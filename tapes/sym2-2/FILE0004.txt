./  ADD  SSI=62440113,NAME=IEHMOVE
*********************************************************************** 00020000
*                                                                     * 00040000
* NAME                                                                * 00060000
*                                                                     * 00080000
*    IEHMVSSD CSECT FOR IEHMOVE PROGRAM                               * 00100000
*                                                                     * 00120000
*********************************************************************** 00140000
*                                                                     * 00160000
* FUNCTION/OPERATION                                                  * 00180000
*                                                                     * 00200000
*    THIS IS THE ROOT SEGMENT FOR IEHMOVE, THE SYSTEM UTILITY THAT    * 00220000
*  MOVES AND COPIES LOGICAL COLLECTIONS OF OPERATING SYSTEM/360 DATA. * 00240000
*  ITS FUNCTIONS ARE AS FOLLOWS                                       * 00260000
*                                                                     * 00280000
*      1.  IT SAVES THE REGISTERS OF THE CALLING PROGRAM              * 00300000
*      2.  GETS CORE FOR THE COMMUNICATION REGION OF IEHMOVE          * 00320000
*      3.  SETS THE TRACE INDICATORS FOR THE OVERLAY SEGMENTS         * 00340000
*      4.  LINKS TO THE FIRST OVERLAY SEGMENT (ENTRY = IEHMVXSE)      * 00360000
*      5.  RETURNS CONTROL TO THE CALLING PROGRAM                     * 00380000
*                                                                     * 00400000
*********************************************************************** 00420000
*                                                                     * 00440000
* ENTRY POINTS                                                        * 00460000
*                                                                     * 00480000
*    THE ONLY ENTRY POINT TO THE ROOT SEGMENT IS IEHMVSSD, THE CSECT  * 00500000
*  NAME, OR IEHMVESD, THE SAME INSTRUCTION.  THIS ENTRY POINT IS THE  * 00520000
*  POINT WHERE THE CALLING PROGRAM ENTERS IEHMOVE.                    * 00540000
*                                                                     * 00560000
*********************************************************************** 00580000
*                                                                     * 00600000
* INPUT                                                               * 00620000
*                                                                     * 00640000
*    THE ONLY INPUT TO THE ROOT SEGMENT IS THE ADDRESS OF THE         * 00660000
*  PARAMETER LIST PASSED TO IT BY THE CALLING PROGRAM.                * 00680000
*                                                                     * 00700000
*********************************************************************** 00720000
*                                                                     * 00740000
* OUTPUT                                                              * 00760000
*                                                                     * 00780000
*    THE OUTPUT TO THE FIRST OVERLAY SEGMENT IS TWOFOLD.  FIRST,      * 00800000
*  THE PARAMETER LIST ADDRESS FROM THE CALLING PROGRAM IS PASSED TO   * 00820000
*  THE OVERLAY SEGMENT IN REGISTER 6, AND THE ADDRESS OF THE          * 00840000
*  COMMUNICATION REGION IS PASSED IN REGISTER 13.                     * 00860000
*                                                                     * 00880000
*********************************************************************** 00900000
*                                                                     * 00920000
* EXTERNAL ROUTINES                                                   * 00940000
*                                                                     * 00960000
*    AS FAR AS THE ROOT SEGMENT IS CONCERNED THE ONLY EXTERNAL        * 00980000
*  ROUTINE IS THE FIRST OVERLAY SEGMENT, IEHMVXSE.                    * 01000000
*                                                                     * 01020000
*********************************************************************** 01040000
         EJECT                                                          01060000
**********************************************************************  01080000
*                                                                     * 01100000
* EXITS                                                               * 01120000
*                                                                     * 01140000
*    THE ONLY EXIT IS A RETURN TO THE CALLING PROGRAM.                * 01160000
*                                                                     * 01180000
*********************************************************************** 01200000
*                                                                     * 01220000
* TABLES/WORK AREAS                                                   * 01240000
*                                                                     * 01260000
*    THE ONLY WORK AREA USED IS THE COMMUNICATION REGION ITSELF.      * 01280000
*  THERE IS NO SYMBOLIC NAME FOR THIS REGION SINCE THE AREA IS        * 01300000
*  OBTAINED BY A GETMAIN MACRO INSTRUCTION.                           * 01320000
*                                                                     * 01340000
*********************************************************************** 01360000
*                                                                     * 01380000
* ATTRIBUTES                                                          * 01400000
*                                                                     * 01420000
*    REENTRANT AND REUSEABLE                                          * 01440000
*                                                                     * 01460000
*********************************************************************** 01480000
IEHMVSSD CSECT                                                          01486004
*A031649                                                       @ZA06531 01492004
         EJECT                                                          01500000
*C031637                                                       @ZA03372 01520103
*A031637                                                       @ZA00101 01520402
*D031637-031644,031679-031685,031707-031713,031880-031888      @ZA00101 01520802
*D031918-031925                                                @ZA00101 01521202
*C031946                                                       @ZA00101 01521602
*                                                                A50932 01522100
*D023606,023630,023631                                           A99999 01524500
* 023631-023954,030212-030460,032007-065007                      A44303 01526600
* 032008-032012                                                  I30905 01528700
*                                                                A30471 01530800
* 030480                                                           I276 01532900
* 030600,031600                                                  A29758 01535019
* 031890                                                         A36041 01536020
* 031491,031617-031624,031736,031771-031778,031813-031827,031862 A36113 01538021
* 032016,032032-032132                                           A38736 01538121
*C031533,031547,031568,031575,031603,031610,031642,031644,031652,A46081 01538322
*C031677,031680,031685,031687,031705,031708,031713,031715,031730,A46081 01538522
*C031734,031736,031771,031785,031813,031882,032002               A46081 01538722
*D031540,031608,031631,031635,031643,031645,031686,031714,031722,A46081 01538922
*D031737-031750,031792,031799,031890-031903                      A46081 01539122
*A031535-031545,031605,031607,031615-031630,031646-031650,031654,A46081 01539322
*A031656,031689,031691,031717-031723,031741-031751,031789-031801,A46081 01539522
*A036002-060002                                                  A46081 01539722
*                             REGISTER NOTATION AND USAGE               01540000
R0       EQU   0                                                        01560000
R1       EQU   1                                                        01580000
R2       EQU   2                                                        01600000
R6       EQU   6                                                        01620000
R7       EQU   7                                                        01640000
R13      EQU   13                       SAVE  REG                       01680000
R14      EQU   14                       RETURN REG                      01700000
R15      EQU   15                       ENTRY POINT REG                 01720000
R3       EQU   3                                                 A20878 01722018
R4       EQU   4                                                 A20878 01724018
R5       EQU   5                                                 A20878 01726018
R8       EQU   8                                                 A20878 01728018
R9       EQU   9                                                 A20878 01730018
R10      EQU   10                                                A20878 01732018
R11      EQU   11                                                A20878 01734018
R12      EQU   12                                                A20878 01736018
*                                                                       01740000
*                             ENTRY AND EXTRN STATEMENTS                01760000
         ENTRY IEHMVESD                                                 01780000
*                                                                       01800000
*                             USING STATEMENTS                          01820000
         USING IEHMVESD,R11                                      A20878 01840018
*                                                                       01860000
*                                                                       01880000
IEHMVESD SAVE  (14,12),T,IEHMOVE                                        01900000
         LR    R11,R15       SET UP ADDRESSABILITY               A20878 01920018
         LR    R6,R1                    SAVE POINTER TO CALLING         01940000
*                                       PROGRAMS PARAMETER LIST         01960000
       GETMAIN R,LV=440                                                 01980000
*                             ON RETURN FROM GETMAIN, REG 1 CONTAINS    02000000
*                             POINTER TO 440 BYTE SAVE AREA  TO BE      02020000
*                             USED BY THE MOVE/COPY PROGRAM. REG 13     02040000
*                             WILL SUBSEQUENTLY POINT TO THE NEXT       02060000
*                             AVAILABLE SAVE AREA WITHIN THIS           02080000
*                             440 BYTE EXTENT. CONSEQUENTLY NO          02100000
*                             MODULE WITHIN THE MOVE/COPY PROGRAM       02120000
*                             SHOULD ALLOCATE ITS OWN SAVE              02140000
*                             AREA. 440 BYTES HAS BEEN COMPUTED         02160000
*                             AS THE MAXIMUM EXTENT REQUIRED            02180000
*                             FOR SAVING REGISTERS WITHIN ANY           02200000
*                             GIVEN PATH OF THE MOVE/COPY PROGRAM.      02220000
*                                                                       02240000
*                                                                       02260000
         ST    R1,8(R0,R13)             SET UP FORWARD AND BACKWARD     02280000
         ST    R13,4(R0,R1)             CHAINING TO THE SAVE AREA       02300000
         LR    R13,R1                                                   02320000
         MVI   12(R13),X'00'           SET TRACE INDICATORS             02340000
         MVI   8(R13),X'FF'                                             02360000
         LA    R10,80(R13)        CHAIN SAVE AREAS               A20878 02361218
         ST    R10,8(R13)                                        A20878 02361818
         ST    R13,4(R10)                                        A20878 02362418
         L     R14,12(R13)              RESET REG 14             A20878 02396018
         LA    R1,STAEEXIT             PASS EXIT ROUTINE ON      A30471 02396319
         LINK  EP=IEHMVXSE    GO TO NEXT MODULE                  A20878 02396618
         EJECT                                                          02400000
*********************************************************************** 02420000
*    ON RETURN FROM PROCESSING A MOVE/COPY REQUEST, THE FOLLOWING CODE* 02440000
* TESTS IEHMVV41+13, THE RETURN CODE BYTE, AND SETS THE CORRECT CODE  * 02460000
* IN REGISTER 15 PRIOR TO RETURNING TO THE INVOKING PROGRAM.          * 02480000
*                                                                     * 02500000
* THE FORMAT OF IEHMVV41+13 IS AS FOLLOWS                             * 02520000
*                                                                     * 02540000
*        BITS 0-3  UNUSED                                             * 02560000
*        BIT  4    RETURN CODE 16 SHOULD BE RETURNED                  * 02580000
*        BIT  5    RETURN CODE 12 SHOULD BE RETURNED                  * 02600000
*        BIT  6    RETURN CODE  8 SHOULD BE RETURNED                  * 02620000
*        BIT  7    RETURN CODE  4 SHOULD BE RETURNED                  * 02640000
*        BITS 4-7 OFF MEANS RETURN CODE ZERO                          * 02660000
*                                                                     * 02680000
*    PRIOR TO RETURNING TO THIS POINT, IEHMVESK, THE WRAP UP ROUTINE, * 02700000
* INSERTS INTO REGISTER 15 THE CONTENTS OF IEHMVV41+13.               * 02720000
*********************************************************************** 02740000
*                                                                       02760000
*                                                                       02780000
         BALR  R11,R0                                            A20878 02800018
         USING *,R11                                             A20878 02820018
         LA    R7,4                                                     02840000
         LR    R6,R15                  PUT RETURN CODE IN REG 6         02860000
         SLL   R6,28                   SHIFT BITS 4-7 TO HIGH ORDER     02880000
*                                      BIT POSITIONS                    02900000
         LA    R15,16                  SET RETURN CODE AT 16            02920000
CHKCODE  LTR   R6,R6                   CHECK HIGH ORDER BIT             02940000
         BM    RETURN                  EXIT IF HIGH ORDER BIT ON        02960000
         SLL   R6,1                    SET UP TO CHECK NEXT BIT         02980000
         SR    R15,R7                  REDUCE RETURN CODE BY 4          03000000
         BP    CHKCODE                 CHECK NEXT BIT IF CODE NOT ZERO  03020000
RETURN   LR    R9,R15                  SAVE RETURN CODE          A29758 03020619
FINISH   DELETE EP=DEVMASKT            DELETE DEVICE MASK TABLE    I276 03050019
         L     R6,4(R0,R13)            LOAD SAVE AREA ADDRESS      I276 03054019
         LA    R0,440                  RELEASE STORAGE ACQUIRED FOR     03080000
*                                      SAVE AREA                        03100000
         FREEMAIN R,LV=(0),A=(13)                                       03120000
         STAE  0                                                 A30471 03130019
         LR     R13,R6       LOAD SAVE AREA ADDRESS                     03140019
         LR     R15,R9  LOAD RETURN CODE                                03140119
         RETURN  (14,12),T,RC=(15)     RETURN TO INVOKING PROGRAMA30471 03141419
**********************************************************************  03142119
*       THIS ROUTINE IS ENTERED ONLY WHEN AN ABEND OCCURS IN IEHMOVE.*  03142819
*  REGISTER 12 POINTS TO THE IEHMVV DSECT.  THE DSECT IS USED FOR    *  03143519
*  OBTAINING THE SYSUT1 DCB ADDRESS AND DETERMINING IF A TEMPORARY   *  03144219
*  DATA SET NAME WAS USED ON A MOVE OPERATION.  THE ROUTINE SCRATCHES*  03144919
*  THE WORKFILE AND TEMPORARY DATA SETS ON MOVE.                     *  03145619
**********************************************************************  03146319
STAEEXIT EQU   *                                                 A30471 03147019
         BALR  R10,0                                             A30471 03147719
         USING *,R10                                             A30471 03148419
         LA    R3,12                                             A36113 03148821
         CR    R0,R3                   IS STAE WORK AREA IN CORE A36113 03148921
         BNE   IEHSTA01                YES- GET POINTER TO       A30471 03149819
*                                      DSECT FROM WORK AREA      A30471 03150519
         LR    R12,R2                  GET POINTER TO DSECT      A30471 03151219
         B     IEHSTA02                CONTINUE                  A30471 03151919
IEHSTA01 L     R12,0(R1)               GET POINTER TO DSECT      A30471 03152619
         USING IEHMVV,R12                                        A46081 03153322
IEHSTA02 L     R5,IEHMVV40             GET SYSUT1 DCB PTR        A46081 03153522
         USING IHADCB,R5                                         A46081 03153722
         STM   R13,R14,SAVEDW          SAVE SENSITIVE REGS       A46081 03153922
IEHSTA03 L     R3,CVTPTR               GET PTR TO CVT            A46081 03154122
         USING IEACVT,R3                                         A46081 03154322
         L     R3,CVTTCBP              GET PTR TO NEW/OLD TCB    A46081 03154522
         DROP  R3                                                A46081 03154722
         L     R4,4(R3)                ADDRESS OF CURRENT TCB    A30471 03155419
         L     R3,12(R4)               ADDRESS OF TIOT           A30471 03156119
         TM    DCBOFLGS,OPENED         DCB OPENED                A46081 03156822
         BZ    SKIP1                   *B IF NOT                 A46081 03157522
         LH    R4,40(R5)               OFFSET IN TIOT OF DDNAME  A30471 03158219
         AR    R3,R4                   ADDRESS IN TIOT OF DDNAME A30471 03158919
PREPARE  L     R4,16(R3)               ADDRESS OF UCB            A30471 03159619
         LA    R4,0(,R4)               CLEAR HI-BITS             A46081 03160322
         USING IEFUCBOB,R4                                       A46081 03160522
         CLI   UCBTYP+2,X'20'          DATACELL                  A46081 03160722
         BNE   FOR2321                 YES-BRANCH                A36113 03160921
         MVC   DEVAREA(4),UCBTYP       NO-PUT DEVTYPE IN LIST    A46081 03161022
         MVC   DEVAREA+4(6),SRTEVOLI   PUT VOLSER IN LIST        A46081 03161522
         CLC   DSNAME(8),TEMP          THIS PASS FOR **TEMP      A46081 03162022
         BE    SCRATCH                 *B IF YES                 A46081 03162522
         CLI   IEHMVV39+5,X'FF'        SYSUT1 ALLOCATED          A46081 03163022
         BE    SCRUT2                  NO BYPASS SCRATCH         A44331 03163621
         MVC   DSNAME+9(8),IEHMVV87    MOVE TIME TO **SYSUT1   @ZA03372 03163703
SCRATCH  TM    DCBOFLGS,OPENED         DCB OPEN                  A46081 03164622
         BZ    OVERCLOS                *B IF NOT.SKIP CLOSE      A46081 03164822
         OI    0(R12),X'80'            SET UP HIGH ORDER BIT   @ZA06531 03164904
         CLOSE ((R5)),MF=(E,(R12))     CLOSE THE DS              A46081 03165022
OVERCLOS SR    R0,R0                                             A46081 03165222
         SCRATCH DELLIST                                         A46081 03165422
         CLC   DSNAME(8),TEMP          SCRATCHED TEMPNAME        A46081 03165622
         BE    ENDIT                   FINISHED                  A30471 03165919
         CLI   DSNAME+7,X'F1'          WAS THIS SYSUT1?          A30471 03166619
         BNE   TESTUT2                 TEST SYSUT2               A30471 03167321
SCRUT2   CLI   IEHMVV39+6,X'FF'        WAS SYSUT2 ALLOCATED      A46081 03167722
         BE    SCRUT3                  NO BYPASS SCRATCH UT2     A44331 03167821
         MVI   DSNAME+7,X'F2'          MAKE NAME = **SYSUT2      A46081 03168722
         L     R5,IEHMVV41             GET SYSUT2 DCB PTR        A46081 03168922
         B     SCRATCH                 *B TO SCRATCH/CLOSE UT2   A46081 03169122
TESTUT2  CLI   DSNAME+7,X'F2'          WAS THIS SYSUT2?          A30471 03169421
         BNE   TEMPNAME                IS THERE A **TEMP?        A30471 03170119
SCRUT3   CLI   IEHMVV39+7,X'FF'        WAS SYSUT3 ALLOCATED      A46081 03170522
         BE    TEMPNAME                NO BYPASS SCRATCH UT3     A44331 03170621
         MVI   DSNAME+7,X'F3'          MAKE DSN=UT3              A46081 03171522
         L     R5,IEHMVV42             GET SYSUT3 DCB PTR        A46081 03171722
         B     SCRATCH                 *B TO CLOSE/SCRATCH UT3   A46081 03171922
ENDIT    SR    R15,R15                 RET CODE FOR STAE=DUMP    A46081 03172122
         LM    R13,R14,SAVEDW          RELOAD SENSITIVE REGS     A46081 03172322
         BR    14                      RETURN TO STAE            A30471 03172919
FOR2321  MVC   DEVAREA+4(6),SRTEVOLI   PUT VOLSER IN LIST        A46081 03173022
         SR    R3,R3                                             A36113 03173121
         LH    R3,0(R4)                GET BIN NUMBER            A36113 03173221
         SLL   R3,4                    GET DISPLACEMENT          A36113 03173321
         LA    R6,56                   TO START OF UCB           A46081 03173422
         SR    R4,R3                   GET ADDRESS               A36113 03173521
         SR    R4,R6                   OF UCB                    A46081 03173622
         MVC   DEVAREA(4),UCBTYP       PUT DEVTYPE IN LIST       A46081 03174122
         B     SCRATCH                 *B TO CLOSE/SCRATCH       A46081 03174622
TEMPNAME L     R2,IEHMVV21             PTR TO 'TO' DSNAME        A46081 03175122
         CLC   0(8,R2),TEMP            IS IT **TEMP?             A30471 03175719
         BNE   ENDIT                   NO - FINISHED             A30471 03176419
         TM    IEHMVV20,X'80'          MOVE SPECIFIED ON CC      A46081 03177122
         BO    ENDIT                   YES-DO NOT SCRATCH        A36113 03177821
         L     R5,IEHMVV31             GET PTR TO 'TO' DCB       A46081 03178522
         LA    R5,0(,R5)               CLEAR HIGH BITS           A46081 03178922
         MVI   DSNAME,C' '             BLANK                     A46081 03179322
         MVC   DSNAME+1(43),DSNAME     DSNAME                    A46081 03179722
         MVC   DSNAME(8),TEMP          DSNAME FOR CAMLIST        A46081 03180122
         B     IEHSTA03                SCRATCH **TEMP            A30471 03180619
SKIP1    MVC   DDNAME(8),DCBDDNAM      GET DDNAME FOR COMPARE    A46081 03181322
         LA    R3,24(R3)               POINT TO FIRST DD ENTRY   A36113 03182021
LOOPX    CLC   4(8,R3),DDNAME          IS THIS THE DDNAME I WANT A36113 03182721
         BE    PREPARE                 YES - BRANCH              A30471 03183419
         SR    R4,R4                   PREPARE FOR INCREASE      A30471 03184119
         IC    R4,0(R3)                GET LENGTH OF TIOT ENTRY  A30471 03184819
         AR    R3,R4                   GET POINTER TO NEXT ENTRY A30471 03185519
         CLC   0(4,R3),ZEROS           CHECK END OF TIOT LIST    A36113 03186221
         BE    ENDIT                   YES - BRANCH TO CLOSE RTN.A30471 03186919
         B     LOOPX                   NO - CONTINUE SEARCH      A30471 03187619
ZEROS    DC    1F'0'                                             A30471 03190419
DDNAME   DS    2F                                                A30471 03191119
TEMP     DC    CL8'**TEMP  '                                     A30471 03193219
DELLIST  CAMLST   SCRATCH,DSNAME,,VOLIST                         A30471 03193919
DSNAME   DC    CL44'**SYSUT1.'                                 @ZA00101 03194602
         DS    0F                                                A30471 03195319
         DS    1H                      TO ALIGN ON BOUNDRY       A30471 03196019
VOLIST   DC    H'1'                    ONE VOLUME                A30471 03196719
DEVAREA  DS    10X                     VOL TYPE                  A30471 03197419
         DC    H'0'                    SEQ NO.                   A30471 03198119
SAVEDW   DS    D                                                 A46081 03200222
OPENED EQU     X'10'                                             A46081 03600222
         IEHMVV                                                         04000222
         DCBD  DSORG=BS,DEVD=DA                                         04400222
IEFUCBOB DSECT                                                          04800222
         IEFUCBOB                                                       05200222
IEACVT   DSECT                                                          05600222
         CVT                                                            06000222
         END                                                            06900721
./  ADD  SSI=62440114,NAME=IEHMVESA
 TITLE 'IEHMVESA-IEHMOVE MESSAGE MODULE'                                00020015
*FUNCTION/OPERATION: THIS MODULE CONTAINS A MESSAGE CSECT CONTAINING  * 00040000
*ALL MESSAGES USED BY THE FOLLOWING MODULES: IEHMVSSE, IEHMVSST &     * 00060000
*IEHMVSSS. THE FUNCTION OF THIS MODULE IS TO SELECT THE PROPER MESSAGE* 00080000
*BASED ON THE MESSAGE NUMBER PASSED IN REG 3 AND SET IT UP IN THE     * 00100000
*WORKAREA TO BE PRINTED BY THE MESSAGE WRITER (IEHMVSSU).             * 00120000
*ENTRY POINTS: IEHMVESA                                               * 00140000
*INPUT: MESSAGE NUMBER IN REG 3 MODULE TO RETURN TO NUMBER IN REG 2.  * 00160000
*REG 2 = 4 IEHMVSSD REG 2 = 8 IEHMVSSS REG 2 = 12 IEHMVSST REG 2 = 0  * 00180000
*IEHMVSSK (FINAL WRAPUP) POINTER TO IEHMOVE1 WORKAREA IN REG 12       * 00200000
*EXTERNAL ROUTINES: IEHMVSSU (MESSAGE WRITER)                         * 00220000
*EXITS - NORMAL SEE INPUT                                             * 00240000
*TITLE ' IEHMVSSD                                                     * 00260000
*ENTRY POINTS: IEHMVESD                                               * 00280000
*OUTPUT: PASSES IEHMOVE1 SAVE AREA POINTER IN REG 13                  * 00300000
*EXITS - NORMAL 'LINK' TO IEHMVSSE (E.P. IEHMVESE)                    * 00340000
IEHMVSSA CSECT                                                          00360000
*D009000,024950                                                  A48781 00362022
*A008300,A009060,009160,024920-024940                            A48781 00364022
*2051000200,003200,020000,020400-020600,021000-021200              2752 00370015
*A8816-8819,1374-1376,20740-20797,24960-24997                   YL026VC 00372002
*C20660                                                         YL026VC 00374002
*C024997                                                       @ZA07346 00377099
         ENTRY IEHMVESA                                                 00380000
         USING IEHMVESA,BASE                                            00400000
         USING MESSAGE,MBASE                                            00420000
         USING IEHMVV,R12                                               00440000
IEHMVESA SAVE  (14,12),T,MESSAGE-MODULE-FOR-ST-SS-SE-10-28-65           00460000
         LR    BASE,15                                                  00480000
         L     MBASE,AMBASE                                             00500000
R0       EQU   0                                                        00520000
R1       EQU   1                                                        00540000
R2       EQU   2                                                        00560000
R3       EQU   3                                                        00580000
R4       EQU   4                                                        00600000
R5       EQU   5                                                        00620000
R6       EQU   6                                                        00640000
R7       EQU   7                                                        00660000
BASE     EQU   8                                                        00680000
MBASE    EQU   9                                                        00700000
R10      EQU   10                                                       00720000
R11      EQU   11                                                       00740000
R12      EQU   12                                                       00760000
R13      EQU   13                                                       00780000
R14      EQU   14                                                       00800000
R15      EQU   15                                                       00820000
BLANK    EQU   C' '                     TO CLEAR PRINT-BUFFER    A48781 00830022
        IEHPRE (14),TFC                                                 00840000
         LTR   R3,R3                                                    00860000
         BM    LINK                                                     00880000
         CH    R3,H12        IS IT MSG IEH315I(12TH MSG)?        A30926 00880620
         BE    SETRC4        SET RETURN CODE OF 4                A30926 00881220
         CH    R3,H22                  IS IT IEH473I            YL026VC 00881602
         BE    SETRC4                  SET RETURN CODE TO 4     YL026VC 00881702
         CH    R3,H20                  IS IT IEH471I            YL026VC 00881802
         BE    SETRC12                 SET RETURN CODE TO 12    YL026VC 00881902
         CH    R3,H16             IS IT MSG IEH388I (16TH MSG)     2752 00882015
         BE    SETRC12            YES,BRANCH                       2752 00884015
         CH    R3,H17             IS IT MSG IEH461I (17TH MSG)     2752 00886015
         BNE   SETRC8             NO, BRANCH                       2752 00888015
SETRC12  OI    IEHMVV41+13,X'04'  SET RETURN CODE OF 12            2752 00890015
SETRC8   OI    IEHMVV41+13,X'02'     SET RETURN CODE OF AT LEAST 8 2752 00892015
SETRC4   OI    IEHMVV41+13,X'01'  SET RETURN CODE OF 4           A30926 00896020
         MVI   IEHMVV00,BLANK           TO CLEAR PRINT-BUFFER    A48781 00906022
         MVC   IEHMVV00+1(120),IEHMVV00 CLEAR PRINT-BUFFER       A48781 00916022
         SLL   R3,2                     MULT MESSAGE NO. BY 4           00920000
        LA    R6,MESSTABL-4                                             00940000
         IC    R5,0(R3,R6)              INSERT MESSAGE LENGTH           00960000
         L     R4,0(R3,R6)             LOAD MESSAGE ADDR                00980000
         BCTR  R5,0                     REDUCE LENGTH BY ONE            01000000
         EX    R5,EXINST                MOVE MESSAGE TO PRINT LINE      01020000
         LA    R3,IEHMVV00                                              01040000
LINK     LINK  EP=IEHMVESU                                              01060000
       IEHPOST (14),T                                                   01080000
         LA    15,0(15)                                                 01100000
         LTR   15,15                                                    01120000
         BNE   RET1                                                     01140000
         B     RET2(R2)                                                 01160000
RET2     EQU   *-4                                                      01180000
         B     RET3                     R2 RETURN CONTROL 4 IS SSD      01200000
         B     RET4                                       8 IS SSS      01220000
         B     RET5                                      12 IS SST      01240000
        B     RET1                                                      01260000
EXINST   MVC   IEHMVV00+1(1),0(R4)                                      01280000
RET1     XCTL  (4,12),EP=IEHMVESK                                       01300000
RET3    XCTL  (4,12),EP=IEHMVESE                                        01320000
RET4     XCTL  (4,12),EP=IEHMVESS                                       01340000
RET5     XCTL  (4,12),EP=IEHMVEST                                       01360000
H12      DC    H'12'                                                    01363020
H16      DC    H'16'                                               2752 01366015
H17      DC    H'17'                                               2752 01372015
H20      DC    H'20'                   NUMBER FOR IEH471I       YL026VC 01374002
H22      DC    H'22'                   NUMBER FOR IEH473I       YL026VC 01376002
MESSTABL DS    0F                                                       01380000
         DC    AL1(B-A)                                                 01400000
         DC    AL3(A)                                                   01420000
         DC    AL1(C-B)                                                 01440000
         DC    AL3(B)                                                   01460000
         DC    AL1(D-C)                                                 01480000
         DC    AL3(C)                                                   01500000
         DC    AL1(E-D)                                                 01520000
         DC    AL3(D)                                                   01540000
         DC    AL1(F-E)                                                 01560000
         DC    AL3(E)                                                   01580000
         DC    AL1(G-F)                                                 01600000
         DC    AL3(F)                                                   01620000
         DC    AL1(H-G)                                                 01640000
         DC    AL3(G)                                                   01660000
         DC    AL1(I-H)                                                 01680000
         DC    AL3(H)                                                   01700000
         DC    AL1(J-I)                                                 01720000
         DC    AL3(I)                                                   01740000
         DC    AL1(K-J)                                                 01760000
         DC    AL3(J)                                                   01780000
         DC    AL1(L-K)                                                 01800000
         DC    AL3(K)                                                   01820000
         DC    AL1(M-L)                                                 01840000
         DC    AL3(L)                                                   01860000
         DC    AL1(N-M)                                                 01880000
         DC    AL3(M)                                                   01900000
         DC    AL1(P-N)                                                 01920000
         DC    AL3(N)                                                   01940000
         DC    AL1(Q-P)                                                 01960000
         DC    AL3(P)                                                   01980000
         DC    AL1(R-Q)                                            2752 02000015
         DC    AL3(Q)                                                   02020000
         DC    AL1(S-R)                                          A28295 02040019
         DC    AL3(R)                                              2752 02060015
         DC    AL1(T-S)                                         YL026VC 02066000
         DC    AL3(S)                                           YL026VC 02069000
         DC    AL1(U-T)                                         YL026VC 02074002
         DC    AL3(T)                                           YL026VC 02076002
         DC    AL1(V-U)                                         YL026VC 02078002
         DC    AL3(U)                                           YL026VC 02078402
         DC    AL1(W-V)                                         YL026VC 02078802
         DC    AL3(V)                                           YL026VC 02079202
         DC    AL1(Z-W)                                         YL026VC 02079602
         DC    AL3(W)                                           YL026VC 02079702
AMBASE   DC    A(MESSAGE)                                               02080000
MESSAGE  CSECT                                                          02140000
A        DC    C'IEH301I INCLUDE OP NOT VALID'                          02160000
B        DC    C'IEH302I EXCLUDE OP NOT VALID'                          02180000
C        DC    C'IEH303I REPLACE OP NOT VALID'                          02200000
D        DC    C'IEH304I SUBORDINATE REQ -SKIPPED'                      02220000
E        DC    C'IEH305I MULTIPLE KEYWORD  ERROR'                       02240000
F        DC    C'IEH306I MISPLACED KEYWORD ERROR'                       02260020
G        DC    C'IEH307I KEYWORD NOT PERMITTED'                         02280000
H        DC    C'IEH308I INVALID PARAMETER ERROR'                       02300000
I        DC    C'IEH309I SYNTAX ERROR'                                  02320000
J        DC    C'IEH310I LENGTH ERROR'                                  02340000
K        DC    C'IEH311I INCOMPLETE REQUEST'                            02360000
L        DC    C'IEH315I UNABLE TO FIND FROM VOL'                       02380000
M        DC    C'IEH383I INVALID DEVICE NAME'                           02400000
N        DC    C'IEH384I GENERIC DEVICE NAME ERR'                       02420000
P        DC    C'IEH385I SELECT OP NOT VALID'                           02440000
Q        DC    C'IEH388I UNABLE TO ALLOCATE'                       8257 02460000
         DC    C' IEHMOVE WORKFILES.'                              8257 02480000
R        DC    C'IEH461I UNABLE TO OPEN SYSIN DATA SET'            2752 02490015
S        DC    C'IEH390I INVALID DATA SET NAME SPECIFIED '       A48781 02492022
         DC    C'IN RENAME-PARAMETER'                            A48781 02494022
T        DC    C'IEH470I CVOL NOT PERMITTED.  DATA SET ASSUMED' YL026VC 02496002
         DC    C' TO BE CATALOGED IN MASTER CATALOG.'           YL026VC 02498002
U        DC    C'IEH471I DATA SET NOT FOUND IN CATALOG.'        YL026VC 02498402
V        DC    C'IEH472I CANNOT HONOR CATALOG REQUEST.  DATA'   YL026VC 02498802
         DC    C' SET NOT CATALOGED.'                           YL026VC 02499202
W        DC    C'IEH473I DATA SET WILL BE CATALOGED IN MASTER'  YL026VC 02499602
         DC    C'/USER CATALOG.'                               @ZA07346 02499799
Z        DS    0C                                                       02500000
         IEHMVV                                                    2752 02510015
         END                                                            02520000
./  ADD  SSI=72800111,NAME=IEHMVESH
*        VSAM CATALOG WORK AREA MACRO                            Y02918 00050002
         MACRO                                                   Y02918 00100002
         IEZCTGWA                                                       00150002
CTGWA    DSECT                                                   Y02918 00200002
CTGWAVL  DS    A                                                 Y02918 00250002
CTGWALV  DS    H                                                 Y02918 00300002
CTGWAVCT DS    H                                                 Y02918 00350002
CTGWAUCT DS    H                                                 Y02918 00400002
         MEND                                                    Y02918 00450002
*        VSAM CATALOG VOLUME LIST MACRO                          Y02918 00500002
         MACRO                                                   Y02918 00550002
         IEZCTGVL                                                       00600002
CTGVL    DSECT                                                   Y02918 00650002
CTGVLVOL DS    XL6                                               Y02918 00700002
CTGVLDEV DS    XL4                                               Y02918 00750002
CTGVLSEQ DS    XL2                                               Y02918 00800002
CTGVLTTR DS    XL3                                               Y02918 00850002
         MEND                                                    Y02918 00900002
         TITLE '  IEHMVESH - DATA SET GROUP MODULE'              Y02918 00950002
**************************************************************** Y02918 01000002
*                                                                Y02918 01050002
*TITLE: 'IEHMVESH'                                               Y02918 01100002
*                                                                Y02918 01150002
*FUNCTION/OPERATION: DATA SET GROUP MODULE.                      Y02918 01200002
*        ON FIRST ENTRY FOR A DSGROUP REQUEST, OBTAINS THE NAMES Y02918 01250002
*        OF ALL DATA SETS IN THE GROUP VIA A VSAM GENERIC LOCATE Y02918 01300002
*        REQUEST AND WRITES A RECORD ON SYSUT1 DESCRIBING EACH   Y02918 01350002
*        NON-VSAM DATA SET IN THE GROUP. THEN SETS UP A SINGLE   Y02918 01400002
*        DATA SET MOVE/COPY REQUEST FROM A SYSUT1 RECORD EACH    Y02918 01450002
*        TIME IT IS ENTERED. WHEN ALL THE DATA SETS IN THE GROUP Y02918 01500002
*        HAVE BEEN PROCESSED, IT IS DONE.                        Y02918 01550002
*                                                                Y02918 01600002
*ENTRY POINT: IEHMVESH                                           Y02918 01650002
*                                                                Y02918 01700002
*INPUT: COMMUNICATIONS AREA FIELDS:                              Y02918 01750002
*        IEHMVV21 = ADDRESS OF DSGROUP NAME                      Y02918 01800002
*        IEHMVV40 = ADDRESS OF SYSUT1 DCB                        Y02918 01850002
*        IEHMVV40+4 = ADDRESS OF SYSUT1 DECB                     Y02918 01900002
*        IEHMVV10 = ADDRESS OF NEXT AVAILABLE COMM. AREA         Y02918 01950002
*        IEHMVV20+2 = END OF INPUT FLAG                          Y02918 02000002
*        IEHMVV20 = 'DSNAME' AND 'FROM' FLAGS                    Y02918 02050002
*                                                                Y02918 02100002
*OUTPUT: SYSUT1 RECORD FOR EACH NON-VSAM DATA SET IN GROUP       Y02918 02150002
*        COMMUNICATIONS AREA FIELDS:                             Y02918 02200002
*        IEHMVV27+16 = ADDRESS OF SYSUT1 RECORD AREA             Y02918 02250002
*        IEHMVV27+12 = DSGROUP CONTINUATION FLAG                 Y02918 02300002
*        IEHMVV10 = ADDRESS OF NEXT AVAILABLE COMM. AREA         Y02918 02350002
*        IEHMVV21 = ADDRESS OF 'FROM' DATA SET NAME              Y02918 02400002
*        IEHMVV82 = DSCB TTR FOR SINGLE VOLUME 'FROM' DATA SET   Y02918 02450002
*        IEHMVV22 = VOLUME COUNT AND LIST ADDRESS FOR 'FROM'     Y02918 02500002
*              DATA SET                                          Y02918 02550002
*                                                                Y02918 02600002
*EXTERNAL MODULES: IEHMVESU - TO PRINT ERROR MESSAGES            Y02918 02650002
*                                                                Y02918 02700002
*EXITS:  IEHMVESU - TO PROCESS A SINGLE DATA SET REQUEST         Y02918 02750002
*        IEHMVEST - WHEN A DSGROUP HAS BEEN PROCESSED AND        Y02918 02800002
*              ANOTHER REQUEST IS PENDING                        Y02918 02850002
*        IEHMVESK - WHEN A DSGROUP HAS BEEN PROCESSED AND        Y02918 02900002
*              END OF INPUT WAS ENCOUNTERED                      Y02918 02950002
*                                                                Y02918 03000002
*TABLES/WORK AREA: PERMANENT COMMUNICATIONS AREA - IEHMVV (R12)  Y02918 03050002
*        VSAM CATALOG AREAS - CTGPL (R11), CTGWA (R3),           Y02918 03100002
*              CTGVL (R2)                                        Y02918 03150002
*        SYSUT1 RECORD AREA - UT1RCD (R10)                       Y02918 03200002
*        GENERIC LOCATE WORK AREA - GLWA (R6)                    Y02918 03250002
*        GENERIC LOCATE WORK AREA ENTRY - GLNAME (R7)            Y02918 03300002
*        MODULE WORK AREA (R11)                                  Y02918 03350002
*                                                                Y02918 03400002
*ATTRIBUTES: SERIALLY REUSABLE                                   Y02918 03450002
*                                                                Y02918 03500002
*NOTES: THIS MODULE SUPPORTS DATA SET GROUP OPERATIONS FOR       Y02918 03550002
*        VS2 RELEASE 2.                                          Y02918 03600002
*                                                                Y02918 03650002
**************************************************************** Y02918 03700002
         EJECT                                                   Y02918 03750002
IEHMVESH CSECT                                                   Y02918 03800002
*A069200,095700,096100,096500,112580-113540,118000-118200,     @ZA26030 03800499
*A251100-251300                                                @ZA26030 03800799
*C095500,112500,112540,113840,118300                           @ZA26030 03801099
*D096600                                                       @ZA26030 03801699
*A193100-193200,250600                                         @ZA16446 03802099
*C193000,196000                                                @ZA16446 03804099
*A077100-077200,238008-238016,240705-240745                    @Z40CSJH 03810004
*C071500,111000,197500                                         @ZA10928 03820037
*                                                                Y02918 03850002
*A081700                                                       @ZA07397 03853037
*C071500                                                       @ZA07397 03856037
*A096500-096700                                                @ZA06561 03860037
*D096500                                                       @ZA06561 03870037
*                                                                       03880037
*        REGISTER EQUATES                                        Y02918 03900002
R0       EQU   0                                                 Y02918 03950002
R1       EQU   1                                                 Y02918 04000002
R2       EQU   2                       VOLUME LIST ENTRY BASE    Y02918 04050002
R3       EQU   3                       CATLG WORK AREA BASE AND  Y02918 04100002
*                                      WORK REG                  Y02918 04150002
R4       EQU   4                       WORK REG                  Y02918 04200002
R5       EQU   5                       GENERIC LOCATE AREA       Y02918 04250002
*                                      * USED LENGTH             Y02918 04300002
R6       EQU   6                       GENERIC LOCATE WORK AREA  Y02918 04350002
*                                      * BASE                    Y02918 04400002
R7       EQU   7                       GENERIC LOCATE NAME ENTRY Y02918 04450002
*                                      BASE                      Y02918 04500002
R8       EQU   8                       BASE REGISTER             Y02918 04550002
R9       EQU   9                       WORK REG                  Y02918 04600002
R10      EQU   10                      SYSUT1 RECORD BASE        Y02918 04650002
R11      EQU   11                      CATLG PARM LIST BASE      Y02918 04700002
R12      EQU   12                      COMM. AREA BASE           Y02918 04750002
R13      EQU   13                                                Y02918 04800002
R14      EQU   14                                                Y02918 04850002
R15      EQU   15                                                Y02918 04900002
*                                                                Y02918 04950002
*        LENGTH AND DISPLACEMENT EQUATES                         Y02918 05000002
L1       EQU   1                       LENGTH OF 1               Y02918 05050002
L2       EQU   2                       LENGTH OF 2               Y02918 05100002
L3       EQU   3                       LENGTH OF 3               Y02918 05150002
L4       EQU   4                       LENGTH OF 4               Y02918 05200002
L5       EQU   5                       LENGTH OF 5               Y02918 05250002
L6       EQU   6                       LENGTH OF 6               Y02918 05300002
L12      EQU   12                      LENGTH OF 12              Y02918 05350002
L20      EQU   20                      LENGTH OF 20              Y02918 05400002
L43      EQU   43                      LENGTH OF 43              Y02918 05450002
L44      EQU   44                      LENGTH OF 44              Y02918 05500002
*                                                                Y02918 05550002
D0       EQU   0                       DISPLACEMENT OF 0         Y02918 05600002
D1       EQU   1                       DISPLACEMENT OF 1         Y02918 05650002
D2       EQU   2                       DISPLACEMENT OF 2         Y02918 05700002
D3       EQU   3                       DISPLACEMENT OF 3         Y02918 05750002
D4       EQU   4                       DISPLACEMENT OF 4         Y02918 05800002
D6       EQU   6                       DISPLACEMENT OF 6         Y02918 05850002
D7       EQU   7                       DISPLACEMENT OF 7         Y02918 05900002
D8       EQU   8                       DISPLACEMENT OF 8         Y02918 05950002
D12      EQU   12                      DISPLACEMENT OF 12        Y02918 06000002
D16      EQU   16                      DISPLACEMENT OF 16        Y02918 06050002
D17      EQU   17                      DISPLACEMENT OF 17        Y02918 06100002
*                                                                Y02918 06150002
*        FLAG EQUATES                                            Y02918 06200002
EIP      EQU   X'20'                   END OF INPUT              Y02918 06250002
DSNAME   EQU   X'20'                   DSNAME GIVEN              Y02918 06300002
FROM     EQU   X'01'                   FROM DATA SET SET UP      Y02918 06350002
GL       EQU   0                       GENERIC LOCATE ISSUED     Y02918 06400002
SPL      EQU   4                       SUPERLOCATE ISSUED        Y02918 06450002
DSGCONT  EQU   X'80'                   DSGROUP CONTINUATION      Y02918 06500002
DUMMY    EQU   X'FF'                   DUMMY RECORD CODE         Y02918 06550002
*                                                                Y02918 06600002
*        MISCELLANEOUS EQUATES                                   Y02918 06650002
B1       EQU   1                       SHIFT 1 BIT               Y02918 06700002
B2       EQU   2                       SHIFT 2 BITS              Y02918 06750002
B8       EQU   8                       SHIFT 8 BITS              Y02918 06800002
HEX0F    EQU   X'0F'                   SIGN FOR CONVERSION       Y02918 06850002
BLANK    EQU   X'40'                   EBCDIC BLANK              Y02918 06900002
DOT      EQU   X'4B'                   EBCDIC DOT              @ZA26030 06920099
NONVSAM  EQU   X'C1'                   NON-VSAM DATA SET         Y02918 06950002
M3       EQU   3                       MASK FOR ICM              Y02918 07000002
*                                                                Y02918 07050002
*        PROLOGUE                                                Y02918 07100002
         SAVE  (14,12),T,IEHMVESH-OZ26030                      @ZA26030 07150099
         BALR  R8,R0                   ESTABLISH ADDR            Y02918 07200002
         USING *,R8                                              Y02918 07250002
         IEHPRE (14,1),TF                                        Y02918 07300002
*        ASSEMBLER USING STATEMENTS                              Y02918 07350002
         USING CTGVL,R2                                          Y02918 07400002
         USING CTGWA,R3                                          Y02918 07450002
         USING GLWA,R6                                           Y02918 07500002
         USING GLNAME,R7                                         Y02918 07550002
         USING UT1RCD,R10                                        Y02918 07600002
         USING CTGPL,R11                                         Y02918 07650002
         USING IEHMVV,R12                                        Y02918 07700002
CVOLTEST TM    IEHMVV20+1,X'40'        IS CVOL BIT ON - IF YES @Z40CSJH 07710004
         BO    CVOLNTRY                BR TO CVOL PROCESSING   @Z40CSJH 07720004
         TITLE ' IEHMVESH - GROUP SET-UP'                        Y02918 07750002
*                                                                Y02918 07800002
*        ON FIRST ENTRY, OBTAIN LIST OF DATA SETS IN GROUP.      Y02918 07850002
*        ON SUBSEQUENT ENTRIES, SET UP NEXT MOVE/COPY REQUEST.   Y02918 07900002
*                                                                Y02918 07950002
         TM    IEHMVV27+D12,DSGCONT    DSGROUP CONTINUATION      Y02918 08000002
         BZ    GLREQ                   NO - NEED LIST OF NAMES   Y02918 08050002
         L     R10,IEHMVV27+D16        SET SYSUT1 RECORD ADDRESS Y02918 08100002
         LA    R2,UT1VLST              SET VOL LIST ADDRESS      Y02918 08150002
         NI    IEHMVV20+2,X'BE'        TURN OFF ABORT BITS     @ZA07397 08170037
         B     RDUT1                   READ NEXT SYSUT1 RECORD   Y02918 08200002
*                                                                Y02918 08250002
*        FIRST ENTRY. OBTAIN THE NAMES OF THE DATA SETS IN THE   Y02918 08300002
*        GROUP VIA A VSAM GENERIC LOCATE.                        Y02918 08350002
*                                                                Y02918 08400002
GLREQ    L     R10,IEHMVV10            USE NEXT AVAILABLE AREA   Y02918 08450002
         ST    R10,IEHMVV27+D16        * IN COMM. AREA FOR       Y02918 08500002
*                                      * SYSUT1 RECORD AREA      Y02918 08550002
         LA    R2,UT1VLST              SET VOL LIST BASE         Y02918 08600002
         LA    R11,IEHMVV00            SET MODULE WORK AREA BASE Y02918 08650002
         XC    CTGPL(CTGPLLEN),CTGPL   INITIALIZE PARM LIST      Y02918 08700002
         XC    UT1OVHD,UT1OVHD         INITIALIZE SYSUT1 RECORD  Y02918 08750002
*        SET UP GENERIC LOCATE PARM LIST AND WORK AREA           Y02918 08800002
         OI    CTGOPTN1,CTGNAME+CTGGENLD SET GENREIC LOCATE      Y02918 08850002
         OI    CTGOPTN3,CTGSUPLT+CTGAM0 * OPTION FLAGS           Y02918 08900002
         LA    R9,GLREQNM              SET GENERIC DATA SET      Y02918 08950002
         ST    R9,CTGENT               * NAME ADDRESS            Y02918 09000002
*        SET UP GENERIC DATA SET NAME ENTRY                      Y02918 09050002
         L     R4,IEHMVV21             SET NAME ADDRESS          Y02918 09100002
         SR    R3,R3                   INITIALIZE LEGNTH         Y02918 09150002
GNL      CLI   D0(R4),BLANK            BLANK AFTER NAME          Y02918 09200002
         BE    SETNL                   YES - END OF NAME         Y02918 09250002
         LA    R3,D1(R3)               INCREMENT LENGTH BY 1     Y02918 09300002
         LA    R4,D1(R4)               INCREMENT NAME POINTER    Y02918 09350002
         CH    R3,MAXNL                MAX LENGTH REACHED        Y02918 09400002
         BH    SET43                   YES - USE LENGTH          Y02918 09450002
         B     GNL                     NO - CONTINUE SCAN        Y02918 09500002
SET43    MVC   D0(L1,R9),MAXNL+1       SET LENGTH TO MAX       @ZA26030 09550099
         STC   R3,NLENGTH              SET LENGTH DETERMINED   @ZA26030 09570099
         B     SETNM                   SET NAME IN ENTRY         Y02918 09590099
SETNL    EQU   *                                               @ZA26030 09610099
         STC   R3,D0(R9)               SET LENGTH DETERMINED   @ZA06561 09630099
         STC   R3,NLENGTH              SET LENGTH DETERMINED   @ZA26030 09650099
SETNM    L     R4,IEHMVV21             SET NAME ADDRESS          Y02918 09700002
         MVC   D1(L43,R9),D0(R4)       SET NAME IN ENTRY         Y02918 09750002
*                                                                Y02918 09800002
*        OBTAIN INITIAL AREA FOR GENERIC LOCATE WORK AREA AND    Y02918 09850002
*        SAVE ITS SIZE IN CASE IT IS INSUFFICIENT AND MUST BE    Y02918 09900002
*        FREED                                                   Y02918 09950002
*                                                                Y02918 10000002
         L     R9,C904                 SET INITIAL WORK AREA     Y02918 10050002
         ST    R9,GLSIZE               * SIZE AND SAVE           Y02918 10100002
         GETMAIN R,LV=904              OBTAIN WORK AREA          Y02918 10150002
         ST    R1,CTGWKA               SET WORK AREA ADDRESS     Y02918 10200002
         LR    R6,R1                   SET WORK AREA BASE        Y02918 10250002
*        ENTER HERE TO REISSUE GENERIC LOCATE WITH A LARGER WORK Y02918 10300002
*        AREA                                                    Y02918 10350002
GLRE     STH   R9,GLWALEN              SET WORK AREA LENGTH      Y02918 10400002
         CATLG MF=(E,CTGPL)            ISSUE GENERIC LOCATE      Y02918 10450002
*        TEST RETURN CODE FROM CATALOG MANAGEMENT                Y02918 10500002
         LA    R1,GL                   INDICATE GENERIC LOCATE   Y02918 10550002
         BAL   R14,LOCRCK              ANALIZE RETURN CODE       Y02918 10600002
         B     GLOK                    LOCATE SUCCESSFUL         Y02918 10650002
         B     GLRE                    REISSUE REQUEST           Y02918 10700002
         B     DSGDNE                  ERROR - TERMINATE REQUEST Y02918 10750002
         EJECT                                                   Y02918 10800002
*                                                                Y02918 10850002
*        GENERIC LOCATE WAS SUCCESSFUL. SCAN DATA SET NAME       Y02918 10900002
*        ENTRIES FOR NON-VSAM DATA SETS                          Y02918 10950002
*                                                                Y02918 11000002
GLOK     SR    R5,R5                                             Y02918 11050002
         ICM   R5,3,GLWANLEN           GET LENGTH OF NAME AREA @ZA10928 11100037
         SH    R5,NMOV                 SUBTRACT OVERHEAD         Y02918 11150002
         LA    R7,GLWAFNME             GET FIRST NAME ENTRY ADDR Y02918 11200002
TSTNV    CLI   GLENTYP,NONVSAM         DATA SET VSAM           @ZA26030 11250099
         BNE   ENTDNE                  YES- CANT HONOR REQUEST @ZA26030 11254099
* IF LENGTH IS 44 OR IF BLANK AFTER NAME THEN IT IS A          @ZA26030 11258099
* FULLY QUALIFIED NAME AND THE DATA SET SHALL BE COPIED.       @ZA26030 11262099
         ST    R3,SAVEREG3             SAVE REG3               @ZA26030 11266099
         ST    R7,SAVEREG7             SAVE REG7               @ZA26030 11270099
         SR    R3,R3                   CLEAR REG 3             @ZA26030 11274099
         IC    R3,NLENGTH              GET LENGTH OF NAME      @ZA26030 11278099
         LA    R9,44                   SET MAX NAME EQUAL 44   @ZA26030 11282099
         SR    R9,R3       FULLY QUALIFIED NAME OF 44 CHARS ?  @ZA26030 11286099
         BNZ   NOT44                   NO - GO ON              @ZA26030 11290099
         CLC   D0(L44,R4),D1(R7)       YES - CHECK IF THIS     @ZA26030 11294099
*                                      IS THE NAME WE ARE      @ZA26030 11298099
*                                      LOOKING FOR.            @ZA26030 11302099
         BNE   RESTORE                 NO - CANT HONOR REQUEST @ZA26030 11306099
         BE    DSNV                    YES - CAN HONOR REQUEST @ZA26030 11310099
NOT44    EQU   *                                               @ZA26030 11314099
         LA    R3,D1(R3)          ADD ONE TOO POINT AFTER NAME @ZA26030 11315099
         AR    R7,R3                   POINT AFTER NAME        @ZA26030 11318099
         CLI   D0(R7),BLANK           IS IT A BLANK AFTER NAME @ZA26030 11322099
         BE    DSNV                    YES - CAN HONOR REQUEST @ZA26030 11326099
* IF A DOT AFTER NAME THE DATA SET SHALL BE COPIED IN OTHER    @ZA26030 11330099
* CASE GET NEXT ENTRY.                                         @ZA26030 11334099
         CLI   D0(R7),DOT              IS IT A DOT AFTER NAME  @ZA26030 11338099
         BE    DSNV                    YES - CAN HONOR REQUEST @ZA26030 11342099
RESTORE  EQU   *                                               @ZA26030 11346099
         L     R7,SAVEREG7             RESTORE REG7            @ZA26030 11355099
         L     R3,SAVEREG3             RESTORE REG3            @ZA26030 11364099
ENTDNE   EQU   *                                               @ZA26030 11373099
         SH    R5,GLWAELEN             ALL ENTRIES PROCESSED   @ZA26030 11382099
         BNP   DUMWT                   YES - WRITE DUMMY RCD     Y02918 11400002
         AH    R7,GLWAELEN             POINT TO NEXT ENTRY       Y02918 11450002
         B     TSTNV                   TEST ENTRY TYPE           Y02918 11500002
         EJECT                                                   Y02918 11550002
*                                                                Y02918 11600002
*        DATA SET IS NON-VSAM. ISSUE SUPERLOCATE TO OBTAIN       Y02918 11650002
*        IT'S VOLUME LIST                                        Y02918 11700002
*                                                                Y02918 11750002
DSNV     EQU   *                                               @ZA26030 11800099
         L     R7,SAVEREG7             RESTORE REG7            @ZA26030 11810099
         L     R3,SAVEREG3             RESTORE REG3            @ZA26030 11820099
         XC    CTGPL(CTGPLLEN),CTGPL   INITIALIZE PARM LIST    @ZA26030 11830099
         OI    CTGOPTN3,CTGSUPLT+CTGAM0 SET SUPERLOCATE OPTIONS  Y02918 11850002
         LA    R3,SPWA                 SET WORK AREA ADDRESS     Y02918 11900002
         ST    R3,CTGWKA               * IN PARM LIST            Y02918 11950002
         LA    R9,GLDSNM               SET DATA SET NAME ADDRESS Y02918 12000002
         ST    R9,CTGENT                                         Y02918 12050002
         LA    R9,GLREQNM              SET CVOL RETURN AREA      Y02918 12100002
         ST    R9,CTGCVOL              * ADDRESS                 Y02918 12150002
         ST    R2,CTGWAVL              SET VOLUME LIST ADDRESS   Y02918 12200002
         MVC   CTGWALV,VLLEN           SET VOLUME LIST LENGTH    Y02918 12250002
         CATLG MF=(E,CTGPL)            ISSUE SUPERLOCATE         Y02918 12300002
*        TEST RETURN CODE FROM CATALOG MANAGEMENT                Y02918 12350002
         LA    R1,SPL                  INDICATE SUPERLOCATE      Y02918 12400002
         BAL   R14,LOCRCK              ANALIZE RETURN CODE       Y02918 12450002
         B     SPLOK                   SUCCESSFUL                Y02918 12500002
         B     SPLOK                   SUCCESSFUL                Y02918 12550002
         B     ENTDNE                  ERROR - SKIP DATA SET     Y02918 12600002
         EJECT                                                   Y02918 12650002
*                                                                Y02918 12700002
*        SUPERLOCATE WAS SUCCESSFUL. CONSTRUCT DATA SET RECORD.  Y02918 12750002
*                                                                Y02918 12800002
SPLOK    MVC   UT1NAME(44),GLDSNM      SET DATA SET NAME         Y02918 12850002
         SR    R9,R9                                             Y02918 12900002
         LH    R9,CTGWAVCT             GET VOLUME COUNT          Y02918 12950002
         CH    R9,MAXVC                MORE THAN MAX VOLUMES     Y02918 13000002
         BNH   SETVC                   NO - SET VOL COUNT        Y02918 13050002
         MVC   UT1VLCT,MAXVC           SET VOL COUNT TO MAX      Y02918 13100002
         B     MULTVL                  CONTINUE                  Y02918 13150002
SETVC    MVC   UT1VLCT,CTGWAVCT        SET VOL COUNT RETURNED    Y02918 13200002
         CH    R9,ONEVOL               ONE VOLUME DATA SET       Y02918 13250002
         BNE   MULTVL                  NO - NO TTR               Y02918 13300002
         MVC   UT1TTR,CTGVLTTR         SET DSCB TTR              Y02918 13350002
         B     SKPTTRC                 CONTINUE                  Y02918 13400002
MULTVL   XC    UT1TTR,UT1TTR           SET DSCB TTR TO 0         Y02918 13450002
*        SUPERLOCATE RETURNS INFORMATION IN ORDER:               Y02918 13500002
*              VOLSER,DEVICE CODE,SEQ NO                         Y02918 13550002
*        IEHMOVE REQUIRES INFORMATION IN ORDER:                  Y02918 13600002
*              DEVICE CODE,VOLSER,SEQ NO                         Y02918 13650002
*        SO EACH ENTRY MUST BE REORDERED                         Y02918 13700002
SKPTTRC  LR    R4,R9                   SET VOL COUNT             Y02918 13750002
REORDER  MVC   TEMPVL,CTGVLVOL         SAVE VOLSER               Y02918 13800002
         MVC   MVEVLDEV(L4),CTGVLDEV   REORDER DEVICE CODE       Y02918 13850002
         MVC   MVEVLVOL(L6),TEMPVL     REORDER VOLSER            Y02918 13900002
         LA    R2,D12(R2)              GET NEXT ENTRY ADDRESS    Y02918 13950002
         BCT   R4,REORDER              LOOP UNTIL DONE           Y02918 14000002
         LA    R2,UT1VLST              RESET TO FIRST ENTRY      Y02918 14050002
*        COMPUTE LENGTH OF VOLUME LIST PORTION OF RECORD         Y02918 14100002
         MH    R9,VLELEN               GET VOLUME LIST LENGTH    Y02918 14150002
         AH    R9,VLOVHD               ADD OVERHEAD              Y02918 14200002
         STCM  R9,M3,UT1VLLEN          SET LENGTH                Y02918 14250002
*                                                                Y02918 14300002
*        WRITE DATA SET RECORD TO SYSUT1                         Y02918 14350002
*                                                                Y02918 14400002
         BAL   R14,RCDWRT              WRITE RECORD              Y02918 14450002
         B     ENTDNE                  GET NEXT ENTRY            Y02918 14500002
         EJECT                                                   Y02918 14550002
*                                                                Y02918 14600002
*        ALL NON-VSAM DATA SETS IN THE GROUP ARE NOW             Y02918 14650002
*        REPRESENTED ON SYSUT1. WRITE A DUMMY RECORD.            Y02918 14700002
*                                                                Y02918 14750002
DUMWT    MVI   UT1CDE,DUMMY            SET DUMMY CODE            Y02918 14800002
         SR    R9,R9                                             Y02918 14850002
         STCM  R9,M3,UT1VLLEN          SET VOLUME LIST LENGTH    Y02918 14900002
         BAL   R14,RCDWRT              WRITE RECORD              Y02918 14950002
*                                                                Y02918 15000002
*        FREE GENERIC LOCATE AREA                                Y02918 15050002
*        REPOSITION SYSUT1 TO BEGIN PROCESSING AT FIRST RECORD   Y02918 15100002
*                                                                Y02918 15150002
RDPT     BAL   R14,GLFREE              FREE GENERIC LOCATE AREA  Y02918 15200002
         L     R3,IEHMVV40             SET SYSUT1 DCB ADDRESS    Y02918 15250002
         POINT (R3),RCD1               POINT TO FIRST RECORD     Y02918 15300002
         TITLE ' IEHMVESH - DATA SET SET-UP'                     Y02918 15350002
*                                                                Y02918 15400002
*        FIRST OR SUBSEQUENT ENTRIES. READ A RECORD FROM SYSUT1  Y02918 15450002
*        AND SET UP FIELDS IN COMMUNICATION AREA TO PERFORM A    Y02918 15500002
*        SINGLE DATA SET MOVE/COPY REQUEST FOR THE FROM VOLUME   Y02918 15550002
*        REPRESENTED BY THE SYSUT1 RECORD.                       Y02918 15600002
*                                                                Y02918 15650002
RDUT1    L     R3,IEHMVV40             SET SYSUT1 DCB ADDRESS    Y02918 15700002
         L     R4,IEHMVV40+4           SET SYSUT1 DECB ADDRESS   Y02918 15750002
         READ  (R4),SF,(R3),UT1RCD,'S',MF=E READ UT1 RECORD      Y02918 15800002
         CHECK (R4)                    WAIT FOR COMPLETION       Y02918 15850002
         TM    UT1CDE,DUMMY            DUMMY RECORD              Y02918 15900002
         BO    DSGDNE                  YES - DSGROUP DONE        Y02918 15950002
*                                                                Y02918 16000002
*        SET UP ADDRESS OF 'FROM' DATA SET NAME IN IEHMVV21.     Y02918 16050002
*        FOR SINGLE VOLUME DATA SETS, IEHMVV82 WILL CONTAIN      Y02918 16100002
*        THE DSCB TTR OF THE 'FROM' DATA SET.                    Y02918 16150002
         LA    R9,UT1NAME              SET FROM DSNAME ADDRESS   Y02918 16200002
         ST    R9,IEHMVV21                                       Y02918 16250002
         MVC   IEHMVV82(L3),UT1TTR     SET UP DSCB TTR           Y02918 16300002
*        SET UP A LIST OF 17 BYTE 'FROM' VOLUME ENTRIES USING    Y02918 16350002
*        THE 12 BYTE ENTRIES IN THE SYSUT1 RECORD. PLACE THE     Y02918 16400002
*        VOLUME COUNT IN THE FIRST BYTE OF IEHMVV22 AND THE      Y02918 16450002
*        ADDRESS OF THE 'FROM' VOLUME LIST IN BYTES 2-4 OF       Y02918 16500002
*        IEHMVV22.                                               Y02918 16550002
         SR    R9,R9                   DETERMINE NEXT AVAILABLE  Y02918 16600002
         ICM   R9,M3,UT1VLLEN          * ADDRESS IN COMM. AREA   Y02918 16650002
*                                      * AFTER SYSUT1 RECORD     Y02918 16700002
         LA    R9,UT1NAME(R9)          * AREA - BUILD 'FROM'     Y02918 16750002
         LA    R9,D8(R9)               VOL LIST THERE            Y02918 16800002
         ST    R9,IEHMVV22             SET 'FROM' VOL LIST ADDR  Y02918 16850002
         SR    R4,R4                                             Y02918 16900002
         LH    R4,UT1VLCT              SET VOLUME COUNT          Y02918 16950002
         LTR   R4,R4                   NO VOLUMES                Y02918 17000002
         BZ    RDUT1                   YES - SKIP DATA SET       Y02918 17050002
         STC   R4,IEHMVV22             SET FROM VOLUME COUNT     Y02918 17100002
LOOP2    MVC   D0(L12,R9),CTGVL        MOVE UT1 ENTRY TO 'FROM'  Y02918 17150004
         XC    D12(L5,R9),D12(R9)      * LIST AND CLEAR EXTRA    Y02918 17200002
         LA    R9,D17(R9)              SET NEXT 'FROM' ENTRY     Y02918 17250002
         LA    R2,D12(R2)              SET NEXT UT1 ENTRY        Y02918 17300002
         BCT   R4,LOOP2                LOOP UNTIL VOL CT IS 0    Y02918 17350004
*        SET UP A POINTER TO THE NEXT AVAILABLE FULLWORD IN THE  Y02918 17400002
*        COMMUNICATIONS AREA                                     Y02918 17450002
         LA    R9,D3(R9)                                         Y02918 17500002
         SRL   R9,B2                                             Y02918 17550002
         SLL   R9,B2                                             Y02918 17600002
         ST    R9,IEHMVV10             SET NEXT AVAIL. ADDRESS   Y02918 17650002
*                                                                Y02918 17700002
*        SET FLAGS FOR A SINGLE DATA SET REQUEST AND DATA SET    Y02918 17750002
*        GROUP CONTINUATION.                                     Y02918 17800002
*                                                                Y02918 17850002
         OI    IEHMVV20,DSNAME+FROM    SET DSNAME AND FROM FLAGS Y02918 17900002
         OI    IEHMVV27+D12,DSGCONT    SET DSGROUP CONT. FLAG    Y02918 17950002
         B     DSPRCS                  PROCESS THE DATA SET      Y02918 18000002
         TITLE ' IEHMVESH - EXITS'                                      18050002
*        EXIT TO IEHMVESZ TO PROCESS THE DATA SET REQUEST        Y02918 18100002
DSPRCS   IEHPOST (14,1),T                                        Y02918 18150002
         XCTL   (2,12),EP=IEHMVESZ                               Y02918 18200002
*                                                                Y02918 18250002
*        AN ENTIRE DATA SET GROUP HAS BEEN PROCESSED. IF ANOTHER Y02918 18300002
*        REQUEST IS PENDING, EXIT TO IEHMVEST, OTHERWISE EXIT TO Y02918 18350002
*        IEHMVESK.                                               Y02918 18400002
DSGDNE   TM    IEHMVV20+D2,EIP         END OF INPUT              Y02918 18450002
         BO    ALLDNE                  YES - WRAP UP RUN         Y02918 18500002
NXTREQ   IEHPOST (14,1),T                                        Y02918 18550002
         XCTL (2,12),EP=IEHMVEST                                 Y02918 18600002
ALLDNE   IEHPOST (14,1),T                                        Y02918 18650002
         XCTL  (2,12),EP=IEHMVESK                                Y02918 18700002
         TITLE ' IEHMVESH - SUBROUTINES'                         Y02918 18750002
*                                                                Y02918 18800002
*        THIS ROUTINE ANALIZES THE RETURN CODE FROM CATALOG      Y02918 18850002
*        MANAGEMENT AFTER A GENERIC LOCATE OR SUPERLOCATE        Y02918 18900002
*                                                                Y02918 18950002
LOCRCK   ST    R14,SVRTN               SAVE RETURN ADDRESS       Y02918 19000002
         LTR   R15,R15                 RC=0                      Y02918 19050002
         BZ    RET0                    YES - LOCATE SUCCESSFUL   Y02918 19100002
         CH    R15,RC8                 RC=8                      Y02918 19150002
         BE    ANYNMS                  YES                       Y02918 19200002
         CH    R15,RC40                RC=40                     Y02918 19250002
         BE    SMALL                   YES                     @ZA16446 19300099
         CH    R15,RC44                RC=44                   @ZA16446 19310099
         BNE   ERR                     NO - UNUSUAL CONDITION  @ZA16446 19320099
         SPACE 2                                                 Y02918 19350002
*        RETURN CODE INDICATES THAT THE WORK AREA WAS TOO SMALL  Y02918 19400002
*        IF REQUEST WAS SUPERLOCATE, EXTRA ENTRIES ARE NOT       Y02918 19450002
*        NEEDED. IF REQUEST WAS GENERIC LOCATE, TRY TO GET CORE  Y02918 19500002
*        NEEDED TO RE-ISSUE THE REQUEST.                         Y02918 19550002
SMALL    LTR   R1,R1                   SUPERLOCATE             @ZA16446 19600099
         BP    RET4                    YES - ACCEPT ERROR        Y02918 19650002
         SR    R9,R9                                             Y02918 19700002
         ICM   R9,3,GLWANLEN           SET FEEDBACK AREA SIZE  @ZA10928 19750037
         ST    R9,GLFDBK               SAVE                      Y02918 19800002
         BAL   R14,GLFREE              FREE ORIGINAL WORK AREA   Y02918 19850002
         L     R9,GLFDBK               SET FEEDBACK SIZE         Y02918 19900002
         ST    R9,GLSIZE               SAVE                      Y02918 19950002
         LA    R6,CTGWKA               SET WORK AREA PTR ADDR    Y02918 20000002
         GETMAIN EC,LV=(R9),A=(R6)     ISSUE COND. GETMAIN       Y02918 20050002
         L     R6,CTGWKA               SET WORK AREA BASE        Y02918 20100002
         LTR   R15,R15                 WAS GETMAIN SUCCESSFUL    Y02918 20150002
         BNZ   NOSPC                   NO                        Y02918 20200002
*        RETURN AT NSI + 4 - SPACE INSUFFICIENT                  Y02918 20250002
RET4     LA    R15,D4                  SET RETURN OFFSET         Y02918 20300002
         B     RETB                    RETURN                    Y02918 20350002
         SPACE 2                                                 Y02918 20400002
*        COULD NOT OBTAIN SPACE REQUIRED FOR THE GENERIC LOCATE. Y02918 20450002
*        ISSUE MESSAGE IEH351I AND RETURN AT OFFSET +8.          Y02918 20500002
NOSPC    L     R3,ADSGM2               SET MESSAGE ADDRESS       Y02918 20550002
*        LINK TO IEHMVESU TO PRINT ERROR MESSAGE                 Y02918 20600002
MSGLNK   LINK  EP=IEHMVESU             PRINT MESSAGE             Y02918 20650002
         LTR   R15,R15                 PERM. I/O ERROR           Y02918 20700002
         BP    ALLDNE                  YES - TERMINATE RUN       Y02918 20750002
*        RETURN AT NSI + 8 - ERROR MESSAGE PRINTED               Y02918 20800002
         LA    R15,D8                  SET RETURN OFFSET         Y02918 20850002
         B     RETB                    RETURN                    Y02918 20900002
         SPACE 2                                                 Y02918 20950002
*        LOCATE WAS SUCCESSFUL. IF NO NAMES WERE RETURNED FOR    Y02918 21000002
*        GENERIC LOCATE REQUEST, ISSUE MESSAGE IEH348I AND       Y02918 21050002
*        RETURN AT OFFSET +8.                                    Y02918 21100002
ANYNMS   LTR   R1,R1                   GENERIC LOCATE            Y02918 21150002
         BZ    NONMS                   YES                       Y02918 21200002
*        RETURN AT NSI - CONTINUE PROCESSING                     Y02918 21250002
RET0     SR    R15,R15                 SET RETURN OFFSET         Y02918 21300002
RETB     L     R14,SVRTN               RESTORE RETURN ADDRESS    Y02918 21350002
         B     D0(R15,R14)             RETURN                    Y02918 21400002
*        NO NAMES WERE FOUND FOR DSGROUP SPECIFIED.              Y02918 21450002
NONMS    L     R3,ADSGM1               SET MESSAGE ADDRESS       Y02918 21500002
*        FREE GOTTEN CORE - REQUEST WILL BE TERMINATED           Y02918 21550002
MSGFRE   BAL   R14,GLFREE              FREE GENERIC LOCATE AREA  Y02918 21600002
         B     MSGLNK                  PRINT MESSAGE             Y02918 21650002
         SPACE 2                                                 Y02918 21700002
*        RETURN CODE INDICATES AN UNUSUAL CONDITION.             Y02918 21750002
*        FOR GENERIC LOCATE, ISSUE MESSAGE IEH354I.              Y02918 21800002
*        FOR SUPERLOCATE, ISSUE MESSAGE IEH356I. RETURN AT       Y02918 21850002
*        OFFSET +8.                                              Y02918 21900002
ERR      L     R3,AERRMT(R1)           SET MESSAGE MODEL ADDR    Y02918 21950002
         MVC   ERRMSG,D0(R3)           MOVE MESSAGE TO WORK AREA Y02918 22000002
         LA    R3,ERRMSG               SET MESSAGE ADDRESS       Y02918 22050002
         LR    R9,R1                   SET LOCATE TYPE OFFSET    Y02918 22100002
         SRL   R9,B1                   DIVIDE OFFSET BY 2        Y02918 22150002
         SR    R4,R4                                             Y02918 22200002
         LH    R4,ARCT(R9)             SET RC OFFSET             Y02918 22250002
         LA    R4,D0(R4,R3)            SET RC ADDRESS            Y02918 22300002
         CVD   R15,CVTAR               CONVERT RC TO EBCDIC      Y02918 22350002
         OI    CVTAR+D7,HEX0F                                    Y02918 22400002
         UNPK  D0(L3,R4),CVTAR+6(L2)   PLACE RC IN MESSAGE       Y02918 22450002
         LTR   R1,R1                   SUPERLOCATE               Y02918 22500002
         BZ    MSGFRE                  NO - TERMINATE            Y02918 22550002
         SR    R4,R4                                             Y02918 22600002
         LH    R4,ADSNM                SET DSNAME OFFSET         Y02918 22650002
         LA    R4,D0(R4,R3)            SET DSNAME ADDRESS        Y02918 22700002
         MVC   D0(L44,R4),GLDSNM       PUT DSNAME IN MESSAGE     Y02918 22750002
         B     MSGLNK                  SKIP DATA SET             Y02918 22800002
         EJECT                                                   Y02918 22850002
*        THIS ROUTINE FREES THE CORE OBTAINED FOR THE            Y02918 22900002
*        GENERIC LOCATE WORK AREA                                Y02918 22950002
GLFREE   ST    R14,GLFSV               SAVE RETURN ADDRESS       Y02918 23000002
         L     R9,GLSIZE               SET AREA SIZE             Y02918 23050002
         FREEMAIN R,LV=(R9),A=(R6)     FREE CORE                 Y02918 23100002
         L     R14,GLFSV               RESTORE RETURN ADDRESS    Y02918 23150002
         BR    R14                     RETURN                    Y02918 23200002
         EJECT                                                   Y02918 23250002
*        THIS ROUTINE WRITES A RECORD ON SYSUT1                  Y02918 23300002
RCDWRT   ST    R14,SVRTN               SAVE RETURN ADDRESS       Y02918 23350002
         SR    R9,R9                                             Y02918 23400002
         ICM   R9,M3,UT1VLLEN          SET VOL LIST LENGTH       Y02918 23450002
         AH    R9,RCDOVHD              ADD OVERHEAD              Y02918 23500002
         L     R4,IEHMVV40             SET SYSUT1 DCB ADDRESS    Y02918 23550002
         L     R3,IEHMVV40+4           SET SYSUT1 DECB ADDRESS   Y02918 23600002
         WRITE (R3),SF,(R4),UT1RCD,(R9),MF=E                     Y02918 23650002
         CHECK (R3)                                              Y02918 23700002
         L     R14,SVRTN               RESTORE RETURN ADDRESS    Y02918 23750002
         BR    R14                     RETURN                    Y02918 23800002
*********************************************************************** 23800404
*       LINES 238020-241109 WERE REACTIVATED                   @Z40CSJH 23800804
*       IN SUPPORT OF THE MVS EXTENDED                         @Z40CSJH 23801204
*       CVOL FUNCTION                                          @Z40CSJH 23801604
*********************************************************************** 23801704
CVOLNTRY EQU   *                                                        23802004
         TM    XSWITCHS,X'08'          IS CLOSE SW ON                   23810004
         BO    CLOSE2                  BRANCH IF YES                    23820004
         L     R4,IEHMVV30+8  ADDR OF BEGINNING OF PERM WORK AREA       23830004
*                             USED BY DSGROUP LOAD 1                    23840004
         ST    R4,IEHMVV10             RECLAIM PERM WORK AREA           23842004
         OI    XSWITCHS,X'08'          TURN ON CLOSE SW                 23844004
CLOSE2   DS    0H                                                       23846004
         TM    XSWITCHS,X'80'           IS FIRST IN SW ON               23848004
         BO    REQCOMP                                                  23848404
         MVC   XPOINTER(4),IEHMVV10                                     23848804
         L     R5,IEHMVV41             LOAD UT2 DCB ADDR                23849204
         BAL   R10,POINT                GO TO POINT ROUTINE             23849604
READ1    L     R4,IEHMVV40+4            LOAD UT1 DECB ADDR              23849704
         L     R5,IEHMVV40              LOAD UT1 DCB ADDR               23849804
         L     R6,XPOINTER                                              23849904
*XXXXX   R6 CONTAINS THE ADDRESS OF THE PERM WORK AREA                  23866604
READ2    READ  (R4),SF,(R5),(R6),'S',MF=E                               23876604
         CHECK (R4)                                                     23878604
         CLI   19(R6),X'FF'                                             23880604
         BE    DWRITE1                                                  23882604
         CLI   19(R6),X'00'                                             23883004
         BE    REQSET                                                   23883104
****** POINTER TO BLOCK IN R6 REFERS TO DATA *****                      23883204
****** READ FROM SYSUT1 INTO THE PERM WORK AREA **                      23888804
WRITE1   L     R6,XPOINTER              POINTER TO BLOCK IN R6          23890804
         SR    R3,R3                                                    23892804
         IC    R3,17(R6)                FIRST L OF LL                   23893204
         SLL   R3,8                                                     23893604
         IC    R3,18(R6)                SECOND L OF LL                  23894004
      LA   R3,12(R3)         UP LENGTH                                  23894104
         L     R4,IEHMVV41+4            LOAD DECB ADDR                  23894204
         L     R5,IEHMVV41              LOAD DCB ADDR                   23894304
****** R4 HAS THE DECB ADDR OF SYSUT2 *****                             23908204
****** R5 HAS THE DCB ADDR OF SYSUT2  *****                             23918204
****** WRITE3 WRITES A BLOCK FROM PERM*****                             23920204
****** WORK AREA TO SYSUT2            *****                             23920604
WRITE3   WRITE (R4),SF,(R5),(R6),(R3),MF=E                              23921004
         CHECK (R4)                                                     23921404
         TM    XSWITCHS,X'40'           IS END OF UT1 SW ON             23921804
         BO    CATOPT                                                   23921904
         B     READ1                                                    23922004
DWRITE1  OI    XSWITCHS,X'40'           TURN ON END OF UT1 SW           23922104
         B     WRITE1                                                   23926704
POINT    LA    R0,256         SET TTR2 OF 0010 IN REG                   23928704
         ST    R0,IEHMVV00                                              23930704
         LR    R0,R12         PLACE ADDR OF COMM AREA IN R0             23931104
         L     R1,IEHMVV40              LET R1 POINT AT UT1 DCB         23931204
***** REPOSITION SYSUT1 TO READ THE NEXT BLOCK *****                    23931304
         POINT (1),(0)                  REPOSITION UT1                  23931404
         L     R1,IEHMVV41              LET R1 POINT AT UT2 DCB         23936004
         LR    R0,R12                                                   23938004
***** REPOSITION SYSUT2 TO WRITE THE NEXT BLOCK *****                   23940004
         POINT (1),(0)                  REPOSITION UT2                  23940404
         BR    R10            GO TO READ1                               23940504
REQCOMP  L     R6,XPOINTER                                              23940604
         L     R7,IEHMVV10             R7 NOW CONTAINS A PTR TO A LIST  23940704
*                                      OF VOL ENTRIES FOR THE DATA SET  23952504
*                                      THAT WAS JUST HANDLED            23962504
         ST    R6,IEHMVV10                                              23964504
         NI    IEHMVV20+1,X'FC'         INITIALIZE COMM SWITCHES        23968404
         NI    IEHMVV20+2,X'6E'                                         23970404
         NI    IEHMVV20+3,X'77'                                         23972404
         TM    IEHMVV20+2,X'41'         ARE ABORT BITS ON               23976304
         BNE   REQCOMP1                 BRANCH IF YES                   23978304
         SR    R2,R2                                                    23980304
         IC    R2,1(R7)                INSERT COUNT OF TO VOL ENTRIES   23984204
         LA    R3,12                                                    23986204
         MR    R2,R2                                                    23988204
         LR    R4,R3                    SAVE LENGTH                     23998504
         LA    R3,1(R3)                                                 24008504
         LR    R2,R7                   LOAD PTR TO TO VOL ENTRIES       24008604
         EX    R3,EXCINST                                               24008704
         LA    R4,46(R4)                BUMP LENGTH BY 46               24012104
         STC   R4,18(R6)                                                24014104
         SRL   R4,8                                                     24014504
         STC   R4,17(R6)                STORE COUNT IN RECORD           24014904
         MVC   12(3,6),IEHMVV82+4 PUT NEW TTR IN SYSUT1 RECORD   S21042 24015304
         XC    IEHMVV82+4(3),IEHMVV82+4 CLEAR TTR FIELD          S21042 24015404
         B     WRITE1                                                   24015504
REQCOMP1 NI    IEHMVV20+2,X'BE'         TURN OFF ABORTS BITS            24015604
         B     READ1                                                    24019004
EXCINST  MVC   64(1,R6),0(R2)                                           24021004
REQSET   LA    R7,20(R6)                                                24021404
***** STORE ADDR OF FROM DSNAME *****                                   24021804
         ST    R7,IEHMVV21                                              24022204
         MVC   IEHMVV82(3),12(6)       SAVE OLD DSCBTTR          S21042 24022304
         ST    R6,XPOINTER             SAVE ADDRESS OF RECORD    A27712 24022404
         SR    R7,R7                   CLEAR  REGISTER SEVEN     A27712 24022504
         IC    R7,17(R6)               IN0ERT EN R8  557 8       A27712 24025904
         SLL   R7,8                    COMPUTE LENGTH            A27712 24027904
         IC    R7,18(R6)               OF RECORD                 A27712 24028304
         AR    R6,R7                                             A27712 24028704
         LA    R6,28(R6)          POINTER TO AVAIL FREE AREA     A27712 24029104
         ST    R6,IEHMVV22             ADDRESS OF VOLUME ENTRIES A27712 24029204
         L     R5,XPOINTER             FIND OLD VOLUME LIST      A27712 24029304
         SR    R7,R7                   CLEAR REG 7               A27712 24029404
         IC    R7,65(R5)               NUMBER OF ENTRIES IN LIST A27712 24032804
         LTR   R7,R7                   IS VOL. COUNT 0?          A30287 24034804
         BZ    READ1                   YES-INDEX WITH NO DATA    A30287 24035204
*                                      WAS FOUND. IGNORE IT.     A30287 24035604
         STC     R7,IEHMVV22           SAVE NUMBER OF ENTRIES    A27712 24036004
         LA    R5,66(R5)               POINT TO OLD LIST         A27712 24036104
****     R5=ADDRESS OF OLD 12 BYTE ENTRY  R6=ADDRESS OF NEW      A27712 24036204
****     17 BYTE ENTRY   R7=NUMBER OF ENTRIES IN LIST            A27712 24036304
LOOP     MVC   0(12,R6),0(R5)          MOVE VOLUME LIST          A27712 24037404
         XC    12(5,R6),12(R6)         CLEAR AREA FOR VOLMOUNT   A27712 24039404
         LA    R6,17(R6)               POINT TO NEXT ENTRY       A27712 24039504
         LA    R5,12(R5)               POINT TO NEXT ENTRY       A27712 24039604
         BCT   R7,LOOP                 ANY MORE ENTRIES          A27712 24048204
         LA    R6,3(R6)                ALIGN FOR NEST FULL WORD  A27712 24050204
         SRL   R6,2                    BOUNDRY                   A27712 24052204
         SLL   R6,2                                              A27712 24054204
         ST    R6,IEHMVV10         SAVE ADDRESS FOR NEXT MODULE  A27712 24056204
         OI    IEHMVV20,X'21'          TURN ON DSNAME AND FROM   A27712 24056604
         OI    XSWITCHS,X'80'          TURN ON FIRST IN SW              24056704
         B     EXIT1                                                    24056804
EXIT1  IEHPOST (14,1),T                                                 24056904
         XCTL  (2,12),EP=IEHMVESZ                                       24068504
EXIT2  TM  IEHMVV20,X'10'              IS DSGROUP SW ON        @Z40CSJH 24070504
         BO    EXIT3                    YES-CATLGING ALL DONE  @Z40CSJH 24074504
       IEHPOST (14,1),T                                                 24078504
         XCTL  (2,12),EP=IEHMVETA                                       24078904
EXIT3    TM    IEHMVV20+2,X'20'                                         24079304
         BO    EXIT4                                                    24079704
       IEHPOST (14,1),T                                                 24080104
         XCTL  (2,12),EP=IEHMVEST                                       24080204
EXIT4  IEHPOST (14,1),T                                                 24080304
         XCTL  (2,12),EP=IEHMVESK                                       24081104
CATOPT   OI    IEHMVV20,X'04'           TURN ON CATALOG REQ BIT         24081504
         TM    IEHMVV20,X'80'           IS MOVE BIT ON                  24081904
         BZ    CATOPT1                                                  24082304
         TM    IEHMVV20+1,X'20'         IS UNCATLG BIT ON               24082704
         BZ    CATOPT4                                                  24085604
         MVC   IEHMVV23(4),IEHMVV24                                     24087604
         B     EXIT2                                                    24089604
CATOPT4  DS    0H                                                       24090004
         NI    IEHMVV20,X'7F'           TURN OFF MOVE BIT               24090404
         OI    IEHMVV20,X'40'           TURN ON  COPY BIT               24090804
         OI    IEHMVV20+1,X'20'         TURN ON  UNCATLG BIT            24091204
         MVC   IEHMVV23(4),IEHMVV24    MOVE CVOL PTR TO TO VOL SLOT     24091304
         B     EXIT2                                                    24093404
CATOPT1  TM    IEHMVV20+1,X'30'         CATLG OR UNCATLG BIT ON         24095404
         BZ    EXIT3                                                    24097404
         BO    CATOPT2                                                  24097804
         TM    IEHMVV20+1,X'20'         IS UNCATLG ON                   24101204
         BO    CATOPT3                                                  24103204
         B     EXIT2                                                    24103604
CATOPT2  NI    IEHMVV20,X'BF'           TURN OFF COPY BIT               24104004
         OI    IEHMVV20,X'80'           TURN ON  MOVE BIT               24104404
         NI    IEHMVV20+1,X'DF'        TURN OFF UNCATLG BIT             24104804
         B     EXIT2                                                    24104904
CATOPT3  NI    IEHMVV20,X'BF'           TURN OFF COPY BIT               24108504
         OI    IEHMVV20,X'80'           TURN ON MOVE BIT                24110504
         B     EXIT2                                                    24110904
         TITLE ' IEHMVESH - CONSTANTS'                           Y02918 24112404
*                                                                Y02918 24116004
*        CONSTANTS                                               Y02918 24119604
*                                                                Y02918 24123204
ADSGM1   DC    A(DSGNONE)              NO D/S IN GROUP MSG       Y02918 24126804
ADSGM2   DC    A(DSGNOSPC)             NO SPACE FOR NAMES MSG    Y02918 24138404
AERRMT   DC    A(DSGSRFL)              DSGROUP LOCATE FAILED MSG Y02918 24150002
         DC    A(DSESRFL)              D/S LOCATE FAILED MSG     Y02918 24200002
ARCT     DS    0H                      RC OFFSET TABLE           Y02918 24250002
         DC    AL2(DSGSRFLR-DSGSRFL)   DSGROUP MESSAGE           Y02918 24300002
         DC    AL2(DSESRFLR-DSESRFL)   DATA SET MESSAGE          Y02918 24350002
ADSNM    DC    AL2(DSESRFLN-DSESRFL)   DSNAME OFFSET             Y02918 24400002
RCD1     DC    F'256'                  TTRZ = 0010               Y02918 24450002
C904     DC    F'904'                  INIT. GENERIC LOCATE      Y02918 24500002
*                                      * WORK AREA SIZE          Y02918 24550002
NMOV     DC    H'4'                    OVERHEAD - GENERIC NAMES  Y02918 24600002
VLLEN    DC    H'600'                  MAX LENGTH FOR VOL LIST   Y02918 24650002
MAXVC    DC    H'50'                   MAX VOL COUNT             Y02918 24700002
ONEVOL   DC    H'1'                    COUNT OF 1 VOLUME         Y02918 24750002
VLELEN   DC    H'12'                   VOLUME ENTRY LENGTH       Y02918 24800002
VLOVHD   DC    H'46'                   OVERHEAD FOR VOL LIST     Y02918 24850002
RCDOVHD  DC    H'20'                   OVERHEAD FOR UT1 RECORD   Y02918 24900002
MAXNL    DC    H'43'                   MAX GENERIC NAME LENGTH   Y02918 24950002
RC8      DC    H'8'                    RETURN CODE OF 8          Y02918 25000002
RC40     DC    H'40'                   RETURN CODE OF 40         Y02918 25050002
RC44     DC    H'44'                   RETURN CODE OF 44       @ZA16446 25060099
GLWAELEN DC    H'45'                   GENERIC LOCATE NAME       Y02918 25100002
SAVEREG3 DS    F                       SAVE AREA FOR REG3      @ZA26030 25110099
SAVEREG7 DS    F                       SAVE AREA FOR REG7      @ZA26030 25120099
NLENGTH  DC    H'00'                   SAVE LENGTH OF NAME     @ZA26030 25130099
*                                      * ENTRY LENGTH            Y02918 25150002
PATCH    DC    20F'0'                  PATCH AREA                Y02918 25200002
         TITLE ' IEHMVESH - DSECTS'                              Y02918 25250002
*                                                                Y02918 25300002
*        DSECTS                                                  Y02918 25350002
*                                                                Y02918 25400002
GLWA     DSECT                         GENERIC LOCATE WORK AREA  Y02918 25450002
GLWALEN  DS    XL2                     SIZE OF AREA PROVIDED     Y02918 25500002
GLWANLEN DS    XL2                     SIZE OF AREA USED         Y02918 25550002
GLWAFNME EQU   *                       FIRST NAME ENTRY ADDRESS  Y02918 25600002
*                                                                Y02918 25650002
GLNAME   DSECT                         GENERIC LOCATE NAME ENTRY Y02918 25700002
GLENTYP  DS    CL1                     ENTRY TYPE                Y02918 25750002
GLDSNM   DS    CL44                    DATA SET NAME             Y02918 25800002
*                                                                Y02918 25850002
UT1RCD   DSECT                         SYSUT1 RECORD             Y02918 25900002
UT1OVHD  DS    0XL20                   OVERHEAD LENGTH           Y02918 25950002
UT1KEY   DS    XL12                    KEY - NOT USED            Y02918 26000002
UT1TTR   DS    XL3                     DSCB TTR FOR 1 VOL D/S    Y02918 26050002
         DS    XL2                     NO USED - ALWAYS 0        Y02918 26100002
UT1VLLEN DS    XL2                     LENGTH OF VOL LIST        Y02918 26150002
UT1CDE   DS    XL1                     CODE                      Y02918 26200002
UT1NAME  DS    CL44                    DATA SET NAME             Y02918 26250002
UT1VLCT  DS    XL2                     VOLUME COUNT              Y02918 26300002
UT1VLST  EQU   *                       VOLUME LIST ADDRESS       Y02918 26350002
         EJECT                                                   Y02918 26400002
         IEHMVV                                                  Y02918 26450002
XSWITCHS EQU   IEHMVV27+12                                              26460004
*****XSWITCHS IS USED AS THE CLOSE SWITCH                               26470004
XPOINTER EQU   IEHMVV27+16                                              26480004
         EJECT                                                   Y02918 26500002
         IEZCTGWA                                                Y02918 26550002
         EJECT                                                   Y02918 26600002
         IEZCTGVL                                                Y02918 26650002
MVEVLVOL EQU   CTGVL+D4                MOVE VOLSER               Y02918 26700002
MVEVLDEV EQU   CTGVL                   MOVE DEVICE CODE          Y02918 26750002
         EJECT                                                   Y02918 26800002
         IEZCTGPL                                                Y02918 26850002
         SPACE 2                                                 Y02918 26900002
*                                                                Y02918 26950002
*        MODULE WORK AREA                                        Y02918 27000002
*                                                                Y02918 27050002
GLREQNM  DS    CL100                   GENERIC LOCATE NAME ENTRY Y02918 27100002
*                                      * AND CVOL RETURN AREA    Y02918 27150002
ERRMSG   DS    CL121                   RC ERROR MSG AREA         Y02918 27200002
TEMPVL   DS    CL6                     VOLSER SAVE AREA          Y02918 27250002
CVTAR    DS    D                       CONVERSION WORK AREA      Y02918 27300002
SVRTN    DS    F                       SUBROUTINE SAVE WORD      Y02918 27350002
GLFSV    DS    F                       GLFREE ROUTINE SAVE WORD  Y02918 27400002
GLSIZE   DS    F                       GENERIC LOCATE WORK AREA  Y02918 27450002
*                                      * SIZE                    Y02918 27500002
GLFDBK   DS    F                       GENERIC LOCATE WORK AREA  Y02918 27550002
*                                      * FEEDBACK SIZE           Y02918 27600002
SPWA     EQU   *                       SUPERLOCATE WORK AREA     Y02918 27650002
         TITLE ' IEHMSGSH - MESSAGE CSECT'                       Y02918 27700002
IEHMSGSH CSECT                                                   Y02918 27750002
*        MESSAGE CSECT FOR IEHMVESH                              Y02918 27800002
DSGNONE  DC    CL121' IEH348I NO DATA SETS FOUND FOR DSGROUP SPECIFIED.X27850002
               '                                                 Y02918 27900002
DSGNOSPC DC    CL121' IEH351I SUFFICIENT SPACE NOT AVAILABLE FOR ALL DAX27950002
               TA SETS IN DSGROUP.'                              Y02918 28000002
DSGSRFL  DC    CL52' IEH354I DSGROUP CATALOG SEARCH FAILED. RETURN CODEX28050002
               '                                                 Y02918 28100002
DSGSRFLR DC    CL69'000 .'                                       Y02918 28150002
DSESRFL  DC    CL18' IEH356I DATA SET '                          Y02918 28200002
DSESRFLN DS    CL44                                              Y02918 28250002
         DC    CL36' CATALOG SEARCH FAILED. RETURN CODE '        Y02918 28300002
DSESRFLR DC    CL23'000 .'                                       Y02918 28350002
         END   IEHMVESH                                          Y02918 28400002
./  ADD  SSI=70260462,NAME=IEHMVESI
*TITLE ' IEHMVSSI                                                     * 00050004
*FUNCTION/OPERATION: THIS MODULE IS ENTERED ONLY FOR DSGROUP          * 00100004
*OPERATIONS. IT WILL INSURE THAT THE VOLUME, WITH THE CATALOG         * 00150004
*SPECIFIED IN THE DSGROUP REQUEST, IS MOUNTED AND WILL OPEN THE DATA  * 00200004
*SET 'SYSCTLG' FOR INPUT.                                             * 00250004
*ENTRY POINTS: IEHMVESI                                               * 00300004
*INPUT: POINTER TO IEHMOVE1 WORKAREA IN REG 12                        * 00350004
*EXTERNAL ROUTINES: IEHMVXSF (VOLUME MOUNTING RTN)                    * 00400004
*EXITS - NORMAL IEHMVSSC (CATALOG ANALIZER)                           * 00450004
*                                                                       00460004
* THE ENTIRE MODULE WAS REACTIVATED IN SUPPORT                 @Z40CSJH 00470004
* OF THE EXTENDED MVS CVOL FUNCTION                            @Z40CSJH 00480004
*                                                                       00490004
*C078500-079100,109600                                         @Z40CSJH 00492004
IEHMVSSI CSECT                                                          00500004
*A38150                                                         XA01754 00550004
* 037800                                                         A27712 00600004
*1630002200,031800                                                12490 00650004
IEHMVESI SAVE  (14,12),T,DSGROUP-INITIALIZER-DBRUCE-9-20-65             00700004
         ENTRY IEHMVESI                                                 00750004
         LR    R8,R15                                                   00800004
         USING MESS,R4                                                  00850004
 USING IEHMVV,12                                                        00900004
         USING IEHMVESI,R8                                              00950004
       IEHPRE  (14,1),TFC                                               01000004
R0       EQU   0                                                        01050004
R1       EQU   1                                                        01100004
R2       EQU   2                                                        01150004
R3       EQU   3                                                        01200004
R4       EQU   4                                                        01250004
R5       EQU   5                                                        01300004
R6       EQU   6                                                        01350004
R7       EQU   7                                                        01400004
R8       EQU   8                                                        01450004
R9       EQU   9                                                        01500004
R10      EQU   10                                                       01550004
R11      EQU   11                                                       01600004
R12      EQU   12                                                       01650004
R13      EQU   13                                                       01700004
R14      EQU   14                                                       01750004
R15      EQU   15                                                       01800004
        IEHMVV                                                          01850004
IEHMVSSI CSECT                                                          01900004
* 012000-012400,014400-0146000                                     DT0I 01950004
         TM    IEHMVV20+4,X'10'        IS THIS RETURN FROM VOL MNT      02000004
         BZ    GOON                       IF NOT ---                    02050004
         NI    IEHMVV20+4,X'EF'          TURN OFF SW                    02100004
         B     VOLRET                                                   02150004
GOON     EQU   *                                                        02200004
         MVC   IEHMVV61(8),IEHMVV21     SET UP POINTERS FOR             02250004
*                                       C ATALOG DEPHLONKER             02300004
*                                     ***FIND OR MOUNT CVOL ***         02350004
         TM    IEHMVV20+1,X'40'       CUDL BIT ON                       02400004
         BZ    FINDPACK                                            8113 02450004
VOLMNT   DS    0H                                                       02500004
         L     R1,IEHMVV24                                              02550004
*                                     *** CALLING SEQUENCE AND CALL **  02600004
*                                      ** TO VOLUME MOUNTING ROUTINE**  02650004
*                                     *** VOLUME MOUNTING CALL RETURNS  02700004
*                                     '** POINTER TO DDNAME IN REG 1    02750004
VMGEN    EQU   0                                                        02800004
VMINDICA EQU   4                                                        02850004
VMIT     EQU   4                                                        02900004
VMVMR    EQU   11                                                       02950004
VMITC    EQU   10                                                       03000004
VMDEV    EQU   12                                                       03050004
VMVSN    EQU   16                                                       03100004
VMRTA    EQU   22                                                       03150004
VMUNIT   EQU   24                                                  DT0I 03200004
*                                                                       03250004
*                                      TO CALL VOL MOUNT                03300004
*                                           NO VALID OLD REQUESTS       03350004
*                                      REG 1 POINTS TO                  03400004
*                                                                       03450004
*                                      DEVICE TYPE 4 BYTES              03500004
*                                      VOL ID 6 BYTES                   03550004
         MVC   IEHMVV00+VMIT(4),IEHMVV50+4  PTR TO IT TABLE             03600004
         MVC  IEHMVV00+VMITC(1),IEHMVV50+4  IT ENTRY COUNT              03650004
         MVI   IEHMVV00+VMVMR,X'01'    NUMBER OF REQUESTS               03700004
         MVI   IEHMVV00+VMINDICA,X'90' SET UP INDICATOR                 03750004
         MVC   IEHMVV00+VMDEV(10),0(1) SET UP DEVICE TYPE               03800004
         MVC   IEHMVV00+VMUNIT(5),12(R1)                           DT0I 03850004
         LA    R3,IEHMVV00                                              03900004
         LH    R4,SI                                                    03950004
         IEHPOST  (14),T                                                04000004
         XCTL  EP=IEHMVXSF                                              04050004
VOLRET   EQU   *                                                        04100004
         TM    IEHMVV00+VMIT,X'01'    WAS VOLUME MOUNTED                04150004
         BZ    NOMOUNT                 NO MOUNTING INITIATED ERROR MSG  04200004
         L     1,IEHMVV00+VMIT         YES                              04250004
         AH    1,IEHMVV00+VMRTA                                         04300004
         L     1,0(0,1)                GET POINTER TO DDNAME            04350004
         XC    IEHMVV00(48),IEHMVV00   CLEAR VOLITAL WORK AREA          04400004
         MVI   IEHMVV00,X'C1'          CODE FOR OBTAIN DSNAME           04450004
         LA    R2,IEHMVV00+16          ADDR OF DSNAME AREA              04500004
         ST    R2,IEHMVV00+4           STORE PTR TO DSNAME AREA         04550004
         L     R2,IEHMVV24             LOAD CVOL PTR                    04600004
         LA    R2,4(R2)                BUMP PTR TO VOLID SLOT           04650004
         ST    R2,IEHMVV00+8           STORE PTR TO VOL ID              04700004
         LA    R2,IEHMVV00+64     LOAD ADDR OF 400 BYTE AREA            04750004
         ST    R2,IEHMVV00+12          STORE PTR TO AREA                04800004
         MVI   IEHMVV00+16,X'40'       CLEAR DSNAME AREA                04850004
         MVC   IEHMVV00+17(43),IEHMVV00+16                              04900004
         MVC   IEHMVV00+16(7),JDSNAME  MOVE SYSCTLG TO DSNAME AREA      04950004
         LR    R4,R1                   SAVE PTR TO DDNAME               05000004
        OBTAIN IEHMVV00                                                 05050004
         LA    15,0(15)                                                 05100004
         LTR   15,15                                                    05150004
         BNE   NOFIND                                                   05200004
         L     R2,IEHMVV10              ADDR OF PERM WORK AREA          05250004
         LA    R2,4(R2)                 ALIGN TO FULL WD BOUNDRY        05300004
         SRL   R2,2                                                     05350004
         SLL   R2,2                                                     05400004
         MVC   0(44,R2),IEHMVV00+16    MOVE DSCB KEY TO WORK AREA       05450004
         LA    R3,44(R2)               BUMP PTE TO DATA                 05500004
         MVC   0(96,R3),IEHMVV00+64    MOVE DSCB DATA TO PERM WORK AREA 05550004
         ST    R2,IEHMVV30+8      STORE ADDR OF FROM DSCB               05600004
         LA    R2,140(R2)                                               05650004
         ST    R2,IEHMVV30+4            ADDR OF FROM DECB               05700004
         LA    R2,24(R2)                                                05750004
         ST    R2,IEHMVV30              ADDR OF FROM DCB                05800004
         MVC   0(RENT2-RENT1,R2),RENT1                                  05850004
         LR    R1,R4                   LOAD PTR TO DDNAME               05900004
         MVC   40(8,R2),0(R1)           MOVE DD NAME INTO DCB           05950004
         LA    R2,RENT2-RENT1(R2)      BUMP AND ALIGN PERM WORK AREA    06000004
         LA    R2,4(R2)                 POINTER                         06050004
         SRL   R2,2                                                     06100004
         SLL   R2,2                                                     06150004
         ST    R2,IEHMVV10                                              06200004
*                                       R1 IS POINTER TO DDNAME RETURN  06250004
*                                       FROM VOL MOUNT                  06300004
         XC    IEHMVV00(176),IEHMVV00  CLEAR JFCB AREA                  06350004
         MVC   IEHMVV00(52),JDSNAME     MOVE SYSCTLG INTO JFCB          06400004
         MVI   IEHMVV00+87,X'40'        SET STATUS TO OLD               06450004
         L     R4,IEHMVV24                                              06500004
         MVC   IEHMVV00+118(6),4(R4)    MOVE VOL SER TO JFCB            06550004
         MVI   IEHMVV00+117,X'01'       MOVE NUMBER VOL SER TO JFCB     06600004
         MVI   IEHMVV00+130,X'40'      END OF VOL SER LIST              06650004
         LA    R3,IEHMVV00              LOAD ADDR OF JFCB               06700004
         ST   R3,IEHMVV00+176           STORE IN EXIT LIST              06750004
         LA    R3,IEHMVV00+176         LOAD ADDR OF EXIT LIST           06800004
         ST    R3,IEHMVV00+180          STORE IT IN WORD PAST EXIT LIST 06850004
         MVI   IEHMVV00+176,X'87'       SET CODE IN LEFT BYTE OF LIST   06900004
         L     R4,IEHMVV30              LOAD ADDR OF FROM DCB           06950004
         LA    R3,IEHMVV00+176         LOAD ADDR OF EXIT LIST           07000004
         STH   R3,38(R4)               STORE IN DCB                     07050004
         SRL   R3,16                                                    07100004
         STC   R3,37(R4)                                                07150004
         OPEN  ((R4),(INPUT)),TYPE=J                                    07200004
         B     EXIT1                                                    07250004
*                                     ***FIND SYSRES UCB                07300004
*                                    ***FIND SYSRES UCB                 07350004
FINDPACK DS    0H                                                  8113 07400004
         L     R1,IEHMVV21        GET PTR. TO DSNAME               8113 07450004
         MVC   FQDSNAME(44),0(R1) PUT DSNAME INTO CAMLST AREA      8113 07500004
         LOCATE GRPLOC            EXEC. LOCATE FOR DSNAME          8113 07550004
         L     R1,16              GET PTR. TO CVT                  8113 07600004
         L     R1,0(R1)           GET PTR. TO TCB                  8113 07650004
         L     R1,0(R1)                                            8113 07700004
         L     R1,12(R1)          GET PTR. TO TIOT                 8113 07750004
         LA    R1,24(R1)          GET PTR. TO DD ENTRY             8113 07800004
FINDID   ICM   R2,3,16(R1)             GET UCB @               @Z40CSJH 07850004
         N     R2,CLEARMSK             SAVE 16 BITS            @Z40CSJH 07900004
         TM    16(R1),X'FF'            LAST UCB                @Z40CSJH 07910004
  BC  1,NOTSUB                                                          07950004
   CLC   RSLTAREA+259(6),4(R2)                                          08000004
   BE   VOLTYPE                                                         08050004
   B   CONT                                                             08100004
NOTSUB   CLC   RSLTAREA+259(6),28(R2)                                   08150004
         BE    VOLTYPE            GO SET UP DEVTYPE                8113 08200004
CONT  SR   R3,R3                                                        08250004
         IC    R3,0(R1)                 LENGTH OF DIRECTORY ENTRY  8113 08300004
         AR    R1,R3     GET PTR TO LENGTH OF NEXT ENTRY          12490 08350004
         IC    R3,0(R1)  GET LENGTH OF NEXT ENTRY                 12490 08400004
         LTR   R3,R3                    END OF DIRECTORY?          8113 08450004
         BZ    NOFIND                   YES, GO TO NOFIND          8113 08500004
         B     FINDID                                              8113 08550004
VOLTYPE  TM    2(R2),X'FF'                                              08600004
         BC    1,DEVOK                                                  08650004
         SR    R3,R3               BACK UP TO POINT TO MAIN UCB         08700004
         IC    R3,1(R2)               TO GET E  DEVICE TYPE             08750004
         SLL   R3,4                                                     08800004
         LA    R3,56(R3)                                                08850004
         SR    R2,R3                                                    08900004
DEVOK    MVC   RSLTAREA+255(4),16(R2)                                   08950004
         LA    R2,RSLTAREA              PTR TO VOLID & DEVTYPE     8113 09000004
         L     R1,IEHMVV10              LOAD ADDR OF PERMANENT WRK AREA 09050004
         LA    R1,4(R1)                                                 09100004
        SRL   R1,2                                                      09150004
         SLL   R1,2                                                     09200004
         XC    0(17,R1),0(R1)          SET AREA TO ZERO          A27712 09250004
         MVC   0(4,R1),255(R2)    MOVE TYPE INTO LIST              8113 09300004
         MVC   4(6,R1),259(R2)    MOVE VOLID INTO LIST             8113 09350004
         ST   R1,IEHMVV24               STORE POINTER IN CVOL PTR SLOT  09400004
         LA    R1,17(R1)                                         A27712 09450004
         ST    R1,IEHMVV10              BUMP PERM WORK AREA PTR         09500004
         OI    IEHMVV20+1,X'40'        TURN ON CVOL BIT                 09550004
         B     VOLMNT                                                   09600004
NOMOUNT  L     R4,MESSAD                                                09650004
         XC    IEHMVV00(121),IEHMVV00                                   09700004
         MVC   IEHMVV00+1(32),M1                                        09750004
         L     R1,IEHMVV24              PICK YP VOLUME SERIAL           09800004
         MVC   IEHMVV00+34(6),4(R1)                                     09850004
NOMOUNT1 LA    R3,IEHMVV00                                              09900004
         LINK  EP=IEHMVESU                                              09950004
         LTR   15,15                                                    10000004
         BNE   EXIT2                                                    10050004
         TM    IEHMVV20+2,X'20'         TEST FOR END OF FILE            10100004
         BO    EXIT2                    BRANCH IF ON                    10150004
         B     EXIT3                                                    10200004
NOFIND   L     R4,MESSAD                                                10250004
         MVI   IEHMVV00,X'40'          CLEAR PRINT AREA          A27712 10300004
         MVC   IEHMVV00+1(120),IEHMVV00                          A27712 10350004
         MVC  IEHMVV00+1(32),M1                                         10400004
         MVC   IEHMVV00+34(50),M2                                 12490 10450004
         OI    IEHMVV41+13,X'02'       SET RETURN CODE = 4      XA01754 10500004
         B     NOMOUNT1                                                 10550004
EXIT1  IEHPOST (14,1),T                                                 10600004
         XC    IEHMVV27+12(8),IEHMVV27+12                               10650004
         XCTL  (2,12),EP=IEHMVESC                                       10700004
EXIT2  IEHPOST (14,1),T                                                 10750004
         XCTL  (2,12),EP=IEHMVESK                                       10800004
EXIT3  IEHPOST (14,1),T                                                 10850004
         XCTL  (2,12),EP=IEHMVEST                                       10900004
GRPLOC   CAMLST  NAME,FQDSNAME,,RSLTAREA                           8113 10950004
CLEARMSK DC    X'0000FFFF'             UCB MASK                @Z40CSJH 10960004
FQDSNAME DC    CL44'0'                                             8113 11000004
RSLTAREA DS    0D                                                  8113 11050004
         DS    265C                                                8113 11100004
JDSNAME  DC    CL32'SYSCTLG'                                            11150004
         DC    20X'40'                                                  11200004
         DC    X'40'                    DS STATUS OLD JFCB +87          11250004
         DC    X'01'                    COUNT OF VOL SERIAL             11300004
RENT1    DS    0F                                                       11350004
         DCB   DDNAME=X,                                               C11400004
               RECFM=F,                                                C11450004
               BLKSIZE=256,                                            C11500004
               DSORG=PS,                                               C11550004
               KEYLEN=8,                                               C11600004
               MACRF=RCP                                                11650004
RENT2    DS    0F                                                       11700004
MESSAD   DC    A(MESS)                                                  11750004
SI       DC    CL2'SI'                                                  11800004
MESS     CSECT                                                          11850004
M1      DC     CL32'IEH349I UNABLE TO MOUNT VOLUME'                     11900004
M2  DC  CL50' SYSRES DDCARD OMITTED,CANNOT LOCATE FROM VOLUME'    12490 11950004
         END                                                            12000004
./  ADD  SSI=72640119,NAME=IEHMVESJ
*********************************************************************** 00020000
*        TITLE           IEHMVESJ                                     * 00040000
*                                                                    *  00060000
*        FUNCTION          THIS IS THE CONTROL CARD SCAN ROUTINE     *  00080000
*                          USED BY THE IEHMOVE PROGRAM               *  00100000
*                                                                    *  00120000
*                          IT READS AND SCANS FIELDS OF THE IEHMOVE  *  00140000
*                          CONTROL CARDS PASSING EACH FIELD AS IT IS *  00160000
*                          ENCOUNTERED TO THE IEHMOVE CONTROL CARD   *  00180000
*                          ANALYZER ROUTINE                          *  00200000
*                                                                    *  00220000
*        ENTRY POINTS    IEHMVESJ  VIA XCTL FROM THE IEHMOVE CONTROL  * 00240000
*                                  CARD ANALYZER ROUTINE, IEHMVESS    X 00260000
*                                                                     * 00280000
*                        KEOF      END OF FILE ENTRY                  * 00300000
*                                                                    *  00320000
*        INPUT             IEHMOVE COMMUNICATIONS AND WORK AREA      *  00340000
*                          DESCRIBED IN MACRO EXPANSION OF IEHMVV    *  00360000
*                                                                    *  00380000
*        OUTPUT          SAME AS INPUT AREA                           * 00400000
*                                                                     * 00420000
*        EXTERNAL ROUTINES:                                           * 00440000
*                        IEHMVESU  VIA LINK TO PRINT CARD IMAGES      * 00460000
*                                                                     * 00480000
*                        IEHMVESS  VIA XCTL TO CONTROL CARD ANALYZER  * 00500000
*                                  ROUTINE                            * 00520000
*                                                                     * 00540000
*        EXITS:                                                       * 00560000
*              NORMAL    IEHMVESS                                     * 00580000
*              ERROR     NONE                                         * 00600000
*                                                                    *  00620000
*        TABLES WORK AREA  DSACT IN MACRO EXPANSION IEHMVV           *  00640000
*                                                                    *  00660000
*        ATTRIBUTES      SERIALLY REUSEABLE                           * 00680000
*                                                                     * 00700000
*********************************************************************** 00720000
         EJECT                                                          00740000
IEHMVSSJ START                                                          00760000
RDCDRT   CSECT                                                          00780000
*D100800                                                        OY01173 00785016
*                                                                PM3343 00790018
*                                                                A37900 00792021
*                                                                       00800000
*                             REGISTER NOTATION AND USAGE               00820000
*                                                                       00840000
REG0     EQU   0                        PARAM REG                       00860000
REG1     EQU   1                        PARAM REG                       00880000
REG2     EQU   2                        WORK REG                        00900000
REG3     EQU   3                        WORK REG                        00920000
REG4     EQU   4                        WORK REG                        00940000
REG5     EQU   5                        WORK REG                        00960000
REG7     EQU   7                        BASE FOR SWITCHRD               00980000
REG9     EQU   9                                                        01000000
REG10    EQU   10                                                       01020000
REG11    EQU   11                       BASE FOR IEHMVESJ               01040000
REG12    EQU   12                       BASE FOR IEHMVV                 01060000
REG15    EQU   15                       ENTRY POINT REG                 01080000
*                                                                       01100000
*                             EQUATE STATEMENTS                         01120000
*                                                                       01140000
BLANK    EQU   X'40'                                                    01160000
ABORT    EQU   X'01'                                                    01180000
ZERO     EQU   X'00'                                                    01200000
*                             THE FOLLOWING VALUES ARE USED TO SET      01220000
*                             SWITCHES IN DSECT, SWITCHRD               01240000
BIT0     EQU   X'80'                                                    01260000
BIT1     EQU   X'40'                                                    01280000
BIT2     EQU   X'20'                                                    01300000
BIT3     EQU   X'10'                                                    01320000
BIT4     EQU   X'08'                                                    01340000
BIT5     EQU   X'04'                                                    01360000
BIT6     EQU   X'02'                                                    01380000
BIT7     EQU   X'01'                                                    01400000
BIT8     EQU   X'14'                                                    01420000
RESET0   EQU   X'00'                                                    01440000
RESET1   EQU   X'F7'                                                    01460000
RESET2   EQU   X'98'                                                    01480000
RESET6   EQU   X'EF'                                                    01500000
RESET10  EQU   X'0C'                                                    01520000
CONT     EQU   X'48'          THE FOLLOWING VALUES ARE USED TO TEST FOR 01540000
KSPLT    EQU   X'7F'     DELIMITERS IN THE INPUT STREAM.                01560000
EQUAL    EQU   X'7E'                                                    01580000
COMMA    EQU   X'6B'                                                    01600000
BLANKCOL EQU   X'40'                                                    01620000
LPARN    EQU   X'4D'                                                    01640000
RPARN    EQU    X'5D'                                                   01660000
PERIOD   EQU   X'4B'                                                    01680000
MINUS    EQU   X'60'                                                    01700000
DOLLAR   EQU   X'5B'                                                    01720000
POUND    EQU   X'7B'                                                    01740000
AT       EQU   X'7C'                                                    01760000
PRPARN   EQU   X'03'                                                    01780000
EQRPN    EQU   X'90'                                                    01800000
MSKE     EQU   X'42'                                                    01820000
MSKG     EQU   X'60'                                                    01840000
SLASH    EQU   X'61'                                                    01850013
*                                                                       01860000
*                             ASSEMBLER USING STATEMENTS                01880000
*                                                                       01900000
         USING IEHMVESJ,REG11                                           01920000
         USING IEHMVV,REG12                                             01940000
         USING SWITCHRD,REG7                                            01960000
*                                                                       01980000
*                                                                       02000000
*                             THIS ROUTINE SAVES REGISTERS UPON ENTRY,  02020000
*                             TESTS ENTRY CONTROL SWITCHES TO CONTROL   02040000
*                             ENTRY TO THE SCAN ROUTINE, AND INITIALIZE 02060000
*                             POINTERS TO START SCAN ADDRESS.           02080000
IEHMVESJ SAVE  (14,12),T,ESJ-9-16-65                                    02100000
        IEHPRE (14,1),TF                                                02120000
         LR    REG11,REG15              LOAD BASE REGISTER              02140000
         LA    REG7,IEHMVV90                                            02160000
        L     REG3,DSP12                                                02180000
         NI    SWITCHRD,X'7F'          RESET ERROR BIT ON SWITCHRD      02200000
         TM    SWITCHRD,BIT3           TEST FIRST ENTRY SWITCH          02220000
         BZ    KIRSCD                   IF ENTRY SWITCH IS OFF, GO TO   02240000
*                                       CLEAR CONTROL SWITCHES FOR      02260000
*                                       FIRST READ OPERATION            02280000
         TM    SWITCHRD,BIT1           TEST BYPASS SWITCH               02300000
         BO    KBYPO                    IF BYPASS SWITCH IS ON, GO TO   02320000
*                                       ROUTINE WHICH DETERMINES        02340000
*                                       WHETHER THIS CARD IS TO BE      02360000
*                                       PRINTED NOW.                    02380000
         TM    DSP5,BIT4           TEST RDCD SWITCH                     02400000
         BO    KGTCD                    IF THE READ CARD SWITCH IS ON,  02420000
*                                       GO TO READ ANOTHER CARD.        02440000
         TM    IEHMVV20+3,X'10'         PRINT CARD NOW                  02460000
         BZ    KPFOL                    NO                              02480000
         BAL   REG9,KPRNT               YES PRINT IT NOW                02500000
         OI    IEHMVV20+3,X'20'                                         02520000
         NI    IEHMVV20+3,X'EF'         INDICATE CARD HAS BEEN PRINTED  02540000
KPFOL    TM    DSP5,BIT2           TEST PARAM FOLLOW SWITCH             02560000
         BO    SCANR                    IF PARAM SWITCH IS ON, GO TO    02580000
*                                       SCAN RTN TO GET NEXT DELIMITER  02600000
         TM    DSP5,BIT1           TEST CONTINUE SWITCH                 02620000
         BO    KCONT                    IF CONTINUATION SWITCH IS ON,   02640000
*                                       GO TO SCAN CONTINUATION CARD    02660000
         LA    REG3,1(REG7)             LOAD ADDRESS OF BEGIN COLUMN    02680000
*                   THIS ROUTINE CHECKS FOR A NAME  IF NAME IS PRESENT  02700000
*                      BYPASSES NAME AND SET POINTER TO FIRST BLANK COL 02720000
*                                                                       02740000
KNAME    CLI   0(REG3),BLANKCOL                                         02760000
         BE    KOMMD                    IF DELIMITER FOUND, GO TO SET   02780000
*                                       SWITCHES TO LOOK FOR COMMAND    02800000
*                                       WORD                            02820000
         LA    REG5,DSP3                GET ADDRESS OF COL 71           02840000
         CR    REG3,REG5                IF THIS IS COL 71 AND NO        02860000
*                                       COMMAND WORD HAS BEEN FOUND,    02880000
         BE    KNOP                     GO TO SET ERROR SWITCHES        02900000
         LA    REG3,1(REG3)             OTHERWISE ADJUST POINTER TO THE 02920000
*                                       INPUT STREAM AND                02940000
         B     KNAME                    RETURN TO SEARCH AGAIN          02960000
*                   INITIALIZE SWITCHES AND INDICATORS TO RECOGNIZE     02980000
*                      COMMAND WORD IN FIRST CARD OF A GROUP            03000000
*                      RESET PARENTHESES COUNTER                        03020000
*                                                                       03040000
KOMMD    LA    REG3,1(REG3)             ADJUST PNTR TO THE INPUT STREAM 03060000
         SR    REG2,REG2                                                03080000
         STH   REG2,DSP9           RESET PARENTHESES COUNTER            03100000
         OI    DSP5,BIT5           SET COMMAND CONTROL SWITCH           03120000
         OI    SWITCHRD,BIT4           SET COMMAND BIT IN SWITCHRD      03140000
         NI    DSP10,RESET0        RESET DELIMITER INDICATOR            03160000
*                                                                       03180000
*                                                                       03200000
*                   ADJUST POINTER TO FIRST CHARACTER OF COMMAND        03220000
*                      IF NO COMMAND FOUND BEFORE COL 71 SET BYPASS BIT 03240000
         LA    REG5,DSP3           LOAD ADDRESS OF END COLUMN           03260000
KABC     CLI   0(REG3),BLANKCOL           IS COLUMN BLANK               03280000
         BNE   SCAN                     IF THIS COLUMN IS NOT BLANK,    03300000
*                                       GO TO SCAN FOR NEXT DELIMITER   03320000
         CR    REG3,REG5                  IS THIS THE END COLUMN        03340000
         BE    KNOP                     IF THIS IS END OF CARD AND NO   03360000
*                                       COMMAND WORD HAS BEEN FOUND, GO 03380000
*                                       TO SET ERROR SWITCHES           03400000
         LA    REG3,1(REG3)            IF NO, ADJUST PNTR TO NEXT COL   03420000
         B     KABC                     AND RETURN TO SCAN FOR BLANK    03440000
*                   RESET SWITCHRD CONTROLS  RESET EXIT CONTROLS        03460000
*                      SAVE LAST DELIMITER AND CLEAR DELIMITER IND      03480000
*                                                                       03500000
SCANR    NI    SWITCHRD,RESET1         RESET COMMAND BIT                03520000
SCAN     NI    SWITCHRD,RESET2         RESET ALL BITS BUT ERR,FST ENT   03540000
         NI    DSP5,BIT8           RESET ALL BITS BUT CMD CNTL SWITCH   03560000
SCANPP   MVC   DSP11(1),DSP10                                           03580000
KCPSS    NI    DSP10,RESET0                                             03600000
         NI    DSP8,RESET10        RESET EXIT CONTROL SWITCH            03620000
*                                                                       03640000
*                   THIS ROUTINE SCANS CARD UNTIL DELIMITER IS FOUND    03660000
*                      SAVES ADDRESS OF FIRST CHAR  COMPUTES LENGTH     03680000
*                      SET BIT IN EXIT CONTROL IF DELIM IS IN END COL   03700000
*                      OR BEFORE END COL                                03720000
*                                                                       03740000
KTRT     SR    REG1,REG1                                                03760000
         SR    REG2,REG2                                                03780000
         LA    REG5,DSP3           LOAD ADDRESS OF END COLUMN           03800000
         LR    REG1,REG3                                                03820000
KOMPAR   CLI   0(REG3),KSPLT            IS CHAR A DELIMITER             03840000
         BL    KFIND                    IF YES,GO TO FIND WHAT KIND OF  03860000
*                                       DELIMITER                       03880000
KOMPARA  LA    REG2,1(REG2)            ACCUMULATE LENGTH OF PARAM       03900000
*                                       BEING SCANNED                   03920000
         CR    REG3,REG5                IS THIS END COLUMN              03940000
         BE    KPART                    IF YES, GO TO SAVE LENGTH OF    03960000
*                                       PARTIAL PARAM                   03980000
         LA    REG3,1(REG3)            IF NO, ADJUST PNTR TO NEXT COL   04000000
         B     KOMPAR                   AND RETURN TO LOOK FOR DELIMITE 04020000
*                  KFIND CHECKS FOR DELIMITER OF PERIOD OR MINUS IF     04040000
*                      PRESENT RETURNS TO SCAN ROUTINE   TESTS END COL  04060000
*                      IF DELIMITER IS IN END COL SET CC2 BIT  IF BEFOR 04080000
*                      END COL SET CC1 BIT AND GOES TO TEST DELIMITER   04100000
*                      ROUTINE.                                         04120000
*                                                                       04140000
*                                                                       04160000
KFIND    CLI   0(REG3),PERIOD                                           04180000
         BE    KOMPARA                  IF DELIMITER IS A PERIOD OR A   04200000
*                                      MINUS SIGN, PUND SIGN,DOLLAR     04220000
*                                          SIGN, SLASH OR AT SIGN,      04240013
*                                          RETURN TO CONTINUE SCANNING  04260013
*                                          THE INPUT STREAM             04280013
         CLI   0(REG3),MINUS                                            04300000
         BE    KOMPARA                                                  04320000
     CLI  0(REG3),DOLLAR                                                04340000
         BE    KOMPARA                                                  04360000
      CLI   0(REG3),POUND                                               04380000
         BE    KOMPARA                                                  04400000
      CLI   0(REG3),AT                                                  04420000
         BE    KOMPARA                                                  04440000
         CLI   0(REG3),SLASH                                            04446013
         BE    KOMPARA                                                  04452013
         CR    REG3,REG5               IS THIS END COLUMN               04460000
         BNE   SETCC1                   IF NO, SET SWITCH TO INDICATE   04480000
*                                       DELIMITER FOUND                 04500000
         OI    DSP8,BIT2                SET COND CODE 2 BIT             04520000
         TM    DSP5,BIT3                IS PARTIAL PARAM SW ON          04540000
         BO    KTERBY                   IF YES, PARAM IS TOO LONG, GO   04560000
*                                       TO SET ERROR SWITCH             04580000
         B     TESTPAR                  IF NO,GO TO CHECK FOR PARTIAL   04600000
*                                       PARAM                           04620000
*                   THIS ROUTINE SETS ENTRY SWITCHES WHEN NO COMMAND    04640000
*                      WORD IS FOUND OR NO KEYWORD OR PARAMETER FOLLOWS 04660000
*                      A COMMAND WORD                                   04680000
*                                                                       04700000
KNOP     OI    SWITCHRD,BIT0     ERROR NO COMMAND OR PARAM IN CARD      04720000
         SR    REG1,REG1                                                04740000
         SR    REG2,REG2                                                04760000
KNOPAR   OI    SWITCHRD,BIT1     ERROR NO KEYWORD OR PARAM FOLLOW       04780000
*                                       COMMAND WORD. SET BYPASS SWITCH 04800000
         B     KPASS                    AND GO TO EXIT ROUTINE          04820000
*                   TESTPAR CHECKS FOR PRESENCE OF PAPTIAL PARAMETER    04840000
*                      AND CHECKS LENGTH FOR ZERO OR  GT ZERO.          04860000
*                      SETS CORRECT LENGTH BIT                          04880000
TESTPAR  TM    DSP5,BIT3                IS'PARTIAL PARAM SW ON          04900000
         BO    KPPAR                    IF YES,GOTO CHECK IF PARAM      04920000
*                                       LENGTH IS VALID                 04940000
         SR    REG4,REG4                                                04960000
         AR    REG4,REG2                                                04980000
         BZ    SETLZ                    IF RESULT OF ADDITION IS ZERO   05000000
*                                       GOTO SET LENGTH ZERO SWITCH     05020000
*                                       AND RETURN BELOW TO CHECK FOR   05040000
*                                       VALID DELIMITER.                05060000
         OI    DSP8,BIT6                SET LNG GRTR THAN ZERO BIT      05080000
*                                                                       05100000
*                                                                       05120000
*                                                                       05140000
*                   DELIM  CHECKS FOR VALID DELIMITER AND BRANCHES TO   05160000
*                      ROUTINE TO SET CONTROL SWITCHES                  05180000
*                      IF INVALID DELIMITER IS FOUND BRANCHES TO KINVAL 05200000
*                                                                       05220000
DELIM    CLI   0(REG3),EQUAL                                            05240000
         BE    KEY                      IF DELIMITER IS AN EQUAL SIGN   05260000
*                                       GO TO SET KEYWORD SWITCH        05280000
         CLI   0(REG3),COMMA                                            05300000
         BE    PARAMC                   IF DELIMITER IS A COMMA, GOTO   05320000
*                                       SET PARAMETER SWITCH            05340000
         CLI   0(REG3),LPARN                                            05360000
         BE    PARAMLP                  IF DELIMITER IS A LEFT PAREN    05380000
*                                       SET LEFT PAREN SWITCH           05400000
         CLI   0(REG3),RPARN                                            05420000
         BE    PARAMRP                  IF DELIMITER IS A RIGHT PAREN   05440000
*                                       SET RIGHT PAREN SWITCH          05460000
         CLI   0(REG3),BLANKCOL                                         05480000
         BE    PARBLANK                 IF DELIMITER IS A BLANK,        05500000
*                                       SET BLANK SWITCH                05520000
         B     KINVALD                  IF NONE OF THE ABOVE, SET ERROR 05540000
*                                       SWITCH INDICATING INVALID       05560000
*                                       DELIMITER FOUND.                05580000
*                   DECID  CHECK THE EXIT CONTROL SW AND DELIMITER      05600000
*                      INDICATOR TO SET CORRECT ENTRY SWITCHES AND      05620000
*                      INFORMATION IN SWITCHRD FOR USER PROGRAM         05640000
*                                                                       05660000
*                                                                       05680000
*                   KIRSCO IS THE FIRST ENTRY ROUTINE  WHICH CLEARS     05700000
*                      CONTROL SWITCHES TO ZERO FOR FIRST READ          05720000
*                      GOES TO READ CARD  ROUTINE                       05740000
*                                                                       05760000
KIRSCD   OI    SWITCHRD,BIT3           SET FIRST ENTRY SWITCH           05780000
         SR    REG3,REG3               *CLEAR READ ROUTINE              05800000
         ST    REG3,DSP9                SWITCH AREAS ON FIRST           05820000
         STC   REG3,DSP5                ENTRY INTO ROUTINE*             05840000
         STC   REG3,DSP8                                                05860000
*   KGTCD READS A CARD INTO INPUT AREA.  IF LAST CARD HAS BEEN   PM3343 05880018
*      READ GO TO KEOF.  IF NOT GO TO KGTCDR.                    PM3343 05900018
KGTCD    L     REG1,IEHMVV32       SYSIN DCB ADDRESS.            PM3343 05920018
         LA    REG1,0(REG1)        CLEAR HIGH ORDER BYTE.        PM3343 05940018
         MVC   57(3,REG1),SYNAD    ADDR OF SYSIN SYNAD TO DCB.   PM3343 05960018
         MVC   33(3,REG1),EODA  ADDR OF EOF ROUTINE TO SYSIN DCB PM3343 05980018
*                                                                PM3343 06000018
*         READ NEXT CARD                                         PM3343 06020018
*                                                                PM3343 06040018
         LA    REG0,DSP1                LOAD ADDRESS OF INPUT AREA      06080000
         GET   (REG1),(REG0)            READ A CARD                     06100000
         CLC   DSP1(2),EOF         IS THIS A /* ?                 19919 06103019
         BE    KEOF                YES--THEN W'VE HIT EOF AND     19919 06106019
*                                      DATA MANAGEMENT HAS        19919 06109019
*                                      NOT SENT US TO OUR         19919 06112019
*                                      EOF ROUTINE  .             19919 06115019
         TM    IEHMVV20+3,X'20'         PRINT NOW                       06120000
         BZ    KGTCDR                   NO                              06140000
         BAL   REG9,KPRNT               YES PRINT IT NOW                06160000
         B     KGTCDR                                                   06180000
*                   KGTCDR TESTS COLUMN 72 FOR BLANK AND SETS BIT FOR   06200000
*                      BLANK OR NON BLANK   TEST BYPASS BIT IF ON       06220000
*                      GO TO KBYPO IF OFF GO TO ROUTINE TO TEST ENTRY   06240000
*                      CONTROL SWITCH                                   06260000
*                                                                       06280000
KGTCDR   NI    DSP8,RESET0                                              06300000
         CLI   DSP4,BLANKCOL            IS COLUMN 72 BLANK              06320000
         BE    SET72B                   IF YES, SET END OF CARD SWITCH  06340000
         OI    DSP8,BIT5                SET 72 NB SW                    06360000
RETURN   TM    SWITCHRD,BIT1           IS BYPASS SWITCH ON              06380000
         BO    KBYPO                    IF YES, GOTO TEST IF CARD IS TO 06400000
*                                       BE PRINTED NOW                  06420000
         B     KPFOL                    GO TO TEST IF NEXT CARD SHOULD  06440000
*                                       BE READ.                        06460000
*                   PARBLANK IS ENTERED IF DELIMITER WAS A BLANK        06480000
*                      CHECKS FOR PRESENCE OF COMMAND WORD IF COMMAND   06500000
*                      ADJUST POINTER TO NEXT NON BLANK COLUMN          06520000
*                      CHECKS LENGTH IF NOT ZERO SET BYPASS SW          06540000
*                      IF ZERO AND PRECEDED BY COMMA READ NEXT          06560000
*                      CARD                                             06580000
*                                                                       06600000
PARBLANK TM    DSP5,BIT5                IS CMD CNTL SW ON               06620000
         BO    KPCMD                    IF YES, GO TO SCAN FOR NEXT     06640000
*                                       KEYWORD                         06660000
         OI    SWITCHRD,BIT6           SET PARAM BIT                    06680000
         OI    DSP10,BIT4               SET BLANK DELIM BIT             06700000
DECID    TM    DSP8,BIT2                IS DELIM IN END COLUMN          06720000
         BO    KWENT                    IF YES, GO TO SET READ CARD SW  06740000
         TM    DSP8,BIT7                IS LENGTH EQ TO ZERO            06760000
         BO    KFORZRO                  IF YES, GO TO CHECK TYPE OF     06780000
*                                       DELIMITER                       06800000
         OI    DSP5,BIT2                SET PARAM FOLLOW SW             06820000
         TM    DSP10,BIT4               IS DELIM A BLANK                06840000
         BO    KETBYP                   IF YES, SET BYPASS SWITCH       06860000
         B     KPASS                    IF NONE OF THE ABOVE, EXIT      06880000
KETBYP   OI    SWITCHRD,BIT1           SET BYPASS SWITCH                06900000
         BAL   REG9,PARAN               GO TO TEST PARAN CTR            06920000
         B     KPASS                    EXIT                            06940000
KFORZRO  SR    REG1,REG1                SET REG1 AND REG2 TO ZERO       06960000
         SR    REG2,REG2                                                06980000
         TM    DSP10,BIT4               IS DELIM A BLANK                07000000
         BO    KETRDCD                  IF YES, SET READ CARD SWITCH    07020000
         OI    DSP5,BIT2                SET PARAM FOLLOW SW             07040000
         TM    DSP10,BIT0               IS DELIM AN EQUAL SIGN          07060000
         BO    KTER                     IF YES, GO TO SET ERROR SWITCH  07080000
*                                       AND EXIT                        07100000
         TM    DSP10,BIT2               IS DELIM LEFT PAREN             07120000
         BO    KPAFOL                   IF YES, GO TO SCAN FOR NEXT     07140000
*                                       DELIMITER                       07160000
         TM    DSP10,BIT3               IS DELIM RIGHT PAREN            07180000
         BO    KPASS                    IF YES, EXIT                    07200000
         TM    DSP11,BIT3               WAS LAST DELIM A RT PAREN       07220000
         BO    KPAFOL                   IF YES, GO TO SCAN FOR NEXT     07240000
*                                       DELIMITER                       07260000
         B     KPASS                    OTHERWISE, EXIT                 07280000
KDSP     LA    REG4,DSP2               IS THIS COL 16                   07300000
         CR    REG3,REG4                                                07320000
         BE    KBYPS                    IF YES, GO TO SET BYPASS SWITCH 07340000
*                                       AND EXIT                        07360000
         TM    DSP11,EQRPN              WAS LAST DELIM AN = OR )        07380000
         BZ    KTERBY                   IF NO, SET ERROR SWITCH ANDEXIT 07400000
         B     KBYPS                    OTHERWISE, SET BYPASS SWITCH    07420000
*                                       AND EXIT                        07440000
KETRDCD  OI    DSP5,CONT                SET RDCD AND CONTINUE SW        07460000
         TM    DSP8,BIT4                IS COL 72 BLANK                 07480000
         BO    KDSP                     IF YES, RETURN TO CHECK FOR     07500000
*                                       COL 16                          07520000
         TM    DSP11,BIT1               WAS LAST DELIM A COMMA          07540000
         BO    KGTCD                    IF YES, RETURN TO READ NEXT     07560000
*                                       RECORD                          07580000
         TM    DSP11,BIT2               WAS LAST DELIM A  (             07600000
         BO    KTERBY                   IF YES, SET ERROR SWITCH AND    07620000
*                                       EXIT                            07640000
         B     KBYPS                    OTHERWISE, SET BYPASS SWITCH    07660000
*                                       AND EXIT                        07680000
KTERBY   OI    SWITCHRD,BIT1           SET BYPASS SWITCH                07700000
KTER     OI    SWITCHRD,BIT0           SET ERROR SW                     07720000
         B     KPASS                    AND EXIT                        07740000
KWENT    OI    DSP5,CONT                SET RDCD AND CONTINUE SW        07760000
         TM    DSP8,BIT4                IS COLUMN 72 BLANK              07780000
         BO    KETCTBL                  IF YES, CHECK PAREN COUNT       07800000
         TM    DSP8,BIT7                IS LENGTH EQUAL TO ZERO         07820000
         BO    KZERO                    IF YES, GO TO FIND TYPE OF      07840000
*                                       DELIMITER                       07860000
         TM    DSP10,BIT4               IS DELIM BLANK                  07880000
         BO    KETBYP                   IF YES, SET BYPASS SWITCH AND   07900000
*                                       CHECK PAREN COUNT               07920000
         B     KPASS                    OTHERWISE, EXIT                 07940000
KZERO    SR    REG1,REG1                                                07960000
         TM    DSP10,BIT0               IS DELIM EQUAL                  07980000
         BO    KTER                     IF YES, SET ERROR SWITCH AND    08000000
*                                       EXIT                            08020000
         TM    DSP10,BIT4               IS DELIM A BLANK                08040000
         BO    KETRDCD                  IF YES, SET READ CARD SWITCH    08060000
         TM    DSP10,BIT1               IS DELIM A COMMA                08080000
         BZ    KRTPR                    IF NO, CHECK FOR A RIGHT        08100000
*                                       PAREN DELIMITER                 08120000
         TM    DSP11,BIT3               WAS LAST DELIM A )              08140000
         BO    KGTCD                    IF YES, READ NEXT RECORD        08160000
         B     KPASS                    OTHERWISE, EXIT                 08180000
KRTPR    TM    DSP10,BIT3               IS DELIM A RT PAREN             08200000
         BO    KPASS                    IF YES, EXIT                    08220000
         B     KGTCD                    OTHERWISE, READ NEXT RECORD     08240000
KETCTBL  OI    SWITCHRD,BIT1           SET BYPASS SW                    08260000
         BAL   REG9,PARAN               CHECK PARAN CTR                 08280000
         TM    DSP8,BIT7                IS LENGTH EQ TO ZERO            08300000
         BO    KETLPRN                  IF YES, CHECK FOR TYPE OF       08320000
*                                       DELIMITER                       08340000
         TM    DSP10,BIT1               IS DELIM A COMMA                08360000
         BO    KTER                     IF YES, SET ERROR SWITCH AND    08380000
*                                       EXIT                            08400000
         B     KPASS                    OTHERWISE, EXIT                 08420000
KETLPRN  SR    REG1,REG1                                                08440000
         TM    DSP10,BIT3               IS DELIM A RT PAREN             08460000
         BO    KPASS                    IF YES, EXIT                    08480000
         TM    DSP10,BIT4               IS DELIM A BLANK                08500000
         BO    KETBLK                   IF YES, CHECK WHAT TYPE THE     08520000
*                                       PREVIOUS DELIMITER WAS          08540000
         B     KTER                     OTHERWISE, SET ERROR SWITCH     08560000
*                                       AND EXIT                        08580000
KETBLK   TM    DSP11,MSKG            WAS LAST DELIM A COMMA OR LT PAREN 08600000
         BZ    KPASS                    IF NO, EXIT                     08620000
         B     KTER                     OTHERWISE, SET ERROR SWITCH     08640000
*                                       AND EXIT                        08660000
SET72B   OI    DSP8,BIT4                SET COL 72 BLANK SW             08680000
         B     RETURN                   RETURN TO TEST BYPASS SWITCH    08700000
KBYPO    TM    IEHMVV20+3,X'30'         HAS THIS CARD BEEN PRINTED      08720000
         BO    KBYPO1                   IF YES, TEST FOR BLANK IN COL72 08740000
         TM    IEHMVV20+3,X'20'         SHOULD WE PRINT NOW             08760000
         BO    KBYPO1                   NO                              08780000
         BAL   REG9,KPRNT               YES  PRINT IT NOW               08800000
         OI    IEHMVV20+3,X'20'                                         08820000
         NI    IEHMVV20+3,X'EF'                                         08840000
KBYPO1   CLI   DSP4,BLANKCOL            IS COL 72 BLANK                 08860000
         BNE   KGTCD                    IF NO, READ NEXT RECORD         08880000
         NI    SWITCHRD,BIT3           RESET SWITCHRD                   08900000
         NI    DSP5,RESET0              RESET ENTRY CNTL SW             08920000
         NI    IEHMVV20+3,X'CF'         RESET PRINT SWITCH              08940000
         B     KGTCD                    RETURN TO READ NEXT RECORD      08960000
SETCC1   OI    DSP8,BIT1                SET COND CODE 1 SW              08980000
         B     TESTPAR                  RETURN TO TEST FOR PARTIAL PARM 09000000
SETLZ    OI    DSP8,BIT7                SET LENGTH ZERO SW              09020000
         B     DELIM                    RETURN TO CHECK FOR VALID       09040000
*                                       DELIMITER                       09060000
KEY      OI    SWITCHRD,BIT5           SET KEYWORD BIT                  09080000
         OI    DSP10,BIT0               SET DELIM EQ BIT                09100000
         B     DECID                    RETURN TO SET UP FOR KEYWORD    09120000
*                                       SCAN                            09140000
PARAMC   OI    SWITCHRD,BIT6           SET PARAMETER BIT                09160000
         OI    DSP10,BIT1               SET DELIM COMMA BIT             09180000
         B     DECID                    RETURN TO SET UP FOR SUB PARAM  09200000
*                                       LIST SCAN                       09220000
PARAMLP  OI    SWITCHRD,BIT6           SET PARAMETER BIT                09240000
         OI    DSP10,BIT2               SET DELIM LT PAREN BIT          09260000
         BAL   REG9,ADD                                                 09280000
         B     DECID                    RETURN TO SET UP SCAN FOR NEXT  09300000
*                                       DELIMITER                       09320000
PARAMRP  OI    SWITCHRD,PRPARN         SET PARAM AND RT PAREN BITS      09340000
         OI    DSP10,BIT3               SET DELIM RT PAREN BIT          09360000
         BAL   REG9,SUBT                                                09380000
         B     DECID                    RETURN TO SET UP SCAN FOR       09400000
*                                       NEXT DELIMITER                  09420000
PRFOL    OI    DSP5,BIT2                SET PARAM FOLLOW TO ENTRY CNTL  09440000
         B     KPASS                    EXIT                            09460000
KPRNT    LR    REG1,REG12                                               09480000
         MVI   0(REG1),BLANK                                            09500000
         MVC   1(120,REG1),0(REG1)      CLEAR PRINT BUFFER              09520000
         LA    REG2,IEHMVV90                                            09540000
         MVC   1(80,REG1),1(REG2)       MOVE CARD IMAGE TO PRINT BUFFER 09560000
         ST    REG3,124(REG12)                                          09580000
         LR    REG3,REG1                                                09600000
         LINK  EP=IEHMVESU                                              09620000
         L     REG3,124(REG12)         RESTORE REG 3                    09640000
         TM    IEHMVV20+2,ABORT         IS PERM SWITCH ON?              09660000
         BO    KABORT                                                   09680000
         BR    REG9                                                     09700000
*                                                                       09720000
KINVAL   OI    SWITCHRD,BIT0           INVALID DELIMETER USED           09740000
         LA    REG2,1(REG2)             ADJUST POINTERS TO THE          09760000
         LA    REG3,1(REG3)             INPUT STREAM                    09780000
         CLI   0(REG3),KSPLT           SET ERROR  BIT                   09800000
         BL    KINV                     IF THIS IS A DELIMITER, GOTO    09820000
*                                       ADJUST INPUT STREAM POINTER     09840000
         CR    REG3,REG5                                                09860000
         BL    KINVAL                   IF THIS IS THE END COLUMN, GOTO 09880000
*                                       SET ERROR SWITCH, INVALID       09900000
*                                       DELIMITER USED                  09920000
         TM    DSP8,BIT4                IS COLUMN 72 BLANK              09940000
         BO    KTERBY                   IF YES, SET ERROR SWITCH        09960000
*                                       AND EXIT                        09980000
         LA    REG2,1(REG2)             ADJUST PARAM LENGTH COUNTER     10000000
         B     KPTERR                   AND GOTO SAVE LENGTH OF PARTIAL 10020000
*                                       PARAM                           10040000
KCONT    LA    REG3,DSP1               ADDR. COL. 1 IN REG. 3    A37900 10060021
         CLI   0(REG3),BLANK           COL. 1 BLANK?        3    A37900 10070021
         BNE   KNOP                    IF NO, SYNTAX ERROR       A37900 10072021
         CLC   1(14,REG3),0(REG3)      NEXT 14 COL. BLANK?       A37900 10074021
         BNE   KNOP                    IF NO, SYNTAX ERROR       A37900 10076021
         LA    REG3,DSP2               ADDR. COL. 16 IN REG. 3   A37900 10078021
         CLI   0(REG3),BLANK           COL. 16 BLANK?            A37900 10078421
         BE    KNOP                    IF YES,SYNTAX ERROR       A37900 10078821
         B     SCANR                    RETURN TO SCAN FOR NEXT         10100000
*                                       DELIMITER                       10120000
KPART    TM    DSP5,BIT3                IS PARTIAL PARAM SW ON          10140000
         BO    KTERBY                   IF YES, SET ERROR SWITCH        10160000
*                                       AND EXIT                        10180000
         OI    DSP8,BIT0                SET COND CODE ZERO BIT          10200000
KPTERR   OI    DSP5,BIT3                SET PARTIAL PARAM BIT           10220000
         TM    DSP8,BIT4                IS COL 72 BLANK                 10240000
         BO    KLAST                    IF YES, SET PARAM SWITCH        10260000
         MVI   DSP7,BIT1                                                10280000
         MVC   DSP7+1(43),DSP7                                          10300000
         STC   REG2,DSP6                SAVE LENGTH OF PARTIAL PARAM    10320000
         BCTR  REG2,REG0                ADJUST LENGTH FOR MOVE          10340000
         EX    REG2,MOVEP               MOVE PARTIAL TO SAVE AREA       10360000
         OI    DSP5,BIT1                SET CONTINUE BIT                10380000
         B     KCDFL                    CONTINUATION CARD EXPECTED.     10400000
*                                       GOTO TEST IF COL 72 IS NONBLANK 10420000
KLAST    OI    SWITCHRD,BIT6            SET PARAM BIT                   10440000
         B     KETBYP                   SET BYPASS SWITCH AND EXIT      10460000
KPPAR    SR    REG4,REG4                CLEAR REG                       10480000
         IC    REG4,DSP6                PICK UP PARTIAL LENGTH          10500000
         AR    REG4,REG2                                                10520000
         C     REG4,FOUR4         IS LENGTH GREATER THAN 44             10540000
         BH    KTERBY                                                   10560000
         SR    REG4,REG4                                                10580000
         AR    REG4,REG2                 COMPLETE PARAMETER IN HOLD     10600000
         BZ    KOMPL                    IF LENGTH COUNT IN REG2 IS ZERO 10620000
*                                       PICK UP PARTIAL SWITCH          10640000
*                                       PREVIOUSLY SAVED                10660000
         SR    REG4,REG4                                                10680000
         IC    REG4,DSP6                PICK UP PARTIAL LENGTH          10700000
         LA    REG9,DSP7                ADDR OF PARTIAL HOLD AREA       10720000
         AR    REG4,REG9                                                10740000
         BCTR  REG2,REG0                ADJUST VALUE FOR MOVE           10760000
         EX    REG2,MOVPP                                               10780000
         LA    REG2,1(REG2)             ADJUST LENGTH OF PARAM          10800000
KOMPL    SR    REG4,REG4                COMPUTE LENGTH AND PLACE IN     10820000
         IC    REG4,DSP6                 REG 2                          10840000
         AR    REG2,REG4                                                10860000
         LA    REG1,DSP7                PLACE ADDR OF HOLD AREA IN      10880000
*                                                                       10900000
         NI    DSP8,RESET10                                             10920000
         OI    DSP8,MSKE                SET COND CODE 1 AND LNG GT ZERO 10940000
         MVC   DSP11(1),DSP10          SAVE LAST DELIM INDICATOR        10960000
         NI    DSP10,RESET0                                             10980000
         NI    DSP5,RESET6              RESET PARTIAL PARAM SW          11000000
         B     DELIM                    RETURN TO CHECK FOR             11020000
*                                       VALID DELIM                     11040000
KPASS    LA    REG3,1(REG3)             ADJUST PNTR TO INPUT STREAM     11060000
*                                       AND SAVE REGISTER VALUES USED   11080000
*                                       IN SCAN RTN                     11100000
KPASS1   NI    DSP5,X'EB'                                               11120000
        ST    REG1,DSP13                                                11140000
        ST    REG3,DSP12                                                11160000
         ST    REG2,DSP14                                               11180000
       IEHPOST (14),T                                                   11200000
         MVI   ESSENTRY,ZERO            SET ESS ENTRY SWITCH            11220000
         XCTL  (4,12),EP=IEHMVESS                                       11240000
KPCMD    LA    REG3,1(REG3)             ADJUST PNTR TO START OF NEXT    11260000
         CLI   0(REG3),BLANKCOL           KEYWORD OR PARAMETER AND GO   11280000
         BNE   KPCMA                    IF NOT A BLANK, GOTO TEST       11300000
*                                       FOR A COMMA                     11320000
         CR    REG5,REG3                IS THIS THE END COLUMN?         11340000
         BE    KNOPAR                   IF YES, GOTO SET ERRROR SWITCH, 11360000
*                                       NO KEYWORD FOUND, AND EXIT      11380000
         B     KPCMD                    OTHERWISE, RETURN TO SEARCH     11400000
*                                       FOR A BLANK                     11420000
KPCMA    CLI   0(REG3),COMMA              IF COMMA IS FIRST CHAR FOUND  11440000
         BE    KNOPAR                   SET ERROR SWITCH AND EXIT       11460000
         BCTR  REG3,REG0                                                11480000
         B     PRFOL                    SET PARAM FOLLOW SWITCH ANDEXIT 11500000
KSETP    OI    DSP5,BIT3                SET PARAM FOLLOW AND            11520000
         LA    REG2,1(REG2)             ADJUST PARAM LENGTH COUNTER     11540000
         B     KPTERR                   RETURN TO TEST FOR BLANK IN     11560000
*                                       COL 72                          11580000
KINV     TM    DSP5,BIT5                IF COMD CNTL SW ON ADJ          11600000
         BO    KPCMD                    ADJUST PNTR TO NEXT PARAM       11620000
         B     PRFOL                    SET PARAM FOLLOW SWITCH ANDEXIT 11640000
KCDFL    TM    DSP8,BIT5                IF COL 72 NON BLANK GET CARD    11660000
         BO    KGTCD                    RETURN TO READ NEXT RECORD      11680000
         OI    SWITCHRD,BIT0            SET ERROR  BIT IN SWITCHRD      11700000
KBYPS    OI    SWITCHRD,BIT1            SET BYPASS SW                   11720000
         B     KPASS                    EXIT                            11740000
SUBT     LH    REG4,DSP9                DELIMETER WAS A CLOSE           11760000
         BCTR  REG4,REG0                PARENTESES, SUBTRACT            11780000
         STH   REG4,DSP9                ONE FROM COUNTER                11800000
         LTR   REG4,REG4                IF PAREN COUNT IS NOT LESS THAN 11820000
         BNL   KACK                     ZERO, DO NOT SET ERROR SWITCH   11840000
         OI    SWITCHRD,BIT0            SET ERROR BIT                   11860000
KACK     BR    REG9                                                     11880000
*                                                                       11900000
*                                                                       11920000
ADD      LH    REG4,DSP9                DELIMETER WAS AN OPEN           11940000
         LA    REG4,1(REG4)             PAREN, ADD                      11960000
         STH   REG4,DSP9                ONE TO COUNTER                  11980000
         BR    REG9                                                     12000000
KPAFOL   LA    REG3,1(REG3)             ADJUST PNTR TO NEX COLUMN       12020000
         B     SCANR                    RETURN TO SCAN FOR NEXT         12040000
*                                       DELIMITER                       12060000
KINVALD  OI    SWITCHRD,BIT0            SET ERROR BIT                   12080000
         TM    DSP8,BIT2                IS DELIMETER IN END COL         12100000
         BO    KSETP                    IF YES, RETURN TO SET PARAM     12120000
*                                       FOLLOW SWITCH                   12140000
         B     KINVAL                   OTHERWISE, RETURN TO SET ERROR  12160000
*                                       SWITCH, INVALID DELIMITER USED  12180000
KEOF     NI    SWITCHRD,X'00'          RESET FIRST ENTRY                12200000
         OI    SWITCHRD,X'20'          SET END OF FILE BIT              12220000
         BAL   REG9,PARAN               GOTO TEST PAREN COUNT           12240000
          TM    DSP5,BIT1          CONTINUATION EXPECTED         A32046 12245020
          BZ    KPASS              *B IF NOT                     A32046 12250020
          OI    SWITCHRD,BIT0      INDICATE SYNTAX ERROR         A32046 12255020
         B     KPASS                    EXIT                            12260000
PARAN    SR    REG4,REG4                                                12280000
         AH    REG4,DSP9               ADD PAREN COUNT                  12300000
         BZ    OKAY                     IF PAREN COUNT ZERO, RETURN     12320000
         OI    SWITCHRD,BIT0           SET ERROR BIT                    12340000
OKAY     BR    REG9                                                     12360000
KABORT   DS    0H             ENTRY POINT TO TERMINATE A REQUEST        12380000
         OI    IEHMVV41+13,X'04'       SET RETURN CODE AT 12            12400000
         SR    REG1,REG1                                                12420000
         SR    REG2,REG2                                                12440000
         OI    SWITCHRD,BIT0           SET ERROR BIT                    12460000
         B     KPASS1                   EXIT                            12480000
*                                                                       12500000
*                             FOLLOWING INSTRUCTIONS ARE THE OBJECT     12520000
*                             OF EXECUTE STATEMENTS                     12540000
*                                                                       12560000
MOVEP    MVC   DSP7(1),0(REG1)          MOVES PARTIAL PARAM TO HOLD     12580000
*                                       AREA                            12600000
MOVPP    MVC   0(1,REG4),0(REG1)        MOVES REMAINDER OF PARAM TO     12620000
*                                       HOLD AREA                       12640000
*                                                                       12660000
*                             ASSEMBLER DC STATEMENTS AND DSECTS        12680000
*                             FOR THIS PROGRAM FOLLOW                   12700000
*                                                                       12720000
EOF      DC    CL2'/*'                                            19919 12730019
         DS    0F                                                       12740000
EODA     DC    AL3(KEOF)                                                12760000
FOUR4    DC    F'44'                                                    12780000
SYNAD    DC    AL3(KABORT)                                              12800000
         ENTRY KEOF                                                     12820000
         ENTRY  IEHMVESJ                                                12840000
*                             THE FOLLOWING DSECT DESCRIBES THE SWITCH  12860000
*                             SETTINGS USED BY THIS PROGRAM             12880000
*                                                                       12900000
         SPACE 3                                                        12920000
SWITCHRD DSECT 0F                                                       12940000
         DS    0X'80'                   ERROR INDICATOR                 12960000
         DS    0X'40'                   BYPASS SWITCH                   12980000
         DS    0X'20'                   END OF FILE INDICATOR           13000000
         DS    0X'10'                   FIRST ENTRY SWITCH              13020000
         DS    0X'08'                   COMMAND BIT                     13040000
         DS    0X'04'                   KEYWORD                         13060000
         DS    0X'02'                   PARAMETER                       13080000
         DS    1X'01'                   RIGHT PARENTHESES               13100000
DSP1     DS    CL1                COLUMN  1  OF CARD                    13120000
         DS    CL14                                                     13140000
DSP2     DS    CL1                COLUMN 16  OF CARD                    13160000
         DS    CL54                                                     13180000
DSP3     DS    CL1                COLUMN 71  OF CARD                    13200000
DSP4     DS    CL1                COLUMN 72  OF CARD                    13220000
         DS    CL8                                                      13240000
DSP5     DS    0X                  INTERNAL CONTROL SWITCHES            13260000
         DS    0X'80'                                                   13280000
         DS    0X'40'                   CONTINUED ON NEXT CARD          13300000
         DS    0X'20'                   PARAMETER FOLLOW SWITCH         13320000
         DS    0X'10'                   PARTIAL PARAMETER SWITCH        13340000
         DS    0X'08'                   READ CARD SWITCH                13360000
         DS    0X'04'                   COMMAND CONTROL SWITCH          13380000
         DS    0X'02'                                                   13400000
         DS    1X'01'                                                   13420000
DSP6     DS    1X                       LENGTH OF PARTIAL PARAMETER     13440000
DSP7     DS    CL44                     HOLD AREA FOR PARTIAL PARAM     13460000
DSP8     DS    0X'80'              CONDITION CODE  0                    13480000
         DS    0X'40'              CONDITION CODE 1                     13500000
         DS    0X'20'              CONDITION CODE  2                    13520000
         DS    0X'10'                                                   13540000
         DS    0X'08'              COLUMN 72 BLANK                      13560000
         DS    0X'04'              COLUMN 72 NON BLANK                  13580000
         DS    0X'02'              LENGTH OF PARAM GREATER THAN ZERO    13600000
         DS    1X'01'              LENGTH OF PARAM IS ZERO              13620000
DSP9     DS    1H                  PARENTHESIS COUNTER                  13640000
DSP10    DS    0X'80'              DELIMITER IS EQUAL SIGN              13660000
         DS    0X'40'              DELIMITER IS COMMA                   13680000
         DS    0X'20'              DELIMITER IS LEFT PARENTHESIS        13700000
         DS    0X'10'              DELIMITER IS RIGHT PARENTHESIS       13720000
         DS    0X'08'              DELIMITER IS BLANK                   13740000
         DS    0X'04'                   NOT USED                        13760000
         DS    0X'02'                   NOT USED                        13780000
         DS    1X'01'                   NOT USED                        13800000
DSP11    DS    0X'80'              LAST DELIM WAS EQUAL SIGN            13820000
         DS    0X'40'              LAST DELIM WAS COMMA                 13840000
         DS    0X'20'              LAST DELIM WAS LEFT PARENTHESIS      13860000
         DS    0X'10'              LAST DELIM WAS RIGHT PARENTHESIS     13880000
         DS    0X'08'                                                   13900000
         DS    0X'04'                   NOT USED                        13920000
         DS    0X'02'                   NOT USED                        13940000
         DS    1X'01'                   NOT USED                        13960000
DSP12    DS    1F                  SAVE AREA FOR START OF NEXT SCAN     13980000
DSP13    DS    1F                  POINTER TO START OF PARAM PASSED     14000000
DSP14    DS    1F                  LENGTH OF PARAMETER PASSED           14020000
         SPACE 3                                                        14040000
         IEHMVV                                                         14060000
ESSENTRY EQU   IEHMVV27+4                                               14080000
         END                                                            14100000
./  ADD  SSI=62440121,NAME=IEHMVESK
*TITLE ' IEHMVSSK'                                                      00020020
*FUNCTION/OPERATION: THIS MODULE IS ENTERED WHEN ALL REQUEST TO       * 00040000
*IEHMOVE1 HAVE BEEN SERVICED OR WHEN A CONDITION IS DETERMINED THAT   * 00060000
*WILL NOT ALLOW ANY FURTHER PROCESSING BY IEHMOVE1 PROG.              * 00080000
*THE FUNCTION OF THIS MODULE IS TO: 1. CLOSE WORKFILES, SYSIN,        * 00100000
*SYSPRINT, DCB. 2. SCRATCH WORKFILES 3. FREEMAIN COMMUNICATION        * 00120000
*(OR WORK) AREA.                                                      * 00140000
*ENTRY POINTS: IEHMVESK                                               * 00160000
*INPUT: POINTER TO IEHMOVE1 WORK AREA IN REG 12                       * 00180000
*EXITS - NORMAL 'RETURN' TO IEHMVSSD (STEM)                           * 00200000
*3125 0070                                                         7667 00220000
IEHMVSSK CSECT                                                          00240000
*C013200                                                       @ZA03372 00241403
*A012220,034100                                                @ZM30153 00242803
*A013200,014400,032600                                         @ZA00101 00244203
*D013200-013800,014400-015600,016600-017600,024800-026000      @ZA00101 00245603
*D032600-032800                                                @ZA00101 00247003
*A018600,C019000,028600                                          A50942 00248403
*A018600,C019000,028600                                          A50942 00249803
*A018600,C019000,028600                                          A50942 00251200
*013500-013540                                                   A48777 00253622
*008800                                                          A34084 00256020
* 021000                                                           I276 00258419
* 027800                                                        PTM3039 00260819
*                                                                A30903 00263220
*                                                                A35452 00265620
* 009400,012800                                                  A37897 00268021
* 014000-015800,016400-018000,024400-024600,032200,033000-033200 A37897 00270421
*C013200,014400,018600,019520                                    A50959 00272822
*A012920-012940,014280-014300,018300-018320,018500               A50959 00275200
         USING IEHMVV,COMMAREA                                          00277600
         USING IEHMVESK,BASE                                            00280000
IEHMVESK SAVE  (14,12),T,FINAL-WRAP-UP-DBRUCE-AUG-9-5                   00300000
         ENTRY IEHMVESK                                                 00320000
         LR    BASE,LINK                                                00340000
        IEHPRE (14,1),TFC                                               00360000
** CLOSE SYSIN-SYSPRINT-,,SYSUT1-,,SYSUT2 AND ,,SYSUT3                  00380000
**                                                                      00400000
*      MOVE THE CLOSE TO IEHMVV00 TO MAINTAIN REENTRABILITY             00420000
         MVC   IEHMVV00(RENT2-RENT1),RENT1                              00440000
         B     RENT2                                                    00460000
*    THIS SECTION OF CODE WILL NOT BE EXECUTED IN LINE                  00480000
*      IT WILL BE MOVED TO GOTTEN CORE AND EXECUTED TO MAINTAIN         00500000
*      REENTRABILITY                                                    00520000
RENT1    DS    0F                                                       00540000
         USING *,COMMAREA                                               00560000
         CLOSE ((R6))                                                   00580000
         BR    10                                                       00600000
         USING IEHMVV,COMMAREA                                          00620000
RENT2    DS    0F                                                       00640000
         L     R6,IEHMVV32              SYSIN DCB ADDR                  00660000
         USING IHADCB,R6                                         A35452 00665020
         TM    DCBOFLGS,OPENED         WAS SYSIN OPENED          A35452 00670020
         BZ    SCRATCH                 NO-SKIP FREEPOOL          A35452 00675020
         BALR  R10,COMMAREA       CLOSE                                 00680000
         FREEPOOL (R6)                 FREE SYSIN BUFFERS        A35452 00686020
SCRATCH  EQU   *                                                 A35452 00692020
         SR    DBR1,DBR1                                                00700000
         L     R1,4(SAVEAREA)          GET PREVIOUS SAVE ADDR      7667 00720000
         L     R1,4(R1)                SAVE AREA OF INVOLK         7667 00740000
         L     R1,24(R1)               PARAMETER ADDRESS           7667 00760000
         TM    0(R1),X'80'   DDNAME LIST                           7667 00780000
         BO    NOLIST                  NO                          7667 00800000
         L     R1,4(R1)                DDNAME LIST                 7667 00820000
         CLI   1(R1),X'38'             LIST INCLUDE UT1            7667 00840000
         BNH   NOLIST                  NO                          7667 00860000
          CLI   58(R1),X'00'       SYSUT1 CHANGED                A34084 00880020
         BE    NOLIST                  NO                          7667 00900000
         MVC   UT1(8),58(R1)           MOVE NEW UT1 NAME           7667 00920000
NOLIST   CLI   IEHMVV39+5,X'FF'        FIRST WORKFILE ALLOCATED  A37897 00930021
         BE    BCKFROM                 NO-BYPASS SCRATCH         A37897 00940021
         L     R1,LOC16                PTR TO THE CVT            A37897 00950021
         L     R1,0(R1)                 LOAD PTR TO TCB PTRS            00960000
         L     R1,0(R1)                 LOAD TCB PTR                    00980000
         L     R1,12(R1)                LOAD PTR TO TIOT                01000000
         LA    R1,24(R1)                LOAD PTR TO DD ENTRY IN TIOT    01020000
         IC    DBR1,0(R1)               PUT ENTRY BYTE CNT IN REGISTER  01040000
         LA    DBR3,UT1                 LOAD ADDR OF NAME SYSUT1        01060000
COMP     CLC   0(8,DBR3),4(R1)          COMPARE IT TO TIOT DDNAME ENTRY 01080000
         BE    FIND                     BRANCH IF FOUND                 01100000
         AR    R1,DBR1                  BUMP REG BY LENGTH OF ENTRY     01120000
         IC    DBR1,0(R1)               INSERT LENGTH OF NEXT ENTRY     01140000
         LTR   DBR1,DBR1                IS IT ZERO                      01160000
         BZ    RC2                                                      01180000
         B     COMP                     LOOP AND SEARCH                 01200000
FIND     ICM   R1,3,18(R1)              LOAD UCB PTR           @ZM30153 01220003
         N     R1,FOXES                 CLEAR HALF OF REG      @ZM30153 01222003
         TM    2(R1),X'FF'              IS THIS A 2321                  01223013
         BC    1,NOT2321                BRANCH ON NO                    01226013
         MVC   VOLLST+6(6),4(R1)        MOVE IN VOL SER FROM SUB UCB    01229013
         SR    R6,R6                                                    01232013
         IC    R6,1(R1)                 BACK UP TO POINT TO MAIN        01235013
         SLL   R6,4                        UCB TO GET THE DEVICE TYPE   01238013
         LA    R6,56(R6)                                                01241013
         LR    R10,R1                                                   01244013
         SR    R10,R6                                                   01247013
         MVC   VOLLST+2(4),16(R10)                                      01250013
         B     THRUMOVE                                                 01253013
NOT2321  MVC   VOLLST+2(4),16(R1)       MOVE TYPE CODE TO PARAM LIST    01256013
         MVC   VOLLST+6(6),28(R1)       MOVE VOL SERIAL TO PARAM LIST   01260000
THRUMOVE CLI   IEHMVV39+7,X'FF'        WAS SYSUT3 ALLOCATED      A37897 01270021
         BE    SCRUT2                  NO-BYPASS SCRATCH         A37897 01280021
         L     R6,IEHMVV42                                       A37897 01290021
         TM    DCBOFLGS,OPENED         WAS SYSUT3 OPENED         A50959 01292022
         BZ    NOFR3                   NO-SKIP FREEPOOL          A50959 01294022
         BALR  R10,COMMAREA       CLOSE                                 01300000
NOFR3    MVC   NEWNAME+9(8),IEHMVV87   MOVE TIME TO **SYSUT3   @ZA03372 01320003
         BAL   DBR1,SCRRTN             GO TO THE SCRATCH RTN     A37897 01390021
SCRUT2   CLI   IEHMVV39+6,X'FF'        WAS SYSUT2 ALLOCATED      A37897 01400021
         BE    SCRUT1                  NO-BYPASS SCRATCH         A37897 01420021
         L     R6,IEHMVV41             PTR TO UT2 DCB            A37897 01426021
         TM    DCBOFLGS,OPENED         WAS SYSUT2 OPENED         A50959 01428022
         BZ    NOFR2                   NO-SKIP FREEPOOL          A50959 01430022
         BALR  R10,COMMAREA            CLOSE UT2                 A37897 01432021
NOFR2    MVI   NEWNAME+7,X'F2'         MAKE NAME **SYSUT2      @ZA00101 01440002
         BAL   DBR1,SCRRTN             GO TO THE SCRATCH RTN     A37897 01600021
SCRUT1   MVI   NEWNAME+7,X'F1'         MAKE NAME=SYSUT1          A37897 01640021
         L     R6,IEHMVV40              UT1 DCB ADDR                    01820000
         TM    DCBOFLGS,OPENED         WAS SYSUT1 OPENED         A50959 01830022
         BZ    NOFR1                   NO-SKIP FREEPOOL          A50959 01832022
         BALR  R10,COMMAREA       CLOSE                                 01840000
         FREEPOOL (R6)                 FREE SYSUT1 BUFFER        A50959 01850022
NOFR1    BAL   DBR1,SCRRTN             GO TO THE SCRATCH RTN     A50959 01860022
BCKFROM  EQU   *                                                 A50942 01870022
         TM    IEHMVV51+1,X'01'         TEST FOR ERROR FROM SCRARCH     01880000
         BO    ERR2                     BRANCH IF ERROR ENCOUNTERED     01900000
BCKFROM1 MVC   IEHMVV00(RENT2-RENT1),RENT1                       A37897 01920022
         L     R6,IEHMVV33             LOAD SYSPRINT ADDR               01940000
         TM    DCBOFLGS,OPENED         WAS SYSPRINT OPENED       A35452 01946020
         BZ    RC                      NO-SKIP FREEPOOL          A50959 01952022
         BALR  R10,COMMAREA       CLOSE                                 01960000
         FREEPOOL (R6)       FREE SYSPRINT BUFFER                A35452 01970020
RC       TM    IEHMVV20+2,X'01'    IS PERM ABORT BIT ON                 01980000
         BZ    RC1                NO CONTINUE                           02000000
RC2      OI    IEHMVV41+13,X'02'     RET CODE = 8                       02020000
         OI    IEHMVV32,X'08'           SET RETURN CODE BYTE            02040000
RC1      SR    LINK,LINK                                                02060000
         IC    R7,IEHMVV41+13      LOAD RETURN CODE                     02080000
SKIP1    LA    R1,3040                                             I276 02100019
         LR    R0,R1                                                    02120000
         LR    R1,COMMAREA        PUT ADDR OF COMMAREA INTO REG1        02140000
      FREEMAIN R,LV=(0),A=(1)           FREE COMMAREA MAIN              02160000
       IEHPOST (14,1),T                                                 02180000
         LR    15,R7              PUT RET CODE IN REG 15                02200000
        RETURN (14,12),RC=(15)                                          02220000
SCRRTN   SR    R0,R0                                               LRT  02230013
         SCRATCH  SCR                                              LRT  02240013
         LA    LINK,0(LINK)       CLEAR HIGH ORDER BYTE OF REG 15       02260000
         LTR   LINK,LINK          IS RETURN CODE ZERO                   02280000
         BCR   8,DBR1                   BRANCH IF SUCCESSFUL RETURN     02300000
         SRL   LINK,3                   CHECK FOR A RETURN OF 8         02320000
         LTR   LINK,LINK                                                02340000
         BCR   8,DBR1                   BRANCH IF GOOD RETURN           02360000
*                                          FROM SCRATCH                 02380000
         MVI   IEHMVV51+1,X'01'         INDICATE ERROR ENCOUNTERED      02400000
         BR    DBR1                                                     02420000
MESSAD   DC    A(MESS)                                                  02620000
MESS     CSECT                                                          02640000
         USING MESS,R1                                                  02660000
M1       DC    CL29'IEH381I ERROR ENCOUNTERED IN '                 7667 02680000
         DC    CL21'SCRATCHING WORK FILES'                         7667 02700000
IEHMVSSK CSECT                                                          02720000
ERR2     DS    0H                                                       02740000
    L  R1,MESSAD                                                        02760000
         MVI   IEHMVV00,X'40'          CLEAR PRINT AREA         PTM3039 02770019
         MVC   IEHMVV00+1(120),IEHMVV00                         PTM3039 02780019
         MVC   IEHMVV00+1(50),M1                                   7667 02800000
         OI    IEHMVV41+13,X'04'       RET CODE=12               A29950 02810019
         LR    DBR1,COMMAREA                                       7667 02820000
         LINK  EP=IEHMVESU                                              02840000
         B     BCKFROM1                 RETURN TO WRAP UP        A50942 02860022
LOC16    EQU   16                                                       02880000
OPENED   EQU   X'10'                                             A35452 02890020
BASE     EQU   8                                                        02900000
R0       EQU   0                                                        02920000
R1       EQU   1                                                        02940000
R2       EQU   2                                                        02960000
DBR1     EQU   3                                                        02980000
DBR3     EQU   4                                                        03000000
DBCOMPR  EQU   5                                                        03020000
COMMAREA EQU   12                                                       03040000
SAVEAREA EQU   13                                                       03060000
RETURN   EQU   14                                                       03080000
LINK     EQU   15                                                       03100000
R6       EQU   6                                                        03120000
R7       EQU   7                                                        03140000
R9       EQU   9                                                        03160000
R10      EQU   10                                                       03180000
R11      EQU   11                                                       03200000
SCR     CAMLST SCRATCH,NEWNAME,,VOLLST,,OVRD                     A30903 03240020
NEWNAME  DC    CL44'**SYSUT3.'                                 @ZA00101 03260002
         DS    0H                                                       03340000
VOLLST   DC    XL2'01'                                                  03360000
         DC    XL12'00'                                                 03380000
         DS    0F                                                       03400000
FOXES    DC    X'0000FFFF'              CLEAR HIGH BYTES       @ZM30153 03410003
UT1      DC    CL8'SYSUT1'                                              03420000
         EJECT                                                          03426020
         DCBD                                                    A35452 03432020
         IEHMVV                                                         03440000
         END                                                            03460000
./  ADD  SSI=62440122,NAME=IEHMVESL
 TITLE 'IEHMVSSL-FIXED RECORD DEBLOCKING FOR IEHMOVE-LOAD MODULE ESL'   00010017
*TITLE -IEHMVSSL                                                        00020017
*FUNCTION/OPERATION: THIS MODULE WILL MOVE OR COPY DATA SETS WHICH    * 00040000
*ARE PDS OR PHYSICAL SEQUENTIAL WHICH HAVE FIXED FORMAT RECORDS       * 00060000
*WITHOUT KEYS. THIS MODULE WILL READ RECORDS AND BLOCK OR DEBLOCK THE * 00080000
*RECORDS TO THE BLOCKSIZE OF OUTPUT DCB. ISSUES A GETMAIN FOR WORKAREA* 00100000
*AND FOR A BUFFER WHICH IS AS LARGE AS COMBINED BLOCKSIZE OF INPUT AND* 00120000
*OUTPUT.                                                              * 00140000
*IF USER LABEL PROCESSING WAS REQUESTED, THIS MODULE WILL, AT END-OF- * 00143017
*DATA OR VOLUME SWITCH TIME GETMAIN IF NECESSARY FOR A LABEL SAVEAREA.* 00146017
*THE SAVED LABELS WILL THEN BE PASSED TO IEHMVSSN TO BE OUTPUT DURING * 00149017
*DATA SET WRAP-UP.                                                    * 00152017
*                                                                     * 00155017
*ENTRY POINTS: IEHMVESL                                               * 00160000
*INPUT: AT ENTRY REG 13 POINTS SAVEAREA AND REG 12 POINTS TO          * 00180000
*COMMUNICATION TABLE                                                  * 00200000
*OUTPUT: REG ARE SAME AS INPUT                                        * 00220000
*EXTERNAL ROUTINES: IEHMVSSR- PDS SUBROUTINE TO GET DIRECTORY ENTERIES* 00230017
*                   IEHMVLSU- MESSAGE WRITER                          * 00240017
*EXITS - NORMAL IEHMVSSN - IEHMVSTG                                   * 00260000
*ERRORS: IEHMVSSN                                                     * 00280000
*TABLES/WORK AREAS: IEHMVV - COMMUNICATION TABLE.                     * 00300000
***   ***   ***   ***   ***   ***   ***   ***   ***   ***   ***         00320000
*                                                                     * 00360000
*                                                                     * 00380000
*                                                                     * 00420000
*                                                                     * 00440000
***   ***   ***   ***   ***   ***   ***   ***   ***   ***   ***         00460000
IEHMVSSL CSECT                THIS MODULE WILL READ BPAM OR BSAM        00480000
*                        BLOCKED RECORDS AND REBLOCK THE RECORDS        00500000
*                        TO THE OUTPUT DATASET SPECIFICATIONS IT        00520000
*                        WILL DEBLOCK RECORDS WHICH ARE TOO LONG        00540000
*                        FOR OUTPUT DATASET                    @YA02544 00544002
*A020800-021920                                                @YA02544 00548002
*C067180                                                       @YA02544 00552002
*D020800-021800                                                @YA02544 00556002
*C079000                                                         A99999 00560122
*                                                                A37903 00560421
* 018000,040000                                                  A37888 00562021
*0326000200,002400,005700,070200                                   UL0H 00570017
*0326 058800-059200                                                8114 00575017
*                                                                       00580000
BAS10    EQU   10                                                       00600000
BAS11    EQU   11                                                       00620000
BAS12    EQU   12                                                       00640000
RE0      EQU   0                                                        00660000
RE1      EQU   1                                                        00680000
RE2      EQU   2                                                        00700000
RE3      EQU   3                                                        00720000
RE4      EQU   4                                                        00740000
RE5      EQU   5                                                        00760000
RE6      EQU   6                                                        00780000
RE7      EQU   7                                                        00800000
RE8      EQU   8                                                        00820000
RE9      EQU   9                                                        00840000
RTRN     EQU   14                                                       00860000
GOTO     EQU   15                                                       00880000
DSORG    EQU   26                                                       00900000
EODAD    EQU   33                                                       00920000
SYNAD    EQU   57                                                       00940000
BLKSZ    EQU   62                                                       00960000
RECFM    EQU   36                                                       00980000
FIXED    EQU   X'80'                                                    01000000
VARID    EQU   X'40'                                                    01020000
TRUNC    EQU   X'08'                                                    01040000
         SPACE 3                                                        01060000
IEHMVESL SAVE  (14,12),T,ESJ-TEST-9-20-65                               01080000
         USING IEHMVESL,BAS10                                           01100000
         USING IEHMVV,BAS12                                             01120000
         USING WRKBUF,BAS11                                             01140000
         USING PRINT,1                                                  01160000
         ENTRY IEHMVESL                                                 01180000
         LR    BAS10,GOTO          LOAD BASE FOR PROGRAM                01200000
*                                                                  UL0H 01202017
* ACTIVATE USER INPUT TRAILER LABEL EXIT IF REQUIRED               UL0H 01204017
*                                                                  UL0H 01206017
         CLI   UDCBITLE,DEACTIVE        IS ITLE INACTIVE           UL0H 01208017
         BE    NEXTCODE                 YES,CONTINUE               UL0H 01210017
         MVC   UDCBITLE(4),XXITLE       NO, SET UP ITLE LIST ADDR  UL0H 01212017
NEXTCODE DS    0H                                                  UL0H 01214017
*                                                                  UL0H 01216017
         L     RE2,IEHMVV30        ADDR OF FROM DCB                     01220000
         MVC   SYNAD(3,RE2),SINAD                                       01240000
         L     RE3,IEHMVV31        ADDR OF TO DCB                       01260000
         MVC   SYNAD(3,RE3),SINAD                                       01280000
         LA    RE0,148             LOAD AMOUNT FOR WORKBUF       A25706 01310019
         GETMAIN  R,LV=(0)                                              01320000
         LR    BAS11,RE1                                                01340000
         MVI   0(11),X'00'         CLEAR WORKAREA TO ZEROS              01360000
         MVC   1(143,11),0(11)                                          01380000
         MVC   BLKIN(2),BLKSZ(RE2)                                      01400000
         MVC   BLKOUT(2),BLKSZ(RE3)                                     01420000
         ST    BAS11,GOTAT              STORE ADDR OF WORKAREA          01440000
         IEHPRE (14,1),TF                                               01460000
         TM    DSORG(RE3),X'40'         IS THIS A BSAM DATASET          01480000
         BO    BSMRTN                   YES  SET UP FOR BSAM            01500000
PDSRTN   MVC   EODAD(3,RE2),BPEOD                                       01520000
         L     RE2,IEHMVV31        ADDR OF 'TO' DCB.             A25706 01526019
         MVC   PDSTRKBL(2),18(RE2)   SAVE INITIAL TRACK BALANCE  A25706 01532019
         SR    RE2,RE2                                                  01540000
         SPACE 3                                                        01560000
PDGETM   LA    RE3,CCHHR                ADDR OF BUFFER FOR DIRECTORY    01580000
         LINK   EP=IEHMVESR             GET MEMBER NAME                 01600000
         B     BACK(15)                                                 01620000
BACK     B     CHKALS                                                   01640000
         B     ENDJOB                                                   01660000
         SPACE 3                                                        01680000
MVMOR    LH    RE0,BLKIN                ADD BLOCKSIZE OF FROM AND TO    01700000
         AH    RE0,BLKOUT                DCB'S TO COMPUTE LENGTH OF     01720000
         ST    RE0,GOTEN               STORE AMOUNT FOR BUFFER          01740000
         GETMAIN R,LV=(0)                BUFFER                         01760000
         ST    RE1,BUFPTR               ADDR OF BUFFER                  01780000
         TM    IEHMVV30+4,X'80'        HAS FIRST REC BEEN READ   A37888 01800021
         BO    HAVBUF                                                   01820000
         SR    RE6,RE6                                                  01840000
         SR    RE7,RE7                                             8114 01844017
         L     RE1,IEHMVV30             ADDR OF FROM DCB           8114 01848017
         TM    17(RE1),X'81'            TEST DEVICE TYPE FOR TAPE  8114 01852017
         BO    FXDRTN                   YES  BYPASS POINT MACRO    8114 01856017
         L     RE0,TTRC                 SET UP POINTER FOR              01860000
         IC    RE0,ZERO                  POINT ROUTINE TO POINT TO      01880000
         ST    RE0,POINT                 FIRST RECORD OF MEMBER         01900000
         BAL   RE9,PTRTN                                                01940000
         B     FXDRTN                                                   01980000
         SPACE 3                                                        02000000
CHKALS   TM    CTT,X'80'           IS THIS AN ALIAS DIRECTORY ENTRY     02020000
         BO    STALS               YES  STOW ALIAS                      02040000
         NI    SWITCH,X'FE'        ZERO NOSTOW SWITCH SET WHEN   A25706 02046019
*                                    LAST TRUE MEMBER WAS A DUP. A25706 02052019
         TM    CTT,X'60'           ARE USER DATA TTR'S PRESENT          02060000
         BC    5,ABORT                 YES BRANCH TO ABORT     @YA02544 02080002
         TM    IEHMVV20+3,X'08'        PREALLOCATION           @YA02544 02086002
         BZ    MVMOR                   NO DON'T CHECK          @YA02544 02092002
         XC    BLDLIST,BLDLIST         CLEAR                   @YA02544 02100002
         MVI   BLDLIST+1,X'01'         INDIC ONE ENTRY         @YA02544 02110002
         MVI   BLDLIST+3,X'0E'         ENTRY LENGTH            @YA02544 02120002
         MVC   BLDLIST+4(8),RENAME     GET MEMBER NAME         @YA02544 02126002
         L     (RE7),IEHMVV31          TO DCB ADDRESS          @YA02544 02132002
         BLDL  (RE7),BLDLIST           SEE IF MEMBER EXISTS    @YA02544 02140002
         LTR   15,15                   MEMBER FOUND            @YA02544 02150002
         BZ    DUPE1                   YES PRINT MSG           @YA02544 02160002
         B     MVMOR                   NO CONTINUE             @YA02544 02166002
PTRTN    LA    RE1,0(0,RE1)                                    @YA02544 02172002
         LA    RE0,POINT               TTR ADDR FOR POINT      @YA02544 02180002
         POINT (1),(0)                                         @YA02544 02190002
         BR    RE9                                                      02200000
         SPACE 3                                                        02220000
WRITF    L     RE3,BUFPTR              LOAD ADDR OF BUFFER              02240000
WRITF2   L     RE2,IEHMVV31             ADDRESS OF DCB                  02260000
         LA    2,0(0,2)                 CLEAR HIGH ORDER BYTE           02280000
         L     RE1,IEHMVV31+4           ADDR OF DECB                    02300000
         LA    1,0(0,1)                 CLEAR HIGH ORDER BYTE           02320000
         WRITE (1),SF,(2),(3),MF=E      WRITE RECORD                    02340000
         L     RE1,IEHMVV31+4           ADDR OF DECB                    02360000
         LA    1,0(0,1)                 CLEAR HIGH ORDER BYTE           02380000
         CHECK (1)                      CHECK FOR GOOD READ             02400000
         SH    RE7,BLKOUT               SUBT BLKOUT FROM AMT IN CORE    02420000
         CH    RE7,BLKOUT               IS AMT IN CORE MORE THAN BLKOUT 02440000
         BL    SHIFT                    NO  GO TO SHIF ROUTINE          02460000
         AH    RE3,BLKOUT               ADJUST PTR TO DATA IN CORE      02480000
         B     WRITF2                   YES  WRITE ANOTHER RECORD       02500000
*                                                                       02520000
*                                                                       02540000
SHIFT    LTR   RE7,RE7                  IS AMT IN CORE ZERO             02560000
         BZ    READF                    YES  GO TO READ                 02580000
         BP    SHFT2                    NO   GO TO SHFT2                02600000
         EX    0,*                                                      02620000
MOVER    MVC   0(1,8),0(3)              MOVE DATA TO START OF BUFFER    02640000
         SPACE 3                                                        02660000
HAVBUF   L     RE1,IEHMVV30+4          SET UP TO MOVE THE FIRST         02680000
         L     RE6,12(0,RE1)           RECORD READ BY ESV INTO THE      02700000
         ST    RE6,SAV03               BUFFER GOTTEN BY ESL MODULE      02720000
         L     RE2,IEHMVV30                                             02740000
         LH    RE6,BLKIN                                                02760000
         ST    RE6,SAV02                                                02780000
         L     RE3,SAV03                                                02800000
         L     RE8,BUFPTR                                               02820000
         LR    RE7,RE6                                                  02840000
         CH    RE7,BLKOUT IS ESV RECORD LARGE ENOUGH TO WRITE?     7207 02860000
         BNL   WRITF2  IF YES, WRITE FROM ESV BUFFER.              7207 02880000
         B     SHFTSAV   NO, BR TO XFER RECORD FROM ESV TO ESL BUF 7207 02900000
FXDRTN   CH    RE7,BLKOUT               SHOULD WE READ OR WRITE         02920000
         BNL   WRITF                     BRANCH TO WRITE                02940000
READF    LR    RE6,RE7                  LOAD INDEX REG WITH AMOUNT      02960000
         L     RE8,BUFPTR                                               02980000
RDCHK    L     RE2,IEHMVV30        ADDR OF FROM DCB                     03000000
         L     RE1,IEHMVV30+4      ADDR OF FROM DECB                    03020000
         LA    RE3,0(RE6,RE8)      ADDR OF START OF DATA                03040000
         BAL   RE9,READM                                                03060000
         L     RE1,IEHMVV30+4                                           03080000
         BAL   RE9,CHECM                                                03100000
         B     TSTRNC                                                   03120000
SHFT2    AH    RE3,BLKOUT  SET PTR TO START OF INFO TO BE MOVED    7207 03140000
SHFTSAV  LR    RE4,RE7  LOAD REG 4 WITH NO OF BYTES TO BE MOVED    7207 03160000
SHFT3    LA    RE5,256                  SET UP MAXIMUM LENGTH FOR MOVE  03180000
         CR    RE4,RE5    IS AMOUNT TO BE MOVED LARGER THAN 256?   7207 03200000
         BL    ADJST                      256  NO  BRANCH TO ADJUST     03220000
MOVE     BCTR  RE5,0                    SUBT ONE FOR EXECUTE            03240000
         EX    RE5,MOVER                EXECUTE MOVER                   03260000
         LA    RE5,1(0,5)               ADD ONE TO LENGTH MOVED         03280000
         AR    RE3,RE5   BUMP PTR. TO NEXT INFO TO BE MOVED-       7207 03300000
*          (APPLICABLE ONLY WHEN MORE THAN ONE MOVE IS EXECUTED)   7207 03320000
         AR    RE8,RE5         BUMP BUFFER POINTER                 7207 03340000
         SR    RE4,RE5        SUBTRACT AMOUNT MOVED THIS TIME      7207 03360000
         LTR   RE4,RE4        TEST COUNT OF BYTES MOVED            7207 03380000
         BZ    READF    BRANCH TO READ IF ALL HAVE BEEN MOVED      7207 03400000
         B     SHFT3                    NO  LOOP TO SHIFT MORE          03420000
ADJST    LR    RE5,RE4   LOAD NO. OF BYTES FOR FINAL MOVE          7207 03440000
         B     MOVE                                                     03460000
HAVBUF01 L     RE0,SAV02                                                03480000
         L     RE1,SAV03                                                03500000
         FREEMAIN  R,LV=(0),A=(1)                                       03520000
         B     GIVBAC                                                   03540000
         SPACE 3                                                        03560000
TSTRNC   L     RE2,IEHMVV30             ADDR  OF  DCB                   03580000
         LR    RE1,RE2                                                  03600000
         L     RE2,68(0,2)              ADDR  OF  IOB                   03620000
         SR    RE5,RE5                                                  03640000
         IC    RE5,16(0,1)              ADD KEY LENGTH                  03660000
         AH    RE5,BLKSZ(0,RE1)         ADD BLOCKSIZE                   03680000
         SH    RE5,22(0,RE2)            SUBT RESIDUAL LNG FROM IOB      03700000
         AR    RE7,RE5                                                  03720000
         B     FXDRTN                                                   03740000
         SPACE 3                                                        03760000
BSMRTN   MVC   EODAD(3,RE2),BSEOD                                       03780000
         LA    RE2,256                                                  03800000
         ST    RE2,TTRC                                                 03820000
         B     MVMOR                                                    03840000
ALDONE   LTR   RE7,RE7      HAS EVERYTHING BEEN WRITTEN?           7207 03860000
         BZ    SEQDONE       EVERYTHING HAS BEEN WRITTEN           7207 03880000
         BAL   RE4,WRTRSEQ    NO, GO TO WRITE TRUNCATED BLOCK      7207 03900000
SEQDONE  L     RE0,GOTEN          SET REG ZERO FOR FREEMAIN        7207 03920000
         L     RE1,BUFPTR              ADDR OF BUFFER                   03940000
         FREEMAIN  R,LV=(0),A=(1)                                       03960000
ENDJOB   IEHPOST (14,1),T                                               03980000
         TM    IEHMVV30+4,X'80'        HAS FIRST REC BEEN READ   A37888 04000021
         BO    HAVBUF01                FREEMAIN THAT WAS PASSED TO SSL  04020000
GIVBAC   LA    RE0,148             SIZE OF WORKBUF WORKAREA      A25706 04040019
         LR    RE1,BAS11                                                04060000
         FREEMAIN  R,LV=(0),A=(1)                                       04080000
         TM    IEHMVV20+2,X'40'        IS MIDABORT BIT ON               04100000
         BO    WRAPIT                  YES                              04120000
         TM    IEHMVV20+2,X'08'        IS INC REP BIT ON                04140000
         BO    INCLUDES                YES                              04160000
WRAPIT   XCTL  (2,12),EP=IEHMVESN                                       04180000
INCLUDES TM    IEHMVV20,X'10'          DSGROUP OPERATION           VS0H 04190017
         BC    1,WRAPIT                YES, TO VESN FOR WRAPUP     VS0H 04200017
         XCTL  (2,12),EP=IEHMVETG      NO, TO PDS INC-REP MODULE   VS0H 04210017
         SPACE 3                                                        04220000
DONE     LTR   RE7,RE7                  HAS EVERYTHING BEEN WRITTEN     04240000
         BZ    STOWER                   YES GO TO STOW                  04260000
         LA    RE4,STOWER    SET END OF PDS OR SDS                 9256 04280000
WRTRSEQ  L     RE2,IEHMVV31      LOAD ADDRESS OF DCB               7207 04300000
         LA    2,0(0,2)                                                 04320000
         STH   RE7,BLKSZ(0,RE2)         CHANGE BLOCK SIZE FOR SHORT REC 04340000
         L     RE1,IEHMVV31+4           ADDR OF DECB                    04360000
         LA    1,0(0,1)                 CLEAR HIGH ORDER BYTE           04380000
         L     RE3,BUFPTR        ADDR OF BUFFER                         04400000
         BAL   RE9,WRITM                GO TO WRITE LAST RECORD         04420000
         BAL   RE9,CHECM                                                04440000
         LH    RE5,BLKOUT               RESTORE BLOCKSIZE IN DCB        04460000
         STH   RE5,BLKSZ(0,RE2)                                         04480000
         BR    RE4  BR TO 'STOWAL' FOR PDS OR 'SEQDONE' FOR SEQ DS 7207 04500000
STOWAL   MVC   NAME(8),RENAME           STOW MEMBER                     04520000
         L     RE1,IEHMVV31                                             04540000
         LA    1,0(0,1)                                                 04560000
         LA    RE0,NAME                                                 04580000
         STOW  (1),(0),A                                                04600000
         MVC   OLDTTR(3),TTRC                                           04620000
         B     STOWED(15)                                               04640000
STOWED   B     STWMSG                                                   04660000
         B     DUPLCTE                                                  04680000
         EX    0,*                                                      04700000
         B     DIRFUL                                                   04720000
         B     STOERR                                                   04740000
******************************************************************21919 04741021
*                                                                *21919 04742021
*   NEXT RETURN CODES ALSO GIVE THE MESSAGE:                     *21919 04743021
*         IEH326I I/O ERROR ENCOUNTERED IN OUTPUT DATA SET       *21919 04744021
*   BUT THESE RETURN CODES ARE CAUSED BY OTHER ERRORS            *21919 04745021
*                                                                *21919 04746021
******************************************************************21919 04747021
         B     STOERR        INDICATES I/O REQUESTS AGAINST THE   21919 04748021
*                            DCB ARE STILL OUTSTANDING            21919 04749021
         B     STOERR        INDICATES THE DCB IS NOT OPEN        21919 04750021
         B     STOERR        INDICATES CONDITIONAL GETMAIN WITHIN 21919 04751021
*                            STOW WAS UNSUCCESSFUL                21919 04752021
         SPACE 3                                                        04760000
WRITM    WRITE (1),SF,(2),(3),MF=E      WRITE RECORD                    04780000
         BR    RE9                                                      04800000
         SPACE 3                                                        04820000
CHECM    LA    1,0(0,1)                 CLEAR HIGH ORDER BYTE           04840000
         CHECK (1)                                                      04860000
         BR    RE9                                                      04880000
         SPACE 3                                                        04900000
READM    LA    1,0(0,1)                                                 04920000
         LA    2,0(0,2)                                                 04940000
         READ  (1),SF,(2),(3),MF=E                                      04960000
         TM    IEHMVV74+4,X'FF'   TEST FOR I/O ERROR ON LABELS     UL0H 04966017
         BO    YESLABER           DURING EOV,IF YES - BRANCH       UL0H 04972017
         BR    RE9                                                      04980000
YESLABER L     RE3,A126           PROVIDE MSG FOR MOVE TO BUFFER   UL0H 04981017
         IC    RE2,A126           PROVIDE MSG FOR MOVE INSTR       UL0H 04982017
         BAL   RE5,CLEAR          CLEAR PRINT BUFFER               UL0H 04983017
         LA    RE1,IEHMVV00       PRINT BUF ADDRESS FOR MSG MOVE   UL0H 04984017
         EX    2,MOVMES           MOVE MSG TO PRINT BUFFER         UL0H 04985017
         ST    RE9,SAVERE9        SAVE REISTER 9                   UL0H 04986017
         BAL   RE9,MESSAG02       PRINT MSG                        UL0H 04987017
         L     RE9,SAVERE9        RESTORE REGISTER 9               UL0H 04988017
         NI    IEHMVV74+4,X'00'   RESET I/O ERROR ON LABEL SWITCH  UL0H 04989017
         BR    RE9                RETURN                                04990017
STOWER   L     RE1,BUFPTR          FREE BUFFER BEFORE STOW              05000000
         L     RE0,GOTEN                                                05020000
         FREEMAIN R,LV=(0),A=(1)                                        05040000
         LA    2,10                                                     05060000
STALS    TM    SWITCH,X'01'                                             05080000
         BO    NOSTOW                                                   05100000
         MVC   TTRC(3),OLDTTR                                           05120000
         B     STOWAL                                                   05140000
NOSTOW   L     RE3,A125                                                 05160000
         IC    RE2,A125                                                 05180000
         BAL   RE9,MESSAGE                                              05200000
         B     PDGETM                                                   05220000
DUPLCTE  TM    CTT,X'80'           IS THIS AN ALIAS DIR ENTRY.   A25706 05224019
         BO    DUPE1               YES-- THIS IS A DUP ALIAS.    A25706 05228019
         OI    SWITCH,X'01'        SET NO STOW SWITCH.           A25706 05232019
         L     RE1,IEHMVV31        ADDR OF 'TO' DCB.             A25706 05236019
         MVC   0(3,RE1),TTRC       SET RELAD FIELD IN TO DCB.    A25706 05240019
         MVI   CTT,X'00'           ZERO 'C' BYTE OF STOW LIST    A25706 05244019
*                                     AND USE TTR RETURNED BY    A25706 05248019
*                                     STOW FOR BLOCK ADDR IN     A25706 05252019
*                                     POINT.  POINT TO RECOVER   A25706 05256019
*                                     SPACE WHERE DUP  MEMBER    A25706 05260019
*                                     WRITTEN.                   A25706 05264019
         LA    RE0,TTRC            POINT R0 TO STOW LIST TTR.    A25706 05268019
         POINT (1),(0)             RECOVER DUP NAME SPACE.       A25706 05272019
         L     RE1,IEHMVV31        'TO' DCB ADDR.                A25706 05276019
         MVC   18(2,RE1),PDSTRKBL   RESTORE TRACK BALANCE STORED A25706 05280019
*                                      FROM LAST SUCCESFUL STOW  A25706 05284019
         OI    48(RE1),X'80'       SET DCBOFLGS TO INDICATE      A25706 05288019
*                                      LAST I/O OPERATION WAS    A25706 05292019
*                                      A WRITE.  THIS WILL FORCE A25706 05296019
*                                      A MERGE TO THE DSCB AT    A25706 05300019
*                                      CLOSE TIME IF LAST        A25706 05304019
*                                      MEMBER IS A DUP.          A25706 05308019
DUPE1    L     RE3,A119                                                 05320000
         IC    RE2,A119                                                 05340000
         BAL   RE9,MESSAGE                                              05360000
         B     PDGETM                                                   05380000
         B     ABORT                                                    05400000
STWMSG   L     RE1,IEHMVV31        'TO' DCB ADDR.                A25706 05408019
         MVC   PDSTRKBL(2),18(RE1)  SAVE TRACK BALANCE AFTER     A25706 05416019
*                                      SUCCESSFUL STOW.          A25706 05424019
         L     RE3,A118            MEMBER MOVED/COPIED MESSAGE   A25706 05432019
         IC    RE2,A118                                                 05440000
         BAL   RE9,MESSAGE                                              05460000
         B     PDGETM                                                   05480000
         B     ABORT                                                    05500000
DIRFUL   L     RE3,A121                                                 05520000
         IC    RE2,A121                                                 05540000
         BAL   RE9,MESSAGE                                              05560000
         B     ABORT                                                    05580000
         B     ABORT                                                    05600000
ABORT    OI    IEHMVV20+2,X'40'                                         05620000
         B     ENDJOB                                                   05640000
STOERR   L     RE3,A124                                                 05660000
         IC    RE2,A124                                                 05680000
         L     RE4,IEHMVV21+4                                           05700000
         BAL   RE9,MESSAG03                                             05720000
         B     ABORT                                                    05740000
         B     ABORT                                                    05760000
SORRY    ST    RE1,POINT                *** SYNAD ROUTINE ***      8114 05780017
         TM    POINT,X'80'                                              05800000
         BO    READERR                                                  05820000
         TM    POINT,X'40'                                              05840000
         BO    WRITERR                                                  05860000
ABORTED  OI    IEHMVV20+2,X'40'                                         05940000
         OI    IEHMVV41+13,X'02'       SET RETURNCODE TO 8       A37903 05950021
         B     ALDONE                                                   05960000
READERR  L     RE3,A122                                                 05980000
         IC    RE2,A122                                                 06000000
         L     RE4,IEHMVV21                                             06020000
         BAL   RE9,MESSAG01                                             06040000
         B     ABORTED                                                  06060000
         B     ABORTED                                                  06080000
WRITERR  L     RE3,A123                                                 06100000
         IC    RE2,A123                                                 06120000
         L     RE4,IEHMVV21+4                                           06140000
         BAL   RE9,MESSAG01                                             06160000
         B     ABORTED                                                  06180000
         B     ABORTED                                                  06200000
MOVMES   MVC   MSG(1),0(3)                                              06220000
MESSAGE  BAL   RE5,CLEAR                                                06240000
         LA    RE1,IEHMVV00                                             06260000
         EX    2,MOVMES                                                 06280000
         MVC   NAMES(8),NAME                                            06300000
         B     MESSAG02                                                 06320000
MESSAG01 BAL   RE5,CLEAR                                                06340000
         LA    RE1,IEHMVV00                                             06360000
         EX    2,MOVMES                                                 06380000
         MVC   NAMES01(8),NAME                                     8114 06400017
         MVC   NAMES02(44),0(4)                                         06420000
         B     MESSAG02                                                 06440000
MESSAG03 BAL   RE5,CLEAR                                                06460000
         LA    RE1,IEHMVV00                                             06480000
         EX    2,MOVMES                                                 06500000
         MVC   NAMES03(44),0(4)                                         06520000
         B     MESSAG02                                                 06540000
MESSAG02 LR    RE3,RE1                                                  06560000
         LINK   EP=IEHMVESU           GO TO MESSAGE WRITER              06580000
         AR    RE9,15                                                   06600000
         BR    RE9                                                      06620000
CLEAR    LA    RE1,IEHMVV00                                             06640000
         MVC   CC(1),BLANK                                              06660000
         MVC   MSG(120),CC                                              06680000
         BR    RE5                                                      06700000
*                                                                  UL0H 06700217
* USER INPUT TRAILER EXIT ROUTINE                                  UL0H 06700417
*                                                                  UL0H 06700617
ITLR     DS    0H                                                  UL0H 06700817
         LA    RE4,OFFSET1             SET UP                      UL0H 06701017
         SR    GOTO,RE4                ADDRESSABILITY              UL0H 06701217
         LR    BAS10,GOTO              FOR EXIT ROUTINE            UL0H 06701417
         L     RE4,0(0,RE1)             GET ADDRESS OF LABEL READ  UL0H 06701617
*                            FOR LATER MOVE TO USER                UL0H 06701817
         LTR   RE4,RE4                  ARE USER LABELS PRESENT    UL0H 06702017
         BNE   IOERR                    YES.  CHECK IF OK          UL0H 06702217
*                                                                  UL0H 06702417
NOLABEL  DS    0H                                                  UL0H 06702617
         MVI   UDCBITLE,X'00'           DEACTIVATE LABEL EXIT      UL0H 06702817
         MVI   UDCBOTLE,X'00'           DEACTIVATE LABEL EXIT      UL0H 06703017
         MVI   IEHMVV20+2,X'40'        SET MIDABORT SWITCH TO TELL UL0H 06703217
*                                      VESN THIS IS END OF ACTION  UL0H 06703417
         SR    GOTO,GOTO                NO, RETURN CODE 0 TO EOV   UL0H 06703617
*                                         TO IGNORE ADDITIONAL LAB UL0H 06703817
         BR    RTRN                     RETURN TO EOV              UL0H 06704017
*                                                                  UL0H 06704217
IOERR    DS    0H                                                  UL0H 06704417
         CLI   8(RE1),X'80'             PERM ERROR FROM PARAM LIST UL0H 06704617
         BNE   TRKAVAIL                 NO. CHECK FOR TRACK AVAIL  UL0H 06704817
LABERR   DS    0H                                                  UL0H 06705017
         OI    IEHMVV74+4,X'FF'   SET LABELI/O ERROR FLAG          UL0H 06705717
         BR    RTRN                     RETURN TO EOV OPERATION    UL0H 06706417
TRKAVAIL DS    0H                                                  UL0H 06706617
         CLI   IEHMVV72+10,X'FF'        DA+NLT FLAG ON             UL0H 06706817
*                            INDICATES NO U.L. TRACK ALLOCATED     UL0H 06707017
         BNE   CORAVAIL                 NO PROCESS LABELS          UL0H 06707217
*                                                                  UL0H 06707417
*  OUTPUT MESSAGE - NO USER LABELS MOVE/COPIED.  NO LABEL TRACK.   UL0H 06707617
*                                                                  UL0H 06707817
         MVI   IEHMVV72+14,X'FF'        TELL CLOSE TO OUTPUT MSG   UL0H 06708017
         B     NOLABEL                 GO SET RC, RETURN TO CLOSE  UL0H 06708217
*                                                                  UL0H 06708417
CORAVAIL DS    0H                                                  UL0H 06708617
         CLC   IEHMVV72(4),ALLZEROS     CORE OBTAINED FOR LABELS   UL0H 06708817
         BNE   INITIAL                  YES, INITIALIZE POINTERS   UL0H 06709017
         GETMAIN R,LV=640              GET CORE FOR LABELS         UL0H 06709217
         ST    RE1,IEHMVV72            SAVE GOTTEN CORE ADDRESS    UL0H 06709417
INITIAL  DS    0H                                                  UL0H 06709617
         CLC   0(4,RE4),UTL1DEF        FIRST LABEL IN GROUP        UL0H 06709817
         BNE   SAVLABEL                NO, BYPASS 1ST LABEL SETUP  UL0H 06710017
         MVC   IEHMVV72+4(4),IEHMVV72   SET POINTER TO LABEL SAVLOCUL0H 06710217
         MVI   IEHMVV72+12,X'00'        CLEAR LABEL COUNTER        UL0H 06710417
*                                                                  UL0H 06710617
SAVLABEL DS    0H                                                  UL0H 06710817
         L     RE1,IEHMVV72+4           GET ADDRESS OF CURRENT     UL0H 06711017
*                                         LABEL SAVEAREA           UL0H 06711217
         MVC   0(80,RE1),0(RE4)         SAVE LABEL IN GOTTEN CORE  UL0H 06711417
         LA    RE1,80(0,RE1)            UPDATE POINTER TO NEXT LO- UL0H 06711617
         ST    RE1,IEHMVV72+4           CATION IN LABEL SAVEAREA   UL0H 06711817
         SR    RE4,RE4                  UPDATE                     UL0H 06712017
         IC    RE4,IEHMVV72+12          LABEL                      UL0H 06712217
         LA    RE4,1(RE4)               COUNTER                    UL0H 06712417
         STC   RE4,IEHMVV72+12          BY ONE                     UL0H 06712617
         LA    GOTO,4                   RETURN CODE OF 4 TO EOV    UL0H 06712817
*                                         TO GET ADDITIONAL LABELS UL0H 06713017
         BR    RTRN                     RETURN TO EOV              UL0H 06713217
*                                                                  UL0H 06713417
XXITLE   DC    X'03'                   INPUT TRAILER LABEL         UL0H 06713617
         DC    AL3(ITLR)                   ROUTINE EXIT            UL0H 06713817
OFFSET1   EQU   ITLR-IEHMVESL                                      UL0H 06714017
ALLZEROS DC    1F'0'                                               UL0H 06715017
UTL1DEF  DC    CL4'UTL1'                                           UL0H 06716017
DEACTIVE EQU   X'00'                                               UL0H 06717017
BLDLIST  DS    CL18                                            @YA02544 06718002
         DS    0F                                                       06720000
A118     DC    AL1(M119-M118-1)         LENGTH MINUS ONE OF MESSAGE     06740000
         DC    AL3(M118)                                                06760000
A119     DC    AL1(M120-M119-1)                                         06780000
         DC    AL3(M119)                                                06800000
A120     DC    AL1(M121-M120-1)                                         06820000
         DC    AL3(M120)                                                06840000
A121     DC    AL1(M122-M121-1)                                         06860000
         DC    AL3(M121)                                                06880000
A122     DC    AL1(M123-M122-1)                                         06900000
         DC    AL3(M122)                                                06920000
A123     DC    AL1(M124-M123-1)                                         06940000
         DC    AL3(M123)                                                06960000
A124     DC    AL1(M125-M124-1)                                         06980000
         DC    AL3(M124)                                                07000000
A125     DC    AL1(M126-M125-1)                                    UL0H 07020017
         DC    AL3(M125)                                                07040000
A126     DC    AL1(M130-M126-1)                                    UL0H 07046017
         DC    AL3(M126)                                           UL0H 07052017
A130     DC    AL1(M131-M130-1)                                         07060000
         DC    AL3(M130)                                                07080000
SINAD    DC    AL3(SORRY)                                               07100000
BSEOD    DC    AL3(ALDONE)                                              07120000
BPEOD    DC    AL3(DONE)                                                07140000
BLANK    DC    CL1' '                                                   07160000
ZERO     DC    X'00'                                                    07180000
WRKBUF   DSECT 0D                                                       07200000
PDSTRKBL DS    H                   TRACK BALANCE STORED HERE     A25706 07202019
*                                      AFTER EVERY SUCCESSFULL   A25706 07204019
*                                      STOW.  RESTORED FROM      A25706 07206019
*                                      HERE TO DCB AFTER DUP     A25706 07208019
*                                      NAME STOW.                A25706 07210019
         DS    H                   UNUSED.                       A25706 07212019
POINT    DS    F                                                        07220000
BLKIN    DS    H                                                        07240000
BLKOUT   DS    H                                                        07260000
GOTEN    DS    F                                                        07280000
GOTAT    DS    F                                                        07300000
BUFPTR   DS    F                                                        07320000
SAV01    DS    F                                                        07340000
SAV02    DS    F                                                        07360000
SAV03    DS    F                                                        07380000
SAV04    DS    F                                                        07400000
SAVERE9  DS    1F                 SAVE AREA FOR REGISTER 9         UL0H 07410017
OLDTTR   DS    F                                                        07420000
SWITCH   DS    CL3                                                      07440000
CCHHR    DS    CL5                                                      07460000
NAME     DS    CL8                                                      07480000
TTRC     DS    CL3                                                      07500000
CTT      DS    CL1                                                      07520000
         DS    CL62                                                     07540000
RENAME   DS    CL8                                                      07560000
PRINT    DSECT                                                          07580000
CC       DS    CL1                                                      07600000
MSG      DS    CL15                                                     07620000
NAMES    DS    CL17                                                     07640000
NAMES01  DS    CL17                                                     07660000
NAMES03  DS    CL10                                                     07680000
NAMES02  DS    CL61                                                     07700000
        IEHMVV                                                          07720000
         ORG   IEHMVV70                                            UL0H 07726017
         IEHDCBXL                                                  UL0H 07732017
SPEAK    CSECT                                                          07740000
M118     DC    CL24'  MEMBER NAMED          '                           07760000
         DC    CL22'HAS BEEN MOVED/COPIED.'                             07780000
M119     DC    CL30'IEH319I MEMBER          NOT MO'                     07800000
         DC    CL30'VED/COPID. DUPLICATE NAME IN O'                     07820000
         DC    CL15'UTPUT DATA SET.'                                    07840000
M120     DC    X'00'                                                    07860000
M121     DC    CL30'IEH321I MEMBER          NOT MO'                     07880000
         DC    CL30'VED/COPIED. OUTPUT DIRECTORY I'              A99999 07900022
         DC    CL7'S FULL.'                                             07920000
M122     DC    CL30'I/O ERROR ENCOUNTERED IN MEMBE'                     07940000
         DC    CL29'R          OF INPUT DATA SET '                      07960000
M123     DC    CL30'I/O ERROR ENCOUNTERED IN MEMBE'                     07980000
         DC    CL30'R          OF OUTPUT DATA SET '                     08000000
M124     DC    CL30'IEH326I I/O ERROR ENCOUNTERED '                     08020000
         DC    CL19'IN OUTPUT DATA SET '                                08040000
M125     DC    CL24'  MEMBER NAMED          '                           08060000
         DC    CL32'IS AN ALIAS AND HAS NOT BEEN STO'                   08080000
         DC    CL32'WED, TRUE MEMBER WAS NOT STOWED.'                   08100000
M126     DC    CL29'PERM I/O ERROR WHILE READING '                 UL0H 08105017
         DC    CL30'USER INPUT TRAILER LABELS. NO '                UL0H 08110017
         DC    CL30'MORE LABELS WILL BE PROCESSED.'                UL0H 08115017
M130     DC    X'00'                                                    08120000
M131     DC    X'40'                                                    08140000
         END                                                            08160000
./  ADD  SSI=62440123,NAME=IEHMVESM
 TITLE 'IEHMVSSM-VARIABLE REC DEBLOCKING FOR IEHMOVE-LOAD MODULE ESM'   00010017
*TITLE -IEHMVSSM                                                        00020017
*FUNCTION/OPERATION: THIS MODULE WILL MOVE OR COPY DATASETS WHICH ARE * 00040000
*PDS OR PHYSICAL SEQUENTIAL THAT HAVE VARIABLE RECORD FORMAT WITHOUT  * 00060000
*KEYS. THIS MODULE READS RECORDS AND BLOCKS OR DEBLOCKS THE RECORDS SO* 00080000
*THEY ARE EQUAL TO OR LESS THAN OUTPUT BLOCKSIZE.                     * 00100000
*IF USER LABEL PROCESSING WAS REQUESTED, AT END-OF-DATA OR VOLUME     * 00104017
*SWITCH TIME THIS MODULE WILL GETMAIN IF NECESSARY FOR A LABEL        * 00108017
*SAVEAREA. THE SAVED LABELS WILL THEN BE PASSED TO IEHMVSSN TO BE     * 00112017
*OUTPUT DURING DATA SET WRAP-UP.                                      * 00116017
*ENTRY POINTS: IEHMVESM ONLY ENTRY POINT                              * 00120000
*INPUT: AT ENTRY TO THIS MODULE REG 13 POINTS TO SAVEAREA AND REG 12  * 00140000
*POINTS TO COMMUNICATION TABLE                                        * 00160000
*OUTPUT: SAME AS INPUT                                                * 00180000
*EXTERNAL ROUTINES: IEHMVSSR- PDS SUBROUTINE TO GET DIRECTORY ENTRIES.* 00190017
*                   IEHMVLSU- MESSAGE WRITER.                         * 00200017
*EXITS - NORMAL IEHMVSSN - IEHMVSTG                                   * 00220000
*ERRORS: IEHMVSSN                                                     * 00240000
*TABLES/WORK AREAS: IEHMVV - COMMUNICATION TABLE                      * 00260000
IEHMVSSM CSECT                                                          00280000
*C057000,073800                                                  A48797 00280422
*A059210-059320                                                   21919 00282021
* 017300-01732                                                   A27711 00283019
*1050025800,067400                                                 7615 00286017
*1050000200,090400                                                 UL0H 00293017
* 021320,028120,028200,035520,038686,091649,091677,091698        A36069 00295021
*A086900                                                         A52025 00297022
REG0     EQU   0                                                        00300000
REG1     EQU   1                                                        00320000
REG2     EQU   2                                                        00340000
REG3     EQU   3                                                        00360000
REG4     EQU   4                                                        00380000
REG5     EQU   5                                                        00400000
REG6     EQU   6                                                        00420000
REG7     EQU   7                                                        00440000
REG8     EQU   8                                                        00460000
REG9     EQU   9                                                        00480000
BAS10    EQU   10                                                       00500000
BAS11    EQU   11                                                       00520000
BAS12    EQU   12                                                       00540000
RETN     EQU   14                                                       00560000
LINK     EQU   15                                                       00580000
KEY      EQU   16                                                       00600000
DSORG    EQU   26                                                       00620000
EODAD    EQU   33                                                       00640000
RECFM    EQU   36                                                       00660000
SYNAD    EQU   57                                                       00680000
BLKSZ    EQU   62                                                       00700000
LRECL    EQU   82                                                       00720000
VARBLK   EQU   X'50'                                                    00740000
VARID    EQU   X'40'                                                    00760000
IEHMVESM SAVE  (14,12),T,ESM-9-23-65-TEST                               00780000
         USING PRINT,1                                                  00800000
         USING IEHMVESM,BAS10                                           00820000
         USING WORK,BAS11                                               00840000
         USING IEHMVV,BAS12                                             00860000
         ENTRY   IEHMVESM                                               00880000
         SPACE 3                                                        00900000
         LR    BAS10,LINK                                               00920000
         IEHPRE (14,1),TF                                               00940000
*                                                                  UL0H 00942017
* ACTIVATE USER INPUT TRAILER LABEL EXIT IF REQUIRED               UL0H 00944017
*                                                                  UL0H 00946017
         CLI   UDCBITLE,DEACTIVE        IS ITLE INACTIVE           UL0H 00948017
         BE    NEXTCODE                 YES,CONTINUE               UL0H 00950017
         MVC   UDCBITLE(4),XXITLE       NO, SET UP ITLE LIST ADDR  UL0H 00952017
NEXTCODE DS    0H                                                  UL0H 00954017
*                                                                  UL0H 00956017
         LA    REG0,144                                                 00960000
         GETMAIN R,LV=(0)               GET CORE FOR WORK AREA          00980000
         LR    BAS11,REG1                                               01000000
         MVI   0(BAS11),X'00'           CLEAR WORK AREA TO              01020000
         MVC   1(143,BAS11),0(BAS11)      ZEROS                         01040000
         L     REG2,IEHMVV30                                            01060000
         MVC   SYNAD(3,REG2),BSMSYN+1  MOVE IN FROM SYNAD EXIT ADR VS0H 01080017
         L     REG2,IEHMVV31                                            01100000
         MVC   SYNAD(3,REG2),BSMSYN+1  MOVE IN TO SYNAD EXIT ADR   VS0H 01120017
         L     REG2,IEHMVV30            PLACE EODAD EXIT ADDR IN DCB    01140000
         MVC   EODAD(3,REG2),BPMEOD+1                              VS0H 01160017
         L     REG2,IEHMVV30                                            01180000
         LH    REG3,BLKSZ(0,REG2)                                       01200000
         STH   REG3,BSZIN                                               01220000
         L     REG2,IEHMVV31                                            01240000
         LH    REG3,BLKSZ(0,REG2)                                       01260000
         STH   REG3,BSZOUT                                              01280000
*                                  CHECK RECFM BEFORE DSORG             01300000
         SR    REG7,REG7                                                01320000
         L     REG2,IEHMVV30                                            01340000
         TM    RECFM(REG2),X'10'        IS INPUT DATA BLOCKED           01360000
         BZ    NOBLK                    NO                              01380000
         OI    SWTH1,X'01'              SET INDICATOR FOR BLOCKED INPUT 01400000
NOBLK    L     REG2,IEHMVV31                                            01420000
         TM    RECFM(REG2),X'10'        IS OUTPUT TO BE BLOCKED         01440000
         BZ    NBLKOT                                                   01460000
         OI    SWTH1,X'10'              SET INDICATOR FOR BLOCK OUTPUT  01480000
NBLKOT   TM    DSORG(REG2),X'40'        IS THIS A BSAM DATASET          01500000
         BO    NEWMBR                                                   01520000
         SPACE 3                                                        01540000
PDS      SR    REG2,REG2                                                01560000
GTMBR    LA    REG3,CCHHR               GET NAME OF MEMBER TO BE MOVED  01580000
         LINK  EP=IEHMVESR                                              01600000
         B     BACK(15)                                                 01620000
BACK     B     ALSCHK                   GO TO CHECK FOR ALIAS NAME      01640000
         B     ALDONE                                                   01660000
NEWMBR   LH    REG0,BSZIN            COMPUTE THE SIZE OF                01680000
         AH    REG0,BSZOUT                BUFFER NEEDED EQUALS BLKSIZE  01700000
         ST    REG0,BUFSZ              SAVE BUFFER SIZE (IN+OUT)   VS0H 01701017
         L     REG2,IEHMVV30           GET FROM DCB ADDR           VS0H 01702017
         CLI   16(REG2),X'00'          KEYLEN=0                    VS0H 01704017
         BE    GETIT                   YES, GO GET CORE            VS0H 01706017
         SR    REG1,REG1                                           VS0H 01708017
         IC    REG1,16(REG2)           INSERT KEYLENGTH            VS0H 01710017
         AR    REG0,REG1               ADD INPUT KEYLEN TO BUFLEN  VS0H 01712017
         AR    REG0,REG1               ADD OUTPUT KEYLEN TO BUFLEN VS0H 01714017
         ST    REG0,BUFSZ              SAVE CALCULATED BUFLEN      VS0H 01716017
         LR    REG1,REG0               SET UP EVEN/ODD PAIR        VS0H 01718017
         SR    REG0,REG0               FOR DIVISION                VS0H 01720017
         LA    REG2,8                  LOAD CONSTANT OF 8          VS0H 01722017
         DR    REG0,REG2               DIVIDE BUFSZ BY 8           VS0H 01724017
         LTR   REG0,REG0               REMAINDER EQUAL ZERO        VS0H 01726017
         BNZ   FIXIT                   NO, GO MAKE SURE IT DOES    VS0H 01728017
GETIT    L     REG0,BUFSZ              YES,RELOAD AMT NEEDED     A27711 01738019
         GETMAIN R,LV=(0)                                        A27711 01748019
         ST    REG1,BUFLOC              SAVE LOCATION OF BUFFER         01760000
         ST    REG1,BLKBUF              LL  FOR BLOCKED RECORDS         01780000
         TM    IEHMVV30+4,X'01'                                         01800000
         BO    HASBUF                                                   01820000
WCHREAD  TM    SWTH1,X'11'        ARE BOTH INPUT AND OUTPUT BLOCKED     01840000
         BO    BLKINOUT             YES                                 01860000
         TM    SWTH1,X'01'        IS INPUT BLOCKED                      01880000
         BO    BLKIN                YES                                 01900000
         TM    SWTH1,X'10'        IS OUTPUT BLOCKED                     01920000
         BO    BLKOUT               YES                                 01940000
         EX    0,*                                                      01960000
FIXIT    LA    REG2,8                  LOAD CONSTANT OF 8          VS0H 01963017
         SR    REG2,REG0               FIND DIFF BETW 8 & REMAINDR VS0H 01966017
         A     REG2,BUFSZ              ADD DIFF TO BUFSZ TO MAKE   VS0H 01969017
         ST    REG2,BUFSZ              MULTIPLE OF 8, & GETMAIN    VS0H 01972017
         B     GETIT                   GO TO GET THE CORE          VS0H 01976017
         SPACE 3                                                        01980000
BLKIN    LA    REG7,4                  THE BLKIN ROUTINE HANDLES        02000000
         SR    REG6,REG6           DATA SETS THAT THE INPUT DATA SET    02020000
         L     REG8,BLKBUF         HAS BLOCKED RECORDS AND THE OUTPUT   02040000
         L     REG2,IEHMVV30       DATA SET HA UNBLOCKED VARIABLE       02060000
         L     REG1,IEHMVV30+4     RECORDS                              02080000
         LA    REG3,0(0,REG8)                                           02100000
         BAL   REG9,READ01                                              02120000
         CLI   IEHMVV74+4,X'FF'         I/O ERR IN U.L. EXIT RTN   UL0H 02126017
         BNE   BLKINA                  NOT ON - CONTINUE           UL0H 02129017
         BAL   REG5,IOERRMSG      WRITE I/O ERR MSG FOR U.L.     A36069 02132021
BLKINA   DS    0H                                                       02136017
         L     REG1,IEHMVV30+4                                          02140000
         BAL   REG9,CHECK01                                             02160000
         LH    REG7,0(0,REG3)      TOTAL AMOUNT IN CORE                 02180000
*                                      BLKIN2 WRITES BLOCKED RECORD OUT 02200000
BLKIN2   MVC   LL02(2),4(REG3)     ONE LOGICAL RECORD AT A TIME.        02220000
         LH    REG6,LL02           LENGTH OF LOGICAL RECORD             02240000
         LA    REG5,4(0,0)                                              02260000
         AH    REG5,LL02           LENGTH OF SINGLE BLOCK RECORD        02280000
         STH   REG5,LL01                                                02300000
         MVC   0(2,REG3),LL01                                           02320000
         L     REG2,IEHMVV31                                            02340000
         L     REG1,IEHMVV31+4                                          02360000
         BAL   REG9,WRIT01                                              02380000
         L     REG1,IEHMVV31+4                                          02400000
         BAL   REG9,CHECK01                                             02420000
         AR    REG3,REG6                                                02440000
         SR    REG7,REG6               ROUTINE LOOPS TO BLKIN2 UNTIL    02460000
         C     REG7,FOUR           BLOCKED RECORD IS COPIED AND THEN    02480000
         BH    BLKIN2              BRACHES TO BLKIN TO READ ANOTHER     02500000
         BE    BLKIN               RECORD                               02520000
         EX    0,*                                                      02540000
         SPACE 3                                                        02560000
CLEAR    LA    REG1,IEHMVV00   THIS ROUTINE CLEARS THE PRINT       7615 02580017
         MVI   0(1),X'40'          BUFFER TO BLANKS SO THE MESSAGE      02600000
         MVC   1(120,1),0(1)       MAY BE MOVED INTO THE BUFFER         02620000
         BR    REG4                                                     02640000
         SPACE 3                                                        02660000
BLKOUT   LA    REG7,4                   THE BLKOUT ROUTINE READS        02680000
         SR    REG6,REG6            UNBLOCKED LOGICAL RECORDS AND       02700000
         L     REG8,BLKBUF          BLOCKS THEM TO THE SIZE SPECIFIED   02720000
RDLOOP   L     REG2,IEHMVV30        BY BLOCKSIZE OF THE OUTPUT DCB      02740000
         L     REG1,IEHMVV30+4                                          02760000
         LA    REG3,0(REG6,REG8)        THE ROUTINE LOOPS IN RDLOOP     02780000
         BAL   REG9,READ01          UNTIL THE MAXIMUM NUMBER OF LOGICAL 02800000
         CLI   IEHMVV74+4,X'FF'         I/O ERR IN U.L. EXIT RTN   UL0H 02806017
         BNE   SHFTD1             NOT ON? CONTINUE               A36069 02808021
         BAL   REG5,IOERRMSG      WRITE I/O ERR MSG FOR U.L.     A36069 02812021
SHFTD1   L     REG1,IEHMVV30+4    REC'S THAT 'LL FIT  THE OUTP   A36069 02820021
         BAL   REG9,CHECK01         BLOCKSIZE HAVE BEEN READ AND THEN   02840000
SHFTD    MVC   LL02(2),4(REG3)      WRITES OUT A BLOCKED RECORD.        02860000
         MVC   LL01(4),0(REG3)                                          02880000
         MVC   0(4,REG3),SAVDTA                                         02900000
         LR    REG5,REG7                                                02920000
         AH    REG7,LL02                                                02940000
         AH    REG6,LL02                                                02960000
         CH    REG7,BSZOUT                                              02980000
         BH    SETRITE                                                  03000000
         BE    RITAMT                                                   03020000
         BAL   REG9,SAVEDATA                                            03040000
         B     RDLOOP                                                   03060000
         SPACE 3                                                        03080000
SAVEDATA LA    REG3,0(REG6,REG8)        SAVE THE LAST FOUR BYTES OF     03100000
         MVC   SAVDTA(4),0(REG3)    RECORD TO BE RESTORED AFTER NEXT    03120000
         BR    REG9                 READ                                03140000
         SPACE 3                                                        03160000
SETRITE  STH   REG5,0(0,REG8)           ADJUST THE LENGTH BLOCKS OF     03180000
         L     REG2,IEHMVV31        RECORD AND WRITE BLOCKED RECORD     03200000
         L     REG1,IEHMVV31+4                                          03220000
         LR    REG4,REG3            SAVE POINTER TO LOGICAL RECORD      03240000
         LR    REG3,REG8            NOT WRITTEN                         03260000
         BAL   REG9,WRIT01                                              03280000
         L     REG1,IEHMVV31+4                                          03300000
         BAL   REG9,CHECK01                                             03320000
         BAL   REG9,SHIFT                                               03340000
         LA    REG7,4                                                   03360000
         B     SHFTD                                                    03380000
         SPACE 3                                                        03400000
BLKINOUT DS    0H                                                  VS0H 03410017
         BAL   REG9,CHCKVBS            CHECK FOR VBS DATA SET      VS0H 03420017
         L     REG8,BLKBUF             THE BLKINOUT ROUTINE READS  VS0H 03430017
         SR    REG6,REG6            BLOCKED VARIABLE RECORDS AND        03440000
         LA    REG7,4               REBLOCKS THE RECORDS TO  COMFORM    03460000
INOUTLP  L     REG2,IEHMVV30        TO THE BLOCKSIZE OF THE OUTPUT      03480000
         L     REG1,IEHMVV30+4      DATA SET                            03500000
         LA    REG3,0(REG6,REG8)        THE ROUTINE READS RECORS UNTIL  03520000
         BAL   REG9,READ01          DATA IN CORE IS GREATER THAN THE    03540000
         CLI   IEHMVV74+4,X'FF'         I/O ERR IN U.L. EXIT RTN   UL0H 03546017
         BNE   INOUTLP1                NOT ON - BRANCH             UL0H 03549017
         BAL   REG5,IOERRMSG      WRITE I/O ERR MSG FOR U.L.     A36069 03552021
INOUTLP1 DS    0H                                                  UL0H 03556017
         L     REG1,IEHMVV30+4      OUTPUT BLOCKSIZE  ADJUST FOR        03560000
         BAL   REG9,CHECK01         MAXIMUM LENGTH TO BE WRITTEN WHICH  03580000
SHIFTED  MVC   LL01(4),0(REG3)      IS LESS THAN OUTPUT BLOCKSIZE       03600000
         MVC   LL02(2),4(REG3)                                          03620000
         MVC   0(4,REG3),SAVDTA       DATA THAT IS NOT WRITTEN OUT IN   03640000
         LR    REG5,REG7           RECORD IS SHIFTED TO THE START OF    03660000
         LH    REG6,LL01                                                03680000
         S     REG6,FOUR           IN BACK OF IT                        03700000
         AR    REG7,REG6                                                03720000
         LR    REG6,REG7               AMOUNT IN CORE                   03740000
         S     REG6,FOUR               DISPLACEMENT TO NEXT INPUT       03760000
         CH    REG7,BSZOUT                                              03780000
         BH    SETUPWRT                                                 03800000
         BE    AMTRITE                                                  03820000
         BAL   REG9,SAVEDATA                                            03840000
         B     INOUTLP                                                  03860000
CHCKVBS  L     REG2,IEHMVV30           GET FROM DCB ADDRESS        VS0H 03861017
         TM    36(REG2),X'58'          RECFM=VBS                   VS0H 03862017
         BC    14,0(REG9)              NO, RETURN TO BLKINOUT      VS0H 03863017
         MVC   EODAD(3,REG2),VBSEOD+1  MOVE IN VRE EODAD RTN ADDR  VS0H 03864017
READMORE L     REG3,BLKBUF             YES, LOAD BUFFER ADDRESS    VS0H 03865017
         L     REG2,IEHMVV30           GET FROM DCB ADDRESS        VS0H 03866017
         L     REG1,IEHMVV30+4         GET FROM DECB ADDRESS       VS0H 03867017
         BAL   REG9,READ01             BALR TO READ A BLOCK        VS0H 03868017
         CLI   IEHMVV74+4,X'FF'         I/O ERR IN U.L. EXIT RTN   UL0H 03868317
         BNE   READMOR1                NOT ON - CONTINUE           UL0H 03868417
         BAL   REG5,IOERRMSG      WRITE I/O ERR MSG FOR U.L.     A36069 03868621
READMOR1 DS    0H                                                  UL0H 03868817
         L     REG1,IEHMVV30+4         GET FROM DECB ADDRESS       VS0H 03869017
         BAL   REG9,CHECK01            GO CHECK THE READ           VS0H 03870017
WRITEVBS L     REG3,BLKBUF             LOAD BUFFER ADDRESS         VS0H 03871017
         L     REG2,IEHMVV31           LOAD TO DCB ADDRESS         VS0H 03872017
         L     REG1,IEHMVV31+4         LOAD TO DECB ADDRESS        VS0H 03873017
         BAL   REG9,WRIT01             BALR TO WRITE A RECORD      VS0H 03874017
         L     REG1,IEHMVV31+4         LOAD TO DECB ADDRESS        VS0H 03875017
         BAL   REG9,CHECK01            GO CHECK THE WRITE          VS0H 03876017
         B     READMORE                GO READ SOME MORE           VS0H 03877017
         SPACE 3                                                        03880000
SETUPWRT AH    REG5,LL02                                                03900000
         CH    REG5,BSZOUT                                              03920000
         BH    SETUP01                                                  03940000
         AH    REG3,LL02                                                03960000
         SH    REG6,LL02                                                03980000
         MVC   LL02(2),4(REG3)                                          04000000
         B     SETUPWRT                                                 04020000
SETUP01  SH    REG5,LL02                                                04040000
         LR    REG4,REG3                                                04060000
         LR    REG3,REG8                                                04080000
         STH   REG5,0(0,REG3)                                           04100000
         L     REG2,IEHMVV31                                            04120000
         L     REG1,IEHMVV31+4                                          04140000
         BAL   REG9,WRIT01                                              04160000
         L     REG1,IEHMVV31+4                                          04180000
         BAL   REG9,CHECK01                                             04200000
         BAL   REG9,SHIFT                                               04220000
         LA    REG7,4                                                   04240000
         B     SHIFTED                                                  04260000
         SPACE 3                                                        04280000
SHIFT    SR    REG7,REG5                THE SHIFT ROUTINE SHIFT DATA    04300000
         A     REG7,FOUR            LOCATION OF BUFFER SO THAT THE      04320000
         STH   REG7,LL01                                                04340000
         MVC   0(4,REG4),LL01       NOT WRITTEN OVER TO THE START       04360000
         LR    REG6,REG7            LOGICAL RECORD WILL BE THE FIRST    04380000
SHFT01   LA    REG5,256             RECORD OF THE NEXT BLOCKED RECORD   04400000
         CR    REG5,REG6            WRITTEN                             04420000
         BNH   SHFT02                                                   04440000
         LR    REG5,REG6                                                04460000
SHFT02   BCTR  REG5,0                                                   04480000
         EX    REG5,MOVEDATA                                            04500000
         LA    REG5,1(0,REG5)                                           04520000
         AR    REG3,REG5                                                04540000
         AR    REG4,REG5                                                04560000
         SR    REG6,REG5                                                04580000
         BP    SHFT01                                                   04600000
         SR    REG6,REG6                                                04620000
         LR    REG3,REG8                                                04640000
         LA    REG5,4                                                   04660000
         BR    REG9                                                     04680000
MOVEDATA MVC   0(1,REG3),0(REG4)                                        04700000
         SPACE 3                                                        04720000
AMTRITE  LR    REG3,REG8                SET UP POINTERS FOR WRITE       04740000
         STH   REG7,0(0,REG3)       WHEN AMOUNT IN CORE IS EQUAL TO     04760000
         L     REG2,IEHMVV31        OUTPUT BLOCKSIZE                    04780000
         L     REG1,IEHMVV31+4                                          04800000
         BAL   REG9,WRIT01                                              04820000
         L     REG1,IEHMVV31+4                                          04840000
         BAL   REG9,CHECK01                                             04860000
         B     BLKINOUT                                                 04880000
RITAMT   LR    REG3,REG8                SET UP POINTERS FOR WRITE       04900000
         STH   REG7,0(0,REG3)      WHEN AMOUNT IN CORE IS EQUAL TO      04920000
         L     REG2,IEHMVV31       OUTPUT BLOCKSIZE                     04940000
         L     REG1,IEHMVV31+4                                          04960000
         BAL   REG9,WRIT01                                              04980000
         L     REG1,IEHMVV61+4                                          05000000
         BAL   REG9,CHECK01                                             05020000
         B     BLKOUT                                                   05040000
HASBUF   L     REG8,BLKBUF                                              05060000
         L     REG2,IEHMVV30+4                                          05080000
         L     REG3,12(0,REG2)                                          05100000
         ST    REG3,NBLKFB             SAVE ADDR OF PASSED BUFF         05120000
         LA    REG5,4                  SET UP REGISTERS FOR SHIFT ROUTI 05140000
         L     REG4,NBLKFB             TO MOVE FIRST RECORD INTO MY     05160000
         L     REG3,BLKBUF             BUFFER                           05180000
         LH    REG7,0(0,REG4)                                           05200000
         BAL   REG9,SHIFT                                               05220000
         LA    REG7,4                                                   05240000
         TM    SWTH1,X'11'                                              05260000
         BO    SHIFTED                                                  05280000
         TM    SWTH1,X'10'                                              05300000
         BO    SHFTD                                                    05320000
         LH    REG7,0(0,REG3)                                           05340000
         B     BLKIN2                                                   05360000
         SPACE 3                                                        05380000
EODRTN   C     REG7,FOUR                END OF DATA ROUTINE  CHECKS     05400000
         BE    WCHEND               TO SEE IF ALL DATA IN CORE HAS      05420000
         LR    REG3,REG8            BEEN WRITEN OUT IF NOT WRITES THE   05440000
         STH   REG7,0(0,REG3)       LAST RECORD OUT                     05460000
         L     REG2,IEHMVV31                                            05480000
         L     REG1,IEHMVV31+4                                          05500000
         BAL   REG9,WRIT01                                              05520000
         L     REG1,IEHMVV31+4                                          05540000
         BAL   REG9,CHECK01                                             05560000
WCHEND   L     REG2,IEHMVV30            TEST FOR TYPE OF DATA SET BEING 05580000
         TM    DSORG(REG2),X'40'    MOVED  IF DSORG IS BPAM  FREES MAIN 05600000
         BO    BSAMEND              AND STOWS THE MEMBER JUST MOVED     05620000
STOWER   L     REG0,BUFSZ                                               05640000
         L     REG1,BUFLOC              IF DSORG IS BSAM GO TO FREEMAIN 05660000
         FREEMAIN  R,LV=(0),A=(1)   AND END OF JOB                      05680000
STOWALS  LA    REG0,DIRNM                                        A48797 05700022
         L     REG1,IEHMVV31                                            05720000
         LA    1,0(0,1)                                                 05740000
         MVC   DIRNM(8),RENAM                                           05760000
         STOW  (1),(0),A                                                05780000
         MVC   TTRSAV(4),TTRC                                           05800000
         B     BACK01(15)                                               05820000
BACK01   B     STWMSG                   RETURNS FROM STOW               05840000
         B     DUPLC                                                    05860000
         EX    0,*                                                      05880000
         B     DIRFUL                                                   05900000
         B     STOERR                                                   05920000
******************************************************************21919 05921021
*                                                                *21919 05922021
*   NEXT RETURN CODES ALSO GIVE THE MESSAGE:                     *21919 05923021
*         IEH326I I/O ERROR ENCOUNTERED IN OUTPUT DATA SET       *21919 05924021
*   BUT THESE RETURN CODES ARE CAUSED BY OTHER ERRORS            *21919 05925021
*                                                                *21919 05926021
******************************************************************21919 05927021
         B     STOERR        INDICATES I/O REQUESTS AGAINST THE   21919 05928021
*                            DCB ARE STILL OUTSTANDING            21919 05929021
         B     STOERR        INDICATES THE DCB IS NOT OPEN        21919 05930021
         B     STOERR        INDICATES CONDITIONAL GETMAIN WITHIN 21919 05931021
*                            STOW WAS UNSUCCESSFUL                21919 05932021
         SPACE 3                                                        05940000
GIVBUF   LH    REG0,BSZIN                                               05960000
         L     REG1,NBLKFB                                              05980000
         FREEMAIN  R,LV=(0),A=(1)                                       06000000
         SR     REG1,REG1                                               06020000
         STC    REG1,IEHMVV30+4                                         06040000
BSAMEND  TM    IEHMVV30+4,X'01'        WAS BUFFER PASSED TO ME          06060000
         BO     GIVBUF                 YES IT WAS  GIVE IT BACK         06080000
         L      REG0,BUFSZ          FREEMAIN  AT END OF JOB             06100000
         L     REG1,BUFLOC                                              06120000
         FREEMAIN  R,LV=(0),A=(1)                                       06140000
ALDONE   LA    REG0,144                                                 06160000
         LR    REG1,BAS11                                               06180000
         FREEMAIN  R,LV=(0),A=(1)                                       06200000
         IEHPOST  (14,1),T                                              06220000
         SPACE 3                                                        06240000
         TM    IEHMVV20+2,X'40'                                         06260000
         BO    WRAPUP                                                   06280000
         TM    IEHMVV20+2,X'08'                                         06300000
         BO    INCLUDE                                                  06320000
WRAPUP   XCTL  (2,12),EP=IEHMVESN       TRANSFER CONTROL TO WRAPUP      06340000
*                                    MODULE                             06360000
INCLUDE  TM    IEHMVV20,X'10'          DSGROUP OPERATION           VS0H 06370017
         BC    1,WRAPUP                YES, TO VESN FOR WRAPUP     VS0H 06380017
         XCTL  (2,12),EP=IEHMVETG      NO, XFER CTL TO INCLUDE RTN VS0H 06390017
*                                    REPLACE MODULE                     06400000
         SPACE 3                                                        06420000
SINADR   ST    REG1,ERRSAV         I/O ERROR EXIT FROM CHECK            06440000
         TM    ERRSAV,X'80'        TEST FOR ERROR DURING READ           06460000
         BO    READERR                                                  06480000
         TM    ERRSAV,X'40'        TEST FOR ERROR DURING WRITE          06500000
         BO    WRTERR                                                   06520000
         TM    ERRSAV,X'20'        OTHER ERROR                          06540000
         BO    FMABORT                                                  06560000
         EX    0,*                                                      06580000
         SPACE 3                                                        06600000
FMABORT  OI    IEHMVV20+2,X'40'    SET ABORT BIT AND FREE MAIN          06620000
         B     BSAMEND                                                  06640000
ABORT    OI    IEHMVV20+2,X'40'    SET ABORT BIT AND GO TO WRAPUP       06660000
         B     ALDONE                                                   06680000
         SPACE 3                                                        06700000
MESSAGE  BAL   REG4,CLEAR                MESSAGE ROUTINE MOVES          06720000
         LA    REG1,IEHMVV00     SPECIFIED MESSAGE AND MOVES IT    7615 06740017
         EX    2,MOVMSG             TO BUFFER  INSERT MEMBER NAME       06760000
         MVC   NAME2(8),DIRNM       AND/OR DATA SET NAME INTO           06780000
         B     MESSAG02             MESSAGE AND LINK TO MESSAGE         06800000
MESSAG01 BAL   REG4,CLEAR           WRITER MODULE                       06820000
         EX    2,MOVMSG                                                 06840000
         MVC   NAME3(8),DIRNM                                           06860000
         MVC   DNAM3(44),0(5)                                           06880000
         B     MESSAG02                                                 06900000
MESSAG03 BAL   REG4,CLEAR                                               06920000
         EX    2,MOVMSG                                                 06940000
         MVC   DNAM2(44),0(5)                                           06960000
MESSAG02 LR    REG3,REG1                                                06980000
         LINK   EP=IEHMVESU           GO TO MESSAGE WRITER              07000000
         LTR   15,15                                                    07020000
         BP    ABORT                                                    07040000
         BR    REG9                                                     07060000
MOVMSG   MVC   MSGE(1),0(REG3)                                          07080000
         SPACE 3                                                        07100000
ALSCHK   TM    C,X'80'                  TEST FOR ALIAS BIT ON           07120000
         BO    STALSR              ON  STOW THE ALIAS MEMBER NAME       07140000
         L     REG0,TTRC                                                07160000
         IC    REG0,FOUR                                                07180000
         ST    REG0,PTR                                                 07200000
         LA    REG0,PTR                                                 07220000
         L     REG1,IEHMVV30                                            07240000
         POINT (1),(0)                                                  07260000
         B     NEWMBR              GO  TO SET UP FOR WRITE MEMBER       07280000
         SPACE 3                                                        07300000
STALSR   TM    SWTH,X'01'          TEST STOWBIT IF ON TRUE MEMBER WAS   07320000
         BO    NOSTALR                                                  07340000
         MVC   TTRC(3),TTRSAV      ADJUST TTRC OF ALIAS TO CORRECT      07360000
         B     STOWALS           TTRC                            A48797 07380022
         SPACE 3                                                        07400000
DUPLC    TM    C,X'80'                                                  07420000
         BO    DUPALS                                                   07440000
         OI    SWTH,X'01'                                               07460000
         MVC   RECOVER(3),TTRC                                          07480000
DUPALS   L     REG3,A119                                                07500000
         IC    REG2,A119                                                07520000
         BAL   REG9,MESSAGE                                             07540000
         B     GTMBR                                                    07560000
         SPACE 3                                                        07580000
READERR  L     REG3,A122                PRINT I/O ERROR ON READ         07600000
         IC    REG2,A122              MESSAGE                           07620000
         L     REG5,IEHMVV21                                            07640000
         BAL   REG9,MESSAG01                                            07660000
         B     FMABORT                                                  07680000
         SPACE 3                                                        07700000
WRTERR   L     REG3,A123                PRINT I/O ERROR ON WRITE        07720000
         IC    REG2,A123              MESSAGE                           07740000
         L     REG5,IEHMVV21+4                                          07760000
         BAL   REG9,MESSAG01                                            07780000
         B     FMABORT                                                  07800000
         SPACE 3                                                        07820000
STWMSG   L     REG3,A118                PRINT MESSAGE THAT MEMBER       07840000
         IC    REG2,A118             HAS BEEN MOVED                     07860000
         BAL    REG9,MESSAGE                                            07880000
         B     GTMBR                                                    07900000
         SPACE 3                                                        07920000
DIRFUL   L     REG3,A121                PRINT MESSAGE THAT DIRECTORY    07940000
         IC    REG2,A121             IS  FULL                           07960000
         BAL   REG9,MESSAGE                                             07980000
         B     ABORT                                                    08000000
         SPACE 3                                                        08020000
STOERR   L     REG3,A124                PRINT MESSAGE THAT I/O ERROR    08040000
         IC    REG2,A124             OCCURED  DURING STOW               08060000
         L     REG5,IEHMVV21+4                                          08080000
         BAL   REG9,MESSAG03                                            08100000
         B     ABORT                                                    08120000
         SPACE 3                                                        08140000
NOSTALR  L     REG3,A125                PRINT MESSAGE THAT ALIAS CANNOT 08160000
         IC    REG2,A125            BE  STOWED                          08180000
         BAL   REG9,MESSAGE                                             08200000
         B     GTMBR                                                    08220000
         SPACE 3                                                        08240000
WRIT01   LA    2,0(0,2)                 WRITE A RECORD                  08260000
         LA    1,0(0,1)                                                 08280000
         TM    SWTH,X'01'                                               08300000
         BO    RECOVR                                                   08320000
WRIT02   WRITE (1),SF,(2),(3),MF=E                                      08340000
         BR    REG9                                                     08360000
         SPACE 3                                                        08380000
READ01   LA    2,0(0,2)                 READ A RECORD                   08400000
         LA    1,0(0,1)                                                 08420000
         READ  (1),SF,(2),(3),MF=E                                      08440000
         BR    REG9                                                     08460000
         SPACE 3                                                        08480000
CHECK01  LA    1,0(0,1)                                                 08500000
         CHECK (1)                                                      08520000
         BR    REG9                                                     08540000
         SPACE 3                                                        08560000
RECOVR   NI    SWTH,X'00'               RESET STOWBIT                   08580000
         MVC   PTR(3),RECOVER                                           08600000
         LA    REG0,PTR                                                 08620000
         L     REG1,IEHMVV31                                            08640000
         LA    1,0(0,1)                                                 08660000
         POINT (1),(0)                                                  08680000
         L     REG1,IEHMVV31+4                                   A52025 08690022
         B     WRIT02                                                   08700000
         SPACE 3                                                        08720000
         DS    0F                                                       08740000
A118     DC    AL1(B-A-1)                                               08760000
         DC    AL3(A)                                                   08780000
A119     DC     AL1(C1-B-1)                                             08800000
         DC    AL3(B)                                                   08820000
A120     DC     AL1(D-C1-1)                                             08840000
         DC     AL3(C1)                                                 08860000
A121     DC    AL1(E-D-1)                                               08880000
         DC    AL3(D)                                                   08900000
A122     DC    AL1(F-E-1)                                               08920000
         DC    AL3(E)                                                   08940000
A123     DC    AL1(G-F-1)                                               08960000
         DC    AL3(F)                                                   08980000
A124     DC    AL1(H-G-1)                                               09000000
         DC    AL3(G)                                                   09020000
A125     DC    AL1(I-H-1)                                          UL0H 09030017
         DC    AL3(H)                                                   09046017
A126     DC    AL1(J-I-1)                                          UL0H 09052017
         DC    AL3(I)                                              UL0H 09058017
FOUR     DC    F'4'                                                     09064017
BPMEOD   DC    A(EODRTN)                                           UL0H 09070017
VBSEOD   DC    A(WCHEND)               EODAD ENTRY FOR VRE DCB     VS0H 09073017
BSMSYN   DC    A(SINADR)                                           UL0H 09076017
XXITLE   DC    X'03'                                               UL0H 09082017
         DC    AL3(ITLR)                                           UL0H 09088017
*                                                                  UL0H 09094017
*      USER     INPUT     TRAILER     LABEL     ROUTINE            UL0H 09100017
*                                                                  UL0H 09106017
ITLR     DS    0H                                                  UL0H 09112017
         LA    REG4,OFFSET1                                        UL0H 09118017
         SR    LINK,REG4                                           UL0H 09124017
         LR    BAS10,LINK                                          UL0H 09130017
         L     REG4,0(0,REG1)           GET ADDR OF LABEL READ     UL0H 09130617
*                            FOR LATER MOVE TO USER                UL0H 09131217
         LTR   REG4,REG4                ARE USER LABELS PRESENT    UL0H 09131817
         BNE   IOERR                    YES. CHECK IF OK           UL0H 09132417
NOLABEL  DS    0H                                                  UL0H 09133017
         SR    LINK,LINK                NO, RETURN CODE 0 TO EOV   UL0H 09133617
*                                         TO IGNORE ADDITIONAL LAB UL0H 09134217
         BR    RETN                     RETURN TO EOV              UL0H 09134817
*                                                                  UL0H 09135417
IOERR    DS    0H                                                  UL0H 09136017
         CLI   8(REG1),X'80'            PERM ERROR FROM PARAM LIST UL0H 09136617
         BNE   TRKAVAIL                 NO. CHECK FOR TRACK AVAIL  UL0H 09137217
*                                                                  UL0H 09137817
LABERR   DS    0H                                                  UL0H 09138417
         OI    IEHMVV74+4,X'FF'         YES, SET FLAG TO OUTPUT MSGUL0H 09140417
         BR    RETN                     RETURN TO EOV OPERATION    UL0H 09142617
TRKAVAIL DS    0H                                                  UL0H 09143217
         CLI   IEHMVV72+10,X'FF'        DA+NLT FLAG ON             UL0H 09143817
*                                 INDICATES NO U.L. TRK ALLOCATED  UL0H 09144817
         BNE   CORAVAIL                 NO PROCESS LABELS          UL0H 09145117
*                                                                  UL0H 09145417
*  OUTPUT MESSAGE - NO USER LABELS MOVE/COPIED.  NO LABEL TRACK.   UL0H 09145717
*                                                                  UL0H 09146017
         MVI   IEHMVV72+14,X'FF'        TELL CLOSE TO OUTPUT MSG   UL0H 09146317
         MVI   UDCBITLE,X'00'           DEACTIVATE LABEL EXIT      UL0H 09146617
         MVI   UDCBOTLE,X'00'           DEACTIVATE LABEL EXIT      UL0H 09146917
         B     NOLABEL                 GO SET RC=0,GO TO CLOSE     UL0H 09147217
*                                                                  UL0H 09147517
CORAVAIL DS    0H                                                  UL0H 09147817
         CLC   IEHMVV72(4),ALLZEROS     CORE OBTAINED FOR LABELS   UL0H 09148117
         BNE   INITIAL                  YES, INITIALIZE POINTERS   UL0H 09148417
         GETMAIN R,LV=640              GET CORE FOR LABELS         UL0H 09148717
         ST    REG1,IEHMVV72           SAVE POINTER TO GOTTEN CORE UL0H 09149017
INITIAL  DS    0H                                                  UL0H 09149317
         CLC   0(4,REG4),UTL1DEF        IS THIS 1ST LABEL IN SET   UL0H 09149617
         BNE   SAVLABEL                NO, BYPASS 1ST LABEL SETUP  UL0H 09149917
         MVC   IEHMVV72+4(4),IEHMVV72   SET POINTER TO LABEL SAVLOCUL0H 09150217
         MVI   IEHMVV72+12,X'00'        CLEAR LABEL COUNTER        UL0H 09150517
*                                                                  UL0H 09150817
SAVLABEL DS    0H                                                  UL0H 09151117
         L     REG1,IEHMVV72+4          GET ADDRESS OF CURRENT     UL0H 09151417
*                                         LABEL SAVEAREA           UL0H 09151717
         MVC   0(80,REG1),0(REG4)       SAVE LABEL IN GOTTEN CORE  UL0H 09152017
         LA    REG1,80(0,REG1)          UPDATE POINTER TO NEXT LO- UL0H 09152317
         ST    REG1,IEHMVV72+4            CATION IN LABEL SAVEAREA UL0H 09152617
         SR    REG4,REG4                 UPDATE                    UL0H 09152917
         IC    REG4,IEHMVV72+12           LABEL                    UL0H 09153217
         LA    REG4,1(REG4)                COUNTER                 UL0H 09153517
         STC   REG4,IEHMVV72+12             BY ONE                 UL0H 09153817
         LA    LINK,4                   RETURN CONDITION CODE 4 TO UL0H 09154117
*                                         EOV                      UL0H 09154417
*                                         TO GET ADDITIONAL LABELS UL0H 09154717
         BR    RETN                     RETURN TO EOV              UL0H 09155017
*                                                                  UL0H 09155317
ALLZEROS DC    1F'0'                                               UL0H 09155617
UTL1DEF  DC    CL4'UTL1'                                           UL0H 09155917
DEACTIVE EQU   X'00'                                               UL0H 09156217
*                                                                  UL0H 09156517
OFFSET1  EQU   ITLR-IEHMVESM                                       UL0H 09163517
IOERRMSG DS    0H                                                  UL0H 09164217
         MVI   IEHMVV74+4,X'00'   CLEAR I/O ERROR FLAG           A36069 09164921
         L     REG3,A126                                           UL0H 09165617
         IC    REG2,A126                PROVIDE MSG LENGTH FOR MOVEUL0H 09166317
         BAL   REG4,CLEAR               CLEAR PRINT BUFFER        EUL0H 09167017
         LA    REG1,IEHMVV00      PRINT BUF ADDR FOR MSG MOVE    A36069 09167721
         EX    2,MOVMSG                 MOVE MSG TO PRINT BUF      UL0H 09168417
         BAL   REG9,MESSAG02            PRINT MSG                  UL0H 09169117
         BR    REG5               RETURN TO INLINE PROCESSING    A36069 09169821
WORK     DSECT                                                          09170517
PTR      DS    F                   POINTER TO MEMBER FOR POINT          09180000
TTSAV    DS    F                   SAVE TTRC FOR POSSIBLE ALIAS         09200000
SWTH     DS    CL1                 SWITCHES FOR CONTROL                 09220000
SWTH1    DS    CL1                                                      09240000
SWTH2    DS    CL1                                                      09260000
CCHHR    DS    CL5                 START OF DIRENTRY ENTRY              09280000
DIRNM    DS    2F                                                       09300000
TTRC     DS    CL3                                                      09320000
C        DS    CL1                                                      09340000
USRDT    DS    CL62                START OF USER DATA IN DIRECTORY      09360000
RENAM    DS    CL8                 MEMBER NAME TO BE STOWED WITH        09380000
         DS    CL2                                                      09400000
SAVDTA   DS    F                   SAVE AREA FOR DATA WHEN BLOCKING REC 09420000
BLKBUF   DS    F                   LL   FOR BLOCKED RECORDS             09440000
NBLKFB   DS    F                   START OF BUFFER FOR UNBLOCKED RECORD 09460000
BUFSZ    DS    F                   AMOUNT OF CORE REQUIRED FOR BUF      09480000
BUFLOC   DS    F                   LOCATION OF BUFFER                   09500000
BSZIN    DS    H                                                        09520000
BSZOUT   DS    H                                                        09540000
LL01     DS    F                                                        09560000
LL02     DS    F                                                        09580000
TTRSAV   DS    F                                                        09600000
RECOVER  DS    F                                                        09620000
ERRSAV   DS    F                                                        09640000
         SPACE 3                                                        09660000
PRINT    DSECT                                                          09680000
CC       DS    CL1                                                      09700000
MSGE     DS    CL15                                                     09720000
NAME2    DS    CL17                                                     09740000
NAME3    DS    CL17                                                     09760000
DNAM2    DS    CL11                                                     09780000
DNAM3    DS    CL60                                                     09800000
         SPACE 3                                                        09820000
         IEHMVV                                                         09840000
         ORG   IEHMVV70                                            UL0H 09846017
         IEHDCBXL                                                  UL0H 09852017
         SPACE 3                                                        09860000
MESSAGER CSECT                                                          09880000
A        DC    CL24'  MEMBER NAMED          '                           09900000
         DC    CL22'HAS BEEN MOVED/COPIED.'                             09920000
B        DC    CL30'IEH319I MEMBER          NOT MO'                     09940020
         DC    CL30'VED/COPIED. DUPLICAT NAME IN '                      09960000
         DC    CL16'OUTPUT DATA SET.'                                   09980000
C1       DC     X'00'                                                   10000000
D        DC    CL30'IEH321I MEMBER          NOT MO'                     10020000
         DC    CL30'VED/COPIED. OUTPUT DIRECTORY I'                     10040000
         DC    CL7'S FULL.'                                             10060000
E        DC    CL30'I/O ERROR ENCOUNTERED IN MEMBE'                     10080000
         DC    CL29'R          OF INPUT DATA SET '                      10100000
F        DC    CL30'I/O ERROR ENCOUNTERED IN MEMBE'                     10120000
         DC    CL29'R          OF OUTPUT DATASET '                      10140000
G        DC    CL30'IEH326I I/O ERROR ENCOUNTERED '                     10160000
         DC    CL20' IN OUTPUT DATA SET '                               10180000
H        DC    CL24'  MEMBER NAMED          '                           10200000
         DC    CL32'IS AN ALIAS AND HAS NOT BEEN STO'                   10220000
         DC    CL32'WED, TRUE MEMBER WAS NOT STOWED.'                   10240000
I        DC    CL29'PERM I/O ERROR WHILE READING '                 UL0H 10245017
         DC    CL30'USER INPUT TRAILER LABELS. NO '                UL0H 10250017
         DC    CL30'MORE LABELS WILL BE PROCESSED.'                UL0H 10255017
J        DC    X'00'                                                    10260000
         END                                                            10280000
./  ADD  SSI=70260466,NAME=IEHMVESN
 TITLE 'IEHMVSSN-WRAPUP,CLOSE OF FROM,TO DSETS--IEHMOVE LOAD MOD VESN'  00010017
*TITLE--IEHMVSSN-WRAPUP,CLOSE OF FROM,TO DSETS--IEHMOVE LOAD MOD VESN   00020017
*FUNCTION/OPERATION: TO COMPLETE THE JOB OF MOVING OR COPYING A DATA  * 00040000
*SET, IEHMVSSN FIRST CLOSES THE 'FROM' AND 'TO' DATA SETS AND THEN    * 00060000
*PASSES CONTROL TO ANOTHER WRAP UP ROUTINE DEPENDING UPON THE TYPE OF * 00080000
*OPERATION PERFORMED AND UPON THE RESULTS OF THAT OPERATION           * 00100000
*ENTRY POINTS: IEHMVESN                                               * 00120000
*INPUT: NONE                                                          * 00140000
*OUTPUT: NONE                                                         * 00160000
*EXTERNAL ROUTINES: IEHMVSSU                                          * 00180000
*EXITS - NORMAL  IEHMVESP, IEHMVESQ,                                  * 00200002
*        ERRORS: IEHMVESO, IEHMVSSK                                   * 00220000
*TABLES/WORK AREAS: IEHMVV00                                          * 00240000
*ATTRIBUTES: REENTRANT                                                * 00260000
*********************************************************************   00280000
**                                                                      00300000
**                            IEHMVSSN                                  00320000
**                                                                      00340000
*********************************************************************   00360000
*                                                                       00380000
IEHMVSSN CSECT                                                     8650 00392013
*A008366-008382                                                @ZA01745 00392203
*D008366-008381                                                @ZA01745 00392403
*A009050-009260                                                 YA01457 00392602
*D009050-009300                                                 YA01457 00393202
*A032140,083800                                                  S21042 00394021
*A008900,014200,014800,D015000-015200,A015950,D016000            A43752 00398021
*A021400,D021500-021600,A030280,030520,032000,D032200-038600     A43752 00398421
*C038800,A083310                                                 A43752 00398821
*A009300,D009350                                                 A41754 00399221
*C034500,034560                                                  A38758 00399321
*A044600                                                          19030 00399621
*D034100-034300,034700,035100                                    A26597 00399721
*A023500                                                        YL026VC 00399802
*C030300                                                        YL026VC 00399902
*C2000,41600                                                     Y02918 00400102
*D41800-42000,42800,47800-50000                                  Y02918 00400302
*A025100-025200,028000-029004,030040-030060                    @Z40CSJH 00400704
*A041300-041320,047800-047900,026600-026980,028000-029004      @Z40CSJH 00400804
*A083370                                                       @Z40CSJH 00400904
A0       EQU   0                                                        00401002
A1       EQU   1                                                        00420000
A2       EQU   2                                                        00440000
A3       EQU   3                                                        00460000
A4       EQU   4                                                        00480000
A5       EQU   5                                                        00500000
A6       EQU   6                                                        00520000
A7       EQU   7                                                        00540000
A8       EQU   8                                                        00560000
A9       EQU   9                                                        00580000
A10      EQU   10                                                       00600000
A11      EQU   11                                                       00620000
A12      EQU   12                                                       00640000
A13      EQU   13                                                       00660000
A14      EQU   14                                                       00680000
A15      EQU   15                                                       00700000
IEHMVESN SAVE  (2,12),T,ESN-WRAP-UP---                                  00720000
         ENTRY IEHMVESN                                                 00740000
         EXTRN IEHMVMSN                                                 00760000
         LR    A9,A15                  SET BASE REGISTER                00780000
         USING IEHMVESN,A9                                              00800000
         USING  IEHMVV,A12                                              00820021
         IEHPRE ,TFC                                                    00820421
* THIS RTN FINDS AND SAVES THE VOL SER NBR AND FILE SEQ NBR      A43752 00820821
* FOR THE TO-VOLUMELIST ROUTINE.                                 A43752 00821221
* FOR OPEN TO-DATA SETS THE UCB ADDRESS IS FOUND IN THE          A43752 00821621
* LAST EXTENTDESCRIPTION OF THE DEB                              A43752 00822021
* FOR CLOSED DATASETS OR DATASETS WITHOUT A DCB THE UCB ADDRESS  A43752 00822421
* IS FOUND IN THE TIOT                                           A43752 00822821
* ALWAYS THE VOL SER NBR IS STORED IN THE COMMUNICATIONS AREA    A43752 00823221
* AT IEHMVV82+26                                                 A43752 00823621
* IN SOME CASES THE VOL SER NBR HAS BEEN SAVED IN IEHMVV82+26    A43752 00824021
* EARLIER ( I.E. BY MODULES IEHMVSTA OR IEHMVETG )               A43752 00824421
         CLI   IEHMVV72+11,X'FF'       UL TRACK MISSING(SSX)     A43752 00824821
         BE    TIOTUCB                 YES GET UCB ADDR VIA TIOT A43752 00825221
         TM    IEHMVV20+4,X'08'        MODEL DSCB                A43752 00825621
         BO    TIOTUCB                                           A43752 00826021
         L     A2,IEHMVV31             GET TO DCB ADDR           A43752 00826421
         TM    48(A2),X'10'            IS THE DCB OPEN           A43752 00826821
         BO    DEBUCB                  YES GET UCB ADDR VIA DEB  A43752 00827221
         TM    IEHMVV82+24,X'80'       VOL FROM STA OR ETG       A43752 00827621
         BO    CONTINUE                YES VOL SER ALREADY FOUND A43752 00828021
TIOTUCB  DS    0H                      NO GET UCB VIA TIOT       A43752 00828421
         L     A4,IEHMVV31+8           DDNAME IN TIOT            A43752 00828821
         LA    A4,12(A4)               UCB ADDR IN TIOT          A43752 00829221
         B     SAVEUCB                 SAVE UCB ADDRESS          A43752 00829621
DEBUCB   DS    0H                                                A43752 00830021
         L     A4,44(A2)               DEB ADDR                  A43752 00830421
         SR    A2,A2                   CLEAR FOR INSERT          A43752 00830621
         IC    A2,16(A4)               NBR OF EXTENTS            A43752 00830821
         TM    28(A4),X'04'            DA DEVICE                 A43752 00831221
         BO    OFFS16                  YES FIND LAST EXTENT      A43752 00831621
         LA    A4,28(A4)               SCAN THE EXTENTS   T      A43752 00832021
NEXTEXT1 LA    A4,4(A4)                JUMP TO NEXT EXTENT       A43752 00832421
         BCT   A2,NEXTEXT1             SCAN FURTHER              A43752 00832821
         B     SAVEUCB                 STORE UCB ADDR            A43752 00833221
OFFS16   DS    0H                                                A43752 00833621
         LA    A4,16(A4)               JUMP TO NEXT EXTENT       A43752 00834021
NEXTEXT2 LA    A4,16(A4)               JUMP                      A43752 00834421
         BCT   A2,NEXTEXT2             SCAN FURTHER              A43752 00834821
SAVEUCB  L     A4,0(A4)                GET UCB ADDR              A43752 00835221
         LR    A3,A4                   BASE THE UCB              A43752 00835621
         USING IEFUCBOB,A3             WITH REG 3                A43752 00836121
         L     A4,IEHMVV23+4           ADDRESS OF ACTIVE       @ZA01745 00836603
*                                      TO VOLUME               @ZA01745 00837003
         MVC   IEHMVV82+26(6),4(A4)    SAVE VOL SER NBR        @ZA01745 00837403
         CLI   3(A4),X'05'             2321 DEVICE             @ZA01745 00837803
         BE    CONTINUE                YES                     @ZA01745 00838203
STOREVOL MVC   IEHMVV82+26(6),SRTEVOLI                           A43752 00838621
         MVC   IEHMVV82+24(2),SRTEFSEQ SAVE LOGICAL FILE SEQ NBR A43752 00839121
CONTINUE NI    IEHMVV82+24,X'7F'       CLEAR THE SWITCH          A43752 00839621
         TM    IEHMVV20+2,MIDABRT  TEST FOR MID ABORT BIT ON     PTM504 00840317
         BZ    *+14                 IF NOT, BYPASS NEXT 2 INSTR  PTM504 00840617
         MVI   UDCBIHLE,DEACTIVE    IF SO, DEACTIVATE ALL USER   PTM504 00840917
         MVC   UDCBIHLE+1(15),UDCBIHLE  LABEL EXITS SINCE ONLY   PTM504 00841217
*                                  CODING FOR OTLE EXISTS IN ESN PTM504 00841517
         TM    IEHMVV20+4,X'08'        IS MODEL DSCB SWITCH ON     2695 00842017
         BC    1,NOFREEA     SEE IF FROM DCB OPEN                A25571 00844018
         CLI   UDCBITLE,DEACTIVE       IS ITLE INACTIVE            UL0H 00846017
         BE    SETLABSW                YES, CONTINUE               UL0H 00848017
         MVC   UDCBOTLE(4),XXOTLE      NO, SET UP OTLE LIST ADDR   UL0H 00850017
         MVI  UDCBITLE,DEACTIVE  DEACTIVATE INPUT TRAILER LABEL  A21645 00851018
SETLABSW DS    0H                                                  UL0H 00852017
         MVC   IEHMVV72+4(4),IEHMVV72  INITIALIZE 1ST LABEL PTR    UL0H 00854017
         CLI   IEHMVV72+14,X'FF'       DID EOV REQUEST OUTPUT      UL0H 00856017
         BNE   WRAPUP                  NO, CLOSE DATA SETS         UL0H 00858017
*                                                                  UL0H 00860017
* OUTPUT MESSAGE - NO USER LABELS MOVED/COPIED. NO LABEL TRACK     UL0H 00862017
*                                                                  UL0H 00864017
         LA    A8,IEHMVV00+1           LOCATION FOR MESSAGE STORE  UL0H 00866017
         LA    A15,20                  GET MESSAGE CONSTANT        UL0H 00868017
         ST    A14,SAVE14              SAVE REG14                  UL0H 00870017
         BAL   A14,MSGCLEAR            CLEAR AREA, MOVE IN MSG     UL0H 00872017
         L     A14,SAVE14              RESTORE REG 14              UL0H 00874017
         BAL   A2,LINEPR               GO PRINT MESSAGE            UL0H 00876017
WRAPUP   DS    0H                                                  UL0H 00878017
         L     A2,IEHMVV30             LOAD ADDR OF 'FROM' DCB          00880017
         CLOSE ((A2))                  CLOSE THE 'FROM' DATA SET        00882017
         CLI   IEHMVV72+11,X'FF'       NO U.L. TRK FLG SET BY SSX  UL0H 00884017
         BE    CHECK                   YES, SKIP CLOSE OF 'TO' DATAUL0H 00886017
         TM    IEHMVV20+4,X'08'   IS IT A MODEL DSCB             A25571 00886618
         BO    NOFREE         YES, BYPASS CLOSE OF TO DATA SET   A25571 00887218
*                                      SET - WAS NEVER OPENED      UL0H 00888017
         L     A2,IEHMVV31             LOAD ADDR OF 'TO' DCB            00890017
         CLI   17(2),X'81'             IS TO VOLUME 2400        YA01457 00905002
         BE    TEST                     YES , GO TO TEST        YA01457 00907002
         CLI   17(2),X'83'             IS TO VOLUME 3420        YA01457 00910002
         BNE   NOLEAVE                  NO , GO TO NOLEAVE      YA01457 00912002
TEST     TM    IEHMVV20,VOLUME         MOVE/COPY VOLUME         YA01457 00915002
         BO    LEAVE                    YES , GO TO LEAVE       YA01457 00920002
         TM    IEHMVV20,DSGROUP        MOVE/COPY DSGROUP        YA01457 00922002
         BO    LEAVE                    YES , GO TO LEAVE       YA01457 00925002
NOLEAVE  CLOSE ((2))                   CLOSE NO LEAVE              8650 00932021
         TM    IEHMVV82+16,X'80' BDAM DATA SET                   A41754 00934021
         BNO   CHECK                    NO CONTINUE              A41754 00934121
         NI    IEHMVV82+16,X'7F'       CLEAR THE SWITCH          A41754 00934221
         L     A1,IEHMVV82+16    YES, GET BDAM-AREA              A41754 00934421
         LA    A1,0(A1)                 CLEAR HIGH ORDER BYTE    A41754 00934821
         L     A0,IEHMVV82+20    GET SIZE OF CORE                A41754 00934921
         FREEMAIN R,LV=(0),A=(1)        RELEASE THE AREA         A41754 00935021
         B     CHECK                                               8650 00940013
NOFREEA  TM    IEHMVV10-4,FROMOP                                PTM2138 00941018
         BZ    NOFREE                                           PTM2138 00942018
         NI    IEHMVV10-4,X'7F'                                 PTM2138 00943018
         B     WRAPUP                                           PTM2138 00944018
LEAVE    CLOSE ((2),LEAVE)             CLOSE WITH LEAVE            8650 00945013
CHECK    CLI   IEHMVV74+4,X'FF'         I/O ERR IN U.L. EXIT RTN   UL0H 00946017
         BE    IOERRMSG                 YES, TELL USER             UL0H 00947017
ERMSGRET DS    0H                                                  UL0H 00948017
         LA    A10,IEHMVV00+8          SET UP ADDRESSIBILITY TO    UL0H 00949017
         USING IEFJFCBN,A10            THE JFCB                    UL0H 00950017
         MVI   UDCBIHLE,DEACTIVE                                   UL0H 00951017
         MVI   UDCBOHLE,DEACTIVE                                   UL0H 00952017
         MVI   UDCBITLE,DEACTIVE                                   UL0H 00953017
         MVI   UDCBOTLE,DEACTIVE                                   UL0H 00954017
         NI    JFCBLTYP,X'F7'           CLEAR SUL INDICATOR SET AT UL0H 00955017
         DROP  A10                                                      00956017
*                                       U.L. TRK ALLOCATION TIME   UL0H 00957017
         TM    IEHMVV20+1,UNLOAD        UNLOAD                     UL0H 00958017
*                                          IF YES FREE BUFFERS          00960000
         BZ    NOFREE                     IF NOT ---                    00980000
         TM    IEHMVV20+1,LOAD          IS THIS A LOAD/UNLOAD           01000000
         BO    NOFREE                                                   01020000
         L     A1,IEHMVV31             LOAD ADDR OF TO DCB              01040000
         FREEPOOL  (1)                                                  01060000
NOFREE   DS    0H                                                       01080000
*********************************************************************** 01100000
**        V O L U M E   L I S T   F O R M A T                         * 01120000
*********************************************************************** 01140000
*********************************************************************** 01160000
**                      **                              **            * 01180000
** DEVICE  TYPE         **   VOLUME SERIAL NUMBER       ** SEQUENCE # * 01200000
**  (4 BYTES)           **       (6 BYTES)              **  (2 BYTES) * 01220000
**                      **                              **            * 01240000
*********************************************************************** 01260000
*********************************************************************** 01280000
**                                                                      01300000
**                                                                      01320000
********************************************************************    01340000
**                                                                      01360000
**       HANDLES THE ESTABLISHMENT OF A CORRECT ACTIVE VOL PTR          01380000
**                                                                      01400000
********************************************************************    01420000
         SR    A8,A8                                             A43752 01430021
         SR    A4,A4                                                    01440000
         IC    A4,IEHMVV23+4      LOAD NO OF ACTIVE VOLUMES             01460000
         L     A1,IEHMVV23+4      ADDR OF ACTIVE VOL ID                 01480000
         NI    IEHMVV20+4,X'FD'        CLEAR VOLSWITCH INDIC     A43752 01510021
*                                                                       01545013
*                                                                       01550013
*                                                                       01555013
CHECKVOL CLC   IEHMVV82+26(6),4(A1)    VOL SWITCH OCCURRED       A43752 01560021
         BE    ACTVOLOK                NO                        A43752 01570021
*                                                                       01590013
*                                                                       01595013
         OI    IEHMVV20+4,X'02'         INDICATE VOLUMESWITCH    A43752 01595421
         LA    A8,1(A8)                 COUNT NUMBER OF SWITCHES A43752 01595821
         LA    A1,OFFSVL(A1)            BUMP ACTIVE POINTER      A43752 01597021
         BCT   A4,CHECKVOL                                              01620000
         LA    A4,OFFSVL                VOLUMELIST ENTRYLENGTH   A43752 01630021
         SR    A1,A4              BACK UP ACTIVE PTR WITHIN LIST        01660000
         LA    A4,1                    SET VOL CNT TO 1          A43752 01680021
         BCTR  A8,0                    REDUCE NBR OF VOL'S IN MSGA43752 01684021
         LTR   A8,A8                   ONLY ONE ACT TO VOL       A43752 01688021
         BNZ   *+8                     NO CONTINUE               A43752 01692021
         NI    IEHMVV20+4,X'FD'        YES  DON'T HANDLE VOLSW   A43752 01696021
         MVC   4(6,A1),IEHMVV82+26     MOVE IN VOL SER NBR       A43752 01700021
ONMAIN   XC    SEQ(2,A1),SEQ(A1)       SEQ NBR ZERO              A43752 01748021
         CLI   2(A1),X'20'             TO DEVICE DA              A43752 01768021
         BE    ACTVOLOK                YES CONTINUE              A43752 01788021
         MVC   SEQ(2,A1),IEHMVV82+24   USE LOG FILE SEQ NBR      A43752 01808021
ACTVOLOK ST    A1,IEHMVV23+4      STORE PTR TO ACTIVE PTR               01860000
         STC   A4,IEHMVV23+4      STORE NO. OF VOLUMES IN LIST          01880000
         STC   A8,IEHMVV23             SAVE NBR OF VOLSWITCHES   A43752 01890021
         TM    IEHMVV20,DSGROUP         TEST FOR GROUP OPERATION        01900000
         BO    UPSEQ                      IF SO ---                     01920000
         TM    IEHMVV20,VOLUME          TEST FOR VOLUME OPERATION       01940000
         BO    UPSEQ                     IF SO ---                      01960000
         B     SEQON                                                    01980000
UPSEQ    L     A1,IEHMVV23+4           LOAD ADDR OF ACTIVE VOL ID       02000000
         CLI   2(A1),TAPEOUT            IS OUTPUT ON TAPE               02020000
********************************************************************    02040000
**                                                                      02060000
**       HANDLES UPING THE SEQ NO IN THE ACTIVE VOL LIST FOR TAPE OUT   02080000
**                                                                      02100000
********************************************************************    02120000
         BNE   SEQON                     IF NOT ---                     02140000
         TM    IEHMVV20+4,X'02'         VOLUME SWITCH            A43752 02142021
         BNO   CONTIN1                  NO CONTINUE              A43752 02144021
         SR    A7,A7                    YES GET FILE SEQ NBR     A43752 02146021
MOREVOL  LA    A7,OFFSVL(A7)                                     A43752 02150021
         BCT   A8,MOREVOL               FIND START OF LIST       A43752 02160021
         LR    A5,A1                    ADDR ACTIVE VOLUME       A43752 02170021
         SR    A5,A7                    ADDR START OF LIST       A43752 02172021
         MVC   DTCRT(2),SEQ(A5)         GET SEQ NUMBER           A43752 02174021
         B     CONTIN2                                           A43752 02176021
CONTIN1  MVC   DTCRT(2),SEQ(A1)         GET SEQ NUMBER           A43752 02178021
CONTIN2  LH    A2,DTCRT                                          A43752 02178421
         LA    A2,1(A2)                BUMP SEQ NO BY ONE               02180000
         LA    A3,1                                                     02200000
         CR    A3,A2              WAS SEQ UPED TO 1                     02220000
         BNE   *+8                    IF NOT --- DONE                   02240000
         LA    A2,1(A2)             OTHERWISE BUMP IT TO 2              02260000
         STH   A2,DTCRT                 REPLACE THE SEQUENCE       DT0I 02270018
         MVC   SEQ(2,A1),DTCRT                NUMBER               DT0I 02280018
SEQON    DS    0H                                                       02300000
********************************************************************    02350004
**                                                                      02400004
**       HANDLES THE CONSTRUCTION OF A TO CVOL PTR IF ONE DID NOT EXIST 02450004
**                                                                      02500004
**        LINES 023000-029179 WERE REACTIVATED IN              @Z40CSJH 02510004
**        SUPPORT OF THE MVS EXTENDED CVOL FUNCTION            @Z40CSJH 02520004
********************************************************************    02550004
         TM    IEHMVV20+1,CVOL         WAS CVOL SPECIFIED               02600004
         BO    GOTCVOL                      IF SO ---                   02650004
         TM    IEHMVV20+5,X'20'        DSGRP(NAME) SPECIFIED   @Z40CSJH 02660004
         BO    GOTCVOL                 BR IF YES               @Z40CSJH 02670004
         TM    IEHMVV20,X'01'          FROM VOL SPECIFIED      @Z40CSJH 02680004
         BO    GOTCVOL                 BR IF YES               @Z40CSJH 02690004
         TM    IEHMVV20,X'20'          DSNAME SPECIFIED        @Z40CSJH 02692004
         BO    GOTCVOL                 YES-BYPASS SYSRES       @Z40CSJH 02694004
         TM    IEHMVV20,X'08'          PDS SPECIFIED           @Z40CSJH 02696004
         BO    GOTCVOL                 YES-BYPASS SYSRES       @Z40CSJH 02698004
         L     WORK2,CVTSTRT            OTHERWISE -- FIND SYSRES UCB    02700004
         L     WORK2,CVTILK2(WORK2)       TO GET ASSUMED VOLUME ID      02750004
VON      ICM   WORK3,3,0(WORK2)        GET UCB @               @Z40CSJH 02800004
         N     WORK3,CLEARMSK          SAVE 16 BITS            @Z40CSJH 02850004
         TM    0(WORK2),X'FF'          IS IT LAST PTR          @Z40CSJH 02900004
         BC    1,GOTCVOL               BRANCH IF YES           @Z40CSJH 02900404
         LTR   WORK3,WORK3             CHECK FOR PTR V 0                02902004
         BZ    NOTAUCB                                                  02902404
         TM    UCBTBYT3,DAUCB          IS THIS UCB FOR DA               02902804
         BZ    NOTAUCB                                                  02903204
         TM    SRTESTAT,SYSRUCB        IS THIS A UCB FOR SYSRES         02903604
         BO    VFIND                                                    02903704
NOTAUCB  DS    0H                                                       02903804
         LA    WORK2,2(WORK2)          BUMP THE UCB PTR TABLE PTR       02903904
         B     VON                                                      02908904
VFIND    MVC   IEHMVV24(4),IEHMVV10    SET CVOL LIST PTR                02910904
         L     WORK2,IEHMVV10          LOAD ADDR OF PERM WK AREA        02912904
         MVC   0(4,WORK2),UCBTYP       MOVE DEVICE TYPE                 02914904
         MVC   4(6,WORK2),SRTEVOLI     MOVE VOLUME ID                   02915204
         DROP  A3                                                       02915604
         LA    WORK2,12(WORK2)         BUMP WK AREA PTR BY AMOUNT OF    02915704
         ST    WORK2,IEHMVV10              CORE USED AND STOR           02915804
         OI    IEHMVV20+1,CVOL          TURN ON CVOL BIT                02915904
         B     GOTCVOL                                                  02917904
*******************************************************************2695 02922004
*                                                                 *2695 02924004
* VSSX HAS JUST ALLOCATED A MODEL DSCB.  NO DCB WAS CREATED, AND  *2695 02925004
* THUS VESN MUST BYPASS READING JFCB TO GET VOLID OF 'TO' VOLUME. *2695 02930004
*                                                                 *2695 02935004
*******************************************************************2695 02940004
*                                                                  UL0H 02945004
*                                O R                               UL0H 02950004
*                                                                  UL0H 02955004
*******************************************************************UL0H 02960004
*                                                                  UL0H 02965004
* VESN WAS ENTERED FROM VSSX.  VSSX FOUND USER LABELS IN CORE,    *UL0H 02970004
* BUT NO USER LABEL TRACK WAS ALLOCATED FOR LABELS ON THE 'TO'    *UL0H 02975004
* DATA SET.  A DCB WAS THEREFORE NEITHER CREATED OR OPENED FOR    *UL0H 02980004
* THE 'TO' DATA SET, AND READING OF THE JFCB MUST BE BYPASSED.    *UL0H 02985004
*                                                                  UL0H 02990004
*******************************************************************UL0H 02995004
         DS    0F                                                       03000017
CLEARMSK DC    X'0000FFFF'                                     @Z40CSJH 03004004
GOTCVOL  DS    0H                                              @Z40CSJH 03006004
*********************************************************************** 03012017
*                                                                       03016017
** HANDLES THE BUILDING OF A LIST OF VOLS USED BY THE DS JUST MOVED     03020017
*                                                                       03024017
*********************************************************************** 03028017
LISTVOL  L     A3,IEHMVV10              GET ADDR PERM WORKAREA  YL026VC 03030002
         L     A6,IEHMVV23+4            GET ADDR OF VOLUMELIST   A43752 03030421
         TM    IEHMVV20+4,X'08'        MODEL DSCB INDICATOR ON     2695 03032017
         BC    1,NORDJFCB              YES, BYPASS READ OF JFCB    2695 03036017
         CLI   IEHMVV72+11,X'FF'       DID WE COME HERE FROM VSSX  UL0H 03040017
         BE    NORDJFCB                YES, SKIP READ OF JFCB OF   UL0H 03044017
*                                      'TO' VOL. IT HAS NO DCB AND UL0H 03048017
*                                      WAS NEVER OEPNED.           UL0H 03052017
         LA    A1,IEHMVV00+8      ADDR TO READ JFCB INTO                03080000
         ST    A1,IEHMVV00        BUILD EXIT LIST FOR OPEN              03100000
         MVI   IEHMVV00,ALLOW           INDICATES CORE SET FOR EXT LST  03120000
         L     A1,IEHMVV31             ADDR OF TO DCB                   03140000
         LA    A2,IEHMVV00        ADDR OF EXIT LIST                     03160000
         ST    A2,DCBEXLST(A1)          STORE EXIT LIST ADDR INTO DCB   03180000
         LR    A2,A1                                                    03200000
         RDJFCB ((A2))                                                  03210021
NORDJFCB LA    A10,IEHMVV00+8           SET UP ADDRESSABILITY    A43752 03212021
         USING IEFJFCBN,A10             FOR THE JFCB             A43752 03214021
         MVC   IEHMVV82+4(3),JFCBDSL1  MOVE DSCBTTR TO SAVEAREA  S21042 03216002
         TM    IEHMVV20+4,X'02'         VOLUME SWITCH OCCURRED   A43752 03220021
         BO    VOLSWTCH                 YES MORE ENTRIES TO MAKE A43752 03230021
         XC    12(2,A3),12(A3)          NO CLEAR FILE SEQ NBR    A43752 03240021
         MVC   2(10,A3),0(A6)           COPY VOLLIST ENTRY       A43752 03250021
         LA    A4,1                                              A43752 03260021
         STH   A4,0(A3)                 PWA COUNT IS 1           A43752 03270021
         CLI   2(A6),X'20'              TOVOL DA                 A43752 03280021
         BE    TESTBITS                 YES FILE SEQ NBR ZERO    A43752 03290021
         MVC   12(2,A3),JFCBFLSQ        NO GET FILE SEQ NBR      A43752 03300021
         B     CONTIN3                                           A43752 03310021
VOLSWTCH SR    A7,A7                                             A43752 03320021
         SR    A8,A8                                             A43752 03330021
         IC    A8,IEHMVV23              GET NBR OF SWITCHES      A43752 03340021
NEXTVOL  LA    A7,OFFSVL(A7)                                     A43752 03350021
         BCT   A8,NEXTVOL                                        A43752 03360021
         SR    A6,A7                    POINT TO FIRST VOLUME    A43752 03370021
         IC    A8,IEHMVV23              GET NBR OF SWITCHES      A43752 03380021
         LA    A8,1(A8)                 NBR OF VOLUMES USED      A43752 03390021
         STH   A8,0(A3)                 STORE PWA COUNT          A43752 03392021
PWALOOP  MVC   2(10,A3),0(A6)           COPY VOLLIST ENTRY       A43752 03392421
         XC    12(2,A3),12(A3)          CLEAR FILE SEQ NBR       A43752 03392821
         LA    A6,OFFSVL(A6)            BUMP LIST POINTER        A43752 03392921
         LA    A3,12(A3)                BUMP PWA POINTER         A43752 03393021
         BCT   A8,PWALOOP                                        A43752 03395021
         L     A3,IEHMVV10             POINT TO FIRST VOL        A43752 03395421
         CLI   4(A3),X'20'             TO DA                     A43752 03395621
         BE    TESTBITS                YES ALL SEQ NBRS ZERO     A43752 03395821
         MVC   12(2,A3),JFCBFLSQ        GIVE FILE SEQ NBR        A43752 03396021
CONTIN3  TM    JFCBLTYP,X'0A'          UNLABELED TAPE            A43752 03496021
         BNZ   TESTBITS                NO  IT'S SL OR SUL        A43752 03596021
         DROP  A10                                               A43752 03696021
         MVI   IEHMVV74+12,X'FF'  TURN NL TAPE SWITCH ON         A19476 03942018
WORK2    EQU   2                                                        03960000
WORK3    EQU   3                                                        03980000
TESTBITS DS    0H                                                       04000000
         NI    IEHMVV20+4,X'FD'        SET VOLUME SWITCH OFF    A43752  04010021
         BO    PREABORT                   IF SO ---                     04040000
         TM    IEHMVV20+2,MIDABRT       TEST FOR MID ABORT BIT ON       04060000
         BO    MIDMSG                     IF SO ---                     04080000
         TM    IEHMVV20,MCCATLG         TEST FOR M/C CATALOG   @Z40CSJH 04130004
         BO    COPYGRP                    IF SO ---            @Z40CSJH 04132004
         TM    IEHMVV20,MORC            TEST FOR MOVE OR COPY           04140000
         BO    MOVESET                    IF A MOVE OPERATION    Y02918 04160002
         B     COPYSET                    IF NOT ---                    04220000
MIDMSG   NOP   0(0)                                                     04300000
         OI    IEHMVV41+13,X'02'   SET RET CODE = 8                     04320000
         LA    A8,IEHMVV00+1       ******                               04340000
         LA    A15,4                    *                               04360000
         BAL   A14,MSGCLEAR             *                               04380000
         BAL   A14,MSGDS                *    WRITE MESSAGE-             04400000
         LA    A15,16                   *                               04420000
         BAL   A14,MSG                  *       'DS XX NOT M/C'         04440000
         BAL   A2,LINEPR           ******                               04460000
         SR    A15,A15                  *                         19030 04465019
         BAL   A14,MSGVOL               *                         19030 04470019
         BAL   A2,LINEPR           ******                         19030 04475019
         B     MIDABORT                                                 04480000
RETURN   IEHPOST ,TC                                                    04500000
         L     14,12(0,13)             RESTORE FINAL WRAP RETURN        04520000
         TM    IEHMVV20,X'04'          TEST FOR M/C CATALOG             04540000
         BO    WRAPCAT                    IF SO ---                     04560000
         XCTL  (2,12),EP=IEHMVESH       GO TO CONTINUE REST OF GROUP    04580000
WRAPCAT  TM    IEHMVV20+2,X'20'        TEST FOR END OF INPUT            04600000
         BO    END                        IF SO ---                     04620000
         XCTL  (2,12),EP=IEHMVEST         IF NOT --- GO TO SCAN CARDS   04640000
END      XCTL  (2,12),EP=IEHMVESK      GO TO FINAL WRAP UP              04660000
MIDABORT XCTL  EP=IEHMVESO                           - MIDABORT ******* 04680000
PREABORT OI    IEHMVV20+2,EOI           TURN ON END OF INPUT SWITCH     04700000
         B     MIDABORT                                                 04720000
COPYSET  XCTL  EP=IEHMVESP                           - COPY SING DS *** 04740000
MOVESET  XCTL  EP=IEHMVESQ                           - MOVE SING DS *** 04760000
*********************************************************************** 04770004
**       LINES 048100-050192 WERE REACTIVATED IN               @Z40CSJH 04780004
**       SUPPORT OF THE MVS EXTENDED CVOL FUNCTION             @Z40CSJH 04790004
*********************************************************************** 04800004
COPYGRP  NOP   0(0)                                                     04810004
         LA    A8,IEHMVV00+1       ******                               04860004
         LA    A15,8                    *                               04910004
         BAL   A14,MSGCLEAR             *                               04960004
         BAL   A14,MSGDS                *                               05010004
         LA    A15,12                   *    WRITE MESSAGE -            05012004
         BAL   A14,MSG                  *                               05014004
         BAL   A2,LINEPR                *       'DS XX COPIED TO VOL X' 05016004
         SR    A15,A15                  *                               05018004
         BAL   A14,MSGVOL               *                               05018404
         BAL   A2,LINEPR           ******                               05018804
         B     RETURN                                                   05019204
*                                                                       05020000
*********************************************************************   05040000
**                                                                      05060000
**                            MESSAGE MOVER                             05080000
**                                                                      05100000
**       THIS SUBROUTINE IS LINKED TO IN ORDER TO MOVE MESSAGES         05120000
**       FROM THE MESSAGE CSECT TO THE PRINT AREA (IEHMVV00)            05140000
**       THE LINKAGE IS AS FOLLOWS:          A8= LOCATION FOR MSG       05160000
**                                 A14= RETURN ADDR                     05180000
**                       A15= DISPLACEMENT OF ADCON OF CORRECT MSG      05200000
**       WHEN THIS ROUTINE IS DONE A8  WILL POINT ONE SPACE PAST        05220000
**       THE MOVED MESSAGE --- ALL REGISTERS ARE TRANSPARENT            05240000
**       EXCEPT REGISTERS A1 AND A15 -- THE PRINT AREA IS CLEARED       05260000
**       IF THE INSTRUCTION 'MSGCLEAR' IS LINKED TO                     05280000
**                                                                      05300000
*********************************************************************   05320000
*                                                                       05340000
MSGCLEAR MVI   IEHMVV00,BLANK           CLEAR THE PRINT AREA            05360000
         MVC   IEHMVV00+1(120),IEHMVV00                                 05380000
MSG      L     A1,MSGAD                 GET ADDR OF MSG CSECT           05400000
         AR    A1,A15                   ADD DISP OF CORRECT ADCON       05420000
         L     A1,0(A1)                 LOAD ADDR OF MSG-1              05440000
         IC    A15,0(A1)               LOAD LENGTH OF MSG               05460000
         EX    A15,MSGMOVE              EXECUTE MOVE                    05480000
         AR    A8,A15                   CALC ADDR OF END OF MSG         05500000
         LA    A8,2(A8)                BUMP REG TO END OF MSG +1        05520000
         BR    A14                      RETURN                          05540000
MSGMOVE  MVC   0(1,A8),1(A1)           MOVE MSG                         05560000
*                                                                       05580000
*********************************************************************   05600000
**                                                                      05620000
**                            DATA SET NAME MOVER                       05640000
**                                                                      05660000
**       THIS SUBROUTINE IS LINKED TO IN ORDER TO MOVE DATA SET         05680000
**       NAMES INTO A MESSAGE THE LINKAGE IS AS FOLLOWS:                05700000
**                                           A8= LOCATION FOR NAME      05720000
**                                 A14= RETURN ADDR                     05740000
**                       A15= CODE TO DEFINE WHICH DS NAME              05760000
**                             IF A15=0 ---MOVE 'TO' DS NAME            05780000
**                             IF A15= NOT 0 --- MOVE 'FROM' DS NAME    05800000
**       WHEN THIS ROUTINE IS DONE A8 WILL POINT ONE SPACE PAST         05820000
**       THE MOVED NAME                                                 05840000
**                                                                      05860000
*********************************************************************   05880000
*                                                                       05900000
MSGDS    LTR   A15,A15                  TEST FOR A15=0                  05920000
         BZ    TODS                       IF SO BRANCH                  05940000
         L     A15,IEHMVV21             GET ADDR OF 'FROM' DS NAME      05960000
         B     DSMOVE                                                   05980000
TODS     L     A15,IEHMVV21+4           GET ADDR OF 'TO' DS NAME        06000000
DSMOVE   MVC   0(44,A8),0(A15)          MOVE DS NAME TO PRINT AREA      06020000
CHKEND   CLI   0(A8),BLANK              CHECK FOR END OF NAME           06040000
         BE    NAMEEND                    IF REACHED BRANCH ---         06060000
         LA    A8,1(A8)                 BUMP POINTER TO PRINT AREA      06080000
         B     CHKEND                                                   06100000
NAMEEND  LA    A8,1(A8)                 ALLOW FOR SPACE AFTER NAME      06120000
         BR    A14                      RETURN                          06140000
*                                                                       06160000
********************************************************************    06180000
**                                                                      06200000
**                            MESSAGE WRITE CALLER                      06220000
**                                                                      06240000
**       THIS ROUTINE WILL BE LINKED TO WHENEVER A LINE OF OUTPUT       06260000
**       IS TO BE WRITTEN ON 'SYSPRINT' IT WILL HAVE NO PARAMETERS      06280000
**       AND ASSUME THAT THE LINE TO BE WRITTEN IS LOCATED AT IEHMVV00  06300000
**       AFTER THE WRITE IS COMPLETE, CONTROL WILL BE PASSED BACK VIA   06320000
**       A2  UNLESS A PERMINANT I/O ERROR WAS ENCOUNTERED               06340000
**                                                                      06360000
********************************************************************    06380000
*                                                                       06400000
LINEPR   ST    A3,IEHMVV00+128         SAVE REG 3                       06420000
         LA    A3,IEHMVV00             LOAD ADDR OF PRINT AREA          06440000
         LINK EP=IEHMVESU              GO TO MSG WTR                    06460000
         L     A3,IEHMVV00+128                                          06480000
         B     *+4(A15)                 CHECK RETURN CODE               06500000
         B     0(A2)                         =0  OK WRITE               06520000
         IEHPOST ,TC                                                    06540000
         L     14,12(0,13)              RESTORE REG 14                  06560000
         XCTL  (2,12),EP=IEHMVESK                                       06580000
*                                                                       06600000
*********************************************************************   06620000
**                                                                      06640000
**                            VOLUME LIST MOVER                         06660000
**                                                                      06680000
**       THIS ROUTINE IS LINKED TO  IN ORDER TO MOVE A VOLUME LIST      06700000
**       TO THE PRINT AREA PLUS 20 BYTES(IEHMVV00+20)                   06720000
**       THE LINKAGE IS AS FOLLOWS                                      06740000
**                                 A14= RETURN ADDRESS                  06760000
**       THE FORMAT OF THE LIST IS AS FOLLOWS                           06780000
**         FOR DIRECT ACCESS --- 123 7986 A1763 IBM403                  06800000
**         FOR TAPE          --- 24,0001 7987,0007                      06820000
**         FOR UNIT RECORD   --- UNIT RECORD EQUIP -- UNIT = HR         06840000
**                                                                      06860000
**                            A15= CODE TO DEFINE WHICH VOL LIST        06880000
**                                 IF A15=0 --- 'TO' VOL LIST           06900000
**                                 IF A15= NOT ZERO --- 'FROM' VOL LIST 06920000
*********************************************************************   06940000
*                                                                       06960000
MSGVOL   MVI   IEHMVV00,BLANK          CLEAR PRINT AREA                 06980000
         ST    A14,SAVE14               SAVE RETURN ADDR                07000000
         SR    A0,A0                    CLEAR A0                        07020000
         MVC   IEHMVV00+1(120),IEHMVV00                                 07040000
         LTR   A15,A15                  CHECK WHICH LIST TO MOVE        07060000
         BZ    TOVOL                      IF 'TO' LIST ---              07080000
         L     A1,IEHMVV22              LOAD ADDR OF FROM VOL LIST      07100000
         IC    A0,IEHMVV22              LOAD NO OF VOLUMES IN FROM LIST 07120000
         B     MOVEVOL                                                  07140000
TOVOL    L     A1,IEHMVV10             LOAD ADDR OF TO VOL LIST         07160000
         LH    A0,0(A1)                LOAD COUNT OF VOLUMES            07180000
         LA    A1,2(A1)                BUMP PTR TO START OF VOL IDS     07200000
MOVEVOL  TM    2(A1),UNITREC            TEST FOR VOL = UNIT RECORD      07220000
         BO    UNITVOL                    IF SO ---                     07240000
         CLI   IEHMVV74+12,X'FF'  WAS OUTPUT ON NL TAPE          A19476 07260018
         BE    UNITVOL                    IF SO ---                     07280000
         LA    A15,IEHMVV00+20          LOAD ADDR OF PRINT AREA+20      07300000
CHKLIST  MVC   0(6,A15),4(A1)           MOVE VOL ID                     07320000
         LA    A15,6(A15)               BUMP REG PAST VOL ID            07340000
         MVC   DTCRT(2),SEQ(A1)        PICK UP THE                 DT0I 07350018
         LH    A14,DTCRT                    SEQUENCE NUMBER        DT0I 07360018
         LTR   A14,A14                  CHECK IF TAPE                   07380000
         BZ    SETBLNK                    IF NOT TAPE ---               07400000
         MVI   0(A15),COMMA             MOVE COMMA TO VOLUME LIST       07420000
         CVD   A14,IEHMVV00+128         CONVERT TO DEC                  07440000
         UNPK  1(4,A15),IEHMVV00+128(8) UNPACK                          07460000
         OI    4(A15),PLUS              RESET SIGN                      07480000
         LA    A15,5(A15)               BUMP REG PAST SEQ NO            07500000
SETBLNK  LA    A15,1(A15)               LEAVE SPACE IN VOL LIST         07520000
         LA    A1,12(A1)                                                07540000
         BCT   A0,CHKLIST               LOOP IF MORE VOL ID.S           07560000
         L     A14,SAVE14               RESTORE REG A14                 07580000
         BR    A14                      RETURN                          07600000
SAVE14   DS    F                                                        07620000
UNITVOL  L     A15,MSGAD                LOAD ADDR OF MSG CSECT          07640000
         L     A15,0(A15)               LOAD ADDR OF FIRST MSG          07660000
         MVC   IEHMVV00+20(26),1(A15)      MOVE MSG TO PRINT            07680000
         MVI   IEHMVV74+12,X'00'  TURN NL TAPE SWITCH OFF        A19476 07690018
         BR    A14                      RETURN                          07700000
MOVEGRP EQU   MOVESET                               - MOVE DS GROUP **  07720000
MSGAD    DC    A(IEHMVMSN)                                              07721017
*******************************************************************UL0H 07722017
*                                                                  UL0H 07723017
*   U S E R   L A B E L   E X I T   R O U T I N E                  UL0H 07724017
*                                                                  UL0H 07725017
*******************************************************************UL0H 07726017
XXOTLE   DC    X'04'                   OUTPUT TRAILER LABEL        UL0H 07727017
         DC    AL3(OTLR)               ROUTINE EXIT IN DCB EXLST   UL0H 07728017
OTLR     DS    0H                                                  UL0H 07729017
OFFSET1  EQU   OTLR-IEHMVESN                                       UL0H 07730017
         LA    A8,OFFSET1                                          UL0H 07731017
         SR    A15,A8                                              UL0H 07732017
         LR    A9,A15                  RESET ADDRESSABILITY        UL0H 07733017
         CLC   IEHMVV72(4),ALLZEROS    LABELS IN GOTTEN CORE       UL0H 07734017
         BE    IGNORE                  NO, IGNORE LABEL REQUEST    UL0H 07735017
         CLI   IEHMVV72+12,X'00'       LABEL CTR AT ZERO           UL0H 07735517
         BE    RELCORE                 YES, FREE LABEL CORE        UL0H 07736017
         L     A8,0(A1)                LOAD PTR TO CLOSE LBL BUFF  UL0H 07736517
         LTR   A8,A8                   BUFFER ADDRESS ZERO         UL0H 07737017
         BZ    IGNORE                  YES, RETURN TO CLOSE        UL0H 07737517
IOERR    DS    0H                                                  UL0H 07738017
         CLI   8(A1),X'80'             PERM I/O ERR FROM PARM LIST UL0H 07739017
         BNE   PROVIDE                 NO, PROVIDE A LABEL         UL0H 07740017
         OI    IEHMVV74+4,X'FF'         YES, SET FLAG TO OUTPUT    UL0H 07743017
*                                        MSG AFTER OPEN/CLOSE/EOV  UL0H 07746017
         BR    A14                     RETURN TO CLOSE             UL0H 07750017
PROVIDE  DS    0H                                                  UL0H 07751017
         L     A11,IEHMVV72+4          GET ADDR OF CURRENT LBL     UL0H 07752017
         L     A15,0(0,A1)             GET CLOSE LABEL BUFF ADDR   UL0H 07753017
         MVC   0(80,A15),0(A11)        MOVE LABEL TO OUTPUT BUFFER UL0H 07754017
         LA    A11,80(A11)             UPDATE PTR TO NEXT LABEL    UL0H 07755017
         ST    A11,IEHMVV72+4          SAVE ADDRESS                UL0H 07756017
         SR    A11,A11                 REDUCE                      UL0H 07757017
         IC    A11,IEHMVV72+12            USER                     UL0H 07758017
         BCTR  A11,0                         LABEL                 UL0H 07759017
         STC   A11,IEHMVV72+12                  COUNT              UL0H 07760017
         LA    A15,8                   RETURN CODE OF 8 FOR        UL0H 07761017
         BR    14                      ANOTHER LABEL               UL0H 07762017
*                                                                  UL0H 07763017
RELCORE  DS    0H                                                  UL0H 07764017
         L     A11,IEHMVV72            GET ADDR OF GOTTEN CORE     UL0H 07765017
         FREEMAIN  R,LV=640,A=(11)     FREE GOTTEN CORE            UL0H 07766017
         XC    IEHMVV72(8),IEHMVV72    RESET POINTERS              UL0H 07767017
IGNORE   DS    0H                      RETURN CODE OF ZERO TO      UL0H 07768017
         SR    A15,A15                 CLOSE TO IGNORE LABELS      UL0H 07769017
         BR    A14                     RETURN TO CLOSE             UL0H 07770517
*                                                                       07771017
IOERRMSG DS    0H                                                       07771917
         OI    IEHMVV74+4,X'00'         CLEAR I/O ERROR FLAG       UL0H 07772817
         LA    A8,IEHMVV00+1            LOCATION FOR MESSAGE STORE UL0H 07773717
         LA    A15,24                   CONSTANT FOR MESSAGE IN MSNUL0H 07774617
         ST    A14,SAVE14               SAVE REG 14                UL0H 07775517
         BAL   A14,MSGCLEAR             CLEAR AREA, MOVE MSG IN    UL0H 07776417
         L     A14,SAVE14               RESTORE REG 14             UL0H 07777317
         BAL   A2,LINEPR                PUT MESSAGE OUT      IN    UL0H 07778217
         B     ERMSGRET                 RETURN TO INLINE PROCESSINGUL0H 07779117
*                                                                       07780000
*  E Q U A T E S                                                        07800000
*                                                                       07820000
*                                                                       07840000
FROMOP  EQU  X'80'                                               A25571 07850018
UNLOAD   EQU   X'01'                                                    07860000
LOAD     EQU   X'02'                                                    07880000
TAPEOUT  EQU   X'80'                                                    07900000
DSGROUP  EQU   X'10'                                                    07920000
VOLUME   EQU   X'02'                                                    07940000
CVOL     EQU   X'40'                                                    07960000
CVTSTRT  EQU   16                       PTR TO CVT                      07980000
CVTILK2  EQU   40                       PTR TO UCB LOOKUP TABLE         08000000
ALLOW    EQU   X'87'                                                    08020000
UNLBLED  EQU   X'02'                                                    08040000
UNLBLSW  EQU   X'FF'                                                    08060000
PREABRT  EQU   X'01'                                                    08080000
MIDABRT  EQU   X'40'                                                    08100000
MCCATLG  EQU   X'04'                                                    08120000
MORC     EQU   X'80'                                                    08140000
BLANK    EQU   X'40'                                                    08160000
UNLABEL  EQU   X'FF'                                                    08180000
COMMA    EQU   C','                                                     08200000
PLUS     EQU   X'F0'                                                    08220000
DAUCB    EQU   X'20'                                                    08240000
SYSRUCB  EQU   X'02'                                                    08260000
DCBEXLST EQU   36                                                       08280000
EOI      EQU   X'20'                                                    08300000
UNITREC  EQU   X'08'                                                    08320000
USERLABL EQU   X'0A'                                               UL0H 08325017
DEACTIVE EQU   X'00'                                                    08330017
SEQ      EQU   10                                                       08331018
OFFSVL   EQU   17                       VOLUMELIST ENTRYLENGTH   A43752 08331121
UCBSAVE  DS    1H                       UCB ADDR FROM DEB        A43752 08331221
DTCRT    DS    1H                                                       08332018
ALLZEROS DC    F'0'                                                     08335017
PATCH    DS    10F                     PATCH AREA              @Z40CSJH 08337004
         IEHMVV                                                         08340000
         ORG   IEHMVV70                                            UL0H 08346017
         IEHDCBXL                                                  UL0H 08352017
IEFJFCBN DSECT                                                          08360000
         IEFJFCBN                                                       08380000
JFCBDSL1 EQU   JFCBDSNM+53                                       S21042 08390002
IEFUCBOB DSECT                                                          08400000
         IEFUCBOB                                                       08420000
         END                                                            08440000
./  ADD  SSI=62440125,NAME=IEHMVESO
*TITLE 'IEHMVSSO'                                                     * 00020000
*FUNCTION/OPERATION: THIS ROUTINE HANDLES MOVE AND COPY SITUATIONS    * 00040000
*WHEN AN I/O ERROR OCCURES WHILE WORKING WITH A DATA SET,WORK FILE,   * 00060000
*SYSIN, OR SYSOUT. IT WILL ATTEMPT TO SCRATCH THE 'TO' DATA SET AND   * 00080000
*THEN GO TO THE PROPER ROUTINE TO CONTINUE WITH THE USERS REQUESTS. IF* 00100000
*HOWEVER, THIS ROUTINE GOT CONTROL BECAUSE OF AN I/O ERROR ON SYSOUT  * 00120000
*IT WILL PASS CONTROL TO FINAL WRAP (IEHMVSSK) WHO WILL TERMINATE THE * 00140000
*JOB.                                                                 * 00160000
*ENTRY POINTS: IEHMVESO                                               * 00180000
*INPUT: NONE                                                          * 00200000
*INPUT: NONE                                                          * 00220000
*OUTPUT: NONE                                                         * 00240000
*EXTERNAL ROUTINES: IEHMVSSU                                          * 00260000
*EXITS - NORMAL IEHMUSSK, IEHMVSSH, IEHMVSSZ, IEHMUSST                * 00280000
*        ERRORS: IEHMVSSK                                             * 00300000
*TABLES/WORK AREAS: IEHMVV00                                          * 00320000
*ATTRIBUTES: REENTRANT                                                * 00340000
*                                                                       00360000
*********************************************************************   00380000
**                                                                      00400000
**                            IEHMUSSO                                  00420000
**                                                                      00440000
*********************************************************************   00460000
*                                                                       00480000
IEHMVSSO CSECT                                                   A19476 00486018
*041600,045800                                                   A19476 00492018
*C009800,010000                                                @ZM30153 00494003
*A009900                                                       @ZM30153 00496003
*C009800,010000                                                @ZA10916 00498004
A0       EQU   0                                                        00500000
A1       EQU   1                                                        00520000
A2       EQU   2                                                        00540000
A3       EQU   3                                                        00560000
A4       EQU   4                                                        00580000
A5       EQU   5                                                        00600000
A6       EQU   6                                                        00620000
A7       EQU   7                                                        00640000
A8       EQU   8                                                        00660000
A9       EQU   9                                                        00680000
A10      EQU   10                                                       00700000
A11      EQU   11                                                       00720000
A12      EQU   12                                                       00740000
A13      EQU   13                                                       00760000
A14      EQU   14                                                       00780000
A15      EQU   15                                                       00800000
IEHMVESO BALR  A9,0                     ESTABLISH ADDR FOR PROGRAM      00820000
         ENTRY IEHMVESO                                                 00840000
         USING *,A9                                                     00860000
         USING IEHMVV,A12               ESTABLISH ADDR TO COMMUNICATION 00880000
         L     A10,MSGAD                ESTABLISH ADDR TO MESSAGES      00900000
         USING IEHMSGSO,A10                                             00920000
         TM    IEHMVV20+3,X'08'         TEST PREALLOCATE BIT            00940000
         BO    RETURN                     IF DS WAS PREALLOCATED ---    00960000
         L     A2,IEHMVV31+8            LOAD ADDR OF TO DDNAME @ZA10916 00980004
         SR    A1,A1                    CLEAR REGISTER         @ZM30153 00990003
         ICM   A1,3,14(A2)              LOAD ADDR OF TO UCB    @ZA10916 01000004
         LR    A0,A1                    PUT UCB ADDR IN A0              01020000
         USING UCB,A1                                                   01024013
         TM    UCBID,X'FF'                                              01028013
         DROP  A1                                                       01032013
         BC    12,SCRH2321                                              01036013
         TM    18(A1),X'20'             TEST FOR 'TO' VOL BEING         01040000
         BZ    RETURN                     DIRECT ACCESS - IF NOT ---    01060000
SCRH2321 L     A1,SCRHCODE              LOAD SCRATCH COLTROL BIT        01080013
         L     A2,IEHMVV21+4            LOAD ADDR OF 'TO' DSNAME        01100000
         SR    A3,A3                    CLEAR A3                        01120000
         L     A4,IEHMVV10             ADDR OF TO VOL LIST MADE BY SN   01140000
         STM   A1,A4,IEHMVV00           STORE PARAMETER LIST            01160000
         SCRATCH IEHMVV00               SCRATCH THE 'TO' DATA SET       01180000
         B     *+4(A15)                 CHECK ERROR RETURN              01200000
         B     SCRHOK    =0              --- OK SCRATCH                 01220000
         B     SCRHBAD   =4              --- VOL NOT MOUNTED            01240000
         B     SCRHBAD   =8              --- UNUSUAL CONDITION          01260000
SCRHOK   NOP   0(0)                                                     01280000
         B     RETURN                                                   01300000
SCRHBAD  NOP   0(0)                                                     01320000
         TM    IEHMVV20+2,X'01'        TEST PERMANENT ABORT             01340000
         BO    NOMSG                      IF ON ---                     01360000
         LA    A8,IEHMVV00+1       ******                               01380000
         LA    A15,4                    *                               01400000
         BAL   A14,MSGCLEAR             *                               01420000
         SR    A15,A15                  *                               01440000
         BAL   A14,MSGDS                *    WRITE MESSAGE -            01460000
         LA    A15,8                    *                               01480000
         BAL   A14,MSG                  *       'DS XX MAY NOT BE SCR'  01500000
         BAL   A2,LINEPR                *                               01520000
         SR    A15,A15                  *                               01540000
         BAL   A14,MSGVOL               *                               01560000
         BAL   A2,LINEPR           ******                               01580000
NOMSG    NOP   0(0)                                                     01600000
         B     RETURN                                                   01620000
RETURN   IEHPOST ,TC                                                    01640000
         L     14,12(0,13)              RESTORE FINAL WRAP RETURN       01660000
         TM    IEHMVV20+2,X'01'        TEST FOR PERM ABORT              01680000
         BO    END                        IF ON ---                     01700000
         TM    IEHMVV20,X'10'           TEST FOR GROUP OPERATION        01720000
         BO    ENDGRP                     IF SO ---                     01740000
         TM    IEHMVV20,X'02'           TEST FOR VOLUME OPERATION       01760000
         BO    ENDVOL                     IF SO ---                     01780000
         TM    IEHMVV20+2,X'20'        TEST FOR END BIT                 01800000
         BO    END                        IF ON ---                     01820000
         XCTL  (2,12),EP=IEHMVEST       CARD SCAN                       01840000
END      XCTL  (2,12),EP=IEHMVESK       FINAL WRAP                      01860000
ENDGRP   XCTL  (2,12),EP=IEHMVESH       DO REST OF GROUP                01880000
ENDVOL   XCTL  (2,12),EP=IEHMVESZ       DO REST OF VOLUME               01900000
*                                                                       01920000
*********************************************************************   01940000
**                                                                      01960000
**                            MESSAGE MOVER                             01980000
**                                                                      02000000
**       THIS SUBROUTINE IS LINKED TO IN ORDER TO MOVE MESSAGES         02020000
**       FROM THE MESSAGE CSECT TO THE PRINT AREA (IEHMVV00)            02040000
**       THE LINKAGE IS AS FOLLOWS:          A8= LOCATION FOR MSG       02060000
**                                 A14= RETURN ADDR                     02080000
**                       A15= DISPLACEMENT OF ADCON OF CORRECT MSG      02100000
**       WHEN THIS ROUTINE IS DONE A8  WILL POINT ONE SPACE PAST        02120000
**       THE MOVED MESSAGE --- ALL REGISTERS ARE TRANSPARENT            02140000
**       EXCEPT REGISTERS A1 AND A15 -- THE PRINT AREA IS CLEARED       02160000
**       IF THE INSTRUCTION 'MSGCLEAR' IS LINKED TO                     02180000
**                                                                      02200000
*********************************************************************   02220000
*                                                                       02240000
MSGCLEAR MVI   IEHMVV00,X'40'           CLEAR THE PRINT AREA            02260000
         MVC   IEHMVV00+1(120),IEHMVV00                                 02280000
MSG      L     A1,MSGAD                 GET ADDR OF MSG CSECT           02300000
         AR    A1,A15                   ADD DISP OF CORRECT ADCON       02320000
         L     A1,0(A1)                 LOAD ADDR OF MSG-1              02340000
         IC    A15,0(A1)               LOAD LENGTH OF MSG               02360000
         EX    A15,MSGMOVE              EXECUTE MOVE                    02380000
         AR    A8,A15                   CALC ADDR OF END OF MSG         02400000
         LA    A8,2(A8)                BUMP REG TO END OF MSG +1        02420000
         BR    A14                      RETURN                          02440000
MSGMOVE  MVC   0(1,A8),1(A1)           MOVE MSG                         02460000
*                                                                       02480000
*********************************************************************   02500000
**                                                                      02520000
**                            DATA SET NAME MOVER                       02540000
**                                                                      02560000
**       THIS SUBROUTINE IS LINKED TO IN ORDER TO MOVE DATA SET         02580000
**       NAMES INTO A MESSAGE THE LINKAGE IS AS FOLLOWS:                02600000
**                                           A8= LOCATION FOR NAME      02620000
**                                 A14= RETURN ADDR                     02640000
**                       A15= CODE TO DEFINE WHICH DS NAME              02660000
**                             IF A15=0 ---MOVE 'TO' DS NAME            02680000
**                             IF A15= NOT 0 --- MOVE 'FROM' DS NAME    02700000
**       WHEN THIS ROUTINE IS DONE A8 WILL POINT ONE SPACE PAST         02720000
**       THE MOVED NAME                                                 02740000
**                                                                      02760000
*********************************************************************   02780000
*                                                                       02800000
MSGDS    LTR   A15,A15                  TEST FOR A15=0                  02820000
         BZ    TODS                       IF SO BRANCH                  02840000
         L     A15,IEHMVV21             GET ADDR OF 'FROM' DS NAME      02860000
         B     DSMOVE                                                   02880000
TODS     L     A15,IEHMVV21+4           GET ADDR OF 'TO' DS NAME        02900000
DSMOVE   MVC   0(44,A8),0(A15)          MOVE DS NAME TO PRINT AREA      02920000
CHKEND   CLI   0(A8),X'40'              CHECK FOR END OF NAME           02940000
         BE    NAMEEND                    IF REACHED BRANCH ---         02960000
         LA    A8,1(A8)                 BUMP POINTER TO PRINT AREA      02980000
         B     CHKEND                                                   03000000
NAMEEND  LA    A8,1(A8)                 ALLOW FOR SPACE AFTER NAME      03020000
         BR    A14                      RETURN                          03040000
*                                                                       03060000
********************************************************************    03080000
**                                                                      03100000
**                            MESSAGE WRITE CALLER                      03120000
**                                                                      03140000
**       THIS ROUTINE WILL BE LINKED TO WHENEVER A LINE OF OUTPUT       03160000
**       IS TO BE WRITTEN ON 'SYSPRINT' IT WILL HAVE NO PARAMETERS      03180000
**       AND ASSUME THAT THE LINE TO BE WRITTEN IS LOCATED AT IEHMVV00  03200000
**       AFTER THE WRITE IS COMPLETE, CONTROL WILL BE PASSED BACK VIA   03220000
**       A2  UNLESS A PERMINANT I/O ERROR WAS ENCOUNTERED               03240000
**                                                                      03260000
********************************************************************    03280000
*                                                                       03300000
LINEPR   ST    A3,IEHMVV00+128         SAVE REG 3                       03320000
         LA    A3,IEHMVV00             LOAD ADDR OF PRINT AREA          03340000
         LINK EP=IEHMVESU              GO TO MSG WTR                    03360000
         L     A3,IEHMVV00+128                                          03380000
         B     *+4(A15)                 CHECK RETURN CODE               03400000
         B     0(A2)                         =0  OK WRITE               03420000
         IEHPOST ,TC                                                    03440000
         L     14,12(0,13)              RESTORE REG 14                  03460000
         XCTL  (2,12),EP=IEHMVESK                                       03480000
*                                                                       03500000
*********************************************************************   03520000
**                                                                      03540000
**                            VOLUME LIST MOVER                         03560000
**                                                                      03580000
**       THIS ROUTINE IS LINKED TO  IN ORDER TO MOVE A VOLUME LIST      03600000
**       TO THE PRINT AREA PLUS 20 BYTES(IEHMVV00+20)                   03620000
**       THE LINKAGE IS AS FOLLOWS                                      03640000
**                                 A14= RETURN ADDRESS                  03660000
**       THE FORMAT OF THE LIST IS AS FOLLOWS                           03680000
**         FOR DIRECT ACCESS --- 123 7986 A1763 IBM403                  03700000
**         FOR TAPE          --- 24,0001 7987,0007                      03720000
**         FOR UNIT RECORD   --- UNIT RECORD EQUIP -- UNIT = HR         03740000
**                                                                      03760000
**                            A15= CODE TO DEFINE WHICH VOL LIST        03780000
**                                 IF A15=0 --- 'TO' VOL LIST           03800000
**                                 IF A15= NOT ZERO --- 'FROM' VOL LIST 03820000
*********************************************************************   03840000
*                                                                       03860000
MSGVOL   MVI   IEHMVV00,X'40'           CLEAR PRINT AREA                03880000
         ST    A14,SAVE14               SAVE RETURN ADDR                03900000
         SR    A0,A0                    CLEAR A0                        03920000
         MVC   IEHMVV00+1(120),IEHMVV00                                 03940000
         LTR   A15,A15                  CHECK WHICH LIST TO MOVE        03960000
         BZ    TOVOL                      IF 'TO' LIST ---              03980000
         L     A1,IEHMVV22              LOAD ADDR OF FROM VOL LIST      04000000
         IC    A0,IEHMVV22              LOAD NO OF VOLUMES IN FROM LIST 04020000
         B     MOVEVOL                                                  04040000
TOVOL    L     A1,IEHMVV10             LOAD ADDR OF TO VOL LIST         04060000
         LH    A0,0(A1)                LOAD COUNT OF VOLUMES            04080000
         LA    A1,2(A1)                BUMP PTR TO START OF VOL IDS     04100000
MOVEVOL  TM    2(A1),X'08'             TEST FOR VOL = UNIT REC          04120000
         BO    UNITVOL                    IF SO ---                     04140000
         CLI   IEHMVV74+12,X'FF'  WAS OUTPUT ON NL TAPE          A19476 04160018
         BE    UNITVOL                    IF SO ---                     04180000
         LA    A15,IEHMVV00+20          LOAD ADDR OF PRINT AREA+20      04200000
CHKLIST  MVC   0(6,A15),4(A1)           MOVE VOL ID                     04220000
         LA    A15,6(A15)               BUMP REG PAST VOL ID            04240000
         LH    A14,10(A1)               LOAD VOL SEQ                    04260000
         LTR   A14,A14                  CHECK IF TAPE                   04280000
         BZ    SETBLNK                    IF NOT TAPE ---               04300000
         MVI   0(A15),C','              MOVE , TO VOL LIST              04320000
         CVD   A14,IEHMVV00+128         CONVERT TO DEC                  04340000
         UNPK  1(4,A15),IEHMVV00+128(8) UNPACK                          04360000
         OI    4(A15),X'F0'             RESET SIGN                      04380000
         LA    A15,5(A15)               BUMP REG PAST SEQ NO            04400000
SETBLNK  LA    A15,1(A15)               LEAVE SPACE IN VOL LIST         04420000
         LA    A1,12(A1)                                                04440000
         BCT   A0,CHKLIST               LOOP IF MORE VOL ID.S           04460000
         L     A14,SAVE14               RESTORE REG A14                 04480000
         BR    A14                      RETURN                          04500000
SAVE14   DS    F                                                        04520000
UNITVOL  L     A15,MSGAD                LOAD ADDR OF MSG CSECT          04540000
         L     A15,0(A15)               LOAD ADDR OF FIRST MSG          04560000
         MVC   IEHMVV00+20(26),1(A15)      MOVE MSG TO PRINT            04580000
         MVI   IEHMVV74+12,X'00'  TURN NL TAPE SWITCH OFF        A19476 04590018
         BR    A14                      RETURN                          04600000
         DS    0F                                                       04620000
SCRHCODE DC    XL4'41005000'                                            04640000
MSGAD    DC    A(IEHMSGSO)                                              04660000
         IEHMVV                                                         04680000
UCB      DSECT                                                          04686013
         IEFUCBOB                                                       04692013
IEHMSGSO CSECT                                                          04700000
*                                                                       04720000
*********************************************************************   04740000
**                                                                      04760000
**                            MSG CSECT FOR IEHMVSSO                    04780000
**                                                                      04800000
*********************************************************************   04820000
*                                                                       04840000
         DC    A(MSGA)                                                  04860000
         DC    A(MSGB)                                                  04880000
         DC    A(MSGC)                                                  04900000
MSGA     DC    AL1(MSGB-MSGA-2)                                         04920000
         DC    CL26'UNIT REC OR UNLABLED TAPE'                          04940000
MSGB     DC    AL1(MSGC-MSGB-2)                                         04960000
         DC    CL16'IEH362I DATA SET'                                   04980000
MSGC     DC    AL1(MSGD-MSGC-2)                                         05000000
         DC    CL30'MAY NOT BE SCRATCHED ON VOLUME'                     05020000
         DC    CL3'(S)'                                                 05040000
MSGD     EQU   *                                                        05060000
         END                                                            05080000
./  ADD  SSI=70260468,NAME=IEHMVESP
*TITLE 'IEHMVSSP'                                                     * 00020000
*FUNCTION/OPERATION: THIS ROUTINE HANDLES THE WRAP UP PROCEDURE FOR   * 00040000
*COPY REQUESTS . THIS INCLUDES UNCATALOGING                           * 00060002
*THE DATA SET FROM THE CATALOG IN WHICH IT WAS CATALOGED PRIOR TO THE * 00080000
*COPY (IF ANY) AND CATALOGING THE DATA SET  IF THE                    * 00100002
*'CATLG' OPTION WAS CHOSEN ON THE COPY CONTROL CARD.                  * 00120000
* THE VERIFICATION ROUTINE, IEHMVSSS, CHECKS THAT A COPY PDS OR COPY  * 00134002
* DSNAME WITH CATLG HAS ALSO SPECIFIED FROM AND/OR RENAME SO THAT THE * 00136002
* CATALOGING CAN TAKE PLACE WITHOUT 'DUPLICATE NAME' ERROR.           * 00138002
*ENTRY POINTS: IEHMVESP                                               * 00140000
*INPUT: NONE                                                          * 00160000
*OUTPUT: NONE                                                         * 00180000
*EXTERNAL ROUTINES: IEHMVSSU                                          * 00200000
*EXITS - NORMAL IEHMVSSK, IEHMVSSZ, IEHMVSST,IEHMVESH                 * 00220002
*        ERRORS: IEHMVSSK                                             * 00240000
*TABLES/WORK AREAS: IEHMVV00                                          * 00260000
*ATTRIBUTES: REENTRANT                                                * 00280000
*                                                                       00300000
********************************************************************    00320000
**                                                                      00340000
**                            IEHMVSSP                                  00360000
**                                                                      00380000
********************************************************************    00400000
*                                                                       00420000
IEHMVSSP CSECT                                                   A19476 00426018
*060000,064200                                                   A19476 00432018
*   024200,064800-065400                                         S21042 00434021
*A1300-1380                                                     YL026VC 00436002
*C600,1000,14000,14200,21600,22600,24000,25600,64700,64720      YL026VC 00438002
*C647800                                                        YL026VC 00438402
*D15000-15200,15600-16400,28800-34200.64760,64784-65600         YL026VC 00438802
*A7500-7540,12500-12584,12900,15300,36100-36120,37500            Y02918 00439202
*C600,2200                                                       Y02918 00439602
*A012500-016599,021900-021920,023500                           @Z40CSJH 00439704
*A023900,028620-028900,065900-065920                           @Z40CSJH 00439804
*A064760,065280                                                @Z40CSJH 00439904
*A028624-028640,065784-065788                                  @Z40CSJH 00446604
A0       EQU   0                                                        00453304
A1       EQU   1                                                        00460000
A2       EQU   2                                                        00480000
A3       EQU   3                                                        00500000
A4       EQU   4                                                        00520000
A5       EQU   5                                                        00540000
A6       EQU   6                                                        00560000
A7       EQU   7                                                        00580000
A8       EQU   8                                                        00600000
A9       EQU   9                                                        00620000
A10      EQU   10                                                       00640000
A11      EQU   11                                                       00660000
A12      EQU   12                                                       00680000
A13      EQU   13                                                       00700000
A14      EQU   14                                                       00720000
A15      EQU   15                                                       00740000
DSGRP    EQU   X'10'                   DSGROUP OPERATION         Y02918 00750002
CATLG    EQU   X'10'                   CATLG OPTION              Y02918 00752002
D1       EQU   1                       DISPLACEMENT OF 1         Y02918 00754002
IEHMVESP BALR  A9,0                                                     00760000
         ENTRY IEHMVESP                                                 00780000
         USING *,A9                                                     00800000
         USING IEHMVV,A12               ESTABLISH ADDR TO COMMUNICATION 00820000
         L     A10,MSGAD                ESTABLISH ADDR TO MESSAGES      00840000
         USING IEHMSGSP,A10                                             00860000
         LA    A8,IEHMVV00+1       ******                               00880000
         LA    A15,4                    *                               00900000
         BAL   A14,MSGCLEAR             *                               00920000
         BAL   A14,MSGDS                *                               00940000
         LA    A15,24                   *    WRITE MESSAGE -            00960000
         BAL   A14,MSG                  *                               00980000
         BAL   A2,LINEPR                *       'DS XX COPIED TO VOL X' 01000000
         SR    A15,A15                  *                               01020000
         BAL   A14,MSGVOL               *                               01040000
         BAL   A2,LINEPR               *                                01060000
         TM    IEHMVV20+3,X'04'        *                                01080000
         BZ    NORE                    *                                01100000
         LA    A8,IEHMVV00+1           *                                01120000
         LA    A15,28                  *    AND IS NOW NAMED YY         01140000
         BAL   A14,MSGCLEAR            *                                01160000
         SR    A15,A15                 *                                01180000
         BAL   A14,MSGDS               *                                01200000
         BAL   A2,LINEPR               *                                01220000
NORE     EQU   *                  ******                                01240000
*********************************************************************   01250004
*        THE FOLLOWING SECTION SUPPORTS THE                    @Z40CSJH 01260004
*        EXTENDED MVS CVOL FUNCTION                            @Z40CSJH 01270004
*********************************************************************   01280004
         TM    IEHMVV20,X'10'           DSGRP SPECIFIED        @Z40CSJH 01282004
         BZ    NOTDSGRP                 BR IF NOT              @Z40CSJH 01284004
         TM    IEHMVV20+1,X'10'         CATLG SPECIFIED        @Z40CSJH 01286004
         BO    CVLCATST                 YES-UNCATLG FIRST      @Z40CSJH 01288004
         B     SKPFR                    SKIP FROM TEST         @Z40CSJH 01288404
NOTDSGRP EQU   *                        NOT DSGRP OP           @Z40CSJH 01288804
         TM    IEHMVV20,X'01'           WAS 'FROM' VOL SPEC'D  @Z40CSJH 01290004
         BO    NOUNCAT                  IF SO, SKIP FROM TEST  @Z40CSRC 01340004
         TM    IEHMVV20+1,X'10'         WAS 'CATLG' SPECIFIED  @Z40CSRC 01342004
         BZ    SKPFR                    NO, SKIP 'RENAME' TEST @Z40CSRC 01344004
         TM    IEHMVV20+3,X'04'         WAS 'RENAME' SPECIFIED @Z40CSRC 01346004
         BZ    CVLCATST                 NO, MAY NEED TO UNCAT  @Z40CSRC 01348004
SKPFR    EQU   *                        SKIP FRM TST           @Z40CSJH 01350004
         TM    IEHMVV20+1,X'20'         WAS 'UNCATALOG' SPEC'D @Z40CSJH 01390004
         BZ    NOUNCAT                    IF NOT ---           @Z40CSJH 01440004
         TM    IEHMVV20+1,X'40'         CVOL SPECIFIED         @Z40CSJH 01450004
         BO    UNCATCVO                 UNCTLG CVOL            @Z40CSJH 01460004
         L     A1,CATCODE1              GET UNCATLG BITS       @Z40CSJH 01470004
         B     UNCAT                    GO UNCATLG             @Z40CSJH 01480004
CVLCATST TM    IEHMVV20+1,X'40'         WAS 'CVOL' SPECIFIED   @Z40CSJH 01482004
         BO    SKPFR                    BR IF YES              @Z40CSJH 01484004
UNCVSAM  L     A1,CATCODE1              GET UNCTLG BITS        @Z40CSJH 01486004
         SR    A3,A3                    CLEAR CVOL INDICATOR   @Z40CSJH 01488004
         B     UNCAT                    GO UNCATLG             @Z40CSJH 01488404
*                                                                       01490004
*********************************************************************   01540004
**                                                                      01590004
**       THIS SECTION TAKES CARE OF UNCATALOGING A DATA SET ON A CVOL   01640004
**       OR SYSRES IF SPECIFIED ON A COPY DATA SET OR VOL REQUEST       01650004
**                                                             @Z40CSJH 01652004
*********************************************************************   01654004
*                                                                       01656004
UNCATCVO L     A1,CATCODE2              LOAD CATALOG CONTRBITS @Z40CSJH 01659604
         L     A3,IEHMVV24              LOAD ADDR OF CVOL LIST @Z40CSJH 01659704
         LA    A3,4(A3)                 BUMP ADDR TO CVOL ID   @Z40CSJH 01659804
* GET CVOL MOUNTED                                             @Z40CSJH 01659904
UNCAT    L     A2,IEHMVV21              LOAD ADDR OF 'FROM' DS NAME     01660000
         SR    A4,A4                    CLEAR A4                        01680000
         STM   A1,A4,IEHMVV00           SET UP PARAMETER LIST           01700000
         CATALOG IEHMVV00               UNCATALOG ON FROM VOL           01720000
         B     *+4(A15)                CHECK ERROR RETURN               01740000
         B     UNCATOK   = 0            OK RETURN                       01760000
         B     UNCATBAD  = 4            NO CATALOG FOUND                01780000
         B     UNCATBAD  = 8            INCONSISTANT STRUCTURE          01800000
         B     UNCATBAD  =12            NOT USED                        01820000
         B     UNCATBAD  =16            NOT USED                        01840000
         B     UNCATBAD  =20            NO SPACE                        01860000
         B     UNCATBAD  =24            IMPROPER NAME                   01880000
         B     UNCATBAD  =28            PERM I/O ERROR                  01900000
UNCATOK  NOP   0(0)                                                     01920000
         LA    A8,IEHMVV00+1       ******                               01940000
         LA    A15,8                    *    WRITE MESSAGE -            01960000
         BAL   A14,MSGCLEAR             *       'DS JUST MOVED-UNCTLG   01980000
         BAL   A2,LINEPR           ******                               02000000
         B     NOUNCAT                                                  02020000
UNCATBAD NOP   0(0)                                                     02040000
         LA    A8,IEHMVV00+1       ******                               02060000
         LA    A15,12                   *    WRITE MESSAGE -            02080000
         BAL   A14,MSGCLEAR             *       'DS JUST MOVED-NOT UNCT 02100000
         BAL   A2,LINEPR           ******                               02120000
         B     NOUNCAT                                                  02140000
NOUNCAT  TM    IEHMVV20+1,X'10'         WAS CATLG SPECIFIED             02160002
         BZ    RETURN                     IF NOT -- -                   02180000
         TM    IEHMVV20+1,X'40'         CVOL SPECIFIED         @Z40CSJH 02190004
         BZ    CATVSAM                  NO-GO VSAM CTLG        @Z40CSJH 02192004
*                                                                       02200000
*********************************************************************   02220000
**                                                                      02240000
**       THIS SECTION HANDLES CATALOGING THE DATA SET                   02260002
**                                                                      02280000
*********************************************************************   02300000
*                                                                       02320000
CATALOG  L     A1,CATCODE3              LOAD CATALOG CONTROL BITS       02340000
         O     A1,CVOLBIT               SET CVOL BIT           @Z40CSJH 02350004
         L     A2,IEHMVV21+4           LOAD ADDR OF TO DSNAME           02360000
         L     A4,IEHMVV10             ADDR OF TO VOL LIST MADE BY SN   02380000
         LA    A3,6(A4)                LOAD ADDR OF CVOL       @Z40CSJH 02390004
         LR    A6,A5                   SAVE REGISTER 5           S21042 02410021
         LA    A5,IEHMVV82+4           LOAD ADDRESS OF TTR       S21042 02412021
         STM   A1,A5,IEHMVV00     STORE PARAMETERS IN PARALIST   S21042 02414021
         LR    A5,A6                   RESET REGISTER 5          S21042 02416021
         CATALOG IEHMVV00               CATALOG THE DATA SET            02440000
         B     *+4(A15)                 CHECK ERROR RETURN              02460000
         B     GOODCAT   = 0            CATALOG OK                      02480000
         B     BADCAT    = 4            NO CATALOG                      02500000
         B     BADCAT    = 8            BAD STRUCTURE                   02520000
         B     BADCAT    =12            NOT USED                        02540000
         B     BADCAT    =16            MISSING INDEX           YL026VC 02560002
         B     BADCAT    =20            NO SPACE                        02580000
         B     BADCAT    =24            BAD GDG NAME                    02600000
         B     BADCAT    =28            PERM I/O ERROR                  02620000
GOODCAT  NOP   0(0)                                                     02640000
         LA    A8,IEHMVV00+1       ******                               02660000
         LA    A15,16                   *    WRITE MESSAGE -            02680000
         BAL   A14,MSGCLEAR             *       'DS JUST MOVED-CTLG     02700000
         BAL   A2,LINEPR           ******                               02720000
         B     RETURN                                                   02740000
BADCAT   NOP   0(0)                                                     02760000
         LA    A8,IEHMVV00+1       ******                               02780000
         LA    A15,20                                                   02800000
         BAL   A14,MSGCLEAR             *       'DS JUST MOVED-NOT CTLG 02820000
         BAL   A2,LINEPR           ******                               02840000
         B     RETURN                                                   02860000
CATVSAM  L     A1,CATCODE3              GET CTLG CONTRL BITS   @Z40CSJH 02862004
CATVSAM2 L     A2,IEHMVV21+4            ADDR OF TO DSNAME      @Z40CSJH 02864004
         L     A4,IEHMVV10              TO VOL LIST            @Z40CSJH 02866004
         SR    A3,A3                    INDICATE NO CVOL       @Z40CSJH 02868004
         LR    A6,A5                    SAVE REG 5             @Z40CSJH 02868404
         LA    A5,IEHMVV82+4            GET TTR ADDR           @Z40CSJH 02868804
         STM   A1,A5,IEHMVV00           PARMS TO PARMLIST      @Z40CSJH 02869204
         LR    A5,A6                    RESET REG 5            @Z40CSJH 02869604
         CATALOG IEHMVV00               CATLG THE DATA SET     @Z40CSJH 02869704
         B     *+4(A15)                 CHECK ERROR RETURN     @Z40CSJH 02869804
         B     GOODCAT                  =0 CATLG OK            @Z40CSJH 02869904
         B     BADCAT                   =4 NO CATLG            @Z40CSJH 02873204
         B     BADCAT                   =8 BAD STRUCTURE       @Z40CSJH 02875204
         B     BADCAT                   =12 NOT USED           @Z40CSJH 02875604
         B     BADCAT                   =16 MISING INDEX       @Z40CSJH 02876004
         B     BADCAT                   =20 NO SPACE           @Z40CSJH 02876504
         B     BADCAT                   =24 BAD GDG NAME       @Z40CSJH 02876604
         B     BADCAT                   =28 PERM I/0 ERROR     @Z40CSJH 02882004
*********************************************************************   02883404
*        LINES 029100-034526 WERE REACTIVATED IN SUPPORT OF    @Z40CSJH 02886704
*        THE EXTENDED MVS CVOL FUNCTION                        @Z40CSJH 02890004
*********************************************************************   02900004
BUILDX   LTR   A5,A5                    CHECK TO SEE IF FIRST TIME IN   02910004
         BZ    BADCAT                     IF NOT ---                    02960004
         L     A1,CATCODE4              LOAD BUILDX CONTROL BITS        03010004
         ST    A1,IEHMVV00              STORE IN PARAMETER LIST         03060004
         SR    A5,A5                    CLEAR A5 FOR FIRST TIME IN CHK  03110004
         L     A3,IEHMVV21+4           ADDR OF 'TO' DSNAME              03160004
         LA    A2,44(A3)               ADDR OF END OF DSNAME            03210004
FINDPER  CLI   0(A3),C'.'               CHECK FOR PERIOD                03260004
         BE    DOBUILD                    IF SO ---                     03310004
         CR    A3,A2                    CHECK FOR END OF NAME           03360004
         BE    DOCAT                      IF SO ---                     03410004
BUMP     LA    A3,1(A3)                 BUMP POINTER UP ONE             03420004
         B     FINDPER                                                  03430004
DOCAT    L     A1,CATCODE3              LOAD CATALOG CONTROL BITS       03432004
         ST    A1,IEHMVV00              STORE IN PARAMETER LIST         03434004
         B     CATALOG                                                  03436004
DOBUILD  MVI   0(A3),C' '               REPLACE . WITH BLANK            03438004
         INDEX IEHMVV00                 BUILD INDEX                     03438404
         MVI   0(A3),C'.'               MOVE . BACK IN                  03438804
         B     *+4(A15)                 CHECK ERROR RETURN              03439204
         B     BUMP      = 0            INDX BUILT                      03439604
         B     BADCAT    = 4            NO CATALOG                      03439704
         B     BUMP  =8                INDEX THERE                      03439804
         B     BADCAT    =12            NOT USED                        03439904
         B     BADCAT    =16            MISSING INDEX                   03446604
         B     BADCAT    =20            NO SPACE                        03448604
         B     BADCAT    =24            NOT USED                        03450604
         B     BADCAT    =28            PERM I/O ERROR                  03452604
*                                                                       03453304
*********************************************************************   03460000
**                                                                      03480000
**       THIS SECTION PASSES CONTROL TO THE NEXT LOAD OF MOVE/COPY      03500000
**                                                                      03520000
*********************************************************************   03540000
*                                                                       03560000
RETURN   IEHPOST ,TC                                                    03580000
         L     14,12(0,13)              RESTORE FINAL WRAP RETURN       03600000
         TM    IEHMVV20,DSGRP          TEST FOR GROUP OPERATION  Y02918 03610002
         BO    ENDGRP                    IF ON ---               Y02918 03612002
         TM    IEHMVV20,X'02'           TEST FOR VOL OPERATION          03620000
         BO    ENDVOL                     IF ON ---                     03640000
         TM    IEHMVV20+2,X'20'        TEST FOR END BIT                 03660000
         BO    END                        IF ON ---                     03680000
         XCTL  (2,12),EP=IEHMVEST                                       03700000
END      XCTL  (2,12),EP=IEHMVESK                                       03720000
ENDVOL   XCTL  (2,12),EP=IEHMVESZ                                       03740000
ENDGRP   XCTL  (2,12),EP=IEHMVESH                                Y02918 03750002
*                                                                       03760000
*********************************************************************   03780000
**                                                                      03800000
**                            MESSAGE MOVER                             03820000
**                                                                      03840000
**       THIS SUBROUTINE IS LINKED TO IN ORDER TO MOVE MESSAGES         03860000
**       FROM THE MESSAGE CSECT TO THE PRINT AREA (IEHMVV00)            03880000
**       THE LINKAGE IS AS FOLLOWS:          A8= LOCATION FOR MSG       03900000
**                                 A14= RETURN ADDR                     03920000
**                       A15= DISPLACEMENT OF ADCON OF CORRECT MSG      03940000
**       WHEN THIS ROUTINE IS DONE A8  WILL POINT ONE SPACE PAST        03960000
**       THE MOVED MESSAGE --- ALL REGISTERS ARE TRANSPARENT            03980000
**       EXCEPT REGISTERS A1 AND A15 -- THE PRINT AREA IS CLEARED       04000000
**       IF THE INSTRUCTION 'MSGCLEAR' IS LINKED TO                     04020000
**                                                                      04040000
*********************************************************************   04060000
*                                                                       04080000
MSGCLEAR MVI   IEHMVV00,X'40'           CLEAR THE PRINT AREA            04100000
         MVC   IEHMVV00+1(120),IEHMVV00                                 04120000
MSG      L     A1,MSGAD                 GET ADDR OF MSG CSECT           04140000
         AR    A1,A15                   ADD DISP OF CORRECT ADCON       04160000
         L     A1,0(A1)                 LOAD ADDR OF MSG-1              04180000
         IC    A15,0(A1)               LOAD LENGTH OF MSG               04200000
         EX    A15,MSGMOVE              EXECUTE MOVE                    04220000
         AR    A8,A15                   CALC ADDR OF END OF MSG         04240000
         LA    A8,2(A8)                BUMP REG TO END OF MSG +1        04260000
         BR    A14                      RETURN                          04280000
MSGMOVE  MVC   0(1,A8),1(A1)           MOVE MSG                         04300000
*                                                                       04320000
*********************************************************************   04340000
**                                                                      04360000
**                            DATA SET NAME MOVER                       04380000
**                                                                      04400000
**       THIS SUBROUTINE IS LINKED TO IN ORDER TO MOVE DATA SET         04420000
**       NAMES INTO A MESSAGE THE LINKAGE IS AS FOLLOWS:                04440000
**                                           A8= LOCATION FOR NAME      04460000
**                                 A14= RETURN ADDR                     04480000
**                       A15= CODE TO DEFINE WHICH DS NAME              04500000
**                             IF A15=0 ---MOVE 'TO' DS NAME            04520000
**                             IF A15= NOT 0 --- MOVE 'FROM' DS NAME    04540000
**       WHEN THIS ROUTINE IS DONE A8 WILL POINT ONE SPACE PAST         04560000
**       THE MOVED NAME                                                 04580000
**                                                                      04600000
*********************************************************************   04620000
*                                                                       04640000
MSGDS    LTR   A15,A15                  TEST FOR A15=0                  04660000
         BZ    TODS                       IF SO BRANCH                  04680000
         L     A15,IEHMVV21             GET ADDR OF 'FROM' DS NAME      04700000
         B     DSMOVE                                                   04720000
TODS     L     A15,IEHMVV21+4           GET ADDR OF 'TO' DS NAME        04740000
DSMOVE   MVC   0(44,A8),0(A15)          MOVE DS NAME TO PRINT AREA      04760000
CHKEND   CLI   0(A8),X'40'              CHECK FOR END OF NAME           04780000
         BE    NAMEEND                    IF REACHED BRANCH ---         04800000
         LA    A8,1(A8)                 BUMP POINTER TO PRINT AREA      04820000
         B     CHKEND                                                   04840000
NAMEEND  LA    A8,1(A8)                 ALLOW FOR SPACE AFTER NAME      04860000
         BR    A14                      RETURN                          04880000
*                                                                       04900000
********************************************************************    04920000
**                                                                      04940000
**                            MESSAGE WRITE CALLER                      04960000
**                                                                      04980000
**       THIS ROUTINE WILL BE LINKED TO WHENEVER A LINE OF OUTPUT       05000000
**       IS TO BE WRITTEN ON 'SYSPRINT' IT WILL HAVE NO PARAMETERS      05020000
**       AND ASSUME THAT THE LINE TO BE WRITTEN IS LOCATED AT IEHMVV00  05040000
**       AFTER THE WRITE IS COMPLETE, CONTROL WILL BE PASSED BACK VIA   05060000
**       A2  UNLESS A PERMINANT I/O ERROR WAS ENCOUNTERED               05080000
**                                                                      05100000
********************************************************************    05120000
*                                                                       05140000
LINEPR   ST    A3,IEHMVV00+128         SAVE REG 3                       05160000
         LA    A3,IEHMVV00             LOAD ADDR OF PRINT AREA          05180000
         LINK EP=IEHMVESU              GO TO MSG WTR                    05200000
         L     A3,IEHMVV00+128                                          05220000
         B     *+4(A15)                 CHECK RETURN CODE               05240000
         B     0(A2)                         =0  OK WRITE               05260000
         IEHPOST ,TC                                                    05280000
         L     14,12(0,13)              RESTORE REG 14                  05300000
         XCTL  (2,12),EP=IEHMVESK                                       05320000
*                                                                       05340000
*********************************************************************   05360000
**                                                                      05380000
**                            VOLUME LIST MOVER                         05400000
**                                                                      05420000
**       THIS ROUTINE IS LINKED TO  IN ORDER TO MOVE A VOLUME LIST      05440000
**       TO THE PRINT AREA PLUS 20 BYTES(IEHMVV00+20)                   05460000
**       THE LINKAGE IS AS FOLLOWS                                      05480000
**                                 A14= RETURN ADDRESS                  05500000
**       THE FORMAT OF THE LIST IS AS FOLLOWS                           05520000
**         FOR DIRECT ACCESS --- 123 7986 A1763 IBM403                  05540000
**         FOR TAPE          --- 24,0001 7987,0007                      05560000
**         FOR UNIT RECORD   --- UNIT RECORD EQUIP -- UNIT = HR         05580000
**                                                                      05600000
**                            A15= CODE TO DEFINE WHICH VOL LIST        05620000
**                                 IF A15=0 --- 'TO' VOL LIST           05640000
**                                 IF A15= NOT ZERO --- 'FROM' VOL LIST 05660000
*********************************************************************   05680000
*                                                                       05700000
MSGVOL   MVI   IEHMVV00,X'40'           CLEAR PRINT AREA                05720000
         ST    A14,SAVE14               SAVE RETURN ADDR                05740000
         SR    A0,A0                    CLEAR A0                        05760000
         MVC   IEHMVV00+1(120),IEHMVV00                                 05780000
         LTR   A15,A15                  CHECK WHICH LIST TO MOVE        05800000
         BZ    TOVOL                      IF 'TO' LIST ---              05820000
         L     A1,IEHMVV22              LOAD ADDR OF FROM VOL LIST      05840000
         IC    A0,IEHMVV22              LOAD NO OF VOLUMES IN FROM LIST 05860000
         B     MOVEVOL                                                  05880000
TOVOL    L     A1,IEHMVV10             LOAD ADDR OF TO VOL LIST         05900000
         LH    A0,0(A1)                LOAD COUNT OF VOLUMES            05920000
         LA    A1,2(A1)                BUMP PTR TO START OF VOL IDS     05940000
MOVEVOL  TM    2(A1),X'08'             TEST FOR VOL = UNIT REC          05960000
         BO    UNITVOL                    IF SO ---                     05980000
         CLI   IEHMVV74+12,X'FF'  WAS OUTPUT ON NL TAPE          A19476 06000018
         BE    UNITVOL                    IF SO ---                     06020000
         LA    A15,IEHMVV00+20          LOAD ADDR OF PRINT AREA+20      06040000
CHKLIST  MVC   0(6,A15),4(A1)           MOVE VOL ID                     06060000
         LA    A15,6(A15)               BUMP REG PAST VOL ID            06080000
         LH    A14,10(A1)               LOAD VOL SEQ                    06100000
         LTR   A14,A14                  CHECK IF TAPE                   06120000
         BZ    SETBLNK                    IF NOT TAPE ---               06140000
         MVI   0(A15),C','              MOVE , TO VOL LIST              06160000
         CVD   A14,IEHMVV00+128         CONVERT TO DEC                  06180000
         UNPK  1(4,A15),IEHMVV00+128(8) UNPACK                          06200000
         OI    4(A15),X'F0'             RESET SIGN                      06220000
         LA    A15,5(A15)               BUMP REG PAST SEQ NO            06240000
SETBLNK  LA    A15,1(A15)               LEAVE SPACE IN VOL LIST         06260000
         LA    A1,12(A1)                                                06280000
         BCT   A0,CHKLIST               LOOP IF MORE VOL ID.S           06300000
         L     A14,SAVE14               RESTORE REG A14                 06320000
         BR    A14                      RETURN                          06340000
SAVE14   DS    F                                                        06360000
UNITVOL  L     A15,MSGAD                LOAD ADDR OF MSG CSECT          06380000
         L     A15,0(A15)               LOAD ADDR OF FIRST MSG          06400000
         MVC   IEHMVV00+20(26),1(A15)      MOVE MSG TO PRINT            06420000
         MVI   IEHMVV74+12,X'00'  TURN NL TAPE SWITCH OFF        A19476 06430018
         BR    A14                      RETURN                          06440000
         DS    0F                                                       06460000
***** IN THE 2 FOLLOWING CAMLST MACRO INSTRUCTIONS ONLY THE FIRSTY02063 06470002
***** FULLWORD (OPTIONBITS) IS ACTIVE                            S21042 06472002
CATCODE1 CAMLST UNCAT,MSGAD            UNCATALOG ON SYSRES       S21042 06474021
CATCODE2 CAMLST UNCAT,MSGAD,MSGAD       UNCATALOG ON CVOL      @Z40CSJH 06476004
CATCODE3 CAMLST CAT,MSGAD,,MSGAD,DSCBTTR=MSGAD CATALOG          YL026VC 06478002
CATCODE4 CAMLST BLDX,MSGAD,MSGAD        BUILD INDEX ON CVOL    @Z40CSJH 06528004
FF       DC    XL4'FFFFFFFF'                                            06578004
MSGAD    DC    A(IEHMSGSP)                                              06580000
CVOLBIT  DC    XL4'80000000'            CVOL BIT FOR SVC26     @Z40CSJH 06590004
PATCH    DS    10F                      PATCH AREA             @Z40CSJH 06592004
         IEHMVV                                                         06600000
IEHMSGSP CSECT                                                          06620000
*                                                                       06640000
*********************************************************************   06660000
**                                                                      06680000
**                            MSG CSECT FOR IEHMVSSP                    06700000
**                                                                      06720000
*********************************************************************   06740000
*                                                                       06760000
         DC    A(MSGA)                                                  06780000
         DC    A(MSGB)                                                  06800000
         DC    A(MSGC)                                                  06820000
         DC    A(MSGD)                                                  06840000
         DC    A(MSGE)                                                  06860000
         DC    A(MSGF)                                                  06880000
         DC    A(MSGG)                                                  06900000
         DC    A(MSGH)                                                  06920000
MSGA     DC    AL1(MSGB-MSGA-2)                                         06940000
         DC    CL26'UNIT REC OR UNLABLED TAPE'                          06960000
MSGB     DC    AL1(MSGC-MSGB-2)                                         06980000
         DC    CL16'        DATA SET'                                   07000000
MSGC     DC    AL1(MSGD-MSGC-2)                                         07020000
         DC    CL31'        THE DATA SET JUST COPIE'                    07040000
         DC    CL30'D HAS BEEN SUCCESSFULLY UNCATA'                     07060000
         DC    CL5'LOGED'                                               07080000
MSGD     DC    AL1(MSGE-MSGD-2)                                         07100000
         DC    CL30'IEH363I THE DATA SET JUST COPI'                     07120000
         DC    CL30'ED WAS NOT SUCCESSFULLY UNCATA'                     07140000
         DC    CL5'LOGED'                                               07160000
MSGE     DC    AL1(MSGF-MSGE-2)                                         07180000
         DC    CL30'        THE DATA SET JUST COPI'                     07200000
         DC    CL30'ED HAS BEEN SUCCESSFULLY CATAL'                     07220000
         DC    CL4'OGED'                                                07240000
MSGF     DC    AL1(MSGG-MSGF-2)                                         07260000
         DC    CL30'IEH364I THE DATA SET JUST COPI'                     07280000
         DC    CL30'ED WAS NOT SUCCESSFULLY CATALO'                     07300000
         DC    CL3'GED'                                                 07320000
MSGG     DC    AL1(MSGH-MSGG-2)                                         07340000
         DC    CL28'HAS BEEN COPIED TO VOLUME(S)'                       07360000
MSGH     DC    AL1(MSGI-MSGH-2)                                         07380000
         DC    CL30'                   AND IS NOW '                     07400000
         DC    CL5'NAMED'                                               07420000
MSGI     EQU   *                                                        07440000
         END                                                            07460000
./  ADD  SSI=72650050,NAME=IEHMVESQ
         TITLE 'IEHMVESQ09 --- DATA SET WRAPUP FOR A MOVE OPERATION'    00020000
*                                                                     * 00040000
*TITLE 'IEHMVSSQ'                                                     * 00060000
*                                                                     * 00080000
*FUNCTION/OPERATION: THIS ROUTINE HANDLES THE WRAPUP PROCEDURE FOR ALL* 00100000
*'MOVE' REQUESTS THIS INCLUDES SCRATCHING THE 'FROM' DATA SET, RE-    * 00120000
*NAMEING THE 'TO' DATA SET IF BOTH THE 'TO' AND 'FROM' DATA SETS START* 00140000
*ED ON THE SAME VOLUME, AND UNCATALOGING OR CATALOGING THE DATASET    * 00160002
*IF IT WAS FOUND VIA A CATALOG.                                       * 00180000
* ON MOVE DSNAME AND MOVE PDS OPERATIONS FOR WHICH THE SOURCE DATA    * 00190002
* SET WAS CATALOGED, THE ASSUMPTION IS MADE THAT THE RECEIVING DATA   * 00192002
* SET CAN BE CATALOGED IN PLACE OF THE SOURCE DATA SET.               * 00194002
* IF THE RECEIVING DATA SET IS TO BE CATALOGED, THE SOURCE DATA SET IS* 00196002
* UNCATALOGED AND THE RECEIVING DATA SET CATALOGED. THE RECATALOG     * 00198004
* SET MUST BE UNCATALOGED TO ALLOW THE USER TO MOVE THE CATALOG ENTRY * 00198402
* FROM ONE CATALOG TO ANOTHER SINCE CVOL IS NOT ALLOWED. THE RECATALOG* 00198802
* MACRO WILL ONLY UPDATE THE VOLUME LIST IN THE SPECIFIED CATALOG AND * 00199202
* NOT ALLOW A CHANGE OF CATALOGS AS THE UNCATALOG-CATALOG SEQUENCE    * 00199602
* WILL.                                                               * 00199702
*                                                                     * 00200000
*ENTRY POINTS: IEHMVESQ                                               * 00220000
*                                                                     * 00240000
*INPUT: NONE                                                          * 00260000
*                                                                     * 00280000
*OUTPUT: NONE                                                         * 00300000
*                                                                     * 00320000
*EXTERNAL ROUTINES- IEHMVSSU(MESSAGE WRITER)                          * 00340000
*                                                                     * 00360000
*EXITS- N O R M A L   IEHMVSSK(FINAL WRAPUP)                          * 00380000
*                                                                     * 00400000
*                     IEHMVSSH(DSGROUP WRAPUP)                        * 00420000
*                                                                     * 00440000
*                     IEHMVSSZ(CONTINUE MOVING DATA SETS)             * 00460000
*                                                                     * 00480000
*                     IEHMVSST(CARD SCANNER)                          * 00500000
*                                                                     * 00520000
*       E R R O R S   IEHMVSSK(FINAL WRAPUP)                          * 00540000
*                                                                     * 00560000
*TABLES/WORK AREAS: NONE                                              * 00580000
*                                                                     * 00600000
*ATTRIBUTES: REENTRANT                                                * 00620000
*                                                                     * 00640000
*NOTE: THIS MODULE WILL PRINT OUT A VOLUME LIST THAT CONTAINS MORE    * 00660000
*THAN FIVE VOLUMES.                                                   * 00680000
*                                                                     * 00700000
         EJECT                                                          00720000
*                                                                       00740000
*********************************************************************   00760000
**                                                                      00780000
**                            IEHMVSSQ                                  00800000
**                                                                      00820000
*********************************************************************   00840000
*                                                                       00860000
IEHMVSSQ CSECT                                                     000H 00870017
* 092800                                                         A35444 00872020
* 039200,044800,047800,048600,049000,092800-094200               S21042 00875421
*                                                                A37862 00877021
* 051000,057000,094200                                           A38740 00879021
*                                                                A41787 00879421
*A087100-087200,092700,094500                                    A41824 00879821
*A016900-017200,057619-057663,077400-077560,087020-087020-087040 A48782 00879922
*A094540-094560                                                  A48782 00886622
*D017000-017240,077400,083600                                    A48782 00888622
*C013720,017800-19200,057666,083400,084200,084600                A48782 00890622
*A1900-1997                                                     YL026VC 00892602
*C1600,35200,36000,36200,37200,37360,38000,38600,46400,50000    YL026VC 00893002
*C51000,52200,92740                                             YL026VC 00893102
*D33000-34600,38800-46200,47000-48900,51100=51120,57120-57593   YL026VC 00893202
*D92760-94300                                                   YL026VC 00899902
*A31700-31760,32700,95220                                        Y)2918 00901902
*D32000,32400-32600,32800                                        Y02918 00903902
*C016800,017000,028600                                         @ZM30153 00905903
*A016920,028500                                                @ZM30153 00906303
*D001980-001984                                                @Z40CSJH 00911100
*A031700-032000,034200-034300,037188-037320                    @Z40CSJH 00913100
*A092744-092757                                                @Z40CSJH 00915100
*A037058-037078                                                @Z40CSJH 00915500
*A018336-018344                                                @ZA11951 00916037
*C018352                                                       @ZA11951 00920837
*A036924-036969                                                @ZA18380 00922800
*C036923,037025                                                @ZA18380 00924800
A0       EQU   0                                                        00925602
A1       EQU   1                                                        00930402
A2       EQU   2                                                        00935200
A3       EQU   3                                                        00940000
A4       EQU   4                                                        00960000
A5       EQU   5                                                        00980000
A6       EQU   6                                                        01000000
A7       EQU   7                                                        01020000
A8       EQU   8                                                        01040000
A9       EQU   9                       IEHMVESQ BASE REGISTER           01060000
A10      EQU   10                      BASE REGISTER FOR MESSAGES       01080000
A11      EQU   11                                                       01100000
A12      EQU   12                      BASE REG FOR COMMUNICATION AREA  01120000
A13      EQU   13                                                       01140000
A14      EQU   14                                                       01160000
A15      EQU   15                                                       01180000
         ENTRY IEHMVESQ                                                 01200000
IEHMVESQ BALR  A9,0                                                     01220000
         USING *,A9                                                     01240000
         USING IEHMVV,A12               ESTABLISH ADDR TO COMMUNICATION 01260000
         EJECT                                                          01280000
*                                                                       01300000
*          V O L U M E    L I S T                                       01320000
*                                                                       01340000
*********************************************************************** 01360000
*       *NUMBER *              *                      *               * 01380000
*BINARY *OF     *              *                      * TAPE          * 01400000
* ZEROS *ENTRIES* DEVICE TYPE  * VOLUME  SERIAL       *    SEQUENCE   * 01420000
*       *IN     *              *       NUMBER         *      NUMBER   * 01440000
*       * LIST  *              *                      *               * 01460000
*       *       *              *                      *               * 01480000
*********************************************************************** 01500000
*       *       *              *                      *               * 01520000
*1-BYTE *1-BYTE *4-BYTES       *6-BYTES               *2-BYTES        * 01540000
*                                                                       01560000
**N O T E S --- THE FIRST TWO BYTES PICTURED ABOVE ARE PRESENT ONLY     01580000
**              IN THE FIRST ENTRY OF THE LIST,THE FIRST BYTE OF        01600000
**              WHICH IS NOT USED. THE TAPE SEQUENCE NUMBER IS ZERO     01620000
**              FOR DASD.                                               01640000
*                                                                       01660000
         L     A3,IEHMVV30+12           ADDR OF 'FROM' DD      @ZM30153 01680003
         XC    FROMVOLL,FROMVOLL        INDICATE NO GETMAIN DONE A48782 01690022
         SR    A1,A1                    CLEAR REGISTER         @ZM30153 01692003
         ICM   A1,3,14(A3)              GET UCB ADDR           @ZM30153 01700003
         LR    A3,A1                                             A48782 01710022
         USING UCB,A3                                            A48782 01720022
         TM    UCBID,X'FF'                                              01728013
         DROP  A3                                                A48782 01732022
         BC    12,SCRH2321                                              01736013
         TM    18(A1),X'20'             TEST FOR FROM VOL BEING         01740000
         BZ    SCRTCHOK                  DIRECT ACCESS - IF NOT BRANCH  01760000
SCRH2321 L     A4,IEHMVV10              ADDR OF 'TO' VOL LIST    A48782 01780022
         SR    A7,A7                                             A48782 01790022
         IC    A7,1(A4)                 NO OF VOLS IN 'TO'LIST   A48782 01792022
         LA    A5,12                    LENGTH OF ENTRY IN LIST  A48782 01794022
         MR    A6,A5                    TOTAL LENGTH OF ENTRIES  A48782 01796022
         LA    A4,3(A4,A7)              ADDR OF END OF 'TO' LIST A48782 01798022
         SRL   A4,1                     PLUS ONE                 A48782 01798422
         SLL   A4,1                     ROUNDED TO HALFWORD BDRY A48782 01798822
         ST    A4,FROMVOLA              SAVE BEGIN OF NEW LIST   A48782 01799222
         SR    A7,A7                                             A48782 01799622
         IC    A7,IEHMVV22              NO OF VOLS IN FROM LIST  A48782 01799722
         LR    A8,A7                    SAVE                     A48782 01799822
         MR    A6,A5                    LENGTH OF ENTRIES IN NEW A48782 01799922
         LA    A0,2(A7)                 LENGTH OF NEW FROM LIST  A48782 01806622
         AR    A4,A0                    END OF NEW FROM LIST     A48782 01808622
         L     A7,IEHMVV10+4            END OF WORKAREA          A48782 01810622
         LA    A7,1(A7)                                          A48782 01812622
         CR    A4,A7                    CHECK IF NEW LIST FITS   A48782 01813022
*                                       IN WORKAREA              A48782 01813122
         BNH   BUILDLST                 IF YES, USE WORKAREA     A48782 01813222
         GETMAIN R,LV=(0)               IF NOT, GETMAIN NEW AREA A48782 01819922
         STH   A0,FROMVOLL              SAVE LENGTH OF AREA      A48782 01821922
         LA    A1,0(A1)                                          A48782 01823922
         ST    A1,FROMVOLA              SAVE ADDR OF VOL LIST    A48782 01825922
BUILDLST L     A7,IEHMVV22              ADDR OF OLD FROM LIST    A48782 01826322
         L     A4,FROMVOLA              LOAD ADDR OF VOL LIST    A48782 01826422
         STH   A8,0(A4)                 STORE NO OF VOLS IN NEW  A48782 01826522
         LA    A6,2(A4)                 SET TO FIRST VOL ENTRY   A48782 01831222
MOVENTRY MVC   0(12,A6),0(A7)           MOVE ENTRY INTO NEW LIST A48782 01833222
         CLI   3(A6),X'00'              IS UNIT TYPE ZERO      @ZA11951 01833737
         BNE   NEXT                     NO, BRANCH             @ZA11951 01834237
         MVC   0(4,A6),16(A3)           GET DEV TYPE FROM UCB  @ZA11951 01834737
NEXT     AR    A6,A5                    NEXT ENTRY IN NEW LIST @ZA11951 01835237
         LA    A7,17(A7)                NEXT ENTRY IN OLD LIST   A48782 01835622
         BCT   A8,MOVENTRY              REPEAT IF MORE ENTRIES   A48782 01835722
         LR    A0,A3                    GET UCB ADDRESS          A48782 01835822
         L     A1,SCRHCODE              LOAD SCRATCH CONTROLBITS A48782 01837222
         L     A2,IEHMVV21              LOAD ADDR OF 'FROM' DSN  A48782 01840022
         SR    A3,A3                    CLEAR A3                 A48782 01920022
         STM   A1,A4,IEHMVV00           STORE PARAMETERS FOR SCRATCH    01940000
         SCRATCH IEHMVV00               SCRATCH THE 'FROM' DATA SET     01960000
         LTR   A15,A15                 TEST RETURN CODE                 01980000
         BZ    SCRTCHOK                ZERO --- SCRATCH OK              02000000
         B     BADSCR                  NON-ZERO SCRATCH NO GOOD - ERROR 02020000
SCRTCHOK DS    0H                                                       02040000
         BAL   A14,BIGMSG          ******    LINK TO WRITE MSG          02060000
         B     RENAME                                                   02080000
         EJECT                                                          02100000
BADSCR   DS    0H                                                       02120000
         BAL   A14,BIGMSG          ******    LINK TO WRITE MSG          02140000
         LA    A8,IEHMVV00+1       ******                               02160000
         LA    A15,16                   *                               02180000
         BAL   A14,MSGCLEAR             *                               02200000
         BAL   A14,MSGDS                *    WRITE MESSAGE-             02220000
         LA    A15,20                   *       'DS XX MAY STILL EXIST' 02240000
         BAL   A14,MSG                  *                               02260000
         BAL   A2,LINEPR                *                               02280000
         LA    A15,ANY                 *                         A37862 02290021
         BAL   A14,MSGVOL               *                               02300000
         BAL   A2,LINEPR           ******                               02320000
         B     RENAME                                                   02340000
BIGMSG   ST    A14,BIG14           ******                               02360000
         LA    A8,IEHMVV00+1            *                               02380000
         LA    A15,4                    *                               02400000
         BAL   A14,MSGCLEAR             *                               02420000
         BAL   A14,MSGDS                *                               02440000
         LA    A15,8                    *                               02460000
         BAL   A14,MSG                                                  02480000
         BAL   A2,LINEPR                *                               02500000
         SR    A15,A15                  *    WRITE MESSAGE-             02520000
         BAL   A14,MSGVOL               *       'DS XX MOVED TO VOL X   02540000
         BAL   A2,LINEPR                *           AND NOW NAMED YY'   02560000
         TM    IEHMVV20+3,RENAM                                         02580000
         BZ    BIGDONE                  *                               02600000
         LA    A8,IEHMVV00+1            *                               02620000
         LA    A15,12                   *                               02640000
         BAL   A14,MSGCLEAR             *                               02660000
         SR    A15,A15                  *                               02680000
         BAL   A14,MSGDS                *                               02700000
         BAL   A2,LINEPR                *                               02720000
BIGDONE  L     A14,BIG14                *                               02740000
         BR    A14                      *                               02760000
         EJECT                                                          02780000
RENAME   TM    IEHMVV20+2,PHONYTO      WAS 'TO' DSNAME FAKED            02800000
         BZ    FROMKEY                 NO - BRANCH                      02820000
         L     A1,IEHMVV31+8           YES -- GET ADDRESS OF 'TO' DDNAM 02840000
         SR    A0,A0                    CLEAR REGISTER         @ZM30153 02850003
         ICM   A0,3,14(A1)              LOAD UCB ADDR          @ZM30153 02860003
         L     A1,RENMCODE              LOAD RENAME CONTROL BITS        02880000
         L     A2,IEHMVV21+4            LOAD ADDR OF 'TO' DS NAME       02900000
         L     A3,IEHMVV21              LOAD ADDR OF 'FROM' DS NAME     02920000
         L     A4,IEHMVV10             ADDR OF TO VOL LIST MADE BY SN   02940000
         STM   A1,A4,IEHMVV00           STORE PARAMETERS FOR RENAME     02960000
         RENAME IEHMVV00                RENAME THE 'TO' DATA SET        02980000
         LTR   A15,A15                 TEST RETURN CODE -- ZERO IS OK   03000000
         BZ    FROMKEY                 RENAME WORKED OK                 03020000
         LA    A8,IEHMVV00+1       ******                               03040000
         LA    A15,24                   *    WRITE MESSAGE -            03060000
         BAL   A14,MSGCLEAR             *       'DS MAY HAVE GEN NAME'  03080000
         BAL   A2,LINEPR                *                               03100000
         SR    A15,A15                  *                               03120000
         BAL   A14,MSGVOL               *                               03140000
         BAL   A2,LINEPR           ******                               03160000
**********************************************************************  03170004
*        LINES 032100-034796 WERE REACTIVATED IN SUPPORT       @Z40CSJH 03180004
*        OF THE EXTENDED MVS CVOL FUNCTION                     @Z40CSJH 03190004
**********************************************************************  03192004
FROMKEY  MVI   IEHMVV00+16,X'00'       CLEAR SW                         03260004
         TM    IEHMVV20+1,X'40'         WAS CVOL SPECIFIED              03320004
         BO    CVOLCAT                  YES-TO CATLG CVOL               03330004
         TM    IEHMVV20,X'10'          TEST FOR GROUP OPERATION         03360004
         BO    RECATRSA                 IF SO- CHECK FOR NAME           03410004
         TM    IEHMVV20,X'01'           IS FROM BIT SET        @Z40CSJH 03420004
         BO    RETURN                   YES - TO RETURN        @Z40CSJH 03430004
         TM    IEHMVV20,X'20'           DSNAME SPECIFIED                03460004
         BO    RECATRES                 YES-TO VSAM CATLG               03470004
         TM    IEHMVV20,X'08'           PDS SPECIFIED                   03472004
         BO    RECATRES                 YES-TO VSAM CATLG               03472404
         B     FROMKEYA                 TO CHECK UNCATLG                03472804
RECATRSA TM    IEHMVV20+5,X'20'         DSGRP NAME SPEC.                03473204
         BO    RECATRES                 YES=TO VSAM CATLG               03473604
         B     RECATRSC                 TO SYSRES HNDLING               03473704
FROMKEYA TM    IEHMVV20+1,X'20'         WAS UNCATALOG SPECIFIED         03474004
         BO    UNCATRES                   IF SO ---                     03476004
         B     RECATRSC                   IF NOT ---                    03478004
CVOLCAT  DS    0H                                                       03478404
         TM    IEHMVV20+1,X'20'         WAS UNCATALOG SPECIFIED         03478804
         BO    UNCATVOL                   IF SO ---                     03479204
         B     RECATVOL                   IF NOT ---                    03479604
         EJECT                                                          03480000
********************************************************************    03500000
**       HANDLES UNCATALOGING IF UNCATLG KEYWORD SPECIFIED              03520002
********************************************************************    03540000
UNCATRES L     A1,CATCODE1              LOAD UNCATALOG CONTROL BITS     03560000
         L     A2,IEHMVV21              LOAD ADDR OF 'FROM' DSNAME      03580000
         SR    A3,A3                    INDICATE NO CVOL                03600002
         SR    A4,A4                    SET SWITCH                      03620002
         B     CATALOGY                                                 03640004
*********************************************************************   03650004
*                                                                       03652004
*     THIS ROUTINE HANDLES UNCATALOGING-CATALOGING OF A DATA SET        03654004
*     IF IT WAS DEFINED IN THE VSAM MASTER CATALOG                      03656004
*                                                                       03658004
*********************************************************************   03658404
RECATRES EQU   *                                                        03668404
         L     A2,IEHMVV21              GET @ OF FROM DSNAME            03670404
         L     A4,IEHMVV10              GET @ OF TO VOL LIST            03672404
         SR    A3,A3                    INDICATE NO CVOL                03674404
         L     A1,CATCODE1              UNCATLG CONTROL BITS            03676404
         MVI   IEHMVV00+16,X'FF'                                        03676504
         B     CATALOG                  BR TO CATALOG OPER.             03682304
REDOCAT  EQU   *                                               @ZA18380 03692300
         L     A2,IEHMVV21+4            GET @ OF TO DSNAME     @ZA18380 03692400
         TM    IEHMVV20+3,X'04'         RENAME SPECIFIED       @ZA18380 03692500
         BO    RENAME1                  YES, BRANCH AROUND     @ZA18380 03692600
         L     A2,IEHMVV21              GET @ OF FROM DSNAME   @ZA18380 03696900
RENAME1  L     A1,CATCODE5             LOAD CATLG CONTROL BITS @ZA18380 03702500
CATALOG1 LA    A10,IEHMVV82+4           GET @ OF TTR FIELD              03706804
         ST    A10,IEHMVV00+16          STORE IN PARM LIST              03711104
CATALOG  STM   A1,A4,IEHMVV00           STORE PARM LIST                 03715404
         CATALOG IEHMVV00                                               03719704
         LTR   A15,A15                  TEST RETURN CODE                03724004
         BC    7,CATBAD                 BR + OR -,0 OK                  03728304
         LTR   A4,A4                    WAS UNCATLG ATTEMPTED           03732604
         BZ    UNCATOK                  YES - BRANCH                    03736904
         TM    IEHMVV20+1,X'20'         WAS UNCATLG SPEC'D     @Z40CSJH 03741204
         BO    UNCATOK                  BRANCH IF YES          @Z40CSJH 03745504
         CLI   IEHMVV00+16,X'FF'        CATLG/UNCATLG PAIR              03749804
         BE    REDOCAT                  IF SO ---                       03754104
         LA    A8,IEHMVV00+1            *****                           03758404
         LA    A15,32                   *   WRITE MESSAGE-              03762704
         BAL   A14,MSGCLEAR             * 'DS MOVED-RECATLG             03767004
         BAL   A2,LINEPR                *****                           03771304
         B     RETURN                   TO NEXT MODULE                  03775604
*                                                                       03779904
********************************************************************    03784204
*        LINES 031700-058271 WERE REACTIVATED IN SUPPORT       @Z40CSJH 03788504
*        OF THE EXTENDED MVS CVOL FUNCTION                     @Z40CSJH 03792804
*                                                              @Z40CSJH 03797104
********************************************************************    03801404
**                                                                      03805704
**       HANDLES RECATALOGING ON SYS RES                                03810004
**                                                                      03860004
********************************************************************    03910004
*                                                                       03960004
RECATRSC L     A1,CATCODE2              LOAD RECATALOG CONTROL BITS     04010004
         L     A2,IEHMVV21              LOAD ADDR OF 'FROM' DSNAME      04060004
         L     A4,IEHMVV10             ADDR OF TO VOL LIST MADE BY SN   04110004
         SR    A3,A3                    CLEAR A3                        04160004
         TM    IEHMVV20+3,X'04'        WAS RENAME SPEC                  04210004
         BO    RERECAT1                   IF SO ---                     04260004
         B     CATALOGX                                          S21042 04310004
*                                                                       04360004
********************************************************************    04410004
**                                                                      04460004
**       HANDLES UNCATALOGING ON A CVOL                                 04510004
**                                                                      04560004
********************************************************************    04610004
*                                                                       04660004
UNCATVOL L     A1,CATCODE3              LOAD UNCATALOG CONTROL BITS     04710004
         L     A2,IEHMVV21              LOAD ADDR OF FROM DS NAME       04760004
         L     A3,IEHMVV24              LOAD ADDR OF CVOL LIST          04810004
         LA    A3,4(A3)                 BUMP POINTER TO VOL ID          04860004
         SR    A4,A4                    CLEAR A4                        04910004
         B     CATALOGY                                                 04960004
*                                                                       05010004
********************************************************************    05060004
**                                                                      05110004
**       HANDLES RECATALOGING ON A CVOL                                 05160004
**                                                                      05210004
********************************************************************    05260004
*                                                                       05310004
RECATVOL L     A1,CATCODE4              LOAD RECATALOG CONTROL BITS     05360004
         L     A2,IEHMVV21              LOAD ADDR OF 'FROM' DS NAME     05410004
         L     A3,IEHMVV24              LOAD ADDR OF CVOL LIST          05460004
         LA    A3,4(A3)                 BUMP TO POINT TO VOL ID         05510004
         L     A4,IEHMVV10             ADDR OF TO VOL LIST MADE BY SN   05560004
         TM    IEHMVV20+3,X'04'        WAS RENAME SPEC                  05610004
         BO    RERECAT2                   IF SO ---                     05660004
         B     CATALOGX                                          S21042 05710004
*                                                                       05720004
*********************************************************************   05730004
**                                                                      05740004
**       HANDLES RECATALOGING A RENAMED DATA SET                        05750004
**                                                                      05752004
*********************************************************************   05754004
*                                                                       05756004
RERECAT1 L     A1,CATCODE1             LOAD CATALOG CONTROL BITS        05758004
         MVI   IEHMVV00+16,X'FF'                                        05758404
         B     CATALOGY                                                 05758804
RERECAT2 L     A1,CATCODE3             LOAD CATALOG CONTROL BITS        05759204
         MVI   IEHMVV00+16,X'FF'                                        05759604
         B     CATALOGY                                                 05759704
REDOCATA L     A2,IEHMVV21+4           LOAD ADDR OF TO DSNAME           05759804
         TM    IEHMVV20+1,X'40'        WAS CVOL SPEC                    05763804
         BO    CATCVOL                    IF SO ---                     05765804
         L     A1,CATCODE5             LOAD CATALOG CONTROL BITS        05767804
         B     CATALOGX                                          S21042 05767904
CATCVOL  L     A1,CATCODE6             LOAD CATALOG CONTROL BITS        05769204
*        B     CATALOGX BE CARE *** NO INSTRUCTION *** COMMENT   S21042 05771204
*                                                                       05771604
********************************************************************    05771704
**                                                                      05771804
**       THIS ROUTINE ISSUES THE 'CATALOG' MACRO FOR UNCATALOGING       05771904
**         OR RECATALOGING THE MOVED DATA SET                           05776204
**                                                                      05778204
********************************************************************    05780204
*                                                                       05780604
CATALOGX LA    A10,IEHMVV82+4          LOAD ADDRESS TTR FIELD    S21042 05781004
         ST    A10,IEHMVV00+16         STORE IT IN PARAMETERLIST S21042 05781104
CATALOGY STM   A1,A4,IEHMVV00           STORE PARAMETER LIST            05781204
         CATALOG  IEHMVV00              UNCATALOG OR RECATALOG          05782104
         CH    A15,=H'16'              MISSING INDEX             A38740 05782504
         BE    BUILDX                  IF SO, BUILD INDEX        A38740 05782904
         LTR   A15,A15                 TEST RETURN CODE                 05783304
         BC    7,CATBAD                BRANCH ON PLUS OR MINUS - ZERO   05783704
*                                      IS THE ONLY CODE THATS OK        05783804
         LTR   A4,A4                   TEST TO SEE IF UNCATALOG WAS     05783904
         BZ    UNCATOK                   ATTEMPTED - IF SO BRANCH       05784904
         CLI   IEHMVV00+16,X'FF'       IS THIS A RENAME,RECATALOG       05786904
         BE    REDOCATA                   IF SO ---                     05787904
         LA    A8,IEHMVV00+1       ******                               05789904
         LA    A15,32                   *    WRITE MESSAGE-             05790904
         BAL   A14,MSGCLEAR             *       'DS JUST MOVED-RECTLG   05792904
         BAL   A2,LINEPR           ******                               05793204
         B     RETURN                                                   05793604
UNCATOK  DS    0H                                                       05793704
         LA    A8,IEHMVV00+1       ******                               05793804
         LA    A15,28                   *    WRITE MESSAGE-             05793904
         BAL   A14,MSGCLEAR             *       'DS JUST MOVED-UNCTLG   05794704
         BAL   A2,LINEPR           ******                               05796704
         B     RETURN                                                   05797004
CATBAD   LTR   A4,A4                    TEST TO SEE IF UNCATALOG WAS    05797404
         BZ    UNCATBAD                   ATTEMPTED -- IF SO BRANCH     05797804
         LA    A8,IEHMVV00+1       ******                               05797904
         LA    A15,40                   *    WRITE MESSAGE-             05798004
         BAL   A14,MSGCLEAR             *       'DS JUST MOVED-NOT RECT 05798104
         BAL   A2,LINEPR           ******                               05798204
         B     RETURN                                                   05801604
UNCATBAD DS    0H                                                       05803604
         LA    A8,IEHMVV00+1       ******                               05805604
         LA    A15,36                   *    WRITE MESSAGE-             05805704
         BAL   A14,MSGCLEAR             *       'DS JUST MOVED-NOT UNCT 05805804
         BAL   A2,LINEPR           ******                               05805904
         B     RETURN                                            A38740 05806304
BUILDX   LTR   A5,A5                   CHECK FOR FIRST TIME      A38740 05806704
         BZ    CATBAD                  IF NOT ---                A38740 05806804
         L     A1,CATCODE7             LOAD BUILDX CONTROL BITS  A38740 05806904
         ST    A1,IEHMVV00             STORE IN PARAMETER LIST   A38740 05807004
         SR    A5,A5                   CLEAR A5 FOR FIRST TIME IN CHECK 05808104
         L     A3,IEHMVV21+4           ADDRESS OF TO-DSNAME      A38740 05810104
         LA    A2,44(A3)               ADDRESS OF END OF DSNAME  A38740 05810204
FINDPER  CLI   0(A3),C'.'              CHECK FOR PERIOD          A38740 05811304
         BE    DOBUILD                   IF SO ---               A38740 05813304
         CR    A3,A2                   CHECK FOR END OF NAME     A38740 05813404
         BE    DOCAT                   IF SO ---                 A38740 05814304
BUMP     LA    A3,1(A3)                BUMP POINTER UP ONE       A38740 05816304
         B     FINDPER                                           A38740 05816804
DOCAT    L     A1,CATCODE6             LOAD CATALOG CONTROL BITS A38740 05817204
         L     A2,IEHMVV21+4                                     A38740 05817604
         L     A4,IEHMVV10                                       A38740 05818004
         L     A3,IEHMVV24             LOAD ADDR OF CVOL LIST  @XA04175 05818104
         LA    A3,4(A3)                BUMP TO POINT TO VOL ID @XA04175 05821304
         B     CATALOGY                GO AND CATALOG          @XA04175 05823304
DOBUILD  MVI   0(A3),C' '              REPLACE . WITH BLANK      A38740 05823704
         INDEX IEHMVV00                BUILD INDEX               A38740 05824104
         MVI   0(A3),C'.'              MOVE . BACKM IN           A38740 05824504
         B     *+4(A15)                                          A38740 05824604
         B     BUMP                                              A38740 05824704
         B     CATBAD                                            A38740 05825204
         B     BUMP                                              A38740 05825604
         B     CATBAD                                            A38740 05826004
         B     CATBAD                                            A38740 05826104
         B     CATBAD                                            A38740 05826204
         B     CATBAD                                            A38740 05826304
         B     CATBAD                                            A38740 05827104
         EJECT                                                          05829004
RETURN   LH    A0,FROMVOLL              LENGTH OF GETMAIN AREA   A48782 05829804
         LTR   A0,A0                    CHECK LENGTH             A48782 05831204
         BZ    RETURN1                  IF ZERO, NO GETMAIN DONE A48782 05834404
         FREEMAIN R,LV=(0),A=FROMVOLA   IF NOT ZERO, FREE AREA   A48782 05837604
RETURN1  IEHPOST ,TC                                             A48782 05840804
         L     14,12(0,13)             RESTORE REG 14 TO KEEP PTR HOME  05844004
         TM    IEHMVV20,X'10'          TEST FOR GROUP OPERATION         05847204
         BO    ENDGRP                     IF SO ---                     05850404
         TM    IEHMVV20,X'02'          TEST FOR VOLUME OPERATION        05853604
         BO    ENDVOL                     IF SO -----                   05856804
         TM    IEHMVV20+2,X'20'        TEST FOR END BIT                 05860000
         BO    END                        IF ON ---                     05880000
         LA    A1,EST                  GO TO CARD SCANNER               05900000
EOJ      XCTL  (2,12),EPLOC=(A1)                                        05920000
END      LA    A1,ESK                  GO TO FINAL WRAPUP               05940000
         B     EOJ                                                      05960000
ENDGRP   LA    A1,ESH                  GO TO GROUP WRAPUP               05980000
         B     EOJ                                                      06000000
ENDVOL   LA    A1,ESZ                  CONTINUE VOLUME OPERATION        06020000
         B     EOJ                                                      06040000
         SPACE 4                                                        06060000
         DS    0D                                                       06080000
EST      DC    CL8'IEHMVEST'           CARD SCANNER ROUTINE             06100000
ESK      DC    CL8'IEHMVESK'           FINAL WRAPUP ROUTINE             06120000
ESH      DC    CL8'IEHMVESH'           GROUP WRAPUP ROUTINE             06140000
ESZ      DC    CL8'IEHMVESZ'           VOLUME MOVE ROUTINE              06160000
         EJECT                                                          06180000
*                                                                       06200000
*********************************************************************   06220000
**                                                                      06240000
**                            MESSAGE MOVER                             06260000
**                                                                      06280000
**       THIS SUBROUTINE IS LINKED TO IN ORDER TO MOVE MESSAGES         06300000
**       FROM THE MESSAGE CSECT TO THE PRINT AREA (IEHMVV00)            06320000
**       THE LINKAGE IS AS FOLLOWS:          A8= LOCATION FOR MSG       06340000
**                                 A14= RETURN ADDR                     06360000
**                       A15= DISPLACEMENT OF ADCON OF CORRECT MSG      06380000
**       WHEN THIS ROUTINE IS DONE A8  WILL POINT ONE SPACE PAST        06400000
**       THE MOVED MESSAGE --- ALL REGISTERS ARE TRANSPARENT            06420000
**       EXCEPT REGISTERS A1 AND A15 -- THE PRINT AREA IS CLEARED       06440000
**       IF THE INSTRUCTION 'MSGCLEAR' IS LINKED TO                     06460000
**                                                                      06480000
*********************************************************************   06500000
*                                                                       06520000
MSGCLEAR MVI   IEHMVV00,C' '           CLEAR THE PRINT AREA             06540000
         MVC   IEHMVV00+1(120),IEHMVV00                                 06560000
MSG      L     A1,MSGAD                 GET ADDR OF MSG CSECT           06580000
         AR    A1,A15                   ADD DISP OF CORRECT ADCON       06600000
         L     A1,0(A1)                 LOAD ADDR OF MSG-1              06620000
         IC    A15,0(A1)               LOAD LENGTH OF MSG               06640000
         EX    A15,MSGMOVE              EXECUTE MOVE                    06660000
         AR    A8,A15                   CALC ADDR OF END OF MSG         06680000
         LA    A8,2(A8)                BUMP REG TO END OF MSG +1        06700000
         BR    A14                      RETURN                          06720000
MSGMOVE  MVC   0(1,A8),1(A1)           MOVE MSG                         06740000
         EJECT                                                          06760000
*                                                                       06780000
*********************************************************************   06800000
**                                                                      06820000
**                            DATA SET NAME MOVER                       06840000
**                                                                      06860000
**       THIS SUBROUTINE IS LINKED TO IN ORDER TO MOVE DATA SET         06880000
**       NAMES INTO A MESSAGE THE LINKAGE IS AS FOLLOWS:                06900000
**                                           A8= LOCATION FOR NAME      06920000
**                                 A14= RETURN ADDR                     06940000
**                       A15= CODE TO DEFINE WHICH DS NAME              06960000
**                             IF A15=0 ---MOVE 'TO' DS NAME            06980000
**                             IF A15= NOT 0 --- MOVE 'FROM' DS NAME    07000000
**       WHEN THIS ROUTINE IS DONE A8 WILL POINT ONE SPACE PAST         07020000
**       THE MOVED NAME                                                 07040000
**                                                                      07060000
*********************************************************************   07080000
*                                                                       07100000
MSGDS    LTR   A15,A15                  TEST FOR A15=0                  07120000
         BZ    TODS                       IF SO BRANCH                  07140000
         L     A15,IEHMVV21             GET ADDR OF 'FROM' DS NAME      07160000
         B     DSMOVE                                                   07180000
TODS     L     A15,IEHMVV21+4           GET ADDR OF 'TO' DS NAME        07200000
DSMOVE   MVC   0(44,A8),0(A15)          MOVE DS NAME TO PRINT AREA      07220000
CHKEND   CLI   0(A8),C' '              CHECK FOR END OF NAME            07240000
         BE    NAMEEND                    IF REACHED BRANCH ---         07260000
         LA    A8,1(A8)                 BUMP POINTER TO PRINT AREA      07280000
         B     CHKEND                                                   07300000
NAMEEND  LA    A8,1(A8)                 ALLOW FOR SPACE AFTER NAME      07320000
         BR    A14                      RETURN                          07340000
         EJECT                                                          07360000
*                                                                       07380000
********************************************************************    07400000
**                                                                      07420000
**                            MESSAGE WRITE CALLER                      07440000
**                                                                      07460000
**       THIS ROUTINE WILL BE LINKED TO WHENEVER A LINE OF OUTPUT       07480000
**       IS TO BE WRITTEN ON 'SYSPRINT' IT WILL HAVE NO PARAMETERS      07500000
**       AND ASSUME THAT THE LINE TO BE WRITTEN IS LOCATED AT IEHMVV00  07520000
**       AFTER THE WRITE IS COMPLETE, CONTROL WILL BE PASSED BACK VIA   07540000
**       A2 UNLESS A PERMANENT I/O ERROR WAS ENCOUNTERED                07560000
**                                                                      07580000
********************************************************************    07600000
*                                                                       07620000
LINEPR   LA    A3,IEHMVV00             LOAD ADDRESS OF PRINT AREA       07640000
         LINK EP=IEHMVESU              GO TO MSG WTR                    07660000
         LTR   A15,A15                 CHECK RETURN CODE                07680000
         BZ    0(A2)                   IF ZERO WRITE OK - IF NOT EOJ    07700000
* E R R O R    E X I T                                                  07720000
         LH    A0,FROMVOLL              LENGTH OF GETMAIN AREA   A48782 07740022
         LTR   A0,A0                    CHECK LENGTH             A48782 07750022
         BZ    ERREXIT                  IF ZERO, NO GETMAIN DONE A48782 07752022
         FREEMAIN R,LV=(0),A=FROMVOLA   IF NOT ZERO, FREE AREA   A48782 07754022
ERREXIT  IEHPOST ,TC                                             A48782 07756022
         L     14,12(0,13)              RESTORE REG 14                  07760000
         SPACE 2                                                        07780000
         XCTL  (2,12),EP=IEHMVESK                                       07800000
         EJECT                                                          07820000
*                                                                       07840000
*********************************************************************   07860000
**                                                                      07880000
**                            VOLUME LIST MOVER                         07900000
**                                                                      07920000
**       THIS ROUTINE IS LINKED TO  IN ORDER TO MOVE A VOLUME LIST      07940000
**       TO THE PRINT AREA PLUS 20 BYTES(IEHMVV00+20)                   07960000
**       THE LINKAGE IS AS FOLLOWS                                      07980000
**                                 A14= RETURN ADDRESS                  08000000
**       THE FORMAT OF THE LIST IS AS FOLLOWS                           08020000
**         FOR DIRECT ACCESS --- 123 7986 A1763 IBM403                  08040000
**         FOR TAPE          --- 24,0001 7987,0007                      08060000
**         FOR UNIT RECORD   --- UNIT RECORD EQUIP -- UNIT = HR         08080000
**                                                                      08100000
**                            A15= CODE TO DEFINE WHICH VOL LIST        08120000
**                                 IF A15=0 --- 'TO' VOL LIST           08140000
**                                 IF A15= NOT ZERO --- 'FROM' VOL LIST 08160000
*********************************************************************   08180000
*                                                                       08200000
MSGVOL   MVI   IEHMVV00,C' '           CLEAR PRINT AREA                 08220000
         MVC   IEHMVV00+1(120),IEHMVV00                                 08240000
         ST    A14,SAVE14               SAVE RETURN ADDR                08260000
         XR    A7,A7                   CLEAR A7                         08280000
         LTR   A15,A15                  CHECK WHICH LIST TO MOVE        08300000
         BZ    TOVOL                      IF 'TO' LIST ---              08320000
         L     A5,FROMVOLA             ADDRESS OF FROM VOL LIST  A48782 08340022
         B     MOVEVOL                                                  08380000
TOVOL    L     A5,IEHMVV10             LOAD ADR OF 'TO' VOLUME LIST     08400000
MOVEVOL  IC    A7,1(A5)                LOAD NO OF VOLS IN TO LST A48782 08420022
         LA    A5,2(A5)                BUMP PTR TO START OF VOL LIST    08440000
         TM    2(A5),X'08'             TEST DEVTYPE UNIT RECORD  A48782 08460022
         BO    UNITVOL                    IF SO ---                     08480000
         CLI   IEHMVV74+12,X'FF'  WAS OUTPUT ON NL TAPE          A19476 08500018
         BE    UNITVOL                    IF SO ---                     08520000
         LA    A6,8                    LOAD MAX VOLUME COUNT PER LINE   08540000
PRTLIST  DS    0H                                                       08560000
         LA    A11,IEHMVV00+20         LOAD ADDRESS OF PRINT AREA       08580000
         CR    A7,A6                   COMPARE MAX VALUE TO ACTUAL      08600000
         LR    A0,A7                   LOAD COUNT IN CASE NOT HIGH      08620000
         BNH   CHKLIST                 IF NOT HIGHER CONTINUE NORMALLY  08640000
         LR    A0,A6                   MOVE MAX TO LOOP CONTROL REG     08660000
CHKLIST  MVC   0(6,A11),4(A5)          MOVE VOLUME SERIAL NUMBER        08680000
         LA    A11,6(A11)              BUMP PTR PAST VOLUME SERIAL NO.  08700000
         CLI   2(A5),X'80'             CHECK TAPE                A48782 08702022
         BNE   SETBLNK                 IF NOT, OMIT SEQNO IN LST A48782 08704022
         MVC   SEQNR(2),10(A5)    MOVE VOL. SEQ.NR.              A41824 08710021
         LH    A14,SEQNR          LOAD VOL. SEQ.NR.              A41824 08720021
         MVI   0(A11),C','             MOVE COMMA TO PRINT AREA         08780000
         CVD   A14,IEHMVV00+128         CONVERT TO DEC                  08800000
         UNPK  1(4,A11),IEHMVV00+128(8) UNPACK TAPE SEQUENCE NUMBER     08820000
         OI    4(A11),X'F0'            RESET SIGN TO PRINTABLE CHAR.    08840000
         LA    A11,5(A11)              BUMP PTR PAST TAPE SEQUENCE NO.  08860000
SETBLNK  LA    A11,1(A11)              LEAVE SPACE IN PRINT AREA        08880000
         LA    A5,12(A5)               BUMP PTR TO NEXT ENTRY IN LIST   08900000
         BCTR  A7,A0                   REDUCE INITIAL VOLUME COUNT ALSO 08920000
         BCT   A0,CHKLIST               LOOP IF MORE VOL ID.S           08940000
         OR    A0,A7                   TEST FOR VOLUME LIST FINISHED    08960000
         BZ    NOMORE                  INITIAL COUNT ZERO ALSO - END    08980000
         BAL   A2,LINEPR               BRANCH TO PRINT FIRST LINE       09000000
         MVI   IEHMVV00,C' '           CLEAR PRINT AREA AFTER PRINTING  09020000
         MVC   IEHMVV00+1(120),IEHMVV00                                 09040000
         B     PRTLIST                 REPEAT LOOP TO PRINT REST OF LST 09060000
NOMORE   DS    0H                                                       09080000
         L     A14,SAVE14               RESTORE REG A14                 09100000
         BR    A14                      RETURN                          09120000
UNITVOL  L     A15,MSGAD                LOAD ADDR OF MSG CSECT          09140000
         L     A15,0(A15)               LOAD ADDR OF FIRST MSG          09160000
         MVC   IEHMVV00+20(26),1(A15)      MOVE MSG TO PRINT            09180000
         MVI   IEHMVV74+12,X'00'  TURN NL TAPE SWITCH OFF        A19476 09190018
         BR    A14                      RETURN                          09200000
*                                                                       09220000
*          C O N S T A N T S                                            09240000
*                                                                       09260000
         DS    0F                                                A41824 09270021
SCRHCODE CAMLST  SCRATCH,MSGAD,,MSGAD                            S21042 09270121
RENMCODE CAMLST  RENAME,MSGAD,MSGAD,MSGAD                        S21042 09272021
CATCODE1 CAMLST  UNCAT,MSGAD         UNCATALOG ON SYSRES         S21042 09274002
**********************************************************************  09274404
* LINES 092760,093280,093780,094280,094380 WERE                @Z40CSJH 09274804
* REACTIVATED IN SUPPORT OF THE EXTENDED MVS                   @Z40CSJH 09275204
* CVOL FUNCTION                                                @Z40CSJH 09275604
**********************************************************************  09275704
CATCODE2 CAMLST RECAT,MSGAD,,MSGAD,DSCBTTR=MSGAD RECAT ON SYSRES S21042 09276004
CATCODE5 CAMLST CAT,MSGAD,,MSGAD,DSCBTTR=MSGAD CATALOG ON SYSRES S21042 09278021
CATCODE3 CAMLST  UNCAT,MSGAD,MSGAD           UNCATALOG ON CVOL   S21042 09328004
CATCODE4 CAMLST RECAT,MSGAD,MSGAD,MSGAD,DSCBTTR=MSGAD   CVOL     S21042 09378004
CATCODE6 CAMLST CAT,MSGAD,MSGAD,MSGAD,DSCBTTR=MSGAD    CVOL      S21042 09428004
CATCODE7 DC    XL4'84400000'           FOR BUILD INDEX           A38740 09438004
SAVE14   DS    F                       AREA TO SAVE REG 14 FOR PRT LOOP 09440000
SEQNR    DS    H                  AREA TO SAVE VOL.SEQ.NR.       A41824 09450021
FROMVOLL DS    H                       LENGTH OF GETMAIN AREA    A48782 09452022
FROMVOLA DS    F                       ADDRESS OF GETMAIN AREA   A48782 09454022
MSGAD    DC    V(IEHMVMSQ)             ADDRESS OF MESSAGE MODULE        09460000
BIG14    DS    F                       REG 14 SAVE AREA FOR BIGMSG ROUT 09480000
RENAM    EQU   X'04'                                                    09500013
PHONYTO  EQU   X'10'                                                    09520013
DSGRP    EQU   X'10'                   GROUP OPERATION           Y02918 09522002
ANY      EQU   1                       ANY VALUE NOT ZERO        A37862 09530021
PATCH    DS    10F                      PATCH AREA                      09532004
         IEHMVV                                                         09540000
UCB      DSECT                                                          09546013
         IEFUCBOB                                                       09552013
         END                                                            09560000
./  ADD  SSI=62440129,NAME=IEHMVESR
*TITLE B'I                                                            * 00020000
*   'IEHMVSSR - GETMEMBER NAME'                                       * 00040000
*FUNCTION/OPERATION:                                                  * 00060000
*   THIS ROUTINE GETS PDS DIRECTORY ENTRIES FROM A WORK DATA SET AND  * 00080000
*   PASSES THEM TO THE CALLING ROUTINE. IF ANY ALIAS ENTRIES EXIST FOR* 00100000
*   A GIVEN ENTRY THESE WILL BE PASSED SUBSEQUENT TO PASSING THE      * 00120000
*   REAL-NAME ENTRIES THE NEXT ALIAS ENTRY (IF ANY) WILL BE PASSED AS * 00140000
*   A REAL-NAME ENTRY. THE ENTRY IS PLACED IN AN AREA PROVIDED BY THE * 00160000
*   CALLING ROUTINE.                                                  * 00180000
*ENTRY POINTS:                                                        * 00200000
*        IEHMVESR - ONLY ENTRY POINT                                  * 00220000
*        FIRST TIME IN REGISTER 0=0, EACH TIME THEREAFTER REGISTER0   * 00240000
*        NOT 0. L 1,79 BYTE AREA L 15,A(IEHMVESR) BALR 14,15          * 00260000
*INPUT:                                                               * 00280000
*   UTILITY WORK FILE (SYSUT3) OF 79 BYTE RECORDS WITH 4 BYTE KEY ON A* 00300000
*   DIRECT ACCESS DEVICE.                                             * 00320000
*OUTPUT:                                                              * 00340000
*   PDS DIRECTORY ENTRY WITH 5 BYTES OF LOCATION INFORMATION APPENDED.* 00360000
*EXTERNAL ROUTINES:                                                   * 00380000
*EXITS - NORMAL                                                       * 00400000
*   RETURN EVERY TIME EXCEPT LAST. ON LAST EXIT (END OF WORK FILE)    * 00420000
*   FREEMAIN AND RETURN. REGISTER 15=0-NORMAL, REGISTER 15=4-END OF   * 00440000
*   FILE                                                              * 00460000
*ERRORS:                                                              * 00480000
*   FREEMAIN AND RETURN. REGISTER 15=8-I/O ERROR.                     * 00500000
*TABLES/WORK AREAS:                                                   * 00520000
*   160 BYTE WORK AREA                                                * 00540000
*ATTRIBUTES:                                                          * 00560000
*   READ ONLY, REENTRANT, REUSABLE                                    * 00580000
REG0     EQU   0                                                        00600000
REG1     EQU   1                                                        00620000
REG2     EQU   2                                                        00640000
REG3     EQU   3                                                        00660000
REG4     EQU   4                                                        00680000
REG5     EQU   5                                                        00700000
REG6     EQU   6                                                        00720000
REG7     EQU   7                                                        00740000
REG8     EQU   8                                                        00760000
REG9     EQU   9                                                        00780000
REG10    EQU   10                                                       00800000
REG11    EQU   11                                                       00820000
REG12    EQU   12                                                       00840000
REG13    EQU   13                                                       00860000
REG14    EQU   14                                                       00880000
REG15    EQU   15                                                       00900000
IEHMVSSR CSECT                                                          00904002
*A018960                                                       @ZA02893 00906040
*A023000-023060,042680-042760                                  @ZA01204 00908002
*C016600,018400,052150                                         @ZA01204 00912002
*D023000-023100,042680                                         @ZA01204 00916002
*C 023000,052060                                                YA00085 00920400
*A 023100-023120,042534-042539,049570                           YA00085 00920800
*D 039800-040200,041200                                         YA00085 00921200
*A038100-038120                                                  YM5090 00922001
*C038200                                                         YM5090 00922401
*16600,18400                                                     A34117 00923020
*  ALL CODE FLAGGED S20201 WAS ADDED OR CHANGED FOR              S20201 00926020
*  MERLIN/ZEUS SUPPORT                                           S20201 00932020
         ENTRY IEHMVESR                                                 00940000
IEHMVESR SAVE (14,12),T,SR8/26                                          00960000
         BALR  REG10,0                                                  00980000
         USING IEHMVV,REG12            SET UP                           01000000
         USING INXWK,REG8                     ADDRESSABILITY            01020000
         USING *,REG10                                                  01040000
         IEHPRE ,TF                                                     01060000
         LR    REG4,REG3               ADDR OF RECORD AREA              01080000
         L     REG8,IEHMVV43           RESTORE WORK AREA ADDR           01100000
*********************************************************************** 01120000
**                                                                   ** 01140000
**       DETERMINE FUNCTION TO BE PREFORMED                          ** 01160000
**                                                                   ** 01180000
*********************************************************************** 01200000
         LTR   REG2,REG2               INITIAL ENTRY TO THIS ROUTINE    01220000
         BZ    INX1                    YES, GO TO INITIALIZE            01240000
         TM    IEHMVV20+2,ALIAS        ANY ALIAS ENTRIES                01260000
         BZ    INX4                    NO                               01280000
         TM    INXSW,ALIAS             WANT ALIAS OF PREVIOUS ENTRY     01300000
         BO    INX2                    YES                              01320000
         TM    INXSW,REALNAME          ANY REAL NAME ENTRIES LEFT       01340000
         BO    INX5                    NO                               01360000
*********************************************************************** 01380000
**                                                                   ** 01400000
**           GET THE NEXT REAL NAME ENTRY ON FILE                    ** 01420000
**                                                                   ** 01440000
*********************************************************************** 01460000
INX4     MVI   INXCPE+7,X'01'          SET COUNT IN CCW                 01480000
         MVI   INXTTR,X'00'            SET RECORD TYPE CODE             01500000
         BAL   REG11,INX3              GO TO GET ENTRY                  01520000
         TM    INXSW,ENTRYFND          DIRECTORY ENTRY FOUND            01540000
         BO    INX5                    NO                               01560000
INX4A    OI    INXSW,ALIAS             INDICATE ALIAS WANTED NEXT       01580000
         LA    REG15,0(0,0)            RETURN CODE, NORMAL              01600000
         MVC   INXTTR+1(3),13(REG4)    SAVE TTR OF ENTRY FOUND          01620000
         B     INX4C                                                    01640000
INX4B    FREEMAIN  R,LV=226,SP=1,A=(8)                         @ZA01204 01660002
         LA    REG15,4(0,0)            RETURN CODE                      01680000
INX4C    IEHPOST ,T                                                     01700000
         RETURN (14,12),T,RC=(15)      RETURN TO CALLER                 01720000
*********************************************************************** 01740000
**                                                                   ** 01760000
**                    INITIALIZATION PROCEDURE                       ** 01780000
**                                                                   ** 01800000
*********************************************************************** 01820000
INX1     GETMAIN  R,LV=226,SP=1                                @ZA01204 01840002
         LR    REG8,REG1               ADDR OF WORK AREA                01860000
         ST    REG8,IEHMVV43           SAVE WORK AREA ADDR              01880000
         LA    REG2,INXPRFX            GET ADDR IOB PREFIX       A34117 01886020
         ST    REG2,INXPRFX            PUT IT IN IOB PREFIX      A34117 01892020
         MVI   INXIOBA,X'01'                                   @ZA02893 01896040
         MVI   INXSW,X'00'             CLEAR INDICATOR                  01900000
         MVI   INXCP,X'00'             CLEAR CHAN PROG AREA             01920000
         MVC   INXCP+1(INXCPL2+8-INXCP-1),INXCP                  S20201 01940020
         MVC   IOBINCAM(2),INXCP   BLOCK COUNT IN IOB                   01960000
         LA    REG2,INXEXT             ADDR OF CCHHR OF FIRST RECORD    01980000
         ST    REG2,INXCP              PUT IN CCW                       02000000
         LA    REG2,IEHMVV42+8         ADDR OF CCHHR OF LAST RECORD     02020000
         ST    REG2,INXCPB             PUT IN CCW                       02040000
         LA    REG2,INXCP              ADDR FOR TIC                     02060000
         ST    REG2,INXCPA             PUT IN CCW                       02080000
         LA    REG2,INXCPE             ADDR FOR TIC                     02100000
         ST    REG2,INXCPC             PUT IN CCW                       02120000
         LA    REG2,INXTTR             ADDR OF ATTR OF MEMBER           02140000
         ST    REG2,INXCPE             PUT IN CCW                       02160000
         LA    REG2,INXCPB             ADDR FOR TIC                     02180000
         ST    REG2,INXCPF             PUT IN CCW                       02200000
         ST    REG4,INXCPG             ADDR OF READ-IN AREA             02220000
         ST    REG4,INXCPH             ADDR OF CCHHR OF RECORD READ     02240000
         LA    REG2,INXCPH             ADDR FOR TIC                     02260000
         ST    REG2,INXCPI             PUT IN CCW                       02280000
         ST    REG2,INXCPG1            IN NEW TIC                S20201 02290020
         MVI   INXCLR+8,X'10'          INITIALIZE CLEAR CHAR   @ZA01204 02300002
         LA    REG2,INXCLR+8           POINT AT CLEAR DATA     @ZA01204 02306002
         ST    REG2,INXCPJ             PUT IN CCW               YA00085 02312000
*********************************************************************** 02320000
**                                                                   ** 02340000
**               PUT COMMANDS,COUNTS AND FLAGS IN CCWS               ** 02360000
**                                                                   ** 02380000
*********************************************************************** 02400000
         OC    INXCP(CCWSIN),INXCOM    PUT CCWS IN EXEC AREA     S20201 02500020
INX1B    L     REG2,IEHMVV42           DCB ADDR                         02620000
         ST    REG2,IOBDCBPT       PUT DCB ADDRESS IN IOB               02640000
         POINT (2),INXTTRK                                              02660000
         MVC   MBBCCHHR(8),5(REG2) PUT MBBCCHHR IN IOB                  02680000
         TM    IEHMVV20+RPS,RPS        RECORD READY BIT ON TEST  S20201 02686020
         BO    INX6                    YES-BUILD CCWS            S20201 02692020
         LA    REG2,INXCP              ADDR OF CHANNEL PROGRAM          02700000
         ST    REG2,IOBSTART       PUT IN IOB                           02720000
INX1A    LA    REG2,INXECB             ADDR OF ECB               S20201 02740020
         ST    REG2,IOBECBPT       PUT IN IOB                           02760000
         MVC   INXEXT(5),IOBSEEK   SAVE CCHHR OF FIRST RECORD           02780000
         B     INX4                                                     02800000
INX6     LA    REG2,INXCP              FIRST CCW                 S20201 02801020
         ST    REG2,INXCPK1            IN FIRST SECTOR TIC       S20201 02802020
         LA    REG2,INXCPH             GET RETURN SEARCH         S20201 02803020
         ST    REG2,INXCPL2            AND PUT IN TIC AFTER SET  S20201 02804020
         LA    REG2,SECTOR             PUT SECTOR                S20201 02805020
         ST    REG2,INXCPL                                       S20201 02806020
         ST    REG2,INXCPL1                                      S20201 02807020
         LA    REG2,INXCPL             PUT SEARCH CCW IN         S20201 02808020
         ST    REG2,INXEXT1            TIC CCW AFTER THE         S20201 02809020
         MVC   INXCPG1+1(ADDR),INXEXT1+1   SECOND SET SECTOR     S20201 02810020
         LA    REG2,INXCPD+2           GET A 0 VALUE             S20201 02811020
         ST    REG2,INXCPK                                       S20201 02812020
         LA    REG2,INXCPK             GET NEW FIRST CCW IN CHAINS20201 02813020
         ST    REG2,IOBSTART           AND PUT IN THE IOB        S20201 02814020
         OC    INXCPK(SECCCW),INXCOM1  PUT REST OF NEW CCWS IN   S20201 02815020
         B     INX1A                   CONTINUE                  S20201 02816020
*********************************************************************** 02820000
**                                                                   ** 02840000
**                GET THE NEXT ALIAS ENTRY ON FILE                   ** 02860000
**                                                                   ** 02880000
*********************************************************************** 02900000
INX5     MVI   INXTTR,TYPCODE                                           02920000
         MVI   INXCPE+7,X'01'          SET COUNT IN CCW                 02940000
         OI    INXSW,REALNAME          INDICATE NO REAL NAME ENTRIES    02960000
         BAL   REG11,INX3              GO TO GET ALIAS ENTRY            02980000
         NI    16(REG4),X'7F'          MAKE IT REAL NAME ENTRY          03000000
         TM    INXSW,ENTRYFND          ENTRY FOUND                      03020000
         BZ    INX4A                   YES                              03040000
         B     INX4B                                                    03060000
*********************************************************************** 03080000
**                                                                   ** 03100000
**             GET AN ALIAS OF PREVIOUSLY FOUND ENTRY                ** 03120000
**                                                                   ** 03140000
*********************************************************************** 03160000
INX2     MVI   INXTTR,TYPCODE          SET RECORD TYPE CODE             03180000
         MVI   INXCPE+7,X'04'          SET COUNT IN CCW                 03200000
         BAL   REG11,INX3              GO TO GET ALIAS ENTRY            03220000
         TM    INXSW,ENTRYFND          ENGRY FOUND                      03240000
         BO    INX4                    NO                               03260000
         B     INX4A                                                    03280000
*********************************************************************** 03300000
**                                                                   ** 03320000
**          EXECUTE CHANNEL PROGRAM AND INTERPRET RETURN             ** 03340000
**                                                                   ** 03360000
*********************************************************************** 03380000
INX3     LA    REG9,INXIOBA        ADDR OF IOB                          03400000
         EXCP  (REG9)                                                   03420000
         LA    REG1,INXECB             ECB ADDR                         03440000
         WAIT  ECB=(1)                                                  03460000
         L     REG2,IEHMVV42           DCB ADDR                         03480000
         TM    44(REG2),IOERROR        TEST FOR PERMANENT IO ERROR      03500000
         BO    INXERR                  YES                              03520000
         NI    INXSW,IND           CLEAR INDICATOR                      03540000
         L     REG2,IOBCSW         COMMAND ADDRESS FROM CSW             03560000
         N     REG2,INXMSK1            CLEAR HIGH ORDER BYTE            03580000
         LA    REG3,INXCPD             ADDR OF NO OP COMMAND            03600000
         LA    REG3,8(0,REG3)          ADD 8                            03620000
         CLR   REG2,REG3               CHAN PROG EXIT AT NO OP          03640000
         BNE   0(0,REG11)              NO                               03660000
         OI    INXSW,X'40'             INDICATE EXIT AT NO OP           03680000
         BR    REG11                                                    03700000
*********************************************************************** 03720000
**                                                                   ** 03740000
**               I / O   E R R O R   E X I T                         ** 03760000
**                                                                   ** 03780000
*********************************************************************** 03800000
INXERR   EQU   *                                                 YM5090 03810001
         NI    44(REG2),X'FF'-IOERROR  SET OFF PERM ERROR BITS   YM5090 03812001
         FREEMAIN R,LV=160,SP=1,A=(8)                            YM5090 03820001
         LA    REG15,8(0,0)            RETURN CODE                      03840000
         B     INX4C                                                    03860000
*********************************************************************** 03880000
**                                                                   ** 03900000
**                 C O N S T A N T S                                 ** 03920000
**                                                                   ** 03940000
*********************************************************************** 03960000
INXEXT1  DS    F                       TO UPDATE CCWS            S20201 04040020
INXTTRK  DC    A(256)                                                   04060000
INXMSK1  DC    X'00FFFFFF'                                              04080000
INXK8    DC    H'8'                                                     04100000
*********************************************************************** 04140000
**                                                                   ** 04160000
**             TABLE OF COMMANDS,COUNTS AND FLAGS FOR CCWS           ** 04180000
**                                                                   ** 04200000
*********************************************************************** 04220000
INXCOM   DC    X'31'                                             S20201 04221020
         DC    AL3(0)                                            S20201 04222020
         DC    X'40000005'                                       S20201 04223020
         DC    X'08'                                             S20201 04224020
         DC    AL3(0)                                            S20201 04225020
         DC    X'40000001'                                       S20201 04226020
         DC    X'B1'                                             S20201 04227020
         DC    AL3(0)                                            S20201 04228020
         DC    X'40000005'                                       S20201 04229020
         DC    X'08'                                             S20201 04230020
         DC    AL3(0)                                            S20201 04231020
         DC    X'40000001'                                       S20201 04232020
         DC    X'03'                                             S20201 04233020
         DC    AL3(0)                                            S20201 04234020
         DC    X'20000001'                                       S20201 04235020
         DC    X'A9'                                             S20201 04236020
         DC    AL3(0)                                            S20201 04237020
         DC    X'60000004'                                       S20201 04238020
         DC    X'08'                                             S20201 04239020
         DC    AL3(0)                                            S20201 04240020
         DC    X'40000001'                                       S20201 04241020
         DC    X'06'                                             S20201 04242020
         DC    AL3(0)                                            S20201 04243020
         DC    X'60000057'                                       S20201 04244020
         DC    X'08'                                             S20201 04245020
         DC    AL3(0)                                            S20201 04246020
         DC    X'40000001'                                       S20201 04247020
         DC    X'31'                                             S20201 04248020
         DC    AL3(0)                                            S20201 04249020
         DC    X'40000005'                                       S20201 04250020
         DC    X'08'                                             S20201 04251020
         DC    AL3(0)                                            S20201 04252020
         DC    X'400000FF'                                       S20201 04253020
INXCHPR  DC    X'0D'                   CCW TO DE-ACTIVATE ENTRY YA00085 04253400
         DC    AL3(0)                  FOUND                    YA00085 04253800
         DC    X'20000004'                                      YA00085 04253900
INXCOM1  DC    X'23'                                             S20201 04254020
         DC    AL3(0)                                            S20201 04255020
         DC    X'40000001'                                       S20201 04256020
         DC    X'08'                                             S20201 04257020
         DC    AL3(0)                                            S20201 04258020
         DC    X'40000001'                                       S20201 04259020
         DC    X'22'                                             S20201 04260020
         DC    AL3(0)                                            S20201 04261020
         DC    X'40000001'                                       S20201 04262020
         DC    X'23'                                             S20201 04263020
         DC    AL3(0)                                            S20201 04264020
         DC    X'40000001'                                       S20201 04265020
         DC    X'08'                                             S20201 04266020
         DC    AL3(0)                                            S20201 04267020
         DC    X'00000001'                                     @ZA01204 04268002
         DC    X'03000000'                                     @ZA01204 04272002
         DC    X'00000001'                                     @ZA01204 04276002
*********************************************************************** 04280000
**                                                                   ** 04300000
**             D E F I N E   W O R K   A R E A                       ** 04320000
**                                                                   ** 04340000
*********************************************************************** 04360000
INXWK    DSECT                                                          04380000
INXPRFX  DS    2F                                                A34117 04390020
INXIOBA  DS    10F                                                      04400000
IOBINCAM EQU   INXIOBA+28                                               04420000
IOBDCBPT EQU   INXIOBA+20                                               04440000
IOBSTART EQU   INXIOBA+16                                               04460000
IOBECBPT EQU   INXIOBA+4                                                04480000
IOBCSW   EQU   INXIOBA+8                                                04500000
MBBCCHHR EQU   INXIOBA+32                                               04520000
IOBSEEK  EQU   INXIOBA+35                                               04540000
INXECB   DS    F                                                        04560000
INXEXT   DS    5C                                                       04580000
INXSW    DS    C                                                        04600000
SECTOR   DS    C                       SECTOR VALUE              S20201 04610020
INXTTR   DS    F                                                        04620000
*********************************************************************** 04640000
**                                                                   ** 04660000
**         C H A N N E L   P R O G R A M   A R E A                   ** 04680000
**                                                                   ** 04700000
*********************************************************************** 04720000
INXCP    DS    D                       SEARCH ID= FIRST RECORD          04740000
INXCPA   DS    D                       TIC TO INXCP                     04760000
INXCPB   DS    D                       SEARCH ID= LAST RECORD           04780000
INXCPC   DS    D                       TIC TO INXCPE                    04800000
INXCPD   DS    D                       NO OP, END OF DATA               04820000
INXCPE   DS    D                       SEARCH KEY= FOR DESIRED RECORD   04840000
INXCPF   DS    D                       TIC TO INXCPB                    04860000
INXCPG   DS    D                       READ DATA OF RECORD FOUND        04880000
INXCPG1  DS    D                       TIC TO NEXT SEARCH OR READS20201 04890020
INXCPH   DS    D                       SEARCH ID= OF RECORD FOUND       04900000
INXCPI   DS    D                       TIC TO INXCPH                    04920000
INXCPJ   DS    D                       WRITE KEY,DATA TO CLOBBER RECORD 04940000
INXCPK   DS    D                       FIRST SET SECTOR TO 0     S20201 04943020
INXCPK1  DS    D                    TIC TO OLD BEGINNING (INXCH) S20201 04946020
INXCPL   DS    D                       READ SECTOR               S20201 04949020
INXCPL1  DS    D                       SET SECTOR                S20201 04952020
INXCPL2  DS    D                    TIC TO WRITE SEARCH (INXCPH) S20201 04955020
INXCLR   DS    C                       AREA FOR CLEAR DATA      YA00085 04957000
*********************************************************************** 04960000
**                                                                   ** 04980000
**                  E Q U A T E S                                    ** 05000000
**                                                                   ** 05020000
*********************************************************************** 05040000
*                                                                       05060000
*                                                                       05080000
IND      EQU   X'BF'                                                    05100000
ALIAS    EQU   X'80'                                                    05120000
REALNAME EQU   X'20'                                                    05140000
ENTRYFND EQU   X'40'                                                    05160000
TYPCODE  EQU   X'80'                                                    05180000
IOERROR  EQU   X'C0'                                                    05200000
ADDR     EQU   3                                                 S20201 05203020
CCWSIN   EQU   96                      BYTES IN CCW CHAIN       YA00085 05206000
RPS      EQU   4                       RECORD READY BIT IN DSECT S20201 05209020
CODECCW  EQU   132                     BYTES TO CLEAR FOR CCWS   S20201 05212020
SECCCW   EQU   48                      BYTES IN NEW CCWS       @ZA01204 05215002
         IEHMVV                                                         05220000
         END                                                            05240000
./  ADD  SSI=70260471,NAME=IEHMVEST
*TITLE ' IEHMVSST                                                     * 00020000
*ENTRY POINTS: IEHMVEST                                               * 00040000
*INPUT: POINTER TO IEHMOVE1 WORKAREA IN REG 12                        * 00060000
*EXTERNAL ROUTINES:  IEHMVSSS (CARD                                   * 00080002
*PARAMETER ANALIZER) IEHMVSSJ (CARD SCANNER RTN) IEHMVSSA (MESSAGE    * 00100000
*MODULE)                                                              * 00120000
*EXITS - NORMAL IEHMVSSH FOR DSGROUP OPERATION - IEHMVSSZ FOR ALL     * 00140002
*OTHER OPERATIONS                                                     * 00160000
*TABLES/WORK AREAS: WORK AREA POINTED TO BY REG 12 IS DESCRIBED BY    * 00180000
*DSECT IEHMVV                                                         * 00200000
*                                                                       00220000
*                                                                       00240000
*                                                                       00260000
*                                                                       00280000
*        PURPOSE                         THIS MODULE IS COMPOSED OF     00300000
*                                       THE ROUTINES TO PERFORM FOUR    00320000
*                                       SEPERATE FUNCTIONS   ALL  OF    00340000
*                                       WHICH ARE CONNECTED WITH        00360000
*                                       ANALIZING AN IEHMOVE REQUEST    00380000
*                                                                       00400000
*                                        THE FOUR FUNCTIONS ARE         00420000
*                                                                       00440000
*                                         1  INITIALIZATION OF THE      00460000
*                                            WORKING STORAGE PRIOR TO   00480000
*                                            SETTING IT UP FOR A        00500000
*                                            REQUEST                    00520000
*                                                                       00540000
*                                         2  WRITE APPRORRIATE DATA     00560000
*                                             INCLUDES                  00580000
*                                             EXCLUDES                  00600000
*                                             REPLACE                   00620000
*                                             SELECT                    00640000
*                                            ON WORK FILES UT1 AND UT2  00660000
*                                                                       00680000
*                                              3  FIND  FROM  VOLUME    00700000
*                                                 INFORMATION IN THE    00720000
*                                                 CATALOG WHEN          00740000
*                                                 NECESSARY             00760000
*                                                                       00780000
*                                              4  ANALIZE THE           00800000
*                                                 INFORMATION PROVIDED  00820000
*                                                 IN THE REQUEST PRIOR  00840000
*                                                 TO GOING TO MODULES   00860000
*                                                 THAT ACT UPON THE     00880000
*                                                 REQUEST               00900000
*                                                                       00920000
*BYTES USED AS                                                          00940000
*SWITCHES                A ONE EQUALS ON                                00960000
*                                                                       00980000
*LABEL OF SWITCH    LOOKFOR    INDICATES WHAT PARAM CARD SCANNER        01000000
*                              IS LOOKING FOR.                          01020000
*                                                                       01040000
*               BIT POS 8      KEYWORD DDNAME                           01060000
*                       4      ANY KEYWORD                              01080000
*                       2      A TYPE CODE                              01100000
*                       1      A VOL ID                                 01120000
*                       8      SEQ NUMBER                               01140000
*                       4      A DATA SET NAME                          01160000
*                       2      A MEMBER NAME                            01180000
*                       1      EXPAND DATA                              01200000
*                 ALL BITS OF  COMMAND                                  01220000
*                                                                       01240000
*                                                                       01260000
*                   LOOKFOR+1                                           01280000
*                                                                       01300000
*                                                                       01320000
*               BIT POS 8     I,E,R FILL  FILLING INCLUDE,EXCLUDE       01340000
*                             REPLACE BLOCK IN PERM WORK AREA           01360000
*                       4     ON WHEN PROCESSING INC EXC OR REP OR SEL  01380000
*                             CARDS                                     01400000
*                       2     COMPLEX  MORE THAN ONE TYPE-VOLID-SEQNO   01420000
*                             IN TO OR FROM LIST.                       01440000
*                       1     INCLUDE BLOCK WRITE OUT SW  ON WHEN BLOCK 01460000
*                             HAS BEEN WRITTEN ON WORK FILE  UT1        01480000
*                       8     EXCLUDE BLOCK WRITE OUT  ON WHEN BLOCK    01500000
*                             HAS BEEN WRITTEN ON UT2                   01520000
*                       4     INCLUDE CARD ENCOUNTERED                  01540000
*                       2     EXCLUDE ENCOUNTERED                       01560000
*                       1     SELECT  CARD ENCOUNTERED                  01580000
*                                                                       01600000
*                                                                       01620000
*                   IEHMVV74 + 14  CHECKS THE CONTENTS                  01640019
*                   OF INCLUDE BLOCK                                    01660000
*                                                                       01680000
*               BIT POS 8     DSNAME                                    01700000
*                       4     FROM  (TYPE-VOLID-SEQNO)                  01720000
*                       2     CVOL  (TYPE-VOLID-SEQNO)                  01740000
*                       1     MEMBER NAME                               01760000
*                       8     UNUSED                                    01780000
*                       4     UNUSED                                    01800000
*                       2     UNUSED                                    01820000
*                       1     UNUSED                                    01840000
*                                                                       01860000
*                                                                       01880000
*                        XSWITCHS                                       01900000
*                                                                       01920000
*               BIT  POS 8     SELECT CARD HAS BEEN OR IS BEING         01940000
*                             PROCESSED                                 01960000
*                       4     COMPLEX MEMBER  (MEMBER NAME LIST)        01980000
*                                                                       02000000
*                       2     MEMBER RENAME                             02020000
*                       1     UNUSED                                    02040000
*                       8     UNUSED                                    02060000
*                       4     UNUSED                                    02080000
*                       2     UNUSED                                    02100000
*                       1     UNUSED                                    02120000
*                                                                       02140000
*                                                                       02160000
*                        SWITCHRD       SET BY CARD SCANNER RTN         02180000
*                                                                       02200000
*               BIT  POS 8     SCAN ERROR     SYNTAX ERROR              02220000
*                                                                       02240000
*                       4     BYPASS   IF ON-NEXT ENTRY TO SCAN WILL    02260000
*                             RETURN OPERATOR FLD OF NEXT CARD          02280000
*                       2     END OF FILL ON SYSIN                      02300000
*                       1     SCAN RTN FIRST TIME IN                    02320000
*                                                                       02340000
*                       8     OPERATOR                                  02360000
*                                                                       02380000
*                       4     KEYWORD                                   02400000
*                                                                       02420000
*                       2     PARAMETER                                 02440000
*                                                                       02460000
*                       1     RIGHT PARENTHESIS                         02480000
*                                                                       02500000
*                                                                       02520000
*NOTE    ABOVE SWITCHES EXCEPT SWITCHRD ARE RESET TO ZEROS BEFORE       02540000
*        PROCESSING EACH IEHMOVE REQUEST                                02560000
*                                                                       02580000
*        SWITCHRD IS RESET TO ZEROS PRIOR TO GOING TO CARD SCANNER      02600000
*        FOR FIRST TIME ONLY                                            02620000
*                                                                       02640000
*                                                                       02660000
*                                                                       02680000
*                                                                       02700000
*                                                                       02740000
*                                                                       02760000
IEHMVSST CSECT                                                          02764008
*A128200-128360                                                @ZA07411 02768008
*C028800                                                       @ZA07411 02772008
*D128200                                                       @ZA07411 02776008
         EJECT                                                          02780000
*D109200-109400,110000-110200,110600-110800,111400,111600        A50958 02802822
*D11440                                                          A50958 02803222
*A109900-110400                                                  A50958 02804822
*D130816-132400                                                  A48781 02806400
*A131310-132348                                                  A48781 02809200
*A131114-131115                                                  A45139 02812000
*C131102                                                         A45139 02814800
*   ALL CODE FLAGGED S20201 WAS ADDED FOR RPS SUPPORT            S20201 02817600
* 130820,131050                                                  A33297 02820400
* 016400,067200,093000,099600,103200                             A27307 02823200
* 036600                                                         S21042 02826000
* 053000-053600,068800,078400,079600,082200                      A27307 02828800
*                                                                  I276 02831600
* 113600                                                         A15815 02834400
*A29900,89300,91500,106300-106320,107900-107940,108100          YL026VC 02836402
*C800,108400,134600                                             YL026VC 02836802
*D34600-35200,90600-91000,91800-104400,105400-105800            YL026VC 02836902
*D107200-107400                                                 YL026VC 02837002
*C1400,130810                                                    Y02918 02839002
*A33500-33520,130740                                             Y02918 02839102
*A034900-035200,093700-094084,097600-098900,090400-090900      @Z40CSJH 02849104
*A103600,105336,107500-107520,130760-130800,107700-107720      @Z40CSJH 02849504
*A130910-131110,134520,134700,105502,031900,104593-104596      @Z40CSJH 02855604
*D108100                                                       @Z40CSJH 02857604
*C108400,105502                                                @Z40CSJH 02859604
         ENTRY IEHMVEST                                                 02861704
         USING IEHMVV,12                                                02867804
         USING IEHMVEST,BASE                                            02873904
IEHMVEST SAVE  (14,12),T,IEHMVEST-OZ07411                      @ZA07411 02880008
         LR    BASE,15                                                  02900000
        IEHPRE (14,1),TFC                                               02920000
RO       EQU   0                                                        02940000
SCANAD   EQU   1                                                        02960000
LENGTH   EQU   2                                                        02980000
BADLOC   EQU   20                      BAD LOCATE MESSAGE CODE  YL026VC 02990002
DBR1     EQU   3                                                        03000000
DBR3     EQU   4                                                        03020000
DBCOMPR  EQU   5                                                        03040000
R6       EQU   6                                                        03060000
R7       EQU   7                                                        03080000
DBNXRPTR EQU   7                                                 A28295 03090019
BASE     EQU   8                                                        03100000
R9       EQU   9                                                        03120000
R10      EQU   10                                                       03140000
NXRPTR   EQU   11                                                       03160000
R12      EQU   12                                                       03180000
R15      EQU   15                                              @Z40CSJH 03190004
SAVEREG  EQU   13                                                       03200000
RETURN   EQU   14                                                       03220000
GOTO     EQU   15                                                       03240000
R1       EQU   1                                                        03260000
R2       EQU   2                                                        03280000
R3       EQU   3                                                        03300000
R4       EQU   4                                                        03320000
R5       EQU   5                                                        03340000
L8       EQU   8                       LENGTH OF 8               Y02918 03350002
D12      EQU   12                      DISPLACEMENT OF 12        Y02918 03352002
*                                                                     * 03360000
*              ANALIZE ENTRY CONTROL AND GIVE CONTROL TO              * 03380000
*              THE PROPER ROUTINE                                     * 03400000
*                                                                     * 03420000
*                                                                     * 03440000
         TM    IEHMVV20+4,X'10'         RETURN FROM VXSF       @Z40CSJH 03490004
         BZ    *+12                     BRANCH IF NOT          @Z40CSJH 03500004
         NI    IEHMVV20+4,X'EF'         CLEAR VXSF BIT         @Z40CSJH 03510004
         B     MNT3                     BR TO CHECK ON MOUNT   @Z40CSJH 03520004
         SR    R1,R1                                                    03540000
         IC    R1,ESTENTRY             INSERT ENTRY SW BYTE             03560000
         MVI   ESTENTRY,X'00'                                           03580000
         EX    0,BRANCH(R1)                                             03600000
BRANCH   B     INIT                                                     03620000
         B     FINDFROM                                                 03640000
         B     PREWRUT1          USER DID SPECIFY 'FROM' VOLUME  S21042 03650021
         B     SCAEXIT1                                                 03680000
*                                                                     * 03700000
*                                                                     * 03720000
*              INITIALIZE WORKING STORAGE  IEHMVV  AS NECESSARY       * 03740000
*              PRIOR TO SETTING UP AN IEHMOVE REQUEST                 * 03760000
*                                                                     * 03780000
*              POINT WORK FILES UT1 AND UT2  TO BEGINING OF FILES     * 03800000
*                                                                     * 03820000
*                                                                     * 03840000
INIT     DS    0H                                                       03860000
         MVI   IEHMVV51,X'60'                                           03880000
         XC    IEHMVV20+5(35),IEHMVV20+5  COMMAREA CLEAR         S20201 03900020
         XC    IEHMVV27+5(27),IEHMVV27+5  COMMAREA CLEAR                03920000
         NC    IEHMVV20(6),MASK1 TURN OFF ALL BUT PRINT CNTRL    A37919 03940021
*                                      AND RPS INDICATORS        S20201 03960020
         XC    IEHMVV61(8),IEHMVV61     CLEAR PDS RTN WORDS IN COMM     03980000
*                                       AREA                            04000000
         L     NXRPTR,FAADD             IS FIRST AVILIBLE ADDR POINTER  04020000
         LTR   NXRPTR,NXRPTR            ZERO                            04040000
         BNE   INIT1                    BRANCH IF ND                    04060000
         L     DBR1,NXTPTR              SET UP FIRST AVAILIBLE ADDR     04080000
         LA    DBR1,1(DBR1)             HALF WORD ALIGN THE BEGINING    04100000
         SRL   DBR1,1                   ADDR OF THE WORK AREA USED BY   04120000
         SLL   DBR1,1                   THE CONTROL CARD PARAMETER      04140000
         ST    DBR1,FAADD               RTN                             04160000
         ST    DBR1,NXTPTR                                              04180000
         B     INIT2                                                    04200000
INIT1    ST    NXRPTR,NXTPTR                                            04220000
INIT2    L     NXRPTR,NXTPTR                                            04240000
         XC    0(256,NXRPTR),0(NXRPTR)  CLEAR 256 BYTES OF PERM WORK    04260000
         LA    1,256                   TTRZ OF 0010                     04280000
         ST    1,SARG                                                   04300000
         LA    1,SARG                  ADDR OF 0010                     04320000
         LR    0,1                                                      04340000
         L     1,IEHMVV40              LOAD UT1 DCB PTR                 04360000
         POINT (1),(0)                                                  04380000
         LA    0,SARG                                                   04400000
         L     1,IEHMVV41              LOAD UT2 DCB PTR                 04420000
         POINT (1),(0)                                                  04440000
         CLI   ESSENTRY,X'10'          ESS ENTRY TO MOVE RTN            04460000
         BE    ESSEXIT                                                  04480000
         CLI   ESSENTRY,X'14'          ESS ENTRY FOR COPY RTN           04500000
         BE    ESSEXIT                                                  04520000
         B     ESJEXIT                                                  04540000
*                                       AREA FOR CC PARAMETER RTN       04560000
TRANS2   MVI   ESSENTRY,X'0C'                                           04580000
         B     ESSEXIT                                                  04600000
TRANS3   MVI   ESSENTRY,X'08'                                           04620000
         B     ESSEXIT                                                  04640000
*                                                                     * 04660000
*                                                                     * 04680000
*              THIS ROUTINE IS USED TO WRITE WORK FILES UT1 AND UT2   * 04700000
*                                                                     * 04720000
*              IT WILL GET AN INCLUDE  EXCLUDE  REPLACE  OR A SELECT  * 04740000
*              BLOCK OF INFORMATION THAT HAS PREVIOUSLY BEEN FORMED   * 04760000
*              IN WORKING STORAGE AND PLACE THE INFORMATION IN THE    * 04780000
*              PROPER RECORD FORMAT AND WRITE IT ON THE PROPER WORK   * 04800000
*              FILE                                                   * 04820000
*                                                                     * 04840000
*                                                                     * 04860000
         EJECT                                                          04880000
*              THE RECORD FORMATS ARE AS FOLLOWS                        04900000
*                                                                       04920000
*                1  RECORD PRODUCED BY AN  INCLUDE  REPLACE AND A       04940000
*                   SELECT ASSOCIATED WITH A PDS REQUEST    ON UT1      04960000
*                                                                       04980000
*                   BYTES IN KEY                                        05000000
*                                                                       05020000
*                     4       DEVICE TYPE CODE                          05040000
*                     6       VOLUME ID                                 05060000
*                     2       DEQUENCE NUMBER                           05080000
*                                                                       05100000
*                   BYTES IN DATA                                       05120000
*                                                                       05140000
*                     5       CCHHR OF THIS RECORD                      05160000
*                     1       BLOCK IDENTIFIER  I  E  R  ETC  EBCDIC    05180000
*                     44      DATA SET NAME                             05200000
*                     8       MEMBER NAME                               05220000
*                     4       DEVICE TYPE CODE                          05240000
*                     6       VOLUME ID                                 05260000
*                     2       DEQUENCE NUMBER                           05280000
*                     5       SPECIFIC UNIT IF SPECIFIED           DT0I 05300018
*                     8       MEMBER RENAME     V                  DT0I 05320018
*                                                                       05340018
*                  TOTAL  95  BYTES KEY AND DATA                   DT0I 05360018
         EJECT                                                          05380000
*                2  RECORD PRODUCED BY AN INCLUDE ASSOCIATED WITH     * 05400000
*                   A DSGROUP REQUEST   ON UT1                        * 05420000
*                                                                     * 05440000
*                   BYTES  IN KEY                                     * 05460000
*                                                                     * 05480000
*                     12      UNUSED                                  * 05500000
*                                                                     * 05520000
*                   BYTES  IN DATA                                    * 05540000
*                                                                     * 05560000
*                     5       UNUSED                                  * 05580000
*                     2       BINARY  LENGTH OF REMAINDER OF RECORD   * 05600000
*                     1       CODE BINARY ZERO FOR DSGROUP INCLUDE    * 05620000
*                     44      DATA SET NAME                           * 05640000
*                     2       BINARY COUNT OF 12 BYTE VOL ENTRIES     * 05660000
*                             TO FOLLOW  ALWAYS 1 ON DSGROUP INCLUDE  * 05680000
*                     4       DEVICE TYPE CODE                        * 05700000
*                     6       VOLUME ID                               * 05720000
*                     2       SEQUENCE NUMBER                         * 05740000
*                                                                     * 05760000
*                                                                     * 05780000
*                                                                     * 05800000
*                                                                     * 05820000
*                                                                     * 05840000
         EJECT                                                          05860000
*                                                                     * 05880000
*                                                                     * 05900000
*                   RECORD PRODUCED BY AN EXCLUDE OR REPLACE          * 05920000
*                   ASSOCIATED WITH A PDS REQUEST       ON  UT2       * 05940000
*                                                                     * 05960000
*                   BYTES  IN KEY                                     * 05980000
*                                                                     * 06000000
*                     8       MEMBER NAME                             * 06020000
*                                                                     * 06040000
*                   BYTES  IN DATA                                    * 06060000
*                                                                     * 06080000
*                     1       BLOCK IDENTIFIER                        * 06100000
*                     9       UNUSED                                  * 06120000
*                                                                     * 06140000
*                                                                     * 06160000
*                                                                     * 06180000
*                                                                     * 06200000
*                                                                     * 06220000
*                                                                     * 06240000
*                                                                     * 06260000
*                                                                     * 06280000
*                                                                     * 06300000
*                                                                     * 06320000
PREWRUT1 XC    IEHMVV82(3),IEHMVV82 FROM VOL SPEC, CLEAR DSCBTTR S21042 06330021
WRITEUT1 DS    0H                                                       06340000
         L     DBR1,IEHMVV40            LOAD ADDR OF UT1 DCB            06360000
         TM    LOOKFOR+1,X'10'          FIRST TIME IN                   06380000
         BZ    OPENUT1                  BRANCH IF YES                   06400000
WRITE1   L     R6,IEHMVV26              I,E,R BLOCK PTR                 06420000
         LR    R10,R6                                                   06440000
         SRL   R6,24                    DROP ADDR AND RETAIN COUNT      06460000
         SLL   R10,8                                                    06480000
         SRL   R10,8                    DROP COUNT AND RETAIN ADDR      06500000
         LR    NXRPTR,R10                                               06520000
         ST    NXRPTR,NXTPTR            RECLAIM PERM WORK AREA USED     06540000
*                                       FOR I,E,R BLOCK                 06560000
         ST    NXRPTR,IEHMVV26          STORE BLOCK PTR WITHOUT COUNT   06580000
WRITE4   CLI   0(R10),C'I'              IS THIS AN INCLUDE BLOCK        06600000
         BE    IWRITE                   BRANCH YES                      06620000
         CLI   0(R10),C'E'                         EXCLUDE BLOCK        06640000
         BE    EWRITE                   BRANCH YES                      06660000
         CLI   0(R10),C'R'                         REPLACE BLOCK        06680000
         BE    EWRITE                                                   06700000
CWRITE   MVC   WRITAREA+17(78),0(R10)  MOVE BLOCK TO WRITE AREA  A27307 06720019
         XC    WRITAREA(12),WRITAREA    ZERO KEY AREA                   06740000
CWRITE1  DS    0H                                                       06760000
         L     DBR1,IEHMVV40            COMPARE KL+DL+20 TO TRACK BAL   06780000
         L     R3,IEHMVV40             POINT TO SYSUT1 DCB         7972 06800000
         L     R3,12(0,R3)             POINT TO DEVICE TABLE       7972 06820000
         SR    R4,R4                   CLEAR REG                   7972 06840000
         IC    R4,7(0,R3)              LAST RECORD OVERHEAD        7972 06860000
         LA    R4,95(0,R4)             KEY DATA AND OVERHEAD CT    DT0I 06880018
         L     R3,IEHMVV40             POINT TO SYSUT1 DCB         7972 06900000
         CH    R4,18(0,R3)             WILL RECORD FIT ON TRACK    7972 06920000
         BH    CWRITE2                 NO  WILL NOT FIT            7972 06940000
         MVC   WRITAREA+12(5),8(DBR1)   MOVE CCHAR FROM DCB TO WRITAREA 06960000
         SR    DBR3,DBR3                                                06980000
         IC    DBR3,WRITAREA+16                                         07000000
         LA    DBR3,1(DBR3)             BUMP R OF CCHHR BY ONE          07020000
         STC   DBR3,WRITAREA+16                                         07040000
         B     CWRITE3                                                  07060000
CWRITE2  DS    0H                                                       07080000
         SR    DBR3,DBR3                                                07100000
         STH   DBR3,18(DBR1)                                            07120000
         L     2,IEHMVV40               LOAD UT1 DCB ADDR               07140000
         LA    2,5(2)                                                   07160000
         LA    1,39(2)                  LOAD ADDR OF DEBAD              07180000
         L     1,0(1)                   LOAD DEB ADDR                   07200000
         L     15,16                                                    07220000
         L     15,32(0,15)              ADDR OF MBBCCHHR TO TTR RTN     07240000
         STM   14,12,12(13)                                             07260000
         LA    13,88(13)                                                07280000
         LR    5,13                                                     07300000
         BALR  14,15                                                    07320000
         LR    13,5                                                     07340000
         LA    3,88                                                     07360000
         SR    13,3                                                     07380000
         LM    8,12,52(13)                                              07400000
         SRL   0,8                                                      07420000
         AH    0,DBCTONE          ADD ONE TO T IN TTR                   07440000
         IC    0,DBCTONE               SET R OF TTR TO ONE              07460000
         SLL   0,8                                                      07480000
         L     1,IEHMVV40               LOAD UT1 DCB ADDR               07500000
         LA    1,44(1)                  PLUS 44 TO DEBAD IN DCB         07520000
         L     1,0(1)                   LOAD DEB ADDR                   07540000
         LA    2,IEHMVV00+150           LOAD WORK AREA ADDR 8 BYTES     07560000
         L     15,16                    LOAD CVT PTR                    07580000
         L     15,28(0,15)              ADDR OF TTX TO MBBCCHHR RTN     07600000
         LA    13,88(13)                                                07620000
         LR    5,13                                                     07640000
         BALR  14,15                                                    07660000
         LR    13,5                                                     07680000
         LA    3,88                                                     07700000
         SR    13,3                                                     07720000
         LM    14,12,12(13)                                             07740000
         MVC   WRITAREA+12(5),IEHMVV00+153                              07760000
CWRITE3  DS    0H                                                       07780000
         L     DBR1,IEHMVV40            UT1 DCB ADDR                    07800000
         L     DBR3,IEHMVV40+4          UT1 DECB ADDR                   07820000
         LA    LENGTH,83               LENGTH                      DT0I 07840018
         LA    NXRPTR,WRITAREA          REC ADDR                        07860000
         BAL   R7,WRITE3                                                07880000
WRITE7   BCTR  R6,0                     REDUCE COUNT BY ONE             07900000
         LTR   R6,R6                    IS COUNT ZERO                   07920000
         BZ    TRANS2                   LEAVE RTN IF YES                07940000
         LA    R10,78(R10)             MOVE PTR TO NXT BLOCK TO BE DT0I 07960018
         B     WRITE4                   WRITTEN                         07980000
IWRITE   TM    IEHMVV20,X'10'           DSGROUP BIT ON                  08000000
         BZ    IWRITE1                                                  08020000
         MVI   WRITAREA+17,X'00'        BLOCK                           08040000
         MVI   WRITAREA+18,X'3A'       LENGTH                    A27307 08060019
         MVI   WRITAREA+19,X'00'        BLOCK CODE ZERO                 08080000
         MVC   WRITAREA+20(44),1(R10)  MOVE INTO BLOCK DSNAME           08100000
         MVI   WRITAREA+64,X'00'        VOL ENTRY COUNT                 08120000
         MVI   WRITAREA+65,X'01'                                        08140000
         MVC   WRITAREA+66(12),53(R10) MOVE VOL ENTRY INTO BLOCK        08160000
         B     CWRITE1                                                  08180000
IWRITE1  DS    0H                                                       08200000
         MVC   WRITAREA+17(78),0(R10)  MOVE I BLOCK INOT WRITE AREADT0I 08220018
         MVC   WRITAREA(12),53(R10)    MOVE VOL ENTRY TO KEY            08240000
         B     CWRITE1                                                  08260000
EWRITE   MVC   WRITAREA(8),45(R10)      MOVE MEMBER NAME TO WRITE AREA  08280000
         MVC   WRITAREA+8(1),0(R10)     MOVE BLOCK CODE TO WRITE AREA   08300000
         XC    WRITAREA+9(9),WRITAREA+9 CLEAR 9 BYTES OF DATA REC       08320000
         BAL   R7,WRITE5                                                08340000
         CLI   0(R10),C'R'              IS THIS BLOCK A REPLACE BLOCK   08360000
         BE    IWRITE                   BRANCH YES                      08380000
         B     WRITE7                                                   08400000
OPENUT1  EQU   *                                                        08420000
         L     1,IEHMVV40               ADDR OF UT1 DCB                 08440000
         MVI   18(1),X'7F'              SET MAX TRACK BALANCE           08460000
         MVI   19(1),X'FF'                                              08480000
         B     WRITE1                                                   08500000
OPENUT2  EQU   *                                                        08520000
         L     DBR1,IEHMVV41                                            08540000
         OI    LOOKFOR+1,X'08'          TURN ON WRITE OUT EXC SW        08560000
         B     WRITE6                                                   08580000
WRITE5   TM    LOOKFOR+1,X'08'          IS EXC WRITE OUT SW ON          08600000
         BZ    OPENUT2                                                  08620000
WRITE6   L     DBR3,IEHMVV41+4          UT2 DECB ADDR                   08640000
         L     DBR1,IEHMVV41            UT2 DCB ADDR                    08660000
         LA    LENGTH,10                LENGTH                          08680000
         LA    NXRPTR,WRITAREA                                          08700000
         WRITE (DBR3),SF,(DBR1),(NXRPTR),(LENGTH),MF=E                  08720000
         CHECK (DBR3)                                                   08740000
         BR    R7                                                       08760000
WRITE3   WRITE (DBR3),SF,(DBR1),(NXRPTR),(LENGTH),MF=E                  08780000
         CHECK (DBR3)                                                   08800000
         TM    LOOKFOR+1,X'10'          FIRST REC WRITTEN SW            08820000
         BO    0(R7)                                                    08840000
         NOTE  (DBR1)                                                   08860000
         ST    1,NOTEAREA               SAVE TTR IN AREA                08880000
         OI    LOOKFOR+1,X'10'         TURN ON FIRST REC WRITTEN SW     08900000
         BR    R7                                                       08920000
*********************************************************************** 08930002
*                                                                     * 08940000
*                                                                     * 08960000
*              THIS ROUTINE IS USED TO FIND  FROM VOLUME INFORMATION  * 08980000
*              THAT IS LOCATED IN THE CATALOG WHEN FROM VOLUME        * 09000000
*              INFORMATION IS NOT GIVEN WITH THE  REQUEST             * 09020000
*        LINES 091600-105265 WERE REACTIVATED                  @Z40CSJH 09040004
*        FOR MVS EXTENDED CVOL SUPPORT.                        @Z40CSJH 09090004
*                                                                     * 09140000
*********************************************************************** 09150002
FINDFROM DS    0H                                                       09160000
         TM    LOOKFOR+1,X'80'          IER SW ON                       09210004
         BO    CHECK2                                                   09260004
         TM    IEHMVV20+1,X'40'         IS CVOL BIT ON                  09310004
         BO    MOUNTVOL                                                 09360004
         TM    IEHMVV20,X'10'         DSGROUP SPECIFIED        @Z40CSJH 09370004
         BO    CHKNAME                YES-CHECK FOR NAME       @Z40CSJH 09380004
         TM    IEHMVV20,X'20'         DSNAME SPECIFIED         @Z40CSJH 09390004
         BO    LOCATE1B               YES-LOCATE DATA SET      @Z40CSJH 09400004
         TM    IEHMVV20,X'08'         PDS SPECIFIED            @Z40CSJH 09402004
         BO    LOCATE1B               YES-LOCATE DATA SET      @Z40CSJH 09404004
         B     FINDRES                GET SYSRES VOLID         @Z40CSJH 09406004
CHKNAME  TM    IEHMVV20+5,X'20'       WAS NAME SPECIFIED       @Z40CSJH 09408004
         BO    LOCATE1B               YES-DO LOCATE            @Z40CSJH 09408404
         B     FINDRES                                                  09410004
CHECK2   L     R1,IEHMVV26                                              09460004
         TM    IEHMVV74+14,X'20'     TEST IER CHEDK BIT FOR CVOL A27307 09510004
         BO    MOUNTVOL                                                 09560004
         B     LOCATE1B                IF OFF GO TO FIND RES   @Z40CSJH 09610004
FINDRES  L     R2,16                   LOAD ADDR OF CVT                 09660004
         L     R2,40(R2)               LOAD ADDR OF UCB PTR TABLE       09710004
VON      SR    R3,R3                  CLEAR UCB REG            @Z40CSJH 09760004
         ICM   R3,3,0(R2)             GET UCB ADDR             @Z40CSJH 09810004
         N     R3,CLEARMSK              SAVE 16 BITS           @Z40CSJH 09830004
         TM    0(R2),X'FF'              LAST ENTRY             @Z40CSJH 09840004
         BO    ERROUT                   BR IF NO UCB FOUND     @Z40CSJH 09890004
         LTR   R3,R3                   CHECK FOR BLANK UCB ADDR         09910004
         BZ    NOTAUCB                    IF SO ---                     09960004
         TM    18(R3),X'20'            IS THIS UCB FOR D.A.             10010004
         BZ    NOTAUCB                    IF NOT ---                    10060004
         TM    3(R3),X'02'             IS THIS UCB FOR SYSRES           10110004
         BO    FIND                       IF SO ---                     10160004
NOTAUCB  LA    R2,2(R2)                LOAD ADDR OF NEXT UCB            10210004
         B     VON                                                      10260004
         DS    0F                                                       10310004
CLEARMSK DC    X'0000FFFF'             UCB MASK                @Z40CSJH 10360004
FIND     LR    R2,R3                   LOAD R2 WITH SYSRES UCB ADDR     10410004
         TM    LOOKFOR+1,X'80'     TEST IERFILL SW                      10420004
         BO    IERCVOL                                                  10430004
         L     R3,NXTPTR                LOAD WORK AREA PTR              10440004
         XC    0(12,R3),0(R3)           ZERO 12 BYTE AREA               10450004
         MVC   0(4,R3),16(R2)           MOVE TYPE INTO LIST             10452004
         MVC   4(6,R3),28(R2)           MOVE VOL ID INTO LIST           10454004
         ST    R3,IEHMVV24              STORE IN CVOL LIST PTR          10456004
         LA    R3,12(R3)                BUMP PTR                        10458004
         ST    R3,NXTPTR                SAVE PTR                        10458404
         LA    R3,1                                                     10458804
         STC   R3,IEHMVV24              PUT COUNT OF ONE ENTRY IN PTR   10459204
         C     R15,CLEARMSK            DSGRP-W/NO NAME-OR CVOL @Z40CSJH 10459304
         BNE   LOCATE1                  BR IF NOT TRUE         @Z40CSJH 10459404
         OI    IEHMVV20+1,X'40'         SET CVOL=SYSRES        @Z40CSJH 10459504
         B     TOESIA                   TO ESI EXIT            @Z40CSJH 10459604
IERCVOL  L     R3,IEHMVV26              LOAD PTR TO INC LBOCK           10459804
         LA    R3,53(R3)                BUMP PTR TO FROM VOL SLOT       10459904
         XC    0(17,R3),0(R3)          CLEAR FROM LIST AREA      A27307 10460004
         MVC   0(4,R3),16(R2)      PUT TYPE IN LIST                     10466604
         MVC   4(6,R3),28(R2)           MOVE VOL ID INTO LIST           10468604
         B     MOUNTVOL                                                 10470604
MOUNTVOL DS    0H                                                       10472604
         TM    LOOKFOR+1,X'80'          I,E,R FILL                      10473004
         BO    MNT1                                                     10473104
         L     R1,IEHMVV24              PTR TO CVOL LIST                10473204
         B     MNT2                                                     10479904
MNT1     L     R1,IEHMVV26              I,E,R BLOCK                     10481904
         LA    R1,53(R1)                                                10483904
         B     MNT2                                                     10485904
MNT2     DS    0H                                                       10486304
         LR    R3,R1                                                    10486404
         LH    R4,ST                                                    10486504
    MVC  IEHMVV00+5(3),IEHMVV50+5        SET UP INTERNAL TABLE  POINTER 10493204
    MVC  IEHMVV00+10(1),IEHMVV50+4      SET  UP INTERNAL TABLE COUNT    10495204
     MVI  IEHMVV00+11,X'01'         SET UP NUMBER OF REQUESTS           10497204
         MVC   IEHMVV00+12(17),0(R1)                             A27307 10499204
     LA   3,IEHMVV00                                                    10499604
    MVI   IEHMVV00+4,X'10'      SET UP INDICATOR BYTE                   10499704
       IEHPOST (14),T                                                   10499804
         XCTL  (5,12),EP=IEHMVXSF                                       10499904
MNT3     TM    IEHMVV00+4,X'01'         WAS VOL MOUNTED                 10516504
         BZ    ERROUT                                                   10526504
LOCATE1  MVC   IEHMVV00(4),LOCSW2       FIRST WORD LOCATE LIST @Z40CSJH 10533604
LOCATE1A TM    LOOKFOR+1,X'80'          IS I,E,R. SW ON        @Z40CSJH 10550204
         BO    LOCATE2                  BRANCH YES                      10566804
         MVC   IEHMVV00+4(4),IEHMVV21   SECOND WORD OF LIST FOR LOCATE  10583404
         L     R1,IEHMVV24              CVOL LIST PTR                   10593404
         LA    R1,4(R1)                                                 10595404
         ST    R1,IEHMVV00+8            THIRD WORD OF LIST FOR LOCATE   10597404
LOCATE3  LA    R1,IEHMVV00+16                                           10600000
         ST    R1,IEHMVV00+12           FORTH WORD FOR LOCATE           10620000
         B     LOCATE4                                                  10640000
LOCATE2  L     R1,IEHMVV26              LOAD ADDR OF I E R BLOCK        10660000
         LA    R1,1(R1)                                                 10680000
         ST    R1,IEHMVV00+4            SECOND WORD OF LOCATE LIST      10700000
         LA    R1,56(R1)                                       @Z40CSJH 10750004
         ST    R1,IEHMVV00+8            THIRD WORD-LOCATE      @Z40CSJH 10752004
         B     LOCATE3                                                  10760000
LOCATE1B MVC   IEHMVV00(4),LOCSW        SET OPTION BYTES       @Z40CSJH 10770004
         B     LOCATE1A                 CONT. CAMLST SETUP     @Z40CSJH 10772004
LOCATE4 LOCATE IEHMVV00                                                 10780000
*********************************************************************** 10790002
* IF UNABLE TO LOCATE THE DATA SET, PRINT IEH471I AND QUIT            * 10792002
*********************************************************************** 10794002
         LA    15,0(15)                                                 10800000
         LTR   15,15                                                    10820000
         BNE   ERROUT                    BRANCH IF NOT SUCCESS @Z40CSJH 10840004
         TM    LOOKFOR+1,X'80'          I,E,R SW ON                     10860000
         BO    SETLIST1                                                 10880000
         LH    R3,IEHMVV00+16          LOAD COUNT OF VOL ENTRIES        10900000
         BCT   R3,*+10                 1 VOL, THEN SAVE DSCBTTR  S21042 10910021
         MVC   IEHMVV82(3),IEHMVV00+268 SAVE DSCBTTR             S21042 10912021
         LA    R3,1(R3)                 RESET R3                 S21042 10914021
         L     R1,NXTPTR               LOAD PERM WORK AREA PTR          10960000
         LA    R1,2(R1)                SKIP TWO BYTES                   10980000
         ST    R1,IEHMVV22              STORE PTR TO FROM LIST   A50958 10990022
         ST    R1,IEHMVV22+4            PTR TO ACTIVE FROM LIST  A50958 11000022
         LA    R4,IEHMVV00+18           FIRST CATALOG ENTRY      A50958 11030022
MOVELIST MVC   0(12,R1),0(R4)           MOVE ENTRY TO FROM LIST  A50958 11032022
         XC    12(5,R1),12(R1)          CLEAR UNIT FIELD         A50958 11034022
         LA    R1,17(R1)                NEXT FROM VOL LIST ENTRY A50958 11036022
         LA    R4,12(R4)                NEXT CATALOG ENTRY       A50958 11038022
         BCT   R3,MOVELIST              MOVE NEXT ENTRY IF ONE   A50958 11038422
         LA    R1,3(R1)                 ADD 3 TO PTR TO          A50958 11038522
         SRL   R1,2                     SET PTR TO NEXT          A50958 11038822
         SLL   R1,2                     FULLWORD BOUNDARY        A50958 11039222
         ST    R1,NXTPTR                STORE PERM WORK AREA PTR A50958 11040022
         TM    LOOKFOR+1,X'80'         IER FILL                         11100000
         BO    LOCATE5                                                  11120000
         IC    R1,IEHMVV00+17          INSERT COUNT OF ENTRIESIN LIST   11180000
         STC   R1,IEHMVV22             STORE IN HIGH ORDER BYTE OF PTR  11200000
LOCATE5  EQU   *                                                        11220000
         B     TRANS3                                                   11240000
SETLIST1 L     R1,IEHMVV26              LOAD ADDR OF IER BLOCK          11260000
         MVC   53(12,R1),IEHMVV00+18    MOVE VOL LIST INTO IER BLOCK    11280000
         B     WRITEUT1                                                 11300000
ERROUT   EQU   *                                                        11320000
         LA    R3,12                   LOAD MSG NO IN RS                11340000
LABEL    LA    R2,16                   RETURN TO ESK             A28295 11343019
         TM    IEHMVV90,X'20'          IS THIS END OF INPUT      A15815 11352019
         BO    OUT                     YES-- GO TO OUT           A15815 11358019
         LA    R2,12                                             A15815 11364019
OUT      MVI   ESTENTRY,X'00'          EST ENTRY TO INITIALIZE RTN15815 11370019
         MVI   ESTENTRY,X'00'          EST ENTRY TO INITIALIZE RTN      11380000
         DELETE EP=DEVNAMET            DELETE DEVICE NAME TABLE    I276 11386019
         XC    IEHMVV74+16(4),IEHMVV74+16        CLEAR ADDRESS     I276 11392019
       IEHPOST (14),T                                                   11400000
         XCTL  EP=IEHMVESA                                              11420000
*                                                                       11460000
*                                                                       11480000
*                                                                       11500000
*              THIS ROUTINE IS ENTERED IMMEDIATLY PRIOR TO TRANSFERING  11520000
*              CONTROL TO THE REQUEST HANDLING MODULES                  11540000
*                                                                       11560000
*              IT WILL ANALIZE THE INFORMATION PASSED BY THE REQUEST    11580000
*              TO INSURE THAT AT LEAST A MINIMUM OF INFORMATION         11600000
*              IS PRESENT                                               11620000
*                                                                       11640000
*                                                                     * 11660000
*              IT WILL WRITE DUMMY OR FILE TEXMINATOR RECORDS ON      * 11680000
*              UT1 AND UT2 IF EITHER FILE HAS BEEN WRITTEN ON         * 11700000
*              FOR THIS REQUEST     EXCEPT FOR A DSGROUP REQUEST      * 11720000
*                                                                     * 11740000
*                                                                     * 11760000
*                                                                     * 11780000
SCAEXIT1 TM    IEHMVV20,X'3E'           IS SUB OPERATION BIT ON         11800000
         BNE   *+12                                                     11820000
         LA    R3,11                                                    11840000
         B     ERROUT+4                                                 11860000
         TM    IEHMVV20,X'10'          IS DS GROUP BIT ON               11880000
         BO    EX3                                                      11900000
         TM    LOOKFOR+1,X'10'          IS UNC WRITE OUT SW ON          11920000
         BZ    SCANEX1                                                  11940000
         MVC   IEHMVV26+1(3),NOTEAREA   MOVE TTR TO COMM AREA           11960000
         MVI   IEHMVV26,X'FF'                                           11980000
SCANEX1  DS    0H                                                       12000000
         MVI   WRITAREA,C' '            MOVE BLANK TO FIRST BYTE OF KEY 12020000
         TM    LOOKFOR+1,X'10'          IS INC WRITE OUT SW ON          12040000
         BO    DUMUT1                                                   12060000
EX2      TM    LOOKFOR+1,X'08'          IS EXC WRITE OUT SW ON          12080000
         BO    DUMUT2                   BRANCH YES                      12100000
         B     EX3                                                      12120000
DWRITE   WRITE (DBR3),SF,(DBR1),WRITAREA,82,MF=E                        12140000
         CHECK (DBR3)                                                   12160000
         BR    DBCOMPR                                                  12180000
DUMUT1   L     DBR3,IEHMVV40+4          LOAD DECB ADDR                  12200000
         L     DBR1,IEHMVV40            LOAD DCB ADDR                   12220000
         BAL   DBCOMPR,DWRITE                                           12240000
         MVC   IEHMVV39(5),8(DBR1)      MOVE CCHHR TO COMM AREA         12260000
         B     EX2                                                      12280000
DUMUT2   L     DBR3,IEHMVV41+4          LOAD DECB ADDR                  12300000
         L     DBR1,IEHMVV41            LOAD DCB ADDR                   12320000
         BAL   DBCOMPR,DWRITE                                           12340000
         MVC   IEHMVV41+8(5),8(DBR1)    MOVE CCHHR TO COMMAREA          12360000
         B     EX3                                                      12380000
EX3      DS    0H                                                       12400000
         TM    IEHMVV20+1,X'80'         IS TO VOL BIT ON                12420000
         LA    R3,11                                                    12440000
         BZ    ERROUT+4                 BRANCH IF NO                    12460000
         MVI   LOOKFOR,X'00'                                            12480000
         TM    LOOKFOR+1,X'10'         IS INC WRITE OUT SW ON           12500000
         BZ    SET1                     BRANCH IF NO                    12520000
         OI    XSWITCHS+1,X'08'                                         12540000
SET1     TM    LOOKFOR+1,X'08'          IS EXC WRITE OUT SW ON          12560000
         BZ    SET2                     BRANCH IF NO                    12580000
         OI    XSWITCHS+1,X'04'         TURN ON ANY EXC REP SW          12600000
SET2     TM    LOOKFOR+1,X'01'          SEL INPUT BIT ON                12620000
         BZ    SET3                     BRANCH NO                       12640000
         OI    XSWITCHS+1,X'02'         TURN ON ANY SEL SW              12660000
SET3     DS    0H                                                       12680000
         MVC   IEHMVV20+2(1),XSWITCHS+1                                 12700000
         L     NXRPTR,NXTPTR            ALIGN PERM WORK AREA PTR        12720000
         LA    NXRPTR,4(NXRPTR)        BUMP BY 4                        12740000
         SRL   NXRPTR,2                                                 12760000
         SLL   NXRPTR,2                                                 12780000
         ST    NXRPTR,IEHMVV10                                          12800000
         TM    IEHMVV20+3,X'40'        TODD SW ON              @ZA07411 12820008
         BNO   OK                      NO STOP CHECKING        @ZA07411 12822008
         TM    IEHMVV20,X'02'          VOLUME SW ON            @ZA07411 12824008
         BNO   OK                      NO STOP CHECKING        @ZA07411 12826008
         L     R9,IEHMVV23             CHECK IF TO DEVICE      @ZA07411 12828008
         TM    2(R9),X'80'             IS TAPE OR NOT          @ZA07411 12830008
         BO    OK                      IF TAPE OK              @ZA07411 12832008
         NI    IEHMVV20+3,X'BF'        IF NOT RESET TODD SW    @ZA07411 12834008
OK       TM    IEHMVV20,X'10'          IS DSGROUP SW ON        @ZA07411 12836008
         BO    ESIEXIT                                                  12840000
         B     ESZEXIT                                                  12860000
ESSEXIT  EQU   *                                                        12880000
       IEHPOST (14),T                                                   12900000
         XCTL  (4,12),EP=IEHMVESS                                       12920000
ESZEXIT  EQU   *                                                        12940000
         TM    IEHMVV20+3,X'04'        RENAME SWITCH ON?         A28295 12941019
         BZ    TOESZ                   NO - BRANCH               A28295 12942019
         BAL   R9,RENAMCHK             CHECK FOR VALID RENAME    A28295 12943019
TOESZ    DELETE  EP=DEVNAMET           DELETE DEVICE NAME TABLE  A28295 12944019
         XC    IEHMVV74+16(4),IEHMVV74+16        CLEAR ADDRESS     I276 12952019
       IEHPOST (14),T                                                   12960000
         XCTL  (4,12),EP=IEHMVESZ                                       12980000
ESJEXIT  EQU   *                                                        13000000
       IEHPOST (14),T                                                   13020000
    XCTL   (4,12),EP=IEHMVESJ                                           13040000
ESIEXIT  EQU   *                                                        13060000
         TM    IEHMVV20+3,X'04'        RENAME SWITCH ON?         A28295 13061019
         BZ    TOESI                   NO - BRANCH               A28295 13062019
         BAL   R9,RENAMCHK             CHECK FOR VALID RENAME    A28295 13063019
TOESI    DELETE  EP=DEVNAMET           DELETE DEVICE NAME TABLE  A28295 13064019
         XC    IEHMVV74+16(4),IEHMVV74+16        CLEAR ADDRESS     I276 13072019
         XC    IEHMVV27+D12(L8),IEHMVV27+D12  CLEAR AREA         Y02918 13074002
         TM    IEHMVV20+5,X'20'       WAS NAME SPECIFIED       @Z40CSJH 13076004
         BO    TOESH                  YES-TO VESH              @Z40CSJH 13078004
         TM    IEHMVV20+1,X'40'         WAS CVOL SPECIFIED     @Z40CSJH 13078404
         BO    TOESIA                   BR IF YES              @Z40CSJH 13078804
         L     R15,CLEARMSK             SET R15 SWITCH         @Z40CSJH 13079204
         B     FINDRES                  GET SYSRES VOLID       @Z40CSJH 13079604
TOESIA IEHPOST (14),T                                          @Z40CSJH 13080004
         XCTL  (4,12),EP=IEHMVESI                                Y02918 13081004
TOESH    EQU   *                      IEHMVESH EXIT            @Z40CSJH 13091004
         TM    IEHMVV20+1,X'40'         IS CVOL BIT ON         @Z40CSJH 13093004
         BO    TOESIA                   YES-TO VESI            @Z40CSJH 13095004
         IEHPOST (14),T                                        @Z40CSJH 13101004
         XCTL  (4,12),EP=IEHMVESH     GENERIC LOCATE           @Z40CSJH 13111004
*********************************************************************** 13131022
*                                                                     * 13133022
*                                                                     * 13135022
*  THE FOLLOWING ROUTINE CHECKS THE VALIDITY OF THE             A48781* 13137022
*  DATA SET NAME, AS SPECIFIED IN THE RENAME-PARAMETER.         A48781* 13137422
*  EACH NAME OR SUBNAME (FOR CATALOGUED DATA SETS CORRESPONDING A48781* 13137522
*  TO THE LEVELS) MAY CONSIST ONLY OF ALPHAMERIC OR NATIONAL OR A48781* 13137622
*  HYPHEN OR +0 (I.E. A 12-0 MULTIPUNCH) CHARACTERS,WHILE THE   A48781* 13143222
*  FIRST ONE IN EACH NAME OR SUBNAME MUST BE ALPHABETIC OR      A48781* 13145222
*  NATIONAL. FURTHERMORE EACH NAME MUST CONTAIN 1 TO 8 CHARAC-  A48781* 13147222
*  TERS.                                                        A48781* 13147622
*                                                                     * 13148022
*                                                                     * 13148422
*********************************************************************** 13148522
RENAMCHK L     DBR1,IEHMVV21        FIND FROM- AND TO-DATA SET-  A48781 13150522
         L     DBNXRPTR,IEHMVV21+4  NAME-ADDRESSES               A48781 13152522
         CLC   0(44,DBNXRPTR),0(DBR1) COMPARE FROM-WITH NEW-NAME A48781 13154522
         BNE   TESTNAME             IF UNEQUAL,CHECK VALIDITY    A48781 13154622
         NI    IEHMVV20+3,X'FB'     OTHERWISE,TURN OFF RENAMEBIT A48781 13154722
         B     0(R9)                AND CONTINUE PROCESSING      A48781 13154822
TESTNAME LA    DBCOMPR,44(DBNXRPTR) INITIALISATION OF END OF NEW A48781 13155822
         BCTR  DBNXRPTR,0           DATA SET NAME                A48781 13158022
CHKCHAR1 SR    DBR1,DBR1            INITIALISATION OF COUNTER    A48781 13159022
*                                   FOR CHARS IN EACH NAME       A48781 13160022
         LA    DBNXRPTR,1(DBNXRPTR) POINTER TO NEXT CHAR IN DSN. A48781 13160922
         CR    DBNXRPTR,DBCOMPR     CHECK FOR END OF DSNAME AFTERA48781 13161322
         BE    INVALID              HAVING FOUND A PERIOD        A48781 13167722
TEST     CLI   0(DBNXRPTR),X'5B'    CHECK FOR DOLLAR-SIGN        A48781 13169722
         BE    VALID                DOLLAR-SIGN ALLOWED          A48781 13171722
         CLI   0(DBNXRPTR),X'7B'    CHECK FOR NUMBER-SIGN        A48781 13173722
         BE    VALID                NUMBER-SIGN ALLOWED          A48781 13174122
         CLI   0(DBNXRPTR),X'7C'    CHECK FOR @-SIGN             A48781 13174222
         BE    VALID                @-SIGN ALLOWED               A48781 13174322
         CLI   0(DBNXRPTR),X'C1'    CHECK FOR                    A48781 13176222
         BL    INVALID                    ALPHABETIC CHARACTERS  A48781 13178222
         CLI   0(DBNXRPTR),X'CA'    ALPHABETIC CHARACTERS A      A48781 13178622
         BL    VALID                      THROUGH I ALLOWED      A48781 13179022
         CLI   0(DBNXRPTR),X'D1'    CHECK FOR                    A48781 13179422
         BL    INVALID                    ALPHABETIC CHARACTERS  A48781 13179822
         CLI   0(DBNXRPTR),X'DA'    ALPHABETIC CHARACTERS J      A48781 13179922
         BL    VALID                      THROUGH R ALLOWED      A48781 13185622
         CLI   0(DBNXRPTR),X'E2'    CHECK FOR                    A48781 13187622
         BL    INVALID                    ALPHABETIC CHARACTERS  A48781 13189622
         CLI   0(DBNXRPTR),X'EA'    ALPHABETIC CHARACTERS S      A48781 13190022
         BL    VALID                      THROUGH Z ALLOWED      A48781 13190422
INVALID  LA    DBR1,18              INDIC. MSG. IEH390I-INVALID  A48781 13190822
         B     LABEL                DSNAME IN RENAME-PARAMETER   A48781 13191222
VALID    LA    DBR1,1(DBR1)         UPDATE CTR FOR NMBR OF       A48781 13191322
         CH    DBR1,DBEIGHT         VALID CHARACTERS IN DSNAME   A48781 13191422
         BH    INVALID              ERROR IF MORE THAN 8 CHAR.   A48781 13192122
         LA    DBNXRPTR,1(DBNXRPTR) POINTER TO NEXT CHAR. IN DSN.A48781 13192522
         CR    DBNXRPTR,DBCOMPR     CHECK FOR END OF VALID       A48781 13192922
         BE    0(R9)                DSNAME WITH 44 CHARACTERS    A48781 13193322
         CLI   0(DBNXRPTR),X'40'    CHECK FOR END OF VALID       A48781 13193422
         BE    0(R9)                DSNAME WITH LESS THAN 44CHAR A48781 13193522
         CLI   0(DBNXRPTR),X'4B'    CHECK FOR PERIOD             A48781 13195122
         BE    CHKCHAR1             IF PERIOD,RESET CTR ANDBRANCHA48781 13197122
         CLI   0(DBNXRPTR),X'60'    CHECK FOR HYPHEN             A48781 13197522
         BE    VALID                HYPHEN ALLOWED AS NOT-FIRST  A48781 13197922
*                                                  CHARACTER     A48781 13198322
         CLI   0(DBNXRPTR),X'C0'    CHECK FOR 12-0 MULTIPUNCH    A48781 13203522
         BE    VALID                12-0 MULTIPUNCH ALLOWED      A48781 13205522
*                                       AS NON-FIRST CHARACTER   A48781 13207522
         CLI   0(DBNXRPTR),X'F0'    CHECK FOR NUMERIC CHARACTERS A48781 13207922
         BL    TEST                 NUMERIC CHARACTERS           A48781 13208322
         CLI   0(DBNXRPTR),X'FA'    ALLOWED AS                   A48781 13208722
         BL    VALID                NON-FIRST CHARACTERS IN NAME A48781 13210122
         B     INVALID              TEST FOR ALPHABETIC OR       A48781 13212122
*                                       NATIONAL CHARACTERS      A48781 13212522
        IEHMVV                                                   A48781 13212922
IEHMVSST CSECT                                                   A48781 13214322
WRITAREA EQU   IEHMVV00                                          A48781 13219222
FAADD    EQU   IEHMVV27                                          A48781 13224422
SARG     EQU   IEHMVV27+12                                       A48781 13229622
NOTEAREA EQU   IEHMVV27+20                                       A48781 13234822
LOOKFOR  EQU   IEHMVV27+24                                              13240000
ESSENTRY EQU   IEHMVV27+4                                               13260000
ESTENTRY EQU   IEHMVV27+5                                               13280000
XSWITCHS EQU   IEHMVV27+28                                              13300000
NXTPTR   EQU   IEHMVV10                                                 13320000
MASK1    DC    XL6'000000300400'                                 A37919 13340021
         DS    0H                                                       13360020
DBCTONE  DC    XL4'01000000'                                            13380000
FUDJFACT DC    HL2'114'                                                 13400000
ST       DC    C'ST'                                                    13420000
         DS    0F                                                       13440000
DBEIGHT  DC    XL2'08'                                           A33297 13450020
LOCSW2   DC    XL4'C0000000'            LOC OPTIONS            @Z40CSJH 13452004
LOCSW    CAMLST  NAME,LOCSW,,LOCSW   LOCATE BY NAME WITHOUT CVOLYL026VC 13460002
PATCH    DS    10F                      PATCH AREA             @Z40CSJH 13470004
         END                                                            13480000
./  ADD  SSI=62440131,NAME=IEHMVESU
*TITLE ' IEHMVLSU                                                     * 00020000
*FUNCTION/OPERATION: THIS MODULE IS THE MESSAGE WRITER MODULE. IT     * 00040000
*PRINTS THE HEADER AND PAGE NUMBER ON EACH PAGE. PRINTS MESSAGE AND   * 00060000
*ADJUST LINE COUNT.                                                   * 00080000
*ENTRY POINTS: IEHMVESU IS ONLY ENTRY POINT                           * 00100000
*INPUT: AT ENTRY REG 13 POINT TO SAVEAREA REG 12 POINTS AT            * 00120000
*COMMUNICATION TABLE AND REG 3 POINTS TO START OF THE MESSAGE MINUS   * 00140000
*ONE.                                                                 * 00160000
*OUTPUT: REG ARE SAME AS AT INPUT                                     * 00180000
*EXTERNAL ROUTINES: NONE                                              * 00200000
*EXITS - NORMAL RETURNS TO MODULE WHICH PASSED CONTROL.               * 00220000
*ERRORS: I/O ERROR CAUSES SYSTEM TO TERMINATE JOB                     * 00240000
*TABLES/WORK AREAS: IEHMVV - COMMUNICATION TABLE                      * 00260000
IEHMVSSU CSECT                                                          00280000
*A010000-01360,014000-014400,017000,018220-018320,020400        YA01194 00280316
*A023200-023360,025420-025540                                   YA01194 00280616
*C019400,019800                                                 YA01194 00280916
*D006600,010000-010200,014000-014600,015600-015800,017000-017600YA01194 00281216
*D018400-019200,020400-020600,023200,024200-025000,026200-028400YA01194 00281516
*C018000,018200                                                  A48818 00282022
* 012200-012400                                                  A26720 00286019
* 015000,020400                                                  A26995 00292019
R0       EQU   0                                                        00300000
R1       EQU   1                                                        00320000
R2       EQU   2                                                        00340000
R3       EQU   3                                                        00360000
R4       EQU   4                                                        00380000
R5       EQU   5                                                        00400000
R6       EQU   6                                                        00420000
R7       EQU   7                                                        00440000
R8       EQU   8                                                        00460000
R9       EQU   9                                                        00480000
R10      EQU   10                                                       00500000
R11      EQU   11                                                       00520000
R12      EQU   12                                                       00540000
R13      EQU   13                                                       00560000
R14      EQU   14                                                       00580000
R15      EQU   15                                                       00600000
IEHMVESU SAVE  (14,12),T,ESU-10-27-65-LINK                              00620000
         USING IEHMVESU,R10            SET                              00640000
         USING IEHMVV,R12                     ADDRESSABILITY            00680000
         ENTRY IEHMVESU                                                 00700000
         LR    10,15                    LOAD  BASE                      00720000
         SR    R15,R15                                                  00740000
         IEHPRE (14,1),TF               POINT TO NEW SAVE AREA          00760000
         TM    IEHMVV51,INITIAL                                         00780000
         BC    8,FRSTNTRY               YES                             00800000
         BAL   R9,PRINT                                                 00820000
RETURN   IEHPOST (14,1),T               RESTORE TO INIT1                00840000
         SR    R15,R15                  SET ERROR CODE TO ZERO          00860000
ERRET    RETURN (2,12),T,RC=(15)                                        00880000
SINAD    OI    IEHMVV41+13,X'08'    SET RETURN CODE = 16                00900000
         IEHPOST  (14,1),T                                              00920000
         LA    R15,4                    SET RETURN CODE = 4             00940000
         B     ERRET                                                    00960000
*                                                                       00980000
PRINT    EQU   *                                                YA01194 01000016
         CLI   IEHMVV51,TRISPACE       CHECK NUMBER OF SPACE    YA01194 01002016
         BL    A1                      ONE SPACE GO TO A1       YA01194 01004016
         BH    A2                      TWO SPACE GO TO A2       YA01194 01006016
         CLI   IEHMVV51+11,THREE       CHECK IF IEHMVV51+11 IS  YA01194 01008016
*                                       EQUAL OR GREATER THAN 3 YA01194 01010016
         BNL   PRINT1                  YES , GO TO PRINT1       YA01194 01012016
         B     A3                      NO , GO TO A3            YA01194 01014016
A1       CLI   IEHMVV51+11,ONE         CHECK IF IEHMVV51+11 IS  YA01194 01016016
*                                       EQUAL OR GREATER THAN 1 YA01194 01018016
         BNL   PRINT1                  YES , GO TO PRINT1       YA01194 01020016
         B     A3                      NO , GO TO A3            YA01194 01022016
A2       CLI   IEHMVV51+11,TWO         CHECK IF IEHMVV51+11 IS  YA01194 01024016
*                                       EQUAL OR GREATER THAN 2 YA01194 01026016
         BNL   PRINT1                  YES , GO TO PRINT1       YA01194 01028016
A3       BAL   R8,HEADER               NO , GO TO HEADER        YA01194 01030016
PRINT1   EQU   *                                                YA01194 01032016
         IC    R2,IEHMVV51             INSERT CONTROL CHARACTER YA01194 01034016
         STC   R2,0(R3)                PLACE CHAR IN MESSAGE    YA01194 01036016
         L     R4,IEHMVV33             LOAD ADDR OF SYSPRINT DCB        01040000
         LA    R4,0(0,4)               ZERO OUT HIGH ORDER BITS         01060000
         CLC   1(3,R3),IEH         CHECK FOR ERROR MSG BEING PRINTED    01080000
         BE    ERR                   IF SO---                           01100000
         CLC   2(3,R3),IEH                                              01120000
         BE    ERR                                                      01140000
         CLC   3(3,R3),IEH        CHECK FOR ERROR MSG BEING PRINTED     01160000
         BE    ERR                                                      01180000
         B     PRI                                                      01200000
IEH      DC    CL3'IEH'                                                 01220000
ERR      TM    IEHMVV41+13,X'FF'       TEST EXISTING RETURN CODE A26720 01230019
         BNE     PRI                   IF CODE IS NOT 0, BRANCH  A26720 01240019
         OI    IEHMVV41+13,X'01'       SET RETURN CODE = 4       A26720 01250019
PRI      DS    0H                                                       01260000
         LA    R1,SINAD            LOAD SYNAD ADDR                      01280000
         IC    R0,56(R4)                                                01300000
         ST    R1,56(R4)                                                01320000
         STC   R0,56(R4)                                                01340000
         PUT   (R4),(R3)                                                01360000
         LH    R7,IEHMVV51+10          LINES TO GO ON CURRENT PAGE      01380000
         BCTR  R7,0                    DECREASE LINE COUNT      YA01194 01400016
         CLI   IEHMVV51,X'60'          CHECK NUMBER OF SPACE    YA01194 01440016
         BL    SINGLE                                                   01480000
         BH    ZIP                    IF HIGH,CAUSE DOUBLE SPACE A26995 01500019
         BCTR  R7,0                    DECREASE                         01520000
ZIP      BCTR  R7,0                             LINE COUNT              01540000
SINGLE   STH   R7,IEHMVV51+10          STORE CURRENT LINES TO GO        01600000
         MVI   IEHMVV51,X'40'           SET SINGLE SPACE CODE           01620000
         BR    R9                                                       01640000
*                                                                       01660000
*                                                                       01680000
HEADER   LH    R6,IEHMVV51+12          LOAD CURRENT PAGE NUMBER YA01194 01700016
         CVD   R6,DOUBLE               CONVERT PAGE NUMBER FROM         01780000
         UNPK  NUMB(4),DOUBLE+5(3)       BINARY TO DECIMAL       A48818 01800022
         OI    NUMB+3,PLUS             INSURE CORRECT SIGN       A48818 01820022
         LA    R11,NUMB                                         YA01194 01822016
LOOP     CLI   0(R11),ZERO             CHECK IF ANY LEFT ZEROES YA01194 01824016
         BH    PUT                      NO , GO TO PUT          YA01194 01826016
         MVI   0(R11),BLANK             YES , MOVE A BLANK      YA01194 01828016
         LA    R11,1(R11)              INCREASE R11 WITH ONE    YA01194 01830016
         B     LOOP                    GO TO LOOP               YA01194 01832016
PUT      L     R4,IEHMVV33             DCB ADDRESS FOR SYSPRINT YA01194 01940016
         LA    R4,0(0,R4)              ZERO OUT THE HIGH ORDER BITS     01960000
         PUT   (R4),PRINTOUT                                    YA01194 01980016
         MVI   IEHMVV51,TRISPACE       TRIPLE SPACE BEFORE PRINT        02000000
         LH    R6,IEHMVV51+8           LINES PER PAGE                   02020000
         BCTR  R6,0                    DECREASE LINE COUNT      YA01194 02040016
         STH   R6,IEHMVV51+10          RESTORE CURRENT LINE TO GO       02080000
         LH    R6,IEHMVV51+12          *                                02100000
         LA    R6,1(0,6)                * ADD ONE TO PAGE NUMBER        02120000
         STH   R6,IEHMVV51+12          *                                02140000
         BR    R8                                                       02160000
FRSTNTRY DS    0H                                                       02180000
         LR    R3,R12                                                   02200000
         LH    R5,IEHMVV51+8           LINES PER PAGE                   02220000
         STH   R5,IEHMVV51+10          INITIALIZE LINES TO GO           02240000
         BAL   R8,HEADER               GO TO HEADER PRINT ROUTINE       02260000
         B     RETURN                                                   02280000
TRISPACE EQU   X'60'                                                    02300000
BLANK    EQU   X'40'                                            YA01194 02320016
THREE    EQU   X'03'                                            YA01194 02324016
TWO      EQU   X'02'                                            YA01194 02328016
ONE      EQU   X'01'                                            YA01194 02332016
ZERO     EQU   X'F0'                                            YA01194 02336016
PLUS     EQU   X'F0'                                                    02340000
INITIAL  EQU   X'FF'                                                    02360000
*                                                                       02380000
*                                                                       02400000
         DS    0D                                                       02520000
DOUBLE   DC    2F'0'                                                    02540000
PRINTOUT DS    0CL121                                           YA01194 02542016
CC       DC    X'F1'                                            YA01194 02544016
         DC    CL37'SYSTEM SUPPORT UTILITIES ---- IEHMOVE'      YA01194 02546016
         DC    CL63' '                                          YA01194 02548016
         DC    CL5'PAGE'                                        YA01194 02550016
NUMB     DC    CL15' '                                          YA01194 02552016
         SPACE 2                                                YA01194 02554016
         IEHMVV                                                         02560000
*                                                                       02580000
*                                                                       02600000
         END                                                            02860000
./  ADD  SSI=62440132,NAME=IEHMVETG
 TITLE 'IEHMVETG-HANDLES INCLUDE, REPLACE AND SELECT REQS FOR A PDS'    00010017
*        IEHMVETG                                                       00020000
*                                                                       00040000
* FUNCTION                                                              00060000
*                                                                       00080000
*THIS IS THE MODULE THAT WILL HANDLE ALL INCLUDE AND REPLACE REQUESTS   00100000
*FOR A  MOVE OR COPY PDS.       THE INCLUDE REPLACE LIST IS PUT ON A    00120000
*WORK FILE IN ANY SEQUENCE,JUST THE WAY THEY ARE RECEIVED FROM THE USER 00140000
*THE MODULE WILL FIRST CHECK TO SEE IF THERE ARE ANY INC/REP FROM THE   00160000
*ORIGINAL VOLUME THAT CONTAINED THE PDS TO BE COPIED OR MOVED.IF NONE   00180000
*EXIST, THEN THE PROGRAM WILL READ THE FIRST INC/REP REQUEST FROM THE   00200000
*WORKFILE,AND HAVE THAT VOLUME MOUNTED.IT WILL THEN CHECK THE DSCB  TO  00220000
*MAKE SURE THE INCLUDE IS COMPATABLE WITH THE DATA SET ALREADY MOVED.   00240000
*THE FOLLOWING ARE CHECKED FOR COMPATABILITY                            00260000
*                                                                       00280000
* 1)TEST IS MADE TO SEE IF DATA SET IS A PDS                            00300000
* 2)TEST IS MADE TO INSURE THAT RECORD FORMATS ARE THE SAME             00320000
* 3)TEST IF BLKSIZE OF INCLUDE DS FITS ON THE ORIGINAL FROM DS          00340000
* 4)TEST TO SEE IF KEY LENGTHS ARE EQUAL                                00360000
*                                                                       00380000
*IF ALL THESE TESTS ARE MET, THEN WE CHECK TO SEE IF THE APPROPRIATE    00400000
*VOLUME IS MOUNTED. IF NOT, THEN WE GO TO A VOLUME MOUNT ROUTINE  WITH  00420000
*REG1 POINTING TO VOLUME INFO. WHICH THEN HAS THE CORRECT VOLUME MOUNTD 00440000
*ONCE WE'VE DETERMINED THAT THE CORRECT VOLUME IS MOUNTED,WE ARE READY  00460000
*TO OPEN THIS DATA SET. WE USE THE OPENJ MACRO,FOR WHICH WE HAVE TO     00480000
*BUILD A MODEL JFCB AND SET IT UP WITH DSNAME, MEMBER NAME, VOLUME      00500000
*INFO IN IT. THERE IS ALSO AN EXIT LIST POINTER IN MY DCB TO A LIST FOR 00520000
*OPENJ. THIS OPENS OUR DATA SET AND LET'S US  GET THE CORRECT DIRECTRY  00540000
*ENTRY BY USING BLDL. ONCE WE HAVE THE DIRECTORY ENTRY WE WRITE IT OUT  00560000
*ON A WORK FILE. THE FORMAT OF THIS WORKFILE IS:                        00580000
*                                                                       00600000
* 4 BYTE KEY OF  ATTR                                                   00620000
*       A=00 IF THE NAME IS A TRUE MEMBER NAME                          00640000
*       A=80 IF THE NAME IS AN ALIAS                                    00660000
*     TTR=IS THE TTR TAKEN FOLLOWING THE MEMBER NAME IN THE DIR ENTRY   00680000
*FOLLOWED BY A VARIABLE SIZE DATA RECORD MAX SIZE OF 87 BYTES           00700000
*THE DATA PORTION IS BROKEN DOWN INTO THE FOLLOWING PARTS               00720000
*       1)FIRST 5 BYTES IS THE CCHHR OF THE RECORD ITSELF               00740000
*       2)THE NEXT (X) BYTES IS THE DIRECTORY ENTRY                     00760000
*       3)FOLLOWING THE DIR ENTRY WE HAVE AN 8 BYTE FIELD WHICH CON     00780000
*         TAINS A MEMBER NAME TO BE USED TO STOW WITH. THIS LAST FIELD  00800000
*         IS FOR THE RENAME OPTION.                                     00820000
*                                                                       00840000
*ONCE WE HAVE PROCESSED ALL THE ENTRIES THAT PERTAIN TO A CERTAIN DATA  00860000
*SET ON A CERTAIN VOLUME THEN WE TCLOSE BOTH THE INPUT AND OUTPUT WORK  00880000
*FILES AND TRANSFER CONTROL TO THE MOVE/COPY PDS MODULE.                00900000
*EVERYTIME AN ENTRY IS PROCESSED AND PUT ON THE OUTPUT WORKFILE THAT    00920000
*ENTRY'S KEY IS ZEROED OUT ON THE INPUT WORKFILE WHICH PREVENTS US FROM 00940000
*PROCESSING IT AGAIN.                                                   00960000
*ONCE EVERYTHING HAS BEEN PROCESSED THE INC/REP BIT ON IEHMVV IS TURNED 00980000
*OFF WHICH TELLS THE MOVE/COPY PDS MODULE NOT TO TRANSFER CONTROL TO    01000000
*THE INC/REP MODULE                                                     01020000
*                                                                       01040000
*                                                                       01060000
* INPUT        A WORKFILE AS DESCRIBED IN THE MODULE FUNCTION.          01080000
*                                                                       01100000
* OUTPUT       A WORKFILE OF 4 BYTES OF KEY AND A MAXIMUM DATA PORTION  01120000
*              OF 87 BYTES. FIRST FIVE BYTES ARE CCHHR FOLLOWED BY A    01140000
*              DIRECTORY ENTRY WHICH CAN BE FOLLOWED BY A RENAME FIELD. 01160000
*                                                                       01180000
* EXTERNAL RTN VOLUME MOUNT ROUTINE                                     01200000
*              WRAP UP MODULE (IEHMVESN)                                01220000
*                                                                       01240000
* EXITS        PRINT MSG MODULE(IEHMVESU) VIA LINK                      01260000
*                                                                       01280000
* WORK AREA    WORK AREA FOR 'OBTAIN' MACRO                             01300000
*              WORK AREA FOR I/O BUFFERS                                01320000
*                                                                     * 01340000
* ATTRIBUTES NON-REEENTRANT                                             01350004
*                                                                       01360004
IEHMVSTG CSECT                                                          01370004
*                                                                       01380004
*A034264-034268                                                @ZA11945 01382099
*C035000                                                       @ZA11945 01384099
*A034220-034360                                                @ZA07033 01390004
*A024210-024260                                                @ZA01247 01440802
*C037660,037920,038060,038840,038880,039100,039320,039400      @ZA01247 01440902
*C039480,039620,039680,040040,040080,040120,040490,040550      @ZA01247 01441002
*C040600,041120,041300,041320,142745,142763                    @ZA01247 01441102
*D037740-037796                                                @ZA01247 01441202
*A37730-37790                                                   YM00561 01441302
*D24210-24260                                                   YM00561 01441402
*C37660,37920,38060,38840,38880,39100,39320,39400,39480,39620   YM00561 01442000
*C39680,40040,40080,40120,40490,40550,40600,41120,41300,41320   YM00561 01442500
*C142745,142763                                                 YM00561 01443000
*C040900,041460,046400,107200                                    YM5087 01443500
*A109700                                                         YM5086 01444000
*A017880-017988,024210-024260,037600-041890,                    YA01217 01444516
*A107220-107420,110400,111600,113200,114600,115800,117000,118200YA01217 01445016
*A119400,121200-121560,122400,123100,123260-123320,124400,124700YA01217 01445516
*A127500,142700-142790,147620-147720,157766-157790              YA01217 01446016
*D017840,017880-017940,037600-042000,107220-107600              YA01217 01446516
*D108200-108400,110000,110400-110600,111000,111600-111800,112200YA01217 01447016
*D113200-113400,113800,114600-114800,115200-116000,116400       YA01217 01447516
*D117000-117200,117600,118200-118400,118800,119400-119600,120000YA01217 01448016
*D121200-121400,121800,122400-122600,124400,125600,127800,142400YA01217 01448516
*D142700                                                        YA01217 01449016
*C126000,126400,048400                                          YA01217 01449516
*D049060                                                          M0121 01450416
*D043000,043200                                                   M2686 01450516
*C043400                                                          M2686 01451016
*A049000                                                          M2686 01451516
*A107264-107268                                                  A45202 01452022
*C026300                                                         A38742 01460021
*030000-030800,055400-057000,059800,070800-078390,083060-083120, S20201 01460120
*135600                                                                 01460220
* ALL CODE FLAGGED S20201 WAS ADDED OR CHANGED FOR RLSE 20.2     S20201 01460320
*   RPS SUPPORT                                                  S20201 01460420
* 023800,024400                                                  A27790 01460520
* 107226-107232                                                  A25562 01461019
REG0     EQU   0                                                        01480000
REG1     EQU   1                                                        01500000
REG2     EQU   2                                                        01520000
REG3     EQU   3                                                        01540000
REG4     EQU   4                                                        01560000
REG5     EQU   5                                                        01580000
REG6     EQU   6                                                        01600000
REG7     EQU   7                                                        01620000
REG8     EQU   8                                                        01640000
REG9     EQU   9                                                        01660000
BASE10   EQU   10                                                       01680000
REG11    EQU   11                                                       01700000
REG12    EQU   12                                                       01720000
REG13    EQU   13                                                       01740000
REG14    EQU   14                                                       01760000
REG15    EQU   15                                                       01780000
CCWS     EQU   216                     BYTES IN CCW CHAIN        S20201 01782020
RPS      EQU   4                       RECORD READY FEATURE      S20201 01786020
PO       EQU   X'02'               DSORG PARTITIONED            YA01217 01788016
F        EQU   X'80'               RECFM FIXED                  YA01217 01788616
V        EQU   X'40'                     VARIABLE               YA01217 01789216
U        EQU   X'C0'                     UNDEFINED              YA01217 01790016
T        EQU   X'20'                     TRACK OVERFLOW         YA01217 01791016
B        EQU   X'10'                     BLOCKED                YA01217 01792016
S        EQU   X'08'                     STANDARD / SPANNED     YA01217 01793016
KEYLEN0  EQU   X'01'                     DCB KEYLEN ZERO        YA01217 01794016
TFEATURE EQU   X'40'               UCBTYP TRACK OVERFLOW FEATUREYA01217 01795016
ALL      EQU   X'FF'                                            YA01217 01796016
ZERO     EQU   X'00'                                            YA01217 01797016
BLANK    EQU   C' '                                             YA01217 01798016
         SPACE 2                                                YA01217 01799016
IEHMVETG SAVE  (14,12),T,ETG-SEPT-8/65                                  01800000
         BALR  BASE10,0                                                 01820000
         USING *,BASE10                                                 01840000
         ENTRY IEHMVETG                 THIS IS MY ENTRY POINT          01860000
         USING IEHMVV,REG12             USE REG12 TO GET TO COMTABLE    01880000
         USING CORE,REG11                                               01900000
         USING GETCORE,REG9     USING AS A BASE REGISTER                01920000
         USING MESSAGES,REG7        BASE FOR MSG CSECT                  01940000
         TM    IEHMVV20+4,X'10'         IS THIS RET FROM VOL MNT        01960000
         BZ    SAVE                           IF NOT ---                01980000
         NI    IEHMVV20+4,X'EF'            TURN OFF VOL RET BIT         02000000
         B     VOLRET                                                   02020000
SAVE EQU *                                                              02040000
         IEHPRE ,FT                                                     02060000
*                                                                       02080000
* THIS POINT IS DONE ONCE FOR EVERY TIME THE PROGTAM IS ENTERED         02100000
*                                                                       02120000
         NI    IEHMVV20+2,X'7F'        TURN OFF ALAIS SWITCH       9312 02140000
         L     REG1,IEHMVV42    ADDRESS OF SYSUT3 DCB                   02160000
         LA    REG0,POINT   ADDRESS OF TTR0=0010                        02180000
         POINT (1),(0)   POINT TO BEG OF SYSUT3                         02200000
         L     REG2,IEHMVV42        ADDR OF SYSUT3 DCB                  02220000
         MVI   18(REG2),X'7F'       SET TRK BAL TO MAX                  02240000
         MVI   19(REG2),X'FF'       SET TRK BAL TO MAX                  02260000
*NOW WE SET UP THE PROGRAM BASE,DO,SOME GETMAINS AND DO SOME GENERAL    02280000
*HOUSEKEEPING AND CLOSE THE OLD INPUT DCB                               02300000
*                                                                       02320000
REPEAT   L     REG2,IEHMVV30   ADDRESS OF INPUT DCB                     02340000
         LA    REG2,0(0,REG2)        CLEAR HIGH ORDER BYTE              02360000
         CLOSE ((2),REREAD)             CLOSE THE OLD INPUT DCB  A27790 02380019
         L     REG2,IEHMVV31       ADDRESS OF OUTPUT DCB                02400000
* THIS RTN SAVES THE VOL SER NBR AND FILE SEQ NBR FOR IEHMVESN   A43752 02401021
         TM    IEHMVV82+24,X'80'       VOL SER NBR ALREADY SAVED A43752 02401221
         BO    SKIPSAVE                YES SKIP THE SAVE RTN     A43752 02401421
         TM    48(REG2),X'10'          DCB OPEN                  A43752 02401621
         BNO   SKIPSAVE                NO SKIP THE SAVE RTN      A43752 02401821
         L     REG9,44(REG2)           DEB ADDRESS               A43752 02402021
         SR    REG2,REG2               CLEAR FOR INSERT          A43752 02402521
         IC    REG2,16(REG9)           NBR OF EXTENTS            A43752 02403021
         TM    28(REG9),X'04'          TO DEVICE DA              A43752 02404021
         BO    OFFS16                  YES FIND LAST EXTENT      A43752 02405021
         LA    REG9,28(REG9)           SCAN THE EXTENTS          A43752 02406021
NEXTEXT1 LA    REG9,4(REG9)            JUMP TO NEXT EXTENT       A43752 02407021
         BCT   REG2,NEXTEXT1           SCAN FURTHER              A43752 02408021
         B     SAVEUCB                 STORE UCB ADDR            A43752 02409021
OFFS16   DS    0H                                                A43752 02410021
         LA    REG9,16(REG9)                                     A43752 02411021
NEXTEXT2 LA    REG9,16(REG9)           JUMP TO NEXT EXTENT       A43752 02412021
         BCT   REG2,NEXTEXT2           SCAN FURTHER              A43752 02413021
SAVEUCB  L     REG9,0(REG9)             GET UCB ADDRESS          A43752 02414021
         MVC   IEHMVV82+24(2),38(REG9) SAVE LOG FILE SEQ NBR     A43752 02415021
         MVC   IEHMVV82+26(6),28(REG9) SAVE THE VOL SER NBR      A43752 02415521
         OI    IEHMVV82+24,X'80'       SET THE SWITCH FOR IEHMVESN      02416021
         L     REG2,IEHMVV31           RESTORE THE DCB ADDR      A43752 02417021
SKIPSAVE DS    0H                                                A43752 02418021
         LA    REG2,0(0,REG2)    CLEAR HIGH ORDER BYTE                  02420000
         USING IHADCB,REG2             ADDRESS 'TO' DCB        @ZA01247 02421002
         MVC   SAVRECFM,DCBRECFM       SAVE 'TO' DCB RECFM     @ZA01247 02422002
         MVC   SAVLRECL,DCBLRECL                     LRECL     @ZA01247 02423002
         MVC   SAVBLKSI,DCBBLKSI                     BLKSIZE   @ZA01247 02424002
         MVC   SAVKEYLE,DCBKEYLE                     KEYLEN    @ZA01247 02425002
         DROP  REG2                                            @ZA01247 02426002
*                                       CLOSE OUTPUT DCB         A27790 02430019
         CLOSE ((2),REREAD)             (WILL BE REOPENED)       A27790 02440019
         B     GET                                                      02460000
*TN TO TEST FIRST TIME SW, SET UP A CHUNK OF PERM WKAREA,SET UP BASE    02480000
*FOR PERM WKAREA,MOVE VOLUME INFO OF PDS PREVIOUSLY MOVED/COPIED        02500000
*                                                                       02520000
GET      TM    IEHMVV61,X'01'      TEST FOR FIRST TIME THRU             02540000
         BC    1,BLA                                                    02560000
         OI    IEHMVV61,X'01'      SET FIRST TIME THRU SWITCH           02580000
         L     REG2,IEHMVV10       ADDR OF BEGNG OF PERMANENT WKAREA    02600000
         LR    REG9,REG2     SET UP BASE FOR PERM WKAREA                02620000
         LA    REG2,124(0,REG2) INCREMENT BY NO OF BYTES NEEDED A38742  02630021
         MVC   IEHMVV61+1(3),IEHMVV10+1    MOVE START ADDRESS           02660000
         ST    REG2,IEHMVV10       RESET THE START ADDRESS              02680000
         L     REG2,IEHMVV30+12         GET ADDRESS OF FROM DDNAME      02700000
         MVC   DDNAME(8),0(REG2)        SAVE FROM DDNAME                02720000
         L     REG2,IEHMVV22       ADDRESS OF FROM VOLUME LIST          02740000
         MVC   SEARCH(17),0(REG2)      MOVE 17 BYTE ENTRY IN SEARCHDT0I 02760018
         L     REG2,IEHMVV40          ADDR OF SYSUT1 DCB                02780000
         LA    REG2,0(0,REG2)     CLEAR HIGH ORDER BYTE                 02800000
         MVC   HOLDTTR(3),IEHMVV26+1     SAVE TTR OF SYSUT1             02820000
BLA      EQU   *                                                        02840000
         GETMAIN  R,LV=1016                                      S20201 02860020
         LR    REG11,REG1                                               02880000
         MVC   PREFACE(4),FORBLDL  SET UP WORD INDICATOR FOR BLDL       02900000
NOTFIRST L     REG2,IEHMVV61       ADDRESS OF MY CHUNK OF PERM WKAREA   02920000
         LR    REG9,REG2           THIS SETS UP REGISTER 9              02940000
         TM    IEHMVV61,X'04'    ANOTHER DS PENDING                     02960000
         BO    TESTDSCB       IF SO ---                                 02980000
SETEXCP  MVI   INPUT,X'FF'          INDICATE EXIT TYPE FROM EXCP S20201 03083020
         BAL   REG7,MYEXCP            GO-EXECUTE CHANNEL PROG    S20201 03086020
         CLI   INPUT,X'FF'             ARE FF'S STILL THERE      S20201 03089020
         BC    8,NOREAD                IF YES,SEARCH ID= WAS HIT S20201 03092020
         B     TESTDSCB                CHECK IF DS OPEN FOR DSCB S20201 03095020
*                                                                       03100000
*ROUTINE WILL CHECK TO SEE IF                                           03120000
*1) A DATA SET IS ALREADY OPEN AND READY TO USE                         03140000
*2) IF NOT,THEN THE DSCB FOR A DS IS READ INTO CORE AND CHECKED AGAINST 03160000
*   THE 'FROM' DSCB                                                     03180000
*3) IF ANY DISCREPENCIES ARE DETECTED THE INCLUDE IS DROPPED AND THE    03200000
*   NEXT ONE PICKED UP                                                  03220000
*4) IF DS IS OPEN, THEN THE DSNAMES ARE CHECKED AND IF THIS INCLUDE     03240000
*   BELINGS TO THAT DATA SET AN ENTRY IS MADE ON SYSUT3                 03260000
*                                                                       03280000
*                                                                       03300000
TESTDSCB TM    IEHMVV61,X'20'      IS A DS ALREADY OPEN                 03320000
         BC    1,TESTDSNM          IF YES,IS THIS INC FORM THIS DS      03340000
         TM    IEHMVV61,X'10'        DO ANY VOLUMES HAVE TO BE MNTED    03360000
         BC    1,GOTORON                                                03380000
RONRTN   MVC   DSNAME(44),INPUT+6       DSNAME ON INC/REP JUST READ     03400000
         GETMAIN R,LV=500          THIS FOR 'OBTAIN'                    03420000
         L     REG2,IEHMVV31           ADDRESS OF TO DCB       @ZA07033 03422004
         LA    REG2,0(0,REG2)          CLEAR HIGH ORDER BYTE   @ZA07033 03424004
         USING IHADCB,REG2             ADDRESS TO DCB          @ZA07033 03426004
         TM    DCBOFLGS,X'10'          IS TO DCB OPEN          @ZA11945 03426499
         BZ    OBLIST                  NO, BRANCH              @ZA11945 03426899
         MVC   SAVRECFM,DCBRECFM       SAVE TO DCB RECFM       @ZA07033 03428004
         MVC   SAVLRECL,DCBLRECL                   LRECL       @ZA07033 03430004
         MVC   SAVBLKSI,DCBBLKSI                   BLKSIZE     @ZA07033 03432004
         MVC   SAVKEYLE,DCBKEYLE                   KEYLEN      @ZA07033 03434004
         DROP  REG2                                                     03436004
*                                                                       03440000
*WE NOW BUILD A LIST FOR OBTAIN, WHICH GETS THE DSCB FOR US             03460000
*                                                                       03480000
OBLIST   ST    REG1,LIST+12           ADDR OF WKAREA           @ZA11945 03500099
         LA    REG1,INPUT+6        ADDRESS OF DSNAME                    03520000
         ST    REG1,LIST+4         PLUGGED INTO LIST FOR OBTAIN         03540000
         MVI   LIST,X'C1'          INDICATES A SEARCH ON DSNAME         03560000
         MVC   LIST+1(3),ZEROS     CLEAR OUT OTHER THREE BYTES          03580000
         LA    REG1,SEARCH+4       ADDRESS OF VOL SERIAL NUMBER         03600000
         ST    REG1,LIST+8      ADDR OF VOL SER                         03620000
         LA    REG1,LIST           FOR 'OBTAIN'                         03640000
         OBTAIN (1)                GET ME THE DSCB                      03660000
         B     *+4(REG15)          TESTING RETURN CODE IN REG15         03680000
         B     *+12                NORMAL RETURN                        03700000
         B     MSG2                VOLUME NOT MOUNTED                   03720000
         B     MSG3                DSCB NOT FOUND IN VTOC               03740000
*                                                               YA01217 03760016
*  TEST DATA SET ORGANIZATION, RECORD FORMAT, BLOCKSIZE, RECORD YA01217 03762016
*  RECORD LENGTH AND KEYLENGTH OF INCLUDED OR REPLACING DATA SETYA01217 03764016
*  COMPATIBLE WITH 'TO' DATA SET                               @ZA01247 03766002
*                                                               YA01217 03768016
         L     REG2,LIST+12            INC/REP DSCB ADDRESS + 44YA01217 03770016
         SH    REG2,LENGTH44           ADJUST DSCB POINTER      YA01217 03772016
         USING IECSDSL1,REG2                                    YA01217 03780016
         L     REG3,IEHMVV30+8         FROM DSCB ADDRESS        YA01217 03782016
*                                                               YA01217 03784016
         TM    DS1DSORG,PO             TEST INC/REP DSORG       YA01217 03786016
         BNO   MSG4                    IGNORE IF NOT PARTITIONEDYA01217 03788016
*                                                               YA01217 03790016
         CLC   DS1KEYL,SAVKEYLE        COMPARE KEYLEN INC - TO @ZA01247 03792002
         BNE   MSG7                    MUST BE EQUAL            YA01217 03800016
*                                                               YA01217 03803016
         MVC   TORECFM,SAVRECFM      WORK-COPIES OF TO AND INC @ZA01247 03806002
         MVC   INCRECFM,DS1RECFM       RECFM ALLOWING BIT RESET.YA01217 03809016
*                                                               YA01217 03812016
         TM    INCRECFM,T              TEST INC/REP DS          YA01217 03815016
         BNO   CTESTNOT                IF WRITTEN WITH TRACK    YA01217 03820016
         TM    SEARCH+1,TFEATURE       OVERFLOW, THE DEVICE     YA01217 03822016
         BNO   MSG9                    SHOULD HAVE THIS FEATURE.YA01217 03824016
         NI    INCRECFM,ALL-T          T-BITS NOT USED IN OTHER YA01217 03826016
CTESTNOT NI    TORECFM,ALL-T-KEYLEN0   TESTS OF THE RECFM.      YA01217 03828016
*                                                               YA01217 03830016
         TM    TORECFM,U               BRANCH TO ROUTINE FOR:   YA01217 03832016
         BO    CTESTU                  RECFM UNDEFINED          YA01217 03840016
         TM    TORECFM,F               RECFM FIXED (BLOCKED)    YA01217 03842016
         BO    CTESTF                                           YA01217 03844016
         TM    TORECFM,V+S             RECFM VARIABLE SPANNED   YA01217 03846016
         BO    CTESTVS                                 (BLOCKED)YA01217 03848016
         TM    TORECFM,V               RECFM VARIABLE           YA01217 03850016
         BO    CTESTV                                           YA01217 03852016
*                                      IF NOT SPECIFIED, HANDLE YA01217 03860016
*                                      AS UNDEFINED             YA01217 03863016
*                                                               YA01217 03866016
CTESTU   EQU   *                       - RECFM UNDEFINED.       YA01217 03869016
         TM    INCRECFM,U              INCLUDE RECFM HAS TO BE  YA01217 03872016
         BM    MSG4A                   UNDEFINED OR NOT SPECIFIDYA01217 03875016
         NI    TORECFM,ALL-U           RESET BITS TO COMPARE    YA01217 03880016
         NI    INCRECFM,ALL-U          ONLY CONTROL-CHAR-BITS   YA01217 03882016
         CLC   INCRECFM,TORECFM        TEST RECFM INC/REP - TO @ZA01247 03884002
         BNE   MSG4A                   IF NOT EQUAL INCOMPATIBLEYA01217 03886016
         CLC   DS1BLKL,SAVBLKSI        COMPARE BLKSIZE INC -TO @YA03857 03888002
         BNH   CTESTETJ                GOOD IF NOT LARGER.      YA01217 03890016
         CLC   DS1BLKL,DS1BLKL-DS1DSNAM(REG3)  IF BLKSIZE OF INCYA01217 03892016
         BH    MSG5                    NOT LARGER THAN FROM DS, YA01217*03900016
                                       USER RESPONSIBILITY.     YA01217 03902016
         B     CTESTETJ                NORMAL COPY (IEHMVETJ)   YA01217 03904016
*                                                               YA01217 03906016
CTESTF   EQU   *                       - RECFM FIXED (BLOCKED)  YA01217 03908016
         CLC   INCRECFM,TORECFM        COMPARE RECFM INC - TO  @ZA01247 03910002
         BE    CTESTF1                 IF EQUAL, RECFM OK.      YA01217 03912016
         NI    INCRECFM,ALL-B-S        RESET BITS TO COMPARE    YA01217 03920016
         NI    TORECFM,ALL-B-S         (BLOCKED AND STANDRD OFF)YA01217 03923016
         CLC   INCRECFM,TORECFM        COMPARE REMAINING BITS   YA01217 03926016
         BNE   MSG4A                   MUST BE EQUAL            YA01217 03929016
         CLC   DS1LRECL,SAVLRECL       COMPARE LRECL INC - TO  @ZA01247 03932002
         BNE   MSG6                    MUST BE EQUAL            YA01217 03935016
         TM    SAVRECFM,S              TEST TO DS STANDARD     @ZA01247 03940002
         BNO   CTESTF2                                          YA01217 03942016
         TM    DS1RECFM,S              TEST INC/REP DS STANDARD YA01217 03944016
         BO    CTESTF2                                          YA01217 03946016
         CLI   DS1KEYL,ZERO            IF TO DS S BUT INC NOT, @ZA01247 03948002
         BNE   MSG4A                   REBLOCKING REQUIRED BUT  YA01217 03950016
         B     CTESTESL                ONLY POSSIBLE IF KEY ZEROYA01217 03952016
CTESTF1  EQU   *                                                YA01217 03960016
         CLC DS1LRECL,SAVLRECL         COMPARE LRECL INC - TO  @ZA01247 03962002
         BNE   MSG6                    MUST BE EQUAL            YA01217 03964016
CTESTF2  EQU   *                                                YA01217 03966016
         CLC   DS1BLKL,SAVBLKSI        COMPARE BLKSIZE INC -TO @ZA01247 03968002
         BE    CTESTETJ                IF EQAUL, NORMAL COPY    YA01217 03970016
         CLI   DS1KEYL,ZERO            IF NOT EQUAL AND KEYLEN  YA01217 03972016
         BE    CTESTESL                ZERO, CAN BE REBLOCKED.  YA01217 03980016
         CLC   DS1BLKL,SAVBLKSI        NO REBLOCKING POSSIBLE:  YA01217 03983016
         BH    MSG5                    IF TO BLKSIZE LARGER AND YA01217 03986016
         TM    SAVRECFM,S              NO STANDARD BLOCKS, THE  YA01217 03989016
         BO    MSG5                    SMALLER BLOCKS ARE COPIEDYA01217 03992016
         B     CTESTETJ                                         YA01217 03995016
*                                                               YA01217 04000016
CTESTVS  EQU   *                       - RECFM VARIABLE SPANNED YA01217 04002016
         CLC   INCRECFM,TORECFM        COMPARE RECFM INC - TO  @ZA01247 04004002
         BNE   MSG4A                   MUST BE EQUAL            YA01217 04006016
         CLC   DS1BLKL,SAVBLKSI        COMPARE BLKSIZE INC -TO @ZA01247 04008002
         BNE   MSG5                    V(B)S CANNOT BE REBLOCKEDYA01217 04010016
         CLC   DS1LRECL,SAVLRECL       COMPARE LRECL INC - TO  @ZA01247 04012002
         BNH   CTESTETJ                GOOD IF LOW OR EQUAL     YA01217 04020016
         CLC   DS1LRECL,DS1LRECL-DS1DSNAM(REG3)  IF HIGH, ALLOW YA01217 04022016
         BH    MSG6                    COPY WHEN USER TOOK SAME YA01217 04024016
         B     CTESTETJ                IF GOOD, NORMAL COPY     YA01217 04026016
*                                                               YA01217 04028016
CTESTV   EQU   *                       - RECFM VARIABLE         YA01217 04030016
         XC    INCRECFM,TORECFM        SET NOT-MATCHING BITS IN YA01217 04032016
         TM    INCRECFM,ALL-B            RECFM, OF WHICH ONLY B YA01217 04040016
         BNZ   MSG4A                     (BLOCKED) MAY DIFFER.  YA01217 04043016
         XC    INCRECFM,TORECFM        RESET RECFM              YA01217 04046016
         TM    TORECFM,B               TEST TO DS BLOCKED      @ZA01247 04049002
         BNO   CTESTV3                   BRANCH IF NOT BLOCKED  YA01217 04052016
*                                      - TO DS IS BLOCKED      @ZA01247 04055002
         CLC   SAVBLKSI,DS1BLKL        COMPARE BLKSIZE TO -INC @ZA01247 04060002
         BL    CTESTV1                   LOW                    YA01217 04062016
         BH    CTESTV2                   HIGH                   YA01217 04064016
*                                        EQUAL                  YA01217 04066016
         TM    INCRECFM,B              TEST INC DS BLOCKED      YA01217 04068016
         BO    CTESTETJ                IF BLOCKED, NORMAL COPY  YA01217 04070016
         B     CTESTV2                 IF NOT, TEST KEY TO REBLKYA01217 04072016
CTESTV1  EQU   *                                                YA01217 04080016
         TM    INCRECFM,B              TEST INC DS BLOCKED      YA01217 04082016
         BO    CTESTV4                 IF YES, TEST KEY TO REBLKYA01217 04084016
         TM    DS1RECFM-DS1DSNAM(REG3),B  IF INC NOT BLOCKED ANDYA01217 04086016
         BO    MSG5                    FROM-DS BLOCKED, NOT COPDYA01217 04088016
         CLC   DS1BLKL,DS1BLKL-DS1DSNAM(REG3)  FROM DS NOT BLKED YM5087 04090000
         BL    MSG5                    THEN BLKSIZE MUST BE LOW.YA01217 04092016
CTESTV2  EQU   *                                                YA01217 04100016
         CLI   DS1KEYL,ZERO            TEST FOR KEY             YA01217 04103016
         BZ    CTESTESM                IF NO KEY, REBLOCK       YA01217 04106016
         B     CTESTETJ                ELSE, COPY ASIS          YA01217 04109016
CTESTV3  EQU   *                       - TO DS IS NOT BLOCKED  @ZA01247 04112002
         TM    INCRECFM,B              TEST INC DS BLOCKED      YA01217 04115016
         BNO   CTESTV5                   BRANCH IF NOT          YA01217 04120016
CTESTV4  EQU   *                       INC DS IS BLOCKED        YA01217 04122016
         CLI   DS1KEYL,ZERO            TEST FOR KEY             YA01217 04124016
         BZ    CTESTESM                IF NO KEY, REBLOCK       YA01217 04126016
         B     MSG5                    ELSE REBLOCKING IMPOSSIBLYA01217 04128016
CTESTV5  EQU   *                       INC AND TO DS NOT BLKED @ZA01247 04130002
         CLC   SAVBLKSI,DS1BLKL        COMPARE BLKSIZE TO -INC @ZA01247 04132002
         BNL   CTESTETJ                IF NOT SMALLER, NORMAL C.YA01217 04140016
         TM    DS1RECFM-DS1DSNAM(REG3),B  TEST FROM-DS BLOCKED  YA01217 04142016
         BO    MSG5                    IF SO, BLKSIZE TOO LARGE YA01217 04144016
         CLC   DS1BLKL,DS1BLKL-DS1DSNAM(REG3)  IF NOT, AND BLKSZ YM5087 04146000
         BNL   CTESTETJ                NOT SMALLER, TAKE SAME   YA01217*04148016
                                       RISK AS FOR FROM DS      YA01217 04150016
         B     MSG5                    IF SMALLER, NO COPY      YA01217 04152016
*                                                               YA01217 04160016
CTESTESM MVC   MODULEND,SM             VARIABLE REBLOCKING      YA01217 04163016
         B     SETUPDCB                RETURN TO IEHMVESM       YA01217 04166016
*                                                               YA01217 04169016
CTESTESL MVC   MODULEND,SL             FIXED REBLOCKING         YA01217 04172016
         B     SETUPDCB                RETURN TO IEHMVESL       YA01217 04175016
*                                                               YA01217 04180016
CTESTETJ MVC   MODULEND,TJ             NORMAL MOVE/COPY         YA01217 04185016
*                                      RETURN TO IEHMVETJ       YA01217 04190016
         DROP  REG2                                             YA01217 04195016
*                                                                       04220000
*THIS ROUTINE WILL SET UP A DCB SO IT CAN BE OPENED AND THE DIRECTORY   04240000
*CAN BE ACCESSED BY BLDL                                                04260000
*                                                                       04280000
SETUPDCB MVI   FAKEDCB,X'00'  THIS WILL CLEAR OUT THE WHOLE       M2686 04300016
         MVC   FAKEDCB+1(87),FAKEDCB    DCB AND WE CAN NOW INITIALIZE   04360000
         LA    REG1,1                   PUT CONSTANT OF 1 IN REG1       04380000
         STC   REG1,FAKEDCB+23           INITIALIZES                    04400000
         STC   REG1,FAKEDCB+31            PART OF                       04420000
         STC   REG1,FAKEDCB+55             THE DCB                      04440000
         STC   REG1,FAKEDCB+59              TO WHAT                     04460000
         STC   REG1,FAKEDCB+71               IT LOOKS                   04480000
         STC   REG1,FAKEDCB+75                LIKE                      04500000
         STC   REG1,FAKEDCB+79                 BEFORE                   04520000
         STC   REG1,FAKEDCB+87                  OPEN                    04540000
         LA    REG1,2                   MORE                            04560000
         STC   REG1,FAKEDCB+48           INITIALIZING                   04580000
         MVC   FAKEDCB+50(2),MACRF MACRO FORMAT,WE ARE GOING TO READ    04600000
         MVC   FAKEDCB+26(2),FILETYPE   THIS A PDS                      04620000
         MVC   FAKEDCB+36(1),84(REG2) RECFM FROM DSCB OF THIS DS YM5087 04640000
         MVC   FAKEDCB+37(3),EXITLST+1  MOVE EXITLIST PTR TO DCB        04660000
         MVI   JFCB,X'00'               CLEAR JFCB OUT                  04680000
         MVC   JFCB+1(175),JFCB                                         04700000
         MVC   JFCB(44),INPUT+6         MOVE DSNAME IN                  04720000
         MVI   JFCB+44,X'40'      MOVE BL TO MEMBER NAME                04740000
         MVI   JFCB+117,X'01'           1 VOL ID TO FOLLOW              04760000
         MVC   JFCB+118(6),SEARCH+4     VOL ID                          04780000
         MVI   JFCB+124,X'40'                                           04800000
         MVC   FAKEDCB+40(8),DDNAME     SET UP DDNAME                   04820000
         LA    REG1,44(REG2)           RESET PTR TO DSCB        YA01217 04840016
         L     REG2,IEHMVV30       ADDRESS OF 'FROM' DCB                04860000
         MVC   0(88,REG2),FAKEDCB  MOVE BUILT DCB TO COMTAB             04880000
         MVC   62(2,REG2),42(REG1)     MOVE BLKSIZE TO DCB              04900000
         FREEMAIN R,LV=500,A=(1) FREE CORE GOTTEN FOR DSCB        M2686 04912016
         LA    REG2,0(0,REG2)        CLEAR HIGH ORDER BYTE              04920000
         MVC   RENTOPEN(TAG-OPENJ),OPENJ     THIS MAKES                 04940000
         OPEN  ((2)),TYPE=J,MF=(E,RENTOPEN)  OPEN REENTRANT             04960000
         OI    IEHMVV61,X'20'      INDICATE WE HAVE AN OPEN DS          04980000
*                                                                       05000000
*NOW READY TO PASS SOME INFORMATION TO BLDL,SO WE CAN GET A DIRECTORY   05020000
*ENTRY ONTO SYSUT3                                                      05040000
*                                                                       05060000
BLDLINFO MVC   BLDL(8),INPUT+50    MOVE MEMBER NAME TO BLDL LIST        05080000
         L     REG1,IEHMVV30       ADDRESS OF DCB                       05100000
         LA    REG1,0(0,REG1)      CLEAR HIGH ORDER BYTE FOR BLDL       05120000
         LA    REG0,PREFACE        ADDRESS OF LIST FOR BLDL             05140000
         BLDL  (1),(0)                                                  05160000
         CLI   BLDL+10,X'00'       CHECKING FOR NOFOUND FROM BLDL       05180000
         BC    8,MSG8              IF EQUAL,PRINT MSG                   05200000
         B     PUTONUT3                                                 05220000
*                                                                       05240000
*IF A DS IS OPEN,WE ENTER THIS ROUTINE WHICH CHECKS TO SEE IF THIS INC  05260000
*BELONGS TO THIS DS. IF NOT,THE A SWITCH IS SET THAT SAYS ANOTHER INC   05280000
*EXISTS ON THIS VOLUME,SO NO MOUNTING WILL BE REQUIRED TO PRECESS INCL- 05300000
*UDES FROM AT LEAST ONE MORE DS.                                        05320000
*                                                                       05340000
TESTDSNM CLC   DSNAME(44),INPUT+6  THIS INC BELONG TO THIS DS           05360000
         BC    8,BLDLINFO     IF YES,GIVE ITS INFO TO BLDL              05380000
         OI    IEHMVV61,X'04' SW THAT SAYS ANOTHER INC DS ON THIS VOL   05400000
         B     YES1                                                     05420000
*                                                                       05440000
*ROUTINE WILL  PUT DIRECTORY ENTRY ON SYSUT3 WITH A KEY OF ATTR,A BEING 05460000
*EQUAL TO 00 IF A TRUE MEMB NAME AND 80 IF AN ALIAS. IT WILL ALSO MAKE  05480000
*THE FIRST 5 BYTES OF THE DATA PORTION CCHHR                            05500000
*                                                                       05520000
PUTONUT3 L     REG2,IEHMVV42           SYSUT3 DCB ADDRESS        S20201 05530020
         USING IHADCB,REG2                                       S20201 05540020
         L     REG1,DCBDVTBL           ADDRESS THE DEVICE CHARAC-S20201 05550020
*                                      TERISTICS TABLE           S20201 05560020
         USING UNITABLE,REG1                                     S20201 05570020
         SR    REG3,REG3               TO GET THE DEVICE OVERHEADS20201 05580020
         TM    UNITFLAG,X'08'          2-BYTE OVHD FACTOR        S20201 05590020
         BZ    OVH1                    *B IF NOT-GET 1 BYTE      S20201 05600020
         LH    REG3,UNITOVHI           GET 2-BYTE OVHEAD         S20201 05610020
         B     ADD87                   *B TO ADD KEY+DATALENGTH  S20201 05620020
OVH1     IC    REG3,UNITOVHL           GET 1-BYTE OVHEAD         S20201 05630020
ADD87    LA    REG3,KEYLEN+DATALEN(0,REG3)  TOTAL LENGTH         S20201 05640020
         MVC   BLDL+11(63),BLDL+13     WIPE OUT BLDL EXTRA BYTES S20201 05650020
         CH    REG3,DCBTRBAL           WILL RECORD FIT ON TRACK  S20201 05660020
         BC    2,NEWTRK                NO BUMP TO NEXTTRACK      S20201 05670020
         MVC   CCHHR(4),DCBFDAD+3      MOVE CCHH FROM DCB        S20201 05680020
         IC    REG1,DCBFDAD+7          INSERT R BYTE OF CCHHR    S20201 05690020
         LA    REG1,1(0,REG1)      UP IT BY ONE                         05720000
         STC   REG1,CCHHR+4        STORE IN OUTPUT AREA                 05740000
MOVEDIR  MVC   DATA(74),BLDL       MOVE DIREC ENTRY TO OUTPUT AREA      05760000
         MVC   KEY+1(3),BLDL+8     MOVE TTR TO KEY AREA                 05780000
         TM    BLDL+11,X'80'       IS THIS AN ALIAS ENTRY               05800000
         BC    1,ALIAS             YES IT IS                            05820000
         MVI   KEY,X'00'           TRUE MEMBER NAME                     05840000
         B     *+12                                                     05860000
ALIAS    MVI   KEY,X'80'           AN ALIAS ENTRY                       05880000
         OI    IEHMVV20+2,X'80'        TURN ON ALAIS SWITCH        9312 05900000
         L     REG5,IEHMVV42+4   ADDRESS OF DECB FOR WRITE              05920000
         LA    REG5,0(0,REG5)      CLEAR HIGH ORDER BYTE                05940000
         LA    REG4,KEY            ADDRESS OF OUTPUT AREA               05960000
         LA    REG3,DATALEN            GET DATALENGTH FOR WRITE  S20201 05970020
KEYLEN   EQU   4                                                 S20201 05980020
DATALEN  EQU   87                                                S20201 05990020
         LA    REG1,CCHHR+79     WHERE RENAME GOES                      06000000
         NI    IEHMVV61,X'FB'    TURN OFF DS PENDING BIT                06020000
         MVC   0(8,REG1),INPUT+75      MOVE NEW NAME AT END OF UT3 DT0I 06030018
*                                      RECORD                      DT0I 06040018
         WRITE (5),SF,(2),(4),(3),MF=E     WRITE MACRO                  06060000
         L     REG1,IEHMVV42+4     ADDRESS OF DECB FOR CHECK            06080000
         LA    REG1,0(0,REG1)    CLEAR HIGH ORDER BYTE                  06100000
         CHECK (1)                                                      06120000
         OI    IEHMVV61,X'08'      SHOWS AN ENTRY ON SYSUT3             06140000
         B     SETEXCP                                                  06160000
*                                                                       06180000
*ROUTINE TO UP IT OF TTR BY ONE, SET TRACK BALANCE TO ZERO SET R OF TTR 06200000
*TO ONE                                                                 06220000
*                                                                       06240000
NEWTRK   L     REG1,44(REG2)       ADDRESS OF DEB                       06260000
         LA    REG2,5(REG2)        ADDR OF MBBCCHHR IN DCB              06280000
         LR    REG4,BASE10         SAVE MY BASE REGISTER                06300000
         LR    REG5,REG11          SAVE BASE OF MY GOTTEN CORE          06320000
         STM   9,13,SAVEREG        SAVE THE OTHERS                      06340000
         L     REG15,16            16 CONTAINS ADDR OF COM VEC TBL      06360000
         L     REG15,32(0,REG15)   ADDRESS OF IECPRLTV                  06380000
         BALR  REG14,REG15         CONVERT MBBCCHHR TO TTR              06400000
         LR    BASE10,REG4         REINSTATE BASE REG                   06420000
         LR    REG11,REG5          REINSTATE MY GOTTEN CORE BASE REG    06440000
         LM    9,13,SAVEREG        RESTORE OTHERS                       06460000
         SRL   REG0,8              GET R BYTE IN LOW ORDER              06480000
         IC    REG0,ZEROS          MAKE R ZERO                          06500000
         A     REG0,UPTTR          THIS ADDS ONE TO IT PORTION OF TTR   06520000
         SLL   REG0,8                                                   06540000
         L     REG2,IEHMVV42       ADDRESS OF DCB                       06560000
         L     REG1,44(REG2)       DEB ADDR                             06580000
         LA    REG2,DATA      TEMPORARY AREA TO PUT MBBCCHHR            06600000
         LR    REG4,BASE10         SAVE MY BASE                         06620000
         LR    REG5,REG11          SAVE BASE OF MY GOTTEN CORE          06640000
         STM   9,13,SAVEREG                                             06660000
         L     REG15,16            16 CONTAINS ADDR OF COM VEC TBL      06680000
         L     REG15,28(0,REG15)   ADDRESS OF IEC                       06700000
         BALR  REG14,REG15         CONVERT TTR TO MBBCCHHR              06720000
         LR    BASE10,REG4         REINSTATE MY BASE                    06740000
         LR    REG11,REG5          REINSTATE MY GOTTEN CORE BASE REG    06760000
         LM    9,13,SAVEREG                                             06780000
         MVC   CCHHR(4),DATA+3     MOVES CCHH TO MY OUTPUT AREA         06800000
         IC    REG1,DATA+7         INSERT R BYTE OF CCHHR               06820000
         LA    REG1,1(0,REG1)      UP THE R BYTE BY ONE                 06840000
         STC   REG1,CCHHR+4        STORE THIS R BYTE IN OUTPUT AREA     06860000
         L     REG2,IEHMVV42       ADDR OF DCB                          06880000
         MVC   18(2,REG2),ZEROS  ZERO OUT TRACK BALANCE                 06900000
         B     MOVEDIR                                                  06920000
*                                                                       06940000
*THIS ROUTINE WILL SET UP THE MBBCCHHR FOR THE SEEK(FIRST TIME ONLY)    06960000
*AND WILL ISSUE AN EXCP AND WAIT AND THE INTEROGATE THE RETURN BY IOS   06980000
*                                                                       07000000
*                                                                       07020000
MYEXCP   TM    IEHMVV61,X'02'      FIRST TIME THRU EXCP                 07040000
         BO    IOERROUT           I/O ERR, TERMINATE               7632 07060000
         XC    CCWVOL(CCWS),CCWVOL  CLEAR CHAN PROG AREA         S20201 07070020
         LA    REG2,FIRST         PTR TO FIELD THAT WILLCONTAIN  S20201 07080020
*                                 CCHHR OF START OF INCL/REPL    S20201 07090020
*                                 LIST ON SYSUT1                 S20201 07100020
         ST    REG2,CCWVOL        STORE IN 2ND CHAN PROG         S20201 07110020
         ST    REG2,CHANPROG      STORE IN 1ST CHAN PROG         S20201 07120020
*                                                                S20201 07130020
         LA    REG2,CCWVOL        PTR TO SIDEQ OF 2ND CHANPROG   S20201 07140020
         ST    REG2,CCWVOL+8      STORE IN SUBSEQUENT TIC        S20201 07150020
         ST    REG2,RPSCCW+8      AND IN TIC FOLLOWING SET SECTORS20201 07160020
*                                                                S20201 07170020
         LA    REG2,IEHMVV39      PTR TO CCHHR OF LAST UT1 REC   S20201 07180020
         ST    REG2,ANTHRSRC      STORE IN CCW THAT LOOKS UP END S20201 07190020
         ST    REG2,CCWSRCH       SAME FOR 1ST CHANPROG          S20201 07200020
*                                                                S20201 07210020
         LA    REG2,KEYNZERO      PTR TO CCW THAT LOOKS FOR NON- S20201 07220020
*                                 ZERO-ED KEY                    S20201 07230020
         ST    REG2,ANTHRSRC+8    STORE IN TIC FOLLOWING SIDEQ   S20201 07240020
*                                                                S20201 07250020
         LA    REG2,ZEROS         COMPARAND FOR SKH CCW          S20201 07260020
         ST    REG2,KEYNZERO      PUT IN 2ND CHANPROG            S20201 07270020
         ST    REG2,ZEROOUT+16    ALSO USED TO CLOBBER FOUND REC S20201 07280020
         ST    REG2,RPSCCW        AND AS 1ST SECTOR VALUE        S20201 07290020
         ST    REG2,RPSCHAN       IN BOTH CHAN PROGS             S20201 07300020
*                                                                S20201 07310020
         LA    REG2,ANTHRSRC      PTR TO CCW THAT LOOKS FOR      S20201 07320020
*                                 END OF UT1                     S20201 07330020
         ST    REG2,KEYNZERO+8    STORE IN TIC FOLLOWING SKH CCW S20201 07340020
*                                                                S20201 07350020
         LA    REG2,INPUT         PTR TO INPUT AREA              S20201 07360020
         ST    REG2,KEYNZERO+16   STORE IN READ CCW 2ND CHANPROG S20201 07370020
         ST    REG2,SRCHKEY+16    STORE IN READ CCW 1ST CHANPROG S20201 07380020
         ST    REG2,ZEROOUT       AND IN SIDEQ OF DESTROYER      S20201 07390020
*                                                                S20201 07400020
         LA    REG2,CHANPROG      PTR TO SIDEQ OF 1ST CHANPROG   S20201 07410020
         ST    REG2,CHANPROG+8    STORE IN SUBSEQUENT TIC        S20201 07420020
         ST    REG2,RPSCHAN+8     AND IN TIC FOLLOWING SET SECTORS20201 07430020
*                                                                S20201 07440020
         LA    REG2,SRCHKEY       PTR TO CCW LOOKING FOR MATCHINGS20201 07450020
*                                 VOLUME INFORM (=KEY)           S20201 07460020
         ST    REG2,CCWSRCH+8     STORE IN TIC                   S20201 07470020
*                                                                S20201 07480020
         LA    REG2,SEARCH        PTR TO KEY TO LOOK FOR         S20201 07490020
         ST    REG2,SRCHKEY       PUT IN SKEQ CCW                S20201 07500020
*                                                                S20201 07510020
         LA    REG2,CCWSRCH       PTR TO CCW THAT LOOKS FOR END  S20201 07520020
         ST    REG2,SRCHKEY+8     STORE IN TIC AFTER SKEQ CCW    S20201 07530020
*                                                                S20201 07540020
         LA    REG2,ZEROOUT       PTR TO START OF DESTROYER      S20201 07550020
         ST    REG2,ZEROOUT+8     PUT IN SUBSEQUENT TIC          S20201 07560020
         ST    REG2,READSEC+16    AND IN TIC FOLLOWING READ/SET  S20201 07570020
*                                 SECTOR CCW SEQUENCE            S20201 07580020
         LA    REG2,SECTOR        PTR TO FIELD TO CONTAIN SECTOR S20201 07590020
         ST    REG2,READSEC       STORE IN READ SECTOR CCW       S20201 07600020
         ST    REG2,READSEC+8     AND IN SET SECTOR CCW          S20201 07610020
*                                                                S20201 07620020
         TM    IEHMVV20+RPS,RPS   SYSUT1 ON RPS DEVICE           S20201 07630020
         BZ    NORPS              *B IF NOT                      S20201 07640020
         LA    REG2,READSEC       CCW TO TIC TO AFTER SUCCESFULL S20201 07650020
*                                 READING DATA                   S20201 07660020
         B     *+8                GO TO STORE IN TIC             S20201 07670020
NORPS    LA    REG2,ZEROOUT       NO RPS -NEXT SEQ CCW           S20201 07680020
         ST    REG2,TIC           STORE IN TIC                   S20201 07690020
*                                                                S20201 07700020
**  SET COMMAND CODES,FLAGS AND LENGTHS IN CHANNEL PROGRAM ******S20201 07710020
*                                                                S20201 07720020
         OC    CCWVOL(CCWS),MYCHNLPG                             S20201 07730020
*                                                                S20201 07740020
**** CHANNEL PROGRAM COMPLETED-NOW TAKE CARE OF IOB ************ S20201 07750020
SETIOB   XC    IOB(40),IOB             CLEAR IOB                 S20201 07859020
         LA    REG1,ECB    ADDRESS OF MY ECB                            07880000
         ST    REG1,IOB+4    STICK ECB PTR IN MY IOB                    07900000
         L     REG1,IEHMVV40      ADDRESS OF SYSUT1 DCN                 07920000
         ST    REG1,DCBADR     STICK UT1 DCB PTR IN MY IOB              07940000
         STM   2,13,SAVEREG        SAVE REGISTERS FOR CONVERT ROUTINE   07960000
         LR    REG3,BASE10                                              07980000
         LR    REG4,REG11       SAVE REG11 TO REINSTATE REGISTERS       08000000
         L     REG0,HOLDTTR        TTR OF SYSUT1                        08020000
         IC    REG0,ZEROS          CLEAR OUT TO MAKE TTR0               08040000
         L     REG2,IEHMVV40       ADDRESS OF DCB                       08060000
         L     REG1,44(REG2)       ADDRESS OF DEB IN REG1 FOR CONVERT   08080000
         LA    REG2,MBBCCHHR   WHERE ABSOLUTE ADDRESS IS TO GO          08100000
         L     REG15,16            ADDRESS OF SYSTEM COMMUNICATION TBL  08120000
         L     REG15,28(0,REG15)   ADDRESS OF CONVERT ROUTINE           08140000
         BALR  REG14,REG15         GO TO CONVERT ROUTINE                08160000
         LR    BASE10,REG3                                              08180000
         LR    REG11,REG4       REINSTATE REG11                         08200000
         MVC   FIRST(4),MBBCCHHR+3    MOVE CCHHR TO 'FIRST'             08220000
         IC    REG3,MBBCCHHR+7     INSERT R IN REG3                     08240000
         BCTR  REG3,0      REDUCE REG3 BY ONE                           08260000
         STC   REG3,FIRST+4    START SEARCH AT BEGINNING                08280000
         LM    2,13,SAVEREG        RESTORE THE REGISTERS                08300000
         TM    IEHMVV20+RPS,RPS        RPS BIT ON TEST           S20201 08318020
         BZ    SKPNORM                 NO - BRANCH               S20201 08324020
         LA    REG1,RPSCHAN            ADDRESS OF CCW LIST       S20201 08330020
         B     NORM1                   CONTINUE                  S20201 08336020
SKPNORM  LA    REG1,CHANPROG           S20201                           08342020
NORM1    ST    REG1,START              STORE IN IOB              S20201 08348020
         MVC   ECB(4),ZEROS             CLEAR OUT ECB BEFORE EXCP       08360000
         EXCP  IOB            EXECUTE CHANNEL PROGRAM                   08380000
         L     REG1,IOB+4          ADDRESS OF ECB FOR WAIT              08400000
         WAIT  ECB=(1)      W AIT FOR THIS EVENT TO COMPLETE            08420000
         L     REG1,IEHMVV40       ADDRESS OF DCB                       08440000
         TM    44(REG1),X'C0'                                           08460000
         BC    1,MSG1         GO TO A ROUTINE THAT SAYS PERM I/O ERROR  08480000
         BR    REG7                                                     08500000
*                                                                       08520000
*THIS THE ROUTINE WE GO TO, TO HAVE A VOLUME MOUNTED. WE BUILD THE      08540000
*APPROPRIATE LIST AND PICK UP THE ADDRESS OF VOLUME MOUNT FROM THE COM- 08560000
*TAB AND WHEN HE RETURNS, THE REQUIRED VOLUMES SHOULD BE MOUNTED.       08580000
*                                                                       08600000
GOTORON  NI    IEHMVV61,X'EF'      SO WE WONT COME BACK TO VOLUME MOUNT 08620000
         LA    REG1,SEARCH     POIMTER TO TYPE,VOL ID, SEQ #            08640000
VMGEN    EQU   0                                                        08660000
VMINDICA EQU   4                                                        08680000
VMIT     EQU   4                                                        08700000
VMVMR    EQU   11                                                       08720000
VMITC    EQU   10                                                       08740000
VMDEV    EQU   12                                                       08760000
VMVSN    EQU   16                                                       08780000
VMRTA     EQU    22                                                     08800000
VMUNIT   EQU   24                                                       08810018
*                                                                       08820000
*                                  TO CALL VOL MOUNT                    08840000
*                                       NO VALID OLD REQUESTS           08860000
*                                  REG 1  POINTS TO                     08880000
*                                                                       08900000
*                                       DEVICE TYPE    4 BYTES          08920000
*                                       VOL ID         6 BYTES          08940000
*                                                                       08960000
         MVC   IEHMVV00+VMIT(4),IEHMVV50+4   PTR TO IT TABLE            08980000
         MVC   IEHMVV00+VMITC(1),IEHMVV50+4  IT ENTRY COUNT             09000000
         MVI   IEHMVV00+VMVMR,X'01'          NUMBER OF REQUESTS         09020000
         MVI   IEHMVV00+VMINDICA,X'90'       SET UP INDICATOR           09040000
         MVC   IEHMVV00+VMDEV(10),0(1)       SET UP DEVICE TYPE         09060000
         MVC   IEHMVV00+VMUNIT(5),12(REG1)  SET UP SPEC UNIT       DT0I 09070018
         LA    3,IEHMVV00                                               09080000
         L     4,AATG                                                   09100000
         XCTL  EP=IEHMVXSF                                              09120000
VOLRET   EQU   *                                                        09140000
*                                                                       09160000
         TM    IEHMVV00+VMIT,X'01'           WAS VOLUME MOUNTED         09180000
         BZ    NOMOUNT            NO MOUNTING INITIATED ERROR MSG       09200000
         L     1,IEHMVV00+VMIT                    YES                   09220000
         AH    1,IEHMVV00+VMRTA                                         09240000
         L     1,0(0,1)                      GET POINTER TO DDNAME      09260000
*                                                                       09280000
         MVC   DDNAME(8),0(REG1)        SAVE DDNAME FROM VOL MOUNT      09300000
         B     RONRTN         RETURN TO MY PROGRAM                      09320000
         DS    0F                                                       09340000
AATG     DC    CL4'AATG'                                                09360000
*                                                                       09380000
*THIS ROUTINE WILL CHECK SYSUT1 TO SEE IF ANY MORE INCLUDES ARE PRESENT 09400000
*IF SO IF WILL READ THE FIRST NON-ZERO KEY RECORD AND USE IT'S VOLUME   09420000
*INFORMATION TO HAVE A NEW VOLUME MOUNTED. IF NO MORE INCLUDES, THEN    09440000
*THE INC/REP BIT IS TURNED OFF AND WE GO TO IEHMVETJ FOR THE LAST TIME. 09460000
*                                                                       09480000
VOLEXCP  MVI   INPUT,X'FF'    TO SEE IF I READ ANYTHING                 09500000
         TM    IEHMVV20+RPS,RPS        RECORD READY FEATURE TEST S20201 09508020
         BZ    VOLNORM                 NO-CONTINUE AS USUAL      S20201 09516020
         LA    REG1,RPSCCW             ADDRESS OF CCW LIST       S20201 09524020
         B     NORM2                   CONTINUE                  S20201 09532020
VOLNORM  LA    REG1,CCWVOL            ADDRESS OF CHANNEL PROGRAM S20201 09540020
NORM2    ST    REG1,START              STORE ADDRESS IN MY IOB   S20201 09548020
         MVC   ECB(4),ZEROS             CLEAR OUT ECB BEFORE EXCP       09560000
         EXCP  IOB                 EXECUTE CHANNEL PROGRAM              09580000
         L     REG1,IOB+4     ADDRESS OF ECB FOR WAIT MACRO             09600000
         WAIT  ECB=(1)      W AIT FOR THIS EVENT TO COMPLETE            09620000
         L     REG1,IEHMVV40  ADDRESS OF SYSUT1 DCB                     09640000
         TM    44(REG1),X'C0' CHECKING FOR PERM I/O ERROR               09660000
         BC    1,MSG1         ABDRT AT THIS POINT                       09680000
         CLI   INPUT,X'FF'    TO SEE IF WE READ SOMETHING               09700000
         BC    8,ALLDONE      IF EQUAL, THE NO MORE INCLUDES            09720000
         MVC   SEARCH(17),INPUT+58     MOVE VOL INFO TO            DT0I 09730018
*                                      SEARCH AREA             O   DT0I 09740018
         OI    IEHMVV61,X'10' THIS MEANS VOL MOUNTING REQUIRED          09760000
         B     YES1                                                     09780000
ALLDONE  TM    IEHMVV61,X'08'     ANYTHING ON UT3                  7632 09800000
         BC    1,TRANSFER     IF SO ----                                09820000
IOERROUT NI    IEHMVV20+2,X'F7'   TURN OFF INC/REP BIT             7632 09840000
         NI    IEHMVV61,X'FD'     TURN OFF ERR INDICATOR BIT       7632 09860000
         LR    REG1,REG11     ADDR OF GOTTEN CORE                       09880000
         FREEMAIN  R,LV=1016,A=(1)     FREE DSECT                S20201 09900020
         IEHPOST   ,T                                                   09920000
         L     14,12(0,13)             PRESERVE REG 14 ACROSS XCTL S    09940000
         XCTL   (2,12),EP=IEHMVESN       GO TO WRAP UP                  09960000
*                                                                       09980000
*ROUTINE WILL START DOING SOME CHECKING AS TO WHERE WE STAND AS FAR AS  10000000
*UT3 IS CONCERNED                                                       10020000
*                                                                       10040000
NOREAD   TM    IEHMVV61,X'08'   ANYTHING ON SYSUT3                      10060000
         BC    1,YES1         YES                                       10080000
         B     VOLEXCP        NO,CHECK TO SEE IF ANY MORE INCLUDES      10100000
YES1     EQU   *                                                        10120000
         NI    IEHMVV61,X'DF' TURN OFF ALREADY OPEN BIT                 10140000
         TM    IEHMVV61,X'08' ANY ENTRIES ON UT3                        10160000
         BC    1,TRANSFER     TIME TO CLOSE,REINSTATE AND XCTL          10180000
         NI    IEHMVV61,X'F7' CLEAR THIS SWITH FOR NEXT RUN             10200000
         B     REPEAT         MIGHT NOT HAVE FIT THE ORIGINAL 'FROM' DS 10220000
TRANSFER L     REG2,IEHMVV40  ADDRESS OF UT1 DCB                        10240000
         LA    REG2,0(0,REG2)        CLEAR HIGH ORDER BYTE              10280000
         NI    IEHMVV61,X'F7'                                           10300000
         L     REG2,IEHMVV42  ADDRESS OF SYSUT3 DCB                     10320000
         LA    REG2,0(0,REG2)        CLEAR HIGH ORDER BYTE              10340000
         L     REG5,IEHMVV42+4   ADDRESS OF DECB FOR WRITE              10360000
         LA    REG5,0(0,REG5)      CLEAR HIGH ORDER BYTE                10380000
         WRITE (5),SF,(2),KEY,5,MF=E    WRITE MACRO                     10400000
         L     REG1,IEHMVV42+4     DECB PTR                             10420000
         CHECK (1)                                                      10440000
         MVC   IEHMVV42+8(5),8(REG2)    MOVE CCHHR TO COMM TAB          10460000
         NI    IEHMVV61,X'F7' CLEAR OUT THIS SWITCH                     10480000
         L     REG2,IEHMVV31        FROM DCB FOR REOPENING              10500000
         LA    REG2,0(0,REG2)   CLEAR HIGH ORDER BYTE                   10520000
         MVC   RENTOPEN(TAG1-OPENJ1),OPENJ1   REOPEN OUTPUT DATA SET    10540000
         L     1,IEHMVV21+4     ADDR OF TO DSNAME                       10560000
         MVC    JFCB(44),0(1)       MOVE DSNAME TO JFCB                 10580000
         L     1,IEHMVV23       ADDR OF TO VOLID                        10600000
         MVC   JFCB+118(6),4(1)      MOVE VOL ID TO JFCB                10620000
         LA    1,JFCBPTR         ADDR OF EXIT LIST                      10640000
         ST    1,36(2)         PUT IN DCB                               10660000
         OPEN  ((2)),TYPE=J,MF=(E,RENTOPEN)   THIS MAKES OPEN REENTRANT 10680000
         LR    REG1,REG11          ADDRESS OF SOME GOTTEN CORE          10700000
         FREEMAIN R,LV=1016,A=(1)  FREE CORE MAN                 YM5087 10720000
         LA    REG2,MODULNAM           ADDRESS OF MODULENAME    YA01217 10722016
         IEHPOST ,T                                             YA01217 10742016
         L     REG14,12(0,13)                                           10780000
         XCTL  (2,12),EPLOC=(2)     TRANSFER CONTROL TO MOVE/PDS        10800000
MIDABORT OI    IEHMVV20+2,X'40'   SET MID-ABORT BIT                     10860000
         IEHPOST   ,T                                                   10880000
         LA    REG2,FINAL     ENTRY POINT TO WRAP UP                    10900000
         L     REG14,12(0,13)                                           10920000
         XCTL  (2,12),EPLOC=(2)     TRANSFER CONRTOL TO WRAP-UP         10940000
MSG1     BAL   REG6,CLEAR                                               10960000
         NI    44(REG1),X'3F'          SET OFF PERM ERROR FLAGS  YM5086 10970000
         OI    IEHMVV61,X'02'     TURN ON ERROR INDICATOR          7632 10980000
         MVC   PRINT+1(72),M172   ERROR MSG. TO PRINT BUFFER       7632 11020000
         B     PRINTMSG                                         YA01217 11040016
MSG2     BAL   REG6,CLEAR                                               11080000
         MVC   PRINT+1(80),M173    ERROR MSG TO PRINT BUFFER            11120000
         MVC   PRINT+32(6),SEARCH+4 MOVE VOLUME ID TO ERROR MSG         11140000
         B     FREEDSCB                                         YA01217 11160016
MSG3     BAL   REG6,CLEAR                                               11200000
         MVC   PRINT+1(16),M174         PART OF ERROR MSG TO BUFFER     11240000
         MVC   PRINT+17(44),INPUT+6     DSNAME TO PRINT BUFFER          11260000
         MVC   PRINT+62(59),M174A       REST OF ERROR MSG TO BUFFER     11280000
         MVC   PRINT+79(6),SEARCH+4     VOL ID TO ERROR MSG             11300000
         B     FREEDSCB                                         YA01217 11320016
MSG4     BAL   REG6,CLEAR                                               11360000
         MVC   PRINT+1(16),M175         PART OF ERROR MSG TO BUFFER     11400000
         MVC   PRINT+17(44),INPUT+6     DSNAME TO PRINT BUFFER          11420000
         MVC   PRINT+62(55),M175A       REST OF ERROR MSG               11440000
         B     FREEDSCB                                         YA01217 11460016
MSG4A    BAL   REG6,CLEAR                                               11500000
         MVC   PRINT+1(92),M176         ERROR MSG TO PRINT BUFFER       11540000
         MVC   PRINT+48(7),M176A        RECORD FORMAT NOT COMPATIBLE    11560000
         B     FREEDSCB                                         YA01217 11580016
MSG5     BAL   REG6,CLEAR                                               11620000
         MVC   PRINT+1(92),M176         ERROR MSG TO RPINT BUFFER       11660000
         MVC   PRINT+48(7),M176B        BLKSIZE LARGER ON INCLUDE       11680000
         B     FREEDSCB                                         YA01217 11700016
MSG6     BAL   REG6,CLEAR                                               11740000
         MVC   PRINT+1(92),M176         ERROR MSG TO PRINT BUFFER       11780000
         MVC   PRINT+48(7),M176C        LRECL NOT EQUAL                 11800000
         B     FREEDSCB                                         YA01217 11820016
MSG7     BAL   REG6,CLEAR                                               11860000
         MVC   PRINT+1(92),M176         ERROR MSG TO PRINT BUFFER       11900000
         MVC   PRINT+48(7),M176D        KEY LENGTHS NOT EQUAL           11920000
         B     FREEDSCB                                         YA01217 11940016
MSG8     BAL   REG6,CLEAR                                               11980000
         MVC   PRINT+1(15),M180         FIRST PART OF ERROR MSG         12020000
         MVC   PRINT+16(8),INPUT+50     MEMBER NAME TO ERROR MSG        12040000
         MVC   PRINT+25(21),M180A       SECOND PART OF ERROR MSG        12060000
         MVC   PRINT+47(44),INPUT+6     DATA SET NAME TO ERROR MSG      12080000
         MVC   PRINT+92(29),M180B       THIRD PART OF ERROR MSG         12100000
         B     PRINTMSG                                         YA01217 12120016
MSG9     BAL   REG6,CLEAR                                       YA01217 12124016
         MVC   PRINT+1(L'M177),M177    ERROR MSG TO PRINT BUFFERYA01217 12128016
         MVC   PRINT+2+L'M177(44),INPUT+6 DSNAME TO PRINT BUFFERYA01217 12132016
         LA    REG2,PRINT+46+L'M177    PTR BEHIND DSNAME IN BUFFYA01217 12136016
MSG9LOOP BCTR  REG2,0                  PTR TO PREVIOUS BYTE     YA01217 12140016
         CLI   0(REG2),BLANK           CHECK FOR LAST CHAR IN   YA01217 12144016
         BE    MSG9LOOP                DSNAME.                  YA01217 12148016
         MVC   2(L'M177A,REG2),M177A   REST OF MSG TO BUFFER    YA01217 12152016
         B     FREEDSCB                                         YA01217 12156016
NOMOUNT  BAL   REG6,CLEAR                                               12160000
         MVC   PRINT+1(80),M173         ERROR MSG TO PRINT BUFFER       12200000
         MVC   PRINT+32(6),SEARCH+4  MOVE VOLUME ID TO ERROR MSG        12220000
         B     PRINTMSG                                         YA01217 12240016
CLEAR    MVI   PRINT,X'40'    MOVE A BLANK IN FIRST POS OF PRINT AREA   12280000
         MVC   PRINT+1(120),PRINT     CLEAR OUT PRINT AREA              12300000
         L     REG7,MSGCONST           SET UP BASE FOR MSG CSECTYA01217 12310016
         BR    REG6       GO TO APPROPRIATE MSG RTN                     12320000
FREEDSCB L     REG1,LIST+12            GET ADDRESS OF GETMAIN   YA01217 12326016
         FREEMAIN R,LV=500,A=(1)       FREE CORE GOTTEN FOR DSCBYA01217 12332016
PRINTMSG ST    REG3,IEHMVV00+128       SAVE REG 3                       12340000
         LA    REG3,PRINT              LOAD ADDR OF PRINT AREA          12360000
         LINK EP=IEHMVESU              GO TO MSG WTR                    12380000
         L     REG3,IEHMVV00+128        RESTORE REG 3                   12400000
         B     *+4(REG15)      INTERPRET THE ERROR RETURNS IF ANY       12420000
         B     SETEXCP                 NO ERRORS                YA01217 12440016
         B     MIDABORT        PERM ERROR ON SYSPRINT                   12460000
         DS    0F                                               YA01217 12470016
UPTTR    DC    X'00000100'         TO UP TTR                            12480000
JFCBPTR  DC    X'87'                    OPENJ                           12500000
         DC    AL3(JFCB)                POINTER TO MY JFCB              12520000
FORBLDL  DC    X'0001004A'         PUT IN PREFACE ONCE                  12540000
POINT    DC    X'00000100'          USED TO POINT TO BEG OF UT3         12580000
M176A    DC    C' RECFM '                                       YA01217 12600016
M176B    DC    C'BLKSIZE'                                               12620000
M176C    DC    C' LRECL '                                       YA01217 12640016
M176D    DC    C'KEYLGTH'                                               12660000
FAKEDCB  DC    22F'0'              WHERE PRE-OPEND DCB IS BUILT         12680000
JFCB     DS    44F      USED FOR JFCB IN OPENJ                          12700000
FILETYPE DC    X'0200'             SIGNIFIES A PDS                      12720000
ZEROS    DC    5F'0'               CONSTANT OF ZEROS                    12740000
LENGTH44 DC    H'44'                   LENGTH OF DATA SET NAME  YA01217 12750016
MACRF    DC    X'2400'             SIGNIFIES A REA                      12760000
EODADDR  DC    A(NOREAD)           MY EOD ADDRESS                       12800000
EXITLST  DC    A(JFCBPTR)          ADDCON FOR OPEN WHEN DOING AN OPENJ  12820000
MSGCONST DC    A(MESSAGES)                                              12840000
OPENJ    OPEN  (,(INPUT)),MF=L                                          12860000
TAG      DS    F           TO BE ABLE TO GET CORRECT BYTES IN OPEN      12880000
OPENJ1   OPEN  (,(OUTPUT)),MF=L        PART OF RE-                      12900000
TAG1     DS    F                       ENTRANT OPEN                     12920000
*                                                                       12940000
*CHANNEL PROGRAM THAT SEARCHES THE SYSUT1 FILE FOR ANY MORE INCLUDES    12960000
*IF ANY EXIST THEN VOLUME INFORMATION IS PICKED UP FOR THE NEXT ENTRY   12980000
*INTO THE PROGRAM. THIS CODE WILL BE DUMPED IN GOTTEN CORE SO IT CAN BE 13000000
*REENTRANT.                                                             13020000
*                                                                       13040000
         DS    0D                                                       13060000
MYCHNLPG DC    X'31'               SEARCH ID EQUAL                      13080000
         DC    AL3(0)             ID OF FIRST SYSUT1 REC         S20201 13100020
         DC    X'40000005'                                              13120000
         DC    X'08'                                                    13140000
         DC    AL3(0)             TO SIDEQ                       S20201 13160020
         DC    X'40000001'                                              13180000
         DC    X'B1'               SEARCH ID EQUAL WITH M/T BIT SET     13200000
         DC    AL3(0)             ID OF LAST SYSUT1 REC          S20201 13220020
         DC    X'40000005'                                              13240000
         DC    X'08'                                                    13260000
         DC    AL3(0)             TO SEARCH KEY HIGHER THAN 0000 S20201 13280020
         DC    X'40000001'                                              13300000
         DC    X'03'                                                    13320000
         DC    X'000000'           NOP,HIT THE LAST RECORD              13340000
         DC    X'00000001'                                              13360000
         DC    X'C9'               SEARCH KEY HIGH WITH M/T BIT SET     13380000
         DC    AL3(0)             FOR NON-ZERO-ED KEY            S20201 13400020
         DC    X'60000011'        OF 17 BYTES VOL INFO           S20201 13420020
         DC    X'08'                                                    13440000
         DC    AL3(0)             TO SIDEQ FOR END OF UT1        S20201 13460020
         DC    X'40000001'                                              13480000
         DC    X'06'                                                    13500000
         DC    AL3(0)             READ DATA INTO INPUT AREA      S20201 13520020
         DC    X'00000053'                                         DT0I 13540018
         DC    X'31'               SEARCH ID EQUAL                      13580000
         DC    AL3(0)             OF FIRST SYSUT1 REC            S20201 13600020
         DC    X'40000005'                                              13620000
         DC    X'08'                                                    13640000
         DC    AL3(0)             TIC TO SIDEQ                   S20201 13660020
         DC    X'40000001'                                              13680000
         DC    X'B1'                                                    13700000
         DC    AL3(0)             ID OF LAST UT1 REC             S20201 13720020
         DC    X'40000005'                                              13740000
         DC    X'08'                                                    13760000
         DC    AL3(0)             TIC TO LOOK FOR MATCHING KEY   S20201 13780020
         DC    X'40000001'                                              13800000
         DC    X'03'                                                    13820000
         DC    X'000000'           NO OPERATION,STOPS THE COMMAND CHAIN 13840000
         DC    X'00000001'                                              13860000
         DC    X'29'                                                    13880000
         DC    AL3(0)             SEARCH MATCHING KEY            S20201 13900020
         DC    X'60000011'        OF 17 BYTES VOL INFO           S20201 13920020
         DC    X'08'                                                    13940000
         DC    AL3(0)             TIC TO LOOK FOR END OF UT1     S20201 13960020
         DC    X'40000001'                                              13980000
         DC    X'06'                                                    14000000
         DC    AL3(0)             READ INTO INPUT                S20201 14020020
         DC    X'40000053'                                         DT0I 14040018
         DC    X'08'                   TIC TO NEXT INSTRUCTION   S20201 14045020
         DC    AL3(0)                  OR TO READ SECTOR IF      S20201 14050020
         DC    X'40000001'             RPS DEVICE                S20201 14055020
         DC    X'31'                                                    14060000
         DC    AL3(0)             SIDEQ OF RECORD JUST READ      S20201 14080020
         DC    X'40000005'                                              14100000
         DC    X'08'                                                    14120000
         DC    X'000000'                                                14140000
         DC    X'00000001'                                              14160000
         DC    X'0D'                                                    14180000
         DC    AL3(0)             CLOBBER KEY OF REC JUST READ   S20201 14200020
         DC    X'20000011'                                              14220000
         DC    X'23'                   SET SECTOR TO 0           S20201 14220920
         DC    AL3(0)                                            S20201 14221820
         DC    X'40000001'                                       S20201 14222720
         DC    X'08'                   TIC TO CCWVOL             S20201 14223620
         DC    AL3(0)                                            S20201 14224520
         DC    X'40000001'                                       S20201 14225420
         DC    X'23'                   SET SECTOR TO 0           S20201 14226320
         DC    AL3(0)                                            S20201 14227220
         DC    X'40000001'                                       S20201 14228120
         DC    X'08'                   TIC TO CHANPROG           S20201 14229020
         DC    AL3(0)                                            S20201 14229920
         DC    X'40000001'                                       S20201 14230820
         DC    X'22'                   READ SECTOR VALUE INTO    S20201 14231720
         DC    AL3(0)                  'SECTOR'                  S20201 14232620
         DC    X'40000001'                                       S20201 14233520
         DC    X'23'                   SET SECTOR TO THE VALUE   S20201 14234420
         DC    AL3(0)                  IN 'SECTOR'               S20201 14235320
         DC    X'40000001'                                       S20201 14236220
         DC    X'08'                   TIC BACK TO REGULAR CCWS  S20201 14237120
         DC    AL3(0)                                            S20201 14238020
         DC    X'40000001'                                       S20201 14238920
FINAL    DC    C'IEHMVESN'                                              14260000
MODULNAM DC    CL6'IEHMVE'             1ST PART OF MODULE NAME  YA01217 14270016
MODULEND DS    CL2                     2ND PART OF MODULE NAME  YA01217 14270916
TJ       DC    CL2'TJ'                 END FOR MODULE IEHMVETJ  YA01217 14271816
SM       DC    CL2'SM'                 END FOR MODULE IEHMVESM  YA01217 14272716
SL       DC    CL2'SL'                 END OF MODULE IEHMVESL   YA01217 14273616
TORECFM  DS    C                   WORK COPY OF TO-DS RECFM    @ZA01247 14274502
INCRECFM DS    C                   WORK-COPY OF INC/REP-DS RECFMYA01217 14275416
SAVRECFM DS    C                       SAVE 'TO' DCB RECFM     @ZA01247 14276302
SAVLRECL DS    CL2                                   LRECL      YA01217 14277216
SAVBLKSI DS    CL2                                   BLKSIZE    YA01217 14278116
SAVKEYLE DS    C                                     KEYLEN     YA01217 14279016
*                                                                       14280000
* THE FOLLOWING CSECT IS FOR ALL ERROR MESSAGES TO BE CONTAINED IN      14300000
* THIS LOAD MODULE.  IT ALSO CONTAINS THE ERROR CODES WHICH PRECEDE     14320000
* EACH MESSAGE.                                                         14340000
*                                                                       14360000
MESSAGES CSECT                                                          14380000
M172     DC    CL8'IEH372I '                                            14400000
         DC    CL32'I/O ERROR IN WORK FILE. SOME SUB'              7632 14420000
         DC    CL32'ORDINATE REQUESTS MAY BE IGNORED'              7632 14440000
M173     DC    CL8'IEH373I '                                            14460000
         DC    CL32'UNABLE TO MOUNT VOLUME XXXXXX. S'                   14480000
         DC    CL32'OME INCLUDE OR REPLACE REQUESTS '                   14500000
         DC    CL8'IGNORED.'                                            14520000
M174     DC    CL8'IEH374I '                                            14540000
         DC    CL8'DATASET '                                            14560000
M174A    DC    CL29'NOT FOUND ON VOL XXXXXX. INCL'                      14580000
         DC    CL30'UDE OR REPLACE REQUEST IGNORED'                     14600000
M175     DC    CL8'IEH375I '                                            14620000
         DC    CL8'DATASET '                                            14640000
M175A    DC    CL32'IS NOT PARTITIONED. INCLUDE OR R'                   14660000
         DC    CL23'EPLACE REQUEST IGNORED.'                            14680000
M176     DC    CL8'IEH376I '                                            14700000
         DC    CL32'RECORD CHARACTERISTICS NOT COMPA'                   14720000
         DC    CL32'TIBLE (       ). INCLUDE OR REPL'                   14740000
         DC    CL20'ACE REQUEST IGNORED.'                               14760000
M177     DS    0CL16                                            YA01217 14762016
         DC    CL8'IEH377I '                                    YA01217 14764016
         DC    CL8'DATA SET'                                    YA01217 14766016
M177A    DS    0CL58                                            YA01217 14768016
         DC    CL33'REQUIRES TRACK OVERFLOW FEATURE. '          YA01217 14770016
         DC    CL25'INCL/REPL REQUEST IGNORED'                  YA01217 14772016
M180     DC    CL8'IEH380I '                                            14780000
         DC    CL7'MEMBER '                                             14800000
M180A    DC    CL21'NOT FOUND IN DATASET '                              14820000
M180B    DC    CL29'INCLUDE REPLACE REQUEST IGNRD'                      14840000
*                                                                       14860000
* ANOTHER DSECT THAT I GET CORE FOR                                     14880000
*                                                                       14900000
CORE     DSECT      REG 11 USED AS A BASE                               14920000
KEY      DS    F       KEY PORTION OF OUTPUT REC                        14940000
CCHHR    DS    FL5       STUCK IN TO SCRATCH USED RECDS                 14960000
DATA     DS    FL3        START OF DATA PORTION                         14980000
         DS    22F     REMAINING DATA PORTION AND RENAME FIELD          15000000
FIRST    DS    FL5                 CCHHR OF RECORD PRIOR TO BEGINNING   15020000
VOLLIST  DS    5F                  USED BY VOLUME MOUNT ROUTINE         15040000
SAVEREG  DS    16F       TO SAVE REGS                                   15060000
LIST     DS    4F        LIST AREA FOR OBTAIN                           15080000
PREFACE  DS    1F        1 WORD HDR FOR BLDL                            15100000
BLDL     DS    19F    AREA FOR BLDL                                     15120000
DSNAME   DS    11F       44 BYTE DATA SET NAME IN UT1 REC               15140000
PRINT    DS    31F      PRINT BUFFER FOR MSG WRITER                     15160000
*                                                                       15180000
*THE IOB I USE WHEN EXECUTING MY CHANNEL PROGRAM                        15200000
*                                                                       15220000
         DS    0D                  FORCE TO A DOUBLE WORD  BOUNDRY      15240000
IOB      DS    1F                  FLAGS AND STATUS BYTES               15260000
         DS    1F                  PTR TO YOUR EVENT CONTROL BLK (ECB)  15280000
IOBCSW   DS    2F                  CSW POSTED HERE                      15300000
START    DS    1F                  PTR TO MY CHANNEL PROGRAM            15320000
DCBADR   DS    1F                  ADDRESS OF DCB ASSOCIATED WITH CHAN  15340000
         DS    2F                                                       15360000
MBBCCHHR DS    2F                  ADDRESS USED TO SEEK BY IOS          15380000
ECB      DS    1F                  EVENT CONTROL BLOCK FOR MY EXCP      15400000
SECTOR   DS    F                     FIRST BYTE FOR SECTOR VALUE S20201 15410020
CCWVOL   DS    2D                  WHERE                                15420000
ANTHRSRC DS    6F                   MY REENTRANT                        15440000
KEYNZERO DS    6F                    CHANNEL                            15460000
CHANPROG DS    4F                     PROGRAM                           15480000
CCWSRCH  DS    6F                      WILL BE                          15500000
SRCHKEY  DS    6F                          CONSTRUCTED                  15520000
TIC      DS    2F                      DUMMY TIC                 S20201 15530020
ZEROOUT  DS    6F                                                       15540000
RPSCCW   DS    4F                      SET SECTOR AND TIC        S20201 15545020
RPSCHAN  DS    4F                      SET SECTOR AND TIC        S20201 15550020
READSEC  DS    6F                      READ,SET SECTOR AND TIC   S20201 15555020
RENTOPEN DS    6F        WHERE REENTRANT OPEN GOES                      15560000
*                                                                       15580000
*DSECT FOR A CHUNK OF PERM WK AREA                                      15600000
*                                                                       15620000
GETCORE  DSECT      REG 9 USED AS A BASE                                15640000
HOLDTTR  DS    1F        TTR OF BEG OF SYSUT 1                          15660000
SEARCH   DS    5F   DEV TYPE,VOLID,SEQ NO, UNIT                    DT0I 15680018
IOBADDR  DS    1F        ADDR OF OLD IOB IN UT1 DCB                     15700000
EODAD    DS    1F        ADDR OF OLD EOD IN UT1 DCB                     15720000
DDNAME   DS    2F                  DDNAME TO BE REINSTATED              15740000
INPUT    DS    21F     UT1 READ IN AREA                                 15760000
*                                                                S20201 15761020
** DSECT TO DESCRIBE DEVICE CHARACTERISTICS TABLE ************** S20201 15762020
*                                                                S20201 15763020
UNITABLE DSECT                                                   S20201 15764020
UNITSICC DS    H                                                 S20201 15765020
UNITSIHH DS    H                                                 S20201 15766020
UNITTRLN DS    H                                                 S20201 15767020
UNITOVHI DS    CL1                                               S20201 15768020
UNITOVHL DS    CL1                                               S20201 15769020
UNITOVHK DS    CL1                                               S20201 15770020
UNITFLAG DS    CL1                                               S20201 15771020
UNITTOLR DS    CL1                                               S20201 15772020
*                                                                S20201 15773020
**  DSECT TO DESCRIBE THE DCB ***********************************S20201 15774020
*                                                                S20201 15775020
         DCBD  DSORG=PS,DEVD=DA                                  S20201 15776020
         EJECT                                                  YA01217 15776616
DSCBDSEC DSECT                                                  YA01217 15777216
         SPACE 1                                                YA01217 15777816
         IECSDSL1 (1)                                           YA01217 15778416
         SPACE 2                                                YA01217 15779016
         IEHMVV                                                         15780000
         END                                                            15800000
./  ADD  SSI=81110058,NAME=IEHMVETJ
*TITLE ' IEHMVSTJ                                                     * 00020000
* /* START OF SPECIFICATIONS***                                         00025002
*01* PROCESSOR = ASSEM;                                                 00030002
**** END OF SPECIFICATIONS ***/                                         00035002
*FUNCTION/OPERATION: MOVE OR COPY DATASET WHICH ARE PDS OR PHYSICAL   * 00040000
*SEQUENTIAL. WHEN MOVING OR COPYING PDS DATA SET THE PROGRAM UPDATES  * 00060000
*TTR'S IN DIRECTORY ENTRY AND UPDATES TTR POINTERS IN NOTELISTS IF    * 00080000
*THE PDS CONTAINS NOTELISTS. THE MODULE DOES A GET MAIN FOR BUFFERS   * 00100000
*AND FREEMAIN BEFORE XCTL.                                            * 00120000
*ENTRY POINTS: IEHMVETJ                                               * 00140000
*INPUT: AT ENTRY REG13 POINTS TO SAVEAREA AND REG 12 POINTS TO        * 00160000
*COMMUNICATION TABLE.                                                 * 00180000
*OUTPUT: REGISTERS ARE SAME AS ENTRY.                                 * 00200000
*EXTERNAL ROUTINES: IEHMVSSR, IEHMVLSU.                               * 00220000
*EXITS - NORMAL XCTL TO IEHMVSSN XCTL TO IEHMVETG                     * 00240000
*ERRORS: XCTL TO IEHMVSSN                                             * 00260000
*TABLES/WORK AREAS: IEHMVV - COMMUNICATION TABLE THE WORKAREA IS IN   * 00280000
*THE COMMUNICATION TABLE                                              * 00300000
IEHMVSTJ CSECT                                                          00302002
*A050020-050180,062460                  (ORG)@ZA31216=@XA21663=@YA20729 00302199
*A017500                                                       @ZA10917 00302499
*C017870                                                       @YA01724 00302599
*A27580                                                         YA01458 00302602
*D27560-27720,27800,28200-28900                                 YA01458 00303202
* YM0566 IS REINSERTION OF CODE REMOVED BY XA00077               YM0566 00303302
*C 027560                                                        YM0566 00303602
*A 027660-027860,028500-028948                                   YM0566 00303702
*A008730-008760,017810-017920,130330-130360                     YA01221 00304002
*C007800,008700                                                 YA01221 00306002
*C007800,D008400-008600,A008700,018200,C020800,D039000,040000,   A48812 00310200
*041000,A041600,D043400-043600,A043700,043720,C045600,A051000,   A48812 00310600
*D051200-053200,C053400,A058600,064400,070400,D071030-071810,    A48812 00311000
*A073320,D073370,080400-082000,A130200                           A48812 00311400
*                                                                A37903 00312021
* 032200,032800                                                  A31964 00320120
*045400                                                          A31964 00320220
* 019000                                                         A27706 00320519
* 093200,094600,115660                                           A26560 00321019
*                                                               PTM2433 00323018
* 103450-103550                                                 PTM2433 00326018
*1796005800,111800                                               PTM019 00330017
*                                                                       00340017
*1796                                                              UL0H 00360017
*                                                                  UL0H 00380017
*                                                                     * 00400000
*  THIS ROUTINE COPIES A PDS TO A NEW PDS WITH OPTIONS FOR         UL0H 00410017
*  REPLACING MEMBERS AND INCLUDING NEW MEMBERS IN THE NEW PDS.     UL0H 00420017
*                                                                  UL0H 00430017
*A031300-031384                                                @YA01458 00440002
*C029000                                                       @YA01458 00450002
IEHMVETJ SAVE  (14,12),T,IEHMVETJ-78/04/17-OZ31216             @ZA31216 00460099
         USING IEHMVETJ,BASE10                                          00480000
         USING IEHGOTEN,BASE11                                          00500000
         USING IEHMVV,BASE12                                            00520000
         USING PRINTBUF,1                                               00540000
         ENTRY IEHMVETJ                                                 00560000
*                                                                  UL0H 00570017
*  THIS ROUTINE COMPUTES AMOUNT OF CORE NEEDED FOR WORK AREA       UL0H 00580017
*  AND BUFFER, AND CLEARS WORK AREA TO ZEROS.                      UL0H 00590017
*                                                                  UL0H 00600017
FIRST    LR    BASE10,15                LOAD BASE REGISTER              00640000
         SR    REGZERO,REGZERO                                          00660000
         L     3,IEHMVV62                                               00680000
         LTR   3,3                                                      00700000
         BP    ENTRY2                                                   00720000
         L     2,IEHMVV10                                               00740000
         ST    2,IEHMVV62                                               00760000
         LA    2,188(0,2)                                       YA01221 00780002
         ST    2,IEHMVV10                                               00800000
ENTRY2   L     11,IEHMVV62                                              00820000
         XC    0(188,11),0(11)         CLEAR THE WORKAREA       YA01221 00870002
         MVI   BLDLIST+1,X'01'         INDIC ONE ENTRY          YA01221 00873002
         MVI   BLDLIST+3,X'0E'         ENTRY LENGTH             YA01221 00876002
         L     REG4,IEHMVV31                                            00880000
         MVC   SYNAD(3,REG4),ERREXT         ADDR OF SYNAD EXIT          00900000
         L     REG2,IEHMVV30             LOAD ADDR OF FROMDCB           00920000
         MVC   EODAD(3,REG2),PDSOUT+1   PUT EODAD EXIT IN DCB           00940000
         MVC   SYNAD(3,REG2),ERREXT         ADDR OF SYNAD EXIT          00960000
*                                                                  UL0H 00962017
*  ACTIVATE USER INPUT TRAILER LABEL EXIT IF REQUIRED.             UL0H 00964017
*                                                                  UL0H 00966017
         CLI   UDCBITLE,DEACTIVE       IS ITLE INACTIVE            UL0H 00968017
         BE    NEXTCODE                YES, CONTINUE               UL0H 00970017
         MVC   UDCBITLE(4),XXITLE      NO, SET UP ITLE EXLST ADDR  UL0H 00972017
NEXTCODE DS    0H                                                  UL0H 00974017
         SR    REG3,REG3                                                00980000
         IC    REG3,KEYL(0,REG2)        INSERT KEY LENGTH FROM DCB      01000000
         STC   REG3,KEYLEN                                              01020000
         LH    REGONE,BLKS(0,REG2)      LOAD WITH BLOCKSIZE FROM DCB    01040000
         STH   REGONE,BLKSIZE                                           01060000
         IEHPRE  (14,1),TF                                              01080000
         TM    DSORG(REG2),X'02'        IS THIS A BSAM DATASET          01100000
         BC    8,BSAMRTN               YES GO TO BSAM ROUTINE           01120000
         SR    2,2                                                      01140000
         B     GETMEMBR                                                 01160000
GBSBF    SR    0,0                                                      01180000
         IC    REGZERO,KEYLEN           ADD KEY LENGTH                  01200000
         AH    REGZERO,BLKSIZE          PLUS BLKSIZE TO COMPUTE         01220000
         ST    REGZERO,BUFF            STORE AMOUNT FOR BUFFER          01240000
         GETMAIN R,LV=(0)               BUFFER SIZE                     01260000
         ST    REGONE,BUFFER                                            01280000
         B     READ01                                                   01300000
*      THIS ROUTINE WILL GET MEMBER DIRECTORY RECORD PLACED IN DIRENTRY 01320000
*    AND BRANCH TO ROUTINE INDEXED BY RETURN CODE                       01340000
GETMBR02 LA    REG2,10                                                  01360000
         B     GETMEMBR                                                 01380000
*      GETMBR01 WILL SET ENTRY SWITCH FOR MEMBER ENTRY  WILL            01400000
*    PRINT MESSAGE THAT MEMBER HAS BEEN MOVED                           01420000
GETMBR01 L     REG3,A118                                                01440000
         IC    REG2,A118                                                01460000
         BAL   REG9,MESSAGE                                             01480000
GETMEMBR LA    REG3,DIRENTRY-5                                          01500000
         LINK  EP=IEHMVESR                                              01520000
         B     BACK(15)                                                 01540000
BACK     B     CKALIAS                                                  01560000
         B     FINISHED            END OF JOB                           01580000
         B     WRKFLE                                                   01600000
*                                                                       01620000
*      THIS ROUTINE CHECKS FOR ALIAS BIT IF PRESENT GO TO STOW ALIAS    01640000
*    IF TRUE MEMBER NAME CHECK FOR PRESENCE OF NOTELIST TTRS            01660000
*                                                                       01680000
CKALIAS  LA    2,DIRENTRY-5                                             01700000
         MVI   0(2),X'00'                                               01720000
         MVC   1(4,2),0(2)                                              01740000
         XC    TTRXPTR,TTRXPTR         CLEAR TTRXPTR           @ZA10917 01750004
         TM    C,BIT0                                                   01760000
         BO    STALRTN        YES GO TO STOW ALIAS ROUTINE              01780000
         TM    IEHMVV20+3,X'08'        PREALLOCATION            YA01221 01781002
         BZ    CONTINUE                NO  DON'T CHECK          YA01221 01782002
* THE NEXT ROUTINE READS THE DIRECTORY OF THE RECEIVING         YA01221 01783002
* DATA SET                                                      YA01221 01784002
* IF THE MEMBER TO BE COPIED ALREADY EXISTS THEN THE MEMBER     YA01221 01785002
* WILL NOT BE COPIED AND A WARNING MESSAGE WILL BE ISSUED       YA01221 01786002
         MVC   BLDLIST+4(8),RENAME     GET THE MEMBER NAME     @YA01724 01787002
         L     REG2,IEHMVV31           ADDR TO-DCB              YA01221 01788002
         BLDL  (REG2),BLDLIST                                   YA01221 01789002
         LTR   REG15,REG15             MEMBER FOUND             YA01221 01790002
         BZ    DUP01                   YES  PRINT MSG           YA01221 01791002
CONTINUE DS    0H                      NO COPY THE MEMBER       YA01221 01792002
         TM    C,X'60'                  ARE THERE TTRS                  01800000
         BZ    PDSBUF                   NO                              01820000
         SR    REGZERO,REGZERO         CLEAR FOR INSERT          A48812 01830022
         IC    REGZERO,C               CALCULATE NUMBER          A48812 01832022
         SRL   REGZERO,5               OF USER TTRN'S            A48812 01834022
         LA    REG2,N1                 BYTE N OF FIRST TTR       A48812 01836022
SRCHNL   DS    0H                                                A48812 01838022
         CLI   0(REG2),X'00'           NOTELIST PTR              A48812 01838422
         BNE   NLBUF                   YES GET A NL AREA         A48812 01838822
         LA    REG2,4(REG2)            JUMP TO NEXT TTRN         A48812 01839222
         BCT   REGZERO,SRCHNL          IF ANY                    A48812 01839622
         B     PDSBUF                  SKIP NL GETMAIN           A48812 01839722
NLBUF    DS    0H                                                A48812 01839822
         LA    REGZERO,1024                                             01840000
         LH    REGONE,BLKSIZE                                           01860000
         CR    REGZERO,REGONE                                           01880000
         BH    ADDKEY                                            A27706 01900019
         LR    REGZERO,REGONE                                           01920000
ADDKEY   AH    REGZERO,KEY                                              01940000
         LA    REG2,4                  ADD 4 INTO REGISTER              01960000
         AR    REGZERO,REG2            ADD 4 TO SIZE OF AREA            01980000
         ST    REGZERO,NOTE            STORE AMT FOR NOTELIST BUFF      02000000
         GETMAIN R,LV=(0)               GET AREA FOR NOTELIST           02020000
         ST    REGONE,NOTELIST                                          02040000
         AH    REGONE,KEY                                               02060000
         ST    REGONE,TTRXPTR          BEGIN OF NL DATA          A48812 02090022
PDSBUF   SR    0,0                                                      02100000
         AH    REGZERO,KEY                                              02120000
         AH    REGZERO,BLKSIZE                                          02140000
         ST    REGZERO,BUFF            STORE AMOUNT FOR BUFFER          02160000
         GETMAIN  R,LV=(0)              GET AREA FOR RECORDS            02180000
         ST    REGONE,BUFFER            ADDRESS OF CORE                 02200000
         SR    REG6,REG6                                         A31964 02204020
         ST    REG6,TTR1           ZERO TTR SAVE AREAS           A31964 02208020
         ST    REG6,TTR2                                         A31964 02212020
         ST    REG6,TTR3                                         A31964 02216020
         TM    C,THREENL                                                02220000
         BC    7,HASNOTE                                                02240000
COPYMBR  L     REGONE,IEHMVV30          ADDRESS OF FROM DCB             02260000
         MVI   IOFLG(REGONE),X'00'      RESET I/O FLAGS                 02280000
         L     REG2,IEHMVV31            ADDRESS OF TO DCB               02300000
         MVI   IOFLG(REG2),X'00'        RESET I/O FLAGS                 02320000
         LA    1,0(0,1)                                                 02340000
         MVC   NXTPT(3),TTR             LOAD TTR FROM DIRECTORY         02360000
*                                        ENTRY AND POINT TO FIRST       02380000
         LA    REGZERO,NXTPT                                            02400000
         POINT (1),(0)                                                  02420000
         B     READ01                                                   02440000
*                                                                       02460000
*                                                                       02480000
*      THIS READS A RECORD  COMPUTES THE LENGTH OF RECORD THEN WRITES   02500000
*    THE RECORD IN THE NEW PDS  THIS ROUTINE COPIES MEMBERS THAT HAVE   02520000
*    NO NOTELISTS                                                       02540000
*                                                                       02560000
*                                                                       02580000
READ01   L     REG2,IEHMVV30            ADDRESS OF FROMDCB              02600000
         L     REGONE,IEHMVV30+4                                        02620000
         L     REG3,BUFFER              POINTER TO BUFFER               02640000
         SR    REG5,REG5                                                02660000
         AH    REG5,BLKS(0,REG2)        ADD BLOCKSIZE FROM DCB          02680000
         BAL   REG9,READ               READ A RECORD                    02700000
         CLI   IEHMVV74+4,X'FF'         I/O ERR IN U.L. EXIT RTN   UL0H 02704017
         BNE   READ01A                 NOT ON - CONTINUE           UL0H 02708017
         BAL   REG9,IOERRMSG            OUTPUT I/O ERR MSG         UL0H 02712017
READ01A  DS    0H                                                  UL0H 02716017
         L     REGONE,IEHMVV30+4                                        02720000
         BAL   REG9,CHECK              CHECK THE READ                   02740000
WRIT01   SR    REG5,REG5                                           8696 02748013
         TM    17(REG2),X'20'          TEST FOR DA               YM0566 02756002
         LA    REG9,RETRN              RETURN ADDRESS            YM0566 02766002
         BO    GETLNGTH                YES DA                    YM0566 02776002
         B     NOKEYLN                 NO VALID KEYS             YM0566 02786002
RETRN    L     REG2,IEHMVV31      ADDRESS OF TO DCB                8696 02788013
         MVC   BLKSAVE(2),BLKS(REG2)                                    02800000
         LH    REGONE,CSWCT(0,REG4)   PORTION OF BLOCK NOT MOVED YM0566 02850002
         LTR   REGONE,REGONE                                     YM0566 02860002
         BZ    GOOD                    NOT A TRUNCATED BLOCK     YM0566 02870002
         L     REG4,IEHMVV30           PTR TO FROM DCB           YM0566 02880002
         TM    17(REG2),X'20'          TEST FROM FOR DA          YM0566 02890002
         BZ    CHANGE                  NOT DA                    YM0566 02892002
         SR    REG9,REG9                                         YM0566 02894002
         IC    REG9,KEYL(0,REG2)       FROM KEY LENGTH           YM0566 02894402
         SR    REG5,REG9               DATA LENGTH               YM0566 02894802
CHANGE   STH   REG5,BLKS(0,REG2)   CHANGE DCB BLKSIZE              8696 02895013
GOOD1    L      REGONE,IEHMVV31+4    ADDRESS OF TO DECB        @YA01458 02900002
         L     REG3,BUFFER                                              02940000
         LTR   5,5           IS THE BLOCK COUNT ZERO?              8193 02960000
         BZ    FINISHED      YES--DO NOT ISSUE WRITE               8193 02980000
         BAL   REG9,WRITE              WRITE A RECORD                   03000000
         L     REGONE,IEHMVV31+4                                        03020000
         LA    1,0(0,1)                                                 03040000
         CHECK  (1)                                                     03060000
         L     REG2,IEHMVV31                                            03080000
         MVC   BLKS(2,REG2),BLKSAVE                                     03100000
         B     READ01                                                   03120000
GOOD     TM    36(REG2),X'C0'          UNDEFINED RECFM ?       @YA01458 03122002
         BNO   GOOD1                   NO-BRANCH               @YA01458 03124002
         SR    REG9,REG9               SUBTRACT                @YA01458 03126002
         IC    REG9,KEYL(0,REG2)        KEYLENGTH FROM         @YA01458 03128002
         SR    REG5,REG9                 DATA LENGTH           @YA01458 03130002
         B     GOOD1                                           @YA01458 03132002
*      THE HASNOTE ROUTINE CHECKS THE NUMBER OF TTRNS IN THE USER DATA  03140000
*    AND PLACES THE TTRS INTO A COMPARE AREA AND SAVES THE NUMBER OF    03160000
*    TTRS PRESENT                                                       03180000
*                                                                       03200000
HASNOTE  TM    C,THREENL           ARE THERE TTRNS ?             A31964 03250020
         BC    1,SET3                   HAS THREE TTR POINTERS          03320000
         TM    C,TWONL                                                  03340000
         BC    1,SET2                   HAS TWO TTR POINTERS            03360000
         B     SET1                                                     03380000
SET3     MVC   TTR3(4),TTRN3            MOVE TTR TO COMPARE AREA        03400000
         LA    REG6,1(0,REG6)           ADD COUNT OF ONE TO             03420000
SET2     MVC   TTR2(4),TTRN2                                            03440000
         LA    REG6,1(0,REG6)                                           03460000
SET1     MVC   TTR1(4),TTRN1                                            03480000
         LA    REG6,1(0,REG6)                                           03500000
*                                                                       03520000
*      CHECK TO SEE IF ALL NOTELISTS HAVE BEEN UPDATED IF SO GO TO      03540000
*    READ01 IF NOTELIST REMAINS TO BE UPDATE GO TO POINTER              03560000
*                                                                       03580000
GETNTLST LTR   REG6,REG6                                                03600000
         BC    8,READ01                                                 03620000
         B     POINTER                                                  03640000
*      POINTER ROUTINE DETERMINES WHICH NOTELIST SHOULD BE READ INTO    03660000
*    CORE NEXT  KEEPS TRACK OF NUMBER OF NOTELISTS WHICH HAVE BEEN      03680000
*    UPDATED                                                            03700000
*                                                                       03720000
POINTER  NI    TESTSW,X'00'                                             03740000
         CLI   TTRPT,X'01'                                              03760000
         BL    PTONE                                                    03780000
         BE    PTTWO                                                    03800000
         BH    PTTHRE                                                   03820000
PTONE    CLI   TTR1+3,NONL                                              03840000
         BE    PTTWO                                                    03860000
         L     REGZERO,TTR1                                             03880000
         B     POINT                                                    03920000
PTTWO    CLI   TTR2+3,NONL                                              03940000
         BE    PTTHRE                                                   03960000
         L     REGZERO,TTR2                                             03980000
         B     POINT                                                    04020000
PTTHRE   CLI   TTR3+3,NONL                                              04040000
         BE    WCHREAD                 GO TO READ AND NOTE ROUTINE      04060000
         L     REGZERO,TTR3                                             04080000
*      FALL THROUGH TO POINT                                            04120000
POINT    L     REGONE,IEHMVV30          ADDRESS OF FROMDCB              04140000
         LA    1,0(0,1)                                                 04160000
         STC   REGZERO,TTRXPTR         SAVE NBR OF TTRX'S        A48812 04170022
         IC    REGZERO,ZERO            CLEAR THE LOW ORDER BYTE  A48812 04172022
         SR    REG8,REG8                                                04180000
         IC    REG8,TTRPT                                               04200000
         LA    REG8,1(0,REG8)           ADD ONE TO TTR POINTER          04220000
         STC   REG8,TTRPT                                               04240000
         IC    REGZERO,ZERO                                             04260000
         ST    REGZERO,NXTPT                                            04280000
         LA    REGZERO,NXTPT                                            04300000
         POINT (1),(0)                                                  04320000
         SR    REG8,REG8               CLEAR FOR INSERT          A48812 04370022
         IC    REG8,TTRXPTR            SAVE TOTAL NBR OF NLTTRX'SA48812 04372022
         L     REG2,IEHMVV30            ADDRESS OF FROMDCB              04380000
         MVI   IOFLG(REG2),X'00'        RESET I O FLAGS                 04400000
         L     REG3,NOTELIST            POINTER TO NOTELIST BUFFER      04420000
         LH    REG5,BLKSIZE                                             04440000
         L     REGONE,IEHMVV30+4                                        04460000
         BAL   REG9,READ               READ A RECORD                    04480000
         CLI   IEHMVV74+4,X'FF'         I/O ERR IN U.L. EXIT RTN   UL0H 04484017
         BNE   POINTA                  NOT ON - CONTINUE           UL0H 04488017
         BAL   REG9,IOERRMSG            OUTPUT I/O ERR MSG         UL0H 04492017
POINTA   DS    0H                                                  UL0H 04496017
         L     REGONE,IEHMVV30+4                                        04500000
         BAL   REG9,CHECK              CHECK THE READ                   04520000
         BAL   REG9,GETLNGTH                                            04540000
* THIS ROUTINE ZEROES THE FIRST BIT OF EACH TTRX                 A52050 04545022
         LR    REGONE,REG8             SAVE THE NBR OF TTRX'S    A52050 04550022
         BAL   REG2,RESTNL             CLEAR THE HIGH ORDER BIT  A52050 04555022
         LR    REG8,REGONE             RESTORE                   A52050 04556022
         STC   REG8,TTRXPTR            SET THE COUNTER           A52050 04557022
         B     WCHREAD                                           A48812 04560022
*      READ NOTELIST INTO CORE IF THIS IS FIRST POINT FIND START OF     04580000
*    MEMBER  IF NOT FIRST POINT GO TO READNEXT RECORD                   04600000
*                                                                       04620000
*      READNEXT ADJUSTS THE TTR AND POINTS TO THE NEXT RECORD           04640000
READNEXT L     REGZERO,RDNOTE                                           04660000
         A     REGZERO,ADDTOR                                           04680000
         L     REGONE,IEHMVV30                                          04700000
         LA    1,0(0,1)                                                 04720000
         IC    REGZERO,ZERO                                             04740000
         ST    REGZERO,NXTPT                                            04760000
         LA    REGZERO,NXTPT                                            04780000
         POINT (1),(0)                                                  04800000
READREC  LH    REG5,BLKSIZE                                             04820000
         L     REGONE,IEHMVV30+4                                        04840000
         L     REG2,IEHMVV30            ADDRESS OF FROMDCB              04860000
         L     REG3,BUFFER                                              04880000
         BAL   REG9,READ               READ A RECORD                    04900000
         CLI   IEHMVV74+4,X'FF'         I/O ERR IN U.L. EXIT RTN   UL0H 04904017
         BNE   READRECA                NOT ON - CONTINUE           UL0H 04908017
         BAL   REG9,IOERRMSG            OUTPUT I/O ERR MSG         UL0H 04912017
READRECA DS    0H                                                  UL0H 04916017
         L     REGONE,IEHMVV30+4                                        04920000
         BAL   REG9,CHECK              CHECK THE READ                   04940000
         NOTE  (2)                                                      04960000
         ST    REGONE,RDNOTE                                            04980000
         BAL   REG9,GETLNGTH                                            05000000
         L     REG2,IEHMVV31            ADDRESS OF TO DCB      @ZA31216 05002099
         L     REG4,IEHMVV30            ADDRESS OF FROM DCB    @ZA31216 05004099
         MVC   BLKSAVE(2),BLKS(REG2)    SAVE TO BLKSIZE        @ZA31216 05006099
         TM    17(REG4),X'20'           TEST FROM FOR DA       @ZA31216 05008099
         BZ    CHANGE1                  NOT DA                 @ZA31216 05010099
         SR    REG9,REG9                                       @ZA31216 05012099
         IC    REG9,KEYL(0,REG4)        FROM KEY LENGTH        @ZA31216 05014099
         SR    REG5,REG9                DATA LENGTH            @ZA31216 05016099
CHANGE1  STH   REG5,BLKS(0,REG2)        CHANGE DCB BLKSIZE     @ZA31216 05018099
*      THIS ROUTINE COMPARES THE TTR RETURNED BY NOTE TO THE TTRS IN    05020000
*    THE DIRECTORY ENTRY AND THE TTR IN THE NOTELIST IF AN EQUAL        05040000
*    CONDITION IS FOUND UPDATE TTR WITH THE TTR RETURNED FROM NOTE      05060000
*    AFTER WRITE                                                        05080000
*                                                                       05100000
CMPTTRS  DS    0H                                                A48812 05110022
         CLC   RDNOTE(3),TTR1                                    A48812 05340022
         BE    *+8                                                      05360000
         B     CMP3                                                     05380000
         SR    REG7,REG7                                                05400000
         IC    REG7,N1                                                  05420000
         BAL   REG9,WRTEST1                                             05440000
         MVC   TTRN1(3),WRNOTE          UPDATE TTRN IN DIRECTORY        05460000
         MVC   TTR1(4),ZERO             SET UPDATED COMPARE AREA TO     05480000
CMP3     CLC   RDNOTE(3),TTR2                                           05500000
         BE    *+8                                                      05520000
         B     CMP4                                                     05540000
         SR    REG7,REG7                                                05560000
         IC    REG7,N2                                                  05580000
         BAL   REG9,WRTEST1                                             05600000
         MVC   TTRN2(3),WRNOTE                                          05620000
         MVC   TTR2(4),ZERO                                             05640000
CMP4     CLC   RDNOTE(3),TTR3                                           05660000
         BE    *+8                                                      05680000
         B     CMPDONE                                                  05700000
         SR    REG7,REG7                                                05720000
         IC    REG7,N3                                                  05740000
         BAL   REG9,WRTEST1                                             05760000
         MVC   TTRN3(3),WRNOTE                                          05780000
         MVC   TTR3(4),ZERO                                             05800000
CMPDONE  BAL   REG9,WNTEST                                              05820000
         NI    TESTSW,X'10'                                             05840000
         TM    TESTSW,X'10'            NOTELIST WRITTEN          A48812 05860022
         BO    POINTER                 YES LOOK FOR ANOTHER      A48812 05862022
         SR    REG7,REG7               CLEAR FOR INSERT          A48812 05872022
         IC    REG7,TTRXPTR            NBR OF TTRX'S TO CHECK    A48812 05874022
         LTR   REG7,REG7               ALL TTRX'S UPDATED        A48812 05876022
         BZ    READREC                 YES CONTINUE              A48812 05878022
         LR    REG2,REG7               SAVE THE NBR              A48812 05880022
         L     REG9,TTRXPTR            START OF NOTE LIST        A48812 05882022
NLTTRA   DS    0H                                                A48812 05884022
         TM    0(REG9),X'80'           TTRX FLAGGED              A48812 05886022
         BO    NLTTRD                  YES CHECK NEXT ONE        A48812 05888022
         CLI   2(REG9),X'00'           ZERO TTRX                 A48812 05890022
         BE    NLTTRB                  YES FLAG THIS ONE         A48812 05892022
         CLC   0(3,REG9),RDNOTE        EQUAL TTR'S               A48812 05894022
         BNE   NLTTRC                  NO GO TO NEXT ONE         A48812 05896022
         MVC   0(3,REG9),WRNOTE        YES UPDATE THE TTR        A48812 05898022
NLTTRB   DS    0H                                                A48812 05900022
         OI    0(REG9),X'80'           FLAG THIS TTR             A48812 05902022
         BCT   REG7,NLTTRC             NEXT ONE  IF ANY          A48812 05904022
         BAL   REG2,RESTNL             RESTORE THE NL            A48812 05906022
NLTTRE   DS    0H                                                A48812 05908022
         B     READREC                 CONTINUE                  A48812 05910022
NLTTRC   DS    0H                                                A48812 05912022
         BCT   REG2,NLTTRD             GO TO NEXT TTRX           A48812 05914022
         STC   REG7,TTRXPTR            STORE NEW NL COUNT        A48812 05914422
         B     READREC                 CONTINUE                  A48812 05914822
NLTTRD   DS    0H                                                A48812 05918022
         LA    REG9,4(REG9)            JUMP TO NEXT TTR          A48812 05920022
         B     NLTTRA                                            A48812 05922022
*                                                                       05932022
*            THIS ROUTINE CHECKS TO SEE IF RECORD HAS BEEN WRITTEN      05950022
*               DECIDES WHETHER TO WRITE THE BUFFER OR THE UPDATED      05952022
*               NOTELIST  GO TO UPDATE ROUTINE                          05960000
*                                                                       05980000
WNTEST   TM    TESTSW,X'01'                                             06000000
         BC    1,GOBACK                                                 06020000
         OI    TESTSW,X'01'                                             06040000
         L     REG3,BUFFER                                              06060000
WRTREC   L     REG2,IEHMVV31            ADDRESS OF  TODCB               06080000
         L     REGONE,IEHMVV31+4                                        06100000
         ST    REG9,NINSAV            SAVE RETURN ADDR                  06120000
         BAL   REG9,WRITE              WRITE A RECORD                   06140000
         L     REGONE,IEHMVV31+4                                        06160000
         LA    1,0(0,1)                                                 06180000
         CHECK  (1)                                                     06200000
         L     REG9,NINSAV             LOAD SAVED ADDR                  06220000
         L     REGONE,IEHMVV31         ADDRESS OF TODCB                 06240099
         MVC   BLKS(2,REGONE),BLKSAVE  RESTORE TO BLKSIZE      @ZA31216 06246099
         LA    1,0(0,1)                                                 06260000
         NOTE  (1)                                                      06280000
         ST    REGONE,WRNOTE                                            06300000
SETTEST  OI    TESTSW,X'01'                                             06320000
GOBACK   BR    REG9                                                     06340000
*                                                                       06360000
*                                                                       06380000
WRTEST1  LTR   REG7,REG7                                                06400000
         BE    WNTEST                                                   06420000
         OI    TESTSW,X'10'                                             06440000
         CLI   TTRXPTR,X'00'           NOTELIST UPDATED          A48812 06450022
         BE    WRNLIST1                YES CONTINUE              A48812 06452022
         ST    REG9,NINSAV             SAVE RETURN ADDRESS       A48812 06452422
         BAL   REG2,RESTNL             RESTORE NL BEFORE WRITE   A48812 06454022
         B     BADNOTE                 ISSUE WARNING             A48812 06456022
WRNLIST  DS    0H                                                A48812 06458022
         L     REG9,NINSAV             RESTORE RETURN ADDRESS    A48812 06458422
WRNLIST1 DS    0H                                                A48812 06458822
         L     REG3,NOTELIST                                            06460000
         B     WRTREC                                                   06480000
*      THIS ROUTINE WILL STOW AN ALIAS MEMBER INTO THE NEW PDS  AFTER   06500000
*    UPDATING THE TTRS PRESENT                                          06520000
STALRTN  TM    STOWBIT,X'01'                                            06540000
         BC    1,NOSTALIS                                               06560000
         MVC   TTR(3),TTRSAVE                                           06580000
         TM    C,THREENL                                                06600000
         BC    1,SWAP3                                                  06620000
         TM    C,TWONL                                                  06640000
         BC    1,SWAP2                                                  06660000
         TM    C,ONENL                                                  06680000
         BC    1,SWAP1                                                  06700000
         B     NOSWAP                                                   06720000
SWAP3    MVC   TTRN3(4),SAVTTR3                                         06740000
SWAP2    MVC   TTRN2(4),SAVTTR2                                         06760000
SWAP1    MVC   TTRN1(4),SAVTTR1                                         06780000
NOSWAP   B     STOWMBR                                                  06800000
*              THIS ROUTINE CALCULATES THE LENGTH OF THE RECORD         06820000
*               READ A PLACES LENGT IN REGISTER 5 TO BE USED BY         06840000
*               WRITE                                                   06860000
*                                                                       06880000
GETLNGTH SR    REG5,REG5                                                06900000
         L     REG2,IEHMVV30            ADDRESS OF FROMDCB              06920000
         IC    REG5,KEYL(0,REG2)        INSERT KEY LENGTH FROM DCB      06940000
NOKEYLN  AH    REG5,BLKS(0,REG2)  ADD BLKSIZE FROM DCB             8696 06960013
         L     REG4,IEHMVV30+4         ADDRESS OF DECB                  06980000
         L     REG4,IOBAD(0,REG4)       LOAD ADDR OF IOB                07000000
         SH    REG5,CSWCT(0,REG4)       SUBT COUNT FROM CSW             07020000
         BR    REG9                                                     07040000
*  THIS ROUTINE RESTORES THE NOTELIST BEFORE                     A48812 07040422
*  IT IS WRITTEN                                                 A48812 07040822
* IT IS ALSO INVOKED TO ZERO THE HIGH ORDER BIT OF               A52050 07041822
* EACH TTRX BEFORE PROCESSING                                    A52050 07041922
RESTNL   DS    0H                                                A48812 07042022
         L     REG9,TTRXPTR            START OF NOTELIST         A48812 07044422
NLTTRG   NI    0(REG9),X'7F'           UNFLAG THE TTR            A48812 07046022
         LA    REG9,4(REG9)            JUMP TO NEXT TTR          A48812 07048022
         BCT   REG8,NLTTRG             IF ANY                    A48812 07050022
         STC   REG8,TTRXPTR            INDIC NL CHECKED          A48812 07052022
         BR    REG2                    RETURN TO CALLER          A48812 07054022
*      THIS ROUTINE WILL STOW MEMBER IN DIRECTORY OF NEW PDS            07060000
*                                                                       07080000
STOWMBRF L     REGONE,NOTELIST     LOAD NOTELIST BUFFER ADDRESS. A31964 07085020
         LTR   REGONE,REGONE       DOES MEMBER HAVE NOTELIST ?   A31964 07090020
         BZ    FREBUF              NO.                           A31964 07095020
         SR    REGZERO,REGZERO                                   A31964 07099020
FRENOTE  L     REGONE,NOTELIST     LOAD NOTELIST BUFFER ADDR.    A31964 07190020
         L     REGZERO,NOTE        LENGTH OF NOTELIST BUFFER.    A31964 07199020
         FREEMAIN   R,LV=(0),A=(1)                               A31964 07208020
         SR    REG2,REG2                                         A31964 07214020
         ST    REG2,NOTE           ZERO NOTELIST BUFFER ADDR     A31964 07220020
         ST    REG2,NOTELIST          AND LENGTH.                A31964 07226020
*   CHECK TO SEE IF ALL USER TTRNS HAVE BEEN UPDATED.            A31964 07232020
FREBUF   CLC   TTR1(4),ZERO        HAS FIRST TTRN BEEN UPDATED ? A31964 07237020
         BNE   BADTTRN             NO--PRINT MESSAGE.            A31964 07242020
         CLC   TTR2(4),ZERO        HAS SECOND BEEN UPDATED ?     A31964 07247020
         BNE   BADTTRN             NO                            A31964 07252020
         CLC   TTR3(4),ZERO        HAS THIRD BEEN UPDATED ?      A31964 07257020
         BNE   BADTTRN             NO                            A31964 07262020
FREBUF1  L     REGZERO,BUFF                                      A31964 07267020
         L     REGONE,BUFFER                                     A31964 07272020
         FREEMAIN   R,LV=(0),A=(1)                               A31964 07277020
         SR    REG2,REG2                                         A31964 07282020
         ST    REG2,BUFF                                         A31964 07287020
         ST    REG2,BUFFER                                       A31964 07292020
         B     STOWMBR             STOW THIS MEMBER              A31964 07297020
*   A TTR WITHIN THE NOTELIST HAS NOT BEEN UPDATED.  PRINT       A31964 07302020
*       MESSAGE.  THEN STOW MEMBER.                              A31964 07307020
BADNOTE  L     REG3,A129           GET ADDR OF IEH328I.          A31964 07312020
         IC    REG2,A129           LENGTH MINUS ONE OF IEH328I.  A31964 07317020
         BAL   REG8,CLEAR          HAVE BLANKS PUT IN BUFFER.    A31964 07322020
         EX    REG2,MOVER          MOVE MESSAGE TO BUFFER.       A31964 07327020
         BAL   REG9,MESSAG02       HAVE MESSAGE PRINTED.         A31964 07332020
         B     WRNLIST                 RETURN TO WRITE THE NL    A48812 07334022
*   A TTRN IN THE USER DATA FIELD OF THE DIRECTORY HAS NOT BEEN  A31964 07342020
*       UPDATED.  PRINT MESSAGE.  THEN STOW MEMBER               A31964 07347020
BADTTRN  L     REG3,A128           GET ADDR OF IEH327I.          A31964 07352020
         IC    REG2,A128           LENGTH MINUS ONE OF MESSAGE.  A31964 07357020
         BAL   REG8,CLEAR          HAVE BLANKS PUT IN BUFFER.    A31964 07362020
         EX    REG2,MOVER          MOVE MESSAGE TO BUFFER.       A31964 07367020
         BAL   REG9,MESSAG02       HAVE MESSAGE PRINTED.         A31964 07372020
         B     FREBUF1                                           A31964 07381020
STOWMBR  LA    REGZERO,DIRENTRY                                  A31964 07390020
         MVC   DIRENTRY(8),RENAME      MOVE MEMBER NAME FOR STOW        07420000
         L     REGONE,IEHMVV31          ADDRESS OF TODCB                07440000
         LA    1,0(0,1)                                                 07460000
         STOW  (1),(0),A                                                07480000
         MVC   TTRSAVE(16),TTR         SAVE  TTRS FROM REAL MEMBER      07500000
         B     GO(15)                                                   07520000
GO       B     GETMBR01                                                 07540000
         B     DUPLCTE                                                  07560000
         EX    0,*                                                      07580000
         B     DIRFULL                                                  07600000
         B     STOERR                                                   07620000
******************************************************************21919 07621000
*                                                                *21919 07622000
*   NEXT RETURN CODES ALSO GIVE THE MESSAGE:                     *21919 07623000
*         IEH326I I/O ERROR ENCOUNTERED IN OUTPUT DATA SET       *21919 07624000
*   BUT THESE RETURN CODES ARE CAUSED BY OTHER ERRORS            *21919 07625000
*                                                                *21919 07626000
******************************************************************21919 07627000
         B     STOERR        INDICATES I/O REQUESTS AGAINST THE   21919 07628000
*                            DCB ARE STILL OUTSTANDING            21919 07629000
         B     STOERR        INDICATES THE DCB IS NOT OPEN        21919 07630000
         B     STOERR        INDICATES CONDITIONAL GETMAIN WITHIN 21919 07631000
*                            STOW WAS UNSUCCESSFUL                21919 07632000
*                                                                       07640000
*                                                                       07660000
*                                                                       07680000
WCHREAD  TM    PNTSW,X'01'                                              07700000
         BC    1,READNEXT                                               07720000
*                             POINT TO FIRST RECORD IN MEMBER AND SET   07740000
*                               PNTSW  ON AFTER POINT                   07760000
         L     REGONE,IEHMVV30                                          07780000
         LA    1,0(0,1)                                                 07800000
         MVI   IOFLG(REGONE),X'00'      RESET I/O FLAGS IN DCB          07820000
         L     REG2,IEHMVV31                                            07840000
         MVI   IOFLG(REG2),X'00'        RESET I/O FLAGS IN DCB          07860000
         MVC   NXTPT(3),TTR             PICK UP TTR FROM DIRECTORY      07880000
*                                        RECORD OF THE MEMBER TO BE     07900000
*                                        USED BY NEXT READ              07920000
         LA    REGZERO,NXTPT            LOAD ADDR OF TTR                07940000
         POINT (1),(0)                                                  07960000
         OI    PNTSW,X'01'                                              07980000
         B     READREC                                                  08000000
*                                                                       08020000
*      THIS ROUTINE PRINT OUT A MESSAGE TO OPERATOR                     08220000
MESSAGE  BAL   REG8,CLEAR                                               08240000
         LR    REGONE,BASE12            ADDRESS OF PRINT BUFFER         08260000
         EX    2,MOVER                                                  08280000
         MVC   NAMES(8),DIRENTRY                                        08300000
         B     MESSAG02                                                 08320000
MESSAG01 BAL   REG8,CLEAR                                               08340000
         LR    REGONE,BASE12            ADDRESS OF PRINT BUFFER         08360000
         EX    2,MOVER                                                  08380000
         MVC   NAMES01(8),DIRENTRY                                      08400000
         B     MESSAG02                                                 08420000
MESSAG03 BAL   REG8,CLEAR                                               08440000
         LR    REGONE,BASE12            ADDRESS OF PRINT BUFFER         08460000
         EX    2,MOVER                                                  08480000
         MVC   NAMES03(44),0(4)                                         08500000
         B     MESSAG02                                                 08520000
MESSAG02 LR    REG3,REGONE                                              08540000
         LINK  EP=IEHMVESU                                              08560000
         LTR   15,15                    IS RETURN CODE ZERO             08580000
         BP    PRMABORT                 NO                              08600000
         BR    REG9                                                     08620000
MOVER    MVC   MSG(1),0(3)                                              08640000
CLEAR    LR    REGONE,BASE12            ADDRESS OF PRINT BUFFER         08660000
         MVI   0(1),X'40'                                               08680000
         MVC   1(120,1),0(1)                                            08700000
         SR    0,0                                                      08720000
         BR    8                                                        08740000
*                                                                       08760000
*                                                                       08780000
DUPLCTE  TM    C,BIT0                                                   08800000
         BO    DUP01                                                    08820000
         OI    STOWBIT,X'01'       SET STOWBIT TO RECOVER SPACE         08840000
         MVC   TTRSAV(3),TTR                                            08860000
DUP01    L     REG3,A119           SET UP TO PRINT MESSAGE              08880000
         IC    REG2,A119                                                08900000
         BAL   REG9,MESSAGE                                             08920000
         B     GETMBR02                                                 08940000
DIRFULL  L     REG3,A121                                                08960000
         IC    REG2,A121                                                08980000
         BAL   REG9,MESSAGE                                             09000000
         B     ABORT                                                    09020000
STOERR   L     REG3,A124                                                09040000
         IC    REG2,A124                                                09060000
         L     REG4,IEHMVV21+4                                          09080000
         BAL   REG9,MESSAG03                                            09100000
         B     ABORT                                                    09120000
*                                                                       09140000
WRKFLE   L     REG3,A120                                                09160000
         IC    REG2,A120                                                09180000
         BAL   REG8,CLEAR                                               09200000
         LR    REGONE,BASE12            ADDRESS OF PRINT BUFFER         09220000
         EX    2,MOVER                                                  09240000
         BAL   REG9,MESSAG02                                            09260000
         B     ABORT                                                    09280000
REAERR   L     REG3,IEHMVV30+8                                   A26560 09285019
         TM    ORG(REG3),X'02'         IS THIS A PDS             A26560 09290019
         BZ    RDSEQ                   NO -- ISSUE SEQ MSG       A26560 09295019
*                                                                       09300000
         L     REG3,A122                                         A26560 09320019
         IC    REG2,A122                                                09340000
         L     REG4,IEHMVV21                                            09360000
         BAL   REG9,MESSAG01                                            09380000
         B     ABORT                                                    09400000
RDSEQ    L     REG3,A127                                         A26560 09401019
         IC    REG2,A127                                         A26560 09402019
         L     REG4,IEHMVV21                                     A26560 09403019
         BAL   REG8,CLEAR              SEQ I/O ERROR ON READ     A26560 09404019
         LR    REGONE,BASE12                                     A26560 09405019
         EX    2,MOVER                                           A26560 09406019
         BAL   REG9,MESSAG02                                     A26560 09407019
         B     ABORT                                                    09408019
WRTERR   L     REG3,IEHMVV30+8                                   A26560 09409019
         TM    ORG(REG3),X'02'         IS THIS A PDS             A26560 09410019
         BZ    WTSEQ                   NO -- ISSUE SEQ MESSAGE   A26560 09411019
*                                                                       09420000
*                                                                       09440000
         L     REG3,A123                                         A26560 09460019
         IC    REG2,A123                                                09480000
         L     REG4,IEHMVV21+4                                          09500000
         BAL   REG9,MESSAG01                                            09520000
         B     ABORT                                                    09540000
WTSEQ    L     REG3,A124                                         A26560 09543019
         IC    REG2,A124                                         A26560 09546019
         L     REG4,IEHMVV21+4                                   A26560 09549019
         BAL   REG9,MESSAG03           SEQ I/O ERROR ON WRITE    A26560 09552019
         B     ABORT                                             A26560 09555019
NOSTALIS L     REG3,A125                                                09560000
         IC    REG2,A125                                                09580000
         BAL   REG9,MESSAGE                                             09600000
         B     GETMBR02                                                 09620000
READ     LA    1,0(0,1)                                                 09640000
         LA    2,0(0,2)                                                 09660000
         READ  (1),SF,(2),(3),(5),MF=E                                  09680000
         BR    REG9                                                     09700000
CHECK    LA    1,0(0,1)                                                 09720000
         CHECK (1)                                                      09740000
         BR    REG9                                                     09760000
WRITE    LA    1,0(0,1)                                                 09780000
         LA    2,0(0,2)                                                 09800000
         TM    STOWBIT,X'01'                                            09820000
         BC    1,RCOVR                                                  09840000
WRIT02   WRITE (1),SF,(2),(3),(5),MF=E                                  09860000
         BR    REG9                                                     09880000
BSAMRTN  MVC   EODAD(3,REG2),BSEXIT+1                                   09900000
         TM    IEHMVV30+4,X'80'        IS BUUFER PRESENT                09920000
         BC    8,GBSBF                 NO, GET BSAM BUFFER              09940000
         L     REG7,IEHMVV30+4         DECB ADDRESS                     09960000
         L     REG6,12(0,REG7)         ADDRESS OF BUFFER                09980000
         ST    REG6,BUFFER                                              10000000
         L     REG2,IEHMVV30           SET UP TO FREE MAIN WHICH        10020000
         LH    REG3,BLKS(0,REG2)       WAS PASSED TO IEHMVSTJ           10040000
         ST    REG3,BUFF                                                10060000
         B     WRIT01                                                   10080000
ABORT    B     PRMABORT                                                 10100000
RCOVR    NI    STOWBIT,X'00'                                            10120000
         MVC   NXTPT(3),TTRSAV                                          10140000
         MVC   0(3,REG2),TTRSAV        SET RELAD FIELD IN DCB      9312 10160000
         LA    REGZERO,NXTPT                                            10180000
         L     REGONE,IEHMVV31                                          10200000
         LA    1,0(0,1)                                                 10220000
         POINT (1),(0)                                                  10240000
         L     REGONE,IEHMVV31+4       GET ADDR OF DECB                 10260000
         B     WRIT02                                                   10280000
PRMABORT L     2,IEHMVV20                                               10300000
         O     REG2,ABORTBIT                                            10320000
         ST    REG2,IEHMVV20                                            10340000
         OI    IEHMVV41+13,X'02'       SET RETURNCODE TO 8       A37903 10350021
BSEODAD  B     FINISHED                                                 10360000
INVALID  EX    0,*                                                      10380000
FINISHED L     REG2,IEHMVV30                                            10400000
         TM    DSORG(REG2),X'40'       IS THIS A BSAM DATASET           10420000
         BC    1,FRMAIN01              YES, FREE BUFFER                 10440000
         B     FRMAIN                  WAS A PDS                        10460000
SINAD    ST    REGONE,ERRSAV           STORE ERROR CODE                 10480000
         TM    ERRSAV,X'80'                                             10500000
         BC    1,REAERR                                                 10520000
         TM    ERRSAV,X'40'                                             10540000
         BC    1,WRTERR                                                 10560000
         TM    ERRSAV,X'20'                                             10580000
         BC    1,ABORT                                                  10600000
         B     INVALID                                                  10620000
FRMAIN   L     REGONE,NOTELIST                                          10640000
         LTR   1,1                                                      10660000
         BZ    FRMAIN01                                                 10680000
         L     REGZERO,NOTE                                             10700000
         FREEMAIN  R,LV=(0),A=(1)                                       10720000
FRMAIN01 L     REGONE,BUFFER                                            10740000
         LTR   1,1                                                      10760000
         BZ    FRMAIN02                                                 10780000
         L     REGZERO,BUFF                                             10800000
         FREEMAIN  R,LV=(0),A=(1)                                       10820000
FRMAIN02 TM    IEHMVV20+2,X'40'        IS MIDABORT BIT ON               10840000
         BO    WRAPITUP                YES                              10860000
         TM    IEHMVV20,X'08'                                           10880000
         BZ    WRAPITUP                                                 10900000
         TM    IEHMVV20+2,X'08'        IS INC REP BIT ON                10920000
         BO    INCLUDE                                                  10940000
WRAPITUP  IEHPOST  (14,1),T                                             10960000
         XCTL  (2,12),EP=IEHMVESN                                       10980000
INCLUDE  TM    IEHMVV20,X'10'          DSGROUP OPERATION           VS0H 10981017
         BC    1,WRAPITUP              YES, TO VESN FOR WRAPUP     VS0H 10982017
         IEHPOST  (14,1),T                                         VS0H 10983017
         XCTL  (2,12),EP=IEHMVETG                                       10986017
XXITLE   DC    X'03'                                               VS0H 10989017
         DC    AL3(ITLR)                                           VS0H 10992017
*                                                                  VS0H 10995017
*    USER  INPUT  TRAILER  LABEL  ROUTINE                          VS0H 10998017
*                                                                  VS0H 11001017
ITLR     DS    0H                                                  VS0H 11004017
OFFSET1  EQU   ITLR-IEHMVETJ                                       VS0H 11007017
         LA    REG6,OFFSET1                                        VS0H 11010017
         SR    REG15,REG6                                          VS0H 11013017
         LR    BASE10,REG15                                        VS0H 11016017
         L     REG6,0(REGONE)          GET ADDR OF LABEL BUFFER    UL0H 11016317
         LTR   REG6,REG6               ANY LABELS TO PROCESS       UL0H 11016617
         BNZ   IOERR                   YES, GO CHK 1ST FOR ERRORS  UL0H 11016917
NOLABEL  DS    0H                                                  UL0H 11017217
         MVI   UDCBITLE,X'00'          DEACTIVATE INPUT, OUTPUT    UL0H 11017517
         MVI   UDCBOTLE,X'00'          TRLR LABEL EXITS IN DCB     UL0H 11017817
         SR    REG15,REG15             NO LABELS, RETURN CODE ZERO UL0H 11018117
         BR    RETREG                  TO EOV TO END PROCESSING    UL0H 11018417
*                                                                  UL0H 11018717
IOERR    DS    0H                                                  UL0H 11019017
         TM    8(REGONE),X'80'         I/O ERROR FLG ON IN PARMS   UL0H 11019317
         BZ    TRKAVAIL                 NO, CHK FOR U.L. TRK AVAIL UL0H 11019917
LABERR   DS    0H                                                  UL0H 11020517
         OI    IEHMVV74+4,X'FF'         YES, SET FLAG TO OUTPUT    UL0H 11021117
*                                        MSG AFTER OPEN/CLOSE/EOV  UL0H 11021717
         L     REG2,IEHMVV20           TURN ON                  PTM2433 11021818
         O     REG2,ABORTBIT              MID - ABORT           PTM2433 11021918
         ST    REG2,IEHMVV20                  SWITCH            PTM2433 11022018
         B     ABORT                   GO SET ABORT FLAG (VV20+2)  UL0H 11022317
*                                                                  UL0H 11022617
TRKAVAIL DS    0H                                                  UL0H 11022917
         CLI   IEHMVV72+10,X'FF'       DA+NLT FLAG ON              UL0H 11023217
         BNE   CORAVAIL                NO, HAVE TRK, CHK FOR CORE  UL0H 11023517
*                                                                  UL0H 11023817
*  VESN WILL OUTPUT MESSAGE NO USER LBLS MOVED/COPIED. NO U.L. TRK UL0H 11024117
*                                                                  UL0H 11024417
         MVI   IEHMVV72+14,X'FF'       TELL VESN TO PUT OUT MSG    UL0H 11024717
         B     NOLABEL                 RETURN TO EOV               UL0H 11025017
*                                                                  UL0H 11025317
CORAVAIL DS    0H                                                  UL0H 11025617
         CLC   IEHMVV72(4),ALLZEROS    CORE GOTTEN FOR LABELS      UL0H 11025917
         BNE   INITIAL                 YES, INITIALIZE POINTERS    UL0H 11026217
         GETMAIN  R,LV=640             NO, GET CORE NEEDED         UL0H 11026517
         ST    REGONE,IEHMVV72         SAVE GOTTEN CORE ADDRESS    UL0H 11026817
INITIAL  DS    0H                                                  UL0H 11027117
         CLC   0(4,REG6),UTL1DEF       FIRST LABEL IN GROUP        UL0H 11027417
         BNE   SAVLABEL                NO, GO AROUND SET UP        UL0H 11027717
         MVC   IEHMVV72+4,IEHMVV72     NO, SET PTR TO LBL SAVEAREA UL0H 11028017
         MVI   IEHMVV72+12,X'00'       CLEAR LABEL COUNTER         UL0H 11028317
*                                                                  UL0H 11028617
SAVLABEL DS    0H                                                  UL0H 11028917
         L     REGONE,IEHMVV72+4       GET ADDR OF CURRENT         UL0H 11029217
*                                      LABEL SAVE AREA             UL0H 11029517
         MVC   0(80,REGONE),0(REG6)    SAVE LABEL IN GOTTEN CORE   UL0H 11029817
         LA    REGONE,80(REGONE)       UP PTR TO NEXT LOCATION     UL0H 11030117
         ST    REGONE,IEHMVV72+4       IN LBL SAVEAREA, SAVE PTR   UL0H 11030417
         SR    REG6,REG6                                           UL0H 11030717
         IC    REG6,IEHMVV72+12        UPDATE LABEL                UL0H 11031017
         LA    REG6,1(REG6)                 COUNTER                UL0H 11031317
         STC   REG6,IEHMVV72+12                  BY ONE, AND SAVE  UL0H 11031617
         LA    REG15,4                 RETURN CODE OF 4 TO EOV TO  UL0H 11031917
*                                      GET ADDITIONAL LABELS       UL0H 11032217
         BR    RETREG                  RETURN TO EOV               UL0H 11032517
*                                                                  UL0H 11032817
ALLZEROS DC    F'0'                                                UL0H 11033117
UTL1DEF  DC    CL4'UTL1'                                           UL0H 11033417
DEACTIVE EQU   X'00'                                               UL0H 11033717
SAVE14   DS    F                                                   UL0H 11034017
*                                                                  UL0H 11034317
*                                                                       11034717
IOERRMSG DS    0H                                                  UL0H 11035117
         NI    IEHMVV74+4,X'00'         CLEAR I/O ERROR FLAG       UL0H 11035517
         ST    RETREG,SAVE14            SAVE EOV RETURN ADDRESS    UL0H 11035917
         L     REG3,A126                GET ADDRESS OF MESSAGE     UL0H 11036317
         IC    REG2,A126                GET LENGTH OF MESSAGE      UL0H 11036717
         BAL   REG8,CLEAR               BLANK OUT MESSAGE BUFFER   UL0H 11037117
         LR    REGONE,BASE12            GET ADDR OF BUFFER FOR PRT UL0H 11037517
         EX    2,MOVER                  MOVE MESSAGE TO BUFFER      L0H 11037917
         BAL   REG9,MESSAG02            GO TO MESSAGE WRITER       UL0H 11038317
         B     ABORT                    GO SET ABORT FLAG (VV20+2) UL0H 11038717
BLKSAVE  DC    X'0000'                                                  11040000
         DS    0F                                                       11060000
ZERO     DC    F'0'                                                     11080000
ENDNOTE  DC    X'FFFF0000'                                              11100000
ABORTBIT DC    X'00004000'                                              11120000
ADDTOR   DC    X'00000100'                                              11140000
MASK     DC    X'FFFFFFF8'                                              11160000
PDSOUT   DC    A(STOWMBRF)                                              11200000
BSEXIT   DC    A(BSEODAD)                                               11220000
         DS    0F                                                       11240000
A118     DC    AL1(M119-M118-1)                                         11260000
         DC    AL3(M118)                                                11280000
A119     DC    AL1(M120-M119-1)                                         11300000
         DC    AL3(M119)                                                11320000
A120     DC    AL1(M121-M120-1)                                         11340000
         DC    AL3(M120)                                                11360000
A121     DC    AL1(M122-M121-1)                                         11380000
         DC    AL3(M121)                                                11400000
A122     DC    AL1(M123-M122-1)                                         11420000
         DC    AL3(M122)                                                11440000
A123     DC    AL1(M124-M123-1)                                         11460000
         DC    AL3(M123)                                                11480000
A124     DC    AL1(M125-M124-1)                                         11500000
         DC    AL3(M124)                                                11520000
A125     DC    AL1(M126-M125-1)                                    UL0H 11540017
         DC    AL3(M125)                                                11560000
A126     DC    AL1(M127-M126-1)                                  A26560 11566019
         DC    AL3(M126)                                           UL0H 11572017
A127     DC    AL1(M128-M127-1)                                  A31964 11573020
         DC    AL3(M127)                                         A31964 11574020
A128     DC    AL1(M129-M128-1)                                  A31964 11575020
         DC    AL3(M128)                                         A31964 11576020
A129     DC    AL1(M130-M129-1)                                  A31964 11577020
         DC    AL3(M129)                                         A31964 11578020
A130     DC    AL1(M131-M130-1)                                         11580000
         DC    AL3(M130)                                                11600000
A131     DC    AL1(M132-M131-1)                                         11620000
         DC    AL3(M131)                                                11640000
ERREXT   DC    AL3(SINAD)                                               11660000
REGZERO  EQU   0                                                        11680000
REGONE   EQU   1                                                        11700000
REG2     EQU   2                                                        11720000
REG3     EQU   3                                                        11740000
REG4     EQU   4                                                        11760000
REG5     EQU   5                                                        11780000
REG6     EQU   6                                                        11800000
REG7     EQU   7                                                        11820000
REG8     EQU   8                                                        11840000
REG9     EQU   9                                                        11860000
BASE10   EQU   10                                                       11880000
BASE11   EQU   11                                                       11900000
BASE12   EQU   12                                                       11920000
BASE13   EQU   13                                                       11940000
RETREG   EQU   14                                                       11960000
REG15    EQU   15                                                       11980000
BIT0     EQU   X'80'                                                    12000000
ONENL    EQU   X'20'                                                    12020000
TWONL    EQU   X'40'                                                    12040000
THREENL  EQU   X'60'                                                    12060000
NONL     EQU   X'00'                                                    12080000
EODAD    EQU   33                                                       12100000
SYNAD    EQU   57                                                       12120000
BLKS     EQU   62                                                       12140000
KEYL     EQU   16                                                       12160000
DSORG    EQU   26                                                       12180000
ORG      EQU   82                                                A26560 12190019
IOFLG    EQU   44                                                       12200000
IOBAD    EQU   16                                                       12220000
CSWCT    EQU   14                                                       12240000
IEHGOTEN DSECT                                                          12260000
RDNOTE   DS    1F                                                       12280000
WRNOTE   DS    1F                                                       12300000
TTR1     DS    1F                                                       12320000
TTR2     DS    1F                                                       12340000
TTR3     DS    1F                                                       12360000
TTRNL    DS    1F                                                       12380000
STOWBIT  DS    CL2                                                      12400000
TESTSW   DS    CL1                                                      12420000
TESTSW1  DS    CL1                                                      12440000
TTRPT    DS    CL1                                                      12460000
PNTSW    DS    CL1                                                      12480000
DIRENTRY DS    0CL74                                                    12500000
NAME     DS    CL8                                                      12520000
TTR      DS    CL3                                                      12540000
C        DS    CL1                                                      12560000
TTRN1    DS    CL3                                                      12580000
N1       DS    CL1                                                      12600000
TTRN2    DS    CL3                                                      12620000
N2       DS    CL1                                                      12640000
TTRN3    DS    CL3                                                      12660000
N3       DS    CL1                                                      12680000
         DS    CL50                                                     12700000
RENAME   DS    CL8                                                      12720000
NOTE     DS    CL4                                                      12740000
BUFF     DS    CL4                                                      12760000
NOTELIST DS    CL4                                                      12780000
BUFFER   DS    CL4                                                      12800000
KEY      DS    CL1                                                      12820000
KEYLEN   DS    CL1                                                      12840000
BLKSIZE  DS    1H                                                       12860000
TTRSAVE  DS    CL4                                                      12880000
SAVTTR1  DS    CL4                                                      12900000
SAVTTR2  DS    CL4                                                      12920000
SAVTTR3  DS    CL4                                                      12940000
NXTPT    DS    CL4                                                      12960000
TTRSAV   DS    CL4                                                      12980000
ERRSAV   DC    F'0'                                                     13000000
NINSAV   DS    1F                                                       13020000
TTRXPTR  DS    1F                      START OF NOTELIST         A48812 13030022
         DS    1H                                               YA01221 13033002
BLDLIST  DS    CL18                                             YA01221 13036002
PRINTBUF DSECT                                                          13040000
CC       DS    CL1                                                      13060000
MSG      DS    CL15                                                     13080000
NAMES    DS    CL25                                                     13100000
NAMES01  DS    CL9                                                      13120000
NAMES03  DS    CL10                                                     13140000
NAMES02  DS    CL61                                                     13160000
        IEHMVV                                                          13180000
         ORG   IEHMVV70                                            UL0H 13186017
         IEHDCBXL                                                  UL0H 13192017
ORATOR   CSECT                                                          13200000
M118     DC    CL24'  MEMBER NAMED          '                           13220000
         DC    CL22'HAS BEEN MOVED/COPIED.'                             13240000
M119     DC    CL30'IEH319I MEMBER          NOT MO'                     13260000
         DC    CL30'VED/COPID. DUPLICATE NAME IN O'                     13280000
         DC    CL15'UTPUT DATA SET.'                                    13300000
M120     DC    CL8'IEH372I'                                             13320000
         DC    CL30'I/O ERROR ENCOUNTERED IN WORK '                     13340000
         DC    CL5'FILE.'                                               13360000
M121     DC    CL30'IEH321I MEMBER          NOT MO'                     13380000
         DC    CL30'VED/COPIED. OUTPUT DIRECTORY 1'                     13400000
         DC    CL7'S FULL.'                                             13420000
M122   DC    CL8'IEH322I'                                               13440000
       DC    CL30'I/O ERROR ENCOUNTERED IN MEMBE'                       13460000
         DC    CL29'R          OF INPUT DATA SET.'                      13480000
M123   DC    CL8'IEH323I'                                               13500000
       DC    CL30'I/O ERROR ENCOUNTERED IN MEMBE'                       13520000
         DC    CL30'R          OF OUTPUT DATA SET.'                     13540000
M124     DC    CL30'IEH326I I/O ERROR ENCOUNTERED '                     13560000
         DC    CL19'IN OUTPUT DATA SET '                                13580000
M125     DC    CL24'  MEMBER NAMED          '                           13600000
         DC    CL32'IS AN ALIAS AND HAS NOT BEEN STO'                   13620000
         DC    CL32'WED, TRUE MEMBER WAS NOT STOWED.'                   13640000
M126     DC    CL36'IEH333I PERM I/O ERROR WHILE READING'          UL0H 13645017
         DC    CL36' USER INPUT TRAILER LABELS. NO MORE '          UL0H 13650017
         DC    CL25'LABELS WILL BE PROCESSED.'                     UL0H 13655017
M127     DC    CL32'IEH339 I/O ERROR ENCOUNTERED IN'             A26560 13656019
         DC    CL16' INPUT DATA SET.'                            A26560 13657019
M128     DC    CL41'IEH327I A TTRN IN THE USER DATA FIELD OF '   A31964 13660020
         DC    CL35'THE DIRECTORY HAS NOT BEEN UPDATED '         A31964 13663020
M129     DC    CL38'IEH328I  A TTR IN THE NOTELIST RECORD '      A31964 13666020
         DC    CL21'HAS NOT BEEN UPDATED '                       A31964 13669020
M130     DC    X'00'                                             A31964 13672020
M131     DC    X'40'                                                    13680000
M132     DC    X'00'                                                    13700000
         END                                                            13720000
./  ADD  SSI=70810123,NAME=IEHMVMRY
*0052                                                              2695 00020017
*1550                                                              UL0H 00030017
IEHMVMRY CSECT                                                          00040000
*D010597,010600,024000                                         @YA02601 00041032
*A010594-010598,015184,023997                                   OY01172 00043016
*D010598                                                        OY01172 00046016
*010550                                                          A27312 00050019
*010560                                                          A35445 00055020
*010570                                                          A36065 00057021
*C010590                                                         A45147 00059021
*A010594,010598,015184,023996,023997                             A45147 00059421
*                                                              @G32DSFS 00059732
*                                                              @ZM45071 00059832
*                                                                       00059932
*        SU32 DELETIONS                                        @G32DSFS 00063732
*A010595,010635-010695,015194-015197,024040-024120             @G32DSFS 00067732
*                                                              @G32DSFS 00071732
         ENTRY IEH4DD                                                   00075732
         ENTRY MSGSTART                                                 00080000
         ENTRY NORMALM                                                  00100000
         ENTRY MSGHEAD                                                  00120000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00140000
*                                                                     * 00160000
*    THIS MESSAGE CSECT CONTAINS THE MESSAGE TEXT USED BY MODULES     * 00180000
*    IEHMVSSX, IEHMVSRY, IEHMVSTC COMPRISING LOAD MODULE IEHMVESV       00200000
*                                                                     * 00220000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00240000
MSGSTART DS    0H                                                       00260000
         DC    AL2(MSG1-MSGHEAD)                                        00280000
         DC    AL2(MSG2-MSG1-1)                                         00300000
         DC    AL2(MSG2-MSGHEAD)                                        00320000
         DC    AL2(MSG3-MSG2-1)                                         00340000
         DC    AL2(MSG3-MSGHEAD)                                        00360000
         DC    AL2(MSG4-MSG3-1)                                         00380000
         DC    AL2(MSG4-MSGHEAD)                                        00400000
         DC    AL2(MSG5-MSG4-1)                                         00420000
         DC    AL2(MSG5-MSGHEAD)                                        00440000
         DC    AL2(MSG6-MSG5-1)                                         00460000
         DC    AL2(MSG6-MSGHEAD)                                        00480000
         DC    AL2(MSG7-MSG6-1)                                         00500000
         DC    AL2(MSG7-MSGHEAD)                                        00520000
         DC    AL2(MSG8-MSG7-1)                                         00540000
         DC    AL2(MSG8-MSGHEAD)                                        00560000
         DC    AL2(MSG9-MSG8-1)                                         00580000
         DC    AL2(MSG9-MSGHEAD)                                        00600000
         DC    AL2(MSG10-MSG9-1)                                        00620000
         DC    AL2(MSG10-MSGHEAD)                                       00640000
         DC    AL2(MSG11-MSG10-1)                                       00660000
         DC    AL2(MSG11-MSGHEAD)                                       00680000
         DC    AL2(MSG12-MSG11-1)                                       00700000
         DC    AL2(MSG12-MSGHEAD)                                       00720000
         DC    AL2(MSG13-MSG12-1)                                       00740000
         DC    AL2(MSG13-MSGHEAD)                                       00760000
         DC    AL2(MSG14-MSG13-1)                                       00780000
         DC    AL2(MSG14-MSGHEAD)                                       00800000
         DC    AL2(MSG15-MSG14-1)                                       00820000
         DC    AL2(MSG15-MSGHEAD)                                       00840000
         DC    AL2(MSG16-MSG15-1)                                       00860000
         DC    AL2(MSG16-MSGHEAD)                                       00880000
         DC    AL2(MSG17-MSG16-1)                                       00900000
         DC    AL2(MSG17-MSGHEAD)                                       00920000
         DC    AL2(MSG18-MSG17-1)                                  7491 00940000
         DC    AL2(MSG18-MSGHEAD)                                  7491 00960000
         DC    AL2(MSG19-MSG18-1)                                  7491 00980000
         DC    AL2(MSG19-MSGHEAD)                                  7491 01000000
         DC    AL2(MSG20-MSG19-1)                                  7491 01020000
         DC    AL2(MSG20-MSGHEAD)                                  7491 01040000
         DC    AL2(MSG21-MSG20-1)                                  2695 01045017
         DC    AL2(MSG21-MSGHEAD)                                  2695 01050017
         DC    AL2(MSG22-MSG21-1)                                A27312 01052019
         DC    AL2(MSG22-MSGHEAD)                                A27312 01054019
         DC    AL2(MSG23-MSG22-1)                                A35445 01055020
         DC    AL2(MSG23-MSGHEAD)                                A35445 01056020
         DC    AL2(MSG24-MSG23-1)                                A36065 01057021
         DC    AL2(MSG24-MSGHEAD)                                A36065 01058021
         DC    AL2(MSG28-MSG24-1)                                A45147 01059021
         DC    AL2(MSG28-MSGHEAD)                                A45147 01059421
         DC    AL2(MSG30-MSG28-1)                              @G32DSFS 01059532
         DC    AL2(MSG30-MSGHEAD)                               OY01172 01060532
         DC    AL2(MSG32-MSG30-1)                              @YA02601 01061532
         DC    AL2(MSG32-MSGHEAD)                              @YA02601 01062532
         DC    AL2(MSG53-MSG32-1)                              @G32DSFS 01063532
         DC    AL2(MSG53-MSGHEAD)                              @G32DSFS 01064532
         DC    AL2(MSG54-MSG53-1)                              @G32DSFS 01065532
         DC    AL2(MSG54-MSGHEAD)                              @G32DSFS 01066532
         DC    AL2(MSG55-MSG54-1)                              @G32DSFS 01067532
         DC    AL2(MSG55-MSGHEAD)                              @G32DSFS 01068532
         DC    AL2(MSGN1-MSG55-1)                              @G32DSFS 01069532
*                                                                       01070532
*                                                                       01080000
         DS    0F                                                       01100000
IEH4DD   DC    CL2'01'                                                  01120000
         DC    CL2'02'                                                  01140000
         DC    CL2'03'                                                  01160000
         DC    CL2'04'                                                  01180000
         DC    CL2'05'                                                  01200000
         DC    CL2'06'                                                  01220000
         DC    CL2'07'                                                  01240000
         DC    CL2'08'                                                  01260000
         DC    CL2'09'                                                  01280000
         DC    CL2'10'                                                  01300000
         DC    CL2'11'                                                  01320000
         DC    CL2'12'                                                  01340000
         DC    CL2'13'                                                  01360000
         DC    CL2'14'                                                  01380000
         DC    CL2'15'                                                  01400000
         DC    CL2'16'                                                  01420000
         DC    CL2'17'                                                  01440000
         DC    CL2'18'                                                  01460000
         DC    CL2'19'                                                  01480000
         DC    CL2'20'                                                  01500000
         DC    CL2'21'                                             2695 01510017
         DC    CL2'22'                                           A27312 01515019
         DC    CL2'23'                                           A35445 01517020
         DC    CL2'24'                                           A36065 01518021
         DC    CL2'28'                                           A45147 01518421
         DC    CL2'30'                                          OY01172 01519216
         DC    CL2'32'                                         @YA02601 01519332
         DC    CL2'53'                                         @G32DSFS 01519432
         DC    CL2'54'                                         @G32DSFS 01519532
         DC    CL2'55'                                         @G32DSFS 01519732
*                                                                       01520000
*                                                                       01540000
         DS    0F                                                       01560000
NORMALM  EQU   *-4                     POINTERS TO NORMAL MESSAGES      01580000
         DC    A(MSGN1)                CODE=1                           01600000
         DC    A(MSGN2)                CODE=3                           01620000
         DC    A(MSGN3)                CODE=5                           01640000
         DC    A(MSGN4)                CODE=7                      UL0H 01650017
MSGHEAD  DC    C'DATA SET'             ALL MESSAGES FROM THE MOVE/COPY  01660000
*                                      SINGLE DATA SET MODULE START     01680000
*                                      WITH THE MSGHEAD AND ARE THEN    01700000
*                                      FOLLOWED BY THE DATA SET NAME    01720000
MSG1     DC    C'UNLOADED BECAUSE'                                      01740000
MSG2     DC    C'NOT MOVED/COPIED BECAUSE'                              01760000
*                                                                       01780000
*   THE DATA SET NAME IS FOLLOWED BY EITHER MSG1 OR MSG2. THIS IS       01800000
*   INDICATED TO THE MESSAGE WRITER BY THE HIGH ORDER BIT OF THE MESSAG 01820000
*   INDICATOR BYTE (IEHMVV61). ON=MSG1   OFF=MSG2                       01840000
*                                                                       01860000
*   THE REMAINDER OF THE MESSAGE IS TAKEN FROM THE FOLLOWING LIST WITH  01880000
*   THE MESSAGE CODE IN THE LOW ORDER SEVEN BITS OF THE MESSAGE         01900000
*                   INDICATOR BYTE  (IEHMVV61)                          01920000
*                                                                       01940000
MSG3     DC    C'UNDEFINED DATA SET ORGANIZATIO'   CODE=4               01960000
         DC    C'N'                                                     01980000
MSG4     DC    C'I/O ERROR ON TO VOLUME'           CODE=6               02000000
MSG5     DC    C'UNABLE TO MOUNT FROM VOLUME'      CODE=8               02020000
MSG6     DC    C'DATA SET NOT FOUND'               CODE=10              02040000
MSG7     DC    C'UNABLE TO COPY ON SAME VOLUME'    CODE=12              02060000
MSG8     DC    C'I/O ERROR ON FROM VOLUME'         CODE=14              02080000
MSG9     DC    C'SECURITY PROTECTED'               CODE=16              02100000
MSG10    DC    C'KEYLENGTH NONZERO'                CODE=18              02120000
MSG11    DC    C'ACCESS METHOD NOT COMPATIBLE'     CODE=20              02140000
MSG12    DC    C'RECORD LENGTH NOT DEVICE'         CODE=22              02160000
         DC    C' COMPATIBLE'                                           02180000
MSG13    DC    C'DATA SET MARKED UNMOVEABLE'       CODE=24              02200000
MSG14    DC    C'UNABLE TO MOUNT TO VOLUME'        CODE=26              02220000
MSG15    DC    C'UNABLE TO MOUNT CVOL'             CODE=28              02240000
MSG16    DC    C'UNABLE TO ALLOCATE TO DATA SET'   CODE=30              02260000
MSG17    DC    C'I/O ERROR ENCOUNTERED IN WORK '  CODE=32          7491 02280000
         DC    C'DATA SET'                                         7491 02300000
MSG18    DC    C'I/O ERROR ENCOUNTERED IN INPUT'  CODE=34          7491 02320000
         DC    C' DATA SET'                                        7491 02340000
MSG19    DC    C'I/O ERROR ON SYSPRINT DATA SET'  CODE=36          7491 02360000
MSG20    DC    C'B'                                                     02380000
MSG21    DC    C'DUPLICATE NAME ON TO VOLUME AND'                  2695 02386017
         DC    C' FROM DATA SET IS A MODEL DSCB'      CODE =40     2695 02392017
MSG22    DC    C'DUPLICATE NAME FOUND FOR '                      A27312 02394019
         DC    C'DIRECT DATA SET ON TO VOLUME'                   A27312 02396019
MSG23    DC    C'DUPLICATE NAME FOUND FOR PDS '   CODE =44       A35445 02397020
         DC    C'ON TO VOLUME'                                   A35445 02398020
MSG24    DC    C'PREALLOCATED DATA SET HAS NO '   CODE=46        A36065 02398621
         DC    C'DIRECTORY'                                      A36065 02399221
MSG28    DC    C'TO-VOLUME CONTAINS NON-EMPTY '   CODE=48        A45147 02399621
         DC    C'DATA SET OF SPECIFIED NAME'                     A45147 02399721
MSG30    DC    C'EXPIRATION DATE HAS NOT BEEN REACHED'          OY01172 02399816
MSG32    DC    C'FROM DATA SET HAS NO DIRECTORY'      CODE=52  @YA02601 02400032
MSG53    DC    C'TO DATA SET PREVIOUSLY RACF DEFINED' CODE=54  @G32DSFS 02404032
MSG54    DC    C'OF INVALID RACF AUTHORIZATION '      CODE=56  @G32DSFS 02408032
         DC    C'OR INVALID NAME QUALIFIER'                    @ZM45071 02410032
MSG55    DC    C'MODELED ENTITY NOT RACF DEFINED'     CODE=58  @G32DSFS 02412032
*                                                                       02416032
*                               NORMAL MESSAGES                         02420000
*                                                                       02440000
*        THE FOLLOWING MESSAGES ARE PRINTED AS THEY APPEAR BELOW        02460000
*                                                                       02480000
MSGN1    DC    FL1'75'                                                  02500000
         DC    C'IEH405I '                                              02520000
         DC    C'CATALOG STRUCTURE UNLOADED'                            02540000
         DC    C' BECAUSE THE TO DEVICE'                                02560000
         DC    C' IS NON DIRECT ACCESS'                                 02580000
MSGN2    DC    FL1'36'                                                  02600000
         DC    C'A PREALLOCATED DATA'                                   02620000
         DC    C' SET IS BEING USED'                                    02640000
MSGN3    DC    FL1'84'                                                  02660000
         DC    C'THE DSCB FIELDS, RECFM'                                02680000
         DC    C' AND BLKSIZE, HAVE BEEN DEFINED'                       02700000
         DC    C' TO ALLOW THIS MOVE/COPY'                              02720000
         DC    C' REQUEST'                                              02740000
MSGN4    DC    FL1'77'                                             UL0H 02745017
         DC    C'IEH331I USER LABELS NOT MOVED/COPIED.'            UL0H 02750017
         DC    C'NO USER LABEL TRACK ALLOCATED FOR INPUT.'         UL0H 02755017
         END                                                            02760000
./  ADD  SSI=62440135,NAME=IEHMVMRZ
 TITLE 'IEHMVMRZ-IEHMOVE MSG''S FOR LOAD MODULES IEHMVESZ && IEHMVESX'  00010014
IEHMVMRZ CSECT                                                          00020000
*A009760,014000,023500                                           A45188 00020522
*A009600,D009700,A013800,D014000-014200,C023500                  A37919 00021021
*                                                                A29052 00022019
*1995                                                              UL0H 00025017
*1995000300,023200                                                 4576 00030016
*A16794,431499-433499                                           YL026VC 00032002
         ENTRY IEH4DD                                                   00040000
         ENTRY MSGSTART                                                 00060000
         ENTRY NORMALM                                                  00080000
         ENTRY MSGHEAD                                                  00100000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00120000
*                                                                     * 00140000
*    THIS MESSAGE CSECT CONTAINS THE MESSAGE TEXT USED BY MODULES     * 00160000
*    IEHMVSSZ & IEHMVSRZ, AND WILL BE INCLUDED IN THE LOAD        10943 00180014
*    MODULES IEHMVESZ & IEHMVESX AT SYSTEMS GENERATION TIME.      10943 00200014
*                                                                     * 00220000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00240000
MSGSTART DS    0H                                                       00260000
         DC    AL2(MSG1-MSGHEAD)                                        00280000
         DC    AL2(MSG2-MSG1-1)                                         00300000
         DC    AL2(MSG2-MSGHEAD)                                        00320000
         DC    AL2(MSG3-MSG2-1)                                         00340000
         DC    AL2(MSG3-MSGHEAD)                                        00360000
         DC    AL2(MSG4-MSG3-1)                                         00380000
         DC    AL2(MSG4-MSGHEAD)                                        00400000
         DC    AL2(MSG5-MSG4-1)                                         00420000
         DC    AL2(MSG5-MSGHEAD)                                        00440000
         DC    AL2(MSG6-MSG5-1)                                         00460000
         DC    AL2(MSG6-MSGHEAD)                                        00480000
         DC    AL2(MSG7-MSG6-1)                                         00500000
         DC    AL2(MSG7-MSGHEAD)                                        00520000
         DC    AL2(MSG8-MSG7-1)                                         00540000
         DC    AL2(MSG8-MSGHEAD)                                        00560000
         DC    AL2(MSG9-MSG8-1)                                         00580000
         DC    AL2(MSG9-MSGHEAD)                                        00600000
         DC    AL2(MSG10-MSG9-1)                                        00620000
         DC    AL2(MSG10-MSGHEAD)                                       00640000
         DC    AL2(MSG11-MSG10-1)                                       00660000
         DC    AL2(MSG11-MSGHEAD)                                       00680000
         DC    AL2(MSG12-MSG11-1)                                       00700000
         DC    AL2(MSG12-MSGHEAD)                                       00720000
         DC    AL2(MSG13-MSG12-1)                                       00740000
         DC    AL2(MSG13-MSGHEAD)                                       00760000
         DC    AL2(MSG14-MSG13-1)                                       00780000
         DC    AL2(MSG14-MSGHEAD)                                       00800000
         DC    AL2(MSG15-MSG14-1)                                       00820000
         DC    AL2(MSG15-MSGHEAD)                                       00840000
         DC    AL2(MSG16-MSG15-1)                                       00860000
         DC    AL2(MSG16-MSGHEAD)                                       00880000
         DC    AL2(MSG17-MSG16-1)                                       00900000
         DC    AL2(MSG17-MSGHEAD)                                       00920000
         DC    AL2(MSG18-MSG17-1)                                       00940000
         DC    AL2(MSG18-MSGHEAD)                                       00960000
         DC    AL2(MSG25-MSG18-1)                                A37919 00970021
         DC    AL2(MSG25-MSGHEAD)                                A37919 00973021
         DC    AL2(MSG26-MSG25-1)                                A45188 00976022
         DC    AL2(MSG26-MSGHEAD)                                A45188 00977022
         DC    AL2(MSGN1-MSG26-1)                                A45188 00978022
*                                                                       00980000
*                                                                       01000000
         DS    0F                                                       01020000
IEH4DD   DC    CL2'01'                                                  01040000
         DC    CL2'02'                                                  01060000
         DC    CL2'03'                                                  01080000
         DC    CL2'04'                                                  01100000
         DC    CL2'05'                                                  01120000
         DC    CL2'06'                                                  01140000
         DC    CL2'07'                                                  01160000
         DC    CL2'08'                                                  01180000
         DC    CL2'09'                                                  01200000
         DC    CL2'10'                                                  01220000
         DC    CL2'11'                                                  01240000
         DC    CL2'12'                                                  01260000
         DC    CL2'13'                                                  01280000
         DC    CL2'14'                                                  01300000
         DC    CL2'15'                                                  01320000
         DC    CL2'16'                                                  01340000
         DC    CL2'17'                                                  01360000
         DC    CL2'18'                                                  01380000
         DC    CL2'25'                                           A37919 01400021
         DC    CL2'26'                                                  01420022
*                                                                       01440000
*                                                                       01460000
         DS    0F                                                       01480000
NORMALM  EQU   *-4                     POINTERS TO NORMAL MESSAGES      01500000
         DC    A(MSGN1)                CODE=1                           01520000
         DC    A(MSGN2)                CODE=3                           01540000
         DC    A(MSGN3)                CODE=5                           01560000
         DC    A(MSGN4)                CODE=7                           01580000
         DC    A(MSGN5)                CODE=9                           01600000
         DC    A(MSGN6)                CODE=HEX 8B                      01620000
         DC    A(MSGN7)                CODE=13                          01640000
         DC    A(MSGN8)                CODE=15                          01660000
         DC    A(MSGN9)                CODE=17                     UL0H 01670017
         DC    A(MSGN10)               CODE=19                   A24209 01673018
         DC    A(MSGN11)               CODE=21                   A17911 01676018
         DC    A(MSGN12)               CODE=23                   A25631 01678019
         DC    A(MSGN13)               CODE=25     X'19'         A29052 01679019
         DC    A(MSGN14)               CODE=27                  YL026VC 01679402
MSGHEAD  DC    C'DATA SET'             ALL MESSAGES FROM THE MOVE/COPY  01680000
*                                      SINGLE DATA SET MODULE START     01700000
*                                      WITH THE MSGHEAD AND ARE THEN    01720000
*                                      FOLLOWED BY THE DATA SET NAME    01740000
MSG1     DC    C'UNLOADED BECAUSE'                                      01760000
MSG2     DC    C'NOT MOVED/COPIED BECAUSE'                              01780000
*                                                                       01800000
*   THE DATA SET NAME IS FOLLOWED BY EITHER MSG1 OR MSG2. THIS IS       01820000
*   INDICATED TO THE MESSAGE WRITER BY THE HIGH ORDER BIT OF THE MESSAG 01840000
*   INDICATOR BYTE (IEHMVV61). ON=MSG1   OFF=MSG2                       01860000
*                                                                       01880000
*   THE REMAINDER OF THE MESSAGE IS TAKEN FROM THE FOLLOWING LIST WITH  01900000
*   THE MESSAGE CODE IN THE LOW ORDER SEVEN BITS OF THE MESSAGE         01920000
*                   INDICATOR BYTE  (IEHMVV61)                          01940000
*                                                                       01960000
MSG3     DC    C'UNDEFINED DATA SET ORGANIZATIO'   CODE=4               01980000
         DC    C'N'                                                     02000000
MSG4     DC    C'I/O ERROR ON TO VOLUME'           CODE=6               02020000
MSG5     DC    C'UNABLE TO MOUNT FROM VOLUME'      CODE=8               02040000
MSG6     DC    C'DATA SET NOT FOUND'               CODE=10              02060000
MSG7     DC    C'UNABLE TO COPY ON SAME VOLUME'    CODE=12              02080000
MSG8     DC    C'I/O ERROR ON FROM VOLUME'         CODE=14              02100000
MSG9     DC    C'SECURITY PROTECTED'               CODE=16              02120000
MSG10    DC    C'KEYLENGTH NONZERO'                                     02140000
MSG11    DC    C'ACCESS METHOD NOT COMPATIBLE'     CODE=20              02160000
MSG12    DC    C'RECORD LENGTH NOT DEVICE'         CODE=22              02180000
         DC    C' COMPATIBLE'                                           02200000
MSG13    DC    C'DATA SET MARKED UNMOVEABLE'       CODE=24              02220000
MSG14    DC    C'UNABLE TO MOUNT TO VOLUME'        CODE=26              02240000
MSG15    DC    C'UNABLE TO MOUNT CVOL'             CODE=28              02260000
MSG16    DC    C'UNABLE TO ALLOCATE TO DATA SET'   CODE=30              02280000
MSG17    DC    C'DEVICE TYPES NOT COMPATIBLE'  CODE=32  X'20'    A29052 02300019
MSG18    DC    C'FROM DATA SET DOES NOT HAVE UNLO'                10943 02330014
         DC    C'ADED FORMAT'                                     10943 02340014
MSG25    DC    C'OF UNLOAD REQUEST'                              A37919 02350021
MSG26    DC    C'A DDNAME COULD NOT BE FOUND'                    A45188 02355022
*                                                                       02360000
*                               NORMAL MESSAGES                         02380000
*                                                                       02400000
*        THE FOLLOWING MESSAGES ARE PRINTED AS THEY APPEAR BELOW        02420000
*                                                                       02440000
MSGN1    DC    FL1'62'                                                  02460018
         DC    C'IEH403I UNABLE TO MOVE/COPY VOLU'                      02480000
         DC    C'ME FROM NON DIRECT ACCESS'                             02500000
         DC    C'DEVICE'                                                02520000
MSGN2    DC    FL1'42'                                                  02540000
         DC    C'IEH404I UNABLE TO LOCATE VOLUME'                       02560000
         DC    C' INFORMATION'                                          02580000
MSGN3    DC    FL1'70'                                                  02600018
         DC    C'UNABLE TO ALLOCATE CATALOG'                            02620000
         DC    C' FOR CATLG REQUEST- '                                  02640000
         DC    C'MOVE/COPY REQUEST IGNORED'                             02660000
MSGN4    DC    FL1'50'                                                  02680000
         DC    C'TO DEVICE NOT DIRECT ACCESS'                           02700000
         DC    C' - CATLG KEYWORD IGNORED'                              02720000
MSGN5    DC    FL1'84'                                                  02740000
         DC    C'THE DSCB FIELDS, RECFM'                                02760000
         DC    C' AND BLKSIZE, HAVE BEEN DEFINED'                       02780000
         DC    C' TO ALLOW THIS MOVE/COPY'                              02800000
         DC    C' REQUEST'                                              02820000
MSGN6    DC    FL1'36'                                                  02840018
         DC    C'THE FOLLOWING DATA SET'                                02860000
         DC    C' IS BEING MOVED.'                                      02880000
MSGN7    DC    FL1'69'                                                  02900018
         DC    C'IEH450I REQUEST TERMINATED'                            02920000
         DC    C' BECAUSE DATA SET SPANS MORE'                          02940000
         DC    C' THAN 5 VOLUMES.'                                      02960000
MSGN8    DC    FL1'101'                                                 02980018
         DC    C'IEH451I '                                              03000000
         DC    C'TRACK OVERFLOW FEATURE '                               03020000
         DC    C'REQUIRED/REQUESTED ON DEVICE'                          03040000
         DC    C' THAT DOES NOT HAVE TRACK '                            03060000
         DC    C'OVERFLOW FEATURE.'                                     03080000
MSGN9    DC    FL1'100'                                            ULOH 03084018
         DC    C'IEH332I PERMANENT I/O ERROR WHILE READING USER '  UL0H 03088017
         DC    C'INPUT HEADER LABELS. NO MORE LABELS WILL '        UL0H 03092017
         DC    C'BE PROCESSED.'                                    UL0H 03096017
MSGN10   DC    FL1'36'                                           A24209 03096518
         DC    C'IEH460I INVALID DATA SET ORGANIZATION'          A24209 03097018
MSGN11   DC    FL1'112'                                          A17911 03097518
         DC    C'IEH452I '                                       A17911 03098018
         DC    C'THE DATA SET BEING MOVED/COPIED IS MARKED '     A17911 03098518
         DC    C'UNMOVABLE.  UNMOVABLE DATA MUST BE UPDATED '    A17911 03099018
         DC    C'BEFORE ITS NEXT USE.'                           A17911 03099518
MSGN12   DC    FL1'104'                                          A25631 03099619
         DC    C'IEH413I DATA SET '                              A25631 03099719
         DC    C'                                            '   A25631 03099819
         DC    C'HAS INCORRECT FORMAT FOR UNLOADED DATA SET.'    A25631 03099919
MSGN13   DC    FL1'108'                                          A29052 13099919
         DC    C'IEH433I DATA SET NOT MOVE/COPIED'               A29052 23099919
         DC    C' BECAUSE INCLUDE, EXCLUDE, SELECT OR REPLACE'   A29052 33099919
         DC    C' REQUEST WHILE LOADING/UNLOADING.'              A29052 43099919
MSGN14   DC    FL1'102'                LENGTH OF MESSAGE MINUS 1YL026VC 43149902
         DC    C'IEH474I '             MESSAGE NUMBER PLUS BLANKYL026VC 43199902
         DC    44C' '                  SPACE FOR DSNAME         YL026VC 43249902
         DC    C' HAS DATA ORGANIZATION THAT CANNOT BE'         YL026VC 43299902
         DC    C' MOVED/COPIED.'                                YL026VC 43349902
         END                                                            53099919
./  ADD  SSI=62440137,NAME=IEHMVMSN
 TITLE 'IEHMVMSN--MESSAGE MODULE FOR IEHMOVE LOAD MODULE IEHMVESN' 000H 00010017
IEHMVMSN CSECT                                                          00020017
*                                                                       00030017
*0057                                                              UL0H 00040017
*                                                                  UL0H 00050017
*********************************************************************** 00060017
**                                                                      00080000
**                            MSG CSECT FOR IEHMVSSN                    00100000
**                                                                      00120000
*********************************************************************** 00140000
*                                                                       00160000
         DC    A(MSGA)                                                  00180000
         DC    A(MSGB)                                                  02180017
         DC    A(MSGC)                                                  04180017
         DC    A(MSGD)                                                  06180017
         DC    A(MSGE)                                                  08180017
         DC    A(MSGF)                                             UL0H 10180017
         DC    A(MSGG)                                             UL0H 12180017
*                                                                       14180017
*                                                                       16180017
MSGA     DC    AL1(MSGB-MSGA-2)                                         18180017
         DC    CL26'UNIT REC OR UNLABELED TAPE'                         20180017
*                                                                       22180017
MSGB     DC    AL1(MSGC-MSGB-2)                                         24180017
         DC    CL16'IEH361I DATA SET'                                   26180017
*                                                                       28180017
MSGC     DC    AL1(MSGD-MSGC-2)                                         30180017
         DC    CL16'        DATA SET'                                   32180017
*                                                                       34180017
MSGD     DC    AL1(MSGE-MSGD-2)                                         36180017
         DC    CL19'COPIED TO VOLUME(S)'                                38180017
*                                                                       40180017
MSGE     DC    AL1(MSGF-MSGE-2)                                         42180017
         DC    CL29'NOT MOVED-COPIED TO VOLUME(S)'                      44180017
*                                                                  UL0H 46180017
MSGF     DC    AL1(MSGG-MSGF-2)                                    UL0H 48180017
         DC    CL42'IEH331I USER LABELS ARE NOT MOVED/COPIED. '    UL0H 50180017
         DC    CL40'NO USER LABEL TRACK ALLOCATED FOR INPUT.'      UL0H 52180017
*                                                                  UL0H 54180017
MSGG     DC    AL1(MSGH-MSGG-2)                                    UL0H 56180017
         DC    CL42'IEH335I PERMANENT I/O ERROR WHILE WRITING '    UL0H 58180017
         DC    CL43'USER OUTPUT TRAILER LABELS. NO MORE LABELS '   UL0H 60180017
         DC    CL18'WILL BE PROCESSED.'                            UL0H 62180017
*                                                                  UL0H 64180017
MSGH     EQU   *                                                   UL0H 66180017
         END                                                            68180017
./  ADD  SSI=62440138,NAME=IEHMVMSQ
         TITLE 'IEHMVMSQ09 -- MESSAGE LOAD MODULE FOR IEHMVESQ'         00020000
IEHMVMSQ CSECT                                                          00040000
*                                                                       00060000
*********************************************************************** 00080000
**                                                                      00100000
**                      MESSAGE LOAD MODULE FOR IEHMVESQ                00120000
**                                                                      00140000
*********************************************************************** 00160000
*                                                                       00180000
         DC    A(MSGA)                 DISPLACEMENT-A15= 0              00200000
         DC    A(MSGB)                                 = 4              00220000
         DC    A(MSGC)                                 = 8              00240000
         DC    A(MSGD)                                 = 12             00260000
         DC    A(MSGE)                                 = 16             00280000
         DC    A(MSGF)                                 = 20             00300000
         DC    A(MSGG)                                 = 24             00320000
         DC    A(MSGH)                                 = 28             00340000
         DC    A(MSGI)                                 = 32             00360000
         DC    A(MSGJ)                                 = 36             00380000
         DC    A(MSGK)                                 = 40             00400000
*                                                                       00420000
MSGA     DC    AL1(MSGB-MSGA-2)                                         00440000
         DC    CL26'UNIT REC OR UNLABELED TAPE'                         00460000
MSGB     DC    AL1(MSGC-MSGB-2)                                         00480000
         DC    CL16'        DATA SET'                                   00500000
MSGC     DC    AL1(MSGD-MSGC-2)                                         00520000
         DC    CL27'HAS BEEN MOVED TO VOLUME(S)'                        00540000
MSGD     DC    AL1(MSGE-MSGD-2)                                         00560000
         DC    CL30'                   AND IS NOW '                     00580000
         DC    CL5'NAMED'                                               00600000
MSGE     DC    AL1(MSGF-MSGE-2)                                         00620000
         DC    CL16'IEH365I DATA SET'                                   00640000
MSGF     DC    AL1(MSGG-MSGF-2)                                         00660000
         DC    CL28'MAY STILL EXIST ON VOLUME(S)'                       00680000
MSGG     DC    AL1(MSGH-MSGG-2)                                         00700000
         DC    CL30'IEH366I THE DATA SET JUST MOVE'                     00720000
         DC    CL30'D MAY EXIST WITH AN INTERNALLY'                     00740000
         DC    CL28' GENERATED NAME ON VOLUME(S)'                       00760000
MSGH     DC    AL1(MSGI-MSGH-2)                                         00780000
         DC    CL30'        THE DATA SET JUST MOVE'                     00800000
         DC    CL30'D HAS BEEN SUCCESSFULLY UNCATA'                     00820000
         DC    CL5'LOGED'                                               00840000
MSGI     DC    AL1(MSGJ-MSGI-2)                                         00860000
         DC    CL30'        THE DATA SET JUST MOVE'                     00880000
         DC    CL30'D HAS BEEN SUCCESSFULLY RECATA'                     00900000
         DC    CL5'LOGED'                                               00920000
MSGJ     DC    AL1(MSGK-MSGJ-2)                                         00940000
         DC    CL30'IEH367I THE DATA SET JUST MOVE'                     00960000
         DC    CL30'D WAS NOT SUCCESSFULLY UNCATAL'                     00980000
         DC    CL4'OGED'                                                01000000
MSGK     DC    AL1(MSGL-MSGK-2)                                         01020000
         DC    CL30'IEH368I THE DATA SET JUST MOVE'                     01040000
         DC    CL30'D WAS NOT SUCCESSFULLY RECATAL'                     01060000
         DC    CL4'OGED'                                                01080000
MSGL     EQU   *                                                        01100000
         END                                                            01120000
./  ADD  SSI=62450081,NAME=IEHMVMSY
 TITLE 'IEHMVMSY-IEHMVESY: MESSAGE CSECT'                               00005014
 TITLE 'IEHMVMSY-IEHMVESY: MESSAGE CSECT'                               00010014
IEHMVMSY CSECT                                                          00020000
*A009994,014700,023320                                           A45188 00020422
*C378000,658000,808000                                           A45168 00021021
*                                                                A38744 00022021
*2582                                                              UL0H 00025017
*2544009800,023200                                                 9373 00030014
         ENTRY IEH4DD                                                   00040000
*027800                                                          A18773 00050018
         ENTRY MSGSTART                                                 00060000
         ENTRY NORMALM                                                  00080000
         ENTRY MSGHEAD                                                  00100000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00120000
*                                                                     * 00140000
*    THIS MESSAGE CSECT CONTAINS THE MESSAGE TEXT USED BY MODULES     * 00160000
*    IEHMVSSY, IEHMVSRX, IEHMVSRM COMPRISING LOAD MODULE IEHMVESY       00180000
*                                                                     * 00200000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00220000
MSGSTART DS    0H                                                       00240000
         DC    AL2(MSG1-MSGHEAD)                                        00260000
         DC    AL2(MSG2-MSG1-1)                                         00280000
         DC    AL2(MSG2-MSGHEAD)                                        00300000
         DC    AL2(MSG3-MSG2-1)                                         00320000
         DC    AL2(MSG3-MSGHEAD)                                        00340000
         DC    AL2(MSG4-MSG3-1)                                         00360000
         DC    AL2(MSG4-MSGHEAD)                                        00380000
         DC    AL2(MSG5-MSG4-1)                                         00400000
         DC    AL2(MSG5-MSGHEAD)                                        00420000
         DC    AL2(MSG6-MSG5-1)                                         00440000
         DC    AL2(MSG6-MSGHEAD)                                        00460000
         DC    AL2(MSG7-MSG6-1)                                         00480000
         DC    AL2(MSG7-MSGHEAD)                                        00500000
         DC    AL2(MSG8-MSG7-1)                                         00520000
         DC    AL2(MSG8-MSGHEAD)                                        00540000
         DC    AL2(MSG9-MSG8-1)                                         00560000
         DC    AL2(MSG9-MSGHEAD)                                        00580000
         DC    AL2(MSG10-MSG9-1)                                        00600000
         DC    AL2(MSG10-MSGHEAD)                                       00620000
         DC    AL2(MSG11-MSG10-1)                                       00640000
         DC    AL2(MSG11-MSGHEAD)                                       00660000
         DC    AL2(MSG12-MSG11-1)                                       00680000
         DC    AL2(MSG12-MSGHEAD)                                       00700000
         DC    AL2(MSG13-MSG12-1)                                       00720000
         DC    AL2(MSG13-MSGHEAD)                                       00740000
         DC    AL2(MSG14-MSG13-1)                                       00760000
         DC    AL2(MSG14-MSGHEAD)                                       00780000
         DC    AL2(MSG15-MSG14-1)                                       00800000
         DC    AL2(MSG15-MSGHEAD)                                       00820000
         DC    AL2(MSG16-MSG15-1)                                       00840000
         DC    AL2(MSG16-MSGHEAD)                                       00860000
         DC    AL2(MSG17-MSG16-1)                                       00880000
         DC    AL2(MSG17-MSGHEAD)                                       00900000
         DC    AL2(MSG18-MSG17-1)                                       00920000
         DC    AL2(MSG18-MSGHEAD)                                       00940000
         DC    AL2(MSG19-MSG18-1)                                       00960000
         DC     AL2(MSG19-MSGHEAD)                                      00980000
         DC    AL2(MSG20-MSG19-1)                                  9373 00986014
         DC    AL2(MSG20-MSGHEAD)                                  9373 00993014
         DC    AL2(MSG21-MSG20-1)                                A38744 00995021
         DC    AL2(MSG21-MSGHEAD)                                A38744 00997021
         DC    AL2(MSG26-MSG21-1)                                A38744 00999022
         DC    AL2(MSG26-MSGHEAD)                                A38744 00999422
         DC    AL2(MSG23-MSG26-1)                                A45188 01010022
         DC    AL2(MSG23-MSGHEAD)                                A45188 01012022
         DC    AL2(MSG27-MSG23-1)                               YL026VC 01014002
         DC    AL2(MSG27-MSGHEAD)                               YL026VC 01016002
         DC    AL2(MSG28-MSG27-1)                               YL026VC 01018002
*                                                                       01020000
*                                                                       01030022
         DS    0F                                                       01040000
IEH4DD   DC    CL2'01'                                                  01060000
         DC    CL2'02'                                                  01080000
         DC    CL2'03'                                                  01100000
         DC    CL2'04'                                                  01120000
         DC    CL2'05'                                                  01140000
         DC    CL2'06'                                                  01160000
         DC    CL2'07'                                                  01180000
         DC    CL2'08'                                                  01200000
         DC    CL2'09'                                                  01220000
         DC    CL2'10'                                                  01240000
         DC    CL2'11'                                                  01260000
         DC    CL2'12'                                                  01280000
         DC    CL2'13'                                                  01300000
         DC    CL2'14'                                                  01320000
         DC    CL2'15'                                                  01340000
         DC    CL2'16'                                                  01360000
         DC    CL2'17'                                                  01380000
         DC    CL2'18'                                                  01400000
         DC    CL2'19'                                                  01420000
         DC    CL2'20'                                                  01440000
         DC    CL2'21'                                           A38744 01460022
         DC    CL2'26'                                           A45188 01472022
*                                                                       01480000
*                                                                       01500000
         DS    0F                                                       01520000
NORMALM  EQU   *-4                     POINTERS TO NORMAL MESSAGES      01540000
         DC    A(MSGN1)                CODE=1                           01560000
         DC    A(MSGN2)                CODE=3                           01580000
         DC    A(MSGN3)                CODE=5                           01600000
         DC    A(MSGN4)           CODE=7                                01620000
         DC    A(MSGN5)            CODE=9                               01640000
         DC    A(MSGN6)                CODE=11                     UL0H 01645017
         DC    A(MSGN7)                CODE=13                     UL0H 01650017
         DC    A(MSGN8)                CODE=15                     UL0H 01655017
         DC    A(MSGN9)                CODE=17                     VS0H 01657017
MSGHEAD  DC    C'DATA SET'             ALL MESSAGES FROM THE MOVE/COPY  01660000
*                                      SINGLE DATA SET MODULE START     01680000
*                                      WITH THE MSGHEAD AND ARE THEN    01700000
*                                      FOLLOWED BY THE DATA SET NAME    01720000
MSG1     DC    C'UNLOADED BECAUSE'                                      01740000
MSG2     DC    C'NOT MOVED/COPIED BECAUSE'                              01760000
*                                                                       01780000
*   THE DATA SET NAME IS FOLLOWED BY EITHER MSG1 OR MSG2. THIS IS       01800000
*   INDICATED TO THE MESSAGE WRITER BY THE HIGH ORDER BIT OF THE MESSAG 01820000
*   INDICATOR BYTE (IEHMVV61). ON=MSG1   OFF=MSG2                       01840000
*                                                                       01860000
*   THE REMAINDER OF THE MESSAGE IS TAKEN FROM THE FOLLOWING LIST WITH  01880000
*   THE MESSAGE CODE IN THE LOW ORDER SEVEN BITS OF THE MESSAGE         01900000
*                   INDICATOR BYTE  (IEHMVV61)                          01920000
*                                                                       01940000
MSG3     DC    C'UNDEFINED DATA SET ORGANIZATIO'   CODE=4               01960000
         DC    C'N'                                                     01980000
MSG4     DC    C'I/O ERROR ON TO VOLUME'           CODE=6               02000000
MSG5     DC    C'UNABLE TO MOUNT FROM VOLUME'      CODE=8               02020000
MSG6     DC    C'DATA SET NOT FOUND'               CODE=10              02040000
MSG7     DC    C'UNABLE TO COPY ON SAME VOLUME'    CODE=12              02060000
MSG8     DC    C'I/O ERROR ON FROM VOLUME'         CODE=14              02080000
MSG9     DC    C'SECURITY PROTECTED'               CODE=16              02100000
MSG10    DC    C'KEYLENGTH NONZERO'                CODE=18              02120000
MSG11    DC    C'ACCESS METHOD NOT COMPATIBLE'     CODE=20              02140000
MSG12    DC    C'RECORD LENGTH NOT DEVICE'         CODE=22              02160000
         DC    C' COMPATIBLE'                                           02180000
MSG13    DC    C'DATA SET MARKED UNMOVEABLE'       CODE=24              02200000
MSG14    DC    C'UNABLE TO MOUNT TO VOLUME'        CODE=26              02220000
MSG15    DC    C'UNABLE TO MOUNT CVOL'             CODE=28              02240000
MSG16    DC    C'UNABLE TO ALLOCATE TO DATA SET'   CODE=30              02260000
MSG17    DC    C'ISAM DATASET'         CODE = 32                        02280000
MSG18    DC    C'DEVICE TYPES NOT COMPATIBLE'                           02300000
MSG19    DC    C'DCB ATTRIBUTES ARE NOT COMPATIBLE'                9373 02310014
MSG20    DC    C'THE FROM DATA SET COULD NOT BE OPENED' CODE=38  A38744 02320021
MSG21    DC    C'THE TO DATA SET COULD NOT BE OPENED'  CODE=40   A38744 02326021
MSG26    DC    C'A DDNAME COULD NOT BE FOUND'                    A45188 02336022
MSG23    DC    C'TO DATA SET WAS CHECKPOINT, FROM WAS NOT'      YL026VC 02338002
MSG27    DC    C'FROM DATA SET WAS CHECKPOINT, TO WAS NOT'      YL026VC 02338402
MSG28    EQU   *                                                YL026VC 02338802
*                                                                       02340000
*                               NORMAL MESSAGES                         02360000
*                                                                       02380000
*        THE FOLLOWING MESSAGES ARE PRINTED AS THEY APPEAR BELOW        02400000
*                                                                       02420000
MSGN1    DC    FL1'75'                                                  02440000
         DC    C'IEH405I '                                              02460000
         DC    C'CATALOG STRUCTURE UNLOADED'                            02480000
         DC    C' BECAUSE THE TO DEVICE'                                02500000
         DC    C' IS NON DIRECT ACCESS'                                 02520000
MSGN2    DC    FL1'36'                                                  02540000
         DC    C'A PREALLOCATED DATA'                                   02560000
         DC    C' SET IS BEING USED'                                    02580000
MSGN3    DC    FL1'84'                                                  02600000
         DC    C'THE DSCB FIELDS, RECFM'                                02620000
         DC    C' AND BLKSIZE, HAVE BEEN DEFINED'                       02640000
         DC    C' TO ALLOW THIS MOVE/COPY'                              02660000
         DC    C' REQUEST'                                              02680000
MSGN4    DC    FL1'61'                                                  02700000
         DC    C' REQUEST TERMINATED '                                  02720000
         DC    C'BECAUSE DATA SET SPANS'                                02740000
         DC    C' MORE THAN 5 VOLUMES'                                  02760000
MSGN5    DC    FL1'36'                                           A18773 02770018
         DC    C'IEH460I '                                       A18773 02780018
         DC    C'INVALID DATA SET ORGANIZATION'                         02800000
MSGN6    DC    FL1'102'                                            UL0H 09800017
         DC    C'IEH334I PERMANENT I/O ERROR WHILE WRITING '       UL0H 16800017
         DC    C'USER OUTPUT HEADER LABELS. NO MORE '              UL0H 23800017
         DC    C'LABELS WILL BE PROCESSED.'                        UL0H 30800017
MSGN7    DC    FL1'102'                                          A45168 37800021
         DC    C'MOVE/COPY REQUEST CANCELLED. VS OR VBS'           VS0H 44800017
         DC    C'DATA SET WITH KEYS ON D.A. DEVICE CANNOT'         VS0H 51800017
         DC    C' BE MOVED/COPIED TO TAPE.'                        VS0H 58800017
MSGN8    DC    FL1'79'                                           A45168 65800021
         DC    C'MOVE/COPY REQUEST CANCELLED. TO AND FROM'         VS0H 72800017
         DC    C' DATA SETS HAVE INCOMPATIBLE KEYLENGTHS.'         VS0H 79800017
MSGN9    DC    FL1'75'                                           A45168 80800021
         DC    C'MOVE/COPY REQUEST CANCELLED. NO DATA '            VS0H 81800017
         DC    C'MGMT SUPPORT FOR VS/VBS BDAM DATA SETS.'          VS0H 82800017
         END                                                            86800017
./  ADD  SSI=70280018,NAME=IEHMVMTA
IEHMVMTA CSECT                                                          00050004
**********************************************************************  00100004
*                                                                       00150004
*    TABLE OF MESSAGE ADDRESSES AND RETURN ADDRESS                      00200004
*                                                                       00250004
*     THE ENTIRE CSECT WAS REACTIVATED IN SUPPORT              @Z40CSJH 00252004
*     OF THE EXTENDED MVS CVOL FUNCTION                        @Z40CSJH 00254004
*                                                              @Z40CSJH 00260004
**********************************************************************  00300004
*                                                                       00350004
*                                                                       00400004
         ENTRY MSG301                                                   00450004
         ENTRY MSG300                                                   00500004
         ENTRY MSGTERM                                                  00550004
         ENTRY TAEODAD                                                  00600004
         ENTRY TATBL1                                                   00650004
         EXTRN A                                                        00700004
         EXTRN B                                                        00750004
         EXTRN C                                                        00800004
         EXTRN D                                                        00850004
         EXTRN E                                                        00900004
         EXTRN F                                                        00950004
         EXTRN G                                                        01000004
         EXTRN H                                                        01050004
         EXTRN J                                                        01100004
         EXTRN MYEOD                                                    01150004
*                                                                       01200004
*                                                                       01250004
TATBL1   DS    0F                                                       01300004
         DC    X'FF'                    SUCCESSFULLY CATALOGED          01350004
         DC    AL3(MSGCAT)                                              01400004
         DC    A(A)                                                     01450004
         DC    A(MSG346)                VOLUME NOT MOUNTED              01500004
         DC    A(H)                                                     01550004
         DC    F'0'                     CATALOG STRUCTURE               01600004
         DC    A(B)                                                     01650004
         DC    F'0'                     INVALID CODE                    01700004
         DC    A(H)                                                     01750004
         DC    F'0'                     INDEX LEVEL MISSING             01800004
         DC    A(C)                                                     01850004
         DC    X'FF'                    SPACE NOT AVAILABLE             01900004
         DC    AL3(MSG351)                                              01950004
         DC    A(G)                                                     02000004
         DC    X'FF'                    INVALID NAME                    02050004
         DC    AL3(MSG356)                                              02100004
         DC    A(G)                                                     02150004
         DC    A(MSG348)                I/O ERROR IN CATALOG            02200004
         DC    A(H)                                                     02250004
         DC    F'0'                     INDEX BUILT                     02300004
         DC    A(D)                                                     02350004
         DC    A(MSG346)                VOLUME NOT MOUNTED              02400004
         DC    A(H)                                                     02450004
         DC    F'0'                     CATALOG STRUCTURE               02500004
         DC    A(E)                                                     02550004
         DC    F'0'                     INVALID CODE                    02600004
         DC    A(H)                                                     02650004
         DC    X'F0'                    CATALOG STRUCTURE               02700004
         DC    AL3(MSG354)                                              02750004
         DC    A(G)                                                     02800004
         DC    X'F0'                    NO INDEX SPACE                  02850004
         DC    AL3(MSG351)                                              02900004
         DC    A(H)                                                     02950004
         DC    F'0'                     INVALID CODE                    03000004
         DC    A(H)                                                     03050004
         DC    A(MSG348)                I/O ERROR IN CATALOG            03100004
         DC    A(H)                                                     03150004
         DC    A(MSG326)                I/O ERROR IN OUTPUT             03200004
         DC    A(H)                                                     03250004
         DC    A(MSGEND)                END OF WORK FILE                03300004
         DC    A(F)                                                     03350004
         DC    F'0'                     END OF UNLOADED CATALOG         03400004
TAEODAD  DC    A(MYEOD)                                                 03450004
         DC    A(MSG389)                I/O ERROR ON INPUT              03500004
         DC    A(H)                                                     03550004
         DC    X'FF'                    NOT UNLOADED FORMAT             03600004
         DC    AL3(MSG313)                                              03650004
         DC    A(H)                                                     03700004
         DC    A(MSG372)                I/O ERROR IN WORK FILE          03750004
         DC    A(H)                                                     03800004
         DC    X'FF'                    DATA SET FOUND-NOT INDEX        03850004
         DC    AL3(MSG354)                                              03900004
         DC    A(G)                                                     03950004
         DC    A(MSG346)                VOLUME NOT MOUNTED              04000004
         DC    A(H)                                                     04050004
         DC    X'F0'                    INDEX LEVEL MISSING             04100004
         DC    AL3(MSG354)                                              04150004
         DC    A(G)                                                     04200004
         DC    X'FF'                    INDEX BLOCK FOUND-NOT DATA SET  04250004
         DC    AL3(MSG354)                                              04300004
         DC    A(G)                                                     04350004
         DC    X'FF'                    LOWEST LEVEL NOT DATA SET       04400004
         DC    AL3(MSG354)                                              04450004
         DC    A(G)                                                     04500004
         DC    X'FF'                    SYNTAX ERROR IN NAME            04550004
         DC    AL3(MSG356)                                              04600004
         DC    A(G)                                                     04650004
         DC    A(MSG348)                I/O ERROR IN CATALOG            04700004
         DC    A(H)                                                     04750004
         DC    A(MSG316)                MODEL DSCB NOT WRITTEN          04800004
         DC    A(H)                                                     04850004
         DC    X'FF'                    SUCCESSFULLY UNLOADED           04900004
         DC    AL3(MSGTERMA)                                            04950004
         DC    A(J)                                                     05000004
         DC    X'FF'                    SUCCESSFULLY UNCATALOGED        05050004
         DC    AL3(MSGTERMC)                                            05100004
         DC    A(G)                                                     05150004
*                                                                       05200004
*                                                                       05250004
**********************************************************************  05300004
*                                                                       05350004
*   TABLE OF MESSAGE SEGMENTS- EACH SEGMENT IS PRECEDED BY ITS LNGTH-1  05400004
*                                                                       05450004
**********************************************************************  05500004
*                                                                       05550004
*                                                                       05600004
MSG300   DC    AL1(MSG313-MSG300-2)                                     05650004
         DC    CL8'DATA SET'                                            05700004
MSG313   DC    AL1(6)                                                   05750004
         DC    CL7'IEH313I'                                             05800004
MSG313A  DC    AL1(MSG326-MSG313A-2)                                    05850004
         DC    CL32'HAS INCORRECT FORMAT FOR UNLOADE'                   05900004
         DC    CL11'D DATA SET '                                        05950004
MSG326   DC    AL1(MSG346-MSG326-2)                                     06000004
         DC    CL32'IEH326I I/O ERROR ENCOUNTERED IN'                   06050004
         DC    CL18' OUTPUT DATA SET '                                  06100004
MSG346   DC    AL1(MSG348-MSG346-2)                                     06150004
         DC    CL32'IEH346I CATALOG CANNOT BE LOCATE'                   06200004
         DC    CL32'D, OR CONTROL VOLUMES ARE CONNEC'                   06250004
         DC    CL18'TED TO EACH OTHER.'                                 06300004
MSG348   DC    AL1(MSG351-MSG348-2)                                     06350004
         DC    CL32'IEH348I I/O ERROR ENCOUNTERED IN'                   06400004
         DC    CL9' CATALOG.'                                           06450004
MSG351   DC    AL1(6)                                                   06500004
         DC    CL7'IEH351I'                                             06550004
MSG351A  DC    AL1(MSG354-MSG351A-2)                                    06600004
         DC    CL32'NOT CATALOGED. SPACE NOT AVAILAB'                   06650004
         DC    CL18'LE IN THE CATALOG.'                                 06700004
MSG354   DC    AL1(6)                                                   06750004
         DC    CL7'IEH354I'                                             06800004
MSG354A  DC    AL1(MSG356-MSG354A-2)                                    06850004
         DC    CL32'NOT CATALOGED. INDEX STRUCTURE I'                   06900004
         DC    CL12'NCONSISTENT.'                                       06950004
MSG356   DC    AL1(6)                                                   07000004
         DC    CL7'IEH356I'                                             07050004
MSG356A  DC    AL1(MSG372-MSG356A-2)                                    07100004
         DC    CL32'NOT CATALOGED. INVALID DATA SET '                   07150004
         DC    CL5'NAME'                                                07200004
MSG372   DC    AL1(MSG389-MSG372-2)                                     07250004
         DC    CL32'IEH372I I/O ERROR ENCOUNTERED IN'                   07300004
         DC    CL15' WORK DATA SET.'                                    07350004
MSG389   DC    AL1(MSGCAT-MSG389-2)                                     07400004
         DC    CL32'IEH389I I/O ERROR ENCOUNTERED IN'                   07450004
         DC    CL16' INPUT DATA SET.'                                   07500004
MSGCAT   DC    AL1(0)                                                   07550004
         DC    C' '                                                     07600004
MSGCATA  DC    AL1(MSGEND-MSGCATA-2)                                    07650004
         DC    CL27'CATALOGED ON OUTPUT VOLUME.'                        07700004
MSGEND   DC    AL1(MSG316-MSGEND-2)                                     07750004
          DC    CL29'MOVE/COPY CATALOG COMPLETED. '                     07800004
MSG316   DC    AL1(MSG301-MSG316-2)                                     07850004
         DC    CL32'IEH316I MODEL DSCB FOR GENERATIO'                   07900004
         DC    CL31'N DATA GROUP CANNOT BE WRITTEN.'                    07950004
MSG301   DC    AL1(MSGTERM-MSG301-2)                                    08000004
         DC    CL5'INDEX'                                               08050004
MSGTERM  DC    AL1(MSGTERMA-MSGTERM-2)                                  08100004
         DC    CL32'THE CATALOG HAS BEEN MOVED/COPIE'                   08150004
         DC    CL11'D TO VOLUME'                                        08200004
MSGTERMA DC    AL1(0)                                                   08250004
         DC    C' '                                                     08300004
MSGTERMB DC    AL1(MSGTERMC-MSGTERMB-2)                                 08350004
         DC    CL26'UNLOADED ON OUTPUT VOLUME.'                         08400004
MSGTERMC DC    AL1(0)                                                   08450004
         DC    C' '                                                     08500004
MSGTERMD DC    AL1(MSGTERME-MSGTERMD-2)                                 08550004
         DC    CL28'UNCATALOGED ON INPUT VOLUME.'                       08600004
MSGTERME DS    0C                                                       08650004
         END                                                            08700004
./  ADD  SSI=62450084,NAME=IEHMVMTL
IEHMVMTL CSECT                                                          00020000
*                                                                  UL0H 00022017
*2920                                                              UL0H 00024017
*                                                                  UL0H 00026017
*2074006600-006800                                                 2762 00030015
*009520                                                          A27313 00035019
*********************************************************************** 00040000
*                                                                       00060000
*        M E S S A G E   C S E C T   F O R   I E H M V S T L            00080000
*                                                                       00100000
*********************************************************************** 00120000
*                                                                       00140000
         ENTRY M01                                                      00160000
         ENTRY M02                                                      00180000
         ENTRY M03                                                      00200000
         ENTRY M04                                                      00220000
         ENTRY M05                                                      00240000
         ENTRY M06                                                      00260000
         ENTRY M07                                                 UL0H 00270017
         ENTRY M08                                               A27313 00275019
*                                                                       00280000
*                                                                       00300000
M01      DC    AL1(B-A-1)                                               00320000
         DC    AL3(A)                                                   00340000
M02      DC    AL1(C-B-1)                                               00360000
         DC    AL3(B)                                                   00380000
M03      DC    AL1(D-C-1)                                               00400000
         DC    AL3(C)                                                   00420000
M04      DC    AL1(E-D-1)                                               00440000
         DC    AL3(D)                                                   00460000
M05      DC    AL1(F-E-1)                                               00480000
         DC    AL3(E)                                                   00500000
M06      DC    AL1(G-F-1)                                               00520000
         DC    AL3(F)                                                   00540000
M07      DC    AL1(H-G-1)                                          UL0H 00546017
         DC    AL3(G)                                              UL0H 00552017
M08      DC    AL1(I-H-1)                                        A27313 00554019
         DC    AL3(H)                                            A27313 00556019
*                                                                       00560000
*                                                                       00580000
A        DC    X'00'                                                    00600000
B        DC    CL30'RECORD LENGTH DISAGREES WITH D'                     00620000
         DC    CL16'SCB FOR DATASET '                                   00640000
C        DC    CL8'IEH462I'                                        2762 00650015
         DC    CL32'NO RECORD FOUND OCCURED READING'               2762 00660015
         DC    CL8'DATASET'                                        2762 00670015
D        DC    CL8'IEH389I '                                            00700000
         DC    CL32'I/O ERROR ENCOUNTERED IN INPUT D'                   00720000
D1       DC    CL32'ATA SET                         '                   00740000
          DC    CL20'                    '                              00760000
E        DC    CL17'IEH313I DATA SET '                                  00780000
E1       DC    CL32'                                '                   00800000
         DC    CL32'                     HAS INCORRE'                   00820000
         DC    CL32'CT FORMAT FOR UNLOADED DATA SET.'                   00840000
F        DC    CL8'IEH326I '                                            00860000
         DC    CL32'I/O ERROR ENCOUNTERED IN OUTPUT '                   00880000
F1       DC    CL32'DATA SET                        '                   00900000
         DC    CL21'                     '                              00920000
G        DC    CL42'IEH333I PERMANENT I/O ERROR WHILE READING '    UL0H 00928017
         DC    CL35'USER INPUT TRAILER LABELS. NO MORE '           UL0H 00936017
         DC    CL26'LABELS WILL BE PROCESSED.'                     UL0H 00944017
H        DC    CL39'IEH336I AN UNCORRECTABLE ERROR OCCURED '     A27313 00948019
         DC    CL23'WHILE READING DATA SET '                     A27313 00952019
I        DC    X'00'                                             A27313 00956019
         END                                                            00960000
./  ADD  SSI=80880101,NAME=IEHMVSRA
*TITLE B'I                                                            * 00020000
*'IEHMVSRA-IEHMOVE   BPAM/SAM RELOAD'                              2365 00030014
         TITLE 'IEHMVSRA-IEHMOVE   BPAM/SAM RELOAD'                2365 00040014
*                                                                     * 00060000
*                                                                     * 00080000
*FUNCTION/OPERATION:                                                  * 00100000
*   THIS ROUTINE RESTORES DATA SETS WHICH HAVE BEEN 'UNLOAD' TO THEIR * 00120000
*ORIGINAL FORM (BPAM/SAM) AND PLACES THEM UPON THE ALLOCATED DEVICES. * 00140000
*FOR BPAM IF THE INPUT IS A NORMAL RECORD IT IS WRITTEN OUT ON THE    * 00160000
*ALLOCATED DEVICE, IF THE INPUT IS A NOTE LIST THE TTR'S IN IT ARE    * 00180000
*UPDATED TO REFLECT THE NEW LOCATIONS, IF THE INPUT IS A DIRECTORY    * 00200000
*ENTRY ANY TTR'S IN IT ARE UPDATED. FOR BSAM THE INPUT IS WRITTEN OUT * 00220000
*OUT ON THE ALLOCATED DEVICE.                                         * 00240000
*                                                                     * 00260000
*                                                                     * 00280000
*                                                                     * 00300000
*ENTRY POINTS:                                                        * 00320000
*        IEHMVERA - ONLY ENTRY, L  15, A (IEHMVERA) BALR 15,15        * 00340000
*INPUT:                                                               * 00360000
*   RECORDS READ BY IEHMVSRK WHICH HAVE CONTROL INFORMATION APPENDED  * 00380000
*TO THEM AND MAY CONTAIN LOCATION DEPENDENT INFORMATION.              * 00400000
*OUTPUT:                                                              * 00420000
*   INPUT RECORDS WITH CONTROL INFORMATION REMOVED AND LOCATION       * 00440000
*DEPENDENT INFORMATION UPDATED.                                       * 00460000
*EXTERNAL ROUTINES:                                                   * 00480000
*        'IEHMVSRK - BREAD' READS 'UNLOADED DATA SET AND FORMATS THE  * 00500000
*RECORDS WHICH ARE PASSED TO IEHMVSRA.                                * 00520000
*EXITS - NORMAL                                                       * 00540000
*   PRINT MESSAGE, FREEMAIN AND TRANSFER CONTROL TO IEHMVESN WHEN     * 00560000
*THE ENTIRE DATA SET HAS BEEN 'LOADED'.                               * 00580000
*ERRORS:                                                              * 00600000
*   SET ABORT INDICATOR, PRINT MESSAGE, FREEMAIN, AND TRANSFER CONTROL* 00620000
*TO IEHMVESN WHEN ANY ERROR OCCURS.                                   * 00640000
*TABLES/WORK AREAS:                                                   * 00660000
*   TABLE OF MESSAGE TEXTS, VARIABLE SIZE WORK AREA FOR INPUT         * 00680000
*ATTRIBUTES:                                                          * 00700000
*   READ ONLY, REENTRANT, REUSABLE                                    * 00720000
REG0     EQU   0                                                        00740000
REG1     EQU   1                                                        00760000
REG2     EQU   2                                                        00780000
REG3     EQU   3                                                        00800000
REG4     EQU   4                                                        00820000
REG5     EQU   5                                                        00840000
REG6     EQU   6                                                        00860000
REG7     EQU   7                                                        00880000
REG8     EQU   8                                                        00900000
REG9     EQU   9                                                        00920000
REG10    EQU   10                                                       00940000
REG11    EQU   11                                                       00960000
REG12    EQU   12                                                       00980000
REG13    EQU   13                                                       01000000
REG14    EQU   14                                                       01020000
REG15    EQU   15                                                       01040000
         SPACE 2                                                   2365 01050014
***** THIS ROUTINE TRANSFORMS PARTITIONED DATA SETS THAT HAVE BEEN **** 01060000
*****  'UNLOADED'INTO PROPERLY FORMATTED PDS AND 'LOADS' THEM ON   **** 01080000
*****  A SPECIFIED DIRECT ACCESS DEVICE.                           **** 01100000
IEHMVSRA CSECT                                                          01102003
*C015080                                                       @ZA13724 01102499
*A014480-015080                                                @ZA07335 01102604
*D014480-015440                                                @ZA07335 01103204
*A043170-043190                                                @ZA03361 01104003
*C043800                                                       @ZA03361 01106003
         SPACE 2                                                   2365 01110014
*A036831-036833                                                @YA01704 01112602
*D016050-016070                                                @YA01704 01113202
*A016050-016070,036805-036980,083060-083120                     YA01221 01114000
*C014050                                                        YA01221 01116000
*A026200,038800,065350,082800                                    A44326 01120122
* 012920,053600-053800,055240-055280,080100                      A34119 01120421
* 054000-054600                                                  A34119 01120821
* 015610,015700                                                  A37919 01121221
*                                                                A31964 01122020
* 058000,022800,036400                                          PTM3039 01126020
* 12820-12940,55450-55550,67800,68840-68960,75860-72920          A26493 01129020
* 79600,80060-80120,    014000                                   A26493 01132020
* 080000                                                         A26581 01135020
* 044200,044400                                                  PM2166 01138020
*                                                                A22318 01141020
* 015600,016000                                                  00GM0I 01144020
* 014600-015400                                                  A23094 01147020
*2633066400                                                        3606 01150020
         EXTRN IEHMVERK                                                 01153020
         ENTRY IEHMVERA                                                 01160000
IEHMVERA SAVE  (14,12),T,IEHMVSRA-OZ13724                      @ZA13724 01180099
         BALR  REG10,0                                                  01200000
         USING *,REG10                                                  01220000
         USING IEHMVV,REG12                                             01240000
         USING PDSLWORK,REG9                                            01260000
         USING PDSIO,REG8                                               01280000
*****  CHECK FOR VALID RECORD FORMAT AND BLOCKSIZE  *****               01282019
         L     REG3,IEHMVV30+8         COMPARE RECORD FORMATS OF A26493 01284019
         L     REG4,IEHMVV31           FROM DSCB AND TO DCB      A26493 01286019
         CLC   DCBRECFM(1,REG4),DS1RECFM(REG3)                   A26493 01288019
         BNE   PDSLFMT                 NO -- ISSUE MESSAGE       A26493 01290019
         CLC   DCBBLK(2,REG4),DS1BLK(REG3)  BLKSIZE EQU          A34119 01292021
         BNE   PDSLFMT                 NO -- ISSUE MESSAGE       A26493 01294019
***** INITIALIZATION PROCEDURE *****                                    01300000
         SR    REG3,REG3                                                01320000
         L     REG4,IEHMVV31           DCB ADDR                         01340000
         IC    REG3,16(0,REG4)         INSERT KEY LENGTH                01360000
         LA    REG3,6(0,REG3)          LENGTH OF RECORD INFO FIELD      01380000
         LA    REG0,276            BASIC SIZE OF WORKAREA--FOUR YA01221 01405000
*                                    BYTES ADDED IN RLS18 FOR    PM2166 01410018
*                                    STORING TRACK BALANCE.      PM2166 01415018
         TM    26(REG4),X'02'          DSORG=PO                         01420000
         BZ    PDSLIN                  NO                               01440000
         LH    REG2,62(REG4)        INCREASE WORKAREA PDSLWORK @ZA07335 01448004
*                                   BY THE BLKSIZE IN CASE OF  @ZA07335 01478004
         AR    REG0,REG2            NOTELIST RECORDS           @ZA13724 01508099
         AR    REG0,REG3                OF WORKAREA---PDSLWORK.  A23094 01552018
PDSLIN   LR    REG8,REG0               SAVE SIZE OF 'PDSLWORK'   A37919 01554021
         GETMAIN R,LV=(0)                                        A37919 01556021
         LR    REG9,REG1               SAVE WORK AREA ADDR              01580000
         ST    REG8,PDSLSTM1       SAVE SIZE OF 'PDSLWORK'       00GM01 01600018
         TM    IEHMVV20+2,PDSABORT     INVALID LRECL/BLKSIZE?    A34119 01602021
         BO    PDSLFMT2                YES RETURN TO MSGRTN      A34119 01604021
         MVC   PDSTRKBL(2),18(REG4) SAVE INITIAL TRACK BALANCE.  PM2166 01610018
         LA    REG1,PDSNOTE            ADDR OF NOTE LIST AREA           01620000
         AR    REG1,REG3               ADD LGTH OF RECORD INFO AND KEY  01640000
         ST    REG1,PDSLAD3            SAVE ADDR OF NOTE LIST PROPER    01660000
         LH    REG0,62(0,REG4)         BLOCK SIZE                       01680000
         AR    REG0,REG3               TOTAL IO AREA                    01700000
         ST    REG0,PDSLSTM2           SAVE SIZE OF AREA                01720000
         GETMAIN R,LV=(0)              GET STORAGE FOR IO AREA          01740000
         LR    REG8,REG1               ADDR OF MAIN STORAGE ACQUIRED    01760000
         AR    REG1,REG3               ADD LGTH OF RECORD INFO AND KEY  01780000
         MVI   PDSLSW,X'C0'            INITIALIZE INDICATOR             01800000
         IEHPRE (14,1),TF                                               01820000
         MVI   PDSPTR,X'00'                                             01840000
         MVC   PDSPTR+1(11),PDSPTR     CLEAR WORK AREA                  01860000
         L     REG1,IEHMVV31           DCB ADDR                         01880000
         LA    REG3,PDSLSYNX           SYNAD                            01900000
         ST    REG3,PDSLSTR            SAVE SYNAD                       01920000
         MVC   57(3,REG1),PDSLSTR+1    PUT IN DCB                       01940000
***** GET AN UNLOADED RECORD *****                                      01960000
PDSGET   SR    REG0,REG0               ZERO PARAM REGISTER              01980000
         LA    REG1,PDSREC             ADDR OF INPUT AREA               02000000
         L     REG15,ADBREAD           ADDR OF READING RTN              02020000
         BALR  REG14,REG15             GO TO GET RECORD                 02040000
***** ACT ON RETURN CODE FROM BREAD *****                               02060000
         B     PDSLMSG                 GO TO MSG RTN                    02080000
***** END OF INPUT PROCEDURE *****                                      02100000
PDSLEOI  TM    PDSREC+2,X'02'          SEQUENTIAL ACCESS METHOD         02120000
         BO    PDSLEOD                 YES                              02140000
         TM    PDSLSW,X'40'            ENTRY ALREADY STOWED             02160000
         BO    PDSLEOD                 YES                              02180000
         LA    REG11,PDSLEOD           RETURN ADDR FROM MSG RTN         02200000
         B     PDSL26                  GO TO STOW DIRECTORY ENTRY       02220000
***** DETERMINE TYPE OF RECORD *****                                    02240000
PDSLRET  LH    REG2,PDSREC             LENGTH OF RECORD                 02260000
         STH   REG2,IEHMVV10-2                                  PTM3039 02280019
         TM    PDSREC+2,X'22'          PDS MEMBER OR SAM RECORD         02300000
         BM    PDSL1                   YES                              02320000
         TM    PDSREC+2,X'10'          IS THIS A NOTE LIST              02340000
         BO    PDSL2                   YES                              02360000
         TM    PDSREC+2,X'08'          IS THIS A DIRECTORY ENTRY        02380000
         BO    PDSL3                   YES                              02400000
         TM    PDSREC+2,X'04'          DOES THIS INDICATE N L POSITION  02420000
         BO    PDSL4B                  YES                              02440022
         LA    REG15,12(0,0)           RETURN CODE                      02460000
         B     PDSLMSG                 ABORT-NO RECORD TYPE             02480000
***** PROCESS A RECORD WHICH IS A MEMBER OF A PDS *****                 02500000
PDSL1    LA    REG3,PDSREC+6           ADDR OF RECORD                   02520000
         BAL   REG11,PDSL15            GO TO WRITE RECORD               02540000
         TM    PDSREC+2,X'02'          SAM RECORD                       02560000
         BO    PDSGET                  YES                              02580000
         LTR   REG7,REG7               POINTERS IN DIRECTORY ENTRY      02600000
         BH    PDSL11                  YES                              02620000
PDSL13   DS    0H                                                A44326 02630022
         TM    PDSLSW,X'04'            NOTE LIST EXCHANGE        A44326 02632022
         BO    PDSL2E                  YES RETURN                A44326 02634022
         TM    PDSLSW,X'80'            ANY POINTERS IN NOTE LIST        02640022
         BO    PDSGET                  NO                               02660000
PDSL18   DS    0H                                                A44326 02730022
         LR    REG3,REG5               INIT SCAN CNTR            A44326 02780022
         L     REG4,PDSLAD3            GET NL ADDR               A44326 02830022
PDSL18A  DS    0H                                                A44326 02880022
         TM    0(REG4),X'80'           TTR UPDATED               A44326 02930022
         BO    PDSL18D                 YES GET NEXT TTRX         A44326 02980022
         CLI   2(REG4),X'00'           TTRX ZERO                 A44326 03030022
         BE    PDSL18B                 YES FLAG THIS TTR         A44326 03032022
         CLC   PDSREC+3(3),0(REG4)     TTR'S EQUAL               A44326 03034022
         BNE   PDSL18C                 NO GET NEXT TTRX          A44326 03036022
         BAL   REG11,PDSL12            YES NOTE THIS TTR         A44326 03038022
         IC    REG1,3(0,REG4)          ZERO LAST BYTE            A44326 03038422
         ST    REG1,PDSLSTR            SAVE NEW PTR              A44326 03038822
         MVC   0(4,REG4),PDSLSTR       UPDATE TTRX               A44326 03039222
PDSL18B  DS    0H                                                A44326 03039622
         OI    0(REG4),X'80'           FLAG THIS TTRX            A44326 03039722
         BCT   REG5,PDSL18C            GET NEXT TTR IF ANY       A44326 03039822
         L     REG4,PDSLAD3            GO TO BEGIN OF NL         A44326 03039922
PDSL18E  DS    0H                                                A44326 03043222
         NI    0(REG4),X'7F'           RESTORE TTRX              A44326 03045222
         LA    REG4,4(REG4)            JUMP TO NEXT TTRX         A44326 03045622
         BCT   REG6,PDSL18E            IF ANY                    A44326 03046022
         OI    PDSLSW,X'80'            INDIC NL UPDATED          A44326 03046422
         B     PDSGET                  GET NEXT RECORD           A44326 03046522
PDSL18C  DS    0H                                                A44326 03046622
         BCT   REG3,PDSL18D            GET NEXT TTR IF ANY       A44326 03049922
         B     PDSGET                  GET NEXT RECORD           A44326 03051922
PDSL18D  DS    0H                                                A44326 03052322
         LA    REG4,4(REG4)            JUMP TO NEXT TTRX         A44326 03052722
         B     PDSL18A                 AND CHECK IT              A44326 03053122
***** PROCESS A RECORD WHICH IS A NOTE LIST *****                       03053422
PDSL2    DS    0H                                                A44326 03056722
         TM    PDSLSW,X'08'            NOTE LIST IN CORE         A44326 03060022
         BNO   PDSL2C                  NO CONTINUE               A44326 03070022
         MVC   PDSNTTR(3),PDSREC+3     YES SAVE NEW NL TTR       A44326 03080022
         OI    PDSLSW,X'04'            SET RET SW                A44326 03082022
         B     PDSL4                   WRITE OLD NL FIRST        A44326 03084022
PDSL2E   DS    0H                                                A44326 03088822
         NI    PDSLSW,X'FB'            RESET EXCH SWITCH         A44326 03089222
         MVC   PDSREC+3(3),PDSNTTR     RESTORE NEW NL TTR        A44326 03089622
PDSL2C   DS    0H                                                A44326 03089722
         OI    PDSLSW,X'08'            INDIC NOTE LIST IN CORE   A44326 03089822
         L     REG1,IEHMVV31           DCB ADDR                  A44326 03090022
         NI    PDSLSW,X'7F'            CLEAR INDICATOR           A44326 03140022
         LH    REG5,PDSPTRNO           ORG NBR TTRN'S            A44326 03190022
         LA   REG11,PDSDIR+12                                    A44326 03200022
FINDN    CLC   0(3,REG11),PDSREC+3     TTRN FOUND                A44326 03210022
         BE    TTRNFND                 YES SAVE BYTE N           A44326 03212022
         LA    REG11,4(REG11)          NO GO TO NEXT TTRN        A44326 03214022
         BCT   REG5,FINDN              IF ANY                    A44326 03216022
TTRNFND  DS    0H                                                A44326 03218022
        IC     REG5,3(REG11)           SAVE NBR OF POINTERS      A44326 03218422
         LH    REG2,PDSREC             GET RECORD LENGTH         A44326 03218522
         LA    REG2,6(0,REG2)          ADD 6 TO GET FULL RECORD LENGTH  03218822
         LA    REG0,256(0,0)           PUT 256 IN REG 0                 03220000
         LA    REG1,PDSNOTE            ADDR OF NOTE LIST AREA           03240000
         LA    REG3,PDSREC             ADDR OF RECORD                   03260000
PDSL2A   CLR   REG2,REG0               LENGTH GREATER THAN 256          03280000
         BNH   PDSL2B                  NO                               03300000
         MVC   0(256,REG1),0(REG3)     MOVE MOVE NEXT 256 BYTES OF REC  03320000
         AR    REG3,REG0               INCREASE ADDR BY 256             03340000
         SR    REG2,REG0               DECREASE LGTH BY 256             03360000
         AR    REG1,REG0     INCREASE ADDRESS BY 256               3606 03370016
         B     PDSL2A                                                   03380000
PDSL2B   BCTR  REG2,0                  SUBTRACT 1 FROM LGTH             03400000
         EX    REG2,PDSL10             HAVE RECORD MOVED                03420000
         LR    REG6,REG5               SAVE NBR OF TTRX'S        A44326 03450022
         L     REG1,PDSLAD3            START OF NL               A52050 03453022
MAKEZERO DS    0H                                                A52050 03456022
         NI    0(REG1),X'7F'           CLEAR FIRST BIT           A52050 03459022
         LA    REG1,4(REG1)            POINT TO NEXT NOTE        A52050 03459622
         BCT   REG6,MAKEZERO           IF ANY                    A52050 03459722
         LR    REG6,REG5               SAVE NBR OF TTRX'S        A52050 03459822
         B     PDSGET                  GET ANOTHER RECORD               03460000
***** PROCESS A RECORD WHICH IS A DIRECTORY ENTRY *****                 03480000
PDSL3    MVC   IEHMVV00(74),PDSREC+6   SAVE DIRECTORY ENTRY             03500000
         TM    PDSLSW,X'40'            DIRECTORY ENTRY ALREADY STOWED   03520000
         BO    PDSL3A                  YES                              03540000
         BAL   REG11,PDSL26            GO TO STOW DIRECTORY ENTRY       03560000
PDSL3A   NI    PDSLSW,X'BF'            INDICATE NOT FIRST ENTRY         03580000
         TM    PDSREC+17,X'80'         IS THIS AN ALIAS ENTRY           03600000
         BO    PDSL7                   YES                              03620000
         LH    REG2,IEHMVV10-2                                  PTM3039 03640019
         BCTR  REG2,0                  SUBTRACT 1 FROM LGTH             03660000
         EX    REG2,PDSL6              HAVE RECORD MOVED                03680000
         TM    IEHMVV20+3,X'08'        PREALLOCATION            YA01221 03680500
         BZ    PDSL3B                  NO CONTINUE              YA01221 03681000
*  THIS ROUTINE WILL CHECK THE OUTPUT DATA SET'S DIRECTORY      YA01221 03681500
*  TO SEE WHETHER THE MEMBER ALREADY EXISTS                     YA01221 03682000
*  IN SUCH A CASE THE MEMBER WILL BE SKIPPED                    YA01221 03682500
         MVC   BLDLIST+4(8),PDSDIR     GET THE NAME             YA01221 03683000
         XC    BLDLIST(4),BLDLIST      CLEAR THE FIELD         @YA01704 03683102
         MVI   BLDLIST+1,X'01'         INDIC ONE ENTRY         @YA01704 03683202
         MVI   BLDLIST+3,X'0E'         LENGTH OF THE ENTRY     @YA01704 03683302
         L     REG7,IEHMVV31           ADDR OUTPUT DCB          YA01221 03683500
         BLDL  (REG7),BLDLIST                                   YA01221 03684000
         LTR   REG15,REG15             DUPLICATE NAME           YA01221 03684500
         BNZ   PDSL3B                  NO CONTINUE              YA01221 03685000
PDSL3C   DS    0H                      YES SKIP THE FILE        YA01221 03685500
         SR    REG0,REG0               INDIC: NOT FIRST ENTRY   YA01221 03686000
         LA    REG1,PDSREC             ADDR INPUT AREA          YA01221 03686500
         L     REG15,ADBREAD           ADDR OF READER           YA01221 03687000
         BALR  REG14,REG15             GO TO READ               YA01221 03687500
         B     PDSL3D(REG15)           USE THE BRANCH TABLE     YA01221 03688000
PDSL3D   DS    0H                                               YA01221 03688500
         B     PDSL3E                  RC=0  CHECK THE RECORD   YA01221 03689000
         B     PDSL3F                  RC=4  END OF FILE        YA01221 03689500
         B     PDSLMSG                 RC=8  ERROR              YA01221 03690000
         B     PDSLMSG                 RC=12 ERROR              YA01221 03690500
PDSL3E   DS    0H                      CHECK THE RECORD         YA01221 03691000
         TM    PDSREC+2,X'08'          NEW MEMBER               YA01221 03691500
         BZ    PDSL3C                  NO SKIP ANOTHER RECORD   YA01221 03692000
         LA    REG15,20                CODE FOR MSG IEH319I     YA01221 03692500
         BAL   REG11,PDSLMSG           INDIC DUP MEMBER FOUND   YA01221 03693000
         OI    PDSLSW,X'40'            SKIP THE STOW            YA01221 03693500
         B     PDSL3                   PROCESS NEXT MEMBER      YA01221 03694000
PDSL3F   DS    0H                      END OF DATA              YA01221 03694500
         LA    REG15,20                CODE FOR MSG IEH319I     YA01221 03695000
         BAL   REG11,PDSLMSG           INDIC DUP MEMBER FOUND   YA01221 03695500
         L     REG7,IEHMVV31           ADDR OUTPUT DCB          YA01221 03696000
         OI    48(REG7),X'80'          INDIC LAST OPERATION     YA01221 03696500
*  WAS A WRITE TO HAVE THE TTRLL FIELD OF THE LABEL UPDATED     YA01221 03697000
         B     PDSLEOD                 GO TO TERMINATION        YA01221 03697500
PDSL3B   DS    0H                      CONTINUE PROCESSING      YA01221 03698000
         SR    REG7,REG7                                                03700000
         IC    REG7,PDSDIR+11          'C' BYTE FROM DIRECTORY ENTRY    03720000
         SRL   REG7,5                  NUMBER OF POINTERS PUT IN LOW    03740000
*                                        ORDER END OF REGISTER          03760000
         STH   REG7,PDSPTRNO           NUMBER OF POINTERS               03780000
         B     PDSGET                  GET ANOTHER RECORD               03800000
***** PUT OUT A NOTE LIST AND UPDATE POINTER IN DIRECTORY ENTRY *****   03820000
PDSL4B   DS    0H                                                A44326 03830022
         NI    PDSLSW,X'F7'            CLEAR NL IN CORE INDIC    A44326 03840022
PDSL4    DS    0H                                                A44326 03870022
         TM    PDSLSW,X'80'            ALL TTRX'S UPDATED        A44326 03890022
         BO    PDSL4A                  YES CONTINUE              A44326 03892022
         B     BADNOTE                 NO WRITE WARNING MSG      A44326 03894022
PDSL4A   DS    0H                                                A44326 03896022
         LA    REG3,PDSNOTE+6          ADDR OF RECORD                   03898022
         LH    REG2,PDSNOTE            LENGTH OF NOTE LIST              03898422
         MVC   PDSREC+3(3),PDSNOTE+3   SAVE TTR OF NOTE LIST            03898822
         LA    REG11,PDSL11            ADDR OF UPDATE RTN               03900000
         B     PDSL15                  GO TO WRITE NOTE LIST            03920000
***** PROCESS AN ALIAS DIRECTORY ENTRY *****                            03940000
PDSL7    MVC   IEHMVV00+8(3),PDSDIR+8  PUT TTR OF MEMBER IN ENTRY       03960000
         CLI   PDSPTRNO+1,X'00'        ANY POINTERS IN DIRECTORY        03980000
         BE    PDSL7A                  NO                               04000000
         LH    REG1,PDSPTRNO           NUMBER OF POINTERS               04020000
         SLL   REG1,2                  MULT BY 4 TO GET LGTH OF UPDATE  04040000
         BCTR  REG1,0                  SUBTRACT 1 FROM LGTH             04060000
         EX    REG1,PDSL21             HAVE POINTERS UPDATED            04080000
PDSL7A   OI    PDSLSW,X'40'            INDICATE ENTRY STOWED            04100000
         LA    REG11,PDSGET            RETURN ADDR FROM STOW            04120000
         LA    REG2,IEHMVV00           ADDR OF DIRECTORY ENTRY          04140000
         MVC   PDSDIR(8),IEHMVV00      PUT ALIAS NAME IN DIRECTORY      04160000
PDSL8    L     REG1,IEHMVV31                                       2365 04210014
         LA    REG1,0(0,REG1)          CLEAR HIGH ORDER BYTE            04260000
         STOW  (1),(2),A               PUT OUT DIRECTORY ENTRY          04280000
*****  ACT ON RETURN CODE FROM STOW  *****                              04287018
         LA    REG3,4              TO TEST FOR DUP NAME.         A22318 04294018
         CLR   REG15,REG3          IS RET CODE 4 (DUP NAME) ?    A22318 04301018
         BNE   NOTDUP              NO.                           A22318 04308018
*                                  YES. DUP MEMBER NAME IN TO DS A22318 04315018
         TM    IEHMVV20+3,X'08'        PREALLOCATED            @ZA03361 04317003
         BO    PRE                     YES BRANCH AROUND       @ZA03361 04319003
         L     REG1,IEHMVV31       'TO' DCB ADDR                 22318  04322018
         MVC   0(3,REG1),PDSDIR+8  SET RELAD FIELD IN TO DCB.    A22318 04329018
         MVI   PDSDIR+11,X'00'     ZERO 'C' BYTE OF STOW LIST    A22318 04336018
*                                     AND USE TTR RETURNED       A22318 04343018
*                                     BY STOW FOR BLOCK ADDR     A22318 04350018
*                                     IN POINT. POINT TO         A22318 04357018
*                                     RECOVER SPACE WHERE        A22318 04364018
*                                     DUP MEMBER WRITTEN.        A22318 04371018
         LA    REG0,PDSDIR+8       POINT R0 TO STOW LIST TTR.    A22318 04378018
         POINT (1),(0)             RECOVER DUP NAME SPACE.       A22318 04379018
PRE      L     REG1,IEHMVV31                                   @ZA03361 04380003
         MVC   18(2,REG1),PDSTRKBL RESTORE TRACK BALANCE STORED  PM2166 04381018
*                                    FROM LAST SUCCESSFUL STOW   PM2166 04382018
         OI    48(REG1),X'80'      SET DCBOFLGS TO INDICATE LAST PM2166 04383018
*                                    I/O OPERATION WAS A WRITE.  PM2166 04384018
*                                    THIS WILL FORCE A MERGE TO  PM2166 04385018
*                                    THE DSCB AT CLOSE TIME IF   PM2166 04386018
*                                    LAST MEMBER IS A DUP.       PM2166 04387018
         LR    REG15,REG3          RESTORE STOW RET CODE         A22318 04392018
         B     STOWRCDE            GO TEST STOW RET CODE         PM2166 04395018
NOTDUP   L     REG1,IEHMVV31       'TO' DCB ADDR.                PM2166 04397018
         MVC   PDSTRKBL(2),18(REG1) SAVE TRACK BALANCE AFTER     PM2166 04399018
*                                    SUCCESSFUL STOW.            PM2166 04401018
STOWRCDE LA    REG15,16(REG15)     ADD 16 TO STOW RET CODE.      PM2166 04403018
******************************************************************21919 04403121
*                                                                *21919 04403221
*   THE RETURN CODES X'14',X'18' AND X'1C' OF THE STOW MACRO     *21919 04403321
*   GIVE THE MESSAGE:                                            *21919 04403421
*         IEH326I I/O ERROR ENCOUNTERED IN OUTPUT DATA SET       *21919 04403521
*   THIS MESSAGE IS THE GOOD ONE FOR RETURN CODE X'10'           *21919 04403621
*   THE ABOVE MENTIONED RETURN CODES ARE CAUSED BY               *21919 04403721
*   X'14' I/O REQUESTS AGAINST THE SAME DCB ARE STILL            *21919 04403821
*   OUTSTANDING                                                  *21919 04403921
*   X'18' THE DCB IS NOT OPEN                                    *21919 04404021
*   X'1C' CONDITIONAL GETMAIN WITHIN STOW WAS UNSUCCESSFUL       *21919 04404121
*                                                                *21919 04404221
******************************************************************21919 04404321
         CL    REG15,PDSMAXCD     INVALID RETURN CODE?                  04404421
         BH    PDSLABT            YES, GO AND ABORT JOB           21919 04404521
         LA    REG0,32            IN REG0 SAME CONTENTS AS IN     21919 04404621
*                                 REG15 IN CASE OF I/O ERROR      21919 04404721
         CR    REG15,REG0         NEW OR OLD RETURN CODE?         21919 04404821
         BNH   PDSLMSG            OLD RETURN CODE, THEN BRANCH    21919 04404921
         LR    REG15,REG0         NOW R15 INDICATES I/O ERROR     21919 04405021
         B     PDSLMSG             GO TO ACT ON STOW R. C.       A22318 04406018
***** COMPARE TTR OF MEMBER RECORD JUST READ WITH POINTERS IN *****     04460000
*****  DIRECTORY ENTRY. IF DIRECTORY ENTRY POINTS TO THIS     *****     04480000
*****  RECORD UPDATE THE POINTER TO NEW TTR.                  *****     04500000
PDSL11   LA    REG4,PDSDIR+12          ADDR OF POINTERS                 04520000
         LH    REG3,PDSPTRNO           NUMBER OF POINTERS               04540000
         SR    REG2,REG2                                                04560000
PDSL11A  CLC   PDSREC+3(3),0(REG4)     COMPARE TTR TO POINTER           04580000
         BE    PDSL16                                                   04600000
         LA    REG4,4(0,REG4)          ADDR OF NEXT POINTER             04620000
         LA    REG2,4(0,REG2)          DISPLACEMENT OF POINTER          04640000
         BCT   REG3,PDSL11A            COUNT POINTERS COMPARED          04660000
         B     PDSL13                  IF ALL POINTERS COMPARED         04680000
***** UPDATE POINTER IN DIRECTORY ENTRY *****                           04700000
PDSL16   BAL   REG11,PDSL12            GO TO GET TTR OF RECORD WRITTEN  04720000
         IC    REG1,3(0,REG4)          4TH BYTE OF POINTER              04740000
         ST    REG1,PDSPTR(REG2)       SAVE UPDATED POINTER             04760000
         BCTR  REG7,0                  COUNT POINTER                    04780000
         B     PDSL13                                                   04800000
***** WRITE A MEMBER OR A NOTE LIST *****                               04820000
PDSL15   STM   REG4,REG5,IEHMVV00      SAVE REGISTERS                   04840000
         L     REG4,IEHMVV31+4         DECB ADDR                        04860000
         SR    REG0,REG0                                                04880000
         L     REG1,IEHMVV31           DCB ADDR                         04900000
         IC    REG0,16(0,REG1)         INSERT KEY LENGTH                04920000
         SR    REG2,REG0               SUBTRACT KEY LENGTH              04940000
         L     REG5,IEHMVV31           DCB ADDR                         04960000
         LA    REG4,0(0,REG4)          CLEAR HIGH                       04980000
         LA    REG5,0(0,REG5)           ORDER BYTE                      05000000
         STH   REG2,62(0,REG1)         PUT COUNT IN DCB BLKSIZE    6778 05020000
         WRITE (REG4),SF,(REG5),(REG3),(REG2),MF=E                      05040000
         L     REG1,IEHMVV31+4         DECB ADDR                        05060000
         LA    REG1,0(0,REG1)          CLEAR HIGH ORDER BYTE            05080000
         CHECK (1)                                                      05100000
         LM    REG4,REG5,IEHMVV00      RESTORE REGISTERS                05120000
         BR    REG11                                                    05140000
***** GET TTR OF RECORD JUST WRITTEN                                    05160000
PDSL12   L     REG1,IEHMVV31           DCB ADDR                         05180000
         LA    REG1,0(0,REG1)          CLEAR HIGH ORDER BYTE            05200000
         NOTE  (1)                     GET TTR OF RECORD JUST WRITTEN   05220000
         BR    REG11                                                    05240000
PDSLABT  OI    IEHMVV20+2,PDSABORT     INDICATE ABORTION                05260000
***** END OF LOAD PROCEDURE **                                          05280000
PDSLEOD  L     REG0,PDSLSTM2                                     A26943 05310019
         FREEMAIN R,LV=(0),A=(8)                                        05340000
         L     REG1,IEHMVV30     LOAD DCB-ADDRESS                A34119 05400021
         L     REG7,IEHMVV30+4   LOAD DECB-ADDRESS               A34119 05410021
         LH    REG0,62(REG1)     LOAD CORE LEN                   A34119 05420021
         L     REG7,12(REG7)     LOAD CORE-ADDR.                 A34119 05430021
         FREEMAIN R,LV=(0),A=(7)                                        05480000
FREEM440 L     REG0,PDSLSTM1                                     A34119 05482021
         FREEMAIN  R,LV=(0),A=(9)                                A34119 05484021
PDSLPOST IEHPOST  ,T                                             A26493 05490019
         L     REG14,12(0,REG13)       RESTORE REG14                    05500000
         XCTL  (2,12),EP=IEHMVESN                                       05520000
*****  INVALID RECORD FORMAT OR BLOCKSIZE  *****                        05522019
PDSLFMT  LA    REG0,252                SPACE FOR MSG             A34119 05524021
         LR    REG8,REG0               SAVE THE SPACE            A34119 05526021
         OI    IEHMVV20+2,PDSABORT     INDICATE ABORTION         A34119 05528021
         B     PDSLIN                  GETMAIN MSGAREA           A34119 05528421
PDSLFMT2 LA    REG15,36                INDICATE MSG              A34119 05528821
         LA    REG11,FREEM440          RETURN ADDRESS            A34119 05529221
         IEHPRE                                                         05530019
         B     PDSLMSG                                           A26493 05532019
***** I/O ERROR EXIT ROUTINE *****                                      05540000
PDSLSYNX LA    REG15,32(0,0)           RETURN CODE                      05560000
         B     PDSLMSG                 GO TO MSG RTN                    05580000
***** INTERPRET RETURN CODE *****                                       05600000
PDSLMSG  CL    REG15,PDSMAXCD          CODE VALID                       05620000
         BH    PDSLABT                 NO                               05640000
         L     REG3,PDSLTAB1(REG15)    ACCESS TABLE USING RETURN CODE   05660000
         LA    REG15,PDSLTAB1(REG15)   ADDR OF ACTION CODE              05680000
         TM    0(REG15),X'03'          ACTION CODE-WRITE MESSAGE        05700000
         BZ    0(0,REG3)               NO, GO TO ADDR TAKEN FROM TABLE  05720000
         BO    PDSLMSGA                GO TO WRITE MSG THEN CONTINUE    05740000
         OI    IEHMVV20+2,PDSABORT     INDICATE ABORTION                05760000
         LA    REG11,PDSLEOD           EXIT ADDR                        05780000
PDSLMSGA MVI   PDSMSGAR,X'40'          CLEAR                    PTM3039 05800019
         MVC   PDSMSGAR+1(120),PDSMSGAR MSG AREA                        05820000
***** GENERATE MESSAGE *****                                            05840000
         SR    REG2,REG2                                                05860000
         IC    REG2,0(0,REG3)          GET MSG LENGTH                   05880000
         LA    REG1,PDSMSGAR+1         ADDR OF MSG AREA                 05900000
         EX    REG2,PDSLMOV            PUT MSG IN OUTPUT AREA           05920000
         TM    0(REG15),X'80'          ACTION CODE-PUT NAME IN MESSAGE  05940000
         BZ    PDSLMSGD                NO                               05960000
         LA    REG1,2(REG2,REG1)       ADDR WHERE NEXT SEGMENT PLACED   05980000
         LA    REG3,2(REG2,REG3)       ADDR OF NEXT MSG SEGMENT         06000000
         IC    REG2,0(0,REG3)          GET MSG LENGTH                   06020000
         EX    REG2,PDSLMOV            PUT SEGMENT IN MSG AREA          06040000
         LA    REG1,2(REG2,REG1)       ADDR WHERE NAME PLACED           06060000
         TM    0(REG15),X'40'          ACTION CODE-USE DATA SET NAME    06080000
         BO    PDSLMSGB                YES                              06100000
         MVC   0(8,REG1),PDSDIR        PUT MEMBER NAME IN MSG           06120000
         LA    REG1,9(0,REG1)          ADDR WHERE NEXT SEGMENT PLACED   06140000
         B     PDSLMSGC                                                 06160000
PDSLMSGB L     REG15,IEHMVV21          ADDR OF DATA SET NAME            06180000
         MVC   0(44,REG1),0(REG15)     PUT DS NAME IN MSG               06200000
         LA    REG1,45(0,REG1)         ADDR WHERE NEXT SEGMENT PLACED   06220000
PDSLMSGC LA    REG3,2(REG2,REG3)       ADDR OF NEXT MSG SEGMENT         06240000
         IC    REG2,0(0,REG3)          GET MSG LENGTH                   06260000
         EX    REG2,PDSLMOV            PUT SEGMENT IN MSG AREA          06280000
PDSLMSGD LA    REG3,PDSMSGAR           ADDR OF MSG OUTPUT AREA          06300000
         LINK  EP=IEHMVESU             GO TO MSG WRITER                 06320000
         LTR   REG15,REG15             MSG WRITTEN                      06340000
         BNE   PDSLABT                 NO                               06360000
         BR    REG11                                                    06380000
PDSL26   LA    REG2,PDSDIR             ADDR OF DIRECTORY ENTRY          06400000
         CLI   PDSPTRNO+1,X'00'        ANY POINTERS IN DIR ENTRY        06420000
         BE    PDSL8                   NO                               06440000
CKTTRN   LTR   REG7,REG7           HAVE ALL DIRECTORY TTRNS BEEN A31964 06460020
*                                      UPDATED ?                 A31964 06465020
         BNZ   BADTTRN             NO.                           A31964 06470020
TTRNS    LH    REG1,PDSPTRNO       NO OF POINTERS TO UPDATE.     A31964 06475020
         SLL   REG1,2                  MULT BY 4 TO GET LGTH OF UPDATE  06480000
         BCTR  REG1,0                  SUBTRACT 1 FROM LGTH             06500000
         EX    REG1,PDSL27         HAVE POINTERS UPDATED.        A31964 06510020
         LA    REG2,PDSDIR         ADDR OF DIRECTORY ENTRY       A31964 06520020
         B     PDSL8                                             A31964 06530020
BADNOTE  LA    REG15,40            IEH328I NOTELIST TTR BAD.     A31964 06531020
         L     REG3,PDSLTAB1(REG15)   ADDR OF IEH328I.           A31964 06532020
         LA    REG15,PDSLTAB1(REG15) POINT TO ACTION CODE X'03'  A31964 06533020
         BAL   REG11,PDSLMSGA      HAVE MESSAGE PRINTED.         A31964 06535020
         OI    PDSLSW,X'80'            CLEAR THE SWITCH          A44326 06537022
         L     REG11,PDSLAD3           FIND BEGIN OF NL          A44326 06537422
BADNOTE1 DS    0H                                                A44326 06537822
         NI    0(REG11),X'7F'          CLEAR TTRX FLAG           A44326 06538222
         LA    REG11,4(REG11)          GO TO NEXT TTRX           A44326 06538622
         BCT   REG6,BADNOTE1           IF ANY                    A44326 06538722
         B     PDSL4A                  RETURN                    A44326 06538822
BADTTRN  LA    REG15,44            IEH327I BAD TTRN.             A31964 06539020
         L     REG3,PDSLTAB1(REG15)  ADDR OF IEH327I.            A31964 06540020
         LA    REG15,PDSLTAB1(REG15) POINT TO ACTION CODE X'03'  A31964 06541020
         LR    REG4,REG11         SAVE RETURN ADDRESS                   06542020
         BAL   REG11,PDSLMSGA        HAVE MESSAGE PRINTED.       A31964 06543020
         LR    REG11,REG4         RESTORE RETURN ADDRESS                06544020
         B     TTRNS               UPDATE DIRECTORY TTRNS.       A31964 06545020
***** ADDRESS CONSTANTS *****                                           06560000
ADBREAD  DC    V(IEHMVERK)                                              06580000
***** OPERATIONS TO BE PERFORMED THRU THE EXECUTE INSTRUCTION *****     06600000
PDSL6    MVC   PDSDIR(1),IEHMVV00      SAVE DIRECTORY ENTRY             06620000
PDSL10   MVC   0(1,REG1),0(REG3)       SAVE NOTE LIST              3606 06640016
PDSL21   MVC   IEHMVV00+12(1),PDSDIR+12 UPDATE POINTERS IN ALIAS ENTRY  06660000
PDSL27   MVC   PDSDIR+12(1),PDSPTR     UPDATE POINTERS IN DIRECTORY     06680000
PDSLMOV  MVC   0(1,REG1),1(REG3)       PUT MSG IN OUTPUT AREA           06700000
***** CONSTANTS *****                                                   06720000
PDSLK4   DC    H'4'                                                     06740000
PDSLK8   DC    H'8'                                                     06760000
PDSMAXCD DC    F'44'                                             A31964 06780020
         DS    0F                                                       06800000
PDSLMSK1 DC    X'01000000'                                              06820000
PDSALIAS DC    CL7'(ALIAS)'                                             06840000
PDSLK12  DC    H'12'                                                    06860000
PDSABORT EQU   X'40'                                                    06880000
DCBRECFM EQU   36                                                A26493 06884019
DS1RECFM EQU   84                                                A26493 06888019
DCBBLK   EQU   62                                                A26493 06892019
DS1BLK   EQU   86                                                A26493 06896019
***** TABLE OF MESSAGE ADDRESSES, ROUTINE ADDRESSES AND ACTION CODES ** 06900000
PDSLTAB1 DS    0F                                                       06920000
         DC    AL1(0)                  INPUT RECORD READ                06940000
         DC    AL3(PDSLRET)                                             06960000
         DC    AL1(0)                  END OF INPUT                     06980000
         DC    AL3(PDSLEOI)                                             07000000
         DC    AL1(1)                  I/O ERROR ON INPUT               07020000
         DC    AL3(M389)                                                07040000
         DC    X'C1'                   NOT UNLOADED FORMAT              07060000
         DC    AL3(M313)                                                07080000
         DC    X'83'                   MEMBER LOADED                    07100000
         DC    AL3(MCOP)                                                07120000
         DC    X'83'        DUP NAME                                    07140000
         DC    AL3(M319)                                                07160000
         DC    AL1(0)                  INVALID CODE                     07180000
         DC    AL3(PDSLABT)                                             07200000
         DC    X'81'                   NO SPACE IN DIRECTORY            07220000
         DC    AL3(M321)                                                07240000
         DC    AL1(1)                  I/O ERROR ON OUTPUT              07260000
         DC    AL3(M326)                                                07280000
         DC    X'03'                   INVALID RECFM OR BLKSIZE  A26493 07286019
         DC    AL3(M440)                                         A26493 07292019
         DC    X'03'               CODE=40  MESSAGE=IEH328I      A31964 07293020
         DC    AL3(M441)                                         A31964 07294020
         DC    X'03'               CODE=44  MESSAGE=IEH327I      A31964 07295020
         DC    AL3(M442)                                         A31964 07296020
***** TABLE OF MESSAGE SEGMENTS. EACH SEGMENT IS PRECEDED BY ITS LENGTH 07300000
MSGTAB   CSECT                                                          07320000
M313     DC    AL1(6)                                                   07340000
         DC    CL7'IEH313I'                                             07360000
M313A    DC    AL1(M313B-M313A-2)                                       07380000
         DC    CL8'DATA SET'                                            07400000
M313B    DC    AL1(M319-M313B-2)                                        07420000
         DC    CL32'HAS INCORRECT FORMAT FOR UNLOADE'                   07440000
         DC    CL11'D DATA SET.'                                        07460000
M319     DC    AL1(6)                                                   07480000
         DC    CL7'IEH319I'                                             07500000
M319A    DC    AL1(M319B-M319A-2)                                       07520000
         DC    CL6'MEMBER'                                              07540000
M319B    DC    AL1(M321-M319B-2)                                        07560000
         DC    CL32'NOT MOVED/COPIED. DUPLICATE NAME'                   07580000
         DC    CL20' IN OUTPUT DATA SET.'                               07600000
M321     DC    AL1(6)                                                   07620000
         DC    CL7'IEH321I'                                             07640000
M321A    DC    AL1(M321B-M321A-2)                                       07660000
         DC    CL6'MEMBER'                                              07680000
M321B    DC    AL1(M326-M321B-2)                                        07700000
         DC    CL32'NOT MOVED/COPIED. OUTPUT DIRECTO'                   07720000
         DC    CL11'RY IS FULL.'                                        07740000
M326     DC    AL1(MCOP-M326-2)                                         07760000
         DC    CL32'IEH326I I/O ERROR ENCOUNTERED IN'                   07780000
         DC    CL18' OUTPUT DATA SET.'                                  07800000
MCOP     DC    X'0000'                                                  07820000
MCOPA    DC    AL1(MCOPB-MCOPA-2)                                       07840000
         DC    CL6'MEMBER'                                              07860000
MCOPB    DC    AL1(MLEND-MCOPB-2)                                       07880000
         DC    CL22'HAS BEEN MOVED/COPIED.'                             07900000
MLEND    DC    AL1(M389-MLEND-2)                                        07920000
         DC    CL24'LOAD ROUTINE TERMINATED.'                           07940000
M389     DC    AL1(M440-M389-2)                                  A26493 07960019
         DC    CL32'IEH389I I/O ERROR ENCOUNTERED IN'                   07980000
         DC    CL16' INPUT DATA SET.'                            A26581 07990019
M440     DC    AL1(M441-M440-2)                                  A31964 08000020
         DC    CL41'IEH440I  RECFM OR BLKSIZE IS INCONSISTENT'   A34119 08010021
M441     DC    AL1(M442-M441-2)                                  A31964 08011020
         DC    CL38'IEH328I  A TTR IN THE NOTELIST RECORD '      A31964 08012020
         DC    CL21'HAS NOT BEEN UPDATED.'                       A31964 08013020
M442     DC    AL1(MTERM-M442-2)                                 A31964 08014020
         DC    CL41'IEH327I A TTR IN THE USER DATA FIELD OF '    A31964 08015020
         DC    CL35'THE DIRECTORY HAS NOT BEEN UPDATED.'         A31964 08016020
MTERM    DS    0C                                                       08020000
***** DEFINE INPUT AND OUTPUT AREAS AND WORK AREAS *****                08040000
PDSIO    DSECT                                                          08060000
PDSREC   DS    100F                                                     08080000
PDSLWORK DSECT                                                          08100000
PDSTRKBL DS    H         TRACJ BALANCE STORED HERE AFTER EVERY   A22318 08104018
*                          SUCCESSFUL STOW.  RESTORED FROM HERE  A22318 08108018
*                          TO DCB AFTER DUP NAME STOW.           A22318 08112018
         DS    H         UNUSED                                  A22318 08116018
PDSLSTM1 DS    F                                                        08120000
PDSLSTM2 DS    F                                                        08140000
PDSLAD3  DS    F                                                        08160000
PDSDIR   DS    19F                                                      08180000
PDSMSGAR DS    121C                                                     08200000
PDSPTR   DS    3F                                                       08220000
PDSPTRNO DS    H                                                        08240000
PDSLSW   DS    C                                                        08260000
PDSLSTR  DS    F                                                        08280000
PDSNTTR  DS    F                       NEW NOTE LIST TTR         A44326 08290022
PDSNOTE  DS    F                                                        08300000
         DS    H                                                YA01221 08306000
BLDLIST  DS    CL18                                             YA01221 08312000
         IEHMVV                                                         08320000
         END                                                            08340000
         IEHMVV                                                         08360000
./  ADD  SSI=62450087,NAME=IEHMVSRD
 TITLE 'IEHMVSRD - PERFORMS THE UNLOAD FUNCTION FOR IEHMOVE'            00010016
*       IEHMVSRD                                                        00020000
*THIS MODULE PERFORMS THE UNLOAD FUNCTION FOR THE MOVE/COPY PROGRAM.    00040000
*IT WILL UNLOAD BOTH A PARTITIONED DATA SET (PDS) AS WELL AS A SEQUEN-  00060000
*TIAL DATA SET. THE UNLOAD FORMAT IS UNIQUE IN THAT ONLY THE LOAD FUNC- 00080000
*TION IS CAPABLE OF RECOGNIZING IT AND IN TURN PERFORM THE MOVE/COPY.   00100000
*EACH RECORD THAT IS UNLOADED IS PRECEDED BY A THREE OR SIX BYTE CONS-  00120000
*TANT DEPENDING ON THE TYPE OF RECORD PASSED. THERE WILL ALWAYS BE      00140000
*THREE BYTES OF INFORMATION PRECEDING EVERY UNLOADED RECORD MADE UP OF  00160000
*                                                                       00180000
*        LL = 2 BYTES    LENGTH OF UNLOADED RECORD                      00200000
*        I  = 1 BYTE     INDICATOR AS TO THE TYPE OF RECORD             00220000
*                                                                       00240000
*THE INDICATOR BYTE BREAKS DOWN INTO THE FOLLOWING                      00260000
*                                                                       00280000
*        BIT 0      INDICATES A 3 BYTE TTR FOLLOWS THE LLI BYTES        00300000
*        BIT 1      INDICATES THE UNLOADED DATA SET IS A PDS            00320000
*        BIT 2      INDICATES THE RECORD IS PART OF A MEMBER            00340000
*        BIT 3      INDICATES THE RECORD IS A NOTE LIST                 00360000
*        BIT 4      INDICATES THE RECORD IS A DIRECTORY RECORD          00380000
*        BIT 5      INDICATES THE RECORD IS A DUMMY RECORD              00400000
*        BIT 6      NOT USED                                            00420000
*        BIT 7      NOT USED                                            00440000
*                                                                       00460000
*IF A SEQUENTIAL DATA SET IS UNLOADED THE PROGRAM WILL UNLOAD UP TO THE 00480000
*FIRST END OF FILE INDICATOR AND AT THAT POINT, FREE THE CORE THAT IT   00500000
*NEEDED AND TRANSFER CONTROL TO ANOTHER MOVE/COPY MODULE THAT WILL      00520000
*CLOSE THE DATA SETS AND LOOK FOR ANOTHER REQUEST.                      00540000
*                                                                       00560000
*IN THE CASE OF A PDS, THE PROGRAM GOES TO ROUTINE THAT PASSES IT A     00580000
*DIRECTORY ENTRY. IT THEN CHECKS FOR THE PRESENCE OF NOTELISTS. IF NOTE 00600000
*LISTS ARE PRESENT,THEN THEIR TTR'S ARE SAVED AND THE DIRECTORY INFO IS 00620000
*UNLOADED.THE NEXT THING THAT IS UNLOADED IS THE LOWEST SEQUENCED NOTE  00640000
*LIST. FOLLOWING THIS WE UNLOAD ALL THE MEMBER RECORDS UP TO THE LAST   00660000
*UNLOADED NOTELIST. WHEN THIS POINT IS REACHED THEN THE NEXT LOWEST SE- 00680000
*QUENCED NOTELIST IS UNLOADED. IF NO MORE NOTELISTS EXIST A DUMMY REC-  00700000
*ORD IS WRITTEN WHICH ENABLES THE LOAD TO PUT OUT THE LAST NOTELIST     00720000
*AND LOOK FOR THE END OF DATA MARK. WHEN EOD IS REACHED THE PROCESS IS  00740000
*THEN REPEATED UNTIL NO MORE ENTRIES ARE PASSED FROM THE GET MEMBER     00760000
*ROUTINE. ON A PDS UNLOAD IF THERE ARE NO NOTELISTS THEN THE WHOLE MEM- 00780000
*BER IS UNLOADED SEQUENTIALLY.                                          00800000
*IF USER LABEL PROCESSING WAS REQUESTED, AT END-OF-DATA OR VOLUME     * 00804017
*SWITCH TIME THIS MODULE WILL GETMAIN IF NECESSARY FOR A LABEL        * 00808017
*SAVEAREA. THE SAVED LABELS WILL THEN BE PASSED TO IEHMVSSN TO BE     * 00812017
*OUTPUT DURING DATA SET WRAP-UP.                                      * 00816017
*                                                                       00820000
*                                                                       00840000
*                                                                       00860000
*                                                                       00880000
IEHMVSRD CSECT                                                          00900000
*A032800,033000,037400,038800,041200,044400,05400,074200,076200  A44326 00901022
*A083600                                                         A44326 00901422
*A017600                                                         A44360 00902021
*2050012600-012800,078800                                          UL0H 00903017
*2050062600-063400,063800-065600,066600                            6810 00911017
REG0     EQU   0                                                        00920000
REG1     EQU   1                                                        00940000
REG2     EQU   2                                                        00960000
REG3     EQU   3                                                        00980000
REG4     EQU   4                                                        01000000
REG5     EQU   5                                                        01020000
REG6     EQU   6                                                        01040000
REG7     EQU   7                                                        01060000
REG8     EQU   8                                                        01080000
REG9     EQU   9                                                        01100000
BASE10   EQU   10                                                       01120000
REG11    EQU   11                                                       01140000
REG12    EQU   12                                                       01160000
REG13    EQU   13                                                       01180000
REG14    EQU   14                                                       01200000
REG15    EQU   15                                                       01220000
IEHMVERD SAVE  (14,12),T,ERD-SEPT-10-65                                 01240000
         LR    BASE10,REG15            LOAD BASE REG FOR PROGRAM   UL0H 01260017
         USING IEHMVERD,BASE10                                     UL0H 01280017
         ENTRY IEHMVERD                                                 01300000
         USING IEHMVV,REG12                                             01320000
*                                                                       01340000
         USING MORECORE,REG11                                           01360000
         USING GETCORE,REG9                                             01380000
         USING MESSAGES,REG7      BASE FOR ERROR CSECT                  01400000
         GETMAIN  R,LV=124                                              01420000
         LR    REG11,REG1     BASE REG FOR MORECORE DSECT          5219 01440016
         IEHPRE (0,1),TF                                                01460000
         L     REG1,IEHMVV30      ADDRESS OF FROM DCB                   01480000
*                                                                  UL0H 01480617
* ACTIVATE USER INPUT TRAILER LABEL EXIT IF REQUIRED               UL0H 01481217
*                                                                  UL0H 01481817
         CLI   UDCBITLE,DEACTIVE        IS ITLE INACTIVE           UL0H 01482417
         BE    NEXTCODE                 YES,CONTINUE               UL0H 01483017
         MVC   UDCBITLE(4),XXITLE       NO, SET UP ITLE LIST ADDR  UL0H 01483617
NEXTCODE DS    0H                                                  UL0H 01484217
*                                                                  UL0H 01484817
         L     REG2,16(REG1)  KEYLEN FROM DCB IN HIGH ORDER BYTE   5219 01486016
         SRL   REG2,24        KEYLEN IN LOW, ZEROES IN HIGN        5219 01492016
         AH    REG2,62(REG1)  KEY LENGTH + BLOCKSIZE               5219 01498016
         LA    REG1,74        MAXIMUM DIRECTORY ENTRY              5219 01504016
         CR    REG2,REG1      IS (KEYLEN + BLKSIZE) > OR = TO      5219 01510016
         BC    10,HEREYES1              MAX. DIRECTORY ENTRY LEN   5219 01516016
         LA    REG2,74        NO, USE MAX. DIRECTORY ENTRY LEN     5219 01522016
HEREYES1 LA    REG2,238(REG2) SIZE OF GETCORE DSECT                5219 01528016
         LR    REG0,REG2                                                01540000
*                                                                       01560000
*                                                                       01580000
*                                                                       01600000
*ISSUE A GETMAIN FOR GETCORE DSECT. PART OF DSECT WILL CONTAIN THE 5219 01620016
*'FROM' PHYSCICAL RCD OR A DIRECTORY ENTRY IN 'INPUT'.             5219 01640016
*                                                                       01660000
         GETMAIN R,LV=(0)     GET HOWEVER MUCH IS IN REG0               01680000
         LR    REG9,REG1      BASE FOR GETCORE DSECT               5219 01700016
         ST    REG2,HOWMUCH                                             01720000
         SR    REG2,REG2      CLEAR THIS REGISTER                       01740000
         STC     REG2,SAMSW       INITIALIZE THIS SWITCH TO ZERO        01760000
         XC    LLITTR+3(3),LLITTR+3     INIT THIS FIELD TO ZERO  A44360 01770021
RETURN   L     REG8,IEHMVV30      GET ADDRESS OF FROM DCB               01780000
         MVC   33(3,REG8),EODAD+1     ADDRESS OF MY EODAD               01800000
         MVC   57(3,REG8),SYNAD+1                                       01820000
         MVI   SWITCHES,X'10'          INIT THE SWITCH           A44326 01850022
CHUCKRET NI    SWITCHES,X'D8'          RESET EXCEPT BITS 0,1,4,5 A44326 01860022
         LA    REG7,AREALIST    ADDRESS OF WHERE NTELSTS ARE STORED     01880000
         B     CHARLIE                                                  01900000
*                                                                       01920000
*THIS WILL SET A SWITCH TO INDICATE THAT AN ALIAS ENTRY HAS BEEN PASSED 01940000
*AND THAT NO MEMBERS ARE TO BE PASSED.                                  01960000
*                                                                       01980000
SETSW1   OI    SWITCHES,X'20'                                           02000000
         B     NONTELST                                                 02020000
SETSW2   OI    SWITCHES,X'10'   NO NOTE LISTS                           02040000
         B     NONTELST                                                 02060000
CHARLIE  TM    SWITCHES,X'80'      SWITCH,NOP THE FIRST TIME AROUND     02080000
         BC    1,JUMP              GO TO JUMP IF NOT FIRST TIME         02100000
         OI    SWITCHES,X'80'      SET JUMP SWITCH TO BYPASS THIS CODE  02120000
         SR    REG0,REG0           REG0 MUST BE ZERO FIRST TIME THRU    02140000
         BAL   REG14,DSORG    GO TO TEST IF IT'S A BSAM DS              02160000
         B     *+8                 JUMP OVER NEXT TWO INSTRUCTIONS      02180000
JUMP     LR    REG1,REG9           ADDRESS OF INPUT ENTRY AREA IN REG1  02200000
         LR    REG0,REG1          ANYTHING BUT ZERO IN REGO             02220000
         LA    REG15,IEHCWMGN    ADDRESS OF GET MEMBER NAME ROUTINE     02240000
         BALR  REG14,REG15         GO TO GET NAME RTN AND RETURN IN 14  02260000
         B     *+4(REG15)          IF REG15 IS ZERO,RETURN IS NORMAL    02280000
         B     PROCESS             AND WE GO TO PROCESS.                02300000
         B     WRAPUP              NO MORE NAMES, WRAP UP JOB           02320000
         B     MSGRTN              PERMANENT I/O ERROR,WRITE OUT MSG    02340000
*                                                                       02360000
*THIS ROUTINE WILL EXAMINE THE DIRECTORY ENTRY PASSED TO FOR NOTE       02380000
*LISTS AND TAKE APPROPRIATE MEASURES TO PASS RECORDS TO BWRITE          02400000
*                                                                       02420000
*                                                                       02440000
PROCESS  MVC   MEMBER(8),5(REG9)   SAVE MEMBER NAME TO PRINT IT LATER   02460000
         SR    REG1,REG1      CLEAR THIS REGISTER                       02480000
         SR    REG2,REG2      FOR THIS ROUTINE                          02500000
         TM    16(REG9),X'80'    IS THIS DIR ENTRY AN ALIAS?            02520000
         BC    1,SETSW1       YES IT IS AN ALIAS                        02540000
         NI    SWITCHES,X'DF'   SET ALIAS SWITCH OFF IF IT'S ON         02560000
PROCESS1 IC    REG1,16(REG9)   ENTER 'C' BYTE OF DIR ENRTY IN REG1      02580000
         N     REG1,ANDNTLST  AND OUT EVERYTHING EXCEPT BITS 1 AND 2    02600000
         BC    8,SETSW2  RESULT ZERO, NO NOTELISTS                      02620000
         NI    SWITCHES,X'EF'          INDIC NOTELISTS PRESENT   A44326 02630022
         SRL   REG1,5       MOVE NUMBER OF NTELSYS OVER                 02640000
         STC   REG1,NOTELST   STORE NUMB OF TTRN'S IN DIRECT ENTRY      02660000
         SLA   REG1,2         MULT BY 4,NUMB OF BYTS PER NTLST ENTRY    02680000
         BCT   REG1,*+4       SUBTRACT 1 FROM REG1 AND GO TO NSI        02700000
         EX    REG1,MVNTLIST   MOVE NOTELIST PTRS TO GOTTEN CORE        02720000
NONTELST MVC   LLITTR+2(1),ZEROS  CLEAR OUT I BYTE                      02740000
         OI    LLITTR+2,X'C8'   SET IND FOR DIR ENTRY WITH TTR          02760000
         IC    REG1,16(REG9)   ENTER 'C' BYTE OF DIR ENTRY IN REG1      02780000
         N     REG1,ANDUSDTA  AND OUT EVERYTHING EXECPT BITS 3 TO 7     02800000
         SLA   REG1,1         MULTIPLY BY 2, USER DATA IN HALFWORDS     02820000
         LA    REG1,12(REG0,REG1) ADD 12 MORE FOR NAME AND TTRC         02840000
         STH   REG1,LLITTR    STORE LGTH IN LL BYTES OF LLITTR          02860000
         BCT   REG1,*+4  DECREASE REG1 BY ONE                           02880000
         EX    REG1,MVDIRTRY    MOVE DIRECTORY ENTRY TO INPUT           02900000
         BAL   REG14,WRITE    SET UP TIME FOR BWRITE                    02920000
         TM    SWITCHES,X'20'      WAS THIS AN ALIAS ENTRY              02940000
         BC    1,PRTNAME           YES,PRINT ALIAS OF MEMBER UNLOADED   02960000
SWTEST   TM    SWITCHES,X'10'  ANY MORE TTRN'S IN THIS DIR ENTRY        02980000
         BC    1,NOTTRNS           NO,START UNLOADING MEMBERS           03000000
NEXTTTRN CLC   3(1,REG7),ZEROS   IS THIS A NOTE LIST PTR                03020000
         BC    8,CKNEXT    NO, SO CHECK NEXT ONE                        03040000
WRTNEXT  MVC   LLITTR+3(3),0(REG7) LOAD TTR IN INDICATOR                03060000
         L     REG0,0(REG7)   LOAD TTR IN REG0                          03080000
         LR    REG1,REG8           LOAD ADDRESS OF DCB IN REG1 FOR POIN 03100000
         IC    REG0,ZEROS          MAKE N OF TTRN=0 FOR 'POINT'         03120000
         ST    REG0,LASTLIST   TTR OF LAST NOTE LIST WRITTEN            03140000
         LA    REG0,LASTLIST                                            03160000
         POINT (1),(0)             POINT TO NOTE LIST                   03180000
         LA    REG5,INPUT   FOR READ MACRO                              03200000
         MVC   LLITTR+2(1),ZEROS  CLEAR INDICATOE BEFORE NEXT READ      03220000
         LH    REG3,62(REG8)   LOAD BLKSIZE FROM DCB FOR READ           03240000
         READ  INDECB,SF,(8),(5),(3),MF=E                               03260000
         BAL   REG14,CHLIOER      TEST FOR I/O ERROR ON LABEL      UL0H 03270017
         CHECK INDECB                                                   03280000
         SR    REG3,REG3                                         A44326 03281022
         IC    REG3,3(REG7)            GET NBR OF PTRS IN NL     A44326 03282022
         SLL   REG3,2                  MULTIPLY WITH 4           A44326 03283022
         LA    REG3,4(REG3)            ADD 8 FOR LENGTH AND POINTER     03284022
         GETMAIN R,LV=(REG3)                                     A44326 03285022
         NI    SWITCHES,X'EF'          INDIC NOTELIST PRESENT    A44326 03285522
         ST    REG1,NLAREA             SAVE THE ADDRESS          A44326 03286022
         MVC   NLAREA(1),3(REG7)       SAVE THE NBR OF POINTERS  A44326 03287022
         ST    REG3,0(REG1)            SAVE THE SIZE OF THE AREA A44326 03288022
         BAL   REG14,RECLGTH       COMPUTE LGTH OF RECORD READ          03300000
         LA    REG4,INPUT              FIND START OF DATA        A44326 03303022
         SR    REG2,REG2                                         A44326 03306022
         IC    REG2,16(REG8)           FIND  KEYLENGTH           A44326 03309022
         AR    REG4,REG2               FIND START OF TTRX'S      A44326 03312022
         BAL   REG6,MOVETTRX           SAVE THE TTRX'S           A44326 03315022
         OI    SWITCHES,X'01'          INDIC NOTELIST PROCESSED  A44326 03317022
         OI    LLITTR+2,X'D0'   NOTELIST POINTER                        03320000
         BAL   REG14,WRITE         GIVE RECORD TO BWRITE                03340000
NOTTRNS  L     REG0,12(REG9)    LOAD LAST BYTE OF NAME AND TTR          03360000
         SLL   REG0,8         SHIFT IT OVER 8 BITS TO ZERO OUT C   5219 03380016
         IC    REG0,ZEROS          ZERO OUT C OF TTRC                   03400000
         ST    REG0,HOLDTTR                                             03420000
         LR    REG1,REG8      PUT ADDRESS OF DCB IN REG1                03440000
         LA    REG0,HOLDTTR                                             03460000
         POINT (1),(0)        POINT TO START OF MEMBER                  03480000
NEXTMEMB LA    REG5,INPUT  ADDRESS OF INPUY AREA FOR READ MACRO         03500000
         MVC   LLITTR+2(1),ZEROS  CLEAR INDICATOR BYTE FOR NEXT RECORD  03520000
         LH    REG3,62(REG8)   LOAD BLKSIZE FROM DCB FOR READ           03540000
         READ  INDECB,SF,(8),(5),(3),MF=E                               03560000
         BAL   REG14,CHLIOER      TEST FOR I/O ERROR ON LABEL      UL0H 03570017
         CHECK INDECB                                                   03580000
         TM    SAMSW,X'10'     TEST TO SEE IF UNLOAD IS A BSAM DS       03600000
         BC    1,BSAMDS      YES IT IS                                  03620000
         L     REG1,IEHMVV30      LOAD ADDR OF FROM DCB                 03640000
         NOTE  (1)            NOTE WHERE(TTR) RECORD WAS READ FROM      03660000
         ST    REG1,LASTNOTE  STORE NOTED TTR IN HOLD AREA              03680000
         BAL   REG14,RECLGTH  COMPUTE LENGTH OF RECORD READ             03700000
         TM    SWITCHES,X'10' DO WE HAVE TO CHECK FOR NOTELISTS         03720000
         BC    1,SETIND       NO,SO GO AND SET INDICATOR BYTE           03740000
*                                                                A44326 03741022
* CHECK FOR TTRX POINTERS IN THE NOTELIST                        A44326 03742022
NLTTR    DS    0H                                                A44326 03752022
         SR    REG14,REG14                                       A44326 03754022
         IC    REG14,NLAREA            GET NBR OF TTRX'S LEFT    A44326 03756022
         LTR   REG14,REG14             ALL TTRX'S CHECKED        A44326 03756422
         BZ    NLTTRF                  YES CONTINUE              A44326 03756822
         LR    REG2,REG14              SAVE IT                   A44326 03758022
         L     REG3,NLAREA             GET ADDR NL AREA          A44326 03758422
         LA    REG3,4(REG3)            JUMP PAST LENGTH FIELD    A44326 03758822
NLTTRA   DS    0H                                                A44326 03759222
         TM    0(REG3),X'80'           TTRX CHECKED              A44326 03759622
         BO    NLTTRD                  YES CHECK NEXT TTRX       A44326 03759722
         CLI   2(REG3),X'00'           NO  IS TTRX ZERO          A44326 03759822
         BE    NLTTRB                  YES FLAG THIS ONE         A44326 03759922
         CLC   LASTNOTE(3),0(REG3)     TTRX FOUND                A44326 03766622
         BNE   NLTTRC                  NO GO TO NEXT ONE         A44326 03768622
NLTTRB   DS    0H                                                A44326 03770622
         OI    0(REG3),X'80'           FLAG THIS TTRX            A44326 03772622
         BCT   REG2,NLTTRC             GO TO NEXT ONE IF ANY     A44326 03773022
NLTTRE   DS    0H                                                A44326 03773122
         STC   REG2,NLAREA             SAVE NEW TTRX COUNT       A44326 03773222
         B     NLTTRF                  CONTINUE                  A44326 03779922
NLTTRC   DS    0H                                                A44326 03781922
         BCT   REG14,NLTTRD            GO TO NEXT TTRX           A44326 03783922
         B     NLTTRE                  IF ANY                    A44326 03785922
NLTTRD   DS    0H                                                A44326 03786322
         LA    REG3,4(REG3)            POINT TO NEXT TTRX        A44326 03786422
         B     NLTTRA                  AND GO TO CHECK IT        A44326 03786522
NLTTRF   DS    0H                                                A44326 03793222
         CLC   LASTNOTE(4),LASTLIST IS THIS THE NOTELIST WE POINTED TO  03799922
         BC    8,NXTLIST      YES,GO AND GET NEXT NOTELIST IF ANY       03806622
SETIND   MVC   LLITTR+3(3),LASTNOTE   STORE LAST NOTED TTR IN INDICATOR 03813322
         OI    LLITTR+2,X'E0'   SIGNIFIES A MEMBER BEING PASSED         03820000
         BAL   REG14,WRITE    GO TO BWRITE                              03840000
         B     NEXTMEMB       GO AND GET NEXT MEMBER                    03860000
*                                                                  UL0H 03861017
* THIS ROUTINE CHECKS THE I/O ERROR FLAG IEHMVV74+4  THAT MAY BE   UL0H 03862017
* SET IN THE USER TRAILER LABEL EXIT ROUTINE                       UL0H 03863017
*                                                                  UL0H 03864017
CHLIOER  TM    IEHMVV74+4,X'FF'   TEST I/O ERROR FLAG              UL0H 03865017
         BCR   12,REG14           NOT ON - RETURN                  UL0H 03866017
         BAL   REG6,CLEAR         BLANK OUT PRINT BUFFER           UL0H 03867017
         L     REG7,MSGCONST      SET UP BASE REG FOR MSG          UL0H 03868017
         MVC PRINTOUT+1(89),M129  MOVE ERROR MSG TO PRINT BUFFER   UL0H 03869017
         BAL   REG6,GOTOMSGW      GO TO MSG WRITER                 UL0H 03870017
         BR    REG14              RETURN                           UL0H 03871017
*                                                                A44326 03880022
* THIS ROUTINE MOVES THE NOTELIST TO A SAVE AREA                 A44326 03880922
* AND ZEROES THE FIRST BIT OF EACH TTRX                          A52050 03881422
*                                                                A44326 03881822
MOVETTRX DS    0H                                                A44326 03882722
         IC    REG2,3(REG7)                                      A44326 03883622
         SLL   REG2,2                  FIND LENGTH OF TTRX FIELD A44326 03884522
         LA    REG3,256                                          A44326 03885422
MOVEON   DS    0H                                                A44326 03886322
         CR    REG2,REG3               ONE MOVE WILL DO          A44326 03887222
         BNH   PREPMOVE                YES MOVE AND RETURN       A44326 03888122
         BCTR  REG3,REG0               NO                        A44326 03889022
         EX    REG3,MVTTRX             MOVE 256 BYTES            A44326 03889922
         LA    REG3,1(REG3)                                      A44326 03890822
         SR    REG2,REG3               SUBTRACKT COUNTER         A44326 03891722
         AR    REG1,REG3               UPDATE OUTPUT             A44326 03892622
         AR    REG4,REG3               AND INPUT ADDRESSES       A44326 03893522
         B     MOVEON                  GO TO MOVE AGAIN          A44326 03894422
PREPMOVE DS    0H                                                A44326 03895322
         BCTR  REG2,REG0                                         A44326 03896222
         EX    REG2,MVTTRX             MOVE LAST BYTES           A44326 03897122
         IC    REG2,3(REG7)            NBR OF TTRX'S             A52050 03898022
         L     REG3,NLAREA             START OF NL               A52050 03898522
MAKEZERO DS    0H                                                A52050 03899022
         NI    0(REG3),X'7F'           ZERO FIRST BIT            A52050 03899522
         LA    REG3,4(REG3)            POINT TO NEXT ONE         A52050 03899622
         BCT   REG2,MAKEZERO           IF ANY                    A52050 03899722
         BR    REG6                    RETURN                    A52050 03899822
*ROUTINE TO CHECK IF MORE NOTELIST ARE PRESENT IN THE DIRECTORY RECORD  03900000
*AND IF SO POSITION THE POINTER TO ENABLE US TO GET BACK TO THE CORRECT 03920000
*SPOT IN THE MEMBER AFTER GOING OUT TO GET THE NOTELIST.                03940000
*                                                                       03960000
CKNEXT   SR    REG2,REG2                                                03980000
         IC    REG2,NOTELST   NUMBER OF NOTELISTS TO BE PROCESSED PLUS1 04000000
         BCT   REG2,NEXT      DO WE HAVE ANY MORE, IF YES GO TO NEXT    04020000
         TM    SWITCHES,X'01'          NOTELIST SAVED            A44326 04034022
         BO    HOLE                    YES WRITE A HOLE RECORD   A44326 04038022
         OI    SWITCHES,X'10'          NO MORE NOTELISTS         A44326 04048022
NEXT     LA    REG7,4(REG0,REG7)  POINT TO NEXT TTRN                    04060000
         STC   REG2,NOTELST  SET NOTELIST COUNT TO ONE MINUS ORIG.      04080000
         B     SWTEST  LET'S SEE IF ANY MORE TTRN'S                     04100000
NXTLIST  SR    REG2,REG2      CLEAR IT OUT                              04120000
         IC    REG2,NLAREA                                       A44326 04121022
         LTR   REG2,REG2               ALL TTRX'S CHECKED        A44326 04122022
         BZ    CALLFRMN                YES FREE THE NOTELIST     A44326 04123022
         BAL   REG6,CLEAR              NO PREPARE WARNING        A44326 04124022
         LR    REG2,REG7               SAVE TTRN POINTER         A44326 04125022
         L     REG7,MSGCONST           BASE THE MSG CSECT        A44326 04126022
         MVC   PRINTOUT+1(MEND-M329),M329                        A44326 04127022
         LR    REG7,REG2               RESTORE THE TTRN PTR      A44326 04128022
         BAL   REG6,GOTOMSGW           PRINT THE MSG             A44326 04129022
CALLFRMN BAL   REG6,FREENL             GO TO FREEMAIN  NL        A44326 04130022
         SR    REG2,REG2                                         A44326 04131022
         IC    REG2,NOTELST                                             04140000
REDUCE   BCT   REG2,*+8       ANY MORE TTRW ENTRIES                     04160000
         B     HOLE           NO MORE, WRITE HOLE RECORD                04180000
         STC   REG2,NOTELST  SET NOTELIST COUNT TO ONE MINUS ORIG.      04200000
         LA    REG7,4(REG0,REG7)  INCREMENT TO NEXT TTRN                04220000
         B     SETUPTTR       YES,FIX TTR AND GO                        04240000
*                                                                       04260000
*A HOLE RECORD IS WRITTEN IN PLACE OF THE LAST NOTELIST FOUND IN THE    04280000
*DIRECTORY ENTRY. IT WILL BE 20 BYTES LONG WITH THE APPROPRIATE INDICA- 04300000
*TOR BYTES SET.                                                         04320000
*                                                                       04340000
HOLE     OI    LLITTR+2,X'C4' THIS SETS INDICATOR FOR HOLE RECORD       04360000
         MVC   LLITTR(2),CONS20    NUMBER OF BYTES TRANSFERED           04380000
         BAL   REG14,WRITE         WRITE THIS RECORD OUT                04400000
         OI    SWITCHES,X'10'      NO MORE TTRN'S FOR THIS MEMBER       04420000
         NI    SWITCHES,X'FE'          CLEAR NL SWITCH           A44326 04430022
         B     NEXTMEMB            GET NEXT RECORD OF MEMBER            04440000
*  THIS ROUTINE FREEMAINS THE SAVED NOTELIST                     A44326 04442022
FREENL   DS    0H                                                A44326 04444022
         L     REG1,NLAREA             GET ADDR OF AREA          A44326 04446022
         LA    REG1,0(REG1)                                      A44326 04448022
         L     REG0,0(REG1)            GET THE LENGTH            A44326 04450022
         FREEMAIN R,LV=(REG0),A=(REG1)                           A44326 04452022
         BR    REG6                    RETURN                    A44326 04454022
*                                                                       04460000
*THIS ROUTINE WILL SET UP THE TTR OF THE NEXT RECORD OF THE MEMBER TO   04480000
*BE READ AFTER A POINT AND READ IS GIVEN TO GET A NEW NOTELIST RECORD.  04500000
*THIS MECHANISM ENABLES US TO USE THE SAME ROUTINE FOR EVERY SITUATION  04520000
*AND WE DON'T HAVE TO GIVE A POINT AND A DUMMY READ.                    04540000
*                                                                       04560000
SETUPTTR IC    REG2,LASTNOTE+2     THE R PART OF THE TTR OF THE LST NTE 04580000
         LA    REG2,1(REG0,REG2)  UP THE R BY ONE                       04600000
         STC   REG2,LASTNOTE+2     RETURN THE UPDATED R TO HOLD AREA    04620000
         MVC   13(3,REG9),LASTNOTE  MOVE THIS TTR TO DIRECT TTR         04640000
         B     NEXTTTRN                                                 04660000
*                                                                       04680000
*ROUTINE TO COMPUTE LENGTH OF RECORD JUS READ                           04700000
*                                                                       04720000
RECLGTH  SR    REG4,REG4           CLEAR REG4                           04740000
         L     REG2,INDECB+16    ADDRESS OF IOB                         04760000
         LH    REG3,14(REG2)       LOAD RESIDUAL COUNT FROM CSW IN REG3 04780000
         IC    REG4,16(REG8)       LOAD KEYLENGTH,MIGHT BE 0, IN REG4   04800000
         AH    REG4,62(REG8)       ADD BLOCKSIZE TO KEY LENGTH          04820000
         SR    REG4,REG3           HOW MUCH KEY AND DATA TRANSMITTED    04840000
         STH   REG4,LLITTR         STORE IN INDICATOR BYTES LL          04860000
         LR    REG3,REG14                                               04880000
         LR    REG14,REG3                                               04900000
         BR    REG14               GO BACK TO MAIN LINE                 04920000
*                                                                       04940000
*THIS ROUTINE WILL SET UP THE APPROPRIATE REGISTERS FOR THE BWRITE RTN  04960000
*                                                                       04980000
*                                                                       05000000
WRITE    TM    SWITCHES,X'40' IS THE FIRST TIME SWITCH ON               05020000
         BC    1,OTHRTIMS     YES IT IS, BYPASS SOME INSTRUCTIONS       05040000
         OI    SWITCHES,X'40' SET THE SWITCH FOR EVERY OTHER TIME THRU  05060000
OTHRTIMS SR    REG0,REG0      OTHER CALL INDICATOR REG0=0               05080000
         LA    REG1,LLITTR   ADDRESS OF INPUT AREA FOR BWRIET           05100000
         L     REG15,BWRITE   BWRITE CONTAINS ADDRESS OF IEHMVERM       05120000
         LR    REG5,REG14                                               05140000
         BALR  REG14,REG15                                              05160000
         LR    REG14,REG5                                               05180000
         MVC   LLITTR+2(1),ZEROS  SET UP FOR NEXT RECORD                05200000
         B     *+4(REG15)     INTERROGATING THE RETURN CODES IN REG15   05220000
         B     0(REG14)       GOOD RETURN                               05240000
         B     MSGRTN1        PERMANENT I/O ERROR                       05260000
*                                                                       05280000
* THIS ROUTINE WILL TAKE CARE OF RECLGTHS ON BSAM SET THE IBDICATOR     05300000
*  AND WRITE OUT THE RECORD                                             05320000
*                                                                       05340000
DSORG    TM    26(REG8),X'02'    IS THIS DS A PDS                       05360000
         BCR   1,REG14     IF ONES THEN IT IS A PDS                     05380000
         OI    SAMSW,X'10'   THIS SAYS THAT THE UNLOAD IS A BSAM DS     05400000
         OI    SWITCHES,X'10'     INDIC NO NOTELIST              A44326 05410022
         B     NEXTMEMB                                                 05420000
BSAMDS   BAL   REG14,RECLGTH     GO TO COMPUTE LENGTH OF RECORD READ    05440000
         OI    LLITTR+2,X'82'      INDICATOR FOR A BSAM DS              05460000
         BAL   REG14,WRITE    GO AND WRITE THIS RECORD                  05480000
         MVI   LLITTR+2,X'00'    CLEAR INDICATOR BYTE FOR A BSAM DS     05500000
         B     NEXTMEMB                                                 05520000
*                                                                       05540000
*THIS ROUTINE WILL LOAD THE MSG NUMBER IN A REGISTER AND GO TO MSGWRTER 05560000
*                                                                       05580000
MSGRTN   BAL   REG6,CLEAR    CLEAR OUT PRINT OUT AREA                   05600000
         L     REG7,MSGCONST     SET UP BASE REG FOR MSG CSECT          05620000
         MVC   PRINTOUT+1(47),M126   ERROR MSG TO PRINT BUFFER          05640000
         BAL   REG6,GOTOMSGW             GO TO MESSAGE WRITER           05660000
MSGWERR  OI    IEHMVV20+2,X'40'    SET MID-ABORT BIT                    05680000
         B     SKIPJR                                                   05700000
MSGRTN1  BAL   REG6,CLEAR    CLEAR OUT PRINT BUFFER                     05720000
         L     REG7,MSGCONST     SET UP BASE REG FOR MSG CSECT          05740000
         MVC   PRINTOUT+1(49),M127   ERROR MSG TO PRINT BUFFER          05760000
         L     REG1,IEHMVV21+4   ADDRESS OF DSNAME                      05780000
         MVC   PRINTOUT+50(44),0(REG1)   MOVE DSNAME TO ERROR MSG       05800000
         BAL   REG6,GOTOMSGW    GO TO MSG WRITER                        05820000
         B     MSGWERR                                                  05840000
SINAD    BAL   REG6,CLEAR   CLEAR OUT PRINT BUFFER                      05860000
         L     REG7,MSGCONST   SET UP BASE FOR MSG CSECT                05880000
         MVC   PRINTOUT+1(48),M189    ERROR MSG TO PRINT BUFFER         05900000
         L     REG1,IEHMVV21     ADDRESS OF DSNAME                      05920000
         MVC   PRINTOUT+49(44),0(REG1)    MOVE DSNAME TO ERROR MSG      05940000
         BAL   REG6,GOTOMSGW    GO TO MSG WRITER                        05960000
         B     MSGWERR                                                  05980000
IEHCWMGN TM    SWITCHES,X'08'     FIRST TIME THRU GET MEMBER            06000000
         BC    1,SECOND       NO GO TO SECOND                           06020000
         OI    SWITCHES,X'08'     SET FIRST TIME THRU SWITCH            06040000
         SR    REG0,REG0      REQUIREMENT FIRST TIME THRU               06060000
         B     SECOND+2                                                 06080000
SECOND   LR    REG0,BASE10      LOAD IT POSITIVE                        06100000
         STM   REG2,REG5,IEHMVV00    SAVE REGISTERS                     06120000
         LR    REG5,REG14          SAVE RETURN                          06140000
         IC    REG4,SWITCHES       SAVE SW                              06160000
         SLL   REG4,8                                                   06180000
         IC    REG4,SAMSW                                               06200000
         LA    REG3,IEHMVV00+16                                         06220000
         LR    REG2,REG0           LOAD FIRST TIME IND                  06240000
         LINK   EP=IEHMVESR        GO TO GET MEMBER                     06360000
         STC   REG4,SAMSW                                               06580000
         SRL   REG4,8                                                   06600000
         STC   REG4,SWITCHES       REINSTATE SW                         06620000
         LR    REG14,REG5          RESTORE RETURN                       06640000
         MVC   0(87,REG9),IEHMVV00+16                                   06680000
         LM    REG2,REG5,IEHMVV00  RESET REG                            06700000
         BR    REG14                                                    06720000
*                                                                       06740000
*ROUTINE THAT WILL PRINT THE NAME OF THE MEMBER THAT WAS UNLOADED       06760000
*                                                                       06780000
PRTNAME  TM    SAMSW,X'10'    IS THIS A BSAM DS                         06800000
         BC    1,WRAPUP   IF YES GO TO WRAPUP                           06820000
         BAL   REG6,CLEAR      CLEAR PRINT BUFFER                       06840000
         L     REG7,MSGCONST     SET UP BASE REG FOR MSG CSECT          06860000
         MVC   M128+6(8),MEMBER    MOVE MEMBER NAME TO LOG MSG          06880000
         MVC   PRINTOUT+1(32),M128     MOVE ERROR MSG TO PRONT BUFFER   06900000
         BAL   REG6,GOTOMSGW             GO TO MESSAGE WRITER           06920000
         NI    44(REG8),X'00'   SO I CAN READ AGAIN                     06940000
         B     CHUCKRET   RETURN TO SET SWITCHES FOR NEXT MEMBER        06960000
*                                                                       06980000
* ROUTINE TO GO TO MESSAGE WRITER AND INTEEROGATE ITS RETURN CODE       07000000
*                                                                       07020000
GOTOMSGW ST    REG3,IEHMVV00+128       SAVE REG 3                       07040000
         LA    REG3,PRINTOUT           LOAD ADDR OF PRINT AREA          07060000
         LINK EP=IEHMVESU              GO TO MSG WTR                    07080000
         L     REG3,IEHMVV00+128        RESTORE REG 3                   07100000
         B     *+4(REG15)     INTERROGATE RETURN CODE                   07120000
         BR    REG6          RETURN CODE OF ZERO EVERYTHING OK          07140000
         B     MSGWERR         PERM I/O ERROR ON SYSPRINT               07160000
*                                                                       07180000
*CLEAR RTN TO CLEAR PRINT BUFFER BEFORE MOVUNG MSG IN                   07200000
*                                                                       07220000
CLEAR    MVI   PRINTOUT,X'40' MOVE A BLANK IN FIRST POS OF PRNT BUF     07240000
         MVC   PRINTOUT+1(120),PRINTOUT  CLEAR OUT THE WHOLE BUFFER     07260000
         BR    REG6                                                     07280000
*                                                                       07300000
*THIS ROUTINE WILL WRAPUP THE PROGRAM. THIS WILL TELL BWRITE WE ARE ALL 07320000
*DONE AND WILL RETURN CONTROL TO STEM.                                  07340000
*                                                                       07360000
WRAPUP   LPR   REG0,BASE10  LAST TIME INDICATOR TO BWRITE               07380000
         BAL   REG14,OTHRTIMS+2 GO TO BWRITE FOR LAST TIME              07400000
SKIPJR   TM    SWITCHES,X'10'          NOTELIST IN CORE          A44326 07420022
         BO    SKIPFRM                 NO  SKIP FREEMAIN         A44326 07425022
         BAL   REG6,FREENL             YES FREE THE NOTELIST     A44326 07430022
SKIPFRM  LR    REG1,REG11              ADDR OF MORECORE          A44326 07435022
         FREEMAIN  R,LV=124,A=(1)                                       07440000
         LR    REG1,REG9     ADDRESS OF WHERE TO FREE CORE FROM         07460000
         L     REG0,HOWMUCH     # OF BYTES TO FREE                      07480000
         FREEMAIN R,LV=(0),A=(1)   FREE CORE MAN                        07500000
         IEHPOST (0,1),T                                                07520000
         LA    REG2,WRAPJR    SET UP XCTL                               07540000
         L     REG14,12(REG0,REG13)                                     07560000
         XCTL  (2,12),EPLOC=(2)                                         07580000
MVNTLIST MVC   AREALIST(1),17(REG9)   MOVE NOTELISTS                    07600000
MVDIRTRY MVC   INPUT(1),5(REG9)   MOVE DIRECTORY ENTRY                  07620000
MVTTRX   MVC   4(1,REG1),0(REG4)       MOVE TTRX'S FROM NOTELIST A44326 07630022
ZEROS    DC    F'0'                                                     07640000
NUMB     DC    X'00'                                                    07660000
CONS4    DC    F'4'                                                     07680000
ANDNTLST DC    X'00000060'      USED TO GET NUMBER OF TTRN'S            07700000
ANDUSDTA DC    X'0000001F'      USED TO GET AMOUNT OF USER DATA         07720000
WRAPJR   DS    0D                                                       07740000
         DC    C'IEHMVESN'     ENTRY POINT IN WRAPUP                    07760000
CONS20   DC    H'20'      PLACED IN LL OF LLITTR FOR HOLE REC.          07780000
BWRITE   DC    A(IEHMVERM)    ADDRESS OF BWRITE MODULE                  07800000
EODAD    DC    A(PRTNAME)    FOR EOD IN DCB                             07820000
SYNAD    DC    A(SINAD)     FOR SINAD IN DCB                            07840000
MSGCONST DC    A(MESSAGES)     ADDRESS OF ERROR MSG CSECT               07860000
         EXTRN IEHMVERM                                                 07860617
XXITLE   DC    X'00'                   INPUT TRAILER LABEL         UL0H 07861217
         DC    AL3(ITLR)                    ROUTINE EXIT           UL0H 07861817
*                                                                  UL0H 07862417
*     USER     INPUT     TRAILER     LABEL     EXIT     ROUTINE    UL0H 07863017
*                                                                  UL0H 07863617
ITLR     DS    0H                                                  UL0H 07864217
OFFSET1  EQU   ITLR-IEHMVERD                                       UL0H 07864817
         LA    REG4,OFFSET1            SET UP                      UL0H 07865417
         SR    REG15,REG4              ADDRESSABILITY              UL0H 07866017
         LR    BASE10,REG15            FOR EXIT ROUTINE            UL0H 07866617
         L     REG4,0(0,REG1)           GET ADDR OF LABEL READ     UL0H 07867217
*                            FOR LATER MOVE TO USER                UL0H 07867817
         LTR   REG4,REG4                ARE USER LABELS PRESENT    UL0H 07868417
         BNE   IOERR                    YES. CHECK IF OK           UL0H 07869017
NOLABEL  DS    0H                                                  UL0H 07869617
         SR    REG15,REG15              NO, RETURN CODE 0 TO EOV   UL0H 07870217
*                                         TO IGNORE ADDITIONAL LAB UL0H 07870817
         BR    REG14                    RETURN TO EOV              UL0H 07871417
*                                                                  UL0H 07872017
IOERR    DS    0H                                                  UL0H 07872617
         CLI   8(REG1),X'80'            PERM ERROR FROM PARAM LIST UL0H 07873217
         BNE   TRKAVAIL                 NO. CHECK FOR TRACK AVAIL  UL0H 07873817
LABERR   DS    0H                                                  UL0H 07874417
         OI    IEHMVV74+4,X'FF'   SET I/O ERROR FLAG               UL0H 07875017
         BR    REG14                    RETURN TO EOV OPERATION    UL0H 07875617
TRKAVAIL DS    0H                                                  UL0H 07876217
         CLI   IEHMVV72+10,X'FF'        DA+NLT FLAG ON             UL0H 07876817
*                            INDICATES NO U.L. TRK ALLOCATED       UL0H 07877417
         BNE   CORAVAIL                 NO PROCESS LABELS          UL0H 07878017
*  OUTPUT MESSAGE - NO USER LABELS MOVE/COPIED.  NO LABEL TRACK.   UL0H 07878617
*                                                                  UL0H 07879217
         MVI   IEHMVV72+14,X'FF'        TELL CLOSE TO OUTPUT MSG   UL0H 07879817
         MVI   UDCBITLE,X'00'           DEACTIVATE LABEL EXIT      UL0H 07880417
         MVI   UDCBOTLE,X'00'           DEACTIVATE LABEL EXIT      UL0H 07881017
         B     NOLABEL                 GO RETURN CODE=ZERO TO EOV  UL0H 07881617
*                                                                  UL0H 07882217
CORAVAIL DS    0H                                                  UL0H 07882817
         CLC   IEHMVV72(4),ALLZEROS     CORE OBTAINED FOR LABELS   UL0H 07883417
         BNE   INITIAL                  YES, INITIALIZE POINTERS   UL0H 07884017
         GETMAIN R,LV=640              GET CORE FOR LABELS         UL0H 07884617
         ST    REG1,IEHMVV72           SAVE POINTER TO GOTTEN CORE UL0H 07885217
INITIAL  DS    0H                                                  UL0H 07885817
         CLC   0(4,REG4),UTL1DEF        IS THIS 1ST LABEL IN SET   UL0H 07886417
         BNE   SAVLABEL                NO, GO AROUND 1ST LBL SETUP UL0H 07887017
         MVC   IEHMVV72+4(4),IEHMVV72   SET POINTER TO LABEL SAVLOCUL0H 07887617
         MVI   IEHMVV72+12,X'00'        CLEAR LABEL COUNTER        UL0H 07888217
*                                                                  UL0H 07888817
SAVLABEL DS    0H                                                  UL0H 07889417
         L     REG6,IEHMVV72+4          GET ADDRESS OF CURRENT     UL0H 07890017
*                                         LABEL SAVEAREA           UL0H 07890617
         MVC   0(80,REG6),0(REG4)       SAVE LABEL IN GOTTEN CORE  UL0H 07891217
         LA    REG6,80(REG0,REG6)       UPDATE POINTER TO NEXT LO- UL0H 07891817
         ST    REG6,IEHMVV72+4            CATION IN LABEL SAVEAREA UL0H 07892417
         SR    REG4,REG4                 UPDATE                    UL0H 07893017
         IC    REG4,IEHMVV72+12           LABEL                    UL0H 07893617
         LA    REG4,1(REG4)                COUNTER                 UL0H 07894217
         STC   REG4,IEHMVV72+12             BY ONE                 UL0H 07894817
         LA    REG15,4                  RETURN CODE OF 4 TO EOV    UL0H 07895417
*                                         TO GET ADDITIONAL LABELS UL0H 07896017
         BR    REG14                    RETURN TO EOV              UL0H 07896617
*                                                                  UL0H 07897217
ALLZEROS DC    1F'0'                                               UL0H 07897817
UTL1DEF  DC    CL4'UTL1'                                           UL0H 07898417
DEACTIVE EQU   X'00'                                               UL0H 07899017
MESSAGES CSECT                                                          07900000
M126     DC    CL8'IEH372I '                                            07920000
         DC    CL32'I/O ERROR ENCOUNTERED IN WORK DA'                   07940000
         DC    CL7'TA SET.'                                             07960000
M127     DC    CL8'IEH326I '                                            07980000
         DC    CL32'I/O ERROR ENCOUNTERED IN OUTPUT '                   08000000
         DC    CL9'DATA SET '                                           08020000
M128     DC    CL32'MEMBR          HAS BEEN UNLOADED'                   08040000
M129     DC    CL29'PERM I/O ERROR WHILE READING '                 UL0H 08045017
         DC    CL30'USER INPUT TRAILER LABELS. NO '                UL0H 08050017
         DC    CL30'MORE LABELS WILL BE PROCESSED.'                UL0H 08055017
M189     DC    CL8'IEH389I '                                            08060000
         DC    CL32'I/O ERROR ENCOUNTERED IN INPUT D'                   08080000
         DC    CL8'ATA SET '                                            08100000
M329     DC    CL8'IEH329I'                                      A44326 08105022
         DC    C'A TTR IN A NOTELIST CANNOT BE UPDATED'          A44326 08110022
MEND     DS    0C                                                A44326 08115022
*                                                                       08120000
*THIS IS THE WAY THE MOVE/COPY COMMUNICATION TABLE WILL LOOK AS FAR AS  08140000
*THE UNLOAD PDS IS CONCERNED.                                           08160000
*                                                                       08180000
*                                                                       08200000
MORECORE DSECT                                                          08220000
SWITCHES DS    CL1                 USED FOR SWITCHES IN THE PROGRAM     08240000
INDECB   DS    6F     WHERE INPUT DECB IS TO BE LODGED                  08260000
NOTELST  DS    FL1     NUMBER OF NOTELISTS OR TTRN'S                    08280000
LASTNOTE DS    F       TTR OF LAST RECORD READ                          08300000
LASTLIST DS    F     TTR OF LAST NOTE LIST                              08320000
AREALIST DS    3F      WHERE TTRN'S ARE TO BE LODGED                    08340000
HOLDTTR  DS    F                                                        08360000
NLAREA   DS    F                       ADDR OF TTRX PTR IN NL    A44326 08370022
GETCORE  DSECT                                                          08380000
         DS    CL88     WHERE GET MEMBER PUTS DIR ENTRY                 08400000
TTRNPTR  DS    F    CONTENTS OF REG13 POINTING TO NOTELISTS             08420000
HOWMUCH  DS    1F                                                       08440000
SAMSW    DS    FL1    BSAM SWITCH                                       08460000
PRINTOUT DS    31F         MSG WRITER BUFFER                            08480000
MEMBER   DS    2F                                                       08500000
LLITTR   DS    CL6                 USED AS AN INDICATOR TO BWRITE       08520000
INPUT    DS    1H                                                       08540000
         IEHMVV                                                         08560000
         ORG   IEHMVV70                                            UL0H 08566017
         IEHDCBXL                                                  UL0H 08572017
         END                                                            08580000
./  ADD  SSI=70280025,NAME=IEHMVSRK
 TITLE 'IEHMVSRK-READS UNLOADED REC-IEHMOVE LOAD MOD ETA,ETL,ERA,ESX'   00007017
*FUNCTION/OPERATION: THIS MODULE READS UNLOADED RECORDS AND           * 00014017
*RECONSTRUCTS THE ORIGINAL DATA SET.                                  * 00021017
*IF USER LABEL PROCESSING WAS REQUESTED, AT END-OF-DATA OR VOLUME     * 00028017
*SWITCH TIME THIS MODULE WILL GETMAIN IF NECESSARY FOR A LABEL        * 00035017
*SAVEAREA. THE SAVED LABELS WILL THEN BE PASSED TO IEHMVSSN TO BE     * 00042017
*OUTPUT DURING DATA SET WRAP-UP.                                      * 00049017
*DATA SET                                                             * 00060000
*ENTRY POINTS: IEHMVERK                                               * 00080000
*INPUT: ONE PHYSICAL RECORD; OPEN DCB OF UNLOAD DATA SET              * 00100000
*OUTPUT: LOGICAL RECORDS IN UNLOADED FORMAT TO UNLOAD DATA SET        * 00120000
*EXTERNAL ROUTINES: NONE                                              * 00140000
*EXITS-NORMAL RETURN TO CALLING ROUTINE                               * 00160000
*ERRORS: I/O ERROR                                                    * 00180000
*TABLES/WORK AREAS: BREAD TABLE-CONTAINS POINTERS TO OUTPUT RECORDS.  * 00200000
*ATTRIBUTES: REUSEABLE                                                * 00220000
*NOTES: NONE                                                          * 00240000
*                                                                       00260000
*                                                                       00280000
*                                                                       00300000
*                                                                       00320000
*                   BREAD                                               00340000
*                                                                       00360000
*                                                                       00380000
*                                                                       00400000
*                                                                       00420000
IEHMVSRK CSECT                                                          00440000
*3050 000200-000400,004600                                         UL0H 00460017
*                                                                       00480000
IEHMVERK SAVE  (14,12),T,SRK-OCT-14                                     00500000
*                                                                       00520000
         IEHPRE  ,TFC                                                   00540000
*                                                                       00560000
         LR    REG5,REG15               SET UP BASE                     00580000
         USING IEHMVERK,REG5            INFORM ASSEMBER                 00600000
         USING IEHMVV,REG12             INFORM ASSEMBER OF IEHMVV DSECT 00620000
*                                                                       00640000
*                                                                       00660000
         LTR   REG0,REG0           IS THIS FIRST TIME IN                00680000
         BM    FIRSTIN             YES                                  00700000
*                                                                       00720000
*                                                                       00740000
         EJECT                                                          00760000
*                                                                       00780000
*                                                                       00800000
*                                                                       00820000
*                   SECTION FOR EQU'S                                   00840000
*                                                                       00860000
*                                                                       00880000
*                                                                       00900000
*                                                                       00920000
*                        REGISTERS                                      00940000
REG0     EQU   0                        FIRST TIME IN SWITCH            00960000
REG1     EQU   1                        PASSED PARAMETER                00980000
REG2     EQU   2                        BREAD DSECT                     01000000
REG3     EQU   3                        LENGTH                          01020000
REG4     EQU   4                        POINTER TO OUT AREA             01040000
REG5     EQU   5                        BASE REGISTER                   01060000
REG6     EQU   6                                                        01080000
REG7     EQU   7                                                        01100000
REG8     EQU   8                                                        01120000
REG9     EQU   9         USED MAINLY FOR     B80       IO               01140000
REG10    EQU   10                            M80       CUR80            01160000
REG11    EQU   11                            L80       ENDIO            01180000
REG12    EQU   12                                                       01200000
REG13    EQU   13                                                       01220000
REG14    EQU   14                                                       01240000
REG15    EQU   15                                                       01260000
*                                                                       01280000
*                                                                       01300000
*                                                                       01320000
*                                                                       01340000
         EJECT                                                          01360000
*                                                                       01380000
*                                                                       01400000
*                                                                       01420000
*                                                                       01440000
*                   MAIN STEM                                           01460000
*                                                                       01480000
*                                                                       01500000
END      EQU   X'01'               END OF FILE INDICATOR                01520000
TTR      EQU   X'80'               TTR INDICATOR                        01540000
RTNFIRST DS    0H                                                       01560000
         L     REG2,IEHMVV60            SET UP PERMANENT WORK AREA      01580000
         USING BREAD,REG2                    POINTER                    01600000
         LR    REG4,REG1                SET UP REG4 AS POINTER TO       01620000
*                                            RECORD BUILD AREA TO       01640000
*                                            PRESERVE REG1              01660000
*                                                                       01680000
         LA    REG3,3                   GO TO ROUTINE MOVE TO GET       01700000
         BAL   REG14,MOVE                    AN  LLI TO KNOW LENGTH     01720000
*                                            OF RECORD                  01740000
         TM    2(REG1),END         IS THIS END OF FILE                  01760000
         BO    MEOD                    YES RETURN EOF INDICATION        01780000
*                                                                       01800000
*                                                                       01820000
*                                                                       01840000
         SR    REG3,REG3           GET LL OF RECORD TO BE MOVED         01860000
         IC    REG3,0(REG1)                                             01880000
         SLL   REG3,8                                                   01900000
         IC    REG3,1(REG1)                                             01920000
*                                                                       01940000
         TM    2(REG1),TTR         IS THERE A TTR IN RECORD             01960000
         BZ    *+8                      NO, DO NOT ADD 3 TO LENGTH      01980000
         LA    REG3,3(0,REG3)           YES, ADD 3 TO LENGTH OF RECORD  02000000
*                                                                       02020000
         BAL   REG14,MOVE               GO TO MOVE ROUTINE TO GET       02040000
         SR    REG15,REG15                   BASIC RECORD               02060000
THISISRT DS    0H                                                       02080000
*                                                                       02100000
         IEHPOST  ,TFC                                                  02120000
*                                                                       02140000
*                                                                       02160000
*                                                                       02180000
         RETURN (14,12),T,RC=(15)                                       02200000
         EJECT                                                          02220000
*                                                                       02240000
*                                                                       02260000
*                                                                       02280000
*                   MOVE ROUTINE - TO MOVE NUMBER OF BYTES GIVEN        02300000
*                                  IN REG3 TO OUT AREA                  02320000
*                                                                       02340000
*                                                                       02360000
MOVE     DS    0H                                                       02380000
         LM    REG9,REG11,B80           GET CURRANT POINTERS FOR        02400000
*                                            80 BYTE AREA               02420000
*                                                                       02440000
XX       DS    0H                                                       02460000
         SR    REG11,REG10              CALCULATE NUMBER OF BYTES       02480000
*                                            LEFT IN THIS 80 BYTE       02500000
*                                            BUFFER                     02520000
         CR    REG11,REG3               ARE THERE ENOUGH BYTES IN BUF   02540000
         BL    HAVEGET                    NO, GO TO HAVEGET             02560000
*                                         YES, MOVE TO OUT AREA         02580000
         LA    REG9,0(REG10,REG3)       SET UP NEXT MID BUFFER POINTER  02600000
         ST    REG9,M80                                                 02620000
         LA    REG9,0(REG4,REG3)        UP OUTAREA POINTER              02640000
*                                                                       02660000
         BCTR  REG3,0                   SET UP LENGTH FOR MOVE          02680000
         EX    REG3,M                   MOVE CARACTERS TO OUT AREA      02700000
*                                                                       02720000
         LR    REG4,REG9                SET UP OUT AREA POINTER         02740000
         BR    REG14                    RETURN TO CALLER                02760000
*                                                                       02780000
*                                                                       02800000
*                                                                       02820000
*                                                                       02840000
*                                                                       02860000
HAVEGET  SR    REG3,REG11               CALCULATE LENGTH TO BE LEFT     02880000
*                                            TO MOVE AFTER THIS MOVE    02900000
         LA    REG9,0(REG4,REG11)       UP OUTPUT POINTER               02920000
         LTR   REG11,REG11                                              02940000
         BZ    NOEX                                                     02960000
    BCTR   REG11,0    SET  UP  LENGTH  FOR MOVE                         02980000
         EX    REG11,M                  MOVE CHARACTERS TO OUT AREA     03000000
*                                                                       03020000
NOEX     LR    REG4,REG9                OUTPUT POINTER                  03040000
         B     E80                      GO TO ROUTINE TO GET NEXT       03060000
*                                            80 BYTE BUFFER             03080000
RTF80    DS    0H                  RETURN FROM ROUTINE TO GET AREA      03100000
*                                            REG9 CONTAINS BUF POINTER  03120000
         LA    REG10,2(0,REG9)          SET UP POINTER TO FIRST         03140000
*                                           BYTE TO BE USED IN BUFFER   03160000
         LA    REG11,80(0,REG9)         SET UP POINTER TO LAST OF       03180000
*                                            BUFFER                     03200000
         STM   REG9,REG11,B80           STORE POINTERS                  03220000
         B     XX                       RETURN TO TOP OF ROUTINE        03240000
*                                                                       03260000
*                                                                       03280000
*                                                                       03300000
*                                                                       03320000
*                                                                       03340000
*                                                                       03360000
*                                                                       03380000
*                                                                       03400000
         EJECT                                                          03420000
*                                                                       03440000
*                                                                       03460000
*                                                                       03480000
*                   ROUTINE TO INITIALIZE FOR FIRST ENTRY               03500000
*                                                                       03520000
FIRSTIN  DS    0H                                                       03540000
*                                                                  UL0H 03542017
* ACTIVATE USER INPUT TRAILER LABEL EXIT IF REQUIRED               UL0H 03544017
*                                                                  UL0H 03546017
         CLI   UDCBITLE,DEACTIVE        IS ITLE INACTIVE           UL0H 03548017
         BE    NEXTCODE                 YES,CONTINUE               UL0H 03550017
         MVC   UDCBITLE(4),XXITLE       NO, SET UP ITLE LIST ADDR  UL0H 03552017
NEXTCODE DS    0H                                                  UL0H 03554017
*                                                                  UL0H 03556017
         L     REG2,IEHMVV10            GET POINTER TO WORK AREA        03560000
         LA    REG3,1                                                   03580000
         STM   REG2,REG3,IEHMVV60       SET UP PS                       03600000
         LA    REG8,28(0,REG2)                                          03620000
         ST    REG8,IEHMVV10            RESET PERMANENT WORK            03640000
         LM    REG8,REG9,IEHMVV30       GET DECB                        03660000
         L     REG9,12(0,REG9)          GET IO AREA                     03680000
         LR    REG11,REG9               GET END IO                      03700000
         LR    REG10,REG9               GET CUR80 POINTER               03720000
         AH    REG11,62(0,REG8)              AREA POINTER               03740000
         STM   REG9,REG11,IO            SET UP IO AREA POINTERS         03760000
         LR    REG11,REG10                   POINTERS                   03780000
         STM   REG9,REG11,B80                                           03800000
         SR    REG0,REG0                ZERO FIRST TIME IN SWITCH       03820000
         B     RTNFIRST                 RETURN                          03840000
*                                                                       03860000
*                                                                       03880000
*                                                                       03900000
*                                                                       03920000
*                                                                       03940000
*                                                                       03960000
*                                                                       03980000
*                                                                       04000000
         EJECT                                                          04020000
*                                                                       04040000
*                                                                       04060000
*                                                                       04080000
*                   SECTION TO  GET 80 BYTE AREAS                       04100000
*                                                                       04120000
*                                                                       04140000
*                                                                       04160000
E80      DS    0H                                                       04180000
         LM    REG9,REG11,IO            GET IO AREA POINTERS            04200000
*                                                                       04220000
         LA    REG10,80(0,REG10)        UP CUR80 BUFFER POINTER TO      04240000
         ST    REG10,CUR80                   NEXT AREA                  04260000
         CR    REG10,REG11              ARE THERE MORE 80 BYTE BUFFERS  04280000
*                                                                       04300000
         BL    RT80                     NO, RETURN RECORD               04320000
*                                                                       04340000
         LM    REG10,REG11,IEHMVV30     GET FROM DCB AND DECB           04360000
        LA     REG11,0(REG11)   CLEAR HIGH ORDER BYTE                   04380000
         ST    REG9,CUR80               USE IO AREA AS CUR80 BUFFER     04400000
*                                                                       04420000
         MVC   57(3,REG10),SYNAD        SET UP SYNAD                    04440000
         MVC   33(3,REG10),EOD               AND EOD                    04460000
     LR   REG7,REG1                                                     04480000
*                                                                       04500000
    LR   REG6,REG14                                                     04520000
         READ  (REG11),SF,(REG10),(REG9),'S',MF=E                       04540000
         CLI   IEHMVV74+4,X'FF'         I/O ERR IN U.L. EXIT RTN   UL0H 04544017
         BE    IOERRMSG                 YES, TELL USER             UL0H 04548017
ERMSGRET DS    0H                                                  UL0H 04552017
*                                                                       04556017
         CHECK (REG11)                  CHECK THE READ                  04560000
*                                                                       04580000
     LR  REG14,REG6                                                     04600000
     LR   REG1,REG7                                                     04620000
*                                                                       04640000
YY       EQU   *                                                        04660000
         LH    REG6,0(0,REG9)           GET PS NUMBER                   04680000
         LH    REG7,IEHMVV60+6                                          04700000
         LA    REG7,1(0,REG7)           PS  OK                          04720000
         STH   REG7,IEHMVV60+6     IF REG7 OVER X'8000'            7185 04740000
         LH    REG7,IEHMVV60+6      SET TO NEGATIVE                7185 04760000
         CR    REG7,REG6                                                04780000
         BNE   BOOM                                                     04800000
         B     RTF80                    RETURN                          04820000
*                                                                       04840000
RT80     LR    REG9,REG10               SET UP CURRANT BUF POINTER      04860000
         B     YY                                                       04880000
*                                                                       04900000
BOOM     LA    REG15,12                 INDICATE ERROR IN PS            04920000
         B     THISISRT                      AND RETURN                 04940000
*                                                                       04960000
*                                                                       04980000
*                                                                       05000000
*                                                                       05020000
MSYNAD   LA    REG15,8                  INDICATE IO ERROR               05040000
         B     THISISRT                      AND RETURN                 05060000
MEOD     LA    REG15,4                  INDICATE EOD                    05080000
         B     THISISRT                      AND RETURN                 05100000
         EJECT                                                          05120000
*                                                                       05140000
*                                                                       05160000
*                   SECTION FOR CONSTANTS                               05180000
*                                                                       05200000
*                                                                       05220000
*                                                                       05240000
         ENTRY IEHMVERK                                                 05260000
M        MVC   0(1,REG4),0(REG10)                                       05280000
*                                                                       05300000
SYNAD    DC    AL3(MSYNAD)                                              05320000
EOD      DC    AL3(MEOD)                                                05340000
*                                                                  UL0H 05340117
XXITLE   DC    X'03'                   INPUT TRAILER LABEL         UL0H 05340217
         DC    AL3(ITLR)               EXIT ROUTINE EXLIST ENTRY   UL0H 05340317
*                                                                  UL0H 05340417
*  USER  INPUT  TRAILER  LABEL  EXIT  ROUTINE                      UL0H 05340517
*                                                                  UL0H 05340617
ITLR     DS    0H                                                  UL0H 05340717
OFFSET1  EQU  ITLR-IEHMVERK                                        UL0H 05340817
         LA    REG8,OFFSET1            SET UP                      UL0H 05340917
         SR    REG15,REG8              ADDRESSABILITY              UL0H 05341017
         LR    REG5,REG15              FOR THE EXIT ROUTINE        UL0H 05341117
         L     REG8,0(0,REG1)           GET ADDR OF LABEL READ     UL0H 05341317
*                            FOR LATER MOVE TO USER                UL0H 05341517
         LTR   REG8,REG8                ARE USER LABELS PRESENT    UL0H 05341717
         BNE   IOERR                    YES. CHECK IF OK           UL0H 05341917
*                                                                  UL0H 05342117
NOLABEL  DS    0H                                                  UL0H 05342317
         MVI   UDCBITLE,X'00'           DEACTIVATE LABEL EXIT      UL0H 05342517
         MVI   UDCBOTLE,X'00'           DEACTIVATE LABEL EXIT      UL0H 05342717
         OI    IEHMVV20+2,X'40'        SET MIDABORT BIT TO TELL    UL0H 05343017
*                                      VESN THIS IS END OF ACTION  UL0H 05343317
         SR    REG15,REG15              NO, RETURN CODE 0 TO EOV   UL0H 05343517
*                                         TO IGNORE ADDITIONAL LAB UL0H 05343717
         BR    REG14                    RETURN TO EOV              UL0H 05343917
*                                                                  UL0H 05344117
IOERR    DS    0H                                                  UL0H 05344317
*                                                                  UL0H 05344517
*                                                                  UL0H 05344717
         TM    8(REG1),X'80'           IO ERR FLAG ON IN PARM LIST UL0H 05344917
         BC    14,TRKAVAIL             NO, GO SEE IF HAVE U.L. TRK UL0H 05345117
*                                                                  UL0H 05345317
LABERR   DS    0H                                                  UL0H 05345517
         OI    IEHMVV74+4,X'FF'         YES, SET FLAG TO OUTPUT    UL0H 05346117
*                                        MSG AFTER OPEN/CLOSE/EOV  UL0H 05346717
         B     NOLABEL                 RETURN TO EOV PROCESSING    UL0H 05347517
*                                                                  UL0H 05347717
TRKAVAIL DS    0H                                                  UL0H 05347917
         CLI   IEHMVV72+10,X'FF'        DA+NLT FLAG ON             UL0H 05348117
*                            INDICATES NO U.L. TRACK ALLOCATED     UL0H 05348317
         BNE   CORAVAIL                 NO PROCESS LABELS          UL0H 05348517
*                                                                  UL0H 05348717
*  OUTPUT MESSAGE - NO USER LABELS MOVE/COPIED.  NO LABEL TRACK.   UL0H 05348917
*                                                                  UL0H 05349117
         MVI   IEHMVV72+14,X'FF'        TELL CLOSE TO OUTPUT MSG   UL0H 05349317
         B     NOLABEL                 GO RETURN CODE=ZERO         UL0H 05349517
*                                                                  UL0H 05349717
CORAVAIL DS    0H                                                  UL0H 05349917
         CLC   IEHMVV72(4),ALLZEROS     CORE OBTAINED FOR LABELS   UL0H 05350117
         BNE   INITIAL                  YES, INITIALIZE POINTERS   UL0H 05350317
         GETMAIN R,LV=640              GET CORE FOR LABELS         UL0H 05350517
         ST    REG1,IEHMVV72           SAVE POINTER TO GOTTEN CORE UL0H 05350717
INITIAL  DS    0H                                                  UL0H 05350917
         CLC   0(4,REG8),UTL1DEF       1ST LABEL IN SET            UL0H 05351117
         BNE   SAVLABEL                NO, BYPASS 1ST LABEL SETUP  UL0H 05351317
         MVC   IEHMVV72+4(4),IEHMVV72   SET POINTER TO LABEL SAVLOCUL0H 05351517
         MVI   IEHMVV72+12,X'00'        CLEAR LABEL COUNTER        UL0H 05351717
*                                                                  UL0H 05351917
SAVLABEL DS    0H                                                  UL0H 05352117
         L     REG1,IEHMVV72+4          GET ADDRESS OF CURRENT     UL0H 05352317
*                                         LABEL SAVEAREA           UL0H 05352517
         MVC   0(80,REG1),0(REG8)       SAVE LABEL IN GOTTEN CORE  UL0H 05352717
         LA    REG1,80(REG0,REG1)       UPDATE POINTER TO NEXT LO- UL0H 05352917
         ST    REG1,IEHMVV72+4            CATION IN LABEL SAVEAREA UL0H 05353117
         SR    REG8,REG8                 UPDATE                    UL0H 05353317
         IC    REG8,IEHMVV72+12           LABEL                    UL0H 05353517
         LA    REG8,1(REG8)                COUNTER                 UL0H 05353717
         STC   REG8,IEHMVV72+12             BY ONE                 UL0H 05353917
         LA    REG15,4                  RETURN CODE OF 4 TO EOV    UL0H 05354117
*                                         TO GET ADDITIONAL LABELS UL0H 05354317
         BR    REG14                    RETURN TO EOV              UL0H 05354517
*                                                                  UL0H 05354717
*                                                                  UL0H 05354917
MSG01    DS    0H                                                  UL0H 05355117
         LINK  EP=IEHMVESU                                         UL0H 05355317
         BR    REG9                    RETURN TO ITLR AND EOV      UL0H 05355517
*                                                                  UL0H 05355717
*                                                                  UL0H 05355917
ALLZEROS DC    1F'0'                                               UL0H 05356117
UTL1DEF  DC    CL4'UTL1'                                           UL0H 05356317
DEACTIVE EQU   X'00'                                               UL0H 05356517
SAVE14   DS    F                       AREA TO SAVE EOV RETURN     UL0H 05356817
*                                                                  UL0H 05357117
MOVER    MVC   1(1,REG1),0(REG3)       EXECUTED MOVE MESSAGE INST  UL0H 05357417
*                                                                  UL0H 05357717
*                                                                  UL0H 05358017
         DS    0F                                                  UL0H 05358317
AMSG1    DC    AL1(MSG2-MSG1-1)        INPUT TRLR LBL I/O ERROR    UL0H 05358617
         DC    AL3(MSG1)               MESSAGE LENGTH, ADDRESS     UL0H 05358917
IOERRMSG DS    0H                                                  UL0H 05758917
         NI    IEHMVV74+4,X'00'        RESET I/O ERROR SWITCH      UL0H 06158917
         ST    REG14,SAVE14             SAVE EOV RETURN ADDRESS    UL0H 06558917
         L     REG3,AMSG1               GET ADDRESS OF MESSAGE     UL0H 06958917
         IC    REG2,AMSG1               GET LENGTH OF MESSAGE      UL0H 07358917
         LR    REG1,REG12               GET ADDR OF PRINT BUFFER   UL0H 07758917
         MVI   0(1),X'40'               BLANK OUT                  UL0H 08158917
         MVC   1(120,1),0(1)             PRINT BUFFER          R   UL0H 08558917
         EX    2,MOVER                  MOVE MESSAGE TO BUFFER      L0H 08958917
         BAL   REG9,MSG01               GO TO MESSAGE WRITER        L0H 09358917
         L     REG14,SAVE14             RELOAD EOV RETURN ADDRESS   L0H 09758917
         B     ERMSGRET                 RETURN TO INLINE PROCESSINGUL0H 10158917
*                            SECTION FOR DSECTS                         11360017
*                                                                       14360017
BREAD    DSECT                                                          17360017
IO       DS    F                       BEGINNING OF I/O AREA            20360017
CUR80    DS    F                       CURRENT 80 BYTE AREA             23360017
ENDIO    DS    F                       END OF I/O AREA                  26360017
B80      DS    F                       START OF CURRENT 80 AREA         29360017
M80      DS    F                       RELATIVE POINTER                 32360017
L80      DS    F                       END OF CURRENT 80 AREA           35360017
         IEHMVV                                                         38360017
         ORG   IEHMVV70                                            UL0H 41360017
         IEHDCBXL                                                  UL0H 44360017
IEHMVMRK CSECT                                                     UL0H 47360017
*******************************************************************UL0H 50360017
*                                                                  UL0H 53360017
*                       MESSAGE CSECT FOR IEHMVSRK                 UL0H 56360017
*                                                                  UL0H 59360017
*******************************************************************UL0H 62360017
*                                                                  UL0H 65360017
MSG1     DC    CL41'IEH333I PERM I/O ERROR WHILE READING USER'     UL0H 68360017
         DC    CL42' INPUT TRAILER LABELS. NO MORE LABELS WILL'    UL0H 71360017
         DC    CL14' BE PROCESSED.'                                UL0H 74360017
*                                                                  UL0H 77360017
MSG2     DC    X'00'                                               UL0H 80360017
*                                                                  UL0H 83360017
         END                                                            89460017
./  ADD  SSI=70280026,NAME=IEHMVSRM
*TITLE:  IEHMVSRM                                                       00020000
*FUNCTION/OPERATION: THIS CODE HANDLES THE FUNCTION OF WRITING DATA     00040000
*SETS IN THE UNLOADED FORMAT. IT WILL CONVERT THE OUTPUT TO 80        * 00060000
*CHARACTER RECORDS, WHICH INCLUDE CONTROL CHARACTERS USED DURING        00080000
*SUCCESSIVE LOAD OPERATIONS                                             00100000
*ENTRY POINTS: IEHMVERM                                               * 00120000
*INPUT: IT IS PASSED THE DATA TO BE WRITTEN VIA AN ADDRESS IN REG 1     00140000
*OUTPUT: 80 CHARACTER RECORDS IN EITHER BLOCKED OR UNBLOCKED FORMAT   * 00160000
*EXTERNAL ROUTINES: NONE                                              * 00180000
*EXITS: NORMAL EXIT TO CALLING ROUTINE                                  00200000
*                                                                       00220000
*ERRORS: EXIT TO CALLING ROUTINE                                        00240000
*TABLES/WORK AREAS: NONE                                              * 00260000
*ATTRIBUTES: SERIALLY REUSEABLE                                       * 00280000
IEHMVSRM CSECT                                                          00300000
*A008400                                                        OY01180 00302016
*A017200,C020600,027200,A028180                                  A44360 00305021
*3001014400,021800,028200                                          9677 00310014
TESTZ    EQU   0                                                        00320000
* 009200-009400                                                  A27588 00330019
PTA      EQU   1                                                        00340000
PTB      EQU   2                                                        00360000
P1       EQU   3                                                        00380000
P2       EQU   4                                                        00400000
GR5      EQU   5                                                        00420000
GR6      EQU   6                                                        00440000
GR7      EQU   7                                                        00460000
GR8      EQU   8                                                        00480000
GR9      EQU   9                                                        00500000
GR10     EQU   10                                                       00520000
GR11     EQU   11                                                       00540000
CTABLEPT EQU   12                                                       00560000
SAREAPT  EQU   13                                                       00580000
RETN     EQU   14                                                       00600000
RCODE    EQU   15                                                       00620000
TTR      EQU   X'80'                                                    00640000
IEHMVERM SAVE  (2,12),T,ERM-8-31-65-10AM                                00660000
         ENTRY IEHMVERM                                                 00680000
         LR    GR11,RCODE               SET UP REG 11 AS                00700000
         USING IEHMVERM,GR11              PROGRAM BASE REG              00720000
         USING IEHMVV,CTABLEPT          SET UP ADDRESSABILITY TO THE    00740000
*                                         COMMUNICATIONS TABLE          00760000
         LR    GR5,PTA                  REG 5 NOW CONTAINS THE POINTER  00780000
*                                         TO THE RECORDS IN CORE THAT   00800000
*                                         ARE TO BE PUT                 00820000
        IEHPRE ,TFC                                                     00840000
         L     GR10,ADCB                SET UP                  OY01180 00846016
         MVC   57(3,GR10),SINAD+1    MOVE SYNAD ADDR TO DCB     OY01180 00852016
         LTR   TESTZ,TESTZ              TEST FIRST LAST SWITCH          00860000
         BM    INIT                     FIRST TIME IN                   00880000
         BP    FILL                     LAST TIME IN                    00900000
BACK     XC    LENGSAVE(4),LENGSAVE    CLEAR OUT 4 BYTES FOR     A27588 00910019
         MVC   LENGSAVE+2(2),0(GR5)    MOVE LENGTH INTO LAST TWO A27588 00920019
*                                      BYTES OF FIELD, TO KEEP   A27588 00930019
*                                      LENGTH FROM GOING NEGATIVEA27588 00940019
         L     PTB,LENGSAVE            LOAD LENGTH               A27588 00950019
         TM    2(GR5),TTR          TEST FOR TTR                         00960000
         BO    ADD6                     YES THIS RECORD HAS A TTR       00980000
         LA    PTB,3(0,PTB)             ADD 3 FOR LLI                   01000000
A        AR    PTB,GR5                  INITILIZE PTB                   01020000
B        LA    P1,80                                                    01040000
         LH    GR6,IEHMVV60+2           LOAD K INTO REG 6               01060000
         SR    P1,GR6                   CALCULATE P1                    01080000
         LR    P2,PTB                                                   01100000
         SR    P2,GR5                   CALCULATE P2                    01120000
         CR    P2,P1                    COMPARE REG 4 AND REG 3         01140000
         BL    D                        BRANCH IF P2 IS LESS THAN P1    01160000
         BH    CONT                                                     01180000
         TM    LLI+3,X'01'      LAST TIME SW ON                         01200000
         BO    D       YES                                              01220000
CONT     LR    GR7,P1                                                   01240000
         BCTR  GR7,0                    REDUCE REG 7 BY ONE TO SETUP    01260000
*                                         EXECUTE OF MOVE INSTRUCTION   01280000
         L     GR8,IEHMVV60+4           REG 8 NOW POINTS TO THE NEXT    01300000
*                                         OUTPUT BUFFER                 01320000
         AR    GR8,GR6                  REG 8 NOW POINTS TO NEXT        01340000
*                                         AVAILABLE AREA IN OUTPUT      01360000
*                                         BUFFER                        01380000
         EX    GR7,C                    MOVE DATA INTO OUTPUT BUFFER    01400000
         AR    GR5,P1                   UP THE PTA                      01420000
REESTAB  LA    GR6,2                   REINITIALIZE K              9677 01440014
         STH   GR6,IEHMVV60+2           STORE A 2 IN K                  01460000
         LH    GR6,IEHMVV60             UP COUNT OF                     01480000
         LA    GR6,1(0,GR6)               P.S.                          01500000
         STH   GR6,IEHMVV60               BY ONE                        01520000
         L     GR7,IEHMVV60+4           REG 7 NOW POINTS TO THE NEXT    01540000
*                                         OUTPUT BUFFER                 01560000
         STH   GR6,0(GR7)               STORE TWO BYTE P.S. IN          01580000
*                                         BEGINNING OF BUFFER           01600000
         L     PTA,ADCB                 LOAD ADDRESS OF DCB IN REG 1    01620000
         PUT   (1)                                                      01640000
         ST    PTA,IEHMVV60+4           STORE ADDRESS OF NEXT OUTPUT    01660000
*                                         BUFFER                        01680000
         CR    P2,P1                    COMPARE REG 4 AND REG 3         01700000
         BNE   B                       CONTINUE                  A44360 01720021
         TM    LLI+3,X'01'             LAST RECORD WRITTEN       A44360 01730021
         BO    WRAPUP                  YES FORMAT LAST RECORD    A44360 01740021
         B     RETSET                  NO RETURN TO CALLER       A44360 01750021
SINAD    DC    A(E1)      SYAAD ADDR TO BE PUT IN DCB                   01760000
E1       LA    RCODE,4                  SET UP RETURN CODE FOR          01780000
*                                         PERMANENT I/O ERRORS          01800000
         B     RET                                                      01820000
INIT     L     GR10,ADCB                SET UP                          01840000
         MVC   57(3,GR10),SINAD+1    MOVE SYNAD ADDR TO DCB             01860000
         L     PTA,ADCB                 LOAD ADDRESS OF DCB IN REG 1    01880000
         PUT   (1)                                                      01900000
         ST    PTA,IEHMVV60+4           STORE ADDRESS OF FIRST OUTPUT   01920000
*                                         BUFFER                        01940000
         LA    GR6,2                                                    01960000
         STH   GR6,IEHMVV60+2           STORE A 2 IN K                  01980000
         SR    GR6,GR6                                                  02000000
         STH   GR6,IEHMVV60             INITILIZE P.S. TO ZERO          02020000
         B     BACK                                                     02040000
EXEC1    XC    0(1,GR10),0(GR10)       PAD BUFFER WITH ZEROES    A44360 02060021
*                                                                       02080000
*                                                                       02100000
FILL   EQU   *                                                          02120000
         SR    0,0    TURN OFF LAST TIME IND                            02140000
         OI    LLI+3,X'01'    TURN ON LAST TIME SW                      02160000
         CLI   IEHMVV60+3,X'4D'        ROOM FOR LLI IN BUFF        9677 02180014
         BH    INCRESE    NO CHANGE CT TO 20                            02200000
NOW      LA    1,LLI    SET UP EOD INDICATOR                            02220000
         LR    5,1                                                      02240000
         B     BACK                                                     02260000
INCRESE  OI    LLI+1,X'14'   SET COUNT TO 20                            02280000
         B     NOW                                                      02300000
LENGSAVE DS    F                                                 A27588 02310019
LLI     DC    X'00000100'                                               02320000
EIGHTY   DC    H'80'                                               9677 02330014
ADD6     LA    PTB,6(0,PTB)             ADD 6 FOR LLI AND TTR           02340000
         B     A                                                        02360000
C        MVC   0(1,GR8),0(GR5)          EXECUTE MOVE OF NUMBER OF BYTES 02380000
*                                         (EITHER P1 OR P2) TO OUTPUT   02400000
*                                         BUFFER + K FROM PTA           02420000
D        LR    GR7,P2                                                   02440000
         BCTR  GR7,0                    REDUCE REG 7 BY ONE TO SETUP    02460000
*                                         EXECUTE OF MOVE INSTRUCTION   02480000
         L     GR8,IEHMVV60+4           REG 8 NOW POINTS TO THE NEXT    02500000
*                                         OUTPUT BUFFER                 02520000
         AR    GR8,GR6                  REG 8 NOW POINTS TO NEXT        02540000
*                                         AVAILABLE AREA IN OUTPUT      02560000
*                                         BUFFER                        02580000
         EX    GR7,C                    MOVE DATA INTO OUTPUT BUFFER    02600000
         LH    GR6,IEHMVV60+2           LOAD K INTO REG 6               02620000
         AR    GR6,P2                   UP K TO NEW VALUE               02640000
         CH    GR6,EIGHTY              IS BUFF FULL                9677 02645014
         LR    P2,P1                   TO BRANCH TO RESET          9677 02650014
         BE    REESTAB                 BUFF IS FULL                     02655014
         STH   GR6,IEHMVV60+2           STORE K                         02660000
         TM    LLI+3,X'01'      LAST TIME SW ON                         02680000
         BZ   RETSET     NO                                             02700000
WRAPUP   LH    GR6,IEHMVV60            LOAD P.S. COUNT           A44360 02720021
         LA    GR6,1(0,GR6)    INCREMENT BY ONE                         02740000
         L     GR7,IEHMVV60+4    LOAD BUFFER ADD                        02760000
         STH   GR6,0(GR7)   PUT P.S. CT IN BUFFER                       02780000
RETSET   SR    RCODE,RCODE              SET UP NORMAL RETURN CODE       02800000
RET      TM    LLI+3,X'01'             LAST TIME SW ON             9677 02806014
         BZ    DONE                    SWITCH NOT ON               9677 02812014
         L     GR10,IEHMVV60+4         ADDR OF OUTPUTBUFFER      A44360 02818021
         LH    GR6,IEHMVV60+2          NBR OF BYTES USED         A44360 02819021
         AR    GR10,GR6                START OF PADDING AREA     A44360 02820021
         LA    GR7,79                  80 MINUS 1 FOR EX         A44360 02821021
         SR    GR7,GR6                 LENGTH OF PADD AREA       A44360 02822021
         EX    GR7,EXEC1               PAD LAST REC WITH ZEROES  A44360 02823021
         NI    LLI+1,X'00'             TURN OFF REC LENGTH       A44360 02824021
         NI    LLI+3,X'00'            TURN OFF LAST TIME SWITCH  A44360 02825021
DONE     IEHPOST ,TC                                                    02830014
        RETURN (14,12),T,RC=(15)                                        02840000
         DROP  GR11,CTABLEPT                                            02860000
         IEHMVV                                                         02880000
ADCB     EQU   IEHMVV31                                                 02900000
         END                                                            02920000
./  ADD  SSI=80880104,NAME=IEHMVSRV
 TITLE 'IEHMVSRV-IEHMOVE COPY-UNLOAD-LOAD-ABORT ROUTINE'          10943 00020014
*FUNCTION/OPERATION: THIS MODULE DETERMINES IF THE DATA SET UNDER     * 00040000
*CONSIDERATION CAN BE MOVED OR UNLOADED OR NEITHER.                   * 00060002
*ENTRY POINTS: IEHMVESV                                               * 00100000
*INPUT: NONE                                                          * 00120000
*OUTPUT: SWITCH SETTINGS IN MOVE/COPY COMMUNICATIONS TABLE            * 00140000
*EXTERNAL ROUTINES: NONE                                              * 00160000
*EXITS-NORMAL RETURN TO CALLING ROUTINE-IEHMVSRZ                      * 00180000
*ERRORS I/O ERROR; SECURITY DATA SET IN DSGROUP; BDAM UNMOVEABLE      * 00200000
*TRACK OVERFLOW ERRORS  MORE THAN 5 VOLUMES                             00220000
*DATA SET                                                             * 00240000
*MESSAGES: MESSAGES WHICH CAN BE PRINTED DUE TO TESTS IN THIS MODULE *  00240515
*          ARE THESE:                                                *  00241015
*                                                                    *  00241515
*   DATA SET -                                                       *  00242015
*              UNLOADED BECAUSE -                                    *  00242515
*                                 I/O ERROR ON FROM VOLUME           *  00243015
*                                                                    *  00243515
*                                 SECURITY PROTECTED                 *  00244015
*                                                                    *  00244515
*                                 DATA SET MARKED UNMOVEABLE         *  00245015
*                                                                    *  00245515
*                                                                    *  00246015
*                                                                    *  00246515
*              NOT MOVED/COPIED BECAUSE -                            *  00247015
*                                    ACCESS METHOD NOT COMPATIBLE    *  00247515
*                                                                    *  00248015
*                                    RECORD LENGTH NOT COMPATIBLE    *  00248515
*                                                                    *  00249015
*                                    DATA SET MARKED UNMOVEABLE      *  00249515
*                                                                    *  00250015
*                                    SUBORDINATE REQUEST WHILE LOADING  00250515
*                                                                    *  00251015
*                                                                    *  00251515
*                                                                    *  00252015
*                                                                    *  00254515
*   IEH450I REQUEST TERMINATED BECAUSE DATA SET SPANS MORE THAN 5 VOL.  00255015
*                                                                    *  00255515
*   TRACK OVERFLOW FEATURE REQUESTED/REQUIRED ON DEVICE THAT DOES    *  00256015
*   NOT HAVE TRACK OVERFLOW                                          *  00256515
*                                                                    *  00257015
****    ****    ****    ****    ****    ****    ****    ****    ****    00257515
*TABLES/WORK AREAS: NONE                                              * 00260000
*ATTRIBUTES: REUSEABLE                                                * 00280000
*  NOTES  THIS MODULE IS PART OF LOAD MODULE  IEHMVESX                  00300000
*        THIS MODULE TEST FOR TRACK OVERFLOW FEATURE USED/REQUESTED     00320000
*        AND IN THE UNIT BEFORE A DECISION IS MADE TO UNLOAD    YA01696 00340002
IEHMVSRV CSECT                                                  YA01696 00341002
*C040700                                                       @ZA28978 00341299
*A100496                                                       @ZA24602 00342899
*D027500-027520,027540-027560                                  @ZA13732 00343099
*A023100-023120                                                @ZA13711 00343700
*A088300-088780                                                @ZA04396 00347103
*D088300-088850                                                @ZA04396 00349803
*A090460-090520                                                @ZA03378 00352503
*C030000                                                       @ZA01733 00355203
*D 032930-032960                                               @ZA01656 00357902
*A032930-032940                                                @ZA01239 00360602
*A027500-027560                                                @ZA01234 00363302
*D027500-027600,139700-139720,147500                           @ZA01234 00366002
*A028200-028600                                                 YA01696 00368702
*D028200-028600                                                         00371402
*A032940                                                        YA01671 00374102
*C102100,105600,106000                                          YA01218 00376802
*                                                                       00379502
*                                                                       00382202
*                                                                       00384902
*                                                                       00387602
*A083620-083720                                                 OY01193 00390302
*D100000-100200,C100220,A100530                                  A50960 00393002
*A100244,100248                                                  A48802 00395722
*C100300                                                         A48802 00398422
*065400                                                          A45188 00401122
*A103300-103388,132900                                           A45144 00403822
*A080600,D085400,A085500,D085600-085800,086400,A086500           A37919 00406522
* 006400-007000,008000-008400                                    A44302 00409222
* 027800                                                         A32041 00411922
*                                                                A32032 00414622
* 112000-112800,119400-120000                                    A30084 00417319
*                                                                A29052 00420019
*088400,088800-089000,089250-089300                              A25286 00460119
* 045250,046000,046200-048400,146250                             A25631 00460219
*                                                                A22664 00460518
* 114000-116600,117600-119200,120200-120800                      A17911 00461018
*                                                                A17911 00462018
* 059400,089400                                                  A21645 00463018
*                                                                A21645 00464018
*  042600-043800                                                 A35460 00464520
*A040700,040720,134900                                           A35460 00464921
*                                                                  UL0H 00465017
*0055 004000,025000,025400-026000,066200,146800                    UL0H 00470017
*                                                                  UL0H 00475017
*                                                                  0310 00477002
*0055  110800-111800                                               0310 00479002
*                                                                  0310 00479402
*C600,12000,16000                                               YL026VC 00479802
*D800,2525-2540,10220,10380,12200-12400,12800-13400,67200-69200 YL026VC 00479902
*D70130-70160,123200-131600,132200-132600,133000                YL026VC 00481602
*A27500-27580,139700-139720,147500                              YM07033 00483602
*C27600                                                         YM07033 00484002
*A39100                                                         YM06314 00484402
*A010220-010284,013100-013200,067100-067400                    @Z40CSJH 00484804
*A070120-070140,083620-083680,123100-123400                    @Z40CSJH 00484904
*A130600,131000,132683-132787,133000                           @Z40CSJH 00489904
IEHMVESV SAVE  (14,12),T,IEHMVSRV-OZ28978                      @ZA28978 00495099
         ENTRY IEHMVESV                                                 00500000
         LR    BASE,LINK                                                00520000
         USING IEHMVV,MCTABLE                                           00540000
         USING DSCBDSEC,DSCB                                            00560000
         USING IEHMVESV,BASE                                            00580000
         IEHPRE (14,1),TFC                                              00600000
         USING IEHMVV,MCTABLE                                           00620000
* OBTAIN FROM AND TO DEVICE TYPE CODES                           A44302 00630021
          STM  DEV14,DEV1,DEVSAVE                                       00720000
         L     DEV14,IEHMVV30+12   ADDRESS OF FROM DDNAME.              00740000
         LA    DEV1,0(0,DEV14)                                          00760000
         DEVTYPE (1),DEVT1         OBTAIN  UCB DEVICE TYPE.   (FROM)    00780000
         L     DEV14,IEHMVV31+8    RETRIEVE ADDRESS  OF  TO  DDNAME.    00860000
         LA    DEV1,0(0,DEV14)                                          00880000
         DEVTYPE  (1),DEVT2        OBTAIN UCB DEVICE TYPE    (TO)       00900000
IEHMVRSA LM    DEV14,DEV1,DEVSAVE                                       00920000
*                                       TEST SECURITY ROUTINE           00940000
         B     IEHMVESM                                                 00960000
IEHMVRSM DS  0H                   LOAD TEST ROUTINE                     00980000
         B     IEHMVERH                                                 01000000
IEHMVRRH DS  0H                   ACCESS METHOD TEST                    01020000
**********************************************************************  01022004
*                                                                       01022404
* LINES 010300-010396 WERE REACTIVATED IN                      @Z40CSJH 01024004
* SUPPORT OF THE EXTENDED MVS CVOL FUNCTION                    @Z40CSJH 01026004
*                                                                       01028004
**********************************************************************  01028404
         TM    IEHMVV20,CATALOG+FROM IS UNLOADED CATALOG EXPECTED 10943 01030004
         BC    14,IEHMVESW             NO, BRANCH                 10943 01032004
         TM    IEHMVV20+1,LOAD         HAS LOAD CONDITION BEEN SET10943 01034004
         BO    IEHMVESW                YES, BRANCH                10943 01036004
*                                      NO, WRITE ERROR MSG        10943 01038004
         MVI   IEHMVV61,FROMERR        MSG NUMBER                 10943 01038404
         L     LINK,PREAB              SET UP TO PREABORT         10943 01038804
         BR    LINK                                               10943 01039204
*                                                                 10943 01039604
         B     IEHMVESW                                                 01040000
IEHMVRSW DS  0H                                                         01060000
*                                                                       01080000
         TM    IEHMVV20+1,UNLOAD        UNLOAD CONDITION                01100000
         BO    IEHMVRTE           YES,SKIP TEST RECORD LENGTH           01120000
*                                                                       01140000
*                                       RECORD LENGTH TEST              01160000
         B     IEHMVETE                                                 01180000
IEHMVRTE DS  0H                   CHECK FOR LOAD CONDITION      YL026VC 01200002
*                                                                       01260000
         TM    IEHMVV20+1,CATLG    CATALOG REQUEST             @Z40CSJH 01310004
         BO    YESCATLG            YES                         @Z40CSJH 01320004
RTNCATLG DS  0H                   CHECK FOR LOAD CONDITION              01330004
*                                                                       01340004
         TM    IEHMVV20+1,LOAD          IS THIS A LOAD CONDITION        01360000
         BO    IEHMVESL           YES,GO TO UNMOVEABLE TEST             01380000
         L     ACCE,IEHMVV22+4                                          01400000
         CLI   2(ACCE),DASD             FROM DEVICE DASD                01420000
         BNE   IEHMVRSL           NO,OMIT UNMOVEABLE TEST               01440000
*                                                                       01460000
*                                       UNMOVEABLE TEST                 01480000
         B     IEHMVESL                                                 01500000
IEHMVRSL DS  0H                   PREPARE TO LEAVE ROUTINE              01520000
*                                                                       01540000
        IEHPOST (14,1),TC                                               01560000
*                                                                       01580000
         MVC   12(4,SAVE),MNOP    SET RETURN TO COPYRTN IN IEHMVSRZ     01600002
         RETURN (14,12),T                                               01620000
GOOUT    L     LINK,PREAB                                               01640000
         BR    LINK                                                     01660000
*                                                                       01680000
*                                                                       01700000
MNOP     DC    A(COPYRTN)                                               01720000
         EXTRN COPYRTN                                                  01740000
         EJECT                                                          01760000
*                                                                       01780000
IEHMVERH DS  0H     THIS IS A LOAD TEST ROUTINE. IF PHYSICAL SEQUENTIAL 01800000
*                   ORGANIZATION, A JFCB IS READ AND THE DATA SET IS    01820000
*                    OPENED. A TEST IS MADE FOR UNLOADED DATA SET OR    01840000
*                   THE DSCB IS FILLED                                  01860000
*                   NORMAL EXIT IS TO IEHVESW                           01880000
         L     ACCE,IEHMVV22+4          FROM DEVICE DASD                01900000
         CLI   2(ACCE),DASD                                             01920000
         BNE   LTOPEN                   NO, GO TO OPEN DATA SET         01940000
*                                                                       01960000
*                                       YES, TEST ACCESS METHOD         01980000
         L     DSCB,IEHMVV30+8          GET DSCB POINTER                02000000
         CLI   DS1DSORG,BSAM            DSORG EQUAL PHYSICAL SEQ.       02020000
         BE    LTOPEN                                                   02040000
*                                                                       02060000
         CLI   DS1DSORG,AZERO     NO,TEST FOR NO ORGANIZATION GIVEN     02080000
         BE    LTOPEN             YES,BRANCH TO OPEN                    02100000
*                                                                       02120000
*                                                                       02140000
LTRETURN DS  0H                   BRANCH TO ACCESS METHOD TEST          02160000
*                                                                       02180000
         B     IEHMVRRH                                                 02200000
*                                                                       02220000
*                                                                       02240000
*                                                                       02260000
*                                                                       02280000
LTOPEN   DS  0H                   OPEN J                                02300000
         TM    IEHMVV20+5,X'40'        UNLOAD REQUEST          @ZA13711 02310099
         BO    IEHMVRRH                YES,BRANCH              @ZA13711 02312099
         L     ACCE,IEHMVV10            GET PTR TO PER WORK AREA        02320000
         LA    ACCO,96(ACCE)            UP PTR                          02340000
         ST    ACCO,IEHMVV10            YES, CONTINUE, STORE PER WORK   02360000
         ST    ACCE,IEHMVV30            STORE DCB PTR                   02380000
         L     ACCO,LENGTHDC            MOVE DCB                        02400000
         EX    ACCO,MOVELT                                              02420000
         LR    M7,ACCE                                                  02440000
         ST    M7,IEHMVV30              SET UP FROM DCB POINTER         02460000
         L     M5,IEHMVV30+12                                           02480000
         LA    ACCE,IEHMVV70                                       UL0H 02500017
         ST    ACCE,DCBEXLST-IHADCB(0,M7)    EXIT LIST POINTER          02520000
         LA    ACCE,IEHMVV00                                            02540000
         ST    ACCE,UDCBJFCB           SET UP JFCB POINTER         UL0H 02550017
         MVI   UDCBJFCB,X'87'          FLAG AS JFCB DCBEXLST ENTRY UL0H 02560017
         MVC   UDCBDCBE(4),DCBXX       SET UP DCB ENTRY IN EXLIST  UL0H 02570017
         MVC   UDCBIHLE(4),ADIHLR      SET UP INPUT HDR LBL RTN    UL0H 02580017
         MVI   UDCBIHLE,ACTIVIHL       ENTRY IN DCB EXLIST         UL0H 02590017
         TM    IEHMVV20+3,FRDDKEY FROMDD KEYWORD                        02620000
         BO    FROMDD              YES                                  02640000
*                                                                       02660000
*                                                                       02680000
         MVI   IEHMVV00,AZERO     ZERO AREA FOR JFCB IN WORK AREA       02700000
         MVC   IEHMVV00+1(175),IEHMVV00                                 02720000
         MVI   JFCBLTYP,LABEL     INDICATE LABELED TAPE                 02740000
         MVI   JFCBIND2,X'40'    SET DISP OLD                  @ZA01234 02753002
FROMBACK EQU   *                                                        02763020
         TM    JFCBLTYP,SL             STANDARD LABEL                   02766020
         BNO   FDSN               *B IF NO-USE EXISTING RECFM    A32041 02769020
*                                                        BLKSIZE A32041 02772020
*                                                        LRECL   A32041 02775020
         XC    JFCRECFM(1),JFCRECFM  ELSE ZERO JFCB FIELDS SO    A32041 02778020
         XC    JFCDSORG(1),JFCDSORG         DCB FIELDS WILL      A32041 02781020
         XC    JFCBLKSI(2),JFCBLKSI         BE FILLED FROM THE   A32041 02784020
         XC    JFCLRECL(2),JFCLRECL         STANDARD LABEL       A32041 02787020
*                                                                A32041 02790020
FDSN     L     ACCE,IEHMVV21      RETURN FROM USING FROMDD       A32041 02793020
         MVC   JFCBDSNM(44),0(ACCE)     SET UP DSNAME                   02800000
         TM    IEHMVV20+3,FRDDKEY      FROMDD KEYWORD           YA01696 02820002
         BO    FROMDD1                 YES KEEP DDNAME IN DCB   YA01696 02830002
         L     ACCE,IEHMVV30+12        FROM DDNAME ADDRESS      YA01696 02840002
         MVC   DCBDDNAM-IHADCB(8,M7),0(ACCE) PUT DDNAME IN DCB  YA01696 02850002
FROMDD1  MVI   JFCBELNM,BLANK          PUT IN ELEMENT NAME      YA01696 02860002
         MVC   JFCBELNM+1(7),JFCBELNM                                   02880015
*                                                                       02900000
*                                                                       02920000
         LA    M6,JFCBVOLS         POINTER TO JFCB VOL LIST             02940000
         SR    ACCO,ACCO                                                02960000
         IC    ACCO,IEHMVV22       COUNT OF VOL IDS                     02980000
         LA    M5,6                MAX COUNT OF 5 VOL IDS      @ZA01733 03000003
         L     ACCE,IEHMVV22       POIHTER TO VOL LIST                  03020000
         MVC   JFCBFLSQ(2),10(ACCE)                                     03040000
VOLIDLP  DS  0H                                                         03060000
         MVC   0(6,M6),4(ACCE)   MOVE VOL ID                            03080000
         LA    M6,6(0,M6)          UP JFCB POINTER                      03100000
         LA    ACCE,17(0,ACCE)     UP FROM VOL POINTER           A32032 03120020
         BCT   M5,NVOLIDS          MOVED 5 VOL IDS                      03140000
         MVI   IEHMVV61,NONTOF    MORE THAN FIVE VOLUMES SET UP MSG     03160000
         L     LINK,PREAB                                               03180000
         BR    LINK                                                     03200000
NVOLIDS  BCT  ACCO,VOLIDLP         MOVED ALL OF THE  VOL IDS            03220000
         MVC   JFCBNVOL(1),IEHMVV22                                     03240000
         MVI   0(M6),BLANK                                              03260000
FDDRTN   DS  0H                   OPEN - FROM DCB                       03280000
         MVC   JFCBDSNM+53(3),IEHMVV82   PUT TTR IN JFCB         S21042 03290021
         XC    IEHMVV82(3),IEHMVV82    AFTER IT, CLEAR           S21042 03292021
         OPEN  ((M7),(INPUT)),TYPE=J                                    03300000
         OI    IEHMVV10-4,OK      INDICATE FROM DCB OPENED              03320000
         CLI   IEHMVV10-5,AZERO   BRANCH IF OPEN SUCCESSFUL             03340000
         BE    NOMSS                                                    03360015
         IC    ACCE,IEHMVV61                                            03380000
         MVC   IEHMVV61(1),IEHMVV10-5                                   03400000
         L    LINK,GOTOMESS                                             03420015
         BALR  RETURN,LINK                                              03440015
         STC   ACCE,IEHMVV61                                            03460000
NOMSS    DS    0H                                                  UL0H 03466017
         CLI   IEHMVV74+4,X'FF'         I/O ERR IN U.L. EXIT RTN   UL0H 03472017
         BE    IOERRMSG                 YES, TELL USER             UL0H 03478017
ERMSGRET DS    0H                                                  UL0H 03484017
*                                       TEST FOR UNLOADED DATA SET UL0H 03490017
*                                                                       03500000
         L     M5,IEHMVV22                                              03520015
         CLI   2(M5),UNITRCD            IS THIS UNIT RECORD             03540000
         BNE   AAAAKK                                                   03560000
         LA    ACCO,80                                                  03580000
         B     LTCON                                                    03600000
AAAAKK   DS  0H                                                         03620000
         LA    ACCO,80            INITIALIZE REG. 3 TO DECIMAL 80  8952 03624013
         L     ACCE,IEHMVV22      PTR. TO FROM LIST                8952 03628013
         TM    2(ACCE),UNITRCD    IS DEVICE UNIT RECORD?           8952 03632013
         BO    LTCON              IF YES, SET TO READ FIRST RECORD 8952 03636013
         L     ACCE,IEHMVV30                                            03640000
         CH    ACCO,DCBLRECL-IHADCB(0,ACCE)                             03680000
         BNE   NOLT                     NO, STOP LOAD TEST              03700000
         CLI   2(M5),TAPE              TEST FOR FROM DEVICE TAPE        03720000
         BE    PATCH                   SKIP KEYLENTGH TEST              03740000
         CLI   DCBKEYLE-IHADCB(ACCE),AZERO   TEST KEY LENGTH            03760000
         BNE   NOLT                    NO LOAD                          03780000
PATCH    LA    ACCO,800          GET SET TO TEST FOR BLKSIZ OF 800 8952 03820013
         CH    ACCO,DCBBLKSI-IHADCB(0,ACCE)  BLOCKSIZE EQUAL TO 800     03860000
         BNE   NOLT                                                     03880000
LTCON    DS  0H                                                         03900000
         LR    ACCE,ACCO          SET BLOCKSIZE                 YM06314 03910002
         LR    ZERO,ACCO          GET BLOCK LENGTH                      03920000
         GETMAIN R,LV=(0)               GET CORE                        03940000
         L     M5,IEHMVV30+4            GET DECB POINTER                03960000
         OI    IEHMVV30+4,OK      TURN ON BUFFER BIT                    03980000
*                                                                       04000000
         L     M7,IEHMVV30              DCB PTR                         04020000
         LA    ACCO,NOLT                                                04040000
         ST    ACCO,DCBEODAD-IHADCB(0,M7)  ADDRESS OF END OF DATA ROUT. 04060000
         MVC   DCBSYNAD+1-IHADCB(3,M7),SYNADRTN                @ZA28978 04070099
*                                       SYNADRTN - MSG I/O ERR   A35460 04072021
         LR    ACCO,1                                                   04080000
         READ  (M5),SF,(M7),(ACCO),(ACCE),MF=E                          04100000
*                                       READ THE FIRST RECORD           04120000
*                                                                       04140000
         LR    PARAM,M5           GET ADDRESS OF DECB                   04160000
         CHECK (1)                      CHECK THE READ                  04180000
         L     PARAM,12(PARAM)    GET IO AREA                           04200000
*  CHECK FIRST RECORD WRITTEN BY IEHMVSSY FOR AN UNLOADED DATA SET      04220000
         L     ACCE,LDRC                                                04240000
         CLC   2(78,PARAM),0(ACCE)   FIRST RECORD OF UNLOADED    A35460 04250020
*                                    DATA SET?                   A35460 04260020
         BE    UNLDPROC              GO TO READ UNLOADED RECORDS A35460 04270020
         TM    IEHMVV20,X'08'        IS KEYWORD 'PDS' SPECIFIED? A35460 04280020
         BZ    NOLT                  NO, BRANCH (PS DATA SET)    A35460 04290020
         MVI   IEHMVV61,X'22'        PUT ERROR CODE IN WORK AREA A35460 04300020
         L     LINK,PREAB            LOAD ADDRESS OF THE ENTRY   A35460 04310020
*                                    POINT OF THE ERROR ROUTINE  A35460 04320020
         BR    LINK                  GO TO ERROR ROUTINE         A35460 04330020
UNLDPROC LNR   ZERO,BASE             CONTINUE TO SET UP FOR      A35460 04340020
*                                    LOADING                     A35460 04350020
*                                    SET UP TO CALL BREAD TO GET A35460 04360020
*                                    DSCB                        A35460 04370020
         LA    1,IEHMVV00+40                                            04400015
         L     LINK,BREAD               GO TO BREAD ROUTINE             04420000
         BALR  RETURN,LINK                                              04440000
         B     LTBREAD(LINK)            CHECK RETURNS FROM BREAD        04460000
LTBREAD  B     LTOK                     BREAD OK                        04480000
         B     NOLT               END OF DATA                           04500000
         B     LTPIO                    PERMANT IO ERROR                04520000
         B     NOPSLT                  SEQ NUMBERS INCORRECT     A25631 04530019
         DC    X'0000'                                                  04540000
LTPIO    DS    0H                                                       04560000
         MVI   IEHMVV61,ERROR     SET ERROR MESSAGE                     04580000
EXIT     L     LINK,PREAB                                        A25631 04600019
         BR    LINK                                                     04620000
NOPSLT   MVI   IEHMVV61,PSERR                                    A25631 04626019
         B     EXIT                                              A25631 04632019
LTOK     DS  0H                                                         04640000
         MVC   DEVCHARU(4),IEHMVV00+236 PICK UP OLD DEVICE TYPE         04660000
         L     ACCE,IEHMVV30+8    GET FROM DSCB                         04680000
         MVC   0(140,ACCE),IEHMVV00+43                                  04700015
         MVC   IEHMVV25(2),IEHMVV00+183     SET UP DIRECTORY QUAN       04720015
         OI    IEHMVV20+1,LOAD          TURN ON LOAD BIT                04740000
         TM    IEHMVV00+185,MOVE  WAS UNLOAD DS UNMOVEABLE              04760000
         BZ    GNNNU              NO NOT UNMOVEABLE                     04780015
* * * * *                         YES-- UNMOVEABLE                      04800015
         OI    IEHMVV10-4,ANYINCRP TURN ON OUR UNMOVE INDICATION        04820000
GNNNU    DS    0H                                                       04840000
         SPACE 1                                                        04860000
         STM   DEV14,DEV1,DEVSAVE       SAVE THE REGISTERS TO BE USED   04880000
         TM    IEHMVV00+185,X'40'       TEST THE LOAD FLAG              04900000
         BO    DEVA                    BRANCH IF NEW UNLOAD             04920000
         MVC   IEHMVV00+186(8),DEVCONST  SET UP DEFAULT VALUES          04940000
DEVA     L     DEV14,IEHMVV31+8        GET ADDRESS OF THE 'TO'          04960000
         LA    DEV1,0(0,DEV14)          DDNAME                          04980000
         DEVTYPE (1),DEVCHAR,DEVTAB     GET THE 'TO' DEVICE CHARCTER    05000000
         TM    DEVCHAR+2,X'20'          TEST DEVICE TYPE OF 'TO' DEV    05020000
         BZ    DEVCONT                  BRANCH IF NOT DIRECT ACCESS     05040000
         MVC   DEVCHAR(4),IEHMVV00+186  GET THE SIZE OF THE DATASET     05060000
         L     DEV14,DEVCHAR            AND PUT INTO REGISTER DEV14     05080000
         LH    DEV0,DEVCHAR+12         SET UP TO DIVIDE BY THE          05100000
         AR    DEV14,DEV0              TRACK CAPACITY AND ROUND         05120000
         BCTR  DEV14,0                 UP TO GET AN ADEQUATE            05140000
         SRDA  DEV14,32                NUMBER OF TRACKS FOR THE         05160000
         DR    DEV14,DEV0              NEW ALLOCATION                   05180000
         ST    DEV15,DEVCHAR            STORE RESULT BACK INTO DSCB     05200000
         MVC   DADPQ-IECSDSL1(4,ACCE),DEVCHAR   FOR ALLOCATION          05220000
         MVC   DEVCHAR(4),IEHMVV00+190  GET THE SECONDARY QUANTITY      05240000
         L     DEV14,DEVCHAR            AND TEST FOR DEFAULT            05260000
         LTR   DEV14,DEV14              VALUES BY SEEING IF NEGATIVE    05280000
         BNL   DEVD                     SECONDARY QUANTITY              05300000
         LCR   DEV14,DEV14              MAKE POSITIVE AND SET           05320000
         MVI   DS1SCALO-IECSDSL1(ACCE),X'80'  SEC ALLOC CONTROL         05340000
DEVD     TM    DS1SCALO-IECSDSL1(ACCE),X'80'  TEST TYPE OF SEC ALLOC    05360000
         BZ    DEVCONT                  BRANCH IF ABSOLUTE OR BLOCK     05380000
         AR    DEV14,DEV0              CAPACITY AND ROUND UP            05400000
         BCTR  DEV14,0                 TO GET AN APPROPRIATE            05420000
         SRDA  DEV14,32                VALUE FOR THE SECONDARY          05440000
         DR    DEV14,DEV0               ALLOCATION REQUEST              05460000
         TM    DS1SCALO-IECSDSL1(ACCE),X'40'  TEST TYPE OF SEC ALLOC    05480000
         BZ    DEVB                    BRANCH IF TRACK                  05500000
         LR    DEV14,DEV15              SET UP TO CONVERT TO CYL        05560000
         SR    DEV0,DEV0               ALLOCATION                       05570013
         IC    DEV0,DEVCHAR+11               REQUEST AND                05580013
         AR    DEV14,DEV0              ROUND UP TO THE NEXT             05600000
         BCTR  DEV14,0                 HIGHER NUMBER OF                 05620000
         SRDA  DEV14,32                CYLINDERS ON THE                 05640000
         DR    DEV14,DEV0              DEVICE                           05660000
         B     DEVB                                                     05680000
         SPACE 1                                                        05700000
         SPACE 1                                                        05740000
DEVB     ST    DEV15,DEVCHAR            STORE THE PROPER SEC ALLOC      05760000
         MVC   DS1SCALO-IECSDSL1+1(3,ACCE),DEVCHAR+1  INTO THE DSCB     05780000
         B     DEVCONT                                                  05800000
         SPACE 2                                                        05820000
DEVCHAR  DS    5F                       DEVICE CHARACTERISTICS AREA     05840000
DEVSAVE  DS    4F                       REGISTER SAVE AREA              05860000
DEVCONST DC    F'72500'                DEFAULT VALUES GIVE A PRIMARY    05880000
         DC    F'-36250'                QUAN OF 20 TRACKS ON 2311       05900000
         SPACE 1                                                        05920000
DEVT1    DS    2F                                                A21645 05940018
DEVT2    DS    2F                      UCB TYPE FOR TO   DEVICE         05960000
DEVCHARU DS    1F                                                       05980000
         SPACE 1                                                        06000000
DEV14    EQU   14                       DEFINE THE REGISTERS USED       06020000
DEV15    EQU   15                       IN THIS DEVICE ALLOCATION       06040000
DEV0     EQU   0                                                        06060000
DEV1     EQU   1                                                        06080000
         SPACE 1                                                        06100000
DEVCONT  LM    DEV14,DEV1,DEVSAVE       RESTORE REGISTERS               06120000
         SPACE 1                                                        06140000
         B     LTRETURN                                                 06160000
NOLT     DS    0H                                                       06180000
         L     ACCE,IEHMVV22+4          IS FROM DEVICE DASD             06200000
         CLI   2(ACCE),DASD                                             06220000
         BE    LTRETURN           YES,GO TO RETURN                      06240000
*                                       NO, SET UP FOR TESTING          06260000
*                                                                       06280000
         L     ACCE,IEHMVV30            GET DCB ADDRESS                 06300000
         L     ACCO,IEHMVV30+8          GET DSCB ADDRESS                06320000
         MVC   DS1RECFM-DSCBDSEC(1,ACCO),DCBRECFM-IHADCB(ACCE)          06340000
         MVC   DS1BLKL-DSCBDSEC(2,ACCO),DCBBLKSI-IHADCB(ACCE)           06360000
         MVC   DS1LRECL-DSCBDSEC(2,ACCO),DCBLRECL-IHADCB(ACCE)          06380000
         L     ACCE,IEHMVV21            DATA SET NAME                   06400000
         MVC   DS1DSNAM-DSCBDSEC(44,ACCO),0(ACCE)                       06420000
         MVI   DS1FMTID-DSCBDSEC(ACCO),X'F1'                            06440000
         MVI   DS1DSORG-DSCBDSEC(ACCO),X'40'                            06460000
         B     LTRETURN                 RETURN                          06480000
FROMDD   DS    0H                                                       06500000
         L     1,IEHMVV28                                               06520015
         MVC   DCBDDNAM-IHADCB(8,M7),0(1)                               06540000
         L     M5,16                   FIND ADDR CVT             A45188 06541022
         L     M5,0(M5)                FIND TCB POINTERS         A45188 06542022
         L     M5,4(M5)                FIND TCB ADDR             A45188 06543022
         L     M5,12(M5)               FIND TIOT ADDR            A45188 06544022
         LA    M5,24(M5)               FIND FIRST DD ENTRY       A45188 06545022
NEXTDD   SR    M6,M6                                             A45188 06546022
         IC    M6,0(M5)                FIND ENTRY LENGTH         A45188 06547022
         CLC   4(8,M5),0(1)            DDNAME FOUND              A45188 06548022
         BE    RDJFCB                  YES CONTINUE              A45188 06549022
         AR    M5,M6                   NO GO TO NEXT ENTRY       A45188 06550022
         L     M6,0(M5)                                          A45188 06551022
         LTR   M6,M6                   END OF TIOT               A45188 06552022
         BNZ   NEXTDD                  NO COMPARE NEXT ONE       A45188 06553022
         MVI   IEHMVV61,X'26'          YES INDICATE MSG NBR      A45188 06554022
         L     LINK,PREAB                                        A45188 06555022
         BR    LINK                    TERMINATE THE REQ         A45188 06556022
RDJFCB   DS    0H                                                A45188 06557022
         RDJFCB  ((M7))                                                 06560000
         B     FROMBACK                                                 06580000
         DS    0F                                                       06600000
DCBXX    DC    X'05'                                               UL0H 06620017
         DC    AL3(MYDCBXX)                                             06640000
ZZZ      DC    X'0000'                                                  06660000
MYDCBXX  CLC   DCBBLKSI-IHADCB(2,M7),ZZZ                                06680000
         BE    MYDCBX             YES,BLOCKSIZE EQUAL TO ZERO           06700000
**********************************************************************  06710004
* LINES 067500-069380 WERE REACTIVATED IN                      @Z40CSJH 06720004
* SUPPORT OF THE EXTENDED MVS CVOL FUNCTION                    @Z40CSJH 06730004
**********************************************************************  06740004
         LA    ACCE,80            NO                                    06750004
         CH    ACCE,DCBLRECL-IHADCB(ZERO,M7)  RECL EQUAL TO 80          06800004
         BE    RTNDCBX                                                  06850004
CHKCAT   TM    IEHMVV20,CATALOG   CATLG KEYWORD                         06900004
         BZ    RTNDCBX            RETURN                                06910004
         MVI   DCBDSORG+1-IHADCB(M7),AZERO                              06920004
         MVI   DCBDSORG-IHADCB(M7),BSAM                                 06930004
         MVI   DCBBLKSI+1-IHADCB(M7),AZERO                              06932004
         MVI   DCBBLKSI-IHADCB(M7),ONE                                  06934004
         MVI   DCBKEYLE-IHADCB(M7),EIGHT                                06936004
         MVI   DCBRECFM-IHADCB(M7),FIXED+KEYL                      1719 06938004
RTNDCBX  DS    0H                                                       06940000
         RETURN   RC=0                                                  06960000
MYDCBX   DS    0H                 TEST FORMAT                           06980000
         L     M5,IEHMVV22                                              06990017
         CLI   2(M5),UNITRCD      FROM VOLUME UNIT RECORD               07000017
         BE    UUWW                                                     07010017
         TM    IEHMVV20,CATALOG  CATALOG KEYWORD ?             @Z40CSJH 07012004
         BO    CHKCAT                                          @Z40CSJH 07014004
         MVI   DCBBLKSI-IHADCB(M7),TEN                                  07019017
         MVI   DCBRECFM-IHADCB(M7),UNDEF                                07022017
         MVI   IEHMVV10-5,X'09'                                         07025017
         B     RTNDCBX                                                  07026017
ADIHLR   DC    X'01'                   INPUT HEADER LABEL ROUTINE  UL0H 07028017
         DC    AL3(IHLR)               DCBEXLIST ENTRY             UL0H 07031017
*                                                                  UL0H 07037017
* USER INPUT HEADER LABEL ROUTINE ENTERED FROM OPENJ OF INPUT DCB  UL0H 07040017
*   WITH REGISTER 1 POINTING TO A 5-WORD PARAMETER LIST. WORD 1    UL0H 07043017
*   POINTS TO THE LABEL BUFFER AREA.  IF WORD 1 IS ZERO, THERE ARE UL0H 07046017
*   NO INPUT HEADER LABELS TO BE PROCESSED.                        UL0H 07049017
*                                                                  UL0H 07052017
IHLR     DS    0H                                                  UL0H 07055017
OFFSET1  EQU   IHLR-IEHMVESV                                       UL0H 07058017
         LA    M8,OFFSET1              SET UP                      UL0H 07061017
         SR    LINK,M8                 ADDRESSABILITY              UL0H 07064017
         LR    BASE,LINK               FOR EXIT ROUTINE            UL0H 07067017
         L     M8,0(PARAM)        GET ADDR OF LABEL BUFFER AREA    UL0H 07069017
         LTR   M8,M8              ARE USER LABELS PRESENT          UL0H 07071017
         BNE   CHKIOERR           YES, IS I/O ERROR INDICATED IN   UL0H 07073017
*                                 PARAMETER LIST                   UL0H 07075017
NOLABEL  SR    LINK,LINK          NO, RETURN CODE OF ZERO TO OPEN  UL0H 07077017
*                                 TO IGNORE ADDITIONAL LABELS      UL0H 07079017
         BR    RETURN             RETURN TO OPENJ                  UL0H 07081017
*                                                                  UL0H 07083017
CHKIOERR DS    0H                                                  UL0H 07085017
         TM    8(PARAM),X'80'     PERM ERROR SHOWN IN PARM LIST    UL0H 07087017
         BC    14,CORAVAIL        NO, SEE IF CORE GOTTEN YET       UL0H 07089017
LABLERR  DS    0H                                                  UL0H 07091017
         OI    IEHMVV74+4,X'FF'         YES, SET FLAG TO OUTPUT    UL0H 07096017
*                                        MSG AFTER OPEN/CLOSE/EOV  UL0H 07101017
         MVI   UDCBIHLE,X'00'     DEACTIVATE HEADER LABEL ENTRIES  UL0H 07107017
         MVI   UDCBOHLE,X'00'     IN DCB EXIT LIST                 UL0H 07109017
         OI    IEHMVV20+2,X'40'        TELL VESN TO PUT OUT MSG    UL0H 07111017
*                                      DATA SET(S) NOT MOVED/COPIEDUL0H 07113017
         BR    RETURN             RETURN TO OPENJ ROUTINE          UL0H 07117017
CORAVAIL DS    0H                                                  UL0H 07119017
         CLC   IEHMVV72(4),ALLZERO     WAS CORE GOTTEN FOR LABELS  UL0H 07121017
         BNE   SAVLABEL           ADDR NOT ZERO, CORE GOTTEN       UL0H 07123017
         GETMAIN  R,LV=640        GET CORE IF NECESSARY            UL0H 07125017
         ST    PARAM,IEHMVV72     SAVE ADDR OF GOTTEN CORE         UL0H 07127017
         MVC   IEHMVV72+4(4),IEHMVV72  SAVE POINTER TO CURRENT     UL0H 07129017
*                                      LABEL SAVEAREA              UL0H 07131017
SAVLABEL DS    0H                                                  UL0H 07133017
         L     M9,IEHMVV72+4      GET ADDR CURRENT LBL SAVEAREA    UL0H 07135017
         MVC   0(80,M9),0(M8)     MOVE LBL TO AREA FROM LABEL      UL0H 07137017
*                                 BUFFER ADDRESSED BY PARAM LIST   UL0H 07139017
         LA    M9,80(M9)          UPDATE POINTER TO NEXT AREA      UL0H 07141017
         ST    M9,IEHMVV72+4      STORE UPDATED POINTER            UL0H 07143017
         SR    M9,M9                                               UL0H 07145017
         IC    M9,IEHMVV72+12     PICK UP COUNT OF LABELS          UL0H 07147017
         LA    M9,1(M9)           INCREMENT COUNT BY 1             UL0H 07149017
         STC   M9,IEHMVV72+12     STORE UPDATED COUNT              UL0H 07151017
         LA    LINK,4             SET RETURN CODE TO 4 FOR OPEN    UL0H 07153017
*                                 TO GET ADDITIONAL LABELS         UL0H 07155017
         BR    RETURN             RETURN TO OPENJ ROUTINE          UL0H 07157017
*                                                                       07158017
IOERRMSG DS    0H                                                  UL0H 07159017
         IC    ACCE,IEHMVV61            SAVE CURRENT MSG CODE      UL0H 07160017
         LA    M9,17                    LOAD MSG CODE AND STORE    UL0H 07161017
         STC   M9,IEHMVV61               FOR MESSAGE WRITER        UL0H 07162017
         L     LINK,GOTOMESS            GET ADDR OF MESSAGE WRITER UL0H 07163017
         LR    M9,RETURN                SAVE RETURN ADDR FOR OPENJ UL0H 07164017
         BALR  RETURN,LINK              BRANCH TO WRITE MESSAGE    UL0H 07165017
         STC   ACCE,IEHMVV61            RESTORE PREVIOUS CODE      UL0H 07166017
         LR    RETURN,M9                RESTORE RETURN ADDRESS     UL0H 07167017
         B     ERMSGRET                 RETURN TO INLINE PROCESSINGUL0H 07168017
LOADDCB  DCB  DSORG=PS,MACRF=RP,RECFM=U                                 07180000
LOADDCBE DS    0F                                                       07200000
LENGTHDC DC    A(LOADDCBE-LOADDCB)                                      07220000
MOVELT   MVC   0(1,ACCE),LOADDCB                                        07240000
BREAD    DC    A(IEHMVERK)                                              07260000
         EXTRN IEHMVERK                                                 07280000
UUWW     DS    0H                                                       07300000
         L     ACCE,IEHMVV30                                            07320015
         MVI   DCBRECFM-IHADCB(ACCE),X'80'                              07340015
         LA    ACCO,80                                                  07360015
         STH   ACCO,DCBBLKSI-IHADCB(ACCE)                               07380015
         STH   ACCO,DCBLRECL-IHADCB(ACCE)                               07400015
         MVI   DCBDSORG-IHADCB(ACCE),X'40'                              07420015
         B     RTNDCBX                                                  07440015
         EXTRN UNLREC1                                                  07460000
LDRC     DC    A(UNLREC1)         IN SRZ,FIRST RECORD OF UNLOAD DATAS.  07480000
         EJECT                                                          07500000
*                                                                       07520000
*                                                                       07540000
IEHMVESM DS    0H                 SECURITY TEST                         07560000
*                                                                       07580000
*                                                                       07600000
         L     DSCB,IEHMVV30+8          SET UP DSCB POINTER             07620000
*                                                                       07640000
         TM    DS1DSIND,SECUR           IS DATA SET SECURITY PROTECTED  07660000
         BZ    IEHMVRSM           NO,RETURN                             07680000
*                                       YES, PROCEED WITH TESTING       07700000
         TM    IEHMVV20,DSGROUP         DSGROUP FUNCTION                07720000
         BO    CONTEST                  YES, CONTINUE TEST              07740000
         TM    IEHMVV20,VOLUME          NO, PROCEED TO TEST FOR VOLUME  07760000
         BZ    IEHMVRSM           RETURN                                07780000
CONTEST  DS    0H                                                       07800000
         TM    IEHMVV20+1,SECURITY      SECURITY OPERAND GIVEN          07820000
         BO    IEHMVRSM           YES,RETURN                            07840000
*                                                                       07860000
*                                                                       07880000
*                                                                       07900000
*                                                                       07920000
         MVI   IEHMVV61,SECER     SET ERROR MESSAGE                     07940000
         L     LINK,PREAB         PREABORT                              07960000
         BR    LINK                                                     07980000
*                                                                       08000000
         EJECT                                                          08020000
*                                                                       08040000
IEHMVESW DS    0H                 ACCESS METHOD TEST                    08060000
         TM    IEHMVV20+5,X'40'  UNLOAD REQUESTED                A37919 08066021
         BO    UNLREQMS                YES GIVE MESSAGE          A37919 08072021
         L     DSCB,IEHMVV30+8          GET DSCB POINTER                08080000
         CLI   DS1DSORG,BDAM            DSORG BDAM                      08100000
         BE    TSTBDAM                  YES CHECK DEVICE TYPE           08120000
PROBDAM  DS    0H                 TEST FOR DA                           08140000
         L     ACCE,IEHMVV23+4    ACTIVE TO VOL LIST                    08160000
         CLI   2(ACCE),DASD       DIRECT ACCESS                         08180000
         BNE   TAPHYSE            NO,CONTINUE                           08200000
*                                 YES,NO UNLOAD                         08220000
*                                                                       08240000
TAGOBACK DS    0H                                                       08260000
         B     IEHMVRSW                                                 08280000
*                                                                       08300000
*                                                                       08320000
*                                                                       08340000
TAPHYSE  DS    0H                 CONTINUE TEST                         08360000
**********************************************************************  08362004
* LINES 083700-083780 WERE REACTIVATED IN                      @Z40CSJH 08364004
* SUPPORT OF THE EXTENDED MVS CVOL FUNCTION                    @Z40CSJH 08366004
**********************************************************************  08368004
         TM    IEHMVV20,CATALOG        TEST FOR CATALOG FUNCTIONXA00427 08370004
         BNO   TAPHYSEQ                IF NOT, TEST KEYLEN      XA00427 08372004
         OI    IEHMVV20+1,UNLOAD       IF CATALOG, HAS TO BE    XA00427*08374004
                                         UNLOADED               XA00427 08376004
         B     TAGOBACK                                         XA00427 08378004
TAPHYSEQ EQU   *                                                        08378404
         CLI   DS1KEYL,AZERO                                            08380000
         BNE   TAKEY              UNLOAD CONDITION                      08400000
         CLI   DS1DSORG,BSAM            IS DSORG PHYSICAL SEQUENTIAL    08420000
         BE    TAGOBACK                 YES, NOT AN UNLOAD              08440000
*                                          TABLE-PRINT MESSAGE          08460000
         CLI   DS1DSORG,AZERO     DEFAULT                               08480000
         BE    TAGOBACK                                                 08500000
TAKEY    DS    0H                 SET UNLOAD CONDITION                  08520000
         MVI   IEHMVV61,X'94'      ACCESS METHOD NOT COMPAT.     A29052 08550019
         B     WRTMSG                  WRITE MESSAGE             A37919 08560021
*                                                                       08600000
TAKEYS   DS    0H                                                       08620000
         MVI   IEHMVV61,X'A0'      DEVICE TYPES NOT COMPAT MESS  A29052 08650019
         B     WRTMSG                  WRITE MESSAGE             A37919 08651021
*                                                                       08652021
UNLREQMS DS    0H                                                A37919 08653021
         MVI   IEHMVV61,X'A4'          UNLOADREQUEST MSG         A37919 08654021
*                                                                       08655021
WRTMSG   DS    0H                                                A37919 08656021
         OI    IEHMVV20+1,UNLOAD SET THE UNLOAD-CONDITION        A37919 08657021
         L     ACCO,GOTOMESS       GO TO 'MSG' IN SRZ TO HAVE    A29052 08660019
         BALR  RETURN,ACCO            MESSAGE WRITTEN.           A29052 08670019
         B     TAGOBACK                                                 08680000
TSTBDAM  DS    0H                 TEST FOR IDENTICAL DEVICES            08700000
         L     ACCE,IEHMVV22      ADDR OF FROM VOL                      08720000
         L     ACCO,IEHMVV23+4    ADDRESS OF TO VOL                     08740000
*                                                                       08760000
*                                                                       08780000
         TM    IEHMVV20+1,LOAD          TEST FOR BDAM LOAD CONDITION    08800000
         BZ    CHEKCUR                  BRANCH IF NOT A LOAD CONDITION  08820000
         CLC   DEVCHARU+2(1),DEVT2+2   COMPARE DEV CLASS       @ZA04396 08830003
         BNE   TAKEYS                  NOT EQUAL UNLOAD BDAM   @ZA04396 08834003
         CLI   DEVCHARU+3,X'09'        FROM 3330-1             @ZA04396 08838003
         BE    TESTTO                  YES TEST TO DEVICE      @ZA04396 08842003
         CLI   DEVCHARU+3,X'0D'        FROM 3330-11            @ZA04396 08846003
         BNE   EQUAL                   NO GO TO EQUAL          @ZA04396 08850003
TESTTO   CLI   DEVT2+3,X'09'           TO 3330-1               @ZA04396 08854003
         BE    MAINLINE                YES GO ON               @ZA04396 08858003
         CLI   DEVT2+3,X'0D'           TO 3330-11              @ZA04396 08862003
         BE    MAINLINE                YES GO ON               @ZA04396 08866003
EQUAL    CLC   DEVCHARU+3(1),DEVT2+3   COMPARE                 @ZA04396 08870003
         BNE   TAKEYS                  UNLOAD BDAM             @ZA04396 08874003
MAINLINE CLC   DEVCHARU(1),DEVT2       COMPARE FIRST BYTE OF   @ZA04396 08878003
*                                      DEVICE TYPE FIELD         A25286 08890019
         BNE   TAKEYS                                            A25286 08895019
         B     TESTOVF                                                  08900000
CHEKCUR  CLC   DEVT1(4),DEVT2           COMPARE UCB TYPE FIELDS         08920000
         BE    TESTOVF             DEVICES ALIKE                 A21645 08925018
         CLI   2(ACCO),DASD       IS TO DEVICE DIRECT ACCESS     A21645 08930018
         BNE   TAKEYS             NO,UNLOAD BDAM                 A21645 08935018
         CLC  DEVT1+4(4),DEVT2+4  IS INPUT DEVICE LARGER THAN    A21645 08940018
*                                  MAXIMUM OUTPUT BLKSIZE        A21645 08945018
         BH    TAKEYS              YES,UNLOAD DATA SET           A21645 08950018
TESTOVF  TM    DS1RECFM,YESOFLOW        WAS FROM WRITTEN WITH TRACK     08960000
*                                       OVERFLOW                        08980000
         BO    OFLOW               BRANCH IF YES                        09000000
         B     IEHMVRTE           ALLOW BDAM MOVE                       09020000
OFLOW    DS    0H                                                       09040000
         TM    DEVT1+2,TAPE            FROM TAPE               @ZA03378 09046003
         BO    IEHMVRTE                YES LOAD                @ZA03378 09052003
         TM    DEVT1+1,YAOFLOW     DOES FROM DEVICE HAVE OFLOW FEATURE. 09060000
         BZ    MSG1                     IF NOT-DEVICES ARE NOT COMPA-   09080000
*                                          TABLE-PRINT MESSAGE          09100000
         B     IEHMVRTE           ALLOW MOVE                            09120000
         EJECT                                                          09140000
*                                                                       09160000
IEHMVETE DS    0H                 TEST RECORD LENGTH                    09180000
         L     ACCE,IEHMVV22+4     FROM VOLUME LIST                     09200000
         L     ACCO,IEHMVV23+4     TO VOLUME LIST                       09220000
         CLI   2(ACCO),TAPE        TO TAPE                              09240000
         BE    IEHMVRTE            YES                                  09260000
         CLI   2(ACCO),DASD        TO VOLUME DA                         09280000
         BNE   WOW                 NO                                   09300000
         CLI   2(ACCE),TAPE        FROM TAPE                            09320000
         BE    TESTDSCB                 OBTAIN DSCB                     09340000
         L     DSCB,IEHMVV30+8     NO,GET FROM DSCB POINTER             09360000
         TM    DS1RECFM,YESOFLOW   WRITTEN IN TRACK OVERFLOW            09380000
         BZ    TESTDSCB           OBTAIN DSCB                           09400000
         TM    DEVT1+1,YAOFLOW       DOES UNIT HAVE OVERFLOW FEATURE.   09420000
         BO    TESTDSCB           OBTAIN DSCB                           09440000
MSG1     MVI   IEHMVV61,NOTOF      SET OP MSG                           09460000
ABORT    L     LINK,PREAB          SET UP TO PREABORT  IN SRZ           09480000
         BR    LINK                                                     09500000
TESTDSCB DS    0H                                                       09520000
         L     ACCE,IEHMVV23      ADDR OF TO VOL LIST                   09540000
         CLI   2(ACCE),DASD       TO DEVICE DIRECT ACCESS               09560000
         BNE   TRACKCAP                                                 09580000
         XC    IEHMVV00(20),IEHMVV00    CLEAR 20 SPACES                 09600000
         MVI   IEHMVV00,MODE      INDICATE SEARCH MODE                  09620000
         MVC   IEHMVV00+4(4),IEHMVV21+4   TO DATASET NAME               09640000
         LA    ACCE,4(ACCE)         GET ADDRESS OF VOL SERIAL NO.       09660000
         ST    ACCE,IEHMVV00+8    SERIAL NUMBER                         09680000
         LA    ACCE,IEHMVV00+16    GET ADDRESS OF WORK AREA             09700000
         ST    ACCE,IEHMVV00+12    STORE ADDRESS OF WORK AREA           09720000
         OBTAIN IEHMVV00                                                09740000
         LTR   LINK,LINK          RETURN CODE EQUAL TO ZERO             09760000
         BZ    PREAL                                                    09780000
* ALL TESTING OF THE DSCB FIELDS AFTER THIS POINT, WITH THE EXCEPTION*  09786015
* OF THE TWO REFERENCES IN 'PREAL', PERTAIN TO THE 'FROM' DSCB.      *  09792015
NOPREAL  TM    DS1RECFM,YESOFLOW   WRITTEN WITH TRACK OVERFLOW          09800000
         BZ    TRACKCAP           TEST RECORD LENGTH                    09820000
TODEVTO  DS    0H                                                       09840000
         TM    DEVT2+1,YAOFLOW     DOES TO DEVICE HAVE TRACK OVERFLOW.  09860000
         BO    IEHMVRTE                                                 09880000
         B     TAKEYS                  UNLOAD DATA SET                  09900000
* WHEN ADDRESSING THE 'TO' DSCB AFTER THE OBTAIN MACRO,                 09920015
*  A DISPLACEMENT OF 44 MUST BE MADE BACK TO THE DSNAME AT THE KEY.     09940000
*  SINCE THE DSCB STARTS AT IEHMVV00+16, 28 MUST BE SUBTRACTED          09960000
*  FROM THE DSCB DISPLACEMENT.                                          09980000
PREAL    L     M10,IEHMVV22       ADDRESS OF FROM VOLUME LIST    A50960 10022022
         L     M11,IEHMVV23+4   ADDRESS OF ACTIVE TO VOLUME      S21042 10024021
         TM    IEHMVV20+3,X'04'                                  A48802 10024422
         BO    PREAL1                                            A48802 10024822
         CLC   4(6,M10),4(M11)  COMPARE VOLID OF T0 & FROM VOL   S21042 10026021
         BE    NOPREAL          EQUAL, THEN NO PREALLOCATION     S21042 10028021
PREAL1   OI    IEHMVV20+3,X'08'        INDICATE PREALLOCATION    A48802 10030022
*                                                                S21042 10032021
         L     PARAM,IEHMVV31+8        GET PTR TO 'TO' DDNAME    S21042 10034021
         LA    PARAM,0(PARAM)                                    S21042 10035021
         DEVTYPE (PARAM),INFO,DEVTAB   GET DEVICE CHARACTERISTICSS21042 10036021
         MVC   CCHHR(5),96(ACCE)       MOVE CCHHR IN ABS ADDR LOCS21042 10038021
         LH    PARAM,CCHHR             GET CC                    S21042 10038421
         MH    PARAM,TRCYL             CONVERT CC TO TT          S21042 10038821
         AH    PARAM,CCHHR+2           GET TOTAL TT              S21042 10039221
         SLL   PARAM,8                 FREE RIGHTMOST BYTE       S21042 10039621
         IC    PARAM,CCHHR+4           INSERT R                  S21042 10039721
         SLL   PARAM,8                 MOVE TTR TO LEFT 3 BYTES  S21042 10039821
         ST    PARAM,IEHMVV82+4        SAVE TTR                  S21042 10039921
*                                                                S21042 10046621
         GETMAIN R,LV=120              SAVE AREA FOR 'TO' DSCB   S21042 10048621
         OI    IEHMVV20+5,X'01'        INDICATE GETMAIN DONE   @ZA24602 10049699
         ST    PARAM,IEHMVV82+12       SAVE PTR TO THIS AREA     S21042 10050621
         XC    0(120,PARAM),0(PARAM)   CLEAR AREA                S21042 10052621
         MVC   0(117,PARAM),IEHMVV00   MOVE IN OBTAIN'S RESULT   S21042 10053021
         CLI   DS1RECFM-28-DS1DSNAM(MCTABLE),AZERO  RECFM GIVEN IN DSCB 10053122
         BE    NOPREAL            NO, SAME AS NOT PREALLOCATED   A50960 10053222
         TM    DS1RECFM-28-DS1DSNAM(MCTABLE),YESOFLOW T.O. IN TO DSCB   10053321
         BO    TODEVTO                                                  10060000
TRACKCAP STM   RETURN,PARAM,DEVSAVE   STORE REGISTERS TO BE USED        10080000
         L     DEV14,IEHMVV31+8        DDNAME OF THE 'TO' VOLUME   1719 10100015
         LA    PARAM,0(DEV0,DEV14)                                      10120000
         DEVTYPE (1),DEVCHAR,DEVTAB                                     10140000
         LH    ACCO,DEVCHAR+12     GET TRACK CAPACITY                   10160000
         LM    RETURN,PARAM,DEVSAVE   RESTORE REGISTERS                 10180000
         SR    M5,M5                                                    10200000
         L     ACCE,IEHMVV22+4         ADDR OF THE 'FROM' VOLUMEYA01218 10210002
         CLI   2(ACCE),TAPE        FROM TAPE                            10220000
         BE    SIZE                BRANCH AROUND KEYL                   10240000
         IC    M5,DS1KEYL                                               10260000
SIZE     AH    M5,DS1BLKL          ADD KEVL AND BLOCKSIZE               10280000
         CR    M5,ACCO             COMPARE LRECL TO CAPACITY            10300000
         BNH   IEHMVRTE                                                 10320000
         CLC   DS1EXT1+2(8),ZEROS       CHECK FOR MODEL-DSCB     A45144 10330022
         BNE   WOW                                               A45144 10332022
         CLC   DS1SCALO+1(3),ZEROS      CHECK FOR MODEL DSCB     A45144 10334022
         BNE   WOW                                               A45144 10336022
         CLC   DS1DSSN(6),ZEROS         CHECK FOR MODEL-DSCB     A45144 10338022
         BE    WOW                                               A45144 10338422
         B     IEHMVRTE                 IF MODEL-DSCB, BRANCH    A45144 10338822
WOW      DS    0H                 TEST FOR REBLOCKING                   10340000
         TM    DS1RECFM,BLOCKED   BLOCKED FORMAT                        10360000
*                                           FORMAT                      10380000
         BZ    NORB                    NO, GO TO SET UP UNLOAD          10400000
*                                                                       10420000
         TM    DS1RECFM,UNDEF     UNDEFINED FORMAT                      10440000
         BO    NORB                    YES, NO REBLOCKING               10460000
*                                      NO, RECFM IS FB OR VB            10480000
         LH    M5,DS1LRECL        LOGICAL REC LENGTH                    10500000
         CR    M5,ACCO             COMPARE SIZE TOCAPACITY              10520000
         BH    NORB                    NO, SET UP UNLOAD                10540000
         ST    ACCO,IEHMVV10-12                                 YA01218 10560002
         TM    DS1RECFM,FIXED     RECFM FIXED                           10580000
         BNO   VBLOCKED                NO                       YA01218 10600002
*                                                                       10620000
*                                      FIXED BLOCKED                    10640000
         OI    IEHMVV10-4,X'20'             INDICATE TO MOVE DS         10660000
         MVI   IEHMVV10-1,X'07'             ON LRECL                    10680000
         B     IEHMVRTE                                                 10700000
VBLOCKED EQU   *                       VARIABLE BLOCKED                 10720000
         OI    IEHMVV10-4,X'10'             INDICATE TO MOVE DS         10740000
         MVI   IEHMVV10-1,X'09'                                         10760000
         B     IEHMVRTE                NO UNLOAD RETURN                 10780000
NORB     DS    0H                 SET UNLOAD CONDITION                  10800000
*MESSAGE - DATA SET UNLOADED BECAUSE RECORD LENGTH NOT DEVICE           10810015
*                 COMPATIBLE                                            10820015
         MVI   IEHMVV61,X'96'                                           10840000
         OI    IEHMVV20+1,UNLOAD                                        10860000
         L     ACCO,GOTOMESS       GO TO SRZ TO HAVE             A29052 10866019
         BALR  RETURN,ACCO         MESSAGE WRITTEN.              A29052 10872019
         B     IEHMVRTE                                                 10880000
         EJECT                                                          10900000
*                                                                       10920000
IEHMVESL DS    0H                 UNMOVEABLE TEST                       10940000
*                                                                       10960000
*                                                                       10980000
*                                                                       11000000
         TM    IEHMVV10-4,UNMOVE  UNMOVEABLE DATA SET                   11020000
         BZ    IEHMVRSL           NO,                                   11040000
*                                 YES,CONTINUE WITH TEST                11060000
UNYES    DS    0H                                                  0310 11130017
*                                                                       11300000
*             TO VOLUME DIRECT ACCESS                                   11320000
         L     ACCE,IEHMVV23           GET TO VOL LIST                  11340015
         CLI   2(ACCE),DASD            IS TO VOL DIRECT ACCESS          11360015
         BNE   INMUN                   IF NO...... BRANCH               11380015
         IC    ACCE,IEHMVV61       SAVE MESSAGE CODE.            A29052 11400019
         MVI   IEHMVV61,X'15'      WRITE MESSAGE STATING THAT    A17911 11430018
         L     ACCO,GOTOMESS         UNMOVABLE DATA MUST BE      A17911 11480018
*                                    UPDATED (IEH452I).          A17911 11530018
         BALR  RETURN,ACCO         GO TO SRZ TO WRITE MESSAGE.   A17911 11580018
         STC   ACCE,IEHMVV61       RESTORE MESSAGE CODE.         A29052 11600019
         B     IEHMVRSL            RETURN TO MAIN FLOW AND EXIT. A17911 11630018
INMUN    DS    0H                  UNLOAD UNMOVABLE DATA SETS    A17911 11680018
         OI    IEHMVV20+1,UNLOAD     NOT GOING TO DIRECT ACCESS. A17911 11730018
         IC    ACCE,IEHMVV61       SAVE  MESSAGE  CODE.          A29052 11750019
         MVI   IEHMVV61,DSCBER     SET MESSAGE INDICATOR.        A17911 11780018
         L     ACCO,GOTOMESS       GO TO 'MSG' IN SRZ TO HAVE    A29052 11790019
         BALR  RETURN,ACCO         RESTORE MESSAGE CODE.         A29052 11800019
         B     IEHMVRSL            BRANCH TO MAIN FLOW AND       A17911 11830018
*                                    RETURN TO IEHMVSRZ.         A17911 11880018
**                                                                      12100000
*                                                                       12120000
*******     ******    ** * * * * * * * * * *  * **  * * * * * * *       12140000
*                                                                       12160000
         EJECT                                                          12180000
*                                                                       12200000
BADMTTO  DS    0H                 ERROR CONDITION                       12220000
         MVI   IEHMVV61,BADMT     SET MESSAGE                           12240000
         L     LINK,PREAB                                               12260000
         BR    LINK                                                     12280000
*                                                                       12300000
**********************************************************************  12310004
* LINES 123500-132361 WERE REACTIVATED IN                      @Z40CSJH 12320004
* SUPPORT OF THE MVS EXTENDED CVOL FUNCTION                    @Z40CSJH 12330004
**********************************************************************  12340004
         USING IEHMVESV,BASE                                            12350004
YESCATLG DS    0H       ALLOCATES CATALOG ON RECEIVING VOLUME           12400004
         TM    IEHMVV20+4,OK      FIRST TIME SWITCH FOR SZ              12450004
         BO    RTNCATLG                                                 12500004
         XC    IEHMVV00(140),IEHMVV00  SET TO ZEROS                     12550004
         MVI   IEHMVV00,BLANK     PUT BLANKS IN NAME OF JFCB            12600004
         MVC   IEHMVV00+1(43),IEHMVV00                                  12650004
         MVC   IEHMVV00(7),SYSCTLG                                      12700004
         MVI   IEHMVV00+44,SET                                          12750004
         MVI   IEHMVV00+94,OK                                           12800004
         MVI   IEHMVV00+97,TEN                                          12850004
         MVI   IEHMVV00+59,ONE                                          12900004
         MVI   IEHMVV00+111,TEN                                         12950004
*        SET PARAMETERS FOR SVC 32                                      13000004
         L     ACCE,IEHMVV31+8    GET POINTER TO 'TO' DDNAME            13050004
         SR    PARAM,PARAM        CLEAR REG 1(PARAM)           @Z40CSJH 13060004
         ICM   PARAM,3,DDUCB(ACCE)     @ UCB                   @Z40CSJH 13100004
         MVC   IEHMVV00+45(6),28(PARAM)                                 13150004
         ST    PARAM,IEHMVV31                                           13160004
         LA    PARAM,IEHMVV31     POINTER TO ADDRESS OF UCB             13170004
DDUCB    EQU   14                                                       13172004
         LA    ZERO,IEHMVV00      ADDRESS OF JFCB                       13174004
         LA    ACCE,2048          SET HIGH ORDER BIT TO ONE TO SHOW     13176004
         SLL   ACCE,20            FROM UTILITY                          13178004
         OR    ZERO,ACCE                                                13178404
         L     ACCE,IEHMVV23      GET TO VOL                            13178804
         CLI   2(ACCE),DASD       IS IT DIRECT ACCESS                   13179204
         BNE   TONOTDA            NO                                    13179604
         SVC   32                 SPACE ALLOCATION                      13179704
         LA    RETURN,4                                                 13179804
         SR    LINK,RETURN        SUBTRACT 4 FROM RETURN CUDE           13179904
         BC    12,BBB1            BRANCH IF SUCCESSFUL ALLOCATION OR    13186604
*                                 DUPLICATE NAME DSCB EXISTS            13188604
         MVI   IEHMVV61,ALER      SET UP MESSAGE                        13190604
         L     LINK,PREAB                                               13192604
         BR    LINK                                                     13193004
TONOTDA  DS    0H          WRITE ERROR MESSAGE                          13193104
         IC    ACCE,IEHMVV61      SAVE MSG NUMBER                       13193204
         MVI   IEHMVV61,CATER     SET UP MESSAGE                        13214904
         L     LINK,GOTOMESS                                            13224904
         BALR  RETURN,LINK                                              13234904
         STC   ACCE,IEHMVV61      RESTORE MSG NUMBER                    13235304
         NI    IEHMVV20+1,AND                                           13235704
         B     RTNCATLG                                                 13236104
GOTOMESS DC    A(MSG)                                                   13236604
         EXTRN MSG                                                      13258304
BBB1     DS    0H                                              @Z40CSJH 13268304
         OI    IEHMVV20+4,OK      SET FIRST TIME SW FOR SZ     @Z40CSJH 13278304
         B     RTNCATLG                                        @Z40CSJH 13278704
*                                                                       13280000
ZEROS    DC    2F'0'                                             A45144 13290022
SYSCTLG   DC   C'SYSCTLG'                                      @Z40CSJH 13300004
*        DATA SET INDICATORS IN DSCB                                    13320000
*                                                                       13340000
*                                                                       13360000
         DS    0F                                                       13380000
DOG      DC    C'  SZ'                                                  13400000
ABSE     DC    A(IEHMVESV)                                              13420000
LASTVOL  EQU   X'80'                                                    13440000
UNMOVE   EQU   X'08'                                                    13460000
SECUR    EQU   X'10'                                                    13480000
SYNADRTN DC    A(LTPIO)                                          A35460 13490021
PREAB    DC    A(PREABORT)                                              13500000
         EXTRN PREABORT                                                 13520000
INFO     DS    0CL20                   +                         S21042 13530021
         DS    CL10                    +DEVICE TYPE              S21042 13532021
TRCYL    DS    CL2                     +CHARACTERISTICS          S21042 13534021
         DS    CL8                     +                         S21042 13536021
CCHHR    DS    CL5                     ABS ADDR OF 'TO' DSCB     S21042 13538021
         EJECT                                                          13540000
MOVE     EQU   X'80'                                                    13560000
COPY     EQU   X'40'                                                    13580000
DSNAME   EQU   X'20'                                                    13600000
DSGROUP  EQU   X'10'                                                    13620000
PDS      EQU   X'08'                                                    13640000
CATALOG  EQU   X'04'                                                    13660000
VOLUME   EQU   X'02'                                                    13680000
FROM     EQU   X'01'                                                    13700000
TO       EQU   X'80'                                                    13720000
CVOL     EQU   X'40'                                                    13740000
UNCATLG  EQU   X'20'                                                    13760000
CATLG    EQU   X'10'                                                    13780000
SECURITY EQU   X'08'                                                    13800000
EXPAND   EQU   X'04'                                                    13820000
LOAD     EQU   X'02'                                                    13840000
UNLOAD   EQU   X'01'                                                    13860000
MIDABORT EQU   X'40'                                                    13880000
ENDINPUT EQU   X'20'                                                    13900000
PHONYTO  EQU   X'10'                                                    13920000
ANYINCRP EQU   X'08'                                                    13940000
ANYEXCRP EQU   X'04'                                                    13960000
ZERO     EQU   0                                                        13980000
PARAM    EQU   1                                                        14000000
ACCE     EQU   2                                                        14020000
ACCO     EQU   3                                                        14040000
BASE     EQU   4                                                        14060000
M5       EQU   5                                                        14080000
M6       EQU   6                                                        14100000
M7       EQU   7                                                        14120000
M8       EQU   8                                                        14140000
M9       EQU   9                                                        14160000
M10      EQU   10                                                       14180000
M11      EQU   11                                                       14200000
MCTABLE  EQU   12                                                       14220000
SAVE     EQU   13                                                       14240000
RETURN   EQU   14                                                       14260000
LINK     EQU   15                                                       14280000
DSCB     EQU   M7                                                       14300000
WORK3   EQU   ACCO                                                      14320000
WORK2   EQU   ACCE                                                      14340000
DASD    EQU   X'20'                                                     14360000
BDAM     EQU   X'20'                                                    14380000
ALER     EQU   X'05'                                                    14400000
AND      EQU   X'EF'                                                    14420000
AZERO    EQU   X'00'                                                    14440000
BADMT    EQU   X'1A'                                                    14460000
BLANK    EQU   X'40'                                                    14480000
BLOCKED  EQU   X'10'                                                    14500000
BSAM     EQU   X'40'                                                    14520000
CATER    EQU   X'07'                                                    14540000
DATAC    EQU   X'02'                                                    14560000
DSCBER   EQU   X'98'                                                    14580000
EIGHT    EQU   X'08'                                                    14600000
ERROR    EQU   X'0E'                                                    14620000
PSERR    EQU   X'17'                   MSG-DATA SET HAS          A25631 14623019
*                                      INCORRECT FORMAT          A25631 14626019
FIXED    EQU   X'80'                   BIT IN RECFM                1719 14630015
KEYL     EQU   X'01'                                                    14640015
FRDDKEY  EQU   X'02'                                                    14660000
LABEL    EQU   X'0A'              STANDARD USER LABELS             UL0H 14664017
SL       EQU   X'02'              INDICATES STANDARD LABEL       A32041 14666020
DEACTIVE EQU   X'00'              DEACTIVATE DCB EXIT LIST         UL0H 14668017
ACTIVIHL EQU   X'01'                                               UL0H 14672017
ACTIVOHL EQU   X'02'                                               UL0H 14676017
ACTIVITL EQU   X'03'                                               UL0H 14680017
ACTIVOTL EQU   X'04'                                               UL0H 14684017
ACTIVEND EQU   X'87'              JFCB ACTIVE END OF DCB EXIT LIST UL0H 14688017
ALLZERO  DC    F'0'                                                UL0H 14692017
MERROR   EQU   X'18'                                                    14700000
FROMERR  EQU   X'22'   MSG19, 'FROM' D.S. NOT IN UNLOADED FORMAT  10943 14710014
MODE     EQU   X'C1'                                                    14720000
NEW      EQU   X'C0'                                                    14740000
NONTOF   EQU   X'0D'                                                    14760000
NOTOF    EQU   X'0F'                                                    14780000
OK       EQU   X'80'                                                    14800000
ONE      EQU   X'01'                                                    14820000
PREALL   EQU   X'08'                                                    14840000
SECER    EQU   X'10'                                                    14860000
SET      EQU   X'F1'                                                    14880000
TAPE     EQU   X'80'                                                    14900000
TEN      EQU   X'0A'                                                    14920000
TLOAD    EQU   X'40'                                                    14940000
UNDEF    EQU   X'C0'                                                    14960000
UNITRCD  EQU   X'08'                                                    14980000
YAOFLOW  EQU   X'40'                                                    15000000
YESOFLOW EQU   X'20'                                                    15020000
         EJECT                                                          15040000
         TITLE 'DSCB FORMAT'                                            15060000
DSCBDSEC DSECT                                                          15080000
         IECSDSL1 (1)                                                   15100000
         ORG   DS1EXT1+3                                                15120000
DADPQ    DS    CL4                      PRIM QUAN FOR MODEL ALLOC       15140000
         IEHMVV                                                         15160000
         ORG   IEHMVV70                                            UL0H 15166017
         IEHDCBXL                                                  UL0H 15172017
         ORG   IEHMVV00                                                 15180000
         IEFJFCBN                                                       15200000
         TITLE 'DCB FORMAT'                                             15220000
         DCBD  DSORG=(PS,IS,DA,PO)                                      15240000
         END                                                            15260000
./  ADD  SSI=71610103,NAME=IEHMVSRX
 TITLE 'IEHMVSRX-DCB CONSTRUCTION FOR IEHMOVE LOAD MODULE ESY'          00010017
*TITLE -IEHMVSRX                                                        00020017
*FUNCTION /OPERATION: THIS ROUTINE HANDLES THE BUILDING OF THE DCB'S  * 00040000
*FOR THE FROM AND TO DATA SETS, OPENING THOSE DATA SETS, AND          * 00060000
*HANDLING THE FROMDD AND TODD KEYWORDS                                * 00080000
*ENTRY POINTS: IEHMVESX                                               * 00100000
*INPUT: INFORMATION IN MOVE/COPY COMMUNICATIONS TABLE                 * 00120000
*OUTPUT 'FROM' OCB                                                    * 00140000
*'TO' DCB                                                             * 00160000
*EXTERNAL ROUTINES: MESSAGE WRITER                                      00180000
*EXITS-NORMAL RETURN TO CALLING MODULE-IEHMVSSY                       * 00200000
*ERRORS: NONE                                                         * 00220000
*TABLES/WORK AREAS: MOVE/COPY COMMUNICATIONS TABLE                    * 00240000
*ATTRIBUTES: REUSEABLE                                                * 00260000
*NOTES: PART OF LOAD MODULE IEHMVESY                                  * 00264002
*                                                                       00268002
IEHDCBDM CSECT                                                          00269004
*A046410-046530,046700,077601-077602                           @ZA09158 00270004
*C013400,048600                                                @ZA09158 00271004
*A049890-049900                                                @ZA04377 00272103
*A049244-049266                                                @ZA01249 00272302
*D049244-049264                                                @ZA01249 00272602
*C049150,049170                                                @ZA01243 00273002
*A043613-043614                                                @ZA01229 00274002
*C027400                                                       @ZA01234 00276002
*A043680-043686                                                @YA02622 00283102
*D043680-043684                                                @YA02622 00283202
*D051300-051600                                                @YA02612 00283502
*A049150                                                       @YA02545 00284002
*C049170                                                       @YA02545 00285002
*D049150-049154                                                @YA02545 00286002
*D078000                                                        OY01176 00290102
*A005560,078000-078185,024930-024960                            OY01176 00290202
*A043604-043699                                                  A52003 00290422
*A077604-077607                                                  A52003 00290822
*A068200                                                         A99999 00292022
*A029400                                                         A48772 00310122
*A057000,058000                                                  A45188 00310422
*A029400,D033200,A045200,D048800                                 A45179 00310822
*A017020-017500                                                 OY01174 00311402
* 033800,049240                                                  A38744 00312021
*A009860-009920,049103-049190,067810-067920,076406-076568        A37919 00313022
*C067800,073200,073800,075600,076400,077600                      A37919 00314022
* 027640                                                                00315020
 TITLE 'IEHMVSRX-IEHMOVE BUILD/OPEN TO/FROM DCB,USE TODD/FROMDD'   1308 00320014
* --CODE ADDED BECAUSE OF FIX FOR DATA MANAGEMENT APAR 26725     A26725 00340019
*  (OPEN SVC ROUTINE WILL ISSUE TYPE 013 ABEND IF TRACK-OVERFLOW A26725 00340119
*   BIT IS ON IN DCB FOR DEVICE WHICH DOESN'T SUPPORT TRACK-     A26725 00340219
*   OVERFLOW)                                                    A26725 00340319
* 043680-043720                                                 PTM0125 00340519
* 065800-066000                                                  A21645 00340819
*                                                                  UL0H 00341017
*0057023800-024000,024800-025400,027200,041000-042000,043200,      UL0H 00342017
*         064600,069200                                            UL0H 00343017
*                                                                  UL0H 00344017
*0057043600                                                        4128 00352017
*0057025600-025800                                                 8461 00356017
*031400,047200                                                   A27726 00360019
*027800,037400-037600,043800,049720-049920,051700                 19030 00364019
*--ANY STATEMENTS FLAGGED 19030 PERTAIN TO VARIABLE SPANNED RECORD--    00368019
*--SUPPORT FOR BDAM DATA SETS                                           00372019
*                             REGISTER NOTATION AND USAGE               00380000
*                                                                       00400000
R0       EQU   0                        PARAM REG                       00420000
R1       EQU   1                        PARAM REG                       00440000
R3       EQU   3                        WORK REG                        00460000
R4       EQU   4                        WORK REG                        00480000
R5       EQU   5                        WORK REG                        00500000
R6       EQU   6                        WORK REG                        00520000
R7       EQU   7                        BASE FOR DCB                    00540000
R2       EQU   2                       WORK REG                    VS0H 00546017
R8       EQU   8                       WORK REG                    UL0H 00552017
R9       EQU   9                                                OY01176 00556002
R10      EQU   10                       BASE FOR JFCB                   00560000
R11      EQU   11                       BASE FOR IEHMVESX               00580000
R12      EQU   12                       BASE FOR COMMUNICATION AREA     00600000
R13      EQU   13                      SAVE REG                         00620000
R14      EQU   14                       RETURN REG                      00640000
R15      EQU   15                       ENTRY POINT REG                 00660000
*                                                                       00680000
*                                                                       00700000
*                             EQUATES                                   00720000
*                                                                       00740000
OPEN     EQU   X'10'                                             A38744 00750021
SELECT   EQU   X'02'                                                    00760000
FROMKEY  EQU   X'02'                                                    00780000
LOADUNLD EQU   X'03'                                                    00800000
DASD     EQU   X'20'                                                    00820000
TOKEYWRD EQU   X'40'                                                    00840000
PREALLOC EQU   X'08'                                                    00860000
FIVE     EQU   X'05'                                                    00880000
ZERO     EQU   X'00'                                                    00900000
TRKOFLOW EQU   X'DF'                    MASK TO 'AND' OFF        A26725 00905019
*                                        TRACK-OVERFLOW BIT IN   A26725 00910019
*                                        DCB RECFM BYTE          A26725 00915019
BLANK    EQU   X'40'                                                    00920000
CATALOG  EQU   X'04'                                                    00940000
LOAD     EQU   X'02'                                                    00960000
UNLOAD   EQU   X'01'                                                    00980000
RLSE     EQU   X'04'                   DEFAULT RELEASE           A37919 00986022
RLSEREQ  EQU   X'80'                   EXPLICIT RELEASE          A37919 00992022
TIOTDDNA EQU   X'04'                   TIOT DDNAME              YL026VC 00994002
*                                                                       01000000
*                                                                       01020000
*                             EXTRN AND ENTRY STATEMENTS                01040000
*                                                                       01060000
         ENTRY IEHMVESX                                                 01080000
         EXTRN MSG                                                      01100000
         EXTRN PREABORT                                                 01120000
*                                                                       01140000
*                                                                       01160000
*                             ASSEMBLER USING STATEMENTS                01180000
*                                                                       01200000
         USING IEHMVESX,R11                                             01220000
         USING IEHMVV,R12                                               01240000
         USING IHADCB,R7                                                01260000
         USING JFCBX,R10                                                01280000
         USING IECSDSL1,R12                                             01300000
         USING DEBBASIC,R3                                      YL026VC 01302002
         USING DEBAVT,R2                                        YL026VC 01304002
         USING DEBXTN,R4                                        YL026VC 01306002
         USING DSAB,R5                                          YL026VC 01308002
         USING TCB,R6                                           YL026VC 01310002
         USING IEZJSCB,R8                                       YL026VC 01312002
         USING QDB,R9                                           YL026VC 01314002
*                                                                       01320000
IEHMVESX SAVE  (14,12),T,IEHMVSRX-OZ09158                      @ZA09158 01340004
         LR    R11,R15                  SET UP ADDRESSABILITY FOR ESX   01360000
         IEHPRE (14,1),TFC                                              01380000
         CLI   IEHMVV22,FIVE            DOES THE FROM VOLUME LIST       01400000
*                                       INDICATE THAT MORE THAN 5       01420000
*                                       VOLUMES ARE INVOLVED IN THIS    01440000
*                                       REQUEST?                        01460000
         BH    ABORT                    YES. TERMINATE THIS REQUEST,    01480000
*                                       PRINT MESSAGE INDICATING        01500000
*                                       PROGRAM DOES NOT HANDLE MORE    01520000
*                                       THAN 5 VOLUMES AND CAUSE CONTRO 01540000
*                                       TO RETURN FOR ANOTHER REQUEST.  01560000
         CLI   IEHMVV23,FIVE            DOES THE TO VOLUME LIST         01580000
*                                       INDICATE THAT MORE THAN 5       01600000
*                                       VOLUMES ARE INVOLVED IN THIS    01620000
*                                       REQUEST?                        01640000
         BH    ABORT                    YES. TERMINATE THIS REQUEST AS  01660000
*                                       ABOVE.                          01680000
*                                       OTHERWISE CONTINUE PROCESSING   01700000
*                                       THIS REQUEST                    01720000
*                                                                       01740000
*                                                                       01760000
         TM    IEHMVV20+3,PREALLOC      HAS THE TO DATA SET BEEN        01780000
*                                       PREALLOCATED?                   01800000
         BZ    CONT                     NO.                             01820000
         MVC    SAVRECFM(1),IEHMVV31                                    01840000
         MVI    IEHMVV31,X'00'                                          01860000
*                                       SET HAS BEEN PREALLOCATED, THE  01880000
*                                       DSCB HAS BEEN READ INTO THE     01900000
*                                       VOLATILE WORK AREA. IT IS       01920000
*                                       NECESSARY TO SAVE THE RECORD    01940000
*                                       FORMAT FOR USE BY THE ROUTINE   01960000
*                                       GIVEN CONTROL BY OPENJ DURING   01980000
*                                       PROCESSING OF THE TO DCB.       02000000
CONT     DS    0H                       CONTINUE NORMAL PROCESSING      02020000
         L     R4,IEHMVV30                                              02040000
         LTR   R4,R4                    HAS FROM DCB BEEN BUILT?        02060000
         BNE   TODCBB                   YES. GO TO BUILD TO DCB         02080000
         TM    IEHMVV20,CATALOG         IS THIS A CATALOG FUNCTION?     02100000
         BO    CATDCBB                 YES. BUILD SPECIAL DCB           02120000
         L     R4,IEHMVV30+8            GET DSCB POINTER                02140000
         LH    R0,DS1DSORG-DS1DSNAM(R0,R4)                              02160000
*                                       GET DSORG FROM DSCB AND PASS    02180000
*                                       TO DCBBUILDER                   02200000
GOCAT    DS    0H                                                       02220000
         LA    R1,0                     PASS INPUT CODE TO DCBBUILDER   02240000
         L     R15,DCBB                                                 02260000
         BALR  R14,R15                  LINK WITH DCBBUILDER            02280000
         ST    R7,IEHMVV30              SAVE DCB POINTER                02300000
         LA    R10,IEHMVV00             SET UP ADDRESSABILITY FOR JFCB  02320000
         L     R4,IEHMVV30+12           GET DDNAME POINTER              02340000
         MVC   DCBDDNAM(8),0(R4)        MOVE DDNAME TO DCB              02360000
         LA    R4,IEHMVV70              GET EXIT LIST ADDRESS      UL0H 02380017
         O     R4,DCBEXLST              PICK UP HIGH ORDER BYTE    UL0H 02400017
         ST    R4,DCBEXLST              FROM EXIT LIST FIELD IN         02420000
*                                       DCB AND STORE IT WITH EXIT      02440000
*                                       LIST ADDRESS IN DCB             02460000
         ST    R10,UDCBJFCB             SET UP JFCB EXIT LIST ADDR UL0H 02470017
         MVI   UDCBJFCB,X'87'             AND ACTIVATE ENTRY       UL0H 02480017
         MVC   UDCBDCBE(4),DCBXX        SET UP DCB EXIT LIST ADDR  UL0H 02490017
         MVC   UDCBIHLE(4),ADIHLR ADDR.INPUT HEADER-LABEL ROUT. OY01176 02493002
         MVI   UDCBIHLE,X'01'    INDICATE INPUT HEADER LABEL    OY01176 02496002
         CLI   UDCBOHLE,X'00'           IS OHLE INACTIVE           UL0H 02500017
         BE    SETLABSW                 YES, CONTINUE              UL0H 02510017
         MVC   UDCBOHLE(4),XXOHLE       NO, SET UP OHLE LIST ADDR  UL0H 02520017
SETLABSW DS    0H                                                  UL0H 02530017
         MVI   IEHMVV72+8,X'01'         SET 1ST LABEL SWITCH       UL0H 02540017
         XC    IEHMVV72+4(4),IEHMVV72+4 CLEAR CURRENT LABEL POINTERUL0H 02550017
         TM    IEHMVV20+3,FROMKEY       WAS FROMDD KEYWORD SPECIFIED?   02600000
         BO    FROMDD                   YES. GO TO MOVE FROM DDNAME     02620000
*                                       INTO DCB AND READ JFCB          02640000
         MVI   IEHMVV00,ZERO            NO. BUILD JFCB                  02660000
         MVC   IEHMVV00+1(175),IEHMVV00                                 02680000
*                                                                       02700000
         MVI   JFCBLTYP,X'0A'          INDICATE STAND. USER LBLS   UL0H 02720017
         MVI   JFCBIND2,X'40'         AND OLD DATA SET IN JFCB @ZA01234 02740002
*                                                                       02760000
FROMBACK EQU   *                                                        02760620
         TM    JFCBLTYP,SL          STANDARD LABEL               A32041 02761220
         BNO   BDAMTST            *B IF NOT- USE EXISTING RECFM  A32041 02761820
*                                                         BLKSIZEA32041 02762420
*                                                    AND LRECL   A32041 02763020
*                                                                A32041 02763620
         XC    JFCDSORG(1),JFCDSORG   ELSE ZERO OUT JFCB FIELDS  A32041 02764220
         XC    JFCRECFM(1),JFCRECFM      SO THE DCB FIELDS       A32041 02764820
         XC    JFCLRECL(2),JFCLRECL    WILL BE FILLED FROM THE   A32041 02765420
         XC    JFCBLKSI(2),JFCBLKSI    STANDARD LABEL            A32041 02766020
*                                                                A32041 02766620
BDAMTST  L     R4,IEHMVV30+8         ADDRESS OF FROM DSCB        A32041 02767220
         TM    82(R4),X'20'       IS DATA SET BDAM                19030 02768019
         BNO   FROMCONT           NO                              19030 02772019
         TM    84(R4),X'48'       IS THE RECFM VS                 19030 02776019
         BNO   FROMCONT           NO                              19030 02780019
         OI    50(R7),X'01'    TURN ON CHECK RTN BIT              19030 02784019
         OI    JFCBFTEK,X'20'     SET BUFTEK TO 'R'               19030 02788019
FROMCONT L     R4,IEHMVV21        GET DSNAME POINTER              19030 02792019
         MVC   JFCBDSNM(44),0(R4)       MOVE DSNAME INTO THE JFCB       02800000
         L     R4,IEHMVV30+12                                           02820000
         MVC   DCBDDNAM(8),0(R4)        RELOAD DDNAME TO THE DCB        02840000
         MVI   JFCBELNM,BLANK                                           02860000
         MVC   JFCBELNM+1(7),JFCBELNM SET ELEMENT NAME IN JFCB          02880000
*                                       TO BLANKS                       02900000
         LA    R6,JFCBVOLS              GET POINTER TO JFCB             02920000
*                                       VOLUME LIST                     02940000
         MVI   0(R6),X'40'                                       A45179 02950022
         MVC   1(29,R6),0(R6)         BLANK JFCBVOLS             A45179 02952022
         SR    R5,R5                                                    02960000
         IC    R5,IEHMVV22              GET VOLUME COUNT                02980000
         LA    R3,5                    LIMIT MOVE TO MAXIMUM OF         03000000
*                                       FIVE VOLUMES                    03020000
         L     R4,IEHMVV22              GET POINTER TO VOLUME LIST      03040000
         MVC   JFCBFLSQ(2),10(R4)       MOVE IN FILE SEQUENCE NUMBER    03060000
VOLIDLP  DS    0H                                                       03080000
         MVC   0(6,R6),4(R4)            MOVE IN VOLUME SERIAL NUMBER    03100000
         LA    R6,6(R6)                                                 03120000
         LA    R4,17(R4)    ADJUST TO NEXT VOLUME NUMBER IN LIST A27726 03140019
         BCT   R3,NVOLIDS               HAVE FIVE VOLUME NUMBERS        03160000
*                                       BENN MOVED?                     03180000
         MVI   JFCBNVOL,FIVE            YES.                            03200000
         B     FDDRTN                                                   03220000
NVOLIDS  BCT   R5,VOLIDLP               HAVE ALL THE VOLUME NUMBERS     03240000
*                                       BEEN MOVED?                     03260000
         MVC   JFCBNVOL(1),IEHMVV22     YES. MOVE IN ACTUAL VOLUME      03280000
*                                       COUNT                           03300000
FDDRTN   DS    0H                                                       03340000
         MVI   79(7),X'01'   INITIALIZE DCBEOBR FIELD TO DC A(1)  12574 03350015
         MVC   JFCBDSNM+53(3),IEHMVV82        MOVE TTR IN JFCB   S21042 03352021
         XC    IEHMVV82(3),IEHMVV82       AFTER THAT, CLEAR FIELDS21042 03354021
         OPEN  ((R7),INPUT),TYPE=J                                      03360000
         TM    DCBOFLGS-IHADCB(R7),OPEN SUCCESSFUL OPEN          A38744 03370021
         BO    OPENFROM                 YES CONTINUE             A38744 03380021
         MVI   IEHMVV61,X'26'           NO INDICATE MSG NUMBER   A38744 03390021
         B     ABEND                    AND TERMINATE THE REQ    A38744 03392021
OPENFROM OI    IEHMVV10-4,X'80'         INDICATE FROMDCB OPENED  A38744 03394021
         CLI   IEHMVV10-5,X'00'         IS THERE A MESSAGE TO BE        03400000
*                                       PRINTED?                        03420000
         BE    NOMSS                    NO. SKIP LINK TO MESSAGE WRITER 03440000
         IC    R4,IEHMVV61                                              03460000
         MVC   IEHMVV61(1),IEHMVV10-5   SET MESSAGE CODE                03480000
         L     R15,ADMSG                                                03500000
         BALR  R14,R15                  AND LINK TO MSG WRITER          03520000
         STC   R4,IEHMVV61              RESET MSG BYTE                  03540000
NOMSS    DS    0H                                                       03560000
         CLI   IEHMVV74+4,X'FF'         I/O ERR IN U.L. EXIT RTN   UL0H 03565017
         BE    IOERRMSG                 YES, TELL USER             UL0H 03570017
ERMSGRET DS    0H                                                       03575017
TODCBB   DS    0H             ENTRY POINT FOR BUILDING TO DCB           03580000
         TM    IEHMVV20+1,LOADUNLD      IS THIS BOTH LOAD AND UNLOAD    03600000
*                                       CONDITION?                      03620000
         BO    BBLLUU                   YES. USE SPECIAL DCB            03640000
         TM    IEHMVV20+1,UNLOAD        NO. IS THIS UNLOAD CONDITION?   03660000
         BO    UNDCBB                   YES                             03680000
         TM    IEHMVV20,CATALOG         NO. IS THIS CATALOG FUNCTION?   03700000
         BO    MYMDCB                   YES.                            03720000
TODCBB1  DS    0H                                                  VS0H 03730017
         L     R4,IEHMVV30+8      ADDR OF 'FROM' DSCB             19030 03734019
         TM    82(R4),X'20'       IS THIS A BDAM DATA SET         19030 03738019
         BNO   TURNOFF            NO                              19030 03742019
         TM    84(R4),X'48'       IS THIS A VS DATA SET           19030 03746019
         BNO   TURNOFF            NO                              19030 03750019
         TM    IEHMVV20+1,UNLOAD  IS THIS AN UNLOAD SITUATION     19030 03754019
         BO    REGSET             YES, ALLOW UNLOAD OF VS DATA    19030 03758019
TURNOFF  NI    IEHMVV20+1,X'FE'   TURN OFF UNLOAD SWITCH          19030 03762019
         LH    R0,DS1DSORG-DS1DSNAM(R0,R4)                              03770017
*                                       GET DSORG FROM DSCB             03780000
SETUNB   LA    R1,1                     PASS OUTPUT CODE TO             03800000
*                                       DCBBUILDER                      03820000
         L     R15,DCBB                                                 03840000
         BALR  R14,R15                  LINK TO DCBBUILDER              03860000
         ST    R7,IEHMVV31              SAVE DCB ADDRESS                03880000
         TM    IEHMVV20+1,LOADUNLD      LOAD AND UNLOAD CONDITION?      03900000
         BO    LLUUBB                   YES. RESOLVE BLOCKSIZES         03920000
RLLUUBB  DS    0H                                                       03940000
         L     R4,IEHMVV23+4            GET VOLUME LIST POINTER         03960000
         CLI   2(R4),DASD               IS TO DEVICE DA?                03980000
         BNE   NEDASD                   NO                              04000000
OKNE     DS    0H                                                       04020000
         LA    R10,IEHMVV00             SET UP ADDRESSABILITY FOR JFCB  04040000
         L     R4,IEHMVV31+8                                            04060000
         MVC   DCBDDNAM(8),0(R4)        MOVE DDNAME TO THE DCB          04080000
         LA    R4,IEHMVV70              GET EXIT LIST ADDRESS      UL0H 04090017
         O     R4,DCBEXLST              PICK UP HIGH ORDER BYTE    UL0H 04100017
         ST    R4,DCBEXLST                FROM EXIT LIST FIELD     UL0H 04110017
         ST    R10,UDCBJFCB             SET UP JFCB EXIT LIST ADDR UL0H 04120017
         MVI   UDCBJFCB,X'87'             AND ACTIVATE ENTRY       UL0H 04130017
         MVC   UDCBDCBE(4),XXXT         SET UP DCB EXIT LIST ADDR  UL0H 04140017
         CLI   UDCBOHLE,X'00'           IS OHLE INACTIVE           UL0H 04150017
         BE    LABSWSET                 YES, CONTINUE              UL0H 04160017
         MVC   UDCBOHLE(4),XXOHLE       NO, SET UP OHLE LIST ADDR  UL0H 04170017
LABSWSET DS    0H                                                  UL0H 04180017
         MVI   IEHMVV72+8,X'01'         SET 1ST LABEL SWITCH       UL0H 04190017
         XC    IEHMVV72+4(4),IEHMVV72+4 CLEAR CURRENT LABEL POINTERUL0H 04200017
         TM    IEHMVV20+3,TOKEYWRD      WAS TODD KEYWORD SPECIFIED?     04220000
         BO    TODD                     YES. GO TO READ JFCB            04240000
*                                                                       04260000
         MVI   IEHMVV00,ZERO            NO. BUILD NEW JFCB              04280000
         MVC   IEHMVV00+1(175),IEHMVV00                                 04300000
         MVI   JFCBLTYP,X'02'          INDICATE S L              A48589 04320022
         TM    UDCBITLE,X'03'          USER LABELS FOUND         A48589 04330022
         BNO   NOSUL                   NO  CONTINUE              A48589 04332022
         OI    JFCBLTYP,X'08'          YES  INDICATE IT          A48589 04334022
NOSUL    DS    0H                                                A48589 04336022
         MVI   JFCBIND2,X'40'           AND OLD DATA SET IN JFCB        04340000
TOBACK   DS    0H                                                       04360000
         ST    R1,SAVEREG1           SAVE REG1 FOR TIME MACRO    A52003 04360422
         TM    IEHMVV20,X'80'        MOVE-OPERATION              A52003 04360822
         BO    KEEPCDT               BRANCH,IF YES - NO CHANGE   A52003 04361222
         TM    IEHMVV20+3,X'08'        PREALLOCATED DATA SET   @ZA01229 04361302
         BO    RESET                   YES                     @ZA01229 04361402
         TIME  ,                     GET CURRENT CREATION-DATE   A52003 04361622
         XC    DW,DW                 CLEAR CONVERSION-AREA       A52003 04361722
         LR    R4,R1                 GET DATE IN REG4            A52003 04361822
         STH   R1,DW+6               STORE DDDF                  A52003 04361922
         CVB   R1,DW                 CONVERT IT TO BINARY        A52003 04362322
         STH   R1,DW+6               STORE IT IN ALIGNED AREA    A52003 04362722
         MVC   JFCBCRDT+1(2),DW+6    MOVE IT INTO THE JFCB       A52003 04363122
         SRDL  R4,4                  PUT X'F' INTO REG5          A52003 04363522
         SRL   R4,12                 REMOVE 'DDD'                A52003 04363922
         SLDL  R4,4                  PUT YYF IN REG4             A52003 04364422
         STH   R4,DW+6               STORE 'YYF' INTO CONV.AREA  A52003 04364822
         CVB   R1,DW                 CONVERT IT TO BINARY        A52003 04365222
         STC   R1,JFCBCRDT           STORE IT INTO JFCB          A52003 04365622
         B     TSTEXPDT              TEST EXPIRATION-DATE        A52003 04365722
KEEPCDT  L     R4,IEHMVV30+8         GET ADDR. FROM-DSCB         A52003 04365822
         MVC   JFCBCRDT(3),53(R4)    COPY EXISTING CREATIONDATE  A52003 04365922
TSTEXPDT CLC   JFCBXPDT(3),ZEROS       EXPDT SPEC IN DD-CARD   @YA02622 04368002
         BNE   RESET                   YES KEEP IT             @YA02622 04368202
         TM    IEHMVV20+3,X'08'        PREALLOCATED DATA SET   @YA02622 04368402
         BO    RESET                   YES KEEP EXPDT          @YA02622 04368602
         L     R4,IEHMVV30+8         IF NO, COPY IT FROM DSCB    A52003 04368822
         MVC   JFCBXPDT(3),56(R4)                                A52003 04369222
RESET    L     R1,SAVEREG1           RESET REG1                  A52003 04369622
         XC    JFCRECFM(1),JFCRECFM  CLEAR RECFM OF JFCB         A52003 04369722
         XC    JFCBLKSI(4),JFCBLKSI  CLEAR BLOCKSIZE + LRECL     A52003 04369822
         L     R4,IEHMVV30+8         GET ADDRESS OF FROM-DSCB    A52003 04369922
         TM    82(R4),X'20'       IS THIS A BDAM DATA SET         19030 04370019
         BNO   TOCONT             NO                              19030 04374019
         TM    84(R4),X'48'       IS THE RECFM VS                 19030 04378019
         BNO   TOCONT             NO                              19030 04382019
         OI    JFCBFTEK,X'20'     SET BUFTEK TO 'R'               19030 04386019
TOCONT   L     R4,IEHMVV31+8      ADDR OF DDNAME                  19030 04390019
         MVC   DCBDDNAM(8),0(R4)        MOVE DDNAME TO DCB              04400000
         L     R4,IEHMVV21+4                                            04420000
         MVC   JFCBDSNM(44),0(R4)       MOVE DSNAME TO JFCB             04440000
         MVI   JFCBELNM,BLANK                                           04460000
         MVC   JFCBELNM+1(7),JFCBELNM SET ELEMENT NAME TO BLANKS        04480000
         LA    R6,JFCBVOLS              GET VOLUME LIST POINTER         04500000
*                                       IN JFCB                         04520000
         MVI   0(R6),X'40'                                       A45179 04530022
         MVC   1(29,R6),0(R6)         BLANK JFCBVOLS             A45179 04532022
         SR    R5,R5                                                    04540000
         IC    R5,IEHMVV23+4            GET VOLUME COUNT                04560000
         LA    R3,5                     SET MAXIMUM COUNT OF VOLUME     04580000
*                                       NUMBERS TO BE MOVED             04600000
         L     R4,IEHMVV23+4                                            04620000
         MVC   JFCBFLSQ(2),10(R4)                                       04640000
         CLI   2(R4),X'80'             IS TO VOL TAPE          @ZA09158 04641004
         BNE   V1                      NO                      @ZA09158 04642004
         CLC   4(6,R4),BLANKS          IS TO VOL SER BLANK     @ZA09158 04643004
         BE    V5                      YES                     @ZA09158 04644004
         CLC   4(6,R4),SCRTCH          IS TO VOL SER SCRTCH    @ZA09158 04645004
         BNE   V1                      NO                      @ZA09158 04646004
V5       L     R1,IEHMVV31+8           DDNAME ADDRESS IN TIOT  @ZA09158 04647004
         SR    R4,R4                   CLEAR REG4              @ZA09158 04648004
         ICM   R4,3,14(R1)             GET UCB ADDRESS         @ZA09158 04649004
         CLI   27(R4),X'00' SHOULD FILE ONE BE WRITTEN         @ZA09158 04650004
         BE    V1                      YES                     @ZA09158 04651004
         MVC   0(6,R6),28(R4)          MOVE VOL SER TO JFCB    @ZA09158 04652004
         B     V4                                              @ZA09158 04653004
V1       DS    0H                                                       04660000
         L     R4,IEHMVV23+4           ACTIVE TO VOLUME        @ZA09158 04670004
         MVC   0(6,R6),4(R4)            MOVE VOLUME SERIAL TO JFCB      04680000
         LA    R6,6(R6)                                                 04700000
         LA    R4,17(R4)    ADJUST TO NEXT VOLUME NUMBER IN LIST A27726 04720019
         BCT   R3,V2                    HAVE FIVE VOLUME NUMBERS        04740000
*                                       BEEN MOVED?                     04760000
         MVI   JFCBNVOL,FIVE            YES                             04780000
         B     V3                                                       04800000
V2       BCT   R5,V1                    HAVE ALL VOLUME NUMBERS         04820000
*                                       BEEN MOVED?                     04840000
V4       MVC   JFCBNVOL(1),IEHMVV23+4  MOVE VOL COUNT TO JFCB  @ZA09158 04860004
V3       DS    0H                                                       04900000
         MVI   79(7),X'01'   INITIALIZE DCBEOBR FIELD TO DC A(1)  12574 04910015
         MVC   JFCBDSNM+53(3),IEHMVV82+4 MOVE TTR IN JFCB        S21042 04912022
         XC    IEHMVV82+4(3),IEHMVV82+4 AND CLEAR THE FIELD      S21042 04912222
         TM    IEHMVV20,X'04'          MOVE/COPY CATALOG         A37919 04912422
         BO    NORLSE                  *B IF YES-NO RELEASE      A37919 04912622
*                                      (DS1LSTAR IS MEANING-     A37919 04912822
*                                      LESS IN A CATALOG DSCB    A37919 04913022
         TM    DCBDSORG,X'20'          DSORG=DA                  A37919 04913222
         BZ    TESTU                   *B IF NOT                 A37919 04913422
         TM    DCBRECFM,X'40'          RECFM=V(B)(S)(T)          A37919 04913622
         BZ    TESTU                   *B IF NOT                 A37919 04913822
         TM    DCBRECFM,X'80'          SAME QUESTION             A37919 04914022
         BZ    NORLSE                  *B IF YES-NO RLSE         A37919 04914222
*                                      BECAUSE OF ANY EXISTING   A37919 04914422
*                                      RELATIVE TRACK ADDRESSING A37919 04914622
*                                      SCHEME)                   A37919 04914822
TESTU    TM    IEHMVV10-4,RLSE         DEFAULT ALLOC TO BE     @ZA01243 04915002
*                                      RELEASED AT CLOSE         A37919 04915622
         BZ    EXPL                    *B IF NOT                 A37919 04915822
         TM    IEHMVV20+3,PREALLOC     PREALLOCATION             A37919 04916022
         BO    EXPL                    *B IF YES-NO DEFAULT RLSE A37919 04916222
         B     SETRLSE                 *B TO APPLY DEFAULT RLSE  A37919 04916422
EXPL     TM    IEHMVV20+5,RLSEREQ      RLSE EXPLICITLY           A37919 04916622
         BZ    NORLSE                  *B IF NOT                 A37919 04916822
SETRLSE  OI    JFCBIND1,JFCRLSE        RELEASE UNUSED SPACE    @ZA01243 04917002
*                                      AT CLOSE                  A37919 04917222
         B     SETOFF                  *B TO CLEANUP             A37919 04917422
NORLSE   NI    JFCBIND1,X'FF'-JFCBRLSE INDIC NO RELEASE          A37919 04917622
SETOFF   NI    IEHMVV10-4,X'FF'-RLSE   SETOFF DEFAULT RLSE       A37919 04917822
*                                      FOR REUSABILITY           A37919 04918022
*                                                                A37919 04918222
*        IF THE FROM DATA SET IS A CHECKPOINT DATA SET ON A     YL026VC 04918402
*        SECURE VOLUME, THEN INITIALIZE THE TO DATA SET AS A    YL026VC 04918602
*        CHECKPOINT DATA SET                                    YL026VC 04918802
         STM   R4,R6,SCSV1              SAVE REGS               YL026VC 04918902
         STM   R8,R9,SCSV2              SAVE REGS               YL026VC 04919002
         L     R7,IEHMVV30              GET FROM DCB ADDRESS    YL026VC 04919202
         L     R3,DCBDEBAD              GET DEB ADDRESS         YL026VC 04919402
         L     R2,DEBAPPAD              GET DEB AVT ADDRESS     YL026VC 04919602
         L     R4,DEBXTNP               GET DEB EXTENSION ADDR  YL026VC 04919802
         L     R5,DEBXDSAB              GET DSAB ADDRESS        YL026VC 04920002
         TM    DSABFLG4,DSABCKVL        SECURE VOLUME           YL026VC 04920202
         BO    CSSEC                    YES                     YL026VC 04920402
         NI    IEHMVV30,X'FD'           CLEAR FROM SECURE FLAG  YL026VC 04920602
         B     OPNTO                    OPEN TO D/S             YL026VC 04920802
CSSEC    OI    IEHMVV30,X'02'           SET FROM SECURE FLAG    YL026VC 04921002
         TM    JFCBIND2,X'C0'           TO D/S HAVE DISP OF NEW YL026VC 04921202
         BZ    OPNTO                    NO - OPEN TO D/S        YL026VC 04921402
         L     R6,DEBTCBAD              GET TCB ADDRESS         YL026VC 04921602
         L     R8,TCBJSCB               GET JSCB ADDRESS        YL026VC 04921702
         L     R9,JSCDSABQ              GET DSAB QUEUE ADDRESS  YL026VC 04921802
         L     R5,QDBFELMP              GET FIRST DSAB ADDRESS  YL026VC 04922002
TIENSR   L     R2,DSABTIOT              GET TIOT DD ENTRY       YL026VC 04922202
         CLC   TIOTDDNA(8,R2),DCBDDNAM  TO DDNAME               YL026VC 04922402
         BE    TIEFND                   YES - THIS IS DSAB      YL026VC 04922602
*                                       FOR TO D/S              YL026VC 04922802
         L     R5,DSABFCHN              GET NEXT DSAB ADDRESS   YL026VC 04923002
         LTR   R5,R5                    LAST DSAB IN QUEUE      YL026VC 04923202
         BNZ   TIENSR                   NO - CONTINUE SEARCH    YL026VC 04923402
         B     OPNTO                    NO DSAB FOR TO DDNAME   YL026VC 04923602
TIEFND   MODESET EXTKEY=SUPR,SAVEKEY=(2) GET INTO DSAB KEY      YL026VC 04923802
         OI    DSABFLG4,DSABCKDS        SET CHECKPOINT FLAG     YL026VC 04924002
         MODESET KEYADDR=(2)            RESET KEY               YL026VC 04924202
OPNTO    TM    IEHMVV20+1,UNLOAD        UNLOAD SITUATION       @ZA01249 04924402
         BO    SKPOPTCD                 YES                    @ZA01249 04924602
         L     R7,IEHMVV31              GET TO DCB ADDRESS     @ZA01249 04924802
         L     R8,IEHMVV30+8            GET ADDR. FROM DSCB    @ZA01249 04925002
         MVC   52(1,R7),85(R8)          MOVE THE OPTCD-BYTE    @ZA01249 04925202
*                                       TO OUTPUT DCB          @ZA01249 04925402
SKPOPTCD L     R7,IEHMVV31             GET TO DCB ADDRESS      @ZA01249 04925602
         OPEN  ((R7),OUTPUT),TYPE=J                            @ZA01249 04925802
         TM    DCBOFLGS-IHADCB(R7),OPEN OPEN SUCCESSFUL        @ZA01249 04926002
         BO    OPENTO                  YES CONTINUE            @ZA01249 04926202
         MVI   IEHMVV61,X'28'          NO INDICATE MSG NUMBER  @ZA01249 04926402
         B     ABEND                   AND TERMINATE THE REQ   @ZA01249 04926602
OPENTO   OI    IEHMVV10-4,X'40'         INDICATE TO  DCB OPENED  A38744 04926821
         MVI   UDCBIHLE,X'00'          DEACTIVATE INHDR LBL EXIT   UL0H 04928017
         MVI   UDCBOHLE,X'00'          DEACTIVATE OUTHDR LBL EXIT  UL0H 04932017
*                                                               YL026VC 04932202
*        TERMINATE REQUEST IF FROM ADN TO DATA SETS DO NOT      YL026VC 04932402
*        HAVE THE SAME CHECKPOINT SECURE STATUS                 YL026VC 04932602
*                                                               YL026VC 04932802
         L     R3,DCBDEBAD             GET TO DEB ADDRESS       YL026VC 04933002
         L     R2,DEBAPPAD             GET DEB AVT ADDRESS      YL026VC 04933202
         L     R4,DEBXTNP              GET DEB EXTENSION ADDR   YL026VC 04933402
         L     R5,DEBXDSAB             GET DSAB ADDRESS         YL026VC 04933602
         TM    DSABFLG4,DSABCKVL       SECURE VOLUME            YL026VC 04933802
         BO    CSSEC2                  YES                      YL026VC 04934002
         NI    IEHMVV30,X'FE'          CLEAR TO SECURE FLAG     YL026VC 04934202
         B     CSCRTST                 TEST SECURE STATUS       YL026VC 04934402
CSSEC2   OI    IEHMVV30,X'01'          SET TO SECURE FLAG       YL026VC 04934602
CSCRTST  LM    R4,R6,SCSV1              RESTORE REGS            YL026VC 04934702
         LM    R8,R9,SCSV2              RESTORE REGS            YL026VC 04934802
         TM    IEHMVV30,X'02'           FROM D/S SECURE         YL026VC 04934902
         BO    CSCRT2                  YES                      YL026VC 04935002
         TM    IEHMVV30,X'01'          TO D/S SECURE            YL026VC 04935202
         BZ    CSCROK                  NO - PROCEED W/REQUEST   YL026VC 04935402
         MVI   IEHMVV61,X'2C'          INDICATE MSG NUMBER      YL026VC 04935602
         B     ABEND                   TERMINATE REQUEST        YL026VC 04935802
CSCRT2   TM    IEHMVV30,X'01'          TO D/S SECURE            YL026VC 04936002
         BO    CSCROK                  YES - PROCEED W/REQUEST  YL026VC 04936202
         MVI   IEHMVV61,X'2E'          INDICATE MSG NUMBER      YL026VC 04936402
         B     ABEND                   TERMINATE REQUEST        YL026VC 04936602
CSCROK   NI    IEHMVV30,X'FC'          CLEAR SECURE FLAGS       YL026VC 04936802
*                                                                  VS0H 04937002
*  THE FOLLOWING CHECKS ARE MADE TO DETERMINE WHETHER A VS OR VBS  VS0H 04940017
*  DATA SET CAN BE MOVED/COPIED FROM DA TO TAPE. NORMALLY A DATA   VS0H 04944017
*  SET ON DA WITH KEYS IS UNLOADED WHEN 'TO' DEVICE IS TAPE.  VS   VS0H 04948017
*  AND VBS DATA SETS MAY NOT BE UNLOADED.  IF THE FROM DATA SET HASVS0H 04952017
*  A RECFM=VS OR VBS, IF THE FROM DEVICE IS DA, AND THERE ARE KEYS VS0H 04956017
*  PRESENT; AND IF THE TO DEVICE IS TAPE, A MESSAGE WILL BE GIVEN  VS0H 04960017
*  TO INDICATE THE DATA SET WILL NOT BE MOVED/COPIED/UNLOADED.     VS0H 04964017
*                                                                  VS0H 04968017
         L     R1,IEHMVV30             GET FROM DCB ADDRESS        VS0H 04970017
         TM    36(R1),X'58'     TEST 'FROM' DCB FOR VBS           19030 04973019
         BO    BDAMCHK          VBS DATA SET.GO TEST KEY          19030 04976019
BDAMCHK  TM    36(R1),X'48'     TEST 'FROM' DCB FOR VS            19030 04979019
         BNO   NORMCODE         NOT A SPANNED DATA SET            19030 04982019
         TM    26(R1),X'20'     TES FOR BDAM DSORG                19030 04985019
         BO    NORMCODE         ALL BDAM VS PROCESSING            19030 04988019
         TM    17(R1),X'80'            FROM TAPE               @ZA04377 04989003
         BO    NORMCODE                YES DO NOT CHECK KEY    @ZA04377 04990003
TESTKEY  CLI   16(R1),X'00'     FROM DATA SET KEYLEN=0            19030 04991019
         BE    NORMCODE                YES, NO PROBLEM             VS0H 04996017
         L     R2,IEHMVV31             GET TO DCB ADDRESS          VS0H 05000017
         TM    17(R2),X'20'            TO DEVICE DIRECT ACCESS     VS0H 05004017
         BC    1,ANYKEYTO              YES, STILL NO PROBLEM       VS0H 05008017
         MVI   IEHMVV61,X'0D'          SET CODE TO GIVE MSG, ABORT VS0H 05012017
         B     ABEND                   GO GIVE CONTROL TO PREABORT VS0H 05016017
ANYKEYTO CLI   16(R2),X'00'            TO DATA SET KEYLEN=0        VS0H 05020017
         BE    KEYERR                  ERROR, BOTH DATA SETS       VS0H 05024017
*                                      MUST HAVE KEYS              VS0H 05028017
         CLC   16(1,R2),16(R1)         TO, FROM KEYLENS EQUAL      VS0H 05032017
         BE    NORMCODE                YES                         VS0H 05036017
KEYERR   MVI   IEHMVV61,X'0F'          UNEQUAL KEYLENS,ERROR       VS0H 05040017
         B     ABEND                   SET  MSG CODE, GIVE MSG     VS0H 05044017
NORMCODE B     PROCEED                 NORMAL PROCEDURE            VS0H 05048017
MYMDCB   DS    0H                                                       05052017
         L     R4,IEHMVV23+4           GET VOLUME LIST POINTER          05056017
         CLI   2(R4),DASD              IS TO DEVICE DA                  05060017
         BE    PROCEED                 YES, EXIT.                       05064017
         OI    IEHMVV20+1,UNLOAD       SET UNLOAD BIT                   05068017
UNDCBB   DS    0H                       AND GO TO BUILD DCB FOR         05100000
*                                       UNLOAD CONDITION                05120000
         TM    IEHMVV20+1,LOADUNLD IS THIS BOTH LOAD AND UNLOAD    3826 05123018
         BO    BBLLUU              YES, BUILD SPECIAL DCB          3826 05126018
REGSET   LA    R0,1               PASS SPECIAL DSORG TO DCB BLDR  19030 05170019
*                                      DCB BUILDER                 VS0H 05180017
         B     SETUNB                                                   05190017
BBLLUU   SR    R0,R0                    PASS SPECIAL DSORG CODE TO      05200000
         B     SETUNB                   DCBBUILDER FOR LOAD/UNLOAD      05220000
*                                       SITUATION                       05240000
LLUUBB   MVI   DCBLRECL+1,X'50'         SET LOGICAL RECORD LENGTH       05260000
*                                       IN DCB AT 80                    05280000
         MVI   DCBRECFM,X'90'           SET RECORD FORMAT TO FIXED      05300000
*                                       AND STANDARD                    05320000
         L     R5,IEHMVV23                                              05340000
         MVI   DCBBLKSI+1,X'50'         MOVE IN BLOCK SIZE OF 80        05360000
         CLI   2(R5),X'08'              IS TO DEVICE UNIT RECORD?       05380000
         BE    RLLUUBB                  YES. RETURN TO NORMAL FLOW      05400000
         MVI   DCBBLKSI+1,X'20'         MOVE IN BLOCKSIZE OF 800        05420000
         MVI   DCBBLKSI,X'03'           WHEN TO DEVICE IS NOT           05440000
         B     RLLUUBB                  UNIT RECORD                     05460000
CATDCBB  DS    0H                                                       05480000
         LA    R0,2                     GET SPECIAL DSORG CODE FOR      05500000
         B     GOCAT                    CATALOG OPERATION AND PASS IT   05520000
*                                       TO DCBBUILDER                   05540000
PROCEED  DS    0H                                                       05560000
         IEHPOST  (14,1),TFC                                            05580000
*                                                                       05600000
*                                                                       05620000
         RETURN  (14,12), T                                             05640000
FROMDD   DS    0H                       IF FROMDD SPECIFIED MOVE        05660000
         L     R1,IEHMVV28              FROMDDNAME TO THE DCB           05680000
         MVC   DCBDDNAM(8),0(R1)        SO THAT JFCB CAN BE READ        05700022
         BAL   R5,SCANTIOT             RETURN IF DDNAME FOUND    A45188 05710022
         RDJFCB ((R7))                  READ FROM JFCB           A45188 05759922
         B     FROMBACK                 RETURN TO FILL IN JFCB          05770022
TODD     DS    0H                      IF TODD SPECIFIED MOVE           05772022
         L     R1,IEHMVV28+4            TODDNAME TO THE DCB SO THAT     05780000
         MVC   DCBDDNAM(8),0(R1)        CORRECT JFCB WILL BE READ       05800000
         BAL   R5,SCANTIOT             RETURN IF DDNAME FOUND    A45188 05802022
         RDJFCB ((R7))                                                  05804022
         B     TOBACK                  RETURN TO FILL IN JBCB           05806022
SCANTIOT DS    0H                                                A45188 05808022
         L     R4,16                    FIND ADDR CVT            A45188 05810022
         L     R4,0(R4)                FIND TCB POINTERS         A45188 05811022
         L     R4,4(R4)                 FIND TCB ADDR            A45188 05812022
         L     R4,12(R4)                FIND TIOT ADDR           A45188 05814022
         LA    R4,24(R4)                FIND FIRST DD ENTRY      A45188 05816022
NEXTDD2  SR    R6,R6                                             A45188 05818022
         IC    R6,0(R4)                 FIND ENTRY LENGTH        A45188 05818422
         CLC   4(8,R4),0(R1)            DDNAME FOUND             A45188 05818822
         BCR   8,R5                    YES RETURN                A45188 05819322
         AR    R4,R6                    NO GO TO NEXT ENTRY      A45188 05819622
         L     R6,0(R4)                                          A45188 05819722
         LTR   R6,R6                    END OF TIOT              A45188 05819822
         BNZ   NEXTDD2                 NO COMPARE NEXT ONE       A45188 05819922
         MVI   IEHMVV61,X'2A'           YES INDIC MSG NBR        A45188 05826622
         B     ABEND                    AND TERMINATE THE REQ    A45188 05828622
RDTOJFCB DS    0H                                                A45188 05830622
NEDASD   DS    0H                                                       05860000
         TM    IEHMVV20+1,UNLOAD        IS THIS AN UNLOAD SITUATION?    05880000
         BO    OKNE                     YES. RETURN TO BUILDING DCB     05900000
*                                                                       05920000
         TM    IEHMVV20+1,LOAD          IS THIS ALOAD SITUATION ?       05940000
         BO    XLOADX                   YES. GO TO RESOLVE BLOCKSIZE    05960000
*                                       AND RECORD FORMAT FOR LOAD      05980000
         L     R4,IEHMVV30                                              06000000
         L     R5,IEHMVV31              GET POINTERS TO FROM AND TO     06020000
*                                       DCBS                            06040000
         MVC   DCBBLKSI-IHADCB(2,R5),DCBBLKSI-IHADCB(R4)                06060000
*                                       MAKE BLOCKSIZE OF FROM AND TO   06080000
*                                       DCB EQUAL                       06100000
*                                       MAKE RECORD LENGTH AND FORMAT   06120000
*                                       OF BOTH DCBS EQUAL              06140000
         MVC   DCBLRECL-IHADCB(2,R5),DCBLRECL-IHADCB(R4)                06160000
         MVC   DCBRECFM-IHADCB(1,R5),DCBRECFM-IHADCB(R4)                06180000
         NI    DCBRECFM-IHADCB(R5),TRKOFLOW  TURN OFF TRACK-     A26725 06183019
*                                        OVERFLOW BIT IN TO      A26725 06186019
*                                        DCB'S RECFM BYTE (TAPES A26725 06189019
*                                        CANNOT HAVE TRACK-      A26725 06192019
*                                        OVERFLOW RECFM)         A26725 06195019
         B     OKNE                     RETURN TO BUILDING DCB          06200000
XLOADX   DS    0H             THIS ENTRY  POINT IS USED  TO MOVE        06220000
*                             BLOCKSIZE, RECORD LENGTH AND FORMAT       06240000
*                             FROM  THE  DSCB  TO THE  TO DCB           06260000
*                             IN  LOAD  SITUATIONS ONLY                 06280000
         L     R5,IEHMVV31                                              06300000
         L     R4,IEHMVV30+8            GET POINTERS TO TO DCB AND      06320000
*                                       FROM  DSCB                      06340000
         MVC   DCBBLKSI-IHADCB(2,R5),DS1BLKL-DS1DSNAM(R4)               06360000
         MVC   DCBLRECL-IHADCB(2,R5),DS1LRECL-DS1DSNAM(R4)              06380000
         MVC   DCBRECFM-IHADCB(1,R5),DS1RECFM-DS1DSNAM(R4)              06400000
         NI    DCBRECFM-IHADCB(R5),TRKOFLOW  TURN OFF TRACK-     A26725 06403019
*                                        OVERFLOW BIT IN TO      A26725 06406019
*                                        DCB'S RECFM BYTE (TAPES A26725 06409019
*                                        CANNOT HAVE TRACK-      A26725 06412019
*                                        OVERFLOW RECFM)         A26725 06415019
         B     OKNE                     RETURN  TO BUILDING DCB         06420000
         DS    0F                                                       06440000
DCBXX    DC    X'05'                   DCB EXIT LIST ENTRY FOR     UL0H 06460017
         DC    AL3(MYEXIT)              FROM DCB                        06480000
ZZZ      DC    X'0000'                                                  06500000
MYEXIT   DS    0H                                                       06520000
         CLC   DCBDSORG(2),BDAM                                         06540000
         BNE   CBLK                                                     06560000
         TM    DCBRECFM,X'40'    RECFM  U  OR  V                 A21645 06580018
         BO    CBLK                                              A21645 06600018
         OI    DCBOPTCD,RBA            INDICATE USE OF RELATIVE         06620000
*              BLOCK ADDRESSING FOR FIXED LENGTH RECORDS FOR            06640000
*              BDAM.    THIS MUST BE USED TO MOVE TRACK OVERFLOW        06660000
*              BDAM DATA SETS.                                          06680000
FIXED    EQU   X'80'                                                    06700000
RBA      EQU   X'01'                                                    06720000
CBLK     CLC   DCBBLKSI(2),ZZZ         IS BLKSIZE ZEROX                 06740000
         BE    CHBLK                    YES  GO TO CHANGE IT            06760000
DCBRTN   RETURN RC=0                    NO  RETURN TO OPEN J            06780000
CHBLK    DS    0H                                                       06800000
         MVI   IEHMVV10-5,X'05'         SET MESSAGE BYTE                06810022
         MVI   DCBBLKSI,X'0A'                                           06820000
         CLI   DCBRECFM,X'00'          RECFM SPECIFIED           A99999 06830022
         BNE   DCBRTN                  YES  RETURN TO OPEN       A99999 06832022
         MVI   DCBRECFM,X'C0'          NO  MAKE IT UNDEFINED     A99999 06840022
         B     DCBRTN                   RETURN TO OPEN J                06880000
         DS    0F                                                       06900000
XXXT     DC    X'05'                   DCB EXIT LIST ENTRY FOR     UL0H 06920017
         DC    AL3(MYTOEXIT)            TO DCB                          06940000
MYTOEXIT DS    0H             ENTRY POINT GIVEN CONTROL BY OPENJ        06960000
*                             FOR PROCESSING THE TO DCB                 06980000
         L     R4,IEHMVV30                                              07000000
         CLC   DCBBLKSI(2),ZZZ          IS BLOCK SIZE ZERO?             07020000
         BNE   AROUND                   NO. GO TO TEST DSORG            07040000
         TM    IEHMVV20+1,LOAD         WILL THIS REQUEST RESULT IN A    07060000
*                                        LOADED PDS ON THE              07080000
*                                        RECEIVING VOLUME               07100000
         BNO   MVBLK                                            OY01174 07104002
         L     R4,IEHMVV30+8           FROMDSCB ADDR            OY01174 07108002
         CLC   DS1BLKL-DS1DSNAM(2,R4),ZZZ  IF BLKSIZE ZERO      OY01174 07112002
         BNE   JLDCBSET                GO MOVE DCB PARAMETERS   OY01174 07116002
         MVI   DCBBLKSI,X'0A'          ELSE TAKE DEFAULTBLKSI   OY01174 07120002
         MVI   DCBRECFM,X'C0'           AND DEFAULT RECFM       OY01174 07130002
*                                      FROM THE FROM DSCB       OY01174 07140002
         OI    JFCBTSDM,X'01'      INDICATE DSCB COMPLETE       OY01174 07145002
         B     DCBRTN              GO RETURN TO OPEN            OY01174 07150002
MVBLK    EQU   *                                                OY01174 07155002
         MVC   DCBBLKSI(2),DCBBLKSI-IHADCB(R4)                          07160000
*                                       IF BLOCKSIZE IS ZERO, MOVE      07180000
*                                       BLOCKSIZE AND RECORD LENGTH     07200000
*                                       FROM THE FROM DCB TO THE TO DCB 07220000
         MVC   DCBLRECL(2),DCBLRECL-IHADCB(R4)                          07240000
AROUND   CLC   DCBDSORG(2),BDAM         IS TO DSORG BDAM?               07260000
         BNE   TESTTO                   NO. GO TO TEST FOR PREALLOCATE  07280000
DONE     CLC   DCBRECFM(1),ZZZ     IS THE RECFM ZERO               1308 07300014
         BNE   DCBRTN              BRANCH IF NOT ZERO                   07320000
         MVC   DCBRECFM(1),DCBRECFM-IHADCB(R4)                          07340000
*                                  USE RECORD FORMAT OF FROM DCB        07360000
         B     DCBRTN                   RETURN TO OPEN                  07380000
TESTTO   TM    IEHMVV20+3,PREALLOC      HAS THE TO DATA SET BEEN        07400000
*                                       PREALLOCATED?                   07420000
         BZ    DONE                     NO. GO TO FILL IN RECORD FORMAT 07440000
*                                       FIELD AND RETURN TO OPEN        07460000
         TM    IEHMVV20,X'08'           CHECK FOR PDS KEYWORD           07480000
         BO    DONE                IF YES, GO CHECK FOR RECFM      1308 07500014
         MVC   DCBRECFM(1),SAVRECFM   IF NO, USE THE SAVED RECFM   1308 07520014
         CLI    DCBRECFM,X'00'             IS NEW RECFM SPECIFIED       07540000
         BNE    DCBRTN                  YES USE NEW RECFM               07560000
         MVC    DCBRECFM(1),DCBRECFM-IHADCB(R4)   NO MOVE IN OLD RECFM  07580000
*                                       SAVED FROM THE TO DSCB TO FILL  07600000
*                                       IN THE TO DCB                   07620000
         B     DCBRTN                   RETURN TO OPEN                  07640000
JLDCBSET L     R4,IEHMVV30+8           GET PNTR TO FROM DSCB            07660000
*                                      AND FILL IN DCB FIELDS           07680000
         MVC   DCBBLKSI(2),86(R4)                                       07700000
         MVC   DCBRECFM(1),84(R4)                                       07720000
         MVC   DCBLRECL(2),88(R4)                                       07740000
         B     DCBRTN                                                   07760000
BLANKS   DC    CL6'      '                                     @ZA09158 07760104
SCRTCH   DC    CL6'SCRTCH'                                     @ZA09158 07760204
DW       DS    D                                                 A52003 07760422
SAVEREG1 DS    F                                                 A52003 07760522
ZEROS    DC    X'000000'                                         A52003 07760622
ALLZEROS DC    F'0'                                              A52003 07760722
XXOHLE   DC    X'02'                    OUTPUT HEADER LABEL        UL0H 07760917
         DC    AL3(OHLR)                  ROUTINE EXIT             UL0H 07761217
*                                                                  UL0H 07761517
OHLR     DS    0H                                                  UL0H 07761817
OFFSET1  EQU   OHLR-IEHMVESX                                       UL0H 07762117
* USER OUTPUT HEADER LABEL ROUTINE ENTERED FROM OPENJ OF OUTPUT DCBUL0H 07762417
*                                                                  UL0H 07762717
         LA    R8,OFFSET1              SET UP                      UL0H 07763017
         SR    R15,R8                  ADDRESSABILITY              UL0H 07763317
         LR    R11,R15                 FOR EXIT ROUTINE            UL0H 07763617
         CLI   IEHMVV72+8,X'01'         FIRST LABEL SWITCH ON      UL0H 07763917
         BNE   PROVIDE                  NO, PROVIDE NEXT LABEL     UL0H 07764217
         CLC   IEHMVV72(4),ALLZEROS     YES, LABELS IN GOTTEN CORE UL0H 07764517
         BE    IGNORE                   NO, IGNORE LABEL REQUEST   UL0H 07764817
         MVC   IEHMVV72+4(4),IEHMVV72   INITIALIZE LABEL POINTER   UL0H 07765117
         MVI   IEHMVV72+8,X'00'         CLEAR 1ST LABEL SWITCH     UL0H 07765417
PROVIDE  DS    0H                                                  UL0H 07765717
         TM    8(R1),X'80'             I/O ERROR FLG ON IN PARMLST UL0H 07766017
         BO    IOERR                   YES, GIVE MESSAGE           UL0H 07766317
         CLI   IEHMVV72+12,X'00'       LABEL COUNT AT ZERO         UL0H 07766617
         BE    FRECORE                 YES, NO LABELS, FREE CORE   UL0H 07766917
         L     R8,IEHMVV72+4            GET ADDR OF CURRENT LABEL  UL0H 07767217
         L     R15,0(R1)               GET ADDR OF OPEN LBL BUFFER UL0H 07767517
         MVC   0(80,R15),0(R8)         MOVE LABEL TO OUTPUT BUFFER UL0H 07767817
         LA    R8,80(0,R8)              UPDATE POINTER TO NEXT     UL0H 07768117
         ST    R8,IEHMVV72+4              LABEL AND SAVE POINTER   UL0H 07768417
         SR    R15,R15                  REDUCE                     UL0H 07768717
         IC    R15,IEHMVV72+12            USER                     UL0H 07769017
         BCTR  R15,R0                       LABEL                  UL0H 07769317
         STC   R15,IEHMVV72+12                COUNT                UL0H 07769617
*                                                                  UL0H 07769917
         LA    R15,8                    RETURN CODE 8 TO OPEN FOR  UL0H 07770217
         BR    R14                        ANOTHER LABEL            UL0H 07770517
*                                                                  UL0H 07770817
FRECORE  DS    0H                                                  UL0H 07771117
         L     R8,IEHMVV72              GET ADDR OF GOTTEN CORE    UL0H 07771417
         FREEMAIN R,LV=640,A=(R8)       FREE GOTTEN CORE           UL0H 07771717
         XC    IEHMVV72(8),IEHMVV72     RESET POINTERS             UL0H 07772017
*                                                                  UL0H 07772317
IGNORE   DS    0H                                                  UL0H 07772617
         SR    R15,R15                  RETURN CODE 0 TO OPEN TO   UL0H 07772917
         BR    R14                        IGNORE LABELS            UL0H 07773217
*                                                                  UL0H 07773517
*                                                                  UL0H 07773817
*     GIVE MESSAGE--I/O ERROR WRITING USER OUTPUT HEADER LABELS    UL0H 07774117
*                                                                  UL0H 07774417
IOERR    DS    0H                                                  UL0H 07774717
         OI    IEHMVV74+4,X'FF'         YES, SET FLAG TO OUTPUT    UL0H 07775017
*                                        MSG AFTER OPEN/CLOSE/EOV  UL0H 07775317
         B     FRECORE                  GO FREE GOTTEN CORE        UL0H 07775617
*                                                                       07775917
IOERRMSG DS    0H                                                  UL0H 07776217
         OI    IEHMVV74+4,X'00'         CLEAR I/O ERROR FLAG       UL0H 07776517
         SR    R4,R4                    CLEAR REG 4                UL0H 07776817
         IC    R4,IEHMVV61             SAVE CURRENT MSG CODE       UL0H 07777117
         MVI   IEHMVV61,X'0B'          MOVE IN CODE FOR THIS MSG   UL0H 07777417
         L     R15,ADMSG               GET ADDR OF MSG WRITER      UL0H 07777717
         BALR  R14,R15                 AND GO GIVE MSG             UL0H 07778017
         STC   R4,IEHMVV61             RESTORE TO PREV. VALUE      UL0H 07778317
         B     ERMSGRET                 RETURN TO INLINE PROCESSINGUL0H 07778617
*                                                                       07780000
ADIHLR   DC    X'01'             INPUT HEADER LABEL ROUTINE     OY01176 07800002
         DC    AL3(IHLR)         DCB-EXLIST ENTRY               OY01176 07800502
IHLR     DS    0H                                               OY01176 07801002
OFFSET   EQU   IHLR-IEHMVESX                                    OY01176 07801502
         LA    R8,OFFSET         SET UP                         OY01176 07802002
         SR    R15,R8            ADDRESSABILITY                 OY01176 07802502
         LR    R11,R15           FOR EXIT ROUTINE               OY01176 07803002
         L     R8,0(R1)          GET ADDR. OF LABEL BUFFERAREA  OY01176 07803502
         LTR   R8,R8             ARE USER LABELS PRESENT        OY01176 07804002
         BNE   CHKIOERR          YES,IS I/O-ERROR INDICATED     OY01176 07804502
NOLABEL  SR    R15,R15           NO,RETURN TO OPEN,RETURNCODE 0 OY01176 07805002
         BR    R14                                              OY01176 07805502
CHKIOERR DS    0H                                               OY01176 07806002
         TM    8(R1),X'80'       PERM.ERROR SHOWN IN PARMLIST   OY01176 07806502
         BC    14,CORAVAIL       NO,SEE IF CORE GOTTEN YET      OY01176 07807002
LABLERR  DS    0H                                               OY01176 07807502
         OI    IEHMVV74+4,X'FF'  YES,SET FLAG TO OUTPUT MSG     OY01176 07808002
         MVI   UDCBIHLE,X'00'    DEACTIVATE HEADER LABEL ENTRIES Y01176 07808502
         MVI   UDCBOHLE,X'00'    IN DCB-EXIT LIST               OY01176 07809002
         OI    IEHMVV20+2,X'40'  TELL ESN TO PUT OUT MSG        OY01176 07809502
         BR    R14               RETURN TO OPENJ                OY01176 07810002
CORAVAIL DS    0H                                               OY01176 07810502
         CLC   IEHMVV72(4),ALLZEROS WAS CORE GOTTEN FOR LABELS  OY01176 07811002
         BNE   SAVLABEL          ADDR.NOT ZERO,CORE GOTTEN      OY01176 07811502
         GETMAIN R,LV=640        GET CORE IF NECESSARY          OY01176 07812002
         ST    R1,IEHMVV72       SAVE ADDR.OF GOTTEN CORE       OY01176 07812502
         MVC   IEHMVV72+4(4),IEHMVV72 SAVE PTR TO LABELSAVEAREA OY01176 07813002
SAVLABEL DS    0H                                               OY01176 07813502
         L     R9,IEHMVV72+4     GET ADDR.CURRENT LBL-SAVEAREA  OY01176 07814002
         MVC   0(80,R9),0(R8)    MOVE LBL TO AREA FROM LABELBF  OY01176 07814502
         LA    R9,80(R9)         UPDATE PTR TO NEXT AREA        OY01176 07815002
         ST    R9,IEHMVV72+4     STORE UPDATED PTR              OY01176 07815502
         SR    R9,R9                                            OY01176 07816002
         IC    R9,IEHMVV72+12    PICK UP COUNT OF LABELS        OY01176 07816502
         LA    R9,1(R9)          INCREMENT COUNT BY 1           OY01176 07817002
         STC   R9,IEHMVV72+12    STORE UPDATED COUNT            OY01176 07817502
         LA    R15,4             RETCODE 4 TO GET ADDIT.LABELS  OY01176 07818002
         BR    R14               RETURN TO OPENJ-ROUTINE        OY01176 07818502
ABORT    DS    0H             THIS ENTRY POINT IS USED TO ABNORMALLY    07820000
*                             TERMINATE A REQUEST WHICH INVOLVES MORE   07840000
*                             THAN 5 VOLUMES.                           07860000
         MVI   IEHMVV61,X'07'           SET MESSAGE CODE TO PRINT MSG   07880000
*                                       INDICATING WHY THIS REQUEST IS  07900000
*                                       BEING TERMINATED.               07920000
ABEND    L     R14,PREAB                                                07940000
         BR    R14                      GOTO PREABORT ROUTINE WHICH     07960000
*                                       PRINTS MSG, CLOSES THE FROM AND 07980000
*                                       TO DCBS IF THEY HAVE BEEN       08000000
*                                       OPENED, AND RETURNS CONTROL TO  08020000
*                                       IEHMVESH IF THERE IS ANOTHER    08040000
*                                       REQUEST OR TO IEHMVESK IF THERE 08060000
*                                       ARE NO MORE REQUESTS.           08080000
*                                                                       08100000
*                                                                       08120000
*                                                                       08140000
*                             DCB BUILDER ROUTINE                       08160000
*********************************************************************** 08180000
*    THIS ROUTINE FORMATS A DCB FOR THE FROM AND TO DATA SETS         * 08200000
* ACCORDING TO THE DATA SET ORGANIZATION INDICATED IN REGISTER 0      * 08220000
*    THE ROUTINE USES THE CODE IN REGISTER 0 TO SEARCH A TABLE        * 08240000
* FOR THE APPROPRIATE DCB FORMAT.                                     * 08260000
*    IF THE ORGANIZATION REQUESTED IS INVALID, THE REQUEST IS         * 08280000
* TERMINATED.  IF THE SOURCE DATA SET IS NOT A PHYSICAL SEQUENTIAL,   * 08300000
* PARTITIONED, OR DIRECT ACCESS(BDAM) DATA SET, IT CANNOT BE PROCESSED* 08320000
* BY THE UTILITY PROGRAM.                                             * 08340000
*                                                                     * 08360000
*                                                                     * 08380000
* INPUT:            REG 0 CONTAINS DSORG CODE                         * 08400000
*                   REG1 INDICATES WHETHER DCB IS FOR                 * 08420000
*                          INPUT OR OUTPUT.                           * 08440000
*                                                                     * 08460000
*                           0 = INPUT                                 * 08480000
*                           1 = OUTPUT                                * 08500000
*                                                                     * 08520000
*                                                                     * 08540000
* OUTPUT:           REG7  CONTAINS POINTER TO DCB                     * 08560000
*                                                                     * 08580000
*                                                                     * 08600000
*    DCBS ARE BUILT IN THE PERMANENT WORK AREA AND EACH TIME          * 08620000
* A DCB IS BUILT, THE POINTER TO THE BEGINNING OF THE                 * 08640000
* PERMANENT WORK AREA IS DISPLACED BY THE LENGTH OF THE DCB           * 08660000
*                                                                     * 08680000
*                                                                     * 08700000
* ERRORS       INVALID DSORG.  REQUEST IS TERMINATED.                 * 08720000
*                                                                     * 08740000
*                                                                     * 08760000
* ENTRY POINT: DCBBUILD                                               * 08780000
*********************************************************************** 08800000
*                                                                       08820000
*                                                                       08840000
         ENTRY DCBBUILD                                                 08860000
DCBBUILD DS    0H             ENTRY POINT TO DCB BUILDER ROUTINE        08880000
         USING DCBBUILD,R15             SET UP ADDRESSABILITY.R15       08900000
*                                       LOADED BY CALLING ROUTINE       08920000
         LA    R4,SCHTABLE              GET ADDRESS OF DSORG TABLE      08940000
*                                       AND FIND DSORG REQUESTED        08960000
BBLOOP   CH    R0,0(R4)                 IS THIS THE DSORG NEEDED?       08980000
         BE    BBFND                    YES. GO TO FILL IN DCB FIELDS   09000000
         CLI   0(R4),X'FF'              NO. IS THIS END OF TABLE?       09020000
         BE    BBEND                    YES. GO TO LOAD ERROR CODE      09040000
         LA    R4,6(R4)                 NO. INCREMENT TABLE POINTER     09060000
         B     BBLOOP                   AND RETURN TO SEARCH AGAIN.     09080000
BBEND    DS    0H            ENTRY POINT FOR ABORTING REQUEST IF        09100000
*                            DSORG IS INVALID.  FOR THE PURPOSES OF     09120000
*                            THIS PROGRAM, THE DSORG IS INVALID IF IT   09140000
*                            IS NOT PS, BDAM, OR BPAM.                  09160000
         MVI   IEHMVV61,X'09'          SET MSG CODE INVALID DSORG AND   09180000
*                                      ABORT REQUEST                    09200000
         B     ABEND                                                    09220000
*                                                                       09240000
*                                                                       09260000
BBFND    DS    0H             ENTRY POINT WHEN CORRECT DSORG HAS        09280000
*                             BEEN FOUND. DCB DISPLACEMENTS ARE         09300000
*                             COMPUTED HERE AND DCB FIELDS ARE          09320000
*                             FILLED IN.                                09340000
*                                                                       09360000
         L     R7,IEHMVV10              GET POINTER TO BEGINNING        09380000
*                                       OF PERMANENT WORK AREA          09400000
         LH    R5,4(R4)                 GET DCB LENGTH FROM DSORG       09420000
*                                       TABLE.                          09440000
         LA    R10,0(R5,R7)             ADJUST PERMANENT WORK AREA      09460000
*                                       POINTER BY DCB LENGTH.          09480000
         ST    R10,IEHMVV10                                             09500000
         EX    R5,ZERDCB                ZERO OUT DCB AREA.              09520000
         LH    R4,2(R4)                 PICKUP RELATIVE DISPLACEMENT    09540000
*                                       OF DCB ENTRY TABLE FROM         09560000
*                                       SEARCH TABLE AND                09580000
         LA    R5,TOPTAB                                                09600000
         LA    R5,0(R4,R5)              AND USE IT TO CALCULATE         09620000
*                                       POINTER TO THE DCB FIELDS       09640000
*                                       TO BE FILLED IN.                09660000
*                                                                       09680000
BBGO     DS    0H             ENTRY POINT OF LOOP WHICH FILLS IN        09700000
*                             THE DCB FROM CONTROL FIELDS IN            09720000
*                             THE DCB ENTRY TABLE.                      09740000
         CLI   0(R5),X'FF'              IS THIS THE END OF DCB          09760000
*                                       ENTRY TABLE?                    09780000
         BE    BBDONE                   YES. DCB HAS BEEN BUILT.        09800000
*                                       RETURN TO CALLING ROUTINE       09820000
         SR    R4,R4                    NO.                             09840000
         IC    R4,0(R5)                 GET RELATIVE POSITION OF DCB    09860000
*                                       FIELD TO BE FILLED              09880000
         SR    R3,R3                    GET LENGTH OF DCB FIELD         09900000
         IC    R3,1(R5)                 TO BE FILLED                    09920000
*                                                                       09940000
         LR    R10,R3                   HOLD FIELD LENGTH FOR LATER USE 09960000
         BCTR  R10,R0                   REDUCE FIELD LENGTH BY ONE      09980000
*                                       FOR CORRECT MOVE LENGTH         10000000
         LA    R6,2(R5)                 ADJUST POINTER TO THE DCB       10020000
*                                       ENTRY TABLE TO THE FIELD TO     10040000
*                                       BE MOVED.                       10060000
         LTR   R1,R1                    IS THIS DCB FOR INPUT?          10080000
         BZ    BBMOVE                   YES.                            10100000
         LA    R6,0(R3,R6)              NO. ADJUST POINTER TO OUTPUT    10120000
*                                       FLAG FIELD                      10140000
BBMOVE   DS    0H             ENTRY POINT FOR MOVE OPERATION            10160000
*                             AND LOOP MODIFICATION.                    10180000
         LA    R4,0(R4,R7)              CALCULATE POINTER TO FIELD      10200000
*                                       TO BE FILLED                    10220000
         EX    R10,BBM                  MOVE ENTRY FROM DCB ENTRY       10240000
*                                       TABLE TO THE DCB                10260000
         LA    R5,2(R5,R3)              ADJUST DCB ENTRY TABLE          10280000
         LA    R5,0(R5,R3)              POINTER TO NEXT FIELD TO        10300000
*                                       BE MOVED.                       10320000
         B     BBGO                     RETURN TO BEGINNING OF          10340000
*                                       LOOP                            10360000
BBDONE   DS    0H             EXIT LABEL                                10380000
         BR    R14                      NORMAL RETURN                   10400000
*                                                                       10420000
ZERDCB   XC    0(1,R7),0(R7)            ZERO OUT DCB AREA               10440000
BBM      MVC   0(1,R4),0(R6)            MOVE FIELD FROM DCB ENTRY       10460000
*                                       TABLE TO DCB BEING BUILT.       10480000
         DROP  R15                                                      10500000
ADMSG    DC    A(MSG)                   EXTERNAL REFERENCE.             10520000
PREAB    DC    A(PREABORT)              EXTERNAL REFERENCE              10540000
SCSV1    DS    3F                                               YL026VC 10542002
SCSV2    DS    2F                                               YL026VC 10544002
BDAM     DC    X'2000'                                                  10560000
SL       EQU   X'02'       INDICATES STANDARD LABEL              A32041 10570020
SAVRECFM DS    CL1                                                      10580000
         DS    CL1                                                      10600000
         EJECT                                                          10620000
SCHTABLE EQU   *                                                        10640000
         DC    X'4000'                  PS                              10660000
         DC    AL2(PSXXX-TOPTAB)                                        10680000
     DC   FL2'120'                                                      10700000
         DC    X'2000'                  BDAM                            10720000
         DC    AL2(BDAMXXX-TOPTAB)                                      10740000
    DC   FL2'120'                                                       10760000
         DC    X'0200'                  POS                             10780000
         DC    AL2(PDSXXX-TOPTAB)                                       10800000
    DC   FL2'120'                                                       10820000
         DC    X'0001'                  UNLOAD                          10840000
         DC    AL2(UNLDXXX-TOPTAB)                                      10860000
    DC  FL2'120'                                                        10880000
         DC    X'0000'                                                  10900000
         DC    AL2(PSXXX-TOPTAB)                                        10920000
      DC   FL2'120'                                                     10940000
         DC    X'0002'                                                  10960000
         DC    AL2(CATDCB-TOPTAB)                                       10980000
         DC    FL2'120'                                                 11000000
         DC    X'FFFF'                                                  11020000
TOPTAB   EQU   *                        TOP OF DCB ENTRY TABLE          11040000
CATDCB   EQU   *                                                        11060000
         DC    AL1(DCBDSORG-IHADCB)                                     11080000
         DC    X'02'                                                    11100000
         DC    X'4000'                                                  11120000
         DC    X'4000'                                                  11140000
         DC    AL1(DCBOFLGS-IHADCB)                                     11160000
         DC    X'01'                                                    11180000
         DC    X'02'                                                    11200000
         DC    X'02'                                                    11220000
         DC    AL1(DCBMACR-IHADCB)                                      11240000
         DC    X'02'                                                    11260000
       DC    X'2400'                                                    11280000
         DC    X'0020'                                                  11300000
         DC    AL1(DCBBLKSI-IHADCB)                                     11320000
         DC    X'02'                                                    11340000
         DC    X'0100'                                                  11360000
         DC    X'0100'                                                  11380000
         DC    AL1(DCBKEYLE-IHADCB)                                     11400000
         DC    X'01'                                                    11420000
         DC    X'08'                                                    11440000
         DC    X'08'                                                    11460000
         DC    AL1(DCBRECFM-IHADCB)                                     11480000
         DC    X'01'                                                    11500000
         DC    X'81'                                                    11520000
         DC    X'81'                                                    11540000
         DC    X'FF'                                                    11560000
PSXXX    EQU   *                        START OF PS DCB ENTRIES         11580000
         DC    AL1(DCBDSORG-IHADCB)                                     11600000
         DC    X'02'                                                    11620000
         DC    X'4000'                                                  11640000
         DC    X'4000'                                                  11660000
         DC    AL1(DCBOFLGS-IHADCB)                                     11680000
         DC    X'01'                                                    11700000
         DC    X'02'                                                    11720000
         DC    X'02'                                                    11740000
         DC    AL1(DCBMACR-IHADCB)                                      11760000
         DC    X'02'                                                    11780000
         DC    X'2000'                                                  11800000
         DC    X'0020'                                                  11820000
         DC    X'FF'                    END OF PS DCB ENTRIES           11840000
BDAMXXX  EQU   *                        START OF BDAM DCB ENTRIES       11860000
         DC    AL1(DCBDSORG-IHADCB)                                     11880000
         DC    X'02'                                                    11900000
         DC    X'2000'                                                  11920000
         DC    X'4000'                                                  11940000
         DC    AL1(DCBMACR-IHADCB)                                      11960000
         DC    X'02'                                                    11980000
         DC    X'2800'                                                  12000000
         DC    X'0028'                                                  12020000
         DC    AL1(DCBOFLGS-IHADCB)                                     12040000
         DC    X'01'                                                    12060000
         DC    X'02'                                                    12080000
         DC    X'02'                                                    12100000
         DC    AL1(DCBOPTCD-IHADCB)                                     12120000
         DC    X'01'                                                    12140000
         DC    X'10'                                                    12160000
         DC    X'00'                                                    12180000
         DC    AL1(DCBDSORG-IHADCB)                                     12200000
         DC    X'02'                                                    12220000
         DC    X'2000'                                                  12240000
         DC    X'4000'                                                  12260000
         DC    AL1(DCBMACR-IHADCB)                                      12280000
         DC    X'02'                                                    12300000
         DC    X'2800'                                                  12320000
         DC    X'0028'                                                  12340000
         DC    AL1(DCBOFLGS-IHADCB)                                     12360000
         DC    X'01'                                                    12380000
         DC    X'02'                                                    12400000
         DC    X'02'                                                    12420000
         DC    AL1(DCBOPTCD-IHADCB)                                     12440000
         DC    X'01'                                                    12460000
         DC    X'10'                                                    12480000
         DC    X'00'                                                    12500000
         DC    X'FF'                    END OF BDAM DCB ENTRIES         12520000
UNLDXXX  EQU   *                        START OF UNLOAD DCB ENTRIES     12540000
         DC    AL1(DCBDSORG-IHADCB)                                     12560000
         DC    X'02'                                                    12580000
         DC    X'4000'                                                  12600000
         DC    X'4000'                                                  12620000
         DC    AL1(DCBBUFNO-IHADCB)                                     12640000
         DC    X'04'                                                    12660000
         DC    X'00000001'                                              12680000
         DC    X'00000001'                                              12700000
         DC    AL1(DCBBUFL-IHADCB)                                      12720000
         DC    X'02'                                                    12740000
         DC    X'0000'                                                  12760000
         DC    X'0320'                                                  12780000
         DC    AL1(DCBBFTEK-IHADCB)                                     12800000
         DC    X'01'                                                    12820000
         DC    X'00'                                                    12840000
         DC    X'40'                                                    12860000
         DC    AL1(DCBBLKSI-IHADCB)                                     12880000
         DC    X'02'                                                    12900000
         DC    X'0000'                                                  12920000
         DC    X'0320'                                                  12940000
         DC    AL1(DCBLRECL-IHADCB)                                     12960000
         DC    X'02'                                                    12980000
         DC    X'0000'                                                  13000000
         DC    X'0050'                                                  13020000
         DC    AL1(DCBRECFM-IHADCB)                                     13040000
         DC    X'01'                                                    13060000
         DC    X'C0'                                                    13080000
     DC   X'90'                                                         13100000
         DC    AL1(DCBMACR-IHADCB)                                      13120000
         DC    X'02'                                                    13140000
         DC    X'2000'                                                  13160000
         DC    X'4848'                                                  13180000
         DC    AL1(DCBOFLGS-IHADCB)                                     13200000
         DC    X'01'                                                    13220000
         DC    X'02'                                                    13240000
         DC    X'02'                                                    13260000
         DC    X'FF'                    END OF UNLOAD DCB ENTRIES       13280000
PDSXXX   EQU   *                                                        13300000
         DC    AL1(DCBDSORG-IHADCB)          DSORG FIELD                13320000
         DC    X'02'                         LENGTH                     13340000
         DC    X'0200'                       PDS FROM                   13360000
         DC    X'0200'                       PDS TO                     13380000
         DC    AL1(DCBMACR-IHADCB)           MACR                       13400000
         DC    X'02'                                                    13420000
         DC    X'2400'                                                  13440000
         DC    X'0024'                                                  13460000
         DC    AL1(DCBOFLGS-IHADCB)                                     13480000
         DC    X'01'                                                    13500000
         DC    X'02'                                                    13520000
         DC    X'02'                                                    13540000
         DC    X'FF'                                                    13560000
DCBB     DC    A(DCBBUILD)                                              13580000
         DCBD  DSORG=(PS,IS,DA,PO)                                      13600000
         EJECT                                                          13620000
JFCBX    DSECT                                                          13640000
         IEFJFCBN                                                       13660000
XLIST    DS    2F                                                       13680000
*                             EXIT  LIST  SPACE  ALLOCATION             13700000
         IEHMVV                                                         13720000
         ORG   IEHMVV70                                            UL0H 13726017
         IEHDCBXL                                                  UL0H 13732017
         ORG   IEHMVV00                                                 13740000
         IECSDSL1 (1)                                                   13760000
         IKJTCB LIST=YES                                        YL026VC 13762002
         IEZJSCB                                                YL026VC 13764002
         IHAQDB                                                 YL026VC 13766002
         IHADSAB                                                YL026VC 13768002
         IEZDEB LIST=YES                                        YL026VC 13770002
         END                                                            13780000
./  ADD  SSI=63510182,NAME=IEHMVSRY
  TITLE  'IEHMVSRY-ROUTING AND ERRORS FOR IEHMOVE LOAD MODULE ESV'      00010017
*TITLE--IEHMVSRY---ROUTING AND ERRORS FOR IEHMOVE LOAD MODULE ESV       00020017
*FUNCTION/OPERATION: M                                                * 00040000
*FUNCTION/OPERATION: HANDLES CONTROL AND MESSAGES FOR LOAD MODULE     * 00060000
*IEHMVESV                                                             * 00080000
*ENTRY POINTS: IEHMVESY                                               * 00100000
*INPUT: MOVE/COPY COMMUNICATIONS TABLE                                * 00120000
*OUTPUT: MESSAGES RESULTING FROM RETURNS FROM CALLED MODULES          * 00140000
*EXTERNAL ROUTINES: IEHMVSSX                                          * 00160000
*EXITS-NORMAL XCTL TO IEHMVESY                                        * 00180000
*ERROR: NONE INITIATED IN MODULE                                      * 00580017
*TABLES/WORK AREAS: MOVE/COPY COMMUNICATIONS TABLE                    * 00980017
*ATTRUBUTES: REUSEABLE                                                * 01380017
*NOTES: PART OF LOAD MODULE IEHMVESV                                  * 01780017
*                                                                       02180017
         TITLE 'SINGLE DATA SET TRANSFER ROUTINE'                       02580017
*                                                                       02980017
*3050                                                              2695 03380017
*2163                                                              UL0H 03580017
IEHMVSSY CSECT                                                          03780017
*A662400-664800,665800-667800,671800,701800-704800             @ZA03360 03880003
*A778600-781000,855800                                         @ZA03360 03980003
*D665800,701800                                                @ZA03360 04080003
*D780800                                                       @ZM40458 04130003
*A786300                                                       @ZM40458 04140003
*A330300-333500                                                @ZA11965 04150099
*C333800                                                       @ZA11965 04170099
*                                                                       04180017
*                                                                       04580017
IEHMVESY SAVE  (14,12),T,IEHMVSRY-OZ11965                      @ZA11965 04980099
         ENTRY IEHMVESY                                                 05380017
*                                                                       05780017
*              REGISTERS                                                06180017
*                                                                       06580017
PASSA    EQU   0                                                        06980017
PASSB    EQU   1                                                        07380017
R2       EQU   2                                                        07780017
R3       EQU   3                                                        08180017
ACCE     EQU   4                                                        08580017
ACCO     EQU   5                                                        08980017
BASE     EQU   6                                                        09380017
R7       EQU   7                                                        09780017
R8       EQU   8                                                        10180017
R9       EQU   9                                                        10580017
R10      EQU   10                                                       10980017
R11      EQU   11                                                       11380017
MCTABLE  EQU   12                                                       11780017
SAVE     EQU   13                                                       12180017
RETURN   EQU   14                                                       12580017
LINK     EQU   15                                                       12980017
*                                                                       13380017
*                                                                       13780017
BASESET  BALR   BASE,0                                                  14180017
    USING  *,BASE                                                       14580017
BB       DS    0H                                                       14980017
         USING IEHMVV,MCTABLE                                           15380017
*                                  PROCESS                              15780017
*                                       CALL BUILD DCB AND GO TO DADSM  16180017
    IEHPRE  (14,1),TFC,                                                 16580017
*                                                                       16980017
         L     LINK,BUILDDCB            GET ADDRESS                     17380017
         BALR  RETURN,LINK              BRANCH                          17780017
*                                                                       18180017
*                                                                       18580017
   IEHPOST  (14,1),TFC,                                                 18980017
         TM    IEHMVV20+4,X'08'        MODEL DSCB INDICATOR ON     2695 19380017
         BC    1,GOTOVESN              YES, LINK DIRECTLY TO WRAP  2695 19780017
*                                      UP OR TO FINISH VOLUME OR   2695 20180017
*                                      DSGROUP MOVE/COPY           2695 20580017
         CLI   IEHMVV72+11,X'FF'       REQUEST FROM VSSX TO GO     UL0H 20680017
*                                      DIRECTLY TO VESN            UL0H 20780017
         BE    GOTOVESN                YES, GO AROUND XCTL TO VESY UL0H 20880017
    XCTL   (2,12),EP=IEHMVESY                                           20980017
GOTOVESN XCTL  (2,12),EP=IEHMVESN                                       21380017
***** REGISTER DESIGNATION *****                                        21780017
BUILDDCB DC    A(IEHMVESX)                                              22180017
         EXTRN IEHMVESX                                                 22580017
         DS    0D                                                       22980017
MODNAME  DC    CL6'IEHMVE'                                              23380017
EOF      EQU   X'20'                                                    23780017
         TITLE 'PRE ABORT ROUTINE'                                      24180017
PREABORT DS    0H                                                       24580017
         ENTRY PREABORT                                                 24980017
*                                                                       25380017
   BALR   BASE,0                                                        25780017
    USING   *,BASE                                                      26180017
   L   BASE,B                                                           26580017
    USING   BB,BASE                                                     26980017
         TM    IEHMVV10-4,FVOLUME  FROM VOLUME TO BE CLOSED             27380017
         BO    CLOSEF                                                   27780017
FCLOSE   TM    IEHMVV10-4,BLANK    TO VOLUME TO BE CLOSED               28180017
         BO    CLOSET                                                   28580017
TCLOSE   DS    0H                                                       28980017
*                                                                       29380017
   IEHPOST  (14,1),TFC,                                                 29780017
PREAB1   DS    0H                                                       30180017
    BALR   BASE,0                                                       30580017
     USING   *,BASE                                                     30980017
    L    BASE,B                                                         31380017
   USING   BB,BASE                                                      31780017
               BAL  RETURN,MSG     GO TO MESSAGE WRITER                 32180017
    IEHPOST  (14,1),TFC,                                                32580017
         OI    IEHMVV41+13,X'01'   RET CODE = 4                         32980017
         L     R2,IEHMVV23             ADDR OF TO VOL LIST     @ZA11965 33030099
         TM    2(R2),X'80'             TO VOL TAPE             @ZA11965 33080099
         BNO   NOTAPE                  NO, BRANCH              @ZA11965 33130099
         TM    IEHMVV20+2,X'01'        PERM ABORT ON           @ZA11965 33180099
         BNO   NOTAPE                  NO, BRANCH              @ZA11965 33230099
         MVC   IEHMVV00(6),MODNAME     MOVE IN MODULE NAME     @ZA11965 33280099
         MVI   IEHMVV00+6,C'S'         ADD S TO MODULE NAME    @ZA11965 33330099
         MVI   IEHMVV00+7,C'K'         ADD K TO MODULE NAME    @ZA11965 33340099
         OI    IEHMVV41+13,X'04'       SET RETURN CODE = 12    @ZA11965 33342099
         B     ALLDONE                 BRANCH TO IEHMVESK      @ZA11965 33350099
NOTAPE   OI    IEHMVV20+2,MIDABORT TURN ON MIDABORT            @ZA11965 33380099
         TM    IEHMVV20,VOLUME     VOLUME OPERATION?                    33780017
    BO   SINGLE                                                         34180017
         MVC   IEHMVV00(6),MODNAME MOVE IN MODULE NAME                  34580017
         MVI   IEHMVV00+6,C'S'           ADD S TO MOCULE NAME           34980017
         TM    IEHMVV20,DSGROUP                                         35380017
         BO    GODSG                                                    35780017
         TM    IEHMVV20+2,EOF                                           36180017
         BO    GOHOME                                                   36580017
         MVI   IEHMVV00+7,C'T'     ADD TO MODULE NAME                   36980017
ALLDONE  DS    0H                                                       37380017
         XCTL  (2,12),EPLOC=(12)                                        37780017
SINGLE   MVC   IEHMVV00(6),MODNAME                                      38180017
         MVI   IEHMVV00+6,C'S'     ADD S TO MODULE NAME                 38580017
         MVI   IEHMVV00+7,C'Z'     ADD Z TO MODULE NAME                 38980017
         B     ALLDONE                                                  39380017
*                                                                       39780017
GOHOME   MVI   IEHMVV00+7,C'K'                                          40180017
         B     ALLDONE                                                  40580017
GODSG    DS    0H                                                       40980017
         MVI   IEHMVV00+7,C'H'                                          41380017
         B     ALLDONE                                                  41780017
CLOSEF   DS    0H                                                       42180017
         L     ACCE,IEHMVV30       ADDR OF FROM DCB                     42580017
         MVI   UDCBITLE,X'00'          DEACTIVATE INPUT TRLR EXIT  UL0H 42780017
         CLOSE ((ACCE))                                                 42980017
         B     FCLOSE                                                   43380017
CLOSET   DS    0H                                                       43780017
         L     ACCE,IEHMVV31       ADDR OF TO DCB                       44180017
         MVI   UDCBOTLE,X'00'          DEACTIVATE OUTPUT TRLR EXIT UL0H 44380017
         CLOSE ((ACCE))                                                 44580017
         B     TCLOSE                                                   44980017
DEACTIVE EQU   X'00'                                               UL0H 45180017
VOLUME   EQU   X'02'                                                    45380017
MIDABORT EQU   X'40'                                                    45780017
BLANK    EQU   C' '                                                     46180017
FVOLUME  EQU   X'80'                                                    46580017
DSGROUP  EQU   X'10'                                                    46980017
CATALOG  EQU   X'04'                                                    47380017
DASD     EQU   X'20'                                                    47780017
         TITLE 'MESSAGE HANDLER'                                        48180017
ONES     EQU   X'FF'                                                    48580017
ODD      EQU   X'01'                                                    48980017
NOTMOV   EQU   X'80'                                                    49380017
ZERO     EQU   X'00'                                                    49780017
UNLOAD   EQU   X'01'                                                    50180017
UNLOADM  EQU   X'7F'                                                    50580017
MSG      DS    0H                                                       50980017
         STM   PASSA,LINK,200(MCTABLE)  STORE REGISTERS                 51380017
    DROP   BASE                                                         51780017
         BALR  LINK,PASSA          SET UP ADDRESSABILITY                52180017
         USING *,LINK                                                   52580017
   L   BASE,B                                                           52980017
         DROP  LINK                DROP BASE REGISTERS                  53380017
    USING   BB,BASE                                                     53780017
         LR    R7,RETURN                                                54180017
         MVI   IEHMVV00,ONES                                            54580017
         MVI   IEHMVV00+1,BLANK    BLANK OUT PRINT LINE                 54980017
         MVC   IEHMVV00+2(120),IEHMVV00+1                               55380017
         TM    IEHMVV61,ODD        DATA SET MESSAGE OR NORMAL           55780017
*                                       MESSAGE                         56180017
         BO    NORMMES                       NORMAL MESSAGE             56580017
*                                            DATA SET MESSAGE           56980017
*                                                                       57380017
         MVC   IEHMVV00+1(4),IEH4       SET UP MSG NUMBER               57780017
         LA    ACCE,127                                                 58180017
         SR    ACCO,ACCO           MAKE HIGH ORDER BIT OF               58580017
         IC    ACCO,IEHMVV61       FIRST BYTE ZERO                      58980017
         NR    ACCO,ACCE                                                59380017
         L     R3,AIEH4DD         ADDRESS OF CODE                       59780017
         LA    ACCO,0(R3,ACCO)    SET UP MESSAGE DIAGNOSTIC CODE        60180017
         MVC   IEHMVV00+5(2),0(ACCO)                                    60580017
         MVI   IEHMVV00+7,C'I'                                          60980017
         L     ACCE,MSGH                SET UP MSG HEADER               61380017
         LA    ACCO,7                                                   61780017
         BAL   R8,MSGMOVE                                               62180017
*                                                                       62580017
         L     ACCE,IEHMVV21            SET UP DSNAME                   62980017
         LA    ACCO,43                                                  63380017
         BAL   R8,MSGMOVE                                               63780017
         TM    IEHMVV61,NOTMOV    UNLOAD MSG OR NOT MOVE                64180017
         BO    MSGUNLD                       UNLOAD MSG                 64580017
         LA    ACCE,2                        NOT MOVED                  64980017
MSGAA    EQU   *                                                        65380017
         BAL   R8,MSGDMOVE              SET UP FINAL PART               65780017
         SR    ACCE,ACCE                                                66180017
         OI    SW,X'01'                SET SWITCH              @ZA03360 66240003
         SR    PASSA,PASSA             CLEAR                   @ZA03360 66300003
         LA    R3,IEHMVV00                                     @ZA03360 66360003
         LINK  EP=IEHMVESU                                     @ZA03360 66420003
         B     MSGCHECK(LINK)          CHECK RETURNS           @ZA03360 66480003
SECPRINT IC    ACCE,IEHMVV61                                   @ZA03360 66580003
         MVI   IEHMVV00+1,BLANK        BLANK OUT               @ZA03360 66680003
         MVC   IEHMVV00+2(120),IEHMVV00+1  PRINTAREA           @ZA03360 66780003
         BAL   R8,MSGDMOVE                                              66980017
         NI    SW,X'FE'                RESET SWITCH            @ZA03360 67180003
PRINTMES SR    PASSA,PASSA         TO PRINT A NORMAL MESSAGE            67380017
         LA    R3,IEHMVV00                                              67780017
         LINK  EP=IEHMVESU                                              68180017
         B     MSGCHECK(LINK)           CHECK RETURNS                   68580017
MSGCHECK B     GOODMSG                  GOOR WRITE                      68980017
         XCTL  EP=IEHMVESK              I/O ERROR                       69380017
*                                                                       69780017
GOODMSG  TM    SW,X'01'                PRINT SECOND PART       @ZA03360 70180003
*                                      OF MSG                  @ZA03360 70280003
         BO    SECPRINT                YES                     @ZA03360 70380003
         LR    RETURN,R7               NO RETURN               @ZA03360 70480003
         MVI   IEHMVV61,ZERO       MOVE ZERO INTO MSG INDICATOR         70580017
         LM    PASSA,LINK,200(MCTABLE)                                  70980017
         BR    RETURN              BRANCH BACK TO CALLING ROUTINE       71380017
MSGUNLD  DS    0H                                                       71780017
         NI    IEHMVV61,UNLOADM   TURN OFF UNLOAD MSG BIT               72180017
         LA    ACCE,0                                                   72580017
         B     MSGAA                                                    72980017
MSGDMOVE DS    0H                                                       73380017
         SLL   ACCE,1                                                   73780017
         L     R3,ADMSG          LOAD ADDRESS OF MESSAGESTART           74180017
         LH    ACCO,2(R3,ACCE)                                          74580017
         LH    ACCE,0(R3,ACCE)                                          74980017
         A     ACCE,MSGH           GET ADDRESS OF PROPER MSG            75380017
MSGMOVE  DS    0H                                                       75780017
         LA    R9,IEHMVV00+121                                          76180017
MSGLOOP  CLI   0(R9),BLANK         FIND LAST NON BLANK                  76580017
         BNE   MSGPL                         CHARACTER IN               76980017
         BCT   R9,MSGLOOP                    MSG AREA                   77380017
MSGPL    DS    0H                                                       77780017
         TM    SW,X'01'                PRINT SECOND PART       @ZA03360 77840003
*                                      OF MSG                  @ZA03360 77900003
         BNO   *+8                     NO BRANCH AROUND        @ZA03360 77960003
         LA    R9,IEHMVV00                                     @ZA03360 78020003
         EX    ACCO,MSMOVE         MOVE MESSAGE IN PRINTOUT AREA        78180017
         BR    R8                  BRANCH BACK TO FINISH MESSAGE        78580017
SW       DC    X'00'                                           @ZM40458 78630003
NORMMES  DS    0H                                                       78980017
         SR    ACCE,ACCE                                                79380017
         IC    ACCE,IEHMVV61            GET MESSAGE CODE                79780017
         LA    ACCE,1(PASSA,ACCE)                                       80180017
         SLL   ACCE,1              MULTIPLY BY TWO                      80580017
*                                                                       80980017
         L     R3,ANORMALM     LOAD ADDRESS OF NORMAL MESSAGE           81380017
         L     ACCE,0(R3,ACCE)    GET MESSAGE POINTER                   81780017
         SR    ACCO,ACCO                                                82180017
         IC    ACCO,0(ACCE,PASSA)  GET MESSAGE LENGTH                   82580017
         LA    ACCE,1(PASSA,ACCE)                                       82980017
         EX    ACCO,NORMM          MOVE MESSAGE TO PRINT AREA           83380017
         B     PRINTMES                 GO TO PRINT MESSAGE             83780017
NORMM    MVC   IEHMVV00+1(1),0(ACCE)                                    84180017
B        DC    A(BB)                                                    84580017
         ENTRY MSG                                                      84980017
IEH4     DC    CL4'IEH4'                                                85380017
MSMOVE   MVC   2(1,R9),0(ACCE)                                          85780017
MSGH     DC    A(MSGHEAD)               POINTER TO MESSAGES             86180017
ADMSG    DC    A(MSGSTART)                                              86580017
ANORMALM DC    A(NORMALM)                                               86980017
AIEH4DD  DC    A(IEH4DD)                                                87380017
         EXTRN MSGSTART                                                 87780017
         EXTRN NORMALM                                                  88180017
         EXTRN IEH4DD                                                   88580017
         EXTRN MSGHEAD                                                  88980017
         IEHMVV                                                         89380017
         ORG   IEHMVV70                                            UL0H 89580017
         IEHDCBXL                                                  UL0H 89780017
         END                                                            90180017
./  ADD  SSI=62450096,NAME=IEHMVSRZ
 TITLE 'IEHMVSRZ-ROUTING AND ERRORS FOR IEHMOVE LOAD MODULE ESX'        00010017
 TITLE 'IEHMVSRZ-ROUTING AND ERRORS FOR IEHMOVE LOAD MODULE ESX'        00020017
*TITLE -IEHMVSRZ                                                        00030017
*FUNCTION/OPERATION: HANDLES ERRORS AND MESSAGES FOR LOAD MODULE      * 00040000
*IEHMVESX                                                               00060000
*ENTRY POINTS: IEHMVESZ                                               * 00080000
*INPUT: NONE                                                          * 00100000
*OUTPUT: MESSAGES RESULTING FROM RETURNS FROM CALLED MODULES          * 00120000
*EXTERNAL ROUTINES: IEHMVSRV; IEHMVSRK                                * 00140000
*EXITS-NORMAL XCTL TO IEHMVESV                                        * 00160000
*ERRORS: NONE                                                         * 00180000
*TABLES/WORK AREAS: NONE                                              * 00200000
*ATTRIBUTES: REUSEABLE                                                * 00220000
*NOTES: PART OF LOAD MODULE IEHMVESX                                    00240000
*                                                                       00260000
         TITLE 'SINGLE DATA SET CONTROL'                                00280000
*                                                                       00300000
*                                  LOAD MODULE  IEHMVL20                00320000
*                                               SINGLE DATE SET         00340000
*                                                                       00360000
*                                                                       00380000
IEHMVSRZ CSECT                                                          00400000
*C050860-050930                                                @ZA03378 00405003
* 022400                                                         A29052 00410019
*                                                                       00420000
*3050                                                              UL0H 00430017
*                                                                       00440000
*              LOAD MODULE ENTRY POINT  IEHMVESZ                        00460000
IEHMVESZ SAVE  (14,12),T,ESZ-SEPT20-THERE-CHARLIE                       00480000
         ENTRY IEHMVESZ                                                 00500000
*                                                                       00520000
    USING  IEHMVV,MCTABLE                                               00540000
*                                                                       00560000
*              REGISTERS                                                00580000
*                                                                       00600000
PASSA    EQU   0                                                        00620000
PASSB    EQU   1                                                        00640000
R2       EQU   2                                                        00660000
R3       EQU   3                                                        00680000
ACCE     EQU   4                                                        00700000
ACCO     EQU   5                                                        00720000
BASE     EQU   6                                                        00740000
R7       EQU   7                                                        00760000
R8       EQU   8                                                        00780000
R9       EQU   9                                                        00800000
R10      EQU   10                                                       00820000
R11      EQU   11                                                       00840000
MCTABLE  EQU   12                                                       00860000
SAVE     EQU   13                                                       00880000
RETURN   EQU   14                                                       00900000
LINK     EQU   15                                                       00920000
*                                                                       00940000
*                                                                       00960000
*                                                                       00980000
         BALR  BASE,0                                                   01000000
         USING *,BASE                                                   01020000
SINGLE   EQU   *                                                        01040000
    IEHPRE  (14,1),TFC,                                                 01060000
*                                       CALL COPY-UNLOAD-LOAD-ABORT     01080000
*                                                                       01100000
         L     LINK,COPYTEST            GET ADDRESS                     01120000
         BALR  RETURN,LINK         BRANCH TO IEHMESV                    01140000
         DROP  BASE                                                     01160000
COPYRTN  EQU  *                                                         01180000
         BALR  LINK,PASSA          SET UP ADDRESSABILITY                01200000
         USING *,LINK                                                   01220000
         L     BASE,ASIN                                                01240000
         DROP  LINK                                                     01260000
         USING SINGLE,BASE                                              01280000
*                                                                       01300000
     IEHPOST  (14,1),TFC,                                               01320000
*                                                                       01340000
         TM    IEHMVV20+1,LORUNL   UNLOAD OR LOAD                       01360000
         BZ    NOLDUNLD            NO CONTINUE                          01380000
         TM    IEHMVV20+2,INEXSE   YES,INCLUDE,EXCLUDE OR SELECT        01400000
         BZ    NOLDUNLD     NO CONTINUE                                 01420000
         MVI   IEHMVV61,ERROR      YES                                  01440000
         MVI   ABSW,ONES                                                01460000
         B     PREABORT                 GO PRINT MESSAGE                01480000
ABSW     DC    X'00'                                                    01500000
         DS    0F                                                       01520000
NOLDUNLD DS    0H                                                       01540000
         L     RETURN,12(PASSA,SAVE)                                    01560000
    XCTL   (2,12),EP=IEHMVESV                                           01580000
***** CONSTANTS *****                                                   01600000
UNLREC1  DC    FL2'75'                                                  01620000
         DC    X'0E'                                                    01640000
         DC    CL32'THIS IS AN UNLOADED DATA SET PRO'                   01660000
         DC    CL8'DUCED BY'                                            01680000
         DC    X'80'                                                    01700000
         DC    CL32'THE IBM UTILITY, SYSMOVE.OMMBRLD'                   01720000
         DC    CL2'WB'                                                  01740000
COPYTEST DC    A(IEHMVESV)                                              01760000
         EXTRN IEHMVESV                                                 01780000
    ENTRY  UNLREC1                                                      01800000
         ENTRY COPYRTN                                                  01820000
BUILDREQ EQU   *                                                        01840000
LOAD     EQU   X'02'                                                    01860000
UNLOAD   EQU   X'01'                                                    01880000
EOF      EQU   X'20'                                                    01900000
VOLUME   EQU   X'02'                                                    01920000
FVOLUME  EQU   X'80'                                                    01940000
FOUR     EQU   X'04'                                                    01960000
DSGROUP  EQU   X'10'                                                    01980000
T        EQU   X'E3'                                                    02000000
K        EQU   X'D2'                                                    02020000
Z        EQU   X'E9'                                                    02040000
H        EQU   X'C8'                                                    02060000
I        EQU   X'C9'                                                    02080000
S        EQU   X'E2'                                                    02100000
ODD      EQU   X'01'                                                    02120000
NOTMOV   EQU   X'80'                                                    02140000
BLANK    EQU   X'40'                                                    02160000
ZERO     EQU   X'00'                                                    02180000
LORUNL   EQU   X'03'                                                    02200000
INEXSE   EQU   X'0E'                                                    02220000
ERROR    EQU   X'19'               CODE FOR MESSAGE IEH433I      A29052 02230019
*                                   IN CSECT IEHMVMRZ            A29052 02240019
ONES     EQU   X'FF'                                                    02260000
UNLOADM  EQU   X'7F'                                                    02280000
DEACTIVE EQU   X'00'                                               UL0H 02290017
      DS     0H                                                         02300000
         TITLE 'PRE ABORT ROUTINE'                                      02320000
PREABORT DS    0H                  ABORT ROUTINE                        02340000
         ENTRY PREABORT                                                 02360000
         BALR  LINK,PASSA                                               02380000
         USING *,LINK                                                   02400000
         L     BASE,ASIN                                                02420000
         DROP  LINK                                                     02440000
         USING SINGLE,BASE                                              02460000
         TM    IEHMVV10-4,FVOLUME  FROM VOLUME TO BE CLOSED             02480000
         BO    CLOSEF              YES,GO TO CLOSE FROM VOLUME          02500000
FCLOSE   TM    IEHMVV10-4,BLANK    TO VOLUME TO BE CLOSED               02520000
         BO    CLOSET              YES,GO TO CLOSE TO VOL               02540000
TCLOSE   DS    0H                                                       02560000
*                                                                       02580000
*                                                                       02600000
         LR    R9,RETURN                                                02620000
         BAL   RETURN,MSG               GO TO MESSAGE WRITER            02640000
         LR    RETURN,R9                                                02660000
         TM    ABSW,ONES                                                02680000
         BO    NOPOST                                                   02700000
         IEHPOST (14,1),TFC,                                            02720000
   IEHPOST  (14,1),TFC,                                                 02740000
NOPOST   CLI   IEHMVV41+13,X'04'       RETURN CODE EQUAL 8       A25631 02750019
         BZ    ABSWOFF                                           A25631 02760019
         OI    IEHMVV41+13,X'01'       SET RETURN CODE TO 4      A25631 02770019
ABSWOFF  MVI   ABSW,ZERO                                                02780019
         OI    IEHMVV20+2,BLANK    TURN ON MID-ABORT                    02800000
         TM    IEHMVV20,VOLUME     TEST FOR VOL OPERATION               02820000
         MVC   IEHMVV00(6),MODNAME MOVE IN MODULE NAME                  02840000
         MVI   IEHMVV00+6,S        ADD 'S' TO MODULE NAME               02860000
         BO    SINGO                                                    02880000
         TM    IEHMVV20,DSGROUP    DSGROUP OPERATION                    02900000
         BO    GODSG                                                    02920000
         TM    IEHMVV20+2,EOF      END OF INPUT                         02940000
         BO    GOHOME                                                   02960000
         MVI   IEHMVV00+7,T        ADD 'T' TO MODULE NAME               02980000
ALLDONE  DS    0H                  TRANSFER TO MODULE NAME              03000000
         XCTL  (2,12),EPLOC=(12)                                        03020000
*                                                                       03040000
GOHOME   MVI   IEHMVV00+7,K        ADD 'K' TO MODULE NAME               03060000
         B     ALLDONE                                                  03080000
SINGO    MVI   IEHMVV00+7,Z        ADD 'Z' TO MODULE NAME               03100000
         B     ALLDONE                                                  03120000
GODSG    DS    0H                                                       03140000
         MVI   IEHMVV00+7,H        ADD 'H' TO MODULE NAME               03160000
         B     ALLDONE                                                  03180000
CLOSEF   DS    0H                  CLOSE FROM DATASET                   03200000
         L     ACCE,IEHMVV30       ADDRESS OF FROM DCB                  03220000
         MVI   UDCBITLE,DEACTIVE       DEACTIVATE INPUT TRLR EXIT  UL0H 03230017
         CLOSE ((ACCE))                                                 03240000
         B     FCLOSE                                                   03260000
CLOSET   DS    0H                  CLOSE TO DATASET                     03280000
         L     ACCE,IEHMVV31       ADDRESS OF TO DATASET                03300000
         MVI   UDCBOTLE,DEACTIVE       DEACTIVATE OUTPUT TRLR EXIT UL0H 03310017
         CLOSE ((ACCE))                                                 03320000
         B     TCLOSE                                                   03340000
MODNAME  DC    CL6'IEHMVE'                                              03360000
         TITLE 'MESSAGE HANDLER'                                        03380000
         DROP  BASE                                                     03400000
MSG      DS    0H                                                       03420000
         STM   PASSA,LINK,200(MCTABLE)  STORE REGISTERS                 03440000
         BALR  LINK,PASSA          SET UP ADDRESSABILITY                03460000
         USING *,LINK                                                   03480000
         L     BASE,ASIN                                                03500000
         DROP  LINK                DROP BASE REGISTERS                  03520000
      USING    SINGLE,BASE                                              03540000
         LR    R7,RETURN                                                03560000
         MVI   IEHMVV00,ONES                                            03580000
         MVI   IEHMVV00+1,BLANK    BLANK OUT PRINT LINE                 03600000
         MVC   IEHMVV00+2(120),IEHMVV00+1                               03620000
         TM    IEHMVV61,ODD        DATA SET MESSAGE OR NORMAL           03640000
*                                          MESSAGE                      03660000
         BO    NORMMES                      NORMAL MESSAGE              03680000
*                                           DATA SET MESSAGE            03700000
*                                                                       03720000
         MVC   IEHMVV00+1(4),IEH4       SET UP MSG NUMBER               03740000
         LA    ACCE,127                 GET IEH4                        03760000
         SR    ACCO,ACCO           MAKE HIGH ORDER BIT OF               03780000
         IC    ACCO,IEHMVV61       FIRST BYTE ZERO                      03800000
         NR    ACCO,ACCE                                                03820000
         L     R3,AIEH4DD          ADDRESS OF CODE                      03840000
         LA    ACCO,0(R3,ACCO)     SET UP MESSAGE DIAGNOSTIC CODE       03860000
         MVC   IEHMVV00+5(2),0(ACCO)                                    03880000
         MVI   IEHMVV00+7,I        END CODE WITH 'I'                    03900000
         L     ACCE,MSGH                SET UP MSG HEADER               03920000
         LA    ACCO,7                                                   03940000
         BAL   R8,MSGMOVE                                               03960000
*                                                                       03980000
         L     ACCE,IEHMVV21            SET UP DSNAME                   04000000
         LA    ACCO,43                                                  04020000
         BAL   R8,MSGMOVE                                               04040000
         TM    IEHMVV61,NOTMOV    UNLOAD MSG OR NOT MOVE                04060000
         BO    MSGUNLD                       UNLOAD MSG                 04080000
         LA    ACCE,2                        NOT MOVED                  04100000
MSGAA    EQU   *                                                        04120000
         BAL   R8,MSGDMOVE              SET UP FINAL PART               04140000
         SR    ACCE,ACCE                                                04160000
         IC    ACCE,IEHMVV61                 OF MSG                     04180000
         BAL   R8,MSGDMOVE                                              04200000
PRINTMES SR    PASSA,PASSA         TO PRINT A NORMAL MESSAGE            04220000
         LA    R3,IEHMVV00                                              04240000
         LINK  EP=IEHMVESU                                              04260000
*                                                                       04280000
*                                                                       04300000
         B     MSGCHECK(LINK)           CHECK RETURNS                   04320000
MSGCHECK B     GOODMSG                  GOOR WRITE                      04340000
         XCTL  EP=IEHMVESK              I/O ERROR                       04360000
*                                                                       04380000
GOODMSG  LR    RETURN,R7                                                04400000
         MVI   IEHMVV61,ZERO       MOVE ZERO INTO MSG INDICATOR         04420000
         LM    PASSA,LINK,200(MCTABLE)                                  04440000
         BR    RETURN              BRANCH BACK TO CALLING ROUTINE       04460000
MSGUNLD  DS    0H                                                       04480000
         NI    IEHMVV61,UNLOADM   TURN OFF UNLOAD MSG BIT               04500000
         LA    ACCE,0                                                   04520000
         B     MSGAA                                                    04540000
MSGDMOVE DS    0H                                                       04560000
         SLL   ACCE,1                                                   04580000
         L     R3,ADMSG            LOAD ADDRESS OF MSGSTART             04600000
         LH    ACCO,2(R3,ACCE)                                          04620000
         LH    ACCE,0(R3,ACCE)                                          04640000
         A     ACCE,MSGH           GET ADDRESS OF PROPER MSG            04660000
MSGMOVE  DS    0H                                                       04680000
         LA    R9,IEHMVV00+121                                          04700000
MSGLOOP  CLI   0(R9),BLANK         FIND LAST NON BLANK                  04720000
         BNE   MSGPL                         CHARACTER IN               04740000
         BCT   R9,MSGLOOP                    MSG AREA                   04760000
MSGPL    DS    0H                                                       04780000
         EX    ACCO,MSMOVE         MOVE MESSAGE IN PRINTOUT AREA        04800000
         BR    R8                  BRANCH BACK TO FINISH MESSAGE        04820000
NORMMES  DS    0H                                                       04840000
         SR    ACCE,ACCE                                                04860000
         IC    ACCE,IEHMVV61            GET MESSAGE NUMBER              04880000
     LA   ACCO,127                                                      04900000
    NR   ACCE,ACCO                                                      04920000
         LA    ACCE,1(PASSA,ACCE)                                       04940000
         SLL   ACCE,1              MULTIPLY BY TWO                      04960000
         L     R3,ANORMALM         LOAD ADDR OF NORMAL MESSAGE          04980000
         L     ACCE,0(R3,ACCE)     GET MESSAGE POINTER                  05000000
         SR    ACCO,ACCO                                                05020000
         IC    ACCO,0(ACCE,PASSA)  GET MESSAGE LENGTH                   05040000
         LA    ACCE,1(PASSA,ACCE)                                       05060000
         EX    ACCO,NORMM          MOVE MESSAGE TO PRINT AREA           05080000
         CLI   IEHMVV00+5,X'F1'        IS MSG IEH413I          @ZA03378 05086003
         BE    PSCHK                   YES ISSUE MSG           @ZA03378 05093003
         TM    IEHMVV61,FVOLUME    DSNAME INCLUDED IN MSG               05100000
         BZ    PRINTMES            NO GO TO PRINT MSG                   05120000
         LA    ACCO,43             SET UP TO MOVE                       05140000
         L     ACCE,IEHMVV21       DSNAME TO MSG AREA                   05160000
     BAL   R8,MSGMOVE                                                   05180000
         B     PRINTMES                 GO TO PRINT MESSAGE             05200000
PSCHK    L     ACCE,IEHMVV21           MOVE DSNAME               A25631 05202019
         LA    ACCO,43                   TO THE PRINT            A25631 05204019
         LA    R9,IEHMVV00+17               AREA                 A25631 05206019
         EX    ACCO,MSMOVE                                       A25631 05208019
         OI    IEHMVV41+13,X'04'       SET RETURN CODE = 8       A25631 05210019
         B     PRINTMES                                          A25631 05212019
NORMM    MVC   IEHMVV00+1(1),0(ACCE)                                    05220000
IEH4     DC    CL4'IEH4'                                                05240000
MSMOVE   MVC   2(1,R9),0(ACCE)                                          05260000
MSGH     DC    A(MSGHEAD)               POINTER TO MESSAGES             05280000
         ENTRY MSG                                                      05300000
ADMSG    DC    A(MSGSTART)                                              05320000
ANORMALM DC    A(NORMALM)                                               05340000
AIEH4DD  DC    A(IEH4DD)                                                05360000
         EXTRN MSGSTART                                                 05380000
         EXTRN NORMALM                                                  05400000
         EXTRN IEH4DD                                                   05420000
         EXTRN MSGHEAD                                                  05440000
ASIN     DC    A(SINGLE)                                                05460000
         IEHMVV                                                         05480000
         ORG   IEHMVV00                                                 05500000
         ORG   IEHMVV70                                            UL0H 05506017
         IEHDCBXL                                                  UL0H 05512017
         END                                                            05520000
./  ADD  SSI=72760043,NAME=IEHMVSSF
 TITLE 'IEHMVSSF-IEHMOVE,IEHLIST,IEHPROGM VOLUME MOUNTER'          1415 00020014
*********************************************************************** 00028019
*                                                                     * 00036019
*                                                                     * 00044019
*FUNCTION/OPERATION: THE FUNCTION OF IEHMVSSF IS TO HANDLE VOLUME     * 00052019
*MOUNTING OPERATIONS. IT DECIDES WHICH DEVICE(S) THE VOLUME MAY BE    * 00060000
*MOUNTED ON AND FOR DIRECT ACCESS DEVICES CAUSES (BY USE OF OPEN TYPE * 00080000
*=J) THE ACTUAL MOUNTING OF THE VOLUME.                               * 00090019
*                                                                     * 00100019
*ENTRY POINTS: IEHMVESF                                               * 00120000
*                                                                     * 00130019
*INPUT: VOLUME ID; VOLUME DEVICE TYPE                                 * 00140000
*                                                                     * 00150019
*OUTPUT: POINTER TO DD NAME ON WHICH VOLUME IS OR CAN BE MOUNTED      * 00160019
*                                                                     * 00170019
*EXTERNAL ROUTINES: NONE                                              * 00180000
*                                                                     * 00190019
*EXITS: NORMAL - RETURN TO CALLING ROUTINE                            * 00200019
*                                                                     * 00210019
*EXITS: ERROR - RETURN TO CALLING ROUTINE WITH NOMOUNT BIT ON IN      * 00217019
*                ITHEADER                                             * 00224019
*                                                                     * 00231019
*TABLES/WORK AREAS:  INTERNAL TABLE CONTAINING POINTERS TO DD NAMES   * 00240019
*     IN TIOT,MASK OF AVAILABLE DEVICES, AND ADDRESS OF DEVICE    I276* 00249019
*     MASK TABLE                                                  I276* 00258019
*                                                                     * 00267019
*ATTRIBUTES: REUSEABLE                                                * 00280000
*                                                                     * 00290019
*NOTES: USED IN PROGRAMS IEHLIST,IEHPROGM, IEHMOVE                    * 00300000
*                                                                       00320000
*                                                                       00340000
*                                                                       00360000
*                                                                       00380000
*                                                                       00400000
*                                                                       00420000
*                                                                       00440000
*                                                                       00460000
*                                                                       00480000
*                                                                       00500000
*                                                                       00520000
*                                                                       00560000
*              PURPOSE   THE VOLUME MOUNTING ROUTINE CAUSES VOLUMES     00580000
*                        TO BE MOUNTED ON DEVICES ALLOCATED TO THE      00600000
*                        CALLING PROGRAM.  FOR DIRECT ACCESS MOUNTABLE  00620000
*                        DEVICES THE ACTUAL MOUNTING IS ACCOMPLISHED.   00640000
*                        FOR OTHER DEVICE TYPES THE ROUTINE RETURNS A   00660000
*                        POINTER TO A DDNAME WHICH PROVIDES THE         00680000
*                        ALLOCATION FOR A DEVICE ON WHICH THE VOLUME    00700000
*                        CAN BE MOUNTED.  THE CALLING PROGRAM CAN THEN  00720000
*                        EFFECT THE ACTUAL MOUNTING.                    00740000
*                                                                       00760000
*                                                                       00780000
*              CALLING FORMATS                                          00800000
*                                                                       00820000
*                   THE CALLING SEQUENCE                                00840000
*                                                                       00860000
*        L     R1,ADDRESS OF PARAMETER LIST                             00880000
*        L     R13,ADDRESS OF SAVE AREA                                 00900000
*        L     R15,ADDRESS OF VOLUME MOUNTING ROUTINE                   00920000
*        BALR  R14,R15                                                  00940000
*                                                                       00960000
*                                                                       00980000
*                   PARAMETER LIST                                      01000000
*                                                                       01020000
*        THE PARAMETER LIST IS COMPOSED OF N ENTRIES:                   01030019
*              THE 12 BYTE INTERNAL TABLE HEADER                        01040019
*              AND N-1 17 BYTE VOLUME MOUNTING REQUESTS            DT0I 01050019
*                                                                       01060019
*                                                                       01100000
*              FOR DESCRIPTION OF ENTRIES SEE THE WRITTEN DOCUMENTATION 01120000
*              ON VOLUME MOUNTING ROUTINE.                              01140000
*                                                                       01144019
*                                                                       01148019
*********************************************************************** 01152019
*                                                                       01156019
IEHVOLMT CSECT                                                          01158020
*A100888,C101600,D102600-102800,104200-104800                    A45128 01158122
*A134200,134800,136000,136400,137200,152400,164400,165600,C167000A45128 01158422
*A134326,134332,136146,136152,137230                              M3250 01159200
* 025000                                                          M0313 01160020
*058400,110600-111800,113400-113800,145870-146050,146160-146196,  M0313 01162020
*147330-147380,147630-147690 MAKE AN 18 FW SAVE AREA AVAILABLE    M0313 01164020
* 144450-144460                                                  S20201 01166820
*145870-146050,146169-146196,247330-147380,147630-147690,         M0487 01166920
* 180820-180840                                                   M0487 01167020
*                                                                A31436 01167420
*                                                                A32626 01168120
* 095600,096000-096800,097400-097600,098000-098800,099600,100000     CT 01168820
*  100004,112000,112400-112800                                       CT 01169520
*  IMPROVEMENT OF COMMENTS (RELEASE 20)                              CT 01170220
* 092680,092920,114600                                           A29718 01171519
* 018800-019000,094170-094175,103400-103600                      A25651 01172019
* 113000                                                         A27790 01173019
*                                                                A27909 01174019
* 022400,082000,145600,179600                                      I276 01176019
*C144400                                                       @Z30AAAG 01178003
*A094032,111,114086900,920,087300,400,100914,944,948,          @ZM30153 01180403
*A109220,500,144384,495,160800,900,164424,428,180620           @ZM30153 01180503
*C087400,094031,144495086800,164440-660                        @ZM30153 01180803
*D087000,094126                                                @ZM30153 01180903
*  LOADING THE DEVICE MASK TABLE AND STORING ITS ADDRESS IN THE    I276 01181019
*  INTERNAL TABLE                                                  I276 01186019
* 056800-057600,058600-058800,060400-061800,069200-070000,       HEADRS 01191019
*  073600-077400,094200,108400-108800,114000,114200-114400,      HEADRS 01196019
*  117400,117800,179000                                          HEADRS 01201019
*  ADDITION OF HEADERS FOR EASE IN FOLLOWING FLOW                HEADRS 01206019
* 018600,081800,092800,093200,094160-094165,094660,094720,           CS 01207019
*  103000-103200                                                     CS 01208019
*  IMPROVEMENT OF COMMENTS                                           CS 01209019
* 144420-144480                                                  A23794 01211019
*                                                                00GM0I 01223018
*0646135200,137400                                                 7296 01227017
*0646091200                                                      PTM404 01235017
*2018                                                              UL0H 01243017
*                                                                  UL0H 01251017
*2357054200,068800,094150,094190,103800,106000,115000                   01255018
*A109210                                                       @ZA25503 01256099
*D109500                                                       @ZA25503 01257099
*                             REGISTER NOTATION AND USAGE               01260000
*                                                                       01280000
R0       EQU   0                                                        01300000
PARAMPTR EQU   1                        PARAM REG                       01320000
ACCE     EQU   2                        WORK REG                        01340000
ACCO     EQU   3                        WORK REG                        01360000
WORK     EQU   4                                                        01380000
TIOT     EQU   4                                                        01400000
INLOOP   EQU   5                        LOOP CONTROL REG                01420000
SEARCH   EQU   6                        SEARCH INDICATOR REG            01440000
IT       EQU   7                        INTERNAL TABLE REG              01460000
LOOP     EQU   8                        LOOP CONTROL REG                01480000
VMREQUST EQU   9                        BASE FOR VOLUME MOUNT REQUEST   01500000
BASE     EQU   10                       BASE FOR IEHMVSSF               01520000
WORK2    EQU   11                                                       01540000
WORK3    EQU   12                                                       01560000
R13      EQU   13                       SAVE REG                        01580000
RETURN   EQU   14                       RETURN REG                      01600000
LINK     EQU   15                       ENTRY POINT REG                 01620000
R2       EQU   2                                                        01640000
R3       EQU   3                                                        01660000
R4       EQU   4                                                        01680000
R5       EQU   5                                                        01700000
R6       EQU   6                                                        01720000
R7       EQU   7                                                        01740000
R8       EQU   8                                                        01760000
R11      EQU   11                                                       01764013
R12      EQU   12                                                       01768013
R14      EQU   14                                                       01772013
R15      EQU   15                                                       01776013
*                                                                       01780000
*                                                                       01800000
*                             EQUATE STATEMENTS                         01820000
*                                                                       01840000
OFFSET0  EQU   0                                                 HEADRS 01901019
INITTO1  EQU   1                                                 HEADRS 01902019
OFFSET1  EQU   1                                                 HEADRS 01903019
ONEBIT   EQU   1                                                 HEADRS 01904019
ONEBYTE  EQU   1                                                 HEADRS 01905019
OFFSET2  EQU   2                                                 HEADRS 01906019
TWO      EQU   2                                                 HEADRS 01907019
TWOBITS  EQU   2                                                 HEADRS 01908019
TWOBYTES EQU   2                                                 HEADRS 01909019
OFFSET3  EQU   3                                                     CS 01909519
INITTO4  EQU   4                                                 HEADRS 01910019
OFFSET4  EQU   4                                                 HEADRS 01911019
VALUE4   EQU   4                                                 A23794 01912019
FIVEBITS EQU   5                                                 HEADRS 01913019
OFFSET6  EQU   6                                                 HEADRS 01913319
OFFSET7  EQU   7                                                     CS 01913619
OFFSET8  EQU   8                                                 HEADRS 01914019
OFFSET31 EQU   31                                                HEADRS 01915019
OFFSET32 EQU   32                                                HEADRS 01916019
WORDSIZE EQU   32             32 BITS IN A REGISTER              HEADRS 01917019
ADD256   EQU   256                                                      01917519
HEXFF    EQU   X'FF'          TEST FOR END OF UCB LUT            HEADRS 01918019
UCBVSN   EQU   28             OFFSET TO VOLUME SERIAL NUMBER IN UCB     01920000
UCBDEVT  EQU   18             OFFSET TO DEVICE TYPE IN UCB              01940000
UCBUNIT  EQU   13          OFFSET TO UNIT NAME IN UCB              DT0I 01950018
REMOVABL EQU   X'24'          USED TO TEST UCB FOR REMOVABLE VOLUME: CS 01952019
*                              NEITHER RESERVED NOR PERMANENTLY      CS 01954019
*                              RESIDENT                              CS 01956019
TRKOFLOW EQU   X'40'          USED TO TEST DEVICE TYPE FOR       A31436 01956820
*                              TRACK-OVERFLOW OPTION             A31436 01957620
DASD     EQU   X'20'          USED TO TEST DEVICE TYPE FOR       A31436 01958420
*                              DIRECT-ACCESS DEVICE CLASS        A31436 01959220
COMTAB   EQU   16             POINTER TO COMMUNICATIONS TABLE           01960000
CMTTCB2  EQU   0              TCB POINTER IN COMMUNICATIONS TABLE       01980000
TCBTIOT  EQU   12             OFFSET IN TCB FOR POINTER TO TIOT         02000000
TIOTFOUN EQU   24             FOUNDATION LENGTH OF TIOT                 02020000
TIOTLEN  EQU   0              OFFSET TO TIOT LENGTH FIELD               02040000
TIOTDDNA EQU   4              OFFSET TO DDNAME FIELD IN TIOT            02060000
TIOTUCB  EQU   14             OFFSET FROM DDNAME IN TIOT TO UCB POINTER 02080000
TIOTENTR EQU   20             OFFSET TO ENTRY BLOCK LENGTH IN TIOT      02100000
IUCB     EQU   40             OFFSET FROM CVT FOR POINTER TO UCB TABLE  02120000
ONEVOL   EQU   X'01'          USE TO INDICATE JFCB IS FOR ONE VOLUME CT 02123020
MOUNTREQ EQU   17                      SIZE OF VOL MOUNT REQUEST   DT0I 02126018
SLASH    EQU   X'61'                                               DT0I 02132018
*                                                                       02140000
*                                                                       02160000
*                             ENTRY AND EXTRN STATEMENTS                02180000
*                                                                       02200000
         ENTRY IEHMVESF                                                 02220000
*                                                                       02260000
*                                                                       02280000
*                             ASSEMBLER USING STATEMENTS                02300000
*                                                                       02320000
         USING IEHMVESF,BASE            ADDRESSABILITY FOR THIS PROGRAM 02340000
         USING ITHEADER,PARAMPTR        ADDRESSABILITY FOR THE INTERNAL 02360000
*                                      TABLE                            02380000
         USING REQUEST,VMREQUST         ADDRESSABILITY FOR VOLUME       02400000
*                                       MOUNTING REQUEST TABLE          02420000
*                                                                       02440000
*********************************************************************** 02442019
*********************************************************************** 02444019
**                                                                   ** 02446019
**                    ENTRY POINT INTO IEHVOLMT                      ** 02448019
**                           (IEHMVESF)                              ** 02450019
**                                                                   ** 02452019
*********************************************************************** 02454019
*********************************************************************** 02456019
*                                                                       02458019
IEHMVESF SAVE  (14,12),T,ESF                                            02460000
         LR    BASE,LINK               SET UP BASE REGISTER       M0313 02463020
         LA    R2,SAVE18F              ADDRESS OF NEW SAVE AREA   M0313 02466020
         ST    R2,8(R13)               ADDRESS OF NEW SAVE AREA   M0313 02469020
         ST    R13,4(R2)               ADDRESS OF CURRENT SAVE AREM0313 02472020
         LR    R13,R2                  CURRENT=NEW                M0313 02475020
*                                                                       02480000
*                                                                       02520000
*                             DSECTS FOR THE INTERNAL TABLE AND FOR     02540000
*                             THE VOLUME MOUNTING REQUEST TABLE FOLLOW  02560000
*                                                                       02580000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  02586019
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  02592019
*                                                                       02600000
*                   DESCRIPTION INTERNAL TABLE HEADER                   02620000
ITHEADER DSECT                                                          02640000
GENERICC DS    CL1                      GENERIC NAME COUNT              02660000
GENERICP EQU   GENERICC                 POINTER TO GENERIC DDNAMES      02680000
         DS    CL3                                                      02700000
INDICATO DS    CL1                      INDICATOR BYTE                  02720000
MOUNT    EQU   X'80'                         BIT O     MOUNT INDICATION 02740000
SELECT   EQU   X'40'                         BIT 1     SELECTIVE        02760000
*                                                           DISMOUNT    02780000
OLDVALID EQU   X'20'                         BIT 2     IGNORE OLD       02800000
*                                                           REQUESTS    02820000
TABLE    EQU   X'10'                         BIT 3     INTERNAL TABLE   02840000
*                                                                       02860000
YESMOUNT EQU   X'01'                         BIT 7     MOUNTED A VOLUME 02880000
NOMOUNT  EQU   X'02'                         BIT 6     COULD NOT MOUNT  02900000
*                                                           A VOLUME    02920000
PTRINTAB EQU   INDICATO                 POINTER TO INTERNAL TABLE       02940000
         DS    CL3                                                      02960000
LENINTAB DS    CL2                      LENGTH OF INTERNAL TABLE        02980000
*                                                                       03000000
CNTINTAB DS    CL1                      COUNT OF INTERNAL TABLE ENTRIES 03020000
*                                                                       03040000
CNTVMR   DS    CL1                      COUNT OF VOLUME MOUNTING        03060000
*                                            REQUESTS                   03080000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  03100000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  03120000
*                                                                       03120819
*                                                                       03121619
*                                                                       03122419
*                      DIAGRAM OF INTERNAL TABLE                        03123219
*                                                                       03124019
*                                                                       03124819
*        *--------- 2 BYTES -------* *-------- 2 BYTES --------*        03125619
*                                                                       03126419
*                                                                       03127219
*        *******************************************************        03128019
*        *          LENGTH          *         OFFSET TO        *        03128820
*        *        (IN BYTES)        *    DEVICE MASK SIZES     *        03129619
*        *******************************************************        03130419
*        *     USAGE   *              POINTER TO               *        03131219
*        *     CODE    *           DD ENTRY IN TIOT            *        03132019
*                                                                       03132819
*        *                          *                          *        03133619
*                                                                       03134419
*        *                          *                          *        03135219
*                                                                       03136019
*        *                          *                          *        03136819
*                                                                       03137619
*        *******************************************************        03138419
*        *    SIZE OF DEVICE MASK   *    SIZE OF DEVICE MASK   *        03139219
*        *  (WITHOUT 2321 SECTION)  *                          *        03140019
*        *******************************************************        03140819
*        *                     DEVICE MASK                     *        03141619
*        *     (BITS ARE ON FOR VOLUMES MATCHING DD CARDS)     *        03142419
*                                                                       03143219
*        *                          *                          *        03144019
*                                                                       03144819
*        *                          *                          *        03145619
*                                                                       03146419
*        *                          *                          *        03147219
*                                                                       03148019
*        *******************************************************        03148819
*        *      ADDRESS OF SCHEDULER'S DEVICE MASK TABLE       *   I276 03149619
*        *          (IEHVOLMT DOES A LOAD OF THE DMT)          *   I276 03150419
*        *******************************************************   I276 03151219
*                                                                       03152019
*                                                                       03152819
*                                                                       03153619
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  03154419
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  03155219
*                                                                       03156019
*                   DESCRIPTION OF A VOLUME MOUNTING REQUEST            03160000
*                                                                       03180000
REQUEST  DSECT                                                          03200000
*                                                                       03220000
DEVICE   DS    CL4                      DEVICE TYPE                     03240000
VSN      DS    CL6                      VOLUME SERIAL NUMBER            03260000
RTA      DS    CL2                      RELATIVE TABLE ADDRESS          03280000
UNIT     DS    CL5                                                 DT0I 03290018
DISMOUNT EQU   X'80'                    BIT O INDICATES A SELECTIVE     03300000
*                                            DISMOUNT ENTRY             03320000
USAGE    EQU   X'80'                    USAGE BIT IN INTERNAL TABLE     03340000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  03360000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  03370019
*                                                                       03380000
*                                                                       03400000
IEHVOLMT CSECT                                                          03420000
*                                                                       03440000
*********************************************************************** 03442019
*                                                                     * 03444019
*               TEST WHETHER INTERNAL TABLE IS BUILT                  * 03446019
*                                                                     * 03448019
*********************************************************************** 03450019
*                                                                       03452019
*                                  DECISION                             03460000
         TM    INDICATO,TABLE           DOES INTERNAL TABLE ALREADY     03480000
*                                            EXIST?                     03500000
         BZ    CREATEIT                                                 03520000
*                                            WHICH CALLS IEHITGEN TO    03540000
*                                            CREATE INTERNAL TABLE      03560000
*                                                                       03580000
*                                       IF YES, PROCEED TO TEST FOR     03600000
*                                            ANY MOUNT REQUESTS         03620000
*                                                                       03640000
*********************************************************************** 03642019
*                                                                     * 03644019
*                       TEST FOR VOLUME MOUNT                         * 03646019
*                       OR DISMOUNT REQUESTS                          * 03648019
*                                                                     * 03650019
*********************************************************************** 03652019
*                                                                       03660000
MOUNTDEC DS    0H             DECISION                                  03680000
         CLI   CNTVMR,X'00'            ARE THERE ARY VOLUME COUNTINE    03700000
*                                            REQUESTS                   03720000
         BE    RETURNA                  IF NO, BRANCH TO "RETURNA" TO   03740000
*                                            RETURN TO CALLING PROGRAM  03760000
*                                       IF YES, PROCEED TO TEST WHETHER 03780000
*                                            TO HONOR ANY PREVIOUS      03800000
*                                            MOUNTS                     03820000
*                                                                       03840000
*                                                                       03860000
*********************************************************************** 03862019
*                                                                     * 03864019
*               TEST WHETHER TO HONOR PREVIOUS MOUNTS                 * 03866019
*                                                                     * 03868019
*********************************************************************** 03870019
*                                                                       03872019
*                                  DECISION                             03880000
         TM    INDICATO,OLDVALID        ARE ANY OF THE OLD MOUNTS VALID 03900000
*                                                                       03920000
         BZ    NOTVALID                 IF NO, BRANCH TO "NOTVALID" TO  03940000
*                                            ZERO OUT THE USAGE BITS    03960000
*                                            IN THE INTERNAL TABLE      03980000
*                                       IF YES, PROCEED TO TEST FOR     04000000
*                                           SELECTIVE DISMOUNTING       04020000
*                                                                       04040000
*                                                                       04060000
*********************************************************************** 04062019
*                                                                     * 04064019
*              TEST FOR SELECTIVE DISMOUNT REQUESTS                   * 04066019
*                                                                     * 04068019
*********************************************************************** 04070019
*                                                                       04072019
*                                  DECISION                             04080000
         TM    INDICATO,SELECT          ARE THERE ANY SELECTIVE         04100000
*                                            DISMOUNTS?                 04120000
*                                                                       04140000
         BZ    VALHOPE                                                  04160000
*                                            MOUNT REQUESTS             04180000
*                                       IF YES, PROCEED TO HANDLE       04200000
*                                            SELECTIVE DISMOUNTS        04220000
*                                                                       04240000
*                                                                       04260000
*                                       SELECTIVE DISMOUNTING           04280000
*                                                                       04300000
*                                  INITIALIZE LOOP                      04320000
         LA    VMREQUST,12(0,PARAMPTR)  ESTABLISH POINTER TO FIRST      04340000
*                                            VOLUME MOUNTING REQUEST    04360000
         SR    LOOP,LOOP                INITIALIZE LOOP CONTROL         04380000
         IC    LOOP,CNTVMR                   REGISTER TO THE NUMBER     04400000
*                                            OF VOLUME MOUNTING         04420000
*                                            REQUESTS                   04440000
         L     IT,PTRINTAB              INITIALIZE POINTER TO INTERNAL  04460000
*                                            TABLE                      04480000
*                                                                       04500000
*                                                                       04520000
*                                  START LOOP                           04540000
DISMTLP  DS    0H                       LOOP CONTROLLED BY NUMBER OF    04560000
*                                            VOLUME MOUNTING REQUESTS   04580000
*                                                                       04600000
*                                                                       04620000
*                                  DECISION                             04640000
         TM    RTA,DISMOUNT             IS THIS VOLUME TO BE DISMOUNTED 04660000
*                                                                       04680000
         BZ    NODISMT                  IF NO, BRANCH TO "NODISMT" TO   04700000
*                                            INCREMENT LOOP CONDITION   04720000
*                                            AND TEST                   04740000
*                                       IF YES, PROCEED TO DISMOUNT     04760000
*                                            VOLUME                     04780000
*                                                                       04800000
*                                                                       04820000
*                                  PROCESS                              04840000
         NI    RTA,X'7F'                DROP HIGH ORDER BIT OF RELATIVE 04860000
         LH    ACCE,RTA                      TABLE ADDRESS AND PLACE    04880000
*                                            IN WORK REGISTER           04900000
*                                                                       04920000
*                                                                       04940000
*                                  DECISION                             04960000
         LTR   ACCE,ACCE                IS RELATIVE TABLE ADDRESS ZERO  04980000
         BZ    SETRTA                   IF YES, BRANCH TO "SETRTA" TO   05000000
*                                            PROCEED WITH LOOP          05020000
*                                       IF NO, PROCEED TO ZERO USAG     05040000
*                                            BIT IN THE INTERNAL TABLE  05060000
*                                                                       05080000
*                                                                       05100000
*                                  PROCESS                              05120000
         LA    ACCO,0(ACCE,IT)          ZERO USAGE BIT IN INTERNAL      05140000
        NI    0(ACCO),X'7F'                 TABLE                       05160000
*                                                                       05180000
*                                                                       05200000
*                                  PROCESS                              05220000
SETRTA   DS    0H                       ZERO RELATIVE TABLE ADDRESS     05240000
*                                            AND SET HIGH ORDER BIT ON  05260000
         SR    ACCE,ACCE                                                05280000
         STH   ACCE,RTA                                                 05300000
         OI    RTA,DISMOUNT                                             05320000
*                                                                       05340000
*                                                                       05360000
*                                  PROCESS                              05380000
NODISMT  DS    0H                       INCREMENT TO NEXT VOLUME ENTRY  05400000
         LA    VMREQUST,MOUNTREQ(VMREQUST)                         DT0I 05420018
*                                                                       05440000
*                                                                       05460000
*                                  LOOP CONTROL                         05480000
         BCT   LOOP,DISMTLP             HAS LAST VOLUME REQUEST BEEN    05500000
*                                            INSPECTED FOR DISMOUNTING  05520000
*                                       IF NO, BRANCH TO START OF       05540000
*                                            LOOP, "DISMTLP"            05560000
*                                                                       05562019
*********************************************************************** 05564019
*                                                                     * 05566019
*           WHEN FINISH DISMOUNTS BRANCH TO DO ANY MOUNTS             * 05568019
*                                                                     * 05570019
*********************************************************************** 05572019
*                                                                       05574019
         B     MTREQUST                 IF YES, BRANCH TO "MTREQUST" TO 05580000
*                                            MOUNT ANY REQUESTS         05600000
*                                                                       05620000
*                                                                       05640000
*                                                                       05660000
CREATEIT DS    0H                  ************************************ 05670019
*                                  *                                  * 05680019
*                                  *   THIS BRANCH POINT IS ENTERED   * 05690019
*                                  *      WHEN THE INTERNAL TABLE     * 05700019
*                                  *          IS TO BE BUILT          * 05710019
*                                  *                                  * 05720019
*                                  ************************************ 05730019
*                                                                       05780000
*                                                                       05800000
         BAL   RETURN,ENTERHER                                          05820000
         L     RETURN,4(R13)           BASE ADDRESS IS OVERLAID   M0313 05828020
         L     BASE,16(RETURN)         RESTORE IT WITH EP ADDRESS M0313 05836020
*                                                                       05845019
*                                                                       05850019
RETURNTG DS    0H                  ************************************ 05855019
*                                  *                                  * 05860019
*                                  *       RETURN FROM BUILDING       * 05865019
*                                  *          INTERNAL TABLE          * 05870019
*                                  *                                  * 05875019
*                                  ************************************ 05880019
*                                                                       05885019
*                                                                       05890019
         B     ERRETURN(LINK)           WAS AN ERROR CONDITION RETURNED 05900000
ERRETURN B     MOUNTDEC                 IF NO, CONTINUE WITH ROUTINE    05920000
ERROR    DS    0H                       IF YES,EXIT WITH ERROR CODE     05940000
         L     R13,4(R13)              CURRENT SA= OLD SA         M0313 05950020
         RETURN (14,12),T,RC=4                                          05960000
*                                                                       05980000
*                                                                       06000000
*                                                                       06020000
*********************************************************************** 06040019
*                                                                     * 06060019
*                    ENTRY POINT TO MOUNT VOLUMES                     * 06080019
*                   IF OLD MOUNTS ARE TO BE IGNORED                   * 06100019
*                                                                     * 06120019
*********************************************************************** 06140019
*                                                                       06160019
NOTVALID DS    0H                                                HEADRS 06180019
*                                  INITIALIZE LOOP                      06200000
         L     IT,PTRINTAB              INITIALIZE POINTER TO INTERNAL  06220000
*                                            TABLE                      06240000
         SR    LOOP,LOOP                                                06260000
         IC    LOOP,CNTINTAB            INITIALIZE LOOP CONTROL TO      06280000
         LTR   LOOP,LOOP     ANY DD CARDS                          8377 06286013
         BZ    VALHOPE       NO DD CARDS                           8377 06292013
*                                            NUMBER OF ENTRIES IN       06300000
*                                            INTERNAL TABLE             06320000
*                                                                       06340000
*                                                                       06360000
*                                  START LOOP                           06380000
NOUSELP  DS    0H                       LOOP CONTROLLED BY NUMBER OF    06400000
*                                            ENTRIES IN INTERNAL TABLE  06420000
*                                                                       06440000
*                                                                       06460000
*                                  PROCESS                              06480000
         NI    4(IT),X'7F'              CLEAR USAGE BIT FROM TABLE      06500000
*                                            ENTRY                      06520000
*                                                                       06540000
*                                                                       06560000
*                                  PROCESS                              06580000
         LA    IT,4(IT)                 INCREMENT TO NEXT TABLE         06600000
*                                            ENTRY                      06620000
*                                                                       06640000
*                                                                       06660000
*                                  LOOP CONTROL                         06680000
         BCT   LOOP,NOUSELP             HAS LAST TABLE ENTRY USAGE BIT  06700000
*                                            BEEN CLEARED               06720000
*                                       IF NO, BRANCH TO START OF       06740000
VALHOPE  LA    VMREQUST,12(0,PARAMPTR)                                  06760000
         SR    LOOP,LOOP                                                06780000
         IC    LOOP,CNTVMR                                              06800000
         SR    ACCO,ACCO                                                06820000
VOMLP    DS    0H                                                       06840000
         STH   ACCO,RTA                                                 06860000
         LA    VMREQUST,MOUNTREQ(0,VMREQUST)                       DT0I 06880018
         BCT   LOOP,VOMLP                                               06900000
*                                                                       06910019
*                                                                       06920019
*********************************************************************** 06930019
*                                                                     * 06940019
*                    PROCESS VOLUME MOUNT REQUESTS                    * 06950019
*                                                                     * 06960019
*********************************************************************** 06970019
*                                                                       06980019
MTREQUST DS    0H                                                HEADRS 06990019
*                                  INITIALIZE INNER LOOP "B"            07020000
         LA    VMREQUST,12(PARAMPTR)    ESTABLISH POINTER TO FIRST      07040000
*                                            VOLUME MOUNTING REQUEST    07060000
         SR    LOOP,LOOP                INITIALIZE LOOP CONTROL TO      07080000
         IC    LOOP,CNTVMR                   COUNT OF VOLUME MOUNTING   07100000
*                                            REQUESTS                   07120000
LOOPB    DS    0H                       START INNER LOOP B              07140000
         LA    SEARCH,0                 LOAD SERIAL SEARCH INDICATOR    07160000
*                                  DECISION                             07180000
         OC    RTA(2),RTA              IS RELATIVE TABLE ADDRESS ZERO   07200000
         BC    4,STEPVSN                IF NO, BRANCH TO "SETEPUSN" AND 07220000
*                                            OMIT INNER LOOP "C" FOR    07240000
*                                            THIS VOLUME MOUNTING       07260000
*                                            REQUEST                    07280000
*                                       IF YES, PROCEED TO SET UP INNER 07300000
*                                            LOOP "C"                   07320000
         LR    RETURN,LOOP                                              07340000
*                                                                       07760000
*                                                                       07780000
*                                                                       07800000
*                                  REGISTERS IN SEARCH FOR DEVICE       07820000
*                                       HAVE FOLLOWING MEANING          07840000
*                                                                       07860000
*                                       ACCE -    OUR MASK-1 WORD       07880000
*                                       IT   -    PTRINTAB, MASK LENGTH 07900000
*                                       WORK -    PTR TO OUR MASK       07920000
*                                       WORK2-    ENTRY LENGTH AND 32   07940000
*                                       INLOOP    PTR DEVICE MASK TABLE 07960000
*                                       LOOP -    NUMBER OF DMT ENTRIES 07980000
*                                                 RELATIVE TABLE ADDR.  08000000
*                                       LINK -    4  DEC. REG           08020000
*                                       ACCO -    DMT MASK- 1 WORD      08040000
*                                                 AND MASK              08060000
*                                                                       08080000
DEV      DS    0H                                                       08100000
         L     IT,PTRINTAB              GET POINTER INTERNAL TABLE      08120000
         LH    INLOOP,0(IT)             GET SIZE OF INTERNAL TABLE I276 08123019
         S     INLOOP,FOUR              SUBTRACT FOUR              I276 08126019
         L     INLOOP,0(INLOOP,IT)      GET ADDRESS OF DMT         I276 08129019
*                                        (STORED AS LAST FULLWORD  I276 08132019
*                                         IN THE INTERNAL TABLE)   I276 08135019
         LH    WORK2,2(IT)              GET MASK DISPLACEMENT           08140000
         LA    WORK,4(WORK2,IT)         POINTER TO MASK                 08160000
         LH    IT,OFFSET2(WORK2,IT)     SIZE OF MASK                 CS 08180019
*                                        (IN INTERNAL TABLE)         CS 08200019
         LA    WORK2,8(IT)              DMT ENTRY LENGTH                08220000
         LH    LOOP,0(INLOOP)           GET DMT NUMBER OF ENTRIES       08240000
         LA    INLOOP,4(INLOOP)         UP DMT PTR PAST HEADER          08260000
DMTSRCH  DS    0H                                                       08280000
*                                                                       08282019
*                                                                       08284019
*                   SEARCH THE DEVICE MASK TABLE                        08286019
*          FOR THE DEVICE TYPE OF THE VOLUME TO BE MOUNTED              08288019
*                                                                       08290019
*                                                                       08292019
         CLC   4(4,INLOOP),DEVICE       COMPARE DEVICE TYPES            08300000
         BE    DMTFOUND                 EQUAL                           08320000
         LA    INLOOP,0(WORK2,INLOOP)   UP DMT PTR                      08340000
         BCT   LOOP,DMTSRCH             LAST OF TABLE                   08360000
*                                       YES, NOT FOUND                  08380000
*                                                                       08383019
*                                                                       08386019
*             IF CAN'T FIND MATCH IN DMT, SEARCH THE UCBS               08389019
*                                                                       08392019
*                                                                       08395019
         STM   R4,R8,DMTAREA                                            08400000
         LA    ACCE,DMTENTRY                                            08420000
         USING DMTENTRY,ACCE                                            08440000
         L     R4,CVTPTR                                                08460000
         USING CVT,R4                                                   08480000
         L     R4,CVTILK2               POINTER TO UCB POINTER LIST     08500000
         DROP  R4                                                       08520000
         USING UCB,R5                                                   08540000
         SR    R6,R6                                                    08560000
         SR    R7,R7                                                    08580000
         XC    0(40,ACCE),0(ACCE)       CLEAR DMT ENTRY ENTRY           08600000
         MVC   DMTETYPE(4),DEVICE       MOVE IN DEVICE TYPE.            08620000
         LA    R8,DMTESRTS              POINTER TO FIRST BIT PATTERN WD 08640000
*                                       WORD IN NEW DMT ENTRY.          08660000
LOOP1    EQU   *                                               @ZM30153 08680003
         SR    R5,R5                   ZERO UCB REG            @ZM30153 08690003
         ICM   R5,3,0(R4)              GET UCB PTR             @ZM30153 08692003
         BZ    LOOP2                    YES                             08720000
         CLM   R5,3,FOXES+TWO          END OF UCB TABLE ?      @ZM30153 08730003
         BE    END                     BRCH IF YES             @ZM30153 08740003
*                                                                       08741020
**********                                                              08742020
*                                                                       08743020
*        SEARCH FOR MATCH OF DEVICE TYPES IN A UCB AND THE              08744020
*         VOLUME MOUNT REQUEST                                          08745020
*         (FOR DIRECT-ACCESS DEVICES, ONLY THE TRACK-OVERFLOW    A31436 08746020
*          BIT IS CHECKED IN THE OPTIONS BYTE)                   A31436 08747020
*                                                                       08748020
**********                                                              08749020
*                                                                       08750020
         TM    DEVICE+2,DASD            TEST DEVICE CLASS BYTE   A31436 08751020
*                                        OF THE VOLUME MOUNT     A31436 08752020
*                                        REQUEST'S DEVICE TYPE   A31436 08753020
         BO    TESTOPTS                 IF DIRECT ACCESS, BRANCH A31436 08754020
*                                        TO DO SPECIAL TESTS     A31436 08755020
         CLC   DEVICE(4),UCBTYP         IS THIS THE TYPE WE ARE LOOKING 08760000
*                                       FOR                             08780000
         BNE   LOOP2                    NO                              08800000
         B     HAVEMTCH                 HAVE FOUND DEVICE TYPE   A31436 08800620
*                                        MATCH                   A31436 08801220
TESTOPTS EQU   *                        ** DIRECT-ACCESS ONLY ** A31436 08801820
         CLC   DEVICE(1),UCBTYP         TEST FIRST BYTE OF THE   A31436 08802420
*                                        DEVICE TYPES            A31436 08803020
         BNE   LOOP2                    IF NOT EQUAL, BRANCH     A31436 08803620
         CLC   DEVICE+2(2),UCBTYP+2     TEST LAST TWO BYTES OF   A31436 08804220
*                                        THE DEVICE TYPES        A31436 08804820
         BNE   LOOP2                    IF NOT EQUAL, BRANCH     A31436 08805420
         TM    UCBTYP+1,TRKOFLOW        TEST TRACK-OVERFLOW BIT  A31436 08806020
*                                        IN UCB'S DEVICE MASK    A31436 08806620
         BO    TESTON                   IF ON, BRANCH            A31436 08807220
         TM    DEVICE+1,TRKOFLOW        TEST TRACK-OVERFLOW BIT  A31436 08807820
*                                        IN REQUEST'S MASK       A31436 08808420
*                                        (KNOW UCB'S BIT IS OFF) A31436 08809020
         BO    LOOP2                    IF ON, BRANCH (NO MATCH) A31436 08809620
         B     HAVEMTCH                 IF OFF, BRANCH (MATCH)   A31436 08810220
TESTON   EQU   *                                                 A31436 08810820
         TM    DEVICE+1,TRKOFLOW        TEST TRACK-OVERFLOW BIT  A31436 08811420
*                                        IN REQUEST'S MASK       A31436 08812020
*                                        (KNOW UCB'S BIT IS ON)  A31436 08812620
         BNO   LOOP2                    IF OFF, BRANCH (NO MATCH)A31436 08813220
HAVEMTCH EQU   *                                                 A31436 08813820
*                                                                       08814420
**********                                                              08815020
*                                                                       08815620
*        HAVE FOUND A UCB WITH THE CORRECT DEVICE TYPE. NOW TURN        08816220
*         ON THE UCB'S BIT IN THE MASK OF THE DUMMY DMT ENTRY           08816820
*                                                                       08817420
**********                                                              08818020
*                                                                       08818620
         AL    R6,ONE                   PUT A 1 IN THE BIT PATTERN      08820000
*                                        OF THE DUMMY DMT ENTRY         08830020
         LH    R0,DMTETYNO                                              08840000
         A     R0,ONE                   ADD ONE TO THE NO. OF DEVICES.  08860000
*                                        IN THE DUMMY DMT ENTRY         08870020
         STH   R0,DMTETYNO                                              08880000
LOOP2    LA    R7,1(0,R7)               COUNT OF UCB'S CHECKED MOD 32   08900000
         CH    R7,THIRTY2               IS THIS THE 32ND DEVICE CHECKED 08920000
         BE    LOOP3                    YES                             08940000
         SLL   R6,1(0)                                                  08960000
LOOP25   LA    R4,2(0,R4)               GET POINTER TO NEXT UCB         08980000
         B     LOOP1                                                    09000000
LOOP3    SR    R7,R7                                                    09020000
         ST    R6,0(0,R8)                                               09040000
         LA    R8,4(0,R8)               NEXT BIT PATTERN WORD           09060000
         SR    R6,R6                    CLEAR BIT PATTERN REG.          09080000
         B     LOOP25                                                   09100000
END      LA    R3,31    MAX NUMBER PLUS 1 OF POSITIONS TO SHIFT  PTM404 09120017
         SR    R3,R7                                                    09140000
         SLL   R6,0(R3)                                                 09160000
         ST    R6,0(0,R8)                                               09180000
         DROP  ACCE                                                     09200000
         DROP R5                                                        09210013
         LH    R4,DMTETYNO                                              09220000
         LTR   R4,R4                    ANY DEVICES FOUND               09240000
         LM    R4,R8,DMTAREA                                            09260000
         BZ    DTS                      NO MATCH FOUND IN UCB'S  A29718 09270019
*                                        - TAKE NOMOUNT EXIT     A29718 09280019
         LA    INLOOP,DMTENTRY                                          09300000
         B     DMTFOUND                 HAVE FOUND MATCH IN UCBS     CS 09305019
*                                       - GO CHECK WHETHER CAN       CS 09310019
*                                         ISSUE MOUNT ON THE DEVICE  CS 09315019
*                                                                       09325019
*                                                                       09335019
*          (SPECIAL PROCESSING IF HAVE FOUND MATCH FOR 2321)            09345019
*                                                                       09355019
*                                                                       09365019
MT2321   L     IT,PTRINTAB                                              09400513
         SR    LINK,LINK                                                09401013
         SR    R3,R3                                                    09401513
         IC    LINK,CNTINTAB                                            09402013
         LTR   LINK,LINK                TEST FOR ZERO DD CARDS   A29718 09402119
         BZ    DTS                      IF ZERO, TAKE NOMOUNT    A29718 09402219
*                                        EXIT                    A29718 09402319
**********                                                              09402420
*                                                                       09402520
*        2321 LOOP 1 - CHECK WHETHER THE VOLUME REQUESTED IS ALREADY    09402620
*                      MOUNTED IN A BIN                                 09402720
*                                                                       09402820
**********                                                              09402920
AGAIN    L     INLOOP,4(IT)             GET FIRST DD POINTER IN I.T.    09403020
         ICM   INLOOP,3,TIOTUCB(INLOOP) GET UCB PTR            @ZM30153 09403103
         N     INLOOP,FOXES            ZERO LEFT HALF OF REG   @ZM30153 09403203
         TM    2(INLOOP),X'FF'                                          09403513
         LA    LOOP,4(LOOP)             UP RTA FOR TABLE                09404013
         BC    12,NOWSUB                                                09404513
TRYAGAIN LA    IT,4(IT)                UP PTR TO NXT DDNAME PTR         09405013
         BCT   LINK,AGAIN                                               09405513
**********                                                              09405620
*                                                                       09405720
*       2321 LOOP 2 - CHECK WHETHER THE VOLUME REQUESTED CAN BE         09405820
*                      MOUNTED IN A BIN                                 09405920
*                                                                       09406020
**********                                                              09406120
         LTR   R3,R3                    TEST FOR SUBS FOUND IN LOOP 1   09406220
         BZ    DTS                      NO SUB - CANNOT MOUNT           09406513
         SR    LOOP,LOOP                                                09407013
         L     IT,PTRINTAB              MUST DO A DISMOUNT AND MOUNT    09407513
         IC    LINK,CNTINTAB            NUMBER OF INT TBL ENTRIES       09408013
         LA    LINK,1(LINK)                                             09408513
AGAIN2   LA    IT,4(IT)                 POINT TO DDNAME PTR             09409013
         BCTR  LINK,0                                                   09409513
         LTR   LINK,LINK                                                09410013
         BZ    DTS                                                      09410513
         L     INLOOP,0(IT)             PTR TO DD NAME                  09411013
         ICM   INLOOP,3,TIOTUCB(INLOOP) GET UCB ADDR           @ZM30153 09411103
         N     INLOOP,FOXES            ZERO LEFT HALF OF REG   @ZM30153 09411403
         TM    2(INLOOP),X'FF'          TEST FOR SUB UCB                09413803
         LA    LOOP,4(LOOP)             UP RTA FOR TABLE                09414503
         BC    12,ANYSUB                                                09415203
         B     AGAIN2                                                   09415903
NOWSUB   LA    R3,1(R3)                 INDIXATE SUB FOUND              09416603
         CLC   4(6,INLOOP),VSN          CHECK IF REQUIRED VOL PRESENT   09417303
         BE    CHKUNIT             GO CHECK IF SPECIFIC UNIT       DT0I 09418003
*                                  WAS SPECIFIED                   DT0I 09418703
         B     TRYAGAIN                                                 09419403
ANYSUB   DS    0H                                                       09420103
         TM    OFFSET3(INLOOP),REMOVABL IS THIS VOLUME REMOVABLE?    CS 09420803
         BM    AGAIN2                   NO. CANNOT DO MOUNT          CS 09421503
*                                        (RESERVED AND PERMANENTLY   CS 09422203
*                                         RESIDENT BITS MUST BE OFF  CS 09422903
*                                         IN UCB)                    CS 09423603
         TM    OFFSET2(INLOOP),SRTEBSVL IS THIS VOLUME SHARABLE? A27909 09424303
         BZ    AGAIN2                   YES. CANNOT MOUNT.       A27909 09425003
*                                        (SHARABLE IF BIT        A27909 09425703
*                                         IS OFF IN UCB)         A27909 09426403
         TM    INDICATO,MOUNT           MOUNT REQUESTED                 09427103
         BZ    ONUSE                                                    09427803
CKUNIT2  CLI   UNIT,X'00'          WAS SPECIFIC UNIT SPECIFIED     DT0I 09428503
         BE    TMNT2321            BRANCH ON NO                    DT0I 09429203
         CLI   UNIT+3,SLASH        WAS BIN NUMB SPECIFIED          DT0I 09429903
         BNE   GETMAIN             BRANCH ON NO                    DT0I 09430603
         CLC   1(1,INLOOP),UNIT+4  CHECK IF CORRECT BIN NUMB       DT0I 09431303
         BE    GETMAIN             BRANCH ON YES                   DT0I 09432003
         B     AGAIN2              GO GET ANOTHER UCB              DT0I 09432703
GETMAIN  SR    R2,R2                                               DT0I 09433403
         IC    R2,1(INLOOP)        PICK UP BIN NUMB AND            DT0I 09434103
         SLL   R2,4                CALCULATE MAIN UCB ADDR         DT0I 09434803
         LA    R2,56(R2)                                           DT0I 09435503
         SR    INLOOP,R2                                           DT0I 09436203
         CLC   UNIT(3),13(INLOOP)  IS THIS THE UNIT SPECIFIED      DT0I 09436903
         BNE   AGAIN2              NO GET ANOTHER UCB              DT0I 09437603
         B     TMNT2321            TRY TO MOUNT                    DT0I 09438303
CHKUNIT  CLI   UNIT,X'00'          WAS SPECIFIC UNIT SPECIFIED     DTOI 09439003
         BE    ONUSE               BRANCH ON NO                    DT0I 09439703
         CLI   UNIT+3,SLASH        CHECK IF BIN NUMB WAS SPECIFIED DT0I 09440403
         BNE   BACKUP              BRANCH ON NO                    DT0I 09441103
         NI    UNIT+4,X'0F'            TURN OFF ZONE BITS          DT0I 09441803
         CLC   1(1,INLOOP),UNIT+4  CHECK IF CORRECT BIN NUMB       DT0I 09442503
         BE    BACKUP              BRANCH ON YES TO CHECK UNIT     DT0I 09443203
         B     TRYAGAIN            GO CHECK ANOTHER UCB            DT0I 09443903
BACKUP   SR    R2,R2                                               DTOI 09444603
         IC    R2,1(INLOOP)        PICKUP BIN NUMB                 DT0I 09445303
         SLL   R2,4                AND CALCULTTE MAIN              DT0I 09446003
         LA    R2,56(R2)           UCB ADDR                        DT0I 09446703
         SR    INLOOP,R2                                           DT0I 09447403
         CLC   UNIT(3),13(INLOOP)  IS THIS THE SPECIFIC UNIT       DT0I 09448103
         BE    ONUSE               BRANCH ON YES                   DT0I 09448803
         B     TRYAGAIN            GO CHECK NEXT UCB               DT0I 09449503
*                                                                       09450203
*                                                                       09450903
*                                                                       09451603
*              HAVE FOUND MATCH FOR VOLUME'S DEVICE TYPE                09452303
*                                                                       09453003
*        NOW SEARCH THROUGH DEVICE MASKS FOR A UNIT MATCHING A DD       09453703
*        CARD'S ALLOCATION. (LOOP 1 - CHECK WHETHER VOLUME IS           09454403
*         ALREADY MOUNTED. LOOP 2 - LOOK FOR A VOLUME TO DISMOUNT       09455103
*         IN ORDER TO MOUNT THE VOLUME REQUESTED.)                      09455803
*                                                                       09456503
*                                                                       09457203
*                                                                       09457903
DMTFOUND DS    0H                                                HEADRS 09458603
         SR    LOOP,LOOP                SET UP FOR RTA                  09459303
         LA    LINK,4                   SET UP DECREMENT REG            09460000
         CLI   OFFSET7(INLOOP),X'05'    CHECK DEVICE TYPE IN DMT     CS 09465019
*                                        ENTRY                       CS 09470019
         BE    MT2321                   BRANCH IF 2321               CS 09475019
GETMSKS  DS    0H                                                       09480000
         L     ACCE,0(WORK)             GET A WORD OF OUR MASK          09500000
         L     ACCO,8(INLOOP)           GET DMT MASK                    09520000
         LA    WORK,4(WORK)             UP BOTH MASK POINTERS           09540000
         LA    INLOOP,4(INLOOP)          TO NEXT WORD TO CHECK       CT 09544020
*                                                                       09548020
**********                                                              09552020
*                                                                       09556020
*        'AND' A WORD OF INTERNAL TABLE MASK WITH A WORD OF THE         09560020
*         DMT MASK TO FIND MATCHING BITS                                09564020
*                                                                       09568020
**********                                                              09572020
*                                                                       09576020
         NR    ACCO,ACCE                AND REGS TO FIND MATCHES        09580000
         LA    WORK2,32                 CONTROL FOR LOOP THROUGH     CT 09590020
*                                        BITS IN REGISTERS           CT 09600020
SHIFTBOT DS    0H                                                    CT 09610020
         LTR   ACCE,ACCE                TEST AND                     CT 09620020
         SLL   ACCE,ONEBIT               SHIFT OUR MASK REGISTER     CT 09630020
*                                        ONE BIT                     CT 09640020
         BM    UPRTA                    BRANCH IF BIT ON             CT 09650020
*                                        (CORRESPONDS TO A DD CARD)  CT 09660020
TESTAN   DS    0H                                                       09700000
         LTR   ACCO,ACCO                TEST AND                        09720000
*                                                                       09724020
**********                                                              09728020
*                                                                       09732020
*        BRANCH OUT OF LOOP THROUGH MASKS WHEN FIND A BIT ON            09736020
*         (HAVE FOUND A UCB MATCHING A DD CARD)                         09740020
*                                                                       09744020
**********                                                              09748020
*                                                                       09752020
         SLL   ACCO,ONEBIT              SHIFT MATCH REGISTER         CT 09756020
*                                        ONE BIT                     CT 09760020
         BM    POSMOUNT                 BRANCH IF BIT ON             CT 09764020
*                                        (MEANS UCB MATCHES DD CARD) CT 09768020
CONSCH1  DS    0H                                                       09780000
         BCT   WORK2,SHIFTBOT           LOOP ON 32 BITS OF ANDED     CT 09800020
*                                        REGISTER                    CT 09820020
         SR    IT,LINK                  CHECK NUMBER OF WORDS LEFT   CT 09840020
*                                        TO CHECK IN MASKS           CT 09860020
         BP    GETMSKS                  IF GREATER THAN ZERO, BRANCH CT 09880020
         B     BB1(SEARCH)                                              09900000
BB1      B     SS1                                                      09920000
         L     IT,PTRINTAB                                              09940000
         B     DTS                      HAVE FAILED TO FIND A        CT 09950020
*                                        VOLUME TO DISMOUNT          CT 09960020
*                                        - TAKE ERROR EXIT           CT 09970020
SS1      LA    SEARCH,4                 LOAD DEVICE TYPE SEARCH INDIC   09980000
         B     DEV                      START SECOND LOOP THROUGH    CT 09986020
*                                        MASKS - THIS TIME LOOK FOR  CT 09992020
*                                        A DEVICE TO DISMOUNT        CT 09998020
*                                        RATHER THAN FOR A VOLUME    CT 10004020
*                                        WHICH IS ALREADY MOUNTED    CT 10010020
UPRTA    DS    0H                       INCREMENT RELATIVE TABLE ADDR   10020000
         LA    LOOP,4(LOOP)              TO NEXT DD CARD POINTER     CT 10030020
*                                        IN INTERNAL TABLE           CT 10040020
         B     TESTAN                                                   10060000
POSMOUNT EQU   *                                                        10080000
         LR    R0,IT                   SAVE REMAINING LENGTH     A45128 10081022
         L     IT,PTRINTAB             START OF INT. TABLE       A45128 10082022
         LH    WORK3,2(IT)             MASK DISPLACEMENT         A45128 10083022
         LH    IT,2(WORK3,IT)          TOTAL MASK LENGTH         A45128 10084022
         SR    IT,R0                   DETERMINE F/W FIELD       A45128 10084822
         SLL   IT,4                    OFFSET IN UCBLUT          A45128 10085622
         LA    LINK,32                 BITS PER F/W              A45128 10086022
         SR    LINK,WORK2              OFFSET IN BITS            A45128 10087022
         SLL   LINK,1                  OFFSET IN UCBLUT FIELD    A45128 10088022
         AR    LINK,IT                 OFFSET IN UCBLUT          A45128 10090022
*                                                                A45128 10091022
         L     IT,COMTAB               FIND CVT ADDRESS          A45128 10092022
         L     IT,IUCB(IT)             POINTER TO UCBLUT         A45128 10093022
         AR    IT,LINK                 ADD IN INDEX            @ZM30153 10093403
         ICM   IT,3,0(IT)              GET UCB PTR             @ZM30153 10094403
         N     IT,FOXES                ZERO LEFT HALF OF REG   @ZM30153 10094803
         LA    LINK,4                  RESTORE LINK              A45128 10095022
         B     DEVDEC1(SEARCH)                                          10100000
DEVDEC1  B     S1                                                       10120000
**********                                                              10122019
*                                                                       10124019
*        MATCH IN LOOP 2 -                                              10125020
*            TEST WHETHER THIS VOLUME CAN BE DISMOUNTED IN ORDER        10126019
*             TO MOUNT THE REQUESTED VOLUME                             10128019
*            (IF NOT, CONTINUE SEARCHING)                               10130019
*                                                                       10132019
**********                                                              10134019
D1       DS    0H                                                       10140000
         LR    WORK3,IT                 POINTER TO UCB           A45128 10160022
         L     IT,PTRINTAB              GET TABLE POINTER               10180000
         LA    IT,0(LOOP,IT)                                            10200000
         TM    0(IT),USAGE              TEST IF IN USE                  10220000
         BO    CONSCH                   IF YES CONTINUE SEARCH          10240000
         USING UCB,WORK3                                         A27909 10286019
         TM    SRTESTAT,REMOVABL        IS THIS VOLUME REMOVABLE?    CS 10292019
         BM    CONSCH                   NO. CANNOT DO MOUNT          CS 10298019
*                                        (RESERVED AND PERMANENTLY   CS 10304019
*                                         RESIDENT BITS MUST BE OFF  CS 10310019
*                                         IN UCB)                    CS 10316019
         TM    UCBTBYT3,UCB3TAPE        IS THIS VOLUME A TAPE?   A27909 10322019
         BO    SKIPTEST                 YES. DON'T TEST WHETHER  A27909 10328019
*                                        SHARABLE. (ALL TAPES    A27909 10334019
*                                        ARE NON-SHARABLE)       A27909 10340019
         TM    SRTESTAB,SRTEBSVL        IS THIS VOLUME SHARABLE? A27909 10346019
         BZ    CONSCH                   YES. CANNOT MOUNT.       A27909 10352019
*                                        (SHARABLE IF BIT        A27909 10358019
*                                         IS OFF IN UCB)         A27909 10364019
SKIPTEST DS    0H                                                A27909 10370019
         CLI   UNIT,X'00'              WAS A UNIT ADDR SPECIFIED   DT0I 10376018
         BE    TMOUNT                  NO, MOUNT VOLUME            DT0I 10380018
         CLC   UCBUNIT(3,WORK3),UNIT   IS THIS THE UNIT SPECIFIED  DT0I 10384018
         BE    TMOUNT                  BRANCH ON YES               DT0I 10388018
         B     CONSCH                                              DT0I 10392018
         DROP  WORK3                                             A27909 10396019
**********                                                              10396619
*                                                                       10397219
*        MATCH IN LOOP 1 -                                              10397520
*            TEST WHETHER THE REQUESTED VOLUME IS ALREADY MOUNTED       10397819
*                                                                       10398419
**********                                                              10399019
S1       DS    0H                                                       10400000
*                                                                       10500000
         CLI   18(IT),X'08'             UNIT RECORD DEVICE              10520000
         BE    ONUSE                    YES, INDICATE MOUNTED           10540000
*                                       COMPARE VSN S                   10560000
         CLC   UCBVSN(6,IT),VSN         VOLUME SERIALS EQUAL            10580000
         BE    CHKADR                  YES,CHECK IF MOUNTED ON     DT0I 10590018
*                                      CORRECT UNIT                DT0I 10600018
CONSCH   DS    0H                                                       10620000
         LR    IT,R0                                                    10640000
         B     CONSCH1                                                  10660000
CHKADR   EQU   *                                                   DT0I 10662018
         CLI   UNIT,X'00'               WAS UNIT ADDR SPECIFIED    DT0I 10670018
         BE    ONUSE                   BRANCH ON NO                DT0I 10672018
         CLC   UCBUNIT(3,IT),UNIT      IS THIS THE UNIT SPECIFIED  DT0I 10674018
         BE    ONUSE                   BRANCH ON YES               DT0I 10676018
         B     CONSCH                                              DT0I 10678018
TMOUNT   DS    0H                  DECISION                             10680000
         TM    INDICATO,MOUNT           IS MOUNTING BIT ON              10700000
         BZ    ONUSE                    IF NO, BRANCH TO "ONUSE" TO     10720000
*                                            SET UP USAGE BIT AND       10740000
*                                            RELATIVE TABLE ADDRESS     10760000
*                                       IF YES, PROCEED TO GET VOLUMES  10780000
*                                            MOUNTED                    10800000
*                                                                       10820000
*                                                                       10830019
*                   MOUNT VOLUME BY MEANS OF OPENJ                      10840019
*                   ******************************                      10850019
*                                                                       10860019
*               ONLY DIRECT ACCESS DEVICES ARE MOUNTED                  10870019
*                                                                       10900000
         L     ACCO,0(IT)                                               10920000
         ICM   ACCO,3,TIOTUCB(ACCO)    GET UCB ADDR            @ZA25503 10922099
         N     ACCO,FOXES              ZERO HIGH BYTES         @ZM30153 10932099
         CLI   UCBDEVT(ACCO),X'20'                                      10960000
         BNE   ONUSE                                                    10980000
TMNT2321 L     ACCE,0(IT)               POINT TO DDNAME FOR MOUNT       11000013
*             (IF NOT, CONTINUE SEARCHING)                              11030020
         STM   RETURN,PARAMPTR,SAVEREG SAVE REGISTERS PRIOR TO    M0313 11080020
*                                      OPEN & CLOSE               M0313 11130020
         MVI   JFCB+117,ONEVOL          INDICATE JFCB IS FOR ONE     CT 11190020
*                                        VOLUME                      CT 11200020
         LA    ACCO,OPENJDCB                                            11220000
         MVC   DCBDDNAM-IHADCB(8,ACCO),0(ACCE)  PUT DDNAME IN DCB    CT 11227020
*                                                FOR THE OPENJ       CT 11234020
         MVC   JFCB+118(6),VSN          PUT VOLSER IN JFCB FOR THE   CT 11241020
*                                        OPENJ                       CT 11248020
*                                       ISSUE THE OPENJ MACRO (THE   CT 11255020
*                                        OPERATOR WILL RECEIVE AN    CT 11262020
*                                        IEC101A MESSAGE TO MOUNT    CT 11269020
         OPEN  (OPENJDCB,INPUT),TYPE=J   THE VOLUME)                 CT 11276020
*                                       CLOSE THE DCB USED TO    A27790 11290019
         CLOSE (OPENJDCB,REREAD)         MOUNT THE VOLUME        A27790 11300019
*                                                                       11320000
         LM    RETURN,PARAMPTR,SAVEREG RELOAD REGISTERS           M0313 11350020
*                                                                       11381019
*                                                                       11382019
*                TURN ON USAGE BIT IN INTERNAL TABLE                    11383019
*                  AND INDICATE MOUNT IN ITHEADER                       11384019
*                ***********************************                    11385019
*                                                                       11386019
*                                                                       11387019
ONUSE    STH   LOOP,RTA                                          HEADRS 11388019
         L     IT,PTRINTAB                                       HEADRS 11389019
         LA    IT,OFFSET0(IT)           GET DD POINTER           HEADRS 11390019
         AR    IT,LOOP                  ADD IN RTA               HEADRS 11391019
         LR    LOOP,RETURN                                       HEADRS 11392019
         OI    OFFSET0(IT),USAGE        TURN ON USAGE BIT IN     HEADRS 11393019
*                                        INTERNAL TABLE          HEADRS 11394019
         OI    INDICATO,YESMOUNT        CALCULATE RTA AND        HEADRS 11395019
*                                        INDICATE A MOUNT        HEADRS 11396019
         B     STEPVSN                  BRANCH TO STEPVSN (STEP  HEADRS 11397019
*                                        TO NEXT VOLUME SERIAL   HEADRS 11398019
*                                        NUMBER)                 HEADRS 11399019
*                                                                       11400019
*                                                                       11421019
*                                                                       11427019
*                      INDICATE VOLUME NOT FOUND                        11433019
*                      *************************                        11439019
*                                                                       11445019
DTS      DS    0H                                                HEADRS 11451019
         OI    INDICATO,NOMOUNT         TURN ON NOMOUNT BIT IN   A29718 11455019
*                                        ITHEADER                A29718 11459019
         B     RETURNA                  RETURN TO CALLER         A29718 11463019
*                                        (IGNORE ANY OTHER       A29718 11467019
*                                         VOLUME MOUNT REQUESTS) A29718 11471019
STEPVSN  DS    0H                       GET VOLUME SERIAL NUMBER POINT  11480000
         LA    VMREQUST,MOUNTREQ(VMREQUST)                         DT0I 11500018
*                                                                       11520000
*                                                                       11540000
*                                  LOOP CONTROL  FOR INNER LOOP "B"     11560000
         BCT   LOOP,LOOPB               HAS LAST VOLUME SERIAL NUMBER   11580000
*                                            BEEN HANDLED               11600000
*                                       IF NO, BRANCH TO "LOOPB" TO     11620000
*                                            CONTINUE SEARCH ON VOLUME  11640000
*                                            SERIAL NUMBERS             11660000
*                                       IF YES, PROCEED TO TEST FOR     11680000
*                                            COMPLETION OF OUTER LOOP   11700000
*                                                                       11720000
*********************************************************************** 11724019
*********************************************************************** 11728019
**                                                                   ** 11732019
**                     RETURN TO CALLING PROGRAM                     ** 11736019
**                                                                   ** 11740019
*********************************************************************** 11744019
*********************************************************************** 11748019
*                                                                       11752019
RETURNA  DS    0H                                                HEADRS 11756019
         L     R13,4(R13)              CURRENT SA= OLD SA         M0313 11758020
         RETURN (14,12),T,RC=0                                          11760000
*                                                                       11763019
*********************************************************************** 11766019
*********************************************************************** 11769019
**                                                                   ** 11772019
**                ENTRY POINT TO BUILD INTERNAL TABLE                ** 11775019
**                                                                   ** 11778019
*********************************************************************** 11781019
*********************************************************************** 11784019
*                                                                       11787019
ENTERHER DS    0H                                                HEADRS 11790019
         BALR  BASE,R0                  SET UP ADDRESSABILITY           11800000
         USING *,BASE                   INFORM ASSEMBLER                11820000
*                                                                       11840000
*                                                                       11860000
*                                  PROCESS                              11880000
*                                       ESTABLISH POINTER TO TIOT       11900000
         L     ACCE,COMTAB              GET ADDRESS OF COMMUNICATIONS   11920000
*                                            TABLE                      11940000
         L     ACCE,CMTTCB2(ACCE)       GET ADDRESS OF DOUBLE WORD      11960000
*                                            TCB POINTERS               11980000
         L     ACCE,4(ACCE)             GET TCB ADDRESS                 12000000
         L     TIOT,TCBTIOT(ACCE)       GET TIOT ADDRESS                12020000
         LA    TIOT,TIOTFOUN(TIOT)      STEP TIOT ADDRESS PAST          12040000
*                                            FOUNDATION                 12060000
   CLC   41(3,ACCE),Z                                                   12080000
     BE   NOTJOBLB                                                      12100000
         CLC   TIOTDDNA(8,TIOT),JOBLIB  CHECK WHETHER FIRST TIOT A32626 12103020
*                                        ENTRY IS FOR JOBLIB DD  A32626 12106020
         BNE   NOTJOBLB                 IF NO, BRANCH (HAD STEP- A32626 12109020
*                                        LIB, NOT JOBLIB, ENTRY  A32626 12112020
*                                        IN TCB)                 A32626 12115020
    LA   TIOT,TIOTENTR(TIOT)                                            12120000
NOTJOBLB DS    0H                  PROCESS                              12140000
         LA    SEARCH,0                 SET INDEX TO BYPASS TABLE       12160000
*                                       BUILDING LOOP                   12180000
PRESET   DS    0H                  PROCESS                              12200000
*                                       (ASSUME PARAMPTR, TIOT, AND     12206019
*                                        SEARCH REGISTERS ARE PRESET)   12212019
         LR    ACCE,TIOT                SET UP POINTERS FOR NOT         12220000
         L     IT,PTRINTAB                   BUILD LOOP                 12240000
*                                       TIOT AND INTERNAL TABLE         12260000
*                                            POINTERS                   12280000
         SR    ACCO,ACCO                ZERO REGISTER TO COUNT NUMBER   12300000
*                                       OF ENTRIES NEEDED IN INT. TABLE 12320000
*                                                                       12322019
*********************************************************************** 12324019
*                                                                     * 12326019
*                    TWO-PASS LOOP TO SEARCH TIOT                     * 12328019
*                                                                     * 12330019
*********************************************************************** 12332019
*                                                                       12334019
SCHTIOT  DS    0H                  PROCESS                              12340000
         SR    LOOP,LOOP                FETCH TIOT ENTRY LENGTH         12360000
*                                                                       12380000
         IC    LOOP,TIOTLEN(ACCE)       LOOP CONTAINS TIOT LENGTH       12400000
*                                                                       12420000
*                                                                       12440000
*                                  DECISION                             12460000
         LTR   LOOP,LOOP                IS THIS LAST ENTRY IN TIOT      12480000
         BZ    ENDTIOT                  IF YES, BRANCH TO ENDTIOT TO    12500000
*                                            DETERMINE RESULTS OF TIOT  12520000
*                                           SCAN                        12540000
*                                                                       12560000
*                                                                       12580000
*                                  DECISION                             12600000
         CLC   TIOTDDNA(8,ACCE),BLANK   IS DDNAME BLANK                 12620000
         BE    UPTIOT                   IF YES, BRANCH TO UPTIOT TO     12640000
         CLC   TIOTDDNA(8,ACCE),SYSAB   IS DDNAME SYSABEND         2711 12645014
         BE    UPTIOT                   YES,BRANCH TO EXCLUDE      2711 12650014
*                                          THIS DD ENTRY           2711 12655014
         CLC   TIOTDDNA(8,ACCE),SYSUDMP  IS DDNAME SYSUDUMP        4919 12656016
         BE    UPTIOT                  YES, BRANCH TO EXCLUDE      4919 12657016
*                                      THIS DD ENTRY               4919 12658016
         CLC   TIOTDDNA(8,ACCE),STPLIB  IS DDNAME STEPLIB          SL0H 12658517
         BE    UPTIOT                   YES, BRANCH TO EXCLUDE     SL0H 12659017
*                                       THIS DD ENTRY              SL0H 12659517
*                                  PROCESS                              12660000
         SR    LOOP,LOOP                                                12680000
         IC    LOOP,GENERICC                                            12700000
*                                                                       12720000
*                                                                       12740000
*                                  DECISION                             12760000
         LTR   LOOP,LOOP                IS GENERIC COUNT ZERO           12780000
         BZ    ISBUILD                  IF YES, BRANCH TO "ISBUILD" TO  12800000
*                                            GENERIC NAME SEARCH        12820000
*                                                                       12840000
*                                                                       12860000
*                                  INITIALIZE LOOP ON GENERIC NAMES     12880000
         L     INLOOP,GENERICP          FETCH GENERIC TABLE ADDRESS     12900000
*                                  DECISION                             12920000
GENLOOP  DS    0H                       IS GENERIC NAME EQUAL TO        12940000
         CLC   TIOTDDNA(8,ACCE),0(INLOOP)   DDNAME                      12960000
         BE    UPTIOT                  IF YES, BRANCH TO UPTIOT TO      12980000
*                                            OMIT DDNAME FROM INTERNAL  13000000
*                                            TABLE                      13020000
*                                                                       13040000
*                                                                       13060000
*                                  PROCESS                              13080000
         LA    INLOOP,8(INLOOP)         INCREMENT GENERIC NAME POINTER  13100000
*                                                                       13120000
*                                                                       13140000
*                                  LOOP CONTROL                         13160000
         BCT   LOOP,GENLOOP             ARE THERE MORE GENERIC NAMES    13180000
*                                       IF YES, BRANCH TO START OF      13200000
*                                            LOOP "GENLOOP"             13220000
*                                       IF NO, PROCEED WITH TABLE       13240000
*                                            BUILDING                   13260000
ISBUILD  DS    0H             BRANCH ENTRY POINT ENTERED AFTER ALLOWING 13280000
*                             FOR GENERIC DDNAMES                       13300000
*                                  DECISION                             13320000
         B     DECIDEBL(SEARCH)         IS THIS BUILD LOOP              13340000
DECIDEBL B     NBLD                     IF NOT BUILD LOOP, BRANCH TO    13360000
*                                            NBLD                       13380000
         B     BLD                      IF BUILD LOOP BRANCH TO BLD     13400000
NBLD     DS    0H                  PROCESS                              13420000
         SR    LOOP,LOOP                                         A45128 13430022
         IC    LOOP,2(ACCE)            NBR OF DEVICES            A45128 13432022
         LTR   LOOP,LOOP         IS NUMB&R OF DEVICES 0           M3250 13432600
         BNP   UPTIOT            IF YES, NO SPACE NEEDED IN I.T.  M3250 13433200
NEXTDEV1 DS    0H                                                A45128 13434022
         LA    IT,4(IT)                 INCREMENT INTERNAL TABLE        13440000
         LA    ACCO,1(ACCO)             TABLE ADDRESS AND COUNT         13460000
*                                       OF ENTRIES NEEDED IN INT. TABLE 13480000
         BCT   LOOP,NEXTDEV1           MORE DEVICES              A45128 13490022
UPTIOT   DS    0H                  PROCESS                              13500000
         SR    LOOP,LOOP                                           7296 13510017
         IC    LOOP,TIOTLEN(ACCE)  PLACE DD ENTRY LENGTH IN LOOP   7296 13520017
         LA    ACCE,0(LOOP,ACCE) UP ACCE TO POINT TO NEXT DD ENTRY 7296 13530017
*                                                                       13540000
         B     SCHTIOT                  BRANCH TO SCHTIOT TO INSPECT    13560000
*                                            NEXT TIOT ENTRY            13580000
BLD      DS    0H             BRANCH POINT FOR BUILD LOOP               13600000
         SR    SEARCH,SEARCH                                     A45128 13610022
         SR    INLOOP,INLOOP                                     A45128 13612022
         IC    INLOOP,2(ACCE)          NBR OF DEVICES            A45128 13614022
         LTR   INLOOP,INLOOP     IS NUMBER OF DEVICES 0           M3250 13614600
         BNP   SKIP              IF YES, DON'T FILL I. T.         M3250 13615200
NEXTDEV2 DS    0H                                                A45128 13616022
         LA    LOOP,TIOTDDNA(ACCE)      PLACE DDNAME ADDRESS IN         13620000
         ST    LOOP,4(IT)                    INTERNAL TABLE             13640000
         STC   SEARCH,4(IT)            INDIC DEV POSITION        A45128 13650022
         LA    SEARCH,1(SEARCH)        FOR NEXT POSITION         A45128 13652022
*                                                                       13660000
*                                                                       13680000
*                                  PROCESS                              13700000
         LA    IT,4(IT)                 UPDATE INTERNAL TABLE POINTER   13720000
         BCT   INLOOP,NEXTDEV2         MORE DEVICES              A45128 13722022
SKIP     DS    0H                                                 M3250 13723000
         LA    SEARCH,4                RESTORE SEARCH            A45128 13724022
         SR    LOOP,LOOP                                           7296 13730017
         IC    LOOP,TIOTLEN(ACCE)  PLACE DD ENTRY LENGTH IN LOOP   7296 13740017
         LA    ACCE,0(LOOP,ACCE) UP ACCE TO POINT TO NEXT DD ENTRY 7296 13750017
*                                                                       13760000
         B     SCHTIOT                  BRANCH TO  SCHTIOT TO INSPECT   13780000
*                                            NEXT TIOT ENTRY            13800000
ENDTIOT  DS    0H             BRANCH POINT ENTERED AT END OF TIOT SEARC 13820000
         B     DECBUILD(SEARCH)         IS THIS A BUILD LOOP            13840000
DECBUILD B     CHKSPCE                  NO                              13860000
         B     CHKDUP                   YES                             13880000
*                                                                       13882019
*********************************************************************** 13884019
*                                                                     * 13886019
*         COMPUTE AMOUNT OF SPACE NEEDED FOR INTERNAL TABLE           * 13888019
*                                                                     * 13890019
*********************************************************************** 13892019
*                                                                       13894019
CHKSPCE  LA    IT,OFFSET4(IT)           IT = SPACE NEEDED FOR DD        13904019
*                                        ENTRIES + 4 BYTE HEADER        13914019
         L     LOOP,PTRINTAB            GET ADDRESS OF IT (SHOULD       13924019
*                                        BE ZEROED)                     13934019
         LA    LOOP,OFFSET0(LOOP)       ZERO OUT HIGH-ORDER BYTE        13944019
         SR    IT,LOOP                  COMPUTE IT LENGTH SO FAR        13954019
         STC   ACCO,CNTINTAB            SAVE NUMBER OF DD ENTRIES       13964019
*                                        FOR IT IN ITHEADER             13974019
         STH   IT,LENINTAB              SAVE LENGTH OF HEADER AND       13984019
*                                        DD PORTION OF IT IN            13994019
*                                        ITHEADER                       14004019
*                                                                       14014019
*                                                                       14024019
*                     CALCULATE DEVICE MASK SIZE                        14034019
*                (THIS MASK WILL BE PLACED IN THE IT,                   14044019
*                  AND USED TO COMPARE WITH DMT ENTRIES)                14054019
*                                                                       14064019
*                                                                       14074019
         LA    R0,0(IT)                 LOAD AMOUNT OF CORE NEEDED      14160000
         L     ACCE,COMTAB              GET POINTER TO COMTAB           14180000
         L     ACCE,IUCB(ACCE)          GET UCB TABLE POINTER           14200000
         SR    LOOP,LOOP                LOOP WILL HOLD COUNT OF         14210019
*                                        ENTRIES IN UCB LOOK-UP TABLE   14220019
         LR    ACCO,ACCE                SAVE ADDRESS OF UCB LUT FOR     14230019
*                                        LATER USE                      14240019
UCBLOOK  TM    OFFSET0(ACCE),HEXFF                                      14250019
         BNO   UPPTR                                                    14260019
         TM    OFFSET1(ACCE),HEXFF      HAVE FOUND X'FFFF' AT END       14270019
*                                        OF UCB LUT?                    14280019
         BO    ENDUCB                   IF SO, STOP COUNTING ENTRIES    14290019
UPPTR    LA    LOOP,ONEBIT(LOOP)        UP COUNT OF ENTRIES IN UCB LUT  14300019
         LA    ACCE,OFFSET2(ACCE)       POINT TO NEXT HALFWORD IN LUT   14310019
         B     UCBLOOK             BRANCH TO LOOP                       14360000
*                                                                       14363019
*                                                                       14366019
*             ADJUST THE MASK SIZE IF 2321S ARE SYSGENNED               14369019
*                                                                       14372019
*                                                                       14375019
ENDUCB   DS    0H                                                       14380000
         LR    ACCE,LOOP         NO. OF BITS FOR PART ONE OF MASK  1415 14390014
*                                                                       14410013
*                                                                       14412013
*                                      ACCO HAS ADDRESS OF UCB LUT      14415019
*                                                                       14418019
         SR    SEARCH,SEARCH           USE SEARCH TO KEEP COUNT OF THE  14422013
*                                         NUMBER OF 2321                14424013
         SR    LOOP,LOOP               USE LOOP FOR THE BASE REG IN     14426013
*                                         REFERANCING THE UCB           14428013
         SR    R0,R0                   USE R0 TO KEEP NUMBER OF UCB     14430013
*                                         PTRS AT END OF TIOT           14432013
         USING UCB,LOOP                                                 14434013
NEXTUCB  CLC   0(2,ACCO),Z              CHECK FOR 2 BYTES OF ZERO       14436013
         BE    NOT2321                    BRANCH ON YES                 14438013
         SR    LOOP,LOOP               ZERO WORK REG           @ZM30153 14438403
         ICM   LOOP,3,0(ACCO)           GET UCB ADDR           @Z30AAAG 14440003
         TM    UCBTYP+2,X'20'                                           14442013
         BC    12,NOT2321                                               14444013
         CLI   UCBTYP+3,X'05'          IS THIS A 2321 UCB        S20201 14445020
         BNE   NOT2321                  NO,NEXT UCB LUT ENTRY    S20201 14446020
****                                                             A23794 14448119
*                                                                A23794 14448219
*     DON'T COUNT ALTERNATE CHANNEL POINTERS TO UCBS (FOR 2321S) A23794 14448319
*                                                                A23794 14448419
****                                                             A23794 14448519
         LA    WORK2,UCBPTRS            USE WORK2 TO POINT TO    A23794 14448619
*                                        2321 POINTERS (KEPT IN  A23794 14448719
*                                        WORK SPACE)             A23794 14448819
         LTR   SEARCH,SEARCH            TEST NUMBER OF 2321S     A23794 14448919
*                                        FOUND                   A23794 14449019
         BZ    IS2321                   IF ZERO, COUNT THIS      A23794 14449119
*                                        POINTER                 A23794 14449219
         LR    WORK3,SEARCH             USE WORK3 TO BCT THROUGH A23794 14449319
*                                        2321 POINTERS           A23794 14449419
CHKPTR   CLM   LOOP,3,0(WORK2)         TEST UCB POINTERS       @ZM30153 14449503
         BE    NOT2321                  IF EQUAL, HAVE AN ALTER- A23794 14453603
*                                        NATE CHANNEL POINTER    A23794 14455203
*                                        (DON'T COUNT IT)        A23794 14456803
         LA    WORK2,TWOBYTES(WORK2)    POINT TO NEXT 2321 PTR.  A23794 14458403
         BCT   WORK3,CHKPTR             LOOP THROUGH 2321 PTRS.  A23794 14460003
****                                                                    14461603
*                                                                       14463203
*                      INCREMENT COUNT OF 2321S                         14464803
*                                                                       14466403
****                                                                    14468003
IS2321   LA    SEARCH,OFFSET1(SEARCH)   ADD ONE TO NUMBER OF 2321S      14469603
         CH    SEARCH,MAXCOUNT          TEST NUMBER OF 2321S     A23794 14471203
         BH    ITERROR                  IF > 30, DON'T HAVE      A23794 14472803
*                                        ENOUGH WORK SPACE       A23794 14474403
*                                        (TAKE ERROR EXIT)       A23794 14476003
         STH   LOOP,0(WORK2)            SAVE THIS 2321 POINTER   A23794 14477603
*                                        IN WORK SPACE           A23794 14479203
NOT2321  LA    ACCO,2(ACCO)             UPDATE UCB POINTER              14480803
         TM    0(ACCO),X'FF'            IS THIS THE END OF THE UCB      14482403
*                                         LOOK UP TABLE                 14484003
         BC    12,NEXTUCB                IF NO TAKE ONE OF THE BRANCHES 14485603
         TM    1(ACCO),X'FF'                                            14487203
         BC    12,NEXTUCB                                               14488803
*                                         FALL THROUGH IF YES           14490403
         DROP  LOOP                                                     14492003
HAVE2321 LTR   SEARCH,SEARCH           WERE THERE ANY 2321              14493603
         BZ    NORMAL                                                   14495203
         LA    ACCE,2(ACCE)   2 BYTES SEPARATING 2 PARTS OF MASK   1415 14496803
         LR    ACCO,SEARCH                                              14498403
         LR    R0,SEARCH                                                14500003
         LR    SEARCH,ACCE             SAVE PREVIOUSLY CALCULATED VALUE 14501603
         SR    ACCE,ACCE                  FOR INTERNAL TABLE            14503203
         M     ACCE,TEN                 MULTIPLY NUMBER OF 2321S        14504803
*                                        BY 10 TO GET NUMBER OF         14506403
*                                        BIN POINTERS (RESULT IS        14508003
*                                        IN REGISTER ACCO)              14509603
         AR    ACCO,SEARCH              GET TOTAL BITS IN MASK          14511203
         A     R0,ONE                                                   14512803
         SRL   R0,1                    DIVIDE BY 2                      14514403
         SLL   R0,2                    MUL BY 4                         14516003
*                                       (ROUND NUMBER OF 2321S          14517603
*                                        TO NEXT MULTIPLE OF 4)         14519203
*                                                                       14520803
         LR    ACCE,ACCO                                                14522403
*                                                                       14524003
*                                                                       14525603
*                COMPUTE SIZE OF DEVICE MASK IN BYTES,                  14527203
*                     ROUNDED TO NEXT FULLWORD                          14528803
*                                                                       14530403
*                                                                       14532003
NORMAL   LA    ACCE,31(ACCE)            ROUND TOTAL MASK LENGTH    1415 14533603
         SRL   ACCE,5                    AND CONVERT TO FULL WORDS 1415 14535203
         SLL   ACCE,2                    LENGTH                    1415 14536803
         LR    ACCO,ACCE                                                14538403
         AR    ACCO,IT                                                  14540000
         LA    ACCO,OFFSET8(ACCO)       ADD FOUR BYTES FOR MASK    I276 14544019
*                                        LENGTH AND FOUR BYTES     I276 14548019
*                                        FOR DMT ADDRESS           I276 14552019
*                                                                       14556019
*********************************************************************** 14560019
*                                                                     * 14564019
*               GET CORE SPACE FOR THE INTERNAL TABLE                 * 14568019
*                                                                     * 14572019
*********************************************************************** 14576019
*                                                                       14580019
         AR    R0,ACCO                  R0 HAS NUMBER OF BYTES TO       14584019
*                                      GETMAIN FOR IT             M0313 14588020
         LR    LOOP,PARAMPTR           SAVE PTR TO IT HEADER      M0313 14592020
         ST    R0,SAVER0               SAVE GETMAIN SIZE          M0313 14596020
*                                      ACROSS GETMAIN             M0313 14600020
*                                                                       14608019
         GETMAIN R,LV=(R0)              ISSUE GETMAIN                   14612019
         L     R0,SAVER0               RESTORE REGISTER           M0313 14616020
*                                                                       14620619
*                                                                       14621219
*                       ZERO OUT INTERNAL TABLE                         14621819
*                                                                       14622419
*                                                                       14623019
         LR    WORK2,R0                 GET LENGTH OF INTERNAL TABLE    14623619
         LR    WORK3,PARAMPTR           GET ADDRESS OF INTERNAL TABLE   14624219
         LH    INLOOP,MAXIXC            PUT 255 IN INLOOP - MAXIMUM     14624819
*                                        LENGTH FOR EXECUTE INSTRUCTION 14625419
ZEROTABL C     WORK2,MAXSIZE                                            14626019
         BNH   LASTXC                                                   14626619
         EX    INLOOP,XCINSTR           ZERO OUT 256 BYTES OF INTERNAL  14627219
*                                        TABLE                          14627819
         S     WORK2,MAXSIZE                                            14628419
         LA    WORK3,ADD256(WORK3)                                      14629019
         B     ZEROTABL                                                 14629619
LASTXC   BCTR  WORK2,0                  SUBTRACT ONE FROM LENGTH TO     14630219
*                                        PREPARE FOR EXECUTE INSTR.     14630819
         EX    WORK2,XCINSTR            ZERO OUT INTERNAL TABLE         14631419
*                                                                       14632019
*                                                                       14636019
*                PUT HEADER VALUES IN INTERNAL TABLE,                   14640019
*                      LOAD DEVICE MASK TABLE,                     I276 14644019
*             AND TURN BIT ON FOR INTERNAL TABLE BUILT                  14648019
*                                                                       14652019
*                                                                       14656019
         STH   R0,OFFSET0(PARAMPTR)     SAVE GETMAIN SIZE IN            14660019
*                                        FIRST HALFWORD OF INTER-       14664019
*                                        NAL TABLE                      14668019
         STH   IT,OFFSET2(PARAMPTR)     SAVE ((# OF DDS X 4) + 4)       14672019
*                                        IN SECOND HALFWORD             14676019
         LA    SEARCH,OFFSET31(SEARCH)  COMPUTE SIZE OF MASK            14680019
         SRL   SEARCH,FIVEBITS           WITHOUT BITS FOR 2321          14684019
         SLL   SEARCH,TWOBITS            BIN POINTERS (IF NO            14688019
*                                        2321S,SEARCH = 0)              14692019
         STH   SEARCH,OFFSET0(IT,PARAMPTR)                              14696019
*                                       SAVE SEARCH AFTER DD PTR.       14700019
*                                        SPACE IN INTERNAL TABLE        14704019
         STH   ACCE,OFFSET2(IT,PARAMPTR)                                14708019
*                                       SAVE MASK SIZE IN SECOND        14712019
*                                        HALFWORD AFTER DD SPACE        14716019
*                                        IN INTERNAL TABLE              14720019
         LR    WORK2,R0                 GET SIZE OF INTERNAL TABLE I276 14724019
         AR    WORK2,PARAMPTR           ADD ADDRESS OF INTERNAL    I276 14728019
*                                        TABLE                     I276 14732019
         STM   R0,PARAMPTR,SAVER0      SAVE REGS ACROSS LOAD      M0313 14738020
         LOAD  EP=DEVMASKT              LOAD DEVICE MASK TABLE     I276 14744019
         S     WORK2,FOUR               GET ADDRESS OF LAST WORD   I276 14748019
*                                        IN INTERNAL TABLE         I276 14752019
         ST    R0,0(WORK2)              STORE DMT ADDRESS IN LAST  I276 14756019
*                                        WORD OF INTERNAL TABLE    I276 14760019
         LM    R0,PARAMPTR,SAVER0      RESTORE REGISTERS          M0313 14766020
         IC    ACCE,INDICATO-ITHEADER(LOOP)                             14772019
*                                       TEMPORARILY SAVE INDICATO       14776019
         ST    PARAMPTR,PTRINTAB-ITHEADER(LOOP)                         14780019
*                                       STORE ADDRESS OF INTERNAL       14784019
*                                        TABLE IN ITHEADER              14788019
         STC   ACCE,INDICATO-ITHEADER(LOOP)                             14792019
*                                       RESTORE INDICATO BYTE           14796019
         LR    PARAMPTR,LOOP            RETURN ITHEADER ADDRESS         14800019
*                                        TO REGISTER 1                  14804019
         LA    SEARCH,INITTO4           SET INDEX TO ENTER TABLE        14808019
*                                        BUILDING LOOP (TO PUT          14812019
*                                        POINTERS TO DDS IN             14816019
*                                        INTERNAL TABLE)                14820019
*                                                                       14824019
         OI    INDICATO,TABLE           INDICATE INTERNAL TABLE         14828019
*                                        BUILT                          14832019
*                                                                       14836019
*********************************************************************** 14840019
*                                                                     * 14844019
*                        RETURN TO TIOT LOOP                          * 14848019
*               TO PUT DD POINTERS IN INTERNAL TABLE                  * 14852019
*                                                                     * 14856019
*********************************************************************** 14860019
*                                                                       14864019
         B     PRESET                                                   14869019
*                                                                       14875019
*********************************************************************** 14882019
*                                                                     * 14889019
*       CHECK DDS IN INTERNAL TABLE FOR DUPLICATE UCB POINTERS        * 14896019
*                  (IF FIND DUPLICATE, ADJUST COUNT)                  * 14903019
*                                                                     * 14910019
*********************************************************************** 14917019
*                                                                       14924019
CHKDUP   DS    0H                                                       14931019
         L     ACCE,PTRINTAB            SET UP FOR SEARCH OF            14940000
         LA    ACCE,4(ACCE)                                             14960000
         SR    LOOP,LOOP                     DUPLICATIONS               14980000
         IC    LOOP,CNTINTAB                                            15000000
         LTR   LOOP,LOOP               IF NO DD CARDS OMIT SEARCH       15020000
         BZ    JUMPOUT                                                  15040000
         BCT   LOOP,LOOPOUT                                             15060000
         B     JUMPOUT                                                  15080000
LOOPOUT  DS    0H             START OUTER LOOP                          15100000
*                                  PROCESS                              15120000
*                                       SET UP FOR INNER LOOP           15140000
         LA    ACCO,4(ACCE)             SET POINTER TO COMPARE DDNAME   15160000
         LR    INLOOP,LOOP              SET COUNT FOR NUMBER OF         15180000
*                                       ITERATIONS                      15200000
LOOPIN   DS    0H                  DECISION                             15220000
         SR    IT,IT                                             A45128 15225022
         IC    IT,0(ACCE)              DEV.ENTRY POSITION        A45128 15230022
         SLL   IT,2                    MULTIPLY WITH 4           A45128 15235022
         A     IT,0(ACCE)              FOR CORRECT UCB           A45128 15240022
         SR    VMREQUST,VMREQUST                                 A45128 15245022
         IC    VMREQUST,0(ACCO)        DEV.ENTRY POSITION        A45128 15250022
         SLL   VMREQUST,2              MULTIPLY WITH 4           A45128 15255022
         A     VMREQUST,0(ACCO)        FOR CORRECT UCB           A45128 15260022
*                                                                       15280000
         CLC   TIOTUCB(2,IT),TIOTUCB(VMREQUST)                          15300000
*                                                                       15320000
         BE    EQUCB                    IF EQUAL GO TO "EQUCB" TO MOVE  15340000
*                                            TABLE UP                   15360000
*                                       IF NOT EQUAL PROCEED WITH       15380000
*                                            SEARCH                     15400000
*                                                                       15420000
*                                                                       15440000
*                                  PROCESS                              15460000
         LA    ACCO,4(ACCO)             INCREMENT DDNAME POINTER        15480000
*                                                                       15500000
*                                                                       15520000
*                                  DECISION                             15540000
         BCT   INLOOP,LOOPIN            WAS THIS LAST COMPARE OF        15560000
*                                            INNER LOOP                 15580000
*                                       YES, LOOP TO LOOPIN TO CONTINUE 15600000
*                                            SEARCH                     15620000
*                                       NO.PROCEED TO TEST OUTER LOOP   15640000
X1       DS    0H                  PROCESS                              15660000
         LA    ACCE,4(ACCE)             INCREMENT DDNAME POINTER        15680000
*                                                                       15700000
*                                                                       15720000
*                                  DECISION                             15740000
         BCT   LOOP,LOOPOUT             LAST OUTER LOOP COMPARED        15760000
*                                                                       15780000
*                                       NO, BRANCH TO "LOOPOUT" TO      15800000
*                                            CONTINUE SEARCH            15820000
*                                                                       15826019
*********************************************************************** 15832019
*                                                                     * 15838019
*                        BUILD THE DEVICE MASK                        * 15844019
*                        IN THE INTERNAL TABLE                        * 15850019
*                                                                     * 15856019
*********************************************************************** 15862019
*                                                                       15868019
JUMPOUT  DS    0H             REGISTER USAGE FOR SETTING UP MASK-       15874019
*                                       ACCE IS MASK REG                15880000
*                                       LOOP IS UCB POINTER             15900000
*                                       INLOOP IS COUNT REG             15920000
*                                       LINK CONTAINS A ONE             15940000
*                                       ACCO IS MASK POINTER            15960000
         SR    R0,R0                                                    15980000
         L     IT,PTRINTAB                                              16000000
         SR    ACCE,ACCE                                                16020000
         LA    INLOOP,32                                                16040000
         LA    LINK,1                                                   16060000
         SR    ACCO,ACCO               ZERO WORK REG           @ZM30153 16080003
         ICM   ACCO,3,2(IT)            GET UCB ADDR            @ZM30153 16090003
         L     LOOP,COMTAB              GO TO LOC 16                    16100000
         L     LOOP,IUCB(LOOP)          GET POINTER TO UCB TABLE        16120000
TESTUCBS TM    OFFSET0(LOOP),HEXFF                                      16130019
         BNO   SHIFT                                                    16140019
         TM    OFFSET1(LOOP),HEXFF      HAVE FOUND X'FFFF' AT END       16150019
*                                        OF UCB LUT?                    16160019
         BO    ENDMASK                  IF SO, STOP CHECKING ENTRIES    16170019
SHIFT    DS    0H                                                       16180019
         SLL   ACCE,ONEBIT              SHIFT DEVICE MASK REGISTER      16190019
         CLC   OFFSET0(TWOBYTES,LOOP),Z TEST THE UCB POINTER            16200019
         BE    NOTEUCB                  IF ZERO, DON'T LOOK FOR MATCH   16210019
*                                                                       16300000
*                                                                       16320000
         SR    WORK,WORK                GET NUMBER OF TABLE ENTRIES     16340000
         IC    WORK,CNTINTAB                                            16360000
      LTR   WORK,WORK            ARE THERE ANY DD  CARDS                16380000
     BZ    NOTEUCB           NO  OMIT   TEST                            16400000
         L     IT,PTRINTAB              POINTER TO INTERNAL TABLE       16420000
COMHERE  DS    0H                                                A45128 16425022
         TM    4(IT),X'FF'             UCB FOUND BEFORE          A45128 16430022
         BO    ANYMORE                 YES  CONTINUE             A45128 16435022
         SR    WORK2,WORK2             NO  COMPARE               A45128 16440022
         IC    WORK2,4(IT)             DEV.ENTRY POSITION        A45128 16441022
         SLL   WORK2,2                 MULTIPLY WITH 4           A45128 16441222
         A     WORK2,4(IT)             CORRECT UCB ADDRESS       A45128 16441422
         SR    WORK3,WORK3             ZERO WORK REG           @ZM30153 16442403
         ICM   WORK3,3,TIOTUCB(WORK2)   GET UCB ADDR           @ZM30153 16442803
*        TM    2(WORK3),X'FF'           IS IT A MAIN UCB                16444003
*        BC    1,MAIN                     BRANCH ON YES                 16446003
*        SR    WORK2,WORK2                                              16448003
*        IC    WORK2,1(WORK3)           CALCULATE THE ADDRESS OF THE    16450003
*        SLL   WORK2,4                  MAIN UCB                        16452003
*        LA    WORK2,56(WORK2)                                          16454003
*        SR    WORK3,WORK2                                              16456003
*        CH    WORK3,0(LOOP)            IS THIS UCB PTR EQUAL TO THE    16458003
*                                         UCB PTR IN THE UCB LOOK UP    16460013
*                                         TABLE                         16462013
*        BE    EQUCBS                     BRANCH ON YES                 16464003
*        B ANYMORE                                             @ZM30153 16466003
MAIN     CLC   TIOTUCB(2,WORK2),0(LOOP)                                 16468013
         BE    EQUCBS                   EQUAL                           16480000
ANYMORE  LA    IT,4(IT)                                                 16500013
         BCT   WORK,COMHERE             LAST OF UCBS TO COMPARE         16520000
         B     NOTEUCB                  NO EQUAL UCBS                   16540000
EQUCBS   DS    0H                                                A45128 16541022
         OR    ACCE,LINK               TURN ON MASK BIT                 16600000
         L     WORK3,PTRINTAB                                           16620000
         AR    WORK3,R0                                                 16640000
         LA    WORK3,0(WORK3)                                           16660000
         LA    IT,0(IT)                                                 16680000
         OI    4(IT),X'FF'             THIS UCB HAS BEEN FOUND   A45128 16700022
         CR    WORK3,IT                                                 16720000
         BE    EQREG                                                    16740000
         XC    4(4,WORK3),4(IT)                                         16760000
         XC    4(4,IT),4(WORK3)                                         16780000
         XC    4(4,WORK3),4(IT)                                         16800000
EQREG    DS    0H                                                       16820000
         LR    WORK3,R0                                                 16840000
         LA    R0,4(WORK3)                                              16860000
NOTEUCB  L     IT,PTRINTAB              RELOAD IT POINTER               16880000
*                                                                       16900000
*                                                                       16920000
         BCT   INLOOP,UPUCB                                             16940000
         ST    ACCE,4(IT,ACCO)                                          16960000
         LA    ACCO,4(ACCO)                                             16980000
         SR    ACCE,ACCE                                                17000000
         LA    INLOOP,32                                                17020000
UPUCB    LA    LOOP,2(LOOP)                                             17040000
         B     TESTUCBS                                                 17060000
ENDMASK  DS    0H                                                       17080000
         LA    LINK,32                                                  17100000
         CR    LINK,INLOOP                                              17120000
   BE   SKIPST                                                          17140000
         SLL   ACCE,0(INLOOP)                                           17160000
         ST    ACCE,4(IT,ACCO)                                          17180000
SKIPST   DS    0H                                                       17200000
         LA    LINK,0                                                   17220000
         SR    WORK,WORK                                                17240000
         L     IT,PTRINTAB             GET PNTR TO INTERNAL TABLE       17260000
         IC    WORK,CNTINTAB           AND NUMBER OF TABLE ENTRIES      17280000
         LTR   WORK,WORK               CHECK FOR ZERO                   17300000
         BZ    GETOUT                                                   17320000
REPEAT   NI    4(IT),X'00'             TURN OFF UCB FOUND BIT           17340000
         LA    IT,4(IT)                GET NEXT TABLE ENTRY             17360000
         BCT   WORK,REPEAT                                              17380000
*                                                                       17382019
*********************************************************************** 17384019
*                                                                     * 17386019
*                    RETURN TO REGULAR PROCESSING                     * 17388019
*                     (INTERNAL TABLE IS BUILT)                       * 17390019
*                                                                     * 17392019
*********************************************************************** 17394019
*                                                                       17396019
GETOUT   DS    0H                                                       17400000
*                                                                       17400213
*                                                                       17400413
*                                                                       17400613
         SR    R15,R15                                                  17415413
         BR    RETURN                                                   17420000
*                                                                       17422019
*********************************************************************** 17424019
*                                                                     * 17426019
*           ERROR EXIT: ERROR WHILE BUILDING INTERNAL TABLE           * 17428019
*                                                                     * 17430019
*********************************************************************** 17432019
*                                                                       17434019
ITERROR  LA    R15,VALUE4               INDICATE ERROR CONDITION A23794 17436019
*                                       - TOO MANY POINTERS TO   A23794 17436419
*                                         2321S IN UCB LOOK-UP   A23794 17436820
*                                         TABLE (ONLY HAVE WORK  A23794 17437219
*                                         SPACE FOR 30)          A23794 17437620
         BR    RETURN                                            A23794 17438019
EQUCB    DS    0H             BRANCH POINT WHEN TWO UCB POINTERS        17440000
*                             ARE EQUAL                                 17460000
         SR    IT,IT                                                    17480000
         IC    IT,CNTINTAB                                              17500000
         S     IT,ONE                                                   17520000
         STC   IT,CNTINTAB                                              17540000
         LH    IT,LENINTAB                                              17560000
         S     IT,FOUR                                                  17580000
         STH   IT,LENINTAB                                              17600000
         LA    IT,0(ACCO)                                               17620000
         LR    VMREQUST,INLOOP                                          17640000
         BCT   VMREQUST,LPHERE                                          17660000
         B     TTOK                                                     17680000
LPHERE   DS    0H                                                       17700000
         MVC   0(4,IT),4(IT)                                            17720000
         LA    IT,4(IT)                                                 17740000
         BCT   VMREQUST,LPHERE                                          17760000
         BCT   INLOOP,TOK                                               17780000
TTOK     BCT   LOOP,X1                                                  17800000
         B     JUMPOUT                                                  17820000
TOK      BCT   LOOP,LOOPIN                                              17840000
         B     JUMPOUT                                                  17860000
*                                                                       17880000
*                                                                       17888019
*              ASSEMBLER DC,DS STATEMENTS AND DCB MACROS                17896019
*              *****************************************                17904019
*                                                                       17912019
*                                                                       17920000
Z        DC    X'000000'                                                17940000
         DC    X'00'                                                    17950013
*                                                                       17980000
ONE      DC    F'1'                                                     18000000
BLANK    DC    CL8'        '                                            18020000
SYSAB    DC    CL8'SYSABEND'                                       2711 18030014
SYSUDMP  DC    CL8'SYSUDUMP'                                       4919 18035016
STPLIB   DC    CL8'STEPLIB '                                       SL0H 18037017
JOBLIB   DC    CL8'JOBLIB  '                                     A32626 18038020
*                                                                       18040000
FOUR     DC    F'4'                                                     18060000
FOXES    DC    X'0000FFFF'             USED TO 'AND' OUT REG   @ZM30153 18062003
EIGHT    DC    F'8'                                                     18064013
TEN      DC    F'10'                                                    18068013
SIXTEEN  DC    F'16'                                                    18072013
MAXSIZE  DC    F'256'                   MAXIMUM LENGTH TO USE WITH      18073019
*                                        EXECUTE                        18074019
MAXIXC   DC    H'255'                                                   18075019
XCINSTR  XC    OFFSET0(0,WORK3),OFFSET0(WORK3)                          18076019
THIRTY2  DC    H'32'                                                    18080000
MAXCOUNT DC    H'30'                    30 2321 UCB PTRS. MAX.   A23794 18085020
*                                                                A23794 18086020
*                    15 WORD WORK SPACE FOR 2321S                A23794 18087020
*          (HOLDS MAXIMUM OF 30 POINTERS TO UCBS FOR 2321S)      A23794 18088020
*                                                                A23794 18089020
UCBPTRS  DC    30H'00'                                           A23794 18090020
ZAPAREA  DC    5F'0'                    SPACE AVAILABLE FOR             18091020
*                                        SUPERZAP FIXES                 18092020
DMTAREA  DS    5F                                                       18100000
SAVER0   EQU   DMTAREA+8                                          M0313 18106020
SAVEREG  EQU   DMTAREA                                            M0313 18112020
DMTENTRY DS    10F                      DYNAMICALLY BUILT DMT AREA.     18120000
DMTETYNO EQU   DMTENTRY+2               NO. OF DEVICES IN BIT PATTERN   18140000
DMTETYPE EQU   DMTENTRY+4               DEVICE TYPE CODE                18160000
DMTESRTS EQU   DMTENTRY+8               BIT PATTERN                     18180000
*                                           TABLE                       18200000
*                                                                       18220000
*                                                                       18240000
         DS    0F                                                       18260000
JFCB     DC    44X'04'                                                  18280000
         DC    8C' '                                                    18300000
         DC    12XL10'00'                                               18320000
OPENJDCB DCB   DSORG=PS,MACRF=R,EXLST=VOLMLIST                          18340000
         DS    0F                                                       18360000
VOLMLIST DC    X'87'                                                    18380000
         DC    AL3(JFCB)                                                18400000
SAVE18F  DS    18F                                                M0313 18410020
         DCBD  DSORG=PS                                                 18420000
*                                                                       18422019
*                                                                       18424019
*                           DUMMY SECTIONS                              18426019
*                           **************                              18428019
*                                                                       18430019
*                                                                       18432019
CVT      DSECT                                                          18440000
         CVT                                                            18460000
UCB      DSECT                                                          18480000
         IEFUCBOB                                                       18500000
         END                                                            18520000
./  ADD  SSI=72650033,NAME=IEHMVSSS
*TITLE 'IEHMVSSS'                                                       00020000
*FUNCTION/OPERATION: THIS ROUTINE HANDLES THE ANALYSIS OF INPUT         00040000
*CONTROL CARDS.  IT RECEIVES PARAMETERS FROM IEHMVLSU ONE AT A          00060000
*TIME AND SETS SWITCHES AND BUILDS TABLES ACCORDINGLY IN THE            00080000
*PERMANENT WORK AREA                                                    00100002
*ENTRY POINTS: IEHMVESS                                                 00120000
*INPUT: PERMANENT WORK AREA, IEHMVV                                     00140002
*OUTPUT: PERMANENT WORK AREA, IEHMVV                                    00160002
*EXTERNAL ROUTINES: IEHMVLSU,IEHMVSSA                                   00180000
*EXITS - NORMAL TO IEHMVSST                                             00200000
*        ERROR TO IEHMVSSA                                              00220000
*TABLES/WORK AREAS: IEHMVV                                              00240000
*AA                                                                     00260000
*ATTRIBUTES: SERIALLY RE-USEABLE                                        00280000
*NOTES: SEE BELOW FOR SWITCH DESCRIPTION                                00300000
*                                                                       00320000
*                                                                       00340000
*                                                                       00360000
*BYTES USED AS                                                          00380000
*SWITCHES                A ONE EQUALS ON                                00400000
*                                                                       00420000
*LABEL OF SWITCH    DBLOOKFO   INDICATES WHAT PARAM CARD SCANNER        00440000
*                              IS LOOKING FOR.                          00460000
*                                                                       00480000
*               BIT POS 8      KEYWORD DDNAME                           00500000
*                       4      ANY KEYWORD                              00520000
*                       2      A TYPE CODE                              00540000
*                       1      A VOL ID                                 00560000
*                       8      SEQ NUMBER                               00580000
*                       4      A DATA SET NAME                          00600000
*                       2      A MEMBER NAME                            00620000
*                       1      EXPAND DATA                              00640000
*                 ALL BITS OF  COMMAND                                  00660000
*                                                                       00680000
*                                                                       00700000
*                   DBLOOKFO+1                                          00720000
*                                                                       00740000
*                                                                       00760000
*               BIT POS 8     I,E,R FILL  FILLING INCLUDE,EXCLUDE       00780000
*                             REPLACE BLOCK IN PERM WORK AREA           00800000
*                       4     ON WHEN PROCESSING INC EXC OR REP OR SEL  00820000
*                             CARDS                                     00840000
*                       2     COMPLEX  MORE THAN ONE TYPE-VOLID-SEQNO   00860000
*                             IN TO OR FROM LIST.                       00880000
*                       1     INCLUDE BLOCK WRITE OUT SW  ON WHEN BLOCK 00900000
*                             HAS BEEN WRITTEN ON WORK FILE  UT1        00920000
*                       8     EXCLUDE BLOCK WRITE OUT  ON WHEN BLOCK    00940000
*                             HAS BEEN WRITTEN ON UT2                   00960000
*                       4     INCLUDE CARD ENCOUNTERED                  00980000
*                       2     EXCLUDE ENCOUNTERED                       01000000
*                       1     SELECT  CARD ENCOUNTERED                  01020000
*                                                                       01040000
*                                                                       01060000
*                   IEHMVV74 + 14  CHECKS THE CONTENTS                  01080019
*                   OF INCLUDE BLOCK                                    01100000
*                                                                       01120000
*               BIT POS 8     DSNAME                                    01140000
*                       4     FROM  (TYPE-VOLID-SEQNO)                  01160000
*                       2     CVOL  (TYPE-VOLID-SEQNO)                  01180000
*                       1     MEMBER NAME                               01200000
*                       8     UNUSED                                    01220000
*                       4     UNUSED                                    01240000
*                       2     UNUSED                                    01260000
*                       1     UNUSED                                    01280000
*                                                                       01300000
*                                                                       01320000
*                        XSWITCHS                                       01340000
*                                                                       01360000
*               BIT  POS 8     SELECT CARD HAS BEEN OR IS BEING         01380000
*                             PROCESSED                                 01400000
*                       4     COMPLEX MEMBER  (MEMBER NAME LIST)        01420000
*                                                                       01440000
*                       2     MEMBER RENAME                             01460000
*                       1     UNUSED                                    01480000
*                       8     UNUSED                                    01500000
*                       4     UNUSED                                    01520000
*                       2     UNUSED                                    01540000
*                       1     UNUSED                                    01560000
*                                                                       01580000
*                                                                       01600000
*                        SWITCHRD       SET BY CARD SCANNER RTN         01620000
*                                                                       01640000
*               BIT  POS 8     SCAN ERROR     SYNTAX ERROR              01660000
*                                                                       01680000
*                       4     BYPASS   IF ON-NEXT ENTRY TO SCAN WILL    01700000
*                             RETURN OPERATOR FLD OF NEXT CARD          01720000
*                       2     END OF FILL ON SYSIN                      01740000
*                       1     SCAN RTN FIRST TIME IN                    01760000
*                                                                       01780000
*                       8     OPERATOR                                  01800000
*                                                                       01820000
*                       4     KEYWORD                                   01840000
*                                                                       01860000
*                       2     PARAMETER                                 01880000
*                                                                       01900000
*                       1     RIGHT PARENTHESIS                         01920000
*                                                                       01940000
*                                                                       01960000
*NOTE    ABOVE SWITCHES EXCEPT SWITCHRD ARE RESET TO ZEROS BEFORE       01980000
*        PROCESSING EACH IEHMOVE REQUEST                                02000000
*                                                                       02020000
*        SWITCHRD IS RESET TO ZEROS PRIOR TO GOING TO CARD SCANNER      02040000
*        FOR FIRST TIME ONLY                                            02060000
*                                                                       02080000
*                                                                       02100000
*                                                                       02120000
*                                                                       02140000
*                                                                       02160000
*                                                                       02180000
IEHMVSSS CSECT                                                          02200000
*A189224-189242,189260                       @XA19624-@YA19299-@ZA26187 02200199
*C189218,189248                              @XA19624-@YA19299-@ZA26187 02200299
*A070475-070478                                                @ZA24330 02201099
*A070557-070575                                                @ZA18348 02201199
*D070503,070521,070539,070557                                  @ZA18348 02201200
*               SU32 DELETIONS                                 @G32DSFS 02201300
*A066060,125900-126300,222900                                  @G32DSFS 02201400
*                                                              @G32DSFS 02201500
*A189213-189215,189217                       @XA15455-@YA14038-@ZA13783 02201600
*C189208-189212,189216,189219                @XA15455-@YA14038-@ZA13783 02201700
*A189204-189253,223540                                         @ZA11956 02201808
*A070404-070480,223460-223520                                  @ZA10933 02202808
*C023000                                                       @ZA10933 02205708
*A189220-189360                                                @ZA07336 02206408
*C169030                                                       @ZM30153 02207408
*A169034,202700,202720                                         @ZM30153 02210208
*A42300-42320,50900,59600-59700,90900-90940,114900-114999       YL026VC 02212008
*A223140-223160,234700-234780                                   YL026VC 02213008
*C26300,47800,60100,66080,91300-93200,115066-115133,115900      YL026VC 02214808
*C116400,116900,117400,117900-1183600,234880-2355330            YL026VC 02215808
*D35400-35600,52600,59800,60600-60800,94200-107920,115600       YL026VC 02217608
*D116000-116320,116600,117000-117200,117600,235600-129400       YL026VC 02220408
*C59700-60100,91400-93200,131400,139800,235300-235320            Y02918 02221408
*D90900-90940,140200-140400                                      Y02918 02223208
*A91320-91340,214900                                             Y02918 02224208
*A107860-107920,116260-116320                                   YA01196 02226008
*C047800,A066000,066200,222800                                   A37919 02228808
* 032800.033000                                                  A32046 02229808
* 161100,168800                                                    I276 02231608
* 010800,037200,039600,095800,106900,118000,1330000,137200,      A27307 02234408
* 142000,149400                                                  A27307 02235408
*3195                                                              7474 02242008
* 072200,084000,101600,144800,161200                             A21900 02243008
*  PRINT ERROR MESSAGE IF HAVE A COMMA INSTEAD OF AN EQUAL SIGN  A21900 02245008
*  AFTER MEMBER,FROMDD,TODD,PDS,EXPAND OR DEVICE KEYWORD         A21900 02246008
*3236169200,173400,179000,190400                                   DTOI 02248008
*A035700-035720,060900-060920,070500-070560                    @Z40CSJH 02249008
*A093700,094500-094520,107900-107920,116200-116400             @Z40CSJH 02250008
*A127500-127600,139700-139800,240100,131500-131688             @Z40CSJH 02251008
*C235466,091600,140000,131400                                  @Z40CSJH 02252008
*D091320-091340,234700-235026,235100-235399                    @Z40CSJH 02253008
         ENTRY IEHMVESS                                                 02254008
         USING IEHMVV,12                                                02255008
         USING IEHMVESS,DBBASE                                          02260000
         USING IEHMVESS+4096,DBBASE1                                    02280000
IEHMVESS SAVE (14,12),T,IEHMVSSS-OZ26187                       @ZA26187 02300099
         LR    DBBASE,15                 *                              02320000
         LA    DBBASE1,2048(DBBASE)        *****************            02340000
         LA    DBBASE1,2048(DBBASE1)          ***************           02360000
      IEHPRE   (14,1),TFC                                               02380000
       IEHMVV                                                           02400000
IEHMVSSS CSECT                                                          02420000
         SR    R1,R1                                                    02440000
         IC    R1,ESSENTRY             INSERT REENTRY BYTE              02460000
         EX    0,BRANCH(R1)            EXEC BRANCH BASED UPON VALUE     02480000
*                                      OF REENTRY BYTE                  02500000
BRANCH   B     DBTOSCA3                                                 02520000
         B     ERRPRNT1                                                 02540000
         B     DBSKIP4                                                  02560000
         B     DBSKIP2                                                  02580000
         B     DBMV3                                                    02600000
         B     DBCP3                                                    02620000
         B     DBTOSCAN                RETURN FROM CVOL MESSAGE YL026VC 02630002
DBTOSCAN DS    0H                                                       02640000
         TM    SWITCHRD,BYPASS         IS SCAN BYPASS SW ON             02660000
         BZ    DBTOSCA1                                                 02680000
         TM    DBLOOKFO+1,IERSW        TEST FOR E.E.R. BIT ON           02700000
         BO    DBTEST5                                                  02720000
         TM    DBCOMSW,X'3E'           IS SUB OPERATION BIT ON          02740000
         BZ    DBERR11                                                  02760000
         TM    DBCOMSW+1,TO             IS TO BIT ON                    02780000
         BZ    DBERR11                                                  02800000
         B     DBTEST5                                                  02820000
DBTOSCA1 DS    0H                                                       02840000
         MVI   ESSENTRY,X'00'          RESET RENTRY SW                  02860000
       IEHPOST (14),T                                                   02880000
         XCTL  EP=IEHMVESJ                                              02900000
DBTOSCA3 DS    0H                                                       02920000
         LM    R1,R2,IEHMVV90+136      LOAD SCAN REG POINTERS           02940000
         TM    DBFAADD,X'80'           HAS ERROR MESSAGE BEEN SAVED     02960000
         BO    ERRPRNT                 BRANCH IF YES                    02980000
DBTOSCA2 DS    0H                                                       03000000
          TM    SWITCHRD,SYSINEOF  END OF FILE ON SYSIN          A32046 03006020
          BO    DBEOFRTN           *B IF YES                     A32046 03012020
         TM    SWITCHRD,ERRSCAN        IS SCAN ERROR SWITCH ON          03020000
         BZ    DBTEST2                   BRANCH IF OFF                  03040000
         B     DBERR9                    SCAN ERROR MSG                 03060000
ERRPRNT  NI    DBFAADD,X'00'           RESET SAVED ERR MSG SW           03080000
         SR    R3,R3                                                    03100000
         IC    R3,IEHMVV00+130         SAVED MESSAGE NUMBER             03120000
         MVI   ESSENTRY,X'04'          SET RENTRY TO ERRPRNT1           03140000
         LA    R2,8                    CAUSE RETURN TO SSS              03160000
         B     ESAEXIT                                                  03180000
ERRPRNT1 DS    0H                                                       03200000
         MVI   ESSENTRY,X'00'          RESET REENTRY SW                 03220000
         LM    1,2,IEHMVV90+136                                         03240000
         B     DBTOSCA2                                                 03260000
DBTEST2   EQU   *                                                A32046 03280020
         BO    DBEOFRTN                  BRANCH TO EOF RTN IF YES       03300000
         TM    SWITCHRD,BYPASS         IS SCAN BYPASS SWITCH ON         03320000
         BZ    DBTEST3                   BRANCH IF OFF                  03340000
         LTR   DBLENGTH,DBLENGTH         SCAN LENGTH ZERO ?             03360000
         BNE   DBTEST3                   BRANCH IF NO                   03380000
         LTR   DBSCANAD,DBSCANAD         SCAN ADDRESS ZERO ?            03400000
         BNE   DBTEST3                   BRANCH IF NO                   03420000
DBTEST5  TM    DBLOOKFO,ANYKEY         LOOKING FOR A KEYWORD            03440000
         BO    DBSKIP1                                                  03460000
         B     DBERR9                    SCAN ERROR MSG                 03480000
DBSKIP1  TM    DBLOOKFO+1,IERSW        INC,EXC,OR REP SWITCH ON         03500000
         BZ    DBSKIP3                                                  03520000
         TM    DBCOMSW,CATLOG          TEST CATALOG BIT        @Z40CSJH 03540008
         BO    DBSKIP4                                         @Z40CSJH 03560008
         TM    DBCOMSW,DSGROUP         TEST FOR DSGROUP BIT             03580000
         BZ    DBSKIP5                                                  03600000
         L     DBNXRPTR,DBIERPTR                                        03620000
         CLI   0(DBNXRPTR),C'I'                                         03640000
         BNE   DBSKIP4                                                  03660000
DBSKIP5  DS    0H                                                       03680000
         L     DBNXRPTR,DBNXTPTR         STORE INTO THE REQ BLOCK       03700000
         LA    DBNXRPTR,78(0,DBNXRPTR)  INCREMENT TO NEXT IERBLK A27307 03720019
         ST    DBNXRPTR,DBNXTPTR         AVAILABLE  ADDRESS IN THE      03740000
         L     DBNXRPTR,DBIERPTR         BLOCK  & ADD ONE TO THE        03760000
         A     DBNXRPTR,DBCTONE          COUNT OF INC,EXC,REP REQ'S     03780000
         ST    DBNXRPTR,DBIERPTR                                        03800000
         SRL   DBNXRPTR,24                                              03820000
         CH    DBNXRPTR,HONE                                            03840000
         BE    FROMTEST                                                 03860000
         B     DBSKIP2                                                  03880000
FROMTEST TM    DBCOMSW,DSGORPDS        TEST FOR DSGROUP OR PDS BIT      03900000
         BZ    WRITEUT1                 BRANCH EITHER                   03920000
         L     DBNXRPTR,DBIERPTR                                        03940000
         TM    IEHMVV74+14,X'40'       IS IER FROM SWITCH ON     A27307 03960019
         BO    WRITEUT1                                                 03980000
         B     FINDFROM                                                 04000000
DBSKIP2  TM    XSWITCHS,COMPLEXM       IS COMPLEX MEMBER SWITCH ON      04020000
         BZ    DBSKIP4                                                  04040000
        B     DBMEMRTN                                                  04060000
DBSKIP3  TM    DBCOMSW,DSNORPDS        TEST FOR DSNAME OR PDS BIT       04080000
         BZ    DBSKIP4                                                  04100000
         TM    DBCOMSW,FROM            IS FROM BIT ON                   04120000
         BZ    FINDFROM                                                 04140000
DBSKIP4  MVI   DBLOOKFO,OPERATOR       NOW LOOKING FOR AN OPERATOR      04160000
         B     DBTOSCA1                                                 04180000
DBTEST3  TM    DBLOOKFO,TYPCODE        LOOKING FOR A TYPE               04200000
         BO    DBDEVLUP                  GO TO DEVICE LOOKUP RTN        04220000
         TM    DBLOOKFO,OPERATR        LOOKING FOR AN OPERATOR          04240000
         BZ    DBOPLUP                   GO TO OPERATOR LOOKUP RTN      04260000
         TM    DBLOOKFO,ANYKEY         LOOKING FOR A KEYWORD            04280000
         BO    DBKEYLUP                  GO TO KEWORD LOOKUP RTN        04300000
         TM    DBLOOKFO,VOLID          LOOKING FOR A VOLUME ID          04320000
         BO    DBVIDRTN                  GO TO VOL.ID RTN               04340000
         TM    DBLOOKFO,KEYDDN         LOOKING FOR A DDNAME             04360000
         BO    DDNAMRTN                                                 04380000
         TM    DBLOOKFO,SEQNUMB        LOOKING FOR A SEQUENCE NUMBER    04400000
         BO    DBSEQRTN                  GO TO SEQ. NO. RTN             04420000
         TM    DBLOOKFO,DSNAME         LOOKING FOR A DATA SET NAME      04440000
         BO    DBNAMRTN                  GO TO NAME AND NODE RTN        04460000
         TM    DBLOOKFO,MEMNAME        LOOKING FOR A MEMBER NAME        04480000
         BO    DBMNMRTN                  GO TO MEMBER NAME RTN          04500000
         TM    DBLOOKFO,EXPDAT         LOOKING FOR EXPAND PARAM         04520000
         BO    EXPDATA                                                  04540000
         B     DBERR9                    SCAN ERROR MSG                 04560000
*********************************************************************** 04580000
**                                                                   ** 04600000
**            K E Y W O R D   L O O K U P   R O U T I N E            ** 04620000
**                                                                   ** 04640000
*********************************************************************** 04660000
DBKEYLUP STC   DBLENGTH,DBBYTE           SCAN LENGTH > EIGHT            04680000
         CLI   DBBYTE,8                                                 04700000
         BH    DBERR8                    LENGTH ERROR MSG               04720000
         LTR   DBLENGTH,DBLENGTH                                 A30933 04726020
         BZ    DBERR9              SIGNAL SYNTAX ERROR           A30933 04732020
         LA    DBR1,DBKWDTAB             SET UP CONTROL LOOP            04740000
         LA    DBR3,12                                                  04760000
         LA    DBCOMPR,DBKWDEND-12       TABLE LENGTH - UNIT    YL026VC 04780002
         MVI   DBSARG,X'40'                                             04800000
         MVC   DBSARG+1(7),DBSARG                                       04820000
         BCTR  DBLENGTH,0                                               04840000
         EX    DBLENGTH,DBKEY4           MOVE  SCAN KEYWD TO DBSARG     04860000
DBKEY3   CLC   DBSARG(8),0(DBR1)         LOOK UP IN TABLE               04880000
         BNE   DBKEY2                    FIND ?                         04900000
         LA    DBR1,8(0,DBR1)            SET UP TO BRANCH               04920000
         EX    0,0(DBR1,0)               EXECUTE BRANCH IN TABLE        04940000
DBKEY2   BXLE  DBR1,DBR3,DBKEY3          LOOP BACK TO DBKEY3            04960000
         B     DBERR7                    INVALID KWD MSG                04980000
DBKEY4   MVC   DBSARG(0),0(DBSCANAD)                                    05000000
*********************************************************************** 05020000
**                                                                   ** 05040000
**           O P E R A T O R   L O O K U P   R O U T I N E           ** 05060000
**                                                                   ** 05080000
*********************************************************************** 05090002
DBOPLUP  STC   DBLENGTH,DBBYTE           LENGTH > EIGHT ?               05100000
         CLI   DBBYTE,8                                                 05120000
         BNH   DBOPL1                                                   05140000
         B     DBERR8                    WRONG LENGTH MSG               05160000
DBOPL1   LA    DBR1,DBOPTAB              SET UP CONTROL LOOP            05180000
         LA    DBR3,12                                                  05200000
         LA    DBCOMPR,DBOPTAB+60                                       05220000
         MVI   DBSARG,BLANK            CLEAR AREA                       05240000
         MVC   DBSARG+1(7),DBSARG                                       05280000
         BCTR  DBLENGTH,0                                               05300000
         EX    DBLENGTH,DBOPLOP3         MOVE SCAN OPERATOR TO          05320000
DBOPCMP2 CLC   DBSARG(8),0(DBR1)         DBSARG                         05340000
         BNE   DBOPLOP2                  FIND ?                         05360000
         LA    DBR1,8(0,DBR1)            SET UP BRANCH IF YES           05380000
         EX    0,0(DBR1,0)               EXECUTE BRANCH IN TABLE        05400000
DBOPLOP2 BXLE  DBR1,DBR3,DBOPCMP2        LOOP TO CONTINUE LOOKING       05420000
         B     DBERR8                    INVALID OPERATOR MSG           05440000
DBOPLOP3 MVC   DBSARG(0),0(DBSCANAD)                                    05460000
*********************************************************************** 05480000
**                                                                   ** 05500000
**                   O P E R A T O R   T A B L E                     ** 05520000
**                                                                   ** 05540000
*********************************************************************** 05560000
         DS    0F                                                       05580000
DBOPTAB  DC    C'MOVE    '                                              05600000
         B     DBMVRTN                                                  05620000
         DC    C'COPY    '                                              05640000
         B     DBCPRTN                                                  05660000
         DC    C'INCLUDE '                                              05680000
         B     DBINCRTN                                                 05700000
         DC    C'EXCLUDE '                                              05720000
         B     DBEXCRTN                                                 05740000
         DC    C'REPLACE '                                              05760000
         B     DBREPRTN                                                 05780000
         DC    C'SELECT  '                                              05800000
         B     DBSELRTN                                                 05820000
*********************************************************************** 05840000
**                                                                   ** 05860000
**                    K E Y W O R D   T A B L E                      ** 05880000
**                                                                   ** 05900000
*********************************************************************** 05920000
DBKWDTAB DC    C'DSNAME  '                                              05940000
         B     DBDSNRTN                                                 05960002
         DC    C'DSGROUP '                                       Y02918 05970002
         B     DBDSGRTN                                          Y02918 06010002
         DC    C'PDS     '                                              06020000
         B     DBPDSRTN                                                 06040000
         DC    C'CATALOG '                                     @Z40CSJH 06060008
         B     DBCATRTN                                        @Z40CSJH 06080008
         DC    C'VOLUME  '                                              06100000
         B     DBVOLRTN                                                 06120000
         DC    C'FROM    '                                              06140000
         B     DBFRORTN                                                 06160000
         DC    C'TO      '                                              06180000
         B     DBTORTN                                                  06200000
         DC    C'CVOL    '                                              06220000
         B     DBCVORTN                                                 06240000
         DC    C'CATLG   '                                              06260000
         B     DBCLGRTN                                                 06280000
         DC    C'UNCATLG '                                              06300000
         B     DBUNCRTN                                                 06320000
         DC    C'EXPAND  '                                              06340000
         B     DBEXPRTN                                                 06360000
         DC    C'PASSWORD'                                              06380000
         B     DBSECRTN                                                 06400000
         DC    C'MEMBER  '                                              06420000
         B     DBMEMRTN                                                 06440000
         DC    CL8'RENAME'                                              06460000
         B     DBRENAME                                                 06480000
         DC    CL8'DUMP'                                                06500000
         B     DUMPRTN                                                  06520000
         DC    CL8'FROMDD'                                              06540000
         B     FROMDD                                                   06560000
         DC    CL8'TODD'                                                06580000
         B     TODD                                                     06600000
         DC    CL8'UNLOAD'                                       A37919 06603021
         B     UNLRTN                                            A37919 06606021
         DC    CL8'COPYAUTH'           RACF 2 KEYWORD          @G32DSFS 06606632
         B     DBATHRTN                BR TO KEYWORD RTN       @G32DSFS 06607332
DBKWDEND DS    0H                      END OF KEYWORD TABLE     YL026VC 06608002
UNLRTN   DS    0H                                                A37919 06609021
         OI    DBCOMSW+5,UNLOAD  USERS UNLOAD REQUEST            A37919 06612021
         B     CONTINUE                USER'S UNLOAD REQUEST     A37919 06615021
DUMPRTN  OI    DBCOMSW+3,DUMP          TURN ON DUMP SWITCH              06620000
CONTINUE DS    0H                                                A37919 06630021
         MVI   DBLOOKFO,ANYKEY         NOW LOOKING FOR A KEYWORD        06640000
         B     DBTOSCAN                                                 06660000
*********************************************************************** 06680000
**                                                                   ** 06700000
**             N A M E   OR   N O D E   R O U T I N E                ** 06720000
**                                                                   ** 06740000
*********************************************************************** 06760000
DBNAMRTN TM    SWITCHRD,PARAM          IS IT A PARAMETER                06780000
         BZ    DBERR6                     BRANCH IF NO                  06800000
         TM    DBLOOKFO+1,IERSW        INC,EXC,OR REP REQUIRED          06820000
         BO    DBNAM1                     BRANCH IF YES                 06840000
         LA    DBR1,44(DBNXRPTR)        UPDATE NEXT AVIL SPACE PTR      06860000
         ST    DBR1,DBNXTPTR                                            06880000
DBNAM1   MVI   0(DBNXRPTR),BLANK                                        06900000
         MVC   1(43,DBNXRPTR),0(DBNXRPTR) THE DATA SET NAME             06920000
         CH    DBLENGTH,DBFORTY4          LENGTH > FORTY FOUR           06940000
         BH    DBERR10                    LENGTH ERROR MSG              06960000
         LTR   DBLENGTH,DBLENGTH       IS LENGTH ZERO                   06980000
         BZ    DBERR10                 BRANCH IF YES                    07000000
         BCTR  DBLENGTH,0                 REDUCE LENGTH BY ONE          07020000
         EX    DBLENGTH,DBNAM2                                          07040000
         ST    DBLENGTH,SAVEREG2       SAVE REG2               @ZA10933 07040908
         ST    DBNXRPTR,SAVEREGB       SAVE REG11              @ZA10933 07041808
         SR    DBLENGTH,DBLENGTH       CLEAR REG2              @ZA10933 07042708
LOOP1    LA    DBNXRPTR,1(0,DBNXRPTR)  POINT TO NEXT CHARACTER @ZA10933 07043608
*                                       OF DSNAME              @ZA10933 07044508
         LA    DBLENGTH,1(0,DBLENGTH)  ADD ONE TO REG2         @ZA10933 07045408
         CLI   0(DBNXRPTR),X'40'       END OF DSNAME           @ZA10933 07046308
         BE    END                     YES                     @ZA10933 07047208
         CLI   0(DBNXRPTR),X'00'       END OF DSNAME           @ZA24330 07047599
         BE    END                     YES                     @ZA24330 07047799
         CLI   0(DBNXRPTR),X'4B'       CHECK FOR A PERIOD      @ZA10933 07048108
         BNE   LOOP1                   CHECK NEXT CHARACTER    @ZA10933 07049008
         CH    DBLENGTH,DBEIGHT        LENGTH > 8              @ZA10933 07049908
         BH    DBERR10                 LENGTH ERROR MSG        @ZA10933 07050300
         LA    DBNXRPTR,1(0,DBNXRPTR)  POINT TO NEXT CHARACTER @ZA10933 07050900
*                                       OF DSNAME              @ZA10933 07051500
         SR    DBLENGTH,DBLENGTH       CLEAR REG2              @ZA10933 07052100
         B     LOOP1                                           @ZA10933 07052700
END      CH    DBLENGTH,DBEIGHT        LENGTH > 8              @ZA10933 07053300
         BH    DBERR10                 LENGTH ERROR MSG        @ZA10933 07053900
         L     DBLENGTH,SAVEREG2       RELOAD REG2             @ZA10933 07054500
         L     DBNXRPTR,SAVEREGB       RELOAD REG11            @ZA10933 07055100
         TM    DBCOMSW,DSGROUP         WAS DSGROUP SPECIFIED   @ZA18348 07055700
         BZ    DBNAM1A                 NO-BRANCH               @ZA18348 07056300
         OI    DBCOMSW+5,X'20'         SET=NAME SWITCH         @ZA18348 07056900
DBNAM1A  EQU   *                       NO NAME BRANCH TO       @ZA18348 07057500
         MVI   DBLOOKFO,ANYKEY         NOW LOOKING FOR A KEYWORD        07060000
         B     DBTOSCAN                                                 07080000
DBNAM2   MVC   0(1,DBNXRPTR),0(DBSCANAD)                                07100000
*********************************************************************** 07120000
**                                                                   ** 07140000
**             M E M B E R   K E Y W O R D   R O U T I N E           ** 07160000
**                                                                   ** 07180000
*********************************************************************** 07200000
DBMEMRTN TM    SWITCHRD,PARAM          IS SCAN PARAM SWITCH ON  A21900  07210018
*                                       FOR A COMMA              A21900 07213018
         BNO   IERCHK                  IF NOT, BRANCH            A21900 07216018
         CLI   PARENCTR+1,ZERO         TEST WHETHER CHECKING     A21900 07219018
*                                       MEMBERNAMES INSIDE       A21900 07222018
*                                       PARENTHESES (CTR NOT 0)  A21900 07225018
         BE    DBERR8                  IF NOT, HAVE ERROR -      A21900 07228018
*                                       COMMA INSTEAD OF EQUAL   A21900 07231018
*                                       SIGN AFTER KEYWORD       A21900 07234018
IERCHK   TM    DBLOOKFO+1,IERSW        INC,EXC, OR REP REQUIRED  A21900 07237018
         BZ    DBERR7                     KWD NOT ALLOWED MSG           07240000
         L     DBNXRPTR,DBNXTPTR                                        07260000
         LA    DBNXRPTR,45(0,DBNXRPTR)    ADJ REG PTR TO MEMBER AREA    07280000
         MVI   DBLOOKFO,MEMNAME        NOW LOOKING FOR A MEMBER NAME    07300000
         B     DBTOSCAN                                                 07320000
DBMNMRTN CH    DBLENGTH,DBEIGHT           LENGTH > EIGHT ?              07340000
         BH    DBERR10                    LENGTH ERROR MSG              07360000
         LTR   DBLENGTH,DBLENGTH        IS LENGTH ZERO                  07380000
         BZ    DBMNM7                                                   07400000
         BCTR  DBLENGTH,0                 REDUCE LENGTH BY ONE          07420000
         TM    XSWITCHS,RENAME         IS MEMBER RENAME SWITCH ON       07440000
         BO    DBMNM5                                                   07460000
         B     DBMNM6                                                   07480000
DBMNM7   TM    XSWITCHS,COMPLEXM       IS COMPLEX MEMBER SWITCH ON      07500000
         BO    DBMNM8                   BRANCH IF YES                   07520000
         B     DBERR8                                                   07540000
DBMNM8   TM    SWITCHRD,RTPAREN        IS RIGHT PAREN BIT ON            07560000
         BO    DBMNM2                   BRANCH IF YES                   07580000
         B     DBERR8                                                   07600000
DBMNM5   NI    XSWITCHS,OFF            TURN OFF MEMBER  RENAME SWITCH   07620000
         B     DBMNM4                                                   07640000
DBMNM6   DS    0H                                                       07660000
         CLI   IEHMVV90+129,TWO         IS PAREN COUNT TWO              07680000
         BNE   DBMNM3                   BRANCH IF NO                    07700000
         OI    XSWITCHS,RENAME         TURN ON MEMBER RENAME SWITCH     07720000
DBMNM3   DS    0H                                                       07740000
         MVI   0(DBNXRPTR),BLANK                                        07760000
         MVC   1(7,DBNXRPTR),0(DBNXRPTR)  CLEAR MEMBER NAME AREA        07780000
         EX    DBLENGTH,DBMNM1            MOVE MEMBER NAME INTO LIST    07800000
DBMNM4   LA    DBNXRPTR,25(DBNXRPTR)   PIONT TO MEMBER RENAME SLOT DT0I 07820018
         MVI   0(DBNXRPTR),BLANK       CLEAR MEMBER RENAME SLOT         07840000
         MVC   1(7,DBNXRPTR),0(DBNXRPTR)                                07860000
         EX    DBLENGTH,DBMNM1          MOVE MEMBER NAME                07880000
         TM    XSWITCHS,RENAME         IS MEMBER RENAME SWITCH ON       07900000
         BO    DBMEMRTN                                                 07920000
         CLI   IEHMVV90+129,X'00'      IS PAREN COUNT ZERO              07940000
        BE    DBMNM2                   BRANCH IF YES                    07960000
         OI    XSWITCHS,COMPLEXM       TURN ON COMPLEX MEMBER SWITCH    07980000
         LA    DBSCANAD,2(DBLENGTH,DBSCANAD) CHECK FOR TWO RIGHT        08000000
         CLI   0(DBSCANAD),C')'              PARENTHISIS                08020000
         BE    DBMEMRTN                                                 08040000
        B     DBSKIP1                                                   08060000
DBMNM2   XC    XSWITCHS(1),XSWITCHS     TURN OFF SEL EXC AND MEMBER SW  08080000
         MVI   DBLOOKFO,ANYKEY         NOW LOOKING FOR KEYWORD          08100000
         B     DBTOSCAN                                                 08120000
DBMNM1   MVC   0(1,DBNXRPTR),0(DBSCANAD) EXECUTED INST                  08140000
*********************************************************************** 08160000
**                                                                   ** 08180000
**       F R O M   A N D   TO   D D N A M E   R O U T I N E S        ** 08200000
**                                                                   ** 08220000
*********************************************************************** 08240000
TODD     L     DBNXRPTR,DBNXTPTR                                        08260000
         ST    DBNXRPTR,IEHMVV28+4      STORE ADDR OF TO DDNAME         08280000
         OI    DBCOMSW+3,TODDSW        TURN ON TODD SWITCH              08300000
         B     FROMDD1                                                  08320000
FROMDD   L     DBNXRPTR,DBNXTPTR                                        08340000
         ST    DBNXRPTR,IEHMVV28        STORE ADDR OF FROM DD NAME      08360000
         OI    IEHMVV20+3,X'02'         TURN ON FROM DD SW              08380000
FROMDD1  TM    SWITCHRD,PARAM          IS SCAN PARAM SWITCH ON  A21900  08390018
         BO    DBERR8                   BRANCH IF ON            A21900  08400018
         TM    DBLOOKFO+1,IERSW        INC,EXC, OR REP REQUIRED A21900  08410018
         BO    DBERR7                   BRANCH IF YES                   08420000
         MVI   DBLOOKFO,KEYDDN         NOW LOOKING FOR A DDNAME         08440000
         B     DBTOSCAN                                                 08460000
DDNAMRTN  CH   DBLENGTH,DBEIGHT         IS LENGTH OVER 8                08480000
         BH    DBERR10                  LENGTH ERROR MSG                08500000
         LTR   DBLENGTH,DBLENGTH        IS LENGTH OVER ZERO             08520000
         BZ    DBERR8                   INVALID PARAM MSG               08540000
         BCTR  DBLENGTH,0               REDUCE LENGTH BY ONE            08560000
         MVI   0(DBNXRPTR),BLANK       CLEAR DDNAME AREA                08580000
         MVC   1(7,DBNXRPTR),0(DBNXRPTR)                                08600000
         EX    DBLENGTH,DBMNM1          MOVE DDNAME INTO LIST           08620000
         LA    DBNXRPTR,44(DBNXRPTR)    BUMP AREA POINTER               08640000
         ST    DBNXRPTR,DBNXTPTR        STORE AREA POINTER              08660000
         MVI   DBLOOKFO,ANYKEY         NOW LOOKING FOR A KEYWORD        08680000
         B     DBTOSCAN                                                 08700000
*********************************************************************** 08720000
**                                                                   ** 08740000
**             R E N A M E   K E Y W O R D   R O U T I N E           ** 08760000
**                                                                   ** 08780000
*********************************************************************** 08800000
DBRENAME TM    SWITCHRD,PARAM          IS SCAN PARAMETER SWITCH ON      08820000
         BO    DBERR8                   BRANCH IF ON                    08840000
         TM    DBLOOKFO+1,IERSW        INC,EXC,OR REP REQUIRED          08860000
         BO    DBERR7                   KWD NOT ALLOWED                 08880000
         TM    DBCOMSW+3,RENAMESW       IS RENAME SWITCH ON             08900000
         BO    DBERR5                   BRANCH IF YES                   08920000
         OI    DBCOMSW+3,RENAMESW       TURN ON RENAME SWITCH           08940000
         L     DBNXRPTR,DBNXTPTR        PUT POINTER IN REG              08960000
         ST    DBNXRPTR,IEHMVV21+4      SET UP 'TO' DSNAME POINTER      08980000
         MVI   DBLOOKFO,DSNAME         NOW LOOKING FOR A NAME           09000000
         B     DBTOSCAN                                                 09020000
*********************************************************************** 09040000
**                                                                   ** 09060000
**               D S G R O U P   R O U T I N E                       ** 09080000
**                                                                   ** 09100000
*********************************************************************** 09120000
DBDSGRTN EQU   *                                                YL026VC 09130002
         TM    DBLOOKFO+1,IERSW         INC,EXC,OR REP REQUIRED  Y02918 09140002
         BO    DBDSG1                    BRANCH IF YES         @Z40CSJH 09160008
         TM    DBCOMSW,EQUKWD            EQUIVALENT KWD ALREADY  Y02918 09180002
         BO    DBERR5                    MULT KWD MSG            Y02918 09200002
         L     DBNXRPTR,DBNXTPTR                                 Y02918 09220002
         OI    DBCOMSW,DSGROUP         TURN ON DSGROUP SWITCH    Y02918 09240002
         TM    SWITCHRD,PARAM           SCAN PARAMETER SWITCH ON Y02918 09260002
         BZ    DBDSG2                    BRANCH IF NO            Y02918 09280002
         MVI   DBLOOKFO,ANYKEY         NOW LOOKING FOR A KEYWORD Y02918 09300002
         B     DBTOSCAN                                          Y02918 09320002
DBDSG2   MVI   DBLOOKFO,DSNAME         NOW LOOKING FOR A NAME           09340000
         ST    DBNXRPTR,DBNNPTR                                         09360000
         NI    DBCOMSW+5,X'DF'         CLEAR=NAME SWITCH       @Z40CSJH 09370008
         B     DBTOSCAN                                                 09380000
DBDSG1   L     DBNXRPTR,DBNXTPTR         PUT PTR IN REG                 09400000
         TM    DBCOMSW,CATLOG          IS CATALOG BIT ON       @Z40CSJH 09420008
         BO    DBDSG3                  BRANCH YES              @Z40CSJH 09440008
         TM    DBCOMSW,DSGROUP         IS DSGROUP BIT ON                09460000
         BZ    DBDSG4                  BRANCH IF NO                     09480000
         L     DBR1,IEHMVV26           LOAD PTR TO IER BLOCK            09500000
         CLI   0(DBR1),C'I'            IS IT AN INCLUDE BLOCK           09520000
         BNE   DBDSG3                  BRANCH IF NO                     09540000
DBDSG4   DS    0H                                                       09560000
         OI    IEHMVV74+14,X'80'       DSNAME BIT ON IN IER SW   A27307 09580019
         LA    DBNXRPTR,1(0,DBNXRPTR)    ADJ PTR IN REG TO NAME AREA    09600000
         MVI   DBLOOKFO,DSNAME         NOW LOOKING FOR A NAME           09620000
         B     DBTOSCAN                                                 09640000
DBDSG3   LA    DBR1,44(DBNXRPTR)       BUMP PERM WORK AREA PTR          09660000
         ST    DBR1,DBNXTPTR                                            09680000
         ST    DBNXRPTR,IEHMVV21+4     STORE TO DSNAME PTR              09700000
         MVI   DBLOOKFO,DSNAME         NOW LOOKING FOR A NAME           09720000
         B     DBTOSCAN                                                 09740000
*********************************************************************** 09760000
**                                                                   ** 09780000
**         D S N A M E   K E Y W O R D   R O U T I N E               ** 09800000
**                                                                   ** 09820000
*********************************************************************** 09840000
DBDSNRTN TM    SWITCHRD,PARAM          IS SCAN PARAMETER SWITCH ON      09860000
         BO    DBERR8                                                   09880000
         TM    DBLOOKFO+1,IERSW        IS INC,EXC,OR REP REQUIRED       09900000
         BO    DBDSG1                                                   09920000
         TM    DBCOMSW,EQUKWD           IS EQUIVALENT KWD ALREADY IN    09940000
         BO    DBERR5                    MULTIPLE KWD MSG               09960000
         L     DBNXRPTR,DBNXTPTR                                        09980000
         MVC   DBNNPTR(4),DBNXTPTR       NEXT AVAIL. ADDR. TO DBNNPTR   10000000
         OI    DBCOMSW,DSNSW           TURN ON DSNAME SWITCH IN COMSW   10020000
         B     DBDSG2                                                   10040000
*********************************************************************** 10060000
**                                                                   ** 10080000
**              P D S   K E Y W O R D   R O U T I N E                ** 10100000
**                                                                   ** 10120000
*********************************************************************** 10140000
DBPDSRTN TM    SWITCHRD,PARAM          IS SCAN PARAM SWITCH ON  A21900  10150018
         BO    DBERR8                   BRANCH IF ON            A21900  10160018
         TM    DBLOOKFO+1,IERSW        INC,EXC, OR REP REQUIRED A21900  10170018
         BO    DBDSG1                                                   10180000
         TM    DBCOMSW,EQUKWD           IS EQUIVALENT KWD ALREADY IN    10200000
         BO    DBERR5                    MULTABLE KWD MSG               10220000
         OI    DBCOMSW,PDS             TURN ON PDS KEYWORD SWITCH       10240000
         L     DBNXRPTR,DBNXTPTR                                        10260000
         MVC   DBNNPTR(4),DBNXTPTR       SET UP NODE/NAME PTR           10280000
         B     DBDSG2                                                   10300000
*********************************************************************** 10320000
**                                                                   ** 10340000
**         V O L U M E   K E Y W O R D   R O U T I N E               ** 10360000
**                                                                   ** 10380000
*********************************************************************** 10400000
DBVOLRTN TM    SWITCHRD,PARAM          IS PARAMETER SWITCH ON ?         10420000
         BO    DBERR8                    INVALID PARAM MSG              10440000
         TM    DBLOOKFO+1,IERSW        INC,EXC,OR REP REQUIRED ?        10460000
         BO    DBERR7                    KWD NOT ALLOWED                10480000
         TM    DBCOMSW,EQUKWD     KEYWORD ALREADY IN               7474 10486017
         BM    DBERR5             MULTIPLE KEYWORD ERROR           7474 10492017
         TM    DBCOMSW,X'03'             EQUIVALENT KWD ALREADY IN ?    10500000
         BO    DBERR5                    MULT KED MSG                   10520000
         OI    DBCOMSW,X'03'             TURN ON VOLUME SW              10540000
         B     DBFRO4                                                   10560000
*********************************************************************** 10580000
**                                                                   ** 10600000
**             F R O M   K E Y W O R D   R O U T I N E               ** 10620000
**                                                                   ** 10640000
*********************************************************************** 10660000
DBFRORTN TM    SWITCHRD,PARAM          IS PARAMETER SWITCH ON ?         10680000
         BO    DBERR8                    INVALID PARAM MSG              10700000
         TM    DBLOOKFO+1,IERSW        INC,EXC,OR REP REQUIRED ?        10720000
         BO    DBFRO1                    BRANCH IF YES                  10740000
         TM    DBCOMSW,X'03'             EQUIVALENT KWD ALREADY IN ?    10760000
         BO    DBERR5                    MULT KWD MSG                   10780000
         TM    DBCOMSW+1,CVOL          TEST FOR 'CVOL' USED    @Z40CSJH 10786008
         BO    DBERR5                    EXCLUDES USE OF 'FROM'@Z40CSJH 10792008
         OI    DBCOMSW,FROM            TURN ON FROM SWITCH              10800000
DBFRO4   MVI   DBLOOKFO,TYPCODE         NOW LOOKING FOR A TYPE          10820000
         L     DBNXRPTR,DBNXTPTR        LOAD NEXT AVILIBLE POINTER      10840000
         LA    DBNXRPTR,2(DBNXRPTR)     BUMP IT 2 FOR LATER SCRATCHING  10860000
         ST    DBNXRPTR,DBNXTPTR                                        10880000
         ST    DBNXRPTR,DBFLPTR         SET UP FROM L-ST PTR            10900000
         B     DBTOSCAN                                                 10920000
DBFRO1   L     DBNXRPTR,DBNXTPTR         PUT PTR IN REG                 10940000
         OI    IEHMVV74+14,X'40'       TURN ON IER FROM SW       A27307 10960019
IERVOL   LA    DBNXRPTR,53(0,DBNXRPTR)     ADJUST POINTER TO FROM AREA  10980000
         MVI   DBLOOKFO,TYPCODE        NOW LOOKING FOR A TYPE           11000000
         B     DBTOSCAN                                                 11020000
*********************************************************************** 11040000
**                                                                   ** 11060000
**               T O   K E Y W O R D   R O U T I N E                 ** 11080000
**                                                                   ** 11100000
*********************************************************************** 11120000
DBTORTN  TM    SWITCHRD,PARAM          IS SCAN PARAMETER SWITCH ON      11140000
         BO    DBERR8                    INVALID PARAMETER MSG          11160000
         TM    DBLOOKFO+1,IERSW        INC,EXC,OR REP REQUIRED          11180000
         BO    DBERR7                    KWD NOT ALLOWED MSG            11200000
         TM    DBCOMSW+1,TO            CHECK IF KEYWORD IS ALREADY IN   11220000
         BO    DBERR5                    MULTABLE KWD MSG               11240000
         OI    DBCOMSW+1,TO            TURN ON TO KEYWORD SWITCH        11260000
         MVI   DBLOOKFO,TYPCODE        NOW LOOKING FOR A TYPE           11280000
         L     DBNXRPTR,DBNXTPTR        LOAD NEXT AVILIBLE POINTER      11300000
         LA    DBNXRPTR,2(DBNXRPTR)     BUMP IT 2 FOR LATER SCRATCHING  11320000
         ST    DBNXRPTR,DBNXTPTR                                        11340000
         ST    DBNXRPTR,DBTLPTR         SET UP TO LIST PTR              11360000
         ST    DBNXRPTR,DBTLPTR+4      SET ACTIVE TO VOL PTR            11380000
         B     DBTOSCAN                                                 11400000
*********************************************************************** 11440008
**                                                                   ** 11499908
**             C V O L   K E Y W O R D   R O U T I N E               ** 11540008
**                                                                   ** 11590008
** LINES 114500-118466 WERE REACTIVATED IN                     @Z40CSJH 11600008
** SUPPORT OF THE EXTENDED MVS CVOL FUNCTION                   @Z40CSJH 11610008
*********************************************************************** 11640008
DBCVORTN TM    SWITCHRD,PARAM          IS SCAN PARAMETER SWITCH ON      11690008
         BO    DBERR8                    INVALID PARAMETER MSG          11740008
         TM    DBLOOKFO+1,IERSW        INC,EXC,OR REP REQUESTED ?       11800008
         BO    DBCVO2                    BRANCH IF YES                  11810008
         TM    DBCOMSW+1,CVOL          IS KEYWORD ALREADY IN            11820008
         BO    DBERR5                    MULTABLE KWD MSG               11830008
         TM    DBCOMSW,FROM            TEST FOR 'FROM' USED     XA00425 11832008
         BO    DBERR5                    EXCLUDES USE OF 'CVOL' XA00425 11834008
         OI    DBCOMSW+1,CVOL          TURN ON CVOL KEYWORD SWITCH      11836008
         MVI   DBLOOKFO,TYPCODE        NOW LOOKING FOR A TYPE           11836408
         L     DBNXRPTR,DBNXTPTR        LOAD NEXT AVILIBLE POINTER      11836808
         LA    DBNXRPTR,2(DBNXRPTR)     BUMP IT 2 FOR LATER SCRATCHING  11837208
         ST    DBNXRPTR,DBCVPTR         SET UP CVOL LIST PTR            11837608
         ST    DBNXRPTR,DBNXTPTR                                        11838008
         B     DBTOSCAN                                                 11838408
DBCVO2   L     DBNXRPTR,DBNXTPTR         PUT PTR IN REG                 11838808
         OI    IEHMVV74+14,X'20'       TURN ON EIR CVOL SW       A27307 11839208
         B      IERVOL         YES BRANCH                               11840008
*********************************************************************** 11850008
**                                                                   ** 11860000
**             C A T L G   K E Y W O R D   R O U T I N E             ** 11880000
**                                                                   ** 11900000
*********************************************************************** 11920000
DBCLGRTN TM    DBLOOKFO+1,IERSW        INC,EXC,OR REP REQUEST           11940000
         BO    DBERR7                    KWD NOT ALLOWED MSG            11960000
         TM    DBCOMSW+1,CATLG         IS KEYWORD ALREADY IN            11980000
         BO    DBERR5                    MULTABLE KWD MSG               12000000
         TM    DBCOMSW,MOVE            IS THIS A MOVE REQUESTED ?       12020000
         BO    DBERR7                                                   12040000
         OI    DBCOMSW+1,CATLG         TURN ON CATLG KEYWORD SWITCH     12060000
         B     DBTOSCAN                                                 12080000
*********************************************************************** 12100000
**                                                                   ** 12120000
**             U N C A T L G   K E Y W O R D   R O U T I N E         ** 12140000
**                                                                   ** 12160000
*********************************************************************** 12180000
DBUNCRTN TM    DBLOOKFO+1,IERSW        INC,EXC,OR REP REQUESTED ?       12200000
*                                                                       12220000
         BO    DBERR7                    KWD NOT ALLOWED MSG            12240000
         TM    DBCOMSW+1,UNCATLG       IS KEYWORD ALREADY IN            12260000
         BO    DBERR5                    MULTABLE KWD MSG               12280000
         OI    DBCOMSW+1,UNCATLG       TURN ON UNCATLG KEYWORD SWITCH   12300000
         B     DBTOSCAN                                                 12320000
*********************************************************************** 12340000
**                                                                   ** 12360000
**         S E C U R I T Y   K E Y W O R D   R O U T I N E           ** 12380000
**                                                                   ** 12400000
*********************************************************************** 12420000
DBSECRTN TM    DBLOOKFO+1,IERSW        INC,EXC,OR REP REQUESTED ?       12440000
         BO    DBERR7                    KWD NOT ALLOWED MSG            12460000
         TM    DBCOMSW+1,SECURITY      IS KEYWORD ALREADY IN            12480000
         BO    DBERR5                    MULTABLE KWD MSG               12500000
         OI    DBCOMSW+1,SECURITY      TURN ON SECURITY KEYWORD SWITCH  12520000
         B     DBTOSCAN                                                 12540000
***************************************************************@G32DSFS 12550032
**                                                             @G32DSFS 12554032
**         C O P Y A U T H   K E Y W O R D   R O U T I N E     @G32DSFS 12558032
**                                                             @G32DSFS 12562032
***************************************************************@G32DSFS 12566032
DBATHRTN TM    DBCOMSW+5,COPYAUTH      IS KEYWORD ALREADY IN   @G32DSFS 12570032
         BO    DBERR5                    MULTIPLE KWD MSG      @G32DSFS 12574032
         OI    DBCOMSW+5,COPYAUTH      TURN ON COPYAUTH KEYWORD@G32DSFS 12578032
         B     DBTOSCAN                BR TO SCAN FOR PARMS    @G32DSFS 12582032
***************************************************************@G32DSFS 12586032
**                                                                   ** 12590032
**         C A T A L O G   K E Y W O R D   R O U T I N E             ** 12594032
**                                                                   ** 12598032
** LINES 125900-129599 WERE REACTIVATED                        @Z40CSJH 12602032
** IN SUPPORT OF THE EXTENDED CVOL FUNCTION                    @Z40CSJH 12606032
*********************************************************************** 12610032
DBCATRTN TM    DBLOOKFO+1,IERSW        INC,EXC,OR REP REQUESTED ?       12614032
         BO    DBDSG1                  BRANCH IF YES                    12618032
***************************************************************@G32DSFS 12630132
         TM    DBCOMSW,EQUKWD           IS EQUIVALENT KWD ALREADY IN    12640008
         BO    DBERR5                    MULTABLE KWD MSG               12650008
         OI    DBCOMSW,CATLOG          TURN ON CATALOG KEYWORD SWITCH   12660008
         TM    SWITCHRD,PARAM          IS SCAN PARAMETER SWITCH ON      12670008
         BO    DBCAT2                                                   12680008
         L     DBNXRPTR,DBNXTPTR                                        12690008
         ST    DBNXRPTR,DBNNPTR                                         12700008
         MVI   0(DBNXRPTR),BLANK       CLEAR JJ BYTE AREA               12710008
         MVC   1(43,DBNXRPTR),0(DBNXRPTR)                               12720008
         MVI   DBLOOKFO,DSNAME         NOW LOOKING FOR A NAME           12730008
         B     DBTOSCAN                                                 12740008
DBCAT2   MVI   DBLOOKFO,ANYKEY         NOW LOOKING FOR A KEYWORD        12750008
         B     DBTOSCAN                                                 12760008
*********************************************************************** 12960000
**                                                                   ** 12980000
**               I N C L U D E   O P E R A T O R                     ** 13000000
**                                                                   ** 13020000
*********************************************************************** 13040000
DBINCRTN DS    0C                                                       13060000
         OI    DBCOMSW+3,CARDPRNT      TURN ON CARDPRINT CONTROL SWITCH 13080000
         TM    DBCOMSW,MOVECOPY        MOVE OR COPY SWITCH ALREADY ON   13100000
         BZ    DBERR4                    MUST FOLLOW MOVE OR COPY OP    13120000
         TM    DBCOMSW,PDS               INCLUDE PERMITTED ?   @Z40CSJH 13140008
         BO    DBINC2                   YES-INCLUDE OK         @Z40CSJH 13143008
         TM    DBCOMSW,X'10'            IS IT DSGROUP          @Z40CSJH 13146008
         BZ    DBERR1                   NO-INCL NOT OK         @Z40CSJH 13149008
         TM    DBCOMSW+1,X'40'          CVOL SPECIFIED         @Z40CSJH 13152008
         BZ    DBERR1                   NO-INCLUDE NOT OK      @Z40CSJH 13155008
DBINC2   TM    DBLOOKFO+1,FRSTIER       IS FIRST I,E,R SW ON   @Z40CSJH 13160008
         BO    DBINC3                                                   13200000
         OI    DBLOOKFO+1,FRSTIER      TURN ON FIRST INC,EXC,OR REP SW  13220000
         MVC   DBIERPTR(4),DBNXTPTR      PUT IER BLOCK CHAIN ADDR IN    13240000
DBINC3   L     DBNXRPTR,DBNXTPTR         REQ BLOCK***J*PUT PTR IN REG   13260000
         MVI   0(DBNXRPTR),C'I'          PUT '2' IN FIRST BYTE OF REQBL 13280000
         MVI   IEHMVV74+14,X'00'                                 A27307 13300019
         MVI   DBLOOKFO,ANYKEY         NOW LOOKING FOR A KEYWORD        13320000
         OI    DBLOOKFO+1,INCLUDE      TURN INCLUDE SWITCH ON           13340000
         B     DBTOSCAN                                                 13360000
*********************************************************************** 13380000
**                                                                   ** 13400000
**               R E P L A C E   O P E R A T O R                     ** 13420000
**                                                                   ** 13440000
*********************************************************************** 13460000
DBREPRTN DS    0C                                                       13480000
         OI    DBCOMSW+3,CARDPRNT      TURN ON CARDPRINT CONTROL SWITCH 13500000
         TM    DBCOMSW,MOVECOPY         IS MOVE COPY SW ALREADY ON      13520000
         BZ    DBERR4                    MUST FOLLOW MOVE OR COPY OP    13540000
         TM    DBCOMSW,PDS             IS PDS SWITCH ON                 13560000
         BZ    DBERR3                    REPLACE NOT VALID  IGNORED     13580000
         TM    DBLOOKFO+1,FRSTIER      IS FIRST INC,EXC,OR REP SW ON    13600000
         BO    DBREP3                                                   13620000
         OI    DBLOOKFO+1,FRSTIER      TURN ON FIRST INC,EXC,OR REP SW  13640000
         MVC   DBIERPTR(4),DBNXTPTR      PUT IER BLOCK CHAIN ADDR IN    13660000
DBREP3   L     DBNXRPTR,DBNXTPTR         REQ BLOCK ***SET UP REG PTR    13680000
         MVI   0(DBNXRPTR),C'R'          PUT 'CH IN FIRST BYTE OF IERBL 13700000
         MVI   IEHMVV74+14,X'00'                                 A27307 13720019
         MVI   DBLOOKFO,ANYKEY         NOW LOOKING FOR A KEYWORD        13740000
         OI    DBLOOKFO+1,REPLACE      TURN REPLACE SWITCH ON           13760000
         B     DBTOSCAN                                                 13780000
*********************************************************************** 13800000
**                                                                   ** 13820000
**                E X C L U D E   O P E R A T O R   R O U T I N E    ** 13840000
**                                                                   ** 13860000
*********************************************************************** 13880000
DBEXCRTN DS    0C                                                       13900000
         OI    DBCOMSW+3,CARDPRNT      TURN ON CARDPRINT CONTROL SWITCH 13920000
         TM    DBCOMSW,MOVECOPY         IS MOVE COPY SW ALREADY ON      13940000
         BZ    DBERR4                    MUST FOLLOW MOVE OR COPY OP    13960000
         TM    DBCOMSW,X'0C'            PDS OR CATALOG         @Z40CSJH 13962008
         BM    DBEXC2                   BRANCH ON EITHER       @Z40CSJH 13964008
         TM    DBCOMSW,X'10'            IS IT DSGROUP          @Z40CSJH 13966008
         BZ    DBERR2                   NO-INVALID ERROR       @Z40CSJH 13968008
         TM    DBCOMSW+1,X'40'          CVOL SPECIFIED         @Z40CSJH 13970008
         BO    DBEXC6                   BR IF YES-EXCLUDE OK   @Z40CSJH 13972008
         B     DBERR2                   EXCLUDE INVALID        @Z40CSJH 13974008
DBEXC2   TM    DBCOMSW,PDS              IS IT PDS              @Z40CSJH 13980008
         BZ    DBEXC6                   BR IF NOT              @Z40CSJH 14000008
         MVI   XSWITCHS,SELECT         TURN ON SEL EXC MULT MEMBER SW   14060000
DBEXC5   TM    DBLOOKFO+1,FRSTIER      IS FIRST INC,EXC,OR REP SW ON    14080000
         BO    DBEXC3                                                   14100000
         OI    DBLOOKFO+1,FRSTIER      TURN ON FIRST INC,EXC,OR REP SW  14120000
         MVC   DBIERPTR(4),DBNXTPTR      PUT ADDR OF IER CHAIN IN REQBL 14140000
DBEXC3   L     DBNXRPTR,DBNXTPTR         SET UP REQ PTR                 14160000
         MVI   0(DBNXRPTR),C'E'          PUT 'E' IN FIRST BYTE OF IERBL 14180000
         MVI   IEHMVV74+14,X'C0'       TURN ON FROM ,CVOL SW     A27307 14200019
         OI    DBLOOKFO+1,EXCLUDE      TURN EXCLUDE SWITCH ON           14220000
         MVI   DBLOOKFO,ANYKEY         NOW LOOKING FOR A KEYWORD        14240000
         B     DBTOSCAN                                                 14260000
DBEXC6   TM    DBLOOKFO+1,EXC          IS EXC SWITCH ON                 14280000
         BO    DBERR2                  BRANCH YES                       14300000
         OI    DBLOOKFO+1,EXCLUDE      TURN EXCLUDE SWITCH ON           14320000
         MVI   DBLOOKFO,ANYKEY         NOW LOOKING FOR A KEYWORD        14340000
         B     DBTOSCAN                                                 14360000
*********************************************************************** 14380000
**                                                                   ** 14400000
**          E X P A N D   K E Y W O R D   R O U T I N E              ** 14420000
**                                                                   ** 14440000
*********************************************************************** 14460000
DBEXPRTN TM    SWITCHRD,PARAM          IS SCAN PARAM SWITCH ON  A21900  14470018
         BO    DBERR8                   BRANCH IF ON            A21900  14480018
         TM    DBCOMSW+1,EXPAND        IS KEYWORD ALREADY IN    A21900  14490018
         BO    DBERR5                    MULTABLE KWD MSG               14500000
         TM    DBLOOKFO+1,IERSW        WAS INC,EXC,OR REP REQUESTED     14520000
         BO    DBERR7                   KWD NOT ALLOWED                 14540000
         XC    IEHMVV25+2,IEHMVV25+2    CLEAR EXP DATA ARE A            14560000
         OI    DBCOMSW+1,EXPAND        TURN ON EXPAND KEYWORD SWITCH    14580000
         MVI   DBLOOKFO,EXPDAT         NOW LOOKING FOR EXPAND DATA      14600000
         B     DBTOSCAN                                                 14620000
DBSELRTN DS    0C                                                       14640000
         OI    DBCOMSW+3,CARDPRNT      TURN ON CARDPRINT CONTROL SWITCH 14660000
         TM    DBCOMSW,MOVECOPY         IS MOVE COPY SW ALREADY ON      14680000
         BZ    DBERR4                                                   14700000
         TM    DBCOMSW,PDS             IS PDS SWITCH ON                 14720000
         BZ    DBERR14                                                  14740000
         TM    DBLOOKFO+1,EXC          ARE THERE ANY PRECEDING EXCLUDES 14760000
         BO    DBERR14                                                  14780000
         MVI   XSWITCHS,SELECT         TURN ON SEL EXC MULT MEMBER SW   14800000
         TM    DBLOOKFO+1,INC          ARE THERE ANY PRECEDING INCLUDES 14820000
         BO    DBSEL3                                                   14840000
         OI    DBLOOKFO+1,X'41'          TURN ON IER AND SELECT SW      14860000
         MVC   DBIERPTR(4),DBNXTPTR      SET UP IER BLOCK POINTER       14880000
DBSEL3   L     DBNXRPTR,DBNXTPTR                                        14900000
         MVI   0(DBNXRPTR),C'I'          MOVE I INTO THE BLOCK          14920000
         MVI   IEHMVV74+14,X'E0'     TURN ON FROM,CVOL,DSN SW    A27307 14940019
*                                      IN THE INCLUDE BLOCK             14960000
         L     DBR1,IEHMVV21                                            14980000
         MVC   1(44,DBNXRPTR),0(DBR1)    MOVE DS NAME INTO BLOCK        15000000
         L     DBR1,IEHMVV22                                            15020000
         MVC   53(12,DBNXRPTR),0(DBR1)  MOVE FROM INEO INTO BLOCK       15040000
DBSEL4   TM    DBCOMSW+1,CVOL          IS CVOL SWITCH ON                15060000
         BZ    DBSEL5                    BRANCH IF NO                   15080000
         L     DBR1,IEHMVV24                                            15100000
         MVC   65(12,DBNXRPTR),0(DBR1)   MOVE CVOL INFO INTO BLOCK      15120000
DBSEL5   MVI   DBLOOKFO,ANYKEY         NOW LOOKING FOR A KEYWORD        15140000
         OI    DBLOOKFO+1,SELENCNT     TURN ON SELECT ENCOUNTERED SW    15160000
         B     DBTOSCAN                                                 15180000
EXPDATA  TM    SWITCHRD,PARAM          IS SCAN PARAMETER SWITCH ON      15200000
         BZ    DBERR8                   BRANCH IF NO                    15220000
         LTR   DBLENGTH,DBLENGTH        IS LENGTH ZERO                  15240000
         BC    13,DBERR10               BRANCH IF YES                   15260000
         CH    DBLENGTH,DBTWO           IS LENGTH TWO                   15280000
         BH    DBERR10                  LENGTH ERROR                    15300000
EXPD3    BCTR  DBLENGTH,0               REDUCE LENGTH BY ONE            15320000
         EX    DBLENGTH,EXPD4                                           15340000
         CVB   DBR1,IEHMVV00                                            15360000
         STH   DBR1,IEHMVV25+2                                          15380000
         MVI   DBLOOKFO,ANYKEY         NOW LOOKING FOR A KEYWORD        15400000
         B     DBTOSCAN                                                 15420000
EXPD4    PACK  0(8,12),0(1,DBSCANAD)                                    15440000
*********************************************************************** 15460000
**                                                                   ** 15480000
**          C O P Y   O P E R A T O R   R O U T I N E                ** 15500000
**                                                                   ** 15520000
*********************************************************************** 15540000
DBCPRTN  DS    0C                                                       15560000
         TM    DBCOMSW,MOVECOPY         IS MOVE COPY SW ALREADY ON      15580000
         BNE   DBCP2                     BRANCH IF YES                  15600000
DBCP3    OI    DBCOMSW,COPY            TURN ON COPY SWITCH              15620000
         OI    DBCOMSW+3,CARDPRNT      TURN ON CARDPRINT CONTROL SWITCH 15640000
         MVI   DBLOOKFO,ANYKEY         NOW LOOKING FOR A KEYWORD        15660000
         B     DBTOSCAN                                                 15680000
DBCP2    MVI   ESSENTRY,X'14'                                           15700000
         B     SCAEXIT1                                                 15720000
*********************************************************************** 15740000
**                                                                   ** 15760000
**             M O V E   O P E R A T O R   R O U T I N E             ** 15780000
**                                                                   ** 15800000
*********************************************************************** 15820000
DBMVRTN  DS    0C                                                       15840000
         TM    DBCOMSW,MOVECOPY         IS MOVE COPY SW ALREADY ON      15860000
         BNE   DBMV2                     BRANCH IF YES                  15880000
DBMV3    OI    DBCOMSW,MOVE            TURN ON MOVE SWITCH              15900000
         OI    DBCOMSW+3,CARDPRNT      TURN ON CARDPRINT CONTROL SWITCH 15920000
         MVI   DBLOOKFO,ANYKEY         NOW LOOKING FOR A KEYWORD        15940000
         B     DBTOSCAN                                                 15960000
DBMV2    MVI   ESSENTRY,X'10'                                           15980000
         B     SCAEXIT1                                                 16000000
*********************************************************************** 16020000
**                                                                   ** 16040000
**            D E V I C E   L O O K U P   R O U T I N E              ** 16060000
**                                                                   ** 16080000
*********************************************************************** 16100000
DBDEVLUP L     R0,IEHMVV74+16          ADD OF DEVNAMET             I276 16102019
         LTR   R0,R0                   IS DEVNAMET LOADED          I276 16104019
         BNZ   LOADED                  YES                         I276 16106019
         LOAD  EP=DEVNAMET             LOAD DEVICE NAME TABLE      I276 16108019
         ST    R0,IEHMVV74+16          SAVE ADDR OF DEVNAMET       I276 16110019
         L     R1,IEHMVV90+136         RESET R1                    I276 16112019
LOADED   TM    SWITCHRD,PARAM          IS SCAN PARM SWITCH ON      I276 16114019
         BO    DBERR8                   BRANCH IF ON            A21900  16120018
         TM    SWITCHRD,RTPAREN        IS RIGHT PAREN BIT ON    A21900  16130018
         BO    DBVID4                                                   16140000
         TM    DBLOOKFO+1,COMPLEX      IS COMPLEX LIST BIT ON           16160000
         BO    DBDEV5                    BRANCH IF YES                  16180000
         CLI   IEHMVV90+129,X'00'      IS PAREN COUNT ZERO              16200000
         BE    DBDEV5                    BRANCH IF YES                  16220000
         OI    DBLOOKFO+1,COMPLEX      TURN ON COMPLEX BIT              16240000
DBDEV5   STC   DBLENGTH,DBBYTE           SAVE THE LENGTH                16260000
         CLI   DBBYTE,8                  LENGTH > EIGHT ?               16280000
         BNH   DBDEV1                    BRANCH IF NO                   16300000
         B     DBERR8                    INVALID PARAMETER MSG          16320000
DBDEV1   DS    0C                                                       16340000
         L     DBAVIL2,IEHMVV74+16     PUT ADDR OF DEVNAMET IN R   I276 16360019
         LA    DBAVIL3,12                                               16380000
         SR    DBAVIL0,DBAVIL0                                          16400000
         M     DBAVIL0,0(0,DBAVIL2)     CALC LENGTH OF TABLE            16420000
         LA    DBAVIL0,12                                               16440000
         SR    DBAVIL3,DBAVIL0          REDUCE LENGTH BY 12             16460000
*                                       LOAD COMPR WITH THE ADDR OF THE 16480000
*                                       TABLE PLUS TWELEVE LESS THAN    16500000
*                                       THE LENGTH OF THE TABLE         16520000
         LA    DBCOMPR,4(DBAVIL3,DBAVIL2)                               16540000
         LA    DBR3,12                  SET UP TABLE LOOK UP            16560000
         LA    DBR1,4(DBAVIL2)          ADDR OF TABLE                   16580000
         MVI   DBSARG,BLANK            CLEAR AREA                       16600000
         MVC   DBSARG+1(7),DBSARG                                       16620000
         XC    UNIT(5),UNIT            RESET SPECIFIC UNIT NAME TO DT0I 16626018
*                                      ZERO                        DT0I 16632018
         BCTR  DBLENGTH,0                REDUCE LENGTH BY ONE           16640000
         EX    DBLENGTH,DBDEV4           MOVE TYPE TO SARG              16660000
DBDEV2   CLC   DBSARG(8),0(DBR1)         COMPARE TO DEVICE TYPE TABLE   16680000
         BNE   DBDEV3                                                   16700000
         ST    DBR1,DBREENTR            SAVE TABLE ENTRY ADDRESS        16720000
         CLI   10(DBR1),X'80'                                           16740000
         BE    DBDVTAPE                                                 16760000
         CLI   10(DBR1),X'20'                                           16780000
         BE    DBDVDISK                                                 16800000
         CLI   10(DBR1),X'08'                                           16820000
         BE    DBDVDISK                                                 16840000
         B     DBERR13                                                  16860000
DBDEV3   BXLE  DBR1,DBR3,DBDEV2          LOOP HERE                      16900000
         L     DBR1,16                 GET PTR TO UCBLUT           DT0I 16901018
         L     DBR1,40(DBR1)                                       DT0I 16902018
CHECKUCB ICM   DBR3,3,0(DBR1)           GET PTR TO UCB         @ZM30153 16903003
         N     DBR3,FOXES               CLEAR TOP HALF         @ZM30153 16903403
         TM    0(DBR1),X'FF'           TEST FOR END OF UCBLUT      DT0I 16904018
         BC    14,NOTEND                BRANCH ON NOT END          DT0I 16905018
         TM    1(DBR1),X'FF'           CHECK FOR DEFINITE END      DT0I 16906018
         BC    1,DBERR8                BRANCH TO INDICATE NO       DT0I 16907018
*                                      MATCH FOUND                 DT0I 16908018
NOTEND   LTR   DBR3,DBR3               CHECK FOR ZERO ENTRY        DT0I 16909018
         BZ    NXTUCB                  BRANCH ON YES               DT0I 16910018
         CLC   DBSARG(3),13(DBR3)      CHECK FOR UNIT NAME         DT0I 16911018
         BE    FOUND                   BRANCH WHEN FOUND           DT0I 16912018
NXTUCB   LA    DBR1,2(DBR1)            BRANCH TO NEXT UCBLUT ENTRY DT0I 16913018
         B     CHECKUCB                BRANCH TO CHECK NEXT UCB    DT0I 16914018
FOUND    LA    DBR3,8(DBR3)            UPDATE SO DEVICE TYPE IS    DT0I 16915018
*                                      SAME OFFSET IN UCB AS IN DNTDT0I 16916018
         ST    DBR3,DBREENTR           SAVE IT FOR NEXT RTN        DT0I 16917018
         MVC   UNIT(5),DBSARG          SAVE SPECIFIC UNIT          DT0I 16918018
         CLI   10(DBR3),X'80'          CHECK IF TAPE               DT0I 16919018
         BE    DBDVTAPE                BRANCH ON YES               DT0I 16920018
         CLI   10(DBR3),X'20'          TEST FOR DA                 DT0I 16921018
         BE    DBDVDISK                BRANCH ON YES               DT0I 16922018
         CLI   10(DBR3),X'08'          TEST FOR UNIT RECORD        DT0I 16923018
         BE    DBDVDISK                 BRANCH ON YES              DT0I 16924018
         B     DBERR13                 IF NONE OF ABOVE CONSIDER ITDT0I 16925018
*                                      AN ERROR                    DT0I 16926018
DBDEV4   MVC   DBSARG(1),0(DBSCANAD)     EXECUTED INST                  16940000
*********************************************************************** 16960000
**                                                                   ** 16980000
**            V O L U M E   I D   R O U T I N E                      ** 17000000
**                                                                   ** 17020000
*********************************************************************** 17040000
DBVIDRTN MVI 0(DBNXRPTR),BLANK          CLEAR VOL ID AREA               17060000
         MVC   1(5,DBNXRPTR),0(DBNXRPTR)                                17080000
         LTR   DBLENGTH,DBLENGTH         IS LENGTH ZERO                 17100000
         BZ    DBVID17                   BRANCH IF YES                  17120000
         LA    DBR1,6                    CAUSE VD  ID TO BE             17140000
         SR    DBR1,DBLENGTH             RIGHT JUSTIFIED                17160000
         BL    DBERR10                   BRANCH IF LENGTH   SIX         17180000
         LR    DBR1,DBNXRPTR                                            17200000
         BCTR  DBLENGTH,0                REDUCE LENGTH BY ONE           17220000
         EX    DBLENGTH,DBVID2           MOVE VOL ID INTO LIST          17240000
DBVID17  LA    DBNXRPTR,6(DBNXRPTR)      ADJ NXT AREA PTR               17260000
         TM    DBACTTYP,TAPE            IS THE TYPE A TAPE              17280000
         BO    DBVID3                    BRANCH IF YES                  17300000
         XC    0(2,DBNXRPTR),0(DBNXRPTR) CLEAR SEQ NO. AREA             17320000
         LA    DBNXRPTR,7(DBNXRPTR)       ADJUST TO NEXT TYPE SLOT DT0I 17340018
         TM    DBLOOKFO+1,COMPLEX      IS COMPLEX SWITCH ON             17360000
         BO    DBVID16                   BRANCH IF YES                  17380000
         CLI   IEHMVV90+129,X'00'      IS PAREN COUNT ZERO              17400000
         BE    DBVID4                    BRANCH IF YES                  17420000
         B     DBDVD1                                                   17440000
DBVID16  LH    DBR1,IEHMVV90+128       PUT PAREN COUNT IN REG           17460000
         BCTR  DBR1,0                                                   17480000
         LTR   DBR1,DBR1                 IS REG ZERO                    17500000
         BH    DBDVD1                                                   17520000
         BM    DBVID4                                                   17540000
         MVI   DBLOOKFO,TYPCODE        NOW LOOKING FOR A TYPE           17560000
         B     DBTOSCAN                                                 17580000
DBVID11  LH    DBR1,IEHMVV90+128       PUT PAREN COUNT IN REG           17600000
         BCTR  DBR1,0                    REDUCE REG BY ONE              17620000
         LTR   DBR1,DBR1                                                17640000
         BH    DBVID12                                                  17660000
         BM    DBVID4                                                   17680000
         XC    0(2,DBNXRPTR),0(DBNXRPTR) CLEAR SEQ NO. AREA             17700000
         LA    DBNXRPTR,2(DBNXRPTR)      ADJ PTR TO NEXT TYPE SLOT      17720000
         MVI   DBLOOKFO,TYPCODE        NOW LOOKING FOR A TYPE           17740000
         B     DBTOSCAN                                                 17760000
DBVID2   MVC   0(1,DBR1),0(DBSCANAD)     EXECUTED INST                  17780000
DBVID3   TM    DBLOOKFO+1,COMPLEX      IS COMPLEX SWITCH ON             17800000
         BO    DBVID11                   BRANCH IF YES                  17820000
         CLI   IEHMVV90+129,X'00'      IS PAREN COUNT ZERO              17840000
         BNE   DBVID12                   BRANCH IF NO                   17860000
         XC    0(2,DBNXRPTR),0(DBNXRPTR) CLEAR SEQ NO. AREA             17880000
         LA    DBNXRPTR,7(DBNXRPTR)    ADJUST TO NEXT TYPE SLOT    DT0I 17900018
         B     DBVID4                    GO TO END OF LIST RTN          17920000
DBVID12  XC    0(2,DBNXRPTR),0(DBNXRPTR) CLEAR SEQ NO. AREA             17940000
         MVI   DBLOOKFO,SEQNUMB        NOW LOOKING FOR A SEQ NUMBER     17960000
         B     DBTOSCAN                                                 17980000
*********************************************************************** 18000000
**                                                                   ** 18020000
**            E N D   O F   L I S T   R O U T I N E                  ** 18040000
**                                                                   ** 18060000
*********************************************************************** 18080000
DBVID4   MVI   DBLOOKFO,ANYKEY         NOW LOOKING FOR A KEYWORD        18100000
         NI    DBLOOKFO+1,X'DF'          TURN OFF COMPLEX BIT           18120000
         TM    DBLOOKFO+1,IERSW        WAS INC,EXC,OR REP REQUESTED     18140000
         BO    DBTOSCAN                                                 18160000
         CLC   DBNXTPTR(4),IEHMVV22     COMP TO FROM LST PTR            18180000
         BNE   DBVID6                                                   18200000
         LA    DBR1,IEHMVV22                                            18220000
         B     DBVID7                                                   18240000
DBVID6   CLC   DBNXTPTR(4),IEHMVV23     COMP TP TO LST PTR              18260000
         BNE   DBVID8                                                   18280000
         LA    DBR1,IEHMVV23                                            18300000
         B     DBVID7                                                   18320000
DBVID8   CLC   DBNXTPTR(4),IEHMVV24     COMP TO CVOL LST PTR            18340000
         BNE   DBVID9                                                   18360000
         LA    DBR1,IEHMVV24                                            18380000
         B     DBVID7                                                   18400000
DBVID9   B     DBERR9                                                   18420000
DBVID7   ST    DBNXRPTR,DBNXTPTR         UP NEXT AVIL PTR               18440000
         LH    DBAVIL0,DBENTCT           PLACE ENTRY COUNT              18460000
         STC   DBAVIL0,0(0,DBR1)         IN LEFT MOST BYTE OF LIST PTR  18480000
         STC   DBAVIL0,4(0,DBR1)         DO SOMETHING                   18500000
         SR    DBAVIL0,DBAVIL0                                          18520000
         STH   DBAVIL0,DBENTCT                                          18540000
         B     DBTOSCAN                                                 18560000
*********************************************************************** 18580000
**                                                                   ** 18600000
**          S E Q U E N C E   N U M B E R   R O U T I N E            ** 18620000
**                                                                   ** 18640000
*********************************************************************** 18660000
DBSEQRTN MVI   IEHMVV00,BLANK          CLEAR DOUBLE WORD TO BLANKS      18680000
         MVC   IEHMVV00+1(7),IEHMVV00                                   18700000
         LTR   DBLENGTH,DBLENGTH         IS LENGTH ZERO                 18720000
         BZ    DBSEQ17                   BRANCH IF YES                  18740000
*                                      CAUSE SEQ FLD TO BE RIGHT        18760000
*                                      JUSTIFIED IN DOUBLE WORD         18780000
         LA    DBR1,4                  MAX LENGTH OF SEQ FLD            18800000
         SR    DBR1,DBLENGTH                                            18820000
         BL    DBERR10                   BRANCH IF LENGTH  2            18840000
         LA    DBAVIL0,IEHMVV00+4      RIGHT WORD OF DOUBLE WORD        18860000
         AR    DBR1,DBAVIL0                                             18880000
         BCTR  DBLENGTH,0                                               18900000
         EX    DBLENGTH,DBVID2           MOVE SEQ. NO. INTO LIST        18920000
         ST    DBSCANAD,SAVEREG3       SAVE REG3               @ZA11956 18920208
         AR    DBSCANAD,DBLENGTH       POINT AT SEQ NO         @ZA13783 18920408
         CLI   1(DBSCANAD),X'5D'       IS NEXT A RIGHT         @ZA13783 18920608
*                                      PARENTHESIS ?           @ZA13783 18920808
         BNE   OK                      NO, BRANCH              @ZA13783 18921008
         CLI   2(DBSCANAD),X'40'       IS IT A BLANK AFTER     @ZA13783 18921208
*                                      RIGHT PARENTHESIS ?     @ZA13783 18921408
         BE    OK                      YES, BRANCH             @ZA11956 18921608
         CLI   2(DBSCANAD),X'6B'       IS IT A COMMA AFTER     @ZA26187 18921899
*                                      RIGHT PARENTHESIS ?     @ZA26187 18922499
         BE    OK                      YES, BRANCH             @ZA26187 18923099
         TM    IEHMVV20+5,X'04'        IS RIGHT SWITCH ON      @ZA26187 18923699
*                                      SET IN IEHMVESJ         @ZA26187 18924299
         BNO   DBERR9                  NO, ERROR               @ZA26187 18924899
OK       L     DBSCANAD,SAVEREG3       RELOAD REG3             @ZA11956 18925499
         NI    IEHMVV20+5,X'FB'        RESET RIGHT SWITCH      @ZA26187 18926099
         LA    DBLENGTH,1(0,DBLENGTH)  ADD ONE TO LENGTH       @ZA07336 18928008
LOOP     CLI   0(DBR1),X'F0'          CHECK DIGIT RANGE OF 1-9 @ZA07336 18932008
         BL    DBERR9                  ERROR                   @ZA07336 18936008
         CLI   0(DBR1),X'F9'                                   @ZA07336 18938008
         BH    DBERR9                  ERROR                   @ZA07336 18940008
         LA    DBR1,1(0,DBR1)          ADD ONE TOO CHECK NEXT  @ZA07336 18944008
*                                      DIGIT IF ANY            @ZA07336 18948008
         BCT   DBLENGTH,LOOP           END OF SEQ LIST         @ZA07336 18952008
         PACK  IEHMVV00(8),IEHMVV00(8)                                  18956008
         CVB   DBAVIL0,IEHMVV00                                         18960000
         STC   DBAVIL0,1(DBNXRPTR)    PUT SEQ NO. IN LIST               18980000
         SRL   DBAVIL0,8                                                19000000
         STC   DBAVIL0,0(DBNXRPTR)                                      19020000
DBSEQ17  LA    DBNXRPTR,7(DBNXRPTR)      ADJ PTR IN REG            DTOI 19040018
         TM    DBLOOKFO+1,COMPLEX      IS COMPLEX SWITCH ON             19060000
         BO    DBSEQ1                   BRANCH IF YES                   19080000
         CLI   IEHMVV90+129,X'00'      IS PAREN COUNT ZERO              19100000
         BE    DBVID4                                                   19120000
         B     DBDVT1                                                   19140000
DBSEQ1   LH    DBR1,IEHMVV90+128       PUT PAREN COUNT IN REG           19160000
         BCTR  DBR1,0                   REDUCE IT BY ONE                19180000
         LTR   DBR1,DBR1                TEST CONTENTS OF REG            19200000
         BNE   DBDVT1                   BRANCH IF NOT ZERO              19220000
         MVI   DBLOOKFO,TYPCODE        NOW LOOKING FOR TYPE             19240000
         B     DBTOSCAN                                                 19260000
*********************************************************************** 19280000
**                                                                   ** 19300000
**             D E V I C E    =   T A P E                            ** 19320000
**                                                                   ** 19340000
*********************************************************************** 19360000
DBDVTAPE MVI   DBACTTYP,TAPE            SET ACTIVE TYPE TO TAPE         19380000
DBDVT1   L     DBR1,DBREENTR            LOAD ADDR OF DEVICE TABLE ENTRY 19400000
         MVC   0(4,DBNXRPTR),8(DBR1)    MOVE TYPE CODE TO COMM AREA     19420000
         MVC   12(5,DBNXRPTR),UNIT     SAVE SPECIFIC NAME          DT0I 19430018
         B     DBDVD2                                                   19440000
*********************************************************************** 19460000
**                                                                   ** 19480000
**             D E V I C E    =   D I S K                            ** 19500000
**                                                                   ** 19520000
*********************************************************************** 19540000
DBDVDISK MVI   DBACTTYP,DISK            SET ACTIVE TYPE TO DISK         19560000
DBDVD1   L     DBR1,DBREENTR            LOAD ADDR OF DEVICE TABLE ENTRY 19580000
         MVC   0(4,DBNXRPTR),8(DBR1)    MOVE TYPE CODE TO COMM AREA     19600000
         MVC   12(5,DBNXRPTR),UNIT     SAVE SPECIFIC NAME          DT0I 19610018
DBDVD2   LA    DBNXRPTR,4(0,DBNXRPTR)   ADJ PTR TO VOL.ID. SLOT         19620000
         MVI   DBLOOKFO,VOLID           NOW LOOKING FOR VOL ID          19640000
         LH    DBAVIL0,DBENTCT           PUT COUNT INTO REG             19660000
         LA    DBAVIL0,1(DBAVIL0)        ADD ONE TO COUNT               19680000
         STH   DBAVIL0,DBENTCT           SAVE COUNT                     19700000
         B     DBTOSCAN                                                 19720000
CLEAR    LTR   0,0                       IS LEGNTH ZERO                 19740000
         BC    8,0(14)                   RETURN IF YES                  19760000
         MVI   0(1),X'00'                SET PROPOEATION BYTE           19780000
         BCTR  0,0                                                      19800000
         LTR   0,0                       IS LENGTH ZERO                 19820000
         BC    8,0(14)                   RETURN IF YES                  19840000
         LA    15,255                    MAX PROPOGATION FACTOR IN R15  19860000
CLEAR3   CLR   0,15                      IS MAX LARGER THAN LENGTH      19880000
         BNH   CLEAR2                    BRANCH IF NO                   19900000
         EX    15,CLEAR1                 EXECUTE MVC INSTRUCTION        19920000
         SR    0,15                                                     19940000
         AR    1,15                                                     19960000
         B     CLEAR3                                                   19980000
CLEAR2   LTR   0,0                                                      20000000
         BC    8,0(14)                                                  20020000
         XR    15,0                                                     20040000
         XR    0,15                                                     20060000
         XR    15,0                                                     20080000
         EX    15,CLEAR1                                                20100000
         BR    14                                                       20120000
CLEAR1   MVC   1(1,1),0(1)                                              20140000
*********************************************************************** 20160000
**                                                                   ** 20180000
**    REQUEST BLOCK --  MISC DC,DS,EQUATE STATEMENTS                 ** 20200000
**                                                                   ** 20220000
*********************************************************************** 20240000
         DS    0F                                                       20260000
FOXES    DC    X'0000FFFF'              BIT SETTING TO         @ZM30153 20270003
*                                       CLEAR REGISTER         @ZM30153 20272003
DBTWELVE DC    H'12'                                                    20280000
DBEIGHT  DC    XL2'08'                                                  20300000
         DS    0H                                                       20320000
HONE     DC    X'0001'                                                  20340000
         DS    0H                                                       20360000
DBTWO    DC    X'0002'                                                  20380000
UNIT     DC    XL5'00'                 SPECIFIC UNIT NAME          DT0I 20390018
R0       EQU   0                                                        20400000
R1       EQU   1                                                        20420000
R2       EQU   2                                                        20440000
R3       EQU   3                                                        20460000
R4       EQU   4                                                        20480000
DBAVIL1  EQU   0                                                        20500000
DBSCANAD EQU   1                         ADDR RETURNED FROM SCAN PROG   20520000
DBLENGTH EQU   2                         LENG RETURNED FROM SCAN PROG   20540000
DBR1     EQU   3                         MAINLY FOR CONTROL LOOPS       20560000
DBR3     EQU   4                         MAINLY FOR CONTROL LOOPS       20580000
DBCOMPR  EQU   5                         MAINLY FOR CONTROL LOOPS       20600000
DBAVIL3  EQU   7                                                        20620000
DBBASE1  EQU   8                                                        20640000
DBAVIL0  EQU   6                                                        20660000
DBBASE   EQU   9                                                        20680000
DBAVIL2  EQU   10                                                       20700000
DBNXRPTR EQU   11                                                       20720000
DBAVIL5  EQU   12                                                       20740000
DBSAVR   EQU   13                        PTR TO SAVE AREA (LINKAGES)    20760000
DBRET    EQU   14                        RETURN REG       (LINKAGES)    20780000
DBBRTO   EQU   15                        BRANCH TO ADDR   (LINKAGES)    20800000
DBCOMSW  EQU   IEHMVV20                                                 20820000
DBNNPTR  EQU   IEHMVV21                                                 20840000
DBFLPTR  EQU   IEHMVV22                                                 20860000
DBTLPTR  EQU   IEHMVV23                                                 20880000
DBCVPTR  EQU   IEHMVV24                                                 20900000
DBEXPPTR EQU   IEHMVV25                                                 20920000
DBIERPTR EQU   IEHMVV26                                                 20940000
DBFAADD  EQU   IEHMVV27                                                 20960000
DBNXTPTR EQU   IEHMVV10                                                 20980000
DBELPTR  EQU   IEHMVV10+4                                               21000000
DBENTCT  EQU   IEHMVV27+8                                               21020000
DBREENTR EQU   IEHMVV27+4                                               21040000
ESSENTRY EQU   IEHMVV27+4                                               21060000
ESTENTRY EQU   IEHMVV27+5                                               21080000
DBSARG   EQU   IEHMVV27+12                                              21100000
DBACTTYP EQU   IEHMVV27+30                                              21120000
DBBYTE   EQU   IEHMVV27+31                                              21140000
NOTEAREA EQU   IEHMVV27+20                                              21160000
DBLOOKFO EQU   IEHMVV27+24                                              21180000
XSWITCHS EQU   IEHMVV27+28                                              21200000
SWITCHRD EQU   IEHMVV90                                                 21220000
DISK     EQU   X'02'                                                    21240000
EQUKWD   EQU   X'3C'                                                    21260000
RENAMESW EQU   X'04'                                                    21280000
TWO      EQU   X'02'                                                    21300000
TAPE     EQU   X'01'                                                    21320000
BYPASS   EQU   X'40'                                                    21340000
IERSW    EQU   X'80'                                                    21360000
TO       EQU   X'80'                                                    21380000
ERRSCAN  EQU   X'80'                                                    21400000
SYSINEOF EQU   X'20'                                                    21420000
ANYKEY   EQU   X'40'                                                    21440000
DSGROUP  EQU   X'10'                                                    21460000
DSGORPDS EQU   X'18'                                                    21480000
DSGORVOL EQU   X'12'                                             Y02918 21490002
DSNORPDS EQU   X'28'                                                    21500000
FROM     EQU   X'01'                                                    21520000
OPERATOR EQU   X'00'                                                    21540000
TYPCODE  EQU   X'20'                                                    21560000
OPERATR  EQU   X'FF'                                                    21580000
VOLID    EQU   X'10'                                                    21600000
KEYDDN   EQU   X'80'                                                    21620000
SEQNUMB  EQU   X'08'                                                    21640000
DSNAME   EQU   X'04'                                                    21660000
MEMNAME  EQU   X'02'                                                    21680000
DUMP     EQU   X'01'                                                    21700000
PARAM    EQU   X'02'                                                    21720000
RENAME   EQU   X'20'                                                    21740000
RTPAREN  EQU   X'01'                                                    21760000
OFF      EQU   X'DF'                                                    21780000
BLANK    EQU   C' '                                                     21800000
TODDSW   EQU   X'40'                                                    21820000
DSNSW    EQU   X'20'                                                    21840000
PDS      EQU   X'08'                                                    21860000
CVOL     EQU   X'40'                                                    21880000
CATLG    EQU   X'10'                                                    21900000
MOVE     EQU   X'80'                                                    21920000
UNCATLG  EQU   X'20'                                                    21940000
SECURITY EQU   X'08'                                                    21960000
CATLOG   EQU   X'04'                                                    21980000
CARDPRNT EQU   X'10'                                                    22000000
MOVECOPY EQU   X'C0'                                                    22020000
FRSTIER  EQU   X'40'                                                    22040000
INCLUDE  EQU   X'84'                                                    22060000
REPLACE  EQU   X'86'                                                    22080000
SELECT   EQU   X'80'                                                    22100000
EXCLUDE  EQU   X'82'                                                    22120000
EXPAND   EQU   X'04'                                                    22140000
EXPDAT   EQU   X'01'                                                    22160000
EXC      EQU   X'02'                                                    22180000
INC      EQU   X'40'                                                    22200000
SELENCNT EQU   X'81'                                                    22220000
COPY     EQU   X'40'                                                    22240000
COMPLEX  EQU   X'20'                                                    22260000
COMPLEXM EQU   X'40'                                                    22280000
UNLOAD   EQU   X'40'                                             A37919 22290021
COPYAUTH EQU   X'10'                   COPYAUTH KEYWORD        @G32DSFS 22295032
RDDCB    EQU   IEHMVV90+48                                              22300000
PARENCTR EQU   IEHMVV90+X'80'          COUNT OF OPEN PARENTHESES A21900 22306018
ZERO     EQU   X'00'                                             A21900 22312018
CVOLPASS EQU   X'03'                   CVOL BYPASS SWITCH       YL026VC 22314002
CVOLMSG  EQU   X'13'                   CVOL MESSAGE NUMBER      YL026VC 22316002
         DS    0F                                                       22320000
DBSIX    DC    H'06'                                                    22340000
SAVEREGB DS    F                       SAVE AREA FOR REG11     @ZA10933 22346008
SAVEREG2 DS    F                       SAVE AREA FOR REG2      @ZA10933 22352008
SAVEREG3 DS    F                       SAVE AREA FOR REG3      @ZA11956 22356008
         DS    0F                                                       22360000
DBCTONE  DC    XL4'01000000'                                            22380000
MASK1    DC    XL4'00000030'                                            22400000
         DS    0F                                                       22420000
DBFORTY4 DC    X'002C'                                                  22440000
*                                                                       22460000
*                                                                       22480000
*                                                                       22500000
*                                                                       22520000
*                                                                       22540000
DBERR1   LA    R3,1                                                     22560000
         B     ERRDUMP                                                  22580000
DBERR2   LA    R3,2                                                     22600000
         B     ERRDUMP                                                  22620000
DBERR3   LA    R3,3                                                     22640000
         B     ERRDUMP                                                  22660000
DBERR4   LA    R3,4                                                     22680000
         B     ERRDUMP                                                  22700000
DBERR5   LA    R3,5                                                     22720000
         B     ERRDUMP                                                  22740000
DBERR6   LA    R3,6                                                     22760000
         B     ERRDUMP                                                  22780000
DBERR7   LA    R3,7                                                     22800000
         B     ERRDUMP                                                  22820000
DBERR8   LA    R3,8                                                     22840000
         B     ERRDUMP                                                  22860000
DBERR9   LA    R3,9                                                     22880000
         B     ERRDUMP                                                  22900000
DBERR10  LA    R3,10                                                    22920000
         B     ERRDUMP                                                  22940000
DBERR11  LA    R3,11                                                    22960000
         B     ERRDUMP                                                  22980000
DBERR12  LA    R3,13                                                    23000000
         B     ERRDUMP                                                  23020000
DBERR13  LA    R3,14                                                    23040000
         B     ERRDUMP                                                  23060000
DBERR14  LA    R3,15                                                    23080000
         B     ERRDUMP                                                  23100000
DBERR15  LA    R3,12                                                    23120000
         B     ERRDUMP                                                  23140000
DBEOFRTN OI    XSWITCHS+1,X'20'         TURN ON END OF INPUT SW         23160000
         TM    IEHMVV20,X'C0'                                           23180000
         BZ    RET2                                                     23200000
          TM    SWITCHRD,ERRSCAN   SYNTAX ERROR                  A32046 23203020
          BZ    SCAEXIT1           *B IF NOT                     A32046 23206020
          LA    R2,16              CAUSE MSG MODULE TO GO TO ESK A32046 23209020
          LA    R3,9               INDIC MSG # 309               A32046 23212020
          B     ESAEXIT                                          A32046 23215020
         B     SCAEXIT1                                                 23220000
ERRDUMP  DS    0C                                                       23240000
         TM    IEHMVV20+3,X'20'        HAS CARD BEEN PRINTED            23260000
         BZ    SAVMESS                 BRANCH IF NO                     23280000
         MVI   ESSENTRY,X'00'          RESET RENTRY SW                  23300000
         MVI   ESTENTRY,X'00'          RESET RENTRY SW                  23320000
         OI    SWITCHRD,BYPASS    TURN SCAN BYPASS SWITCH ON       7474 23330017
         LA    R2,12                   CAUSE MSG MODULE TO XCTL TO EST  23340000
ESAEXIT  EQU   *                                                        23360000
       IEHPOST (14),T                                                   23380000
        XCTL  EP=IEHMVESA                                               23400000
INIT1    DS    0H                                                       23420000
         MVI   ESTENTRY,X'00'          RESET RENTRY SW                  23440000
         B     ESTEXIT                                                  23460000
SCAEXIT1 DS    0H                                                       23502802
         MVI ESTENTRY,X'0C'            SET EST ENTRY TO SCAEXIT1        23506402
         B     ESTEXIT                 WRITE MESSAGE           @Z40CSJH 23546608
FINDFROM DS    0H                                                       23553302
         MVI   ESTENTRY,X'04'          SET EST ENTRY TO FINDFROM        23560000
         B     ESTEXIT                                                  23580000
WRITEUT1 MVI   ESTENTRY,X'08'          SET EST ENTRY TO WRITEUT1        23600000
         B     ESTEXIT                                                  23620000
ESTEXIT  DS    0H                                                       23640000
       IEHPOST (14),T                                                   23660000
         XCTL  (4,12),EP=IEHMVEST                                       23680000
RET2     DS    0H                                                       23700000
       IEHPOST (14),T                                                   23720000
         XCTL  (4,12),EP=IEHMVESK                                       23740000
ERRDUMP1 DS    0H                                                       23760000
         MVI   DBREENTR,X'00'                                           23780000
         TM    XSWITCHS+1,X'20'         IS END OF INPUT ON              23800000
         BO    RET2                                                     23820000
         OI    SWITCHRD,BYPASS         TURN ON SCAN BYPASS SWITCH       23840000
         TM    SWITCHRD,SYSINEOF       IS SCAN EOF SWITCH ON            23860000
         BO    RET2                                                     23880000
         OI    DBCOMSW+3,CARDPRNT      TURN ON CARDPRINT CONTROL SWITCH 23900000
         B     INIT1                                                    23920000
SAVMESS  OI    DBFAADD,X'80'           TURN ON SAVE MESS SW             23940000
        STC   R3,IEHMVV00+130         SAVE MESSAGE NUMBER               23960000
         B     ERRDUMP1                                                 23980000
         DS    0F                                                       24000000
PATCH    DS    10F                      PATCH AREA             @Z40CSJH 24010008
         END                                                            24020000
./  ADD  SSI=73320045,NAME=IEHMVSSV
*TITLE 'IEHMVSSV                                                      * 00020000
*FUNCTION/OPERATION: THIS MODULE HANDLES THE MOUNTING OF THE FROM, TO * 00040000
*AND CVOL VOLUMES; AND OBTAINING THE DSCB ON THE FROM DATA SET IF IT  * 00060000
*RESIDES ON A DIRECT ACCESS DEVICE                                    * 00080000
*ENTRY POINTS: IEHMVESV                                               * 00100000
*INPUT: MOVE/COPY COMMUNICATIONS TABLE                                * 00120000
*OUTPUT: DSCB IN MOVE/COPY COMMUNICATIONS TABLE                       * 00140000
*EXTERNAL ROUTINES: IEHMVXSF                                          * 00160000
*EXITS-NORMAL XCTL IEHMVXSF; RETURN TO CALLING ROUTINE IEHMVSSZ       * 00180000
*ERRORS: UNABLE TO MOUNT REQUIRED VOLUMES                             * 00200000
*TABLES/WORKAREAS: MOVE/COPY COMMUNICATIONS TABLE                     * 00220000
*ATTRUBUTES: REUSEABLE                                                * 00240000
*NOTES: PART OF LOAD MODULE IEHMVESZ                                  * 00260000
*2050022200-024600                                                 4173 00270016
*2892074000                                                        DT0I 00275018
         EJECT                                                          00280000
IEHCULAT CSECT                                                          00300000
*A023946-023952,065460-065520                                  @ZA28250 00300199
*A023800-023940                                                @ZA16493 00300299
*C023960                                                       @ZA16493 00300399
*C056400,056600                                                @ZM30153 00300799
*A056500,089500,089520                                         @ZM30153 00300803
* 019100                                                         A29225 00301019
*                                                                A17911 00302018
* 014600-014800,025800-026800,027200-027400                      A17911 00304018
*                                                                A17911 00306018
* 014800,027600-027700                                           A24209 00310018
*036000-039400,040200-040800,046200-047200,087800                S21042 00312021
*                                                                       00320000
*                             REGISTER NOTATION AND USAGE               00340000
*                                                                       00360000
ZERO     EQU   0                                                        00380000
PARAM    EQU   1                                                        00400000
ACCE     EQU   2                                                        00420000
WORK2    EQU   2                                                        00440000
WORK3    EQU   3                                                        00460000
ACCO     EQU   3                                                        00480000
BASE     EQU   4                        BASE FOR IEHMVESV               00500000
M5       EQU   5                                                        00520000
M6       EQU   6                                                        00540000
DSCB     EQU   7                        BASE FOR DSCB DSECT             00560000
MCTABLE  EQU   12                       BASE FOR IEHMVV, WORK AREA      00580000
SAVE     EQU   13                      SAVE REG                         00600000
RETURN   EQU   14                       RETURN REG                      00620000
LINK     EQU   15                      ENTRY POINT REG                  00640000
*                                                                       00660000
*                             ASSEMBLER EQUATE STATEMENTS               00680000
*                                                                       00700000
CODE03   EQU   X'03'                    UNABLE TO LOCATE VOL INFO       00720000
CODE08   EQU   X'08'                    UNABLE TO MOUNT FROM VOLUME     00740000
CODE10   EQU   X'0A'                    DATA SET NOT FOUND              00760000
CODE12   EQU   X'0C'                    UNABLE TO COPY ON SAME VOLUME   00780000
*                                       WITHOUT RENAME FUNCTION         00800000
CODE19   EQU   X'13'                    DSORG FIELD IS INCORRECT A24209 00810018
CODE26   EQU   X'1A'                    UNABLE TO MOUNT TO VOL          00820000
UNMOVE   EQU   X'08'                                                    00840000
RENAME   EQU   X'04'                                                    00860000
COMTAB   EQU   16                       POINTER TO THE CVT              00880000
SYSRES   EQU   X'02'                                                    00900000
DASD     EQU   X'20'                                                    00920000
COPY     EQU   X'40'                                                    00940000
CATALOG  EQU   X'04'                                                    00960000
VOLUME   EQU   X'02'                                                    00980000
FROM     EQU   X'01'                                                    01000000
CVOL     EQU   X'40'                                                    01020000
*                                                                       01040000
*                             ENTRY AND EXTRN STATEMENTS                01060000
*                                                                       01080000
         ENTRY IEHMVESV                                                 01100000
         ENTRY RTNVM                                                    01120000
         ENTRY CALLMT                                                   01140000
         EXTRN COPYRTN                                                  01160000
         EXTRN KK1                                                      01180000
         EXTRN KK2                                                      01200000
         EXTRN PREABORT                                                 01220000
*                                                                       01240000
*                             ASSEMBLER USING STATEMENTS                01260000
*                                                                       01280000
         USING IEHMVV,MCTABLE                                           01300000
         USING DSCBDSEC,DSCB                                            01320000
         USING IEHMVESV,BASE                                            01340000
*                                                                       01360000
*                                                                       01380000
IEHMVESV SAVE  (14,12),T,IEHMVSSV-OZ28250                      @ZA28250 01400099
         LR    BASE,LINK                SET UP ADDRESSABILITY           01420000
         IEHPRE (14,1),TFC                                              01440000
         B     IEHMVESP                 OTHERWISE, GOTO MOUNT FROM VOL  01500000
IEHMVRSP DS    0H             ENTRY POINT TO TEST FOR COPY OPERATION    01520000
     TM   IEHMVV20,COPY                                                 01540000
    BO   COPYYES                                                        01560000
    TM   IEHMVV20,CATALOG                                               01580000
    BO   COPYYES                                                        01600000
NOTCOPY  DS    0H             ENTRY POINT TO FIND THE FROM DSCB.        01620000
*                             THE PERMANENT WORK AREA POINTER IS        01640000
*                             DISPLACED BY 140 BYTES TO BE OCCUPIED BY  01660000
*                             THE DSCB. IF THE FROM DEVICE IS DIRECT    01680000
*                             ACCESS, THE DSCB IS OBTAINED. OTHERWISE,  01700000
*                             NO MOUNTING OPERATION TAKES PLACE AND     01720000
*                             CONTROL IS RETURNED TO THE CALLER         01740000
         L     ACCE,IEHMVV10                                            01760000
         LA    ACCO,140(ACCE)                                           01780000
         ST    ACCO,IEHMVV10                                            01800000
         ST    ACCE,IEHMVV30+8               DSCB POINTER               01820000
     XC   0(140,ACCE),0(ACCE)                                           01840000
         L     ACCE,IEHMVV22+4          FROM DEVICE DASD                01860000
         CLI   2(ACCE),DASD                                             01880000
         BNE   IEHMVEEJ                PREPARE TO EXIT           A29225 01910019
         L     ACCE,IEHMVV30+8                                          01920000
*                                                                S21042 01930021
*  IF THE TTR OF THE 'FROM' DSCB IS AVAILABLE, IT IS CONVERTED   S21042 01932021
*  TO CCHHR AND THE DSCB OBTAIN'D BY SEEK CCHHR. IF NO TTR IS    S21042 01934021
*  AVAILABLE OR THE OBTAIN FAILS A SEARCH DSNAME OBTAIN IS DONE  S21042 01936021
*                                                                S21042 01938021
         OC    IEHMVV82(3),IEHMVV82    IS TTR ZERO ?             S21042 01938421
         BZ    SEARCH                  YES, SEARCH DSCB BY NAME  S21042 01938821
         L     PARAM,IEHMVV30+12       GET PTR TO 'FROM' DDNAME  S21042 01939221
         LA    PARAM,0(PARAM)    CLEAR HIGH-ORDER BYTE           S21042 01939421
         DEVTYPE (PARAM),INFO,DEVTAB   GET DEVICE CHARACTERISTICSS21042 01939621
         L     PARAM,IEHMVV82          GET TTR OF 'FROM' DSCB    S21042 01939721
         SRL   PARAM,8                 MOVE R TO RIGHTMOST BYTE  S21042 01939821
         STC   PARAM,CCHHR+4           SAVE R                    S21042 01939921
         SRL   PARAM,8                 MOVE TT TO RIGHTMOST BYTESS21042 01946621
         SR    ZERO,ZERO               CLEAR REG FOR DIVISION    S21042 01948621
         LH    M5,TRCYL                PICK UP NR OF TRKS/CYL    S21042 01950621
         DR    ZERO,M5                 DIVIDE TT BY TRKS/CYL     S21042 01952621
         STH   PARAM,CCHHR             SAVE CC                   S21042 01953021
         STH   ZERO,CCHHR+2            SAVE HH                   S21042 01953121
         LA    PARAM,CCHHR             GET ADDR OF CCHHR         S21042 01953221
         MVI   IEHMVV00,X'C0'          +INDICATE                 S21042 01959921
         MVI   IEHMVV00,X'80'          +SEEK MODE                S21042 01960021
         ST    PARAM,IEHMVV00+4        SET UP PTR TO CCHHR       S21042 01962021
         L     ACCO,IEHMVV22+4         +                         S21042 01964021
         LA    ACCO,4(ACCO)            +SET UP VOL SEQ NUMBER    S21042 01966021
         ST    ACCO,IEHMVV00+8         +                         S21042 01966421
         LA    ACCO,IEHMVV00+16        SET UP PTR                S21042 01966521
         ST    ACCO,IEHMVV00+12        TO WORK AREA              S21042 01973221
         OBTAIN IEHMVV00                                         S21042 01973321
*                                                                S21042 01975321
         LTR   LINK,LINK               OBTAIN SUCCESSFUL ?       S21042 01977321
         BNZ   SEARCH                  NO, SEARCH DSCB BY NAME   S21042 01979321
         L     ACCO,IEHMVV21           GET PTR TO 'FROM' DSNAME  S21042 01979721
         CLC   IEHMVV00+16(44),0(ACCO) SAME DSNAMES ?            S21042 01979821
         BNE   SEARCH                  NO, SEARCH DSCB BY NAME   S21042 01979921
         MVC   0(140,ACCE),IEHMVV00+16 MOVE DSCB                 S21042 01986521
         B     SKIPMT                  SKIP DSCB SEARCH BY NAME  S21042 01986621
*                                                                S21042 01988621
*  OBTAIN BY SEARCH DSNAME                                       S21042 01990621
SEARCH   DS    0H                                                S21042 01992621
         XC    IEHMVV00(20),IEHMVV00    INDICATE SEARCH MODE            01993621
         OI    IEHMVV00,X'C1'                                           02000221
         MVC   IEHMVV00+4(4),IEHMVV21   SET UP DSNAME                   02006821
         L     ACCO,IEHMVV22+4                                          02013421
         LA    ACCO,4(ACCO)             SET UP VOLUME SEQUENCE NUMBER   02020000
         ST    ACCO,IEHMVV00+8                                          02040000
         LA    ACCO,IEHMVV00+16         SET UP POINTER TO WORK AREA     02060000
         ST    ACCO,IEHMVV00+12                                         02080000
*                                                                       02100000
*                                                                       02120000
         OBTAIN IEHMVV00                                                02140000
*                                                                       02160000
         B     CUOBT(LINK)              CHECK OBTAIN RETURNS            02180000
CUOBT    DS    0H                                                       02200000
*                       RTN CODE       MEANING                     4173 02220016
         B     OBOK          0         DSCB FOUND                  4173 02240016
         B     EOBTAIN       4         VOL NOT MOUNTED, PRINT MSG  4173 02260016
         B     NTINVTOC      8         DSCB NOT FOUND IN VTOC      4173 02280016
         B     SVC27ERR      12        I/O ERR RETN FROM SVC27     4173 02300016
         B     SVC27ERR      16        WORK AREA ALLOC ERR SVC 27  4173 02320016
         B     SVC27ERR      20        VTOC EXTENT VIOLATED SVC 27 4173 02340016
NTINVTOC MVI   IEHMVV61,X'0A'          CODE FOR MSG MODULE         4173 02360016
         L     ACCO,IEHMVV23+4        ADDRESS OF ACTIVE TO VOL @ZA16393 02380099
         LA    ACCO,0(ACCO)            CLEAR HIGH ORDER BYTE   @ZA16393 02382099
         CLI   2(ACCO),X'80'           TO DEV TAPE ?           @ZA16393 02384099
         BNE   MSGNOUT                 NO, PRINT MSG IEH406I   @ZA16493 02386099
         TM    IEHMVV20,X'16'          DSGROP/VOLUME/CATALOG   @ZA16493 02388099
         BM    MSGNOUT                 YES, PRINT MSG IEH406I  @ZA16493 02390099
         OI    IEHMVV20+5,X'08'      SET TO WRITE A DUMMY FILE @ZA16493 02392099
         OI    IEHMVV20+1,X'01'        SET UNLOAD SWITCH       @ZA16493 02394099
         B     IEHMVEEJ                MOUNT TO VOLUME         @ZA28250 02394699
DUMMY    EQU   *                                               @ZA28250 02395299
         B     MSGNOUT                 PRINT MSG IEH406I       @ZA16493 02396099
SVC27ERR MVI   IEHMVV61,X'0E'          THIS WILL CAUSE THE MSG     4173 02400016
*                                      MODULE TO ISSUE THE I/O ERR 4173 02420016
*                                      MSG FOR THREE DIFF RTNS,NB  4173 02440016
MSGNOUT  L     LINK,PREAB              PREPARE TO LEAVE MODULE     4173 02460016
         BR    LINK                                                     02480000
OBOK     DS    0H                                                       02500000
         L     ACCO,IEHMVV21                                            02520000
         MVC   0(44,ACCE),0(ACCO)       MOVE DSNAME                     02540000
         MVC   44(96,ACCE),IEHMVV00+16  MOVE DSCB                       02560000
         L     ACCO,IEHMVV00+12        GET PTR TO WORKAREA       S21042 02610021
         L     PARAM,IEHMVV30+12       GET PTR TO 'FROM' DDNAME  S21042 02660021
         LA    PARAM,0(PARAM)    CLEAR HIGH ORDER BYTE           S21042 02665021
         DEVTYPE (PARAM),INFO,DEVTAB   GET DEVICE CHARACTERISTICSS21042 02670021
         MVC   CCHHR(5),96(ACCO)       MOVE CCHHR IN ABS ADDR LOCS21042 02680021
         LH    PARAM,CCHHR             GET CC                    S21042 02690021
         MH    PARAM,TRCYL             CONVERT CC TO TT          S21042 02692021
         AH    PARAM,CCHHR+2           GET TOTAL TT              S21042 02694021
         SLL   PARAM,8                 FREE RIGHTMOST BYTE       S21042 02696021
         IC    PARAM,CCHHR+4           INSERT R                  S21042 02698021
         SLL   PARAM,8                 MOVE TTR TO LEFT 3 BYTES  S21042 02698421
         ST    PARAM,IEHMVV82          SAVE TTR                  S21042 02698821
SKIPMT   DS    0H                                                       02700000
         TM    IEHMVV20,X'04'           IS THIS A CATALOG MOVE   A24209 02745018
         BZ    IEHMVEEJ                 NO. GO MOUNT TO VOLUME   A24209 02750018
  TM   DS1DSORG-DS1DSNAM(ACCE),X'E2'    IS DSORG =0              A24209 02755018
         BZ    IEHMVEEJ                 YES. GO MOUNT TO VOLUME  A24209 02760018
         MVI   IEHMVV61,CODE19          CATALOG HAS WRONG DSORG  A24209 02765018
         B     MSGNOUT                  GO TO PRINT MESSAGE      A24209 02770018
IEHMVREJ DS    0H             ENTRY POINT FOR LEAVING THIS PROGRAM      02780000
        IEHPOST (14,1),TC                                               02800000
*                                                                       02820000
         MVC   12(4,SAVE),MNOP          SET UP ADDRESS FOR ENTRY INTO   02840000
*                                       IEHMVSSZ. ENTRY POINT IS        02860000
*                                       CALLED COPYRTN.                 02880000
         RETURN (14,12),T                                               02900000
COPYYES  DS    0H             ENTRY POINT FOR COPY OPERATION            02920000
         TM    IEHMVV20+3,RENAME       IS RENAME SPECIFIED              02940000
         BO    NOTCOPY                  YES ALLOW COPY ON SAME VOLUME   02960000
         L     ACCE,IEHMVV22            NO. GET POINTERS TO THE FROM    02980000
*                                       AND TO VOLUME LISTS AND COMPARE 03000000
*                                       THE VOLUME SERIAL NUMBERS       03020000
         L     ACCO,IEHMVV23+4                                          03040000
         CLC   4(6,ACCE),4(ACCO)                                        03060000
         BNE   NOTCOPY                  IT THE VOLUME IDS ARE NOT EQUAL 03080000
*                                       CONTINUE PROCESSING             03100000
         MVI   IEHMVV61,CODE12          IF EQUAL, ABORT STEP WITH MSG   03120000
*                                       UNABLE TO COPY ON SAME VOLUME   03140000
*                                       STEP WILL BE TERMINATED IF AN   03160000
*                                       ATTEMPT IS MADE TO COPY ONTO    03180000
*                                       THE SAME VOLUME WITHOUT         03200000
*                                       SPECIFYING THE RENAME FUNCTION  03220000
GOOUT    L     LINK,PREAB                                               03240000
         BR    LINK                                                     03260000
EOBTAIN  DS    0H             ENTRY POINT TO ABORT A REQUEST IF THE     03280000
*                             FROM VOLUME CANNOT BE MOUNTED             03300000
         MVI   IEHMVV61,CODE08          SET MSG CODE UNABLE TO MOUNT    03320000
*                                       FROM VOLUME                     03340000
         B     GOOUT                                                    03360000
IEHMVESP DS    0H             ENTRY POINT FOR MOUNTING THE FROM VOLUME  03380000
         TM    IEHMVV20,FROM            FROM VOL SPECIDIED              03400000
         BO    MTFROM                   YES,PROCEED TO MOUNT FROM VOL   03420000
*                                                                       03440000
*                                       NO, TEST FOR CVOL               03460000
         TM    IEHMVV20+1,CVOL          CVOL SPECIFIED                  03480000
         BO    MTCVOL                   YES, PROCEED TO MOUNT CVOL      03500000
*                                                                       03520000
      TM    IEHMVV20,CATALOG            CATALOG FUNCTION                03540000
         BO    SYSCAT         IF YES, CHECK TO SEE IF SYSTEM RESIDENCE  03560000
*                             VOLUME HAS BEEN MOUNTED                   03580000
GOLO     DS    0H                                                       03960000
         L     M5,IEHMVV10                                              03980000
         LA    M5,4(M5)                                                 04000000
         IC    ACCE,IEHMVV22           GET NUMBER OF VOLUMES     S21042 04020021
         LA    ACCO,12                                                  04100000
         MR    ACCE,ACCO                GET LENGTH OF LIST              04120000
         EX    ACCO,LOMO                MOVE THE VOLUME LIST TO THE     04140000
*                                       PERMANENT WORK AREA, READJUST   04160000
*                                       POINTER TO THE BEGINNING OF     04180000
*                                       THIS WORK AREA AND GO TO MOUNT  04200000
*                                       THE FROM VOLUME                 04220000
         AR    M5,ACCO                                                  04240000
         ST    M5,IEHMVV10                                              04260000
         B     MTFROM                                                   04280000
MTCVOL   DS    0H             ENTRY POINT FOR MOUNTING CONTROL VOLUME   04300000
*                             WHEN CVOL IS SPECIFIED                    04320000
         L     PARAM,IEHMVV24           GET PNTR TO CVOL LIST           04340000
         MVI   IEHMVV00+4,X'90'         SET UP INDICATOR                04360000
         MVI   IEHMVV00+400,X'00'       SET CODE FOR VOLUME MOUNTING    04380000
*                                       ROUTINE TO RETURN HERE          04400000
         BAL   RETURN,CALLMT            GO TO VOLUME MOUNTER            04420000
RTN100   DS    0H             RETURN IS HERE FROM VOLUME MOUNTER WITH   04440000
*                             RETURN CODES IN REGISTER 15 AS FOLLOWS    04460000
*                                                                       04480000
*                             0 =  VOLUME NOT MOUNTED                   04500000
*                             4 =  VOLUME MOUNTED                       04520000
         B     TETMTR(LINK)                                             04540000
TETMTR   B     BADMT                                                    04560000
         TM    IEHMVV20,CATALOG         CATALOG ;UNCTION                04580000
     BO   CVOLCAT                                                       04600000
         B     GOLO                    READJUST PTR TO WORKAREA  S21042 04620021
*                                       INFORMATION FOR NEXT DATA SET   04740000
*                                       TO BE MOVED                     04760000
MTFROM   DS    0H             ENTRY POINT FOR MOUNTING FROM VOLUME      04780000
         L     PARAM,IEHMVV22           GET PNTR TO FROM VOLUME LIST    04800000
         MVI   IEHMVV00+4,X'90'         SET UP INDICATOR                04820000
         MVI   IEHMVV00+400,X'04'       SET CODE FOR VOLUME MOUNTER TO  04840000
*                                       TO RETURN HERE                  04860000
         BAL   RETURN,CALLMT            GO TO VOLUME MOUNTER            04880000
RTN200   DS    0H             RETURN FROM VOLUME MOUNTER HERE           04900000
*                             RETURN CODES ARE                          04920000
*                                                                       04940000
*                             0 = VOLUME NOT MOUNTED                    04960000
*                             4 = VOLUME MOUNTED                        04980000
         B     TESTMTR(LINK)            MOUNT OK                        05000000
TESTMTR  B     BADMT                    NO                              05020000
         ST    PARAM,IEHMVV30+12        IF MOUNT OK, SAVE POINTER TO    05040000
*                                       FROM DDNAME RETURNED BY VOLUME  05060000
*                                       MOUNTER                         05080000
         MVC   IEHMVV22+4(4),IEHMVV22   UPDATE ACTIVE FROM VOL LIST     05100000
         B     IEHMVRSP                 PNTR AND RETURN TO CHECK FOR    05120000
*                                       COPY OPERATION                  05140000
BADMT    DS    0H             ENTRY POINT FOR ABORTING REQUEST IF       05160000
*                             VOLUME NOT MOUNTED                        05180000
         MVI   IEHMVV61,CODE08          SET MSG CODE UNABLE TO MOUNT    05200000
*                                       FROM VOLUME AND ABORT THE       05220000
*                                       REQUEST                         05240000
         L     LINK,PREAB                                               05260000
         BR    LINK                                                     05280000
LOMO     MVC   0(1,M5),IEHMVV00+18                                      05300000
CVOLCAT  DS    0H             ENTRY POINT FOR UPDATING THE FROM VOLUME  05320000
*                             LIST POINTER FOR A CATALOG MOVE REQUEST   05340000
    MVC   IEHMVV22(4),IEHMVV24                                          05360000
         B     MTFROM                   RETURN TO MOUNT FROM VOLUME     05380000
SYSCAT   DS    0H             ENTRY POINT FOR CHECKING IF THE SYSTEM    05400000
*                             RESIDENCE VOLUME IS MOUNTED               05420000
         L     WORK2,COMTAB             GET POINTER TO THE CVT          05440000
         L     WORK2,40(WORK2)          AND POINTER TO THE UCB TABLE    05460000
*                                       OF ADDRESSES                    05480000
*                             AT THIS POINT THE UCB TABLE IS SEARCHED   05500000
*                             FOR THE SYSTEM RESIDENCE UCB. IF NOT      05520000
*                             FOUND, THE STEP IS ABORTED. IF FOUND,     05540000
*                             DEVICE CLASS AND VOLUME INFORMATION ARE   05560000
*                             MOVED FROM THE UCB TO THE PERMANENT       05580000
*                             WORK AREA AND CONTROL IS RETURNED TO      05600000
*                             MOUNT SYSTEM RESIDENCE AS THE FROM VOLUME 05620000
VON      ICM   WORK3,3,0(WORK2)         GET UCB PTR            @ZM30153 05640003
         N     WORK3,FOXES              ZERO LEFT HALF OF REG  @ZM30153 05650003
         C     WORK3,FOXES              END OF UCB TABLE?      @ZM30153 05660003
         BE    BADMT                    YES. ABORT                      05680000
         TM    3(WORK3),SYSRES          NO. IS THIS THE SYS RES UCB     05700000
         BO    VFIND                    YES                             05720000
NNVV     DS    0H                                                       05740000
         LA    WORK2,2(WORK2)           NO.INCREMENT PNTR TO UCB TABLE  05760000
         B     VON                      AND CONTINUE SEARCH             05780000
VFIND    DS    0H                                                       05800000
         CLI   18(WORK3),DASD           IS DEVICE CLASS DIRECT ACCESS   05820000
*                             IF NO, RETURN TO UCB TABLE SEARCH. IF YES 05840000
*                             MOVE DEVICE CLASS AND VOLUME SERIAL       05860000
*                             NUMBER FROM THE UCB TO THE PERMANET WORK  05880000
*                             AREA, UPDATE THE ACTIVE FROM VOL LIST     05900000
*                             PNTR AND THE PERMANENT WORK AREA PNTR     05920000
*                             AND RETURN TO MOUNT THE FROM VOLUME       05940000
   BNE  NNVV                                                            05960000
    L    ACCE,IEHMVV10                                                  05980000
    LA   ACCE,4(ACCE)                                                   06000000
     XC    10(2,ACCE),10(ACCE)                                          06020000
     MVC   0(4,ACCE),16(WORK3)                                          06040000
       MVC   4(6,ACCE),28(WORK3)                                        06060000
    ST    ACCE,IEHMVV22                                                 06080000
    LA   ACCO,1                                                         06100000
         STC   ACCO,IEHMVV22                                            06120000
   MVC    IEHMVV22+4(4),IEHMVV22                                        06140000
     LA   ACCO,12(ACCE,0)                                               06160000
    ST   ACCO,IEHMVV10                                                  06180000
     B    MTFROM                                                        06200000
IEHMVEEJ DS    0H             ENTRY POINT FOR MOUNTING THE TO VOLUME    06220000
         L     PARAM,IEHMVV23+4         GET PNTR TO ACTIVE TO VOL       06240000
         MVI   IEHMVV00+4,X'B0'         INDICATE TO VOLUME MOUNTER THAT 06260000
*                                       OLD MOUNTS ARE VALID            06280000
         MVI   IEHMVV00+400,X'08'       SET CODE FOR VOLUME MOUNTER TO  06300000
*                                       RETURN HERE                     06320000
         BAL   RETURN,CALLMT            GO TO VOLUME MOUNTER            06340000
RTN300   DS    0H             RETURN HERE FORM VOLUME MOUNTER           06360000
*                             RETURN CODES ARE                          06380000
*                                                                       06400000
*                             0 =  TO VOLUME HAS NOT BEEN MOUNTED       06420000
*                             4 =  TO VOLUME MOUNTED                    06440000
         B     TOTST(LINK)                                              06460000
TOTST    DS    0H                                                       06480000
         B     BADMTTO                  VOLUME NOT MOUNTED, ABORT       06500000
         ST    PARAM,IEHMVV31+8         YES.SAVE PNTR TO THE DDNAME     06520000
*                                       RETURNED BY VOLUME MOUNT AND    06540000
         TM    IEHMVV20+5,X'08'  SHALL A DUMMY FILE BE WRITTEN @ZA28250 06546099
         BO    DUMMY                    YES, BRANCH BACK       @ZA28250 06552099
         B     IEHMVREJ                 EXIT FROM THE PROGRAM           06560000
BADMTTO  DS    0H                                                       06580000
         MVI   IEHMVV61,CODE26          SET MSG CODE UNABLE TO MOUNT    06600000
*                                       TO VOLUME AND ABORT REQUEST     06620000
         L     LINK,PREAB                                               06640000
         BR    LINK                                                     06660000
CALLMT   DS    0H             ENTRY POINT FOR SETTING UP VOLUME         06680000
*                             MOUNTING REQUEST AND GIVING CONTROL TO    06700000
*                             IEHMVXSF WHICH IS THE VOLUME MOUNTING     06720000
*                             ROUTINE                                   06740000
*                                                                       06760000
*                             REGISTER 1 CONTAINS A POINTER TO THE      06780000
*                             VOLUME LIST WHICH THE VOLUME MOUNTING     06800000
*                             ROUTINE USES TO DETERMINE WHAT VOLUME TO  06820000
*                             MOUNT.                                    06840000
*                                                                       06860000
*                             THE VOLUME MOUNTING REQUEST IS BUILT BY   06880000
*                             THIS ROUTINE AT IEHMVV00                  06900000
*                                                                       06920000
*                             IEHMVSSZ CONTAINS EXTERNAL REFERENCES TO  06940000
*                             THIS ROUTINE                              06960000
*                             IEHMVSSZ USES THIS ROUTINE TO MOUNT THE   06980000
*                             FROM AND TO VOLUMES WHEN A VOLUME MOVE    07000000
*                             OPERATION IS REQUESTED                    07020000
*                                                                       07040000
*                             PARAMETERS PASSED TO IEHMVXSF ARE         07060000
*                                                                       07080000
*                             REGISTER 3     PNTR TO THE VOLUME         07100000
*                                            MOUNTING REQUEST           07120000
*                             REGISTER 4     RETURN INDICATOR 'SZ'      07140000
*                                            SPECIFIES THAT IEHMVXSF    07160000
*                             IS TO GIVE CONTROL TO IEHMVSSZ AFTER THE  07180000
*                             VOLUME HAS BEEN MOUNTED                   07200000
*                             IF THE VOLUME HAS BEEN MOUNTED, IEHMVSSZ  07220000
*                             RETURNS CONTROL TO THIS MODULE AT         07240000
*                             ALTERNATE ENTRY POINT, RTNVM.             07260000
         DROP  BASE                                                     07280000
         BALR  LINK,ZERO                                                07300000
         USING *,LINK                                                   07320000
         MVC   IEHMVV00+5(3),IEHMVV50+5 SET UP PNTR TO INTERNAL TABLE   07340000
         MVC   IEHMVV00+10(1),IEHMVV50+4                                07360000
         MVI   IEHMVV00+11,X'01'        SET UP NUMBER OF REQUESTS       07380000
         MVC   IEHMVV00+12(19),0(PARAM)  SET UP DEVICE CLASS       DT0I 07390018
*                                      AND VOLUME                  DT0I 07400018
*                                       SERIAL NUMBER                   07420000
         LA    ACCO,IEHMVV00            SET UP PARAMETERS, PNTR TO      07440000
         L     BASE,DOG                 VOLUME MOUNTING REQUEST AND     07460000
*                                       SUFFIX OF MODULE TO BE GIVEN    07480000
*                                       CONTROL BY IEHMVXSF             07500000
         TM    IEHMVV00+400,X'F0'                                       07520000
         BM    OVERPOST                                                 07540000
         IEHPOST (14,1),T                                               07560000
OVERPOST DS    0H             PASS CONTROL TO IEHMVXSF VIA XCTL         07580000
         BALR  M6,ZERO                                                  07600000
         USING *,M6                                                     07620000
         DROP  LINK                                                     07640000
    XCTL  EP=IEHMVXSF                                                   07660000
         DROP  M6                                                       07680000
         USING *,RETURN                                                 07700000
         EJECT                                                          07720000
RTNVM    DS    0H             ALTERNATE ENTRY POINT FOR THIS MODULE     07740000
*                             GIVEN CONTROL BY IEHMVSSZ                 07760000
*                             THIS ROUTINE TESTS FOR GOOD VOLUME        07780000
*                             MOUNTING OPERATION                        07800000
*                                                                       07820000
*                             IT RETURNS A CODE IN REGISTER 15 TO THE   07840000
*                             ROUTINE WHICH REQUESTED THE VOLUME        07860000
*                             MOUNTING AS FOLLOWS                       07880000
*                                                                       07900000
*                             0 = VOLUME NOT MOUNTED                    07920000
*                             4 = VOLUME MOUNTED                        07940000
*                                                                       07960000
*                             IF THE VOLUME WAS MOUNTED, REGISTER 1     07980000
*                             CONTAINS A POINTER TO THE DDNAME USED     08000000
*                                                                       08020000
*                             THIS ROUTINE DETERMINES WHICH MODULE IS   08040000
*                             TO RECEIVE CONTROL NEXT ON THE BASIS OF   08060000
*                             A CODE PLACED AT IEHMVV00+400 BY THE      08080000
*                             ROUTINE WHICH REQUESTED THE VOLUME        08100000
*                             MOUNTING.                                 08120000
         SR    LINK,LINK                SETUP RETURN CODE 0             08140000
         TM    IEHMVV00+4,X'01'         WAS VOLUME MOUNTED              08160000
         BZ    NOMOUNT                  NO                              08180000
         LA    LINK,4                   YES.RETURN CODE 4 GOOD MOUNT    08200000
         L     PARAM,IEHMVV00+4         GET PNTR TO INTERNAL TABLE      08220000
         LA    PARAM,0(PARAM)           ZERO HIGH ORDER BYTE            08240000
         AH    PARAM,IEHMVV00+22        ADJUST PNTR TO RELATIVE TABLE   08260000
*                                       ADDRESS WITHIN THE INTERNAL TAB 08280000
         L     PARAM,0(PARAM)           GET PNTR TO DDNAME              08300000
NOMOUNT  DS    0H                                                       08320000
         TM    IEHMVV00+400,X'F0'                                       08340000
         L     BASE,ABSE                                                08360000
         BM    OVERPRE                                                  08380000
         DROP  RETURN                                                   08400000
         USING IEHMVESV,BASE                                            08420000
         IEHPRE (14,1),T                                                08440000
OVERPRE  SR    RETURN,RETURN                                            08460000
         IC    RETURN,IEHMVV00+400      PICK UP VALUE TO BE USED IN     08480000
*                                       COMPUTING CORRECT RETURN        08500000
*                                       LOCATION. VALUES ARE AS         08520000
*                                       INDICATED BELOW.                08540000
         B     DDRTN(RETURN)                                            08560000
DDRTN    B     RTN100              00 = RETURN TO SSV                   08580000
         B     RTN200              04 = RETURN TO SSV                   08600000
         B     RTN300              08 = RETURN TO SSV                   08620000
         B     RTN100              12 = RETURN TO SSV                   08640000
         B     AB101               16 = RETURN TO SSZ                   08660000
         L     RETURN,AB200        20 = RETURN TO SSZ                   08680000
         BR    RETURN                                                   08700000
AB101    L     RETURN,AB100                                             08720000
         BR    RETURN                                                   08740000
         EJECT                                                          08760000
*                                      DC AND DS STATEMENTS      S21042 08780021
*                                                                       08800000
AB100    DC    A(KK1)         EXTERNAL REFERENCE TO IEHMVSSZ            08820000
AB200    DC    A(KK2)         EXTERNAL REFERENCE TO IEHMVSSZ            08840000
MNOP     DC    A(COPYRTN)     EXTERNAL REFERENCE TO IEHMVSSZ            08860000
ABSE     DC    A(IEHMVESV)    ENTRY POINT FOR THIS MODULE               08880000
PREAB    DC    A(PREABORT)    EXTERNAL REFERENCE TO IEHMVSSZ            08900000
         DS    0F                                                       08920000
FF       DC    4X'FF'                                                   08940000
FOXES    DC    X'0000FFFF'              BIT SETTINGS TO        @ZM30153 08950003
*                                       CLEAR REGISTER         @ZM30153 08952003
DOG      DC    C'  SZ'                                                  08960000
INFO     DS    0CL20                   +                         S21042 08970021
         DS    CL10                    +DEVICE TYPE              S21042 08972021
TRCYL    DS    CL2                     +CHARACTERISTICS          S21042 08974021
         DS    CL8                     +                         S21042 08976021
CCHHR    DS    CL5                     ABS ADDR OF 'FROM' DSCB   S21042 08978021
         EJECT                                                          08980000
ITHEAD   DSECT                                                          09000000
GENERICC DS    CL1                      GENERIC NAME COUNT              09020000
GENERICP EQU   GENERICC                 POINTER TO GENERIC DDNAMES      09040000
         DS    CL3                                                      09060000
INDICATO DS    CL1                      INDICATOR BYTE                  09080000
*                                                                       09100000
MOUNT    EQU   X'80'                                                    09120000
SELECT   EQU   X'40'                                                    09140000
OLDVALID EQU   X'20'                                                    09160000
TABLE    EQU   X'10'                                                    09180000
YESMOUNT EQU   X'01'                                                    09200000
*                                                                       09220000
         DS    CL3                                                      09240000
PTRINTAB EQU   INDICATO                                                 09260000
LENINTAB DS    CL2                                                      09280000
CNTINTAB DS    CL1                                                      09300000
CNTVMR   DS    CL1                                                      09320000
         TITLE 'DSCB FORMAT'                                            09340000
DSCBDSEC DSECT                                                          09360000
         IECSDSL1 (1)                                                   09380000
         TITLE 'MOVE-COPY COMMUNICATIONS TABLE'                         09400000
         IEHMVV                                                         09420000
         ORG   IEHMVV00                                                 09440000
         IEFJFCBN                                                       09460000
         TITLE 'DCB FORMAT'                                             09480000
         DCBD  DSORG=(PS,IS,DA,PO)                                      09500000
         END                                                            09520000
./  ADD  SSI=80890138,NAME=IEHMVSSX
         TITLE 'IEHMVSSX-BUILD DCB AND GO TO DADSM'                     00010032
*TITLE--IEHMVSSX--RENAME AND REBLOCK FOR IEHMOVE LOAD MODULE ESV-  UL0H 00020032
*FUNCTION/OPERATION: THIS MODULE HANDLES RENAMING OF DATA SETS AND THE* 00040000
*ALLOCATION OF THE TO DATA SET. IT ALSO HANDLES REBLOCKING PARAMETERS * 00060000
*AND PREALLOCATED DATA SETS                                           * 00080000
*ENTRY POINTS: IEHMVESX                                               * 00100000
*INPUT: MOVE/COPY COMMUNICATIONS TABLE                                * 00120000
*OUTPUT: NONE                                                         * 00140000
*EXTERNAL ROUTINES: IEHMVSTC                                          * 00160000
*EXITS-NORMAL RETURN TO CALLING RETURN-IEHMVSRY                       * 00180000
*ERRORS: UNABLE TO ALLOCATE TO DATA SET                               * 00200000
*TABLES/WORK AREAS: MOVE/COPY COMMUNICATIONS TABLE                    * 00220000
*ATTRIBUTES: REUSEABLE                                                * 00240000
*NOTES: PART OF LOAD MODULE IEHMVESV                                  * 00260000
*                                                                       00280000
*                                                                       00320000
*                                                                       00340000
*        PURPOSE    THIS ROUTINE CONSTRUCTS THE PROPER DCB'S AND        00360000
*                   ACQUIRES SPACE ALLOCATION FOR THE TO DATASET.       00380000
*                                                                       00400000
*        CHART SX                                                       00420000
*                                                                       00440000
*                                                                       00460000
*        INSERT THE CALLING SEQUENCE                                    00461037
IEHMVSSX CSECT                                                          00462037
*A075300                                     @XA21512-@YA20602-@ZA30700 00462199
*C077060-077140                                                @ZA31059 00463099
*C034227,034304,038544                       @XA19907-@YA19884-@ZA28198 00463299
*D034312-034384,038520-038540                @XA19907-@YA19884-@ZA28198 00463399
*A065760-065768,065784,067800-067804                           @ZA24602 00463499
*C067805                                                       @ZA24602 00463599
*A067800-067880                              @ZA18362-@XA16955-@YA15387 00463699
*C067900                                     @ZA18362-@XA16955-@YA15387 00463799
*C056900                                     @ZA16483-@XA16944-@YA15376 00463899
*A046225-046227                              @ZA13789-@XA16035-@YA14040 00463999
*C034384,046200,046228                       @ZA13789-@XA16035-@YA14040 00464037
*D034301-034302                              @ZA13789-@XA16035-@YA14040 00465037
*A023263-023342                                                @ZA11963 00467037
*C023350,023418                                                @ZA11963 00470037
*A034301-034302                                                @ZA10937 00470732
*C034384,046200                                                @ZA11931 00471037
*A019614,020900-020960,080981                                  @ZA07399 00472037
*C020400,020800,021000-021200,021600                           @ZA07399 00473037
*C006000,034130-034140                                         @ZA07359 00475037
*A056830-056860                                                @ZA06516 00476037
*A034220-034304                                                @ZA04412 00477037
*D034220-034306                                                @ZA04412 00480637
*A065987-066001                                                @ZA04409 00482037
*C038804                                                       @ZA03353 00483037
*A046200-046244                                                @ZA01734 00483737
*D046200                                                       @ZA01734 00484437
*A067720-067760                                                @ZA01727 00485137
*D062945-062955                                                @ZA01727 00486837
*A062802-062812,062945-062955                                  @ZA01244 00488037
*A038804-038810                                                @ZA01243 00489037
*D038804-038809                                                @ZA01243 00490037
*A034346-034347                                                @ZA01238 00491037
*A056900                                                       @ZA01234 00492037
*C044950,054150                                                @ZM30153 00493037
*A033250                                                       @ZA01233 00494037
*A044920,054144                                                @ZM30153 00495037
*D033250-033550                                                @ZA01233 00496037
*A058150-058190                                                @YA02601 00497037
*D058150                                                       @YA02601 00498037
*A023086-023087                                                @YA02577 00499037
*A034306-034384,081405                                         @YA02566 00500202
*A079135                                                       @YA01681 00501037
*C023065,023075                                                @YA01681 00502037
*C079137                                                       @YA01720 00502837
*A023252-023298,080980-080982                                   YA01684 00503237
*A053850-054510                                                 YA01675 00505037
*D053850-054400                                                 YA01675 00506037
*A022920,023050-023090,033733-033787,035300-035320,035450-035730YA01193 00507037
*A038498-038514,038800-038804,041900-042260,042550-042570       YA01193 00508037
*A043345-043346,081810-081820                                   YA01193 00509037
*C034400-034520,034700-035000,042650-043050,043344              YA01193 00510037
*D023050,035300,035450-035700,038498-038500,038800-038803       YA01193 00511037
*D041900-042300,042550                                          YA01193 00512037
*A008600                                                        YA01219 00513037
*C066670                                                        YA01219 00514037
*A019600-019800,066790-066820,081400-081440                     OY01172 00515037
*D019800                                                        OY01172 00516037
*A034240-034400                                                 OY01179 00516837
*C054000-054200                                                  A45176 00517637
*D022420,023300-023900,028650-029050                            OY01192 00518437
*A029650-033910                                                 OY01178 00519237
*C023050                                                        OY01175 00520337
*C044650,044700                                                 OY01178 00521337
*A014040,079138                                                 OY01175 00523037
*D029650-034120                                                 OY01178 00524037
*A013950,022402-022432,023300-023450,029300                     OY01192 00525037
*D065800-067042                                                  A45147 00525937
*C059370                                                         A45147 00526937
*A013660,013720,059370-059395,065800-066940                      A45147 00527937
*                                                                A44334 00528937
*023450,023550,023650                                            S21042 00529937
*063400-063600,066000,066400,066630,077060,077180                S21042 00530937
*                                                               PTM6813 00531937
*066600                                                          A36065 00532937
*007800-009000,009400-010800,011600-011800,012200-012400,013920- S20201 00533937
*-017600,022400-051200,066750,067600,071800,072200,081200-084400 S20201 00534937
*085860,085920                                                   S20201 00535937
*  ALL CODE FLAGGED S20201 WAS ADDED OR CHANGED FOR              S20201 00536937
*  MERLIN/ZEUS SUPPORT                                           S20201 00537937
*                                                                A30639 00538937
*                                                                A30084 00540019
* 027870-027880                                                  A25571 00560518
*1600022200                                                        0659 00561017
*2572 005400                                                            00562017
*1600                                                              2695 00565017
*1600036300-036500,038804-038972                                   3919 00570017
*1600                                                           PTM1219 00575017
*036800,042200,042600                                             19030 00575719
*--ANY STATEMENTS FLAGGED 19030 PERTAIN TO VARIABLE SPANNED RECORD--    00576419
*--SUPPORT FOR BDAM DATA SETS                                           00577119
*037000-037200                                                   A27060 00577819
*                                                                A27710 00578519
*066200                                                          A27312 00579219
*                                                                       00580000
*       VS2 RELEASE2 SU32                                      @G32DSFS 00583032
*058202-058204,077060-077140                                   @ZM44439 00586099
*058190-058393,067260-067312                                   @G32DSFS 00589032
*                                                                       00592032
*                                                                       00595032
IEHMVESX SAVE  (14,12),T,IEHMVSSX-OZ30700-SU32                 @ZA30700 00600099
         ENTRY IEHMVESX                                                 00620000
         LR    BASE,LINK                                                00640000
         USING IEHMVESX,BASE                                            00660000
    IEHPRE  (14,1),TFC,                                                 00680000
*                                                                       00700000
*                                                                       00720000
         USING IEHMVV,MCTABLE                                           00740000
*                                                                       00760000
         EXTRN IEHMVETC                                          S20201 00810020
*                                                                S20201 00860020
MOVE     EQU   X'80'                   KEYWORD 'MOVE' SPECIFIED YA01219 00860402
PDS      EQU   X'08'                                                    00920000
EXPAND   EQU   X'04'                                                    01100000
LOAD     EQU   X'02'                                                    01120000
UNLOAD   EQU   X'01'                                                    01140000
PHONYTO  EQU   X'10'                                                    01200000
RENAME   EQU   X'04'                                                    01260000
PREALBIT EQU   X'08'                                                    01280000
PREALLOC EQU   X'20'                                                    01300000
CATALOGF EQU   X'04'                                                    01320000
VBLOCKED EQU   X'10'                                                    01340000
FBLOCKED EQU   X'20'                                                    01360000
VOLUME   EQU   X'02'                                             A45147 01366021
PSBIT    EQU   X'40'                                             A45147 01372021
PDSBIT   EQU   X'02'                                                    01380000
LABALLO  EQU   X'40'                   FLAG DSCB FOR U.L. TRK ALLO UL0H 01390017
MODLDSCB EQU   X'08'                   MODEL-DSCB INDICATOR      A45176 01395022
DUMP     EQU   X'01'                                             S20201 01396020
BDAM     EQU   X'20'                                             S20201 01402020
X22      EQU   X'22'                                            OY01175 01405002
*                                                                S20201 01408020
***      REGISTER EQUATIONS ****                                 S20201 01414020
*                                                                S20201 01420020
R0       EQU   0                                                 S20201 01426020
PASSA    EQU   R0                                                S20201 01432020
*                                                                S20201 01438020
R1       EQU   1                                                 S20201 01444020
PASSB    EQU   R1                                                S20201 01450020
*                                                                S20201 01456020
R2       EQU   2                                                 S20201 01462020
*                                                                S20201 01468020
R3       EQU   3                                                 S20201 01474020
*                                                                S20201 01480020
R4       EQU   4                                                 S20201 01486020
ACCE     EQU   R4                                                S20201 01492020
*                                                                S20201 01498020
R5       EQU   5                                                 S20201 01504020
ACCO     EQU   R5                                                S20201 01510020
*                                                                S20201 01516020
R6       EQU   6                                                 S20201 01522020
M6       EQU   R6                                                S20201 01528020
*                                                                S20201 01534020
R7       EQU   7                                                 S20201 01540020
*                                                                S20201 01546020
R8       EQU   8                                                 S20201 01552020
*                                                                S20201 01558020
R9       EQU   9                                                 S20201 01564020
*                                                                S20201 01570020
R10      EQU   10                                                S20201 01576020
*                                                                S20201 01582020
R11      EQU   11                                                S20201 01588020
BASE     EQU   R11                                               S20201 01594020
*                                                                S20201 01600020
R12      EQU   12                                                S20201 01606020
MCTABLE  EQU   R12                                               S20201 01612020
*                                                                S20201 01618020
R13      EQU   13                                                S20201 01624020
SAVE     EQU   13                                                S20201 01630020
*                                                                S20201 01636020
R14      EQU   14                                                S20201 01642020
RETURN   EQU   R14                                               S20201 01648020
*                                                                S20201 01654020
R15      EQU   15                                                S20201 01660020
LINK     EQU   R15                                               S20201 01666020
*                                                                S20201 01672020
*                                                                S20201 01678020
*                                                                S20201 01684020
         EJECT                                                          01690020
         L     R0,WALENGTH             GET LENGTH FOR GETMAIN    S20201 01696020
         GETMAIN  R,LV=(R0)            GET WORK AREA             S20201 01702020
         LR    R10,R1                  ESTABLISH ADDRESSABILITY  S20201 01708020
         USING WORKAREA,R10            TO WORKAREA               S20201 01714020
*                                                                S20201 01720020
*                                                                       01780000
         TM    IEHMVV20+3,RENAME   TEST RENAME BIT                      01800000
         BO    NOV                                                      01820000
         L     ACCE,IEHMVV22       ADDRESS OF FROM VOLUME LIST          01840000
         L     ACCO,IEHMVV23+4     ADDRESS OF ACTIVE TO VOLUME          01860000
         CLC   4(6,ACCE),4(ACCO)   COMPARE VOLUME ID OF TO & FROM VOLS  01880000
         BE    ENAMEX                                                   01900000
         MVC   IEHMVV21+4(4),IEHMVV21 SET ADDR OF TO & FROM DS NAMES =  01920000
         B     NOV                                                      01940000
ENAMEX   DS    0H                                                       01960000
         TIME  ,                                                OY01172 01961002
         ST    R0,SAVEREG0             SAVE REG0               @ZA07399 01961537
         XC    DW,DW                                            OY01172 01962002
         STH   R1,DW+6                                          OY01172 01963002
         CVB   R4,DW                                            OY01172 01964002
         STH   R4,DW+6                                          OY01172 01965002
         MVC   TIMEDATE+1(2),DW+6                               YA01172 01965502
         SR    R0,R0                                            OY01172 01966002
         SLDL  R0,16                                            OY01172 01967002
         SLL   R1,12                                            OY01172 01968002
         SRDL  R0,28                                            OY01172 01969002
         STH   R1,DW+6                                          OY01172 01970002
         CVB   R4,DW                                            OY01172 01971002
         STC   R4,TIMEDATE                                      OY01172 01972002
         L     R2,IEHMVV30+8                                    OY01172 01973002
         MVC   DSCBDATE(3),56(R2)                               OY01172 01974002
         CLC   TIMEDATE(3),DSCBDATE                             OY01172 01975002
         BNL   GOON                                             OY01172 01976002
         B     MSGNOMOV                                         OY01172 01977002
GOON     L     ACCE,IEHMVV10                                    OY01172 01978002
         LA    ACCO,44(ACCE)                                            02000000
         ST    ACCO,IEHMVV10                                            02020000
         ST    ACCE,IEHMVV21+4     SAVE ADDR OF DS NAME AREA   @ZA07399 02040037
         OI    IEHMVV20+2,PHONYTO  TURN PHONYTO BIT ON                  02060000
         MVC   0(8,ACCE),DUNAME   **TEMP.T TO DS NAME AREA     @ZA07399 02080037
         L     R0,SAVEREG0         RELOAD REG0                 @ZA07399 02084037
         ST    R0,DV               STORE CLOCK TIME            @ZA07399 02088037
         OI    DV+3,X'0F'          SET SIGN BYTE               @ZA07399 02092037
         UNPK  8(7,ACCE),DV(4)     UNPACK                      @ZA07399 02096037
         MVI   15(ACCE),C' '       MOVE BLANKS INTO DS NAME    @ZA07399 02100037
         MVC   16(29,ACCE),15(ACCE) AREA                       @ZA07399 02120037
         B     NOV                                                      02140000
DUNAME   DC    CL8'**TEMP.T'                                   @ZA07399 02160000
NOV      DS    0H                                                       02180000
*                                                                       02200000
*                                                                       02220000
         NI    IEHMVV20+4,X'F7'   TURN OFF MODEL DSCB SWITCH       0659 02230017
         L     R2,IEHMVV30+8           ADDRESS OF FROM DSCB      S20201 02235020
         USING FT1DSCB,R2              ESTABLISH ADDRESSABILITY  S20201 02240020
         LA    R3,DEVCHAR              ESTABLISH ADDRESSABILITY  A45176 02240222
         USING UNITCHAR,R3             FROM-DEV CHARACTERISTICS  A45176 02240422
         L     R4,IEHMVV30+12          PTR TO FROM-DDNAME        A45176 02240622
         LA    R4,0(R4)                ZERO HIGH-ORDER BYTE      A45176 02240822
         XC    0(40,R3),0(R3)          ZERO BOTH DEVTYPE AREAS   A45176 02241022
         DEVTYPE (R4),(R3),DEVTAB      GET FROM-DEVTYPE          A45176 02241222
         CLC   DS1EXT1+2(8),ZEROS      CHECK FOR MODEL-DSCB      A45176 02241422
         BNE   NOTMOD                  NO MODEL-DSCB             A45176 02241622
         CLC   DS1SCALO+1(3),ZEROS     CHECK FOR MODEL-DSCB      A45176 02241822
         BNE   NOTMOD                  NO MODEL DSCB             A45176 02242022
         CLI   DEVTYPE+2,DASD          TEST FROM-DEVICE DASD     A45176 02242222
         BE    SETMOD                  YES, MUST BE MODEL DSCB   A45176 02242422
         TM    IEHMVV20+1,LOAD         DATA SET TO BE LOADED     A45176 02242622
         BNO   NOTMOD                  NO, MUST BE TAPE INPUT    A45176 02242822
SETMOD   OI    IEHMVV20+4,MODLDSCB     INDICATE MODEL-DSCB       A45176 02243022
         B     AFTERSCK                                          A45176 02243222
NOTMOD   DS    0H                                                S21042 02244021
         TM    DS1DSORG,PDSBIT         IS THIS A PDS             S20201 02245020
         BO    YPDS                    *B IF YES                 S20201 02250020
AFTERSCK MVC   IEHMVV00(100),0(R2)     MOVE DSCB                 S20201 02255020
         LR    R2,MCTABLE              TEMPORARY ADDRESS THE     S20201 02260020
*                                      MOVED DSCB WITH R2        S20201 02265020
         XC    DS1LSTAR(10),DS1LSTAR   BLANK OUT                 S20201 02270020
         XC    DADDQ+4(83),DADDQ+4                               S20201 02275020
         L     R2,IEHMVV30+8           RE-ADDRESS FROM DSCB      S20201 02280020
         MVC   DADPQ-IECSDSL1(4,MCTABLE),DADPQ COPY PRIM QUANT   S20201 02285020
*                                      INTO NEW DSCB             S20201 02290020
         MVI   UNLOADSW,X'00'          SWITCH INITIALY OFF      YA01193 02292002
         L     R3,IEHMVV23+4           PTR TO TO VOLLIST         S20201 02295020
         CLI   2(R3),DASD              TO DEVICE DIRECT ACCESS   S20201 02300020
         BE    SETVOLSR                IF SO, CALCULATE SPACE   YA01193 02305002
*                                      IF NOT TO DIRECT ACCESS, YA01193 02305502
         TM    IEHMVV20+1,UNLOAD         AND NOT TO BE UNLOADED,YA01193 02306002
         BNO   YTAPE2                  BYPASS SPACE-CALC.      @YA01681 02306502
         TM    IEHMVV20+1,LOAD+UNLOAD  FOR A LOAD-UNLOAD        YA01193 02307002
         BO    YTAPE2                  NO SPACE-VALUE REQ.     @YA01681 02307502
         OI    UNLOADSW,X'80'          INDICATE SPACE ONLY REQRDYA01193*02308002
                                         FOR UNLOAD-INFORMATION YA01193 02308502
         TM    IEHMVV20+4,MODLDSCB     TEST IF MODEL-DSCB      @YA02577 02308602
         BO    YTAPE2                  YES                     @YA02577 02308702
SETVOLSR EQU   *                                                YA01193 02309002
         LA    R3,4(R3)                BUMP TO VOLSER            S20201 02310020
         MVC   DS1DSSN-DS1DSNAM(6,MCTABLE),0(R3)                 S20201 02315020
*                                      UPDATE DS SERIAL IN NEW   S20201 02320020
*                                      DSCB                      S20201 02325020
****************************************************************        02325202
*                                                              *        02325402
*  IF COPY, PUT IN CURRENT DATE AS CREATION DATE IN TO-DSCB    *        02325602
*  IF MOVE, KEEP THE OLD CREATION DATE IN TO-DSCB              *        02325802
*                                                              *        02326002
****************************************************************        02326202
         L     R4,IEHMVV22             ADDR OF FROM VOL LIST   @ZA11963 02326337
         LA    R4,0(R4)                CLEAR HIGH ORDER BYTE   @ZA11963 02329037
         TM    2(R4),X'80'             FROM TAPE               @ZA11963 02330037
         BNO   NOTAPE                  NO, BRANCH              @ZA11963 02330837
         TM    IEHMVV20+1,LOAD         LOAD FUNCTION           @ZA11963 02331637
         BO    NOTAPE                  YES, BRANCH             @ZA11963 02332437
         MVI   52(R12),X'01'           SET VOL SEQ = 1         @ZA11963 02333237
         B     TIME                    GET CURRENT DATE        @ZA11963 02334037
NOTAPE   TM    IEHMVV20,X'80'          MOVE OPERATION          @ZA11963 02335037
         BO    MOVE1                   BRANCH IF YES            YA01684 02336037
         ST    R1,SAVEREG1             SAVE REG1 FOR TIME MACRO YA01684 02337037
TIME     TIME  ,                       GET CURRENT DATE        @ZA11963 02340037
         XC    DV,DV                   CLEAR CONVERSION AREA    YA01684 02342037
         LR    R4,R1                   GET DATE IN REG4         YA01684 02345037
         STH   R1,DV+6                 STORE 'DDDC'             YA01684 02347037
         CVB   R1,DV                   CONVERT IT TO BINARY     YA01684 02349037
         STH   R1,DV+6                 STORE IT IN ALIGNED AREA YA01684 02351037
         MVC   54(2,R12),DV+6          MOVE IT INTO NEW DSCB    YA01684 02353037
         SRDL  R4,4                    PUT X'F' INTO REG5       YA01684 02355037
         SRL   R4,12                   REMOVE 'DDD' FROM REG4   YA01684 02357037
         SLDL  R4,4                    PUT 'YYF' INTO REG4      YA01684 02359037
         STH   R4,DV+6                 STORE 'YYF' INTO AREA    YA01684 02361037
         CVB   R1,DV                   CONVERT IT TO BINARY     YA01684 02363037
         STC   R1,53(R12)              STORE IT INTO NEW DSCB   YA01684 02365037
         L     R1,SAVEREG1             RESET REG1               YA01684 02367037
MOVE1    EQU   *                                                YA01684 02369037
         L     R4,IEHMVV21+4           PTR TO NEW DSNAME         A45176 02371037
         MVC   IEHMVV00(44),0(R4)      PUT IN NEW DSCB           A45176 02373037
         TM    IEHMVV20+4,MODLDSCB     TEST FOR MODEL-DSCB       A45176 02375037
         BO    CALLALLO                BRANCH TO ALLOCATE IF ONE A45176 02377037
         EJECT                                                          02395020
REGUPROC EQU   *                                                 S20201 02400020
*****************************************************************S20201 02405020
*                                                                S20201 02410020
*   SPACE ALLOCATION ALGORITHM -                                 S20201 02415020
*                                                                S20201 02420020
*     THE FOLLOWING SECTION OF CODE DETERMINES THE NUMBER OF     S20201 02425020
*     BYTES OF AUXILIAIRY STORAGE NEEDED FOR THE TO DATASET.     S20201 02430020
*     FROM THIS NUMBER,THE NUMBER OF TRACKS NEEDED CAN BE        S20201 02435020
*     DERIVED                                                    S20201 02440020
*                                                                S20201 02445020
*     FOR BDAM DATASETS,ALL EXTENTS (MAX 16) WILL BE TAKEN INTO  S20201 02450020
*     ACCOUNT                                                    S20201 02455020
*                                                                S20201 02460020
*     FOR NON-BDAM DATASETS ONLY THE PRIMARY ALLOCATION,WHICH    S20201 02465020
*     EXISTS IN UP TO 5 EXTENTS,WILL BE USED TO DETERMINE THE    S20201 02470020
*     NUMBER OF TRACKS IN THE FROM DATASET. AS SOON AS AN EXTENT S20201 02475020
*     IS FOUND THAT CORRESPONDS TO THE SECONDARY ALLOCATION      S20201 02480020
*     AMOUNT,WE STOP COUNTING THE NUMBER OF TRACKS AND CYLINDERS S20201 02485020
*     IN THE FROM DATASET, EXCEPT WHEN THIS EXTENT IS THE FIRST. S20201 02490020
*         THIS WILL GIVE THE USER THE ABILITY TO RECLAIM UNUSED  S20201 02495020
*     SPACE IN A PDS,(CAUSED BY REPLACING MEMBERS) MERELY BY     S20201 02500020
*     MOVING THE DATASET THUS GETTING ONLY THE ORIGINAL          S20201 02505020
*     PRIMARY ALLOCATION BACK.                                   S20201 02510020
*                                                                S20201 02515020
*     ONCE WE HAVE ACCUMULATED THE NUMBER OF TRACKS OCCUPIED     S20201 02520020
*     BY THE FROM DATASET,WE MULTIPLY THIS NUMBER BY THE TRACK-  S20201 02525020
*     CAPACITY OF THE FROM DEVICE,GIVING US THE APPROXIMATE      S20201 02530020
*     NUMBER OF BYTES IN THE FROM DATASET                        S20201 02535020
*                                                                S20201 02540020
*     DIVIDING THIS NUMBER BY THE SUM OF KEYLENGTH,BLOCKSIZE AND S20201 02545020
*     DEVICE OVERHEAD WILL GIVE US THE APPROXIMATE NUMBER OF     S20201 02550020
*     RECORDS IN THE FROM DATASET.                               S20201 02555020
*          SOMETIMES,LIKE IN THE CASE OF THE SYS1.SYSJOBQE DATA- S20201 02560020
*     SET OR IN USER DEFINED ACCESS METHODS,THE BLOCKSIZE AND    S20201 02565020
*     KEYLENGTHWILL NOT BE DEFINED IN THE FROM DATASETS' DSCB.   S20201 02570020
*     FOR THESE SITUATIONS,THE BLOCKSIZE IS DEFAULTED TO FIT THE S20201 02575020
*     THE AVERAGE BLOCKSIZE OF AN AVERAGE JOB QUEUE.             S20201 02580020
*                                                                S20201 02585020
*     IT SHOULD BE NOTED,HOWEVER,THAT THIS NUMBER OF RECORDS     S20201 02590020
*     IS IN NO WAY REALISTIC FOR DATASETS WITH UNDEFINED OR VAR- S20201 02595020
*     IABLE RECORD FORMATS. THE BLKSIZE GIVEN IN THE DSCB OF     S20201 02600020
*     THESE DATASETS IS THE MAXIMUM SIZE,SO THE NUMBER OF        S20201 02605020
*     RECORDS WILL BE TO LOW. THIS WOULD ONLY IMPACT THE RESULT  S20201 02610020
*     WHEN THE 'TO' DEVICE OVERHEAD IS NOT THE SAME AS THE'FROM' S20201 02615020
*     OVERHEAD. THEREFORE WE NEUTRALIZE THIS DIFFERENCE BY       S20201 02620020
*     MULTIPLYING THE SUM OF MAXIMUM BLOCKSIZE,KEYLENGTH AND     S20201 02625020
*     OVERHEAD BY THE QUOTIENT OF 'FROM' AND 'TO' OVERHEAD,PRIOR S20201 02630020
*     TO DIVIDING THE NUMBER OF BYTES BY IT.    WHEN WE ARE      S20201 02635020
*     COPYING TO A DEVICE WITH A BIGGER OVERHEAD,THE RESULTING   S20201 02640020
*     AVERAGE BLOCKSIZE WILL BE SMALLER THAN THE ORIGINAL MAXI-  S20201 02645020
*     MUM,THUS BOOSTING UP THE RESULTING NUMBER OF RECORDS,AND   S20201 02650020
*     THUS THE RESULTING NMBR OF TRACKS,WHICH SHOULD BE ENOUGH   S20201 02655020
*     TO MAKE UP FOR THE DIFFERENCE IN OVERHEAD.                 S20201 02660020
*        WHEN WE ARE COPYING BETWEEN THE SAME TYPES OF DEVICES,  S20201 02665020
*     THE AVERAGE BLOCKLENGTH WILL BE THE SAME AS THE MAXIMUM    S20201 02670020
*     BLOCKLENGTH ,WHICH CAN'T DO ANY HARM,AS THE OVERHEAD ARE   S20201 02675020
*     EQUAL TO.                                                  S20201 02680020
*        WHEN COPYING TO A DEVICE WITH A SMALLER OVERHEAD,THE    S20201 02685020
*     AVERAGE BLOCKSIZE WILL BE GREATER THAN THE MAX BLOCKSIZE,  S20201 02690020
*     WHICH RESULTS IN A LOWER NUMBER OF TRACKS FOR THE NEW DATA S20201 02695020
*     SET THAN IT WOULD HAVE BEEN WITH THE MAX BLOCKSIZE.        S20201 02700020
*                                                                S20201 02705020
*     THE NUMBER OF RECORDS THUS DERIVED,IS MULTIPLIED BY THE    S20201 02710020
*     SUM OF KEYLENGTH,BLOCKSIZE AND DEVICE OVERHEAD OF THE 'TO' S20201 02715020
*     DATASET,TAKING INTO CONSIDERATION ANY DE-BLOCKING          S20201 02720020
*     CONSTRAINTS,POSED UPON THE OPERATION DUE TO TRACK CAPACITY S20201 02725020
*     INCOMPATABILITY.(ALSO THE NUMBER OF RECORDS IS ADJUSTED    S20201 02730020
*     INCASE OF DE-BLOCKING).   THE PRODUCT OF THIS MULTIPLI-    S20201 02735020
*     CATION IS THE APPROXIMATE NUMBER OF BYTES IN THE NEW DATA- S20201 02740020
*     SET.                                                       S20201 02745020
*                                                                S20201 02750020
*     DIVIDING THIS NUMBER OF BYTES BY THE TRACK CAPACITY OF     S20201 02755020
*     THE 'TO' DEVICE ,WILL GIVE USE THE DESIRED NUMBER OF TRACKSS20201 02760020
*     TO BE USED IN ALLOCATION.                                  S20201 02765020
*                                                                S20201 02770020
*     THE SAME PROCEDURE IS FOLLOWED FOR THE SECONDARY ALLOCATIONS20201 02775020
*     AMOUNT,AFTER CONVERTING THE AMOUNT TO TRACKS IF APPROPRIATES20201 02780020
*                                                                S20201 02785020
*     NOTE: THIS ALGORITHM WAS REVISED AND REWRITTEN IN ITS ENTI-S20201 02790020
*     RETY FOR RELEASE 20.2 RECORD READY SUPPORT                 S20201 02795020
*                                                                S20201 02800020
*****************************************************************S20201 02805020
         SPACE 2                                                        02810020
         TM    IEHMVV20+1,LOAD         IS DATASET BEING LOADED   S20201 02815020
         BO    CALLALLO                *B IF YES-USE F1 DSCB OF  S20201 02820020
*                                      ORIGINAL DATASET TO ALLOC-S20201 02825020
*                                      ATE THE NEW DATASET       S20201 02830020
*                                                                S20201 02835020
         TM    DS1DSORG,ISAM           IS THIS AN ISAM DATASET   S20201 02840020
         BO    GOODALLO                *B IF YES LIKE ALL IS OK  S20201 02845020
*                                                                S20201 02850020
ISAM     EQU   X'80'                                             S20201 02855020
*                                                                S20201 02860020
         L     R4,IEHMVV31+8           GET PTR TO'TO'DDNAME      S20201 02910020
         LA    R4,0(R4)                ZERO HI-BYTE              S20201 02915020
         DEVTYPE (R4),DEVCHAR2,DEVTAB   GET ANOTHER 5 WORDS      S20201 02920020
         MVI   DEFSW,X'00'             CLEAR SWITCH              S20201 02925020
         LA    R3,DEVCHAR              ADDRESS FROM DEVTYPE      A45176 02930022
         CLI   DEVTYPE+2,DASD          FROM DEVICE DA            S20201 02940020
         BNE   GETDEFLT                 USE DEFAULT ALLOCATION   A44334 02945021
*                                      PRIMARY ALLOCATION AMOUNT S20201 02950020
         XC    SECALLO,SECALLO         ZERO SAVE AREA FOR SECON- S20201 02955020
*                                      DARY ALLOCATION           S20201 02960020
         CLC   DS1PTRDS(5),ZEROS       TEST FOR FORMAT3-DSCB    OY01178 02965002
         BE    DSCBNOF3                IF NO,SKIP F3-ROUTINE    OY01178 02970002
         MVC   CAMLIST(4),CAMLST1      MOVE SEEK MODE BYTES     OY01178 02975002
         LA    R14,DS1PTRDS            PTR TO F3 CCHHR ADDRESS  OY01178 02980002
         L     R15,IEHMVV22+4          PTR TO FROM VOLUME LIST  OY01178 02985002
         LA    R15,4(R15)              PTR TO FROM-VOLUME SERNR OY01178 02995002
         LA    R0,FT3DSCB              PTR TO OBTAINAREA        OY01178 03000002
         STM   R14,R0,CAMLIST+4        STORE PTRS IN CAMLIST    OY01178 03005002
         LA    R1,CAMLIST              PTR TO CAMLIST           OY01178 03010002
         OBTAIN (R1)                   OBTAIN FORMAT3-DSCB      OY01178 03015002
         LTR   R15,R15                 TEST F3-DSCB FOUND       OY01178 03025002
         BNZ   BALLO                   MSG,IF NOT               OY01178 03030002
         MVC   EXTENTS(30),DS1EXT1     MOVE 3 F1-EXTENTS        OY01178 03035002
         MVC   EXTENTS+70(91),EXTENTS+71 ELIMINATE F3-INDICATOR OY01178 03040002
         B     DSCBSECA                                         OY01178 03045002
DSCBNOF3 MVC   EXTENTS(31),DS1EXT1     MOVE EXTENTS+ZERO BYTE   OY01178 03055002
DSCBSECA EQU   *                                                OY01178 03060002
*                                                               OY01178 03065002
*  COMPUTE NUMBER OF TRACKS OF 'FROM' SELONDARY ALLOCATION      OY01178 03070002
*                                                               OY01178 03075002
         TM    DS1SCALO,X'80'          TEST TYPE OF SEC ALLOC   OY01178 03085002
         BZ    DSCBSCAN                FOR ABS/BLKS SEC ALLOC=0 OY01178 03090002
         MVC   SECSAVE+1(3),DS1SCALO+1 GET SEC ALLOC QUANTITY   OY01178 03095002
         MVI   SECSAVE,X'00'                                    OY01178 03100002
         TM    DS1SCALO,X'40'          TEST ALLOCATION IN       OY01178 03105002
         BZ    DSCBBDAM                CYLINDERS OR TRACKS      OY01178 03115002
         L     R4,SECSAVE              IF IN CYLINDERS,         OY01178 03120002
         MH    R4,TRPCYL               MULTIPLY BY NR OF        OY01178 03125002
         ST    R4,SECSAVE              TRACKS PER CYLINDER.     OY01178 03130002
DSCBBDAM TM    DS1DSORG,BDAM           TEST FOR BDAM DATA SET   OY01178 03135002
         BO    DSCBSCAN                IF NOT BDAM,USE          OY01178 03145002
         MVC   SECALLO(4),SECSAVE      THIS VALUE TO COMPARE    OY01178 03150002
DSCBSCAN EQU   *                                                OY01178 03155002
*                                                               OY01178 03160002
*  SCAN EXTENTS TO DEFINE TOTAL 'FROM' PRIMARY ALLOCATION.      OY01178 03165002
*  WHEN AN EXTENT IS SMALLER THAN OR EQUAL TO THE SECONDARY     OY01178 03175002
*  ALLOCATION,IT WILL BE CONSIDERED AS A SECONDARY ALLOCATION,  OY01178 03180002
*  EXCEPT FOR THE FIRST EXTENT. THE SUM OF THE SPACES USED BY   OY01178 03185002
*  THE OTHER EXTENTS WILL BE CONSIDERED AS PRIMARY ALLOCATION.  OY01178 03190002
*  NOTE: FOR BDAM DATA SETS,OR IF THE ALLOCATION WAS 'ABS' OR   OY01178 03195002
*  'BLK',ALL EXTENTS WILL BE USED AS PRIMARY (BECAUSE'SECALLO'  OY01178 03205002
*  HAS BEEN SET TO ZERO).                                       OY01178 03210002
*                                                               OY01178 03215002
         LA    R15,EXTENTS                                      OY01178 03220002
         MVI   FIRSTEXT,X'FF'          INDICATE FIRST EXTENT    OY01178 03225002
         SR    R7,R7                   PRIMARY ALLOC INIT ZERO  OY01178 03235002
         TM    EXTENTS,X'40'           TEST FIRST EXT USER LABELOY01178 03240002
         BNO   DSCBNOUL                IF USER LABEL TRACK,     OY01178 03245002
DSCBEXTS LA    R15,10(R15)             SKIP THIS EXTENT         OY01178 03250002
DSCBNOUL CLI   0(R15),X'00'            CHECK EXTENT USED        OY01178 03255002
         BE    DSCBCONV                IF NOT,NO MORE EXTENTS   OY01178 03265002
         TM    DEVCHAR+17,X'02'        TEST FOR 2321            OY01178 03270002
         BO    DEV2321                 SPECIAL ROUTINE FOR 2321 OY01178 03275002
         LH    R6,6(R15)               GET UPPER CC             OY01178 03280002
         SH    R6,2(R15)               SUBTRACT LOWER CC        OY01178 03285002
         MH    R6,TRPCYL               CONVERT CYLS TO TRACKS   OY01178 03295002
         AH    R6,8(R15)               ADD UPPER TT             OY01178 03300002
         SH    R6,4(R15)               SUBTRACT LOWER TT        OY01178 03305002
         LA    R6,1(R6)                ADD ONE FOR FIRST TRACK  OY01178 03310002
*                                                               OY01178 03315002
BACK2321 AR    R7,R6                   ADD EXTENT TO PRIMARY   @ZA01233 03325002
         MVI   FIRSTEXT,X'00'          RESET FIRST EXTENT SWITCHOY01178 03360002
         B     DSCBEXTS                SCAN NEXT EXTENT         OY01178 03365002
DSCBCONV ST    R7,PRIME                SAVE TOTAL PRIMARY ALLOC OY01178 03370002
         TM    IEHMVV20+1,UNLOAD       TEST FOR UNLOAD          YA01193 03370202
         BNO   CONVDSCB                IF NOT, GO AROUND        YA01193 03370402
         L     R1,IEHMVV10             ELSE, - RESERVE SPACE IN YA01193 03370602
         MH    R7,TRLENGTH               THE PERMANENT WORK AREAYA01193 03370802
         ST    R7,0(R1)                - SET NBR BYTES IN PRIME YA01193 03371002
         XC    4(4,R1),4(R1)           - ZERO FOR SEC IF TRK-CYLYA01193 03371202
         TM    DS1SCALO,X'80'          TEST TYPE OF SEC ALLOC   YA01193 03371402
         BZ    SETPTR                  USE ZERO, OR             YA01193 03371602
         L     R7,SECSAVE              CALCULATE NBR OF SECOND. YA01193 03371802
         MH    R7,TRLENGTH               BYTES                  YA01193 03372002
         ST    R7,4(R1)                  AND SAVE               YA01193 03372202
SETPTR   ST    R1,IEHMVV85             SAVE POINTER TO BE       YA01193*03372402
                                         PASSED TO IEHMVSSY     YA01193 03372602
         LA    R1,8(R1)                UPDATE POINTER TO THE    YA01193 03372802
         ST    R1,IEHMVV10               PERMANENT WORK AREA    YA01193 03373002
         TM    UNLOADSW,X'80'          IF SPACE ONLY NEEDED IN  YA01193 03373202
         BO    YTAPE1                    UNLOADED DATA SET, SKIPYA01193*03373402
                                         REST OF CALCULATIONS   YA01193 03373602
CONVDSCB EQU   *                                                YA01193 03373802
         TM    DS1DSORG,BDAM           TEST FOR BDAM            OY01178 03375002
         BNO   GETBLKSZ                                         OY01178 03385002
         MVC   SECALLO+1(3),SECSAVE+1  IF BDAM GET SEC ALLOC    OY01178 03390002
         TM    DS1RECFM,X'40'          RECFM V OR U            @ZA07359 03413037
         BO    FINISH                  YES TRACK INTEGRITY     @ZA07359 03417037
GETBLKSZ CLC   DEVCHAR+2(1),DEVCHAR2+2 TEST DEV CLASS          @ZA04412 03422037
         BNE   NOTEQUAL                NOT EQUAL               @ZA28198 03422799
         CLI   DEVCHAR+3,X'09'         FROM 3330-1             @ZA04412 03423437
         BE    TESTTO                  YES                     @ZA04412 03424137
         CLI   DEVCHAR+3,X'0D'         FROM 3330-11            @ZA04412 03424837
         BNE   EQUAL                   TEST IF EQUAL           @ZA04412 03425537
TESTTO   CLI   DEVCHAR2+3,X'09'        TO 3330-1               @ZA04412 03426237
         BE    FINISH                  YES                     @ZA04412 03426937
         CLI   DEVCHAR2+3,X'0D'        TO 3330-11              @ZA04412 03427637
         BE    FINISH                  YES                     @ZA04412 03428337
EQUAL    CLC   DEVCHAR+3(1),DEVCHAR2+3 TO AND FROM EQUAL       @ZA04412 03429037
         BE    FINISH                  YES                     @ZA04412 03429737
NOTEQUAL EQU   *                       NO                      @ZA28198 03430499
* CLACULATE NUMBER OF BYTES (DATA + GAPS) REQUIRED FOR A NORMAL YA01193 03440002
* RECORD (IN R1), AND FOR THE LAST RECORD ON A TRACK (IN R8)    YA01193 03442002
         SR    R1,R1                                            YA01193 03444002
         IC    R1,DS1KEYL              KEYLENGTH                YA01193 03446002
         AH    R1,DS1BLKL                        + BLKSIZE      YA01193 03448002
         BNZ   SETR8                   IF NOT ZERO, USE THESE   YA01193 03450002
         LH    R1,DEFBLK               ELSE, SET DEFAULT VALUE  YA01193 03452002
*                                      TO SUIT JOBQUEUE          S20201 03460020
         MVI   DEFSW,X'FF'             INDICATE DEFAULT USED     S20201 03465020
SETR8    LR    R8,R1                   USE SAME VALUE FOR LAST  YA01193 03470002
         TM    OVHIND,X'01'            TEST FOR TOLERANCE FACTORYA01193 03475002
         BZ    ADDOVH1                 BRANCH AROUND IF NOT     YA01193*03480002
                                                      APPLICABLEYA01193 03485002
         LH    R5,TOLERANC             GET TOLERANCE FACTOR     YA01193 03490002
         MR    R0,R5                   (BLKSIZE + KEYLEN) * TOL YA01193 03495002
         SRDA  R0,9                    DIVIDE BY 512            YA01193 03500002
ADDOVH1  TM    OVHIND,X'08'            2-BYTE OVERHEAD           S20201 03510020
         BO    BIGOVHD1                *B IF YES                 S20201 03515020
         SR    R6,R6                   CLEAR FOR INSERT          S20201 03520020
         IC    R6,OVHCNT               GET ONE BYTE OVH          S20201 03525020
         AR    R1,R6                   ADD FOR NORMAL RECORD    YA01193 03530002
         IC    R6,OVHCNT+1             FOR LAST RECORD          YA01193 03531002
         B     ADD2                                             YA01193 03532002
BIGOVHD1 LH    R6,OVHCNT               GET TWO BYTES OVERHEAD    S20201 03535020
ADD1     AR    R1,R6                   ADD OVERHEAD TO BLKSIZE   S20201 03540020
ADD2     AR    R8,R6                   ADD OVHD FOR LAST RECORD YA01193 03545002
         CLI   DS1KEYL,X'00'           TEST FOR KEY             YA01193 03549002
         BNE   ENDOVHD                 IF WITH KEY NO ADJUSTMENTYA01193 03553002
         SR    R6,R6                   IF WITHOUT KEY,          YA01193 03557002
         IC    R6,KEYOVHD              - GET OVERHEAD FOR KEY   YA01193 03561002
         SR    R1,R6                   - SUBTRACT FOR NORMAL    YA01193 03565002
         SR    R8,R6                   - SUBTRACT FOR LAST REC. YA01193 03569002
ENDOVHD  EQU   *                                                YA01193 03573002
*                                                                S20201 03580020
         CLI   DEFSW,X'FF'             WAS DEFAULT BLKSIZE USED  S20201 03585020
         BE    NOADJUST                *B IF YES-SKIP RECFM CHECKS20201 03590020
*                                                                S20201 03595020
*                                                                S20201 03600020
         TM    DS1RECFM,X'40'          CHECK RECFM               S20201 03605020
         BZ    NOADJUST                *B IF FIXED(BLOCKED)      S20201 03610020
         TM    DS1RECFM,X'48'          CHECK RECFM               S20201 03615020
         BO    NOADJUST                *B IF VARIABLE SPANNED    S20201 03620020
         CLI   DEVTYPE+2,DASD          FROM DEVICE DA            S20201 03621020
         BNE   NOADJUST                *B IF NOT                 S20201 03622020
*                                                                S20201 03625020
*                                      ADJUST THE TOTAL MAXIMUM  S20201 03630020
*                                      BLOCKSIZE FOR VARIABLE    S20201 03635020
*                                      AND UNDEFINED RECORDS     S20201 03640020
*                                                                S20201 03645020
         TM    OVHIND,X'08'            2-BYTE OVERHEAD           S20201 03650020
         BO    BIGOVHD3                *B IF YES                 S20201 03655020
         XR    R0,R0                   CLEAR FOR INSERT          S20201 03660020
         IC    R0,OVHCNT               GET 1-BYTE OVERHEAD       S20201 03665020
         MR    R0,R0                   GET 1-ST PART OF ADJUST-  S20201 03670020
*                                      MENT DONE:MULTIPLY        S20201 03675020
         B     PART2                   *B TO DO SECOND PART      S20201 03680020
BIGOVHD3 MH    R1,OVHCNT               MULTIPLY WITH 2-BYTE OVHD S20201 03685020
PART2    LA    R3,DEVCHAR2             TEMPORARY ADDRESS 'TO'    S20201 03690020
*                                      DEVICE CHARACTERISTICS    S20201 03695020
         XR    R0,R0                   CLEAR FOR DIVIDE          S20201 03700020
         TM    OVHIND,X'08'            2-BYTE OVERHEAD           S20201 03705020
         BO    BIGOVHD4                *B IF YES                 S20201 03710020
         XR    R5,R5                   CLEAR FOR INSERT          S20201 03715020
         IC    R5,OVHCNT               GET 1-BYTE OVERHEAD       S20201 03720020
         B     DIVIDE                  *B TO DIVIDE              S20201 03725020
BIGOVHD4 LH    R5,OVHCNT               GET 2-BYTE OVERHEAD       S20201 03730020
DIVIDE   DR    R0,R5                   DIVIDE BY 'TO' OVHD       S20201 03735020
         LTR   R0,R0                   ANY REMAINDER             S20201 03740020
         BZ    *+8                     *B IF NOT                 S20201 03745020
         LA    R1,1(R1)                ADD ONE FOR REMAINDER     S20201 03750020
         LA    R3,DEVCHAR              RE-ADDRESS FROM DEVICE    S20201 03755020
*                                      CHARACTERISTICS           S20201 03760020
NOADJUST EQU   *                                                 S20201 03765020
*                                                                S20201 03770020
*                                      R1 CONTAINS THE AVERAGE   S20201 03775020
*                                      NUMBER OF BYTES THAT A    S20201 03780020
*                                      BLOCK NEEDS IN THE FROM   S20201 03785020
*                                      DATASET                   S20201 03790020
         TM    DS1RECFM,X'20'          TRACKOVERFLOW             A44334 03792021
         BO    MIXED                   YES CONTINUE              A44334 03794021
         TM    DS1RECFM,X'80'          FIXED LENGTH              A44334 03821021
         BZ    MIXED                   NO, CONTINUE              A44334 03823021
* FOR A FIXED LENGTH DATASET THE NUMBER OF RECORDS PER TRACK     A44334 03825021
* IS CALCULATED AND MULTIPLIED WITH THE NUMBER OF TRACKS TO      A44334 03827021
* FIND THE EXACT NUMBER OF BLOCKS IN THE FROM DATASET            A44334 03829021
         L     R6,PRIME                CALCULATE THE NUMBER      A44334 03831021
         BAL   R9,FROMRECS             OF RECORDS IN THE         A44334 03833021
         ST    R5,PRIME                PRIMARY ALLOCATION        A44334 03835021
         L     R6,SECALLO              YES, CALCULATE THE NUMBER A44334 03839421
         BAL   R9,FROMRECS             OF RECORDS IN THE         A44334 03839821
         B     STORESEC                SECONDARY ALLOCATION      A44334 03839921
MIXED    DS    0H                      STANDARD CALCULATION      A44334 03840021
         L     R4,PRIME                GO TO MULTIPLY TRACKS     A44334 03842021
         BAL   R9,NOFIXED              WITH TRACKCAP AND DIVIDE  A44334 03844021
         ST    R5,PRIME                BY REAL BLOCKSIZE         A44334 03844421
         L     R4,SECALLO              GET NBR OF SECONDARY      A44334 03845021
         BAL   R9,NOFIXED              TRACKS TO CALCULATE NBR   A44334 03847021
         B     STORESEC                OF SECONDARY BLOCKS       A44334 03849021
FROMRECS DS    0H                                                A44334 03849421
         LH    R5,TRLENGTH             GET TRACK LENGTH         YA01193 03849802
         SR    R5,R8                   ADJUST FOR LAST RECORD   YA01193 03850202
         AR    R5,R1                   (REPLACE BY NORMAL)      YA01193 03850602
         SR    R4,R4                   PREPARE FOR DIVIDE       YA01193 03851002
         DR    R4,R1                   NBR OF BLOCKS PER TRACK   A44334 03851402
         LA    R5,1(R5)                ADD ONE                 @ZA28198 03852099
         MR    R4,R6                   FIND SUM OF BLOCKS        A44334 03854821
         BR    R9                      RETURN TO SAVE THE NBR    A44334 03854921
NOFIXED  DS    0H                                                A44334 03855021
         MH    R4,TRACKCAP             CALC TOTAL NBR OF BYTES   A44334 03857021
         SRDA  R4,32                   NBR OF BYTES FOR THE      A44334 03859021
*                                      DS AS A DOUBLE LENGTH     A44334 03859421
*                                      SIGNED INTEGER            A44334 03859821
         DR    R4,R1                   FIND NBR OF BLOCKS        A44334 03859921
         LTR   R5,R5                   ZERO ALLOCATION           A44334 03860021
         BNZ   NOREM                   NO, CONTINUE              A44334 03862021
         LTR   R4,R4                   YES TEST FOR REMAINDER    A44334 03864021
         BZ    NOREM                   NO, ZERO ALLOCATION       A44334 03864421
         LA    R5,1(R5)                YES ALLOCATE MINIMUM      A44334 03864821
NOREM    BR    R9                      RETURN TO SAVE AMOUNT     A44334 03864921
GETDEFLT EQU   *                                                YA01193 03880002
         TM    UNLOADSW,X'80'          IF SPACE OMLY NEEDED IN  YA01193 03880102
         BO    YTAPE1                    UNLOADED D.S., DEFAULTSYA01193*03880202
                                       ARE SET IN IEHMVSSY      YA01193 03880302
         MVI   IEHMVV10-4,X'04'        RELEASE UNUSED SPACE    @ZA03353 03880437
         LH    R1,DEVCHAR2+12          TRACKCAPACITY FOR TO    @ZA01243 03880502
*                                       DEVICE                 @ZA01243 03880602
         SLL   R1,16                   CLEAR HIGH ORDER BYTES  @ZA01243 03880702
         SRL   R1,16                                           @ZA01243 03880802
         L     R5,DEFAULT1             DEFAULT PRIMARY ALLOC   @ZA01243 03880902
         AR    R5,R1                   ADD TRACKCAPACITY       @ZA01243 03881002
         BCTR  R5,0                     MINUS ONE TO ROUND UP    A44334 03881221
         SR    R4,R4                    CLEAR TO DIVIDE          A44334 03881521
         DR    R4,R1                    GIVES NUMBER TRKS PRIME  A44334 03881821
         ST    R5,PRIME                 SAVE PRIME ALLOCATION    A44334 03882121
         L     R5,DEFAULT2              DEFAULT SECONDARY ALLOC  A44334 03882421
         AR    R5,R1                    ADD TRACKCAPACITY        A44334 03882721
         BCTR  R5,0                     MINUS ONE TO ROUND UP    A44334 03883021
         SR    R4,R4                    CLEAR TO DIVIDE          A44334 03883321
         DR    R4,R1                    DIVIDED BY TRACKCAPACITY A44334 03883621
*                                       GIVES NUMBER TRACKS SEC  A44334 03883921
         ST    R5,SECALLO               SAVE SECONDARY ALLOC     A44334 03884221
         MVI   DS1SCALO-IECSDSL1(MCTABLE),X'80'                  S20201 03885020
*                                      INDICATE THAT IT WILL BE  S20201 03890020
*                                      ALLOCATED IN UNITS        S20201 03895020
*                                      OF TRACKS                 S20201 03900020
         B     FINISH                                            A44334 03902021
STORESEC ST    R5,SECALLO              SAVE NMBR OF BLOCKS SECONDS20201 03940020
*                                                                S20201 03945020
*                                                                S20201 03950020
         LA    R3,DEVCHAR2             ADDRESS 'TO' DEVICE       S20201 03955020
*                                      CHARACERISTICS FROM NOW ONS20201 03960020
*                                                                S20201 03965020
         TM    IEHMVV10-4,FBLOCKED     FIXED DEBLOCKING FORCED   S20201 03970020
         BZ    TESTVB                  *B IF NOT                 S20201 03975020
         LH    R4,DS1LRECL             YES-USE LRECL AS NEW      S20201 03980020
*                                      BLOCK LENGTH              S20201 03985020
         B     TESTDEF                                           S20201 03990020
TESTVB   TM    IEHMVV10-4,VBLOCKED     VARIABLE DEBLOCKING FORCEDS20201 03995020
         BZ    GETBLK                  *B IF NOT                 S20201 04000020
         LH    R4,IEHMVV10-10          YES-USE MAX LRECL AS NEW  S20201 04005020
*                                      BLOCK LENGTH              S20201 04010020
         B     TESTDEF                                           S20201 04015020
GETBLK   LH    R4,DS1BLKL              USE OLD BLOCKSIZE         S20201 04020020
TESTDEF  LTR   R4,R4                   WAS IT DEFINED            S20201 04025020
         BNZ   GETBF                   *B IF YES                 S20201 04030020
         LH    R4,DEFBLK               NO-USE ARBITRARY DEFAULT  S20201 04035020
*                                      TO SUIT JOBQUEUE          S20201 04040020
GETBF    EQU   *                                                 S20201 04045020
*                                      DETERMINE THE DE-BLOCKING S20201 04050020
*                                      FACTOR (NEEDED TO BE ABLE S20201 04055020
*                                      TO CALCULATE THE NEW NMBR S20201 04060020
*                                      OF RECORDS AFTER DE-      S20201 04065020
*                                      BLOCKING)                 S20201 04070020
*                                                                S20201 04075020
         LH    R1,DS1BLKL              GET ORIGINAL BLKSIZE      S20201 04080020
         LTR   R1,R1                   WAS IT DEFINED            S20201 04085020
         BNZ   CLEAR0                  *B IF YES                 S20201 04090020
         LH    R1,DEFBLK               NO-GET ARBITRARY DEFAULT  S20201 04095020
*                                      TO SUIT JOBQUEUE          S20201 04100020
CLEAR0   SR    R0,R0                   CLEAR FOR DIVIDE          S20201 04105020
         DR    R0,R4                   GET DEBLOCKING FACTOR     S20201 04110020
         LTR   R0,R0                   ANY REMAINDER             S20201 04115020
         BZ    XMIT                    *B IF NOT                 S20201 04120020
         LA    R1,1(R1)                ADD ONE FOR REMAINDER     S20201 04125020
*                                                                S20201 04130020
*                                      R1 HAS THE DEBLOCKING     S20201 04135020
*                                      FACTOR=THE NUMBER TO MUL- S20201 04140020
*                                      TIPLY THE NUMBERS OF REC- S20201 04145020
*                                      ORDS WITH                 S20201 04150020
*                                                                S20201 04155020
XMIT     LR    R5,R1                   R5 DOES,TOO               S20201 04160020
         M     R0,PRIME                MULTIPLY PRIME AMOUNT     S20201 04165020
         ST    R1,PRIME                SAVE NEW NUMBER OF RECS   S20201 04170020
         LR    R1,R5                   GET MULTIPLICAND BACK     S20201 04175020
         M     R0,SECALLO              MULTIPLY SECONDARY AMNT   S20201 04180020
         ST    R1,SECALLO              SAVE                      S20201 04185020
         SR    R1,R1                                            YA01193 04190002
         IC    R1,DS1KEYL              KEYLENGTH                YA01193 04194002
         AR    R1,R4                             + BLKSIZE      YA01193 04198002
         LR    R8,R1                   USE SAME FOR LAST RECORD YA01193 04202002
         TM    OVHIND,X'01'            TEST FOR TOLERANCE FACTORYA01193 04206002
         BZ    ADDOVH2                 BRANCH AROUND IF NOT     YA01193*04210002
                                                      APPLICABLEYA01193 04214002
         LH    R5,TOLERANC             GET TOLERANCE FACTOR     YA01193 04218002
         MR    R0,R5                   (BLKSIZE + KEYLEN) * TOL YA01193 04222002
         SRDA  R0,9                    DIVIDE BY 512            YA01193 04226002
ADDOVH2  TM    OVHIND,X'08'            2-BYTE OVERHEAD           S20201 04235020
         BO    BIGOVHD2                *B IF YES                 S20201 04240020
         SR    R6,R6                   CLEAR FOR INSERT          S20201 04245020
         IC    R6,OVHCNT               GET ONE BYTE OVHD         S20201 04250020
         AR    R1,R6                   ADD OVHD FOR NORMAL RECRDYA01193 04255002
         IC    R6,OVHCNT+1             FOR LAST RECORD          YA01193 04256002
         B     ADD3                      GO TO ADD OVERHEAD     YA01193 04257002
BIGOVHD2 LH    R6,OVHCNT               GET 2 BYTES OVHD          S20201 04260020
         AR    R1,R6                   ADD OVHD FOR NORMAL RECRDYA01193 04265002
ADD3     AR    R8,R6                   ADD OVHD FOR LAST RECORD YA01193 04270002
         CLI   DS1KEYL,X'00'           TEST FOR KEY             YA01193 04275002
         BNE   ENDOVHD2                IF WITH KEY NO ADJUSTMENTYA01193 04280002
         SR    R6,R6                   IF WITHOUT KEY,          YA01193 04285002
         IC    R6,KEYOVHD              - GET OVERHEAD FOR KEY   YA01193 04290002
         SR    R1,R6                   - SUBTRACT FOR NORMAL    YA01193 04295002
         SR    R8,R6                   - SUBTRACT FOR LAST RECRDYA01193 04300002
ENDOVHD2 EQU   *                                                YA01193 04305002
*                                                                S20201 04310020
         TM    DS1RECFM,X'20'          TRACKOVERFLOW             A44334 04312021
         BO    NORMPROC                YES NORMAL PROCEDURE      A44334 04314021
         TM    DS1RECFM,X'80'          FIXED RECORDS             A44334 04314421
         BZ    NORMPROC                NO, NORMAL PROCEDURE      A44334 04314821
* FOR RECFM=F OR FB THE NUMBER OF RECEIVING TRACKS IS CALCULATED A44334 04314921
* BY DIVIDING THE NUMBER OF RECORDS IN THE DATASET BY THE NUMBER A44334 04315021
* OF RECORDS PER RECEIVING TRACK                                 A44334 04317021
         L     R7,PRIME                 GET NUMBER OF BLOCKS     A44334 04319021
         BAL   R9,BLKTRK               FIND NBR OF TRACKS        A44334 04319421
         TM    DS1DSORG,X'02'          PARTITIONED DATASET       A44334 04319821
         BZ    *+8                     NO  CONTINUE              A44334 04319921
         LA    R7,1(R7)                 YES ADD 1 FOR DIRECTORY  A44334 04320021
         ST    R7,PRIME                 NBR OF TRACKS REQUIRED   A44334 04322021
         L     R7,SECALLO              GET NBR OF BLOCKS         A44334 04324021
         BAL   R9,BLKTRK               CALCULATE SECONDARY       A44334 04324421
         ST    R7,SECALLO               ALLOCATION IN TRACKS     A44334 04324821
         B     FINISH                  CONTINUE                  A44334 04324921
NORMPROC DS    0H                                                A44334 04325021
         L     R5,PRIME                GET NBR OF BLOCKS         A44334 04327021
         BAL   R9,NORMCALC             FIND NBR OF TRACKS        A44334 04329021
         ST    R5,PRIME                FOR PRIMARY ALLOCATION    A44334 04329421
         L     R5,SECALLO              GET NBR OF BLOCKS         A44334 04329821
         BAL   R9,NORMCALC             FIND NBR OF TRACKS        A44334 04329921
         ST    R5,SECALLO              FOR SECONDARY ALLOCATION  A44334 04330021
         B     FINISH                  CONTINUE                  A44334 04332021
BLKTRK   DS    0H                      TRACK CALC FOR F OR FB    A44334 04334021
         LH    R5,TRLENGTH             GET TRACK LENGTH         YA01193 04334402
         SR    R5,R8                   ADJUST FOR LAST RECORD   YA01193 04334502
         AR    R5,R1                   (REPLACE BY NORMAL)      YA01193 04334602
         SR    R4,R4                   PREPARE FOR DIVIDE        A44334 04334821
         DR    R4,R1                   NBR OF BLOCKS PER TRACK   A44334 04334921
         LTR   R5,R5                   LET THIS NUMBER BE        A44334 04335021
         BNZ   *+8                     ONE AT LEAST              A44334 04337021
         LA    R5,1(R5)                                          A44334 04339021
         SR    R6,R6                    PREPARE FOR DIVIDE       A44334 04339421
         DR    R6,R5                    NUMBER OF TRACKS REQUIRE A44334 04340321
         LTR   R6,R6                    ANY REMAINDER            A44334 04341221
         BCR   8,R9                     NO,CONTINUE              A44334 04342121
         LA    R7,1(R7)                 ADD ONE FOR REMAINDER    A44334 04343021
         BR    R9                      RETURN TO STORE AMOUNT    A44334 04344021
NORMCALC DS    0H                                                A44334 04367021
         LH    R0,TRACKCAP             GET TRACKCAPACITY         A44334 04369021
         MR    R4,R1                   GET NUMBER OF BYTES       S20201 04370020
         DR    R4,R0                   GET NMBR OF TRACKS        S20201 04375020
         LTR   R4,R4                   ANY REMAINDER             S20201 04380020
         BZ    *+8                     *B IF NOT                 S20201 04385020
         LA    R5,1(R5)                ADD ONE FOR REMAINDER     S20201 04390020
         BR    R9                      RETURN TO STORE AMOUNT    A44334 04392021
*                                                                S20201 04410020
*                                                                S20201 04415020
*                                                                S20201 04420020
*                                                                S20201 04425020
DEV2321  EQU   *                                                 S20201 04430020
*        BUILD A FAKE DEB FOR USE BY THE RESIDENT CCHH TO TTR    S20201 04435020
*        CONVERSION ROUTINE                                      S20201 04440020
*                                                                S20201 04445020
         MVI   CONVINP,X'00'           CLEAR CONVERSION-         S20201 04450020
         MVC   CONVINP+1(31),CONVINP   WORKAREA                  S20201 04455020
         MVI   CONVINP,X'01'           SET M=1                   S20201 04460020
         MVC   CONVINP+7(4),6(R15)     INPUT CCHH FOR CONVERSIONOY01178 04465002
         MVC   DEBSTRCC(8),2(R15)      SET FAKE'S EXTENTS       OY01178 04470002
         MVI   DEBUCBAD+14,X'7F'       SET NUMBER OF TRACKS-     S20201 04475020
         MVI   DEBUCBAD+15,X'FF'       HIGH                      S20201 04480020
         L     R1,IEHMVV30+12          PTR TO TIOT ENTRY         S20201 04485020
         L     R1,12(0,R1)             PTR TO SUB-UCB            S20201 04490020
         SR    R8,R8                    CLEAR REGISTER         @ZM30153 04492003
         ICM   R8,3,0(R1)               BACK                   @ZM30153 04495003
         SLL   R8,4                    TO                        S20201 04500020
         LA    R8,56(R8)               MAIN                      S20201 04505020
         SR    R1,R8                   UCB                       S20201 04510020
         ST    R1,DEBUCBAD             STORE IN FAKE DEB         S20201 04515021
         STM   R10,R13,CONVSAVE        SAVE BASE REGISTERS       S20201 04520020
         STM   R2,R5,CONVSVE2          SAVE DATA REGISTERS       S20201 04525020
         ST    R15,SAVE15              SAVE EXTENT PTR           S20201 04530020
         LA    R2,CONVINP+4            INPUT CCHH FOR CONVERSION S20201 04535020
         LA    R1,CONVSAVE             PTR TO FAKED DEB          S20201 04540020
         L     R15,CVTPTR              PTR TO CVT                S20201 04545020
         USING CVT,R15                 ESTABLISH ADDRESSABILITY  S20201 04550020
         L     R15,CVTPRLTV            EP TO CONVERT RTN         S20201 04555020
         DROP R15                                                S20201 04560020
         BALR  R14,R15                 BRANCH TO CONVERT ROUTINE S20201 04562021
         LM    R10,R13,0(R1)           RESTORE BASES             S20201 04565020
         LM    R2,R5,CONVSVE2          RESTORE DATA REGS         S20201 04570020
         L     R15,SAVE15              RESTORE EXTENT PTR        S20201 04575020
         SRL   R0,16                   SHIFT OUT RN OF TTRN      S20201 04580020
         LR    R6,R0                   GET TT IN PROPER REG      S20201 04585020
         LA    R6,1(R6)                UP IT BY ONE              S20201 04590020
         B     BACK2321                *B TO REGULAR PROCEDURE   S20201 04595020
*                                                                S20201 04600020
*                                                                S20201 04605020
*                                                                S20201 04610020
FINISH   LR    R2,MCTABLE              ADDRESS THE NEW DSCB      S20201 04615020
         TM    DS1SCALO,X'C0'          ALLOCATED IN CYLS       @ZA13789 04620037
         BNO   NOCYL                   NO                      @ZA01734 04620437
         XR    R4,R4                   CLEAR REG4              @ZA01734 04620837
         L     R5,PRIME                PRIMARY FROM ALLOC      @ZA01734 04621237
         LH    R1,DEVCHAR2+10          TO DEV TRACK CAPACITY   @ZA01734 04621637
         DR    R4,R1                   DIV PRIMARY WITH        @ZA01734 04622037
*                                      TO TRACK CAPACITY       @ZA01734 04622437
         LTR   R4,R4                   ANY REMAINDER           @ZA13789 04622537
         BZ    AROUND                  NO, BRANCH              @ZA13789 04622637
         LA    R5,1(R5)                ADD ONE FOR REMAINDER   @ZA13789 04622737
AROUND   MH    R5,DEVCHAR2+10          MULT R5 WITH TO DEV     @ZA13789 04622837
*                                      TRACK CAPACITY          @ZA01734 04623237
         ST    R5,PRIME                NEW PRIMARY ALLOC       @ZA01734 04623637
NOCYL    LR    R2,MCTABLE              ADDRESS THE NEW DSCB    @ZA10937 04623837
         MVC   DADPQ(4),PRIME          PUT PRIMARY QUANTITY    @ZA01734 04624037
*                                      IN TO DSCB              @ZA01734 04624437
         L     R5,SECALLO              GET SEC ALLOC AMOUNT      S20201 04625020
         TM    DS1SCALO,X'80'          TEST ALLOC TYPE           S20201 04630020
         BZ    CALLALLO                *B IF ABSOLUTE OR BLOCKS  S20201 04635020
         TM    DS1SCALO,X'40'          TEST IF CYLS              S20201 04640020
         BZ    SETQ                    *B IF NOT-SET TRACKS      S20201 04645020
         XR    R4,R4                   CLEAR FOR DIVIDE          S20201 04650020
         LH    R1,TRPCYL               GET TRACKS PER CYL        S20201 04655020
         DR    R4,R1                   DIVIDE TO GET CYLS        S20201 04660020
         LTR   R4,R4                   ANY REMAINDER             S20201 04665020
         BZ    *+8                     *B IF NOT                 S20201 04670020
         LA    R5,1(R5)                ADD ONE FOR REMAINDER     S20201 04675020
         ST    R5,SECALLO              SET CYLS BACK             S20201 04680020
SETQ     MVC   DS1SCALO+1(3),SECALLO+1 SET IN NEW DSCB           S20201 04685020
*                                                                S20201 04690020
*                                                                S20201 04695020
*                                                                       05140000
CALLALLO DS    0H                                                       05160000
*                                                                       05180000
         LR    R2,MCTABLE              ADDRESS THE NEW DSCB      S20201 05190021
         TM    IEHMVV10-4,FBLOCKED ANY FIXED BLOCK REBLOCKING           05200000
         BO    CCHBLK                                                   05220000
         TM    IEHMVV10-4,VBLOCKED ANY VARIABLE BLOCKED REBLOCKING      05240000
         BZ    RTNXX               IF NO BRANCH AROUND REBLOCKING ROUTN 05260000
         MVC   DS1BLKL(2),IEHMVV10-10   MOVE IN MAX LRECL AS NEW        05280000
         B     RTNXX                       BLOCKING FACTOR              05300000
CCHBLK   MVC   DS1BLKL(2),DS1LRECL MOVE IN LRECL FFORMAT AS BLOCK FACTR 05320000
RTNXX    DS    0H                                                       05340000
*                                                                       05360000
*                                                                       05380000
****************************************************************        05385002
*                                                              *        05386002
*  TEST IF 'TO'-VOLUME IS MOUNTED, IF NOT PRINT FOLLOWING MSG  *        05387002
*  IEH416I DATA SET XXX NOT MOVED/COPIED BECAUSE UNABLE TO     *        05390002
*  ALLOCATE TO DATA SET                                        *        05392002
*                                                              *        05395002
****************************************************************        05396002
*                                                                       05397002
*                                                                       05401002
         L     R1,IEHMVV31+8           GET PTR TO DDNAME (TIOT) YA01675 05403002
         BCTR  R1,R0                   BACK 2 BYTES TO POINT TO YA01675 05404002
         BCTR  R1,R0                   NO. OF DEVICES REQUESTED YA01675 05407002
         SR    R7,R7                   GET NO OF DEVICES        YA01675 05409002
         IC    R7,0(R1)                REQUESTED.               YA01675 05411002
         LA    R1,14(R1)               STEP TO FIRST DEV. ENTRY YA01675 05412002
         L     R8,IEHMVV23+4           ADDRESS OF 'TO'-VOL LIST YA01675 05413002
FINDUCB  EQU   *                                                YA01675 05414002
         SR    R6,R6                    CLEAR REGISTER         @ZM30153 05414403
         ICM   R6,3,2(R1)               LOAD(SUB-) UCB ADDRESS @ZM30153 05415003
         CLI   3(R8),X'05'             TEST IF UNIT IS 2321     YA01675 05416002
         BE    SUBUCB                  IF 2321 USE SUBUCB       YA01675 05417002
         CLC   28(6,R6),4(R8)          ELSE, COMPARE UCB-VOLSER YA01675*05418002
                                       WITH 'TO'-VOLSER.        YA01675 05419002
         BE    UCBFOUND                IF FOUND, VOL IS MOUNTED YA01675 05420002
NEXTUCB  EQU   *                                                YA01675 05421002
         LA    R1,4(R1)                POINT TO NEXT DEV. ENTRY YA01675 05422002
         BCT   R7,FINDUCB              IF AN UCB TO COMPARE     YA01675 05423002
         B     BALLO                   IF LAST, VOL NOT MOUNTED YA01675 05424002
SUBUCB   EQU   *                                                YA01675 05425002
         CLC   4(6,R6),4(R8)           COMPARE VOLSER IN SUBUCB YA01675*05440002
                                       WITH 'TO'-VOLSER.        YA01675 05443002
         BNE   NEXTUCB                 IF NOT EQUAL BRANCH      YA01675 05446002
****************************************************************        05449002
UCBFOUND EQU   *                                                YA01675 05452002
         ST    R6,IEHMVV31             STORE (SUB-) UCB ADDRESS YA01675 05455002
         LA    R1,IEHMVV31                                              05460000
DDUCB    EQU   14                                                       05480000
*                                                                       05500000
*                                                                       05520000
DIRECT   LA    R0,IEHMVV00             GET ADDRESS OF DSCB         2695 05540017
*                                                                       05560000
*                                                                       05580000
         LA    ACCE,2048           MAKE SIGN NEGATIVE                   05600000
         SLL   ACCE,20             PLACE A ONE IN HIGH ORDER BIT        05620000
         OR    R0,ACCE            ONE BIT INFORMS ALLOCATE THAT ENTRY   05640000
*                                 WAS MADE FROM A UTILITY PROGRAM       05660000
*                                                                       05680000
         TM    IEHMVV20+3,X'04'        RENAME SPEC.            @ZA06516 05683037
         BNO   *+8                     NO BRANCH AROUND        @ZA06516 05686037
         NI    IEHMVV00+93,X'EB'  TURN OFF SECUR BITS          @ZA16483 05690037
         TM    IEHMVV20+1,UNLOAD                                        05700000
         BO    OKUN                                                     05720000
NOWTRY   DS    0H                                                       05740000
         TM    IEHMVV20+4,X'08'        MODEL DSCB INDICATOR ON     2695 05746017
         BC    1,NOWTRY1               YES, BYPASS MOVING NO.EXT'S 2695 05752017
         MVI   DS1NOEPV,X'01'     MOVE NO OF EXTENTS ON VOL INTO DSCB   05760000
NOWTRY1  DS    0H                                                  UL0H 05765017
         L     ACCO,IEHMVV30+8         GET FROM DSCB ADDRESS       UL0H 05770017
         CLI   105(ACCO),X'40'         U.L. TRK FOR FROM DATA SET  UL0H 05775017
         BE    TRKALLO                  YES, ASK FOR U.L. TRK      UL0H 05776017
*                            FROM DEVICE MAY HAVE BEEN U.L. TAPE   UL0H 05777017
         CLC   IEHMVV72(4),ZEROS        WERE HEADER LABELS SAVED   UL0H 05778017
         BNE   TRKALLO                  YES, ASK FOR U.L. TRK      UL0H 05779017
         B     ALLO                     NO, NORMAL ALLOCATE        UL0H 05780017
TRKALLO  DS    0H                                                  UL0H 05782017
         MVI   DS1EXT1,LABALLO         YES, ALLOCATE U.L. TRACK    UL0H 05785017
*                                      FOR 'TO' DATA SET           UL0H 05790017
ALLO     DS    0H                                                       05795019
         TM    IEHMVV10-4,X'08'    IS THE DATA SET UNMOVABLE     A99999 05800019
         BZ    ALLO1               NO.                           A99999 05805019
         OI    DS1DSORG,X'01'      TURN DSCB UNMOVABLE BIT ON.   A99999 05810019
         TM    IEHMVV20+3,X'08'    PREALLOCATED DATA SET ?       S21042 05812021
         BO    DUPNAME+6           YES, BYPASS ALLOCATION        S21042 05814021
ALLO1    TM    82(R12),X'02'           'TO' DATA SET A PDS     @YA02601 05815002
         BNO   ALLO2                   NO ALLOCATE             @YA02601 05815502
         CLC   112(4,R12),ZEROS        YES ANY DIR BLOCKS      @YA02601 05816002
         BNE   ALLO2                   YES ALLOCATE            @YA02601 05816502
         CLC   108(4,R12),ZEROS        NO PRIM QUANTITY ZERO   @YA02601 05817002
         BE    ALLO2                   YES ALLOCATE            @YA02601 05817502
         MVI   IEHMVV61,X'34'          NO PRINT MSG IEH432I    @YA02601 05818002
         B     DIFMES                  GO AND PRINT            @YA02601 05818502
ALLO2    EQU   *                                               @G32DSFS 05819032
**                                                             @G32DSFS 05819632
** IF COPYAUTH IS SPECIFIED ,BUT THE FROM DATA SET IS NOT      @G32DSFS 05819732
** RACF DEFINED THEN NO MODEL WILL BE DONE. HOWEVER            @G32DSFS 05819832
** IF ADSP IS SPECIFIED THEN A RACF DEFINE WILL                @G32DSFS 05819932
** BE DONE. IF NEITHER, GO TO ALLOCATE WITHOUT RACF ACTION.    @G32DSFS 05820032
**                                                             @G32DSFS 05820132
         TM    IEHMVV20+3,X'08'    PREALLOCATED DATA SET ?     @ZM44439 05820232
         BO    DUPNAME+6           YES, BYPASS ALLOCATION      @ZM44439 05820432
         TM    IEHMVV20+5,COPYAUTH     COPYAUTH SPECIFIED      @G32DSFS 05820632
         BZ    ADSPCHK                 NO,BR TO ADSP CHECK     @G32DSFS 05820832
         TM    DS1DSIND,DS1RACDF       IS FROM D.S. RACF DEF   @G32DSFS 05821032
         BO    AUTHCHK                 YES,CHECK AUTHORIZATION @G32DSFS 05821232
**                                                             @G32DSFS 05821432
** CHECK THE JSCB FOR AUTO DATA SET PROTECT                    @G32DSFS 05821632
**                                                             @G32DSFS 05821832
ADSPCHK  EQU   *                       CHECK FOR ADSP          @G32DSFS 05822032
         USING CVT,R15                                         @G32DSFS 05822232
         L     R15,CVTPTR              PTR TO CVT              @G32DSFS 05822432
         L     R15,CVTTCBP             PTR TO TCB WORDS        @G32DSFS 05822632
         L     R15,4(R15)              CURRENT TCB PTR         @G32DSFS 05822832
         USING TCB,R15                                         @G32DSFS 05823032
         L     R15,TCBJSCB             PTR TO JSCB             @G32DSFS 05823232
         USING IEZJSCB,R15                                     @G32DSFS 05823432
         L     R15,JSCBACT             CURRENT JSCB            @G32DSFS 05823632
         NI    NEWDSCB1(R12),X'FF'-DS1RACDF RESET RACF IND.    @G32DSFS 05823832
         TM    JSCBFBYT,JSCBADSP       AUTO DATA SET PROTECT   @G32DSFS 05824032
         BZ    ALLO2B                  NO,GO TO ALLOCATE       @G32DSFS 05824232
         DROP  R15                                             @G32DSFS 05824432
**                                                             @G32DSFS 05824632
** RACF DEFINE                                                 @G32DSFS 05824832
**                                                             @G32DSFS 05825032
DEFINE   EQU   *                       RACF DEFINE             @G32DSFS 05825232
         L     R7,TODS                 SET TO DATA SET AND     @G32DSFS 05825432
         L     R15,TOVOL               VOLUMN ADDR.-4          @G32DSFS 05825632
         LA    R15,4(R15)              ACTIVE TO VOL           @G32DSFS 05825832
         MVC   RACDEF(LRACDEF),MRACDEF MOVE PARM LIST          @G32DSFS 05826032
         RACDEF ENTITY=((R7)),VOLSER=((R15)),MF=(E,RACDEF)     @G32DSFS 05826232
         OI    NEWDSCB1(R12),DS1RACDF  DSCB1 RACF DEFINED      @G32DSFS 05826432
         LTR   R15,R15                 WAS DEFINE SUCCESSFUL   @G32DSFS 05826632
         BZ    ALLO2A                  YES,BR TO ALLOCATE      @G32DSFS 05826832
         CH    R15,RACRET16            VALID RETURN CODE       @G32DSFS 05827032
         BH    BALLO1                  NO BR,UNABLE TO ALLO MSG@G32DSFS 05827232
DIFMESA  EQU   *                       RET=8,NOT AUTHORIZED    @G32DSFS 05827432
         SRL   R15,2                   DIVIDE RET CODE BY 4    @G32DSFS 05827632
         LA    R15,RACFMSGT-1(R15)     ADDR OF ERROR CODE      @G32DSFS 05827832
         MVC   IEHMVV61(1),0(R15)      ERROR CODE TO WORK AREA @G32DSFS 05828032
         B     DIFMES                  BRANCH TO ERROR MSG     @G32DSFS 05828232
**                                                             @G32DSFS 05828432
** CHECK FOR ALTER AUTHORIZATION TO THE MODEL DATA SET         @G32DSFS 05828832
**                                                             @G32DSFS 05828932
AUTHCHK  EQU   *                                               @G32DSFS 05829032
         L     R7,FROMDS               SET FROM DATA SET AND-  @G32DSFS 05829132
         L     R15,FROMVOL             VOLUME -4               @G32DSFS 05829232
         LA    R15,4(R15)              FIRST TO VOL PTR        @G32DSFS 05829332
         MVC   RACHECK(LRACHECK),MRACHECK MOVE PARM LIST       @G32DSFS 05829432
         RACHECK ATTR=ALTER,ENTITY=((R7)), AUTHORIZATION CHECK @G32DSFS*05829532
               VOLSER=((R15)),MF=(E,RACHECK)                   @G32DSFS 05829632
         LTR   R15,R15                 RET = 0,SUCCESSFUL      @G32DSFS 05829732
         BZ    RACMODEL                YES,DO MODEL            @G32DSFS 05829832
         CH    R15,RACRET16            VALID RETURN CODE       @G32DSFS 05829932
         BH    BALLO1                  NO,UNABLE TO ALLO MSG   @G32DSFS 05830032
         CH    R15,RACRET4             DS NOT RACF DEFINED     @G32DSFS 05830132
         BNE   DIFMESA                 NO,ISSUE ERROR MSG      @G32DSFS 05830332
         LA    R15,16                  YES,FORCE MODEL DATA-   @G32DSFS 05830532
         B     DIFMESA                 SET NOT DEFINED MSG.    @G32DSFS 05830732
**                                                             @G32DSFS 05830932
** DO RACF MODEL                                               @G32DSFS 05831032
**                                                             @G32DSFS 05831132
RACMODEL EQU   *                                               @G32DSFS 05831232
         L     R7,FROMDS               ADDR OF FROM DATA SET   @G32DSFS 05831332
         L     R2,FROMVOL              ADDR OF FROM VOLUMN -4  @G32DSFS 05831432
         LA    R2,4(R2)                FIRST FROM VOL PTR      @G32DSFS 05831532
         L     R15,TOVOL               ADDR OF ACTIVE 'TOVOL'-4@G32DSFS 05831632
         LA    R15,4(R15)              TO VOL PTR              @G32DSFS 05831732
         L     R14,TODS                ADDR OF TO DATA SET     @G32DSFS 05831832
         MVC   RACDEF(LRACDEF),MRACDEF MOVE PARM LIST          @G32DSFS 05831932
         RACDEF TYPE=DEFINE,MENTITY=((R7)),MVOLSER=((R2)),     @G32DSFS*05832032
               VOLSER=((R15)),ENTITY=((R14)),MF=(E,RACDEF)     @G32DSFS 05832132
         L     R2,IEHMVV30+8           RESTORE FROM DSCB1 ADDR @G32DSFS 05832232
         OI    NEWDSCB1(R12),DS1RACDF  SET RACF DEFINED        @G32DSFS 05832332
         LTR   R15,R15                 WAS MODEL SUCCESSFUL    @G32DSFS 05832432
         BZ    ALLO2A                  YES,BR TO ALLOCATE      @G32DSFS 05832532
         CH    R15,RACRET16            VALID RETURN CODE       @G32DSFS 05832632
         BH    BALLO1                  RET CODE GT. 16-INVALID @G32DSFS 05832732
         B     DIFMESA                 RET=8,BR TO ERROR MSG   @G32DSFS 05833132
**                                                             @G32DSFS 05833532
** GO TO DADSM ALLOCATE                                        @G32DSFS 05838032
**                                                             @G32DSFS 05838132
ALLO2A   EQU   *                       RESTORE REGS 1 AND 0    @G32DSFS 05838232
         LA    R1,IEHMVV31             RESTORE UCB ADDR REG1   @G32DSFS 05838332
         LA    R0,IEHMVV00             GET ADDRESS OF DSCB     @G32DSFS 05838432
*                                                                       05838532
* TURN ON HIGH ORDER BIT OF REGISTER 0 TO INFORM DADSM         @G32DSFS 05838632
* ALLOCATE THAT ENTRY WAS FROM A UTILITY PROGRAM               @G32DSFS 05838732
*                                                                       05838832
         LA    ACCE,2048               MAKE SIGN NEGATIVE      @G32DSFS 05838932
         SLL   ACCE,20                 SHIFT TO HI ORDER BYTE  @G32DSFS 05839032
         OR    R0,ACCE                 SET BIT IN REG 0        @G32DSFS 05839132
ALLO2B   EQU   *                       NO RACF ACTION          @G32DSFS 05839232
         SVC   32                      ALLOCATION SVC          @G32DSFS 05839332
         LA    RETURN,4                                                 05839532
         SR    LINK,RETURN                                              05840000
         BZ    DUPNAME                                                  05860000
         BM    GOODALLO                                                 05880000
         BP    BALLO                                                    05900000
*                                                                       05906017
*                                                                       05912017
DUPNAME  DS    0H                  PREALLOCATED DATA SET                05920000
         MVC   IEHMVV82+4(3),DS1DSNAM+62 SAVE TTR                S21042 05922021
         TM    IEHMVV20+4,X'08'        MODEL DSCB INDICATOR ON     2695 05925017
         BC    1,DUPMODL               YES, GIVE MSG FOR DUPLICATE 2695 05930017
*                                      NAME ON 'TO' VOLUME         2695 05935017
         TM    DS1DSORG,X'20'          A BDAM DATASET            S20201 05936020
         BNO   DUPNAMES                FROM-DS NOT BDAM          A45147 05937021
         TM    IEHMVV20+1,UNLOAD       FROM-DS BDAM, TEST UNLOAD A45147 05937521
         BNO   BDAMDUP                 CANNOT COPY BDAM IN PREAL A45147 05938021
*                                      DS - NOT ABLE TO TEST FOR A45147 05938521
*                                      EMPTY OR NOT              A45147 05939021
DUPNAMES DS    0H                                                A45147 05939521
         NI    IEHMVV10-4,X'CF'    TURN OFF 2 SWITCHES IN COM REGION    05940000
         TM    IEHMVV20,CATALOGF                                        05960000
     BO   GOODALLO                                                      05980000
         TM    IEHMVV20,PDS        PDS FUNCTION                         06000000
         BO    TSTOB                                             A36065 06020021
         TM    IEHMVV20+2,PHONYTO      PHONY NAME USED                  06040000
         BZ    TSTOB                   NO GO TO OBTAIN TO DS NAME       06060000
         L     ACCE,IEHMVV21+4         YES CREATE NEW PHONY NAME        06080000
         LA    ACCO,43(0,ACCE)                                          06100000
UNDOTR   DS    0H                                                       06120000
         CLI   0(ACCO),C' '                                             06140000
         BNE   UNDOTHIS                                                 06160000
         BCT   ACCO,UNDOTR                                              06180000
UNDOTHIS DS    0H                                                       06200000
         MVI   1(ACCO),C'.'                                             06220000
         MVI   2(ACCO),C'M'                                             06240000
         MVC   IEHMVV00(44),0(ACCE)                                     06260000
         B     CALLALLO                                                 06280000
************************************************************   @ZA01244 06280202
*                                                          *   @ZA01244 06280402
*   WAY OUT IF FOUND DUPLICATE NAME ON TO-VOL AND FROM     *   @ZA01244 06280602
*   DATA SET IS A MODELDSCB.                               *   @ZA01244 06280802
*                                                          *   @ZA01244 06281002
************************************************************   @ZA01244 06281202
DUPMODL  IC    ACCE,IEHMVV61           SAVE CURRENT CODE IN REG    2695 06282017
         MVI   IEHMVV61,X'28'          MOVE IN MSG CODE FOR DUPE   2695 06284017
*                                      NAME ON TO VOLUME WHEN      2695 06286017
*                                      FROM DSET IS MODEL DSCB     2695 06288017
         NI    IEHMVV10-4,X'BF'        TURN OFF SWITCH FOR CLOSE   2695 06290017
*                                      OF 'TO' DCB (NOT OPEN)      2695 06292017
         OI    IEHMVV10-4,X'80'        TURN ON SW TO CLOSE FROM    2695 06294017
         B     DIFMES                  GO TO PREABORT ROUTINE      2695 06296017
TSTOB    DS    0H                                                       06300000
         TM    IEHMVV20+3,X'08'        PREALLOCATED DATA SET ?   S21042 06310021
         BO    GETDSCB                 YES, BYPASS OBTAIN        S21042 06312021
         L     ACCO,IEHMVV31+8         GET PTR TO 'TO' DDNAME    S21042 06314021
         LA    ACCO,0(ACCO)            CLEAR HIGH ORDER BYTE     S21042 06315021
         DEVTYPE (ACCO),INFO,DEVTAB    GET DEVICE CHARACTERISTICSS21042 06316021
         L     ACCO,IEHMVV82+4         GET TTR OF 'TO' DSCB      S21042 06318021
         SRL   ACCO,8                  MOVE R TO RIGHTMOST BYTE  S21042 06318421
         STC   ACCO,CCHHR+4            SAVE R                    S21042 06318821
         SRL   ACCO,8                  MOVE TT TO RIGHTMOST BYTESS21042 06319221
         SR    ACCE,ACCE               CLEAR REG FOR DIVISION    S21042 06319621
         LH    R6,TRCYL                PICK UP NR OF TRKS/CYL    S21042 06319721
         DR    ACCE,R6                 DIVIDE TT BY TRKS/CYL     S21042 06319821
         STH   ACCO,CCHHR              SAVE CC                   S21042 06319921
         STH   ACCE,CCHHR+2            SAVE HH                   S21042 06326621
         LA    ACCO,CCHHR              GET ADDR OF CCHHR         S21042 06328621
         XC    IEHMVV00(4),IEHMVV00    SET UP TO OBTAIN                 06333321
         MVI   IEHMVV00,X'C0'          +INDICATE                 S21042 06340021
         MVI   IEHMVV00+1,X'80'        +SEEK MODE                S21042 06350021
         ST    ACCO,IEHMVV00+4         SET UP PTR TO CCHHR       S21042 06360021
         L     ACCO,IEHMVV23+4                                          06380000
         LA    ACCO,4(ACCO)            SET UP VOL SERIAL                06400000
         ST    ACCO,IEHMVV00+8                                          06420000
         LA    ACCO,IEHMVV00+16                                         06440000
         ST    ACCO,IEHMVV00+12        WORK AREA                        06460000
         OBTAIN   IEHMVV00                                              06480000
         LTR   LINK,LINK               DSCB FOUND                S21042 06500021
         BZ    GOTDSCB                 YES                       S21042 06520021
         B     BALLO                   DSCB NOT FOUND            S21042 06540021
GETDSCB  EQU   *                                                 S21042 06570021
         L     R1,IEHMVV82+12          GET PTR TO DSCB SAVE AREA S21042 06572021
         MVC   IEHMVV00+60(96),16(R1)  MOVE DSCB TO WORK AREA    S21042 06574021
         TM    IEHMVV20+5,X'01'        GETMAIN DONE BY SRV     @ZA24602 06576099
         BNO   GOTDSCB                 NO,SKIP FREEMAIN        @ZA24602 06576899
         FREEMAIN R,LV=120,A=(1)       FREE SAVE AREA            S21042 06577699
         NI    IEHMVV20+5,X'FE'        INDICATE FREEMAIN DONE  @ZA24602 06578499
GOTDSCB  EQU   *                       CHECK PREALLOCATED DATA   A45147 06580021
*                                      SET WITH FROM-DS, TO      A45147 06583021
*                                      ALLOW MOVE-COPY/UNLOAD    A45147 06586021
         TM    DS1DSORG+16-DS1DSNAM(MCTABLE),BDAM  TEST TO-DS DA A45147 06589021
         BO    ACINCOMP                UNABLE TO DETERMINE BDAM  A45147 06592021
*                                      DS EMPTY OR NOT, MSG411   A45147 06595021
         L     ACCO,IEHMVV30+8         LOAD FROM-DSCB ADDRESS    A45147 06598021
         CLI   DS1DSORG-DS1DSNAM(ACCO),X'00' DSORG UNDEFINED   @ZA04409 06598737
         BNE   *+8                     NO GO ON                @ZA04409 06599437
         MVI   DS1DSORG-DS1DSNAM(ACCO),X'40' SET DEFAULT PS    @ZA04409 06600137
         TM    DS1DSORG-DS1DSNAM(ACCO),PSBIT  TEST FROM-DSORG    A45147 06601021
         BO    PSORUNLD                IF PS, CHECK TO-DS PS     A45147 06604021
         TM    IEHMVV20+1,UNLOAD       IF UNLOAD,CHECK TO-DS PS  A45147 06607021
         BNO   FROMPDS                 FROM-DS NOT PS OR BDAM    A45147 06610021
*                                      MUST BE PDS (NO UNLOAD)   A45147 06613021
*                                                                A45147 06616021
PSORUNLD EQU   *                       FROM-DS PS OR TO UNLOAD   A45147 06619021
         TM    DS1DSORG+16-DS1DSNAM(MCTABLE),PDSBIT+BDAM+ISAM    A45147 06622021
*                                       TEST TO-DSORG            A45147 06625021
         BNZ   ACINCOMP                IF NOT PS, MSG411         A45147 06628021
*                                      IF PS COPY IF TO-DS EMPTY A45147 06631021
         CLC   DS1LSTAR+16-DS1DSNAM(3,MCTABLE),NOTUTST           A45147 06634021
         BE    PREALLO                 IF EMPTY, USE DS TO COPY  A45147 06637021
         MVI   IEHMVV61,X'30'          IF NOT EMPTY, MSG428      A45147 06640021
         B     DIFMES                                            A45147 06643021
FROMPDS  EQU   *                       FROM-DS IS PO (NO UNLOAD) A45147 06646021
         CLC   DS1LSTAR+16-DS1DSNAM(3,MCTABLE),NOTUTST           A45147 06649021
         BNE   PSORPDS                 IF TO-DS NOT EMPTY TEST   A45147 06652021
*                                      FOR PS OR PDS             A45147 06655021
         MVI   IEHMVV61,X'2E'          TO-DS EMPTY, MSG424 'NO   A45147 06658021
         B     DIFMES                  DIRECTORY' - NOT COPIED   A45147 06661021
PSORPDS  EQU   *                                                 A45147 06664021
         TM    IEHMVV20,MOVE+VOLUME    CHECK FOR MOVE-VOLUME    YA01219 06667002
         BO    DUPPDS                   IF SO, PDS NOT MERGED    A45147 06670021
         TM    DS1DSORG+16-DS1DSNAM(MCTABLE),PDSBIT              A45147 06673021
         BO    PREALLO                 TO-DS PDS, MOVE/COPY      A45147 06676021
*                                      TO-DS NOT PDS, MSG411     A45147 06679021
MSGNOMOV MVI   IEHMVV61,X'32'                                   OY01172 06680002
         B     DIFMES                                           OY01172 06681002
ACINCOMP EQU   *                                                 A45147 06682021
         MVI   IEHMVV61,X'14'          MSG411 'ACCESS METHOD NOT A45147 06685021
         B     DIFMES                  COMPATIBLE'               A45147 06688021
DUPPDS   MVI   IEHMVV61,X'2C'           MSG 423 DUPLICATE PDS    A45147 06691021
         B     DIFMES                                            A45147 06694021
BDAMDUP  DS    0H                                                A27312 06705019
         MVI   IEHMVV61,X'2A'     SET UP DUP NAME MSG            A27312 06710019
         B     DIFMES                                            A27312 06715019
**                                                             @G32DSFS 06726032
** IF THE ALLOCATION FAILED FOR A RACF DEFINED DATA SET,       @G32DSFS 06726832
** A RACF DELETE WILL BE DONE                                  @G32DSFS 06727632
**                                                             @G32DSFS 06728432
BALLO    DS    0H                                                       06729232
         TM    NEWDSCB1(R12),DS1RACDF  WAS D.S. RACF DEFINED   @G32DSFS 06729432
         BZ    BALLO1                                          @G32DSFS 06729632
         L     R7,TODS                 ADDR OF TO DATA SET     @G32DSFS 06729832
         L     R15,TOVOL               ADDR OF TO VOLUMN -4    @G32DSFS 06730032
         LA    R15,4(R15)              PTR TO 'TOVOL'          @G32DSFS 06730332
         MVC   RACDEF(LRACDEF),MRACDEF MOVE PARM LIST          @G32DSFS 06730632
         RACDEF TYPE=DELETE,ENTITY=((R7)),VOLSER=((R15)),      @G32DSFS*06730932
               MF=(E,RACDEF)                                   @G32DSFS 06731232
         NI    NEWDSCB1(R12),X'FF'-DS1RACDF RESET RACF DEFINED @G32DSFS 06732032
BALLO1   EQU   *                                               @G32DSFS 06734032
         MVI   IEHMVV61,X'1E'                                           06740000
DIFMES   TM    IEHMVV20+3,DUMP         DUMP TO BE GIVEN INSTEAD  S20201 06746020
*                                      OF MESSAGE                S20201 06752020
         BZ    ABORT                   *B IF NOT GIVE MSG        S20201 06758020
         ABEND 4095,DUMP                                         S20201 06764020
ABORT    EQU   *                                                 S20201 06770020
         L     R0,WALENGTH             LENGTH OF AREA TO       @ZA01727 06772037
*                                      BE FREED                @ZA01727 06774037
         FREEMAIN R,LV=(R0),A=(R10)                            @ZA01727 06776037
         TM    IEHMVV20+5,X'01'        GETMAIN DONE BY SRV     @ZA24602 06780099
         BNO   DONTFREE                NO,SKIP FREEMAIN        @ZA24602 06780199
         L     R1,IEHMVV82+12    GET POINTER TO DSCB SAVE AREA @ZA24602 06780299
         FREEMAIN R,LV=120,A=(1)       ISSUE FREEMAIN          @ZA24602 06780399
         NI    IEHMVV20+5,X'FE'        INDICATE FREEMAIN DONE  @ZA24602 06780499
DONTFREE L     ACCO,IEHMVV22+4     ADDRESS OF ACTIVE FROM VOL  @ZA18362 06780599
         LA    ACCO,0(ACCO)            CLEAR HIGH ORDER BYTE   @ZA18362 06781000
         CLI   2(ACCO),X'80'           FROM DEVICE TAPE        @ZA18362 06782000
         BNE   PREAB1                  NO, BRANCH              @ZA18362 06783000
         L     ACCO,IEHMVV30           ADDRESS OF FROM DCB     @ZA18362 06784000
         LA    ACCO,0(ACCO)            CLEAR HIGH ORDER BYTE   @ZA18362 06785000
         TM    48(ACCO),X'10'          FROM DCB OPEN           @ZA18362 06786000
         BNO   PREAB1                  NO, BRANCH              @ZA18362 06787000
         OI    IEHMVV10-4,X'80'        SET TO CLOSE IN SRY     @ZA18362 06788000
PREAB1   L     LINK,PREAB                                      @ZA18362 06789000
         BR    LINK                GO TO PREABORT ROUTINE               06800000
OKUN     DS    0H                                                       06820000
         LR    ACCE,PASSA                                               06840000
     MVI   DS1DSORG,X'00'                                               06860000
         MVC   DS1DSORG+1(12),DS1DSORG  ZERO DSORG FIELD OF DSCB        06880000
         B     NOWTRY                                                   06900000
NOTUTST   DC   X'000000'                                                06920000
*                                                                       06940000
*                                                                       06960000
         DS    0H                                                       06980000
*                                                                       07000000
YPDS     DS    0H                                                       07020000
         TM    IEHMVV20+1,LOAD     LOAD CONDITION                       07040000
         BO    YLOAD               YES                                  07060000
*                                  NO                                   07080000
         L     15,BERT             GO TO DIRECTORY DEPHONKER            07100000
         BALR  14,15                                                    07120000
         LH    ACCE,IEHMVV25       GET DIRECTORY COUNT                  07140000
         LTR   15,15         ERROR FROM DIRECTORY DEPHONKER        7491 07160000
         BNZ   DIFMES                  *B IF YES                 S20201 07200020
AFTERB   DS    0H                                                       07240000
         TM    IEHMVV20,PDS        PDS KEYWORD                          07260000
         BO    YPDSS                    YES, GO TO USE EXPAND           07280000
AFTERPDS DS    0H                                                       07300000
         TM    IEHMVV20+1,UNLOAD   UNLOAD CONDITION                     07320000
         BO    YUNLOAD             YES, GO TO CONSTRUCT UNLOAD DSCB     07340000
         ST    ACCE,DADDQ-DS1DSNAM(0,MCTABLE)  REQUEST DIRECTORY S20201 07350020
*                                              SPACE             S20201 07360020
         B     AFTERSCK                                                 07380000
YLOAD    DS    0H                                                       07400000
         LH    ACCE,IEHMVV25       DIRECTORY COUNT                      07420000
         B     AFTERB                                                   07440000
YPDSS    DS    0H                                                       07460000
         AH    ACCE,IEHMVV25+2          GET EXPAND                      07480000
         B     AFTERPDS                                                 07500000
YUNLOAD  DS    0H                                                       07520000
         MVI   IEHMVV10-4,X'04'        RELEASE UNUSED SPACE    @ZA30700 07530099
         STH   ACCE,IEHMVV25                                            07540000
         B     AFTERSCK                                                 07560000
ZEROS    DC    2F'0'                   DOUBLE WORD OF HEX ZEROS    2695 07580017
DEACTIVE EQU   X'00'                                               UL0H 07584017
ACTIVOHL EQU   X'02'                                               UL0H 07588017
ACTIVITL EQU   X'03'                                               UL0H 07592017
ACTIVOTL EQU   X'04'                                               UL0H 07596017
BERT     DC    A(IEHMVETC)                                              07600000
ADMSG    DC    A(MSG)                                                   07620000
         EXTRN MSG                                                      07640000
PREALLOS DS    0H                                                       07660000
         MVC   DS1RECFM(1),IEHMVV00+84  SAVE RECFM IN FROM DSCB    UL0H 07665017
         MVC   IEHMVV31(1),DS1RECFM      AND IN 1ST BYTE OF TO     UL0H 07670017
*                                         DCB POINTER              UL0H 07675017
         B     PREALLOX                 INDICATE PREALLOCATION     UL0H 07690017
PREALLO  DS    0H                                                       07700000
         TM    IEHMVV20,PDS            TEST FOR PDS              A36065 07702021
         BO    PREALLOS                                          A36065 07704021
         MVC   IEHMVV74(1),DS1EXT1+16   SAVE UL TRK INDIC TO BE@ZA31059 07706099
*                                        DESTROYED IN MSG WRITE    UL0H 07710099
         MVC   IEHMVV31(1),DS1RECFM+16  SAVE RECFM IN 1ST BYTE @ZA31059 07714099
*                                       OF  POINTER TO TO DCB      UL0H 07724032
PREALLOX OI    IEHMVV20+3,PREALBIT        TURN ON PREALLOCATE BIT  UL0H 07730017
         IC    ACCE,IEHMVV61                                            07740000
         MVI   IEHMVV61,X'03'                                           07760000
         L     LINK,ADMSG                                               07780000
         BALR  RETURN,LINK         GO TO MESSAGE WRITER                 07840000
         STC   ACCE,IEHMVV61                                            07860000
         CLI   IEHMVV74,LABALLO         U.L. TRK FOR 'TO' DATA SET UL0H 07875717
         BE    YTAPE                    YES, ACTIVATE EXITS        UL0H 07876417
         B     GOODALLB                 NO, CHECK FURTHUR          UL0H 07877217
GOODALLO DS    0H                                                  UL0H 07878017
         MVC   IEHMVV82+4(3),DS1DSNAM+62 SAVE TTR                S21042 07880021
         CLI   DS1EXT1,LABALLO          U.L. TRK FOR 'TO' DATA SET UL0H 07881017
         BE    YTAPE                   YES, ACTIVATE EXITS         UL0H 07884017
*                                                                       07885017
GOODALLB DS    0H                                                  UL0H 07886017
         CLC   IEHMVV72(4),ZEROS        WERE HEADER LABELS SAVED   UL0H 07912217
         BE    NORMEXIT                 NO, NORMAL EXIT            UL0H 07912817
         B     RELCORE                  YES, FREE CORE AND GIVE MSGUL0H 07913417
YTAPE2   NI    IEHMVV20+4,X'F7'        SET MODEL DSCB SW OF    @YA01681 07913502
YTAPE1   NOP   0(0)                                            @YA01720 07913702
YTAPE    DS    0H                                                  UL0H 07914002
         CLC   IEHMVV72(4),ZEROS        WERE HEADER LABELS SAVED   UL0H 07915017
         BE    TAPEPRO                  NO, CONTINUE               UL0H 07916017
         MVI   UDCBOHLE,ACTIVOHL       ACTIVATE EXIT LIST          UL0H 07917017
TAPEPRO  DS    0H                                                  UL0H 07920017
         MVI   UDCBITLE,ACTIVITL       ACTIVATE EXIT LIST          UL0H 07923017
NORMEXIT LA    PASSB,3                                             UL0H 07926017
         EJECT                                                          07940000
PROCEED  DS    0H                                                       07960000
         L     R0,WALENGTH             LENGTH TO FREE            S20201 07970020
         FREEMAIN R,LV=(R0),A=(R10)                              S20201 07980020
*                                                                       08000000
       IEHPOST  (14,1),TFC,                                             08020000
         RETURN (14,12),T                                               08030017
*                                                                  UL0H 08044017
*   DIRECT ACCESS OUTPUT DEVICE AND NO LABEL TRACK ALLOCATED       UL0H 08048017
*                                                                  UL0H 08052017
RELCORE  DS    0H                                                  UL0H 08056017
         L     M6,IEHMVV72             GET ADDR OF GOTTEN CORE     UL0H 08060017
         FREEMAIN  R,LV=640,A=(M6)     FREE GOTTEN CORE            UL0H 08064017
SETFLGS  MVI   IEHMVV72+11,X'FF'       SET FLAG TO SHOW MSG        UL0H 08068017
*                                      REQUEST IS FROM VSSX        UL0H 08072017
         MVI   IEHMVV72+10,X'FF'       SET DA+NLT FLAG TO SHOW     UL0H 08076017
*                                      U.L. TRK NOT ALLOCATED      UL0H 08080017
         MVI   IEHMVV72+14,X'FF'       SET FLAG FOR VESN TO PUT    UL0H 08084017
*                                      OUT NO U.L. TRK MESSAGE     UL0H 08088017
         B     PROCEED                 RETURN TO VSRY FOR ROUTING  UL0H 08092017
*                                                                  UL0H 08096017
SAVEREG1 DS    F                       SAVE AREA FOR REG1       YA01684 08098002
SAVEREG0 DS    F                       SAVE AREA FOR REG0      @ZA07399 08098137
DV       DS    D                       CONVERSION AREA          YA01684 08098202
INFO     DS    0CL20                   +                         S21042 08098421
         DS    CL10                    +DEVICE TYPE              S21042 08098821
TRCYL    DS    CL2                     +CHARACTERISTICS          S21042 08099221
         DS    CL8                     +                         S21042 08099621
CCHHR    DS    CL5                     ABS ADDR OF 'TO' DSCB     S21042 08099721
PREAB    DC    A(PREABORT)                                         UL0H 08100017
         EXTRN  PREABORT                                           UL0H 08104017
WALENGTH DC    A(ENDWA-WORKAREA)       DEFINE WORKAREA LENGTH    S20201 08112020
DEFAULT1 DC    F'72500'                DEFAULT PRIMARY           S20201 08120020
DEFAULT2 DC    F'36250'                DEFAULT SECONDARY         S20201 08128020
DEFBLK   DC    H'160'                  ARBITRARY DEFAULT         S20201 08136020
HW1      DC    H'1'                                              S20201 08140021
CONST    DC    F'2'                                            @YA02566 08140502
DW       DS    D                                                OY01172 08141002
TIMEDATE DS    3C                                               OY01172 08142002
DSCBDATE DS    3C                                               OY01172 08143002
CAMLST1  CAMLST SEEK,0,0,0             OPTION BYTES FOR SEEK     S20201 08144020
*** RACF VERSION 2 EQUATES AND DECLARES                        @G32DSFS 08144432
RACFMSGT EQU   *                       RACF MESSAGE TABLE      @G32DSFS 08144832
         DC    X'36'                   PREVIOUSLY DEFINED      @G32DSFS 08145232
         DC    X'38'                   UNAUTHORIZED            @G32DSFS 08145632
         DC    X'1E'                   INVALID RET CODE        @G32DSFS 08146032
         DC    X'3A'                   MODEL NOT RACF DEFINED  @G32DSFS 08146432
ENDTAB   EQU *                         END RACF MSG TABLE      @G32DSFS 08146832
COPYAUTH EQU   X'10'                   COPYAUTH KEYWORD        @G32DSFS 08148032
DS1RACDF EQU   X'40'                   DSCB1 RACF BIT          @G32DSFS 08148432
RACRET4  DC    H'4'                    RACF RETURN CODE 4      @G32DSFS 08148832
RACRET16 DC    H'16'                   RACF RETURN CODE 16     @G32DSFS 08149232
MRACDEF  RACDEF DSTYPE=N,CLASS='DATASET',    RACDEF PARM LIST  @G32DSFS*08149632
               MF=L                                            @G32DSFS 08150032
LRACDEF  EQU   *-MRACDEF                                       @G32DSFS 08150432
MRACHECK RACHECK CLASS='DATASET',MF=L        RACHECK PARM LIST @G32DSFS 08150832
LRACHECK EQU   *-MRACHECK                                      @G32DSFS 08151232
         DC    CL50'CE PATCH AREA - 50 BYTES'                    S20201 08152020
         EJECT                                                          08160020
WORKAREA DSECT                                                   S20201 08168020
DEFSW    DS    CL1                                               S20201 08176020
FIRSTEXT DS    CL1                     X'FF',WHEN SCAN OF EXT1  OY01178 08180002
UNLOADSW DS    XL1                     X'80' WHEN SPACE QUANTITYYA01193*08181002
                                         ONLY REQUIRED FOR UNLD.YA01193 08182002
DEVCHAR  DS    5F                                                S20201 08184020
DEVCHAR2 DS    5F                                                S20201 08192020
SECSAVE  DS    F                       TO SAVE SECALLO FOR BDAM OY01178 08196002
SECALLO  DS    F                                                 S20201 08200020
PRIME    DS    F                                                 S20201 08208020
* THE NEXT SEVEN WORDS ARE BEING REUSED BY RACDEF AND RACHECK  @G32DSFS 08212032
ALIGN    DS    2F                                                S20201 08216020
RACDEF   EQU   ALIGN                   REUSE CAMLIST AREA      @G32DSFS 08218032
RACHECK  EQU   RACDEF                  REUSE CAMLIST AREA      @G32DSFS 08220032
CAMLIST  DS    4F                                                S20201 08224020
CONVSVE2 DS    4F                                                S20201 08232020
SAVE15   DS    F                                                 S20201 08240020
CONVSAVE DS    4F                                                S20201 08248020
CONVINP  DS    4F                                                S20201 08256020
DEBUCBAD DS    F                                                 S20201 08264020
         DS    H                                                 S20201 08272020
DEBSTRCC DS    CL8                                               S20201 08280020
         DS    H                                                 S20201 08288020
         DS    H                                                OY01178 08290002
EXTENTS  DS    CL26                                             OY01178 08292002
FT3DSCB  DS    CL350                                             S20201 08296020
ENDWA    EQU   *                                                 S20201 08304020
         EJECT                                                          08312020
UNITCHAR DSECT                                                   S20201 08320020
DEVTYPE  DS    F                                                 S20201 08328020
         DS    H                                                 S20201 08336020
TRACKCAP DS    H                                                 S20201 08344020
CYLPDEV  DS    H                                                 S20201 08352020
TRPCYL   DS    H                                                 S20201 08360020
TRLENGTH DS    H                                                 S20201 08368020
OVHCNT   DS    H                                                 S20201 08376020
KEYOVHD  DS    C                                                 S20201 08384020
OVHIND   DS    C                                                 S20201 08392020
TOLERANC DS    H                                                 S20201 08400020
         EJECT                                                 @G32DSFS 08402032
         IECDSECS TCB,JSCB,EXPAND=YES                          @G32DSFS 08404032
         EJECT                                                          08408020
CVT      DSECT                                                   S20201 08416020
         CVT                                                            08424020
         IEHMVV                                                         08460000
FROMVOL  EQU   IEHMVV22                ADDR OF FROMVOL -4      @G32DSFS 08461032
TOVOL    EQU   IEHMVV23+4              ADDR OF TOVOL -4        @G32DSFS 08462032
FROMDS   EQU   IEHMVV21                ADDR OF FROM DATA SET   @G32DSFS 08464032
TODS     EQU   IEHMVV21+4              ADDR OF TO DATA SET     @G32DSFS 08465032
         ORG   IEHMVV70                                                 08466020
         IEHDCBXL                                                       08472020
FT1DSCB  DSECT                                                   S20201 08482020
         IECSDSL1 (1)                                                   08500000
         ORG   DS1EXT1+3                                                08520000
DADPQ    DS    F                                                        08540000
DADDQ    DS    F                                                        08560000
DASD     EQU   X'20'                                                    08580000
NEWDSCB1 EQU   DS1DSIND-DS1DSNAM       OFFSET TO RECEIVING DSCB@G32DSFS 08600032
         END                                                            11600032
./  ADD  SSI=71610105,NAME=IEHMVSSY
 TITLE 'IEHMVSSY-ROUTING AND ERRORS FOR IEHMOVE LOAD MODULE ESY'        00010017
 TITLE 'IEHMVSSY-ROUTING AND ERRORS FOR IEHMOVE LOAD MODULE ESY'        00020017
*TITLE -IEHMVSSY                                                        00030017
*FUNCTION/OPERATION: MODULE IEHMVSSY HANDLES THE WRITING OF THE FIRST * 00040000
*RECORDS OF AN UNLOADED DATA SET AND MAKES THE DECISION OF WHICH IS   * 00060000
*TO BE GIVEN CONTROL TO DO THE ACTUAL MOVE/COPY OPERATION             * 00080000
*THIS CSECT HANDLES ABNORMAL CLOSES IF PREABORT IS DEMANDED AS THE    * 00083017
*RESULT OF ERRORS.  NO USER LABELS ARE PROCESSED DURING THESE ABNORMAL* 00086017
*TERMINATIONS.  FOR VARIABLE SPANNED RECORDS, THIS MODULE WILL IDEN-  * 00089017
*TIFY THIS FORMAT AND USE THIS ANALYSIS TO DETERMINE THE NEXT MODULE  * 00092017
*TO BE GIVEN CONTROL.                                                 * 00095017
*ENTRY POINTS: IEHMVESY                                               * 00100000
*INPUT: MOVE/COPY COMMUNICATIONS TABLE                                * 00120000
*OUTPUT: UNLOADED DATA SET HEADER RECORDS                             * 00140000
*EXTERNAL ROUTINES: BALR TO IEHMVSRM FOR UNLOADED WRITES              * 00148017
*                   LINK TO IEHMVLSU FOR MESSAGE WRITING              * 00156017
*                   BALR TO IEHMVSRX TO BUILD DCB'S                   * 00164017
*                   XCTL TO IEHMVESK FOR I/O ERRORS                   * 00172017
*EXITS-NORMAL DETERMINED AT EXECUTION TIME FROM TYPE OF REQUEST       * 00180000
*ERRORS: NONE                                                         * 00200000
*TABLES/WORKAREAS: MOVE/COPY COMMUNICATIONS TABLE                     * 00220000
*ATTRIBUTES: REUSEABLE                                                * 00240000
*NOTES: PART OF LOAD MODULE-IEHMVESY                                  * 00260000
*                                                                       00280002
*                                                                       00290002
IEHMVSSY CSECT                                                 @YA01681 00300002
*                                                                       00310002
*D017450-017550,019630-019750                                  @YA02612 00312002
*A024860-024920,030650-030750                                  @YA02605 00315002
*A072340-072370,110700                                         @YA01681 00320002
*D072340                                                       @YA01681 00330002
*                                                                       00340102
*D035400-047400,115600-116120                                   YA01193 00340202
*A035400-044400                                                 YA01193 00340302
*C053200                                                         A44360 00340421
*                                                                A30505 00341019
*                                                                A29052 00342019
*086200                                                          A18773 00345018
*3387000200,001600,003500,069400,069800,076800,077600,077760,078800VS0H 00350017
*019690,021200,028000,057850-058300,059300-059700                 19030 00352019
*--ANY STATEMENTS FLAGGED 19030 PERTAIN TO VARIABLE SPANNED RECORD--    00354019
*--SUPPORT FOR BDAM DATA SETS                                           00356019
*                                                                       00360000
*                                                                       00380000
IEHMVESY SAVE  (14,12),T,SSY-V2-L1                                      00400000
         ENTRY IEHMVESY                                                 00420000
*                                                                       00440000
*              REGISTERS                                                00460000
*                                                                       00480000
PASSA    EQU   0                                                        00500000
PASSB    EQU   1                                                        00520000
R0       EQU   0                                                        00525013
R1       EQU   1                                                        00530013
R15      EQU   15                                                       00535013
R2       EQU   2                                                        00540000
R3       EQU   3                                                        00560000
ACCE     EQU   4                                                        00580000
ACCO     EQU   5                                                        00600000
BASE     EQU   6                                                        00620000
R7       EQU   7                                                        00640000
R8       EQU   8                                                        00660000
R9       EQU   9                                                        00680000
R10      EQU   10                                                       00700000
R11      EQU   11                                                       00720000
MCTABLE  EQU   12                                                       00740000
SAVE     EQU   13                                                       00760000
RETURN   EQU   14                                                       00780000
LINK     EQU   15                                                       00800000
*                                                                       00820000
ANYSEL   EQU   X'02'                                                    00840000
BLANK    EQU   C' '                                                     00860000
BLOCKED  EQU   X'10'                                                    00880000
DSGROUP  EQU   X'10'                                                    00900000
FIXED    EQU   X'80'                                                    00920000
FVOLUME  EQU   X'80'                                                    00940000
NOTMOVE  EQU   X'80'                                                    00960000
ODD      EQU   X'01'                                                    00980000
ONES     EQU   X'FF'                                                    01000000
UDSORG   EQU   X'04'                                                    01020000
UNLOADM  EQU   X'7F'                                                    01040000
UNMOVE   EQU   X'08'                                                    01060000
U        EQU   X'C0'              RECFM UNDEFINED                  9373 01070013
F        EQU   X'80'              RECFM FIXED                      9373 01080013
V        EQU   X'40'              RECFM VAR                        9373 01090013
FB       EQU   X'90'              RECFM FIXED BLOCKED              9373 01100013
VB       EQU   X'50'              RECFM VAR BLOCKED                9373 01110013
VS       EQU   X'48'              RECFM VARIABLE SPANNED           VS0H 01113017
VBS      EQU   X'58'              RECFM VARIABLE BLOCKED SPANNED   VS0H 01116017
VOLUME   EQU   X'02'                                                    01120000
ZERO     EQU   X'00'                                                    01140000
DEACTIVE EQU   X'00'                                               UL0H 01150017
*                                                                       01160000
BASESET  BALR   BASE,0                                                  01180000
    USING  *,BASE                                                       01200000
BB       DS    0H                                                       01220000
         USING IEHMVV,MCTABLE                                           01240000
*                                  PROCESS                              01260000
*                                       CALL BUILD DCB AND GO TO DADSM  01280000
    IEHPRE  (14,1),TFC,                                                 01300000
*                                                                       01320000
         L     LINK,BUILDDCB            GET ADDRESS                     01340000
         BALR  RETURN,LINK              BRANCH                          01360000
*                                                                       01380000
*                                                                       01400000
*                                                                       01420000
*                                  SET UP TO SEARCH DSORG TABLE         01440000
         L     ACCE,IEHMVV30+8          GET ADDR OF DSCB                01460000
         LA    ACCO,DSORGTAB                                            01480000
*                                                                       01500000
*                                  TURN OFF UNMOVEABLE                  01520000
DSLOOP   DS    0H                                                       01540000
         CLC   0(2,ACCO),FILETYPE(ACCE) COMPARE DSORG WITH TABLE        01560000
*                                                                       01580000
         BE    EQDSORG                  EQUAL                           01600000
         LA    ACCO,4(ACCO)             INCREMENT COMPARE               01620000
         CLI   0(ACCO),ONES                                             01640000
         BNE   DSLOOP                   NO                              01660000
*                                       YES, ERROR CONDITION            01680000
*        MESSAGE                                                        01700000
         MVI   IEHMVV61,UDSORG                                          01720000
         B     PREAB1                                                   01740000
*                                                                       01760000
*                                                                       01780000
EQDSORG  DS    0H                                                       01800000
         LA    R3,PATIS                TEST FOR ISAM ORGANIZATION       01820000
         CR    R3,ACCO                 BY CHECKING POINTER TO           01840000
         BNE   *+12                    DSORG TABLE - BRANCH IF NOT      01860000
         MVI   IEHMVV61,32             PRINT A MESSAGE IF IT IS ISAM    01880000
         B     PREAB1                  AND SKIP THE DATASET             01900000
         SR    R3,R3                    GET XCTL TABLE DISPLACEMENT     01920000
         IC    R3,3(0,ACCO)                                             01940000
*                                                                       01960000
         TM    IEHMVV20,CATALOG         CATALOG FUNCTION                01980000
         BO    TCAT                     YES                             02000000
*                                       NO                              02020000
*                                                                       02040000
         TM    IEHMVV20+2,ANYSEL                                        02060000
         BO    SELECT                                                   02080000
*                                                                       02100000
TST20    TM    IEHMVV20+1,BOTH     BOTH LOAD AND UNLOAD           19030 02120019
         BO    YESBOTH                  YES                             02140000
*                                       NO                              02160000
         TM    IEHMVV20+1,LOAD          ONLY LOAD                       02180000
         BO    YESLOAD                  YES                             02200000
*                                       NO                              02220000
         TM    IEHMVV20+1,UNLOAD        UNLOAD ONLY                     02240000
         BO    YESUNLD                  YES                             02260000
         B     XCTLEXEC                 NO                              02280000
*                                                                       02300000
SELECT   DS    0H                                                       02320000
         LA    R3,GOSELECT(0,0)                                         02340000
    B  XCTLEXEC                                                         02360000
GOSELECT EQU    30                                                      02380000
TCAT     DS    0H                                                       02400000
         L     ACCE,IEHMVV23+4          TO DEVICE DIRECT ACCESS         02420000
         CLI   2(ACCE),DASD                                             02440000
         BE    OKCAT                    YES                             02460000
         OI    IEHMVV20+1,UNLOAD        NO, UNLOAD                      02480000
         TM    IEHMVV20+5,X'40'        UNLOAD REQUEST          @YA02605 02486002
         BO    *+12                    YES DO NOT PRINT MSG    @YA02605 02492002
         MVI   IEHMVV61,X'01'           INDICATE MESSAGE                02500000
     BAL   RETURN,MSG                                                   02520000
         TM    IEHMVV20+1,LOAD          LOAD ALSO                       02540000
         BO    LUCAT                    YES                             02560000
         LA    R3,DAVEBRCE              NO                              02580000
DAVEBRCE EQU   28                                                       02600000
         B     UNCAT                                                    02620000
OKCAT    DS    0H                                                       02640000
         LA    R3,DAVEBRCE              SET UP TO GO TO CATALOG         02660000
         TM    IEHMVV20+1,LOAD          LOAD CONDITION                  02680000
    BZ   *+8                                                            02700000
         LA    R3,LOADCAT               YES, SET UP XCTL ROUTE          02720000
LOADCAT  EQU   26                                                       02740000
         B     XCTLEXEC                                                 02760000
*                                                                       02780000
YESBOTH  TM    26(ACCE),X'20'      TEST FOR BDAM DSORG            19030 02790019
         BC    1,*+8               IT IS BDAM WE'RE SET FOR 'STL' 19030 02800019
         LA    R3,LUDIS(0,0)       SET TO XCTL TO 'ERA'           19030 02810019
LUCAT    EQU   YESBOTH                                                  02820000
LUDIS    EQU   24                                                       02840000
         CLI   IEHMVV61,ZERO       IS THERE A MESSAGE TO BE PRINTED3826 02846018
         BE    *+8                 NO SKUP MESSAGE WRITER          3826 02852018
         BAL   RETURN,MSG               GO TO MSG WRITER                02860000
         B     XCTLEXEC                                                 02880000
YESLOAD  EQU   *                                                        02900000
         LA    R3,LOADDIS(R3)           SET UP XCTL TAB FOR LOAD        02920000
LOADDIS  EQU   4                                                        02940000
         B     XCTLEXEC                                                 02960000
YESUNLD  DS    0H                                                       02980000
         CLI   IEHMVV61,ZERO       IS THERE A MESSAGE ?          A29052 02986019
         BE    UNWRITE             NO.                           A29052 02992019
         BAL   RETURN,MSG                                               03000000
UNWRITE  DS    0H                                                       03020000
         LA    R3,UNLDDIS(R3)           SET UP XCTL TABLE FOR UNLOAD    03040000
UNCAT    DS    0H                                                       03060000
         TM    IEHMVV20+5,X'40'        UNLOAD REQUEST          @YA02605 03065002
         BNO   *+8                     NO BRANCH AROUND        @YA02605 03070002
         NI    IEHMVV41+13,X'FE'       YES RESET RETURN CODE   @YA02605 03075002
*                                                                       03080000
*                                                                       03100000
***** WRITE FIRST RECORD OF UNLOADED DATA SET *****                     03120000
         LA    REG0,1(0,0)                                              03140000
         LNR   REG0,REG0               SET UP REGISTER FOR BWRITE RTN   03160000
         LA    REG1,UNLREC1            ADDR OF RECORD                   03180000
         BAL   REG2,UNLWRT                                              03200000
***** WRITE DSCB ON UNLOADED DATA SET *****                             03220000
         L     REG2,IEHMVV30+8         DSCB ADDR                        03240000
         LR    REG1,MCTABLE                                             03260000
         USING UNLDLLI,REG1                                             03280000
         MVC   IECSDSL1(140),0(REG2)   COPY THE DSCB INTO RECORD        03300000
         MVC   UNLDLLI(3),UNLKDS       SET UP LLI IN RECORD             03320000
         MVC   UNLDDIR(2),IEHMVV25     COPY THE DIRECTORY QUANTITY      03340000
         MVI   UNLDFLAG,X'00'          SET THE OLD UNLOAD FLAG          03360000
         SPACE 1                                                        03380000
         L     ACCO,IEHMVV30+12        GET THE 'FROM' DDNAME            03400000
         LA    ACCO,0(ACCO)            STRIP OFF HI-ORDER BYTE    S2021 03410020
         DEVTYPE (ACCO),DEVCHAR,DEVTAB GET THE 'FROM' CHARACTERISTICS   03420000
         LR    REG1,MCTABLE                                             03440000
         MVC   UNLDDEVT(4),DEVCHAR      SAVE ORIGINAL DEVICE TYPE       03460000
         CLI   DEVCHAR+2,X'20'         TEST 'FROM' DEVICE FOR D.A.      03480000
         BNE   PATCH2                  BRANCH IF NOT D.A.               03500000
         MVI   UNLDFLAG,X'40'          SET THE NEW UNLOAD FLAG          03520000
         L     ACCO,IEHMVV85           GET PTR TO INFORMATION   YA01193*03540002
                                         PASSED FROM IEHMVSSX   YA01193 03840002
         MVC   UNLDSIZE(8),0(ACCO)     SET PRIM. AND SEC. SIZE  YA01193 04140002
         XC    UNLDSPAR(42),UNLDSPAR   ZERO OUT UNUSED BYTES    YA01193 04440002
         SPACE 3                                                        04760000
PATCH2   DS    0H                                                       04780000
         LR    REG1,MCTABLE             WRITE OUT HEADER RECORD         04800000
         LA    REG0,1                                                   04820000
         TM    IEHMVV10-4,UNMOVE                                        04840000
    BZ   AZBY                                                           04860000
       OI    145(REG1),X'80'        SET UNLOAD UNMOVEABLE SWITCH        04880000
AZBY     DS    0H                                                       04900000
         LA    REG0,0(0,0)                                              04920000
         BAL   REG2,UNLWRT                                              04940000
UNLRET   DS    0H                                                       04960000
         B     THISUN                                                   04980000
UNLWRT   L     REG15,ADBWRT            ADDR OF BWRITE RTN               05000000
         BALR  REG14,REG15                                              05020000
         LTR   REG15,REG15             IO ERROR                         05040000
         BH    UNLIO                                                    05060000
         BR    REG2                                                     05080000
UNLIO    EQU   *                                                        05100000
         MVI   IEHMVV61,X'06'                                           05120000
         B     PREAB1                                                   05140000
***** CONSTANTS *****                                                   05160000
UNLREC1  DC    FL2'75'                                                  05180000
         DC    X'0E'                                                    05200000
         DC    CL32'THIS IS AN UNLOADED DATA SET PRO'                   05220000
         DC    CL8'DUCED BY'                                            05240000
         DC    X'80'                                                    05260000
         DC    CL32'THE IBM UTILITY, SYSMOVE.OMMBRLD'                   05280000
         DC    CL2'WB'                                                  05300000
UNLKDS   DC    X'00C500'                                         A44360 05320021
ADBWRT   DC    A(IEHMVERM)                                              05340000
         EXTRN IEHMVERM                                                 05360000
         ENTRY UNLREC1                                                  05380000
***** REGISTER DESIGNATION *****                                        05400000
REG0     EQU   0                                                        05420000
REG1     EQU   1                                                        05440000
REG2     EQU   2                                                        05460000
REG12    EQU   12                                                       05480000
REG14    EQU   14                                                       05500000
REG15    EQU   15                                                       05520000
THISUN   EQU   *                                                        05540000
UNLDDIS  EQU   2                                                        05560000
         B     XCTLEXEC                                                 05580000
*                                                                       05600000
*                                                                       05620000
XCTLEXEC EQU   *                                                        05640000
*                                                                       05660000
*                                                                       05700000
XCTLREEN DS    0H                                                       05720000
*                                                                       05740000
         LA    R3,XCTLTAB(R3)                                           05760000
         CLI   0(R3),ONES          XCTL OR BRANCH                       05780000
         BE    BRTO                    BRANCH, NOT XCTL            VS0H 05782017
         B     XCTLPRE             XCTL TO MODULE                 19030 05802019
*                                                                  VS0H 05835017
XCTLPRE  MVC   ENTMOD(2),0(R3)          SETUP XCTL NAME                 05840000
XCTL     DS    0H                                                       05860000
       IEHPOST (14,1),TFC,                                         9373 05870013
*                                                                       05880000
         L     14,12(0,13)                                              05900000
         XCTL  (2,12),EPLOC=MODNAME                                     05920000
BRTO     DS    0H                                                       05980000
*                                            IN THIS LOAD MODULE        06000000
         SR    ACCE,ACCE                                                06020000
         IC    ACCE,1(R3)                                               06040000
         L     LINK,BRANCHTO(ACCE)                                      06060000
         BALR  RETURN,LINK              GO TO ROUTINE                   06080000
*                                                                       06100000
         LA    ACCO,BRANCHTO(ACCE)                                      06120000
         MVC   ENTMOD(2),6(ACCO)                                        06140000
         B     XCTL                     BRANCH TO XCTL ROUTINE          06160000
BUILDDCB DC    A(IEHMVESX)                                              06180000
         EXTRN IEHMVESX                                                 06200000
FILETYPE EQU   X'52'                                                    06220000
PS       EQU   X'02'                                                    06240000
BOTH     EQU   X'03'                                                    06260000
         DS    0D                                                       06280000
MODNAME  DC    CL6'IEHMVE'                                              06300000
ENTMOD   DS    CL2                                                      06320000
         DS    0F                                                       06340000
DSORGTAB DS    0H                                                       06360000
         DC    X'4000'                  PHYSICAL SEQUENCIAL             06380000
         DC    H'0'                                                     06400000
         DC    X'0000'                                                  06420000
         DC    H'0'                                                     06440000
         DC    X'2000'                  BDAM                            06460000
         DC    H'6'                                                     06480000
PATIS    DC    X'8000'                 ISAM DSORG                       06500000
         DC    H'0'                                                     06520000
         DC    X'0200'                  PDS                             06540000
         DC    H'18'                                                    06560000
         DC    X'FFFF'                  END OF TABLE                    06580000
         DS    0D                                                       06600000
XCTLTAB  DS    0H                                                       06620000
         DC    X'FF00'             BSAM NORMAL                          06640000
      DC   CL2'RD'                      SAM UNLOAD                      06660000
         DC    CL2'RA'                  SAM LOAD                        06680000
         DC    CL2'TL'                  BDAM NORMAL                     06700000
     DC    CL2'TL'                      BDAM UNLOAD                     06720000
     DC   CL2'TL'                       BDAM LOAD                       06740000
         DC    3XL2'0'                 SPACE FOR ISAM - NEVER USED      06760000
         DC    X'FF08'             PDS  NORMAL                          06780000
         DC    CL2'RD'                  PDS UNLOAD                      06800000
         DC    CL2'RA'                  PDS  LOAD                       06820000
    DC   CL2'TJ'     LOAD-UNLOAD                                        06840000
         DC    CL2'TA'                  CATALOG                         06860000
         DC    CL2'SC'                  CATALOG AND UNLOAD CATALOG      06880000
         DC    CL2'TG'                  SELECT                          06900000
         DC    CL2'TJ'        BSAM U                   CODE=32          06920000
         DC    C'TJ'                   BSAM V, VS NORMAL CODE=34   VS0H 06940017
   DC   X'FF10'    BSAM  VB  REBLOCK    CODE=36                         06960000
         DC    C'SM'                   BSAM VB OR VBS    CODE=38   VS0H 06980017
         DC    CL2'TJ'        BSAM F   NORMAL          CODE=40          07000000
         DC    X'FF18'        BSAM,FB,REBLOCK     CODE=42               07020000
         DC    CL2'TJ'        BSAM FB  NO REBLOCK      CODE=44          07040000
*                                                                  VS0H 07044017
*THE FOLLOWING ENTERIES ARE CURRENTLY UNUSED.  PDS ROUTINES USE THEVS0H 07048017
* SAME ROUTINES AS BSAM AND USE TABLE OFFSETS 32 THRU 44 ABOVE     VS0H 07052017
*                                                                  VS0H 07056017
         DC    CL2'TJ'        PDS  U                   CODE=46          07060000
         DC    CL2'TJ'        PDS  V   NORMAL          CODE=48          07080000
    DC   X'FF10'    PDS   VB  REBLOCK  CODE=50                          07100000
         DC    CL2'TJ'        PDS  VB  NO REBLOCK      CODE=52          07120000
         DC    CL2'TJ'        PDS  F   NORMAL          CODE=54          07140000
         DC    X'FF18'         PDS,FB,REBLOCK    CODE=56                07160000
         DC    CL2'TJ'        PDS  FB  NO REBLOCK      CODE=58          07180000
         DS    0F                                                       07200000
BRANCHTO DS    0H                                                       07201017
         DC    A(SAM)                                                   07202017
         DC    CL4'  SK'                                                07203017
         DC    A(PDS)                                                   07204017
         DC    CL4'  SK'                                                07205017
         DC    A(SMBIT)                                                 07206017
         DC    CL4'  SM'                                                07207017
         DC    A(SLBIT)                                                 07208017
         DC    CL4'  SL'                                                07209017
*                                                                       07210017
BUILDREQ DS    0H                                                       07214017
LOAD     EQU   X'02'                                                    07218017
UNLOAD   EQU   X'01'                                                    07222017
EOF      EQU   X'20'                                                    07226017
SAM      EQU   *                                                   9373 07230017
PDS      L     R2,IEHMVV30+8           GET FROM DSCB ADDRESS   @YA01681 07234002
         CLC   107(8,R2),ZEROS         CHECK FOR MODEL-DSCB    @YA01681 07234502
         BNE   NODSCB                  NO MODEL-DSCB           @YA01681 07235002
         CLC   95(3,R2),ZEROS          CHECK FOR MODEL-DSCB    @YA01681 07235502
         BNE   NODSCB                  NO MODEL DSCB           @YA01681 07236002
         L     R2,IEHMVV22+4           ADDRESS OF FROM VOLLIST @YA01681 07236102
         CLI   2(R2),X'20'             FROM DEVICE DA          @YA01681 07236202
         LA    R3,44                   SET UP XCTL TO ETJ      @YA01681 07236502
         BE    XCTLREEN                YES MUST BE MODEL DSCB  @YA01681 07236702
NODSCB   L     ACCE,IEHMVV30           FROM DCB ADDRESS        @YA01681 07237002
         L     ACCO,IEHMVV31           TO DCB ADDR                 9373 07238017
         TM    36(ACCE),U              FROM U RECFM                9373 07242017
         BO    FROMU                   YES                         9373 07246017
         TM    36(ACCO),U              TO U RECFM                  9373 07250017
         BO    TOISU                   YES                         9373 07254017
         TM    36(ACCE),FB             FROM FB RECFM               9373 07258017
         BC    12,ISFROMF              NO                          9373 07262017
         TM    36(ACCO),FB             TO FB RECFM                 9373 07266017
         BC    12,FBTOF                NO                          9373 07270017
         CLC   82(2,ACCE),82(ACCO)     LRECL EQUAL                 9373 07274017
         BNE   FMERR                   NO IT IS AN ERROR           9373 07278017
         CLC   62(2,ACCE),62(ACCO)     BLKSIZE EQUAL               9373 07282017
         BNE   ESLMOD                  NO GO TO REBLOCK            9373 07286017
         LA    R3,44                    SET UP FOR FB MOD ETJ      VS0H 07290017
         B     XCTLREEN                GO SET UP XCTL TO ETJ       VS0H 07294017
ETJMOD   LA    R3,32                   SET UP FOR IEHMVETJ         9373 07298017
         B     XCTLREEN                                            9373 07302017
FBTOF    TM    36(ACCO),F              TO F RECFM                  9373 07306017
         BC    12,FMERR                NO IT IS AN ERROR           9373 07310017
         CLC   62(2,ACCO),82(ACCE)     TO BLK EQU FROM LRECL       9373 07314017
         BNE   FMERR                   NO IT IS AN ERROR           9373 07318017
ESLMOD   CLI   16(ACCE),ZERO       FROM KEYLENGTH ZERO ?         A30505 07319019
         BNE   FMERR               NO--CAN'T REBLOCK KEYED DS    A30505 07320019
         CLI   16(ACCO),ZERO       IS TO KEYLENGTH ZERO ?        A30505 07321019
         BNE   FMERR               NO- CAN'T REBLOCK KEYED DS.   A30505 07322019
         LA    R3,42               SET UP FOR ESL.               A30505 07323019
         B     XCTLREEN                                                 07324019
ISFROMF  TM    36(ACCE),F              FROM F RECFM                9373 07330017
         BC    12,ISFRMVBS             NO                          VS0H 07335017
         TM    36(ACCO),FB             TO FB RECFM                 9373 07340017
         BC    12,FTOF                 NO                          9373 07345017
         CLC   62(2,ACCE),82(ACCO)     FROM BLK EQU TO LRECL       9373 07350017
         BE    ESLMOD                  YES                         9373 07355017
         B     FMERR                   NO IT IS AN ERROR           9373 07360017
FTOF     TM    36(ACCO),F              TO F RECFM                  9373 07365017
         BC    12,FMERR                NO IT IS AN ERROR           9373 07370017
         CLC   62(2,ACCE),62(ACCO)     BLKS EQUAL                  9373 07375017
         BNE   FMERR                   NO IT IS AN ERROR           9373 07380017
         LA    R3,40                    SET UP F TO F MOD ETJ      VS0H 07385017
         B     XCTLREEN                GO SET UP XCTL TO ETJ       VS0H 07390017
ISFRMVBS DS    0H                                                  VS0H 07395017
         TM    36(ACCE),VBS             FROM VBS RECFM             VS0H 07400017
         BC    12,ISFROMVB              NO                         VS0H 07405017
         TM    36(ACCO),VBS             TO VBS RECFM               VS0H 07410017
         BC    12,FMERR                 NO IT IS AN ERROR          VS0H 07415017
         CLC   82(2,ACCE),82(ACCO)      LRECL EQUAL                VS0H 07420017
         BNE   FMERR                    NO IT IS AN ERROR          VS0H 07425017
         CLC   62(2,ACCE),62(ACCO)      BLKSIZE EQUAL              VS0H 07430017
         BNE   FMERR                    NO IT IS AN ERROR          VS0H 07435017
         LA    R3,38                   SET UP FOR VBS/VBS (ESM)    VS0H 07440017
         LA    R3,34               SET UP FOR ETJ                A30505 07442019
         B     XCTLREEN                GO GIVE CONTROL TO ESM      VS0H 07445017
ISFROMVB TM    36(ACCE),VB             FROM VB RECFM               9373 07450017
         BC    12,ISFROMVS             NO                          VS0H 07454017
         TM    36(ACCO),VB             TO VB RECFM                 9373 07458017
         BC    12,VBTOV            NO                                   07459019
         CLC   62(2,ACCE),62(ACCO)   BLKSIZES EQUAL ?            A30505 07460019
         BE    ETJMOD              NO REBLOCKING GO TO ETJ       A30505 07461019
         B     ESMMOD              IF REBLOCKING CHECK FOR KEYS  A30505 07462019
         LA    R3,38                   SET UP FOR VB TO VB--ESM    VS0H 07466017
         B     XCTLREEN                GO SET UP TO PASS CONTROL   VS0H 07470017
ESMMOD   CLI   16(ACCE),ZERO       IS FROM KEYLENGTH ZERO.       A30505 07471019
         BNE   FMERR               NO-- CAN'T REBLOCK KEYED DS.  A30505 07472019
         CLI   16(ACCO),ZERO       IS TO KEYLENGHT ZERO?         A30505 07473019
         BNE   FMERR               NO--CAN'T REBLOCK KEYED DS.   A30505 07474019
         LA    R3,38               SET UP TO REBLOCK IN ESM.     A30505 07475019
         B     XCTLREEN                                                 07476019
VBTOV    TM    36(ACCE),V              TO V RECFM                  9373 07482017
         BO    ESMMOD                  YES                         9373 07492017
         B     FMERR                   NO IT IS AN ERROR           9373 07502017
ISFROMVS DS    0H                                                  VS0H 07512017
         TM    36(ACCE),VS              FROM VS RECFM              VS0H 07522017
         BC    12,ISFROMV               NO                         VS0H 07532017
         TM    36(ACCO),VS              TO VS RECFM                VS0H 07542017
         BC    12,FMERR                 NO IT IS AN ERROR          VS0H 07552017
         CLC   82(2,ACCE),82(ACCO)      LRECL EQUAL                VS0H 07562017
         BNE   FMERR                    NO IT IS AN ERROR          VS0H 07572017
         CLC   62(2,ACCE),62(ACCO)      BLKSIZE EQUAL              VS0H 07582017
         BNE   FMERR                    NO IT IS AN ERROR          VS0H 07592017
VSETJMOD LA    R3,34                    SET UP FOR VS TO VS MOD ETJVS0H 07602017
         B     XCTLREEN                GO SET UP TO PASS CONTROL   VS0H 07632017
ISFROMV  TM    36(ACCE),V              FROM V RECFM                9373 07662017
         BC    12,FMERR                NO                          9373 07682017
         TM    36(ACCO),VB             TO VB RECFM                 9373 07702017
         BO    ESMMOD                  YES                         9373 07722017
         TM    36(ACCO),V              TO V RECFM                  9373 07742017
         BO    VSETJMOD                SET UP FOR VS/VS MOD VETJ   VS0H 07762017
         B     FMERR                   NO IT IS AN ERROR           9373 07782017
FROMU   TM    36(ACCO),U               TO U RECFM                  9373 07802017
         BC    12,FMERR                NO IT IS AN ERROR           9373 07822017
         B     ETJMOD                  YES                         9373 07842017
TOISU    CLC   62(2,ACCO),62(ACCE)     TO BLK EQU OR GRTR FROM     9373 07862017
         BL    FMERR                   NO IT IS AN ERROR           9373 07882017
         B     ETJMOD                  YES                         9373 07902017
ZZW      DC    X'0000'                                                  07922017
FMERR    MVI   IEHMVV61,X'24'          SET ERROR MESSAGE CODE      9373 07942017
         B     PREAB1                                              9373 07962017
SMBIT    DS    0H                                                       08060000
    OI   IEHMVV20+4,X'20'    INDICATE SM RETURN                         08080000
   BR   RETURN                                                          08100000
SLBIT    DS    0H                                                       08120000
         OI    IEHMVV20+4,BLANK                                         08140000
    BR   RETURN                                                         08160000
         TITLE 'PRE ABORT ROUTINE'                                      08180000
PREABORT DS    0H                                                       08200000
         ENTRY PREABORT                                                 08220000
*                                                                       08240000
   BALR   BASE,0                                                        08260000
    USING   *,BASE                                                      08280000
   L   BASE,B                                                           08300000
    USING   BB,BASE                                                     08320000
*                                                                       08440000
   IEHPOST  (14,1),TFC,                                                 08460000
PREAB1   DS    0H                                                       08480000
    BALR   BASE,0                                                       08500000
     USING   *,BASE                                                     08520000
    L    BASE,B                                                         08540000
   USING   BB,BASE                                                      08560000
         TM    IEHMVV10-4,FVOLUME  FROM VOLUME TO BE CLOSED        9373 08563013
         BO    CLOSEF              YES                             9373 08566013
FCLOSE   TM    IEHMVV10-4,BLANK    TO VOLUME TO BE CLOSED          9373 08569013
         BO    CLOSET              YES                             9373 08572013
TCLOSE   DS    0H                                                  9373 08575013
    BAL   RETURN,MSG                                                    08580000
    IEHPOST  (14,1),TFC,                                                08600000
         MVI   IEHMVV41+13,X'04'       SET RETURN CODE           A18773 08620018
         OI    IEHMVV20+2,BLANK   TURN ON MIDABORT                      08640000
         TM    IEHMVV20,VOLUME     VOLUME OPERATION                     08660000
    BO   SINGLE                                                         08680000
         MVC   IEHMVV00(6),MODNAME                                      08700000
         MVI   IEHMVV00+6,C'S'     ADD S TO MODULE NAME                 08720000
         TM    IEHMVV20,DSGROUP    DSGROUP OPERATION                    08740000
         BO    GODSG                                                    08760000
         TM    IEHMVV20+2,EOF                                           08780000
         BO    GOHOME                                                   08800000
         MVI   IEHMVV00+7,C'T'     ADD T TO MODULE NAME                 08820000
ALLDONE  DS    0H                                                       08840000
         XCTL  (2,12),EPLOC=(12)                                        08860000
SINGLE   MVC   IEHMVV00(6),MODNAME                                      08880000
         MVI   IEHMVV00+6,C'S'                                          08900000
         MVI   IEHMVV00+7,C'Z'                                          08920000
         B     ALLDONE                                                  08940000
*                                                                       08960000
GOHOME   MVI   IEHMVV00+7,C'K'                                          08980000
         B     ALLDONE                                                  09000000
GODSG    DS    0H                                                       09020000
         MVI   IEHMVV00+7,C'H'                                          09040000
         B     ALLDONE                                                  09060000
CLOSEF   DS    0H                                                       09080000
         L     ACCE,IEHMVV30       ADDRESS OF FROM DCB                  09100000
         MVI   IEHMVV70+8,DEACTIVE     DEACTIVATE INPUT TRLR EXIT  UL0H 09110017
         CLOSE ((ACCE))                                                 09120000
         B     FCLOSE                                                   09140000
CLOSET   DS    0H                                                       09160000
         L     ACCE,IEHMVV31       ADDRESS OF TO DCB                    09180000
         MVI   IEHMVV70+12,DEACTIVE    DEACTIVATE OUTPUT TRLR EXIT UL0H 09190017
         CLOSE ((ACCE))                                                 09200000
         B     TCLOSE                                                   09220000
CATALOG  EQU   X'04'                                                    09240000
DASD     EQU   X'20'                                                    09260000
         TITLE 'MESSAGE HANDLER'                                        09280000
MSG      DS    0H                                                       09300000
         STM   REG0,REG15,200(REG12) STORE REGISTERS                    09320000
    DROP   BASE                                                         09340000
         BALR  REG15,0                                                  09360000
         USING *,REG15                                                  09380000
   L   BASE,B                                                           09400000
         DROP  REG15                                                    09420000
    USING   BB,BASE                                                     09440000
         LR    R7,RETURN                                                09460000
         MVI   IEHMVV00,ONES                                            09480000
         MVI   IEHMVV00+1,BLANK                                         09500000
         MVC   IEHMVV00+2(120),IEHMVV00+1                               09520000
         TM    IEHMVV61,ODD                                             09540000
*                                       MESSAGE                         09560000
         BO    NORMMES                       NORMAL MESSAGE             09580000
*                                            DATA SET MESSAGE           09600000
*                                                                       09620000
         MVC   IEHMVV00+1(4),IEH4       SET UP MSG NUMBER               09640000
         LA    ACCE,127                                                 09660000
         SR    ACCO,ACCO           MAKE HIGH ORDER BIT OF FIRST BYTE    09680000
         IC    ACCO,IEHMVV61               ZERO                         09700000
         NR    ACCO,ACCE                                                09720000
         L     R3,AIEH4DD          ADDR OF CODE                         09740000
         LA    ACCO,0(R3,ACCO)     SET UP MESSAGE DIAGNOSTIC CODE       09760000
    MVC  IEHMVV00+5(2),0(ACCO)                                          09780000
         MVI   IEHMVV00+7,X'C9'                                         09800000
         L     ACCE,MSGH                SET UP MSG HEADER               09820000
         LA    ACCO,7                                                   09840000
         BAL   R8,MSGMOVE                                               09860000
*                                                                       09880000
         L     ACCE,IEHMVV21            SET UP DSNAME                   09900000
         LA    ACCO,43                                                  09920000
         BAL   R8,MSGMOVE                                               09940000
         TM    IEHMVV61,NOTMOVE    UNLOAD MSG OR NOT MOVED              09960000
         BO    MSGUNLD                       UNLOAD MSG                 09980000
         LA    ACCE,2                        NOT MOVED                  10000000
MSGAA    DS    0H                                                       10020000
         BAL   R8,MSGDMOVE              SET UP FINAL PART               10040000
         SR    ACCE,ACCE                                                10060000
         IC    ACCE,IEHMVV61                 OF MSG                     10080000
         BAL   R8,MSGDMOVE                                              10100000
PRINTMES SR    REG0,REG0           TO PRINT A NORMAL MSG                10120000
         LA    3,IEHMVV00                                               10140000
         LINK  EP=IEHMVESU                                              10160000
         B     MSGCHECK(LINK)           CHECK RETURNS                   10180000
MSGCHECK B     GOODMSG                  GOOR WRITE                      10200000
         XCTL  EP=IEHMVESK              I/O ERROR                       10220000
*                                                                       10240000
GOODMSG  LR    RETURN,R7                                                10260000
         MVI   IEHMVV61,ZERO       MOVE ZERO INTO MSG INDICATOR         10280000
         LM    REG0,REG15,200(REG12)                                    10300000
         BR    RETURN                                                   10320000
MSGUNLD  DS    0H                                                       10340000
         NI    IEHMVV61,UNLOADM    TURN OFF UNLOAD MSG BIT              10360000
         LA    ACCE,0                                                   10380000
         B     MSGAA                                                    10400000
MSGDMOVE DS    0H                                                       10420000
    SLL   ACCE,1                                                        10440000
         L     R3,ADMSG            LOAD ADDRESS OF MESSAGESTART         10460000
         LH    ACCO,2(R3,ACCE)                                          10480000
         LH    ACCE,0(R3,ACCE)                                          10500000
         A     ACCE,MSGH                                                10520000
MSGMOVE  DS    0H                                                       10540000
         LA    R9,IEHMVV00+121                                          10560000
MSGLOOP  CLI   0(R9),BLANK         FIND LAST NONBLANK                   10580000
         BNE   MSGPL                         CHARACTER IN               10600000
         BCT   R9,MSGLOOP                    MSG AREA                   10620000
MSGPL    DS    0H                                                       10640000
         EX    ACCO,MSMOVE         MOVE MSG INTO PRINTOUT AREA          10660000
         BR    R8                  BRANCH BACK TO FINISH MSG            10680000
NORMMES  DS    0H                                                       10700000
         SR    ACCE,ACCE                                                10720000
         IC    ACCE,IEHMVV61            GET MESSAGE CODE                10740000
         LA    ACCE,1(0,ACCE)                                           10760000
         SLL   ACCE,1                   CALCULATE MESSAGE POINTER       10780000
*                                                                       10800000
         L     R3,ANORMALM         LOAD ADDR OF NORMAL MSG              10820000
         L     ACCE,0(R3,ACCE)     GET MSG PTR                          10840000
         SR    ACCO,ACCO                                                10860000
         IC    ACCO,0(ACCE,0)           GET MESSAGE LENGTH              10880000
         LA    ACCE,1(0,ACCE)                                           10900000
         EX    ACCO,NORMM               MOVE MESSAGE TO PRINT AREA      10920000
         B     PRINTMES                 GO TO PRINT MESSAGE             10940000
NORMM    MVC   IEHMVV00+1(1),0(ACCE)                                    10960000
B        DC    A(BB)                                                    10980000
         ENTRY MSG                                                      11000000
IEH4     DC    CL4'IEH4'                                                11020000
MSMOVE   MVC   2(1,R9),0(ACCE)                                          11040000
MSGH     DC    A(MSGHEAD)               POINTER TO MESSAGES             11060000
ZEROS    DC    2F'0'                                           @YA01681 11070002
ADMSG    DC    A(MSGSTART)                                              11080000
ANORMALM DC    A(NORMALM)                                               11100000
AIEH4DD  DC    A(IEH4DD)                                                11120000
         EXTRN MSGSTART                                                 11140000
         EXTRN NORMALM                                                  11160000
         EXTRN IEH4DD                                                   11180000
         EXTRN MSGHEAD                                                  11200000
         IEHMVV                                                         11220000
         SPACE                                                          11240000
DEVCHAR  EQU   IEHMVV00+200            SPACE FOR DEVICE CHARACTER DATA  11260000
         SPACE 3                                                        11280000
UNLDREC  DS    0D                      DEFINE THE HEADER RECORD         11300000
         DS    XL1   (PHONY BYTE)      FOR UNLOADED DATASETS            11320000
UNLDLLI  DS    XL3                     LENGTH FIELD                     11340000
         SPACE 2                                                        11360000
F1DSCB   DS    0F                                                       11370013
         IECSDSL1  (1)                 DEFINE A FORMAT 1 DSCB           11380000
         SPACE 2                                                        11400000
UNLDDIR  DS    XL2                     DIRECTORY QUANTITY               11420000
UNLDFLAG DS    XL1                     UNLOAD CONTROL FLAG              11440000
UNLDSIZE DS    XL4                      PRIM ALLOC OF DS (IN BYTES)     11460000
UNLDSSIZ DS    XL4                      SEC ALLOCATION OF DS (IN BYTES) 11480000
UNLDSPAR DS    XL42                     UNUSED SPARE BYTES              11500000
UNLDDEVT DS    XL4                      FROM DEVICE TYPE                11520000
         SPACE 1                                                        11540000
         END   IEHMVESY                                                 11620000
./  ADD  SSI=73250230,NAME=IEHMVSSZ
 TITLE 'IEHMVSSZ-VOLUME OPERATIONS FOR IEHMOVE LOAD MODULE ESZ'         00020017
*TITLE -IEHMVSSZ                                                        00030017
*FUNCTION/OPERATION: TO HANDLE VOLUME OPERATIONS AND TO HANDLE ERROR  * 00040000
*RETURNS FROM CALLED ROUTINES.                                        * 00060000
*ENTRY POINTS: IEHMVESZ                                               * 00080000
*INPUT: MOVE/COPY COMMUNICATIONS TABLE                                * 00100000
*OUTPUT: NONE                                                         * 00120000
*EXTERNAL ROUTINES: IEHMVSSVA                                         * 00140000
*EXITS-NORMAL XCTL TO IEHMVESX                                        * 00160000
*ERRORS: NONE                                                         * 00180000
*TABLES/WORK AREAS: MOVE/COPY COMMUNICATIONS TABLE                    * 00200000
*ATTRIBUTES: REUSEABLE                                                * 00220000
*NOTES: PART OF LOAD MODULE IEHMVESZ                                  * 00240000
*                                                                       00260000
         TITLE 'SINGLE DATA SET CONTROL'                                00280000
*                                                                       00300000
*                                  LOAD MODULE  IEHMVL20                00320000
*                                               SINGLE DATE SET         00340000
*                                                                       00360000
*                                                                       00380000
IEHMVSSZ CSECT                                                          00400000
*A048300                                                       @ZA26443 00400199
*A026100,036440-036560                                         @ZA16493 00400200
*A34100-34120,40500,108100                                      YM05783 00400402
*C34400                                                         YM05783 00400802
*A19404-19435,19448-19514,20100-20180,21300-21340,57900         YL026VC 00401802
*A58420-58796,97300-97700,98700                                 YL026VC 00402202
*C12500,14400,98200,98800                                       YL026VC 00402602
*D100,12200-12400,12600-14200,27800-30800,58000-58400           YL026VC 00403002
*D77800-78000,97800-9800,098400-98600                           YL026VC 00403402
*C19431,20120-20140                                              Y02918 00403502
*A19432-19433                                                    Y02918 00403702
*A086820,086920                                                  YM5081 00403802
*C084920,086800-090320,095000,096100,100000-100700              YA01220 00405602
*A105050-105150                                                 YA01220 00407402
*D105800-106000,107400-107600                                   YA01220 00409202
*A014300                                                        YA01195 00411002
*A085700                                                         A48757 00412802
*C085800                                                         A48757 00414602
*A014400                                                         A43752 00416402
* 090000                                                         A24006 00418202
*1980 004200                                                       UL0H 00420017
*                                                                       00440000
*  017600-017800                                                 A17911 00450018
* 088400,089200,090400-091800,096200,096600-096800,097400-097600 S21042 00452021
* 100400,101400-101600,109200                                    S21042 00454021
*D019456-019458                                                @Z40CSJH 00456004
*A012100-012200,027800-027820,078100-078120                    @Z40CSJH 00458004
*A098820-098860                                                @Z40CSJH 00458404
*D034600                                                       @ZA06522 00458899
*                                                                       00460000
*              LOAD MODULE ENTRY POINT  IEHMVESZ               @ZA16493 00480099
IEHMVESZ SAVE (14,12),T,IEHMVSSZ-OZ26443                                00490099
         ENTRY IEHMVESZ                                                 00520000
*                                                                       00540000
    USING  IEHMVV,MCTABLE                                               00560000
*                                                                       00580000
*              REGISTERS                                                00600000
*                                                                       00620000
PASSA    EQU   0                                                        00640000
PASSB    EQU   1                                                        00660000
R2       EQU   2                                                        00680000
R3       EQU   3                                                        00700000
ACCE     EQU   4                                                        00720000
ACCO     EQU   5                                                        00740000
BASE     EQU   6                                                        00760000
R7       EQU   7                                                        00780000
R8       EQU   8                                                        00800000
R9       EQU   9                                                        00820000
R10      EQU   10                                                       00840000
R11      EQU   11                                                       00860000
MCTABLE  EQU   12                                                       00880000
SAVE     EQU   13                                                       00900000
RETURN   EQU   14                                                       00920000
LINK     EQU   15                                                       00940000
         BALR  BASE,0                                                   00960000
         USING *,BASE                                                   00980000
SINGLE   DS    0H                  LABEL CARD ONLY                      01000000
*                       FIRST TIME SWITCH QUESTIONS VOLUME MOUNTING     01020000
         TM    IEHMVV20+4,TEN      IS THIS VOLUME MOUNTED               01040000
         BZ    ABCB                          RE-ENTER                   01060000
         NI    IEHMVV20+4,OFF      YES,TURN FIRST TIME SWITCH OFF       01080000
         L     RETURN,RRR                                               01100000
         BR    RETURN                                                   01120000
ABCB     DS    0H                  LABEL CARD ONLY                      01140000
    IEHPRE  (14,1),TFC,                                                 01160000
         TM    IEHMVV20,VOLUME          VOLUME MOVE                     01180000
         BO    VOLUMEMV                 YES                             01200000
         TM    IEHMVV20,CATALOG         MOVE CATALOG FUNCTION  @Z40CSJH 01210004
         BO    SETCAT                   YES                    @Z40CSJH 01220004
SINGLEOK DS    0H                      LABEL CARD ONLY                  01250002
         XC    IEHMVV62(4),IEHMVV62    CLEAR PTR                YA01195 01430002
         XC   IEHMVV10-12(12),IEHMVV10-12     CLEAR SWITCH AREA         01440002
         XC    IEHMVV82+16(12),IEHMVV82+16                       A43752 01450021
         L     ACCE,IEHMVV10                                            01460000
         LA    ACCO,28(0,ACCE)                                          01480000
         ST    ACCE,IEHMVV30+4                                          01500000
         LA    ACCE,28(0,ACCO)                                          01520000
         ST    ACCO,IEHMVV31+4                                          01540000
         ST    ACCE,IEHMVV10                                            01560000
         TM    IEHMVV20+3,RENAME   TEST FOR RENAME INDICATION           01580000
         BO    NOCH                                                     01600000
         MVC   IEHMVV21+4(4),IEHMVV21  CHANGE'TO'DSNAME ADDRESS         01620000
NOCH     DS    0H                  LABEL CARD ONLY                      01640000
         XC    IEHMVV30(4),IEHMVV30    BLANK ADDRESS OF FROM DCB        01660000
*                                                                       01680000
*                                  PROCESS                              01700000
*                                       CALL COPY-UNLOAD-LOAD-ABORT     01720000
*                                                                       01740000
         TM    IEHMVV20,X'02'      IS THIS A VOLUME MOVE ?       A17911 01750018
         BO    COPYRTN             YES--DO NOT GO TO IEHCULAT.   A17911 01760018
         L     LINK,COPYTEST       GET ADDRESS OF IEHMVESV (EN-  A17911 01770018
*                                    TRY POINT OF CSECT IEHCULAT)A17911 01780018
         BALR  RETURN,LINK         BRANCH TO IEHCULAT.           A17911 01790018
         DROP  BASE                                                     01800000
COPYRTN  DS    0H                      LABEL CARD ONLY                  01820000
         BALR  LINK,0                                                   01840000
         USING *,LINK                                                   01860000
         L     BASE,ASIN                                                01880000
         DROP  LINK                                                     01900000
         USING SINGLE,BASE                                              01920000
*                                                                       01940000
**********************************************************************  01940402
*                                                                    *  01940802
* THIS SECTION TESTS FOR DATA SET ORGANIZATION.  IEHMOVE CANNOT      *  01941202
* PROCESS VSAM DATA SET/SPACES OR ISAM DATA SETS                     *  01941604
* ALTHOUGH FOR VOLUME OPERATIONS THE DATA SET ORGANIZATION COULD     *  01941702
* HAVE BEEN TESTED IN THE XRAYVTOC SECTION, ALL TESTING OF DATA      *  01941802
* SET ORGANIZATION IS DONE HERE.                                     *  01941902
* IF IEHMOVE CANNOT PROCESS THE DATA ORGANIZATION, MESSAGE IEH474I   *  01942102
* IS PRINTED.  FOR A SINGLE DATA SET OPERATION THE RETURN CODE IS 12 *  01942502
* AND ALL PROCESSING STOPS FOR THAT REQUEST.  IF IT IS A VOLUME      *  01942602
* REQUEST, THE RETURN CODE IS 4 AND IEHMOVE GETS THE NEXT ENTRY      *  01943002
* FROM THE VTOC TO BE MOVED/COPIED. IF IT IS A DSGROUP REQUEST,      *  01943102
* THE RETURN CODE IS 4 AND IEHMOVE GETS THE NEXT DATA SET OF         *  01943202
* THE GROUP.                                                         *  01943302
*                                                                    *  01943402
**********************************************************************  01943502
         L     ACCE,IEHMVV30+8     GET ADDR OF 'FROM' DSCB.      A17911 01944602
         TM    83(ACCE),VSAM           IS VSAM ORGANIZATION     YL026VC 01944802
         BO    ORGERR                  ERROR IF VSAM            YL026VC 01945002
         TM    82(ACCE),ISAM           IS ISAM ORGANIZATION     YL026VC 01945202
         BO    ORGERR                  ERROR IF ISAM            YL026VC 01945402
         TM    IEHMVV20,VOLORDSG       VOLUME OR DSGROUP        YL026VC 01946002
         BZ    TESTMOV                 IF NOT, DO NOT PRINT     YL026VC 01947102
         MVI   IEHMVV61,NAME           SET UP TO PRINT NAME     YL026VC 01949102
         BAL   RETURN,MSG              PRINT DSNAME             YL026VC 01951102
TESTMOV  EQU   *                       TEST FOR UNMOVEABLE DATA YL026VC 01951402
         TM    82(ACCE),X'01'      CHECK DSORG FIELD OF 'FROM'   A17911 01952002
*                                    DSCB FOR UNMOVABLE DATA.    A17911 01954402
         BZ    NOTUNMOV            NOT UNMOVABLE -- EXIT         A17911 01957602
         NI    82(ACCE),X'FE'      UNMOVABLE DATA--TURN OFF      A17911 01960802
         OI    IEHMVV10-4,X'08'      UNMOVABLE BIT IN DSCB AND   A17911 01964002
*                                    TURN ON UNMOVABLE BIT IN    A17911 01967202
*                                    IEHMOVE SWITCH AREA.        A17911 01970402
NOTUNMOV EQU   *                   LABEL CARD                    A17911 01973602
     IEHPOST  (14,1),TFC,                                               01976802
         L     RETURN,12(SAVE)                                          01980000
   XCTL   (2,12),EP=IEHMVESX                                            02000000
ORGERR   MVI   IEHMVV61,BADORG         INDICATOR FOR IEH474I    YL026VC 02010002
         TM    IEHMVV20,VOLORDSG       VOLUME OR DSGROUP         Y02918 02012002
         BM    PREABORT                RETURN CODE WILL BE 4     Y02918 02014002
         OI    IEHMVV41+13,X'10'       SET RETURN CODE TO 12    YL026VC 02016002
         B     PREABORT                PRINT MESSAGE            YL026VC 02018002
***** CONSTANTS *****                                                   02020000
COPYTEST DC    A(IEHMVESV)                                              02040000
         EXTRN IEHMVESV                                                 02060000
         ENTRY COPYRTN                                                  02080000
RRR      DC    A(RTNVM)                                                 02100000
         EXTRN RTNVM                                                    02120000
VSAM     EQU   X'08'                  VSAM INDICATOR            YL026VC 02130002
ISAM     EQU   X'80'                  ISAM INDICATOR            YL026VC 02132002
BADORG   EQU   27                     INDICATOR FOR IEH474I     YL026VC 02134002
NINETY   EQU X'90'                                                      02140000
TEN      EQU   X'10'                                                    02160000
OFF      EQU   X'EF'                                                    02180000
CATALOG  EQU   X'04'                                                    02200000
VOLORDSG EQU   X'12'                                                    02220000
NAME     EQU   X'8B'                                                    02240000
RENAME   EQU   X'04'                                                    02260000
F1       EQU   X'F1'                                                    02280000
DEACTIVE EQU   X'00'                                               UL0H 02290017
ZERO     EQU   X'00'                                                    02300000
LIST     EQU   X'87'                                                    02320000
DASDY    EQU   X'20'                                                    02340000
BO       EQU   X'B0'                                                    02360000
FOURTEEN EQU   X'14'                                                    02380000
EDRETURN EQU   140                                                      02400000
FC       EQU   X'FC'                                                    02420000
F2       EQU   X'2F'                                                    02440000
ONE      EQU   X'01'                                                    02460000
EIGHT    EQU   X'08'                                                    02480000
IA       EQU   X'1A'                                                    02500000
OE       EQU   X'0E'                                                    02520000
BLANK    EQU   C' '                                                     02540000
FOUR     EQU   X'04'                                                    02560000
S        EQU   X'E2'                                                    02580000
T        EQU   X'E3'                                                    02600000
Y        EQU   X'E8'                                           @ZA16493 02610099
K        EQU   X'D2'                                                    02620000
H        EQU   X'C8'                                                    02640000
FF       EQU   X'FF'                                                    02660000
I        EQU   X'C9'                                                    02680000
F7       EQU   X'7F'                                                    02700000
EOF      EQU   X'20'                                                    02720000
VOLUME   EQU   X'02'                                                    02740000
FVOLUME  EQU   X'80'                                                    02760000
**********************************************************************  02770004
* LINES 028100-030996 WERE REACTIVATED IN SUPPORT              @Z40CSJH 02780004
* OF THE EXTENDED MVS CVOL FUNCTION                            @Z40CSJH 02790004
**********************************************************************  02800004
ANDBITS  DC    X'C088207180'                                            02810004
ORBITS   DC    X'0440000000'                                            02860004
CAT4VOL  NC    IEHMVV20(5),ANDBITS      RESET VARIOUS VOLUME OPERATIONS 02910004
         OC    IEHMVV20(5),ORBITS       TURN ON SWITCHES FOR CATALOG    02960004
         MVC   IEHMVV24(4),IEHMVV22     FROM VOL BECOMES A CVOL         03010004
         MVC   IEHMVV10(4),IEHMVV30+8   RESET PERMANENT WORK AREA       03060004
SETCAT   MVC   IEHMVV61(8),IEHMVV21     SET UP CAT INCLUDE AND EXCLUDE  03070004
         MVC   IEHMVV86(4),IEHMVV62    SAVE EXC ADR FOR ESC    @XA02965 03080004
         L     ACCE,IEHMVV10                                            03090004
         LA    ACCO,44(ACCE)            UP WORK AREA POINTER            03092004
         ST    ACCO,IEHMVV10                                            03094004
         MVI   0(ACCE),BLANK           BLANK OUT WORKAREA DSNAME FIELD  03096004
         MVC   1(43,ACCE),0(ACCE)                                       03098004
         MVC   0(7,ACCE),SYSCTLG        SET UP SYSCTLG DSNAME           03098404
         ST    ACCE,IEHMVV21            PLACE ADDRESS IN WORK AREA      03098804
         B     SINGLEOK                                                 03099204
SYSCTLG  DC    CL7'SYSCTLG'                                             03099604
      DS     0H                                                         03100000
         TITLE 'PRE ABORT ROUTINE'                                      03120000
PREABORT DS    0H                      LABEL CARD ONLY                  03140000
         ENTRY PREABORT                                                 03160000
         BALR  LINK,0                                                   03180000
         USING *,LINK                                                   03200000
    L   BASE,ASIN                                                       03220000
         DROP  LINK                                                     03240000
    USING   SINGLE,BASE                                                 03260000
         TM    IEHMVV10-4,FVOLUME      FROM VOLUME TO BE CLOSED         03280000
         BO    CLOSEF                  YES.GO TO CLOSE FROM VOLUME      03300000
FCLOSE   TM    IEHMVV10-4,BLANK        TO VOLUME TO BE CLOSED           03320000
         BO    CLOSET                  YES.GO TO CLOSE TO VOLUME        03340000
TCLOSE   DS    0H                      LABEL CARD ONLY                  03360000
         BAL   RETURN,MSG               GO TO MESSAGE WRITER            03380000
         IEHPOST (14,1),TFC,                                            03400000
         CLI   MV61SV,BADORG           IEH474I ISSUED           YM05783 03410002
         BE    NOPOST                  NO                       YM05783 03412002
   IEHPOST  (14,1),TFC,                                                 03420000
NOPOST   OI    IEHMVV41+13,X'01'   RET CODE = 4                 VS05783 03440002
         TM    IEHMVV20,VOLUME         TEST FOR VOLUME OPERATION        03480000
   BO  SINGLE                                                           03500000
         MVC   IEHMVV00(6),MODNAME                                      03520000
         MVI   IEHMVV00+6,S            ADD LETTER'S' TO MODULE NAME     03540000
         TM    IEHMVV20,TEN            DSGROUP OPERATION                03560000
         BO    GODSG                                                    03580000
         TM    IEHMVV20+2,EOF                                           03600000
         BO    GOHOME                                                   03620000
         MVI   IEHMVV00+7,T            ADD LETTER'T' TO MODULE NAME     03640000
         TM    IEHMVV20+5,X'08'        SHOULD A DUMMY FILE     @ZA16493 03644099
*                                      BE WRITTEN              @ZA16493 03648099
         BNO   ALLDONE                                         @ZA16493 03652099
         MVI   IEHMVV00+7,Y            YES GO TO IEHMVESY      @ZA16493 03656099
ALLDONE  DS    0H                      LABEL CARD ONLY                  03660000
         XCTL  (2,12),EPLOC=(12)                                        03680000
GOHOME   MVI   IEHMVV00+7,K            ADD LETTER 'K' TO MODULE NAME    03700000
         B     ALLDONE                                                  03720000
GODSG    DS    0H                      LABEL CARD ONLY                  03740000
         MVI   IEHMVV00+7,H            ADD LETTER'H' TO MODULE NAME     03760000
         B     ALLDONE                                                  03780000
CLOSEF   DS    0H                      LABEL CARD ONLY                  03800000
         MVI   IEHMVV70+8,DEACTIVE                                 UL0H 03810017
         L     ACCE,IEHMVV30           LOAD ADDRESS OF FROM DCB         03820000
         CLOSE ((ACCE))                CLOSE FROM DATA SET              03840000
         B     FCLOSE                                                   03860000
CLOSET   DS    0H                      LABEL CARD ONLY                  03880000
         MVI   IEHMVV70+12,DEACTIVE    DEACTIVATE O'PUT TRLR EXIT  UL0H 03890017
         L     ACCE,IEHMVV31           LOAD ADDRESS OF TO DCB           03900000
         CLOSE ((ACCE))                CLOSE TO DATA SET                03920000
         B     TCLOSE                                                   03940000
MODNAME  DC    CL6'IEHMVE'                                              03960000
         TITLE 'MESSAGE HANDLER'                                        03980000
         DROP  BASE                                                     04000000
MSG      DS    0H                      LABEL CARD ONLY                  04020000
         STM   PASSA,LINK,200(MCTABLE) STORING REGISTERS                04040000
         MVC   MV61SV,IEHMVV61         SAVE MSG CODE            YM05783 04050002
         BALR  LINK,0                  SET UP ADDRESSABILITY            04060000
         USING *,LINK                                                   04080000
    L     BASE,ASIN                                                     04100000
         DROP  LINK                    DROP BASE REGISTERS              04120000
      USING    SINGLE,BASE                                              04140000
         LR    R7,RETURN                                                04160000
         MVI   IEHMVV00,FF             SET UP MESSAGE AREA              04180000
         MVI   IEHMVV00+1,BLANK        BLANK OUT PRINT LINE             04200000
         MVC   IEHMVV00+2(120),IEHMVV00+1                               04220000
         TM    IEHMVV61,ONE       DATA SET MESSAGE OR NORMAL MESSAGE    04240000
         BO    NORMMES            ODD NUMBER IN VV61 IS NORMAL MESSAGE  04260000
*                        PROCESS DATA SET MESSAGES                    * 04280000
*                                  HERE                               * 04300000
*                         EVEN NUMBER IN VV61                         * 04320000
         MVC   IEHMVV00+1(4),IEH4       SET UP MSG NUMBER               04340000
         LA    ACCE,127                 GET IEH4                        04360000
         SR    ACCO,ACCO                                                04380000
         IC    ACCO,IEHMVV61                                            04400000
         NR    ACCO,ACCE                                                04420000
         L     R3,ADIEH4DD             SET UP MESSAGE DIAGNOSTIC CODE   04440000
         LA    ACCO,0(R3,ACCO)                                          04460000
    MVC   IEHMVV00+5(2),0(ACCO)                                         04480000
         MVI   IEHMVV00+7,I            END CODE WITH LETTER 'I'         04500000
         L     ACCE,MSGH                SET UP MSG HEADER               04520000
         LA    ACCO,7                                                   04540000
         BAL   R8,MSGMOVE                                               04560000
         TM     IEHMVV20,X'02'         IS THIS A VOL REQUEST            04580000
         BZ     CONT                   NO  BRANCH                       04600000
         TM     IEHMVV20+3,FVOLUME     YES  IS THIS THE FIRST DATA SET  04620000
         BO     CONT                   NO   BRANCH                      04640000
         LA     ACCE,TEMPNAME          YES   SET UP DSNAME OF VOL       04660000
         LA     ACCO,5                 NAME LENGTH                      04680000
         B      VOLNAME                                                 04700000
CONT     L      ACCE,IEHMVV21          SET UP DSNAME                    04720000
         LA    ACCO,43                                                  04740000
VOLNAME  BAL    R8,MSGMOVE                                              04760000
         TM    IEHMVV61,FVOLUME        UNLOAD MESSAGE OR NOT MOVED      04780000
         BO    MSGUNLD                       UNLOAD MSG                 04800000
         LA    ACCE,2                        NOT MOVED                  04820000
         OI    IEHMVV20+2,X'40'        SET MIDABORT            @ZA26443 04830099
MSGAA    DS    0H                      LABEL CARD ONLY                  04840000
         BAL   R8,MSGDMOVE              SET UP FINAL PART               04860000
         SR    ACCE,ACCE                                                04880000
         IC    ACCE,IEHMVV61                 OF MSG                     04900000
         BAL   R8,MSGDMOVE                                              04920000
PRINTMES  SR   0,0                      TO PRINT A NORMAL MESSAGE       04940000
         LA    3,IEHMVV00                                               04960000
         LINK  EP=IEHMVESU        GO TO PRINT ROUTINE WITH (3) AS PARAM 04980000
         B     MSGCHECK(LINK)           CHECK RETURNS                   05000000
MSGCHECK B     GOODMSG                  GOOR WRITE                      05020000
         XCTL  EP=IEHMVESK              I/O ERROR                       05040000
GOODMSG  LR    RETURN,R7                                                05060000
         MVI   IEHMVV61,ZERO           MOVE ZERO INTO MESSAGE INDICATOR 05080000
         LM    PASSA,LINK,200(MCTABLE) RESTORE REGISTERS                05100000
         BR    RETURN                  BRANCH BACK TO CALLING ROUTINE   05120000
MSGUNLD  DS    0H                      LABEL CARD ONLY                  05140000
         NI    IEHMVV61,F7             TURN OFF UNLOAD MESSAGE BIT      05160000
         LA    ACCE,0                                                   05180000
         B     MSGAA                                                    05200000
MSGDMOVE DS    0H                      LABEL CARD ONLY                  05220000
    SLL   ACCE,1                                                        05240000
         L     R3,ADMSGST              LOAD ADDRESS OF MSGSTART         05260000
         LH    ACCO,2(R3,ACCE)         ACCESSING PROPER MESSAGE         05280000
         LH    ACCE,0(R3,ACCE)                                          05300000
         A     ACCE,MSGH                                                05320000
MSGMOVE  DS    0H                      LABEL CARD ONLY                  05340000
         LA    R9,IEHMVV00+121                                          05360000
MSGLOOP  CLI   0(R9),BLANK             THIS LOOP WILL FIND FIRST BLANK  05380000
         BNE   MSGPL                         CHARACTER IN               05400000
         BCT   R9,MSGLOOP                    MSG AREA                   05420000
MSGPL    DS    0H                      LABEL CARD ONLY                  05440000
         EX    ACCO,MSMOVE             MOVE MESSAGE IN PRINTOUT AREA    05460000
         BR    R8                      BRANCH BACK TO FINISH MESSAGE    05480000
NORMMES  DS    0H                      LABEL CARD ONLY                  05500000
         SR    ACCE,ACCE                                                05520000
         IC    ACCE,IEHMVV61            GET MESSAGE NUMBER              05540000
     LA   ACCO,127                                                      05560000
    NR   ACCE,ACCO                                                      05580000
         LA    ACCE,1(0,ACCE)                                           05600000
         SLL   ACCE,1                                                   05620000
         L     R3,ADNORMAL             LOAD ADDRESS OF NORMAL MESSAGE   05640000
         L     ACCE,0(R3,ACCE)         GET MESSAGE POINTER              05660000
         SR    ACCO,ACCO                                                05680000
         IC    ACCO,0(ACCE,0)           GET MESSAGE LENGTH              05700000
         LA    ACCE,1(0,ACCE)                                           05720000
         EX    ACCO,NORMM               MOVE MESSAGE TO PRINT AREA      05740000
         TM    IEHMVV61,FVOLUME        IS VOLUME OPERATION      YL026VC 05790002
         BO    ADDNAME                 PUT NAME AT END          YL026VC 05842002
**********************************************************************  05844002
*                                                                    *  05846002
* FOR MESSAGE IEH474I, BAD ORGANIZATION, THE DATA SET/SPACE NAME     *  05848002
* IS PUT AT THE BEGINNING OF THE MESSAGE.                            *  05848402
*                                                                    *  05848502
**********************************************************************  05848802
         CLI   IEHMVV61,BADORG         BAD ORGANIZATION MSG.    YL026VC 05850002
         BNE   PRINTMES                PRINT MESSAGE            YL026VC 05860002
         LA    R9,IEHMVV00+7           START OF DSNAME MINUS 2  YL026VC 05870002
         LA    ACCO,43                 LENGTH OF DSNAME MINUS 1 YL026VC 05872002
         L     ACCE,IEHMVV21           ADDRESS OF DSNAME        YL026VC 05874002
         EX    ACCO,MSMOVE             MOVE DSNAME INTO MESSAGE YL026VC 05876002
         B     PRINTMES                PRINT MESSAGE            YL026VC 05878002
ADDNAME  LA    ACCO,43                 LENGTH OF DSNAME MINUS 1 YL026VC 05878402
         L     ACCE,IEHMVV21           ADDRESS OF DSNAME        YL026VC 05878802
         BAL   R8,MSGMOVE              MOVE NAME TO START OF MSG.Y02063 05879202
         B     PRINTMES                PRINT MESSAGE            YL026VC 05879602
NORMM    MVC   IEHMVV00+1(1),0(ACCE)                                    05880000
IEH4     DC    CL4'IEH4'                                                05900000
MSMOVE   MVC   2(1,R9),0(ACCE)                                          05920000
MSGH     DC    A(MSGHEAD)               POINTER TO MESSAGES             05940000
         ENTRY MSG                                                      05960000
         EXTRN IEH4DD                                                   05980000
         EXTRN MSGSTART                                                 06000000
         EXTRN NORMALM                                                  06020000
         EXTRN MSGHEAD                                                  06040000
ADMSGST  DC    A(MSGSTART)                                              06060000
ADNORMAL DC    A(NORMALM)                                               06080000
ADIEH4DD DC    A(IEH4DD)                                                06100000
         EJECT                                                          06120000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 06140000
*                                                                     * 06160000
*   THIS ROUTINE HANDLES THE OPENING OF THE VTOC TO MOVE ONE DATASET  * 06180000
*   OF A VOLUME MOVE OPERATION AND MOUNTING OF THE TO AND FROM VOLUMES* 06200000
*                                                                     * 06220000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 06240000
IEHMVSSZ CSECT                                                          06260000
VOLUMEMV DS    0H                                                       06280000
         BALR  LINK,0                                                   06300000
         USING *,LINK                                                   06320000
    L   BASE,ASIN                                                       06340000
         DROP  LINK                                                     06360000
    USING  SINGLE,BASE                                                  06380000
         TM    IEHMVV20+3,FVOLUME       FIRST DS OF VOLUME MOVE         06400000
        BO    NOT1                     NO                               06420000
         L     PASSB,IEHMVV22          YES                              06440000
         CLI   2(PASSB),DASDY          IS FROM VOLUME DIRECT ACCESS     06460000
         BNE   NOMOVEVO                 NO                              06480000
*                                       YES                             06500000
*                                                                       06520000
*                                       CALL VOL MOUNT FOR VOLUME       06540000
*                                                                       06560000
         XC    IEHMVV00(12),IEHMVV00                                    06580000
         MVI   IEHMVV00+4,NINETY       SET INDICATOR FOR VOLUME MOUNT   06600000
         L     LINK,CALMT                                               06620000
         MVI   IEHMVV00+400,TEN        SET UP VOLUME MOUNT RETURN CODE  06640000
         BALR  RETURN,LINK              GO TO CALL VOL MOUNT            06660000
KK1      DS    0H                      LABEL CARD ONLY                  06680000
         ENTRY KK1                                                      06700000
         DROP  BASE                                                     06720000
         USING KK1,RETURN                                               06740000
         L     BASE,ASIN                                                06760000
         DROP  RETURN                                                   06780000
         USING SINGLE,BASE                                              06800000
         B     VOLOKMT(LINK)            CHECK VOLUME MOUNTING           06820000
VOLOKMT  B     NOVOLMT                  NOT MOUNTED                     06840000
         ST    PASSB,IEHMVV30+12   MOUNTED (STORE ADDR OF FROM DDNAME)  06860000
        MVC   IEHMVV22+4(4),IEHMVV22   ACTIVE FROM                      06880000
*                                       CALL VOL MOUNT FOR TO VOLUME    06900000
         XC    IEHMVV00(12),IEHMVV00                                    06920000
         MVI   IEHMVV00+4,BO           SET INDICATOR FOR VOLUME MOUNT   06940000
         L     PASSB,IEHMVV23+4        PASS TO VOLUME LIST ENTRY POINT  06960000
         L     LINK,CALMT                                               06980000
         MVI   IEHMVV00+400,FOURTEEN   SET UP VOLUME MOUNT RETURN CODE  07000000
         BALR  RETURN,LINK              GO TO CALL VOL MOUNT            07020000
KK2      DS    0H                      LABEL CARD ONLY                  07040000
         ENTRY KK2                                                      07060000
         DROP  BASE                                                     07080000
         USING KK2,RETURN                                               07100000
         L     BASE,ASIN                                                07120000
         DROP  RETURN                                                   07140000
         USING SINGLE,BASE                                              07160000
         B     VOLTOA(LINK)             VOLUME MOUNTED                  07180000
VOLTOA   B     NOTOMT                   NO                              07200000
         ST    PASSB,IEHMVV31+8      YES (STORE ADDR OF TO DDNAME)      07220000
GOTOED   DS    0H                      LABEL CARD ONLY                  07240000
         L     LINK,ED                                                  07260000
         BALR  RETURN,LINK                                              07280000
         L     ACCE,IEHMVV30+8      'FROM'DSCB POINTER FROM XRAYVTOC    07300000
         SR    LINK,LINK                                                07320000
         IC    LINK,EDRETURN(ACCE)      CHECK RETURNS                   07340000
         B     CKED(LINK)                                               07360000
CKED     B     VOLIOERR                 IO ERROR ON FROM VOLUME         07380000
         B     AEOF                     EOF ON VTOC                     07400000
*                                       RETURNED A DSCB                 07420000
         ST    ACCE,IEHMVV21            SET UP FROM DS NAME             07440000
         B     SINGLEOK                 RETURN TO NORMAL PROCESSING     07460000
NOT1     MVC   IEHMVV10(4),IEHMVV30+8                                   07480000
         NI    IEHMVV20+1,FC           RESET COMMUNICATIONS AREA        07500000
         NI    IEHMVV20+2,F2                  INDICATORS AND            07520000
         XC    IEHMVV21(8),IEHMVV21                                     07540000
         XC    IEHMVV30(12),IEHMVV30                                    07560000
         XC    IEHMVV31(8),IEHMVV31     CLEAR SOME AREAS OF             07580000
    XC   IEHMVV43(8),IEHMVV43                                           07600000
         XC    IEHMVV60(16),IEHMVV60                                    07620000
         B     GOTOED                   GO TO GET ANOTHER DSCB          07640000
NOMOVEVO DS 0H                                                          07660000
         MVI   IEHMVV61,ONE            INDICATE MESSAGE TYPE FOR WRITER 07680000
    B    PRESTOP                                                        07700000
PRESTOP  BAL   RETURN,MSG               GO TO MESSAGE WRITER            07720000
         OI    IEHMVV41+13,X'01'   RET CODE = 4                         07740000
AEOF     DS    0H                      LABEL CARD ONLY                  07760000
         TM    IEHMVV20+4,ONE          CATLG TO BE MOVED       @Z40CSJH 07810004
         BO    CAT4VOL                  YES ..... BRANCH       @Z40CSJH 07812004
         MVC   IEHMVV00(6),MODNAME                                      07820000
         MVI   IEHMVV00+6,S            ADD LETTER 'S' TO MODULE NAME    07840000
         TM    IEHMVV20+2,EOF                                           07860000
         BO    VEOF                                                     07880000
         MVI   IEHMVV00+7,T            ADD LETTER 'T' TO MODULE NAME    07900000
LEAVEVOL DS    0H                      LABEL CARD ONLY                  07920000
    IEHPOST  (14,1),TFC,                                                07940000
*                                                                       07960000
         XCTL  (2,12),EPLOC=(12)                                        07980000
VEOF     MVI   IEHMVV00+7,K            ADD LETTER 'K' TO MODULE NAME    08000000
         B     LEAVEVOL                                                 08020000
CALMT    DC    A(CALLMT)                                                08040000
         EXTRN CALLMT                                                   08060000
NOVOLMT  MVI   IEHMVV61,EIGHT          SET INDICATOR FOR MESSAGE WRITER 08080000
         B     PRESTOP                                                  08100000
NOTOMT   MVI   IEHMVV61,IA             SET INDICATOR FOR MESSAGE WRITER 08120000
         B     PRESTOP                                                  08140000
VOLIOERR MVI   IEHMVV61,OE             SET &ND&CATO- FO- MESSAGE W-ITER 08160000
         B     PRESTOP                                                  08180000
ED       DC    A(XRAYVTOC)                                              08200000
ASIN     DC    A(SINGLE)                                                08220000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08240000
*                                                                     * 08260000
*                               XRAYVTOC                              * 08280000
*     THIS ROUTINE OBTAINS ONE FORMAT ONE DSCB FROM THE VTOC FOR A    * 08300000
*     VOLUME MOVE OPERATION. FOR EACH DSCB ONE DATASET WILL BE MOVED  * 08320000
*                                                                     * 08340000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08360000
XRAYVTOC SAVE  (14,12)             SAVE REGISTERS                       08380000
         ST    SAVE,XXREG13            SAVE POINTER TO SAVE AREA        08400000
         LA    SAVE,XXSAVE             SET UP SAVE AREA FOR CALLED RTN  08420000
         L     R11,IEHMVV10            ADDRESS OF PERMANENT WORK AREA   08440000
         USING XXDSCB,R11                                               08460000
         USING XRAYVTOC,LINK                                            08480000
         TM    IEHMVV20+3,FVOLUME     IS THIS FIRST VOLUME ENTRY S21042 08490021
         BO    XXEODAD                                          YA01220 08492002
         MVI   XXJFCB,FOUR             PLACE THE NAME OF THE            08500000
         MVC   XXJFCB+1(43),XXJFCB      VTOC INTO THE JFCB AND          08520000
         MVI   XXMEMBER,BLANK          STORE BLANKS INTO THE            08540000
         MVC   XXMEMBER+1(7),XXMEMBER   MEMBER NAME FIELD.              08560000
         MVI   XX00,X'08'              DON'T WRITE BACK THE JFCB A48757 08570022
         XC    XX00+1(139),XX00+1                                A48757 08580022
         MVI   XXVOLID-1,ONE                                            08600000
         L     R3,IEHMVV22+4           POINT AT ACTIVE FROM VOLUME      08620000
         MVC   XXVOLID(6),4(R3)        PUT VOLUME SERIAL NO. INTO JFCB  08640000
         MVI   XXVOLID+6,BLANK         BLANK OUT NEXT BYTE              08660000
         LA    PASSA,XXDCBL            LENGTH OF DCB            YA01220 08680002
         LR    R7,LINK                 SAVE REGISTER 15          YM5081 08682002
         GETMAIN R,LV=(0)              GET AREA FOR DCB         YA01220 08690002
         LR    LINK,R7                 RESTORE REGISTER 15       YM5081 08692002
         LA    R3,0(PASSB)             CLEAR HIGH ORDER BYTE    YA01220 08700002
         ST    R3,IEHMVV82+8           SAVE DCB ADDRESS         YA01220 08710002
         USING IHADCB,R3                                                08720002
         MVC   IHADCB(XXDCBL),XXDCBSTT SAVE DCB                 YA01220 08730002
         LA    PASSB,XXFULL            EXIT LIST ADDRES         YA01220 08740002
         O     PASSB,DCBEXLST          SAVE FIRST BYTE OF EXLST YA01220 08750002
         ST    PASSB,DCBEXLST          STORE EXLST ADDR IN DCB  YA01220 08760002
         ST    MCTABLE,XXFULL          PUT JFCB ADDRESS IN EXLSTYA01220 08770002
         MVI   XXFULL,LIST             INDICATE JFCB EXIT ONLY  YA01220 08780002
         L     PASSB,IEHMVV30+12       ADDRESS OF DDNAME        YA01220 08790002
         MVC   DCBDDNAM,0(PASSB)       PUT DDNAMEIN DCB         YA01220 08800002
         LR    R7,LINK                 SAVE REGISTER 15         YA01220 08810002
         OPEN  ((R3),INPUT),TYPE=J     OPEN THE VTOC            YA01220 08820002
         LR    LINK,R7                 RESTORE REGISTER 15      YA01220 08830002
         B     XXREAD                  GO TO READ THE VTOC      YA01220 08840002
         SPACE 1                                                YA01220 08850002
XXEODAD  EQU   *                       ROUTINE TO RESET EODAD   YA01220*08860002
                                       AND SYNAD ADDRESSES IN   YA01220*08870002
                                       DCB WHEN REENTRING MODULEYA01220 08880002
         SPACE 1                                                YA01220 08890002
         L     R3,IEHMVV82+8           LOAD DCB ADDRESS         YA01220 08900002
         LA    PASSB,XXEND             ADDRESS OF EODAD ROUTINE YA01220 08910002
         IC    PASSA,DCBEODAD          SAVE FIRST BYTE(DCBBFTEK)YA01220 08920002
         ST    PASSB,DCBEODAD          STORE EODAD ADDR IN DCB  YA01220 08930002
         STC   PASSA,DCBEODAD          RESET FIRST BYTE         YA01220 08940002
         LA    PASSB,XXERR             ADDRESS OF SYNAD ROUTINE YA01220 08950002
         IC    PASSA,DCBSYNAD          SAVE FIRST BYTE (DCBIOBL)YA01220 08960002
         ST    PASSB,DCBSYNAD          STORE SYNAD ADDR IN DCB  YA01220 08970002
         STC   PASSA,DCBSYNAD          RESET FIRST BYTE         YA01220 08980002
         DROP  R3                                               YA01220 08990002
         SPACE 1                                                YA01220 09000002
XXREAD   READ  XXDECB,SF,(R3),(R11),'S',MF=E  READ A DSCB       YA01220 09010002
         CHECK XXDECB                                                   09200000
         USING *,RETURN                                                 09220000
         L     LINK,XXBASEAD           RESET BASE REGISTER              09240000
         DROP  RETURN                                                   09260000
         TM    IEHMVV20+3,FVOLUME      IS THIS THE FIRST VOLUME ENTRY   09280000
         BO    XXLOOK41            NO ..... BRANCH                      09300018
         CLC   XXDSCB(44),XXJFCB       SEARCH FOR BEGINNING OF VTOC     09320018
         BNE   XXREAD                                                   09340018
         CLI   XXFORMAT,ZERO           IS THIS A FORMAT ZERO DSCB       09360018
         BNE   XXSETSW             NO ..... BRANCH                      09380018
         AR    PASSB,BASE              UP THE TTR 1 FOR COMPATIBILITY   09400018
         SRL   PASSB,8                 TTRZ BECOMES ZTTR                09420018
         ST    PASSB,XXCODE            SAVE TTR                         09440018
         MVI   XXJFCB,FOUR                                              09460018
         MVC   XXJFCB+1(43),XXJFCB     44 BYTES OF HEX '04' TO SEARCH   09480018
         B     XXREAD                  GO TO READ NEXT DSCB     YA01220 09500002
XXSETSW  OI    IEHMVV20+3,FVOLUME      SET FIRST ENTRY SWITCH TO 1=OFF  09520018
         B     XXREAD                                                   09540018
XXLOOK41 CLI   XXFORMAT,F1             IS THIS A FORMAT 1 DSCB          09560018
         BNE   XXREAD              NO ..... BRANCH                      09600000
         NOTE  (R3)                    GET TTR OF THIS DSCB     YA01220 09610002
         USING *,RETURN                                                 09640000
         ST    PASSB,IEHMVV82          SAVE TTR FOR CAT. LATER ONS21042 09650021
         L     LINK,XXBASEAD           RESET ADDRESSABILITY             09700000
         DROP  RETURN                                                   09720000
**********************************************************************  09730002
*                                                                    *  09740002
* IF THERE ARE IEHMVOVE UTILITY DATA SETS ON THE VOLUME, THEY ARE    *  09750002
* ARE NOT INCLUDED IN THE VOLUME MOVE/COPY.  UTILITY DATA SETS ARE   *  09760002
* SYSUT1, SYSUT2, AND SYSUT3.  IEHMOVE TRIES TO MAKE THE UTILITY DATA*  09762002
* SET DISTINCTIVE BY STARTING THE DATA SET NAME WITH '**'.  NOW THE  *  09764002
* USER CAN NAME VSAM DATA SET/SPACES STARTING WITH '**' SO FIRST A   *  09766002
* TEST MUST BE MADE FOR VSAM THEN A TEST FOR UTILITY DATA SETS.      *  09768002
* VSAM DATA SETS/SPACES WILL BE CAUGHT AS AN ERROR IN ANOTHER SECTION*  09768402
* OF IEHMVSSZ IN ORDER TO CENTRALIZE ERROR CHECKING.                 *  09768802
*                                                                    *  09769202
**********************************************************************  09769602
         TM    XXDSCB+83,VSAM          IS VSAM ORGANIZATION     YL026VC 09770002
         BO    XXNORM                  ERROR NOTICED LATER      YL026VC 09820002
         CLC   XXDSCB(2),XXASTER       IEHMOVE UTILITY DATA SET?YL026VC 09870002
         BE    XXREAD                  IGNORE UTILITY DATA SETS YL026VC 09880002
**********************************************************************  09882004
*                                                                       09882404
* LINES 098900-098960 WERE REACTIVATED IN SUPPORT              @Z40CSJH 09884004
* OF THE EXTENDED MVS CVOL FUNCTION                            @Z40CSJH 09886004
*                                                                       09886404
**********************************************************************  09888004
         CLC   XXDSCB(8),XXSYSCAT       IS THIS A SYSCTLG DATA SET      09890004
         BNE   XXNORM                                                   09892004
         OI    IEHMVV20+4,ONE          TURN ON SYSCATLG BIT             09894004
         B     XXREAD                   GO GET ANOTHER DSCB             09896004
XXNORM   MVI   XXCODE,EIGHT            POST NORMAL RETURN CODE          09900000
XXCLOSE  ST    R11,IEHMVV30+8          POST ADDRESS OF FROM DSCB        09920000
         LA    R11,148(R11)            INCREMENT PERMANENT WORK ADDRESS 09940000
         ST    R11,IEHMVV10            STORE IT                         09960000
         TM    IEHMVV20+3,FVOLUME  IS THIS FIRST VOLUME ENTRY    S21042 09970021
         BO    OVERCLOS      NO......BRANCH                      S21042 09972021
         OI    IEHMVV20+3,FVOLUME SET FIRST VOL ENTRY TO 1 (=OFF)S21042 09974021
         CLOSE ((R3))                  CLOSE VTOC                       09980000
         LA    PASSA,XXDCBL            LENGTH OF DCB            YA01220 10000002
         LR    PASSB,R3                ADDRESS OF DCB           YA01220 10020002
         FREEMAIN R,LV=(0),A=(1)       FREE DCB AREA            YA01220 10040002
OVERCLOS DS    0H     LABEL CARD ONLY                            S21042 10072021
         L     SAVE,XXREG13            ACCESS SAVE AREA                 10080000
         RETURN (14,12)            RETURN                               10100000
XXEND    MVI   XXCODE,FOUR             POST END OF FILE                 10120000
          BALR RETURN,0                                          S21042 10130021
         USING *,RETURN                                          S21042 10132021
         L     LINK,XXBASEAD            RESET ADDRESSABILITY     S21042 10134021
         DROP  RETURN                                            S21042 10136021
         TM    IEHMVV20+4,X'01'        SYSCATLG BIT ON?          S21042 10138021
         BZ    *+10                     NO, SKIP                 S21042 10138421
         XC    IEHMVV82(3),IEHMVV82 CLEAR TTR FIELD WHEN M/C CAT S21042 10138821
         B     OVERERR                                           S21042 10139221
XXERR    MVI   XXCODE,ZERO             POST  I/O ERROR                  10180000
         BALR  RETURN,0                                                 10200000
         USING *,RETURN                                                 10220000
         L     LINK,XXBASEAD           RESET ADDRESSABILITY             10240000
         DROP  RETURN                                                   10260000
OVERERR  NI    IEHMVV20+3,X'7F' SET FIRST VOLUME ENTRY TO 0 (=ON)S21042 10270021
         B     XXCLOSE                                                  10280000
XXASTER  DC    C'**'                    TO IDENTIFY WORK FILES          10300000
XXSYSCAT DC    CL8'SYSCTLG '            TO IDENTIFY THE CATALOG         10320000
TEMPNAME DC    C'VOLUME'                                                10340000
XXDCBSTT DS    0F                  LABEL THE START OF THE DCB           10360000
XXLEN1   DS    0H                      LABEL CARD ONLY                  10380000
         DCB   DSORG=PS,MACRF=(RP),RECFM=U,                            .10400000
               KEYLEN=44,BLKSIZE=96,                                   .10420000
               EODAD=XXEND,SYNAD=XXERR                                  10440000
XXLEN2   DS    0H                      LABEL CARD ONLY                  10460000
XXDCBL   EQU   XXLEN2-XXLEN1       LENGTH -1 OF THE DCB                 10480000
XXBASEAD DC    A(XRAYVTOC)                                              10500000
         SPACE 3                                                YA01220 10505002
         DCBD  DSORG=PS,DEVD=DA        MAP OF DCB               YA01220 10510002
         SPACE 3                                                YA01220 10515002
         IEHMVV                                                         10520000
         ORG   IEHMVV00                                                 10540000
XXJFCB   DS    25D            USED FOR BUILDING A JFCB                  10560000
         DS    F              NOT USED                                  10620000
XXREG13  DS    F                                                        10640000
XXSAVE   DS    20F            REGISTER SAVE AREA FOR READ               10660000
XXMEMBER EQU   XXJFCB+44      8 BYTE MEMBER NAME  -WILL BE BLANKS-      10680000
XX00     EQU   XXMEMBER+8     SPACE 139 BYTES = 0, 1 BYTE = 1           10700000
XXVOLID  EQU   XXJFCB+118     6 BYTE VOLUME ID FIELD                    10720000
XXFULL   DS    F              WORK AREA ON A FULL WORD                  10780000
XXDECB   DC    5F'0'                                                    10800000
MV61SV   DS    CL1                     SAVE MSG CODE            YM05783 10810002
         ORG                                                            10820000
XXDSCB   DS    11F            DATA SET NAME                             10840000
XXFORMAT DS    X              DSCB FORMAT ID                            10860000
         DS    95X            DSCB INFORMATION FIELDS                   10880000
XXCODE   DS    X              FOR POSTING RETURN STATUS                 10900000
         ORG                                                            10940000
         END   IEHMVESZ                                                 10960000
./  ADD  SSI=70280035,NAME=IEHMVSTA
*TITLE                                                                * 00050004
*   'IEHMVSTA-MOVE/COPY/LOAD/UNLOAD CATALOG'                          * 00100004
*FUNCTION/OPERATION                                                   * 00150004
*   THIS ROUTINE PUTS THE CATALOG OR PART OF THE CATALOG ON A         * 00200004
*   SPECIFIED DEVICE. IF MOVE IS SPECIFIED THE ORIGINAL CATALOG       * 00250004
*   ENTRIES ARE UNCATALOGED. IF UNLOAD IS SPECIFIED THE CATALOG       * 00300004
*   ENTRIES ARE WRITTEN ON THE OUTPUT DATA SET IN UNLOADED FORMAT.    * 00350004
*   IF LOAD IS INDICATED THE ENTRIES FROM THE INPUT DATA SET ARE      * 00400004
*   CATALOGED. NORMALLY CATALOG ENTRIES ARE TAKEN FROM THE ORIGINAL   * 00450004
*   CATALOG BY IEHMVSSC AND WRITTEN ON A WORK DATA SET WHICH IS READ  * 00500004
*   BY THIS ROUTINE. IF THE NECESSARY INDEX STRUCTURE DOES NOT EXIST  * 00550004
*   ON THE 'TO' VOLUME IT IS BUILT.                                   * 00600004
*ENTRY POINTS                                                         * 00650004
*   IEHMVETA-ONLY ENTRY POINT                                         * 00700004
*   CALLING SEQUENCE   L     14,12(0,13)                              * 00750004
*                      XCTL  (2,12),EP=IEHMVETA                       * 00800004
*INPUT                                                                * 00850004
*   WORK DATA SET CONSISTING OF RECORDS CONTAINING NAME AND VOLUME    * 00900004
*   INFORMATION OBTAINED BY IEHMVSSC FROM THE ORIGINAL ('FROM')       * 00950004
*   CATALOG.                                                          * 01000004
*OUTPUT                                                               * 01050004
*   ENTRIES IN THE 'TO' VOLUME CATALOG.                               * 01100004
*EXTERNAL ROUTINES                                                    * 01150004
*   IEHMVSRK  READS UNLOADED FORMAT DATA SETS.                        * 01200004
*   IEHMVSRM  WRITES UNLOADED FORMAT RECORDS                          * 01250004
*EXITS-NORMAL                                                         * 01300004
*   END OF INPUT - WRITE MESSAGE,FREEMAIN,TRANSFER CONTROL TO IEHMVEST* 01350004
*       IF MORE REQUESTS,TRANSFER CONTROL TO IEHMVESK IF NONE.        * 01400004
*      ERRORS                                                         * 01450004
*   I/O ERRORS, MACRO ERRORS - WRITE MESSAGE,INDICATE REQUEST NOT     * 01500004
*       COMPLETED,FREEMAIN,TRANSFER CONTROL TO IEHMVEST IF MORE       * 01550004
*       REQUESTS,TRANSFER CONTROL TO IEHMVESK IF NONE.                * 01600004
*TABLES/WORK AREAS                                                    * 01650004
*   TABLE OF MESSAGE TEXT.                                            * 01700004
*   TABLE OF MACRO CODES.                                             * 01750004
*   WORK AREA OF 900 BYTES.                                           * 01800004
*ATTRIBUTES                                                           * 01850004
*   REENTRANT,READ ONLY,REUSABLE.                                     * 01900004
*                                                                       01950004
*                                                                       02000004
***** REGISTER DESIGNATION *****                                        02050004
*                                                                       02100004
*                                                                       02150004
REG0     EQU   0                                                        02200004
REG1     EQU   1                                                        02250004
REG2     EQU   2                                                        02300004
REG3     EQU   3                                                        02350004
REG4     EQU   4                                                        02400004
REG5     EQU   5                                                        02450004
REG6     EQU   6                                                        02500004
REG7     EQU   7                                                        02550004
REG8     EQU   8                                                        02600004
REG9     EQU   9                                                        02650004
REG10    EQU   10                                                       02700004
REG11    EQU   11                                                       02750004
REG12    EQU   12                                                       02800004
REG13    EQU   13                                                       02850004
REG14    EQU   14                                                       02900004
REG15    EQU   15                                                       02950004
IEHMVSTA CSECT                                                          03000004
* 029120,032600,091600                                           A37886 03050004
*A019300,019320,034300,056040-056096,056420,067900-067960        A48776 03100004
*A096700,105700                                                  A48776 03150004
*C019000,034200,080600,084400                                    A48776 03200004
*                                                                A27719 03250004
* 091000,092000                                                  A29225 03300004
*033600,056200                                                   A23930 03350004
*2164                                                             21076 03400004
*  033750-033800,105200                                          S21042 03450004
*A032487,032489,033704-033719                                    A52004 03500004
*C032450,032486,032488,032490,032500                             A52004 03550004
*D032444-032448,032484                                           A52004 03600004
*A 052700                                                      @XA04148 03650004
*A 054230-054350,055660-055720,067946-067952                   @XA05827 03700004
*C 055200                                                      @XA05827 03750004
*                                                              @Z40CSJH 03760004
*      THE ENTIRE MODULE WAS REACTIVATED IN SUPPORT            @Z40CSJH 03770004
*      OF THE EXTENDED MVS CVOL FUNCTION                       @Z40CSJH 03780004
*                                                                       03790004
         EXTRN IEHMVERM                                                 03800004
         EXTRN IEHMVERK                                                 03850004
         ENTRY A                                                        03900004
         ENTRY B                                                        03950004
         ENTRY C                                                        04000004
         ENTRY D                                                        04050004
         ENTRY E                                                        04100004
         ENTRY F                                                        04150004
         ENTRY G                                                        04200004
         ENTRY H                                                        04250004
         ENTRY J                                                        04300004
         ENTRY  MYEOD                                                   04350004
         EXTRN TATBL1                                                   04400004
         EXTRN TAEODAD                                                  04450004
         EXTRN MSGTERM                                                  04500004
         EXTRN MSG300                                                   04550004
         EXTRN MSG301                                                   04600004
         ENTRY IEHMVETA                                                 04650004
IEHMVETA SAVE  (14,12),T,TA9/15                                         04700004
         IEHPRE ,TF                                                     04750004
         BALR  10,0                                                     04800004
         USING IEHMVV,REG12                                             04850004
         USING TADSECT,REG8                                             04900004
         USING *,REG10                                                  04950004
         TM    IEHMVV20,DSGROUP         IS THIS A DSGROUP FUNCTION      05000004
         BZ    TA00                    NO                               05050004
         L     REG2,IEHMVV41           DCB ADDR-SYSUT2                  05100004
         MVI   16(REG2),KEYLN           PUT KEY LENGTH IN DCB           05150004
         B     *+8                                                      05200004
TA00     L     REG2,IEHMVV40           DCB ADDR-SYSUT1                  05250004
         MVC   57(3,REG2),TASYNAD      PUT SYNAD IN DCB                 05300004
         MVC   33(3,REG2),MYEOD                                         05350004
         GETMAIN  R,LV=944              GET 900 BYTES OF WORK AREA      05400004
         LR    REG8,REG1               ADDR OF STORAGE ACQUIRED         05450004
         MVI   CATNAME,X'40'      BLANK DSNAME                   A48776 05500004
         MVC   CATNAME+1(43),CATNAME  SAVE AREA                  A48776 05550004
         POINT (2),TATTRK                                               05600004
*                                                                       05650004
*                                                                       05700004
***** INITIALIZE MACRO PARAMETER LISTS *****                            05750004
*                                                                       05800004
*                                                                       05850004
         MVI   TALST1,X'00'                                             05900004
         MVC   TALST1+1(47),TALST1     CLEAR PARAM LIST AREA            05950004
         MVI   TALST1,CATMAC            CODE FOR CATALOG MACRO          06000004
         MVI   TALST2,UNCATMAC          CODE FOR UNCATALOG              06050004
         TM    IEHMVV20+1,CVOL          WAS CVOL SPECIFIED              06100004
         BZ    TA02                    NO                               06150004
         OI    TALST2,CVOLIND           CVOL INDICATOR                  06200004
         L     REG2,IEHMVV24           ADDR OF CVOL ID                  06250004
         LA    REG2,4(0,REG2)          ADD 4                            06300004
         ST    REG2,TALST2+8           PUT IN UNCAT LIST                06350004
TA02     L     REG2,IEHMVV23           ADDR OF 'TO' VOL ID              06400004
         LA    REG2,4(0,REG2)          ADD 4                            06450004
         ST    REG2,TALST1+8           PUT IN CATALOG LIST              06500004
         ST    REG2,TALST3+8           PUT IN INDEX LIST                06550004
         LA    REG2,TAWRK+3            ADDR OF NAME                     06600004
         ST    REG2,TALST1+4           PUT IN CATALOG LIST              06650004
         ST    REG2,TALST2+4           PUT IN UNCAT LIST                06700004
         ST    REG2,TALST3+4           PUT IN INDEX LIST                06750004
         LA    REG2,TAWRK+47           ADDR OF VOLUME LIST              06800004
         ST    REG2,TALST1+12          PUT IN CATALOG LIST              06850004
*                                                                       06900004
*                                                                       06950004
***** GET A CATALOG ENTRY FROM WORK FILE *****                          07000004
*                                                                       07050004
*                                                                       07100004
TA04     TM    IEHMVV20+1,LOAD          IS THIS A LOAD SITUATION        07150004
         BO    TA03                    YES                              07200004
         TM    IEHMVV20,DSGROUP         IS THIS A DSGROUP FUNCTION      07250004
         BZ    TA04A                   NO                               07300004
         L     REG2,IEHMVV41           DCB ADDR-SYSUT2                  07350004
         L     REG3,IEHMVV41+4         DECB ADDR                        07400004
         B     TA04B                                                    07450004
TA04A    L     REG2,IEHMVV40           DCB ADDR-SYSUT1                  07500004
         L     REG3,IEHMVV40+4         DECB ADDR                        07550004
TA04B    LA    REG4,TAPRE              INPUT AREA ADDR                  07600004
         LA    REG2,0(0,REG2)          CLEAR                            07650004
         LA    REG3,0(0,REG3)          UPPER BYTES                      07700004
         LA    REG4,0(0,REG4)          OF REGISTERS                     07750004
         READ  (REG3),SF,(REG2),(REG4),'S',MF=E                         07800004
         LA    REG3,0(0,REG3)           CLEAR HIGH ORDER BYTE           07850004
         CHECK (REG3)                                                   07900004
         CLI   TAWRK+2,X'FF'           LAST RECORD                      07950004
         BE    TAEOD                   YES                              08000004
         TM    IEHMVV74+13,X'20'       IS VCB BIT ON?            A27719 08050004
         BO    TAREBLD1                                          A27719 08100004
         CLC   TAPRE+12(5),EXTEND      IS THIS SPEC VCB RECORD   A37886 08150004
         BE    TAREBLD                 GO BUILD VCB REC          A27719 08200004
*                                                                       08250004
*                                                                       08300004
***** DETERMINE TYPE OF ENTRY AND TAKE APPROPRIATE ACTION *****         08350004
*                                                                       08400004
*                                                                       08450004
TA11     CLI   TAWRK+2,VALIND           IS INDICATOR VALID              08500004
         BH    TA17                    NO                               08550004
         TM    IEHMVV20+1,UNLOAD        IS THIS AN UNLOAD SITUATION     08600004
         BO    TA06                    YES                              08650004
         TM    IEHMVV20+1,UNCATLG       UNCATALOG REQUEST (DSGROUP)     08700004
         BO    TA12                    YES                              08750004
TA11A    SR    REG1,REG1                                                08800004
         IC    REG1,TAWRK+2            INDICATOR FROM ENTRY             08850004
         L     REG3,TATBL2(REG1)       GET CODE FROM LIST               08900004
         ST    REG3,TALST3             PUT CODE IN INDEX PARAM LIST     08950004
         L     REG3,TATBL3(REG1)       GET ADDR FROM LIST               09000004
         BR    REG3                                                     09050004
*                                                                       09100004
*                                                                       09150004
*****  REBUILD LONG VCB RECORD  *****                                   09200004
*                                                                       09250004
*                                                                       09300004
TAREBLD  TM    IEHMVV20+1,UNLOAD       UNLOAD SITUATION?         A27719 09350004
         BO    TABLD1                  YES -                     A27719 09400004
         SR    REG2,REG2                                         A27719 09450004
         IC    REG2,TAWRK              PICK UP LENGTH            A27719 09500004
         SLL   REG2,8                  OF RECORD AND             A27719 09550004
         IC    REG2,TAWRK+1            ADD THE BASE OF 20.       A27719 09600004
         AH    REG2,TWENTY             GETMAIN FOR THAT          A27719 09650004
         LA    REG2,8(REG2)            ALLOW FOR REGISTER SAVE   A27719 09700004
         LA    REG2,240(REG2)          ADD SAFTY FACTOR          A27719 09750004
         LR    REG0,REG2               CORE FOR THE RECONSTRUCT  A27719 09800004
         GETMAIN  R,LV=(0)             RECORD                    A27719 09850004
         LR    REG9,REG1               REG9 WILL POINT TO MY AREAA27719 09900004
         LR    REG3,REG1               REG3 WILL VARY AS INFOR-  A27719 09950004
         ST    REG2,SAVCORE            SAVE THE LENGTH OF CORE   A27719 10000004
         LA    REG3,8(REG3)            INCREMENT PAST REG AREA   A27719 10050004
         MVC   0(46,REG3),TAWRK+3      MOVE DSNAME AND VCB COUNT A27719 10100004
         LA    REG3,46(REG3)           START OF VCB ENTRIES      A52004 10150004
         SR    REG2,REG2               CLEAR REG FOR VCB COUNT   A27719 10200004
         IC    REG2,TAVCBS             MATION IS ADDED TO RECORD A27719 10250004
         SLL   REG2,8                  PUT NUMBER OF VCBS IN     A27719 10300004
         IC    REG2,TAVCBS+1           REGISTER                  A27719 10350004
         STM   REG2,REG3,0(REG9)       SAVE THE REGS             A27719 10400004
TAREBLD1 LM    REG2,REG3,0(REG9)                                 A27719 10450004
         LA    REG5,TAINFO             INPUT VCB'S               A27719 10500004
         LA    REG1,2                  LOOP CONTROL              A27719 10550004
LOOPD    MVC   0(240,REG3),0(REG5)                               A27719 10600004
         LA    REG3,240(REG3)          INCREMENT R3 BY NO. MOVE  A27719 10650004
         LA    REG5,240(REG5)          INCREMENT R5 BY NO. MOVE  A27719 10700004
         SH    REG2,TWENTY             SUBTRACT VCBS MOVED       A27719 10750004
         BNP   TA11                    FINISHED LAST REC         A27719 10800004
         BCT   REG1,LOOPD                                        A27719 10850004
         STM   REG2,REG3,0(REG9)                                 A27719 10900004
         OI    IEHMVV74+13,X'20'       TURN OF VCB BIT           A27719 10950004
         B     TARERD                  YES-READ NEXT RECORD      A52004 11000004
CLRVCBS  LA    REG2,16            SET REG2 TO 16                 A52004 11050004
         SR    REG2,REG15         IS RETURN CODE CTLG 16         A52004 11100004
         BZ    BLDINDX            YES -BUILD INDEX FIRST         A52004 11150004
         NI    IEHMVV74+13,X'DF'       TURN OFF VCB BIT          A52004 11200004
         L     REG0,SAVCORE            LOAD LENGTH OF GETAREA    A27719 11250004
         ST    REG15,SAVCORE           SAVE RETURN FROM CATALOG  A27719 11300004
         FREEMAIN  R,LV=(0),A=(9)                                A27719 11350004
         L     REG15,SAVCORE           PICK UP RETURN CODE       A27719 11400004
BLDINDX  LA    REG2,TAWRK+3            ADDR OF NAME              A52004 11450004
         ST    REG2,TALST1+4           PUT IN CATALOG LIST       A27719 11500004
         LA    REG2,TAWRK+47           ADDR OF VOLUME LIST       A27719 11550004
         ST    REG2,TALST1+12          PUT IN CATALOG LIST       A27719 11600004
         B     TA16                                              A27719 11650004
TABLD1   MVI   TAWRK+47,X'EE'          VCB BUILD CODE            A27719 11700004
         MVC   TALNG(2),TAWRK          PUT TRUE LENGTH IN SAFTY  A27719 11750004
         MVI   TAWRK,X'02'             PUT LENGTH OF RECORD TO   A27719 11800004
         MVI   TAWRK+1,X'17'           UNLOAD IN PLACE           A27719 11850004
         CLI   IEHMVV74+13,X'05'       FIRST EXTEND BLOCK        A37886 11900004
         BE    *+12                    NO CONTINUE               A37886 11950004
         LA    REG9,46                 TO CHECK NUMBER OF        A37886 12000004
         MVI   IEHMVV74+13,X'05'       EXTEND BLOCKS PROCESSED   A37886 12050004
         B     TA06                    GO TO UNLOAD              A27719 12100004
TABLD2   MVI   TAWRK+47,X'00'          PUT ZEROS IN COUNT FIELD  A27719 12150004
         TM    IEHMVV74+13,X'20'       IS VCB BIT ON?            A27719 12200004
         BO    TAREBLD1                SKIP SETUP IF YES         A27719 12250004
         MVC   TAWRK(2),TALNG          SET UP TOTAL LENGTH       A27719 12300004
         B     TAREBLD                 GO BUILD LONG VCB RECORD  A27719 12350004
TARERD   TM    IEHMVV20+1,LOAD         IS THIS A LOAD SITUATION? A27719 12400004
         BO    TA03                    YES- READ FROM TAPE       A27719 12450004
         B     TA04A                   NO- READ FROM SYSUT1      A27719 12500004
*                                                                       12550004
***** CATALOG ENTRY ON 'TO' VOLUME *****                                12600004
*                                                                       12650004
*                                                                       12700004
TA11B    CLI   TAWRK+47,X'FF'          IS INDEX SWITCH ON        A23930 12750004
         BE    TA11E                   IF SO GO TO TURN          A23930 12800004
*                                      SWITCH OFF                A23930 12850004
         CLI   TAWRK+47,X'EE'          IS THIS A LOADED VCB?     A27719 12900004
         BE    TABLD2                  GO PREPARE RECORD         A27719 12950004
         CLI   TAWRK+48,X'00'          IS VOL COUNT = ZERO       A23930 13000004
         BE    TA11D                   IF SO GO TO TURN          A23930 13050004
*                                      INDEX SWITCH ON           A23930 13100004
         TM    IEHMVV74+13,X'20'       VCB BIT ON?               A52004 13150004
         BZ    TA11BA                  NO  -                     A52004 13200004
         LA    REG2,8(REG9)            INCREMENT PAST REG AREA   A52004 13250004
         ST    REG2,TALST1+4           ADDRESS OF NAME IN CTLG   A52004 13300004
         LA    REG2,44(REG2)           OBTAIN AND STORE ADDRESS  A52004 13350004
         ST    REG2,TALST1+12          OF VCB IN CATLG LIST      A52004 13400004
TA11BA   EQU   *                                                 A52004 13450004
         CLI   TAWRK+48,X'02'          HOW MUCH VOLS?            S21042 13500004
         BNL   NORMCAT                 MORE THAN 1,BRACH         S21042 13550004
         OI    TALST1+1,X'02'     1 VOL THEN TTRPOINTER BIT ON   S21042 13600004
         LA    REG1,TAPRE+12           PUT ADDRESS OF TTR IN REG1S21042 13650004
         ST    REG1,TALST1+16     STORE ADDRESS IN PARAMETERLIST S21042 13700004
NORMCAT  CATALOG TALST1                                          S21042 13750004
         NI    TALST1+1,X'FD'          SET OFF INDICATION OF TTR S21042 13800004
         TM    IEHMVV74+13,X'20'       VCB BIT ON?               A27719 13850004
         BO    CLRVCBS                 YES -                     A27719 13900004
         B     TA16                                                     13950004
TA11C    MVC   CATNAME(L'CATNAME),TAWRK+3  SAVE DSNAME           A48776 14000004
         TM    IEHMVV20+1,UNCATLG UNCATLG REQ                    A48776 14050004
         BO    TA04                    YES                              14100004
*                                                                       14150004
*                                                                       14200004
***** UNCATALOG ENTRY FROM CVOL IF MOVE SPECIFIED *****                 14250004
*                                                                       14300004
*                                                                       14350004
TA12     TM    IEHMVV20+1,LOAD          IS THIS A LOAD SITUATION        14400004
         BO    TA03                    YES                              14450004
         CLI   TAWRK+2,ZERO             DATA SET ENTRY                  14500004
         BNE   TA04                    NO                               14550004
         TM    IEHMVV20+1,UNCATLG       UNCATALOG REQUEST (DSGROUP)     14600004
         BO    *+12                    YES                              14650004
         TM    IEHMVV20,MOVE            MOVE CATALOG                    14700004
         BZ    TA04                    NO                               14750004
         LA    REG2,TALST2             ADDR OF UNCAT LIST               14800004
         CATALOG (2)                                                    14850004
         LTR   REG15,REG15             ENTRY UNCATALOGED                14900004
         BNE   TA16                    NO                               14950004
         TM    IEHMVV20,MOVE            MOVE REQUEST                    15000004
         BZ    TA11A                   NO-RECAT REQUEST                 15050004
         LA    REG15,124(0,0)          RETURN CODE                      15100004
         B     TA16                                                     15150004
*                                                                       15200004
*                                                                       15250004
***** INTERPRET RETURN CODE *****                                       15300004
*                                                                       15350004
*                                                                       15400004
TA16     CL    REG15,TAMXCD            CODE VALID                       15450004
         BH    TA17                    NO                               15500004
         SLL   REG15,1                 DOUBLE CODE                      15550004
         L     REG3,ADTATBL1            GET MESSAGE ADDRESS             15600004
         L     REG11,ATATBL1            GET RETURN ADDR FROM LIST       15650004
         L     REG3,0(REG3,REG15)                                       15700004
         L     REG11,0(REG11,REG15)                                     15750004
         L     REG11,0(REG11)                                           15800004
         LTR   REG3,REG3               PRINT MSG                        15850004
         BZ    0(0,REG11)              NO                               15900004
*                                                                       15950004
*                                                                       16000004
***** GENERATE MESSAGE *****                                            16050004
*                                                                       16100004
*                                                                       16150004
TAMSG    SR    REG5,REG5                                                16200004
         MVI   TAPRNT,X'00'             CLEAR MESSAGE AREA.             16250004
         MVC   TAPRNT+1(120),TAPRNT    MESSAGE AREA                     16300004
         LA    REG1,TAPRNT+1           ADDR OF MSG AREA                 16350004
         BAL   REG2,TAMSGB             GO TO MOVE SEGMENT               16400004
         L     REG2,ADTATBL1                                            16450004
         LA    REG15,0(REG2,REG15)                                      16500004
         TM    0(REG15),NAME                                            16550004
         BZ    TAMSGA                  NO                               16600004
         LR    REG6,REG3               SAVE MSG ADDR                    16650004
         BM    TAMSGX                  INDEX NAME REQUIRED              16700004
         L     REG3,MSG300AD           ADDR OF MSG SEGMENT              16750004
         B     *+8                                                      16800004
TAMSGX   L     REG3,MSG301AD           ADDR OF MSG SEGMENT              16850004
         BAL   REG2,TAMSGB             GO TO MOVE SEGMENT               16900004
         MVC   0(44,REG1),TAWRK+3      PUT NAME IN MSG                  16950004
         LA    REG1,45(0,REG1)         ADDR OF NEXT PART OF MSG         17000004
         IC    REG5,0(0,REG6)          LGTH OF PREVIOUS MSG SEGMENT     17050004
         LA    REG3,2(REG5,REG6)       ADDR OF NEXT MSG SEGMENT         17100004
         BAL   REG2,TAMSGB             GO TO MOVE SEGMENT               17150004
TAMSGA   LA    REG3,TAPRNT             ADDR OF MSG OUTPUT AREA          17200004
         LINK  EP=IEHMVESU             GO TO MSG WRITER                 17250004
         LTR   REG15,REG15             MESSAGE WRITTEN                  17300004
         BNE   TA31                    NO                               17350004
         BR    REG11                                                    17400004
TAMSGB   IC    REG5,0(0,REG3)          LENGTH OF MSG SEGMENT            17450004
         EX    REG5,TAMVM1             PUT SEGMENT IN MSG AREA          17500004
         LA    REG1,2(REG5,REG1)       ADDR OF NEXT PART OF MSG AREA    17550004
         BR    REG2                    RETURN                           17600004
*                                                                       17650004
*                                                                       17700004
***** REQUEST NOT COMPLETELY SERVICED *****                             17750004
*                                                                       17800004
*                                                                       17850004
TA17     OI    IEHMVV32,X'04'          RETURN CODE TO WRAP-UP RTN       17900004
*                                                                       17950004
*                                                                       18000004
***** END OF   DATA EXIT FOR WORK FILE *****                            18050004
*                                                                       18100004
*                                                                       18150004
TAEOD    LA    REG15,68(0,0)           RETURN CODE                      18200004
         L     REG2,IEHMVV41           ADDR OF SYSUT2 DCB               18250004
         MVI   16(REG2),KEY             RESTORE KEY LGTH IN DCB         18300004
         TM    IEHMVV20,DSGROUP                                  A34094 18350004
         BO    TA30D                                             A34094 18400004
         B     TA16                                                     18450004
*                                                                       18500004
*                                                                       18550004
***** SYNCHRONOUS I/O ERROR EXIT FOR WORK FILE *****                    18600004
*                                                                       18650004
*                                                                       18700004
TASYN    LA    REG15,84(0,0)           RETURN CODE                      18750004
         OI    IEHMVV41+13,X'04'       RET CODE EQUAL 12       @XA04148 18800004
         B     TA16                                                     18850004
*                                                                       18900004
*                                                                       18950004
***** WHEN INDEX STRUCTURE INCOMPLETE BUILD NECESSARY INDEXES *****     19000004
*                                                                       19050004
*                                                                       19100004
TA21     LA    REG4,TAWRK+3            ADDR OF FULLY QUALIFIED NAME     19150004
TA22     LA    REG4,1(0,REG4)          ADD 1                            19200004
         CLI   TAWRK+2,GDG             GDG ENTRY ?             @XA05827 19250004
         BE    TA22C                   YES....BRANCH           @XA05827 19300004
         LA    REG15,TAWRK+47          MASK FOR NAME=44 BYTES  @XA05827 19350004
TA22A    CR    REG4,REG15              NAME 44 OR 35 BYTES ?   @XA05827 19400004
         BNL   TA22B                   YES....BRANCH           @XA05827 19450004
         CLI   0(REG4),PERIOD           IS THIS BYTE A PERIOD           19500004
         BE    TA23                    YES                              19550004
         CLI   0(REG4),BLANK            IS THIS BYTE A BLANK            19600004
         BNE   TA22                    NO                               19650004
TA22B    CLI   TAWRK+2,GDG              GDG INDEX              @XA05827 19700004
         BE    TA25D                   YES                              19750004
         B     TA11B                                                    19800004
TA22C    LA    REG15,TAWRK+38          MASK FOR NAME=35 BYTES  @XA05827 19850004
         B     TA22A                   BRANCH TO TEST          @XA05827 19900004
*                                                                       19950004
TA23     MVI   0(REG4),BLANK            BLANK OUT PERIOD                20000004
         LA    REG15,TAWRK+4      COMPUTE LENGTH OF NAME         A48776 20050004
         LR    REG5,REG4          SAVE VALUE                     A48776 20100004
         SR    REG5,REG15         LENGTH FOR EXECUTE             A48776 20150004
         EX    REG5,CLC1          COMPARE NAMES                  A48776 20200004
***CLC1  CLC   CATNAME(1),TAWRK+3 COMMENT ONLY                   A48776 20250004
         BNE   TA23A              *B IF NOT EQUAL                A48776 20300004
         SR    REG15,REG15        SIMULATE RC OF INDEX=0         A48776 20350004
         B     AFTINDEX           BYPASS SVC 26                  A48776 20400004
TA23A    LA    REG2,TALST3             ADDR OF INDEX             A23930 20450004
*                                      MACRO PARAM LIST          A23930 20500004
         INDEX (2)                                                      20550004
AFTINDEX EQU   *                                                 A48776 20600004
         CLI   TAWRK+47,X'AA'          IS LOW LEVEL SWITCH ON    A23930 20650004
         BE    TA04                    GO TO GET ANOTHER         A23930 20700004
*                                      ENTRY FROM WORK FILE      A23930 20750004
         MVI   0(REG4),PERIOD           RESTORE PERIOD IN NAME          20800004
         LA    REG15,32(0,REG15)       ADD 32 TO RETURN CODE            20850004
         B     TA16                    GO TO TEST RETURN CODE           20900004
TA11D    MVI   TAWRK+47,X'FF'          TURN INDEX SW ON          A23930 20950004
         B     TA21                    BLDX FOR INCOMPLETE       A23930 21000004
*                                      STRUCTURE                 A23930 21050004
TA11E    MVI   TAWRK+47,X'AA'          TURN LOW LEVEL SW ON      A23930 21100004
         B     TA23A                   BLDX FOR LOW LEVEL        A23930 21150004
*                                                                       21200004
*                                                                       21250004
***** BUILD ALIAS CATALOG ENTRY OR CVOL CATALOG ENTRY *****             21300004
*                                                                       21350004
*                                                                       21400004
*                                                                       21450004
TA24B    MVI   TALST3,CHANGE            CHANGE INDEX                    21500004
         MVI   TALST3+1,MACODE          MACRO CODE                      21550004
TA24     LA    REG2,TAWRK+12       POINT TO ALIAS NAME             7622 21600004
         ST    REG2,TALST3+12          PUT IN INDEX MACRO LIST          21650004
         B     TA27                    GO TO ISSUE INDEX MACRO          21700004
*                                                                       21750004
*                                                                       21800004
***** BUILD GENERATION INDEX AND PUT MODEL DSCB ON 'TO' VOLUME *****    21850004
*                                                                       21900004
*                                                                       21950004
TA25     MVC   TALST3+3(1),TAWRK+39    PUT MAX NO OF GEN IN PARAM LIST  22000004
         TM    TAWRK+38,EMPTY           OPTION = EMPTY                  22050004
*                                                                       22100004
         BZ    TA25A                   NO                               22150004
         OI    TALST3+2,EMTCODE         PUT EMPTY CODE IN PARAM LIST    22200004
TA25A    TM    TAWRK+38,DELETE          OPTION = DELETE                 22250004
         BZ    TA25C                   NO                               22300004
         OI    TALST3+2,DELCODE         PUT DELETE CODE IN PARAM LIST   22350004
TA25C    CLI   TAWRK+40,X'BB'  IS THIS A GDG WITH NO DSCB         21076 22400004
         BE    TA21          YES                                  21076 22450004
         MVI   TAWRK+38,BLANK  PUT BLANKS                         21076 22500004
         MVC   TAWRK+39(7),TAWRK+38    ON END OF NAME                   22550004
         MVI   TAWRK+62,ZERO            NO OF EXTENTS                   22600004
         MVI   TAWRK+101,ZERO           SET                             22650004
         MVC   TAWRK+102(41),TAWRK+101 ALLOCATION QTY                   22700004
         GETMAIN  R,LV=140                                              22750004
         LR    REG7,REG1                                                22800004
         MVC   0(43,REG7),TAWRK+3                                       22850004
         MVI   43(REG7),X'40'                                           22900004
         MVI   44(REG7),X'F1'                                           22950004
       MVC   51(89,REG7),TAWRK+47                                       23000004
         L     REG1,IEHMVV31+8                                          23050004
         LH    REG1,14(0,REG1)                                          23100004
         MVC   45(6,REG7),28(REG1)                                      23150004
         L     REG1,IEHMVV31+8         ADDR IN TIOT                     23200004
         LA    REG1,12(0,REG1)                                          23250004
         LR    REG0,REG7                                                23300004
         O     REG0,TAMSK1                                              23350004
         SVC   32                                                       23400004
         LR    REG1,REG7                                                23450004
         LR    REG7,REG15                                               23500004
         FREEMAIN  R,LV=140,A=(1)                                       23550004
         LA    REG15,4            PREPARE FOR TEST TO SEE IF.....  7130 23600004
         CR    REG7,REG15         MODEL DSCB IS ON TO VOLUME ?     7130 23650004
         BNH   TA21               YES, TA21 .... NO, DROP THROUGH  7130 23700004
         LA    REG15,116               RETURN CODE                      23750004
         B     TA16                                                     23800004
TA25D    MVI   TALST3+1,INDMAC          CHANGE INDEX MACRO CODE         23850004
*                                                                       23900004
*                                                                       23950004
         MVC   CATNAME(35),TAWRK+3 SAVE GDG NAME                 A48776 24000004
         MVI   CATNAME+35,X'40'   BLANK REST OF SAVE AREA        A48776 24050004
         MVC   CATNAME+36(8),CATNAME+35                          A48776 24100004
         MVI   TAWRK+38,X'40'          BLANK GDG INFORMATION   @XA05827 24150004
         MVC   TAWRK+39(8),TAWRK+38                            @XA05827 24200004
*                                                                A48776 24250004
         B     TA27                                                     24300004
***** DETERMINE TYPE OF INDEX BUILT AND TAKE APPROPRIATE ACTION *****   24350004
*                                                                       24400004
*                                                                       24450004
TA26     CLI   TALST3+1,NORINDX         NORMAL INDEX                    24500004
         BNE   TA04                    NO                               24550004
         CLI   TAWRK+2,RNALIAS          REAL NAME FOR ALIAS             24600004
         BE    TA24B                   YES                              24650004
         B     TA22                                                     24700004
*                                                                       24750004
*                                                                       24800004
***** USE INDEX MACRO TO CONSTRUCT DESIRED INDEX *****                  24850004
*                                                                       24900004
*                                                                       24950004
TA27     LA    REG2,TALST3             ADDR OF PARAM LIST               25000004
         INDEX (2)                                                      25050004
         CLI   TAWRK+2,RNALIAS         IS THIS AN ALIAS?         A27719 25100004
         BE    TA27B                   YES - BRANCH              A27719 25150004
         CLI   TALST3+1,NORINDX         NORMAL INDEX                    25200004
         BE    TA27A                   YES                              25250004
         CLI   TAWRK+2,CVOLENT          CVOL ENTRY                      25300004
         BH    TA27B                   NO-GDG ENTRY                     25350004
         BE    TA27A                   YES                              25400004
         MVC   TAWRK+3(8),TAWRK+48     PUT ALIAS IN PLACE OF REAL NAME  25450004
TA27A    MVI   TAWRK+11,BLANK           BLANK OUT                       25500004
         MVC   TAWRK+12(35),TAWRK+11   REST OF NAME AREA                25550004
TA27B    LA    REG15,32(0,REG15)       ADD 32 TO RETURN CODE            25600004
         B     TA16                    GO TO TEST RETURN CODE           25650004
*                                                                       25700004
*                                                                       25750004
***** PROCEDURE WHEN CATALOG STRUCTURE INCONSISTENT AFTER CATALOG ***** 25800004
***** MACRO HAS BEEN ISSUED                                             25850004
*                                                                       25900004
*                                                                       25950004
TA28     LA    REG15,88(0,REG1)        PUT ADJUSTED CODE IN  REG 15     26000004
         B     TA16                                                     26050004
*                                                                       26100004
*                                                                       26150004
***** PROCEDURE WHEN CATALOG STRUCTURE INCONSISTENT AFTER INDEX *****   26200004
***** MACRO HAS BEEN ISSUED                                             26250004
*                                                                       26300004
*                                                                       26350004
TA29     CH    REG1,TAK12              INDEX BLOCK FOUND BY LOCATE MACR 26400004
         BZ    TA26                    YES                              26450004
         LA    REG15,88(0,REG1)        PUT ADJUSTED CODE IN REG 15      26500004
         B     TA16                                                     26550004
*                                                                       26600004
*                                                                       26650004
***** PROCEDURE FOR I/O ERROR IN SYSOUT *****                           26700004
*                                                                       26750004
*                                                                       26800004
TA31     OI    IEHMVV32,WRAPCODE        RETURN CODE TO WRAP-UP ROUTINE  26850004
*                                                                       26900004
*                                                                       26950004
***** PROCEDURE FOR ENDING FUNCTION *****                               27000004
*                                                                       27050004
*                                                                       27100004
TA30     TM    IEHMVV20+1,UNLOAD        IS UNLOAD SPECIFIED             27150004
         BZ    TA30A                   NO                               27200004
         LR    REG0,REG10              INDICATE END OF DATA SET         27250004
         L     REG15,TABWRT            ADDR OF WRITER                   27300004
         BALR  REG14,REG15                                              27350004
         L     REG5,IEHMVV31      TO DCB ADDR                           27400004
* THIS ROUTINE SAVES THE VOL SER NBR AND FILE SEQ NBR OF IEHMVESN       27450004
         TM    48(REG5),X'10'          DCB OPEN                  A43752 27500004
         BNO   SKIPSAVE                NO SKIP THE SAVE RTN      A43752 27550004
         L     REG4,44(REG5)           DEB ADDRESS               A43752 27600004
         SR    REG2,REG2               CLEAR FOR INSERT          A43752 27650004
         IC    REG2,16(REG4)           NBR OF EXTENTS            A43752 27700004
         TM    28(REG4),X'04'          DA DEVICE                 A43752 27750004
         BO    OFFS16                  YES FIND LAST EXTENT      A43752 27800004
         LA    REG4,28(REG4)           SCAN THE EXTENTS          A43752 27850004
NEXTEXT1 LA    REG4,4(REG4)            JUMP TO NEXT EXTENT       A43752 27900004
         BCT   REG2,NEXTEXT1           SCAN FURTHER              A43752 27950004
         B     SAVEUCB                 STORE UCB ADDR            A43752 28000004
OFFS16   DS    0H                                                A43752 28050004
         LA    REG4,16(REG4)                                     A43752 28100004
NEXTEXT2 LA    REG4,16(REG4)           JUMP TO NEXT EXTENT       A43752 28150004
         BCT   REG2,NEXTEXT2           SCAN FURTHER              A43752 28200004
SAVEUCB  L     REG4,0(REG4)            GET UCB ADDR              A43752 28250004
         MVC   IEHMVV82+24(2),38(REG4) SAVE LOG FILE SEQ NBR     A43752 28300004
         MVC   IEHMVV82+26(6),28(REG4) SAVE THE VOL SER NBR      A43752 28350004
         OI    IEHMVV82+24,X'80'       SET SWITCH TO IND         A43752 28400004
SKIPSAVE DS    0H                                                A43752 28450004
         CLOSE   ((REG5))                                               28500004
         IEHPOST ,T                                                     28550004
         FREEMAIN R,LV=944,A=(8)                                 A48776 28600004
         L     REG14,12(0,REG13)       RESTORE REG 14                   28650004
         XCTL  (2,12),EP=IEHMVESN                                       28700004
TA30A    TM    IEHMVV20+1,LOAD          IS LOAD SPECIFIED               28750004
         BZ    TA30C                   NO                               28800004
         L     REG5,IEHMVV30           ADDR OF FROM DCB                 28850004
         CLOSE ((5))                                                    28900004
TA30C    TM    IEHMVV32,REQABORT        REQUEST ABORTED                 28950004
         BO    TA30D                   YES                              29000004
         L     REG3,MSGTRMAD           ADDR OF MESSAGE                  29050004
         MVI   TAPRNT,X'00'             CLEAR PRINT AREA                29100004
         MVC   TAPRNT+1(120),TAPRNT    MESSAGE AREA                     29150004
         SR    REG5,REG5                                                29200004
         LA    REG1,TAPRNT+1           ADDR OF MSG AREA                 29250004
         BAL   REG2,TAMSGB             GO TO MOVE MSG                   29300004
         L     REG2,IEHMVV23           ADDR OF TO VOL ID                29350004
         MVC   0(6,REG1),4(REG2)       PUT VOL ID IN MSG                29400004
         BAL   REG11,TAMSGA                                             29450004
TA30D    IEHPOST ,T                                                     29500004
         FREEMAIN R,LV=944,A=(8)                                 A48776 29550004
         L     REG14,12(0,REG13)     RESTORE REG 14                     29600004
         TM    IEHMVV32,SYSERR          SYSOUT ERROR                    29650004
         BO    TA30B                   YES                              29700004
         TM    IEHMVV20+2,EOI           ANY OTHR REQUESTS--END OF INPUT 29750004
         BO    TA30B                   NO                               29800004
         XCTL  (2,12),EP=IEHMVEST                                       29850004
TA30B    XCTL  (2,12),EP=IEHMVESK                                       29900004
*                                                                       29950004
*                                                                       30000004
***** PROCEDURE FOR LOAD SITUATION *****                                30050004
*                                                                       30100004
*                                                                       30150004
TA03     SR    REG0,REG0                                                30200004
         LA    REG1,TAWRK              ADDR OF INPUT AREA               30250004
         L     REG15,TABRD             ADDR OF RTN WHICH READS          30300004
*                                        UNLOADED CATALOG               30350004
         BALR  REG14,REG15             GO TO GET CATALOG ENTRY          30400004
         LTR   REG15,REG15             ENTRY FOUND                      30450004
         BZ    TA11                    YES                              30500004
         LA    REG15,68(0,REG15)       ADD 68 TO RETURN CODE            30550004
         B     TA16                    GO TO TEST RETURN CODE           30600004
*                                                                       30650004
*                                                                       30700004
***** PROCEDURE FOR UNLOAD SITUATION *****                              30750004
*                                                                       30800004
*                                                                       30850004
TA06     SR    REG0,REG0                                                30900004
         LA    REG1,TAWRK              ADDR OF OUTPUT AREA              30950004
         L     REG15,TABWRT            ADDR OF RTN TO WRITE             31000004
*                                       UNLOADED CATALOG                31050004
         BALR  REG14,REG15             GO TO WRITE ENTRY                31100004
         LTR   REG15,REG15             ENTRY WRITTEN                    31150004
         BNE   TA06A                   NO                        A29225 31200004
         TM    TAWRK+2,DSENT            DATA SET ENTRY                  31250004
         BM    TA12                    NO                               31300004
         CLI   TAWRK+48,X'00'          IS THIS AN INDEX ENTRY    A23930 31350004
*                                      WITHOUT DATA SET          A23930 31400004
         BE    TA04                    YES-DO NOT WRITE MESSAGE  A23930 31450004
*                                      GO TO GET ANOTHER ENTRY   A23930 31500004
         CLI   IEHMVV74+13,X'05'       EXTENDED VCBS             A37886 31550004
         BNE   WRTMSG                  NO CONTINUE               A37886 31600004
         LA    REG9,480(REG9)          YES  UPDATE EXT LENGTHCT  A37886 31650004
         CH    REG9,TALNG              LAST BLOCK PROCESSED      A37886 31700004
         BL    TA12                    NO READ NEXT              A37886 31750004
         MVI   IEHMVV74+13,X'00'       YES  TURN OFF INDIC       A37886 31800004
WRTMSG   LA    REG15,120(0,0)          RETURN CODE               A37886 31850004
         B     TA16                                                     31900004
TA06A    LA    REG15,60(0,REG15)       ADD 60 TO RETURN CODE     A29225 31950004
         B     TA16                    GO TO TEST RETURN CODE           32000004
*                                                                       32050004
*                                                                       32100004
***** CONSTANTS *****                                                   32150004
*                                                                       32200004
*                                                                       32250004
TAMXCD   DC    F'124'                                                   32300004
TAMSK1   DC    X'80000000'                                              32350004
TAK12    DC    H'12'                                                    32400004
TAK8     DC    H'8'                                                     32450004
TATTRK   DC    A(256)                                                   32500004
EXTEND   DC    CL5'XVCBS'                                        A27719 32550004
TWENTY   DC    H'20'                                             A27719 32600004
SAVCORE  DS    1F                                                A27719 32650004
*                                                                       32700004
*                                                                       32750004
***** ADDRESS CONSTANTS *****                                           32800004
*                                                                       32850004
*                                                                       32900004
TASYNAD  DC    AL3(TASYN)                                               32950004
TABWRT   DC    A(IEHMVERM)                                              33000004
TABRD    DC    A(IEHMVERK)                                              33050004
*                                                                       33100004
*                                                                       33150004
***** INSTRUCTIONS PERFORMED THRU EXECUTE *****                         33200004
*                                                                       33250004
CLC1     CLC   CATNAME(1),TAWRK+3                                A48776 33300004
*                                                                       33350004
TAMVM1   MVC   0(1,REG1),1(REG3)       MOVE MSG TEXT TO MSG AREA        33400004
A        DC    A(TA11C)                                                 33450004
B        DC    A(TA28)                                                  33500004
C        DC    A(TA21)                                                  33550004
D        DC    A(TA26)                                                  33600004
E        DC    A(TA29)                                                  33650004
F        DC    A(TA30)                                                  33700004
G        DC    A(TA04)                                                  33750004
H        DC    A(TA17)                                                  33800004
J        DC    A(TA12)                                                  33850004
MYEOD    DC    A(TAEOD)                                                 33900004
ADTATBL1 DC    A(TATBL1)                                                33950004
ATATBL1  DC    A(TATBL1+4)                                              34000004
ATAEODAD DC    A(TAEODAD)                                               34050004
MSGTRMAD DC    A(MSGTERM)              CATALOG MOVED/COPIED             34100004
MSG300AD DC    A(MSG300)                                                34150004
MSG301AD DC    A(MSG301)                                                34200004
*                                                                       34250004
*                                                                       34300004
***** TABLE OF CODES FOR INDEX MACRO *****                              34350004
*                                                                       34400004
*                                                                       34450004
TATBL2   DS    0F                                                       34500004
         DC    X'84400000'             BLDX                             34550004
         DC    X'84400000'             BLDA                             34600004
         DC    X'C4080000'             LINKX                            34650004
         DC    X'84400000'             BLDG (HIGHER INDEX LEVELS)       34700004
***** TABLE OF ROUTINE ADDRESSES FOR DIFFERENT TYPES OF ENTRIES *****   34750004
TATBL3   DS    0F                                                       34800004
         DC    A(TA11B)                DATA SET                         34850004
         DC    A(TA27)             ALIAS                           7622 34900004
         DC    A(TA24)                 CVOL                             34950004
         DC    A(TA25)                 GDG INDEX                        35000004
*                                                                       35050004
*                                                                       35100004
***** DEFINE WORK STORAGE *****                                         35150004
*                                                                       35200004
*                                                                       35250004
TADSECT  DSECT                                                          35300004
TAPRNT   DS    121C                                                     35350004
TAST1    DS    F                                                        35400004
TALST1   DS    5F                                                S21042 35450004
TALST2   DS    4F                                                       35500004
TALST3   DS    4F                                                       35550004
CATNAME  DS    CL44               SAVE DS- & GDG NAMES           A48776 35600004
TAPRE    DS    17C                                                      35650004
TAWRK    DS    C                                                        35700004
*                                                                       35750004
*                                                                       35800004
***** E Q U A T E S  *****                                              35850004
*                                                                       35900004
*                                                                       35950004
DSGROUP  EQU   X'10'                                                    36000004
KEYLN    EQU   X'0C'                                                    36050004
BLANK    EQU   C' '                                                     36100004
CATMAC   EQU   X'E4'                                                    36150004
UNCATMAC EQU   X'0C'                                                    36200004
CVOL     EQU   X'40'                                                    36250004
CVOLIND  EQU   X'80'                                                    36300004
LOAD     EQU   X'02'                                                    36350004
VALIND   EQU   X'0C'                                                    36400004
UNLOAD   EQU   X'01'                                                    36450004
UNCATLG  EQU   X'20'                                                    36500004
MOVE     EQU   X'80'                                                    36550004
NAME     EQU   X'FF'                                                    36600004
KEY      EQU   X'08'                                                    36650004
PERIOD   EQU   C'.'                                                     36700004
GDG      EQU   X'0C'                                                    36750004
CHANGE   EQU   X'C4'                                                    36800004
MACODE   EQU   X'10'                                                    36850004
EMPTY    EQU   X'01'                                                    36900004
EMTCODE  EQU   X'08'                                                    36950004
DELETE   EQU   X'02'                                                    37000004
DELCODE  EQU   X'40'                                                    37050004
ZERO     EQU   X'00'                                                    37100004
INDMAC   EQU   X'20'                                                    37150004
NORINDX  EQU   X'40'                                                    37200004
RNALIAS  EQU   X'04'                                                    37250004
CVOLENT  EQU   X'08'                                                    37300004
WRAPCODE EQU   X'08'                                                    37350004
REQABORT EQU   X'04'                                                    37400004
SYSERR   EQU   X'08'                                                    37450004
EOI      EQU   X'20'                                                    37500004
DSENT    EQU   X'FF'                                                    37550004
TAVCBS   EQU   TAWRK+47                                          A27719 37600004
TAINFO   EQU   TAWRK+49                                          A27719 37650004
TALNG    EQU   TAWRK+529                                         A27719 37700004
         IEHMVV                                                         37750004
         END                                                            37800004
./  ADD  SSI=80240042,NAME=IEHMVSTC
*TITLE                                                                * 00020000
*   'IEHMVSTC - PDS DIRECTORY SCANNER'                                * 00040000
*FUNCTION/OPERATION:                                                  * 00060000
*   THIS ROUTINE READS A SPECIFIED PDS DIRECTORY AND WRITES THE       * 00080000
*   DIRECTORY RECORDS ON A WORK FILE FOR THE USE OF THE               * 00100000
*   MOVE/COPY/UNLOAD PDS FUNCTIONS.  IF ANY MEMBERS ARE TO EXCLUDED OR* 00120000
*    REPLACED EACH MEMBER NAME READ IS COMPARED TO THE MEMBER NAMES IN* 00140000
*    A FILE OF EXCLUDES AND REPLACES AND IF IT MATCHES THE ENTRY IS   * 00160000
*   NOT PUT ON THE OUTPUT WORK FILE.                                  * 00180000
*ENTRY POINTS:                                                        * 00200000
*        IEHMVETC - ONLY ENTRY POINT L 15, A (IEHMVETC) BALR 14,15    * 00220000
*INPUT:                                                               * 00240000
*   1.  SPECIFIED PDS DIRECTORY ENTRIES FROM A DIRECT ACCESS DEVICE.  * 00260000
*   2.  WORK FILE (SYSUT2) OF EXCLUDES/REPLACES FROM DIRECT ACCESS    * 00280000
*   DEVICE.                                                           * 00300000
*OUTPUT:                                                              * 00320000
*   WORK FILE (SYSUT3) OF MEMBERS TO MOVED/COPIED/UNLOADED TO DIRECT  * 00340000
*   ACCESS DEVICE.                                                    * 00360000
*EXITS - NORMAL                                                       * 00380000
*   FREEMAIN AND RETURN TO CALLING ROUTINE                            * 00400000
*ERRORS:                                                              * 00420000
*   FREEMAIN AND TRANSFER CONTROL TO IEHMVESN WHEN I/O ERROR OCCURS.  * 00440000
*TABLES/WORK AREAS:                                                   * 00460000
*   136 BYTE WORK AREA.                                               * 00480000
*ATTRIBUTES:                                                          * 00500000
*   READ ONLY,REENTRANT,REUSABLE.                                     * 00520000
*D036300                                                       @ZA11965 00520499
*C036100                                                       @ZA04392 00521099
*A019100                                                       @ZA01234 00522002
*A036300                                                       @YA02535 00525002
*A018900                                                        OY01177 00530016
*A034900                                                         YM5090 00532000
*C036100                                                       @ZA28365 00534099
*A035400,035700,036000                                         @ZA28365 00535099
*A067260-067360                                                @ZA28914 00537099
R0       EQU   0                                                        00540000
R1       EQU   1                                                        00560000
R2       EQU   2                                                        00580000
R3       EQU   3                                                        00600000
R4       EQU   4                                                        00620000
R5       EQU   5                                                        00640000
R6       EQU   6                                                        00660000
R7       EQU   7                                                        00680000
R8       EQU   8                                                        00700000
R9       EQU   9                                                        00720000
R10      EQU   10                                                       00740000
R11      EQU   11                                                       00760000
R12      EQU   12                                                       00780000
R13      EQU   13                                                       00800000
R14      EQU   14                                                       00820000
R15      EQU   15                                                       00840000
CVTPCNVT EQU   28                                                       00860000
CVTPRLTV EQU   32                                                       00880000
SEVENT   EQU   17                      BYTES TO CORRECT TIC      S20201 00882020
NINE1    EQU   9                       BYTES TO CORRECT CCW      S20201 00884020
RPS      EQU   4                       BYTES TO BYTE IN IEHMVV   S20201 00886020
CODE     EQU   136                     BYTES IN CCW CHAIN        S20201 00888020
CCWCLR   EQU   187                     BYTES TO CLEAR IN STCP    S20201 00890020
RECLN    EQU   91                      LENGTH OF RECORD AND KEY  S20201 00892020
EXCLUDE  EQU   C'E'                                                     00900000
ERMASK   EQU   X'C0'                                                    00920000
EXCREP   EQU   X'04'                                                    00940000
DSGROUP  EQU   X'10'                                                    00960000
FIRSTIME EQU   X'FF'                                                    00980000
* THIS IS THE ROUTINE TO BREAK UP A PDS DIRECTORY SO THAT THE PDS MAY   01000000
*              BE COPIED WITHOUT MISSING AN ENTRY                       01020000
*2039 0350-0358,0366-0370,0816-0818,0908-0918                      7491 01040000
*                                                                       01060000
IEHMVSTC CSECT                                                          01080000
*C062000                                                         A48801 01082022
*  ALL CODE FLAGGED S20201 WAS ADDED OR CHANGED FOR              S20201 01086020
*  MERLIN/ZEUS SUPPORT                                           S20201 01092020
         ENTRY IEHMVETC                                                 01100000
IEHMVETC SAVE  (14,12),T,IEHMVSTC-OZ28914                      @ZA28914 01120000
         LR    11,15                                                    01140000
         USING IEHMVETC,11                                              01160000
         USING IEHMVV,12                                                01180000
*                                                                       01200000
         IEHPRE ,FT           SETS UP NEW SAVE AREA                     01220000
*                                                                       01240000
         SR    R10,R10                                                  01260000
         L     R3,IEHMVV41         ADDR OF SYSUT2 DCB                   01280000
         LA    R3,0(0,R3)          CLEAR HIGH ORDER BYTE                01300099
         L     R4,IEHMVV42         ADDR OF SYSUT3 DCB                   01310099
         LA    R4,0(0,R4)          CLEAR HIGH ORDER BYTE                01320099
         USING OUTDCB,4                                                 01330099
         MVC   57(3,R4),ERRAD          PUT SYNAD IN UT3 DCB             01340099
         TM    IEHMVV20,DSGROUP    DSGROUP OPERATION                    01400000
         BO    POINT3                  YES                              01420000
         TM    IEHMVV20+2,EXCREP   ANY EXCLUDES OR REPLACES             01440000
         BZ    POINT3                  NO                               01460000
         POINT (R3),TTRA1              REPOSITION SYSUT2                01480000
POINT3   POINT (R4),TTRA1              REPOSITION SYSUT3                01500000
         MVC   57(3,R3),ERRAD          PUT SYNAD IN UT2 DCB             01520099
*                                                                       01540000
         MVC   OPAREA(SW2-DOPEN+1),DOPEN   REENTRANT OPEN AND DCB SETUP 01560000
         L     R9,IEHMVV30+12      ADDR OF 'FROM' DDNAME                01580000
         MVC   INDCB+40(8),0(R9)   PUT DDNAME IN DCB                    01600000
         GETMAIN  R,LV=650                                       S20201 01620020
         LR    R5,R1                                                    01640000
         USING STCP,R5                                                  01660000
         MVI   MODJFCB,X'00'           CLEAR                            01680000
         MVC   MODJFCB+1(175),MODJFCB   MODEL JFCB                      01700000
         LA    R1,MODJFCB              ADDR OF MODEL JFCB               01720000
         ST    R1,EXLIST               PUT IN EXIT LIST                 01740000
         LA    R1,EXLIST               EXIT LIST ADDR                   01760000
         ST    R1,INDCB+36         PUT IN DCB                           01780000
         MVI   INDCB+36,X'81'                                           01800000
         MVI   EXLIST,X'87'                                             01820000
         L     R1,IEHMVV21             ADDR OF DS NAME                  01840000
         MVC   MODJFCB(44),0(R1)       PUT DS NAME IN JFCB              01860000
         MVI   MODJFCB+44,X'40'                                         01880000
         MVI   MODJFCB+52,X'08'        DON'T WRITE BACK JFCB    OY01177 01890016
         MVI   MODJFCB+117,X'01'       NO OF VOLS                       01900000
         MVI   MODJFCB+87,X'C0'        INDICATE NEW DATA SET   @ZA01234 01910002
         L     R1,IEHMVV22+4           ADDR OF VOL ID                   01920000
         MVI   MODJFCB+124,X'40'                                        01940000
         MVC   MODJFCB+118(6),4(R1)    PUT VOL ID IN JFCB               01960000
         MVC   MODJFCB+53(3),IEHMVV82  MOVE TTR9IN JFCB          S21042 01970021
         OPEN  (INDCB),TYPE=J,MF=(E,OPAREA)                             01980000
***** INITIALIZE CHANNEL PROGRAM AND IOB ******                         02000000
         MVI   EXIOB,X'00'             CLEAR                            02020000
         MVC   EXIOB+1(CCWCLR),EXIOB   AREA                      S20201 02040020
         LA    R1,EXECB                ADDR OF ECB                      02060000
         ST    R1,EXIOB+4              PUT IN IOB                       02080000
         LA    R1,EXCPENT              ADDR OF CHANNEL PROGRAM          02100000
         ST    R1,EXIOB+16             PUT IN IOB                       02120000
         ST    R1,EXCPENT+8            PUT IN CHAN PROG                 02140000
         LA    R1,CHANID+3             ADDR OF MBBCCHHR OF FIRST RECORD 02160000
         ST    R1,EXCPENT              PUT IN CHAN PROG                 02180000
         LA    R1,EXCP3                TIC ADDR                         02200000
         ST    R1,EXCP2+8              PUT IN CHAN PROG                 02220000
         LA    R1,SW3                                                   02240000
         ST    R1,EXCP2+16                                              02260000
         LA    R1,EXCPLAD              ADDR OF CCHHR OF LAST RECORD     02280000
         ST    R1,EXCP3                PUT IN CHAN PROG                 02300000
         LA    R1,EXCP2                TIC ADDR                         02320000
         ST    R1,EXCP3+8              PUT IN CHAN PROG                 02340000
         MVI   NEWIOB,X'00'            CLEAR SWITCH                     02360000
         LA    R1,EXCP2A               TIC ADDR                         02380000
         ST    R1,EXCP2A+8             PUT IN CHAN PROG                 02400000
         LA    R1,EXCP2A               TIC TO SEARCH ID EQ       S20201 02406020
         ST    R1,EXCP2B                                         S20201 02412020
         OC    EXCPENT(CODE),CHPROG   PUT CODES AND LNGTH IN CCWSS20201 02422020
* HOUSEKEEP FOR THE RUN                                                 02440000
         MVC   CHANID(8),5(R3)          PUT START CCHHR IN IOB          02460000
         MVC   EXCPLAD(5),IEHMVV41+8    PUT END CCHHR IN TEST SLOT      02480000
         ST    R3,UT2DCB                STORE DCB ADDRESS IN IOB        02500000
         NI    IEHMVV20+2,X'7F'        CLEAR ALIAS INDICATOR            02520000
*                                                                       02540000
ABLE     READ  INPUT,SF,INDCB,INAREA,MF=E                               02560000
         CHECK INPUT                                                    02580000
*                                                                       02600000
         LA    R10,1(R10)     STEP RECORD COUNTER                       02620000
*                                                                       02640000
         TM    IEHMVV20+2,X'02'       SELECTS SPECIFIED                 02660000
         BO    ABLE                    YES                              02680000
*        TEST TO SEE IF ALL ENTRIES PROCESSED. IF YES-READ TO CT RCDS   02700000
         TM    SWITCH,X'FF'                                             02720000
         BC    1,ABLE                                                   02740000
*                                                                       02760000
*        SET UP BASE ADDRESS FOR BLOCK AND SAVE KEY                     02780000
         LA    R9,INAREA                                                02800000
         MVC   KEY(8),0(R9)                                             02820000
*                                                                       02840000
*        GET ENTRY NAME ADDRESS                                         02860000
         LA    R9,10(R9)                                                02880000
*                                                                       02900000
*        COMPARE ENTRY NAME WITH KEY                                    02920000
REPEAT   CLC   KEY(8),0(R9)                                             02940000
         BE    DOG            EQUAL - LAST ENTRY FOR THIS RECORD        02960000
*                                                                       02980000
*        SET UP FOR WRITE                                               03000000
PROC     LR    R8,R9                                                    03020000
         SH    R8,NINE                                                  03040000
*        COMPUTE LENGTH OF RECORD TO BE WRITTEN IN R7                   03060000
         LH    R7,10(0,R9)                                              03080000
         LA    R6,X'1F'                                                 03100000
         NR    R7,R6                                                    03120000
         AR    R7,R7                                                    03140000
         LA    R7,17(0,R7)   DATA LENGTH IS IN R7                       03160000
*                                                                       03180000
* TEST IF MEMBER IS TO BE EXCLUDED OR REPLACED                          03200000
         TM    IEHMVV20+2,EXCREP                                        03220000
         BZ    PROC2               BRANCH IF NO                         03240000
         MVC   EXECB(4),DEXECB                                          03260000
         ST    R9,NAMEADD          STORE ADDRESS OF ENTRY NAME          03280000
         MVC   EXCP2+1(3),NAMEADD+1                                     03300000
         MVC   EXCP2A+1(3),NAMEADD+1                                    03320000
         MVI   SW3,X'00'           CLEAR EXCLUDE SWITCH                 03340000
         TM    IEHMVV20+RPS,X'04'      RPS BIT ON TEST           S20201 03340920
         BZ    PROC1                   NO - USE EXISTING CCWS    S20201 03341820
         LA    R1,EXCP3A               NEW FIRST CCW (SET SECTOR)S20201 03342720
         ST    R1,EXIOB+16             PUT IT IN THE IOB         S20201 03343620
         LA    R1,EXCPENT              GET PRESENT FIRST CCW     S20201 03344520
         ST    R1,NAMEADD              AND PUT IN TIC ADDRESS    S20201 03345420
         MVC   EXCP3A+NINE1(3),NAMEADD+1                         S20201 03346320
         LA    R1,EXCP3B               GET READ SECTOR CCW       S20201 03347220
         ST    R1,NAMEADD              AND PUT IT IN THE CCW     S20201 03348120
         MVC   EXCP2B+1(3),NAMEADD+1   AFTER THE READ            S20201 03349020
         LA    R1,EXCP2A               GET SEARCH AFTER READ     S20201 03349920
         ST    R1,NAMEADD              AND PUT IN TIC AFTER      S20201 03350820
         MVC   EXCP3B+SEVENT(3),NAMEADD+1  SET SECTOR            S20201 03351720
         LA    R1,SECTOR               GET ADDR TO PUT SECTOR    S20201 03352620
         ST    R1,NAMEADD              VALUE AND PUT IN          S20201 03353520
         MVC   EXCP3B+1(3),NAMEADD+1   CCW FOR READ              S20201 03354420
         MVC   EXCP3B+9(3),NAMEADD+1   AND SET SECTORS           S20201 03355320
         LA    R1,EXCP3+18             GET A BYTE OF ZERO        S20201 03356220
         ST    R1,NAMEADD              FOR 0 SECTOR VALUE        S20201 03357120
         MVC   EXCP3A+1(3),NAMEADD+1   PUT IN SET SECTOR CCW     S20201 03358020
         MVC   NAMEADD+1(3),EXCP2+1    PUT NAME BACK IN DSECT    S20201 03358920
PROC1    LA    R1,EXIOB                                          S20201 03368920
         EXCP  (1)                     SEARCH SYSUT2                    03380000
         L     R1,EXIOB+4                                               03400000
         WAIT  ECB=(1)                                                  03420000
         L     R3,IEHMVV41             DCB ADDR                         03440000
         TM    44(R3),ERMASK                                            03460000
         BZ    EXOK                BRANCH IF NO ERRORS                  03480000
         NI    44(R3),X'FF'-ERMASK SET PERM ERROR OFF            YM5090 03490000
*                                                                       03500000
ERROR    MVI   IEHMVV61,X'20'  SET 61 TO WRITE I/O ERR WORK FILE   7491 03520000
*                              MSG IEH417I                     @ZA28365 03540099
         B     ERROR2A                                             7491 03550099
ERROR1   MVI   IEHMVV61,X'22'  SET 61 TO WRITE I/O ERR FROM DA SET 7491 03560099
*                              MSG IEH418I                     @ZA28365 03570099
         B     ERROR2A                                             7491 03580099
ERROR2   MVI   IEHMVV61,X'24'  SET 61 TO WRITE I/O ERR SYSPRINT    7491 03590099
*                              MSG IEH419I                     @ZA28365 03600099
ERROR2A  OI    IEHMVV20+2,X'40'        INDICATE ABORTION       @ZA28365 03610099
         CLOSE (INDCB),MF=(E,OPAREA)                                    03640000
         FREEMAIN  R,LV=650,A=(5)                                S20201 03660020
         IEHPOST ,T                                                     03680000
         LA    15,4            SET RETURN CODE ERROR               7491 03700000
         RETURN (14,12),T,RC=(15)                                  7491 03720000
*                                                                       03740000
EXOK     TM    SW3,X'FF'                                                03760000
         BZ    PROC2               NO MATCH - BRANCH TO PROCESS ENTRY   03780000
         TM    IEHMVV20+1,X'01'                                         03800000
         BZ    PROC3               EXCLUDE ENTRY IF NOT UNLOAD MODE     03820000
         TM    SW3,EXCLUDE                                              03840000
         BO    PROC3               BRANCH IF IT WAS AN E TO EXCLUDE     03860000
*                                                                       03880000
*        WILL RECORD FIT ON THIS TRACK                                  03900000
PROC2    L     R1,IEHMVV42             GET THE DEVICE OVERHEAD FOR      03920000
         USING IHADCB,R1               THE LAST RECORD ON A TRACK       03940000
         L     R1,DCBDVTBL             BY GOING TO THE DEVICE           03960000
         USING UNITABLE,R1             CHARACTERISTICS TABLE FOR        03980000
         SR    R6,R6                   SYSUT3 -- THEN CHECK TO SEE      04000000
         TM    UNITFLAG,X'08'          IF 2-BYTE OVERHEAD        S20201 04004000
         BZ    ONEBYTE                 NO-GET 1 BYTE AND CONTINUES20201 04008020
         LH    R6,UNITOVHI             GET 2 BYTE OVERHEAD       S20201 04012020
         B     ADDREC                  TEST REC ON TRACK         S20201 04016020
ONEBYTE  IC    R6,UNITOVHL             CHECK TO SEE IF REC.      S20201 04026020
ADDREC   LA    R6,RECLN(0,R6)          (4 BYTE KEY+87 BYTE OF    S20201 04036020
*                                      DATA) WILL FIT            S20201 04046020
         TM    NEWIOB,FIRSTIME                                          04060000
         BZ    BAKER                   YES                              04080000
         CH    R6,OUTDCB+18                                             04100000
         BL    BAKER         BRANCH IF RECORD WILL FIT                  04120000
*                                                                       04140000
*        ZERO TRACK BALANCE                                             04160000
         SR    R6,R6                                                    04180000
         STH   R6,OUTDCB+18                                             04200000
*                                                                       04220000
*        COMPUTE NEXT TRACK ADDRESS                                     04240000
         L     R1,OUTDCB+44        SET UP FOR CONVERT ROUTINE           04260000
         LA    R2,OUTDCB+5                                              04280000
         LR    R3,R13                                                   04300000
         STM   R9,R13,72(R13)      STORE REGISTERS                      04320000
         L    R15,16(0,0)                                               04340000
         L    R15,CVTPRLTV(R0,R15)                                      04360000
         BALR  R14,R15             BRANCH TO CONVERT CCHHR TO TTR       04380000
*                                                                       04400000
         LR    R15,R0              SET UP FOR NEXT TRACK                04420000
         SRL   R15,16                                                   04440000
         LA    R15,1(R0,R15)                                            04460000
         SLL   R15,16                                                   04480000
         LR    R0,R15                                                   04500000
         LA    R2,1(R0,R8)                                              04520000
         L     R15,16(R0,R0)                                            04540000
         L     R15,CVTPCNVT(R0,R15)                                     04560000
         BALR  R14,R15             BRANCH TO CONVERT TTR TO CCHHR       04580000
*                                                                       04600000
*        RESET REGS                                                     04620000
         LM    R9,R13,72(R3)                                            04640000
*                                                                       04660000
*        MAKE FIELD R A ONE                                             04680000
         MVI   8(R8),X'01'                                              04700000
         B     CHARLIE                                                  04720000
*                                                                       04740000
*        RECORD WILL FIT. MOVE CCHHR TO OUT AREA                        04760000
BAKER    MVC   1(8,R8),OUTDCB+5                                         04780000
*                                                                       04800000
*        ADD ONE TO FIELD R                                             04820000
         LA    R8,1(0,R8)                                               04840000
         LH    R1,6(0,R8)                                               04860000
         LA    R1,1(0,R1)                                               04880000
         STH   R1,6(0,R8)                                               04900000
         BCTR  R8,0                                                     04920000
*                                                                       04940000
*        MOVE TTR INTO KEY FIELD                                        04960000
CHARLIE  MVC   1(3,R8),8(R9)                                            04980000
*                                                                       05000000
*        MOVE ALIAS BIT STATUS TO OUTPUT AREA AND WORK FILE CONTROL     05020000
         MVC   0(1,R8),11(R9)                                           05040000
         NI    0(R8),X'80'                                              05060000
*                                                                       05080000
*        PUT RECORD IN OUTPUT AREA                                      05100000
         OC    IEHMVV20+2(1),0(R8)                                      05120000
         MVC   WRAREA(91),0(R8)                                         05140000
         LR    R8,R5                                                    05160000
         MVC   RENAME(8),9(R5)         PUT NAME IN RECORD               05180000
*                                                                       05200000
*        WRITE THE RECORD                                               05220000
         WRITE OUTPUT,SF,OUTDCB,(R8),87,MF=E                            05240000
         CHECK OUTPUT                                                   05260000
         MVI   NEWIOB,X'FF'            INDICATE WRITE DONE              05280000
*                                                                       05300000
*        IS THIS LAST ENTRY OF INPUT RECORD                             05320000
PROC3    TM    EORSW,X'FF'                                              05340000
         BC    1,EASY                                                   05360000
*                                                                       05380000
*        NO - HOUSEKEEP FOR NEXT ENTRY                                  05400000
         SH    R7,FIVE                                                  05420000
         AR    R9,R7                                                    05440000
*                                                                       05460000
*        BRANCH FOR NEXT ENTRY                                          05480000
         B     REPEAT                                                   05500000
*                                                                       05520000
*        IT IS LAST ENTRY - CLEAR SWITCH AND GO READ NEXT RECORD        05540000
EASY     MVI   EORSW,X'00'                                              05560000
         B     ABLE                                                     05580000
*                                                                       05600000
*                                                                       05620000
*        ENTRY NAME IS EQUAL TO KEY                                     05640000
*        IS IT ALL F'S                                                  05660000
DOG      CLC   RECTERM(8),0(R9)                                         05680000
         BE    FOX                                                      05700000
*                                                                       05720000
*        NO IT IS NOT - SET EORSW ON AND CONTINUE PROCESSING            05740000
         MVI   EORSW,X'FF'                                              05760000
         B     PROC                                                     05780000
*                                                                       05800000
*        IT IS EQUAL - SET SWITCH ON AND GO TO READ NEXT RECORD         05820000
FOX      MVI   SWITCH,X'FF'                                             05840000
         B     ABLE                                                     05860000
*                                                                       05880000
*                                                                       05900000
*        END OF DATA ROUTINE                                            05920000
*        STORE RECORD COUNT - CLOSE - END PGM                           05940000
ENDIN    STH   R10,IEHMVV25                                             05960000
         TM    IEHMVV20+2,X'02'       SELECTS SPECIFIED                 05980000
         BO    NOTWRITE                YES                              06000000
*                                                                       06020000
* WRITE OUT DUMMY LAST RECORD                                           06040000
         WRITE OUTPUT,SF,OUTDCB,ENDREC,5,MF=E                           06060000
         CHECK OUTPUT                                                   06080000
*                                                                       06100000
* PUT CCHHR OF RECORD JUST WRITTEN INTO IEHMVV                          06120000
         MVC   IEHMVV42+8(5),OUTDCB+8                                   06140000
NOTWRITE EQU   *                                                        06160000
         CLOSE (INDCB),MF=(E,OPAREA)                                    06180000
         TM    IEHMVV20+2,EXCREP   ANY EXCLUDES OR REPLACES      A48801 06200022
         BZ    ENDB                     NO, SKIP EXCLUDE WRAPUP         06220000
RDEX     L     R3,IEHMVV41             DCB ADDR                         06240000
         MVI   44(R3),X'00'                                             06260000
         L     R2,IEHMVV41+4           DECB ADDR                        06280000
         READ  (2),SF,(3),INAREA,'S',MF=E                               06300000
         L     R2,IEHMVV41+4           DECB ADDR                        06320000
         CHECK (2)                                                      06340000
         CLC   IEHMVV41+8(5),8(R3)     LAST RECORD                      06360000
         BE    ENDB                    YES                              06380000
         CLI   INAREA+8,X'FF'          THIS NAME EXCLUDED               06400000
         BE    RDEX                    YES                              06420000
         L     R2,M320AD               MSG ADDR                         06440000
         BAL   R4,MSGMOVE                                               06460000
         LA    R1,2(R3,R1)             LOCATION OF NAME IN MSG          06480000
         MVC   0(8,R1),INAREA          PUT NAME IN MSG                  06500000
         LA    R1,9(0,R1)              LOCATION OF NEXT PART IN MSG     06520000
         LA    R2,2(R3,R2)             ADDR OF NEXT MSG SEGMENT         06540000
         IC    R3,0(0,R2)              GET LENGTH OF SEGMENT            06560000
         EX    R3,MOVEMSG              PUT MSG IN AREA                  06580000
         LA    R1,2(R3,R1)             LOCATION OF DSNAME IN MSG        06600000
         L     R2,IEHMVV21             ADDR OF DS NAME                  06620000
         MVC   0(44,R1),0(R2)          PUT NAME IN MSG                  06640000
         LA    R4,RDEX                 RETURN ADDR                      06660000
         B     MSGMOVEB                GO TO WRITE MSG                  06680000
ENDB     IEHPOST ,T                                                     06700000
         FREEMAIN R,LV=600,A=(5)                                        06720000
         XC    57(3,R3),57(R3)  CLEAR SYNAD ADDR IN SYSUT2 DCB @ZA28914 06726099
         MVI   59(R3),X'01'     SET LAST BYTE HEX 01           @ZA28914 06732000
         XC    57(3,R4),57(R4)  CLEAR SYNAD ADDR IN SYSUT3 DCB @ZA28914 06734000
         MVI   59(R4),X'01'     SET LAST BYTE HEX 01           @ZA28914 06736000
         LA    R15,0                                                    06740000
         RETURN (14,12),T,RC=(15)                                       06760000
*        MESSAGE MOVING ROUTINE                                         06780000
MSGMOVE  MVI   MSGAREA,X'00'                                            06800000
         MVC   MSGAREA+1(120),MSGAREA                                   06820000
MSGMOVEA SR    R3,R3                   CLEAR REG THREE                  06840000
         IC    R3,0(R2)                INSERT MSG LENGTH                06860000
         LA    R1,MSGAREA+1            ADDR OF MSG AREA                 06880000
         EX    R3,MOVEMSG              PUT MSG IN AREA                  06900000
         CLI   4(R1),C'2'              DOES MSG NEED NAME               06920000
         BE    0(0,R4)                 YES                              06940000
MSGMOVEB LA    3,MSGAREA               ADDR OF MSG OUTPUT AREA          06960000
         LINK  EP=IEHMVESU             GO TO MSG WRITER                 06980000
         LTR   R15,R15                                                  07000000
         BNE   ERROR2                  NO                               07020000
         BR    R4                                                       07040000
DOPEN    OPEN  (,(INPUT)),MF=L                                          07060000
*                                                                       07080000
DIDCB    DCB   DSORG=PS,MACRF=R,                                       B07100000
               DDNAME=DIRINPT,DEVD=DA,KEYLEN=8,                        B07120000
               SYNAD=ERROR1,                                           *07140000
               RECFM=F,                                                B07160000
               BLKSIZE=256,EODAD=ENDIN                                  07180000
*                                                                       07200000
SW1      DC    X'00'                                                    07220000
SW2      DC    X'00'                                                    07240000
ERRAD    DC    AL3(ERROR)                                               07260000
*                                                                       07280000
* CHANNEL PROGRAM FOR SEARCHING FOR EXCLUDES AND REPLACES               07300000
         DS    0D                                                       07320000
CHPROG   DC    X'31'                   SEARCH ID EQUAL FIRST RECORD     07340000
         DC    AL3(0)                                                   07360000
         DC    X'40'                                                    07380000
         DC    X'000005'                                                07400000
         DC    X'08'               IF NOT KEEP SEARCH GOING             07420000
         DC    AL3(0)                                                   07440000
         DC    X'40000001'                                              07460000
         DC    X'A9'                   NOW SEARCH KEY EQUAL TO NAME     07480000
         DC    AL3(0)                                                   07500000
         DC    X'60000008'                                              07520000
         DC    X'08'               IF NOT SEARCH ID                     07540000
         DC    AL3(0)                                                   07560000
         DC    X'40000001'                                              07580000
         DC    X'06'               KEY EQUAL READ DATA                  07600000
         DC    AL3(0)                                                   07620000
         DC    X'60000001'                                              07640000
         DC    X'08'                   IF RPS, GO SET SECTOR     S20201 07645020
         DC    AL3(0)                                            S20201 07650020
         DC    X'40000001'                                       S20201 07655020
         DC    X'29'                   SEARCH KEY EQUAL TO NAME         07660000
         DC    AL3(0)                                                   07680000
         DC    X'60000008'                                              07700000
         DC    X'08'              IF NOT GO BACK TO SEARCH KEY          07720000
         DC    AL3(0)                                                   07740000
         DC    X'40000001'                                              07760000
         DC    X'05'              INDICATE NAME MATCHED                 07780000
         DC    AL3(RECTERM)                                             07800000
         DC    X'20000001'                                              07820000
         DC    X'B1'                   SEARCH ID EQUAL TO LAST RECORD   07840000
         DC    AL3(0)                                                   07860000
         DC    X'40000005'                                              07880000
         DC    X'08'               IF NOT EQUAL GO BACK TO SEARCH KEY   07900000
         DC    AL3(0)                                                   07920000
         DC    X'40000001'                                              07940000
         DC    X'03'               END SEARCH NO MATCH FOUND            07960000
         DC    AL3(0)                                                   07980000
         DC    X'00000001'                                              08000000
         DC    X'23'                   SET SECTOR                S20201 08001020
         DC    AL3(0)                                            S20201 08002020
         DC    X'40000001'                                       S20201 08003020
         DC    X'08'                   SEARCH FOR RECORD         S20201 08004020
         DC    AL3(0)                                            S20201 08005020
         DC    X'40000001'                                       S20201 08006020
         DC    X'22'                   READ SECTPR               S20201 08007020
         DC    AL3(0)                                            S20201 08008020
         DC    X'40000001'                                       S20201 08009020
         DC    X'23'                   SET SECTOR                S20201 08010020
         DC    AL3(0)                                            S20201 08011020
         DC    X'40000001'                                       S20201 08012020
         DC    X'08'                   RETURN TO OLD CCWS        S20201 08013020
         DC    AL3(0)                                            S20201 08014020
         DC    X'40000001'                                       S20201 08015020
DEXECB   DC    F'0'                                                     08020000
         DS    0H                                                       08040000
NINE     DC    X'0009'                                                  08060000
FIVE     DC    X'0005'                                                  08080000
RECTERM  DC    X'FFFFFFFFFFFFFFFF'                                      08100000
ENDREC   DC    X'00BEB000'                                              08120000
         DC    C'DUMMY'                                                 08140000
TTRA1    DC    A(256)                                                   08160000
M320AD   DC    A(M320)                                                  08180000
MOVEMSG  MVC   0(1,R1),1(R2)           MOVE A MSG TO THE OUTPUT AREA    08200000
*                                                                       08220000
         IEHMVV                                                         08240000
         ORG   IEHMVV00                                                 08260000
OPAREA   OPEN  (,(INPUT)),MF=L                                          08280000
*                                                                       08300000
INDCB    DCB   DSORG=PS,MACRF=R,                                       B08320000
               DDNAME=DIRINPT,DEVD=DA,KEYLEN=8,                        B08340000
               RECFM=F,                                                B08360000
               BLKSIZE=256,EODAD=ENDIN                                  08380000
*                                                                       08400000
SWITCH   DS    CL1                                                      08420000
EORSW    DS    CL1                                                      08440000
         DS    0F                                                       08460000
INAREA   DS    CL264                                                    08480000
KEY      DS    CL8                                                      08500000
         READ  INPUT,SF,INDCB,INAREA,MF=L                               08520000
         WRITE OUTPUT,SF,OUTDCB,MF=L                                    08540000
*                                                                       08560000
STCP     DSECT                                                          08580000
WRAREA   DS    CL83                                                     08600000
RENAME   DS    CL8                                                      08620000
MSGAREA  DS    CL121                                                    08640000
EXIOB    DS    5F                                                       08660000
UT2DCB   DS    3F                                                       08680000
CHANID   DS    2F                                                       08700000
EXECB    DS    F                                                        08720000
NAMEADD  DS    F                                                        08740000
EXCPENT  DS    2D                                                       08760000
EXCP2    DS    6F                                                       08780000
EXCP2B   DS    2F                                                S20201 08790020
EXCP2A   DS    6F                                                       08800000
EXCP3    DS    6F                                                       08820000
EXCP3A   DS    4F                                                S20201 08826020
EXCP3B   DS    6F                                                S20201 08832020
SW3      DS    C                                                        08840000
EXCPLAD  DS    5C                                                       08860000
STIOBAD  DS    6C                                                       08880000
NEWIOB   DS    C                                                        08900000
SECTOR   DS    C                                                 S20201 08910020
MODJFCB  DS    44F                                                      08920000
         DS    0F                                                       08940000
EXLIST   DC    X'87'                                                    08960000
         DC    AL3(0)                                                   08980000
OUTDCB   DSECT                                                          09000000
***** TABLE OF MESSAGES. EACH MESSAGE IS PRECEDED BY ITS LENGTH *****   09020000
MSGSECT  CSECT                                                          09040000
M320     DC    AL1(M321-M320-2)                                         09060000
         DC    CL14'IEH320I MEMBER'                                     09080000
M321     DC    AL1(MEND-M321-2)                                         09100000
         DC    CL21'NOT FOUND IN DATA SET'                              09120000
MEND     DS    0C                                                       09140000
         EJECT                                                          09160000
         DCBD  DSORG=PS,DEVD=DA                                         09180000
         EJECT                                                          09200000
UNITABLE DSECT                                                          09220000
UNITSICC DS    H                       DEFINE THE VARIOUS DEVICE        09240000
UNITSIHH DS    H                        CHARACTERISTICS                 09260000
UNITTRLN DS    H                                                        09280000
UNITOVHI DS    CL1                                                      09300000
UNITOVHL DS    CL1                                                      09320000
UNITOVHK DS    CL1                                                      09340000
UNITFLAG DS    CL1                                                      09360000
UNITTOLR DS    CL1                                                      09380000
         END                                                            09400000
./  ADD  SSI=62450113,NAME=IEHMVSTL
*FUNCTION/OPERATION: MOVE OR COPY, UNLOAD AND LOAD DATA SETS USING    * 00040000
*BASIC DIRECT ACCESS METHOD (BDAM). THE BDAM DATASETS MUST USE        * 00060000
*RELATIVE TRACK OR RELATIVE RECORD ACCESS METHODS. THE MODULE DOES A  * 00080000
*GETMAIN FOR A WORKAREA AND BUFFER. READS BDAM DATASET USING BDAM READ* 00100000
*MACRO WRITES BDAM DATASET USING BSAM WRITE CREATE MODE.              * 00120000
*ENTRY POINTS: IEHMVETL ONLY ENTRY POINT                              * 00140000
*INPUT: AT ENTRY TO THIS MODULE REG 13 POINTS TO SAVEAREA AND REG 12  * 00160000
*POINTS TO COMMUNICATION TABLE FOR MOVE COPY PROGRAM.                 * 00180000
*OUTPUT: REG. ARE THE SAME AS INPUT.                                  * 00200000
*EXTERNAL ROUTINES: IEHMVLSU, IEHMVSRM, IEHMVSRK                      * 00220000
*EXITS - NORMAL XCTL TO IEHMVSSN                                      * 00240000
*ERRORS: XCTL TO IEHMVSSN                                             * 00260000
*TABLES/WORK AREAS: IEHMVV IS COMMUNICATION TABLE WRKBUF IS WORKAREA  * 00280000
*DSECT                                                                * 00300000
IEHMVSTL CSECT                                                          00310022
*C047400                                                       @ZA01710 00310302
*A078500                                                       @ZA01249 00310602
*D078500-078610                                                @ZA01249 00311202
*A078500-078610                                                  A52005 00312022
*D078608                                                         A52005 00320022
*C047400                                                         A45172 00320122
*A042740-042784,043100,043120                                    A50933 00320222
*D060800,064050-064150                                           A44346 00320421
*A060700-060900                                                  A44346 00320821
*                                                                 19030 00332019
*        ALL STATEMENTS FLAGGED 19030 PERTAIN TO THE BDAM-VRE     19030 00334019
*        LINE ITEM. BDAM-VRE IS SUPPORT FOR SPANNED RECORDS IN    19030 00336019
*        DIRECT DATA SETS WITH VARIABLE RECORD FORMAT             19030 00338019
*                                                                       00340000
*                                                                A27313 00354019
* 063200-063400                                                  MBVRE1 00356019
*089644,089680-089681,089716-089720                             PTM3086 00358019
*044200                                                          A32036 00359020
*                                                                A37878 00359521
* 078600-079000                                                  A41754 00359621
*047200-047600                                                   A38749 00359921
RG0      EQU   0                                                        00360000
RG1      EQU   1                                                        00380000
RG2      EQU   2                                                        00400000
RG3      EQU   3                                                        00420000
RG4      EQU   4                                                        00440000
RG5      EQU   5                                                        00460000
RG6      EQU   6                                                        00480000
RG7      EQU   7                                                        00500000
RG8      EQU   8                                                        00520000
RG9      EQU   9                                                        00540000
BAL9     EQU   9                                                        00560000
BASE10   EQU   10                                                       00580000
RG11     EQU   11                                                       00600000
BASE12   EQU   12                                                       00620000
RET14    EQU   14                                                       00640000
LINK15   EQU   15                                                       00660000
RTCD15   EQU   15                                                       00680000
KEY      EQU   16                                                       00700000
BLKLH    EQU   62                                                       00720000
DSORG    EQU   26                                                       00740000
IOBBD    EQU   28                                                       00760000
CSWCT    EQU   14                                                       00780000
IOFLG    EQU   44                                                       00800000
UPTTI    EQU   X'80'                                                    00820000
UGTLN    EQU   X'40'                                                    00840000
INVL1    EQU   X'21'                                                    00860000
TEST2    EQU   X'10'                                                    00880000
IOER     EQU   X'08'                                                    00900000
EOFM     EQU   X'04'                                                    00920000
UNEX     EQU   X'02'                                                    00940000
GOOD     EQU   X'00'                                                    00960000
FIXED    EQU   X'80'                                                    00980000
VARBL    EQU   X'40'                                                    01000000
UNKNW    EQU   X'C0'                                                    01020000
RECFM    EQU   36                                                       01040000
IOBBS    EQU   68                                                       01060000
SYNAD    EQU   57                                                       01080000
IFLGS    EQU   44                                                       01100000
OFFSET   EQU   46                                                       01120000
LODE     EQU   X'02'                                                    01140000
BLANK    EQU   C' '                                                     01160000
DONE     EQU   X'00'                                                    01180000
CAPREC   EQU   X'02'                                                    01200000
UNLODE   EQU   X'01'                                                    01220000
MIDABORT EQU   X'40'                                                    01240000
DEACTIVE EQU   X'00'                                               UL0H 01250017
*********************************************************************** 01260000
*                                                                       01280000
*                       THIS MODULE WILL MOVE OR COPY A BDAM            01300017
*                        DATASET WHICH ADDRESSES RECORDS USING          01320000
*                        RELATIVE TRACK OR RELATIVE RECORD NOTATION     01340000
*                                                                       01360000
*********************************************************************** 01380000
IEHMVETL SAVE  (14,12),T,ETL-10-4-65-KCD                                01400000
         USING IEHMVETL,BASE10                                          01420000
         USING IEHMVV,BASE12            COMMUNICATIONS REGION           01440000
         USING WRKBUF,RG11              WORK AREA                       01460000
         ENTRY IEHMVETL                                                 01480000
         EXTRN M01                                                      01500000
         EXTRN M02                                                      01520000
         EXTRN M03                                                      01540000
         EXTRN M04                                                      01560000
         EXTRN M05                                                      01580000
         EXTRN M06                                                      01600000
         EXTRN M07                                                 UL0H 01602017
         EXTRN M08                                               A27313 01602519
         LR    BASE10,LINK15           LOAD  BASE REGISTER         VS0H 01603017
*                                                                  UL0H 01604017
*  ACTIVATE USER INPUT TRAILER LABEL ROUTINE EXIT IF REQUIRED.     UL0H 01606017
*                                                                  UL0H 01608017
         CLI   UDCBITLE,DEACTIVE       IS ITLE INACTIVE            UL0H 01610017
         BE    NEXTCODE                YES, CONTINUE               UL0H 01612017
         MVC   UDCBITLE(4),XXITLE      ACTIVATE DCB EXLIST ENTRY PTM504 01614017
NEXTCODE DS    0H                                                  UL0H 01616017
         L     RG2,IEHMVV31            ADDRESS OF TO DCB                01640000
         MVC   SYNAD(3,RG2),SYNBSM      MOVE ADDR OF OUTPUT ERROR RTN   01660000
         IEHPRE (14,1),TF                                               01680000
         TM    IEHMVV20+1,LODE          IS THIS A LOAD SITUATION        01700000
         BZ    *+12                                                     01720000
         L     RG2,IEHMVV31             SUPPLY ADDRESS OF 'TO'DCB       01740000
         B     *+8                                                      01760000
         L     RG2,IEHMVV30             SUPPLY ADDRESS OF 'FROM' DCB    01780000
         SR    RG3,RG3                                                  01800000
         LA    RG4,123        AMOUNT NEEDED FOR WORKAREA          19030 01820019
         IC    RG3,KEY(0,RG2)      INSERT KEY LENGTH FROM DCB           01840000
         LH    RG5,BLKLH(0,RG2)    LOAD BLKSIZE FROM DCB                01860000
         LR    RG0,RG4                  DETERMINE AMOUNT OF             01880000
         AR    RG0,RG3                  SPACE NEEDED IN                 01900000
         AR    RG0,RG5                  GETMAIN AREA                    01920000
         LR    RG4,RG0             SAVE GETMAIN AMOUNT          PTM2137 01930018
         GETMAIN  R,LV=(0)         GET MAIN FOR WORKAREA AND BUFFERS    01940000
         LR    RG11,RG1                                                 01960000
        MVI   0(RG11),X'00'           CLEAR WORK AREA                   01980000
         MVC   1(122,RG11),0(RG11)                                19030 02000019
         ST    RG4,GOTEN          STORE GETMAIN AMOUNT          PTM2137 02020018
         LA    RG4,123        SIZE OF WKAREA DISPLACEMENT         19030 02040019
         AR    RG1,RG4                                                  02060000
         ST    RG1,KEYADR          STORE ADDRESS OF KEY BUFFER          02080000
         AR    RG1,RG3                                                  02100000
         ST    RG1,BUFADR          STORE ADDRESS OF DATA BUFFER         02120000
         LA    RG1,INDECB         ADDR OF INPUT DECB              19030 02124019
         ST    RG1,IEHMVV30+4     SAVE DECB ADDR IN IEHMVV DSECT  19030 02128019
         LA    RG1,DECBOUT        ADDR OF OUTPUT DECB             19030 02132019
         ST    RG1,IEHMVV31+4     SAVE DECB ADDR IN IEHMVV DSECT  19030 02136019
         STH   RG3,KEYLGN          STORE LENGTH OF KEY                  02140000
         STH   RG5,BLKSIZ          STORE LENGTH OF DATA RECORD          02160000
         B     FRSTUPDT                                                 02180000
*********************************************************************** 02200000
*                                                                       02220000
*                                THE UPDAT ROUTINE WILL BUMP THE        02240000
*                             TTI IN THE BLKREF FIELD BY ADDING ONE     02260000
*                             TO THE  I  UNTIL A NO RECORD FOUND        02280000
*                             CONDITION IS RETURNED FROM READ           02300000
*                                                                       02320000
*********************************************************************** 02340000
UPDAT00  DS    0H                                                       02360000
         L     RG2,IEHMVV30             FROM DCB                        02380000
         TM    RECFM(RG2),X'C0'   TEST FOR UNDEFINED RCD FRMT      6429 02386017
         BO    *+12               RECORD FORMAT IS 'U' TYPE        6429 02392017
         TM    RECFM(RG2),FIXED         FORMAT= F ?                     02400000
         BO    CONT1                                                    02420000
         LH    RG8,TTIR     LOAD TT FROM BLKREF AND ADD                 02440000
         LA    RG8,1(0,RG8)         ONE TO IT STORE UPDATED TT BACK     02460000
         STH   RG8,TTIR             IN BLKREF  RESET IREC TO ZERO       02480000
FRSTUPDT SR    RG8,RG8                                                  02500000
         STH   RG8,IREC                SET RECORD NUMBER TO ZERO        02520000
CONT1    DS    0H                                                       02540000
         TM    IEHMVV20+1,LODE          IS THIS A LOAD SITUATION        02560000
         BO    FIRSTON        YES,TURN ON FSTR0SW                 19030 02580019
         L     RG2,IEHMVV30             FROM DCB                        02600000
         TM    RECFM(RG2),X'C0'   TEST FOR UNDEFINED RCD FRMT      6429 02606017
         BO    *+12               RECORD FORMAT IS 'U' TYPE        6429 02612017
         TM    RECFM(RG2),FIXED                                         02620000
         BO    READ1                                                    02640000
         TM    RECFM(RG2),X'48'  IS RECFM VS                      19030 02646019
         BO    VREPROC        YES,GO PROCESS VS                   19030 02652019
         L     RG8,TTIR                 SET UP TO READ R ZERO RECORDS   02660000
         ST    RG8,BLKREF              OF NEXT  TRACK                   02680000
         L     RG2,IEHMVV30             ADDR OF FROM DCB                02700000
         LA    RG3,INDECB                                               02720000
         SR    RG4,RG4                                                  02740000
         LA    RG5,CCHH                INPUT AREA FOR R ZERO RECORD     02760000
         READ  (3),DIF,(2),(5),8,(4),BLKREF,MF=E                        02780000
         BAL   RET14,CHLIOER     CHECK FOR I/O ERROR ON LABELS    UL0H  02790017
         WAIT  1,ECB=INDECB            WAIT FOR COMPLETION OF READ      02800000
         CLI   EXCD01,DONE              IS OPERATION COMPLETE           02820000
         BNE   ARWEDONE                                                 02840000
         SR    RG6,RG6                                                  02860000
         IC    RG6,R0                  PLACE RECORD COUNT IN REG 6      02880000
UPDAT01  DS    0H                                                       02900000
         L     RG2,IEHMVV30                                             02920000
         TM    RECFM(RG2),VARBL   RECORD FORMAT U OR V?          A21645 02940018
         BZ    READ1              NO,MUST BE FIXED?              A21645 02960018
         SR    RG8,RG8                                                  02980000
         IC    RG8,IREC            PICK UP OLD RECORD NUMBER            03000000
         LA    RG8,1(0,RG8)        ADD ONE TO RECORD NUMBER             03020000
         STC   RG8,IREC            STORE CURRENT RECORD NUMBER          03040000
READ1    MVC   BLKREF(4),TTIR                                           03060000
READ     LA    RG3,INDECB     ADDRESS OF DECB                           03080000
         L     RG2,IEHMVV30        ADDRESS OF DCB                       03100000
         L     RG4,KEYADR          ADDRESS OF KEY BUFFER                03120000
         L     RG5,BUFADR          ADDRESS OF DATA BUFFER               03140000
         TM    IEHMVV20+1,LODE          IS THIS A LOAD SITUATION        03160000
         BC    1,LOAD              SURE IS                              03180000
         TM    RECFM(RG2),X'C0'   TEST FOR UNDEFINED RCD FRMT      6429 03186017
         BO    *+12               RECORD FORMAT IS 'U' TYPE        6429 03192017
         TM    RECFM(RG2),FIXED                                         03200000
         BO    CONT2                                                    03220000
         LTR   RG6,RG6                 HAVE ALL RECORDS BEEN READ       03240000
         BZ    FRMT01                  YES SIR                          03260000
CONT2    DS    0H                                                       03280000
         READ  (3),DIF,(2),(5),'S',(4),BLKREF,MF=E                      03300000
         BAL   RET14,CHLIOER     CHECK FOR I/O ERROR ON LABELS    UL0H  03310017
         WAIT  1,ECB=INDECB                                             03320000
*                                  TEST EXCEPTION CONDITION BITS        03340000
         TM    RECFM(RG2),X'C0'   TEST FOR UNDEFINED RCD FRMT      6429 03346017
         BO    CONT3              RECFM  IS  U  TYPE             A21645 03353018
         TM    RECFM(RG2),FIXED                                         03360000
         BZ    CONT3                                                    03380000
         L     RG6,TTIR                 ADD ONE TO RELATIVE BLOCK       03400000
         A     RG6,ONEO                 ADDRESS.                        03420000
         ST    RG6,TTIR                                                 03440000
         B     CONT4                                                    03460000
FIRSTON  OI    FSTR0SW,X'01'  TURN ON FSTR0SW TO INDCT FIRSTIN    19030 03464019
         B     LOAD           GO LOAD DATA SET                    19030 03468019
*                                                                       03472019
*                                                                       03476019
CONT3    DS    0H                                                       03480000
         BCTR  RG6,0            SUBT 1 FROM RECORD COUNT                03500000
CONT4    DS    0H                                                       03520000
         CLI   EXCD01,GOOD      IF EXCD IS ZERO WRITE THE RECORD READ   03540000
         BE    FRMT02                                                   03560000
ARWEDONE TM    EXCD01,UPTTI            THIS SHOULD NEVER HAPPEN         03580000
         BO    UNEXPLND                PRINT UNEXPLAINED ERROR MSG      03600000
*                                FORMAT BEFOR UPDATING TTI              03620000
         TM    EXCD01,UGTLN     IF EXCD IS 40                           03640000
         BO    LENERR                 WRITE ERROR MSG,                  03660000
*                                                                       03680000
         TM    EXCD01,EOFM      IF EXCD IS 04 CHECK FORMAT,IF FORMAT U  03700000
         BO    FRMTO3                                            A27588 03720019
*                                MESSAGE.                               03740000
         TM    EXCD01,IOER      IF EXCD IS 08 A I/O ERROR HAS BEEN      03760000
         BO    PRMERR            ENCOUNTERED                            03780000
*                                WRITE ERROR MSG                        03800000
         TM    EXCD01,INVL1     IF EXCD IS 20,01,21 PRINT INVALID       03820000
         BC    5,INVALD          RETURN MSG                             03840000
*                                                                       03860000
         TM    EXCD01,UNEX      IF EXCD IS 02 PRINT ERROR MSG           03880000
         BO    UNEXPLND                                                 03900000
         TM    EXCD01,TEST2     IF EXCD IS 10 TEST EXCEPTION CODE       03920000
         BO    TSTX2             BYTE 2                                 03940000
         B     UNCORECT           GO PRINT MESSAGE               A27313 03960019
TSTX2    TM    EXCD02,TEST2     IF  EXCD02 IS 10 GO TO END OF JOB       03980000
         BO    FINISHED                                                 04000000
         B     INVALD           IF  EXCD02 IS OTHER THAN 10 PRINT       04020000
*********************************************************************** 04040000
*                                                                       04060000
*                            WRITIT WILL WRITE THE RECORD IN THE NEW    04080000
*                              DATASET CHECK RETURN CODES AND CHECK FOR 04100000
*                              ERRORS AFTER WRITING GOOD RECORD WILL    04120000
*                              GO TO UPDATE ROUTINE                     04140000
*                                                                       04160000
*********************************************************************** 04180000
WRIT01   L     RG2,IEHMVV31             ADDR OF 'TO'DCB                 04200000
         LA    RG2,0(0,RG2)        CLEAR HIGH ORDER BYTE                04220000
         TM    IEHMVV20+1,UNLODE        IS THIS AN UNLOAD SITUATION     04240000
         BC    1,UNLOAD            SURE IS                              04260000
         TM    RECFM(RG2),X'48'    IS RECFM VS                    19030 04266019
         BO    LNTHCHK             YES, CHECK FOR ZERO LENGTH     19030 04272019
         CLI   16(RG2),X'00'      TEST FOR KEY                   A50933 04274022
         BE    WRIT02             IF NO KEY, WRITE               A50933 04276022
         CLI   INPUT,X'FF'        CHECK FOR DUMMY RECORD         A50933 04278022
         BE    WRTDUMMY           IF SO, WRITE A DUMMY RECORD    A50933 04278422
WRIT02   WRITE DECBOUT,SF,(2),INPUT,(5),MF=E                            04280000
         BR    RG9                                                      04300000
WRTDUMMY WRITE DECBOUT,SD,(2),INPUT,(5),MF=E                     A50933 04310022
         BR    RG9                                               A50933 04312022
*                                                                       04320000
*                                                                       04340000
GETLGNTH L     RG2,IEHMVV30             ADDR OF FROM DCB                04360000
*                                                                       04380000
         SR    RG5,RG5            SUBTRACT RESIDUAL COUNT FROM   A32036 04400020
         AH    RG5,BLKLH(0,RG2)   CSW FROM BLKSIZE TO COMPUTE    A32036 04420020
*                                 THE LENGTH                     A32036 04440020
         L     RG3,IOBBD(0,RG2)        *OF THE RECORD READ              04460000
         SH    RG5,CSWCT(0,RG3)                                  A27588 04480019
         L     RG2,IEHMVV31             ADDR OF 'TO' DCB                04500000
         LA    RG2,0(0,RG2)             CLEAR HIGH ORDER BYTE           04520000
         BR    RG9                      BRANCH TO WRITE ROUTINE         04540000
*                                                                       04560000
FRMT02   L     RG2,IEHMVV30             ADDR OF 'FROM' DCB              04580000
         TM    RECFM(RG2),UNKNW    IS THIS A FORMAT U DATASET           04600000
         BO    GETL                  YES GO TO COMPUTE LENGTH           04620000
         LH    RG5,BLKLH(0,RG2)        LOAD BLOCK SIZE IN REG 5         04640000
         BAL   RG9,WRIT01                                               04660000
         B     BACK01(15)                                               04680000
         SPACE 3                                                        04700000
WRITEOK  LH    RG5,LLI                 LOAD LENGTH OF UNLOAD REC A38749 04720021
         SR    RG1,RG1                                           A38749 04730021
         IC    RG1,KEYLGN+1            GET KEYLENGTH           @ZA01710 04740002
         LA    RG1,8(RG1)              AND ADD 8 FOR MBBCCHHR    A38749 04750021
         SR    RG5,RG1                 SUBTRACT GIVES INIT BLKSZ A38749 04760021
         TM    LLI+2,CAPREC             IS THIS A CAPACITY RECORD       04780000
         BO    WRIT03                  IT IS FOR A FACT                 04800000
         BAL   RG9,WRIT01     NO PRINT ERROR MESSAGE                    04820000
         B     BACK01(15)                                               04840000
GETL     BAL   RG9,GETLGNTH                                             04860000
         BAL   RG9,WRIT01                                               04880000
         B     BACK01(15)                                               04900000
BACK01   B     CHEK01              TEST ROUTINES TO TEST REG 15 RETURN  04920000
         B     TRKFUL                                                   04940000
         B     CHEK01                                                   04960000
         EX    0,*                   CODES FROM WRITE CREATE            04980000
FRMT01   L     RG2,IEHMVV30             ADDRESS OF 'FROM' DCB           05000000
         TM    RECFM(RG2),VARBL         IS FORMAT V OR U                05020000
         BO    WRIT03                    YES                            05040000
         B     UPDAT00                   NO MUST BE F                   05060000
*                                                                       05080000
*                                                                       05100000
TRKFUL   TM    RECFM(RG2),VARBL         IS FORMAT V OR U                05120000
         BO    UNEXPLND                 IF V OR U FORMAT,IT INDICATES-- 05140000
*                                       NO ROOM ON CURRENT TRACK TO     05160000
*                                       WRITE BLOCK; USER MUSTWRITE CAP 05180000
*                                       ACITY RECORD BEFORE REISSUING   05200000
*                                       THIS REQUEST                    05220000
*                                                                       05240000
         B     CHEK01                   IF F FORMAT, IT INDICATES--     05260000
*                                       BLOCK WILL BE WRITTEN - THE CUR 05280000
*                                       RENT TRACK WILL THEN BE FULL -  05300000
*                                       THEREFORE, BRANCH TO CHECK RTN  05320000
*                                                                       05340000
*********************************************************************** 05360000
*                                                                       05380000
*                                  THIS ROUTINE FOR FORMATS V AND U     05400000
*                               WRITES A CAPACITY RECORD IN R 0  AND    05420000
*                               THEN GOES TO UPDATE TTI TO NEXT TRACK   05440000
*                                                                       05460000
*********************************************************************** 05480000
WRIT03   L     RG2,IEHMVV31             ADDR OF 'TO' DCB                05500000
         BCTR  RG6,0                   SUBTRACT ONE                     05520000
         TM    IEHMVV20+1,UNLODE        IS THIS AN UNLOAD SITUATION     05540000
         BO    UNLD01                  YES IT IS                        05560000
         TM    RECFM(RG2),X'48'    IS THE RECFM VS                19030 05570019
         BO    VSR0TST             YES                            19030 05580019
R0WRITE  WRITE DECBOUT,SZ,(RG2),MF=E   WRITE CAPACITY RECORD      19030 05590019
         CHECK DECBOUT                                                  05600000
         TM    RECFM(RG2),X'48'    IS RECFM VS                    19030 05606019
         BO    UPDATWRT            YES,GO UPDATE NEXT WRITE PTR   19030 05612019
         B     UPDAT00                                                  05620000
*                                  THIS IS THE CHECK ROUTINE FOR        05640000
*                               WRITE A RECORD AND RETURNS TO UPDAT01   05660000
CHEK01   CHECK DECBOUT                                                  05680000
         B     UPDAT01                                                  05700000
FRMTO3   L     RG2,IEHMVV30            ADDRESS OF THE FROM DCB   A27588 05730019
         TM    RECFM(RG2),UNKNW        IS RECFM UNDEFINED?       A27588 05760019
         BO    UNDEF                   YES -                     A27588 05790019
         LH    RG5,BLKLH(0,RG2)        PUT BLKSIZE IN REG2       A27588 05820019
         B     WRTEOF                                            A27588 05850019
UNDEF    BAL   RG9,GETLGNTH            GO CALCULATE BLK LENGTH   A27588 05880019
         B     WRTEOF                                            A27588 05910019
*********************************************************************** 05940000
*                                                                       05960000
*                                  THIS ROUTINES WRITES AN EOF MARK     05980000
*                               RESETS  ERROR FLAGS IN  DCB AND RESET   06000000
*                               THE UNAVAILABLE SWITCH IN THE IOB       06020000
*                                                                       06040000
*********************************************************************** 06060000
WRTEOF   TM    RECFM(RG2),FIXED         IS REC. FRMT. FIXED      A44346 06070021
         BO    FINISHED                 STOP COPYING             A44346 06080021
         L     RG2,IEHMVV31             ADDRESS OF TO-DCB        A44346 06090021
         MVC   SYNAD(3,RG2),SYNEOF      MOVE ADDR OF EOFRET IN DCB      06100000
         LH    RG8,BLKLH(0,RG2)         SAVE BLOCKSIZE FROM DCB         06120000
         STH   RG8,BLKOUT                                               06140000
         SR    RG5,RG5                                           A28895 06160019
         STH   RG5,BLKLH(0,RG2)   SET BLKSIZE TO ZERO.           A28895 06180019
         BAL   RG9,WRIT01                                               06200000
*                                                                       06240000
EOFRET   STM   14,4,12(13)              SAVE REGISTERS                  06260000
         L     RG2,IEHMVV31             LOAD ADDR OF 'TO' DCB           06280000
         MVI   IFLGS(RG2),GOOD          RESET I/O ERR FLAGS             06300000
         MVC   SYNAD(3,RG2),SYNBSM      RESTORE ORIGINAL SYNAD ROUTINE  06360000
         LH    RG8,BLKOUT               LOAD DCB BLOCKSIZE              06380000
         STH   RG8,BLKLH(0,RG2)         RESTORE BLOCKSIZE IN DCB        06400000
         B     UPDAT01                                                  06420000
*                                                                       06440000
PRMERR   B     INPUTERR                                                 06460000
*                                                                       06480000
INPUTERR BAL   RG9,CLEAR           CLEAR PRINT BUFFER                   06500000
         L     RG1,IEHMVV21        ADDR OF FROM DATA SET NAME           06520000
         L     RG8,AM04                 LOAD MESSAGE ADDRESS            06540000
         IC    RG7,0(RG8)                                               06560000
         L     RG8,0(RG8)                                               06580000
         B     MESG01                   I/O ERROR ON INPUT              06600000
NOTUNLD  BAL   RG9,CLEAR           CLEAR PRINT BUFFER                   06620000
         L     RG1,IEHMVV21        ADDR OF FROM DATA SET NAME           06640000
         L     RG8,AM05                 LOAD ADDRESS OF MESSAGE         06660000
         IC    RG7,0(RG8)                                               06680000
         L     RG8,0(RG8)                                               06700000
         B     MESG02                   NOT AN UNLOADED DATA SET        06720000
OUTPTERR BAL   RG9,CLEAR      CLEAR PRINT BUFFER                        06740000
         L     RG1,IEHMVV21+4      ADDR OF 'TO' DATA SET NAME           06760000
         L     RG8,AM06                 LOAD MESSAGE ADDRESS            06780000
         IC    RG7,0(RG8)                                               06800000
         L     RG8,0(RG8)                                               06820000
         B     MESG01                                                   06840000
*                                                                       06860000
CLEAR    MVI   0(12),BLANK              CLEAR PRINT BUFFER              06880000
         MVC   1(120,12),0(12)                                          06900000
         BR    RG9                                                      06920000
*                                                                       06940000
MESG01   EX    7,MOVER                  MOVE MESSAGE TO BUFFER          06960000
         MVC   50(44,12),0(1)           MOVE DATASET NAME TO BUFFER     06980000
         B     MESG03                                                   07000000
UNCORMSG EX    RG7,MOVER     MOVE MSG TO BUFFER                  A27313 07005019
         MVC   62(44,BASE12),0(RG1) MOVE DATA SET NAME TO BUFFER A27313 07010019
         B     MESG03             GO PRINT MESSAGE               A27313 07015019
MESG02   EX    7,MOVER                  MOVE MESSAGE TO BUFFER          07020000
         MVC   18(44,12),0(1)           MOVE DATASET NAME TO BUFFER     07040000
MESG03   LR    RG1,RG3                 SAVE REG 3                       07060000
         LR    RG3,BASE12                                               07080000
         LINK  EP=IEHMVESU                                              07100000
         LR    RG3,RG1                 RESTORE REG 3                    07120000
         B     ABORT                                                    07140000
*                                                                       07160000
UNCORECT BAL   RG9,CLEAR          CLEAR PRINT BUFFER             A27313 07162019
         L     RG8,AM08           LOAD ADDRESS OF MSG            A27313 07164019
         IC    RG7,0(RG8)         INSERT LENGTH                  A27313 07166019
         L     RG8,0(RG8)         CLEAR OUT HIGH ORDER BYTE      A27313 07168019
         L     RG1,IEHMVV21       ADDR OF PRINT BUFFER           A27313 07170019
         B     UNCORMSG      GO SET UP MSG                       A27313 07172019
*                                                                       07180000
SYNRET   B     OUTPTERR                 GO TO OUTPUT ERROR ROUTINE      07200000
*                                                                       07220000
INVALD   EX    0,*                      LOOP DUMP                       07240000
*                                                                       07260000
*                                                                       07280000
UNEXPLND BAL   RG9,CLEAR                WRITE MESSAGE                   07300000
         L     RG8,AM03                 LOAD MESSAGE START ADDR         07320000
         IC    RG7,0(RG8)                                               07340000
         L     RG8,0(RG8)                                               07360000
        L     RG1,IEHMVV21            ADDR OF PRINT BUFFER              07380000
         B     MESG01                   UNEXPLAINED ERROR DURING READ   07400000
*                                                                       07420000
*                                                                       07440000
ABORT    OI    IEHMVV20+2,MIDABORT      SET BIT AND TERMINATE           07460000
         B     GETOUT                                                   07480000
*                                                                       07500000
MOVER    MVC   1(1,12),0(RG8)                                           07520000
*                                                                       07540000
*                                                                       07560000
LENERR   BAL   RG9,CLEAR                CLEAR PRINT BUFFER              07580000
         L     RG8,AM02                 LOAD ADDRESS OF MESSAGE         07600000
         IC    RG7,0(RG8)                                               07620000
         L     RG8,0(RG8)                                               07640000
        L     RG1,IEHMVV21            ADDR OF PRINT BUFFER              07660000
         B     MESG01                   WRONG LENGTH RECORD             07680000
LASTR    L     RG2,IEHMVV31  ADDR OF TO DCB                       19030 07680919
         TM    RECFM(RG2),X'48'  IS RECFM VS                      19030 07681819
         BNO   GETOUT        NO - GO TO FREE CORE                 19030 07682719
         TM    IEHMVV20+1,LODE  IS THIS A LOAD SITUATION          19030 07683619
         BZ    GETOUT        NO - GO TO FREE CORE                 19030 07684519
*                                                                       07685419
*    TEST TO SEE IF TRACK IS FULL OF DATA - IF SO, DATA MGMT      19030 07686319
*    WILL HAVE ADVANCED WRTTR TO NEXT TRACK AND WILL HAVE         19030 07687219
*    WRITTEN THE R0 ON PRIOR TRACK                                19030 07688119
*                                                                       07689019
         CLI   LSTWRTI,X'01' WAS LAST WRITE A DATA RECORD         19030 07689919
         BNE   FINAL         NO - GO WRITE LAST R0                19030 07690819
         CLI   WRTTR+2,X'01' IS NEXT WRITE SET FOR R1             19030 07691719
         BC    8,LOADEND     YES - BYPASS R0 WRITE                19030 07692619
FINAL    BAL   RG9,WRTR01    WRITE LAST R0 FOR LOAD               19030 07693519
LOADEND  TM    SWITCH,X'08'  IS THIS END OF EXTENT                19030 07694419
         BO    GETOUT        YES                                  19030 07695319
         BAL   RG9,WRTR01    LOOP TO WRITE R0 RECORDS             19030 07696219
         B     LOADEND       TO END OF EXTENT                     19030 07697119
*                                                                       07698019
FINISHED TM    IEHMVV20+1,UNLODE        IS THIS AN UNLOAD SITUATION     07700000
         BZ    LASTR         NOT UNLOAD SITUATION                 19030 07720019
         LA    RG0,10                   YES, SET UP PARAMETER           07740000
         L     LINK15,BWRITE            ADDR OF BWRITE ROUTINE          07760000
         BALR  RET14,LINK15             LINK TO MODULE IEHMVERM         07780000
         B     *+4(15)                  RESULTING CONDITION CODE        07800000
         B     GETOUT                   DETERMINES WHICH BRANCH         07820000
         B     OUTPTERR                 IS TAKEN                        07840000
GETOUT   ST    RG11,IEHMVV82+16        SAVE AREA-ADDR. FOR ESN @ZA01249 07850002
         MVI   IEHMVV82+16,X'80' INDICATION FOR ESN              A41754 07861221
         MVC   IEHMVV82+20(4),GOTEN SAVE LENGTH OF AREA          A41754 07861621
*  IEHMVESN WILL FREEMAIN IEHMVESL'S WORKAREA AFTER CLOSE        A41754 07862021
*  BECAUSE THE CLOSEROUTINES USE THE DECB                        A41754 07864021
         IEHPOST (14,1),T                                               07920000
         XCTL  (2,12),EP=IEHMVESN                                       07940000
*                                                                       07960000
*THIS ROUTINE WILL SET UP THE OUTPUT TO CONFORM TO THE BWRITE FORMAT.   07980000
*PRECEDING EVERY RECORD WILL BE ELEVEN BYTES OF DATA,THE FIRST THREE TO 08000000
*BE USED BY BWRITE AND THE NEXT EIGHT BYTES TO BE USED BY BDAM LOAD ROU 08020000
*TINE.                                                                  08040000
*THESE ELEVEN BYTES BREAK DOWN INTO:                                    08060000
*      LL= LENGTH OF RECORD (BLKSIZE+KEY+8FOR MBBCCHHR)                 08080000
*       I= INDICATOR FOR UNLOAD PDS AND IN BDAM WILL EQUAL ZERO         08100000
*MBBCCHHR= USED WHEN LOADING BY ABSOLUTE DISK ADDRESS                   08120000
UNLD01   OI    LLI+2,X'02'                                              08140000
         LA    RG5,8                   CAPACITY RECORD SHOULD BE READ   08160000
UNLOAD   DS    0H                                                       08180000
         LR    RG3,RG5        RG5= BLKSIZE                              08200000
         AH    RG3,KEYLGN     ADD KEY LENGTH IF ANY                     08220000
         LA    RG3,08(0,RG3)  MBBCCHHR= 8 BYTES                         08240000
         STH   RG3,LLI        STORE LENGTH IN LL BYTES                  08260000
         MVC   MBBCCHHR(8),BLKREF  USED WHEN LOADING BY ABSOLUTE DISK A 08280000
         LA    RG1,LLI        PASS BWRITE ADDRESS OF INPUT              08300000
         SR    RG0,RG0        OTHER THAN FIRST TIME SWITCH              08320000
         L     LINK15,BWRITE  ADDRESS OF BWRITE ROUTINE                 08340000
         BALR  RET14,LINK15   GO TO BWRITE ROUTINE                      08360000
         B     *+4(LINK15)    CHECK RETURN CODE FROM BWRITE             08380000
         B     GDRETRN                                                  08400000
         B     OUTPTERR       I/O ERROR DETECTED                        08420000
*                                                                       08440000
GDRETRN  SR RG8,RG8                                                     08460000
         STC   RG8,LLI+2               RESET R0 INDICATOR               08480000
         L     RG2,IEHMVV30             FROM DCB.                       08500000
         TM    RECFM(RG2),X'C0'   TEST FOR UNDEFINED RCD FRMT      6429 08506017
         BO    *+12               RECORD FORMAT IS 'U' TYPE        6429 08512017
         TM    RECFM(RG2),FIXED                                         08520000
         BO    READ1                                                    08540000
         TM    RECFM(RG2),X'48'    IS RECFM VS                    19030 08546019
         BO    TESTRD        YES                                  19030 08552019
         LTR   RG6,RG6                 HAVE ALL RECORDS BEEN READ       08560000
         BP    UPDAT01                  NO                              08580000
         BZ    WRIT03                                                   08600000
         BM    UPDAT00                                                  08620000
VREPROC  L     RG2,IEHMVV30        ADDR OF FROM DCB               19030 08620219
         MVC   SYNAD(3,RG2),SYNVRE1 PUT INPUT SYNAD ADDR          19030 08620419
*                                  INTO FROM DCB                  19030 08620619
         L     RG2,IEHMVV31       ADDR OF TO DCB                  19030 08620819
         MVC   SYNAD(3,RG2),SYNBSM  PUT OUTPUT SYNAD ADDR         19030 08621019
*                                  INTO 'TO' DCB                  19030 08621219
R0READ   LA    RG3,INDECB         DECB ADDRESS                    19030 08621419
         L     RG2,IEHMVV30       FROM DCB                        19030 08621619
         L     RG4,KEYADR    LOAD ADDR OF KEY BUFFER              19030 08621819
         L     RG5,BUFADR         BUFFER ADDR                     19030 08622019
         READ  (RG3),DIRU,(RG2),(RG5),8,0,TTIR,NXTRD,MF=E         19030 08622219
         CHECK (RG3)                                              19030 08622419
         OC    EXCD01(1),EXCD01   WAS THE READ SUCCESSFULL        19030 08622619
         BC    4,INPUTCHK         NO, GO CHECK INDICATOR BITS     19030 08622819
         B     CHKR0              GO CHECH FOR UNLOAD             19030 08623019
*                                                                       08623219
TTRUPDT  MVC   TTIR(3),NXTRD      UPDATES TTIR                    19030 08623419
VREREAD1 OC    IREC(1),IREC       R0 RECORD                       19030 08623619
         BC    8,R0READ      YES                                  19030 08623819
         LA    RG3,INDECB         DECB ADDR                       19030 08624019
         L     RG2,IEHMVV30        LOAD ADDR OF FROM DCB          19030 08624219
         L     RG4,KEYADR          LOAD ADDR OF KEY BUFFER        19030 08624419
         L     RG5,BUFADR          LOAD ADDR OF DATA BUFFER       19030 08624619
*                                                                 19030 08624819
*        READ DATA RECORD                                         19030 08625019
*                                                                 19030 08625219
         READ  (RG3),DIRU,(RG2),(RG5),'S',(RG4),TTIR,NXTRD,MF=E   19030 08625419
         BAL   RET14,CHLIOER       CHECK FOR I/O ERROR ON U/L     19030 08625619
         CHECK (RG3)                                              19030 08625819
         OC    EXCD01(1),EXCD01   WAS THE READ SUCCESSFULL        19030 08626019
         BC    4,INPUTCHK         NO, GO CHECK INDICATOR BITS     19030 08626219
CHKUNLD1 TM    IEHMVV20+1,UNLODE   CHECK FOR UNLOAD               19030 08626419
         BNO   CHKTT2              NOT UNLOAD-CHECK TT            19030 08626619
         MVC   BLKREF(4),TTIR      YES UNLOAD-PUT TTR IN BLKREF   19030 08626819
         L     RG5,BUFADR         GET ADDR OF DATA PORTION OF RECD19030 08627019
         MVC   RECSIZE(2),0(RG5)  MOVE RECORD SIZE TO RECORD SAVE 19030 08627219
         LH    RG5,RECSIZE        LOAD SIZE OF RECORD JUST READ   19030 08627419
         B     UNLOAD              GO TO UNLOAD DATA RECORD       19030 08627619
*                                                                       08627819
CHKR0    TM    IEHMVV20+1,UNLODE  IS THIS AN UNLOAD SITUATION     19030 08628019
         BO    R0SETTR            YES, SET UP FOR UNLOAD OF R0 RCD19030 08628219
         CLI   4(RG5),X'00'  ANY RCDS ON THIS TRK                 19030 08628419
         BE    CHKTT1             NO,                             19030 08628619
         B     TTRUPDT            GO READ DATA RECORD             19030 08628819
*                                                                       08629019
R0SETTR  MVC   BLKREF(4),TTIR     MOVE TTR OF RCD TO BLKREF       19030 08629219
         B     UNLD01             GO UNLOAD R0 RECORD             19030 08629419
*                                                                       08629619
CHKTT1   CLC   TTIR(2),WRTTR       COMPARE READ AND WRITE TT      19030 08629819
         BE    EQUAL         GO TO CHECK RECORD COUNT             19030 08630019
         BAL   RG9,WRTR01    GO TO WRITE R0 RECORD                19030 08630219
         B     CHKTT1        COMPARE TT AGAIN                     19030 08630419
*                                                                       08630619
EQUAL    L     RG5,BUFADR    LOAD DATA BUFFER ADDR                19030 08630819
         CLI   4(RG5),X'00'        DOES TRACK REC CNT = 0         19030 08631019
         BNE   LOADTEST           NO, TEST LOAD CONDITION         19030 08631219
         OC    NXTRD(3),NXTRD     IS THIS THE LAST RECORD OF INPUT19030 08631419
         BC    8,LOADTEST         YES, PRACESS END OF DATA        19030 08631619
         BAL   RG9,WRTR01    GO TO WRITE R0 RECORD                19030 08631819
LOADTEST TM    IEHMVV20+1,LODE     IS THIS A LOAD                 19030 08632019
         BO    LOAD                YES-GO TO LOAD                 19030 08632219
         MVC   TTIR(3),NXTRD       SET TTR TO NEXT RECORD         19030 08632419
EXTNTEND OC    NXTRD(3),NXTRD     CHECK TTR FOR ZEROS             19030 08632619
         BC    4,VREREAD1          IF NOT 0 GO TO READ DATA       19030 08632819
         L     RG2,IEHMVV31        LOAD ADDR OF TO DCB            19030 08633019
         WRITE DECBOUT,SZ,(RG2),MF=E   WRITE R0 RECORD            19030 08633219
         STC   RTCD15,SWITCH      SAVE RETURN CODE                19030 08633419
         CHECK DECBOUT                                            19030 08633619
         TM    SWITCH,X'08'       IS THIS THE END OF EXTENT       19030 08633819
         BNO   EXTNTEND           NO, LOOP TO WRITE R0 RECORDS    19030 08634019
*                                 TO THE END OF THE EXTENT        19030 08634219
         B     GETOUT              GO TO FREEMAIN                 19030 08634419
*                                                                       08634619
CHKTT2   CLC   TTIR(2),WRTTR       COMPARE READ AND WRITE TT      19030 08634819
         BE    WRITEVS             TT EQUAL-GO TO WRITE DATA      19030 08635019
         BAL   RG9,WRTR01          TT NOT EQUAL-WRITE R0          19030 08635219
         B     CHKTT2              GO TO CHECK TT AGAIN           19030 08635419
*                                                                       08635619
*********************************************************************** 08640000
*                                                                       08660000
*THIS ROUTINE WILL RE-LOAD (PERFORM THE MOVE/COPY) AN UNLOADED DATA SET 08680000
*ITS INPUT CAN ONLY BE THAT WHICH WAS PREVIOUSLY UNLOADED.              08700000
*                                                                       08720000
*********************************************************************** 08740000
LOAD     LA    RG1,LLI        ADDRESS OF WHERE RECORD IS TO GO          08760000
         SR    RG0,RG0        OTHER THAN FIRST CALL TO BREAD            08780000
         L     LINK15,BREAD   ADDRESS OF BREAD ROUTINE                  08800000
         BALR  RET14,LINK15   GO TO BREAD(LOAD) ROUTINE                 08820000
         B     *+4(LINK15)    CHECK RETURN CODE FROM BREAD              08840000
         B     GOODREAD                                                 08860000
         B     FINISHED       END OF FILE                               08880000
         B     INPUTERR       I/O ERROR                                 08900000
         B     NOTUNLD        THIS IS NOT AN UNLOADED DATA SET          08920000
GOODREAD MVC   BLKREF(8),MBBCCHHR                                       08940000
         B     WRITEOK                                                  08960000
WRITEVS  L     RG2,IEHMVV31        LOAD ADDR OF TO DCB            19030 08960119
         LA    RG2,0(0,RG2)        CLEAR HIGH ORDER BYTE          19030 08960219
         WRITE DECBOUT,SFR,(RG2),INPUT,,WRTTR,MF=E  WRITE DATA    19030 08960319
         MVI   LSTWRTI,X'01'       SET LAST WRITE SW TO DATA      19030 08960419
         CHECK DECBOUT                                            19030 08960519
         B     LOADTEST            GO TO TEST FOR LOAD            19030 08960619
*                                                                       08960719
WRTR01   L     RG2,IEHMVV31        LOAD ADDR  OF TO DCB           19030 08960819
         WRITE DECBOUT,SZ,(RG2),MF=E  WRITE R0 RECORD             19030 08960919
         STC   RTCD15,SWITCH SAVE RETURN CODE                     19030 08961019
         CHECK DECBOUT                                            19030 08961119
         LH    RG8,WRTTR           LOAD TTR ON NEXT WRITE         19030 08961219
         LA    RG8,1(0,RG8)        ADD ONE TO TT                  19030 08961319
         STH   RG8,WRTTR          STORE TT FOR NEXT WRITE         19030 08961419
         BR    RG9                                                19030 08961519
TESTRD   OC    NXTRD(3),NXTRD      HAVE ALL RCD BEEN READ         19030 08961619
         BC    8,FINISHED  SET CODE FOR END OF UNLOADED DATA SET  19030 08961719
*                          AND GO TO WRAPUP                       19030 08961819
         TM    IEHMVV20+1,LODE     IS THIS A LODE SITUATION       19030 08961919
         BO    LOAD                YES                            19030 08962019
         MVC   TTIR(4),NXTRD       GET TTR OF NEXT RECORD TO READ 19030 08962119
         B     VREREAD1            GO READ NEXT RECORD            19030 08962219
*                                                                       08962319
VSR0TST  CLI   FSTR0SW,X'01'  IS THIS FIRST R0 TO BE PROCESSED    19030 08962419
         BNE   TSTLSWTI       NO,TEST LAST WRITE INDICATOR        19030 08962519
         MVI   FSTR0SW,X'00'  TURN OFF FIRST R0 SWITCH            19030 08962619
         B     LOAD           GO GET NEXT RECORD                  19030 08962719
*                                                                       08962819
TSTLSWTI CLI   LSTWRTI,X'01'  WAS LAST WRITE A DATA RECORD        19030 08962919
         BNE   R0WRITE        NO,GO WRITE R0 RECORD               19030 08963019
         CLI   WRTTR+2,X'01'      IS NEXT WRITE SET FOR R0        19030 08963119
         BNE   R0WRITE            NO, GO WRITE R0 RECORD          19030 08963219
         MVI   LSTWRTI,X'00'  SET LAST WRITE INDICATOR TO R0      19030 08963319
         B     LOAD           CONTINUE LOADING PROCEEDURE         19030 08963419
*                                                                       08963519
UPDATWRT LH    RG8,WRTTR      GET TRACK NUMBER                    19030 08963619
         LA    RG8,1(0,RG8)   ADD ONE TO TRACK COUNT              19030 08963719
         STH   RG8,WRTTR      UPDATE TTR FOR NEXT WRITE           19030 08963819
         MVI   LSTWRTI,X'00'  SET LAST WRITE INDICATOR TO R0      19030 08963919
         B     LOAD           CONTINUE LOADING                    19030 08964019
*                                                                       08964119
LNTHCHK  SR    RG1,RG1            CLEAR REGISTER ONE            PTM3086 08964219
         IC    RG1,KEYLGN+1       GET LENGTH OF KEY BEING USED  PTM3086 08964319
         SR    RG5,RG1            SUBTRACT KEYLENGTH FROM 'LL'    19030 08964519
         LTR   RG5,RG5        IS DATA LENGTH ZREO                 19030 08964619
         BC    8,LASTEOF      YES,WRITE IMBEDDED EOF              19030 08964719
         AR    RG5,RG1        RESTORE RECORD SIZE FOR WRITE DATA  19030 08964819
         B     WRITEVS        GO WRITE VS DATA RECORD             19030 08964919
SYNVRE1  DC    AL3(SYNREAD)        SYNAD RTN FOR VRE INPUT        19030 08965019
*        THIS IS THE INPUT SYNAD ROUTINE FOR VS RECORDS.THE CODE  19030 08965119
*        CHECKS FOR ERRORS AFTER THE READ CHECK IS ISSUED         19030 08965219
SYNREAD  BR    RET14              RETURN TO CHECK ROUTINE         19030 08965319
INPUTCHK TM    EXCD01,X'04'       IS THIS END OF FILE             19030 08965419
         BO    EOFCHEK            YES, CHECK FOR IMBEDDEED EOF    19030 08965519
         TM    EXCD01,X'08'       DID AN I/O ERROR OCCUR          19030 08965619
         BO    INPUTERR           YES PRINT MSG                   19030 08965719
         TM    EXCD01,X'80'       WAS THE RECORD FOUND            19030 08965819
         BO    UNEXPLND           NO, PRINT MSG AND ABORT         19030 08965919
         TM    EXCD01,X'40'       IS THIS A RECORD LENGTH CHECK   19030 08966019
         BO    LENERR             YES, PRINT MSG                  19030 08966119
         B     UNCORECT      AN UNCORRECTABLE ERROR OCCURED       19030 08966219
*                                                                       08966319
EOFCHEK  DS    0H                 THIS ROUTIN IS ENTERED WHEN     19030 08966419
*                                 AN EOF MARK IS READ ON THE      19030 08966519
*                   INPUT DATA SET.-THERE IS A POSSIBILITY OF     19030 08966619
*                   THERE BEING AN IMBEDDED END OF FILE WITHIN    19030 08966719
*                   THE DATA SET.- THE ONLY WAY OF KNOWING IF IT  19030 08966819
*                   IS AN IMBEDDED EOF OR THE ACTUAL END OF THE   19030 08966919
*                   DATA SET IS BY TESTING THE NEXT READ ADDRESS  19030 08967019
*                   FOR A TTR OF ZERO.-THE TTR OF ZERO'S IS AN    19030 08967119
*                   INDICATOR FROM DATA MANAGMENT THAT THE LAST   19030 08967219
*                   RECORD HAS BEEN READ.-IF THE TTR IS NOT ZERO  19030 08967319
*                   THEN A ZERO LENGTH RECORD MUST BE WRITTEN TO  19030 08967419
*                   THE OUTPUT DATA SET TO MAKE AN EOF MARK       19030 08967519
         TM    IEHMVV20+1,UNLODE  IS THIS A UNLOAD SITUATION    PTM3086 08967619
         BO    SETZERO            YES, SET UNLOAD RCD LNTH TO 0 PTM3086 08967719
         OC    NXTRD(3),NXTRD     IS THIS THE LAST RECORD       PTM3086 08967819
         BC    8,TESTTRK         YES, GO SEE IF TRKS ARE EQUAL  PTM3086 08967919
TRKCMPR  CLC   TTIR(2),WRTTR      ARE TR'S EQUAL                  19030 08968219
         BE    LASTEOF            YES, GO WRITE EOF               19030 08968319
         BAL   RG9,WRTR01         WRITE R0 FOR LAST TRK           19030 08968419
         B     TRKCMPR            GO COMPARE TRKS                 19030 08968519
LASTEOF  OC    KEYLGN(2),KEYLGN   IS KEYLENGTH ZERO             PTM3086 08968619
         BNZ   SETLNZRO           NO, SET DATA LNTH TO ZERO     PTM3086 08968719
         L     RG2,KEYADR         GET ADDRESS OF KEY            PTM3086 08968819
         XC    0(3,RG2),0(RG2)    CLEAR KEY AND RECORD LNTH     PTM3086 08968919
         L     RG2,IEHMVV31       ADDR OF TO DCB                PTM3086 08969019
         OI    KEY(RG2),X'01'     SET KEY TO ONE                PTM3086 08969119
ZROLNWRT L     RG2,IEHMVV31        ADDR OF 'TO' DCB             PTM3086 08969219
         WRITE DECBOUT,SFR,(RG2),INPUT,,WRTTR,MF=E ZERO LEN REC PTM3086 08969319
         CHECK DECBOUT                                          PTM3086 08969419
         OI    LSTWRTI,X'01'      SET LST WRT INDCTR TO DATA    PTM3086 08969519
         MVC   KEY(1,RG2),KEYLGN+1  RESET KEY LENGTH IN DCB     PTM3086 08969619
         TM    IEHMVV20+1,LODE     IS THIS A LOAD SITUATION     PTM3086 08969719
         BO    LOAD               YES,GO LOAD NEXT RCD          PTM3086 08969819
         TM    FSTR0SW+1,X'01'     IS LAST EOF WRITTEN          PTM3086 08969919
         BO    LSTWRT              YES TEST FOR LAST R0 WRITE   PTM3086 08970019
         CLI   NXTRD+2,X'00'      IS NEXT READ A R0             PTM3086 08970119
         BNE   LOADTEST           GO PROCESS NEXT RECORD        PTM3086 08970219
GOWRITSZ BAL   RG9,WRTR01         GO WRITE R0                   PTM3086 08970319
         OI    LSTWRTI,X'00'      INDICATE LAST WRITE WAS R0    PTM3086 08970419
         B     LOADTEST           GO PROCESS NEXT RECORD        PTM3086 08970519
SETLNZRO L     RG2,BUFADR         GET ADDRESS OF DATA BUFFER    PTM3086 08970619
         XC    0(2,RG2),0(RG2)    SET DATA LENGTH TO ZERO       PTM3086 08970719
         B     ZROLNWRT           GO WRITE ZERO LNTH RECORD     PTM3086 08970819
TESTTRK  CLC   TTIR(2),WRTTR      ARE THE TRKS EQUAL            PTM3086 08970919
         BE    SETLAST            YES, PROCESS LAST RECORD      PTM3086 08971019
         BAL   RG9,WRTR01         GO WRITE R0 FOR LAST TRK      PTM3086 08971119
         B     TESTTRK            CHECK TRACK EQUALITY          PTM3086 08971219
SETLAST  OI    FSTR0SW+1,X'01'    INDICATE RETURN TO LSTWRT     PTM3086 08971319
         B     LASTEOF            GO WRITE LAST LAST EOF        PTM3086 08971419
         B     LASTEOF             GO WRITE LAST ZERO LNTH RCD    19030 08972119
*                                                                       08972219
LSTWRT   CLI   WRTTR+2,X'01'      IS NEXT WRITE AN R0             19030 08972319
         BE    GETOUT             YES,DATA MNGMNT WROTE R0        19030 08972419
         L     RG2,IEHMVV31       ADDR OF 'TO' DCB                19030 08972519
         WRITE DECBOUT,SZ,(RG2),MF=E  WRITE LAST R0               19030 08972619
         CHECK DECBOUT                                            19030 08972719
         B     GETOUT               WRAPUP                        19030 08972819
*                                                                       08972919
SETZERO  SR    RG5,RG5                                            19030 08973019
         B     UNLOAD                                             19030 08973119
SYNBSM   DC    AL3(SYNRET)                                              08980000
SYNEOF   DC    AL3(EOFRET)                                              09000000
XXITLE   DC    X'03'                                               UL0H 09004017
         DC    AL3(ITLR)                                           UL0H 09008017
ZEROS    DC    F'0'                                                UL0H 09012017
UTL1DEF  DC    CL4'UTL1'                                           UL0H 09016017
BWRITE   DC    A(IEHMVERM)                                              09020000
         EXTRN IEHMVERM                                                 09040000
BREAD    DC    A(IEHMVERK)                                              09060000
         EXTRN IEHMVERK                                                 09080000
         DS    0H                                                       09100000
ONEO     DC    X'00000100'                                              09120000
*                                                                  UL0H 09124017
*              USER   INPUT   TRAILER   LABEL   EXIT   ROUTINE     UL0H 09128017
*                                                                  UL0H 09132017
ITLR     DS    0H                                                  UL0H 09136017
OFFSET1  EQU   ITLR-IEHMVETL                                       UL0H 09140017
         LA    RG3,OFFSET1             SET UP                      UL0H 09144017
         SR    RTCD15,RG3              ADDRESSABILITY              UL0H 09148017
         LR    BASE10,RTCD15           FOR EXIT ROUTINE            UL0H 09152017
         L     RG3,0(RG1)              GET ADDR OF LABEL BUFFER    UL0H 09161017
         LTR   RG3,RG3                 ANY LABELS PRESENT          UL0H 09161217
         BNZ   IOERR                   YES, GO CHK IF I/O ERROR    UL0H 09161417
NOLABEL  DS    0H                                                  UL0H 09161617
         SR    RTCD15,RTCD15           NO LABELS,RETURN CODE ZERO  UL0H 09161817
         BR    RET14                   RETURN TO EOV               UL0H 09162017
*                                                                  UL0H 09162217
IOERR    DS    0H                                                  UL0H 09162417
         TM    8(RG1),X'80'            I/O ERR FLAG ON IN PARAMS   UL0H 09162617
         BC    14,TRKAVAIL             NO, CHECK IF U.L. TRACK     UL0H 09162817
*                                      WAS ALLOCATED FOR LABELS    UL0H 09163017
*                                                                  UL0H 09163217
LABERR   DS    0H                                                  UL0H 09163417
*                                                                  UL0H 09163617
* I/O ERROR ENCOUNTERED READING USER INPUT TRAILER LBLS, GIVE MSG  UL0H 09163817
*                                                                  UL0H 09164017
         OI    IEHMVV74+4,X'FF'   SET LABEL I/O ERROR FLAG         UL0H 09164417
         BR    RET14              RETURN TO EEOV                        09164817
*                                                                  UL0H 09165417
TRKAVAIL DS    0H                                                  UL0H 09165617
         CLI   IEHMVV72+10,X'FF'       DA + NLT FLAG ON            UL0H 09165817
         BNE   CORAVAIL                NO, IS CORE ALREADY GOTTEN  UL0H 09166017
*                                                                  UL0H 09166217
* VESN WILL OUTPUT MESSAGE NO USER LBLS MOVED/COPIED. NO U.L. TRK  UL0H 09166417
*                                                                  UL0H 09166617
         MVI   IEHMVV72+14,X'FF'       TELL VESN TO PUT OUT MSG    UL0H 09166817
CANCEL   MVI   UDCBITLE,X'00'          DEACTIVATE INPUT, OUTPUT    UL0H 09167017
         MVI   UDCBOTLE,X'00'          TRAILER LBL EXITS IN DCB    UL0H 09167217
         OI    IEHMVV20+2,X'40'        SET FLAG FOR VESN MESSAGE   UL0H 09167417
*                                      DATA SET(S) NOT MOVED OR    UL0H 09167617
*                                      COPIED, ERROR SITUATION     UL0H 09167817
         B     NOLABEL                 RETURN TO EOV               UL0H 09168017
*                                                                  UL0H 09168217
CORAVAIL DS    0H                                                  UL0H 09168417
         CLC   IEHMVV72(4),ZEROS       ANY CORE AVAILABLE ALREADY  UL0H 09168617
         BNE   INITIAL                 YES, INITIALIZE POINTERS    UL0H 09168817
*                                                                  UL0H 09169017
         GETMAIN  R,LV=640             NO, GETMAIN TO SAVE LABELS  UL0H 09169217
*                                                                  UL0H 09169417
         ST    RG1,IEHMVV72+4          SAVE GOTTEN CORE ADDRESS    UL0H 09169917
*                                                                  UL0H 09170417
INITIAL  DS    0H                                                  UL0H 09170917
         CLC   0(4,RG3),UTL1DEF        FRST LABEL IN GROUP         UL0H 09171417
         BNE   SAVLABEL                NO, BYPASS 1ST LABEL SETUP  UL0H 09171917
         MVC   IEHMVV72+4(4),IEHMVV72  NO, SET PTR TO LBL SAVEAREA UL0H 09172417
         MVI   IEHMVV72+12,X'00'       INITIALIZE LBL CTR TO ZERO  UL0H 09172917
*                                                                  UL0H 09173417
SAVLABEL DS    0H                                                  UL0H 09173917
         L     RG1,IEHMVV72+4          GET ADDR OF CURRENT LBL AREAUL0H 09174417
         MVC   0(80,RG1),0(RG3)        SAVE LABEL IN GOTTEN CORE   UL0H 09174917
         LA    RG1,80(RG1)             UP PTR TO NEXT LOCATION     UL0H 09175417
         ST    RG1,IEHMVV72+4          AND SAVE ADDRESS            UL0H 09175917
         SR    RG1,RG1                 INCREMENT                   UL0H 09176417
         IC    RG1,IEHMVV72+12            LABEL                    UL0H 09176917
         LA    RG1,1(RG1)                    COUNTER               UL0H 09177417
         STC   RG1,IEHMVV72+12                  BY 1, AND SAVE     UL0H 09177917
         LA    RTCD15,4                SET RC=4 FOR MORE LABELS    UL0H 09178417
         BR    RET14                   RETURN TO EOV PROCESSING    UL0H 09178917
CHLIOER  TM    IEHMVV74+4,X'FF'   TEST LABEL I/O ERROR FLAG        UL0H 09179017
         BCR   12,RET14           NOT ON - RETURN.                 UL0H 09179117
         BAL   RG9,CLEAR          BLANK OUT PRINT BUFFER           UL0H 09179217
         L     RG8,AM07           LOAD ADDRESS OF MSG ADDRESS      UL0H 09179317
         IC    RG7,0(RG8)         LOAD MSG LENGTH                  UL0H 09179417
         L     RG8,0(RG8)         LOAD ACTUAL MSG ADDRESS          UL0H 09179517
         EX    7,MOVER            MOVE MSG TO PRINT BUFFER         UL0H 09179617
         B     MESG03             GO TO MESSAGE WRITER             UL0H 09179717
AM01     DC    A(M01)                                                   09180000
AM02     DC    A(M02)                                                   09200000
AM03     DC    A(M03)                                                   09220000
AM04     DC    A(M04)                                                   09240000
AM05     DC    A(M05)                                                   09260000
AM06     DC    A(M06)                                                   09280000
AM07     DC    A(M07)                                              UL0H 09290017
AM08     DC    A(M08)             ADDRESS OF UNCORRECTABLE ERROR A27313 09295019
*                                                                       09300000
*                                                                       09320000
*                                                                       09340000
         SPACE 3                                                        09360000
WRKBUF   DSECT                                                          09380000
CCHH     DS    F                                                        09400000
R0       DS    CL1                     COUNT OF NUMBER OF RECORDS       09420000
COUNT    DS    CL2                     ON TRACK                         09440000
         DS    CL1                                                      09460000
SWITCH   DS    H   FOR VS RECORDS THIS IS USED TO SAVE THE        19030 09470019
*                  RETURN CODE FROM THE WRITE R0 MACRO. ITS       19030 09480019
*                  CONTENTS WILL BE TESTED FOR END OF EXTENT      19030 09490019
BLKOUT   DS    H                   WORK AREA 64 BYTES                   09500000
KEYLGN   DS    H                                                        09520000
BLKSIZ   DS    H                                                        09540000
KEYADR   DS    F                                                        09560000
BUFADR   DS    F                                                        09580000
NXTRD    DS    F             FEEDBACK FROM READ                   19030 09581019
WRTTR    DS    F             FEEDBACK FROM WRITE                  19030 09582019
RECSIZE  DS    F             SAVE AREA FOR RECORD SIZE            19030 09583019
FSTR0SW  DS    H             FIRST R0 SW  0=OFF  1=ON             19030 09584019
*                            SECOND BYTE USED AS INDICATOR        19030 09585019
*                            01= LAST EOF WAS WRITTEN             19030 09586019
*                            00= IMBEDDED EOF WAS WRITTEN         19030 09587019
LSTWRTI  DS    H             LAST REC WRITTEN  0=R0  1=DATA       19030 09588019
*                            SECOND BYTE USED AS INDICATOR        19030 09589019
*                            01= KEY WAS CHANGED FOR EOF WRITE    19030 09590019
*                            00= KEY WAS NOT CHANGED              19030 09591019
INDECB   DS    CL1                                                      09600000
EXCD01   DS    CL1                                                      09620000
EXCD02   DS    CL2                                                      09640000
         DS    7F                 INPUT DECB EXTENSION            19030 09660019
DECBOUT  DS    6F                 OUTPUT DECB                     19030 09680019
BLKREF   DS    2F                                                       09700000
TTIR     DS    H                                                        09720000
IREC     DS    H                                                        09740000
GOTEN    DS    F                                                        09760000
LLI      DS    CL3            LENGTH AND INDICATOR FOR BWRITE           09780000
MBBCCHHR DS    CL8            USED WHEN LOADING WITH ABSOLUTE DISK ADDR 09800000
INPUT    DS    CL1            READ IN AREA                              09820000
         IEHMVV                                                         09840000
         ORG   IEHMVV70                                            UL0H 09846017
         IEHDCBXL                                                  UL0H 09852017
*                                                                       09860000
*                                                                       09880000
         END   IEHMVSTL                                           19030 09890019
./  ADD  SSI=62450115,NAME=IEHMVXSE
*TITLE ' IEHMVSSE                                                     * 00020000
*                                                                       00040000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00060000
*   THIS MODULE WILL GET AND INITIALIZE A WORKING STORAGE AREA        * 00080000
*FOR THE USE OF ALL THE MODULES OF THE IEHMOVE PROGRAM.               * 00100000
*   THE WORKING STORAGE WILL BE POINTED TO BY REGISTER 12             * 00120000
*THROUGHOUT THE COURSE OF THE PROGRAM.                                * 00140000
*   THE WORKING STORAGE IS DEFINED BY THE DSECT,IEHMVV.               * 00160000
*   THE PARAMETER LIST PASSED IN REGISTER 1 BY THE INVOKING           * 00180000
*PROGRAM WILL BE ACTED UPON IN THIS MODULE.                           * 00200000
*   CONTROL WILL BE PASSED TO BOTH THE VOLUME MOUNTING ROUT-          * 00220000
*INE AND THE MESSAGE WRITER FOR INITIALING PURPOSES.                  * 00240000
*   THREE WORK FILES ASSOCIATED WITH THE SYSUT1 DD CARD WILL          * 00260000
*BE ALLOCATED INTERNALLY BY THIS MODULE.                              * 00280000
*   THEY WILL BE OPENED IN THIS MODULE AND WILL REMAIN                * 00300000
*OPEN FOR THE DURATION OF THE IEHMOVE PROGRAM.                        * 00320000
*    THIS MODULE WILL PASS CONTROL VIA XCTL TO MODULE                 * 00340000
*IEHMVSST AND IT WILL NOT BE ENTERED AGAIN DURING THE COURSE          * 00360000
*OF THIS PROGRAM.                                                     * 00380000
*********************************************************************** 00400000
*                                                                       00420000
*ENTRY POINTS: 1. IEHMVXSE (IEHMVSSD LINKS TO THIS E.P.)              * 00440000
*2. IEHMVESE (ALL ENTRYES EXCEPT IEHMVSSD USE THIS ENTRY POINT)       * 00460000
*INPUT: POINTER TO IEHMDVE1 WORKAREA IN REG 12 - EXCEPT ENTRY TO      * 00480000
*IEHMVXSE                                                             * 00500000
*OUTPUT: REGISTER 12 POINTS TO IEHMOVE1 COMM AREA (COMM AREA IS       * 00520000
*DESCRIBED BY DSECT IEHMVV IN THIS LISTING)                           * 00540000
*EXTERNAL ROUTINES: IEHMVXSF (VOLUME MOUNTING ROUTINE)                * 00560000
*IEHMVSSA (MSG. WRITER ROUTINE)                                       * 00580000
*EXITS - NORMAL IEHMVSST (CONTROL CARD ANALIZER RIN.)                 * 00600000
*TABLES/WORK AREAS: WORK AREA DSECT IEHMVV IS USED THROUGH OUT THE    * 00620000
*IEHMOVE1 PROGRAM AS A WORK AREA AND COMMUNICATIONS AREA. A POINTER TO* 00640000
*THIS WORK AREA IS MAINTAINED IN REGISTER 12.                         * 00660000
IEHMVSSE CSECT                                                          00662002
*A104810-104950,121260-121320                                  @ZA07393 00662104
*C017000                                                       @ZA07393 00662204
*C017000,091000                                                @ZA07392 00662504
*A138100,139300,140500                                         @ZA07360 00663004
*C017000                                                       @ZA07360 00664004
*C106500                                                       @ZA03372 00665003
*A044150-044234                                                @ZA01726 00668003
*D044150-044250                                                @ZA01726 00671003
*C124200,127800                                                @ZM33040 00674003
         TITLE 'IEHMVXSE-IEHMOVE WORK AREA SETUP, PARAM ANLYZR'         00677003
*A105000-116400,022200,122850,137000,138200,139400             @ZA00101 00680003
*D105000-117000,122200-122600,130200-132000,137000-137600      @ZA00101 00680403
*D138200-138800,139400-140000                                  @ZA00101 00680803
*C093600                                                       @ZM30153 00682003
*A082000-082150                                                @ZA01246 00683002
*A093700,155408                                                @ZM30153 00684003
*D082000                                                       @ZA01246 00686002
*A052680-052840,122900                                          YA01194 00690016
*D072600,072800,073400,073600                                    A48763 00700122
*A073700-073933,155404                                           A48763 00700222
*C154800                                                         A48763 00700322
*C155000                                                         A44310 00700421
* 093200                                                         A38756 00701021
* 107200,108600,111000,112400,115400,116800,166000               A37897 00702021
* 104060-104120                                                  S20201 00703100
*                                                                A30471 00707000
* 018600,027400,082000                                             I276 00710000
* 081520,082000,083200,083400                                    A24913 00713000
* 123600                                                         A23994 00716000
* 118800-119200                                                  S21042 00718021
*0313-127400                                                       9754 00719000
*0313083600,084800,157680-157800,159400-159600                     BS0H 00722000
*0313042600,042800,043000,043600,044200,053400,053600-054600       7356 00725000
*03130085000-085200                                                7356 00728000
* 066000,066400,066600,066800                                    A21460 00731000
*0313                                                           PTM663  00734000
*113000                                                          A37871 00734220
*                             REGISTER NOTATION AND USAGE               00737000
R0       EQU   0                                                        00740000
DEV0     EQU   0                                                        00760000
DEV1     EQU   1                                                        00780000
R1       EQU   1                                                        00800000
R2       EQU   2                                                        00820000
ECR2     EQU   2                                                        00840000
DEV2     EQU   2                                                        00860000
R3       EQU   3                                                        00880000
ECR3     EQU   3                                                        00900000
DBR1     EQU   3                        WORK REG                        00920000
DEV3     EQU   3                                                        00940000
DBR3     EQU   4                        WORK REG                        00960000
DBCOMPR  EQU   5                                                        00980000
R6       EQU   6                                                        01000000
DADR1    EQU   6                                                        01020000
INVOKE1  EQU   6                                                        01040000
R7       EQU   7                                                        01060000
INVOKE2  EQU   7                                                        01080000
BASE     EQU   8                        BASE REG FOR IEHMVXSE           01100000
R10      EQU   10                                                       01120000
R12      EQU   12                                                       01140000
COMMAREA EQU   12                       BASE REG FOR COMMUNICATION AREA 01160000
R13      EQU   13                                                       01180000
R14      EQU   14                                                       01200000
DEV14    EQU   14                                                       01220000
DEV15    EQU   15                                                       01240000
R15      EQU   15                                                       01260000
*                                                                       01280000
*                                                                       01300000
*                             ENTRY AND EXTRN STATEMENTS                01320000
         ENTRY IEHMVXSE                                                 01340000
         ENTRY IEHMVESE                                                 01360000
*                             EQUATE STATEMENTS                         01380000
VOLMNTSW EQU   X'10'                                                    01400000
SWTCHOFF EQU   X'EF'                                                    01420000
DIGIT    EQU   X'F0'                                                    01440000
ZERO     EQU   X'00'                                                    01460000
VMIT     EQU   4                                                        01480000
VMITC    EQU   10                                                       01500000
VMVMR    EQU   11                                                       01520000
BLANK    EQU   X'40'                                                    01540000
OPEN     EQU   X'10'                                                    01560000
DCBFLG   EQU   48                                                       01580000
TOLANCE  EQU   X'01'                    DEVICE TOLERANCE MASK.          01600000
PARMERR  EQU   X'1FF'                                                   01610017
OVHED    EQU   14                      DEVICE OVERHEAD CONSTANT  S20201 01611020
OVHED1   EQU   17                      OVERHEAD BIT IF 2-BYTE    S20201 01612020
CVTAD    EQU   16                      ADDRESS OF ADDRESS OF CVT S20201 01613020
RPS      EQU   1                       DEVICE CHARISTICS BYTE    S20201 01614020
LEFTJUS  EQU   24                      BITS IN 3 BYTE SHIFT      S20201 01615020
*                                                                       01620000
*                                                                       01640000
         USING IEHMVXSE,BASE                                            01660000
         USING IEHMVV,COMMAREA           ADDRESSABILITY TO COMM DSECT   01680000
IEHMVXSE SAVE  (14,12),T,IEHMVXSE-OZ07393                      @ZA07393 01700004
         LR    BASE,R15                 SET UP ADDRESSABILITY           01720000
        IEHPRE (14,1),TFC                                               01740000
         LR    DBR1,R1                 PUT ADDRESS OF STAE EXIT  A30471 01750019
*                                      IN REG. FOR STAE MACRO    A30471 01751019
*                                                                     * 01760000
*              GETMAIN FOR THE WORKING STORAGE TO BE USED             * 01780000
*              BY THE IEHMOVE PROGRAM                                 * 01800000
*              THE FIRST 2000 BYTES ARE CLEARD TO BINARY ZEROS        * 01820000
*                                                                       01840000
         GETMAIN R,LV=3040                                         I276 01860019
         LR    COMMAREA,R1              SET UP ADDRESSABILITY FOR       01880000
*                                       MOVE/COPY COMMUNICATION AREA    01900000
         LA    R0,2000                                                  01920000
         BAL   R14,CLEAR                BRANCH TO CLEAR ROUTINE TO      01940000
*                                       CLEAR 2000 BYTE AREA            01960000
         STAE  (DBR1),CT,PARAM=(12),XCTL=YES                     A30471 01970019
         B     SKIPENTR                BRANCH AROUND ALTERNATE ENTRY    01980000
*                                                                     * 02000000
*              THIS IS AN ALTERNATE ENTRY POINT THAT IS USED          * 02020000
*              WHEN CONTROL IS PASSED TO THIS MODULE FROM THE MESSAGE * 02040000
*              WRITER MODULE OR THE VOLUME MOUNTING VOLUME            * 02060000
*                                                                     * 02080000
         USING *,R15                                                    02100000
IEHMVESE S     R15,ACON                 SET UP ADDRESSABILITY FOR       02120000
         LR    BASE,R15                 ALTERNATE ENTRY                 02140000
         DROP  R15                                                      02160000
         USING IEHMVXSE,BASE                                            02180000
         BALR  R15,R0                                                   02200000
         SAVE  (14,12),T,ESE                                            02220000
        IEHPRE (14),TFC                                                 02240000
         TM    IEHMVV20+4,VOLMNTSW      IS RETURN FROM VOLUME MOUNT     02260000
*                                       SWITCH ON?                      02280000
         BZ    TESTENTR                                                 02300000
         NI    IEHMVV20+4,SWTCHOFF     TURN SWITCH OFF                  02320000
         B     MNTIN                                                    02340000
TESTENTR DS    0H                                                       02360000
         B     FINDUCB                                                  02380000
SKIPENTR DS    0H                                                       02400000
*                                                                     * 02420000
*              INITIALIZATION OF THE WORKING STORAGE BEGINS HERE      * 02440000
*                                                                     * 02460000
*              GENERALLY THE FOLLOWING THING WILL TAKE PLACE          * 02480000
*                                                                     * 02500000
*               1   SET UP BEGINNING AND END ADDRESS OF PERMANENT     * 02520000
*                   WORK AREA                                         * 02540000
*               2   SET ASIDE 144 BYTES FOR THE CARD SCAN MODULE      * 02560000
*                   IEHMVSSJ                                          * 02580000
*               3   MOVE SYSIN  SYSPRINT AND  THREE WORK FILE DCBS    * 02600000
*                   AND ASSOCIATED DECB S TO PERMANENT WORK AREA      * 02620000
*              THE ABOVE ITEMS WILL REMAIN IN THE WORKING STORAGE     * 02640000
*              DURING THE COURSE OF THE IEHMOVE PROGRAM               * 02660000
*                                                                     * 02680000
         LA    DBR1,IEHMVV90             INITIALIZE BEGINING AND END    02700000
         ST    DBR1,IEHMVV10             ADDRESS OF PERMANENT WORK      02720000
         LA    DBR1,IEHMVV00                                       I276 02730019
         LA    DBR1,3039(DBR1)         END OF DSECT                I276 02740019
         ST    DBR1,IEHMVV10+4                                          02760000
         L     DBR1,IEHMVV10                                            02780000
         LA    DBR1,144(DBR1)           AREA FOR IEHMVESJ CARD SCAN RTN 02800000
         ST    DBR1,IEHMVV10                                            02820000
         S     DBR1,DISP1               CALC DCB ADDR ACCORDING TO      02840000
         ST    DBR1,IEHMVV32            OFFSET IN MACRO EXPANSION       02860000
         L     DBR1,IEHMVV10                                            02880000
         MVC   0(LOC2-LOC1,DBR1),LOC1   MOVE DCB TO PERM WORK AREA      02900000
         LA    DBR1,LOC2-LOC1(DBR1)                                     02920000
         LA    DBR1,20(DBR1)                                            02940000
         ST    DBR1,IEHMVV10            UPDATE NEXT AVIL ADDR           02960000
         L     DBR1,IEHMVV10             CALC DCB ADDRESS ACCORDING TO  02980000
         S     DBR1,DISP2                THE EQU STATEMENT WITHIN THE   03000000
         ST    DBR1,IEHMVV33             DCB MACRO EXPANSION            03020000
         L     DBR1,IEHMVV10                                            03040000
         MVC   0(LOC3-LOC2,DBR1),LOC2    MOVE DCB TO WORK AREA          03060000
         LA    DBR1,LOC3-LOC2(DBR1)                                     03080000
         LA    DBR1,20(DBR1)                                            03100000
         ST    DBR1,IEHMVV10             UPDATE NEXT AVALIBLE ADDR PTR  03120000
         L     DBR1,IEHMVV10             CALC DCB ADDRESS ACCORDING TO  03140000
         S     DBR1,DISP3                THE EQU STATEMENT IN THE       03160000
         ST    DBR1,IEHMVV40             DCB MACRO EXPANSION            03180000
         L     DBR1,IEHMVV10                                            03200000
         MVC   0(LOC4-LOC3,DBR1),LOC3    MOVE DCB TO WORK AREA          03220000
         LA    DBR1,LOC4-LOC3(DBR1)                                     03240000
         ST    DBR1,IEHMVV40+4           STORE DECB ADDRESS             03260000
         LA    DBR1,20(DBR1)                                            03280000
         ST    DBR1,IEHMVV10             UPDATE NEXT AVAILIABE ADDR PTR 03300000
         L     DBR1,IEHMVV10           CALC DCB ADDR ACCORDING TO       03320000
         S     DBR1,DISP4              THE EQU STSTEMENT IN THE         03340000
         ST    DBR1,IEHMVV41           DCB MACRO EXPANSION              03360000
         L     DBR1,IEHMVV10                                            03380000
         MVC   0(LOC5-LOC4,DBR1),LOC4  MOVE DCB TO PERM WORK AREA       03400000
         LA    DBR1,LOC5-LOC4(DBR1)                                     03420000
         ST    DBR1,IEHMVV41+4         STORE DECB ADDR                  03440000
         LA    DBR1,20(DBR1)                                            03460000
         ST    DBR1,IEHMVV10           UPD ATE NEXT AVILAB. ADDR        03480000
         L     DBR1,IEHMVV10            CALC DCB ADDRESS ACCORDING TO   03500000
         S     DBR1,DISP5               THE EQU STATEMENT IN THE        03520000
         ST    DBR1,IEHMVV42            DCB MACRO EXPANSION             03540000
         L     DBR1,IEHMVV10                                            03560000
         MVC   0(LOC6-LOC5,DBR1),LOC5                                   03580000
         LA    DBR1,LOC6-LOC5(DBR1)                                     03600000
         ST    DBR1,IEHMVV42+4          STORE DECB ADDR                 03620000
         LA    DBR1,20(DBR1)                                            03640000
         ST    DBR1,IEHMVV10                                            03660000
         LA    DBR1,60                  SET UP LINE COUNT OF 60         03680000
         STH   DBR1,IEHMVV51+8                                          03700000
         LA    DBR1,1                                                   03720000
         STH   DBR1,IEHMVV51+12        SET PAGE NO. TO 01               03740000
         MVC   IEHMVV00+176(24),DDNAMES MOVE KNOWN DDNAMES TO VOLITAL   03760000
*                                       WORK AREA                       03780000
*                                                                     * 03800000
*                                                                     * 03820000
*              INVOKER PARAMETERS WILL BE CONSIDERED IN THIS SECTION  * 03840000
*                                                                     * 03860000
*              THE ITEMS THAT WILL BE CONSIDERED ARE                  * 03880000
*               1   LINE COUNT                                        * 03900000
*               2   SYSIN  SYSPRINT  AND SYSUT1 DD CARD NAME          * 03920000
*                   SUBSTITUTIONS                                     * 03940000
*               3   PAGE NUMBER                                       * 03960000
*                                                                     * 03980000
*                                                                     * 04000000
         GETMAIN  R,LV=56              GET 56 BYTES OF CORE        VS0H 04020017
         USING ECSAVE,R1                USE DSECT,ECSAVE TO ADDRESS     04040000
*                                       THIS AREA                       04060000
         STM   R2,INVOKE2,ECSAVE        SAVE REGISTERS                  04080000
         L     R2,0(R6)                 GET ADDRESS OF PARM FIELD SET   04100000
         LA    DBR1,1             INITIALIZE REG TO DEFAULT        4942 04106015
*                                 VALUE OF POWER PARM (1)          4942 04112015
*                                                                       04120000
         AH    R2,0(R2)                 ADDRESS + LENGTH=END OF         04140000
         LA    R2,2(R2)       LENG IN LL FIELD DOES NOT INCLUDE LL 4942 04146015
*                             LL FIELD, BUMP PTR TO END OF PARM(+2)4942 04152015
*                                       PARM LIST                       04160000
         L     R6,0(0,R6)              POINTER TO PARM LIST        000F 04167017
         CLI   1(R6),ZERO    SEE IF LENGTH INDICATER FOR PARM LIST VS0H 04168017
*                            IS ZERO                               VS0H 04169017
         BE    HERE          IF THERE ARE NO PARMS 20/20/40 IS     VS0H 04170017
*                            ASSUMED                               VS0H 04171017
         LA    R6,2(R6)       BUMP REG BY 2 TO POINT TO ACTUAL PARM4942 04175015
ECLOOP1  CLC   ECKEY(6),0(R6)           CHECK FOR PARMETER POWER=  000F 04181017
         BE    CKDIGIT                  NO,UP POINTER              000F 04187017
         LA    R6,1(0,R6)                                          000F 04193017
         CR    R6,R2                    CHECK FOR END OF PARM      000F 04199017
         BNL   HERE     NO MATCH, DEFAULT IS 20/20/40              4942 04206015
         B     ECLOOP1                                                  04210014
CKDIGIT  LA    R6,6(0,R6)               BUMP PARM POINTER BY SIX   000F 04220017
         LR    R7,R6                    POINTER FOR DIGITS TO BE   000F 04230017
         CR    R6,R2                    CHECK FOR END OF LIST      000F 04240017
         BNL   PARMERR1                ERROR                       7356 04260017
         CLI   0(R6),X'F0'             CHECK DIGIT RANGE OF 1-9    000F 04270017
         BL    PARMERR1                ERROR                       7356 04280017
         CLI   0(R6),X'F9'                                         000F 04290017
         BH    PARMERR1                ERROR                       7356 04300017
         LA    R6,1(0,R6)               CHECK FOR END OF LIST      000F 04310017
         CR    R6,R2                                               000F 04320017
         BNL   ECFIND                                              4942 04330015
         CLI   0(R6),X'6B'             DELIMITER FOR THIS PARAM    7356 04333017
         BE    ECFIND                  IF YES, THEN FINISHED       7356 04336017
         LA    DBR1,1(0,DBR1)           UPDATE BYTE COUNTER        000F 04344017
         CLI   0(R6),X'F0'              CHECK DIGIT RANGE OF 1-9   000F 04352017
         BL    PARMERR1                ERROR                       7356 04360017
         CLI   0(R6),X'F9'                                         000F 04370017
         BH    PARMERR1                ERROR                       7356 04380017
         LA    R6,1(0,R6)               UPDATE PARM POINTER        000F 04388017
         CR    R6,R2                    CHECK POINTERS             000F 04396017
         BNL   ECFIND                                              000F 04404017
         CLI   0(R6),X'6B'            DELIMITER FOR THIS PARAM @ZA01726 04415003
         BE    ECFIND                 IF YES, THEN FINISHED    @ZA01726 04416003
         LA    DBR1,1(0,DBR1)          UPDATE BYTE COUNTER     @ZA01726 04417003
         CLI   0(R6),X'F0'             CHECK DIGIT RANGE 1-9   @ZA01726 04418003
         BL    PARMERR1                ERROR                   @ZA01726 04419003
         CLI   0(R6),X'F9'                                     @ZA01726 04420003
         BH    PARMERR1                ERROR                   @ZA01726 04421003
         LA    R6,1(0,R6)              UPDATE PARM POINTER     @ZA01726 04422003
         CR    R6,R2                   CHECK POINTERS          @ZA01726 04423003
         BNL   ECFIND                                          @ZA01726 04424003
         CLI   0(R6),X'6B'            DELIMITER SHOULD BE HERE @ZA01726 04425003
         BNE   PARMERR1               AS ONLY THREE DIGITS FOR @ZA01726 04426003
*                                     POWER ARA SUPPORTED      @ZA01726 04427003
ECFIND   BCTR  DBR1,0                   REDUCE BYTE COUNT BY ONE   000F 04434017
*                                          FOREXECUTE OF PACK      000F 04443017
         EX    DBR1,ECPACK              PACK THE NUMBER            000F 04452017
         CVB   DBR1,ECDBL               AND CONVERT IT             000F 04461017
HERE     LA    R2,20      ASSUME 20 TRACKS                         4942 04470015
         MR    R2,R2                   INCREASE 20 BY POWER        000F 04480017
         B     ECEND                                                    04490014
PARMERR1 OI    PARMERR(COMMAREA),X'01' SET PARAM ERROR BIT         7356 04493017
         B     ECEND                   SKIP TO PROCESS NEXT PARAM  7356 04496017
         SPACE 3                                                        04500014
ECPACK   PACK  ECDBL(8),0(R0,R7)   EXECUTED PACK INSTRUCTION       4942 04510015
         SPACE 3                                                        04520014
ECEND    ST    DBR1,IEHMVV50            PLACE THE ALLOCATION       000F 04550017
*                                          AMOUNT IN THE WORK AREA 000F 04580017
         LM    R2,R7,ECSAVE             RELOAD REGISTERS                04620000
         FREEMAIN  R,LV=56,A=(1)       FREE 56 BYTES OF GOTTEN COREVS0H 04640017
         DROP  R1                                                       04660000
INVOPT   L     INVOKE2,0(0,INVOKE1)     SET UP POINTER TO BYTE COUNT    04680000
         LH    DBR1,0(0,INVOKE2)         BYTE COUNT IN REG              04700000
         LTR   DBR1,DBR1                 IS BYTE COUNT ZERO             04720000
         BZ    INVOPT1                   BRANCH IF YES                  04740000
         B     INVOPT2                                                  04760000
INVOPT1  MVI   XSEENTRY,ZERO            SET ENTRY SWITCH TO ZERO        04780000
         L     INVOKE2,0(0,INVOKE1)                                     04800000
         LTR   INVOKE2,INVOKE2           IS THE POINTER MINOS           04820000
         BM    INVEXIT                   BRANCH IF YES                  04840000
         B     INVDD                     GO TO DD NAME RTN IF NO        04860000
INVOPT2  SH    DBR1,DSIX                 SCAN FOR LINECNT=              04880000
         AR    INVOKE2,DBR1                                             04900000
INVOPT4  CLC   LINECNT(8),0(INVOKE2)     LOOK FOR LINECNT=              04920000
         BE    INVOPT3                   BRANCH IF FOUND                04940000
         BCTR  INVOKE2,R0                                               04960000
         BCT   DBR1,INVOPT4              BRANCH IF NOT FOUND            04980000
         B     INVOPT1                   LOOP AND LOOK FURTHER          05000000
INVOPT3  LA    INVOKE2,8(INVOKE2)        IS PARAM FOLLOWING EQUAL ONE   05020000
         CLI   0(INVOKE2),X'EF'          OR TWO BYTES                   05040000
         BNH   INVOPT5                   BRANCH IF FIRST BYTE IS DELIM  05060000
         CLI   1(INVOKE2),X'EF'          IS SECOND BYTE A DELIMITER     05080000
         BNH   INVOPT7                   BRANCH IF YES                  05100000
  LA  DBR1,1  SET  COUNT                                                05120000
         B     INVOPT6                                                  05140000
INVOPT7  SR  DBR1,DBR1   SET  COUNT                                     05160000
INVOPT6  EX    DBR1,INVOPT8              MOVE LINE COUNT TO COMM AREA   05180000
         B     INVOPT9                                                  05200000
INVOPT8  PACK  IEHMVV00(8),0(1,INVOKE2)    PACK  NUMBER                 05220000
INVOPT9  DS    0H                                                       05240000
         CVB   DBR3,IEHMVV00            CONVERT IT TO BINARY            05260000
         C     DBR3,FOUR               CHECK IF LINE COUNT IS   YA01194 05268016
*                                       EQUAL OR GREATER THAN 4 YA01194 05276016
         BL    INVOPT5                 NO , GO TO INVOPT5       YA01194 05284016
         STH   DBR3,IEHMVV51+8          STORE IT IN COMM. AREA          05292022
         B     INVOPT1                                                  05300000
INVOPT5  DS    0H                                                       05320000
         OI    PARMERR(COMMAREA),X'01' SET PARAM ERROR BIT         7356 05330017
         B     INVEXIT                 GO OPEN SYSPRINT AND ABORT  7356 05340017
INVDD    L     INVOKE2,4(INVOKE1)  SET UP POINTER TO DDNAME LIST        05480000
         LH    DBR1,0(INVOKE2)     LOAD AREA COUNT IN A REG             05500000
         LTR   DBR1,DBR1           IS COUNT ZERO                        05520000
         BZ    INVDD1              BRANCH IF YES                        05540000
         B     INVDD2                                                   05560000
INVDD1   L     INVOKE2,4(INVOKE1)  SET UP POINTER TO DDNAME LIST        05580000
         LTR   INVOKE2,INVOKE2     IS POINTER MINUS                     05600000
         BM    INVEXIT             EXIT IF YES                          05620000
         B     INVPG               GO TO PAGE NO. RTN IF NO             05640000
INVDD2   EQU *                                                          05660000
         LA    DBR3,34             LOAD 34 INTO A REG                   05680000
         CLR   DBR1,DBR3           COMPARE COUNT TO REG                 05700000
         BNH   INVDD1              BRANCH IF LOW OR EQUAL               05720000
         LA    INVOKE2,2(INVOKE2)                                       05740000
         LM    R14,R15,32(INVOKE2)                                      05760000
         BCTR  INVOKE2,R0                                               05780000
         BCTR  INVOKE2,R0                                               05800000
         LTR   R14,R14                  IS THE NAME ZEROS?              05820000
         BZ    INVDD3              BRANCH IF YES                        05840000
         STM   R14,R15,IEHMVV00+176     REPLACE SYSIN DDNAME            05860000
         L     DBR3,IEHMVV32            CHANGE NAME IN SYSIN DCB        05880000
         STM   R14,R15,40(DBR3)                                         05900000
INVDD3   LA    DBR3,42             LOAD 40 INTO A REG                   05920000
         CLR   DBR1,DBR3           COMPARE COUNT TO REG                 05940000
         BNH   INVDD1              BRANCH IF LOW OR EQUAL               05960000
         LA    INVOKE2,2(INVOKE2)                                       05980000
         LM    R14,R15,40(INVOKE2)                                      06000000
         BCTR  INVOKE2,R0                                               06020000
         BCTR  INVOKE2,R0                                               06040000
         LTR   R14,R14                  IS THE NAME ZERO?               06060000
         BZ    INVDD4              BRANCH IF YES                        06080000
         STM   R14,R15,IEHMVV00+184     REPLACE SYSPRINT DDNAME         06100000
         L     DBR3,IEHMVV33            CHANGE NAME IN SYSPRINT DCB     06120000
         STM   R14,R15,40(DBR3)                                         06140000
INVDD4   LA    DBR3,58                  LOAD REG WITH 58                06160000
         CLR   DBR1,DBR3                COMPARE COUNT TO REG            06180000
         BNH   INVDD1                   BRANCH IF LOW OR EQUAL          06200000
         LA    INVOKE2,2(INVOKE2)                                       06220000
         LM    R14,R15,56(INVOKE2)                                      06240000
         BCTR  INVOKE2,R0                                               06260000
         BCTR  INVOKE2,R0                                               06280000
         LTR   R14,R14                  IS THE NAME ZERO?               06300000
         BZ    INVDD1                   BRANCH IF YES                   06320000
         STM   R14,R15,IEHMVV00+192     REPLACE SYSUT1 DDNAME           06340000
         L     DBR3,IEHMVV40            CHANGE NAME IN SYSUT1 DCB       06360000
         STM   R14,R15,40(DBR3)                                         06380000
         L     DBR3,IEHMVV41            CHANGE DD NAME IN SYSUT2 DCB    06400000
         STM   R14,R15,40(DBR3)                                         06420000
         L     DBR3,IEHMVV42            CHANGE DD NAME IN SYSUT3 DCB    06440000
         STM   R14,R15,40(DBR3)                                         06460000
         B     INVDD1                                                   06480000
INVPG1   PACK  IEHMVV00(8),2(1,INVOKE2) MOVE PAGE # TO COMM AREA A21460 06490018
INVPG    L     INVOKE2,8(INVOKE1)       SET POINTER TO PAGE NO POINTER  06500000
         LH    DBR1,0(INVOKE2)          LOAD AREA COUNT                 06520000
         LTR   DBR1,DBR1                IS COUNT ZERO                   06540000
         BZ    INVEXIT                  BRANCH IF YES                   06560000
         BCTR  DBR1,0                   DECREASE COUNT BY 1 FOR  A21460X06566018
                                        EX INSTRUCTION           A21460 06573018
         EX    DBR1,INVPG1              MOVE PAGE NO. TO COMM AREA      06580000
         CVB   INVOKE2,IEHMVV00         CONVERT IT TO BINARY            06620000
         STH   INVOKE2,IEHMVV51+12     STORE BACK IN COMM AREA   A21460 06660018
INVEXIT  DS    0H                                                       06700000
*                                                                     * 06720000
*                                                                     * 06740000
*              AT THIS POINT A LIST OF DD NAMES ASSOCIATED WITH       * 06760000
*              DATA SETS THAT WILL BE ACTIVE THROUGH OUT THE COURSE   * 06780000
*              OF THE IEHMOVE PROGRAM   WORK FILES  ETC WILL BE PASSED* 06800000
*              TO THE VOLUME MOUNTING ROUTINE                         * 06820000
*              THE VOLUME MOUNTING ROUTINE WILL INITIALIZE ITS SELF   * 06840000
*              SO AS TO PREVENT THE VOLUMES ON WHICH THESE DATA SETS  * 06860000
*              RESIDE FROM BEING  DISMOUNTED                          * 06880000
*                                                                     * 06900000
*                                                                     * 06920000
         LA    R1,IEHMVV00+176          SET UP VOLUME MOUNTING REQUEST  06940000
         ST    R1,IEHMVV00                                              06960000
         LA    R1,3                                                     06980000
         STC   R1,IEHMVV00                                              07000000
         MVI   IEHMVV00+VMVMR,X'00'     NUMBER OF REQUESTS              07020000
         LA    DBR1,IEHMVV00       PTR TO LIST FOR VOL MNT              07040000
         LH    DBR3,SE                                                  07060000
       IEHPOST (14),T                                                   07080000
         XCTL  EP=IEHMVXSF                                              07100000
MNTIN    DS    0H                                                       07120000
         LR    R1,DBR1                                                  07140000
         L     R15,VMIT(0,R1)           GET ADDRESS OF INTERNAL TABLE   07160000
         SR    R0,R0                                                    07180000
         IC    R0,VMITC(R0,R1)          GET NUMBER OF IT ENTRIES        07200000
         LH    R14,0(R0,R15)            GET LENGTH OF TABLE             07220000
         L     R1,IEHMVV10              POINTER TO PERMANENT WORK AREA  07240000
         ST    R1,IEHMVV50+4            SET UP POINTER TO IT TABLE      07300000
         STC   R0,IEHMVV50+4            SET UP NUMBER OF IT ENTRIES     07320000
         LA    R10,255          TO MOVE 256 BYTES BY EX-INSTR.   A48763 07370022
MVCINTBL CH    R14,H256         IS INT. TBL. LONGER THAN 256 BTS A48763 07372022
         BNH   LASTMVC          IF NOT, BYPASS LOOP TO MOVE IT   A48763 07374022
         EX    R10,ITMOVER      IF YES,MOVE IT IN STEPS OF 256BTSA48763 07376022
         SH    R14,H256         ADJUST NR OF BYTES, TO BE MOVED  A48763 07378022
         LA    R15,256(R15)     ADJUST ADDRESS,FROM WHICH TO MOVEA48763 07378422
         LA    R1,256(R1)       ADJUST ADDRESS,TO WHICH TO MOVE  A48763 07378822
         B     MVCINTBL         BRANCH FOR MOVE OF THE REST OF ITA48763 07379222
LASTMVC  BCTR  R14,R0           SUBTRACT ONE FOR EX-INSTRUCTION  A48763 07379622
         EX    R14,ITMOVER      MOVE REMAINING PART OF INT. TABLEA48763 07379722
         LA    R1,1(R1,R14)     ADJUST NEW WORKAREA-POINTER      A48763 07379822
         ST    R1,IEHMVV10      SAVE NEW WORKAREA-POINTER        A48763 07379922
         LR    R1,DBR1                                           A48763 07386622
         L     R15,VMIT(R0,R1)  GET ADDRESS OF I.T. FOR FREEMAIN A48763 07388622
         LH    R14,0(R0,R15)    GET LENGTH OF I.T. FOR FREEMAIN  A48763 07390622
         LR    R0,R14                                            A48763 07393322
         LR    R1,R15                                                   07400000
         FREEMAIN R,LV=(0),A=(1)        FREE TABLE AREA                 07420000
         B     ITMOVEO                                                  07440000
ITMOVER  MVC   0(1,R1),0(R15)           USED FOR MOVING INTERNAL TABLE  07460000
ITMOVEO  DS    0H                                                       07480000
*                                                                     * 07500000
*                                                                     * 07520000
*              SYSIN  AND  SYSPRINT  DCB S  WILL BE OPENED HERE       * 07540000
*                                                                     * 07560000
*              AFTER SYSPRINT IS OPENED CONTROL WILL BE PASSED        * 07580000
*              TO THE MESSAGE WRITER SO THAT IT CAN INITIALIZE        * 07600000
*              ITS SELF   SKIP FORMS                                  * 07620000
*                         PRINT HEADER  AND PAGE NUMBER               * 07640000
*                         ETC                                         * 07660000
*                                                                     * 07680000
*                                                                     * 07700000
         L     DBR1,IEHMVV32                                            07720000
         L     DBR3,IEHMVV33                                            07740000
         MVC   37(3,DBR1),DCB1+37  UPDATE ADDRESS OF EXITLISTS  PTM663  07746017
         MVC   37(3,DBR3),DCB2+37   AFTER XCTLS - ESP FOR MVT   PTM663  07752017
         L     DBCOMPR,IEHMVV10                                         07760000
         MVC   0(RENT2-RENT1,DBCOMPR),RENT1                             07780000
         MVI   IEHMVV20,X'00'          SET SWITCH FOR SYSIN DCB    BS0H 07786017
*                                         EXIT                     BS0H 07792017
         BALR  R10,DBCOMPR             GO TO OPEN DCBS                  07800000
*                                                                       07820000
         TM    PARMERR(COMMAREA),X'01' IS PARAM ERROR BIT ON       7356 07826017
         BO    LINKAGE                 IF SO GO TO BAD PARAM ABORT 7356 07832017
*                                                                       07840000
*    THE FOLLOWING CODE CHECKS THE FLAG FIELDS OF THE SYSIN AND         07860000
* SYSPRINT DCBS FOR A SUCCESSFUL OPEN.                                  07880000
*                                                                       07900000
*    IF SYSPRINT HAS NOT BEEN OPENED SUCCESSFULLY, NO SYSPRINT          07920000
* DD STATEMENT HAS BEEN SUPPLIED.                                       07940000
*                                                                       07960000
*    CONSEQUENTLY, NO MESSAGE TO THIS EFFECT CAN BE PRINTED.            07980000
* CODE 16 IS RETURNED TO THE SCHEDULER AND THE JOB IS TERMINATED.       08000000
*                                                                       08020000
*    IF SYSIN HAS NOT BEEN OPENED SUCCESSFULLY, NO SYSIN                08040000
* DD STATEMENT HAS BEEN SUPPLIED.                                       08060000
*                                                                       08080000
*    A MESSAGE TO THIS EFFECT IS PRINTED, CODE 16 IS RETURNED           08100000
* TO THE SCHEDULER AND THE JOB IS TERMINATED.                           08120000
*                                                                       08140000
         CLI   IEHMVV20,X'F0'          BLOCKSIZE CHECK PASSED      BS0H 08146017
         BNE   BLKOK                   YES. BLOCKSIZE CHECK PASSED BSOH 08153018
         TM    DCBFLG(DBR3),OPEN       HAS SYSPRINT BEEN OPENED OK      08160000
         BO    TSTSYSIN                YES. GOTO TEST SYSIN             08180000
NOGOOD   TM    DCBFLG(DBR1),OPEN       HAS SYSIN BEEN OPENED   @ZA01246 08200002
         BZ    FREE                     NO SKIP CLOSE          @ZA01246 08205002
         CLOSE ((DBR1))                 YES CLOSE SYSIN        @ZA01246 08210002
FREE     LA R0,3040                    PREPARE TO ABORT        @ZA01246 08215002
         LR    R1,COMMAREA             LOAD PARAM REGS TO FREE STORAGE  08220000
*                                      ACQUIRED FOR COMMUNICATIONS      08240000
*                                      AREA.                            08260000
         FREEMAIN R,LV=(0),A=(1)       ISSUE FREEMAIN                   08280000
         IEHPOST (14,1),T              RESTORE PNTR TO SAVE AREA        08300000
         LA    R15,8                   LOAD ABORT RETURN CODE    A24913 08320018
         RETURN (14,12),RC=(15)        RETURN TO STEM                   08340000
BLKOK    TM    DCBFLG(DBR3),OPEN       HAS SYSPRINT BEEN OPENED  A24913 08343018
         BZ    NOGOOD                  NO. PREPARE TO ABORT      A24913 08346018
TSTSYSIN TM    IEHMVV20,X'FF'          CHECK FOR IMPROPER BLKSI    BS0H 08350017
         BC    1,LINKAGE               YES, INCOMPLETE OPERN       BS0H 08360017
         TM    DCBFLG(DBR1),OPEN       HAS SYSIN BEEN OPENED OK    BS0H 08370017
         BO    OKAY                    YES. CONTINUE PROCESSING THIS    08380000
*                                      REQUEST.                         08400000
*                            IF NO, GO TO MESSAGE WRITER TO PRINT       08420000
*                            HEADER AND RETURN TO SET UP MESSAGE        08440000
*                            UNABLE TO OPEN SYSIN DATA SET.             08460000
         B     LINKAGE                                             BS0H 08461017
EXITSYS  OC    62(2,DBR1),62(DBR1)     HAS BLOCK SIZE BEEN PROVIDEDBS0H 08462017
         BNZ   DIVIDE                  YES, GO TO CHECK FOR A      BS0H 08463017
*                                         MULTIPLE OF LRECL        BS0H 08464017
         MVC   62(2,DBR1),82(DBR1)     ASSUME BLOCKSIZE=80         BS0H 08465017
         RETURN                                                         08466017
DIVIDE   SR    R2,R2                                               BS0H 08466817
         LH    R15,82(DBR1)            PICK UP LRECL               BS0H 08467617
         LR    R1,DBR1                  SAVE REGISTER              BS0H 08468417
         LH    R3,62(DBR1)             PICK UP BLOCK SIZE          BS0H 08469217
         DR    R2,R15                  DIVIDE BLOCKSIZE BY LRECL   BS0H 08470017
         LR    DBR1,R1                                             BS0H 08470817
         LTR   R2,R2                    CHECK FOR REMAINDER        BS0H 08471617
         BCR   8,R14                   RETURN TO OPERN IF DIVIDE   BS0H 08472417
*                                         SUCCESSFUL               BS0H 08473217
         MVI   IEHMVV20,X'FF'          SET FOR S\SIN UNOPENED      BS0H 08474017
         MVC   62(2,DBR1),82(DBR1)      MOVE LRECL TO BLKSIZE      BS0H 08474817
         RETURN                                                         08476017
DCBPRTS  OC    62(2,DBR3),62(DBR3)     BLOCKSIZE PROVIDED          BS0H 08477017
         BNZ   CHECKD                  YES, BLOCK SIZE PROVIDED    BS0H 08478017
         MVC   62(2,DBR3),82(DBR3)     SET BLOCKSIZE = LRECL       BS0H 08479017
         RETURN                                                         08480017
CHECKD   SR    R2,R2                                               BS0H 08481017
         LH    R3,62(DBR3)             PICK UP BLOCKSIZE           BS0H 08482017
         LH    R15,82(DBR3)            PICK UP LRECL               BS0H 08483017
         DR    R2,R15                  DIVIDE BLOCK SIZE BY LRECL  BS0H 08484017
         L     DBR1,IEHMVV32           RESTORE SYSIN DCB POINTER   BS0H 08485017
         LTR   R2,R2                                               BS0H 08486017
         BCR   8,R14                   NO REMAINDER RETURN TO OPEN BS0H 08487017
         MVI   IEHMVV20,X'F0'          SET ERROR CODE              BS0H 08488017
         MVC   62(2,DBR3),82(DBR3)      MOVE LRECL TO BLKSIZE      BS0H 08489017
         RETURN                                                         08490017
LINKAGE  LINK  EP=IEHMVESU                                         BS0H 08491017
         TM    PARMERR(COMMAREA),X'01' IS PARAM ERROR BIT ON       7356 08492017
         BZ    *+12                    IF NOT SYSIN NOT OPENED     7356 08493017
         LA    R3,8                    PARAM ERR MSG CODE FOR ESA  7356 08494017
         B     *+8                     SKIP UNOPENED SYSIN CODE    7356 08495017
         LA    R3,17                   SET UNOPENED SYSIN CODE     7356 08496017
         LA    R2,16                   FORCE ENTRY TO IEHMVESK, THE     08540000
*                                      WRAP UP ROUTINE. AFTER IEHMVESA  08560000
*                                      HAS CAUSED THE ABOVE MSG TO BE   08580000
*                                      PRINTED, IT WILL PASS CONTROL    08600000
*                                      TO IEHMVESK ON THE BASIS OF      08620000
*                                      THE CODE FOUND IN REGISTER 2.    08640000
         OI    IEHMVV41+13,X'08'       SET RETURN CODE BYTE AT 16       08660000
*                                      THIS BYTE WILL BE LOADED INTO    08680000
*                                      REGISTER 15 BY IEHMVESK PRIOR    08700000
*                                      TO RETURNING TO THE STEM.        08720000
         B     ESAEXIT                 GO TO IEHMVESA                   08740000
OKAY     DS    0H                                                       08760000
         L     R3,MINUS                 SET CODES FOR REENTRY           08780000
         LA    R2,4                     TO IEHMVXSE                     08800000
ESAEXIT  DS    0H                                                       08820000
       IEHPOST (14),T                                                   08840000
         XCTL  EP=IEHMVESA                                              08860000
*                                                                     * 08880000
*                                                                     * 08900000
*              THE THREE WORK FILES WILL BE ALLOCATED BY THIS ROUTINE * 08920000
*                                                                     * 08940000
*              A JFCB WILL BE CONSTRUCTED AND PASSED TO DADSM FOR     * 08960000
*              ALLOCATION OF EACH OF THE UNIQUELY NAMED FILES         * 08980000
*                                                                     * 09000000
*                                                                     * 09020000
FINDUCB  MVI   XSEENTRY,ZERO            SET ENTRY SWITCH TO ZERO        09040000
         L     DBR1,16                  LOAD PTR TO CVT                 09060000
         L     DBR1,0(DBR1)             LOAD POINTER TO TCB POINTE      09080000
         L     DBR1,4(DBR1)            LOAD CURRENT TCB        @ZA07392 09100004
         L     DBR1,12(DBR1)            LOAD TIOT POINTER               09120000
         LA    DBR1,24(DBR1)            ADJ TIOT POINTER TO POINT TO DD 09140000
         L     DBCOMPR,IEHMVV40                                         09160000
UCB1     CLC   40(8,DBCOMPR),4(DBR1)                                    09180000
         BE    UCBFOUND                 BRANCH IF YES                   09200000
     SR   DBR3,DBR3                                                     09220000
    IC  DBR3,0(DBR1)                                                    09240000
         AR    DBR1,DBR3                BUMP POINTER TO NEXT DD ENTRY   09260000
    IC  DBR3,0(DBR1)                                                    09280000
         LTR   DBR3,DBR3                IS LENGTH ZERO                  09300000
         BZ    NOFIND1                 YES NO DD MATCH WAS MADE  A38756 09320021
         B     UCB1                     LOOP TO CONTINUE SEARCH         09340000
UCBFOUND EQU   *                                               @ZM30153 09360003
         SR    R1,R1                    CLEAR REGISTER         @ZM30153 09362003
         ICM   R1,3,18(DBR1)            LOAD UCB PTR           @ZM30153 09370003
         ST    R1,IEHMVV31                                              09380000
         XC    IEHMVV39+5(3),IEHMVV39+5 CLEAR NAME GENERATEOR COUNTS    09400000
         MVI   IEHMVV31,X'80'                                           09420000
*                                       *** BUILD JFCB TO CALL DADSM**  09440000
         SPACE 1                                                        09460000
*              COMPUTE THE NUMBER OF TRACKS FOR ANY DIRECT ACCESS       09480000
*              DEVICE BY USING THE DEVICE CHARACTERISTICS               09500000
         SPACE 1                                                        09520000
         STM   DEV14,DEV3,DEVSAVE                                       09540000
         L     DEV14,IEHMVV40          GET ADDRESS OF SYSUT1 DDNAME     09560000
         LA    DEV1,40(0,DEV14)         FROM SYSUT1 DCB                 09580000
         DEVTYPE (1),DEVCHAR,DEVTAB     GET DEVICE CHARACTERISTICS      09600000
         TM    DEVCHAR+2,X'20'         TEST FOR DIRECT ACCESS           09620000
         BZ    DEVCONT                 BRANCH IF NOT D. A.              09640000
         TM    DEVCHAR+RPS,X'10'     RECORD READY FEATURE AVAIL. S20201 09645020
         BZ    ALLOC                   NO - CONTINUE             S20201 09650020
         OI    IEHMVV20+VMIT,X'04'     TURN ON RECORD READY BIT  S20201 09655020
ALLOC    L     DEV15,IEHMVV50          GET THE NO. OF TRACKS NOW S20201 09665020
         LA    DEV15,0(0,DEV15)        COMPUTED AND PLACE IN REGISTER   09680000
         SR    DEV0,DEV0                                                09700000
         LR    DEV2,DEV0                                                09720000
         LA    DEV1,88                  PICK ASSUMED KEYED RECORD       09740000
*                                          LENGTH OF 88 BYTES           09760000
         TM    DEVCHAR+17,TOLANCE       TEST FOR DEVICE TOLERANCE       09780000
         BZ    NOTOL                    BRANCH IF NO TOLERANCE          09800000
         MH    DEV1,DEVCHAR+18          MULTIPLY BY TOLERANCE           09820000
         SRL   DEV1,9                   DIVIDE RESULT BY 512            09840000
NOTOL    LH    DEV3,DEVCHAR+12          PICK UP MAXIMUM TRACK LENGTH    09860000
         SR    DEV3,DEV1                SUBTRACT OFF RECORD SIZE TIMES  09880000
*                                          TOLERANCE IF ANY             09900000
         TM    DEVCHAR+OVHED1,X'08'    2-BYTE COUNT TEST         S20201 09904020
         BZ    NOTOL1                  NO - CONTINUE             S20201 09908020
         LH    DEV0,DEVCHAR+OVHED      GET OVERHEAD VALUE        S20201 09912020
         B     CHANGED                 CONTINUE                  S20201 09916020
NOTOL1   IC    DEV0,DEVCHAR+15         PICK UP OVERHEAD FACTOR   S20201 09926020
*                                          KEYED LAST RECORD            09940000
         SR    DEV3,DEV0                SUBTRACT OFF OVERHEAD FACTOR    09960000
         IC    DEV0,DEVCHAR+14          PICK UP OVERHEAD FACTOR FOR     09980000
*                                          KEYED NON LAST RECORD        10000000
CHANGED  AR    DEV1,DEV0            SUBTRACT OFF OVERHEAD FACTOR S20201 10020020
         DR    DEV2,DEV1                DIVIDE TRACK LENGTH MINUS LAST  10040000
*                                          RECORD LENGTH BY NON LAST    10060000
*                                          RECORD LENGTH                10080000
         LA    DEV3,1(DEV3)             INCREMENT RECORD COUNT BY ONE   10100000
*                                          FOR LAST RECORD              10120000
         LA    DEV14,21                 PICK UP NUMBER OF 88 BYTE       10140000
*                                          KEYED RECORDS THAT WILL FIT  10160000
*                                          ON ONE TRACK OF A 2311       10180000
         MR    DEV14,DEV14              CALCULATE TOTAL NUMBER OF       10200000
*                                          RECORDS NEEDED               10220000
         DR    DEV14,DEV3               CALCULATE NUMBER OF RECORDS     10240000
*                                          BY NUMBER THAT WILL FIT ON   10260000
*                                          A TRACK OF DEVICE TO BE      10280000
*                                          USED                         10300000
         ST    DEV15,IEHMVV50           STORE, NUMBER OF TRACKS NEEDED  10320000
DEVCONT  LM    DEV14,DEV3,DEVSAVE                                       10340000
         SPACE 1                                                        10360000
         MVC   IEHMVV00(176),JFCB1      MOVE SKELETON JFCB TO WORK AREA 10380000
         MVC   IEHMVV00+152(3),IEHMVV50+1   NUMBER OF TRKS TO JFCB      10400000
         CLI   DEVCHAR+3,X'05'          TEST FOR 2321            S20201 10406000
         BC    7,NOT2321                                         S20201 10412000
         MVC   IEHMVV00+118(6),4(R1)    IF YES DISPLACEMENT TO VOL      10418013
*                                          SER IS DIFFERENT SINCE       10424013
*                                          A SUB UCB IS POINTED TO      10430013
         B     GO                                                       10436013
NOT2321  MVC   IEHMVV00+118(6),28(R1)   MOVE VOL SER FROM UCB TO JFCB   10442013
GO       MVI   IEHMVV00+124,X'40'       VOL SER NO DELIMETER            10448013
         MVC   IEHMVV00(2),ASTRISK     PROTECT DSNAME WITH PRECEDING    10460000
*                                      ASTRISK                          10480000
         ST    R1,SAVEREG1             SAVE REG1               @ZA07393 10481004
         TIME  ,                                               @ZA07393 10482004
         XC    DW,DW                   CLEAR CONVERSION AREA   @ZA07393 10483004
         LR    R6,R1                   GET DATE IN REG6        @ZA07393 10484004
         STH   R1,DW+6                 STORE DAY 'DDC'         @ZA07393 10485004
         CVB   R1,DW                   CONVERT TO BINARY       @ZA07393 10486004
         STH   R1,DW+6                 STORE IT                @ZA07393 10487004
         MVC   IEHMVV00+81(2),DW+6     MOVE DAY INTO JFCB      @ZA07393 10488004
         SRDL  R6,4                    PUT 'C' INTO REG7       @ZA07393 10489004
         SRL   R6,12                   REMOVE DAY 'DDD'        @ZA07393 10490004
         SLDL  R6,4                    PUT BACK 'C'            @ZA07393 10491004
         STH   R6,DW+6                 STORE YEAR 'YYC'        @ZA07393 10492004
         CVB   R1,DW                   CONVERT TO BINARY       @ZA07393 10493004
         STC   R1,IEHMVV00+80          MOVE YEAR INTO JFCB     @ZA07393 10494004
         L     R1,SAVEREG1             RESET REG1              @ZA07393 10495004
DUPNAME  TIME  ,                       GET TIME                @ZA00101 10500002
         ST    R0,DV                   STORE CLOCK TIME        @ZA00101 10530002
         OI    DV+3,X'0F'              SET SIGN BYTE           @ZA00101 10560002
         UNPK  IEHMVV00+10(7),DV(4)    UNPACK                  @ZA00101 10590002
         MVC   IEHMVV00+2(8),DDNAMES+16 MOVE SYSUT1.T TO JFCB  @ZA00101 10620002
         MVC   IEHMVV87(8),IEHMVV00+9  SAVE TIME FOR SCRATCH   @ZA03372 10650003
         LA    R3,IEHMVV00             ADDRESS OF VOLITAC      @ZA00101 10680002
*                                      WORK AREAA              @ZA00101 10710002
         ST    R3,IEHMVV31+4           STORE ADDRESS           @ZA00101 10740002
         BAL   DBCOMPR,CALLDAD         ALLOCATE **SYSUT1       @ZA00101 10770002
         SR    R15,R6                  CHECK RETURN CODE       @ZA00101 10800002
         BZ    DUPNAME                 DUPLICATE NAME          @ZA00101 10830002
         BM    DAD1                    GOOD ALLOCATE           @ZA00101 10860002
NOFIND1  MVC   IEHMVV39+5(3),XFF       INDICATE NONE OF THE    @ZA00101 10890002
*                                      WORKFILES WAS ALLOCATED @ZA00101 10920002
         B     NOFIND                  AND ABORT               @ZA00101 10950002
DAD1     DS    0H                                              @ZA00101 10980002
         MVC   TTRSAVE(3),IEHMVV00+53  SAVE TTR FOR OPEN       @ZA00101 11010002
         MVI   IEHMVV00+7,X'F2'        MAKE NAME **SYSUT2.T    @ZA00101 11040002
         BAL   DBCOMPR,CALLDAD         ALLOCATE **SYSUT2       @ZA00101 11070002
         SR    R15,R6                  CHECK RETURN CODE       @ZA00101 11100002
         BM    DAD2                    GOOD ALLOCATE           @ZA00101 11130002
         MVC   IEHMVV39+6(2),XFF       INDICATE **SYSUT2 AND   @ZA00101 11160002
*                                      **SYSUT3 NOT ALLOCATED  @ZA00101 11190002
         B     NOFIND                  AND ABORT               @ZA00101 11220002
DAD2     DS    0H                                              @ZA00101 11250002
         MVC   TTRSAVE+3(3),IEHMVV00+53 SAVE TTR FOR OPEN      @ZA00101 11280002
         MVI   IEHMVV00+155,X'44'      PREP JFCBCTRI FOR SLL   @ZA00101 11310002
         L     DBCOMPR,IEHMVV00+152    DOUBLE THE ALLOCATION   @ZA00101 11340002
         SLL   DBCOMPR,1               FOR SYSUT3 WORK FILE    @ZA00101 11370002
         ST    DBCOMPR,IEHMVV00+152    PUT IT IN JFCB          @ZA00101 11400002
         MVI   IEHMVV00+7,X'F3'        MAKE NAME **SYSUT3.T    @ZA00101 11430002
         BAL   DBCOMPR,CALLDAD         ALLOCATE **SYSUT3       @ZA00101 11460002
         SR    R15,R6                  CHECK RETURN CODE       @ZA00101 11490002
         BM    DAD3                    GOOD ALLOCATE           @ZA00101 11520002
         MVC   IEHMVV39+7(1),XFF       INDICATE **SYSUT3 NOT   @ZA00101 11550002
*                                      ALLOCATED               @ZA00101 11580002
         B     NOFIND                  AND ABORT               @ZA00101 11610002
DAD3     DS    0H                                              @ZA00101 11640002
         MVC   TTRSAVE+6(3),IEHMVV00+53    SAVE TTR FOR OPEN     S21042 11710021
         B     CALLDAD1                                                 11720000
CALLDAD  DS    0H                                                       11740000
         LA    R1,IEHMVV31                                              11760000
         L     R0,IEHMVV31+4                                            11780000
         SVC   32                       CALL DADSM                      11800000
         LA    DADR1,4                  TEST RETURNS FROM DADSM         11820000
         SLL   R15,8                    CLEAR LEFTMOST BYTE OF REG 15   11840000
         SRL   R15,8                                                    11860000
         B     0(DBCOMPR)              RETURN TO CALLER          S21042 11880021
*                                                                       11940000
*                             ASSEMBLER DC STATEMENTS                   11960000
*                                                                       11980000
ACON     DC    A(IEHMVESE-IEHMVXSE)     USED TO SET UP ADDRESSABILITY   12000000
*                                       FOR ALTERNATE ENTRY,IEHMVESE    12020000
ECKEY    DC    C'POWER='                                                12040000
LINECNT  DC    CL8'LINECNT='            USED FOR PAGE CONTROL           12060000
DSIX     DC    H'06'                                                    12080000
DEVSAVE  DS    6F                       REGISTER SAVE AREA              12100000
DEVCHAR  DS    5F                      DEVICE CHARACTERISTICS AREA      12120000
DW       DS    D                                               @ZA07393 12126004
SAVEREG1 DS    F                                               @ZA07393 12132004
*                             FOLLOWING ARE THE DDNAMES NORMALLY USED   12140000
*                             BY THE MOVE/COPY PROGRAM                  12160000
DDNAMES  DC    CL8'SYSIN'                                               12180000
         DC    CL8'SYSPRINT'                                            12200000
         DC    CL8'SYSUT1.T'                                   @ZA00101 12220002
TTRSAVE  DS    9X    DSCBTTR SAVE AREA FOR SYSUT WORKFILES       S21042 12270021
ASTRISK  DC    C'**'                                                    12280000
DV       DS    F                                               @ZA00101 12285002
FOUR     DC    F'4'                                             YA01194 12290016
JFCB1    DS    0F                                                       12300000
JDSNAME  DC    22X'4040'                                                12320000
         DC    8X'40'                                                   12340000
JTSDM    DC    1X'08'                  SUPPRESS OPEN FROM        A23994 12350018
*                                      PUTTING THE JFCB ON THE Q A23994 12360018
         DC    13X'00'                                                  12380000
         DC    1X'00'                                                   12400000
         DC    1X'00'                                          @ZM33040 12420003
         DC    2X'00'                                                   12440000
         DC    2X'00'                                                   12460000
         DC    8X'00'                                                   12480000
         DC    3X'00'                                                   12500000
         DC    3X'00'                                                   12520000
         DC    1X'00'                                                   12540000
         DC    1X'C0'                                                   12560000
         DC    24X'00'                                                  12580000
         DC    4X'00'                                                   12600000
         DC    1X'00'                                                   12620000
         DC    1X'01'                                                   12640000
JVOLSER  DC    30X'00'                                                  12660000
         DC    1X'00'                                                   12680000
         DC    3X'00'                                                   12700000
JPRIQUAN DC    FL3'20'                                                  12720000
JSPACPAR DC    X'88'                                               9754 12740017
         DC    XL3'00'                                                  12760000
         DC    1X'00'                                          @ZM33040 12780003
         DC    3X'00'                                                   12800000
         DC    3X'00'                                                   12820000
         DC    2X'00'                                                   12840000
         DC    3X'00'                                                   12860000
         DC    3X'00'                                                   12880000
         DC    X'00'                                                    12900000
         DC    X'00'                                                    12920000
*                                                                       12940000
*                                                                       12960000
*                             THIS ROUTINE BUILDS UNIQUE DSNAMES        12980000
*                             FOR THE WORK FILES                        13000000
*                                                                     * 13220000
*                                                                     * 13240000
*              THE UNIQUE NAME THAT EACH WORK FILE WAS ALLOCATED      * 13260000
*              WITH IS AGAIN DEVELOPED AND PLUGGED INTO A JFCB        * 13280000
*              AND EACH WORK FILE IS OPENED   USING  OPEN J           * 13300000
*                                                                     * 13320000
*                                                                     * 13340000
CALLDAD1 DS    0H                                                       13360000
         L     R6,IEHMVV40                                              13380000
         L     R7,IEHMVV41                                              13400000
         L     R2,IEHMVV42                                              13420000
         L     DBCOMPR,IEHMVV10         LOAD ADDR OF PERM WORK AREA     13440000
         LA    DBR1,IEHMVV00+176        LOAD ADDR OF WORD PAST JFCB     13460000
         ST    DBR1,IEHMVV00+176        STORE THE ADDR IN THE WORD      13480000
         L     DBR1,IEHMVV40            LOAD ADDR OF SYSUT1 DCB         13500000
         MVC   37(3,DBR1),IEHMVV00+177  MOVE 3 BYTE --ADDR OF DCB EXLST 13520000
         L     DBR1,IEHMVV41           LOAD ADDR SYSUT2 DCB             13540000
         MVC   37(3,DBR1),IEHMVV00+177 MOVE EXLIST PTR TO UT2  DCB      13560000
         L     DBR1,IEHMVV42           LOAD ADDR OF SYSUT3 DCB          13580000
         MVC   37(3,DBR1),IEHMVV00+177 MOVE EXLST PTR INTO UT3 DCB      13600000
         LA    DBR1,IEHMVV00            LOAD ADDR OF JFCB FOR OPEN J    13620000
         ST    DBR1,IEHMVV00+176        STORE ADDR IN EXIT LIST         13640000
         MVI   IEHMVV00+176,X'87'       SET CODE IN LEFT BYTE OF EXLST  13660000
         MVC   IEHMVV00(2),ASTRISK      MOVE DSNAME PROTECTION ASTRISK  13680000
         MVI   IEHMVV00+7,X'F1'        MAKE NAME **SYSUT1.T    @ZA00101 13700002
         MVC   0(RENT3-RENT2,DBCOMPR),RENT2 MOVE OPEN TO WORK AREA      13780000
         MVC   IEHMVV00+53(3),TTRSAVE  DSCBTTR IN JFCB FOR OPEN  S21042 13790021
         BALR  R10,DBCOMPR             BRANCH TO OPEN DCB               13800000
         XC    37(3,R6),37(R6)       CLEAR SYSUT1 DCB EXITLIST @ZA07360 13810004
         MVI   IEHMVV00+7,X'F2'        MAKE NAME **SYSUT2.T    @ZA00101 13820002
         MVC   0(RENT4-RENT3,DBCOMPR),RENT3 MOVE OPEN TO WORK AREA      13900000
         MVC   IEHMVV00+53(3),TTRSAVE+3 DSCBTTR IN JFCB FOR OPEN S21042 13910021
         BALR  R10,DBCOMPR              BRAMCH TO OPEN DCB              13920000
         XC    37(3,R7),37(R7)       CLEAR SYSUT2 DCB EXITLIST @ZA07360 13930004
         MVI   IEHMVV00+7,X'F3'        MAKE NAME **SYSUT3.T    @ZA00101 13940002
         MVC   0(RENT5-RENT4,DBCOMPR),RENT4 MOVE OPEN TO WORK AREA      14020000
         MVC   IEHMVV00+53(3),TTRSAVE+6 DSCBTTR IN JFCB FOR OPEN S21042 14030021
         BALR  R10,DBCOMPR              BRAMCH TO OPEN DCB              14040000
         XC    37(3,R2),37(R2)       CLEAR SYSUT3 DCB EXITLIST @ZA07360 14050004
         XC    IEHMVV00(200),IEHMVV00   CLEAR VOLITAL WORK AREA         14060000
         XC    0(100,DBCOMPR),0(DBCOMPR) CLEAR THE PERM WORK AREA       14080000
         MVI   XSEENTRY,ZERO            RESET REENTRY SWITCH            14100000
*                                                                     * 14120000
*                                                                     * 14140000
*              AT THIS POINT CONTROL IS TRANSFERD TO THE IEHMOVE      * 14160000
*              REQUEST ANALIZER ROUTINES   THE FIRST MODULE IS        * 14180000
*              IEHMVSST                                               * 14200000
*                                                                     * 14220000
*                                                                     * 14240000
      IEHPOST (14),T                                                    14260000
         L     R14,12(R0,R13)                                           14280000
         XCTL  (2,12),EP=IEHMVEST                                       14300000
NOFIND   LA    R2,16                    CAUSE RENTRY TO ESK             14320000
         LA    R3,16                    MESSAGE NUMBER                  14340000
         B     ESAEXIT                                                  14360000
RENT1    DS    0F                                                       14380000
         DROP  BASE                                                     14400000
         USING *,DBCOMPR                                                14420000
         OPEN  ((DBR1),INPUT,(DBR3),OUTPUT)                             14440000
         BR    R10                      RETURN TO MAIN FLOW             14460000
         DROP  DBCOMPR                                                  14480000
         USING IEHMVXSE,BASE                                            14500000
RENT2    DS    0F                                                       14520000
         DROP  BASE                                                     14540000
         USING *,DBCOMPR                                                14560000
         OPEN  ((R6),OUTIN),TYPE=J                                      14580000
         BR    R10                      RETURN TO MAIN FLOW             14600000
         DROP  DBCOMPR                                                  14620000
         USING IEHMVXSE,BASE                                            14640000
RENT3    DS    0F                                                       14660000
         DROP  BASE                                                     14680000
         USING *,DBCOMPR                                                14700000
         OPEN  ((R7),OUTIN),TYPE=J                                      14720000
         BR    R10                      RETURN TO MAIN FLOW             14740000
         DROP  DBCOMPR                                                  14760000
         USING IEHMVXSE,BASE                                            14780000
RENT4    DS    0F                                                       14800000
         DROP  BASE                                                     14820000
         USING *,DBCOMPR                                                14840000
         OPEN  ((R2),OUTIN),TYPE=J                                      14860000
         BR    R10                      RETURN TO MAIN FLOW             14880000
         DROP  DBCOMPR                                                  14900000
         USING IEHMVXSE,BASE                                            14920000
RENT5    DS    0F                                                       14940000
*                             THIS ROUTINE IS USED TO CLEAR 2000 BYTES  14960000
*                             OF THE MOVE/COPY COMMUNICATION REGION     14980000
*                                                                       15000000
CLEAR    LTR   R0,R0                    IS LENGTH ZERO?                 15020000
         BE    0(R0,R14)                YES.RETURN TO MAIN FLOW         15040000
         MVI   0(R1),ZERO               SET PROPAGATION BYTE            15060000
         BCTR  R0,R0                                                    15080000
         LTR   R0,R0                    IS LENGTH ZERO?                 15100000
         BE    0(R0,R14)                YES.RETURN TO MAIN FLOW         15120000
         LA    R15,255                  PUT MAXIMUM PROPAGATION         15140000
*                                       FACTOR IN REG 15                15160000
CLEAR3   CLR   R0,R15                   IS MAXIMUM LARGER THAN LENGTH   15180000
*                                       TO BE CLEARED?                  15200000
         BNH   CLEAR2                   YES                             15220000
         EX    R15,CLEAR1               EXECUTE MOVE INSTRUCTION,       15240000
         SR    R0,R15                   REDUCT LENGTH TO BE CLEARED,    15260000
         AR    R1,R15                   ADJUST POINTER TO NEXT AREA AND 15280000
         B     CLEAR3                   LOOP BACK TO EXECUTE MOVE AGAIN 15300000
CLEAR2   LTR   R0,R0                                                    15320000
         BE    0(R0,R14)                IF FINISHED RETURN              15340000
         XR    R15,R0                                                   15360000
         XR    R0,R15                                                   15380000
         XR    R15,R0                   OTHERWISE, CLEAR REMAINING      15400000
         EX    R15,CLEAR1               AREA AND RETURN                 15420000
         BR    R14                                                      15440000
CLEAR1   MVC   1(1,R1),0(R1)                                            15460000
         DS    0F                                                A48763 15480022
H37      DC    XL2'13'                 NMBR OF '.*'              A44310 15500021
SE       DC    C'SE'                                                    15520000
MINUS    DC    X'80000000'                                              15540000
H256     DC    H'256'                                            A48763 15540422
FOXES    DC    X'0000FFFF'              ZERO LEFT HALF         @ZM30153 15540803
SYSDCB   DS    0F                                                  BS0H 15542017
         DC    X'85'                   SYSIN DCB EXIT              BS0H 15544017
         DC    AL3(EXITSYS)                                        BS0H 15546017
DCBPRT   DS    0F                                                  BS0H 15548017
         DC    X'85'                   DCB EXIT FOR SYSPTINT       BS0H 15550017
         DC    AL3(DCBPRTS)                                        BS0H 15552017
DISP1    DC    A(LOC1-DCB1)                                             15560000
DISP2    DC    A(LOC2-DCB2)                                             15580000
DISP3    DC    A(LOC3-DCB3)                                             15600000
DISP4    DC    A(LOC4-DCB4)                                             15620000
DISP5    DC    A(LOC5-DCB5)                                             15640000
LOC1     DS    0F                                                       15660000
DCB1     DCB   DSORG=PS,                                               C15680000
               MACRF=(GM),                                             C15700000
               RECFM=FB,                                               C15720000
               LRECL=80,                                               C15740000
               EXLST=SYSDCB,                                       BS0HC15770017
               BUFNO=1,                                                C15800000
               DDNAME=SYSIN                                             15820000
LOC2     DS    0F                                                       15840000
DCB2     DCB   DDNAME=SYSPRINT,                                        C15860000
               DSORG=PS,                                               C15880000
               RECFM=FBA,                                              C15900000
               LRECL=121,                                              C15920000
               EXLST=DCBPRT,                                       BS0HC15950017
               BUFNO=1,                                                C15980000
               MACRF=(PM)                                               16000000
LOC3     DS    0F                                                       16020000
DCB3     DCB   DDNAME=SYSUT1,                                          *16040000
               DSORG=PS,                                               *16060000
               MACRF=(RCP,WCP),                                        X16080000
               DEVD=DA,                                                *16100000
               KEYLEN=12,                                              X16120000
               RECFM=U,                                                C16140000
               BLKSIZE=666,                                            C16160000
               BUFNO=1,                                                *16180000
               NCP=1                                                    16200000
LOC4     DS    0F                                                       16220000
DCB4     DCB   DDNAME=SYSUT1,                                          C16240000
               MACRF=(RCP,WCP),                                        X16260000
               DSORG=PS,                                               X16280000
               DEVD=DA,                                                X16300000
               KEYLEN=8,                                               X16320000
               RECFM=U,                                                C16340000
               BLKSIZE=666,                                            C16360000
               NCP=1                                                    16380000
LOC5     DS    0C                                                       16400000
DCB5     DCB   DDNAME=SYSUT1,                                          C16420000
               MACRF=(RCP,WCP),                                        C16440000
               DSORG=PS,                                               X16460000
               DEVD=DA,                                                X16480000
               KEYLEN=4,                                               X16500000
               RECFM=U,                                                X16520000
               BLKSIZE=87,                                             C16540000
               NCP=1                                                    16560000
LOC6     DS    0C                                                       16580000
PRNTAREA DC    15XL8'0'                                                 16600000
XFF      DC    XL3'FFFFFF'                                       A37897 16610021
ECDSECT  DSECT                                                          16620000
ECSAVE   DS    6F                      SAVE AREA FOR 2-7                16640000
         DS    D                                                        16660000
ECDBL    DS    D                       DBL WORD WORK AREA               16680000
         IEHMVV                                                         16700000
XSEENTRY EQU   IEHMVV27+4                                               16720000
         END                                                            16740000
./  ADD  SSI=62450121,NAME=IEHMVXSF
*TITLE 'IEHMVXSF                                                      * 00020000
*FUNCTION/OPERATION: THE FUNCTION OF IEHMVXSF IS TO ADJUST THE INPUT  * 00040000
*PARAMETERS FOR THE VOLUME MOUNT ROUTINE, IEHMVSSF; PASS CONTROL TO   * 00060000
*THAT ROUTINE AND UPON RETURN XCTL TO THE ROUTINE WHICH XCTL'ED TO    * 00080000
*IEHMVXSF                                                             * 00100000
*ENTRY POINTS: IEHMVXSF                                               * 00120000
*INPUT: REGISTER 3 - POINTER TO PARAMETER LIST REGISTER 4 - LAST TWO  * 00140000
*CHARACTERS OF ROUTINE WHICH IS TO BE RETURNED TO REGISTER 1 -        * 00160000
*PARAMETER LIST POINTER PASSED TO IEHMVSSF                            * 00180000
*EXTERNAL ROUTINES: IEHMVSSF                                          * 00200000
*EXITS - NORMAL TO ROUTINE SPECIFIED AS INPUT TO IEHMVXSF             * 00220000
*ERRORS: NONE                                                         * 00240000
*TABLES/WORK AREAS: NONE                                              * 00260000
*ATTRIBUTES: REUSEABLE                                                * 00280000
*NOTES: IN LOAD MODULE WITH IEHMVSSF AND DEVICE MASK TABLE            * 00300000
*                                                                       00320000
*                                                                       00340000
*                                                                       00360000
IEHMVXSF CSECT                                                          00380000
*                                                                       00400000
*                             REGISTER NOTATION AND USAGE               00420000
*                                                                       00440000
R0       EQU   0                        PARAM REG                       00460000
R1       EQU   1                        PARAM REG                       00480000
R3       EQU   3                        WORK REG                        00500000
R4       EQU   4                        WORK REG                        00520000
R12      EQU   12                       BASE FOR COMMUNICATION AREA     00540000
R14      EQU   14                       RETURN REG                      00560000
R15      EQU   15                       BASE AND ENTRY POINT REG        00580000
*                                                                       00600000
*                             THIS CONTROL SECTION EXISTS FOR THE       00620000
*                             PURPOSE OF ADJUSTING THE LINKAGE REGISTER 00640000
*                             VALUES TO CONFORM TO STANDARD USAGE PRIOR 00660000
*                             TO PASSING CONTROL TO THE VOLUME MOUNTING 00680000
*                             ROUTINE.                                  00700000
*                                                                       00720000
         USING IEHMVXSF,R15             SET UP ADDRESSABILITY           00740000
         LR    R1,R3                    ADJUST PARAMETERS               00760000
         LR    R0,R14                                                   00780000
         L     R15,VOLMT                GET ADDRESS OF VOLUME MOUNT RTN 00800000
         BALR  R14,R15                  GO TO VOLUME MOUNT ROUTINE      00820000
         USING IEHMVV,R12                                               00840000
         DROP  R15                                                      00860000
         USING *,R15                    RELOAD ADDRESSABILITY           00880000
         LR    R15,R14                                                  00900000
         LR    R14,R0                   ON RETURN FROM VOLUME MOUNT,    00920000
         STH   R4,RETURNTO             SET UP RETURN NAME AND XCTL      00940000
         OI    IEHMVV20+4,X'10'              INDICATION                 00960000
         XCTL  EPLOC=XCTL                                               00980000
    DS   0F                                                             01000000
XCTL     DC    C'IEHMVE'                                                01020000
RETURNTO DC    C'  '                                                    01040000
VOLMT    DC    A(IEHVOLMT)                                              01060000
    EXTRN  IEHVOLMT                                                     01080000
         IEHMVV                                                         01100000
         END                                                            01120000
