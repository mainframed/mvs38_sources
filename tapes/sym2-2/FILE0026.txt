./  ADD  SSI=81730289,NAME=BNGCDISP
         PRINT OFF                                                      00050007
         MACRO                                                          00050407
&NAME    BNGHJN &LABEL,&HJN                                             00050807
         LCLC  &HJA,&HJB                                                00051207
&HJA     SETC  '&SYSPARM'(1,4)                                          00051607
&HJB     SETC  '&SYSPARM'(5,4)                                          00052007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00052407
         B     &LABEL .                 BR AROUND CONSTANTS             00052807
         SPACE 2                                                        00053207
.NOBRNCH ANOP                                                           00053607
         AIF   ('&NAME' EQ '').NOLABEL                                  00054007
         DC    C'&NAME' .              MODULE IDENTIFIER                00054407
.NOLABEL ANOP                                                           00054807
         DC    X'&HJA' .                DATE OF MODIFICATION            00055207
         AIF   ('&HJN' NE 'HJN').DATE                                   00055607
         DC    X'&HJB' .                HJN OF MODIFICATION             00056007
.DATE    ANOP                                                           00056407
         AIF   ('&LABEL' EQ '').NOLBL                                   00056807
         SPACE 2                                                        00057207
&LABEL   DS    0H                                                       00057607
.NOLBL   ANOP                                                           00058007
         MEND                                                           00058407
         PRINT ON                                                       00058807
*********************************************************************** 00059207
*                                                                     * 00100000
* MODULE NAME = BNGCDISP                                              * 00150000
*                                                                     * 00200000
* DESCRIPTIVE NAME = CICS DEMF DISPLAY CONTROL MODULE                 * 00250000
*                                                                     * 00300000
* COPYRIGHT = NONE                                                    * 00350000
*                                                                     * 00400000
* STATUS = RELEASE 1, LEVEL 1                                         * 00450000
*                                                                     * 00500000
* FUNCTION = 1) RECEIVES CONTROL FROM CICS;                           * 00550000
*            2) EDITS THE INPUT INTO 6 PARM FIELDS WITH LEFT JUSTIFY; * 00600000
*            3) DOES SYNTAX CHECK ON DEMF COMMANDS AND PARAMETERS;    * 00650000
*            4) DETERMINES WHETHER THE REQUEST IS FOR MENU,REMOTE,    * 00700000
*               LOCAL OR 3270 SCREEN ERROR DISPLAY AND PASSES CONTROL * 00750000
*               TO BNGTMENU,BNGTRMOT,BNGTLOCL OR BNGT3270 SEGMENT     * 00800000
*               ACCORDINGLY WITH PARAMETERS;                          * 00850000
*            5) HANDLES ALL,LINE AND CTRL ERROR DISPLAY REQUEST AND   * 00900000
*               WRITES ITS ERROR INFORMATION TO THE 3270 DISPLAY      * 00950000
*               TERMINAL AND ISSUES SOME OF THE DISPLAY MESSAGES;     * 01000000
*            6) ACCESSES SYS1.DEMFLOG DATA FILE FOR ALL,LINE AND CTRL * 01050000
*               ERROR DISPLAY REQUEST;                                * 01100000
*            7) RETURNS CONTROL TO CICS.                              * 01150000
*                                                                     * 01200000
* NOTES = NONE                                                        * 01250000
*                                                                     * 01300000
*    DEPENDENCIES =                                                   * 01350000
*                                                                     * 01400000
*    THE FOLLOWING ARE CICS TABLES/CONTROL BLOCKS AND THEIR LABELS    * 01450000
*    USED BY DEMF CICS MODULES (BNGCDISP,BNGC3270,BNGCLOCL,BNGCRMOT   * 01500000
*    BNGCMENU) :                                                      * 01550000
*                                                                     * 01600000
*    CICS TABLE AND                                                   * 01650000
*    CONTROL BLOCKS                  LABELS USED                      * 01700000
*    ----------------------          -----------                      * 01750000
*                                                                     * 01800000
*    COMMON SYSTEM AREA              CSATCTBA                         * 01850000
*    (CSA)                                                            * 01900000
*                                                                     * 01950000
*    TERMINAL CONTROL TABLE          TCTTEDA                          * 02000000
*    TERMINAL ENTRY (TCTTE)          TCTTETM                          * 02050000
*                                    TCTTELT                          * 02100000
*                                    TCTTETI                          * 02150000
*                                    TCTTECLT                         * 02200000
*                                    TCTTETEL                         * 02250000
*                                    TCTTETT                          * 02300000
*                                    TCTTEGU                          * 02350000
*                                    TCTTETA                          * 02400000
*                                                                     * 02450000
*    TERMINAL CONTROL TABLE          TCTLELF                          * 02500000
*    LINE ENTRY (TCTLE)              TCTLEFAA                         * 02550000
*                                    TCTLEPI                          * 02600000
*                                    TCTLEMFP                         * 02650000
*                                    TCTLEPA                          * 02700000
*                                    TCTLEDCB                         * 02750000
*                                    TCTLERLN                         * 02800000
*                                                                     * 02850000
*    TERMINAL INPUT/OUTPUT AREA      TIOADBA                          * 02900000
*    (TIOA)                          TIOATDL                          * 02950000
*                                                                     * 03000000
*    TASK CONTROL AREA               TCAFCAAA                         * 03050000
*    (TCA)                           TCAFCAA                          * 03100000
*                                    TCAPCPI                          * 03150000
*                                    TCASCSA                          * 03200000
*                                                                     * 03250000
*    FILE INPUT/OUTPUT AREA          FIOADBA                          * 03300000
*    (FIOA)                                                           * 03350000
*                                                                     * 03400000
*    RESTRICTIONS = NONE                                              * 03450000
*                                                                     * 03500000
*    REGISTER CONVENTIONS = R12 ADDRESS OF TCA                        * 03550000
*                           R13 ADDRESS OF CSA                        * 03600000
*                                                                     * 03650000
*    PATCH LABEL = NONE                                               * 03700000
*    PATCH LABEL = PATCH                                       @OX21950 03720007
*                                                                     * 03750000
* MODULE TYPE =  CICS DISPLAY CONTROL                                 * 03800000
*                                                                     * 03850000
*    PROCESSOR = ASSEMBLER H                                          * 03900000
*                                                                     * 03950000
*    MODULE SIZE = 5632 DECIMAL BYTES                                 * 04000000
*                                                                     * 04050000
*    ATTRIBUTES = QUASI-REENTRANT                                     * 04100000
*                                                                     * 04150000
* ENTRY POINT = BNGCDISP                                              * 04200000
*                                                                     * 04250000
*    PURPOSE = SEE FUNCTION                                           * 04300000
*                                                                     * 04350000
*    LINKAGE = R12 LOADED WITH THE ADDRESS OF TCA                     * 04400000
*              R13 LOADED WITH THE ADDRESS OF CSA                     * 04450000
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 04500000
*              R15 LOADED WITH ENTRY POINT                            * 04550000
*                                                                     * 04600000
* INPUT =  INPUT TIOA                                                 * 04650000
*                                                                     * 04700000
* OUTPUT = OUTPUT TIOA                                                * 04750000
*                                                                     * 04800000
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 04850000
*               00 - OPERATION PERFORMED AS REQUESTED                 * 04900000
*                                                                     * 04950000
* EXIT-ERROR  = NONE                                                  * 05000000
*                                                                     * 05050000
* EXTERNAL REFERENCE = BNGCLOCL,BNGCRMOT,BNGCMENU AND BNGC3270        * 05100000
*                                                                     * 05150000
*    ROUTINES = LOCATE ROUTINE                                        * 05200000
*               MOD1SCAN ROUTINE                                      * 05250000
*               MOD1 TABLE BUILD (AT LABEL S215) ROUTINE              * 05300000
*                                                                     * 05350000
*    DATA AREAS =  TWA (300 BYTES)                                    * 05400000
*                                                                     * 05450000
*    CONTROL BLOCK = DFHCSADS, DFHTCTTE, DFHTCTLE, DFHTCADS,          * 05500000
*                    DFHTIOA, DFHFIOA                                 * 05550000
*                                                                     * 05600000
* TABLES = TABLE    - FUNCTION/COMPANION TABLE                        * 05650000
*          MOD1TAB  - 3277 MODEL 1 TABLE                              * 05700000
*          HXTOEB   - HEX CHARS TO EBCDIC CHARS TABLE                 * 05750000
*          EBTOHX   - EBCDIC CHARS TO HEX CHARS TABLE                 * 05800000
*          LOTOUP   - LOWER TO UPPER CASE CHARS TABLE                 * 05850000
*                                                                     * 05900000
* MACROS = DCBD, DFHFC, DFHSC, DFHTC, DFHPC                           * 05950000
*                                                                     * 06000000
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 06050000
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 06050107
* CHANGE 02  02/22/78  BNGHJN MACRO ADDED                             * 06050207
*A139000                                                       @OZ29900 06050307
*C521500                                                       @OZ30480 06050407
*A489500                                                       @OZ31882 06050507
*D454000-455000                                                @OZ31878 06050607
*C456500-457000,551500-552000,601000-602000,603500-607000      @OZ31878 06050707
*C608500-611000                                                @OZ31878 06050807
*A412000,654500,684000                                         @OZ31885 06050907
*C037000,360500-361500                                         @OX21950 06051007
*A728500                                                       @OX21950 06051107
*                                                                     * 06150000
*********************************************************************** 06200000
BNGCDISP TITLE 'DISPLAY AUDITS INPUT AND DISPLAYS ALL LINES,LINE, CTRL' 06250000
         PRINT OFF                                                      06300000
         COPY  DFHCSADS                                                 06350000
         COPY  DFHTCTTE                                                 06400000
         COPY  DFHTCTLE                                                 06450000
         COPY  DFHTIOA                                                  06500000
         COPY  DFHTCADS                                                 06550000
         PRINT ON                                                       06600000
PARM1    DS    D                   1ST INPUT PARM - DEMF                06650000
PARM2    DS    D                   2ND INPUT PARM - ALL/LINE/CTRL/      06700000
*                                                    3270               06750000
PARM3    DS    D                   3RD INPUT PARM                       06800000
PARM4    DS    D                   4TH INPUT PARM                       06850000
PARM5    DS    D                   5TH INPUT PARM                       06900000
PARM6    DS    D                   6TH INPUT PARM                       06950000
SBACNT   DS    PL1                 COUNT OF SBA'S IN INPUT              07000000
RELREC   DS    CL3                 BDAM RELATIVE BLOCK ADDRESS          07050000
SVRELREC DS    CL3           SAVE AREA FOR LINE/CTRL RELATIVE BLOCK NO. 07100000
DBLWD    DS    D                   DOUBLEWORD WORK AREA                 07150000
DUBLWD   EQU   DBLWD                                                    07200000
FULLWD   DS    F                   FULLWORD WORK AREA                   07250000
TWALINE  DS    F             SAVE AREA FOR CICS SYMBOLIC LINE POINTER   07300000
*   THE TWA FROM HERE UP MUST REMAIN IN THAT ORDER TO MATCH TWALINE     07350000
*         WITH TWATCTID IN THE 3270 PROGRAM.                            07400000
LINEID   DS    XL6                 HARDWARE LINE ADDRESS                07450000
LINENAME DS    CL8           LINE NAME SAVE AREA FOR RECAP HEADER       07500000
CTRLID   DS    X                   HARDWARE CONTROL UNIT ADDRESS        07550000
CTRLNAME DS    CL8           CTRL/CLUSTER NAME WORK AREA FOR OUTPUT     07600000
TERMNAME DS    CL8                 TERML/LOGICAL UNIT NAME WORK AREA    07650000
CLUSNAME DS    CL8           CTRL/CLUSTER NAME SAVE AREA FOR RECAP HDR. 07700000
NEWPARM  DS    C                   NEW-PARM SWITCH                      07750000
CTRPARM  DS    C                   COUNTER OF CHARS STORED IN PARM(X)   07800000
SAVETIOA DS    F                   SAVE AREA FOR ORIGINAL TIOA          07850000
SAVEBBSS DS    F                   SAVE POINTER TO BLK AND SLOT         07900000
TWASLOT  DS    C                   INPUT SLOT COUNT IN HEX              07950000
WRKSLOT  DS    C                   TWASLOT WORK AREA                    08000000
*                                  DISPLACEMENTS IN TIOA                08050000
SAVERCAP DS    F                   SAVEAREA FOR POINTER TO RECAP LINE   08100000
SAVEITEM DS    F                   SAVEAREA FOR POINTER TO FIRST LINE   08150000
*                                  AND CTRL DISPLAYS                    08200000
SLOTCNT  DS    C                   COUNT OF DETAIL SLOTS READ           08250000
ITEMCNT  DS    PL2                 COUNT OF OUTPUT ITEMS IN LINE        08300000
WORKCNT  DS    PL2                 ITEM WORK COUNTER                    08350000
WORK15   DS    CL15                                                     08400000
QUITSW   DS    C             USED TO STOP EDIT OF INPUT ON 3RD SBA      08450000
*                             IF 2ND SBA = L1P7 OR L6P26  ***ALSO*** XH 08500000
*                            USED AS MOD-1 OUTPUT-FULL-SWITCH        XH 08550000
*                               00 = NOT FULL   FF = OUTPUT FULL BUT XH 08600000
*     CONTINUE SCANNING DATA BASE FOR CORRECT ERROR COUNTS           XH 08650000
*********************************************************************** 08700000
MOD1TABL DS    CL64          MAX OF 32 ENTRIES FOR MOD-1 TABLE          08750000
*                              LOCAL TERM = 2-BYTES                     08800000
*                              REMOTE CU AND TERM = 2-BYTES             08850000
TBRELREC DS    CL3           SAVE AREA FOR PAGING 'BBB'                 08900000
TBSLOT   DS    C             SAVE AREA FOR PAGING 'SS'                  08950000
TBCTRL   DS    C             SAVE AREA FOR MDR CTRL UNIT                09000000
TBLINE   DS    CL6           SAVE AREA FOR LINE ADDR OF PAGE            09050000
TBARG    DS    CL2           SAVE AREA FOR TABLE ARGUMENT               09100000
TABLECNT DS    PL2           COUNT OF ENTRIES IN TABLE                  09150000
WKTBLCNT DS    PL2           WORK AREA FOR COUNT OF TABLE ENTRIES       09200000
MOD1SW   DS    X             00 = SWT OFF    FF = SWT ON                09250000
*                            IF ON, PERFORM MOD1 TABLE SCAN             09300000
SOUTLOOP DS    F             SAVE AREA FOR OUTLOOP REGISTER             09350000
*********************************************************************** 09400000
         COPY  DFHFIOA                                                  09450000
CTRLLAST DS    F                   LAST USED ADDR IN DATASET            09500000
CTRLTOTL DS    F                   TOTAL BLOCKS IN DATASET              09550000
CTRLBACK DS    F                   BACKWARD PTR IN CTRL BLK CHAIN       09600000
CTRLFWD  DS    F                   FORWARD PTR IN CTRL BLK CHAIN        09650000
CTRLENTS DS    C                   NBR ENTRIES IN THIS CTRL BLK         09700000
         DS    CL15                FOR FUTURE USE                       09750000
CTRLSLT1 DS    0C                  START OF CTRL SLOT NBR ONE.          09800000
         ORG   FIOADBA                                                  09850000
DATAPORT DS    CL6                 PORT & LIB ADDR                      09900000
DATATIME DS    CL4                 TIME BLOCK CREATED                   09950000
DATADATE DS    CL4                 DATE BLOCK CREATED                   10000000
DATAFWD  DS    CL3                 FORWARD CHAIN ADDR                   10050000
DATABACK DS    CL3                 BACKWAD CHAIN ADDR                   10100000
BLKLTH   DS    CL2                 NBR BYTES USED IN THIS BLOCK         10150000
         DS    CL10                                                     10200000
DATASLT1 DS    0C                  START OF 1ST DATA SLOT               10250000
SLOTS    DSECT           MAP OF ENTRIES IN CONTROL BLOCK                10300000
         USING SLOTS,DATAREG                                            10350000
SLOTLINE DS    CL6                CHANNEL ADDRESS(PORT OR LIB)          10400000
SLOTNBC  DS    CL2                NUMBER OF BLOCKS IN THIS CHAIN        10450000
SLOTHITS DS    CL2                TOTAL HITS ON THIS LINE               10500000
SLOTRFB  DS    CL3                RELATIVE ADDRESS FIRST BLOCK IN CHAIN 10550000
SLOTRLB  DS    CL3                RELATIVE ADDRESS LAST BLOCK IN CHAIN  10600000
SLOTLTH  EQU   *-SLOTS                                                  10650000
         ORG   SLOTS         MAP OF MDR AND OBR IN DETAIL BLOCKS        10700000
DATALTH  DS    C                   LTH OF THIS SLOT                     10750000
LINEIDA  DS    CL6                 LINE AND LIB ADDR                    10800000
ENTRYTYP DS    C                   ENTRY TYPE - MDR OR OBR              10850000
         DS    CL3                                                      10900000
MDRTYPE  DS    C                   TYPE HDWE - 03 EQUALS 3270           10950000
         DS    CL3                                                      11000000
DATE     DS    CL4                 DATE OF ERROR - 00YY0DDF             11050000
TIME     DS    CL4                 TIME OF ERROR - HHMMSSHH             11100000
         DS    CL8                                                      11150000
MDRCUA   DS    CL2                 MDR CHAN & UNIT ADDR                 11200000
MDRCTRL  DS    C                   MDR CTRL UNIT POLL ADDR              11250000
MDRTERM  DS    C                   MDR TERMIL POLL ADDR                 11300000
MDRSTATS DS    CL2                 REMOTE 3270 STATUS                   11350000
         DS    CL2                                                      11400000
OBRCCW   DS    CL8                 LAST CCW EXECUTED                    11450000
OBRCSW   DS    CL8                 CHANNEL STATUS WORD                  11500000
         DS    CL6                                                      11550000
OBRUCB   DS    C                                                        11600000
         DS    CL3                                                      11650000
OBRCUA   DS    CL2                 OBR CHAN & UNIT ADDR                 11700000
OBRCTRL  DS    C                                                        11750000
OBRTERM  DS    C                                                        11800000
         DS    CL12                                                     11850000
OBRSENSE DS    CL2                 OBR SENSE BYTES                      11900000
*********************************************************************** 11950000
BNGCDISP CSECT                                                          12000000
SBA      EQU   X'11'         SET BUFFER ADDRESS                         12050000
SF       EQU   X'1D'         START FIELD                                12100000
IC       EQU   X'13'         INSERT CURSOR                              12150000
UNA      EQU   X'40'         UNPROTECTED,NORMAL INTENSITY, ALPHAMERIC   12200000
PNA      EQU   X'60'         PROTECTED, NORMAL INTENSITY, ALPHAMERIC    12250000
PHA      EQU   X'E8'             PROTECTED, HIGH INTENSITY, ALPHAMERIC  12300000
MNP      EQU   X'61'             PROT,MODIFIED,NORMAL                   12350000
PIA      EQU   X'6D'             PROTECTED,MODIFIED,INVISIBLE,ALPHA     12400000
L1P1     EQU   X'4040'       LINE 1, POSITION 1  BUFFER ADDRESS.        12450000
L1P7     EQU   X'40C6'       LINE 1, POSITION 7  BUFFER ADDRESS.        12500000
L1P36    EQU   X'40E3'       LINE 1, POSITION 36 BUFFER ADDRESS.        12550000
L2P1     EQU   X'C150'       LINE 2, POSITION 1  BUFFER ADDRESS.        12600000
L2P4     EQU   X'C1D3'       PAGE FWD  BUFFER ADDR FOR 3277-2           12650000
L2P44    EQU   X'C17B'       PAGE BKWD BUFFER ADDR FOR 3277-2           12700000
L3P1     EQU   X'C260'       LINE 3, POSITION 1 BUFFER ADDRESS.         12750000
L3P4     EQU   X'C1D3'       LINE 3, POSITION 4 BUFFER ADDRESS.         12800000
L4P1     EQU   X'C3F0'       LINE 4, POSITION 1  BUFFER ADDRESS.        12850000
L4P4     EQU   X'C17B'       PAGE BKWD BUFFER ADDR FOR 3277-1           12900000
L6P26    EQU   X'C6E9'       LINE 6, POSITION 26 BUFFER ADDRESS.        12950000
TCTTEAR  EQU   2             POINTS TO TCTTE                            13000000
BASE1    EQU   3             BASE REGISTER ONE = 0-4095                 13050000
BASE2    EQU   4             BASE REGISTER TWO = 4096-8191              13100000
TIOABAR  EQU   5             POINTS TO TIOA                             13150000
FIOABAR  EQU   6             POINTS TO FIOA                             13200000
PARMREG  EQU   6             POINTS TO PARM AREA                        13250000
OUTREG   EQU   7             POINTS TO DATA IN TIOA AREA                13300000
OUTLOOP  EQU   8             USED FOR LOOPING THRU DATA IN TIOA AREA    13350000
MOD1REG  EQU   8             POINTS TO MOD-1 TABLE (MOD1TABL)           13400000
DATAREG  EQU   9             POINTS TO DATA IN FIOA AREA                13450000
DATALOOP EQU   10            USED FOR LOOPING THRU DATA IN FIOA AREA    13500000
TABLEREG EQU   11            POINTS TO FUNCTION/COMPANION TABLE         13550000
R11      EQU   11            PARMLIST COUNTER WORK REGISTER FOR CTRPARM 13600000
LINKREG  EQU   11            SUBROUTINE LINKAGE                         13650000
R14      EQU   14                                                       13700000
R15      EQU   15                                                       13750000
*********************************************************************** 13800000
         BALR  BASE1,0                                                  13850000
         USING *,BASE1,BASE2                                            13900000
BNGCDISP BNGHJN GO                                             @OZ29900 13920007
         LA    BASE2,2048(BASE1)                                        13950000
         LA    BASE2,2048(BASE2)                                        14000000
         L     TCTTEAR,TCAFCAAA                                         14050000
         LA    TCTTEAR,0(TCTTEAR)                                       14100000
         L     TIOABAR,TCTTEDA                                          14150000
         ZAP   SBACNT,=P'0'        SET SBA COUNTER TO ZERO.             14200000
         TR    TIOADBA(80),LOTOUP  TRANSLATE LOWER CASE TO UPPER CASE.  14250000
         LA    DATAREG,TIOADBA     POINT TO 1ST BYTE IN TIOA.           14300000
         LR    DATALOOP,DATAREG    SETUP DATA LOOP                      14350000
         AH    DATALOOP,TIOATDL                                         14400000
         XC    PARM1(48),PARM1     ZERO OUT PARM FIELDS                 14450000
         LA    PARMREG,PARM1       POINT TO PARMS.                      14500000
         LR    14,PARMREG                                               14550000
         MVI   QUITSW,X'00'        SET QUITSW OFF.                      14600000
         MVI   NEWPARM,C'1'        TURN ON 'NEW PARM' SWITCH.           14650000
         MVI   CTRPARM,X'00'       SET CHARS COUNTER IN PARM = ZERO     14700000
A160     CLI   0(DATAREG),SBA      IS THIS BYTE AN SBA?                 14750000
         BNE   A210                NO. CHECK IT FURTHER.                14800000
         CLI   QUITSW,X'FF'            QUIT SWITCH ON?                  14850000
         BE    C10                          YES.  QUIT EDIT.            14900000
         CLC   1(2,DATAREG),=AL2(L1P7)  IS 2ND SBA = LINE 1 POSN 7?     14950000
         BE    A170                              NO. CONTINUE EDIT      15000000
         CLC   1(2,DATAREG),=AL2(L6P26) IS 2ND SBA = LINE 6 POSN 26?    15050000
         BNE   A180                              NO. CONTINUE EDIT      15100000
A170     MVI   QUITSW,X'FF'            TURN QUIT SWITCH ON              15150000
A180     AP    SBACNT,=P'1'        YES. ADD TO TO SBA COUNTER.          15200000
         LA    DATAREG,2(DATAREG)  BUMP TIOA POINTER BY 2.              15250000
         B     B80                                                      15300000
A210     CLI   0(DATAREG),C'A'     IS IT AN 'A' OR HIGHER?              15350000
         BL    B80                 NO. CHECK NEW PARM SWITCH.           15400000
         CLI   NEWPARM,C'1'        IS FIRST CHAR FOR PARM(X)?           15450000
         BNE   B10                 NO.                                  15500000
         MVI   NEWPARM,C'0'        YES. SET FIRST CHAR IN FOR PARM      15550000
         MVI   CTRPARM,X'00'       SET PARM CHAR CTR = 0                15600000
B10      IC    R11,CTRPARM         LOAD R11 = CTRPARM                   15650000
         LA    R11,1(R11)          ADD CTRPARM = CTRPARM + 1            15700000
         STC   R11,CTRPARM         STORE NEW CTR BACK CTRPARM           15750000
         CLI   CTRPARM,X'08'       IS CHAR COUNT IN PARM OVER 8 ?       15800000
         BH    B50                 YES. GO BACK LOOP WITHOUT STORING    15850000
         MVC   0(1,14),0(DATAREG)  PUT THIS BYTE IN THIS PARM           15900000
         CLI   PARM6+7,X'00'       ARE ALL PARMS USED UP?               15950000
         BNE   C10                 YES. GOTO SYNTAX CHECKING ROUTINE    16000000
         LA    14,1(14)            BUMP PARM POINTER WORKREG.           16050000
B40      LA    DATAREG,1(DATAREG)  BUMP TIOA POINTER.                   16100000
         CR    DATAREG,DATALOOP    IS THERE MORE DATA IN TIOA?          16150000
         BL    A160                YES. GO PROCESS MORE DATA.           16200000
         B     C10                 NO. GOTO SYNTAX CHECKING ROUTINE     16250000
B50      CLC   PARM2(5),=X'F3F2F7F000'  IS THIS A 3270 SCREEN INPUT ?   16300000
         BNE   B40                      NO.                             16350000
         CP    SBACNT,=P'2'        IS THIS NON-FORMATTED INPUT ?        16400000
         BH    B40                 NO.                                  16450000
         B     Z40                 YES. SEND INVALID FORMAT MSG.        16500000
B80      CLI   NEWPARM,C'1'        IS NEW-PARM SWITCH ON?               16550000
         BE    B40                 YES. CHECK FOR MORE DATA.            16600000
         CLI   PARM6,X'00'         NO. ARE ALL PARMS USED UP?           16650000
         BNE   C10                 YES. GOTO SYNTAX CHECKING ROUTINE    16700000
         LA    PARMREG,8(PARMREG)  NO. BUMP TO NEXT NEW PARM.           16750000
         LR    14,PARMREG          POINT WORK REG TO NEXT PARM.         16800000
         MVI   NEWPARM,C'1'        TURN ON NEW-PARM SWICH.              16850000
         B     B40                 GO CHECK FOR MORE DATA.              16900000
*********************************************************************** 16950000
*                                                                     * 17000000
*        AT THIS POINT UP TO 5 PARMS HAVE BEEN EDITED AND             * 17050000
*        ARE LEFT JUSTIFIED WITH TRAILING X'00'S                      * 17100000
*                                                                     * 17150000
*********************************************************************** 17200000
         EJECT                                                          17250000
*********************************************************************** 17300000
*                                                                     * 17350000
*        SYNTAX CHECKING ROUTINE                                      * 17400000
*                                                                     * 17450000
*********************************************************************** 17500000
C10      CLI   QUITSW,X'FF'            IS SBA QUIT SWT ON ?             17550000
         BE    C15                     YES. DATA ENTERED FROM 29 AREA   17600000
         CP    SBACNT,=P'1'            NO. IS SBACNT > 1 ?              17650000
         BH    CC10                    YES. BYPASS SYNTAX CHECK         17700000
         CLI   PARM2,X'00'             IS PARM2 BLANK ?                 17750000
         BE    D80                     YES. GOTO BNGCMENU               17800000
C15      CLC   PARM2(5),=X'D4C5D5E400' IS PARM2=MENU ?                  17850000
         BNE   C20                     NO                               17900000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  17950000
         BE    D80                     YES. GOTO BNGCMENU               18000000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  18050000
C20      CLC   PARM2(4),=X'C1D3D300'   IS PARM2 = ALL ?                 18100000
         BNE   C30                     NO                               18150000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  18200000
         BE    CC10                    YES.GO SCHEDULE APPROPRIATE PGM  18250000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  18300000
C30      CLC   PARM2(6),=X'D3D6C3C1D300'  IS PARM2 = LOCAL ?            18350000
         BNE   C40                        NO                            18400000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  18450000
         BE    CC10                   YES.GO SCHEDULE APPROPRIATE PGM   18500000
         CLC   PARM3+1(2),=C'SS'       IS LOCAL/REMOTE SCREEN ?         18550000
         BE    CC10                   YES.                              18600000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  18650000
C40      CLC   PARM2(6),=X'D9C5D4D6E3C5' IS PARM2 = REMOTE ?            18700000
         BNE   C50                     NO.                              18750000
         CLC   PARM2+7(1),=C'S'        IS REMOTE SCREEN ?               18800000
         BE    C45                     YES.                             18850000
         CLI   PARM2+6,X'00'           IS REMOTE SYNTAX ERROR ?         18900000
         BNE   Z40                     YES. GO ISSUE INVALID FORMAT MSG 18950000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  19000000
         BE    CC10                   YES.GO SCHEDULE APPROPRIATE PGM   19050000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  19100000
C45      CLI   PARM3,X'00'             IS REMOTE SCREEN ?               19150000
         BNE   CC10                   YES.                              19200000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  19250000
C50      CLC   PARM2(5),=X'D3C9D5C500' IS PARM2 = LINE ?                19300000
         BNE   C60                     NO                               19350000
         CLI   PARM4,X'00'             IS PARM4 = 00 ?                  19400000
         BNE   Z40                     NO. GO ISSUE INVALID FORMAT MSG  19450000
C55      CLI   PARM3+3,X'00'           LINE ADDR = 4 OR MORE ?          19500000
         BNE   Z40                     YES.                             19550000
         CLI   PARM3+2,X'00'           LINE ADDR = 2 OR LESS ?          19600000
         BE    Z40                     YES.                             19650000
         LA    DATALOOP,3              SET FOR SCAN 3 CHARS             19700000
         LA    DATAREG,PARM3           SET DATAREG = PARM3 PTR          19750000
C57      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         19800000
         BNL   C59                     YES. IT IS NUMERIC               19850000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          19900000
         BH    Z40                     YES. IT IS INVALID FORMAT        19950000
C59      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       20000000
         BCT   DATALOOP,C57            LOOP                             20050000
         B     CC10                    NO. GO SCHEDULE APPROPRIATE PGM  20100000
C60      CLC   PARM2(5),=X'C3E3D9D300' IS PARM2 = CTRL ?                20150000
         BNE   C70                     NO                               20200000
         CLI   PARM5,X'00'             IS PARM5 = 00 ?                  20250000
         BNE   Z40                     NO.                              20300000
         CLI   PARM4,X'00'             IS PARM4 = 00 ?                  20350000
         BE    C55                     YES.                             20400000
C65      CLI   PARM4+2,X'00'           CTRL ADDR = 3 OR MORE ?          20450000
         BNE   Z40                     YES.                             20500000
         CLI   PARM4+1,X'00'           CTRL ADDR = 1 OR LESS ?          20550000
         BE    Z40                     YES.                             20600000
C66      LA    DATALOOP,2              SET FOR SCAN 2 CHARS             20650000
         LA    DATAREG,PARM4           SET DATAREG = PARM4 PTR          20700000
C67      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         20750000
         BNL   C69                     YES. IT IS NUMERIC               20800000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          20850000
         BH    Z40                     YES. IT IS INVALID FORMAT        20900000
C69      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       20950000
         BCT   DATALOOP,C67            LOOP                             21000000
         B     C55                     NO. GO CHECK LINE ADDR (PARM3)   21050000
C70      CLC   PARM2(5),=X'F3F2F7F000' IS PARM2 = 3270 ?                21100000
         BNE   Z40                     NO.                              21150000
         CLI   PARM6,X'00'             IS PARM6 = 00 ?                  21200000
         BNE   Z40                     NO.                              21250000
         CLI   PARM5,X'00'             IS PARM5 = 00 ?                  21300000
         BE    C75                     YES.                             21350000
         CLI   PARM5+2,X'00'           IS TERMINAL ADDR = 3 OR MORE ?   21400000
         BNE   Z40                     YES.                             21450000
         CLI   PARM5+1,X'00'           IS TERMINAL ADDR = 1 OR LESS ?   21500000
         BE    Z40                     YES.                             21550000
         LA    DATALOOP,2              SET FOR SCAN 2 CHARS             21600000
         LA    DATAREG,PARM5           SET DATAREG = PARM5 PTR          21650000
C72      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         21700000
         BNL   C74                     YES. IT IS NUMERIC               21750000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          21800000
         BH    Z40                     YES. IT IS INVALID FORMAT        21850000
C74      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       21900000
         BCT   DATALOOP,C72            LOOP                             21950000
         B     C65                     NO. GO CHK LINE AND CTRL         22000000
C75      CLI   PARM4,X'00'             IS PARM4 = 00 ?                  22050000
         BNE   Z40                     NO.                              22100000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  22150000
         BE    D10                     YES. BRANCH TO BNGC3270          22200000
*********************************************************************** 22250000
*                                                                     * 22300000
*     THE FOLLOWING CODE CHECKS FOR A CICS SYMBOLIC MATCH             * 22350000
*                                                                     * 22400000
*********************************************************************** 22450000
         MVC   WORK15(8),PARM3         SAVE PARM3                       22500000
         OC    PARM3,=CL8' '           MAKE ZEROS                       22550000
         BAL   LINKREG,CICSLOC         CALL SYMBOLIC NAME CONV. RTN     22600000
         CLI   PARM3+7,X'00'           IS NAME CONVERTED ?              22650000
         BE    D10                     YES. BYPASS SYNTAX CHK           22700000
         MVC   PARM3,WORK15            NO. RESTO PARM3-CONT. SYNTAX CHK 22750000
*        ******************            **************************       22800000
         CLI   PARM3+3,X'00'           IS TERM/LINE = 4 OR MORE ?       22850000
         BNE   Z70                     YES. GO ISSUE SYMBOLIC ERR MSG   22900000
         CLI   PARM3+2,X'00'           IS TERM/LINE = 2 OR LESS ?       22950000
         BE    Z70                     YES. GO ISSUE SYMBOLIC ERR MSG   23000000
         LA    DATALOOP,3              SET FOR SCAN 3 CHARS             23050000
         LA    DATAREG,PARM3           SET DATAREG = PARM3 PTR          23100000
C77      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         23150000
         BNL   C79                     YES. IT IS NUMERIC               23200000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          23250000
         BH    Z70                     YES. IT IS SYMBOLIC ERROR        23300000
C79      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       23350000
         BCT   DATALOOP,C77            LOOP                             23400000
*********************************************************************** 23450000
*                                                                     * 23500000
*        AT THIS POINT UP TO 5 PARMS HAVE BEEN EDITED AND             * 23550000
*        ARE LEFT JUSTIFIED WITH TRAILING X'00'S                      * 23600000
*                                                                     * 23650000
*********************************************************************** 23700000
CC10     CP    SBACNT,=P'3'        CNT OF SBA LESS THAN THREE           23750000
         BL    D10                 YES,THIS IS INIT ENTRY               23800000
*********************************************************************** 23850000
*                                                                     * 23900000
*        ENTRY IS FROM A FORMATTED SCREEN. THEREFORE,                 * 23950000
*        THIS SECTION TRANSFERS CONTROL TO APPROPRIATE                * 24000000
*        COMPANION PROGRAM.                                           * 24050000
*                                                                     * 24100000
*********************************************************************** 24150000
         CLC   PARM2(4),=C'MENU'   IS THIS MENU SCREEN ?                24200000
         BE    D32                 YES. GO CHECK MENU PARAMETERS        24250000
         CLI   TIOADBA+35,C'%'     IS THIS FROM BITS PROMPTER SCR ?  XH 24300000
         BE    C190                YES. GOTO BNGC3270                XH 24350000
         CLI   PARM4,X'00'         IS PARM4 BLANK ?                     24400000
         BE    D80                 YES. USER DID NOT X ANY ENTRIES      24450000
         CLC   TIOADBA+15(2),=X'C1D3'   IS THIS A PAGE FORWARD-LG       24500000
*                                       OR A PAGE BACKWARD-SM?          24550000
         BNE   CC40                YES.                              BB 24600000
         CLI   TCTTETM,X'F1'       IS THIS A 3277-1?                 BB 24650000
         BE    CC60                YES. DO PAGE BACKWARD-SM.         BB 24700000
         B     CC50                NO. DO PAGE FORWARD-LG.           BB 24750000
CC40     CLC   TIOADBA+15(2),=X'C17B'   IS THIS A PAGE BACKWRD-LG?   BB 24800000
         BE    CC60                YES.                              BB 24850000
         CLC   TIOADBA+15(2),=X'406B'   IS THIS A PAGE FORWARD-SM?   BB 24900000
         BNE   C109                NO. MUST BE BLOWUP REQUEST        BB 24950000
CC50     MVC   PARM4(4),=C'PAGE'    SET UP PARMS FOR PAGING          BB 25000000
         MVC   PARM5(7),=C'FORWARD'     FORWARD.                     BB 25050000
         B     D10                  GO TO APPROPRIATE PGM.           BB 25100000
CC60     MVC   PARM4(4),=C'PAGE'    SET UP PARMS FOR PAGING          BB 25150000
         MVC   PARM5(7),=C'BACKWRD'     BACKWARD.                    BB 25200000
         B     D10                  GO TO APPROPRIATE PGM.           BB 25250000
*********************************************************************** 25300000
*                                                                     * 25350000
*     AT THIS POINT, THE REQUEST IS FOR A BLOWUP OF AN ENTRY OF ONE   * 25400000
*     OF THE DISPLAYS. THE FUNCTION/COMPANION TABLE IS SEARCHED FOR   * 25450000
*     THE NAME OF THE PROGRAM TO PERFORM THE NEXT DISPLAY.            * 25500000
*                                                                     * 25550000
*********************************************************************** 25600000
C109     LA    TABLEREG,TABLE      POINT AT FUNCTION/COMPANION TABLE.   25650000
C110     CLC   0(4,TABLEREG),PARM2 PGRM NAME IN TABLE?                  25700000
         BE    C170                YES.                                 25750000
         CLC   0(3,TABLEREG),=C'END'    END OF TABLE?                   25800000
         BE    D30                 YES. GO CK FOR MENU REQUEST          25850000
         LA    TABLEREG,TABLENTY(TABLEREG)  BUMP TO NEXT ENTRY.         25900000
         B     C110                GO CH NEXT ENTRY.                    25950000
C170     OC    4(4,TABLEREG),4(TABLEREG) IS THERE A COMPANION PGRM?     26000000
         BZ    D10                       NO.                            26050000
         MVC   PARM2(4),4(TABLEREG)      MOVE COMPANION NAME TO PARM2.  26100000
         CLC   PARM2(4),=C'TERM'   IS THIS A TERML ERROR REQUEST?       26150000
         BNE   D10                 NO.                                  26200000
C190     DFHPC TYPE=XCTL,PROGRAM=BNGC3270                               26250000
*********************************************************************** 26300000
*                                                                     * 26350000
*        THE FOLLOWING CODE CHECKS ALL SINGLE PARM ENTRIES FOR        * 26400000
*        A CICS SYMBOLIC MATCH.                                       * 26450000
*                                                                     * 26500000
*********************************************************************** 26550000
*********************************************************************** 26600000
*                                                                     * 26650000
*        THIS IS THE CICS SYMBOLIC NAME LOCATE/CONVERT ROUTINE.       * 26700000
*                                                                     * 26750000
*********************************************************************** 26800000
CICSLOC  L     14,CSATCTBA         POINT TO TCT PREFIX.                 26850000
         L     14,4(14)            POINT TO BTAM ADCON LIST.            26900000
D0510    CLC   0(4,14),=X'FFFFFFFF'  ANY MORE LINES TO LOOK AT?         26950000
         BE    D0600               NO. LINE NAME NOT IN CICS TCT.--EXIT 27000000
         L     1,0(14)             POINT TO A LINE.                     27050000
         ST    1,TWALINE           STORE ADDR IN CASE THIS IS IT.       27100000
         TM    TCTLELF,TCTLEFAA    IS THIS A POOLED LINE?               27150000
         BZ    D0520               NO.                                  27200000
         TM    TCTLEPI,TCTLEMFP    YES. IS IT 1ST IN POOL?              27250000
         BZ    D0540               NO. SKIP IT - DOESN'T POINT TO DCB.  27300000
D0520    L     15,TCTLEPA          YES. POINT TO 1ST TERML.             27350000
D0530    CLC   PARM3(4),0(15)      IS THIS OUR TERML?                   27400000
         BE    D0550               YES. HAVE LOCATED ITS LINE ENTRY.    27450000
         TM    (TCTTELT-TCTTETI)(15),TCTTECLT  LAST TERML ON LINE?      27500000
         BO    D0540               YES. GO LOOK AT NEXT LINE.           27550000
         AH    15,(TCTTETEL-TCTTETI)(15)  BUMP TO NEXT TERML.           27600000
         B     D0530                                                    27650000
D0540    LA    14,4(14)            BUMP TO NEXT LINE ADDRESS.           27700000
         B     D0510                                                    27750000
D0550    EQU   *                                                        27800000
         LR    TCTTEAR,15                                               27850000
         CLI   TCTTETT,X'91'       IS THIS A 3277 REMOTE?               27900000
         BE    D0560               YES.                                 27950000
         CLI   TCTTETT,X'92'       IS THIS A 3275?                      28000000
         BE    D0560               YES.                                 28050000
         CLI   TCTTETT,X'99'       IS THIS A 3277 LOCAL?                28100000
         BE    D0560               YES.                                 28150000
         B     D0590               NO. CAN'T USE SYMBOLIC NAME--EXIT    28200000
D0560    L     1,TWALINE           POINT TO THIS TERML'S LINE.          28250000
         L     14,TCTLEDCB         POINT TO THE DCB.                    28300000
         USING IHADCB,14                                                28350000
         DCBD                                                           28400000
BNGCDISP CSECT                                                          28450000
         SR    15,15                                                    28500000
         CLI   TCTTETT,X'99'       IS THIS A LOCAL 3270?                28550000
         BE    D0570               YES. GET REL LINE NBR FROM TE.       28600000
         IC    15,TCTLERLN         NO. GET REL LINE NBR FROM LE.        28650000
         B     D0572                                                    28700000
D0570    IC    15,TCTTEGU                                               28750000
D0572    L     1,DCBDEBAD          POINT TO THE DEB.                    28800000
         LA    1,32(1)             POINT TO LIST OF UCBS.               28850000
D0574    BCT   15,D0576                                                 28900000
         B     D0578                                                    28950000
D0576    LA    1,4(1)              BCT TO APPROPRIATE RLN UCB.          29000000
         B     D0574                                                    29050000
D0578    L     1,0(1)              POINT TO THE UCB.                    29100000
         XC    PARM3,PARM3                                              29150000
         MVC   PARM3(3),13(1)      MOVE LINEID TO INPUT PARM FIELD.     29200000
         CLI   TCTTETT,X'99'       IS THIS A LOCAL 3270?                29250000
         BE    D0590               YES. BYPASS LOOKING FOR POLL CHARS.  29300000
         L     14,TCTTETA          POINT TO ADDRESSING LIST.            29350000
         UNPK  DUBLWD,0(2,14)      GET CTRL UNIT ADDRESS.               29400000
         TR    DUBLWD,HXTOEB       CONVERT IT TO 2 EBCDIC CHARS.        29450000
         MVC   PARM4(2),DUBLWD+5   MOVE THEM TO INPUT PARM FIELD.       29500000
         NI    PARM4,X'FD'         CONVERT REMOTE CU TO ACTUAL CU NUM   29550000
         UNPK  DUBLWD,2(2,14)      GET TERML ADDRESS.                   29600000
         TR    DUBLWD,HXTOEB       CONVERT IT TO 2 EBCDIC CHARS.        29650000
         MVC   PARM5(2),DUBLWD+5   MOVE THEM TO INPUT PARM FIELD.       29700000
D0590    EQU   *                                                        29750000
         MVC   TWALINE,TCTTETI     SAVE CICS SYMBOLIC NAME FOR          29800000
*                                  3270 PROGRAM.                        29850000
         L     TCTTEAR,TCAFCAAA    POINT BACK TO ORIGINAL TCT           29900000
         LA    TCTTEAR,0(TCTTEAR)  CLEAR HIGH ORDER BYTE FROM ADDR      29950000
         BR    LINKREG                                                  30000000
D0600    XC    TWALINE,TWALINE                                          30050000
         BR    LINKREG                                                  30100000
*********************************************************************** 30150000
*                                                                     * 30200000
*        THIS SECTION TRANSFERS CONTROL TO APPROPRIATE PROGRAM.       * 30250000
*                                                                     * 30300000
*********************************************************************** 30350000
D10      LA    TABLEREG,TABLE      POINT AT FUNCTION/COMPANION TABLE.   30400000
D20      CLC   0(4,TABLEREG),PARM2 PROGRAM NAME IN TABLE?               30450000
         BE    D25                 YES.                                 30500000
         CLC   0(3,TABLEREG),=C'END' END OF TABLE?                      30550000
         BE    D30                 YES. GO TO CK MENU REQUEST           30600000
         LA    TABLEREG,TABLENTY(TABLEREG)  BUMP TO NEXT ENTRY.         30650000
         B     D20                 GO CHECK NEXT ENTRY.                 30700000
D25      CLI   4(TABLEREG),X'00'   IS THERE A PGRM NAME TO XCTL TO?     30750000
         BNE   E10                 NO.                                  30800000
         MVC   TCAPCPI,8(TABLEREG) STORE NAME IN TCA.                   30850000
         DFHPC TYPE=XCTL                                                30900000
D30      CLC   PARM2(4),=C'MENU'                                        30950000
         BNE   D80                 NO.                                  31000000
D32      CLI   TCTTETM,X'F1'       IS THIS A 3277 MODEL 1?              31050000
         BE    D50                 YES.                                 31100000
         CLC   TIOADBA+15(2),=X'4AD6' LARGE MENU 'ALL' = L9P23          31150000
         BE    D40                 YES.                                 31200000
         CLC   TIOADBA+15(2),=X'4BE6' LARGE MENU '3270'= L10P23         31250000
         BE    D41                 YES.                                 31300000
         CLC   TIOADBA+15(2),=X'4CF6' LARGE MENU 'RMOT'= L11P23         31350000
         BE    D42                 YES.                                 31400000
         CLC   TIOADBA+15(2),=X'4FD6' LARGE MENU 'LOCL'= L13P23         31450000
         BNE   D80                 NO. MUST BE FOR MENU.                31500000
D35      DFHPC TYPE=XCTL,PROGRAM=BNGCLOCL YES. GO TO LOCAL PROG.        31550000
D40      MVC   PARM2(3),=C'ALL'    SETUP TO                             31600000
         LA    TABLEREG,TABLE          DO                               31650000
         ZAP   SBACNT,=P'1'        ALL LINES DISPLAY.                   31700000
         B     E10                                                      31750000
D41      XC    PARM2(32),PARM2     CLEAR PARMS FOR TRANSFER             31800000
         MVC   PARM2(4),=C'3270'   SETUP TO DO                          31850000
         ZAP   SBACNT,=P'1'        3270  DISPLAY.                       31900000
         DFHPC TYPE=XCTL,PROGRAM=BNGC3270                               31950000
D42      DFHPC TYPE=XCTL,PROGRAM=BNGCRMOT                               32000000
D50      CLC   TIOADBA+15(2),=X'C17A' SMALL MENU 'ALL' = L4P3           32050000
         BE    D40                 YES.                                 32100000
         CLC   TIOADBA+15(2),=X'C2E2' SMALL MENU '3270'= L5P3           32150000
         BE    D41                 YES.                                 32200000
         CLC   TIOADBA+15(2),=X'C34A' SMALL MENU 'RMOT'= L6P3           32250000
         BE    D42                 YES.                                 32300000
         CLC   TIOADBA+15(2),=X'C45A' SMALL MENU 'LOCL'= L8P3           32350000
         BE    D35                 YES.                                 32400000
D80      DFHPC TYPE=XCTL,PROGRAM=BNGCMENU                               32450000
*********************************************************************** 32500000
*                                                                     * 32550000
*        AT THIS POINT IT HAS BEEN DETERMINED THAT THE REQUEST IS FOR * 32600000
*        ALL LINES, LINE, OR CTRL. THIS MODULE HANDLES THOSE DISPLAYS.* 32650000
*                                                                     * 32700000
*********************************************************************** 32750000
         EJECT                                                          32800000
*********************************************************************** 32850000
*                                                                     * 32900000
*        THIS SECTION CREATES THE COMMON HEADER FOR                   * 32950000
*        ALL LINES, ONE LINE, AND CTRL.                               * 33000000
*                                                                     * 33050000
*********************************************************************** 33100000
E10      MVC   SAVETIOA,TCTTEDA    SAVE ORIGINAL TIOA ADDRESS.          33150000
*                                  GET TIOA BIG ENOUGH FOR OUTPUT       33200000
         DFHSC TYPE=GETMAIN,CLASS=TERM,NUMBYTE=2048,INITIMG=00          33250000
         L     TIOABAR,TCASCSA     POINT TO NEW TIOA                    33300000
         ST    TIOABAR,TCTTEDA     POINT TO NEW TIOA                    33350000
         LA    OUTREG,TIOADBA      POINT TO START OF OUTPUT DATA AREA   33400000
         MVC   0(HDR1LTH,OUTREG),HDR1        MOVE STANDARD FIRST LINE.  33450000
         MVC   HDR1LTH(4,OUTREG),0(TABLEREG) MOVE NAME OF THIS          33500000
*                                            DISPLAY TO TIOA.           33550000
         OC    HDR1LTH(4,OUTREG),=CL4' '     CHANGE ALL'00' TO ALL' '   33600000
         LA    OUTREG,HDR1LTH+4(OUTREG)      UPDATE DATA POINTER.       33650000
         CLI   TCTTETM,X'F1'       IS THIS A 3277 MODEL 1?              33700000
         BE    E150                YES.                                 33750000
         MVC   0(3,OUTREG),HDR1X   MOVE SBA L2P1 FOR MOD 2.             33800000
         LA    OUTREG,3(OUTREG)                                         33850000
E150     MVC   0(HDR2LTH,OUTREG),HDR2   MOVE PAGE-FOWARD HEADER TO TIOA 33900000
         MVC   HDR2LTH(HDR3LTH,OUTREG),HDR3  MOVE PAGE-BACK HEADER      33950000
         LA    OUTREG,HDR2LTH+HDR3LTH-15(OUTREG)                        34000000
         ST    OUTREG,SAVEBBSS     SAVE POINTER TO BBBSS IN TIOA        34050000
         LA    OUTREG,15(OUTREG)                                        34100000
         ST    OUTREG,SAVERCAP     SAVE POINTER TO RECAP LINE           34150000
         MVC   0(41,OUTREG),16(TABLEREG)  MOVE RECAP HEADER TO TIOA     34200000
         LA    OUTREG,41(OUTREG)                                        34250000
         CLI   TCTTETM,C'1'        IS THIS A MODEL 1?                   34300000
         BE    F30                 YES.                                 34350000
         MVC   0(3,OUTREG),HDR3X   MOVE SBA L4P1 FOR MOD 2.             34400000
         LA    OUTREG,3(OUTREG)                                         34450000
F30      MVC   0(41,OUTREG),57(TABLEREG)  MOVE COLUMN HEADER TO TIOA.   34500000
         LA    OUTREG,41(OUTREG)                                        34550000
         ST    OUTREG,SAVEITEM     SAVE POINTER TO FIRST LINE ITEM      34600000
         CLI   TCTTETM,X'F1'       IS THIS A MODEL 1?                   34650000
         BE    F130                YES.                                 34700000
         MVC   0(41,OUTREG),57(TABLEREG)  MOVE COLUMN HEADER AGAIN      34750000
         LA    OUTREG,41(OUTREG)                                        34800000
         ST    OUTREG,SAVEITEM     SAVE POINTER TO FIRST LINE ITEM      34850000
         LA    OUTLOOP,80          SETUP FOR 80 LINE ITEMS FOR MOD 2    34900000
         B     F150                                                     34950000
F130     LA    OUTLOOP,14          SETUP FOR 14 LINE ITEMS FOR MOD 1    35000000
*********************************************************************** 35050000
*                                                                     * 35100000
*        THIS SECTION BUILDS THE APPROPRIATE DISPLAY                  * 35150000
*                                                                     * 35200000
*********************************************************************** 35250000
F150     CP    SBACNT,=P'2'        IS COUNT OF SBA'S LESS THAN 3?       35300000
         BH    R10                 NO. GO TO CONTINUATION SCREEN.       35350000
F180     XC    RELREC,RELREC       POINT TO FIRST CONTROL BLOCK.        35400000
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=G120,DATASET=EMFILE       35450000
F190     UNPK  DBLWD,TCAFCAA(3)                                      PH 35500000
         MVC   IOERCODE(2),DBLWD+3                                      35550000
         TR    IOERCODE,HXTOEB     MOVE CICS RETURN CODE TO I/O ERR MSG 35600000
         UNPK  DBLWD,RELREC(4)                                          35650000
         MVC   IOERBLK,DBLWD+4     MOVE BLK NBR THAT WAS BEING READ     35700000
         TR    IOERBLK,HXTOEB                                           35750000
         MVC   TIOATDL(IOERLTH),IOERMSG                                 35800000
F240     B     Z80                                                      35850000
IOERMSG  DC    AL2(IOERLTH-4),X'0000'                                   35900000
         DC   AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)     35950000
         DC    CL34' ',AL1(SF,PNA),CL39' '                              36000000
         DC    CL39'BNG013A C I/O ERR READING SYS1.DEMFLOG '   @OX21950 36050007
         DC    CL28'  THE CICS RESPONSE CODE IS '              @OX21950 36080007
IOERCODE DC    CL4'00  '                                       @OX21950 36110007
         DC    CL9' '                                                   36200000
         DC    CL34'THE BDAM RELATIVE BLOCK NUMBER IS  '                36250000
IOERBLK  DC    CL3'000'                                                 36300000
IOERLTH  EQU   *-IOERMSG                                                36350000
G120     L     FIOABAR,TCAFCAA     POINT TO FIOA AREA.                  36400000
         OC    CTRLENTS,CTRLENTS   ANY LINE ENTRIES?                    36450000
         BZ    Z30                 NO. WRITE 'NO LINE ERRORS'           36500000
         SR    DATALOOP,DATALOOP                                        36550000
         IC    DATALOOP,CTRLENTS   SET LOOP CTR FOR READING SLOTS.      36600000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT IN BLOCK.        36650000
         CLC   PARM2(3),=C'ALL'    DOES PARM2 = ALL?                    36700000
         BE    J10                 YES.                                 36750000
         OC    PARM3,PARM3         WAS A LINE ADDRESS ENTERED?          36800000
         BZ    Z40                 NO. WRITE 'NO LINE ENTERED'          36850000
         MVC   LINENAME,PARM3           MOVE LINE ADDRESS TO SAVE AREA  36900000
         MVC   CLUSNAME,PARM4           MOVE CONTROL UNIT NAME TO SAVE  36950000
         MVC   MSG7CTRL,PARM4           MOVE CTRL ADDR TO ERRS MSG AREA 37000000
         OC    MSG7CTRL,=CL8' '                                         37050000
         MVC   NOLINE,PARM3        MOVE LINE ADDRESS TO 'NO ERROR' MSG  37100000
         OC    NOLINE,=CL3' '                                           37150000
         MVC   MSG7LINE,NOLINE     MOVE LINE ADDRESS TO 'NO ERRORS'     37200000
*                                  FOR CONTROL UNIT                     37250000
H40      TR    PARM3(3),EBTOHX     CHANGE F0C6F2 TO 000F02 ETC.         37300000
         PACK  DBLWD,PARM3(4)      PACK   000F02 TO 0000F2 ETC.         37350000
         MVC   LINEID(3),DBLWD+4   MOVE GOOD PORTION TO SAVE AREA       37400000
         MVC   LINEID+3(3),=XL3'000000'                                 37450000
H80      CLC   SLOTLINE,LINEID     IS THIS CONTROL SLOT FOR OUR LINE?   37500000
         BE    L60                 YES. GO GET DETAIL BLOCK.            37550000
         LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           37600000
         BCT   DATALOOP,H80        CHECK NEXT SLOT.                     37650000
         CLC   CTRLFWD,=F'0'       MORE CONTROL BLOCKS?                 37700000
         BE    Z10                      NO. GO WRITE 'NO LINE ERRORS'   37750000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        37800000
         DFHFC TYPE=RELEASE                                             37850000
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=H180,DATASET=EMFILE       37900000
         B     F190                BRANCH IF I/O ERROR.                 37950000
H180     L     FIOABAR,TCAFCAA     POINT TO FIOA                        38000000
         SR    DATALOOP,DATALOOP                                        38050000
         IC    DATALOOP,CTRLENTS   SET SLOT LOOP CONTROL                38100000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT.                 38150000
         B     H80                                                      38200000
*********************************************************************** 38250000
*                                                                     * 38300000
*        THIS SECTION FORMATS 'ALL LINE' ENTRIES                      * 38350000
*                                                                     * 38400000
*********************************************************************** 38450000
J10      L     14,SAVEBBSS         LOAD SAVED ADDR OF BLK/SLOT TIOA.    38500000
         MVC   0(5,14),=C'00001'   MOVE 00001 TO FIRST AND              38550000
         MVC   10(5,14),0(14)      PREVIOUS BBBSS'S                     38600000
J40      MVC   PARM1(6),SLOTLINE   SETUP LINE ADDRESS FOR               38650000
J110     UNPK  DBLWD,SLOTLINE(4)   UNPK LINE ADDR IN WORKAREA           38700000
         TR    DBLWD+4(3),HXTOEB   CONVERT TO EBCDIC                    38750000
         MVC   DTLITEM,=CL8' '     CLEAR DETAIL LINE ITEM               38800000
         MVC   DTLITEM(3),DBLWD+4  PUT LINE ADDR IN DETAIL ENTRY        38850000
J150     LH    14,SLOTHITS         PUT LINE ERRORS IN REG.              38900000
         CVD   14,DBLWD            CONVERT TO DECIMAL                   38950000
         UNPK  DTLCOUNT,DBLWD+5(3) PUT LINE ERROR COUNT                 39000000
         OI    DTLCOUNT+3,X'F0'    IN OUTPUT                            39050000
         MVC   0(DTLLTH,OUTREG),DTLENTRY MOVE DETAIL ENTRY TO OUTPUT    39100000
         MVC   DTLCOUNT,=C'0001'   RESTORE PROGRAM CONSTANT.            39150000
         LA    OUTREG,DTLLTH(OUTREG) UPDATE OUTPUT POINTER              39200000
         BCT   DATALOOP,K100       MORE SLOTS IN THIS CTRL BLK?         39250000
         CLC   CTRLFWD,=F'0'       NO. MORE CTRL BLKS?                  39300000
         BE    K120                NO. PREPARE TO EXIT.                 39350000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        39400000
         DFHFC TYPE=RELEASE                                             39450000
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=K50,DATASET=EMFILE        39500000
         B     F190                I/O ERROR                            39550000
K50      L     FIOABAR,TCAFCAA     POINT TO FIOA                        39600000
         SR    DATALOOP,DATALOOP                                        39650000
         IC    DATALOOP,CTRLENTS   SET LOOP CONTROL.                    39700000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT                  39750000
         B     J40                                                      39800000
K100     LA    DATAREG,SLOTLTH(DATAREG) POINT TO NEXT SLOT.             39850000
         BCT   OUTLOOP,J40         ROOM LEFT IN TIOA?                   39900000
K120     L     15,SAVEBBSS         NO. POINT TO BLK/SLT AREA IN TIOA.   39950000
         UNPK  DBLWD,RELREC(4)     STORE BDAM RELATIVE                  40000000
         TR    DBLWD,HXTOEB        CONTROL BLK NUMBER                   40050000
         MVC   5(3,15),DBLWD+4     (LAST BBBSS) IN OUTPUT               40100000
         SR    14,14                                                    40150000
         IC    14,CTRLENTS         GET ORIGINAL COUNT OF SLOTS          40200000
         SR    14,DATALOOP         DETERMINE LAST SLOT READ.            40250000
         STC   14,DBLWD+6          STORE                                40300000
         UNPK  DBLWD(3),DBLWD+6(2) SLOT NUMBER                          40350000
         TR    DBLWD,HXTOEB        (LAST BBBSS)                         40400000
         MVC   8(2,15),DBLWD       IN OUTPUT.                           40450000
K230     LA    14,TIOADBA          COMPUTE LENGTH OF                    40500000
         SR    OUTREG,14           DATA IN TIOA.                        40550000
         STH   OUTREG,TIOATDL      STORE LENGTH IN TIOA                 40600000
         DFHTC TYPE=(WRITE,ERASE)  ALL DONE. SEND DISPLAY.              40650000
         DFHPC TYPE=RETURN                                              40700000
*********************************************************************** 40750000
*                                                                     * 40800000
*        THIS SECTION PREPARES THE 'LINE' OR 'CTRL' DISPLAY           * 40850000
*                                                                     * 40900000
*********************************************************************** 40950000
L60      MVI   QUITSW,X'00'        TURN OFF OUTPUT-FULL-SWITCH       XH 41000000
         ZAP   ITEMCNT,=P'0'       SET CTR OF OUTPUT ITEMS = 0          41050000
         MVC   RELREC,SLOTRFB      SAVE POINTER TO DETAIL BLK           41100000
L140     DFHFC TYPE=RELEASE        RELEASE CONTROL BLOCK                41150000
         MVC   SVRELREC,RELREC     SAVE FOR LAST BBBSS'S                41200000
         OC    RELREC,RELREC       IS THERE ANY DATA BLOCKS ?  @OZ31885 41210007
         BZ    Z130                NO, WRITE 'NO DATA BLKS MSG'@OZ31885 41220007
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=L170,DATASET=EMFILE       41250000
         B     F190                I/O ERROR                            41300000
L170     L     FIOABAR,TCAFCAA     POINT TO FIOA                        41350000
         SR    DATALOOP,DATALOOP                                        41400000
         LH    DATALOOP,BLKLTH     SET SLOT LOOP CONTROL                41450000
         LA    DATAREG,DATASLT1    POINT FOR FIRST SLOT                 41500000
L210     MVI   SLOTCNT,X'00'       ZERO OUT DETAIL SLOT COUNTER.        41550000
         OC    LINENAME,=CL8' '                                         41600000
         OC    CLUSNAME,=CL8' '                                         41650000
L220     L     1,SAVERCAP          POINT TO RECAP HEADER                41700000
         CLC   PARM2(4),=C'LINE'   PARM2 = LINE?                        41750000
         BE    L230                YES.                                 41800000
         CLC   PARM4,=CL8' '       IS PARM4 BLANK?                      41850000
         BE    L225                YES. MUST BE LOCAL.                  41900000
         OC    PARM4,PARM4         OR IS PARM4 ZEROS?                   41950000
         BZ    L225                YES. MUST BE LOCAL ALSO              42000000
         MVC   22(8,1),CLUSNAME    MOVE CONTROL UNIT TO HEADER          42050000
         MVC   30(3,1),=C'ON '                                          42100000
         MVC   33(8,1),LINENAME    MOVE LINE ADDR. TO HEADER            42150000
         B     M10                                                      42200000
L225     MVC   11(19,1),=C'LOCAL CONTROL UNIT '                         42250000
         MVC   30(8,1),LINENAME    MOVE CTRL UNIT TO HEADER             42300000
         B     M10                                                      42350000
L230     MVC   21(8,1),LINENAME    MOVE LINE ADDR. TO HEADER            42400000
*********************************************************************** 42450000
*                                                                     * 42500000
*        THIS SECTION FORMATS A 'LINE' ITEM OR A 'CTRL' ITEM.         * 42550000
*                                                                     * 42600000
*********************************************************************** 42650000
M10      MVC   CTRLNAME,=D'0'      ZERO  OUT CONTROL UNIT WORK AREA.    42700000
         MVC   TERMNAME,=CL8' '    BLANK OUT TERMINAL WORK AREA.        42750000
         MVC   RELREC,DATAFWD      SAVE NEXT DETAIL BLK ADDR.           42800000
         MVC   TBARG,=CL2' '       CLEAR MOD-1 TABLE ARGUMENT        XH 42850000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR ENTRY?                42900000
         BE    N10                 YES.                                 42950000
         CLI   ENTRYTYP,X'30'      IS IT AN OBR ENTRY?                  43000000
         BE    N80                 YES.                                 43050000
         CLI   ENTRYTYP,X'34'      IS IT TCAM OBR?                      43100000
         BE    N80                 YES,BR                               43150000
M100     CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY?            43200000
         BE    N150                YES.                                 43250000
         OC    CTRLNAME,=CL8' '                                         43300000
         OC    PARM4,=CL8' '                                            43350000
         CLC   PARM4,CTRLNAME      IS PARM 4 = REMOTE CTRL UNIT NAME?   43400000
         BE    N150                YES. PROCESS ENTRY                   43450000
         CLI   PARM4,X'40'         IS PARM4 BLANK ?                     43500000
         BNE   M140                NO. MUST BE REMOTE--BYPASS CK LOCAL  43550000
         OC    LINENAME,=CL8' '                                         43600000
         CLC   LINENAME,CTRLNAME   IS LINENAME = LOCAL CTRL UNIT ?      43650000
         BE    N150                YES. PROCESS ENTRY                   43700000
M140     SR    R15,R15                                               XH 43750000
         IC    R15,SLOTCNT         ADD ONE                           XH 43800000
         AH    R15,=H'1'           TO                                XH 43850000
         STC   R15,SLOTCNT         SLOT COUNTER.                     XH 43900000
M160     SR    R14,R14                                               XH 43950000
         IC    R14,DATALTH         PUT LTH OF SLOT IN WORK REG          44000000
         AR    DATAREG,R14         POINT TO NEXT DETAIL SLOT.           44050000
         SR    DATALOOP,R14        MORE SLOTS IN THIS DETAIL BLK?       44100000
         BP    M10                 YES.                                 44150000
         OC    RELREC,RELREC       MORE DETAIL BLOCKS?                  44200000
         BNE   L140                YES.                                 44250000
M240     ZAP   WORKCNT,ITEMCNT                                          44300000
         BZ    Z50                                                      44350000
         B     K230                                                     44400000
N10      CLI   MOD1SW,X'00'        MOD-1 SWITCH OFF ?                XH 44450000
         BE    N30                 YES. BYPASS MOD-1 SCANNER CHECK   XH 44500000
         CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?        XH 44550000
         BE    N20                 YES. USE REMOTE TERMINAL ADDR     XH 44600000
         MVC   TBARG(1),MDRCTRL    SET TBARG = REMOTE CTRL UNIT      XH 44650000
         B     N25                 GO CK ADDR AGAINST MOD-1 TABLE    XH 44700000
N20      MVC   TBARG(1),MDRTERM    SET TBARG = REMOTE TERMINAL       XH 44750000
N25      BAL   LINKREG,MOD1SCAN    CK IF REMOTE CU OR TERMINAL       XH 44800000
         CLC   TBARG,=X'0000'        IN MOD-1 TABLE?                 XH 44850000
         BE    M140                YES. BYPASS THIS ERROR ENTRY      XH 44900000
N30      UNPK  CTRLNAME(3),MDRCTRL(2)   MDR - PUT CONTROL UNIT       XH 44950000
         TR    CTRLNAME(2),HXTOEB       NAME                            45000000
         MVI   CTRLNAME+2,X'00'         IN WORK AREA.                   45050000
         UNPK  TERMNAME(3),MDRTERM(2)   PUT TERMINAL                    45100000
         TR    TERMNAME(2),HXTOEB       NAME                            45150000
         MVI   TERMNAME+2,C' '          IN WORK AREA.                   45200000
         B     M100                                                     45250000
N80      CLI   OBRUCB,X'10'        IS THIS A LOCAL                      45300000
         BE    N110                YES, GO MOVE 3 BYTE ADDRESS          45350000
N85      CLI   MOD1SW,X'00'        IS MOD-1 SWITCH OFF ?             XH 45550000
         BE    N95                 YES. BYPASS MOD-1 SCANNER CHECK   XH 45600000
         CLC   PARM2(4),=C'CTRL'      IS THIS A 'CTRL' DISPLAY?@OZ31878 45650007
         BE    N88                    YES. USE REMOTE TERM ADDR@OZ31878 45660007
         MVC   TBARG(1),OBRCTRL       PASS REMOTE CU TO MOD-1  @OZ31878 45670007
         B     N90                    GO CK ADDR AGAINST MOD-1 @OZ31878 45680007
N88      MVC   TBARG(1),OBRTERM       PASS REMOTE TERM ADDR    @OZ31878 45690007
*                                     TO MOD-1                 @OZ31878 45700007
N90      BAL   LINKREG,MOD1SCAN       CK IF REMOTE CU OR TERM  @OZ31878 45710007
         CLC   TBARG,=X'0000'        ADDR FOR REMOTE LINE ERRORS     XH 45750000
*                                    IS IN MOD-1 TABLE ?             XH 45800000
         BE    M140                YES. BYPASS THIS ERROR ENTRY      XH 45850000
N95      UNPK  DBLWD,OBRCTRL(2)    OBR - MOVE 1 BYTE REMOTE CU ADR   XH 45900000
         TR    DBLWD+4(3),HXTOEB                                        45950000
         MVC   CTRLNAME(2),DBLWD+5 TO WORK AREA                         46000000
         UNPK  DBLWD,OBRTERM(2)    MOVE 1-BYTE REMOTE TERML ADDR        46050000
         TR    DBLWD+4(3),HXTOEB                                        46100000
         MVC   TERMNAME(2),DBLWD+5 WORK AREA.                           46150000
         B     M100                                                     46200000
N110     CLI   MOD1SW,X'00'        IS MOD-1 SWITCH OFF ?             XH 46250000
         BE    N130                YES. BYPASS MOD-1 SCANNER CHECK   XH 46300000
         MVC   TBARG,OBRCUA        SET TBARG = LOCAL TERMINAL ADDR   XH 46350000
         BAL   LINKREG,MOD1SCAN    CK IF LOCAL TERMINAL IS IN        XH 46400000
         CLC   TBARG,=X'0000'           MOD-1 TABLE ?                XH 46450000
         BE    M140                YES. BYPASS THIS ERROR ENTRY      XH 46500000
N130     UNPK  DBLWD,LINEIDA(4)    OBR - MOVE 3-BYTE CONTROL UNIT    XH 46550000
         TR    DBLWD+4(3),HXTOEB        ADDRESS(POSSIBLY ROUNDED)       46600000
         MVC   CTRLNAME(3),DBLWD+4      TO WORK AREA.                   46650000
         UNPK  DBLWD,OBRCUA(3)          MOVE REAL 3-BYTE CONTROL        46700000
         TR    DBLWD+4(3),HXTOEB        UNIT ADDRESS                    46750000
         MVC   TERMNAME(3),DBLWD+4      WORK AREA.                      46800000
         B     M100                                                     46850000
N150     OC    CTRLNAME,=CL8' '                                         46900000
         L     R14,SAVEITEM        POINT TO FIRST ITEM IN TIOA          46950000
         ZAP   WORKCNT,ITEMCNT     ANY ITEMS IN TIOA?                   47000000
         BZ    P50         NO,ADD NEW ITEM                              47050000
N170     CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY?            47100000
         BE    P20                 YES.                                 47150000
         CLC   TERMNAME,ITEMLTH(R14) WORKTERMINAL = TIOA TERMINAL?      47200000
         BE    P40                 YES.                                 47250000
N230     LA    R14,DTLLTH(R14)     BUMP TO NEXT ITEM                    47300000
         SP    WORKCNT,=PL2'1'     SUBT ONE FROM ITEM COUNTER.          47350000
         BZ    P90     ANY ITEMS?  NO. ADD NEW ITEM.                    47400000
         B     N170                                                     47450000
P20      CLC   CTRLNAME,ITEMLTH(R14)    WORK CTRL = TIOA CTRL?          47500000
         BNE   N230                NO.                                  47550000
P40      PACK  FULLWD(3),COUNTLTH(4,R14)  ADD                           47600000
         AP    FULLWD(3),=P'1'            ONE                           47650000
         UNPK  COUNTLTH(4,R14),FULLWD(3)  TO                            47700000
         OI    COUNTLTH+3(R14),X'F0'      COUNT FIELD.                  47750000
         B     M140                GO CHECK NEXT SLOT.                  47800000
P50      CLC   PARM2(4),=C'LINE'   IS IT LINE                           47850000
         BE    P170                YES,BR                               47900000
         SR    R15,R15                                                  47950000
         IC    R15,SLOTCNT                                              48000000
         AH    R15,=H'1'                                                48050000
         STC   R15,SLOTTTR                                              48100000
         L     R15,SAVEBBSS                                             48150000
         UNPK  DBLWD(3),SLOTTTR(2)                                      48200000
         TR    DBLWD,HXTOEB                                             48250000
         MVC   3(2,R15),DBLWD                                           48300000
P90      CLI   QUITSW,X'FF'        MOD-1 OUTPUT-FULL-SW ON ?         XH 48350000
         BE    M140                YES. BYPASS PUTTING ADDR IN OUTPUTXH 48400000
         CLC   PARM2(4),=C'LINE'        IS THIS A 'LINE' DISPLAY?    XH 48450000
         BE    P170                     YES.                            48500000
         MVC   DTLITEM,TERMNAME    NO. MOVE TERMINAL                    48550000
P120     MVC   0(DTLLTH,OUTREG),DTLENTRY  TO OUTPUT                     48600000
         LA    OUTREG,DTLLTH(OUTREG) UPDATE OUTPUT POINTER.             48650000
         AP    ITEMCNT,=P'1'       ADD 1 TO COUNT OF OUTPUT ITEMS.      48700000
         SR    R15,R15                                               XH 48750000
         IC    R15,SLOTCNT         ADD ONE                           XH 48800000
         AH    R15,=H'1'           TO                                XH 48850000
         STC   R15,SLOTCNT         SLOT COUNTER.                     XH 48900000
         L     R15,SAVEBBSS        NO. POINT TO BLK/SLT AREA IN TIOA.XH 48950000
         MVI   QUITSW,X'00'        TURN OFF OUTPUT-FULL-SW.    @OZ31882 48970007
         UNPK  DBLWD,SVRELREC(4)   STORE BDAM RELATIVE               XH 49000000
         TR    DBLWD,HXTOEB        CONTROL BLK NUMBER                XH 49050000
         MVC   5(3,R15),DBLWD+4    (LAST BBBSS) IN OUTPUT            XH 49100000
         SR    R14,R14                                               XH 49150000
         UNPK  DBLWD(3),SLOTCNT(2) STORE SLOT NUMBER IN              XH 49200000
         TR    DBLWD,HXTOEB        (LAST BBBSS)                      XH 49250000
         MVC   8(2,R15),DBLWD      IN OUTPUT.                        XH 49300000
         CP    ITEMCNT,=P'1'       IS THIS THE FIRST ITEM IN TIOA ?  XH 49350000
         BNE   P140                NO. BYPASS UPDATING FIRST BBBSS   XH 49400000
         MVC   0(5,15),5(15)       SET FIRST BBBSS = LAST BBBSS      XH 49450000
         CLC   10(5,15),=C'BBBSS'  IS PREV BBBSS FILLED IN ?         XH 49500000
         BNE   P140                YES. BYPASS UPDATING PREV BBBSS   XH 49550000
         MVC   10(5,15),0(15)      SET PREV BBBSS = FIRST BBBSS      XH 49600000
P140     BCT   OUTLOOP,M160        MORE ROOM IN TIOA?                XH 49650000
         CLI   TCTTETM,X'F2'       IS THIS A 3270-2 ?                XH 49700000
         BE    M240                YES. PREPARE TO EXIT              XH 49750000
         MVI   QUITSW,X'FF'        TURN ON OUTPUT-FULL-SW FOR MOD-1  XH 49800000
         B     M160                CONTINUE SCANNING REST OF DATABASEXH 49850000
P170     MVC   DTLITEM,CTRLNAME    SETUP CONTROL UNIT ADDRESS           49900000
         B     P120                     FOR OUTPUT.                     49950000
*********************************************************************** 50000000
*                                                                     * 50050000
*        THIS SECTION PREPARES FOR AN ENTRY BLOWUP OR FOR PAGING.     * 50100000
*                                                                     * 50150000
*********************************************************************** 50200000
R10      L     R14,SAVETIOA        RESTORE POINTER TO INPUT DATA.       50250000
         LA    14,12(14)           BUMP PASS 'SSA' 12-BYTES             50300000
         CLC   PARM4(4),=C'PAGE'   IS THIS A 'PAGE' REQUEST?            50350000
         BE    S010                YES,BR CK FOR FWD OR BACK            50400000
         OC    PARM5,PARM5         MAKE SURE A FIELD WAS X'ED           50450000
         BZ    Z40                 BR,ZERO NO FIELD WAS X'ED            50500000
         CLC   PARM2(4),=C'LINE'   NO. THIS MUST BE COMPANION REQUEST.  50550000
         BNE   R010                IF NOT LINE DISPLAY, GO READ RECORD. 50600000
         MVC   PARM3,PARM5         IS LINE, MOVE THE X'D FIELD TO PRM3. 50650000
         MVC   LINENAME,PARM5        MOVE LINE ADDRESS TO SAVE AREA     50700000
         XC    PARM4(16),PARM4       AS IF LINE ID HAD BEEN KEYED IN.   50750000
         B     F180                GO DO LINE DISPLAY AS IF THIS WERE   50800000
*                                  AN INITIAL 'LINE' INPUT.             50850000
R010     MVC   CLUSNAME,PARM5      MOVE CONTROL UNIT ADDR TO SAVE       50900000
         MVC   PARM4,PARM5         MOVE X'D CTRL UNIT TO PARM4 AS IF    50950000
         XC    PARM5,PARM5           IT HAD BEEN KEYED IN.              51000000
         MVC   PARM1,PARM4         PUT CTRL NAME IN PARM1 FOR TABLE     51050000
         OC    PARM1,=CL8' '                                            51100000
R140     L    14,SAVETIOA          RESTORE REG 14                       51150000
         LA    14,12(14)                                                51200000
         TR    17(3,14),EBTOHX     GET BLOCK NUMBER OF                  51250000
         PACK  DBLWD,17(4,14)         REQUESTED LINE INTO HEX.          51300000
         MVC   RELREC,DBLWD+4                                           51350000
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=R170,DATASET=EMFILE       51400000
         B     F190                I/O ERROR.                           51450000
R170     L     FIOABAR,TCAFCAA                                          51500000
         XC    PARM3,PARM3                                              51550000
         UNPK  DBLWD,DATAPORT(4)        MOVE LINE ID                    51600000
         TR    DBLWD+4,HXTOEB           FROM PREVIOUS BLOCK             51650000
         MVC   LINENAME(3),DBLWD+4     TO PARM3 AS IF IT HAD BEEN       51700000
         MVC   PARM3(6),LINENAME        KEYED IN.                       51750000
         DFHFC TYPE=RELEASE                                             51800000
         CLC   PARM3,PARM4         IS THIS A LOCAL CTRL UNIT?           51850000
         BNE   F180                NO. GO TO PROCESS REMOTE.            51900000
         XC    PARM4,PARM4         YES. CLEAR REDUNDANT CU ADDR         51950000
         B     F180                GO DO A 'CTRL' DISPLAY AS IF ABOVE   52000000
*                                  CTRL & LINE HAD BEEN TYPED IN.       52050000
S010     EQU   *                                                        52100000
         CLC   19(2,14),=X'C1D3'   IS THIS A PAGE FORWARD-LG   @OZ30480 52150007
*                                       OR A PAGE BACKWARD-SM? @OZ30480 52155007
         BE    S090                YES.                        @OZ30480 52160007
         CLC   19(2,14),=X'C17B'   IS THIS A PAGE BACKWRD-LG?  @OZ30480 52165007
         BE    S090                YES.                        @OZ30480 52170007
         CLC   19(2,14),=X'406B'   IS THIS A PAGE FORWARD-SM?  @OZ30480 52175007
         BNE   S100                NO, NO OTHER PAGE REQUEST   @OZ30480 52180007
S090     LA    14,4(14)              BUMP WORK REG BY 4        @OZ30480 52185007
S100     MVC   WORK15,21(14)       CONVERT BBBSS'S TO HEX      @OZ30480 52190007
         TR    WORK15,EBTOHX                                            52200000
         CLC   PARM5(4),=C'FORW'   IS IT A 'PAGE FORWARD' REQUEST?      52250000
         BE    S110                YES.                                 52300000
         PACK  DBLWD,WORK15+10(6)                                       52350000
         MVC   RELREC,DBLWD+3      THE 'PREVIOUS' BLOCK.                52400000
         MVC   TWASLOT,DBLWD+6     AND SLOT TO RESUME AT.               52450000
         MVC   TBRELREC,RELREC     SAVE CURRENT 'BBB'                XH 52500000
         MVC   TBSLOT,TWASLOT      SAVE CURRENT 'SS'                 XH 52550000
         L     15,SAVEBBSS         POINT TO NEW OUTPUT HEADER.          52600000
         MVC   0(5,15),31(14)      OLD PREVIOUS NOW BECOMES NEW         52650000
         MVC   10(5,15),31(14)     FIRST AND PREVIOUS.                  52700000
         B     S180                                                     52750000
S110     EQU   *                                                        52800000
         PACK  DBLWD,WORK15+5(6)                                        52850000
         MVC   RELREC,DBLWD+3      PLACE TO PAGE FORWARD FROM           52900000
         MVC   TWASLOT,DBLWD+6                                          52950000
         MVC   TBRELREC,RELREC     SAVE CURRENT 'BBB'                XH 53000000
         MVC   TBSLOT,TWASLOT      SAVE CURRENT 'SS'                 XH 53050000
         L     15,SAVEBBSS         POINT TO NEW OUTPUT HEADER.          53100000
         MVC   0(5,15),26(14)      OLD LAST IS NEW FIRST AND            53150000
         MVC   10(5,15),21(14)     OLD FIRST IS NEW PREVIOUS.           53200000
S180     BAL   LINKREG,LOCATE      LOCATE PROPER BLOCK & SLOT.          53250000
         CLC   PARM2(3),=C'ALL'                                         53300000
         BE    J40                 GO RESUME WHERE LEFT OFF AT (ALL)    53350000
         B     S215                PERFORM MOD-1 TABLE BUILD         XH 53400000
S190     ZAP   ITEMCNT,=P'0'       SET CTR OF OUTPUT ITEMS = 0       XH 53450000
         SR    R15,R15                                                  53500000
         IC    R15,DBLWD+6             UPDATE SLOT COUNTER              53550000
         SH    R15,=H'1'                   FOR PAGING IN                53600000
         STC   R15,SLOTCNT             LINE OR CTRL DISPLAYS.           53650000
S200     UNPK  DBLWD,LINEIDA(4)        MOVE LINE ADDRESS                53700000
         TR    DBLWD+4(3),HXTOEB                TO                      53750000
         MVC   LINENAME(3),DBLWD+4     SAVE AREA FOR RECAP HDR.         53800000
         MVC   LINENAME+3(5),=CL5' '        CLEAR OUT GARBAGE           53850000
         XC    PARM4,PARM4                                              53900000
         CLI   ENTRYTYP,X'91'          IS THIS AN MDR ENTRY?            53950000
         BE    S210                         YES.                        54000000
         CLI   OBRUCB,X'40'            IS THIS A REMOTE OBR ?        XH 54050000
         BNE   S205                         NO.                      XH 54100000
         UNPK  CLUSNAME(3),OBRCTRL(2)       MOVE MDR DUMMY LINE ADDR XH 54150000
         TR    CLUSNAME(2),HXTOEB                TO                  XH 54200000
         MVC   CLUSNAME+2(6),=CL6' '        SAVE AREA FOR RECAP HDR. XH 54250000
         MVC   PARM4(2),CLUSNAME              MOVE  ADDR  TO PARM4   XH 54300000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)XH 54350000
S205     MVC   CLUSNAME,LINENAME       MOVE OBR CTRL ADDR. TO SAVE ARXH 54400000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)XH 54450000
S210     UNPK  CLUSNAME(3),MDRCTRL(2)       MOVE MDR CTRL ADDR.         54500000
         TR    CLUSNAME(2),HXTOEB                TO                     54550000
         MVC   CLUSNAME+2(6),=CL6' '        SAVE AREA FOR RECAP HDR.    54600000
         MVC   PARM4(2),CLUSNAME       MOVE MDR CTRL ADDR. TO PARM4     54650000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)   54700000
*********************************************************************** 54750000
*                                                                     * 54800000
*   THIS IS THE MOD-1 'LINE' AND 'CTRL' TABLE BUILD ROUTINE           * 54850000
*                                                                     * 54900000
*********************************************************************** 54950000
S215     ST    OUTLOOP,SOUTLOOP    SAVE OUTLOOP REGISTER                55000000
         MVC   MOD1TABL,=CL64' '   INITIALIZE MOD1TABL TO BLANKS        55050000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR ?                     55100000
         BE    S218                YES. SAVE MDR CTRL UNIT     @OZ31878 55150007
         CLI   OBRUCB,X'40'        IS THIS A REMOTE OBR ?      @OZ31878 55160007
         BNE   S220                NO. BYPASS SAVING CTRL UNIT @OZ31878 55170007
         MVC   TBCTRL,OBRCTRL      YES. SAVE REMOTE OBR CU     @OZ31878 55180007
         B     S220                                            @OZ31878 55190007
S218     MVC   TBCTRL,MDRCTRL      SET TBCTRL = MDRCTRL        @OZ31878 55200007
S220     MVC   TBLINE,LINEIDA      SAVE CURRENT LINE ID                 55250000
         XC    RELREC,RELREC       POINT TO FIRST CONTROL BLOCK.        55300000
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=S220R,DATASET=EMFILE      55350000
         B     F190                GET I/O ERROR, GO ISSUE ERR MSG.     55400000
S220R    L     FIOABAR,TCAFCAA     POINT TO FIOA AREA.                  55450000
         OC    CTRLENTS,CTRLENTS   ANY LINE ENTRIES?                    55500000
         BZ    Z30                 NO. WRITE 'NO LINE ERRORS'           55550000
         SR    DATALOOP,DATALOOP                                        55600000
         IC    DATALOOP,CTRLENTS   SET LOOP CTR FOR READING SLOTS.      55650000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT IN BLOCK.        55700000
S220A    CLC   TBLINE,SLOTLINE     IS THIS CONTROL SLOT FOR OUR LINE?   55750000
         BE    S222                YES. GO GET DETAIL BLOCK.            55800000
         LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           55850000
         BCT   DATALOOP,S220A      CHECK NEXT SLOT.                     55900000
         CLC   CTRLFWD,=F'0'       MORE CONTROL BLOCKS?                 55950000
         BE    Z10                 NO. GO WRITE 'NO LINE ERRORS'        56000000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        56050000
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=S222R,DATASET=EMFILE      56100000
         B     F190                GET I/O ERROR, GO ISSUE ERR MSG.     56150000
S222R    L     FIOABAR,TCAFCAA     POINT TO INPUT RECORD AREA           56200000
         SR    DATALOOP,DATALOOP                                        56250000
         IC    DATALOOP,CTRLENTS   SET SLOT LOOP CONTROL                56300000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT.                 56350000
         B     S220A                                                    56400000
S222     ZAP   TABLECNT,=P'0'      SET CTR OF TABLE ITEMS = 0           56450000
         LA    MOD1REG,MOD1TABL    POINT TO MOD-1 TABLE                 56500000
         MVC   RELREC,SLOTRFB      MOVE POINTER TO DETAIL BLK           56550000
S222A    MVC   SVRELREC,RELREC     SAVE FOR COMPARE TO TABLE RELREC     56600000
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=S222AR,DATASET=EMFILE     56650000
         B     F190                GET I/O ERROR, GO ISSUE ERR MSG.     56700000
S222AR   L     FIOABAR,TCAFCAA     POINT TO INPUT RECORD AREA           56750000
         SR    DATALOOP,DATALOOP                                        56800000
         LH    DATALOOP,BLKLTH     SET SLOT LOOP CONTROL                56850000
         LA    DATAREG,DATASLT1    POINT FOR FIRST SLOT                 56900000
         MVI   SLOTCNT,X'01'       SET COUNT OF DETAIL BLK SLOTS=1      56950000
         MVC   RELREC,DATAFWD      SAVE NEXT DETAIL BLK ADDR.           57000000
S222B    CLC   SVRELREC,TBRELREC   IS THIS THE RIGHT DETL BLK ?         57050000
         BNE   S222B10             NO. CONTINUE SCAN                    57100000
         CLC   SLOTCNT,TBSLOT      IS THIS THE RIGHT ENTRY ?            57150000
         BNE   S222B10             NO. CONTINUE SCAN                    57200000
S222B03  MVI   MOD1SW,X'FF'        TURN MOD-1 SWITCH ON                 57250000
S222B05  MVC   RELREC,TBRELREC     RESTORE PAGING 'BBB'                 57300000
         MVC   TWASLOT,TBSLOT      RESTORE PAGING 'SS'                  57350000
         BAL   LINKREG,LOCATE      LOCATE STARTING 'BBBSS' FOR DISP     57400000
         L     OUTLOOP,SOUTLOOP    RESTORE THE CONTENT OF OUTLOOP REG   57450000
         B     S190                RESUME PAGING SETUP                  57500000
S222B10  LA    14,MOD1TABL         POINT OT MOD-1 TABLE                 57550000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR ENTRY?                57600000
         BE    S222C               YES.                                 57650000
         CLI   ENTRYTYP,X'30'      IS IT A BTAM OBR?                    57700000
         BE    S222D               YES.                                 57750000
         CLI   ENTRYTYP,X'34'      IS IT A TCAM OBR?                    57800000
         BE    S222D               YES.                                 57850000
S222B20  SR    15,15                                                    57900000
         IC    15,SLOTCNT          ADD ONE                              57950000
         AH    15,=H'1'            TO                                   58000000
         STC   15,SLOTCNT          SLOT COUNTER.                        58050000
         SR    14,14                                                    58100000
         IC    14,DATALTH          PUT LTH OF SLOT IN WORK REG.         58150000
         AR    DATAREG,14          POINT TO NEXT DETAIL SLOT.           58200000
         SR    DATALOOP,14         MORE SLOTS IN THIS DETAIL BLK?       58250000
         BP    S222B               YES.                                 58300000
         OC    RELREC,RELREC       MORE DETAIL BLOCKS?                  58350000
         BNE   S222A               YES.                                 58400000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN MOD-1 TABLE?            58450000
         BZ    S222B05             NO. EXIT BUT DON'T TURN ON MOD-1 SW. 58500000
         B     S222B03             YES. EXIT NORMALLY                   58550000
S222C    CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?           58600000
         BE    S222C50             YES.  USE TERMINAL ADDR ONLY         58650000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?                 58700000
         BZ    S222C30             NO. ADD NEW ITEM                     58750000
S222C10  CLC   0(1,14),MDRCTRL     IS THIS CTRL UNIT IN THE TABLE ?     58800000
         BE    S222B20             YES.  BYPASS THIS ENTRY              58850000
         LA    14,2(14)            BUMP TO NEXT ENTRY                   58900000
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM COUNT         58950000
         BZ    S222C30             BRANCH IF NO MORE ITEMS TO CK        59000000
         B     S222C10                                                  59050000
S222C30  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?             59100000
         BE    S222B03             YES.                                 59150000
         MVC   0(1,MOD1REG),MDRCTRL     STORE IN TABLE                  59200000
         B     S228                                                     59250000
S222C50  CLC   TBCTRL,MDRCTRL      DOES CTRL UNIT ENTRY = REQUESTED CU? 59300000
         BNE   S222B20             NO. BYPASS PUTTING TERMINAL IN TABLE 59350000
         ZAP   WKTBLCNT,TABLECNT                                        59400000
         BZ    S222C70                                                  59450000
S222C60  CLC   0(1,14),MDRTERM     IS THIS TERMINAL IN THE TABLE ?      59500000
         BE    S222B20             YES. BYPASS THIS ENTRY               59550000
         LA    14,2(14)            BUMP TO NEXT ENTRY                   59600000
         SP    WKTBLCNT,=PL2'1'                                         59650000
         BZ    S222C70                                                  59700000
         B     S222C60                                                  59750000
S222C70  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?             59800000
         BE    S222B03             YES.                                 59850000
         MVC   0(1,MOD1REG),MDRTERM    PUT REMOTE TERMINAL INTO TABLE   59900000
         B     S228                                                     59950000
S222D    CLI   OBRUCB,X'10'        IS THIS A LOCAL?                     60000000
         BE    S222G               YES. GO MOVE 3-BYTE ADDR             60050000
         CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?  @OZ31878 60100007
         BE    S222D50             YES.  USE TERMINAL ADDR ONLY@OZ31878 60105007
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?        @OZ31878 60110007
         BZ    S222D30             NO. ADD NEW ITEM            @OZ31878 60115007
S222D10  CLC   0(1,14),OBRCTRL     IS THIS CTRL UNIT IN TABLE? @OZ31878 60120007
         BE    S222B20             YES.  BYPASS THIS ENTRY     @OZ31878 60125007
         LA    14,2(14)            BUMP TO NEXT ENTRY          @OZ31878 60130007
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM COUNT@OZ31878 60135007
         BZ    S222D30             BRANCH IF NO MORE ITEMS     @OZ31878 60140007
         B     S222D10                                         @OZ31878 60145007
S222D30  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?    @OZ31878 60150007
         BE    S222B03             YES.                        @OZ31878 60155007
         MVC   0(1,MOD1REG),OBRCTRL     STORE IN TABLE         @OZ31878 60160007
         B     S228                                            @OZ31878 60165007
S222D50  CLC   TBCTRL,OBRCTRL      DOES CU ENTRY = REQSTED CU? @OZ31878 60170007
         BNE   S222B20             NO. DON'T PUT TERM IN TBL   @OZ31878 60175007
         ZAP   WKTBLCNT,TABLECNT                               @OZ31878 60180007
         BZ    S222D70                                         @OZ31878 60185007
S222D60  CLC   0(1,14),OBRTERM     IS THIS TERMINAL IN THE TBL?@OZ31878 60190007
         BE    S222B20             YES. BYPASS THIS ENTRY      @OZ31878 60195007
         LA    14,2(14)            BUMP TO NEXT ENTRY          @OZ31878 60200007
         SP    WKTBLCNT,=PL2'1'                                @OZ31878 60205007
         BZ    S222D70                                         @OZ31878 60210007
         B     S222D60                                         @OZ31878 60215007
S222D70  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?    @OZ31878 60220007
         BE    S222B03             YES.                        @OZ31878 60225007
         MVC   0(1,MOD1REG),OBRTERM   PUT REMOTE TERM IN TABLE @OZ31878 60230007
         B     S228                                            @OZ31878 60235007
S222G    CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY ?           60250000
         BE    S222B20             YES. BYPASS THIS ERROR DATA          60300000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?        @OZ31878 60350007
         BZ    S225                NO. ADD NEW ITEM TO TABLE   @OZ31878 60400007
S224     CLC   0(2,14),OBRCUA      ARG MATCH TABLE ENTRY ?     @OZ31878 60450007
         BE    S222B20             YES.  BYPASS THIS ARGUMENT  @OZ31878 60500007
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM CNT  @OZ31878 60550007
         BZ    S225                NO MORE ITEMS TO CK--SO ADD @OZ31878 60600007
*                                  THIS NEW ITEM TO TABLE               60750000
         LA    14,2(14)            BUMP TO NEXT TABLE ENTRY             60800000
         B     S224                GO CK ANOTHER ENTRY         @OZ31878 60850007
S225     CP    TABLECNT,=P'32'     MORE THAN 33 ENTRIES--USER  @OZ31878 60890007
*                                  MUST BE PAGING FROM MOD-2   @OZ31878 60930007
         BE    S222B03             PREPARE TO EXIT ROUTINE.    @OZ31878 60970007
         MVC   0(2,MOD1REG),OBRCUA ADD CTRL UNIT TO MOD-1 TABLE@OZ31878 61010007
S228     LA    MOD1REG,2(MOD1REG)  UPDATE TABLE POINTER.       @OZ31878 61050007
         AP    TABLECNT,=P'1'      ADD 1 TO COUNT OF TABLE ITEMS        61150000
         B     S222B20             GO CK ANOTHER ENTRY                  61200000
*********************************************************************** 61250000
*                                                                     * 61300000
*   THIS IS THE MOD-1 TABLE SCANNER ROUTINE                           * 61350000
*                                                                     * 61400000
*********************************************************************** 61450000
MOD1SCAN ST    OUTLOOP,SOUTLOOP    SAVE OUTLOOP REGISTER CONTENT        61500000
         LA    MOD1REG,MOD1TABL    POINT TO MOD-1 TABLE                 61550000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?                 61600000
         BZ    MOD1EXIT            NO. EXIT AND LEAVE TBARG = ADDR.     61650000
MOD1LOOP CLC   0(2,MOD1REG),TBARG  ARG MATCH TABLE ENTRY ?              61700000
         BE    MOD1PASS            YES.  BYPASS THIS ARGUMENT           61750000
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM CNT           61800000
         BZ    MOD1EXIT            NO MORERE ITEMS TO CK--SO EXIT       61850000
         LA    MOD1REG,2(MOD1REG)  BUMP TO NEXT TABLE ENTRY             61900000
         B     MOD1LOOP            GO CHECK ANOTHER ENTRY               61950000
MOD1PASS MVC   TBARG,=X'0000'      CLEAR ARGUMENT = DO NOT USE          62000000
MOD1EXIT L     OUTLOOP,SOUTLOOP    RESTORE THE CONTENT OF OUTLOOP REG   62050000
         BR    LINKREG             RETURN TO CALLER                     62100000
*********************************************************************** 62150000
*                                                                     * 62200000
*        THIS IS THE LOCATE ROUTINE                                   * 62250000
*                                                                     * 62300000
*********************************************************************** 62350000
LOCATE   DFHFC TYPE=GET,DATASET=EMFILE,RDIDADR=RELREC,NORESP=S230       62400000
         B     F190                BRANCH IF GET I/O ERROR.             62450000
S230     L     FIOABAR,TCAFCAA     POINT TO DATA BLK.                   62500000
         MVC   SVRELREC,RELREC     SAVE FOR LAST BBBSS'S                62550000
         CLC   PARM2(3),=C'ALL'    IS THIS 'ALL' BEING CONTINUED?       62600000
         BNE   S250                NO. GO SETUP FOR DATA BLOCK.         62650000
         CLC   TWASLOT,CTRLENTS    YES. SETUP FOR CNTRL BLOCK.          62700000
         BH    S290                QUIT IF GARBAGE KEYED IN.            62750000
         LA    DATAREG,CTRLSLT1                                         62800000
         SR    DATALOOP,DATALOOP   LOOP THRU CONTROL                    62850000
         IC    DATALOOP,CTRLENTS   BLOCK TILL REQUESTED SLOT NBR        62900000
         SR    1,1                 IS SATISFIED.                        62950000
         IC    1,TWASLOT                                                63000000
S235     BCT   1,S240                                                   63050000
         BR    LINKREG                                                  63100000
S240     BCTR  DATALOOP,0                                               63150000
         LA    DATAREG,SLOTLTH(DATAREG)                                 63200000
         B     S235                                                     63250000
S250     LH    DATALOOP,BLKLTH     SETUP LOOP NBR BYTES THIS BLK.       63300000
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM             63350000
         MVC   WRKSLOT,TWASLOT     MOVE TWASLOT TO WRKAREA              63400000
S260     CLI   WRKSLOT,2           IF RQSTED SLOT = 1, THIS IS IT.      63450000
         BL    S320                GO RESUME DISPLAY BUILDING.          63500000
         SR    1,1                                                      63550000
         IC    1,WRKSLOT           DECREMENT SLOT COUNT BY 1.           63600000
         BCTR  1,0                                                      63650000
         STC   1,WRKSLOT                                                63700000
         IC    1,0(DATAREG)        BUMP TO NEXT SLOT.                   63750000
         LTR   1,1                                                      63800000
         BZ    S290                PREVENT LOOP IF GARBAGE INPUT.       63850000
         AR    DATAREG,1                                                63900000
         SR    DATALOOP,1                                               63950000
         LTR   DATALOOP,DATALOOP   VERIFY SLOT NBR VALID FOR THIS BLK.  64000000
         BP    S260                                                     64050000
S290     MVC   TIOADBA(MSG5LTH),MSG5   IF RQSTED SLOT CAN'T             64100000
*                                       BE FOUND, SEND 'SEARCHING ERR'  64150000
         DFHTC TYPE=(WRITE,ERASE)                                       64200000
         DFHPC TYPE=RETURN                                              64250000
S320     BR    LINKREG             RETURN TO MAIN LINE.                 64300000
*********************************************************************** 64350000
Z10      CLC   PARM2(4),=C'CTRL'          IS PARM2 = CTRL ?             64400000
         BE    Z50                        YES.                          64450000
         MVC   TIOATDL(MSG4LTH),MSG4                                    64500000
         B     Z80                                                      64550000
Z20      MVC   TIOATDL(MSG2LTH),MSG2                                    64600000
         B     Z80                                                      64650000
Z30      MVC   TIOATDL(MSG3LTH),MSG3                                    64700000
         B     Z80                                                      64750000
Z40      MVC   TIOATDL(MSG6LTH),MSG6                                    64800000
         B     Z80                                                      64850000
Z50      CLC   MSG7CTRL,=CL2' '           REMOTE CTRL UNIT PRESENT?     64900000
         BNE   Z50A                       YES.                          64950000
         MVC   MSG8CTRL,MSG7LINE          NO. MOVE LOCAL LINE TO CTRL   65000000
         MVC   TIOATDL(MSG8LTH),MSG8                                    65050000
         B     Z80                                                      65100000
Z50A     MVC   TIOATDL(MSG7LTH),MSG7                                    65150000
         B     Z80                                                      65200000
Z70      MVC   MSG1TERM,PARM3        MOVE SYMBOLIC NAME TO ERROR MSG    65250000
         OC    MSG1TERM,=CL8' '      CONVERT X'00' TO BLANK             65300000
         MVC   TIOATDL(MSG1LTH),MSG1                                    65350000
Z80      DFHTC TYPE=(WRITE,ERASE)                                       65400000
         DFHPC TYPE=RETURN                                              65450000
Z130     MVC   MSG13LN,MSG7LINE                                @OZ31885 65460007
         MVC   TIOATDL(MSG13LTH),MSG13                         @OZ31885 65470007
         B     Z80                                             @OZ31885 65480007
*                                                                       65500000
MSG1     DC    AL2(MSG1LTH-4),X'0000'                                   65550000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    65600000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           65650000
         DC    C'BNG002I C UNABLE TO CONVERT SYMBOLIC '                 65700000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           65750000
         DC    C'TERMINAL NAME '                                        65800000
MSG1TERM DC    CL8' '                                                   65850000
MSG1LTH  EQU   *-MSG1                                                   65900000
MSG2     DC    AL2(MSG2LTH-4),X'0000'                                   65950000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    66000000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           66050000
         DC    C'BNG002I C INVALID INPUT FROM SCREEN'                   66100000
MSG2LTH  EQU   *-MSG2                                                   66150000
MSG3     DC    AL2(MSG3LTH-4),X'0000'                                   66200000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    66250000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                        XH 66300000
         DC    C'BNG003I C NO ERRORS RECORDED'                       XH 66350000
MSG3LTH  EQU   *-MSG3                                                   66400000
MSG4     DC    AL2(MSG4LTH-4),X'0000'                                   66450000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    66500000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                        XH 66550000
         DC    C'BNG004I C NO ERRORS RECORDED FOR '                  XH 66600000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                        XH 66650000
         DC    C'LINE '                                                 66700000
NOLINE   DC    CL3' '                                                   66750000
MSG4LTH  EQU   *-MSG4                                                   66800000
MSG5     DC    AL2(MSG5LTH-4),X'0000'                                   66850000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    66900000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           66950000
         DC    C'BNG005I C ERROR NOT FOUND ON FILE FOR '                67000000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           67050000
         DC    C'THE SELECTED ITEM '                                    67100000
MSG5LTH  EQU   *-MSG5                                                   67150000
MSG6     DC    AL2(MSG6LTH-4),X'0000'                                   67200000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    67250000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           67300000
         DC    C'BNG006I C INVALID FORMAT--CHECK PAGE 2 '            XH 67350000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                        XH 67400000
         DC    C'OF MENU FOR CORRECT FORMATS'                        XH 67450000
MSG6LTH  EQU   *-MSG6                                                   67500000
MSG7     DC    AL2(MSG7LTH-4),X'0000'                                   67550000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    67600000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           67650000
         DC    C'BNG007I C NO ERRORS RECORDED FOR REMOTE'            XH 67700000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           67750000
         DC    C'LINE '                                                 67800000
MSG7LINE DC    CL3' '                                                XH 67850000
         DC    C'    CONTROL UNIT '                                     67900000
MSG7CTRL DC    CL2' '                                                XH 67950000
MSG7LTH  EQU   *-MSG7                                                   68000000
MSG8     DC    AL2(MSG8LTH-4),X'0000'                                   68050000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC) XH 68100000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                        XH 68150000
         DC    C'BNG008I C NO ERRORS RECORDED FOR '                  XH 68200000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                        XH 68250000
         DC    C'LOCAL CONTROL UNIT '                                XH 68300000
MSG8CTRL DC    CL3' '                                                XH 68350000
MSG8LTH  EQU   *-MSG8                                                XH 68400000
MSG13    DC    AL2(MSG13LTH-4),X'0000'                         @OZ31885 68405007
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF'          @OZ31885 68410007
         DC    AL1(SF,UNA,IC),AL1(SBA),AL2(L2P1),AL1(SF,PNA)   @OZ31885 68415007
         DC    CL39'BNG013A C NO DATA BLOCKS AVAILABLE FOR '   @OZ31885 68420007
         DC    CL5'LINE '                                      @OZ31885 68425007
MSG13LN  DC    CL3' '                                          @OZ31885 68430007
         DC    CL31':  DATA BASE IN DEGRADED MODE. '           @OZ31885 68435007
         DC    CL39' MUST ALLOCATE MORE BLOCKS THAN LINES'     @OZ31885 68440007
MSG13LTH EQU   *-MSG13                                         @OZ31885 68445007
*********************************************************************** 68450000
HDR3X    DC    AL1(SBA),AL2(L4P1)                                       68500000
HDR1X    DC    AL1(SBA),AL2(L2P1)                                       68550000
DTLENTRY DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'? ) '                     68600000
DTLITEM  DC    CL8' '                                                   68650000
         DC    AL1(SF,PNA)                                              68700000
DTLCOUNT DC    CL4'0001'                                                68750000
DTLLTH   EQU   *-DTLENTRY                                               68800000
ITEMLTH  EQU   DTLITEM-DTLENTRY                                         68850000
COUNTLTH EQU   DTLCOUNT-DTLENTRY                                        68900000
*********************************************************************** 68950000
*                                                                     * 69000000
*   THE FUNCTION/COMPANION TABLE DETERMINES WHICH PROGRAM IS TO WRITE * 69050000
*   THE REQUESTED DISPLAY AND PROVIDES THE CORRECT SCREEN AND COLUMN  * 69100000
*   HEADERS FOR THAT DISPLAY.                                         * 69150000
*                                                                     * 69200000
*********************************************************************** 69250000
TABLE    DS    0C                  FUNCTION/COMPANION TABLE             69300000
         DC    C'ALL',X'00',C'LINE',XL8'00',AL1(SF,PNA)                 69350000
         DC    CL39'    RECAP OF ALL LINES HAVING ERRORS',AL1(SF,PNA)   69400000
         DC    CL39'       LINEID  ERRS        LINEID  ERRS'            69450000
SLOT2    DC    C'LINECTRL',XL8'00',AL1(SF,PNA)                          69500000
         DC    CL17'    RECAP OF LINE',AL1(SF,PNA),CL20' ',AL1(SF,PNA)  69550000
         DC    CL39'      CTRLUNIT ERRS       CTRLUNIT ERRS'            69600000
         DC    C'CTRLTERM',XL8'00',AL1(SF,PNA)                          69650000
         DC    CL18'RECAP OF CTRL UNIT',AL1(SF,PNA),CL19' ',AL1(SF,PNA) 69700000
         DC    CL39'       TERMID  ERRS        TERMID  ERRS'            69750000
         DC    C'3270',XL4'00',C'BNGC3270',CL82' '                      69800000
         DC    C'LOCA',XL4'00',C'BNGCLOCL',CL82' '                      69850000
         DC    C'REMO',XL4'00',C'BNGCRMOT',CL82' '                      69900000
         DC    C'END'                                                   69950000
TABLELTH EQU   *-TABLE                                                  70000000
TABLENTY EQU   SLOT2-TABLE                                              70050000
HDR1     DS    0C                                                       70100000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF'                   70150000
         DC    AL1(SF,UNA,IC,SBA),AL2(L1P36),AL1(SF,MNP)                70200000
HDR1LTH  EQU   *-HDR1                                                   70250000
HDR2     DS    0C                                                       70300000
         DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'?'                        70350000
         DC    AL1(SF,PNA)                                              70400000
         DC    C') PAGE FORWARD '                                       70450000
         DC    CL20' '                                                  70500000
HDR2LTH  EQU   *-HDR2                                                   70550000
HDR3     DS    0C                                                       70600000
         DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'?'                        70650000
         DC    AL1(SF,PNA)                                              70700000
         DC    C') PAGE BACKWRD '                                       70750000
         DC    CL4' '                                                   70800000
         DC    AL1(SF,PIA)                                              70850000
         DC    CL15'BBBSSBBBSSBBBSS'     BBBSSBBBSSBBBSS BLOCK & SLOT   70900000
HDR3LTH  EQU   *-HDR3                                                   70950000
HXTOEB   DC    4XL16'00',C' ',XL15'00',7XL16'00'  THIS TABLE CONVERTS   71000000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  HEX CHARS           71050000
         DC    2XL16'00'                CHARS FA-THRU-FF BACK           71100000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  A THRU F            71150000
EBTOHX   DC    X'00000000000000000000000000000000'     00-0F  THIS      71200000
         DC    X'00000000000000000000000000000000'     10-1F  TABLE     71250000
         DC    X'00000000000000000000000000000000'     20-2F  CONVERTS  71300000
         DC    X'00000000000000000000000000000000'     30-3F  INPUT     71350000
         DC    X'00000000000000000000000000000000'     40-4F  A THRU F  71400000
         DC    X'00000000000000000000000000000000'     50-5F    TO      71450000
         DC    X'00000000000000000000000000000000'     60-6F  0A - 0F   71500000
         DC    X'00000000000000000000000000000000'     70-7F   AND      71550000
         DC    X'00000000000000000000000000000000'     80-8F  F0 - F9   71600000
         DC    X'00000000000000000000000000000000'     90-9F    TO      71650000
         DC    X'00000000000000000000000000000000'     A0-AF  00 - 09   71700000
         DC    X'00000000000000000000000000000000'     B0-BF    AND     71750000
         DC    X'000A0B0C0D0E0F000000000000000000'     C0-CF     *      71800000
         DC    X'00000000000000000000000000000000'     D0-DF   BECOME   71850000
         DC    X'00000000000000000000000000000000'     E0-EF    FF.     71900000
         DC    X'00010203040506070809000000000000'     F0-FF            71950000
LOTOUP   DS    0C          LOWER CASE TO UPPER CASE TR TABLE            72000000
         DC    X'000102030405060708090A0B0C0D0E0F'                      72050000
         DC    X'101112131415161718191A1B1C1D1E1F'                      72100000
         DC    X'202122232425262728292A2B2C2D2E2F'                      72150000
         DC    X'303132333435363738393A3B3C3D3E3F'                      72200000
         DC    X'404142434445464748494A4B4C4D4E4F'                      72250000
         DC    X'505152535455565758595A5B5C5D5E5F'                      72300000
         DC    X'606162636465666768696A6B6C6D6E6F'                      72350000
         DC    X'707172737475767778797A7B7C7D7E7F'                      72400000
         DC    X'80C1C2C3C4C5C6C7C8C98A8B8C8D8E8F'                      72450000
         DC    X'90D1D2D3D4D5D6D7D8D99A9B9C9D9E9F'                      72500000
         DC    X'A0A1E2E3E4E5E6E7E8E9AAABACADAEAF'                      72550000
         DC    X'F0F1F2F3F4F5F6F7F8F9BABBBCBDBEBF'                      72600000
         DC    X'C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF'                      72650000
         DC    X'D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF'                      72700000
         DC    X'E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF'                      72750000
         DC    X'F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF'                      72800000
SLOTTTR  DC    C' '                                                     72850000
PATCH    DS    20F                                             @OX21950 72870007
         LTORG                                                          72900000
         END   BNGCDISP                                                 72950000
./  ADD  SSI=81180046,NAME=BNGCLOCL
*********************************************************************** 00000268
*                                                                     * 00000468
* MODULE NAME = BNGCLOCL                                              * 00000668
*                                                                     * 00000868
* DESCRIPTIVE NAME = CICS DEMF LOCAL TERMINAL ERROR INDEX & TEXT      * 00001068
*                    DISPLAY MODULE                                   * 00001268
*                                                                     * 00001468
* COPYRIGHT = NONE                                                    * 00001668
*                                                                     * 00001868
* STATUS = RELEASE 1, LEVEL 1                                         * 00002068
*                                                                     * 00002268
* FUNCTION = 1) RECEIVES CONTROL FROM BNGCDISP;                       * 00002468
*            2) DISPLAYS CANNED STATUS/SENSE TEXT OF ALL POSSIBLE     * 00002668
*               LOCAL TERMINAL ERROR COMBINATIONS;                    * 00002868
*            3) PROVIDES THE SELECTION DISPLAY OF EXPLANATION AND     * 00003068
*               POSSIBLE CAUSES ON THE LOCAL TERMINAL STATUS/SENSE    * 00003268
*               WHICH IS SELECTED BY DEMF USER;                       * 00003468
*            4) RETURNS CONTROL TO CICS.                              * 00003668
*                                                                     * 00003868
* NOTES = NONE                                                        * 00004068
*                                                                     * 00004268
*    DEPENDENCIES =                                                   * 00004468
*                                                                     * 00004668
*    THE FOLLOWING ARE CICS TABLES/CONTROL BLOCKS AND THEIR LABELS    * 00004868
*    USED BY DEMF CICS MODULES (BNGCDISP,BNGC3270,BNGCLOCL,BNGCRMOT   * 00005068
*    BNGCMENU) :                                                      * 00005268
*                                                                     * 00005468
*    CICS TABLE AND                                                   * 00005668
*    CONTROL BLOCKS                  LABELS USED                      * 00005868
*    ----------------------          -----------                      * 00006068
*                                                                     * 00006268
*    COMMON SYSTEM AREA              CSATCTBA                         * 00006468
*    (CSA)                                                            * 00006668
*                                                                     * 00006868
*    TERMINAL CONTROL TABLE          TCTTEDA                          * 00007068
*    TERMINAL ENTRY (TCTTE)          TCTTETM                          * 00007268
*                                    TCTTELT                          * 00007468
*                                    TCTTETI                          * 00007668
*                                    TCTTECLT                         * 00007868
*                                    TCTTETEL                         * 00008068
*                                    TCTTETT                          * 00008268
*                                    TCTTEGU                          * 00008468
*                                    TCTTETA                          * 00008668
*                                                                     * 00008868
*    TERMINAL CONTROL TABLE          TCTLELF                          * 00009068
*    LINE ENTRY (TCTLE)              TCTLEFAA                         * 00009268
*                                    TCTLEPI                          * 00009468
*                                    TCTLEMFP                         * 00009668
*                                    TCTLEPA                          * 00009868
*                                    TCTLEDCB                         * 00010068
*                                    TCTLERLN                         * 00010268
*                                                                     * 00010468
*    TERMINAL INPUT/OUTPUT AREA      TIOADBA                          * 00010668
*    (TIOA)                          TIOATDL                          * 00010868
*                                                                     * 00011068
*    TASK CONTROL AREA               TCAFCAAA                         * 00011268
*    (TCA)                           TCAFCAA                          * 00011468
*                                    TCAPCPI                          * 00011668
*                                    TCASCSA                          * 00011868
*                                                                     * 00012068
*    FILE INPUT/OUTPUT AREA          FIOADBA                          * 00012268
*    (FIOA)                                                           * 00012468
*                                                                     * 00012668
*    RESTRICTIONS = NONE                                              * 00012868
*                                                                     * 00013068
*    REGISTER CONVENTIONS = R12 ADDRESS OF TCA                        * 00013268
*                           R13 ADDRESS OF CSA                        * 00013468
*                                                                     * 00013668
*    PATCH LABEL = NONE                                               * 00013868
*                                                                     * 00014068
* MODULE TYPE =  CICS DISPLAY                                         * 00014268
*                                                                     * 00014468
*    PROCESSOR = ASSEMBLER H                                          * 00014668
*                                                                     * 00014868
*    MODULE SIZE = 6400 DECIMAL BYTES                                 * 00015068
*                                                                     * 00015268
*    ATTRIBUTES = QUASI-REENTRANT                                     * 00015468
*                                                                     * 00015668
* ENTRY POINT = BNGCLOCL                                              * 00015868
*                                                                     * 00016068
*    PURPOSE = SEE FUNCTION                                           * 00016268
*                                                                     * 00016468
*    LINKAGE = R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 00016668
*                                                                     * 00016868
* INPUT = PARAM LIST ITEMS USED ARE :  INPUT TIOA AT LABEL - B5       * 00017068
*                                                                     * 00017268
* OUTPUT = PARAM LIST ITEMS USED ARE : OUTPUT TIOA AT LABEL - GETTIOA * 00017468
*                                                                     * 00017668
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 00017868
*               00 - OPERATION PERFORMED AS REQUESTED                 * 00018068
*                                                                     * 00018268
* EXIT-ERROR  = NONE                                                  * 00018468
*                                                                     * 00018668
* EXTERNAL REFERENCE = NONE                                           * 00018868
*                                                                     * 00019068
*    ROUTINES = NONE                                                  * 00019268
*                                                                     * 00019468
*    DATA AREAS = NONE                                                * 00019668
*                                                                     * 00019868
*    CONTROL BLOCK = DFHCSADS, DFHTCTTE, DFHTCADS, DFHTIOA            * 00020068
*                                                                     * 00020268
* TABLES = NONE                                                       * 00020468
*                                                                     * 00020668
* MACROS = DFHCOVER, DFHTC, DFHPC, DFHSC                              * 00020868
*                                                                     * 00021068
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 00021268
* CHANGE 01   11/15/77  PROLOGUE ADDED                                * 00021468
*                                                                     * 00021668
*********************************************************************** 00021868
         TITLE 'DEMF LOCAL SRL TEXT MODULE'                             00031868
         DFHCOVER                                                       00032068
         COPY  DFHCSADS                                                 00062068
         EJECT                                                          00092068
         COPY  DFHTCTTE                                                 00122068
         EJECT                                                          00200168
         COPY  DFHTCADS                                                 00214168
SAVEREG  DS    F                                                        00221168
HALFWORD DS    H                                                        00235168
SBACTR   DS    PL1                                                      00241168
TEXTSW   DC    X'00'                                                    00244168
         EJECT                                                          00250168
         COPY  DFHTIOA                                                  00266168
         EJECT                                                          00274168
         CSECT                                                          00282168
BASEREG  EQU   3                                                        00288168
TCTTEAR  EQU   5                                                        00300168
TIOABAR  EQU   6                                                        00316168
SBAREG   EQU   7                                                        00324168
OUTREG   EQU   8                                                        00332168
LINKREG  EQU   9                                                        00338168
MSGREG   EQU   10                                                       00350168
LIMITREG EQU   11                                                       00362168
NEXTREG  EQU   8                                                        00374168
LTHREG   EQU   7                                                        00380168
INREG    EQU   7                                                        00392168
L18P21   EQU   X'D5E4'   MOD2 SCREEN                                    00394168
SML12P1  EQU   X'C6F8'   MOD1 SCREEN                                    00396168
SBA      EQU   X'11'                        SET BUFFER ADDR COMMAND     00400168
SF       EQU   X'1D'                        START FIELD COMMAND         00416168
IC       EQU   X'13'                        INSERT CURSOR COMMAND       00424168
UNA      EQU   X'40'     UNPROTECTED,NORMAL INTENSITY,ALPHAMERIC        00432168
MNA      EQU   X'61'     MODIFIED,NORMAL INTENSITY,ALPHAMERIC           00438168
MDA      EQU   X'E9'     PROT,MODIFIED,HIGH INTENSITY,ALPHAMERIC        00450168
PDA      EQU   X'E8'     PROTECTED,HIGH INTENSITY,ALPHAMERIC            00466168
PNA      EQU   X'60'     PROTECTED,NORMAL INTENSITY,ALPHAMERIC          00474168
BNGCLOCL BALR  BASEREG,0                                                00482168
         USING *,BASEREG                                                00488168
         B     B5                                                       00500168
         DC    C'DEMF LOCAL SRL TEXT MODULE OS V1.0'                    00510168
B5       L     TCTTEAR,TCAFCAAA                                         00513168
         L     TIOABAR,TCTTEDA                                          00520168
         MVI   INDEXSW,X'00'                SET INDEXSW = OFF           00570168
         LA    INREG,TIOADBA                LOCATE INPUT DATA.          00620168
         CLI   0(INREG),SBA                                             00670168
         BNE   B12                                                      00720168
         LA    INREG,3(INREG)                                           00770168
B12      CLC   15(3,INREG),=C'SS='          IS THIS A RQUEST FOR TEXT?  01150168
         BE    D1                           YES. GO LOCATE IT.          01164168
         MVI   INDEXSW,X'FF'                SET INDEXSW = ON            01166168
B14      EQU   *                            NO. BUILD AN INDEX PAGE.    01171168
         LA    LTHREG,IXHDRLTH+3+(44*(SSLTH+4))+(11*SBALTH)             01185168
         BAL   LINKREG,GETTIOA              FREE INAREA & GET OUTAREA.  01190168
         MVC   0(IXHDRLTH,OUTREG),IXHDR     MOVE INDEX HEADER LINE.     01200168
         LA    OUTREG,IXHDRLTH(OUTREG)                                  01216168
         LA    MSGREG,MSG1                  SETUP TO LOCATE ALL         01224168
         L     LIMITREG,=A(LASTMSG)         'SS=????' FIELDS.           01232168
         ZAP   SBACTR,=P'4'                 SETUP FOR 4 PER LINE.       01238168
B22      CLC   0(3,MSGREG),=X'60E2E2'          IS THIS A SENSE/STATUS?  01250168
         BE    C8                           YES. ADD IT TO OUTAREA.     01260168
B24      LA    MSGREG,1(MSGREG)             NO. CONTINUE LOOKING.       01270168
         CR    MSGREG,LIMITREG              ALL DONE?                   01280168
         BL    B22                          NO.                         01290168
         CLI   TCTTETM,C'2'                 IS THIS FOR MOD2 SCREEN?    01290468
         BNE   C3                           NO.                         01290768
         LA    SBAREG,SBA192C               LOAD LAST SBA ATTR ADDR     01291068
         MVC   0(5,OUTREG),0(SBAREG)        MOVE LAST PROTECTED ATTR    01291368
         LA    OUTREG,5(OUTREG)             BUMP 5 BYTES                01291668
C3       CLI   INDEXSW,X'FF'                IS INDEXSW ON ?             01291968
         BNE   C6                           NO.                         01292268
         CLI   TCTTETM,X'F1'                IS THIS A 3277-1 ?          01292568
         BE    C5                           YES.                        01292868
         MVC   0(HITMSGLL,OUTREG),HITMSGL   MOVE 'HIT CLEAR KEY' MSG    01293168
         LA    OUTREG,HITMSGLL(OUTREG)      BUMP OUTPUT POINTER         01293468
         B     C6                                                       01293768
C5       MVC   0(HITMSGSL,OUTREG),HITMSGS   MOVE 'HIT CLEAR KEY' MSG    01294068
         LA    OUTREG,HITMSGSL(OUTREG)      BUMP OUTPUT POINTER         01294368
C6       LA    1,TIOADBA                    YES.                        01294668
         SR    OUTREG,1                     COMPUTE FINAL               01294968
         STH   OUTREG,TIOATDL               DATA LENGTH.                01295268
         DFHTC TYPE=(WRITE,ERASE)                                       01295568
         DFHPC TYPE=RETURN                                              01295868
*********************************************************************** 01296168
*                                                                     * 01296468
*        RETURN                                                       * 01296768
*                                                                     * 01297068
*********************************************************************** 01297368
C8       CP    SBACTR,=P'4'                 BEGINNING A NEW LINE?       01300168
         BNE   C14                          NO.                         01363168
         CLI   TCTTETM,C'2'                 IS THIS FOR MOD2 DISPLAY?   01363668
         BE    C12                          YES.                        01364168
C11      MVC   0(3,OUTREG),0(SBAREG) XXXX   NO. (MOD1) MOVE NEXT        01364668
         LA    SBAREG,3(SBAREG) XXXX        SBA SEQUENCE                01365168
         LA    OUTREG,3(OUTREG) XXXX        TO OUTPUT AREA.             01365668
         B     C13                                                      01366168
C12      MVC   0(8,OUTREG),0(SBAREG) XXXX   YES. MOVE NEXT              01366668
         LA    SBAREG,8(SBAREG) XXXX        SBA SEQUENCE                01367168
         LA    OUTREG,8(OUTREG) XXXX        TO OUTPUT AREA.             01367668
C13      ZAP   SBACTR,=P'0'                                             01368168
C14      MVC   0(SSLTH,OUTREG),SSMSG        MOVE THIS ITEM              01370168
         MVC   SSLTH(4,OUTREG),4(MSGREG)    TO OUTPUT AREA.             01420168
         LA    OUTREG,(SSLTH+4)(OUTREG)                                 01430168
         AP    SBACTR,=P'1'                 ADD 1 TO ITEMS THIS LINE.   01436168
         B     B24                                                      01450168
D1       L     LIMITREG,=A(LASTMSG)         POINT TO LAST MSG.          01466168
         LA    MSGREG,MSG1                  POINT TO 1ST MSG.           01474168
         LR    NEXTREG,MSGREG                                           01482168
D3       MVC   HALFWORD,0(MSGREG)                                       01488168
         AH    NEXTREG,HALFWORD             POINT TO NEXT MSG.          01500168
         ST    MSGREG,SAVEREG                                           01516168
D4       CLC   0(7,MSGREG),15(INREG)        IS THIS THE DESIRED MSG?    01524168
         BE    D12                          YES, MOVE IT TO OUTAREA.    01532168
         LA    MSGREG,1(MSGREG)             NO. STILL IN THIS MSG?      01538168
         CR    MSGREG,NEXTREG                                           01550168
         BL    D4                           YES. KEEP LOOKING.          01566168
         CR    MSGREG,LIMITREG              ALL MSGS LOOKED AT?         01574168
         BL    D3                           NO. RESET ON NEXT MSG.      01582168
         B     B14                          YES. BAD INPUT; SHOW INDEX. 01588168
D12      L     MSGREG,SAVEREG               RESTORE START OF THIS MSG.  01600168
         LA    LTHREG,PGHDRLTH+(12*SBALTH)                              01614168
         MVC   HALFWORD,0(MSGREG)                                       01621168
         AH    LTHREG,HALFWORD              COMPUTE LTH THIS MSG & HDR. 01635168
         MVI   TEXTSW,X'FF'                 SET GETTIOA SUBR SWT        01637168
         BAL   LINKREG,GETTIOA              FREE INAREA & GET OUTAREA.  01641168
         MVC   0(PGHDRLTH,OUTREG),PGHDR     MOVE PAGE HDR LINE.         01650168
         LA    OUTREG,PGHDRLTH(OUTREG)                                  01666168
         MVC   HALFWORD,0(MSGREG)                                       01674168
         LH    1,HALFWORD                   GET TRUE LENGTH             01682168
         SH    1,=H'2'                      OF THIS MSG.                01688168
D20      CH    1,=H'40'                     ONE MORE FULL LINE TO DO?   01700168
         BH    E2                           YES. MOVE IT.               01716168
         MVC   0(3,OUTREG),0(SBAREG)        NO. MOVE THE                01724168
         EX    1,MOVE                       REMAINDER AND               01732168
         AR    OUTREG,1                     GET OUT.                    01738168
         LA    OUTREG,3(OUTREG)                                         01750168
         B     C3                                                       01766168
E2       MVC   0(3,OUTREG),0(SBAREG)        MOVE NEXT SBA SEQUENCE.     01774168
         LA    SBAREG,3(SBAREG)                                         01782168
         CLI   2(MSGREG),SF       IF THIS IS A LINE                     01788168
         BNE   E5                 CONTAINING ATTRIBUTES,                01800168
         MVC   3(2,OUTREG),2(MSGREG)   MOVE                             01816168
         LA    OUTREG,2(OUTREG)        TWO EXTRA                        01824168
         LA    MSGREG,2(MSGREG)        BYTES.                           01832168
         SH    1,=H'2'                                                  01838168
E5       MVC   3(40,OUTREG),2(MSGREG)       MOVE 40 CHARS OF TEXT.      01850168
         LA    OUTREG,43(OUTREG)                                        01860168
         LA    MSGREG,40(MSGREG)                                        01870168
         SH    1,=H'40'                     DECREMENT RESIDUAL COUNT.   01880168
         B     D20                                                      01890368
*********************************************************************** 01890668
*                                                                     * 01890968
*        NEXT SEQUENCE OF INST CLEARS OUTPUT TIOA TO BLANKS           * 01891268
*                                                                     * 01891568
*********************************************************************** 01891868
GETTIOA  ST    TIOABAR,TCASCSA              FREE ORIGINAL               01892168
         DFHSC TYPE=FREEMAIN                INPUT AREA.                 01892468
         STH   LTHREG,TCASCNB                                           01892768
         DFHSC TYPE=GETMAIN,CLASS=TERM      GET NEW TIOA JUST           01893068
         L     TIOABAR,TCASCSA              THE RIGHT SIZE.             01893368
         ST    TIOABAR,TCTTEDA                                          01893668
         LA    SBAREG,SBA1920                                           01893968
         CLI   TCTTETM,C'2'                 SETUP ON LIST OF 12         01894268
         BE    G11                          SBA SEQUENCES FOR           01894568
G10      LA    SBAREG,SBA480 XXXX           APPROPRIATE TERM MODEL.     01894868
G1A      MVC   TIOADBA(3),0(SBAREG) XXXX                                01895168
         LA    SBAREG,3(SBAREG) XXXX        PRIME OUTAREA FOR LINE 1    01895468
         LA    OUTREG,TIOADBA+3 XXXX        AND SETUP OUTREG FOR        01895768
         BR    LINKREG                                                  01896068
G11      CLI   TEXTSW,X'FF'                 IS TEXTSW ON?               01896368
         BNE   G12                          NOT ON.                     01896668
         LA    SBAREG,SBATXT2               SET SBAREG = SBATXT2 PTR    01896968
         B     G1A                                                      01897268
G12      LA    SBAREG,SBA192A                                           01897568
         MVC   TIOADBA(5),0(SBAREG) XXXX                                01897868
         MVC   TIOADBA+5(5),5(SBAREG) XXXX                              01898168
         MVC   TIOADBA+10(3),10(SBAREG) XXXX                            01898468
         LA    SBAREG,13(SBAREG) XXXX       PRIME OUTAREA FOR LINE 1    01898768
         LA    OUTREG,TIOADBA+13 XXXX       AND SETUP OUTREG FOR        01899068
         BR    LINKREG                      REMAINING DATA.             01899368
SBALTH   EQU   3                                                        01900168
SBA192A  DC    X'1140401D6C'       AL1(SBA),AL2(L1P1),AL1(SF,PIA)       01920168
SBA1920  DC    X'11C7601D6C11C7F411C8F01D6C11C9C4114A401D6C114AD4'      01940168
         DC    X'114B501D6C114BE4114C601D6C114CF4114DF01D6C114EC4'      01960168
         DC    X'114F401D6C114FD41150501D6C1150E411D1601D6C11D1F4'      01980168
         DC    X'11D2F01D6C11D3C411D4401D6C11D4D411D5501D6C11D5E4'      02000168
SBA192C  DC    X'11D2C81D6C'       AL1(SBA),AL2(L15P41),AL1(SF,PIA)     02020168
SBA480   DC    X'1140401140E811C15011C1F811C26011C3C8'                  02100168
         DC    X'11C3F011C4D811C54011C5E811C65011C6F8'                  02110168
SBATXT2  DC    X'11C7F411C9C4114AD4'                                    02111168
         DC    X'114BE4114CF4114EC4'                                    02112168
         DC    X'114FD41150E411D1F4'                                    02113168
         DC    X'11D3C411D4D411D5E4'                                    02114168
SSMSG    DC    AL1(SF,UNA),C'?SS='                                      02120168
SSLTH    EQU   *-SSMSG                                                  02130168
IXHDR    DC    AL1(IC,SF,MNA),C'DEMF LOCAL '                            02140168
         DC    AL1(SF,PNA),C'STATUS INDEX,X OVER ?,ENTER'               02150168
IXHDRLTH EQU   *-IXHDR                                                  02160368
PGHDR    DC    AL1(IC,SF,MNA),C'DEMF LOCAL '                            02170568
         DC    AL1(SF,PNA),C'HIT ENTER TO REFRESH INDEX'                02180168
PGHDRLTH EQU   *-PGHDR                                                  02190368
HITMSGS  DC    AL1(SBA),AL2(SML12P1),AL1(SF,PNA)                        02190468
         DC    C'HIT CLEAR KEY TO EXIT DEMF'                            02190568
HITMSGSL EQU   *-HITMSGS                                                02190668
HITMSGL  DC    AL1(SBA),AL2(L18P21),AL1(SF,PNA)                         02190768
         DC    C'HIT CLEAR KEY TO EXIT DEMF'                            02190868
HITMSGLL EQU   *-HITMSGL                                                02190968
INDEXSW  DC    X'00'           INDEX SWITCH 00=OFF  FF=ON               02191068
MOVE     MVC   3(1,OUTREG),2(MSGREG)                                    02191168
         LTORG                                                          02191268
MSG1     DC    AL2(MSG2-*)                                              02191368
         DC    AL1(SF,PNA),C'SS=0220',AL1(SF,PNA),C'  '                 02191468
         DC    CL29'UNIT CHECK,BUS OUT CHECK'                           02191568
         DC    C'A PARITY CHECK WAS DETECTED ON THE      '              02191668
         DC    C'COMMAND BYTE                            '              02191768
         DC    C'                                        '              02191868
         DC    AL1(SF,PNA),C'SS=0240',AL1(SF,PNA),C'  '                 02191968
         DC    CL29'UNIT CHECK,INTERVENTION REQ''D'                     02192068
         DC    C'A COMMAND OTHER THAN SENSE WAS ADDRESSED'              02192168
         DC    C'TO A DEVICE THAT THE 3272 HAS RECORDED  '              02192268
         DC    C'AS UNAVAILABLE OR NOT READY             '              02192368
         DC    C'                                        '              02192468
         DC    AL1(SF,PNA),C'SS=0280',AL1(SF,PNA),C'  '                 02192568
         DC    CL29'UNIT CHECK,COMMAND REJECT'                          02192668
         DC    C'AN INVALID COMMAND WAS ISSUED TO 3272'                 02192768
MSG2     DC    AL2(MSG3-*)                                              02192868
         DC    AL1(SF,PNA),C'SS=0500',AL1(SF,PNA),C'  '                 02192968
         DC    CL29'DEVICE END,UNIT EXCEPTION'                          02193068
         DC    C'3272 ATTEMPTED TO PERFORM A SELECT OR   '              02193168
         DC    C'ERASE ALL UNPROTECTED COMMAND. AFTER RE-'              02193268
         DC    C'TURNING INITIAL STATUS,FOUND ADDRESSED  '              02193368
         DC    CL40'DEVICE BUSY'                                        02193468
         DC    C'                                        '              02193568
         DC    AL1(SF,PNA),C'SS=0601',AL1(SF,PNA),C'  '                 02193668
         DC    CL29'DEVICE END,UNIT CHECK'                              02193768
         DC    CL11' ',CL29'OPERATION CHECK'                            02193868
         DC    C'A WRITE OR ERASE/WRT COMMAND,CONTAINING '              02193968
         DC    C'A WCC WITH A START PRINT BIT,IS CHAINED '              02194068
         DC    C'TO A SUBSEQUENT COMMAND'                               02194168
MSG3     DC    AL2(MSG4-*)                                              02194268
         DC    AL1(SF,PNA),C'SS=0602',AL1(SF,PNA),C'  '                 02194368
         DC    CL29'DEVICE END,UNIT CK,CTRL CK'                         02194468
         DC    C'THE ADDRESSED DEVICE FAILED TO RESPOND  '              02194568
         DC    C'IN A SPECIFIED PERIOD OF TIME TO A      '              02194668
         DC    C'SELECT,WRITE,ERASE/WRT OR AN ERASE ALL  '              02194768
         DC    C'UNPROTECTED COMMAND                     '              02194868
         DC    AL1(SF,PNA),C'SS=0608',AL1(SF,PNA),C'  '                 02194968
         DC    CL29'DEVICE END,UNIT CK,DATA CK'                         02195068
         DC    C'3272 (1) DETECTED PARITY OR CURSOR ERROR'              02195168
         DC    C'DURING A SELECT,WRITE OR ERASE/WRT CMD  '              02195268
         DC    C'OR (2) DETECTED A PARITY CK ON DATA     '              02195368
         DC    C'RECEIVED TO AN INTERNAL POLL'                          02195468
MSG4     DC    AL2(MSG5-*)                                              02195568
         DC    AL1(SF,PNA),C'SS=060C',AL1(SF,PNA),C'  '                 02195668
         DC    CL29'DEVICE END,UNIT CHECK'                              02195768
         DC     CL11' ',CL29'DATA CHECK,UNIT SPECIFY'                   02195868
         DC    C'ADDRESSED DEVICE DETECTED PARITY CK OR  '              02195968
         DC    C'CURSOR CK DURING A SELECT,WRITE,ERASE/- '              02196068
         DC    C'WRT,OR ERASE ALL UNPROTECTED COMMAND    '              02196168
         DC    C'                                        '              02196268
         DC    AL1(SF,PNA),C'SS=0614',AL1(SF,PNA),C'  '                 02196368
         DC    CL29'DEVICE END,UNIT CHECK'                              02196468
         DC    CL11' ',CL29'EQUIPMENT CHECK,UNIT SPECIFY'               02196568
         DC    C'A PRINTER CHARACTER GENERATOR ERROR     '              02196668
         DC    C'OCCURED OR PRINTER BECAME MECHANICALLY  '              02196768
         DC    C'DISABLED DURING PRINTOUT'                              02196868
MSG5     DC    AL2(MSG6-*)                                              02196968
         DC    AL1(SF,PNA),C'SS=0640',AL1(SF,PNA),C'  '                 02197068
         DC    CL29'DEVICE END,UNIT CHECK'                              02200168
         DC    CL11' ',CL29'INTERVENTION REQUIRED'                      02216168
         DC    C'A COMMAND ATTEMPTING TO START A PRINTER '              02224168
         DC    C'FOUND IT NOT READY                      '              02232168
         DC    C'                                        '              02238168
         DC    AL1(SF,PNA),C'SS=0654',AL1(SF,PNA),C'  '                 02250168
         DC    CL29'DEV END,UNIT CK,INTV REQUIRED'                      02266168
         DC    CL11' ',CL29'EQUIPMENT CHECK,UNIT SPECIFY'               02274168
         DC    C'A COMMAND TO START PRINT OPERATION FOUND'              02282168
         DC    C'PRINTER CARRIAGE MOTOR POWER OFF'                      02288168
MSG6     DC    AL2(MSG7-*)                                              02300168
         DC    AL1(SF,PNA),C'SS=0E01',AL1(SF,PNA),C'  '                 02316168
         DC    CL29'CHANNEL END,DEVICE END'                             02324168
         DC    CL11' ',CL29'UNIT CHECK,OPERATION CHECK'                 02332168
         DC    C'ON A WRITE OR ERASE/WRT COMMAND,3272    '              02338168
         DC    C'RECEIVED ILLEGAL BUFFER ADDRESS IN DATA-'              02350168
         DC    C'STREAM,OR DATA ENDED BEFORE PROVIDING   '              02366168
         DC    C'ALL CHARACTERS REQUIRED FOR SBA,RA,SF OR'              02374168
         DC    C'EUA ORDERS'                                            02382168
MSG7     DC    AL2(MSG8-*)                                              02388168
         DC    AL1(SF,PNA),C'SS=0E02',AL1(SF,PNA),C'  '                 02400168
         DC    CL29'CHANNEL END,DEVICE END'                             02416168
         DC    CL11' ',CL29'UNIT CHECK,CONTROL CHECK'                   02424168
         DC    C'ADDRESSED DEVICE FAILED TO RESPOND IN   '              02432168
         DC    C'TIME TO AN ERASE/WRT,UNCHAINED READ     '              02438168
         DC    C'BUFFER,READ MODIFIED OR WRITE COMMAND   '              02450168
         DC    C'                                        '              02466168
         DC    AL1(SF,PNA),C'SS=0E08',AL1(SF,PNA),C'  '                 02474168
         DC    CL29'CHANNEL END,DEVICE END'                             02482168
         DC    CL11' ',CL29'UNIT CHECK,DATA CHECK'                      02488168
         DC    C'3272 DETECTED CURSOR OR PARITY CHECK ON '              02500168
         DC    C'TRANSMISSION OF DATA ON A READ BUFFER OR'              02516168
         DC    C'READ MODIFIED COMMAND'                                 02524168
MSG8     DC    AL2(MSG9-*)                                              02532168
         DC    AL1(SF,PNA),C'SS=0E0C',AL1(SF,PNA),C'  '                 02538168
         DC    CL29'CHANNEL END,DEVICE END'                             02550168
         DC    CL11' ',CL29'UNIT CK,DATA CK,UNIT SPECIFY'               02566168
         DC    C'ADDRESSED DEVICE DETECTED PARITY OR     '              02574168
         DC    C'CURSOR CHECK ON WRITE, READ BUFFER OR   '              02582168
         DC    C'READ MODIFIED COMMAND                   '              02588168
         DC    C'                                        '              02600168
         DC    AL1(SF,PNA),C'SS=0E20',AL1(SF,PNA),C'  '                 02616168
         DC    CL29'CHANNEL END,DEVICE END'                             02624168
         DC    CL11' ',CL29'UNIT CHECK,BUS OUT CHECK'                   02632168
         DC    C'3272 DETECTED A PARITY ERROR ON A CHAR- '              02638168
         DC    C'ACTER IN DATA-STREAM OF A WRITE OR ERASE'              02650168
         DC    C'/WRITE COMMAND'                                        02666168
MSG9     DC    AL2(MSG10-*)                                             02674168
         DC    AL1(SF,PNA),C'SS=0D00',AL1(SF,PNA),C'  '                 02682168
         DC    CL29'CHANNEL END,DEVICE END'                             02688168
         DC    CL11' ',CL29'UNIT EXCEPTION'                             02700168
         DC    C'3272 ATTEMPTED A READ BUFFER,READ MOD-  '              02716168
         DC    C'IFIED,WRITE OR ERASE/WRITE COMMAND BUT  '              02724168
         DC    C'FOUND AFTER RETURNING INITIAL STATUS,   '              02732168
         DC    C'THE ADDRESSED DEVICE WAS BUSY           '              02738168
         DC    C'                                        '              02750168
         DC    AL1(SF,PNA),C'SS=820C',AL1(SF,PNA),C'  '                 02766168
         DC    CL29'ATTENTION,UNIT CHECK'                               02774168
         DC    CL11' ',CL29'DATA CHECK,UNIT SPECIFY'                    02782168
         DC    C'AN IDLE DEVICE DETECTED A PARITY CHECK  '              02788168
         DC    C'OR CURSOR CHECK IN ITS BUFFER'                         02800168
MSG10    DC    AL2(MSG11-*)                                             02816168
         DC    AL1(SF,PNA),C'SS=8210',AL1(SF,PNA),C'  '                 02824168
         DC    CL29'ATTENTION,UNIT CHECK'                               02832168
         DC    CL11' ',CL29'EQUIPMENT CHECK'                            02838168
         DC    C'AN IDLE 3272 POLLED A DEVICE TWICE AND  '              02850168
         DC    C'DETECTED A TRANSMIT PARITY CHECK EACH   '              02866168
         DC    C'TIME ON THE DATA IN THE DEVICE REPLY    '              02874168
         DC    AL1(SF,PNA),C'SS=860C',AL1(SF,PNA),C'  '                 02882168
         DC    CL29'ATTENTION,DEV END,UNIT CHECK'                       02888168
         DC    CL11' ',CL29'DATA CHECK,UNIT SPECIFY'                    02900168
         DC    C'A DEVICE CHANGED FROM NOT AVAILABLE TO  '              02916168
         DC    C'AVAILABLE OR NOT READY TO READY AND DET-'              02924168
         DC    C'ECTED A CURSOR CK IN ITS BUFFER OR A PRI'              02932168
         DC    C'NTER DETECTED A PARITY CK WHILE PRINTING'              02938168
MSG11    DC    AL2(MSG12-*)                                             02950168
         DC    AL1(SF,PNA),C'SS=8640',AL1(SF,PNA),C'  '                 02966168
         DC    CL29'ATTN,DEVICE END,UNIT CK'                            02974168
         DC    CL11' ',CL29'INTERVENTION REQUIRED'                      02982168
         DC    C'THE ADDRESSED PRINTER BECAME NOT READY  '              02988168
         DC    C'(OUT OF PAPER OR COVER OPEN)BEFORE PRINT'              03000168
         DC    C'OPERATION WAS COMPLETED                 '              03016168
         DC    C'                                        '              03024168
         DC    AL1(SF,PNA),C'SS=8654',AL1(SF,PNA),C'  '                 03032168
         DC    CL29'ATTN,DEV END,UNIT CK,INTV REQ'                      03040168
         DC    CL11' ',CL29'EQUIPMENT CHECK,UNIT SPECIFY'               03043168
         DC    C'A PRINTER BECAME MECHANICALLY DISABLED  '              03050168
         DC    C'DURING A PRINTOUT AND AUTOMATIC RECOVERY'              03066168
         DC    C'WAS NOT SUCCESSFUL'                                    03074168
MSG12    DC    AL2(MSG13-*)                                             03082168
         DC    AL1(SF,PNA),C'SS=0000',AL1(SF,PNA),C'  '                 03088168
         DC    CL29'ZERO STATUS     '                                   03100168
         DC    C'NORMAL STATUS FOR ANY COMMAND OTHER THAN'              03116168
         DC    C'NO-OP,SELECT,OR ERASE ALL UNPROTECTED   '              03124168
         DC    C'                                        '              03132168
         DC    AL1(SF,PNA),C'SS=0400',AL1(SF,PNA),C'  '                 03138168
         DC    CL29'DEVICE END          '                               03150168
         DC    C'DENOTES THE FOLLOWING CHANGE IN DEVICE  '              03166168
         DC    C'STATUS--BUSY TO NOT BUSY,NOT AVAILABLE  '              03174168
         DC    C'TO AVAILABLE,BUFFER TRANSFER COMPLETE,  '              03182168
         DC    C'OR ON/OFF LINE SWITCH TO ONLINE'                       03188168
MSG13    DC    AL2(MSG14-*)                                             03200168
         DC    AL1(SF,PNA),C'SS=0800',AL1(SF,PNA),C'  '                 03216168
         DC    CL29'CHANNEL END     '                                   03224168
         DC    C'NORMAL STATUS FOR SELECT OR EAU         '              03232168
         DC    C'                                        '              03238168
         DC    AL1(SF,PNA),C'SS=0C00',AL1(SF,PNA),C'  '                 03250168
         DC    CL29'CHANNEL END,DEVICE END'                             03266168
         DC    C'NORMAL STATUS FOR A NO-OP COMMAND       '              03274168
         DC    C'                                        '              03282168
         DC    AL1(SF,PNA),C'SS=1000',AL1(SF,PNA),C'  '                 03288168
         DC    CL29'BUSY            '                                   03300168
         DC    C'RESPONSE TO A COMMAND ADDRESSED TO A    '              03316168
         DC    C'DEVICE SERVICING A PRIOR ISSUED COMMAND'               03324168
MSG14    DC    AL2(MSG15-*)                                             03332168
         DC    AL1(SF,PNA),C'SS=2000',AL1(SF,PNA),C'  '                 03338168
         DC    CL29'CONTROL UNIT END'                                   03350168
         DC    C'3272 HAD BEEN ADDRESSED WHILE BUSY,BUT  '              03366168
         DC    C'IS NOW NOT BUSY AND FREE TO ACCEPT A NEW'              03374168
         DC    C'COMMAND                                 '              03382168
         DC    C'                                        '              03388168
         DC    AL1(SF,PNA),C'SS=5000',AL1(SF,PNA),C'  '                 03400168
         DC    CL29'STATUS MODIFIER,BUSY'                               03416168
         DC    C'RESPONSE TO A COMMAND ADDRESSED TO A    '              03424168
         DC    C'DEVICE OTHER THAN DEVICE WHOSE STATUS IS'              03432168
         DC    C'PENDING OR DEVICE BEING SERVICED BY 3272'              03438168
MSG15    DC    AL2(LASTMSG-*)                                           03450168
         DC    AL1(SF,PNA),C'SS=HELP',AL1(SF,PNA),C'  '                 03466168
         DC    CL29'LOCAL STATUS/SENSE HELPER.'                         03474168
         DC    CL40'FIELDS "SS=XXXX" REFER TO 1ST BYTE OF'              03482168
         DC    CL40'CSW AND THE SENSE BYTE.  FOR INSTANCE,'             03488168
         DC    CL40'IF ERROR DISPLAY SHOWED CSW=0E00 AND'               03500168
         DC    CL40'SENSE=02, LOOK UP MSG FOR "SS=0E02"'                03512168
LASTMSG  EQU   *                                                        03521168
         END   BNGCLOCL                                                 03530168
./  ADD  SSI=73210089,NAME=BNGCMENU
*********************************************************************** 00000168
*                                                                     * 00000268
* MODULE NAME = BNGCMENU                                              * 00000368
*                                                                     * 00000468
* DESCRIPTIVE NAME = CICS DEMF MENU DISPLAY MODULE                    * 00000568
*                                                                     * 00000668
* COPYRIGHT = NONE                                                    * 00000768
*                                                                     * 00000868
* STATUS = RELEASE 1, LEVEL 1                                         * 00000968
*                                                                     * 00001068
* FUNCTION = 1) RECEIVES CONTROL FROM BNGCDISP;                       * 00001168
*            2) DISPLAYS THE FIRST MENU SCREEN THAT OFFERS A CHOICE   * 00001268
*               OF ALL, 3270, REMOT OR LOCAL DISPLAYS;                * 00001368
*            3) DISPLAYS THE SECOND MENU SCREEN THAT DESCRIBES THE    * 00001468
*               SYNTAX OF THE DEMF COMMANDS AND PARAMETERS WHICH USE  * 00001568
*               EXPLICIT PHYSICAL ADDRESSES OR SYMBOLIC NAMES;        * 00001668
*            4) RETURNS CONTROL TO CICS.                              * 00001768
*                                                                     * 00001868
* NOTES = SEE BELOW                                                   * 00001968
*                                                                     * 00002068
*    DEPENDENCIES =                                                   * 00002168
*                                                                     * 00002268
*    THE FOLLOWING ARE CICS TABLES/CONTROL BLOCKS AND THEIR LABELS    * 00002368
*    USED BY DEMF CICS MODULES (BNGCDISP,BNGC3270,BNGCLOCL,BNGCRMOT   * 00002468
*    BNGCMENU) :                                                      * 00002568
*                                                                     * 00002668
*    CICS TABLE AND                                                   * 00002768
*    CONTROL BLOCKS                  LABELS USED                      * 00002868
*    ----------------------          -----------                      * 00002968
*                                                                     * 00003068
*    COMMON SYSTEM AREA              CSATCTBA                         * 00003168
*    (CSA)                                                            * 00003268
*                                                                     * 00003368
*    TERMINAL CONTROL TABLE          TCTTEDA                          * 00003468
*    TERMINAL ENTRY (TCTTE)          TCTTETM                          * 00003568
*                                    TCTTELT                          * 00003668
*                                    TCTTETI                          * 00003768
*                                    TCTTECLT                         * 00003868
*                                    TCTTETEL                         * 00003968
*                                    TCTTETT                          * 00004068
*                                    TCTTEGU                          * 00004168
*                                    TCTTETA                          * 00004268
*                                                                     * 00004368
*    TERMINAL CONTROL TABLE          TCTLELF                          * 00004468
*    LINE ENTRY (TCTLE)              TCTLEFAA                         * 00004568
*                                    TCTLEPI                          * 00004668
*                                    TCTLEMFP                         * 00004768
*                                    TCTLEPA                          * 00004868
*                                    TCTLEDCB                         * 00004968
*                                    TCTLERLN                         * 00005068
*                                                                     * 00005168
*    TERMINAL INPUT/OUTPUT AREA      TIOADBA                          * 00005268
*    (TIOA)                          TIOATDL                          * 00005368
*                                                                     * 00005468
*    TASK CONTROL AREA               TCAFCAAA                         * 00005568
*    (TCA)                           TCAFCAA                          * 00005668
*                                    TCAPCPI                          * 00005768
*                                    TCASCSA                          * 00005868
*                                                                     * 00005968
*    FILE INPUT/OUTPUT AREA          FIOADBA                          * 00006068
*    (FIOA)                                                           * 00006168
*                                                                     * 00006268
*    RESTRICTIONS = NONE                                              * 00006368
*                                                                     * 00006468
*    REGISTER CONVENTIONS = R12 ADDRESS OF TCA                        * 00006568
*                           R13 ADDRESS OF CSA                        * 00006668
*                                                                     * 00006768
*    PATCH LABEL = NONE                                               * 00006868
*                                                                     * 00006968
* MODULE TYPE = CICS DISPLAY                                          * 00007068
*                                                                     * 00007168
*    PROCESSOR = ASSEMBLER H                                          * 00007268
*                                                                     * 00007368
*    MODULE SIZE = 2176 DECIMAL BYTES                                 * 00007468
*                                                                     * 00007568
*    ATTRIBUTES = QUASI-REENTRANT                                     * 00007668
*                                                                     * 00007768
* ENTRY POINT = BNGCMENU                                              * 00007868
*                                                                     * 00007968
*    PURPOSE = SEE FUNCTION                                           * 00008068
*                                                                     * 00008168
*    LINKAGE = R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 00008268
*                                                                     * 00008368
* INPUT = PARAM LIST ITEMS USED ARE : INPUT TIOA AT BEGINNING OF PGM  * 00008468
*                                                                     * 00008568
* OUTPUT = PARAM LIST ITEMS USED ARE : OUTPUT TIOA AT LABEL - C10     * 00008668
*                                                                     * 00008768
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 00008868
*               00 - OPERATION PERFORMED AS REQUESTED                 * 00008968
*                                                                     * 00009068
* EXIT-ERROR  = NONE                                                  * 00009168
*                                                                     * 00009268
* EXTERNAL REFERENCE = NONE                                           * 00009368
*                                                                     * 00009468
*    ROUTINES = NONE                                                  * 00009568
*                                                                     * 00009668
*    DATA AREAS = NONE                                                * 00009768
*                                                                     * 00009868
*    CONTROL BLOCK = DFHCSADS, DFHTCTTE, DFHTCTLE, DFHTIOA, DFHTCADS  * 00009968
*                                                                     * 00010068
* TABLES = NONE                                                       * 00010168
*                                                                     * 00010268
* MACROS = DFHSC, DFHTC, DFHPC                                        * 00010368
*                                                                     * 00010468
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 00010568
* CHANGE 01   11/15/77  PROLOGUE ADDED                                * 00010668
*                                                                     * 00010768
*********************************************************************** 00010868
         TITLE 'DISPLAY EXCEPTION MONITORING FACILITY MENU PROGRAM'     00019868
         PRINT OFF                                                      00019968
         COPY  DFHCSADS                                                 00020068
         COPY  DFHTCTTE                                                 00030068
         COPY  DFHTCTLE                                                 00040068
         COPY  DFHTIOA                                                  00050068
         COPY  DFHTCADS                                                 00066068
         PRINT ON                                                       00074068
PARM1    DS    D                   1ST INPUT PARM - DEMF                00082068
PARM2    DS    D                   2ND INPUT PARM - MENU                00088068
PARM3    DS    D                   3RD INPUT PARM - X                   00100068
*********************************************************************** 00116068
BNGCMENU CSECT                                                          00124068
SBA      EQU   X'11'               SET BUFFER ADDRESS                   00132068
SF       EQU   X'1D'               START FIELD                          00138068
IC       EQU   X'13'               INSERT CURSOR                        00150068
PNA      EQU   X'60'               PROTECTED,NORMAL,ALPHAMERIC          00166068
PHA      EQU   X'E8'               PROTECTED,HIGH INTENSITY,ALPHAMERIC  00174068
UNA      EQU   X'40'               UNPROT,NORMAL,ALPHAMERIC             00182068
MNP      EQU   X'61'               MODIFIED,NORMAL,PROTECTED,ALPHAMERIC 00188068
L1P1     EQU   X'4040'             LINE 1 POSITION 1                    00200068
L1P35    EQU   X'40E2'                                                  00216068
L1P36    EQU   X'40E3'                                                  00224068
L2P1LG   EQU   X'C150'             LINE 2 POSITION 1 -LARGE SCREEN      00232068
L2P29SM  EQU   X'C1C4'             LINE 2 POSITION 29-SMALL SCREEN      00238068
L2P70    EQU   X'C2D5'                                                  00250068
L3P1SM   EQU   X'C150'             LINE 3 POSITION 1 -SMALL SCREEN      00266068
L4P1SM   EQU   X'C1F8'             LINE 4 POSITION 1 -SMALL SCREEN      00274068
L4P2SM   EQU   X'C1F9'                                                  00282068
L4P4SM   EQU   X'C17B'                                                  00288068
L4P15SM  EQU   X'C2C6'                                                  00300068
L5P1SM   EQU   X'C260'                                                  00316068
L5P2SM   EQU   X'C261'                                                  00324068
L5P4SM   EQU   X'C2E3'                                                  00332068
L5P15SM  EQU   X'C26E'                                                  00338068
L6P1SM   EQU   X'C3C8'                                                  00350068
L6P2SM   EQU   X'C3C9'                                                  00366068
L6P4SM   EQU   X'C34B'                                                  00374068
L6P15SM  EQU   X'C3D6'                                                  00382068
L7P16SM  EQU   X'C37F'                                                  00388068
L8P1SM   EQU   X'C4D8'                                                  00400068
L8P2SM   EQU   X'C4D9'                                                  00416068
L8P4SM   EQU   X'C45B'                                                  00424068
L8P15SM  EQU   X'C4E6'                                                  00432068
L9P16SM  EQU   X'C54F'                                                  00438068
L10P1SM  EQU   X'C5E8'                                                  00450068
L10P2SM  EQU   X'C5E9'                                                  00466068
L10P3SM  EQU   X'C56A'                                                  00474068
L10P4SM  EQU   X'C56B'                                                  00482068
L11P8SM  EQU   X'C6D7'                                                  00488068
L12P8SM  EQU   X'C67F'                                                  00500068
L3P3LG   EQU   X'C2E2'                                                  00516068
L3P25LG  EQU   X'C2F8'                                                  00524068
L4P1LG   EQU   X'C3F0'                                                  00532068
L4P23LG  EQU   X'C4C6'                                                  00538068
L5P1LG   EQU   X'C540'                                                  00550068
L5P23LG  EQU   X'C5D6'                                                  00566068
L6P1LG   EQU   X'C650'                                                  00574068
L6P20LG  EQU   X'C6E3'                                                  00582068
L6P23LG  EQU   X'C6E6'                                                  00588068
L7P1LG   EQU   X'C760'                                                  00600068
L7P21LG  EQU   X'C7F4'                                                  00616068
L7P23LG  EQU   X'C7F6'                                                  00624068
L8P1LG   EQU   X'C8F0'                                                  00632068
L8P21LG  EQU   X'C9C4'                                                  00638068
L8P23LG  EQU   X'C9C6'                                                  00650068
L9P1LG   EQU   X'4A40'                                                  00666068
L9P21LG  EQU   X'4AD4'                                                  00674068
L9P23LG  EQU   X'4AD6'                                                  00682068
L10P21LG EQU   X'4BE4'                                                  00688068
L10P23LG EQU   X'4BE6'                                                  00700068
L12P1LG  EQU   X'4DF0'                                                  00716068
*                                                                       00724068
L6P56    EQU   X'C7C7'                                                  00732068
L6P61    EQU   X'C74C'                                                  00738068
L7P50    EQU   X'C8D1'                                                  00750068
L9P22LG  EQU   X'4AD5'                                                  00766068
L9P24LG  EQU   X'4AD7'                                                  00774068
L9P35LG  EQU   X'4AE2'                                                  00782068
L10P22LG EQU   X'4BE5'                                                  00788068
L10P24LG EQU   X'4BE7'                                                  00800068
L10P35LG EQU   X'4BF2'                                                  00816068
L11P21LG EQU   X'4CF4'                                                  00824068
L11P22LG EQU   X'4CF5'                                                  00832068
L11P24LG EQU   X'4CF7'                                                  00838068
L11P35LG EQU   X'4DC2'                                                  00850068
L12P36LG EQU   X'4ED3'                                                  00866068
L13P21   EQU   X'4FD4'                                                  00874068
L13P22   EQU   X'4FD5'                                                  00882068
L13P24   EQU   X'4FD7'                                                  00888068
L13P35   EQU   X'4FE2'                                                  00900068
L14P36   EQU   X'50F3'                                                  00916068
L15P21   EQU   X'D1F4'                                                  00924068
L15P22   EQU   X'D1F5'                                                  00932068
L15P23   EQU   X'D1F6'                                                  00938068
L15P24   EQU   X'D1F7'                                                  00950068
L16P28   EQU   X'D34B'                                                  00966068
L17P28   EQU   X'D45B'                                                  00974068
BASE1    EQU   3             BASE REGISTER ONE = 0-4095                 00982068
BASE2    EQU   4             BASE REGISTER TWO = 4096-8191              00988068
TCTTEAR  EQU   5             POINTS TO TCTTE                            01000068
TIOABAR  EQU   6             POINTS TO TIOA                             01016068
*********************************************************************** 01024068
         PRINT NOGEN                                                    01032068
         BALR  BASE1,0                                                  01038068
         USING *,BASE1,BASE2                                            01050068
         LA    BASE2,2048(BASE1)                                        01066068
         LA    BASE2,2048(BASE2)                                        01074068
         L     TCTTEAR,TCAFCAAA                                         01082068
         L     TIOABAR,TCTTEDA                                          01086068
*********************************************************************** 01090068
         CLC   TIOADBA+15(2),=X'D1F5'    (L15P22) A PAGE 2 REQUEST-LG?  01100068
         BE    B10                        YES.                          01114068
A10      CLC   TIOADBA+15(2),=X'C5E9'    (L10P2SM)A PAGE 2 REQUEST-SM?  01121068
         BNE   C10                        NO.                           01135068
B10      MVC   PARM1(4),=C'PAGE'                                        01138068
*********************************************************************** 01141068
C10      DFHSC TYPE=GETMAIN,CLASS=TERM,NUMBYTE=2000                     01150068
         L     TCTTEAR,TCAFCAAA                                         01164068
         L     TIOABAR,TCASCSA                                          01171068
         ST    TIOABAR,TCTTEDA                                          01185068
         CLI   TCTTETM,C'1'        IS THIS A SMALL SCREEN?              01190068
         BE    SMALL               YES. USE SMALL MENU.                 01200068
         CLC   PARM1(4),=C'PAGE'   IS THIS A PAGE 2 REQUEST?            01216068
         BE    PAGE2LG             YES.                                 01224068
         LA    1,LG1LTH            POINT TO LARGE 1 MENU                01232068
         LA    14,LG1MSG                                                01238068
EXIT     DS    0H                                                       01250068
         LA    0,TIOATDL                                                01266068
         LR    15,1                                                     01274068
         MVCL  0,14                                                     01282068
         DFHTC TYPE=(WRITE,ERASE)                                       01288068
         DFHPC TYPE=RETURN                                              01300068
SMALL    CLC   PARM1(4),=C'PAGE'   IS THIS A PAGE 2 REQUEST?            01316068
         BE    PAGE2SM            YES.                                  01324068
         LA    1,SM1LTH         POINT TO SMALL 1 MENU                   01332068
         LA    14,SM1MSG                                                01338068
         B     EXIT                                                     01350068
PAGE2SM  LA    1,SM2LTH         POINT TO SMALL 2 MENU                   01366068
         LA    14,SM2MSG                                                01374068
         B     EXIT                                                     01382068
PAGE2LG  LA    1,LG2LTH         POINT TO LARGE 2 MENU                   01388068
         LA    14,LG2MSG                                                01400068
         B     EXIT                                                     01416068
LG1MSG   DC    AL2(LG1LTH-4),X'0000',AL1(SBA),AL2(L6P20LG),AL1(SF,MNP)  01424068
         DC    C'DEMF',AL1(SF,UNA),AL1(SBA),AL2(L6P56),AL1(SF,MNP)      01426068
         DC    C'MENU',AL1(SBA),AL2(L6P61),AL1(SF,PNA)                  01432068
 DC AL1(SBA),AL2(L7P21LG),C'CICS VERSION'                               01457068
 DC AL1(SBA),AL2(L7P50),C'PAGE 1 OF 2'                                  01464068
 DC AL1(SBA),AL2(L8P21LG),C'TYPE IN COMMAND OR X IN ? TO DISPLAY:'      01471068
 DC AL1(SBA),AL2(L9P21LG),C'(',AL1(SBA),AL2(L9P22LG)                    01474068
 DC AL1(SF,UNA,IC),C'?',AL1(SBA),AL2(L9P24LG),AL1(SF,PNA),C')ALL'       01477068
 DC AL1(SBA),AL2(L9P35LG),C'RECAP OF ERRS ON ALL LINES'                 01485068
 DC AL1(SBA),AL2(L10P21LG),C'(',AL1(SBA),AL2(L10P22LG),AL1(SF,UNA),C'?' 01495068
 DC AL1(SBA),AL2(L10P24LG),AL1(SF,PNA),C')3270'                         01520068
 DC AL1(SBA),AL2(L10P35LG),C'ERR DATA ON YOUR TERMINAL'                 01530068
 DC AL1(SBA),AL2(L11P21LG),C'(',AL1(SBA),AL2(L11P22LG),AL1(SF,UNA),C'?' 01536068
 DC AL1(SBA),AL2(L11P24LG),AL1(SF,PNA),C')REMOTE'                       01550068
 DC AL1(SBA),AL2(L11P35LG),C'TEXT OF REMOTE 327X STATUS'                01566068
 DC AL1(SBA),AL2(L12P36LG),C'AND SENSE COMBINATIONS'                    01574068
 DC AL1(SBA),AL2(L13P21),C'(',AL1(SBA),AL2(L13P22),AL1(SF,UNA),C'?'     01582068
 DC AL1(SBA),AL2(L13P24),AL1(SF,PNA),C')LOCAL'                          01588068
 DC AL1(SBA),AL2(L13P35),C'TEXT OF LOCAL 327X STATUS'                   01600068
 DC AL1(SBA),AL2(L14P36),C'AND SENSE COMBINATIONS'                      01610068
 DC AL1(SBA),AL2(L15P21),AL1(SF,MNP),C'DEPRESS ENTER KEY FOR PAGE 2'    01620068
 DC C'--CONTAINS'                                                       01630068
 DC AL1(SBA),AL2(L16P28),C'COMMAND FORMATS USED TO DIRECTLY'            01650068
 DC AL1(SBA),AL2(L17P28),C'ADDRESS A LINE, CTRL UNIT,OR TERML'          01666068
LG1LTH   EQU   *-LG1MSG                                                 01674068
LG2MSG   DC    AL2(LG2LTH-4),X'0000',AL1(SBA),AL2(L1P1),AL1(SF,MNP)     01682068
         DC    C'DEMF',AL1(SF,UNA,IC),AL1(SBA),AL2(L1P35),AL1(SF,MNP)   01688068
         DC    C'MENU',AL1(SF,PNA)                                      01700068
 DC AL1(SBA),AL2(L2P1LG),C'CICS VERSION'                                01716068
 DC AL1(SBA),AL2(L2P70),C'PAGE 2 OF 2'                                  01724068
 DC AL1(SBA),AL2(L3P3LG),C'KEY IN:'                                     01732068
 DC AL1(SBA),AL2(L3P25LG),C'YOU WILL SEE:'                              01738068
 DC AL1(SBA),AL2(L4P1LG),C'DEMF LINE LLL',AL1(SBA),AL2(L4P23LG)         01750068
 DC C'ERRS BY CONTROL UNIT ON SELECTED LINE LLL'                        01766068
 DC AL1(SBA),AL2(L5P1LG),C'DEMF CTRL LLL CC',AL1(SBA),AL2(L5P23LG)      01774068
 DC C'ERRS BY TERMINAL ON REMOTE CONTROL UNIT LLL CC'                   01782068
 DC AL1(SBA),AL2(L6P1LG),C'DEMF CTRL CCC',AL1(SBA),AL2(L6P23LG)         01788068
 DC C'ERRS BY TERMINAL ON LOCAL CONTROL UNIT CCC'                       01800068
 DC AL1(SBA),AL2(L7P1LG),C'DEMF 3270 LLL CC TT',AL1(SBA),AL2(L7P23LG)   01816068
 DC C'ERR DESCRIPTIVE DATA OF REMOTE TERMINAL LLL CC TT'                01824068
 DC AL1(SBA),AL2(L8P1LG),C'DEMF 3270 TTT',AL1(SBA),AL2(L8P23LG)         01832068
 DC C'ERR DESCRIPTIVE DATA OF LOCAL TERMINAL TTT'                       01838068
 DC AL1(SBA),AL2(L9P1LG),C'DEMF 3270 SYMBNAME',AL1(SBA),AL2(L9P23LG)    01850068
 DC C'ERR DESCRIPTIVE DATA OF LOCAL OR REMOTE TERMINAL'                 01866068
 DC AL1(SBA),AL2(L10P23LG),C'WITH CICS NAME',AL1(SBA),AL2(L12P1LG)      01874068
 DC C'TYPE X IN PLACE OF ? ON DISPLAYS TO PAGE OR VIEW LOWER LEVEL '    01882068
 DC C'OF DETAIL'                                                        01888068
LG2LTH   EQU   *-LG2MSG                                                 01900068
SM1MSG   DC    AL2(SM1LTH-4),X'0000',AL1(SBA),AL2(L1P1),AL1(SF,MNP)     01916068
         DC    C'DEMF',AL1(SF,UNA),AL1(SBA),AL2(L1P35),AL1(SF,MNP)      01918068
         DC    C'MENU',AL1(SF,PNA),C'CICS VERSION'                      01924068
 DC AL1(SBA),AL2(L2P29SM),C'PAGE 1 OF 2'                                01932068
 DC AL1(SBA),AL2(L3P1SM),C'TYPE IN COMMAND OR X IN ? TO DISPLAY:'       01950068
 DC AL1(SBA),AL2(L4P1SM),C'(',AL1(SBA),AL2(L4P2SM),AL1(SF,UNA,IC),C'?'  01953068
 DC AL1(SBA),AL2(L4P4SM),AL1(SF,PNA),C')ALL'                            01960068
 DC AL1(SBA),AL2(L4P15SM),C'RECAP OF ERRS ON ALL LINES'                 01982068
 DC AL1(SBA),AL2(L5P1SM),C'(',AL1(SBA),AL2(L5P2SM),AL1(SF,UNA),C'?'     01988068
 DC AL1(SBA),AL2(L5P4SM),AL1(SF,PNA),C')3270'                           02000068
 DC AL1(SBA),AL2(L5P15SM),C'ERR DATA ON YOUR TERMINAL'                  02016068
 DC AL1(SBA),AL2(L6P1SM),C'(',AL1(SBA),AL2(L6P2SM),AL1(SF,UNA),C'?'     02024068
 DC AL1(SBA),AL2(L6P4SM),AL1(SF,PNA),C')REMOTE'                         02032068
 DC AL1(SBA),AL2(L6P15SM),C'TEXT OF REMOTE 327X STATUS'                 02038068
 DC AL1(SBA),AL2(L7P16SM),C'AND SENSE COMBINATIONS'                     02050068
 DC AL1(SBA),AL2(L8P1SM),C'(',AL1(SBA),AL2(L8P2SM),AL1(SF,UNA),C'?'     02066068
 DC AL1(SBA),AL2(L8P4SM),AL1(SF,PNA),C')LOCAL'                          02074068
 DC AL1(SBA),AL2(L8P15SM),C'TEXT OF LOCAL 327X STATUS'                  02082068
 DC AL1(SBA),AL2(L9P16SM),C'AND SENSE COMBINATIONS'                     02088068
 DC AL1(SBA),AL2(L10P1SM),AL1(SF,MNP),C'DEPRESS ENTER KEY FOR PAGE 2'   02100068
 DC C'--CONTAINS'                                                       02110068
 DC AL1(SBA),AL2(L11P8SM),C'COMMAND FORMATS USED TO DIRECTLY'           02130068
 DC AL1(SBA),AL2(L12P8SM),C'ADDRESS A LINE, CTRL UNIT,OR TERM'          02136068
SM1LTH   EQU   *-SM1MSG                                                 02150068
SM2MSG   DC    AL2(SM2LTH-4),X'0000',AL1(SBA),AL2(L1P1),AL1(SF,MNP)     02166068
         DC    C'DEMF',AL1(SF,UNA,IC),AL1(SBA),AL2(L1P35),AL1(SF,MNP)   02174068
         DC    C'MENU',AL1(SF,PNA)                                      02182068
         DC    CL40'CICS VERSION                PAGE 2 OF 2'            02188068
         DC    CL40'  KEY IN:               YOU WILL SEE:'              02200068
         DC    CL40'DEMF LINE LLL       ERRS BY CONTROL UNIT'           02216068
         DC    CL40'DEMF CTRL LLL CC    ERRS BY REMOTE TERML'           02224068
         DC    CL40'DEMF CTRL CCC       ERRS BY LOCAL TERML'            02232068
         DC    CL40'DEMF 3270 LLL CC TT STATUS OF RMOT TERML'           02238068
         DC    CL40'DEMF 3270 TTT       STATUS OF LOCL TERML'           02250068
         DC    CL40'DEMF 3270 SYMBNAME  STATUS OF RMT OR LOC'           02266068
         DC    CL40'                    TERML WITH CICS NAME'           02274068
         DC    CL40'TYPE X IN PLACE OF ? ON DISPLAYS TO PAGE'           02282068
         DC    CL40'OR VIEW LOWER LEVEL OF DETAIL'                      02288068
SM2LTH   EQU   *-SM2MSG                                                 02300068
         LTORG                                                          02310068
         END   BNGCMENU                                                 02320068
./  ADD  SSI=81180047,NAME=BNGCRMOT
*********************************************************************** 00000168
*                                                                     * 00000268
* MODULE NAME = BNGCRMOT                                              * 00000368
*                                                                     * 00000468
* DESCRIPTIVE NAME = CICS DEMF REMOTE TERMINAL ERROR INDEX & TEXT     * 00000568
*                    DISPLAY MODULE                                   * 00000668
*                                                                     * 00000768
* COPYRIGHT = NONE                                                    * 00000868
*                                                                     * 00000968
* STATUS = RELEASE 1, LEVEL 1                                         * 00001068
*                                                                     * 00001168
* FUNCTION = 1) RECEIVES CONTROL FROM BNGCDISP;                       * 00001268
*            2) DISPLAYS CANNED STATUS/SENSE TEXT OF ALL POSSIBLE     * 00001368
*               REMOTE TERMINAL ERROR COMBINATIONS;                   * 00001468
*            3) PROVIDES THE SELECTION DISPLAY OF EXPLANATION AND     * 00001568
*               POSSIBLE CAUSES ON THE REMOTE TERMINAL STATUS/SENSE   * 00001668
*               WHICH IS SELECTED BY DEMF USER;                       * 00001768
*            4) RETURNS CONTROL TO CICS.                              * 00001868
*                                                                     * 00001968
* NOTES = NONE                                                        * 00002068
*                                                                     * 00002168
*    DEPENDENCIES =                                                   * 00002268
*                                                                     * 00002368
*    THE FOLLOWING ARE CICS TABLES/CONTROL BLOCKS AND THEIR LABELS    * 00002468
*    USED BY DEMF CICS MODULES (BNGCDISP,BNGC3270,BNGCLOCL,BNGCRMOT   * 00002568
*    BNGCMENU) :                                                      * 00002668
*                                                                     * 00002768
*    CICS TABLE AND                                                   * 00002868
*    CONTROL BLOCKS                  LABELS USED                      * 00002968
*    ----------------------          -----------                      * 00003068
*                                                                     * 00003168
*    COMMON SYSTEM AREA              CSATCTBA                         * 00003268
*    (CSA)                                                            * 00003368
*                                                                     * 00003468
*    TERMINAL CONTROL TABLE          TCTTEDA                          * 00003568
*    TERMINAL ENTRY (TCTTE)          TCTTETM                          * 00003668
*                                    TCTTELT                          * 00003768
*                                    TCTTETI                          * 00003868
*                                    TCTTECLT                         * 00003968
*                                    TCTTETEL                         * 00004068
*                                    TCTTETT                          * 00004168
*                                    TCTTEGU                          * 00004268
*                                    TCTTETA                          * 00004368
*                                                                     * 00004468
*    TERMINAL CONTROL TABLE          TCTLELF                          * 00004568
*    LINE ENTRY (TCTLE)              TCTLEFAA                         * 00004668
*                                    TCTLEPI                          * 00004768
*                                    TCTLEMFP                         * 00004868
*                                    TCTLEPA                          * 00004968
*                                    TCTLEDCB                         * 00005068
*                                    TCTLERLN                         * 00005168
*                                                                     * 00005268
*    TERMINAL INPUT/OUTPUT AREA      TIOADBA                          * 00005368
*    (TIOA)                          TIOATDL                          * 00005468
*                                                                     * 00005568
*    TASK CONTROL AREA               TCAFCAAA                         * 00005668
*    (TCA)                           TCAFCAA                          * 00005768
*                                    TCAPCPI                          * 00005868
*                                    TCASCSA                          * 00005968
*                                                                     * 00006068
*    FILE INPUT/OUTPUT AREA          FIOADBA                          * 00006168
*    (FIOA)                                                           * 00006268
*                                                                     * 00006368
*    RESTRICTIONS = NONE                                              * 00006468
*                                                                     * 00006568
*    REGISTER CONVENTIONS = R12 ADDRESS OF TCA                        * 00006668
*                           R13 ADDRESS OF CSA                        * 00006768
*                                                                     * 00006868
*    PATCH LABEL = NONE                                               * 00006968
*                                                                     * 00007068
* MODULE TYPE =  CICS DISPLAY                                         * 00007168
*                                                                     * 00007268
*    PROCESSOR = ASSEMBLER H                                          * 00007368
*                                                                     * 00007468
*    MODULE SIZE = 11624 DECIMAL BYTES                                * 00007568
*                                                                     * 00007668
*    ATTRIBUTES = QUASI-REENTRANT                                     * 00007768
*                                                                     * 00007868
* ENTRY POINT = BNGCRMOT                                              * 00007968
*                                                                     * 00008068
*    PURPOSE = SEE FUNCTION                                           * 00008168
*                                                                     * 00008268
*    LINKAGE = R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 00008368
*                                                                     * 00008468
* INPUT = PARAM LIST ITEMS USED ARE : INPUT TIOA AT LABEL - B5        * 00008568
*                                                                     * 00008668
* OUTPUT = PARAM LIST ITEMS USED ARE : OUTPUT TIOA AT LABEL - GETTIOA * 00008768
*                                                                     * 00008868
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 00008968
*               00 - OPERATION PERFORMED AS REQUESTED                 * 00009068
*                                                                     * 00009168
* EXIT-ERROR  = NONE                                                  * 00009268
*                                                                     * 00009368
* EXTERNAL REFERENCE = NONE                                           * 00009468
*                                                                     * 00009568
*    ROUTINES = NONE                                                  * 00009668
*                                                                     * 00009768
*    DATA AREAS = NONE                                                * 00009868
*                                                                     * 00009968
*    CONTROL BLOCK = DFHCSADS, DFHTCTTE, DFHTCADS, DFHTIOA            * 00010068
*                                                                     * 00010168
* TABLES = NONE                                                       * 00010268
*                                                                     * 00010368
* MACROS = DFHCOVER, DFHTC, DFHPC, DFHSC                              * 00010468
*                                                                     * 00010568
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 00010668
* CHANGE 01   11/15/77  PROLOGUE ADDED                                * 00010768
*                                                                     * 00010868
*********************************************************************** 00010968
         TITLE 'DEMF REMOTE SRL TEXT MODULE'                            00013868
         DFHCOVER                                                       00013968
         COPY  DFHCSADS                                                 00014068
         EJECT                                                          00014168
         COPY  DFHTCTTE                                                 00014268
         EJECT                                                          00014368
         COPY  DFHTCADS                                                 00014468
SAVEREG  DS    F                                                        00014568
HALFWORD DS    H                                                        00014668
SBACTR   DS    PL1                                                      00014768
TEXTSW   DC    X'00'                                                    00014868
         EJECT                                                          00014968
         COPY  DFHTIOA                                                  00015068
         EJECT                                                          00015168
         CSECT                                                          00015268
BASEREG  EQU   3                                                        00015368
TCTTEAR  EQU   5                                                        00015468
TIOABAR  EQU   6                                                        00015568
SBAREG   EQU   7                                                        00015668
OUTREG   EQU   8                                                        00015768
LINKREG  EQU   9                                                        00015868
MSGREG   EQU   10                                                       00015968
LIMITREG EQU   11                                                       00016068
NEXTREG  EQU   8                                                        00016168
LTHREG   EQU   7                                                        00016268
INREG    EQU   7                                                        00016368
L18P21   EQU   X'D5E4'   MOD2 SCREEN                                    00016468
SML12P1  EQU   X'C6F8'   MOD1 SCREEN                                    00016568
SBA      EQU   X'11'                        SET BUFFER ADDR COMMAND     00016768
SF       EQU   X'1D'                        START FIELD COMMAND         00016968
IC       EQU   X'13'                        INSERT CURSOR COMMAND       00017168
UNA      EQU   X'40'     UNPROTECTED,NORMAL INTENSITY,ALPHAMERIC        00017368
MNA      EQU   X'61'     MODIFIED,NORMAL INTENSITY,ALPHAMERIC           00017768
MDA      EQU   X'E9'     PROT,MODIFIED,HIGH INTENSITY,ALPHAMERIC        00017868
PDA      EQU   X'E8'     PROTECTED,HIGH INTENSITY,ALPHAMERIC            00017968
PNA      EQU   X'60'     PROTECTED,NORMAL INTENSITY,ALPHAMERIC          00018068
BNGCRMOT BALR  BASEREG,0                                                00018168
         USING *,BASEREG                                                00018268
         B     B5                                                       00018368
         DC    C'DEMF REMOTE SRL TEXT MODULE OS V1.0'                   00018468
B5       L     TCTTEAR,TCAFCAAA                                         00018568
         L     TIOABAR,TCTTEDA                                          00018768
         MVI   INDEXSW,X'00'                SET INDEXSW = OFF           00068768
         LA    INREG,TIOADBA                LOCATE INPUT DATA.          00118768
         CLI   0(INREG),SBA                                             00168768
         BNE   B12                                                      00218768
         LA    INREG,3(INREG)                                           00268768
B12      CLC   15(3,INREG),=C'SS='          IS THIS A RQUEST FOR TEXT?  01153068
         BE    D1                           YES. GO LOCATE IT.          01160068
         MVI   INDEXSW,X'FF'                SET INDEXSW = ON            01164068
B14      EQU   *                            NO. BUILD AN INDEX PAGE.    01174068
         LA    LTHREG,IXHDRLTH+3+(44*(SSLTH+4))+(11*SBALTH)             01181068
         BAL   LINKREG,GETTIOA              FREE INAREA & GET OUTAREA.  01188068
         MVC   0(IXHDRLTH,OUTREG),IXHDR     MOVE INDEX HEADER LINE.     01203068
         LA    OUTREG,IXHDRLTH(OUTREG)                                  01211068
         LA    MSGREG,MSG1                  SETUP TO LOCATE ALL         01227068
         L     LIMITREG,=A(LASTMSG)         'SS=????' FIELDS.           01235068
         ZAP   SBACTR,=P'4'                 SETUP FOR 4 PER LINE.       01241068
B22      CLC   0(3,MSGREG),=X'60E2E2'          IS THIS A SENSE/STATUS?  01253068
         BE    C8                           YES. ADD IT TO OUTAREA.     01260068
B24      LA    MSGREG,1(MSGREG)             NO. CONTINUE LOOKING.       01270068
         CR    MSGREG,LIMITREG              ALL DONE?                   01280068
         BL    B22                          NO.                         01290468
         CLI   TCTTETM,C'2'                 IS THIS FOR MOD2 SCREEN?    01290768
         BNE   C3                           NO.                         01291068
         LA    SBAREG,SBA192C               LOAD LAST SBA ATTR ADDR     01291368
         MVC   0(5,OUTREG),0(SBAREG)        MOVE LAST PROTECTED ATTR    01291668
         LA    OUTREG,5(OUTREG)             BUMP 5 BYTES                01291968
C3       CLI   INDEXSW,X'FF'                IS INDEXSW ON ?             01292268
         BNE   C6                           NO.                         01292568
         CLI   TCTTETM,X'F1'                IS THIS A 3277-1 ?          01292868
         BE    C5                           YES.                        01293168
         MVC   0(HITMSGLL,OUTREG),HITMSGL   MOVE 'HIT CLEAR KEY' MSG    01293468
         LA    OUTREG,HITMSGLL(OUTREG)      BUMP OUTPUT POINTER         01293768
         B     C6                                                       01294068
C5       MVC   0(HITMSGSL,OUTREG),HITMSGS   MOVE 'HIT CLEAR KEY' MSG    01294368
         LA    OUTREG,HITMSGSL(OUTREG)      BUMP OUTPUT POINTER         01294668
C6       LA    1,TIOADBA                    YES.                        01294968
         SR    OUTREG,1                     COMPUTE FINAL               01295268
         STH   OUTREG,TIOATDL               DATA LENGTH.                01295568
         DFHTC TYPE=(WRITE,ERASE)                                       01295868
         DFHPC TYPE=RETURN                                              01296168
*********************************************************************** 01296468
*                                                                     * 01296768
*        RETURN                                                       * 01297068
*                                                                     * 01297368
*********************************************************************** 01297668
C8       CP    SBACTR,=P'4'                 BEGINNING A NEW LINE?       01300068
         BNE   C14                          NO.                         01366068
         CLI   TCTTETM,C'2'                 IS THIS FOR MOD2 DISPLAY?   01366368
         BE    C12                          YES.                        01366668
C11      MVC   0(3,OUTREG),0(SBAREG) XXXX   NO. (MOD1) MOVE NEXT        01366968
         LA    SBAREG,3(SBAREG) XXXX        SBA SEQUENCE                01367268
         LA    OUTREG,3(OUTREG) XXXX        TO OUTPUT AREA.             01367568
         B     C13                                                      01367868
C12      MVC   0(8,OUTREG),0(SBAREG) XXXX   YES. MOVE NEXT              01368168
         LA    SBAREG,8(SBAREG) XXXX        SBA SEQUENCE                01368468
         LA    OUTREG,8(OUTREG) XXXX        TO OUTPUT AREA.             01368768
C13      ZAP   SBACTR,=P'0'                                             01369068
C14      MVC   0(SSLTH,OUTREG),SSMSG        MOVE THIS ITEM              01370068
         MVC   SSLTH(4,OUTREG),4(MSGREG)    TO OUTPUT AREA.             01423068
         LA    OUTREG,(SSLTH+4)(OUTREG)                                 01433068
         AP    SBACTR,=P'1'                 ADD 1 TO ITEMS THIS LINE.   01439068
         B     B24                                                      01453068
D1       L     LIMITREG,=A(LASTMSG)         POINT TO LAST MSG.          01461068
         LA    MSGREG,MSG1                  POINT TO 1ST MSG.           01477068
         LR    NEXTREG,MSGREG                                           01485068
D3       MVC   HALFWORD,0(MSGREG)                                       01491068
         AH    NEXTREG,HALFWORD             POINT TO NEXT MSG.          01503068
         ST    MSGREG,SAVEREG                                           01511068
D4       CLC   0(7,MSGREG),15(INREG)        IS THIS THE DESIRED MSG?    01527068
         BE    D12                          YES, MOVE IT TO OUTAREA.    01535068
         LA    MSGREG,1(MSGREG)             NO. STILL IN THIS MSG?      01541068
         CR    MSGREG,NEXTREG                                           01553068
         BL    D4                           YES. KEEP LOOKING.          01561068
         CR    MSGREG,LIMITREG              ALL MSGS LOOKED AT?         01577068
         BL    D3                           NO. RESET ON NEXT MSG.      01585068
         B     B14                          YES. BAD INPUT; SHOW INDEX. 01591068
D12      L     MSGREG,SAVEREG               RESTORE START OF THIS MSG.  01603068
         LA    LTHREG,PGHDRLTH+(12*SBALTH)                              01610068
         MVC   HALFWORD,0(MSGREG)                                       01624068
         AH    LTHREG,HALFWORD              COMPUTE LTH THIS MSG & HDR. 01631068
         MVI   TEXTSW,X'FF'                 SET GETTIOA SUBR SWT        01634068
         BAL   LINKREG,GETTIOA              FREE INAREA & GET OUTAREA.  01641068
         MVC   0(PGHDRLTH,OUTREG),PGHDR     MOVE PAGE HDR LINE.         01653068
         LA    OUTREG,PGHDRLTH(OUTREG)                                  01661068
         MVC   HALFWORD,0(MSGREG)                                       01677068
         LH    1,HALFWORD                   GET TRUE LENGTH             01685068
         SH    1,=H'2'                      OF THIS MSG.                01691068
D20      CH    1,=H'40'                     ONE MORE FULL LINE TO DO?   01703068
         BH    E2                           YES. MOVE IT.               01711068
         MVC   0(3,OUTREG),0(SBAREG)        NO. MOVE THE                01727068
         EX    1,MOVE                       REMAINDER AND               01735068
         AR    OUTREG,1                     GET OUT.                    01741068
         LA    OUTREG,3(OUTREG)                                         01753068
         B     C3                                                       01761068
E2       MVC   0(3,OUTREG),0(SBAREG)        MOVE NEXT SBA SEQUENCE.     01777068
         LA    SBAREG,3(SBAREG)                                         01785068
         CLI   2(MSGREG),SF       IF THIS IS A LINE                     01791068
         BNE   E5                 CONTAINING ATTRIBUTES,                01803068
         MVC   3(2,OUTREG),2(MSGREG)   MOVE                             01811068
         LA    OUTREG,2(OUTREG)        TWO EXTRA                        01827068
         LA    MSGREG,2(MSGREG)        BYTES.                           01835068
         SH    1,=H'2'                                                  01841068
E5       MVC   3(40,OUTREG),2(MSGREG)       MOVE 40 CHARS OF TEXT.      01853068
         LA    OUTREG,43(OUTREG)                                        01860068
         LA    MSGREG,40(MSGREG)                                        01870068
         SH    1,=H'40'                     DECREMENT RESIDUAL COUNT.   01880068
         B     D20                                                      01890268
*********************************************************************** 01890668
*                                                                     * 01891068
*        NEXT SEQUENCE OF INST CLEARS OUTPUT TIOA TO BLANKS           * 01891468
*                                                                     * 01891868
*********************************************************************** 01892268
GETTIOA  ST    TIOABAR,TCASCSA              FREE ORIGINAL               01892668
         DFHSC TYPE=FREEMAIN                INPUT AREA.                 01893068
         STH   LTHREG,TCASCNB                                           01893468
         DFHSC TYPE=GETMAIN,CLASS=TERM      GET NEW TIOA JUST           01893868
         L     TIOABAR,TCASCSA              THE RIGHT SIZE.             01894268
         ST    TIOABAR,TCTTEDA                                          01894668
         LA    SBAREG,SBA1920                                           01895068
         CLI   TCTTETM,C'2'                 SETUP ON LIST OF 12         01895468
         BE    G11                          SBA SEQUENCES FOR           01895868
G10      LA    SBAREG,SBA480 XXXX           APPROPRIATE TERM MODEL.     01896268
G1A      MVC   TIOADBA(3),0(SBAREG) XXXX                                01896668
         LA    SBAREG,3(SBAREG) XXXX        PRIME OUTAREA FOR LINE 1    01897068
         LA    OUTREG,TIOADBA+3 XXXX        AND SETUP OUTREG FOR        01897468
         BR    LINKREG                                                  01897868
G11      CLI   TEXTSW,X'FF'                 IS TEXTSW ON?               01898268
         BNE   G12                          NOT ON.                     01898668
         LA    SBAREG,SBATXT2               SET SBAREG = SBATXT2 PTR    01899068
         B     G1A                                                      01899468
G12      LA    SBAREG,SBA192A                                           01899868
         MVC   TIOADBA(5),0(SBAREG) XXXX                                01900268
         MVC   TIOADBA+5(5),5(SBAREG) XXXX                              01900668
         MVC   TIOADBA+10(3),10(SBAREG) XXXX                            01901068
         LA    SBAREG,13(SBAREG) XXXX       PRIME OUTAREA FOR LINE 1    01901468
         LA    OUTREG,TIOADBA+13 XXXX       AND SETUP OUTREG FOR        01901868
         BR    LINKREG                      REMAINING DATA.             01902268
SBALTH   EQU   3                                                        01903068
SBA192A  DC    X'1140401D6C'       AL1(SBA),AL2(L1P1),AL1(SF,PIA)       01923068
SBA1920  DC    X'11C7601D6C11C7F411C8F01D6C11C9C4114A401D6C114AD4'      01943068
         DC    X'114B501D6C114BE4114C601D6C114CF4114DF01D6C114EC4'      01963068
         DC    X'114F401D6C114FD41150501D6C1150E411D1601D6C11D1F4'      01983068
         DC    X'11D2F01D6C11D3C411D4401D6C11D4D411D5501D6C11D5E4'      02003068
SBA192C  DC    X'11D2C81D6C'       AL1(SBA),AL2(L15P41),AL1(SF,PIA)     02023068
SBA480   DC    X'1140401140E811C15011C1F811C26011C3C8'                  02103068
         DC    X'11C3F011C4D811C54011C5E811C65011C6F8'                  02113068
SBATXT2  DC    X'11C7F411C9C4114AD4'                                    02114068
         DC    X'114BE4114CF4114EC4'                                    02115068
         DC    X'114FD41150E411D1F4'                                    02116068
         DC    X'11D3C411D4D411D5E4'                                    02117068
SSMSG    DC    AL1(SF,UNA),C'?SS='                                      02123068
SSLTH    EQU   *-SSMSG                                                  02133068
IXHDR    DC    AL1(IC,SF,MNA),C'DEMF REMOTE'                            02143068
         DC    AL1(SF,PNA),C'STATUS INDEX,X OVER ?,ENTER'               02153068
IXHDRLTH EQU   *-IXHDR                                                  02162068
PGHDR    DC    AL1(IC,SF,MNA),C'DEMF REMOTE'                            02171068
         DC    AL1(SF,PNA),C'HIT ENTER TO REFRESH INDEX'                02180068
PGHDRLTH EQU   *-PGHDR                                                  02190068
HITMSGS  DC    AL1(SBA),AL2(SML12P1),AL1(SF,PNA)                        02191068
         DC    C'HIT CLEAR KEY TO EXIT DEMF'                            02192068
HITMSGSL EQU   *-HITMSGS                                                02193068
HITMSGL  DC    AL1(SBA),AL2(L18P21),AL1(SF,PNA)                         02194068
         DC    C'HIT CLEAR KEY TO EXIT DEMF'                            02195068
HITMSGLL EQU   *-HITMSGL                                                02196068
INDEXSW  DC    X'00'           INDEX SWITCH 00=OFF  FF=ON               02197068
MOVE     MVC   3(1,OUTREG),2(MSGREG)                                    02203068
         LTORG                                                          02210068
MSG1     DC    AL2(MSG2-*)                                              02210168
         DC    C'                                        '              02210268
         DC    AL1(SF,PNA),C'SS=404C',AL1(SF,PNA),C'  '                 02210368
         DC    CL29'EQUIPMENT CHECK,DATA CHECK'                         02210468
         DC    C'THE 3271 DETECTED BAD PARITY ON DATA    '              02210568
         DC    C'RECEIVED FROM THE ADDRESSED DEVICE ON   '              02210668
         DC    C'A SPECIFIC OR GENERAL POLL OR A SELECT  '              02210768
         DC    C'COMMAND.                                '              02210868
         DC    C'                                        '              02210968
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT        '              02211068
         DC    C'                 EOT-TO SPEC OR GEN POLL'              02211168
MSG2     DC    AL2(MSG3-*)                                              02211268
         DC    AL1(SF,PNA),C'SS=4050',AL1(SF,PNA),C'  '                 02211368
         DC    CL29'INTERVENTION REQUIRED'                              02211468
         DC    C'                                        '              02211568
         DC    C'THE ADDRESSED DEVICE IS NOT AVAILABLE   '              02211668
         DC    C'OR ADDRESSED PRINTER IS NOT READY ON A  '              02211768
         DC    C'SELECT,READ,WRITE,ERASE/WRITE OR COPY-  '              02211868
         DC    C'COMMAND.                                '              02211968
         DC    C'                                        '              02212068
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT.       '              02212168
         DC    C'                 EOT-TO A READ,WRITE,-  '              02212268
         DC    C'                     ERASE/WRITE OR COPY'              02212368
         DC    C'                     COMMAND.'                         02212468
MSG3     DC    AL2(MSG4-*)                                              02212568
         DC    C'                                        '              02212668
         DC    AL1(SF,PNA),C'SS=4060',AL1(SF,PNA),C'  '                 02212768
         DC    CL29'COMMAND REJECT'                                     02212868
         DC    C'AN INVALID OR ILLEGAL COMMAND WAS       '              02212968
         DC    C'RECEIVED BY THE 3271 OR 3275.           '              02213068
         DC    C'                                        '              02213168
         DC    C'DEVICE RESPONSE= EOT-TO A READ OR WRITE '              02213268
         DC    C'                     COMMAND.'                         02213368
MSG4     DC    AL2(MSG5-*)                                              02213468
         DC    AL1(SF,PNA),C'SS=40C1',AL1(SF,PNA),C'  '                 02213568
         DC    CL29'OPERATION CHECK'                                    02213668
         DC    C'AN INVALID COMMAND SEQUENCE,(NON RECOVER'              02213768
         DC    C'ABLE PROGRAM ERROR)                     '              02213868
         DC    C'(1)ESCAPE COMMAND SEQUENCE NOT IN SECOND'              02213968
         DC    C'DATA CHARACTER POSITION (HEX 27)        '              02214068
         DC    C'(2)DATA FOLLOWS THE COMMAND IN THE DATA-'              02214168
         DC    C'STREAM RECEIVED BY THE DEVICE.          '              02214268
         DC    C'(3)DATA-STREAM CONTAINS OTHER THAN TWO  '              02214368
         DC    C'BYTES,(COPY CONTROL CHARACTER AND FROM  '              02214468
         DC    C'ADDRESS) COMMAND IS ABORTED.            '              02214568
         DC    C'DEVICE RESPONSE= EOT-TO READ,WRT OR EAU.'              02214668
MSG5     DC    AL2(MSG6-*)                                              02214768
         DC    AL1(SF,PNA),C'SS=40C2',AL1(SF,PNA),C'  '                 02214868
         DC    CL29'CONTROL CHECK'                                      02214968
         DC    C'                                        '              02215068
         DC    C'THE DEVICE FAILS TO RESPOND TO THE 3271 '              02215168
         DC    C'IN TIME AND CAUSES A TIMEOUT OR THE POLL'              02215268
         DC    C'FINDS A DEVICE THAT WAS PREVIOUSLY      '              02215368
         DC    C'AVAILABLE AND READY,NOW UNAVAILABLE AND '              02215468
         DC    C'TIMES OUT.                              '              02215568
         DC    C'                                        '              02215668
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT COMMAND'              02215768
         DC    C'                 EOT-TO A WRITE,SPECIFIC'              02215868
         DC    C'                     OR A GENERAL POLL.'               02215968
MSG6     DC    AL2(MSG7-*)                                              02216068
         DC    AL1(SF,PNA),C'SS=40C3',AL1(SF,PNA),C'  '                 02216168
         DC    CL29'CONTROL CHECK,OPERATION CHECK'                      02216268
         DC    C'                                        '              02216368
         DC    C'THE FROM DEVICE FAILS TO COMPLETE AN    '              02216468
         DC    C'OPERATION OR RESPOND TO THE 3271 IN A   '              02216568
         DC    C'PREDETERMINED TIME PERIOD AND TIMES OUT.'              02216668
         DC    C'                                        '              02216768
         DC    C'DEVICE RESPONSE= EOT TO A COPY COMMAND.'               02216868
MSG7     DC    AL2(MSG8-*)                                              02216968
         DC    AL1(SF,PNA),C'SS=40C4',AL1(SF,PNA),C'  '                 02217068
         DC    CL29'DATA CHECK'                                         02217168
         DC    C'(1)CURSOR CHECK IS DETECTED AT THE 3271 '              02217268
         DC    C'OR BAD PARITY ON DATA FROM THE ADDRESSED'              02217368
         DC    C'DEVICE,(NO DATA SENT TO TCU)(2) A PARITY'              02217468
         DC    C'CHECK DETECTED BY 3271,A SUB CHARACTER  '              02217568
         DC    C'IS SUBSTITUTED FOR THE ERROR CHARACTER  '              02217668
         DC    C'DURING TRANSMISSION TO TCU,WHEN COMPLETE'              02217768
         DC    C'THE 3271 SENDS ENQ TO INDICATE AN ERROR.'              02217868
         DC    C'THE TCU RESPONDS NAK,THE 3271 ANSWERS   '              02217968
         DC    C'EOT.ABOVE IS IN RESPONSE TO A READ,WRITE'              02218068
         DC    C'COMMAND OR A SPECIFIC OR GENERAL POLL.'                02218168
MSG8     DC    AL2(MSG9-*)                                              02218268
         DC    AL1(SF,PNA),C'SS=40C5',AL1(SF,PNA),C'  '                 02218368
         DC    CL29'DATA CHECK,OPERATION CHECK'                         02218468
         DC    C'                                        '              02218568
         DC    C'THE 3271 DETECTS A PARITY CHECK ON THE  '              02218668
         DC    C'DATA TRANSFERRED FROM THE FROM DEVICE.  '              02218768
         DC    C'                                        '              02218868
         DC    C'DEVICE RESPONSE= EOT-TO THE COPY COMMAND'              02218968
MSG9     DC    AL2(MSG10-*)                                             02219068
         DC    AL1(SF,PNA),C'SS=40C8',AL1(SF,PNA),C'  '                 02219168
         DC    CL29'EQUIPMENT CHECK'                                    02219268
         DC    C'                                        '              02219368
         DC    C'THE 3271 DETECTED A PARITY CHECK ON DATA'              02219468
         DC    C'RECEIVED FROM THE DEVICE.               '              02219568
         DC    C'(EQUIPMENT CHECK MAY ALSO BE COMBINED   '              02219668
         DC    C'WITH DATA CHECK,REF 40C4)               '              02219768
         DC    C'                                        '              02219868
         DC    C'DEVICE RESPONSE= EOT-TO A SELECT,READ,  '              02219968
         DC    C'                     WRITE,SPECIFIC OR  '              02220068
         DC    C'                     GENERAL POLL.'                    02220168
MSG10    DC    AL2(MSG11-*)                                             02220268
         DC    AL1(SF,PNA),C'SS=40D1',AL1(SF,PNA),C'  '                 02220368
         DC    CL29'INTERVENTION REQUIRED'                              02220468
         DC    C'                   OPERATION CHECK      '              02220568
         DC    C'                                        '              02220668
         DC    C'THE DEVICE IS UNAVAILABLE.              '              02220768
         DC    C'                                        '              02220868
         DC    C'DEVICE RESPONSE= EOT-TO A COPY COMMAND.'               02220968
MSG11    DC    AL2(MSG12-*)                                             02221068
         DC    AL1(SF,PNA),C'SS=4A40',AL1(SF,PNA),C'  '                 02221168
         DC    CL29'DEVICE BUSY,DEVICE END'                             02221268
         DC    C'                                        '              02221368
         DC    C'DEVICE BUSY AND DEVICE END CAN OCCUR    '              02221468
         DC    C'TOGETHER IN RESPONSE TO A SPECIFIC POLL '              02221568
         DC    C'TO A FORMATTED 3277 IF THE OPERATOR HAS '              02221668
         DC    C'PERFORMED BACKTAB OR ERASE INPUT IN     '              02221768
         DC    C'RAPID SUCCESSION.                       '              02221868
         DC    C'IGNORE DEVICE END AND TREAT AS BUSY ONLY'              02221968
         DC    C'                                        '              02222068
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC POLL'               02222168
MSG12    DC    AL2(MSG13-*)                                             02222268
         DC    AL1(SF,PNA),C'SS=4C40',AL1(SF,PNA),C'  '                 02222368
         DC    CL29'DEVICE BUSY,UNIT SPECIFY'                           02222468
         DC    C'                                        '              02222568
         DC    C'ON A READ COMMAND,THE DEVICE WAS BUSY.  '              02222668
         DC    C'THE COMMAND WAS CHAINED TO A SPECIFIC   '              02222768
         DC    C'POLL,WRITE,ERASE/WRITE,OR COPY COMMAND  '              02222868
         DC    C'WHICH STARTED A PRINTER.                '              02222968
         DC    C'ON A COPY COMMAND, THE ADDRESSED "TO"   '              02223068
         DC    C'DEVICE WAS BUSY.                        '              02223168
         DC    C'                                        '              02223268
         DC    C'DEVICE RESPONSE= EOT-TO A READ,WRITE,OR '              02223368
         DC    C'                     A COPY COMMAND.'                  02223468
MSG13    DC    AL2(MSG14-*)                                             02223568
         DC    AL1(SF,PNA),C'SS=4CC1',AL1(SF,PNA),C'  '                 02223668
         DC    CL29'DEVICE BUSY,UNIT SPECIFY'                           02223768
         DC    C'                OPERATION CHECK         '              02223868
         DC    C'THE DB,US AND OP CHECK STATUS AND SENSE '              02223968
         DC    C'WILL BE COMBINED IF A COPY COMMAND IS   '              02224068
         DC    C'ADDRESSED TO A BUSY "TO" DEVICE AND THE '              02224168
         DC    C'COMMAND ALSO SPECIFIES THE "FROM" DEVICE'              02224268
         DC    C'THE SAME AS THE "TO" DEVICE.            '              02224368
         DC    C'                                        '              02224468
         DC    C'DEVICE RESPONSE= EOT-TO A COPY COMMAND.'               02224568
MSG14    DC    AL2(MSG15-*)                                             02224668
         DC    AL1(SF,PNA),C'SS=4E40',AL1(SF,PNA),C'  '                 02224768
         DC    CL29'DEVICE BUSY,UNIT SPECIFY'                           02224868
         DC    C'                  DEVICE END            '              02224968
         DC    C'                                        '              02225068
         DC    C'THE ADDRESSED DEVICE BECOMES NOT BUSY   '              02225168
         DC    C'BEFORE A SPECIFIC POLL IS ISSUED TO     '              02225268
         DC    C'RETRIEVE THE STATUS AND SENSE DATA.     '              02225368
         DC    C'                                        '              02225468
         DC    C'DEVICE RESPONSE= EOT-TO A READ OR WRITE '              02225568
         DC    C'                     COMMAND.'                         02225668
MSG15    DC    AL2(MSG16-*)                                             02225768
         DC    AL1(SF,PNA),C'SS=C140',AL1(SF,PNA),C'  '                 02225868
         DC    CL29'TRANSMISSION CHECK'                                 02225968
         DC    C'                                        '              02226068
         DC    C'3275 DETECTED A BCC ERROR ON THE TCU    '              02226168
         DC    C'TRANSMISSION.                           '              02226268
         DC    C'(TRANSMISSION CHECK NOT USED BY 3271)   '              02226368
         DC    C'                                        '              02226468
         DC    C'DEVICE RESPONSE= EOT-TO A READ OR WRITE '              02226568
         DC    C'                     COMMAND.'                         02226668
MSG16    DC    AL2(MSG17-*)                                             02226768
         DC    AL1(SF,PNA),C'SS=C240',AL1(SF,PNA),C'  '                 02226868
         DC    CL29'DEVICE END'                                         02226968
         DC    C'THE POLL FINDS A DEVICE (1) PREVIOUSLY- '              02227068
         DC    C'BUSY,NOW NOT BUSY OR,(2) PREVIOUSLY-    '              02227168
         DC    C'UNAVAILABLE OR NOT READY, NOW AVAILABLE '              02227268
         DC    C'AND READY. (THE 3271 RECORD IS UPDATED) '              02227368
         DC    C'NOTE: WHEN 3271 POWER IS TURNED ON, THE '              02227468
         DC    C'"DEVICE END" IS SET FOR EACH AVAILABLE  '              02227568
         DC    C'AND READY DEVICE THAT IS ATTACHED.      '              02227668
         DC    C'                                        '              02227768
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR   '              02227868
         DC    C'                     GENERAL POLL.'                    02227968
MSG17    DC    AL2(MSG18-*)                                             02228068
         DC    AL1(SF,PNA),C'SS=C250',AL1(SF,PNA),C'  '                 02228168
         DC    CL29'DEVICE END'                                         02228268
         DC    C'                   INTERVENTION REQUIRED'              02228368
         DC    C'(1)UPON SELECTION THE ADDRESSED PRINTER '              02228468
         DC    C'IS OUT OF PAPER, ITS POWER HAS BEEN TURN'              02228568
         DC    C'ED OFF, OR ITS COVER IS OPEN.           '              02228668
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT COMMAND'              02228768
         DC    C'                                        '              02228868
         DC    C'(2) THE POLL FINDS THE PRINTER NOT READY'              02228968
         DC    C'OR NOT AVAILABLE.                       '              02229068
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR   '              02229168
         DC    C'                     GENERAL POLL.'                    02229268
MSG18    DC    AL2(MSG19-*)                                             02229368
         DC    AL1(SF,PNA),C'SS=C2C4',AL1(SF,PNA),C'  '                 02229468
         DC    CL29'DEVICE END,DATA CHECK'                              02229568
         DC    C'                                        '              02229668
         DC    C'3275 (ONLY) DETECTS AN INTERNAL PARITY  '              02229768
         DC    C'OR CURSOR CHECK ON ITS BUFFER WHEN THE  '              02229868
         DC    C'ATTACHED PRINTER GOES "NOT BUSY".       '              02229968
         DC    C'                                        '              02230068
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR   '              02230168
         DC    C'                     GENERAL POLL.'                    02230268
MSG19    DC    AL2(MSG20-*)                                             02230368
         DC    AL1(SF,PNA),C'SS=C2C8',AL1(SF,PNA),C'  '                 02230468
         DC    CL29'DEVICE END,EQUIPMENT CHECK'                         02230568
         DC    C'                                        '              02230668
         DC    C'THE 3275 (ONLY) DETECTED A CHARACTER    '              02230768
         DC    C'GENERATOR READOUT ERROR.                '              02230868
         DC    C'                                        '              02230968
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR   '              02231068
         DC    C'                     GENERAL POLL.'                    02231168
MSG20    DC    AL2(MSG21-*)                                             02231268
         DC    AL1(SF,PNA),C'SS=C2D8',AL1(SF,PNA),C'  '                 02231368
         DC    CL29'DEV END,INTERVENTION REQUIRED'                      02231468
         DC    C'                         EQUIPMENT CHECK'              02231568
         DC    C'                                        '              02231668
         DC    C'(3275 ONLY) THE ATTACHED PRINTER, "AC-  '              02231768
         DC    C'POWER" IS TURNED OFF,OR A MECHANICAL    '              02231868
         DC    C'"HANG" CONDITION WAS DETECTED           '              02231968
         DC    C'                                        '              02232068
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR   '              02232168
         DC    C'                     GENERAL POLL.      '              02232268
MSG21    DC    AL2(MSG22-*)                                             02232368
         DC    AL1(SF,PNA),C'SS=C4C1',AL1(SF,PNA),C'  '                 02232468
         DC    CL29'UNIT SPECIFY,OPERATION CHECK'                       02232568
         DC    C'                                        '              02232668
         DC    C'THE "FROM DEVICE" HAS A "LOCKED BUFFER" '              02232768
         DC    C'AND CANNOT BE COPIED. (PROGRAM ERROR)   '              02232868
         DC    C'                                        '              02232968
         DC    C'DEVICE RESPONSE= EOT-TO THE COPY COMMAND'              02233068
MSG22    DC    AL2(MSG23-*)                                             02233168
         DC    AL1(SF,PNA),C'SS=C4C4',AL1(SF,PNA),C'  '                 02233268
         DC    CL29'UNIT SPECIFY,DATA CHECK'                            02233368
         DC    C'DURING POLLING,SELECT OR READ COMMANDS  '              02233468
         DC    C'THE ADDRESSED DEVICE DETECTS A "CURSOR" '              02233568
         DC    C'OR "PARITY" CHECK ON DATA THAT IS BEING '              02233668
         DC    C'TRANSFERRED TO THE CONTROL UNIT OR      '              02233768
         DC    C'DURING THE COMMAND OPERATION ON A WRITE '              02233868
         DC    C'COMMAND                                 '              02233968
         DC    C'                                        '              02234068
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT.       '              02234168
         DC    C'                 EOT-TO READ,WRITE OR   '              02234268
         DC    C'                     POLLING COMMANDS.'                02234368
MSG23    DC    AL2(MSG24-*)                                             02234468
         DC    AL1(SF,PNA),C'SS=C4C5',AL1(SF,PNA),C'  '                 02234568
         DC    CL29'UNIT SPECIFY,DATA CHECK'                            02234668
         DC    C'              OPERATION CHECK           '              02234768
         DC    C'                                        '              02234868
         DC    C'THE "FROM DEVICE" DETECTED AN INTERNAL  '              02234968
         DC    C'CURSOR OR PARITY CHECK DURING A COPY-   '              02235068
         DC    C'COMMAND.                                '              02235168
         DC    C'                                        '              02235268
         DC    C'DEVICE RESPONSE= EOT-TO THE COPY COMMAND'              02235368
MSG24    DC    AL2(MSG25-*)                                             02235468
         DC    AL1(SF,PNA),C'SS=C4D8',AL1(SF,PNA),C'  '                 02235568
         DC    CL29'UNIT SPECIFY,INTRVENTION RQRD'                      02235668
         DC    C'                         EQUIPMENT CHECK'              02235768
         DC    C'                                        '              02235868
         DC    C'A COMMAND ATTEMPTED TO START A PRINTER  '              02235968
         DC    C'OPERATION BUT THE PRINTER CARRIAGE MOTOR'              02236068
         DC    C'POWER SWITCH WAS TURNED OFF.            '              02236168
         DC    C'                                        '              02236268
         DC    C'DEVICE RESPONSE= EOT-TO A WRITE,ERASE/- '              02236368
         DC    C'                   WRITE OR COPY COMMAND'              02236468
MSG25    DC    AL2(MSG26-*)                                             02236568
         DC    AL1(SF,PNA),C'SS=C6C4',AL1(SF,PNA),C'  '                 02236668
         DC    CL29'UNIT SPECIFY,DEVICE END'                            02236768
         DC    C'                 DATA CHECK             '              02236868
         DC    C'                                        '              02236968
         DC    C'A PARITY CHECK IS DETECTED AT THE       '              02237068
         DC    C'PRINTER                                 '              02237168
         DC    C'                                        '              02237268
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT COMMAND'              02237368
         DC    C'                 EOT-TO A SPECIFIC OR   '              02237468
         DC    C'                     GENERAL POLL.'                    02237568
MSG26    DC    AL2(MSG27-*)                                             02237668
         DC    AL1(SF,PNA),C'SS=C6C8',AL1(SF,PNA),C'  '                 02237768
         DC    CL29'UNIT SPECIFY,DEVICE END'                            02237868
         DC    C'            EQUIPMENT CHECK             '              02237968
         DC    C'A CHARACTER GENERATOR ERROR IS DETECTED '              02238068
         DC    C'BUT THERE IS NO DATA ERROR,(BUFFER DATA-'              02238168
         DC    C'IS VALID AND REUSEABLE) OR A MECHANICAL '              02238268
         DC    C'FAILURE OCCURED.(COVER OPEN,PAPER OUTAGE'              02238368
         DC    C'OR DISABLED PRINT MECHANISM)            '              02238468
         DC    C'                                        '              02238568
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT.       '              02238668
         DC    C'                 EOT-TO A SPECIFIC OR A '              02238768
         DC    C'                     GENERAL POLL.'                    02238868
MSG27    DC    AL2(MSG28-*)                                             02238968
         DC    AL1(SF,PNA),C'SS=C6D8',AL1(SF,PNA),C'  '                 02239068
         DC    CL29'UNIT SPECIFY,DEVICE END'                            02239168
         DC    C'   INTERVENTION REQUIRED,EQUIPMENT CHECK'              02239268
         DC    C'                                        '              02239368
         DC    C'AN UNRECOVERABLE MECHANICAL FAILURE IS  '              02239468
         DC    C'DETECTED AT THE ADDRESSED PRINTER.      '              02239568
         DC    C'                                        '              02239668
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR A '              02239768
         DC    C'                     GENERAL POLL.      '              02239868
MSG28    DC    AL2(MSG29-*)                                             02239968
         DC    AL1(SF,PNA),C'SS=C840',AL1(SF,PNA),C'  '                 02240068
         DC    CL29'DEVICE BUSY'                                        02240168
         DC    C'                                        '              02240268
         DC    C'INDICATES NORMAL STATUS FOR A DEVICE    '              02240368
         DC    C'EXECUTING A PREVIOUSLY ISSUED COMMAND,- '              02240468
         DC    C'PRINTER OPERATION,BUFFER TRANSFER,ID-   '              02240568
         DC    C'CARD READER OPERATION OR KEYBOARD-      '              02240668
         DC    C'FUNCTIONS.                              '              02240768
         DC    C'                                        '              02240868
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT COMMAND'              02240968
         DC    C'                 EOT-TO A SPECIFIC POLL.'              02241068
MSG29    DC    AL2(MSG30-*)                                             02241168
         DC    AL1(SF,PNA),C'SS=C8C1',AL1(SF,PNA),C'  '                 02241268
         DC    CL29'DEVICE BUSY,OPERATION CHECK'                        02241368
         DC    C'                                        '              02241468
         DC    C'ON A COPY COMMAND,THE "FROM" DEVICE IS  '              02241568
         DC    C'BUSY EXECUTING A PRINTOUT,READING FROM  '              02241668
         DC    C'THE ID CARD READER OR PERFORMING KEY-   '              02241768
         DC    C'BOARD FUNCTIONS. THE COPY COMMAND IS    '              02241868
         DC    C'ABORTED.                                '              02241968
         DC    C'                                        '              02242068
         DC    C'DEVICE RESPONSE= EOT-TO THE COPY COMMAND'              02242168
MSG30    DC    AL2(LASTMSG-*)                                           02242268
         DC    AL1(SF,PNA),C'SS=HELP',AL1(SF,PNA),C'  '                 02242368
         DC    CL29'REMOTE STATUS MSG HELPER.'                          02242468
         DC    CL40'FIELDS "SS=XXXX" REFER TO REMOTE STATUS'            02242568
         DC    CL40'MESSAGES.  ALL COMBINATIONS ARE NOT'                02242668
         DC    CL40'DOCUMENTED.  IF YOU DON''T SEE THE ONE'             02242768
         DC    CL40'YOU NEED, SUCH AS "C2C2" DROP ONE OF THE'           02242868
         DC    CL40'INSIGNIFICANT BITS SUCH AS "DEVICE END".'           02242968
         DC    CL40'THIS WILL PRODUCE "40C2" (YOU NEED A'               02243068
         DC    CL40'6-BIT CODE CHART TO FIGURE THE HIGH-'               02243168
         DC    CL40'ORDER BITS).  NOW LOOK UP MSG FOR "40C2"'           02243268
         DC    CL40'TO SEE IF IT APPLIES TO YOUR SITUATION.'            02243368
LASTMSG  EQU   *                                                        02243468
         END   BNGCRMOT                                                 02243568
./  ADD  SSI=81730291,NAME=BNGC3270
         PRINT OFF                                                      00040007
         MACRO                                                          00040407
&NAME    BNGHJN &LABEL,&HJN                                             00040807
         LCLC  &HJA,&HJB                                                00041207
&HJA     SETC  '&SYSPARM'(1,4)                                          00041607
&HJB     SETC  '&SYSPARM'(5,4)                                          00042007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00042407
         B     &LABEL .                 BR AROUND CONSTANTS             00042807
         SPACE 2                                                        00043207
.NOBRNCH ANOP                                                           00043607
         AIF   ('&NAME' EQ '').NOLABEL                                  00044007
         DC    C'&NAME' .              MODULE IDENTIFIER                00044407
.NOLABEL ANOP                                                           00044807
         DC    X'&HJA' .                DATE OF MODIFICATION            00045207
         AIF   ('&HJN' NE 'HJN').DATE                                   00045607
         DC    X'&HJB' .                HJN OF MODIFICATION             00046007
.DATE    ANOP                                                           00046407
         AIF   ('&LABEL' EQ '').NOLBL                                   00046807
         SPACE 2                                                        00047207
&LABEL   DS    0H                                                       00047607
.NOLBL   ANOP                                                           00048007
         MEND                                                           00048407
         PRINT ON                                                       00048807
*********************************************************************** 00049207
*                                                                     * 00080068
* MODULE NAME = BNGC3270                                              * 00120068
*                                                                     * 00160068
* DESCRIPTIVE NAME = CICS DEMF 3270 DISPLAY MODULE                    * 00200068
*                                                                     * 00240068
* COPYRIGHT = NONE                                                    * 00280068
*                                                                     * 00320068
* STATUS = RELEASE 1, LEVEL 1                                         * 00360068
*                                                                     * 00400007
* FUNCTION = 1) RECEIVES CONTROL FROM BNGCDISP;                       * 00440068
*            2) HANDLES 3270 DISPLAY TERMINAL ERROR INFORMATION       * 00480068
*               REQUEST AND BITS PROMPTER REQUEST;                    * 00520068
*            3) ACCESSES SYS1.DEMFLOG DATA FILE AND COLLECTS THE      * 00560068
*               REQUESTED 3270 ERROR INFORMATION FROM IT;             * 00600068
*            4) FORMS OUTPUT MESSAGE WITH DISPLAY FORMAT AND WRITES   * 00640068
*               IT TO THE 3270 DISPLAY TERMINAL; (ERR INFO AND SOME   * 00680068
*               OF DISPLAY MESSAGES)                                  * 00720068
*            5) RETURNS CONTROL TO CICS.                                00760068
*                                                                     * 00800068
* NOTES = NONE                                                        * 00840068
*                                                                     * 00880068
*    DEPENDENCIES =                                                   * 00920068
*                                                                     * 00960068
*    THE FOLLOWING ARE CICS TABLES/CONTROL BLOCKS AND THEIR LABELS    * 01000068
*    USED BY DEMF CICS MODULES (BNGCDISP,BNGC3270,BNGCLOCL,BNGCRMOT   * 01040068
*    BNGCMENU) :                                                      * 01080068
*                                                                     * 01120068
*    CICS TABLE AND                                                   * 01160068
*    CONTROL BLOCKS                  LABELS USED                      * 01200068
*    ----------------------          -----------                      * 01240068
*                                                                     * 01280068
*    COMMON SYSTEM AREA              CSATCTBA                         * 01320068
*    (CSA)                                                            * 01360068
*                                                                     * 01400068
*    TERMINAL CONTROL TABLE          TCTTEDA                          * 01440068
*    TERMINAL ENTRY (TCTTE)          TCTTETM                          * 01480068
*                                    TCTTELT                          * 01520068
*                                    TCTTETI                          * 01560068
*                                    TCTTECLT                         * 01600068
*                                    TCTTETEL                         * 01640068
*                                    TCTTETT                          * 01680068
*                                    TCTTEGU                          * 01720068
*                                    TCTTETA                          * 01760068
*                                                                     * 01800068
*    TERMINAL CONTROL TABLE          TCTLELF                          * 01840068
*    LINE ENTRY (TCTLE)              TCTLEFAA                         * 01880068
*                                    TCTLEPI                          * 01920068
*                                    TCTLEMFP                         * 01960068
*                                    TCTLEPA                          * 02000068
*                                    TCTLEDCB                         * 02040068
*                                    TCTLERLN                         * 02080068
*                                                                     * 02120068
*    TERMINAL INPUT/OUTPUT AREA      TIOADBA                          * 02160068
*    (TIOA)                          TIOATDL                          * 02200068
*                                                                     * 02240068
*    TASK CONTROL AREA               TCAFCAAA                         * 02280068
*    (TCA)                           TCAFCAA                          * 02320068
*                                    TCAPCPI                          * 02360068
*                                    TCASCSA                          * 02400068
*                                                                     * 02440068
*    FILE INPUT/OUTPUT AREA          FIOADBA                          * 02480068
*    (FIOA)                                                           * 02520068
*                                                                     * 02560068
*    RESTRICTIONS = NONE                                              * 02600068
*                                                                     * 02640068
*    REGISTER CONVENTIONS = R12 ADDRESS OF TCA                        * 02680068
*                           R13 ADDRESS OF CSA                        * 02720068
*                                                                     * 02760068
*    PATCH LABEL = PATCH                                       @OX21950 02800007
*                                                                     * 02840068
* MODULE TYPE = COCS DISPLAY                                          * 02880068
*                                                                     * 02920068
*    PROCESSOR = ASSEMBLER H                                          * 02960068
*                                                                     * 03000068
*    MODULE SIZE = 6976 DECIMAL BYTES                                 * 03040068
*                                                                     * 03080068
*    ATTRIBUTES = QUASI-REENTRANT                                     * 03120068
*                                                                     * 03160068
* ENTRY POINT = BNGC3270                                              * 03200068
*                                                                     * 03240068
*    PURPOSE = SEE FUNCTION                                           * 03280068
*                                                                     * 03320068
*    LINKAGE = R1  LOADED WITH THE PARAM LIST POINTER                 * 03360068
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 03400068
*              R15 LOADED WITH ENTRY POINT                            * 03440068
*                                                                     * 03480068
* INPUT = PARAM LIST ITEMS USED ARE : INPUT TIOA AT BEGINNING OF PGM  * 03520068
*                                                                     * 03560068
* OUTPUT = PARAM LIST ITEMS USED ARE : OUTPUT TIOA AT LABEL - GETTIOA * 03600068
*                                                                     * 03640068
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 03680068
*               00 - OPERATION PERFORMED AS REQUESTED                 * 03720068
*                                                                     * 03760068
* EXIT-ERROR  = NONE                                                  * 03800068
*                                                                     * 03840068
* EXTERNAL REFERENCE = NONE                                           * 03880068
*                                                                     * 03920068
*    ROUTINES = LOCATE ROUTINE                                        * 03960068
*               GETTIOA ROUTINE (GET TERMINAL OUTPUT AREA)            * 04000068
*               BUOBR ROUTINE (BLOW-UP OBR ROUTINE)                   * 04040068
*               BUMDR ROUTINE (BLOW-UP MDR ROUTINE)                   * 04080068
*                                                                     * 04120068
*    DATA AREAS =  TWA (300 BYTES)                                    * 04160068
*                                                                     * 04200068
*    CONTROL BLOCK = DFHCSADS, DFHTCTLE, DFHTCTTE, DFHTCADS,          * 04240068
*                    DFHTIOA, DFHFIOA                                 * 04280068
*                                                                     * 04320068
* TABLES = CALENDAR - CONVERT JULIAN DATE TO GREGORIAN DATE TABLE     * 04360068
*          LEAPTBL  - LEAP YEAR CALCULATION TABLE                     * 04400068
*          CCWTABL  - CONVERT 270X COMMAND CODE INTO ENGLISH          * 04440068
*          CSWTABL  - CONVERT LOCAL 327X STATUS OR 270X LINE STATUS   * 04480068
*                     INTO ENGLISH                                    * 04520068
*          SENSTABL - CONVERT 270X LINE SENSE CODE INTO ENGLISH       * 04560068
*          STATSTBL - CONVERT REMOTE 327X STATUS CODE INTO ENGLISH    * 04600068
*          SENS3272 - CONVERT LOCAL 327X SENSE CODE INTO ENGLISH      * 04640068
*          CCW3272  - CONVERT LOCAL 327X COMMAND CODE INTO ENGLISH    * 04680068
*          TPOPTBL  - CONVERT BTAM TP OP CODE INTO ENGLISH            * 04720068
*          CICSPTOP - CONVERT TCAM TP OP CODE INTO ENGLISH            * 04760068
*          HXTOEB   - HEX CHARS TO EBCDIC CHARS TABLE                 * 04800068
*          EBTOHX   - EBCDIC CHARS TO HEX CHARS TABLE                 * 04840068
*                                                                     * 04880068
* MACROS = DCBD, DFHPC, DFHSC, DFHTC, DFHPC                           * 04920068
*                                                                     * 04960068
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 05000068
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 05000107
* CHANGE 02  02/27/78  BNGHJN MACRO ADDED                             * 05000207
*A110800,246000                                                @OZ30480 05000307
*A192000,374800,414000                                         @OZ31885 05000407
*C384000-384800                                                @OX21950 05000507
*A472800                                                       @OX21950 05000607
*                                                                     * 05080068
*********************************************************************** 05120068
BNGC3270 TITLE 'DISPLAY 3270 MDR AND OBR ENTRIES'                       05160068
R1       EQU   1                                                        05200068
BASE1    EQU   2                   1ST PROGRAM BASE REG.                05240068
BASE2    EQU   3                   2ND PROGRAM BASE REG.                05280068
TCTTEAR  EQU   4                   TCT TERML ENTRY REG.                 05320068
TIOABAR  EQU   5                   TIOA POINTER.                        05360068
FIOABAR  EQU   6                   FIOA POINTER.                        05400068
DATAREG  EQU   7                   POINTER TO DATA IN EMF FILE BLOCK.   05440068
DATALOOP EQU   8                   LOOP REG FOR PROCESSING WITH DATAREG 05480068
OUTREG   EQU   9                   POINTER TO VARIABLE AREA IN TIOA.    05520068
OUTLOOP  EQU   10                  LOOP REG FOR PROCESSING WITH OUTREG. 05560068
LINKREG  EQU   11                  LINKAGE TO COMMON SUBROUTINES.       05600068
R15      EQU   15                                                       05640068
SBA      EQU   X'11'                                                    05680068
SF       EQU   X'1D'                                                    05720068
IC       EQU   X'13'                                                    05760068
UNA      EQU   X'40'                                                    05800068
UHA      EQU   X'C8'                                                    05840068
PNA      EQU   X'60'                                                    05880068
PDA      EQU   X'E8'                                                    05920068
PIA      EQU   X'6D'                                                    05960068
MNP      EQU   X'61'                                                    06000068
L2P1     EQU   X'C150'                                                  06040068
L3P1     EQU   X'C260'                                                  06080068
L1P1     EQU   X'4040'                                                  06120068
L5P1     EQU   X'C260'                                                  06160068
L1P36    EQU   X'40E3'                                                  06200068
L4P1     EQU   X'C3F0'                                                  06240068
L1P7     EQU   X'40C6'                                                  06280068
L3P39    EQU   X'C1F6'                                                  06320068
L2P79    EQU   X'C25E'                                                  06360068
L2P1LG   EQU   X'C150'                                                  06400068
L3P1LG   EQU   X'C260'                                                  06440068
L4P1LG   EQU   X'C3F0'                                                  06480068
L1P1SM   EQU   X'4040'                                                  06520068
L2P1SM   EQU   X'40E8'                                                  06560068
L3P1SM   EQU   X'C150'                                                  06600068
L4P1SM   EQU   X'C1F8'                                                  06640068
L6P26    EQU   X'C6E9'                                                  06680068
         PRINT OFF                                                      06720068
         COPY  DFHCSADS                                                 06760068
         COPY  DFHTCTLE                                                 06800068
         COPY  DFHTCTTE                                                 06840068
         COPY  DFHTCADS                                                 06880068
         PRINT ON                                                       06920068
PARM1    DS    D                   1ST INPUT FIELD.                     06960068
PARM2    DS    D                   2ND INPUT FIELD.                     07000068
PARM3    DS    D                   3RD INPUT FIELD.                     07040068
PARM4    DS    D                   4TH INPUT FIELD.                     07080068
PARM5    DS    D                   5TH INPUT FIELD.                     07120068
PARM6    DS    D                   6TH INPUT FIELD.                     07160068
TWASBAS  DS    PL1                 COUNT OF SBA'S IN INPUT MSG.         07200068
TWAREL   DS    CL3                 FILE CONTROL RELATIVE BLK ADDR.      07240068
TWALINE  DS    F                   ADDR OF OUR TCTLE                    07280068
DUBLWD   DS    D                   WORK AREA.                           07320068
TWATIOA  DS    F                   SAVE INPUT ADDRESS.                  07360068
TWATCTID DS    F                   SAVE TERML ID.                       07400068
TWASLOT  DS    F                   SLOT COUNTER.                        07440068
SAVE14   DS    F                   SAVE AREA.                           07480068
TWAOUT   DS    F                   SAVE OUTPUT HDR ADDR                 07520068
LINESZ   DS    H                   LINE SIZE (3277 MOD 1 OR MOD 2)      07560068
LINELOOP DS    H                   NBR LINE ITEMS PER LINESZ.           07600068
OUTSWCH  DS    C                                                        07640068
HXLINLIB DS    0CL6                LINE ADDRESS INCLUDING               07680068
         DS    C                                                        07720068
HEXLINE  DS    CL2                      VTAM LIB ADDR                   07760068
HEXLIB   DS    CL3                      IN HEX FORMAT.                  07800068
HEXCTRL  DS    C                   CTRL UNIT POLL CHAR.                 07840068
HEXTERM  DS    C                   TERML POLL CHAR.                     07880068
NEWFIRST DS    CL5                 SAVE AREA FOR OLD BLK & SLOT NBR.    07920068
NEWPREV  DS    CL5                 SAVE AREA FOR OLD BLK & SLOT NBR.    07960068
SAVETERM DS    CL8                 TERMINAL SAVE AREA FOR 'NO ERR' MSG  08000068
SAVECU   DS    CL8                 CTRL UNIT SAVE AREA FOR 'NO ERR' MSG 08040068
SAVELINE DS    CL8                 LINE SAVE AREA FOR 'NO ERR' MSG      08080068
SAVEID   DS    CL20                CICS SYMBOLIC ID FOR 'NO ERR' MSG    08120068
BITFIRST DS    CL5                 FIRST BBBSS                          08160068
BITLAST  DS    CL5                 SECOND BBBSS                         08200068
BITPREV  DS    CL5                 THIRD BBBSS                          08240068
DATDATE  DS    CL4                 DATE OF ERROR - 00YYDDDF             08280068
DATTIME  DS    CL4                 TIME OF ERROR - HHMMSSHH             08320068
DATASLOT DSECT                                                          08360068
         USING *,DATAREG                                                08400068
DATALTH  DS    C                   LTH OF THIS SLOT                     08440068
LINEID   DS    CL6                 LINE AND LIB ADDR                    08480068
ENTRYTYP DS    C                   ENTRY TYPE - MDR OR OBR              08520068
         DS    CL3                                                      08560068
MDRTYPE  DS    C                   TYPE HDWE - 03 EQUALS 3270           08600068
         DS    CL3                                                      08640068
DATE     DS    CL4                 DATE OF ERROR - 00YY0DDF             08680068
TIME     DS    CL4                 TIME OF ERROR - HHMMSSHH             08720068
         DS    CL8                                                      08760068
MDRCUA   DS    CL2                 MDR CHAN & UNIT ADDR                 08800068
MDRCTRL  DS    C                   MDR CTRL UNIT POLL ADDR              08840068
MDRTERM  DS    C                   MDR TERMIL POLL ADDR                 08880068
MDRSTATS DS    CL2                 REMOTE 3270 STATUS                   08920068
         DS    CL2                                                      08960068
OBRCCW   DS    CL8                 LAST CCW EXECUTED                    09000068
OBRCSW   DS    CL8                 CHANNEL STATUS WORD                  09040068
         DS    CL6                                                      09080068
OBRUCB   DS    C                                                        09120068
         DS    CL3                                                      09160068
OBRCUA   DS    CL2                 OBR CHAN & UNIT ADDR                 09200068
OBRCTRL  DS    C                                                        09240068
OBRTERM  DS    C                                                        09280068
         DS    CL12                                                     09320068
OBRSENSE DS    CL2                 OBR SENSE BYTES                      09360068
         ORG   DATALTH                                                  09400068
CTRLPORT DS    CL6                 PORT & LIB ADDRESS                   09440068
         DS    CL4                                                      09480068
CTRLFRST DS    CL3                 REL BLK ADDR 1ST BLK IN CHAIN.       09520068
         DS    CL3                                                      09560068
SLOTLTH  EQU   *-CTRLPORT                                               09600068
         COPY  DFHTIOA                                                  09640068
SBA1     DS    CL3                 1ST SBA POSITION.                    09680068
CODE     DS    CL4                 TRANS CODE.                          09720068
SBA2     DS    CL3                 2ND SBA                              09760068
PGRM     DS    CL4                 PROGRAM NAME.                        09800068
SBA3     DS    CL3                 3RD SBA.                             09840068
FLP      DS    CL15                FIRST/LAST/PREVIOUS IF BLOWUP RQST.  09880068
SBA4     DS    CL3                 4TH SBA.                             09920068
BUX      DS    CL4                 X FOR BLOWUP REQUEST.                09960068
TIOITEM  DS    CL5                 ITEM ADDRESS TO BLOWUP.              10000068
         ORG   FLP                 START OF BBBSS AREAS                 10040068
         DS    C                   FOR FORWARD AND BACKWARD REQUST      10080068
         DS    CL3                 4TH SBA FOR BBBSS                    10120068
TIOFIRST DS    CL5                 FIRST BBBSS AREA                     10160068
TIOLAST  DS    CL5                 LAST BBBSS AREA                      10200068
TIOPREV  DS    CL5                 PREVIOUS BBBSS AREA                  10240068
         COPY  DFHFIOA                                                  10280068
CTRLLAST DS    F                   LAST USED ADDR IN DATASET            10320068
CTRLTOTL DS    F                   TOTAL BLOCKS IN DATASET              10360068
CTRLBACK DS    F                   BACKWARD PTR IN CTRL BLK CHAIN       10400068
CTRLFWD  DS    F                   FORWARD PTR IN CTRL BLK CHAIN        10440068
CTRLENTS DS    C                   NBR ENTRIES IN THIS CTRL BLK         10480068
         DS    CL15                FOR FUTURE USE                       10520068
CTRLSLT1 DS    0C                  START OF CTRL SLOT NBR ONE.          10560068
         ORG   FIOADBA                                                  10600068
DATAPORT DS    CL6                 PORT & LIB ADDR                      10640068
DATATIME DS    CL4                 TIME BLOCK CREATED                   10680068
DATADATE DS    CL4                 DATE BLOCK CREATED                   10720068
DATAFWD  DS    CL3                 FORWARD CHAIN ADDR                   10760068
DATABACK DS    CL3                 BACKWAD CHAIN ADDR                   10800068
BLKLTH   DS    CL2                 NBR BYTES USED IN THIS BLOCK         10840068
         DS    CL10                                                     10880068
DATASLT1 DS    0C                  START OF 1ST DATA SLOT               10920068
BNGC3270 CSECT                                                          10960068
         BALR  BASE1,0                                                  11040068
         USING *,BASE1,BASE2                                            11080068
BNGC3270 BNGHJN SKIPID                                         @OZ30480 11100007
         LA    BASE2,2048(BASE1)   SETUP PROGRAM BASE REGS.             11120068
         LA    BASE2,2048(BASE2)                                        11160068
         L     TCTTEAR,TCAFCAAA    POINT TO TCT TERML ENTRY.            11200068
         LA    TCTTEAR,0(TCTTEAR)  CLEAR HIGH ORDER BYTE FROM ADDR      11240068
         L     TIOABAR,TCTTEDA     POINT TO TIOA INPUT AREA.            11280068
A005     CP    TWASBAS,=P'2'       WERE LESS THAN 2 FIELDS INPUT?       11320068
         BNL   J010                NO. GO EXAMINE INPUT FURTHER.        11360068
A010     XC    TWAREL,TWAREL       YES. THIS IS A NEW RECAP REQUEST.    11400068
         CLC   PARM3(3),=C'ALL'    IF PARM 3 IS ONE OF THE DEMF         11440068
         BE    A140                DISPLAY CODES, THIS INPUT WAS FROM   11480068
         CLC   PARM3(4),=C'CTRL'          FORMATTED SCREEN.             11520068
         BE    A140                ZERO IT OUT AND TRY AGAIN.           11560068
         CLC   PARM3(4),=C'LINE'                                        11600068
         BE    A140                                                     11640068
         CLC   PARM3(4),=C'3270'                                        11680068
         BE    A140                                                     11720068
         CLC   PARM4(3),=C'ALL'                                         11760068
         BE    A130                                                     11800068
         CLC   PARM4(4),=C'CTRL'                                        11840068
         BE    A130                                                     11880068
         CLC   PARM4(4),=C'LINE'                                        11920068
         BE    A130                                                     11960068
         CLC   PARM4(4),=C'3270'                                        12000068
         BE    A130                                                     12040068
         CLC   PARM5(3),=C'ALL'                                         12080068
         BE    A120                                                     12120068
         CLC   PARM5(4),=C'CTRL'                                        12160068
         BE    A120                                                     12200068
         CLC   PARM5(4),=C'LINE'                                        12240068
         BE    A120                                                     12280068
         CLC   PARM5(4),=C'3270'                                        12320068
         BE    A120                                                     12360068
         OC    PARM3,PARM3         WAS LINE ID INPUT?                   12400068
         BNZ   B140                YES. GO SEARCH CTRL BLK FOR IT.      12440068
         TM    TCTEAMIB,TCTEVTAM    IS THIS FROM A VTAM TERM?           12480068
         BO    A110                 YES. CAN'T HONOR REQUEST.           12520068
         L     14,CSATCTBA         POINT TO TCT PREFIX.                 12560068
         L     14,4(14)            POINT TO BTAM ADCON LIST.            12600068
A030     CLC   0(4,14),=X'FFFFFFFF'  ANY MORE LINES TO LOOK AT?         12640068
         BE    S190                NO. SEND 'INVALID INPUT' MSG.        12680068
         L     1,0(14)             POINT TO A LINE.                     12720068
         ST    1,TWALINE           STORE ADDR IN CASE THIS IS IT.       12760068
         TM    TCTLELF,TCTLEFAA    IS THIS A POOLED LINE?               12800068
         BZ    A090                NO.                                  12840068
         TM    TCTLEPI,TCTLEMFP    YES. IS IT 1ST IN POOL?              12880068
         BZ    A150                NO. SKIP IT - DOESN'T POINT TO DCB.  12920068
A090     L     15,TCTLEPA          YES. POINT TO 1ST TERML.             12960068
A100     CLC   TCTTETI,0(15)       IS THIS OUR TERML?                   13000068
         BE    A170                YES. HAVE LOCATED ITS LINE ENTRY.    13040068
         TM    (TCTTELT-TCTTETI)(15),TCTTECLT  LAST TERML ON LINE?      13080068
         BO    A150                YES. GO LOOK AT NEXT LINE.           13120068
         AH    15,(TCTTETEL-TCTTETI)(15)  BUMP TO NEXT TERML.           13160068
         B     A100                                                     13200068
A110     MVC   TIOATDL(VTAMLTH),VTAMMSG                                 13240068
         MVC   TIOATDL+(VTAMID-VTAMMSG)(4),TCTTETI                      13280068
         B     D170                                                     13320068
VTAMMSG  DC    AL2(VTAMLTH-4),X'0000'                                   13360068
         DC    CL10'BNG010I C '                                         13400068
VTAMID   DC    CL8' ',CL21' IS A VTAM TERMINAL. '                       13440068
         DC    CL39'FOR INQUIRY,GIVE DEMF HARDWARE ADDRESS.'            13480068
VTAMLTH  EQU   *-VTAMMSG                                                13520068
A120     XC    PARM5,PARM5                                              13560068
         B     A010                                                     13600068
A130     XC    PARM4(16),PARM4                                          13640068
         B     A010                                                     13680068
A140     XC    PARM3(24),PARM3     ZERO OUT PARMS 3, 4, AND 5.          13720068
         B     A010                                                     13760068
A150     LA    14,4(14)            BUMP TO NEXT LINE ADDRESS.           13800068
         B     A030                                                     13840068
A170     EQU   *                                                        13880068
         L     1,TWALINE           POINT TO THIS TERML'S LINE.          13920068
         L     14,TCTLEDCB         POINT TO THE DCB.                    13960068
         USING IHADCB,14                                                14000068
         DCBD                                                           14040068
BNGC3270 CSECT                                                          14080068
         SR    15,15                                                    14120068
         CLI   TCTTETT,X'99'       IS THIS A LOCAL 3270?                14160068
         BE    A200                YES. GET REL LINE NBR FROM TE.       14200068
         IC    15,TCTLERLN         NO. GET REL LINE NBR FROM LE.        14240068
         B     A210                                                     14280068
A200     IC    15,TCTTEGU                                               14320068
A210     L     1,DCBDEBAD          POINT TO THE DEB.                    14360068
         LA    1,32(1)             POINT TO LIST OF UCBS.               14400068
A220     BCT   15,A230                                                  14440068
         B     A250                                                     14480068
A230     LA    1,4(1)              BCT TO APPROPRIATE RLN UCB.          14520068
         B     A220                                                     14560068
A250     L     1,0(1)              POINT TO THE UCB.                    14600068
         MVC   PARM3(3),13(1)      MOVE LINEID TO INPUT PARM FIELD.     14640068
         CLI   TCTTETT,X'99'       IS THIS A LOCAL 3270?                14680068
         BE    B130                YES. BYPASS LOOKING FOR POLL CHARS.  14720068
         L     14,TCTTETA          POINT TO ADDRESSING LIST.            14760068
         UNPK  DUBLWD,0(2,14)      GET CTRL UNIT ADDRESS.               14800068
         TR    DUBLWD,HXTOEB       CONVERT IT TO 2 EBCDIC CHARS.        14840068
         MVC   PARM4(2),DUBLWD+5   MOVE THEM TO INPUT PARM FIELD.       14880068
         NI    PARM4,X'FD'         CONVERT REMOTE CU TO ACTUAL CU NUM   14920068
         UNPK  DUBLWD,2(2,14)      GET TERML ADDRESS.                   14960068
         TR    DUBLWD,HXTOEB       CONVERT IT TO 2 EBCDIC CHARS.        15000068
         MVC   PARM5(2),DUBLWD+5   MOVE THEM TO INPUT PARM FIELD.       15040068
*                                                                       15080068
* AT THIS POINT, IF NO INPUT LINE/CTRL/TERM WAS SPECIFIED, THE          15120068
* ADDRESS PERTAINING TO THE REQUESTOR'S TERMINAL HAS BEEN PLACED        15160068
* IN THE INPUT PARMS AS IF THEY HAD BEEN KEYED IN.                      15200068
*                                                                       15240068
B130     MVC   TWATCTID,TCTTETI    MOVE THIS TERML'S CICS ID ALSO.      15280068
B140     MVC   SAVETERM,PARM5      MOVE TERMINAL  TO SAVE AREA          15320068
         MVC   SAVECU,PARM4        MOVE CTRL UNIT TO SAVE AREA          15360068
         MVC   SAVELINE,PARM3      MOVE LINE      TO SAVE AREA          15400068
B160     MVC   DUBLWD+5(3),PARM3                                        15440068
         TR    DUBLWD,EBTOHX            GET LINE,                       15480068
         PACK  DUBLWD(3),DUBLWD+5(4)    CONTROL UNIT,                   15520068
         MVC   HEXLINE,DUBLWD           AND                             15560068
         MVC   DUBLWD+5(3),PARM4        TERMINAL                        15600068
         TR    DUBLWD,EBTOHX            ADDRESS                         15640068
         PACK  DUBLWD(2),DUBLWD+5(3)    INTO HEX                        15680068
         MVC   HEXCTRL,DUBLWD           FORMAT                          15720068
D070     MVC   DUBLWD+5(3),PARM5        FOR COMPARING                   15760068
         TR    DUBLWD,EBTOHX            TO DATA IN                      15800068
         PACK  DUBLWD(2),DUBLWD+5(3)    DISK FILE.                      15840068
         MVC   HEXTERM,DUBLWD                                           15880068
         ST    TIOABAR,TWATIOA     SAVE ADDR OF ORIGINAL INPUT AREA.    15920068
         BAL   LINKREG,GETTIOA     SETUP NEW OUTPUT AREA WITH HDRS.     15960068
D080     DFHFC TYPE=GET,DATASET=EMFILE,RDIDADR=TWAREL,NORESP=D190       16000068
D090     DFHSC TYPE=GETMAIN,CLASS=TERM,NUMBYTE=256,INITIMG=40           16040068
         L     TIOABAR,TCASCSA     GET A NEW OUTPUT AREA BIG            16080068
         ST    TIOABAR,TCTTEDA     ENOUGH FOR THE BNG001 ERR MSG.       16120068
         MVC   TIOADBA(IOERRLTH),IOERRMSG                               16160068
         MVC   TIOATDL,=AL2(IOERRLTH)                                   16200068
         UNPK  DUBLWD,TWAREL(4)         SETUP I/O ERROR MSG WITH        16240068
         TR    DUBLWD,HXTOEB            BLOCK NBR THAT                  16280068
         MVC TIOADBA+(IOBLOCK-IOERRMSG)(3),DUBLWD+4  WAS BEING READ,    16320068
         UNPK  DUBLWD,TCAFCAA(3)        AND THE CICS FILE               16360068
         TR    DUBLWD,HXTOEB            CONTROL RETURN CODE.            16400068
         MVC   TIOADBA+(IOCODE-IOERRMSG)(2),DUBLWD+3                    16440068
D170     DFHTC TYPE=(WRITE,ERASE)                                       16480068
         DFHPC TYPE=RETURN                                              16520068
D190     L     FIOABAR,TCAFCAA     POINT TO FILE I/O AREA.              16560068
         SR    DATALOOP,DATALOOP   SETUP TO LOOP ON NBR OF              16600068
         IC    DATALOOP,CTRLENTS   ENTRIES IN THIS CNTRL BLK.           16640068
         LTR   DATALOOP,DATALOOP   VERIFY THAT THE DATA SET             16680068
         BNZ   E030                IS NOT EMPTY.                        16720068
D240     LA    OUTREG,TIOADBA      POINT TO OUTPUT AREA                 16760068
         CLI   TCTTETM,X'F1'       IS THIS A 3277-1?                    16800068
         BE    D250                YES.                                 16840068
         MVC   TIOADBA(M11LGLTH),MSG11LG  SEND 'NO ERRS' MSG            16880068
         B     D260                                                     16920068
D250     MVC   TIOADBA(M11SMLTH),MSG11SM  SEND 'NO ERRS' MSG            16960068
D260     CLI   SAVETERM,X'00'      IS THERE A TERMINAL ID?              17000068
         BE    D280                NO. IT IS LOCAL TERMINAL             17040068
         CLI   TCTTETM,X'F1'       IS THIS A 3277-1?                    17080068
         BE    D271                YES.                                 17120068
         MVC   (M11LGTRM-MSG11LG)(2,OUTREG),SAVETERM                    17160068
         MVC   (M11LGCU-MSG11LG)(2,OUTREG),SAVECU                       17200068
         MVC   (M11LGLN-MSG11LG)(3,OUTREG),SAVELINE                     17240068
         MVC   (M11LGID-MSG11LG)(20,OUTREG),SAVEID                      17280068
         MVC   TIOATDL,=AL2(M11LGLTH)                                   17320068
         B     D300                                                     17360068
D271     MVC   (M11SMTRM-MSG11SM)(2,OUTREG),SAVETERM                    17400068
         MVC   (M11SMCU-MSG11SM)(2,OUTREG),SAVECU                       17440068
         MVC   (M11SMLN-MSG11SM)(3,OUTREG),SAVELINE                     17480068
         MVC   (M11SMID-MSG11SM)(20,OUTREG),SAVEID                      17520068
         MVC   TIOATDL,=AL2(M11SMLTH)                                   17560068
         B     D300                                                     17600068
D280     CLI   TCTTETM,X'F1'       (LOCAL) IS THIS A 3277-1?            17640068
         BE    D281                YES.                                 17680068
         MVC   TIOADBA(M12LGLTH),MSG12LG  SEND 'NO ERRS' MSG            17720068
         MVC   (M12LGTRM-MSG12LG)(3,OUTREG),SAVELINE      LOCAL TERM    17760068
         MVC   (M12LGID-MSG12LG)(20,OUTREG),SAVEID                      17800068
         MVC   TIOATDL,=AL2(M12LGLTH)                                   17840068
         B     D300                                                     17880068
D281     MVC   TIOADBA(M12SMLTH),MSG12SM  SEND 'NO ERRS' MSG            17920068
         MVC   (M12SMTRM-MSG12SM)(3,OUTREG),SAVELINE      LOCAL TERM    17960068
         MVC   (M12SMID-MSG12SM)(20,OUTREG),SAVEID                      18000068
         MVC   TIOATDL,=AL2(M12SMLTH)                                   18040068
D300     DFHTC TYPE=(WRITE,ERASE)                                       18080068
         DFHPC TYPE=RETURN                                              18120068
E030     LA    DATAREG,CTRLSLT1    POINT TO FIRST CTRL SLOT.            18160068
E040     OC    PARM4,PARM4         WAS A CTRL UNIT ADDR INPUT?          18200068
         BNZ   E110                YES. LINE ID IS CORRECT.             18240068
         XC    DUBLWD,DUBLWD       NO. THIS MUST BE RQST FOR LOCAL.     18280068
         MVC   DUBLWD(3),HXLINLIB  ROUND CUA ADDR DOWN                  18320068
         NI    DUBLWD+2,B'11100000'     TO EVEN CHAN ADDR.              18360068
         CLC   DUBLWD(6),CTRLPORT       LOOK FOR EQUAL LINE ADDRESS.    18400068
         B     E120                                                     18440068
E110     CLC   HXLINLIB,CTRLPORT   IS THIS SLOT = RQSTD LINE ADDR?      18480068
E120     BE    E200                YES. GO READ ITS DATA BLOCK.         18520068
         LA    DATAREG,SLOTLTH(DATAREG)  NO. BUMP TO NEXT CTRL SLOT.    18560068
         BCT   DATALOOP,E040            MORE SLOTS TO LOOK AT?          18600068
         OC    CTRLBACK,CTRLBACK        NO. IS THERE ANOTHER CTRL BLK?  18640068
         BZ    D240                NO. SEND 'NO ERRS' MSG.              18680068
         MVC   TWAREL,CTRLBACK+1        YES. SAVE NEXT BLOCK ADDR.      18720068
         DFHFC TYPE=RELEASE                                             18760068
         B     D080                                                     18800068
E200     MVC   TWAREL,CTRLFRST     MOVE DATA BLOCK ADDR.                18840068
F020     DFHFC TYPE=RELEASE        RELEASE THE CONTROL BLOCK.           19200068
         OC    TWAREL,TWAREL       IS THERE ANY DATA BLOCKS ?  @OZ31885 19210007
         BZ    T190                NO, WRITE 'NO DATA BLKS MSG'@OZ31885 19220007
         DFHFC TYPE=GET,DATASET=EMFILE,RDIDADR=TWAREL,NORESP=F050       19240068
         B     D090                                                     19280068
F050     L     FIOABAR,TCAFCAA     POINT TO DATA BLOCK.                 19320068
         XC    TWASLOT,TWASLOT     INITIALIZE SLOT COUNT TO 1.          19360068
         LH    DATALOOP,BLKLTH     SETUP TO LOOP ON NBR BYTES IN REC.   19400068
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM.            19440068
F080     L     14,TWASLOT                                               19480068
         LA    14,1(14)            ADD ONE TO SLOT COUNT                19520068
         ST    14,TWASLOT                                               19560068
         CLI   ENTRYTYP,X'91'      IS THIS ENTRY AN MDR RECORD?         19600068
         BNE   H060                NO. TEST FURTHER.                    19640068
         CLI   MDRTYPE,X'03'       YES. IS IT A 3270?                   19680068
         BE    G060                YES. TEST FURTHER.                   19720068
F120     SR    1,1                 NO. BUMP                             19760068
         IC    1,0(DATAREG)        TO NEXT DATA ITEM.                   19800068
         LTR   1,1                 PRECENT ENDLESS LOOP                 19840068
         BZ    F240                IN CASE GARBAGE IN RECORD.           19880068
         AR    DATAREG,1                                                19920068
         SR    DATALOOP,1          ALL DONE WITH THIS BLOCK?            19960068
         LTR   DATALOOP,DATALOOP                                        20000068
         BP    F080                NO. PROCESS NEXT ITEM.               20040068
         OC    DATAFWD,DATAFWD     YES. IS THERE ANOTHER BLOCK?         20080068
         BZ    F240                NO. GO WIND UP OUTPUT.               20120068
         MVC   TWAREL,DATAFWD      YES. GET CHAIN ADDR AND              20160068
         B     F020                GO READ NEXT BLOCK.                  20200068
F240     CLI   OUTSWCH,X'FF'       WAS ANY OUTPUT CREATED?              20240068
         BNE   D240                NO. SEND 'NO ERRS' MSG.              20280068
G020     LA    1,TIOADBA           YES. COMPUTE                         20320068
         SR    OUTREG,1            TOTAL DATA LTH.                      20360068
         STH   OUTREG,TIOATDL                                           20400068
         B     D170                GO TRANSMIT DISPLAY.                 20440068
G060     CLC   MDRCTRL,HEXCTRL     IS THIS MDR FOR RQSTED CTRL UNIT?    20480068
         BNE   F120                NO. SKIP IT.                         20520068
         CLC   MDRTERM,HEXTERM     YES. IS IT FOR REQUESTED TERML?      20560068
         BNE   F120                NO. SKIP IT.                         20600068
         MVC   0(MDRLTH,OUTREG),MDRHDR   YES. SETUP BUILD 1 MDR LINE.   20640068
         UNPK  DUBLWD,MDRSTATS(3)                                       20680068
         TR    DUBLWD,HXTOEB       FILL IN REMOTE STATUS BYTES.         20720068
         MVC   (MDRSTAT-MDRHDR)(4,OUTREG),DUBLWD+3                      20760068
G100     UNPK  DUBLWD,TWAREL(4)                                         20800068
         TR    DUBLWD,HXTOEB       FILL IN THIS BLK NBR.                20840068
         MVC   (MDRBBBSS-MDRHDR)(3,OUTREG),DUBLWD+4                     20880068
         UNPK  DUBLWD,TWASLOT(5)                                        20920068
         TR    DUBLWD,HXTOEB       FILL IN THIS SLOT NBR.               20960068
         MVC   (MDRBBBSS+3-MDRHDR)(2,OUTREG),DUBLWD+5                   21000068
         L     14,TWAOUT           POINT TO OUTPUT BBBSS FIELDS.        21040068
         CLC   (BBBSS-HDR3)(5,14),=C'BBBSS' IS 'FIRST' FILLED IN?       21080068
         BNE   G200                YES. SKIP IT.                        21120068
         MVC   (BBBSS-HDR3)(5,14),(MDRBBBSS-MDRHDR)(OUTREG) NO. DO IT.  21160068
         CLC   (BBBSS+10-HDR3)(5,14),=C'BBBSS' HOW ABOUT 'PREV'?        21200068
         BNE   G200                ALREADY THERE; SKIP IT.              21240068
         MVC   (BBBSS+10-HDR3)(5,14),(BBBSS-HDR3)(14)  NO. USE 'FIRST'  21280068
G200     MVC   (BBBSS+5-HDR3)(5,14),(MDRBBBSS-MDRHDR)(OUTREG)           21320068
         UNPK  DUBLWD,TIME                                              21360068
         MVC   (MDRHRS-MDRHDR)(2,OUTREG),DUBLWD+1   FILL IN HOURS       21400068
         MVC   (MDRMINS-MDRHDR)(2,OUTREG),DUBLWD+3  AND MINUTES.        21440068
G230     MVI   OUTSWCH,X'FF'       INDICATE SOME OUTPUT WAS CREATED.    21480068
         TIME    DEC          GET SYSTEM TIME                           21520068
         STCM  0,15,DATTIME        STORE TIME                           21560068
         STCM  1,15,DATDATE        STORE DATE                           21600068
         CP    DATE,DATDATE        DID ERROR HAPPEN TODAY?              21640068
         BE    G240                YES,BR HIGH INTENSITY                21680068
         SP    DATDATE,=P'1'       MAKE DATE YESTERDAY                  21720068
         CP    DATE,DATDATE        DID IT HAPPEN YESTERDAY              21760068
         BNE   G230A               NO,BR LEAVE INTENSITY NORMAL         21800068
         CLC   TIME,DATTIME        IS IT OLDER THAN 24 HRS?             21840068
         BNL   G240                NO,BR MAKE IT HIGH INTENSITY         21880068
G230A    LA    R1,LEAPTBL                                               21920068
G231     CLC   DATE+1(1),0(1)      SEE IF                               21960068
         BE    G232                ERROR HAPPENED                       22000068
         LA    R1,1(R1)            IN LEAP YEAR                         22040068
         CLI   0(R1),X'FF'         IS IT END OF TABLE                   22080068
         BNE   G231                NO,BR TRY NEXT YEAR                  22120068
         ZAP   CALENDAR+8(2),=P'28' NOT LEAP YEAR                       22160068
         B     G233                CONTINUE                             22200068
G232     ZAP   CALENDAR+8(2),=P'29' YES,LEAP YEAR                       22240068
G233     LA    R15,CALENDAR                                             22280068
G234     MVN   DATE+3(1),=X'0C'    MAKE SURE SIGN IS CORRECT            22320068
         CLC   DATE+2(2),3(R15)    COMPUTE MONTH                        22360068
         BNH   G235                AND DAY FROM                         22400068
         SP    DATE+2(2),3(2,R15)  DAY NUMBER                           22440068
         LA    R15,5(R15)                                               22480068
         B     G234                                                     22520068
G235     MVC   (MDRHRS-MDRHDR)(3,OUTREG),0(R15)  MOVE MONTH AND         22560068
         UNPK  (MDRMINS-MDRHDR)(2,OUTREG),DATE+2(2)   DAY TO OUTPUT     22600068
         OI    (MDRMINS+1-MDRHDR)(OUTREG),X'F0'                         22640068
         B     H030                                                     22680068
G240     MVI   1(OUTREG),PDA       YES.                                 22720068
         MVI   4(OUTREG),UHA                                            22760068
         MVI   15(OUTREG),PDA                                           22800068
H030     LA    OUTREG,MDRLTH(OUTREG)    BUMP TO NEXT OUTPUT SLOT.       22840068
         BCT   OUTLOOP,F120        MORE TIOA ROOM LEFT?                 22880068
         B     G020                NO. GO WIND UP OUTPUT.               22920068
H060     CLI   ENTRYTYP,X'91'      IS THIS ENTRY AN OBR?                22960068
         BE    F120                NO. SKIP IT.                         23000068
         CLC   OBRCUA,HEXLINE      YES. IS IT THE REQUESTED CUA ADDR?XX 23040068
         BNE   F120                NO. SKIP IT.                      XX 23080068
         CLI   OBRUCB,X'10'        IS THIS A REMOTE OBR ?            XX 23120068
         BE    H070                NO. BYPASS CHECKING POLL CHARS    XX 23160068
         CLC   OBRCTRL,HEXCTRL     IS IT THE REQUESTED CTRL UNIT ?      23200068
         BNE   F120                NO. SKIP IT.                         23240068
         CLC   OBRTERM,HEXTERM     IS IT THE REQUESTED TERMINAL ?       23280068
         BNE   F120                NO. SKIP IT.                         23320068
H070     MVC   0(MDRLTH,OUTREG),MDRHDR  YES. SETUP COMMON MDR/OBR HDRXX 23360068
         UNPK  DUBLWD,OBRCSW+4(3)                                       23400068
         TR    DUBLWD,HXTOEB       FILL IN CSW BYTES                    23440068
         MVC   (OBRSNS-MDRHDR)(4,OUTREG),DUBLWD+3                       23480068
         UNPK  DUBLWD,OBRSENSE(3)                                       23520068
         TR    DUBLWD,HXTOEB       FILL IN SENSE BYTES.                 23560068
         MVC   (MDRSTAT-MDRHDR)(4,OUTREG),DUBLWD+3                      23600068
         NI    OBRCCW+5,X'3F'      CLEAN UP TP OP CODE.                 23640068
         UNPK  DUBLWD,OBRCCW+5(2)                                       23680068
         TR    DUBLWD,HXTOEB       FILL IN TP OP CODE.                  23720068
         MVC   (OBRTPOP+1-MDRHDR)(2,OUTREG),DUBLWD+5                    23760068
         MVI   (OBRTPOP-1-MDRHDR)(OUTREG),C'B'                          23800068
         CLI   ENTRYTYP,X'34'      IS THIS A TCAM OBR?                  23840068
         BNE   J005                NO. LEAVE 'B' IN FOR BTAM            23880068
         MVI   (OBRTPOP-1-MDRHDR)(OUTREG),C'T'    T=TCAM                23920068
J005     UNPK  DUBLWD,OBRCCW(2)                                         23960068
         TR    DUBLWD,HXTOEB       FILL IN CHANL COMMAND.               24000068
         MVC   (OBRCMD-MDRHDR)(2,OUTREG),DUBLWD+5                       24040068
         B     G100                GO FILL IN DATA COMMON TO MDR/OBR.   24080068
J010     CLC   TIOADBA+8(2),=AL2(L1P7)  IS SECOND FIELD LINE 1 POSN 7?  24120068
         BE    A010                YES. THIS IS NEW INPUT.              24160068
         CLC   TIOADBA+8(2),=AL2(L6P26) IS SECOND FIELD LINE 6 POSN 26? 24200068
         BE    A010                YES. THIS IS NEW INPUT.              24240068
         LA    14,TIOADBA          SCAN THE INPUT TO SEE                24280068
J020     CLI   0(14),C'%'          IF THE SPECIAL CHAR                  24320068
         BE    J140                '%' IS PRESENT, WHICH                24360068
         CLI   0(14),X'00'         WAS PUT OUT BY THE BLOWUP            24400068
         BE    J050                ROUTINE TO INDICATE A                24440068
         LA    14,1(14)            RETURN FROM BLOWUP.                  24480068
         B     J020                                                     24520068
J050     CLC   PARM4(4),=C'PAGE'   IS THIS A 'PAGE' REQUEST?            24560068
         BNE   L160                NO. MUST BE 'BLOWUP' REQUEST.        24600068
         CLC   31(2,TIOABAR),=X'C1D3'   PAGE REQUEST           @OZ30480 24604007
         BE    ALTBBB                   YES, POINT TO NEXT FLD @OZ30480 24605007
         CLC   31(2,TIOABAR),=X'C17B'   PAGE BKWRD LARGE SCREEN@OZ30480 24606007
         BE    ALTBBB                   YES, POINT TO NEXT FLD @OZ30480 24607007
         CLC   31(2,TIOABAR),=X'406B'   PAGE FRWRD SMALL SCREEN@OZ30480 24608007
         BE    ALTBBB                   YES, POINT TO NEXT FLD @OZ30480 24609007
         B     PTOK                     NO, POINTER IS OK      @OZ30480 24610007
ALTBBB   CLC   PARM5(7),=C'FORWARD'     IS IT PAGE FORWARD     @OZ30480 24611007
         BNE   J191                     NO, MUST BE BACKWARD   @OZ30480 24612007
         MVC   NEWFIRST,TIOLAST+4       OLD LAST TO NEW FIRST  @OZ30480 24613007
         MVC   NEWPREV,TIOFIRST+4       OLD FIRST TO NEW PREV  @OZ30480 24614007
         TR    TIOLAST+4,EBTOHX         TRANSLATE OLD LAST     @OZ30480 24615007
         PACK  DUBLWD,TIOLAST+4(6)      INTO HEX               @OZ30480 24616007
         B     J110                     CONTINUE               @OZ30480 24617007
J191     MVC   NEWFIRST,TIOPREV+4       OLD PREV TO NEW FIRST  @OZ30480 24618007
         MVC   NEWPREV,TIOPREV+4        OLD PREV TO NEW PREV   @OZ30480 24619007
         TR    TIOPREV+4,EBTOHX         TRANSLATE OLD PREV     @OZ30480 24620007
         PACK  DUBLWD,TIOPREV+4(6)      INTO HEX               @OZ30480 24621007
         B     J110                     CONTINUE               @OZ30480 24622007
PTOK     EQU   *                                               @OZ30480 24623007
         CLC   PARM5(7),=C'FORWARD'  NO. IS IT PAGE FORWARD?            24640068
         BNE   J190                NO. MUST BE PAGE BACKWARD.           24680068
         MVC   NEWFIRST,TIOLAST    YES. PROMOTE LAST & FIRST FROM OLD   24720068
         MVC   NEWPREV,TIOFIRST    SCREEN TO NEW FIRST & PREVIOUS.      24760068
         TR    TIOLAST,EBTOHX                                           24800068
         PACK  DUBLWD,TIOLAST(6)   GET OLD 'LAST' BLK & SLOT IN HEX.    24840068
J110     MVC   TWAREL,DUBLWD+3     SETUP TO READ APPROPRIATE BLK.       24880068
         MVC   TWASLOT(1),DUBLWD+6  SETUP TO LOCATE APPROPRIATE SLOT.   24920068
         B     K010       GO READ BLK WHERE DISPLAY WILL RESUME.        24960068
*********************************************************************** 25000068
*                                                                     * 25040068
*        RESTORE BITS PROMPTER BBBSS SCREEN                           * 25080068
*                                                                     * 25120068
*********************************************************************** 25160068
J140     SH    14,=H'18'           BACKUP TO THE BBBSS FIELD            25200068
         MVC   BITFIRST(15),0(14)  ALIGN IT IN CASE NO PAGE ENTERED.    25240068
         MVC   NEWFIRST,BITFIRST    RESTORE OLD 'FIRST' & 'PREVIOUS'    25280068
         MVC   NEWPREV,BITPREV     AS NEW 'FIRST' & 'PREVIOUS'          25320068
         TR    BITFIRST,EBTOHX                                          25360068
         PACK  DUBLWD,BITFIRST(6)  GET OLD 'FIRST' ADDR & SLOT IN HEX.  25400068
         B     J110                                                     25440068
*********************************************************************** 25480068
J190     MVC   NEWFIRST,TIOPREV    OLD 'PREVIOUS' NOW BECOMES NEW       25520068
         MVC   NEWPREV,TIOPREV     'PREVIOUS' AND 'FIRST'               25560068
         TR    TIOPREV,EBTOHX                                           25600068
         PACK  DUBLWD,TIOPREV(6)   GET OLD 'PREVIOUS' IN HEX.           25640068
         B     J110                                                     25680068
K010     BAL   LINKREG,LOCATE      LOCATE SLOT TO RESUME AT.            25720068
         XC    PARM4(16),PARM4     ZERO OUT INPUT PARMS.                25760068
         CLI   ENTRYTYP,X'91'     IS THIS AN MDR?                       25800068
         BE    K020               YES. LINE ADDR IS OK.                 25840068
         XC    HXLINLIB,HXLINLIB  NO. DON'T USE ROUNDED DOWN ADDR.      25880068
         MVC   HXLINLIB+1(2),OBRCUA  GET ACTUAL CUA INSTEAD.            25920068
         B     K030                                                     25960068
K020     MVC   HXLINLIB,LINEID                                          26000068
K030     UNPK  DUBLWD,HEXLINE(3)   RESTORE LINE NBR FROM DATA           26040068
         TR    DUBLWD,HXTOEB       BLOCK AS IF IT HAD BEEN KEYED IN.    26080068
         MVC   PARM3(3),DUBLWD+4                                        26120068
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR RECORD?               26160068
         BE    K040                YES. PUT IN POLLING CHARS.        XX 26200068
         CLI   OBRUCB,X'10'        IS THIS A LOCAL ?                 XX 26240068
         BE    L110                YES. BR NO POLL CHARS             XX 26280068
         MVC   HEXCTRL,OBRCTRL     MOVE CTRL UNIT ADDR               XX 26320068
         MVC   HEXTERM,OBRTERM     MOVE TERMINAL ADDR                XX 26360068
         B     K050                                                  XX 26400068
K040     MVC   HEXCTRL,MDRCTRL     YES.                              XX 26440068
         MVC   HEXTERM,MDRTERM     RESTORE CTRL UNIT ADDR            XX 26480068
K050     UNPK  DUBLWD,HEXCTRL(3)   AND TERMINAL ADDR                 XX 26520068
         TR    DUBLWD,HXTOEB       AS IF THEY HAD                    XX 26560068
         MVC   PARM4(2),DUBLWD+3   BEEN KEYED IN.                    XX 26600068
         MVC   PARM5(2),DUBLWD+5                                     XX 26640068
L110     BAL   LINKREG,GETTIOA     SETUP OUTPUT AREA WITH HEADERS.      26680068
         L     14,TWAOUT                                                26720068
         MVC   (BBBSS-HDR3)(5,14),NEWFIRST  FINISH HEADER WITH ADDR     26760068
         MVC   (BBBSS+10-HDR3)(5,14),NEWPREV   OF FIRST & PREVIOUS BLK. 26800068
         B     F080                GO BUILD ANOTHER PAGE.               26840068
L160     CLC   PARM2(4),=C'TERM'   IS THIS A 'COMPANION' INPUT?         26880068
         BE    L200                YES. GO HUNT FOR CTRL & LINE ADDR.   26920068
         TR    TIOITEM,EBTOHX      NO. GET REQUESTED ITEM ADDR.         26960068
         PACK  DUBLWD,TIOITEM(6)        AND SLOT NUMBER.                27000068
         MVC   TWAREL,DUBLWD+3          INTO HEX.                       27040068
         MVC   TWASLOT(1),DUBLWD+6                                      27080068
         BAL   LINKREG,LOCATE      LOCATE APPROPRIATE SLOT IN DATA BLK. 27120068
         DFHSC TYPE=GETMAIN,CLASS=TERM,NUMBYTE=2000,INITIMG=40          27160068
         L     TIOABAR,TCASCSA     GET A NEW OUTPUT AREA                27200068
         ST    TIOABAR,TCTTEDA     FOR THE BLOWUP DISPLAY.              27240068
         CLI   TCTTETM,C'2'        IS THIS SCREEN A MODEL 2?            27280068
         BE    M060                YES. MOVE APPROPRIATE HEADER.        27320068
         MVC   TIOADBA(BUHDR1LT),BUHDR1   NO. MOVE MODEL 1 BLOWUP HDR.  27360068
         LA    OUTREG,TIOADBA+BUHDR1LT  POINT TO NEXT BYTE OF OUTAREA.  27400068
         B     M080                                                     27440068
L200     TR    PARM3,EBTOHX        PARM3 IS BBBSS OF CTRL UNIT DISPLAY. 27480068
         PACK  DUBLWD,PARM3(6)     GET ITS BLK & SLT IN HEX.            27520068
         MVC   TWAREL,DUBLWD+3                                          27560068
         MVC   TWASLOT(1),DUBLWD+6                                      27600068
         BAL   LINKREG,LOCATE      LOCATE BLK & SLOT OF PREVIOUS DISPLY 27640068
         XC    PARM3,PARM3         ERASE BBBSS GARBAGE.                 27680068
         UNPK  PARM3(4),DATAPORT+1(3)   MOVE LINE ADDR FROM RECORD.     27720068
         MVI   PARM3+3,X'00'                                            27760068
         TR    PARM3,HXTOEB        MAKE IT LOOK LIKE IT WAS KEYED IN.   27800068
         XC    PARM4,PARM4                                              27840068
         CLI   ENTRYTYP,X'91'      IS THIS AN OBR?                      27880068
         BNE   L270                YES. SKIP POLLING CHARACTERS.     XX 27920068
         UNPK  PARM4(3),MDRCTRL(2) NO. GET CTRL UNIT POLL CHAR.         27960068
         MVI   PARM4+2,X'00'                                            28000068
         TR    PARM4,HXTOEB        MAKE IT LOOK LIKE IT WAS KEYED IN.   28040068
         B     L300                                                     28080068
L270     CLI   OBRUCB,X'10'        IS THIS A LOCAL ?                 XX 28120068
         BE    L280                YES. BR NO POLL CHARS             XX 28160068
         UNPK  PARM4(3),OBRCTRL(2)  GET CTRL UNIT POLL CHARS         XX 28200068
         MVI   PARM4+2,X'00'                                         XX 28240068
         TR    PARM4,HXTOEB        MAKE IT LOOK LIKE IT WAS KEYED IN XX 28280068
         B     A010                                                  XX 28320068
L280     MVC   PARM3,PARM5         UNROUND TERML ADDRESS                28360068
         XC    PARM5,PARM5         ERASE GARBAGE IF LOCAL CU.           28400068
L300     DFHFC TYPE=RELEASE                                             28440068
         B     A010                                                     28480068
M060     MVC   TIOADBA(BUHDR2LT),BUHDR2   MOVE MODEL 2 BLOWUP HDR.      28520068
         LA    OUTREG,TIOADBA+BUHDR2LT  POINT TO NEXT BYTE OF OUTAREA.  28560068
M080     UNPK  DUBLWD,TIME         MOVE TIME OF                         28600068
         MVC   0(2,OUTREG),DUBLWD+1     ERROR TO OUTPUT.                28640068
         MVI   2(OUTREG),C':'                                           28680068
         MVC   3(2,OUTREG),DUBLWD+3                                     28720068
         LA    1,LEAPTBL                                                28760068
M090     CLC   DATE+1(1),0(1)           FIGURE OUT IF                   28800068
         BE    M100                     ERROR HAPPENED                  28840068
         LA    1,1(1)                   DURING LEAP YEAR.               28880068
         CLI   0(1),X'FF'                                               28920068
         BNE   M090                                                     28960068
         ZAP   CALENDAR+8(2),=P'28'                                     29000068
         B     M110                                                     29040068
M100     ZAP   CALENDAR+8(2),=P'29'                                     29080068
M110     LA    15,CALENDAR                                              29120068
M120     MVN   DATE+3(1),=X'0C'    PROTECT AGAINST GARBAGE IN PACKED    29160068
         CLC   DATE+2(2),3(15)     FIELD.  COMPUTE MONTH AND            29200068
         BNH   M130                     DAY FROM DAY NUMBER.            29240068
         SP    DATE+2(2),3(2,15)                                        29280068
         LA    15,5(15)                                                 29320068
         B     M120                                                     29360068
M130     MVC   6(3,OUTREG),0(15)        MOVE MONTH TO OUTPUT.           29400068
         UNPK  9(2,OUTREG),DATE+2(2)    MOVE DAY TO OUTPUT.             29440068
         OI    10(OUTREG),X'F0'                                         29480068
         MVC   LINESZ,=H'40'                                            29520068
         MVC   LINELOOP,=H'4'                                           29560068
         CLI   TCTTETM,C'2'        SETUP CORRECT LINE SIZE & NBR        29600068
         BNE   M140                     ITEMS FOR SCREEN MODEL.         29640068
         MVC   LINESZ,=H'80'                                            29680068
         MVC   LINELOOP,=H'12'                                          29720068
M140     EQU   *                                                        29760068
         CLI   ENTRYTYP,X'91'      IS THIS ENTRY AN OBR?                29800068
         BNE   M160                YES.                                 29840068
         BAL   LINKREG,BUMDR       NO. BLOW UP AN MDR ENTRY.            29880068
M150     LA    1,TIOADBA                                                29920068
         SR    OUTREG,1                                                 29960068
         STH   OUTREG,TIOATDL      FINISH UP THE OUTPUT.                30000068
         DFHTC TYPE=WRITE,CTLCHAR=C2                                    30040068
         DFHPC TYPE=RETURN                                              30080068
M160     BAL   LINKREG,BUOBR       BLOWUP AN OBR ENTRY.                 30120068
         B     M150                                                     30160068
BUOBR    MVC   13(5,OUTREG),=C'TP-OP'   MOVE THE                        30200068
         UNPK  DUBLWD,OBRCCW+5(2)       TP OP CODE                      30240068
         TR    DUBLWD,HXTOEB            TO OUTPUT AREA.                 30280068
         MVC   19(2,OUTREG),DUBLWD+5                                    30320068
         LA    15,TPOPTBL                                               30360068
         CLI   ENTRYTYP,X'34'       IS THIS A TCAM OBR?                 30400068
         BNE   O060                 NO. REG 15 POINTS AT BTAM           30440068
         L     15,=A(TCAMTPOP)      YES. POINT TO TCAM TPOP TABLE       30480068
O060     CLC   0(2,15),DUBLWD+5                                         30520068
         BE    O120                                                     30560068
         CLC   0(2,15),=X'FFFF'                                         30600068
         BE    O120                                                     30640068
         LA    15,20(15)                                                30680068
         B     O060                                                     30720068
O120     MVC   22(18,OUTREG),2(15) MOVE EXPLANATION OF TP OP CODE.      30760068
         AH    OUTREG,LINESZ       BUMP TO NEXT LINE OF OUTPUT.         30800068
O170     MVC   0(11,OUTREG),=C'DATA LENGTH'                             30840068
         UNPK  DUBLWD,OBRCCW+6(3)                                       30880068
         TR    DUBLWD,HXTOEB       MOVE DATA LENGTH.                    30920068
         MVC   12(4,OUTREG),DUBLWD+3                                    30960068
         MVC   21(14,OUTREG),=C'RESIDUAL COUNT'                         31000068
         UNPK  DUBLWD,OBRCSW+6(3)                                       31040068
         TR    DUBLWD,HXTOEB                                            31080068
         MVC   36(4,OUTREG),DUBLWD+3                                    31120068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE.            31160068
         MVC   0(15,OUTREG),=C'CHANNEL COMMAND'                         31200068
         UNPK  DUBLWD,OBRCCW(2)                                         31240068
         TR    DUBLWD,HXTOEB       MOVE THE CHANNEL COMMAND.            31280068
         MVC   16(2,OUTREG),DUBLWD+5                                    31320068
         LA    15,CCWTABL                                               31360068
         CLI   OBRUCB,X'40'     IS THIS A REMOTE?                       31400068
         BE    P070             YES. USE 270X COMMANDS.                 31440068
         L     15,=A(CCW3272)   NO. USE THE 3272 COMMANDS.              31480068
P070     CLC   0(2,15),DUBLWD+5                                         31520068
         BE    P130                                                     31560068
         CLC   0(2,15),=X'FFFF'                                         31600068
         BE    P130                                                     31640068
         LA    15,20(15)                                                31680068
         B     P070                                                     31720068
P130     MVC   19(18,OUTREG),2(15) MOVE CCW EXPLANATION.                31760068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE.            31800068
         MVC   4(5,OUTREG),=C'SENSE' MOVE SENSE & STATUS HEADERS.       31840068
         MVC   24(6,OUTREG),=C'STATUS'                                  31880068
         UNPK  DUBLWD,OBRSENSE(3)  MOVE SENSE                        XH 31920068
         TR    DUBLWD,HXTOEB       BYTES TO                          XH 31960068
         MVC   10(4,OUTREG),DUBLWD+3    OUTPUT AREA                  XH 32000068
         UNPK  DUBLWD,OBRCSW+4(3)  MOVE OBR STATUS                   XH 32040068
         TR    DUBLWD,HXTOEB       BYTES TO                          XH 32080068
         MVC   31(4,OUTREG),DUBLWD+3    OUTPUT AREA                  XH 32120068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUTLINE.             32160068
         LR    14,OUTREG           TEMPORARY POINTER TO SENSE OUTPUT.   32200068
         LH    1,LINELOOP          LIMIT DISPLAY IF MOD 1 SCREEN.       32240068
         LA    15,SENSTABL                                              32280068
         CLI   OBRUCB,X'40'        IS THIS REMOTE?                      32320068
         BE    P200                YES, USE 270X SENSE                  32360068
         L     15,=A(SENS3272)     NO, USE 3272 SENSE                   32400068
P200     MVC   DUBLWD(1),OBRSENSE  SETUP TO TEST SENSE BITS.            32440068
         NC    DUBLWD(1),0(15)                                          32480068
         CLC   DUBLWD(1),0(15)                                          32520068
         BE    Q050                                                     32560068
Q010     LA    15,19(15)           BUMP TO NEXT SLOT IN SENSE TABL.     32600068
         CLI   0(15),X'FF'                                              32640068
         BNE   P200                                                     32680068
         B     Q080                                                     32720068
Q050     MVC   0(18,14),1(15)      MOVE EXPLANATION OF 1 SENSE BIT.     32760068
         AH    14,LINESZ           BUMP TO NEXT SENSE OUTPUT AREA.      32800068
         BCT   1,Q010              ANY TIOA ROOM LEFT?                  32840068
Q080     ST    14,SAVE14                                                32880068
         LR    14,OUTREG           NO. SETUP TO LOOK AT STATUS BITS.    32920068
         LH    1,LINELOOP                                               32960068
         LA    15,CSWTABL                                               33000068
Q110     MVC   DUBLWD(2),OBRCSW+4                                       33040068
         NC    DUBLWD(2),0(15)                                          33080068
         CLC   DUBLWD(2),0(15)                                          33120068
         BE    Q180                                                     33160068
Q150     LA    15,20(15)                                                33200068
         CLI   0(15),X'FF'                                              33240068
         BNE   Q110                                                     33280068
         B     Q210                                                     33320068
Q180     MVC   20(18,14),2(15)     MOVE EXPLANATION OF 1 CSW STATUS BIT 33360068
         AH    14,LINESZ           BUMP TO NEXT OUTPUT SLOT             33400068
         BCT   1,Q150              ANY TIOA ROOM LEFT?                  33440068
Q210     C     14,SAVE14           NO.                                  33480068
         BH    R010                                                     33520068
         L     14,SAVE14           SET OUTPUT REG TO HIGHER             33560068
R010     LR    OUTREG,14           OUTPUT ADDRESS (SENSE OR STATUS).    33600068
         BR    LINKREG                                                  33640068
BUMDR    MVC   24(6,OUTREG),=C'SENSE '  MOVE SENSE HDR.                 33680068
         UNPK  DUBLWD,MDRSTATS(3)  MOVE MDR                             33720068
         TR    DUBLWD,HXTOEB       STATUS BYTES                         33760068
         MVC   31(4,OUTREG),DUBLWD+3    TO OUTPUT AREA                  33800068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE.            33840068
         LR    14,OUTREG                                                33880068
         LH    1,LINELOOP                                               33920068
         AR    1,1                 LIMIT MOD 1 TO 7 BITS MAX.           33960068
         BCTR  1,0                                                      34000068
         LA    15,STATSTBL                                              34040068
R080     MVC   DUBLWD(2),MDRSTATS  SETUP TO LOOK AT REMOTE STATUS TBL.  34080068
         NC    DUBLWD(2),0(15)                                          34120068
         CLC   DUBLWD(2),0(15)                                          34160068
         BE    R170                                                     34200068
R120     LA    15,20(15)                                                34240068
         CLI   0(15),X'FF'                                              34280068
         BNE   R080                                                     34320068
         B     R200                                                     34360068
R170     MVC   20(18,14),2(15)     MOVE EXPLANATION OF 1 REMOTE STATUS  34400068
         AH    14,LINESZ           BUMP TO NEXT OUTPUT AREA             34440068
         BCT   1,R120              ANY TIOA ROOM LEFT?                  34480068
R200     LR    OUTREG,14           NO. SETUP TO COMPUTE DATA LTH.       34520068
         BR    LINKREG             RETURN TO MAIN LINE.                 34560068
LOCATE   DFHFC TYPE=GET,DATASET=EMFILE,RDIDADR=TWAREL,NORESP=S030       34600068
         B     D090                                                     34640068
S030     L     FIOABAR,TCAFCAA     POINT TO DATA BLK.                   34680068
         LH    DATALOOP,BLKLTH     SETUP LOOP NBR BYTES THIS BLK.       34720068
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM             34760068
         SR    1,1                 PREPARE SLOT NBR FOR                 34800068
         IC    1,TWASLOT           PUTTING OUT IN DISPLAY               34840068
         BCTR  1,0                 SUB 1 FROM TWASLOT                   34880068
         STC   1,TWASLOT+3         AND STORE INTO LAST BYTE(TWASLOT)    34920068
S060     CLI   TWASLOT,2           IF RQSTED SLOT = 1, THIS IS IT.      34960068
         BL    S220                GO RESUME DISPLAY BUILDING.          35000068
         SR    1,1                                                      35040068
         IC    1,TWASLOT           DECREMENT SLOT COUNT BY 1.           35080068
         BCTR  1,0                                                      35120068
         STC   1,TWASLOT                                                35160068
         IC    1,0(DATAREG)        BUMP TO NEXT SLOT.                   35200068
         LTR   1,1                                                      35240068
         BZ    S190                PREVENT LOOP IF GARBAGE INPUT.       35280068
         AR    DATAREG,1                                                35320068
         SR    DATALOOP,1                                               35360068
         LTR   DATALOOP,DATALOOP   VERIFY SLOT NBR VALID FOR THIS BLK.  35400068
         BP    S060                                                     35440068
S190     EQU   *                                                        35480068
         MVC   TIOADBA(INVLTH),INVMSG  IF RQSTED SLOT CAN'T             35520068
         MVC   TIOATDL,=AL2(INVLTH)     BE FOUND, SEND 'SEARCH ERROR'   35560068
         B     D170                                                     35600068
S220     BR    LINKREG             RETURN TO MAIN LINE.                 35640068
GETTIOA  DFHSC TYPE=GETMAIN,CLASS=TERM,NUMBYTE=2000,INITIMG=40          35680068
         L     TIOABAR,TCASCSA     GET A NEW OUTPUT AREA BIG            35720068
         ST    TIOABAR,TCTTEDA     ENOUGH FOR A MODEL-2 DISPLAY.        35760068
         MVC   TIOADBA(HDR1LTH),HDR1                                    35800068
         MVC   TIOADBA+HDR1LTH(4),=C'3270'   SETUP 1ST LINE OF HEADER.  35840068
         LA    OUTREG,TIOADBA+HDR1LTH+4                                 35880068
         CLI   TCTTETM,C'2'        IS THIS SCREEN A MODEL 2?            35920068
         BNE   T120                NO. 1ST LINE IS OK.                  35960068
         MVC   0(3,OUTREG),HDR2    YES. ADD ANOTHER SBA TO FINISH       36000068
         LA    OUTREG,3(OUTREG)    THIS 80-CHAR LINE.                   36040068
T120     MVC   0(HDR3LTH,OUTREG),HDR3   MOVE THE 'PAGE' REQUEST LINES.  36080068
         MVC   SAVEID,=CL20' '     CLEAR CICS ID FROM SAVE AREA         36120068
         OC    TWATCTID,TWATCTID   IF NO INPUT WAS SPECIFIED,           36160068
         BZ    T130                SHOW USER HIS CICS TERML ID.         36200068
         MVC   (HDR3ID-HDR3)(8,OUTREG),=C'CICS ID '                     36240068
         MVC   (HDR3ID-HDR3+8)(4,OUTREG),TWATCTID                       36280068
         MVC   SAVEID(12),(HDR3ID-HDR3)(OUTREG)                         36320068
T130     ST    OUTREG,TWAOUT       SAVE THIS ADDR TO FILL IN BLK NBRS.  36360068
         LA    OUTREG,HDR3LTH(OUTREG)                                   36400068
         MVC   0(HDR4LTH,OUTREG),HDR4   MOVE THE RECAP LINE HDR.        36440068
         OC    PARM5,PARM5         IF NO TERM ADDR INPUT, SHOW ONLY LIN 36480068
         BZ    T150                                                     36520068
         MVC   (HDR4TERM-HDR4)(2,OUTREG),PARM5   FILL IN THE            36560068
         MVC   (HDR4CTRL-HDR4)(2,OUTREG),PARM4    ID OF THIS TERML      36600068
T150     EQU   *                                                        36640068
         MVC   (HDR4LINE-HDR4)(3,OUTREG),PARM3    CTRL UNIT, AND LINE.  36680068
         CLC   (HDR4TERM-HDR4)(2,OUTREG),=C'  '  IS TERML BLANK?        36720068
         BNE   T160                      NO. LET IT GO.                 36760068
         MVC   8(6,OUTREG),=C'LOCAL '    YES, CHANGE TO                 36800068
         MVC   14(3,OUTREG),PARM3        LOCAL FORMAT.                  36840068
         MVC   17(24,OUTREG),=24C' '                                    36880068
T160     EQU   *                                                        36920068
         LA    OUTREG,HDR4LTH(OUTREG)                                   36960068
         CLI   TCTTETM,C'2'        IS THIS A BIG SCREEN?                37000068
         BNE   T170                NO. THIS LINE IS OK.                 37040068
         MVC   0(3,OUTREG),HDR5    YES. ADD ANOTHER SBA TO              37080068
         LA    OUTREG,3(OUTREG)    GET US PAST 40 MORE CHARS.           37120068
T170     MVC   0(HDR6LTH,OUTREG),HDR6   MOVE COLUMN HEADERS.            37160068
         LA    OUTREG,HDR6LTH(OUTREG)                                   37200068
         LA    OUTLOOP,7           SETUP TO SHOW 7 ITEMS ON MOD 1.      37240068
         CLI   TCTTETM,C'2'        IS THIS A BIG SCREEN?                37280068
         BNE   T180                NO. RETURN TO MAIN LINE.             37320068
         MVC   0(HDR6LTH,OUTREG),HDR6   YES. MOVE ANOTHER COLUMN HDR.   37360068
         LA    OUTREG,HDR6LTH(OUTREG)                                   37400068
         LA    OUTLOOP,40          SETUP TO SHOW 40 ITEMS ON MOD 2.     37440068
T180     BR    LINKREG             RETURN TO MAIN LINE.                 37480068
T190     DFHSC TYPE=GETMAIN,CLASS=TERM,NUMBYTE=256,INITIMG=40  @OZ31885 37484007
         L     TIOABAR,TCASCSA          GET DATA AREA          @OZ31885 37488007
         ST    TIOABAR,TCTTEDA          POINT TO MSG TO WRITE  @OZ31885 37492007
         MVC   TIOADBA(MSG13LTH),MSG13  MOVE IN THE MSG        @OZ31885 37496007
         MVC   TIOATDL,=AL2(MSG13LTH)   MOVE IN THE LENGTH     @OZ31885 37500007
         MVC   TIOADBA+(MSG13LN-MSG13)(3),SAVELINE GET LINE NO.@OZ31885 37504007
         DFHTC TYPE=(WRITE,ERASE)                              @OZ31885 37508007
         DFHPC TYPE=RETURN                                     @OZ31885 37512007
HDR1     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF'                   37520068
         DC    AL1(SF,UNA,IC),AL1(SBA),AL2(L1P36),AL1(SF,MNP)           37560068
HDR1LTH  EQU   *-HDR1                                                   37600068
HDR2     DC    AL1(SBA),AL2(L2P1)                                       37640068
HDR3     DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'?'                        37680068
         DC    AL1(SF,PNA),C') PAGE FORWARD     '                       37720068
HDR3ID   DC    C'                '                                      37760068
         DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'?'                        37800068
         DC    AL1(SF,PNA),C') PAGE BACKWRD'                            37840068
         DC    AL1(SF,PIA)                                              37880068
BBBSS    DC    C'BBBSSBBBSSBBBSS',AL1(SF,PNA),C'    '                   37920068
HDR3LTH  EQU   *-HDR3                                                   37960068
HDR4     DC    AL1(SF,PNA),C'RECAP REMOTE '                          XH 38000068
HDR4TERM DC    CL2'  ',C' ON CU '                                    XH 38040068
HDR4CTRL DC    CL2'  ',C' ON LINE '                                  XH 38080068
HDR4LINE DC    CL3'999',C'  '                                        XH 38120068
HDR4LTH  EQU   *-HDR4                                                XH 38160068
HDR5     DC    AL1(SBA),AL2(L4P1)                                    XH 38200068
HDR6     DC    AL1(SF,PNA),C'      FILE#  TIME SENSE STATUS TPOP CMD'   38240068
HDR6LTH  EQU   *-HDR6                                                XH 38280068
IOERRMSG DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC) XH 38320068
         DC    CL34' ',AL1(SF,PNA),CL39' '                           XH 38360068
         DC    CL39'BNG013A C I/O ERR READING SYS1.DEMFLOG '   @OX21950 38400007
         DC    CL28'  THE CICS RESPONSE CODE IS '              @OX21950 38430007
IOCODE   DC    CL4'00  '                                       @OX21950 38460007
         DC    CL9' '                                                XH 38520068
         DC    CL34'THE BDAM RELATIVE BLOCK NUMBER IS '              XH 38560068
IOBLOCK  DC    CL3'000'                                              XH 38600068
IOERRLTH EQU   *-IOERRMSG                                            XH 38640068
MSG11LG  DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC) XH 38680068
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                        XH 38720068
         DC    C'BNG011I C NO ERRORS RECORDED FOR REMOTE'            XH 38760068
         DC    AL1(SBA),AL2(L3P1LG),AL1(SF,PNA)                      XH 38800068
         DC    CL9'TERMINAL '                                        XH 38840068
M11LGTRM DC    CL2' '                                                XH 38880068
         DC    CL20'       ON CTRL UNIT '                            XH 38920068
M11LGCU  DC    CL2' '                                                XH 38960068
         DC    AL1(SBA),AL2(L4P1),AL1(SF,PNA)                        XH 39000068
         DC    CL8'ON LINE '                                         XH 39040068
M11LGLN  DC    CL3' '                                                XH 39080068
         DC    CL8' '                                                XH 39120068
M11LGID  DC    CL20' '         CICS SYMBOLIC NAME                    XH 39160068
M11LGLTH EQU   *-MSG11LG                                             XH 39200068
MSG11SM  DC    AL1(SBA),AL2(L1P1SM),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)  39240068
         DC    AL1(SBA),AL2(L2P1SM),AL1(SF,PNA)                         39280068
         DC    C'BNG011I C NO ERRORS RECORDED FOR REMOTE'            XH 39320068
         DC    AL1(SBA),AL2(L3P1SM),AL1(SF,PNA)                         39360068
         DC    CL9'TERMINAL '                                        XH 39400068
M11SMTRM DC    CL2' '                                                XH 39440068
         DC    CL20'       ON CTRL UNIT '                            XH 39480068
M11SMCU  DC    CL2' '                                                XH 39520068
         DC    AL1(SBA),AL2(L4P1SM),AL1(SF,PNA)                         39560068
         DC    CL8'ON LINE '                                         XH 39600068
M11SMLN  DC    CL3' '                                                XH 39640068
         DC    CL8' '                                                XH 39680068
M11SMID  DC    CL20' '         CICS SYMBOLIC NAME                    XH 39720068
M11SMLTH EQU   *-MSG11SM                                             XH 39760068
MSG12LG  DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC) XH 39800068
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                        XH 39840068
         DC    C'BNG012I C NO ERRORS RECORDED FOR LOCAL '            XH 39880068
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                        XH 39920068
         DC    CL9'TERMINAL '                                        XH 39960068
M12LGTRM DC    CL3' '                                                XH 40000068
         DC    CL7' '                                                XH 40040068
M12LGID  DC    CL20' '         CICS SYMBOLIC NAME                    XH 40080068
M12LGLTH EQU   *-MSG12LG                                             XH 40120068
MSG12SM  DC    AL1(SBA),AL2(L1P1SM),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)  40160068
         DC    AL1(SBA),AL2(L2P1SM),AL1(SF,PNA)                         40200068
         DC    C'BNG012I C NO ERRORS RECORDED FOR LOCAL '            XH 40240068
         DC    AL1(SBA),AL2(L3P1SM),AL1(SF,PNA)                         40280068
         DC    CL9'TERMINAL '                                        XH 40320068
M12SMTRM DC    CL3' '                                                XH 40360068
         DC    CL7' '                                                XH 40400068
M12SMID  DC    CL20' '         CICS SYMBOLIC NAME                    XH 40440068
M12SMLTH EQU   *-MSG12SM                                             XH 40480068
MDRHDR   DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'? ) '                     40520068
MDRBBBSS DC    CL5'BBBSS',AL1(SF,PNA)                                   40560068
MDRHRS   DC    CL2'24',C':'                                             40600068
MDRMINS  DC    CL2'60',C'  '                                            40640068
MDRSTAT  DC    CL4'XXXX',C'   '                                         40680068
OBRSNS   DC    CL4'    ',C'  '                                          40720068
OBRTPOP  DC    CL2'  ',C'  '                                            40760068
OBRCMD   DC    CL2'  ',C' '                                             40800068
MDRLTH   EQU   *-MDRHDR                                                 40840068
BUHDR1   DC    AL1(SBA),AL2(L1P7),AL1(IC)                               40880068
         DC    AL1(SBA),AL2(L3P39),AL1(SF,PIA),C'%',AL1(SBA),AL2(L5P1)  40920068
         DC    X'3CC75F40',AL1(SBA),AL2(L5P1)                           40960068
BUHDR1LT EQU   *-BUHDR1                                                 41000068
BUHDR2   DC    AL1(SBA),AL2(L1P7),AL1(IC)                               41040068
         DC    AL1(SBA),AL2(L2P79),AL1(SF,PIA),C'%',AL1(SBA),AL2(L4P1)  41080068
         DC    X'3C5D7F40',AL1(SBA),AL2(L4P1)                           41120068
BUHDR2LT EQU   *-BUHDR2                                                 41160068
INVMSG   DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC) XH 41200068
         DC    XL34'00',AL1(SBA),AL2(L2P1),AL1(SF,PNA)               XH 41240068
         DC    CL39'BNG005I C ERROR NOT FOUND ON FILE FOR '          XH 41280068
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                        XH 41320068
         DC    C'THE SELECTED ITEM '                                 XH 41360068
INVLTH   EQU   *-INVMSG                                                 41400068
MSG13    DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    41404007
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                  @OZ31885 41408007
         DC    CL39'BNG013A C NO DATA BLOCKS AVAILABLE FOR '   @OZ31885 41412007
         DC    CL5'LINE '                                      @OZ31885 41416007
MSG13LN  DC    CL3' '                                          @OZ31885 41420007
         DC    CL31':  DATA BASE IN DEGRADED MODE. '           @OZ31885 41424007
         DC    CL39' MUST ALLOCATE MORE BLOCKS THAN LINES'     @OZ31885 41428007
MSG13LTH EQU   *-MSG13                                         @OZ31885 41432007
         LTORG                                                          41440068
CALENDAR DC    C'JAN',PL2'31'                                           41480068
         DC    C'FEB',PL2'28'                                           41520068
         DC    C'MAR',PL2'31'                                           41560068
         DC    C'APR',PL2'30'                                           41600068
         DC    C'MAY',PL2'31'                                           41640068
         DC    C'JUN',PL2'30'                                           41680068
         DC    C'JUL',PL2'31'                                           41720068
         DC    C'AUG',PL2'31'                                           41760068
         DC    C'SEP',PL2'30'                                           41800068
         DC    C'OCT',PL2'31'                                           41840068
         DC    C'NOV',PL2'30'                                           41880068
         DC    C'DEC',PL2'31'                                           41920068
LEAPTBL  DC    X'768084889296FF'                                        41960068
EBTOHX   DC    X'00000000000000000000000000000000'     00-0F  THIS      42000068
         DC    X'00000000000000000000000000000000'     10-1F  TABLE     42040068
         DC    X'00000000000000000000000000000000'     20-2F  CONVERTS  42080068
         DC    X'00000000000000000000000000000000'     30-3F  INPUT     42120068
         DC    X'00000000000000000000000000000000'     40-4F  A THRU F  42160068
         DC    X'000000000000000000000000FF000000'     50-5F    TO      42200068
         DC    X'00000000000000000000000000000000'     60-6F  0A - 0F   42240068
         DC    X'00000000000000000000000000000000'     70-7F   AND      42280068
         DC    X'00000000000000000000000000000000'     80-8F  F0 - F9   42320068
         DC    X'00000000000000000000000000000000'     90-9F    TO      42360068
         DC    X'00000000000000000000000000000000'     A0-AF  00 - 09   42400068
         DC    X'00000000000000000000000000000000'     B0-BF    AND     42440068
         DC    X'000A0B0C0D0E0F000000000000000000'     C0-CF     *      42480068
         DC    X'00000000000000000000000000000000'     D0-DF   BECOME   42520068
         DC    X'00000000000000000000000000000000'     E0-EF    FF.     42560068
         DC    X'00010203040506070809000000000000'     F0-FF            42600068
HXTOEB   DC    4XL16'00',C' ',XL15'00',7XL16'00'  THIS TABLE CONVERTS   42640068
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  HEX CHARS           42680068
         DC    2XL16'00'                CHARS FA-THRU-FF BACK           42720068
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  A THRU F            42760068
CCWTABL  DC    CL20'00TEST IO'                                          42800068
         DC    CL20'01WRITE'                                            42840068
         DC    CL20'02READ'                                             42880068
         DC    CL20'03NO OP'                                            42920068
         DC    CL20'04SENSE'                                            42960068
         DC    CL20'05TEST WRITE'                                       43000068
         DC    CL20'06READ PREPARE'                                     43040068
         DC    CL20'07STEP COUNT'                                       43080068
         DC    CL20'09WRITE POLL'                                       43120068
         DC    CL20'0AREAD INHIBIT'                                     43160068
         DC    CL20'0DWRITE BREAK'                                      43200068
         DC    CL20'0EREAD SEARCH'                                      43240068
         DC    CL20'11WRITE W/TIME OUT'                                 43280068
         DC    CL20'12TEST READ'                                        43320068
         DC    CL20'13SAD ZERO'                                         43360068
         DC    CL20'15WRAP'                                             43400068
         DC    CL20'17SAD ONE'                                          43440068
         DC    CL20'19POLL SOH'                                         43480068
         DC    CL20'1BSAD TWO'                                          43520068
         DC    CL20'1DDIAGNOSTIC POLL'                                  43560068
         DC    CL20'1EADDRESS PREPARE'                                  43600068
         DC    CL20'1FSAD THREE'                                        43640068
         DC    CL20'23SET MODE'                                         43680068
         DC    CL20'27ENABLE'                                           43720068
         DC    CL20'29WRITE DIAL'                                       43760068
         DC    CL20'2FDISABLE'                                          43800068
         DC    CL20'33TEST SYNC'                                        43840068
         DC    CL20'37SEND EOT'                                         43880068
         DC    CL20'3BSEND INQUIRY'                                     43920068
         DC    CL20'41WRITE BREAK'                                      43960068
         DC    CL20'42READ CLEAR'                                       44000068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           44040068
TPOPTBL  DC    CL20'00ON LINE TEST'                                     44080068
         DC    CL20'01DISABLE'                                          44120068
         DC    CL20'02WRITE EOA EOT EOT'                                44160068
         DC    CL20'03WRT POLL/ADDR CHRS'                               44200068
         DC    CL20'04WRITE SPACE'                                      44240068
         DC    CL20'05RD RSP TO POLLING'                                44280068
         DC    CL20'06RD RSP TO ADDRESSING'                             44320068
         DC    CL20'07READ ID RESPONSE'                                 44360068
         DC    CL20'08WRITE EOA'                                        44400068
         DC    CL20'09NOP OR TIC'                                       44440068
         DC    CL20'0AREAD INDEX'                                       44480068
         DC    CL20'0BREAD INQUIRY'                                     44520068
         DC    CL20'0CRD RSP TO INQUIRY'                                44560068
         DC    CL20'10WRT LINE ADDRESS'                                 44600068
         DC    CL20'11RD OR WRT TEXT'                                   44640068
         DC    CL20'12RD SKIP OR TIC'                                   44680068
         DC    CL20'13WRITE DLE ETX'                                    44720068
         DC    CL20'20RD RSP TO TEXT'                                   44760068
         DC    CL20'21ALL RESET COMMANDS'                               44800068
         DC    CL20'22READ SKIP'                                        44840068
         DC    CL20'23WRITE BREAK'                                      44880068
         DC    CL20'24OPEN LOPEN CLOSE'                                 44920068
         DC    CL20'25RD RSP TO TEXT'                                   44960068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           45000068
CSWTABL  DC    B'1000000000000000',CL18'ATTENTION'                      45040068
         DC    B'0100000000000000',CL18'STATUS MODIFIER'                45080068
         DC    B'0010000000000000',CL18'CTRL UNIT END'                  45120068
         DC    B'0001000000000000',CL18'BUSY'                           45160068
         DC    B'0000100000000000',CL18'CHANNEL END'                    45200068
         DC    B'0000010000000000',CL18'DEVICE END'                     45240068
         DC    B'0000001000000000',CL18'UNIT CHECK'                     45280068
         DC    B'0000000100000000',CL18'UNIT EXCEPTION'                 45320068
         DC    B'0000000010000000',CL18'PGRM CTRLD INTRPT'              45360068
         DC    B'0000000001000000',CL18'INCORRECT LENGTH'               45400068
         DC    B'0000000000100000',CL18'PROGRAM CHECK'                  45440068
         DC    B'0000000000010000',CL18'PROTECTION CHECK'               45480068
         DC    B'0000000000001000',CL18'CHANL DATA CHECK'               45520068
         DC    B'0000000000000100',CL18'CHANL CTRL CHECK'               45560068
         DC    B'0000000000000010',CL18'INTFACE CTRL CK'                45600068
         DC    B'0000000000000001',CL18'CHAINING CHECK'                 45640068
         DC    X'FF'                                                    45680068
SENSTABL DC    B'10000000',CL18'COMMAND REJECT'                         45720068
         DC    B'01000000',CL18'INTERVENTION REQD'                      45760068
         DC    B'00100000',CL18'BUS OUT CHECK'                          45800068
         DC    B'00010000',CL18'EQUIPMENT CHECK'                        45840068
         DC    B'00001000',CL18'DATA CHECK'                             45880068
         DC    B'00000100',CL18'OVERRUN'                                45920068
         DC    B'00000010',CL18'LOST DATA'                              45960068
         DC    B'00000001',CL18'TIMEOUT'                                46000068
         DC    X'FF'                                                    46040068
STATSTBL DC    B'0010000000000000',CL18'RESERVED'                       46080068
         DC    B'0001000000000000',CL18'RESERVED'                       46120068
         DC    B'0000100000000000',CL18'DEVICE BUSY'                    46160068
         DC    B'0000010000000000',CL18'UNIT SPECIFY'                   46200068
         DC    B'0000001000000000',CL18'DEVICE END'                     46240068
         DC    B'0000000100000000',CL18'TRANSMISSION CHECK'             46280068
         DC    B'0000000000100000',CL18'COMMAND REJECT'                 46320068
         DC    B'0000000000010000',CL18'INTERVENTION REQD'              46360068
         DC    B'0000000000001000',CL18'EQUIPMENT CHECK'                46400068
         DC    B'0000000000000100',CL18'DATA CHECK'                     46440068
         DC    B'0000000000000010',CL18'CONTROL CHECK'                  46480068
         DC    B'0000000000000001',CL18'OPERATION CHECK'                46520068
         DC    X'FF'                                                    46560068
SENS3272 DC B'10000000',CL18'COMMAND REJECT'                            46600068
         DC B'01000000',CL18'INTERVENTION REQD'                         46640068
         DC B'00100000',CL18'BUS OUT CHECK'                             46680068
         DC B'00010000',CL18'EQUIPMENT CHECK'                           46720068
         DC B'00001000',CL18'DATA CHECK'                                46760068
         DC B'00000100',CL18'UNIT SPECIFY'                              46800068
         DC B'00000010',CL18'CONTROL CHECK'                             46840068
         DC B'00000001',CL18'OPERATION CHECK'                           46880068
         DC    X'FF'                                                    46920068
CCW3272  DC    CL20'01WRITE'                                            46960068
         DC    CL20'05ERASE WRITE'                                      47000068
         DC    CL20'02READ BUFFER'                                      47040068
         DC    CL20'06READ MODIFIED'                                    47080068
         DC    CL20'0BSELECT'                                           47120068
         DC    CL20'0FERASE ALL PROTECTD'                               47160068
         DC    CL20'03NO OP'                                            47200068
         DC    CL20'04SENSE'                                            47240068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           47280068
PATCH    DS    20F                                             @OX21950 47300007
TCAMTPOP DC    CL20'01WRT EOT FOR SELECT'                               47320068
         DC    CL20'02OPEN TP OP CODE'                                  47360068
         DC    CL20'03WRITE POLL CHARS'                                 47400068
         DC    CL20'04RD RSPNS TO POLL'                                 47440068
         DC    CL20'05WRITE PAD CHARS'                                  47480068
         DC    CL20'06ENABLE DIAL LINE'                                 47520068
         DC    CL20'07WRT ADDR SEQUENCE'                                47560068
         DC    CL20'08READ RSPNS TO ADDR'                               47600068
         DC    CL20'09WRITE EOA SEQUENCE'                               47640068
         DC    CL20'0ARD RSPNS EOB/ETB'                                 47680068
         DC    CL20'0BWRITE CPU ID'                                     47720068
         DC    CL20'0CREAD ENQ'                                         47760068
         DC    CL20'0DWRITE ENQ'                                        47800068
         DC    CL20'0ERD RSPNS TO ENQ'                                  47840068
         DC    CL20'0FWRITE DLE EOT'                                    47880068
         DC    CL20'10READ ID (TSO)'                                    47920068
         DC    CL20'11NON-R/W CCW'                                      47960068
         DC    CL20'12WRITE BREAK (TSO)'                                48000068
         DC    CL20'13WRT ENQ AFTER SEL'                                48040068
         DC    CL20'14READ LCOUT'                                       48080068
         DC    CL20'15WRT RSP BEFOR TXT'                                48120068
         DC    CL20'16WRITE RESPONSE'                                   48160068
         DC    CL20'17WRITE TONE'                                       48200068
         DC    CL20'18BSC READ ID ENQ'                                  48240068
         DC    CL20'1ABSC READ ID ACK'                                  48280068
         DC    CL20'1CABORT SEND/RECIEV'                                48320068
         DC    CL20'1EREAD TWX ID'                                      48360068
         DC    CL20'20BUF TRM RESET BLK'                                48400068
         DC    CL20'22CLOSE SDR RECRDNG'                                48440068
         DC    CL20'24WRT RESET AFT SEL'                                48480068
         DC    CL20'51READ SKIP LOOP'                                   48520068
         DC    CL20'53WRT IDLES LOOP'                                   48560068
         DC    CL20'57WRT DLE STX'                                      48600068
         DC    CL20'59WRT DLE ETB(ETX)'                                 48640068
         DC    CL20'5BWRT ENQ RSP TO TXT'                               48680068
         DC    CL20'FFTEXT CCW'                                         48720068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           48760068
         END   BNGC3270                                                 48800068
./  ADD  SSI=81180056,NAME=BNGIDISP
         PRINT OFF                                                      00050007
         MACRO                                                          00050407
&NAME    BNGHJN &LABEL,&HJN                                             00050807
         LCLC  &HJA,&HJB                                                00051207
&HJA     SETC  '&SYSPARM'(1,4)                                          00051607
&HJB     SETC  '&SYSPARM'(5,4)                                          00052007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00052407
         B     &LABEL .                 BR AROUND CONSTANTS             00052807
         SPACE 2                                                        00053207
.NOBRNCH ANOP                                                           00053607
         AIF   ('&NAME' EQ '').NOLABEL                                  00054007
         DC    C'&NAME' .              MODULE IDENTIFIER                00054407
.NOLABEL ANOP                                                           00054807
         DC    X'&HJA' .                DATE OF MODIFICATION            00055207
         AIF   ('&HJN' NE 'HJN').DATE                                   00055607
         DC    X'&HJB' .                HJN OF MODIFICATION             00056007
.DATE    ANOP                                                           00056407
         AIF   ('&LABEL' EQ '').NOLBL                                   00056807
         SPACE 2                                                        00057207
&LABEL   DS    0H                                                       00057607
.NOLBL   ANOP                                                           00058007
         MEND                                                           00058407
         PRINT ON                                                       00058807
*********************************************************************** 00059207
*                                                                     * 00100000
* MODULE NAME = BNGIDISP                                              * 00150000
*                                                                     * 00200000
* DESCRIPTIVE NAME =  IMS DEMF DISPLAY CONTROL MODULE                 * 00250000
*                                                                     * 00300000
* COPYRIGHT = NONE                                                    * 00350000
*                                                                     * 00400000
* STATUS = RELEASE 1, LEVEL 1                                         * 00450000
*                                                                     * 00500000
* FUNCTION = 1) READS INPUT MESSAGE FROM IMS MESSAGE QUEUE;           * 00550000
*            2) EDITS THE INPUT INTO 6 PARM FIELDS WITH LEFT JUSTIFY; * 00600000
*            3) DOES SYNTAX CHECK ON DEMF COMMANDS AND PARAMETERS;    * 00650000
*            4) DETERMINES WHETHER THE REQUEST IS FOR MENU,REMOTE,    * 00700000
*               LOCAL OR 3270 SCREEN ERROR DISPLAY AND LINKS          * 00750000
*               TO BNGTMENU,BNGTRMOT,BNGTLOCL OR BNGT3270 SEGMENT     * 00800000
*               ACCORDINGLY WITH PARAMETERS;                          * 00850000
*            5) HANDLES ALL,LINE AND CTRL ERROR DISPLAY REQUEST AND   * 00900000
*               WRITES ITS ERROR INFORMATION TO THE 3270 DISPLAY      * 00950000
*               TERMINAL AND ISSUES SOME OF THE DISPLAY MESSAGES;     * 01000000
*            6) LINKS TO BNGIREAD TO READ SYS1.DEMFLOG FOR ALL,LINE,  * 01050000
*               CTRL ERROR DISPLAY REQUESTS;                          * 01100000
*            7) WHEN THE INPUT MESSAGE HAS BEEN PROCESSED, BNGIDISP   * 01150000
*               READS ANOTHER MESSAGE. THIS PROCESS CONTINUES UNTIL   * 01200000
*               THE MESSAGE QUEUE IS EXHAUSTED. THEN BNGIDISP RETURNS * 01250000
*               CONTROL TO IMS.                                       * 01300000
*                                                                     * 01350000
* NOTES = NONE                                                        * 01400000
*                                                                     * 01450000
*    DEPENDENCIES = NONE                                              * 01500000
*                                                                     * 01550000
*    RESTRICTIONS = NONE                                              * 01600000
*                                                                     * 01650000
*    REGISTER CONVENTIONS :                                           * 01700000
*    --------------------                                             * 01750000
*                                                                     * 01800000
*    ALL DEMF RECORDING DISPLAY COMPONENTS USE STANDARD REGISTER      * 01850000
*    CONVENTIONS WITH THE EXCEPTION OF THE IMS DISPLAY COMPONENTS.    * 01900000
*    CERTAIN IMS MODULES USE ADDITIONAL REGISTERS AND THE LINK MACRO  * 01950000
*    FOR PASSING OR RETRIEVING DATA PARAMETER INFORMATION AND ARE     * 02000000
*    DETAILED BELOW:                                                  * 02050000
*                                                                     * 02100000
*     MODULE    REGISTER    CONTENTS.                                 * 02150000
*    --------   --------    ------------------------------------      * 02200000
*    BNGIDISP     R5        PASSES ADDRESS OF IMS PROGRAM             * 02250000
*                           COMMUNICATION BLOCK (PCB) TO              * 02300000
*                           BNGI3270, BNGIMENU, BNGILOCL, AND         * 02350000
*                           BNGIRMOT.                                 * 02400000
*                                                                     * 02450000
*                 R11       PASSES TO BNGIREAD THE ADDRESS OF A       * 02500000
*                           PARAMETER LIST CONTAINING:                * 02550000
*                                                                     * 02600000
*                          1) 4-BYTES - ADDRESS OF I/O AREA FROM      * 02650000
*                                       BNGIREAD                      * 02700000
*                                                                     * 02750000
*                          2) 3-BYTES - RELATIVE BLOCK ADDRESS TO     * 02800000
*                                       BE READ BY BNGIREAD           * 02850000
*                                                                     * 02900000
*                          3) 2-BYTES - STATUS OF READ FROM           * 02950000
*                                       BNGIREAD                      * 03000000
*                                                                     * 03050000
*                 R12      FOR BNGI3270, PASSES THE ADDRESS OF A      * 03100000
*                          COMMUNICATION AREA CONTAINING              * 03150000
*                          UP TO SIX EDITTED PARM FIELDS, SAVE        * 03200000
*                          AND WORK AREAS, AND THE INPUT MESSAGE.     * 03250000
*                                                                     * 03300000
*                          FOR BNGILOCL, BNGIRMOT, AND BNGIMENU;      * 03350000
*                          PASSES THE ADDRESS OF THE INPUT MESSAGE.   * 03400000
*                                                                     * 03450000
*    BNGIREAD    LINK TO BNGIDCBA       RETRIEVES THE ADDRESS OF THE  * 03500000
*                (ALIAS FOR BNGISIMS)   ADDRESS OF THE SYS1.DEMFLOG   * 03550000
*                                       DCB.                          * 03600000
*                                                                     * 03650000
*                 R11      RECEIVES ADDRESS OF PARAMETER LIST         * 03700000
*                          (SEE BNGIDISP R11 FOR LIST).               * 03750000
*                                                                     * 03800000
*    BNGI3270     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 03850000
*                                                                     * 03900000
*                 R11     PASSES TO BNGIREAD THE ADDRESS OF A         * 03950000
*                         PARAMETER LIST (SEE BNGIDISP R11 FOR LIST)  * 04000000
*                                                                     * 04050000
*                 R12     RECEIVES FROM BNGIDISP THE ADDRESS OF THE   * 04100000
*                         COMMUNICATION AREA (SEE BNGIDISP R12 FOR    * 04150000
*                         CONTENTS OF AREA).                          * 04200000
*                                                                     * 04250000
*    BNGIMENU     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 04300000
*                                                                     * 04350000
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 04400000
*                         BNGIDISP.                                   * 04450000
*                                                                     * 04500000
*    BNGILOCL     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 04550000
*                                                                     * 04600000
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 04650000
*                         BNGIDISP.                                   * 04700000
*                                                                     * 04750000
*    BNGIRMOT     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 04800000
*                                                                     * 04850000
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 04900000
*                         BNGIDISP.                                   * 04950000
*                                                                     * 05000000
*                                                                     * 05050000
*    PATCH LABEL = NONE                                               * 05100000
*                                                                     * 05150000
* MODULE TYPE = IMS DISPLAY CONTROL                                   * 05200000
*                                                                     * 05250000
*    PROCESSOR = ASSEMBLER H                                          * 05300000
*                                                                     * 05350000
*    MODULE SIZE = 9047 DECIMAL BYTES                                 * 05400000
*                                                                     * 05450000
*    ATTRIBUTES = SERIALLY REUSABLE                                   * 05500000
*                                                                     * 05550000
* ENTRY POINT = BNGIDISP                                              * 05600000
*                                                                     * 05650000
*    PURPOSE = SEE FUNCTION                                           * 05700000
*                                                                     * 05750000
*    LINKAGE = R1  LOADED WITH THE PARAM LIST POINTER                 * 05800000
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 05850000
*              R15 LOADED WITH ENTRY POINT                            * 05900000
*                                                                     * 05950000
* INPUT = PARAM LIST ITEMS USED ARE :  MSGIN  (LABEL)                 * 06000000
*                                                                     * 06050000
* OUTPUT = PARAM LIST ITEMS USED ARE : MSGOUT (LABEL)                 * 06100000
*                                                                     * 06150000
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 06200000
*               00 - OPERATION PERFORMED AS REQUESTED                 * 06250000
*                                                                     * 06300000
* EXIT-ERROR  = NONE                                                  * 06350000
*                                                                     * 06400000
* EXTERNAL REFERENCE = BNGILOCL,BNGIRMOT,BNGIMENU,BNGI3270 & BNGIREAD * 06450000
*                                                                     * 06500000
*    ROUTINES = LOCATE ROUTINE                                        * 06550000
*               MOD1SCAN ROUTINE                                      * 06600000
*               MOD1 TABLE BUILD (AT LABEL S215) ROUTINE              * 06650000
*                                                                     * 06700000
*    DATA AREAS = NONE                                                * 06750000
*                                                                     * 06800000
*    CONTROL BLOCK = NONE                                             * 06850000
*                                                                     * 06900000
* TABLES = TABLE    - FUNCTION/COMPANION TABLE                        * 06950000
*          MOD1TAB  - 3277 MODEL 1 TABLE                              * 07000000
*          HXTOEB   - HEX CHARS TO EBCDIC CHARS TABLE                 * 07050000
*          EBTOHX   - EBCDIC CHARS TO HEX CHARS TABLE                 * 07100000
*          LOTOUP   - LOWER TO UPPER CASE CHARS TABLE                 * 07150000
*                                                                     * 07200000
* MACROS = SAVE, RETURN, CALL(FOR GET/PUT MSG), ABEND                 * 07250000
*          (HARD CODED LINK)                                          * 07300000
*                                                                     * 07350000
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 07400000
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 07400107
* CHANGE 02  02/22/77  BNGHJN MACRO ADDED                             * 07400207
*D122000,128500-129000                                         @OZ29912 07400307
*C181500                                                       @OZ29912 07400407
*A123500,614000,635000                                         @OZ29912 07400507
*A489500                                                       @OZ31883 07400607
*D417500-418500                                                @OZ31879 07400707
*C420000-421000,505500-506000,553000-554000,555500-559000      @OZ31879 07400807
*C560500-563000                                                @OZ31879 07400907
*A373500,614200,635400                                         @OZ31886 07401007
*                                                                     * 07500000
*********************************************************************** 07550000
*********************************************************************** 07600000
*                                                                     * 07650000
BNGIDISP TITLE 'DISPLAY AUDITS INPUT AND DISPLAYS ALL LINES,LINE, CTRL' 07700000
*                                                                     * 07750000
*********************************************************************** 07800000
         SPACE                                                          07850000
PCB      DSECT                 MAP OF IMS PROGRAM COMMUNICATION BLOCK   07900000
         USING *,PCBREG                                                 07950000
PCBTERMN DS    CL8                 REQUESTING TERMINAL SYMBOLIC NAME    08000000
         DS    CL2                 RESERVED                             08050000
PCBSTAT  DS    CL2                 DL/I STATUS CODE                     08100000
PCBDATE  DS    PL4                 TRANSACTION DATE STAMP 00YYDDDF      08150000
PCBTIME  DS    PL4                 TRANSACTION TIME STAMP HHMMSSTH      08200000
PCBSEQ   DS    F                   TRANSACTION SEQUENCE NUMBER          08250000
PCBMODNM DS    CL8                 MFS MESSAGE OUTPUT DESCRIPTOR NAME   08300000
FIOADBA  DSECT                                                          08350000
         USING *,FIOABAR                                                08400000
CTRLLAST DS    F                   LAST USED ADDR IN DATASET            08450000
CTRLTOTL DS    F                   TOTAL BLOCKS IN DATASET              08500000
CTRLBACK DS    F                   BACKWARD PTR IN CTRL BLK CHAIN       08550000
CTRLFWD  DS    F                   FORWARD PTR IN CTRL BLK CHAIN        08600000
CTRLENTS DS    C                   NBR ENTRIES IN THIS CTRL BLK         08650000
         DS    CL15                FOR FUTURE USE                       08700000
CTRLSLT1 DS    0C                  START OF CTRL SLOT NBR ONE.          08750000
         ORG   FIOADBA                                                  08800000
DATAPORT DS    CL6                 PORT & LIB ADDR                      08850000
DATATIME DS    CL4                 TIME BLOCK CREATED                   08900000
DATADATE DS    CL4                 DATE BLOCK CREATED                   08950000
DATAFWD  DS    CL3                 FORWARD CHAIN ADDR                   09000000
DATABACK DS    CL3                 BACKWAD CHAIN ADDR                   09050000
BLKLTH   DS    CL2                 NBR BYTES USED IN THIS BLOCK         09100000
         DS    CL10                                                     09150000
DATASLT1 DS    0C                  START OF 1ST DATA SLOT               09200000
SLOTS    DSECT           MAP OF ENTRIES IN CONTROL BLOCK                09250000
         USING *,DATAREG                                                09300000
SLOTLINE DS    CL6                CHANNEL ADDRESS(PORT OR LIB)          09350000
SLOTNBC  DS    CL2                NUMBER OF BLOCKS IN THIS CHAIN        09400000
SLOTHITS DS    CL2                TOTAL HITS ON THIS LINE               09450000
SLOTRFB  DS    CL3                RELATIVE ADDRESS FIRST BLOCK IN CHAIN 09500000
SLOTRLB  DS    CL3                RELATIVE ADDRESS LAST BLOCK IN CHAIN  09550000
SLOTLTH  EQU   *-SLOTS                                                  09600000
         ORG   SLOTS         MAP OF MDR AND OBR IN DETAIL BLOCKS        09650000
DATALTH  DS    C                   LTH OF THIS SLOT                     09700000
LINEIDA  DS    CL6                 LINE AND LIB ADDR                    09750000
ENTRYTYP DS    C                   ENTRY TYPE - MDR OR OBR              09800000
         DS    CL3                                                      09850000
MDRTYPE  DS    C                   TYPE HDWE - 03 EQUALS 3270           09900000
         DS    CL3                                                      09950000
DATE     DS    CL4                 DATE OF ERROR - 00YY0DDF             10000000
TIME     DS    CL4                 TIME OF ERROR - HHMMSSHH             10050000
         DS    CL8                                                      10100000
MDRCUA   DS    CL2                 MDR CHAN & UNIT ADDR                 10150000
MDRCTRL  DS    C                   MDR CTRL UNIT POLL ADDR              10200000
MDRTERM  DS    C                   MDR TERMIL POLL ADDR                 10250000
MDRSTATS DS    CL2                 REMOTE 3270 STATUS                   10300000
         DS    CL2                                                      10350000
OBRCCW   DS    CL8                 LAST CCW EXECUTED                    10400000
OBRCSW   DS    CL8                 CHANNEL STATUS WORD                  10450000
         DS    CL6                                                      10500000
OBRUCB   DS    C                                                        10550000
         DS    CL3                                                      10600000
OBRCUA   DS    CL2                 OBR CHAN & UNIT ADDR                 10650000
OBRCTRL  DS    C                                                        10700000
OBRTERM  DS    C                                                        10750000
         DS    CL12                                                     10800000
OBRSENSE DS    CL2                 OBR SENSE BYTES                      10850000
*********************************************************************** 10900000
BNGIDISP CSECT                                                          10950000
R1       EQU   1                                                        11000000
BASE1    EQU   2             BASE REGISTER ONE = 0-4095                 11050000
BASE2    EQU   3             BASE REGISTER TWO = 4096-8191              11100000
BASE3    EQU   4             BASE REGISTER THREE = 8192-12287           11150000
PCBREG   EQU   5             IMS PGM COMM BLOCK BASE                    11200000
FIOABAR  EQU   6             POINTS TO FIOA                             11250000
PARMREG  EQU   6             POINTS TO PARM AREA                        11300000
OUTREG   EQU   7             POINTS TO DATA IN TIOA AREA                11350000
OUTLOOP  EQU   8             USED FOR LOOPING THRU DATA IN TIOA AREA    11400000
DATAREG  EQU   9             POINTS TO DATA IN FIOA AREA                11450000
DATALOOP EQU   10            USED FOR LOOPING THRU DATA IN FIOA AREA    11500000
TABLEREG EQU   11            POINTS TO FUNCTION/COMPANION TABLE AND     11550000
*                              VTAM DSECT.                              11600000
LINKREG  EQU   11                  SUBROUTINE LINKAGE                   11650000
R11      EQU   11                                                       11700000
MOD1REG  EQU   12            POINTS TO MOD-1 TABLE                      11750000
R13      EQU   13                                                       11800000
R14      EQU   14                                                       11850000
R15      EQU   15                                                       11900000
*********************************************************************** 11950000
*                                                                     * 12000000
*        THIS SECTION DOES PROGRAM INITIALIZATION                     * 12050000
*                                                                     * 12100000
*********************************************************************** 12150000
         SAVE  (14,12)             SAVE CALLER'S REGISTERS              12250000
         BALR  BASE1,0                                                  12300000
         USING *,BASE1,BASE2,BASE3                                      12350000
BNGIDISP BNGHJN SKIPID                                         @OZ29912 12370007
         LA    BASE2,2048(BASE1)    SET SECOND BASE                     12400000
         LA    BASE2,2048(BASE2)       FROM THE FIRST                   12450000
         LA    BASE3,2048(BASE2)    SET THIRD BASE                      12500000
         LA    BASE3,2048(BASE3)       FROM THE SECOND                  12550000
         LA    14,SAVE             POINT TO OUR SAVE AREA               12600000
         ST    14,8(13)            FORWARD CHAIN FROM OLD               12650000
         ST    13,4(14)            BACKWARD CHAIN TO OLD                12700000
         LR    13,14               FIRST BASE AND S/A FOR OUR REGS      12750000
         B     GO                                                       12800000
SAVE     DS    18F                 SAVE AREA                            12950000
GO       DS    0H                                                       13000000
         MVC   IOPCB+1(3),1(R1)     SAVE IOPCB ADDRESS                  13050000
*********************************************************************** 13100000
*                                                                     * 13150000
*        THIS SECTION  GETS A TRANSACTION                             * 13200000
*                                                                     * 13250000
*********************************************************************** 13300000
GETRANS  DS    0H                                                       13350000
         MVI   MOD1TABL,C' '       BLANK OUT MOD-1 TABLE AREA           13400000
         MVC   MOD1TABL+1(63),MOD1TABL                                  13450000
         MVI   MOD1SW,X'00'        SET MOD-1 SWITCH OFF                 13500000
         MVI   ERRDATA,C' '        BLANK OUT ERROR MESSAGE AREA         13550000
         MVC   ERRDATA+1(116),ERRDATA  *                                13600000
         L     PCBREG,IOPCB        POINT TO IOPCB                       13650000
         CALL  ASMTDLI,(GU,(PCBREG),MSGIN),VL     GET INPUT MSG         13700000
         CLC   PCBSTAT,DLIOK       MESSAGE SEGMENT OBTAINED?            13750000
         BE    A100                GO RESPOND TO MESSAGE IF SO          13800000
         CLC   PCBSTAT,DLIQC       NO MORE TRANSACTIONS AVAILABLE?      13850000
         BNE   ABEND1              INFORM SOMEONE IF UNKNOWN STATUS     13900000
         L     R13,4(R13)          RESTORE INCOMING SAVE AREA ADDRESS   13950000
         RETURN (14,12),T,RC=0     RELINQUISH CONTROL                   14000000
ABEND1   ABEND 666,DUMP                                                 14050000
CHECKST  CLC   PCBSTAT,DLIOK       DID ISRT GO OK?                      14100000
         BE    GETRANS             IF SO, GET ANOTHER MESSAGE           14150000
ABENDMSG ABEND 444,DUMP                                                 14200000
         EJECT                                                          14250000
*********************************************************************** 14300000
*                                                                     * 14350000
*        THIS SECTION EDITS THE INPUT MESSAGE.                        * 14400000
*                                                                     * 14450000
*********************************************************************** 14500000
A100     ZAP   FLDCNT,=P'0'        SET KEYED-IN FIELD COUNTER TO ZERO.  14550000
         XC    PARM1(48),PARM1     ZERO OUT PARM FIELDS                 14600000
         MVC   PARM1(4),MSGTXCD    MOVE TRANSACTION CODE 'DEMF'         14650000
         LH    DATAREG,TIOATDL     SET DATAREG = LNGTH OF INPUT         14700000
         CH    DATAREG,=H'9'       'DEMF ' ONLY ENTERED FROM CLEAR SCR? 14750000
         BNH   D28                 YES. GOTO BNGIMENU                   14800000
         CLC   MSGKEYED,=CL29' '   WAS REQUEST KEYED IN?                14850000
         BNE   A150                YES.                                 14900000
         CLC   MSGCMDCD,=C'MENU'   IS INPUT ENTERED ON PAGE1?           14950000
         BNE   A115                NO.                                  15000000
         CLC   MSGDPRSS,=C'DEPRESS'     IS INPUT ENTERED FROM PAGE 1?   15050000
         BNE   D28                      NO.  GO TO BNGIMENU RTN         15100000
         CLI   MSGALL,C' '         IS ALL CHECKED?                      15150000
         BNE   A100ALL             YES.                                 15200000
         CLI   MSG3270,C' '        IS 3270 CHECKED?                     15250000
         BNE   A150                YES.                                 15300000
         CLI   MSGRMOT,C' '        IS REMOTE CHECKED?                   15350000
         BNE   A100RMOT            YES.                                 15400000
         CLI   MSGLOCL,C' '        IS LOCAL CHECKED?                    15450000
         BNE   A100LOCL            YES.                                 15500000
         B     D28                 GO CALL BNGIMENU RTN                 15550000
A100ALL  MVC   PARM2(3),=C'ALL'    MOVE CMND TO PARM2                   15600000
         B     D10                                                      15650000
A100RMOT MVC   PARM2(4),=C'REMO'   MOVE CMND TO PARM2                   15700000
         B     D10                                                      15750000
A100LOCL MVC   PARM2(4),=C'LOCA'   MOVE CMND TO PARM2                   15800000
         B     D10                                                      15850000
A115     MVC   PARM2(4),MSGCMDCD   MOVE COMMAND ALL, LINE, CTRL,        15900000
*                                                3270, OR MENU          15950000
         MVC   SAVEBBSS,MSGBBBSS   SAVE BBBSS FOR LINKED-TO PGM         16000000
         CLI   MSGPGF,C' '         IS THIS A PAGE FORWARD REQUEST?      16050000
         BNE   A120                YES.                                 16100000
         CLI   MSGPGB,C' '         IS THIS A PAGE BACKWARD REQUEST?     16150000
         BE    A140                NO.  MUST BE COMPANION REQUEST       16200000
         MVC   PARM4(4),=C'PAGE'                                        16250000
         MVC   PARM5(7),=C'BACKWRD'                                     16300000
         B     D10                 CONT NORMAL PROCESSING               16350000
A120     MVC   PARM4(4),=C'PAGE'                                        16400000
         MVC   PARM5(7),=C'FORWARD'                                     16450000
         B     D10                                                      16500000
A140     CLC   MSGCMDCD,=C'3270'   IS THIS FROM 3270 SCREEN?            16550000
         BNE   A145                NO.                                  16600000
         CLC   MSGNTRY(4),=C'BITS' IS THIS FROM BITS PRMPTR SCR?        16650000
         BE    D10                 YES. GOTO BNGI3270 PGM               16700000
A145     MVC   PARM3,MSGNTRY+4     MOVE X'ED-IN DATA TO PARM3           16750000
         OC    PARM3,PARM3         WAS ANYTHING X'ED?                   16800000
         BZ    D28                 NO. GOTO BNGIMENU                    16850000
         B     C109                YES. CK FOR COMPANION REQUEST        16900000
A150     LA    DATAREG,MSGKEYED    POINT TO KEYED-IN DATA               16950000
         LR    DATALOOP,DATAREG    SETUP DATA LOOP                      17000000
         AH    DATALOOP,=H'29'                                          17050000
         LA    PARMREG,PARM2       POINT TO PARMS.                      17100000
         LR    14,PARMREG                                               17150000
         MVI   NEWPARM,C'1'        TURN ON 'NEW PARM' SWITCH.           17200000
         MVI   CTRPARM,X'00'       SET PARM CHAR CTR = 0                17250000
A160     CLI   0(DATAREG),X'FF'    IS THIS BYTE A X'FF'?                17300000
         BNE   A210                NO.                                  17350000
         CLI   PARM3,X'00'         YES. IS PARM3 = SYMNAME ?            17400000
         BE    A155                NO. GO SET SYMNAME FROM PCBTERMN     17450000
         MVC   TWALINE(8),PARM3    YES. SET SYMNAME FROM PARM3          17500000
         B     A156                AND LOAD LLLCCTT/TTT IN PARMS        17550000
A155     MVC   TWALINE(8),PCBTERMN MOVE DEFAULT SYMNAME IN TWALINE      17600000
A156     XC    PARM3(32),PARM3     CLEAR PARMS FOR HARDWARE ADDR        17650000
         MVC   PARM3(3),1(DATAREG) LOAD PARM3 = LLL OR TTT              17700000
         MVC   PARM4(2),4(DATAREG) LOAD PARM4 = CC                      17750000
         MVC   PARM5(2),6(DATAREG) LOAD PARM5 = TT                      17800000
         CLC   PARM4(2),=C'00'     IF PARM4 = ZEROS                     17850000
         BNE   A158                   THEN ZERO-OUT PARM4               17900000
         XC    PARM4(16),PARM4                    & PARM5.              17950000
A158     AP    FLDCNT,=P'1'          INDICATE TO BNGI3270 PGM THAT      18000000
*                                    DATA WAS KEYED IN                  18050000
         B     D10                                                      18100000
A210     CLI   0(DATAREG),X'FE'    IS THIS BYTE A 'FE' ?       @OZ29912 18150007
         BNE   A250                NO.                         @OZ29912 18158007
         MVC   MSG10NAM,1(DATAREG) YES.MOVE VTAM NAME TO ERRMSG@OZ29912 18166007
         B     Z100                GO WRITE ERR MSG.           @OZ29912 18174007
A250     CLI   0(DATAREG),C'A'     IS IT AN 'A' OR HIGHER?     @OZ29912 18182007
         BL    B80                 NO. CHECK NEW PARM SWITCH.           18200000
         CLI   NEWPARM,C'1'        IS FIRST CHAR FOR PARM(X)?           18250000
         BNE   B10                 NO.                                  18300000
         MVI   NEWPARM,C'0'        YES. SET FIRST CHAR IN FOR PARM      18350000
         MVI   CTRPARM,X'00'       SET PARM CHAR CTR = 0                18400000
B10      IC    R11,CTRPARM         LOAD R11 = CTRPARM                   18450000
         LA    R11,1(R11)          ADD CTRPARM = CTRPARM + 1            18500000
         STC   R11,CTRPARM         STORE NEW CTR BACK CTRPARM           18550000
         CLI   CTRPARM,X'08'       IS CHAR COUNT IN PARM OVER 8 ?       18600000
         BNH   B20                 NO.                                  18650000
         CLC   PARM2(6),=C'REMOTE' IS THIS A REMOTE SCREEN ?            18700000
         BE    B40                 YES. CONTINUE                        18750000
         B     Z40                 NO. ISSUE INVALID FORMAT MSG         18800000
B20      MVC   0(1,14),0(DATAREG)  PUT THIS BYTE IN THIS PARM           18850000
         CLI   PARM6+7,X'00'       ARE ALL PARMS USED UP?               18900000
         BNE   C10                 YES. GOTO SYNTAX CHECKING ROUTINE    18950000
         LA    14,1(14)            BUMP PARM POINTER WORKREG.           19000000
B40      LA    DATAREG,1(DATAREG)  BUMP TIOA POINTER.                   19050000
         CR    DATAREG,DATALOOP    IS THERE MORE DATA IN TIOA?          19100000
         BL    A160                YES. GO PROCESS MORE DATA.           19150000
         B     C10                 NO. GOTO SYNTAX CHECKING ROUTINE     19200000
B80      CLI   NEWPARM,C'1'        IS NEW-PARM SWITCH ON?               19250000
         BE    B40                 YES. CHECK FOR MORE DATA.            19300000
         CLI   PARM6,X'00'         NO. ARE ALL PARMS USED UP?           19350000
         BNE   C10                 YES. GOTO SYNTAX CHECKING ROUTINE    19400000
         AP    FLDCNT,=P'1'        ONE  FIELD ENTERED INTO PARM         19450000
         LA    PARMREG,8(PARMREG)  NO. BUMP TO NEXT NEW PARM.           19500000
         LR    14,PARMREG          POINT WORK REG TO NEXT PARM.         19550000
         MVI   NEWPARM,C'1'        TURN ON NEW-PARM SWICH.              19600000
         B     B40                 GO CHECK FOR MORE DATA.              19650000
*********************************************************************** 19700000
*                                                                     * 19750000
*        AT THIS POINT UP TO 5 PARMS HAVE BEEN EDITED AND             * 19800000
*        ARE LEFT JUSTIFIED WITH TRAILING X'00'S                      * 19850000
*                                                                     * 19900000
*********************************************************************** 19950000
         EJECT                                                          20000000
*********************************************************************** 20050000
*                                                                     * 20100000
*        SYNTAX CHECKING ROUTINE                                      * 20150000
*                                                                     * 20200000
*********************************************************************** 20250000
C10      CLC   PARM2(5),=X'D4C5D5E400' IS PARM2=MENU ?                  20300000
         BNE   C20                     NO                               20350000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  20400000
         BE    D28                     YES. GOTO BNGIMENU               20450000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  20500000
C20      CLC   PARM2(4),=X'C1D3D300'   IS PARM2 = ALL ?                 20550000
         BNE   C30                     NO                               20600000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  20650000
         BE    D10                     YES.GO SCHEDULE APPROPRIATE PGM  20700000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  20750000
C30      CLC   PARM2(6),=X'D3D6C3C1D300'  IS PARM2 = LOCAL ?            20800000
         BNE   C40                        NO                            20850000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  20900000
         BE    D10                     YES.GO SCHEDULE APPROPRIATE PGM  20950000
         CLC   PARM3+1(2),=C'SS'       IS LOCAL/REMOTE SCREEN ?         21000000
         BE    D10                     YES.                             21050000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  21100000
C40      CLC   PARM2(6),=X'D9C5D4D6E3C5' IS PARM2 = REMOTE ?            21150000
         BNE   C50                     NO.                              21200000
         CLC   PARM2+7(1),=C'S'        IS REMOTE SCREEN ?               21250000
         BE    C45                     YES.                             21300000
         CLI   PARM2+6,X'00'           IS REMOTE SYNTAX ERROR ?         21350000
         BNE   Z40                     YES. GO ISSUE INVALID FORMAT MSG 21400000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  21450000
         BE    D10                     YES.GO SCHEDULE APPROPRIATE PGM  21500000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  21550000
C45      CLI   PARM3,X'00'             IS REMOTE SCREEN ?               21600000
         BNE   D10                     YES.                             21650000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  21700000
C50      CLC   PARM2(5),=X'D3C9D5C500' IS PARM2 = LINE ?                21750000
         BNE   C60                     NO                               21800000
         CLI   PARM4,X'00'             IS PARM4 = 00 ?                  21850000
         BNE   Z40                     NO. GO ISSUE INVALID FORMAT MSG  21900000
C55      CLI   PARM3+3,X'00'           LINE ADDR = 4 OR MORE ?          21950000
         BNE   Z40                     YES.                             22000000
         CLI   PARM3+2,X'00'           LINE ADDR = 2 OR LESS ?          22050000
         BE    Z40                     YES.                             22100000
         LA    DATALOOP,3              SET FOR SCAN 3 CHARS             22150000
         LA    DATAREG,PARM3           SET DATAREG = PARM3 PTR          22200000
C57      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         22250000
         BNL   C59                     YES. IT IS NUMERIC               22300000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          22350000
         BH    Z40                     YES. IT IS INVALID FORMAT        22400000
C59      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       22450000
         BCT   DATALOOP,C57            LOOP                             22500000
         B     D10                     NO. GO SCHEDULE APPROPRIATE PGM  22550000
C60      CLC   PARM2(5),=X'C3E3D9D300' IS PARM2 = CTRL ?                22600000
         BNE   C70                     NO                               22650000
         CLI   PARM5,X'00'             IS PARM5 = 00 ?                  22700000
         BNE   Z40                     NO.                              22750000
         CLI   PARM4,X'00'             IS PARM4 = 00 ?                  22800000
         BE    C55                     YES.                             22850000
C65      CLI   PARM4+2,X'00'           CTRL ADDR = 3 OR MORE ?          22900000
         BNE   Z40                     YES.                             22950000
         CLI   PARM4+1,X'00'           CTRL ADDR = 1 OR LESS ?          23000000
         BE    Z40                     YES.                             23050000
C66      LA    DATALOOP,2              SET FOR SCAN 2 CHARS             23100000
         LA    DATAREG,PARM4           SET DATAREG = PARM4 PTR          23150000
C67      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         23200000
         BNL   C69                     YES. IT IS NUMERIC               23250000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          23300000
         BH    Z40                     YES. IT IS INVALID FORMAT        23350000
C69      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       23400000
         BCT   DATALOOP,C67            LOOP                             23450000
         B     C55                     NO. GO CHECK LINE ADDR (PARM3)   23500000
C70      CLC   PARM2(5),=X'F3F2F7F000' IS PARM2 = 3270 ?                23550000
         BNE   Z40                     NO.                              23600000
         CLI   PARM6,X'00'             IS PARM6 = 00 ?                  23650000
         BNE   Z40                     NO.                              23700000
         CLI   PARM5,X'00'             IS PARM5 = 00 ?                  23750000
         BE    C75                     YES.                             23800000
         CLI   PARM5+2,X'00'           IS TERMINAL ADDR = 3 OR MORE ?   23850000
         BNE   Z40                     YES.                             23900000
         CLI   PARM5+1,X'00'           IS TERMINAL ADDR = 1 OR LESS ?   23950000
         BE    Z40                     YES.                             24000000
         LA    DATALOOP,2              SET FOR SCAN 2 CHARS             24050000
         LA    DATAREG,PARM5           SET DATAREG = PARM5 PTR          24100000
C72      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         24150000
         BNL   C74                     YES. IT IS NUMERIC               24200000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          24250000
         BH    Z40                     YES. IT IS INVALID FORMAT        24300000
C74      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       24350000
         BCT   DATALOOP,C72            LOOP                             24400000
         B     C65                     NO. GO CHK LINE AND CTRL         24450000
C75      CLI   PARM4,X'00'             IS PARM4 = 00 ?                  24500000
         BNE   Z40                     NO.                              24550000
         CLI   PARM3+3,X'00'           IS TERM/LINE = 4 OR MORE ?       24600000
         BNE   Z70                     YES. GO ISSUE SYMBOLIC ERR MSG   24650000
         CLI   PARM3+2,X'00'           IS TERM/LINE = 2 OR LESS ?       24700000
         BE    Z70                     YES. GO ISSUE SYMBOLIC ERR MSG   24750000
         LA    DATALOOP,3              SET FOR SCAN 3 CHARS             24800000
         LA    DATAREG,PARM3           SET DATAREG = PARM3 PTR          24850000
C77      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         24900000
         BNL   C79                     YES. IT IS NUMERIC               24950000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          25000000
         BH    Z70                     YES. IT IS SYMBOLIC ERROR        25050000
C79      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       25100000
         BCT   DATALOOP,C77            LOOP                             25150000
         B     D10                     NO SYMBOLIC ERROR FOUND          25200000
*********************************************************************** 25250000
         EJECT                                                          25300000
*********************************************************************** 25350000
*                                                                     * 25400000
*        AT THIS POINT, THE REQUEST IS FOR A BLOWUP OF AN ENTRY OF ONE* 25450000
*        OF THE DISPLAYS. THE FUNCTION/COMPANION TABLE IS SEARCHED FOR* 25500000
*        THE NAME OF THE PROGRAM TO PERFORM THE NEXT DISPLAY.         * 25550000
*                                                                     * 25600000
*********************************************************************** 25650000
C109     LA    TABLEREG,TABLE      POINT AT FUNCTION/COMPANION TABLE.   25700000
C110     CLC   0(4,TABLEREG),PARM2 PGRM NAME IN TABLE?                  25750000
         BE    C170                YES.                                 25800000
         CLC   0(3,TABLEREG),=C'END'    END OF TABLE?                   25850000
         BE    D28                 YES. GO CK FOR MENU REQUEST       PH 25900000
         LA    TABLEREG,TABLENTY(TABLEREG)  BUMP TO NEXT ENTRY.         25950000
         B     C110                GO CH NEXT ENTRY.                    26000000
C170     OC    4(4,TABLEREG),4(TABLEREG)   IS THERE A COMPANION PGRM?   26050000
         BZ    D10                               NO.                    26100000
         MVC   PARM2(4),4(TABLEREG)     MOVE COMPANION NAME TO PARM2.   26150000
         CLC   PARM2(4),=C'TERM'  IS THIS A TERML ERROR REQUEST?        26200000
         BNE   D10                 NO.                                  26250000
         L     15,=V(BNGI3270)    LINK TO BNGI3270 PGM.                 26300000
         B     D75                                                      26350000
*********************************************************************** 26400000
*                                                                     * 26450000
*        THIS SECTION SCHEDULES THE APPROPRIATE DISPLAY PROGRAM:      * 26500000
*        ALL LINES, LINE, CTRL, 3270, OR MENU                         * 26550000
*                                                                     * 26600000
*********************************************************************** 26650000
D10      L     TABLEREG,=A(TABLE)  POINT AT FUNCTION/COMPANION TABLE.   26700000
D20      CLC   0(4,TABLEREG),PARM2        PROGRAM NAME IN TABLE?        26750000
         BE    D25                        YES.                          26800000
         CLC   0(3,TABLEREG),=C'END'      END OF TABLE?                 26850000
         BE    D28                        YES. GO TO MENU REQUEST       26900000
         LA    TABLEREG,TABLENTY(TABLEREG)  BUMP TO NEXT ENTRY.         26950000
         B     D20                GO CHECK NEXT ENTRY.                  27000000
D25      CLI   4(TABLEREG),X'00'  IS THERE A PGRM NAME TO XCTL TO?      27050000
         BNE   E10                NO.                                   27100000
         L     15,=V(BNGI3270)                                          27150000
         CLC   8(8,TABLEREG),=C'BNGI3270'                               27200000
         BE    D75                                                      27250000
         L     15,=V(BNGILOCL)                                          27300000
         CLC   8(8,TABLEREG),=C'BNGILOCL'                               27350000
         BE    D50                                                      27400000
         L     15,=V(BNGIRMOT)                                          27450000
         CLC   8(8,TABLEREG),=C'BNGIRMOT'                               27500000
         BE    D50                                                      27550000
D28      DS    0H                                                       27600000
         L     15,=V(BNGIMENU)                                          27650000
D50      DS    0H                                                       27700000
         LA    12,MSGIN            SET UP COMMUNICATION'S POINTER FOR   27750000
*                                     BNGILOCL AND BNGIRMOT             27800000
         B     D100                LINK TO MODULE                       27850000
D75      DS    0H                                                       27900000
         LA    12,COMMAREA         SET UP COMMUNICATION POINTER         27950000
D100     BALR  14,15               LINK TO APPROPRIATE MODULE           28000000
         B     GETRANS             GET ANOTHER MESSAGE                  28050000
         EJECT                                                          28100000
*********************************************************************** 28150000
*                                                                     * 28200000
*        AT THIS POINT IT HAS BEEN DETERMINED THAT THE REQUEST IS FOR * 28250000
*        ALL LINES, LINE, OR CTRL. THIS MODULE HANDLES THOSE DISPLAYS.* 28300000
*                                                                     * 28350000
*********************************************************************** 28400000
*********************************************************************** 28450000
*                                                                     * 28500000
*        THIS SECTION CREATES THE COMMON HEADER FOR                   * 28550000
*        ALL LINES, ONE LINE, AND CTRL.                               * 28600000
*                                                                     * 28650000
*********************************************************************** 28700000
E10      MVC   MSGCMD,0(TABLEREG)     MOVE NAME OF THIS                 28750000
*                                     DISPLAY TO OUTPUT                 28800000
         OC    MSGCMD,=CL4' '         CHANGE ALL'00' TO ALL' '          28850000
         MVC   MSGPG,HDRPG                                              28900000
         MVC   MSGRECAP,18(TABLEREG)  MOVE RECAP HEADER TO TIOA         28950000
         MVC   MSGHDR1,59(TABLEREG)   MOVE COLUMN HEADER TO TIOA.       29000000
         MVC   MSGHDR2,59(TABLEREG)   MOVE COLUMN HEADER AGAIN          29050000
         MVC   LGBBBSS,=C'BBBSSBBBSSBBBSS' SETUP OUTPUT BBBSS           29100000
         MVC   SMBBBSS,LGBBBSS             SETUP OUTPUT BBBSS           29150000
         LA    OUTREG,MSGHDR2+39      POINT TO FIRST ENTRY IN OUTPUT    29200000
         LA    OUTLOOP,14             SETUP 14 LINE ITEMS FOR MOD 1     29250000
*                                     ADJUST FOR MOD 2 AFTER            29300000
*                                     MOD 1 ITEMS ENTERED IN OUTPUT     29350000
*********************************************************************** 29400000
*                                                                     * 29450000
*        THIS SECTION BUILDS THE APPROPRIATE DISPLAY                  * 29500000
*                                                                     * 29550000
*********************************************************************** 29600000
F150     CP    FLDCNT,=P'0'      FIELD'S KEYED-IN?                      29650000
         BE    R10                NO. GO TO BLOWUP/PAGING SECTION       29700000
F180     XC    RELREC,RELREC       POINT TO FIRST CONTROL BLOCK.        29750000
*        DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=G120,DATASET=EMFILE       29800000
         BAL   LINKREG,READ        GET FIRST CONTROL BLOCK.             29850000
         B     G120                                                     29900000
*********************************************************************** 29950000
*                                                                     * 30000000
*        THIS IS A COMMON READ SUBROUTINE FOR THIS PROGRAM.           * 30050000
*                                                                     * 30100000
*********************************************************************** 30150000
READ     ST    11,SAVE11                                                30200000
         LA    11,PARMADDR         SET UP PARM REG                      30250000
         L     15,=V(BNGIREAD)    POINT TO READ MODULE                  30300000
         BALR  14,15              LINK TO BDAM READ MODULE              30350000
         L     11,SAVE11                                                30400000
         OC    STATUS,STATUS      READ OK?                              30450000
         BZ    0(LINKREG)         YES. RETURN TO CALLER                 30500000
         CLC   STATUS,=C'FF'       WAS EMFILE OPENED?                   30550000
         BE    Z60                 NO.  WRITE 'NOT OPEN' MSG            30600000
         UNPK  DBLWD,STATUS(3)                                          30650000
         MVC   IOERCODE,DBLWD+3                                         30700000
         TR    IOERCODE,HXTOEB     MOVE BDAM RETURN CODE TO I/O ERR MSG 30750000
         UNPK  DBLWD,RELREC(4)                                          30800000
         MVC   IOERBLK,DBLWD+4     MOVE BLK NBR THAT WAS BEING READ     30850000
         TR    IOERBLK,HXTOEB                                           30900000
         B     Z20                     IF REQUESTED SLOT CAN'T          30950000
*                                        BE FOUND, SEND 'SEARCHING ERR' 31000000
SAVE11   DS    F                                                        31050000
*********************************************************************** 31100000
*                                                                     * 31150000
*********************************************************************** 31200000
G120     L     FIOABAR,IOAREA      POINT TO FIOA AREA.                  31250000
         OC    CTRLENTS,CTRLENTS   ANY LINE ENTRIES?                    31300000
         BZ    Z30                 NO. WRITE 'NO LINE ERRORS'           31350000
         SR    DATALOOP,DATALOOP                                        31400000
         IC    DATALOOP,CTRLENTS   SET LOOP CTR FOR READING SLOTS.      31450000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT IN BLOCK.        31500000
         CLC   PARM2(3),=C'ALL'    DOES PARM2 = ALL?                    31550000
         BE    J10                 YES.                                 31600000
         OC    PARM3,PARM3         WAS A LINE ADDRESS ENTERED?          31650000
         BZ    Z40                 NO. WRITE 'NO LINE ENTERED'      PH  31700000
         MVC   LINENAME,PARM3           MOVE LINE ADDRESS TO SAVE AREA  31750000
         MVC   CLUSNAME,PARM4           MOVE CONTROL UNIT NAME TO SAVE  31800000
         MVC   MSG7CTRL,PARM4           MOVE CONTROL UNIT NAME TO SAVE  31850000
         OC    MSG7CTRL,=CL2' '            FOR CONTROL UNIT COMMAND     31900000
         MVC   MSG4LN,PARM3        MOVE LINE ADDRESS TO 'NO ERROR' MSG  31950000
         OC    MSG4LN,=CL3' '                                           32000000
         MVC   MSG7LINE,MSG4LN     MOVE LINE ADDRESS TO 'NO ERROR' MSG  32050000
*                                       FOR CONTROL UNIT COMMAND        32100000
H40      TR    PARM3(3),EBTOHX     CHANGE F0C6F2 TO 000F02 ETC.         32150000
         PACK  DBLWD,PARM3(4)      PACK   000F02 TO 0000F2 ETC.         32200000
         MVC   LINEID(3),DBLWD+4   MOVE GOOD PORTION TO SAVE AREA       32250000
         MVC   LINEID+3(3),=XL3'000000'                                 32300000
H80      CLC   SLOTLINE,LINEID     IS THIS CONTROL SLOT FOR OUR LINE?   32350000
         BE    L60                 YES. GO GET DETAIL BLOCK.            32400000
         LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           32450000
         BCT   DATALOOP,H80        CHECK NEXT SLOT.                     32500000
         CLC   CTRLFWD,=F'0'       MORE CONTROL BLOCKS?                 32550000
         BE    Z10                 NO. GO WRITE 'NO LINE ERRORS'        32600000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        32650000
         BAL   LINKREG,READ                                             32700000
*        DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=H180,DATASET=EMFILE       32750000
         L     FIOABAR,IOAREA      POINT TO INPUT RECORD AREA           32800000
         SR    DATALOOP,DATALOOP                                        32850000
         IC    DATALOOP,CTRLENTS   SET SLOT LOOP CONTROL                32900000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT.                 32950000
         B     H80                                                      33000000
         EJECT                                                          33050000
*********************************************************************** 33100000
*                                                                     * 33150000
*        THIS SECTION FORMATS 'ALL LINE' ENTRIES                      * 33200000
*                                                                     * 33250000
*********************************************************************** 33300000
J10      LA    14,LGBBBSS          LOAD SAVED ADDR OF BLK/SLOT TIOA.    33350000
         MVC   LGBBBSS(5),=C'00001'   MOVE 00001 TO FIRST AND           33400000
         MVC   LGBBBSS+10(5),LGBBBSS    PREVIOUS BBBSS'S                33450000
         MVC   SMBBBSS,LGBBBSS     DO THE SAME FOR SMALL SCREEN         33500000
         MVI   QUITSW,X'00'        TURN OFF OUTPUT-FULL SWITCH          33550000
J40      UNPK  DBLWD,SLOTLINE(4)        UNPK LINE ADDR IN WORKAREA      33600000
         TR    DBLWD+4(3),HXTOEB        CONVERT TO EBCDIC               33650000
         MVC   DTLITEM,=CL8' '     CLEAR DETAIL LINE ITEM               33700000
         MVC   DTLITEM(3),DBLWD+4  PUT LINE ADDR IN DETAIL ENTRY        33750000
J150     LH    14,SLOTHITS         PUT LINE ERRORS IN REG.              33800000
         CVD   14,DBLWD            CONVERT TO DECIMAL                   33850000
         UNPK  DTLCOUNT,DBLWD+5(3)      PUT LINE ERROR COUNT            33900000
         OI    DTLCOUNT+3,X'F0'         IN OUTPUT                       33950000
         MVC   0(DTLLTH,OUTREG),DTLENTRY   MOVE DETAIL ENTRY TO OUTPUT  34000000
         MVC   DTLCOUNT,=C'0001'      RESTORE PROGRAM CONSTANT.         34050000
         LA    OUTREG,DTLLTH(OUTREG)    UPDATE OUTPUT POINTER           34100000
         BCT   DATALOOP,K100       MORE SLOTS IN THIS CTRL BLK?         34150000
         CLC   CTRLFWD,=F'0'       NO. MORE CTRL BLKS?                  34200000
         BE    K120                NO. PREPARE TO EXIT.                 34250000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        34300000
         BAL   LINKREG,READ                                             34350000
*        DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=K50,DATASET=EMFILE        34400000
         L     FIOABAR,IOAREA      POINT TO INPUT RECORD                34450000
         SR    DATALOOP,DATALOOP                                        34500000
         IC    DATALOOP,CTRLENTS   SET LOOP CONTROL.                    34550000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT                  34600000
         B     J40                                                      34650000
K100     LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           34700000
         BCT   OUTLOOP,J40         OUTPUT COUNTER EMPTY?                34750000
         CLI   QUITSW,X'FF'        OUTPUT AREA FILLED FOR 3277-2?       34800000
         BE    K120                YES.                                 34850000
         MVI   QUITSW,X'FF'        NO. TURN ON OUTPUT-FULL SWITCH       34900000
         LA    OUTLOOP,66          SETUP OUTPUT COUNTER                 34950000
         L     15,=A(SMBBBSS)      POINT TO SMALL BLK/SLT AREA IN OUPUT 35000000
         UNPK  DBLWD,RELREC(4)     STORE BDAM RELATIVE                  35050000
         TR    DBLWD,HXTOEB        CONTROL BLK NUMBER                   35100000
         MVC   5(3,15),DBLWD+4     (LAST BBBSS) IN OUTPUT               35150000
         SR    14,14                                                    35200000
         IC    14,CTRLENTS         GET ORIGINAL COUNT OF SLOTS          35250000
         SR    14,DATALOOP         DETERMINE LAST SLOT READ.            35300000
         STC   14,DBLWD+6          STORE                                35350000
         UNPK  DBLWD(3),DBLWD+6(2) SLOT NUMBER                          35400000
         TR    DBLWD,HXTOEB        (LAST BBBSS)                         35450000
         MVC   8(2,15),DBLWD       IN OUTPUT.                           35500000
         MVC   MSGENDSM,MSGODAT2+12 STOR ERRS FOR LAST ENTRY FOR SM SCR 35550000
         B     J40                 GO PROCESS MORE SLOTS                35600000
K120     L     15,=A(LGBBBSS)     POINT TO LARGE BLK/SLT AREA IN OUTPUT 35650000
         UNPK  DBLWD,RELREC(4)     STORE BDAM RELATIVE                  35700000
         TR    DBLWD,HXTOEB        CONTROL BLK NUMBER                   35750000
         MVC   5(3,15),DBLWD+4     (LAST BBBSS) IN OUTPUT               35800000
         SR    14,14                                                    35850000
         IC    14,CTRLENTS         GET ORIGINAL COUNT OF SLOTS          35900000
         SR    14,DATALOOP         DETERMINE LAST SLOT READ.            35950000
         STC   14,DBLWD+6          STORE                                36000000
         UNPK  DBLWD(3),DBLWD+6(2) SLOT NUMBER                          36050000
         TR    DBLWD,HXTOEB        (LAST BBBSS)                         36100000
         MVC   8(2,15),DBLWD       IN OUTPUT.                           36150000
K200     CLC   SMBBBSS+5(5),=C'BBBSS'    SMALL SCREEN FULL?             36200000
         BNE   K230                      YES.                           36250000
         MVC   SMBBBSS+5(5),LGBBBSS+5    NO. SMALL BBBSS NEVER SET      36300000
         LA    14,80                  SINCE THE ENTRIES NEVER FILLED    36350000
         SR    14,OUTLOOP             A SMALL SCREEN AREA, OUTLOOP      36400000
         LR    OUTLOOP,14             MUST BE ADJUSTED                  36450000
K230     LTR   OUTLOOP,OUTLOOP        OUTPUT ALREADY CLEARED?           36500000
         BZ    K250                   YES.                              36550000
K240     MVC   0(CLRLTH,OUTREG),CLRNTRY         NO. CLEARING            36600000
*                                               OUTPUT FIELDS           36650000
         LA    OUTREG,CLRLTH(OUTREG)    UPDATE OUTPUT POINTER           36700000
         BCT   OUTLOOP,K240       MORE ENTRIES TO CLEAR IN OUTPUT       36750000
K250     L     PCBREG,IOPCB       POINT TO IOPCB                        36800000
         CALL  ASMTDLI,(ISRT,(PCBREG),MSGOUT,LGALL),VL                  36850000
         B     CHECKST                                                  36900000
*********************************************************************** 36950000
*                                                                     * 37000000
*        THIS SECTION PREPARES THE 'LINE' OR 'CTRL' DISPLAY           * 37050000
*                                                                     * 37100000
*********************************************************************** 37150000
L60      MVI   QUITSW,X'00'        TURN OFF OUTPUT-FULL-SW.             37200000
         ZAP   ITEMCNT,=P'0'       SET CTR OF OUTPUT ITEMS = 0          37250000
         MVC   RELREC,SLOTRFB      SAVE POINTER TO DETAIL BLK           37300000
L140     MVC   SVRELREC,RELREC     SAVE FOR LAST BBBSS'S                37350000
         OC    RELREC,RELREC       IS THERE ANY DATA BLOCKS ?  @OZ31886 37360007
         BZ    Z130                NO, WRITE 'NO DATA BLKS MSG'@OZ31886 37370007
         BAL   LINKREG,READ                                             37400000
L170     L     FIOABAR,IOAREA      POINT TO INPUT RECORD AREA           37450000
         SR    DATALOOP,DATALOOP                                        37500000
         LH    DATALOOP,BLKLTH     SET SLOT LOOP CONTROL                37550000
         LA    DATAREG,DATASLT1    POINT FOR FIRST SLOT                 37600000
L210     MVI   SLOTCNT,X'00'       ZERO OUT DETAIL SLOT COUNTER.        37650000
         OC    LINENAME,=CL8' '                                         37700000
         OC    CLUSNAME,=CL8' '                                         37750000
L220     L     1,=A(MSGRECAP)           POINT TO RECAP HEADER           37800000
         CLC   PARM2(4),=C'LINE'        PARM2 = LINE?                   37850000
         BE    L230                         YES.                        37900000
         CLC   PARM4,=CL8' '            IS PARM4 BLANK?                 37950000
         BE    L225                     YES. MUST BE LOCAL.             38000000
         OC    PARM4,PARM4              OR IS PARM4 ZEROS?              38050000
         BZ    L225                     YES. MUST BE LOCAL ALSO         38100000
         MVC   19(2,1),CLUSNAME         MOVE CONTROL UNIT TO HEADER     38150000
         MVC   21(9,1),=C' ON LINE '                                    38200000
         MVC   31(7,1),LINENAME         MOVE LINE ADDR. TO HEADER       38250000
         B     M10                                                      38300000
L225     MVC   9(19,1),=C'LOCAL CONTROL UNIT '                          38350000
         MVC   28(8,1),LINENAME         MOVE CTRL UNIT TO HEADER        38400000
         B     M10                                                      38450000
L230     MVC   19(8,1),LINENAME         MOVE LINE ADDR. TO HEADER       38500000
*********************************************************************** 38550000
*                                                                     * 38600000
*        THIS SECTION FORMATS A 'LINE' ITEM OR A 'CTRL' ITEM.         * 38650000
*                                                                     * 38700000
*********************************************************************** 38750000
M10      MVC   CTRLNAME,=D'0'      ZERO  OUT CONTROL UNIT WORK AREA.    38800000
         MVC   TERMNAME,=CL8' '    BLANK OUT TERMINAL WORK AREA.        38850000
         MVC   RELREC,DATAFWD      SAVE NEXT DETAIL BLK ADDR.           38900000
         MVC   TBARG,=CL2' '       CLEAR MOD-1 TABLE ARGUMENT           38950000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR ENTRY?                39000000
         BE    N10                 YES.                                 39050000
         CLI   ENTRYTYP,X'30'      IS IT A BTAM OBR?                    39100000
         BE    N80                 YES.                                 39150000
         CLI   ENTRYTYP,X'34'      IS IT A TCAM OBR?                    39200000
         BE    N80                 YES.                                 39250000
         B     M140                                                     39300000
M100     CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY?            39350000
         BE    N150                YES.                                 39400000
         OC    CTRLNAME,=CL8' '    CHANGE X'00' TO X'40'                39450000
         OC    PARM4,=CL8' '       CHANGE X'00' TO X'40'                39500000
         CLC   PARM4,CTRLNAME      PARM4 = CONTROL UNIT NAME?           39550000
         BE    N150                YES.                                 39600000
         CLI   PARM4,X'40'         IS PARM4 BLANK ?                  PH 39650000
         BNE   M140                NO. MUST BE REMOTE--BYPASS CK LOCAL  39700000
         OC    LINENAME,=CL8' '    CHANGE X'00' TO X'40'                39750000
         CLC   LINENAME,CTRLNAME   CONTROL UNIT = LINE?                 39800000
         BE    N150                YES. MUST BE LOCAL CONTROL UNIT      39850000
M140     SR    15,15                                                    39900000
         IC    15,SLOTCNT          ADD ONE                              39950000
         AH    15,=H'1'            TO                                   40000000
         STC   15,SLOTCNT          SLOT COUNTER.                        40050000
M160     SR    14,14                                                    40100000
         IC    14,DATALTH          PUT LTH OF SLOT IN WORK REG.         40150000
         AR    DATAREG,14          POINT TO NEXT DETAIL SLOT            40200000
         SR    DATALOOP,14         MORE SLOTS IN THIS DETAIL BLK?       40250000
         BP    M10                 YES.                                 40300000
         OC    RELREC,RELREC       MORE DETAIL BLOCKS?                  40350000
         BNE   L140                YES.                                 40400000
M240     ZAP   WORKCNT,ITEMCNT     ANY ITEMS IN TIOA?                   40450000
         BZ    Z50                 NO. WRITE 'NO ERRS' MSG FOR CTRLUNIT 40500000
         CLC   SMBBBSS+5(5),=C'BBBSS'   IS SMALL 'BBBSS' FILLED IN ?    40550000
         BNE   M260                     YES.   BYPASS FILLING IT IN     40600000
         MVC   SMBBBSS+5(5),LGBBBSS+5   NO. FILL IT IN                  40650000
M260     MVC   MSGENDSM,MSGODAT2+12 STOR ERRS FOR LAST ENTRY FOR SM SCR 40700000
         B     K200                                                     40750000
N10      CLI   MOD1SW,X'00'           MOD-1 SW ON ?                     40800000
         BE    N30                    NO. BYPASS MOD-1 SCANNER CK.      40850000
         CLC   PARM2(4),=C'CTRL'      IS THIS A 'CTRL' DISPLAY ?        40900000
         BE    N20                    YES. USE REMOTE TERMINAL ADDR     40950000
         MVC   TBARG(1),MDRCTRL       PASS REMOTE CTRL UNIT TO MOD-1    41000000
         B     N25                    GO CK ADDR AGAINST MOD-1 TABLE    41050000
N20      MVC   TBARG(1),MDRTERM       PASS REMOTE TERM ADDR TO MOD-1    41100000
N25      BAL   LINKREG,MOD1SCAN       CK IF REMOTE CU OR TERMINAL       41150000
         CLC   TBARG,=X'0000'           IN MOD-1 TABLE ?                41200000
         BE    M140                   YES. BYPASS THIS ERROR ENTRY      41250000
N30      UNPK  CTRLNAME(3),MDRCTRL(2)   MDR - PUT CONTROL UNIT          41300000
         TR    CTRLNAME(2),HXTOEB       NAME                            41350000
         MVI   CTRLNAME+2,X'00'         IN WORK AREA.                   41400000
         UNPK  TERMNAME(3),MDRTERM(2)   PUT TERMINAL                    41450000
         TR    TERMNAME(2),HXTOEB       NAME                            41500000
         MVI   TERMNAME+2,C' '          IN WORK AREA.                   41550000
         B     M100                                                     41600000
N80      CLI   OBRUCB,X'10'        IS THIS A LOCAL?                     41650000
         BE    N110                YES. GO MOVE 3-BYTE ADDR             41700000
N85      CLI   MOD1SW,X'00'           MOD-1 SW ON ?                     41900000
         BE    N95                    NO. BYPASS MOD-1 SCANNER CK.      41950000
         CLC   PARM2(4),=C'CTRL'      IS THIS A 'CTRL' DISPLAY?@OZ31879 42000007
         BE    N88                    YES. USE REMOTE TERM ADDR@OZ31879 42010007
         MVC   TBARG(1),OBRCTRL       PASS REMOTE CU TO MOD-1  @OZ31879 42020007
         B     N90                    GO CK ADDR AGAINST MOD-1 @OZ31879 42030007
N88      MVC   TBARG(1),OBRTERM       PASS REMOTE TERM ADDR    @OZ31879 42040007
*                                     TO MOD-1                 @OZ31879 42050007
N90      BAL   LINKREG,MOD1SCAN       CK IF REMOTE CU OR TERM  @OZ31879 42060007
         CLC   TBARG,=X'0000'           IN MOD-1 TABLE ?                42150000
         BE    M140                   YES. BYPASS THIS ERROR ENTRY      42200000
N95      UNPK  DBLWD,OBRCTRL(2)    OBR - MOVE 1-BYTE REMOTE CU ADDR     42250000
         TR    DBLWD+4(3),HXTOEB                                        42300000
         MVC   CTRLNAME(2),DBLWD+5      TO WORK AREA.                   42350000
         UNPK  DBLWD,OBRTERM(2)         MOVE 1-BYTE REMOTE TERML ADDR   42400000
         TR    DBLWD+4(3),HXTOEB                                        42450000
         MVC   TERMNAME(2),DBLWD+5      WORK AREA.                      42500000
         B     M100                                                     42550000
N110     UNPK  DBLWD,LINEIDA(4)    OBR - MOVE 3-BYTE CONTROL UNIT       42600000
         TR    DBLWD+4(3),HXTOEB        ADDRESS(POSSIBLY ROUNDED)       42650000
         MVC   CTRLNAME(3),DBLWD+4      TO WORK AREA.                   42700000
         CLI   MOD1SW,X'00'           MOD-1 SW ON ?                     42750000
         BE    N130                   NO. BYPASS MOD-1 SCANNER CK.      42800000
         MVC   TBARG,OBRCUA           PASS LOCAL TERMINAL TO MOD-1      42850000
*                                       SCANNER                         42900000
         BAL   LINKREG,MOD1SCAN       CK IF LOCAL TERMINAL              42950000
         CLC   TBARG,=X'0000'           IN MOD-1 TABLE ?                43000000
         BE    M140                   YES. BYPASS THIS ERROR ENTRY      43050000
N130     UNPK  DBLWD,OBRCUA(3)          MOVE REAL 3-BYTE CONTROL        43100000
         TR    DBLWD+4(3),HXTOEB        UNIT ADDRESS                    43150000
         MVC   TERMNAME(3),DBLWD+4      WORK AREA.                      43200000
         B     M100                                                     43250000
N150     OC    CTRLNAME,=CL8' '    CHANGE ZEROS TO BLANKS.              43300000
         LA    14,MSGHDR2+39       POINT TO FIRST ITEM IN TIOA          43350000
         ZAP   WORKCNT,ITEMCNT     ANY ITEMS IN TIOA?                   43400000
         BZ    P90                 NO. ADD NEW ITEM.                    43450000
N170     CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY?            43500000
         BE    P20                 YES.                                 43550000
         CLC   TERMNAME,ITEMLTH(14)     WORKTERMINAL = TIOA TERMINAL?   43600000
         BE    P40                 YES.                                 43650000
N230     LA    14,DTLLTH(14)       BUMP TO NEXT ITEM                    43700000
         SP    WORKCNT,=PL2'1'     SUBT ONE FROM ITEM COUNTER.          43750000
         BZ    P90     ANY ITEMS?  NO. ADD NEW ITEM.                    43800000
         B     N170                                                     43850000
P20      CLC   CTRLNAME,ITEMLTH(14)     WORK CTRL = TIOA CTRL?          43900000
         BNE   N230                NO.                                  43950000
P40      PACK  FULLWD(3),COUNTLTH(4,14)  ADD                            44000000
         AP    FULLWD(3),=P'1'          ONE                             44050000
         UNPK  COUNTLTH(4,14),FULLWD(3)  TO                             44100000
         OI    COUNTLTH+3(14),X'F0'     COUNT FIELD.                    44150000
         B     M140                GO CHECK NEXT SLOT.                  44200000
P90      CLC   PARM2(4),=C'LINE'        IS THIS A 'LINE' DISPLAY?       44250000
         BE    P170                     YES.                            44300000
         MVC   DTLITEM,TERMNAME    NO. MOVE TERMINAL                    44350000
P120     MVC   0(DTLLTH,OUTREG),DTLENTRY  TO OUTPUT                     44400000
         LA    OUTREG,DTLLTH(OUTREG)    UPDATE OUTPUT POINTER.          44450000
         AP    ITEMCNT,=P'1'       ADD 1 TO COUNT OF OUTPUT ITEMS.      44500000
         SR    15,15                                                    44550000
         IC    15,SLOTCNT          ADD ONE                              44600000
         AH    15,=H'1'               TO                                44650000
         STC   15,SLOTCNT             SLOT COUNTER                      44700000
         L     15,=A(LGBBBSS)      POINT TO LARGE BLK/SLT AREA IN OUPUT 44750000
         UNPK  DBLWD,SVRELREC(4)   STORE BDAM RELATIVE                  44800000
         TR    DBLWD,HXTOEB        CONTROL BLK NUMBER                   44850000
         MVC   5(3,15),DBLWD+4     (LAST BBBSS) IN OUTPUT               44900000
         UNPK  DBLWD(3),SLOTCNT(2)     STORE SLOT NUMBER IN             44950000
         TR    DBLWD,HXTOEB        (LAST BBBSS)                         45000000
         MVC   8(2,15),DBLWD       IN OUTPUT.                           45050000
         CP    ITEMCNT,=P'1'       IS THIS THE FIRST ITEM IN TIOA ?     45100000
         BNE   P140                NO. BYPASS UPDATE OF BBBSS'S         45150000
         MVC   LGBBBSS(5),LGBBBSS+5   UPDATE (FIRST BBBSS) FOR LG SCR   45200000
         MVC   SMBBBSS(5),LGBBBSS     UPDATE (FIRST BBBSS) FOR SM SCR   45250000
         CLC   LGBBBSS+10(5),=C'BBBSS'  IS PREV BBBSS FILLED IN ?       45300000
         BNE   P140                     YES. DON'T UPDATE.              45350000
         MVC   LGBBBSS+10(5),LGBBBSS  UPDATE (PREVIOUS BBBSS) FOR LGSCR 45400000
         MVC   SMBBBSS+10(5),LGBBBSS  UPDATE (PREV  BBBSS) FOR SM SCR   45450000
P140     BCT   OUTLOOP,M160        MORE ROOM IN TIOA?                   45500000
         CLI   QUITSW,X'FF'        OUTPUT AREA FILLED FOR 3277-2?       45550000
         BE    M240                YES.                                 45600000
         MVI   QUITSW,X'FF'        NO. TURN ON OUTPUT-FULL SWITCH       45650000
         LA    OUTLOOP,66          SETUP OUTPUT COUNTER                 45700000
         MVC   SMBBBSS+5(5),LGBBBSS+5    ADD (LAST BBBSS) TO SMBBBSS    45750000
         B     M160                GO PROCESS MORE SLOTS                45800000
P170     MVC   DTLITEM,CTRLNAME    SETUP CONTROL UNIT ADDRESS           45850000
         B     P120                     FOR OUTPUT.                     45900000
         EJECT                                                          45950000
*********************************************************************** 46000000
*                                                                     * 46050000
*        THIS SECTION PREPARES FOR AN ENTRY BLOWUP OR FOR PAGING.     * 46100000
*                                                                     * 46150000
*********************************************************************** 46200000
R10      CLC   PARM4(4),=C'PAGE'   IS THIS A 'PAGE' REQUEST?            46250000
         BE    S010                YES. CK FOR FWD OR BACK.             46300000
         CLC   PARM2(4),=C'LINE'   NO. THIS MUST BE COMPANION REQUEST.  46350000
         BNE   R010                IF NOT LINE DISPLAY, GO READ RECORD. 46400000
         MVC   PARM3,MSGNTRY+4     IS LINE, MOVE THE X'D FIELD TO PRM3. 46450000
         MVC   LINENAME,MSGNTRY+4       MOVE LINE ADDRESS TO SAVE AREA  46500000
         XC    PARM4(16),PARM4      AS IF LINE ID HAD BEEN KEYED IN.    46550000
         B     F180                GO DO LINE DISPLAY AS IF THIS WERE   46600000
*                                  AN INITIAL 'LINE' INPUT.             46650000
R010     MVC   CLUSNAME,MSGNTRY+4       MOVE CONTROL UNIT ADDR TO SAVE  46700000
         MVC   PARM4,MSGNTRY+4     MOVE X'D CTRL UNIT TO PARM4 AS IF    46750000
         XC    PARM5,PARM5           IT HAD BEEN KEYED IN.              46800000
R140     TR    MSGBBBSS(3),EBTOHX  GET BLOCK NUMBER OF                  46850000
         PACK  DBLWD,MSGBBBSS(4)      REQUESTED LINE INTO HEX.          46900000
         MVC   RELREC,DBLWD+4                                           46950000
         BAL   LINKREG,READ                                             47000000
R170     L     FIOABAR,IOAREA          POINT TO INPUT RECORD AREA       47050000
         XC    PARM3,PARM3                                              47100000
         UNPK  DBLWD,DATAPORT(4)        MOVE LINE ID                    47150000
         TR    DBLWD+4,HXTOEB           FROM PREVIOUS BLOCK             47200000
         MVC   LINENAME(3),DBLWD+4     TO PARM3 AS IF IT HAD BEEN       47250000
         MVC   PARM3(3),LINENAME        KEYED IN.                       47300000
         CLC   PARM3(3),PARM4      IS THIS A LOCAL CTRL UNIT?           47350000
         BNE   F180                NO. GO TO PROCESS REMOTE.            47400000
         XC    PARM4,PARM4         YES. CLEAR REDUNDANT CU ADDR         47450000
         B     F180                GO DO A 'CTRL' DISPLAY AS IF ABOVE   47500000
*                                  CTRL & LINE HAD BEEN TYPED IN.       47550000
S010     DS    0H                                                       47600000
         MVC   WORK15,MSGBBBSS     CONVERT BBBSS'S TO HEX               47650000
         TR    WORK15,EBTOHX                                            47700000
         CLC   PARM5(4),=C'FORW'   IS IT A 'PAGE FORWARD' REQUEST?      47750000
         BE    S110                YES.                                 47800000
         PACK  DBLWD,WORK15+10(6)                                       47850000
         MVC   RELREC,DBLWD+3      THE 'PREVIOUS' BLOCK.                47900000
         MVC   TWASLOT,DBLWD+6     AND SLOT TO RESUME AT.               47950000
         MVC   TBRELREC,RELREC     SAVE CURRENT 'BBB'                   48000000
         MVC   TBSLOT,TWASLOT      SAVE CURRENT 'SS'                    48050000
         MVC   LGBBBSS(5),MSGBBBSS+10   OLD PREVIOUS NOW BECOMES NEW    48100000
         MVC   LGBBBSS+10(5),MSGBBBSS+10    FIRST AND PREVIOUS.         48150000
         MVC   SMBBBSS,LGBBBSS      DO SAME FOR 3277-1 BBBSS            48200000
         B     S180                                                     48250000
S110     DS    0H                                                       48300000
         PACK  DBLWD,WORK15+5(6)                                        48350000
         MVC   RELREC,DBLWD+3      PLACE TO PAGE FORWARD FROM           48400000
         MVC   TWASLOT,DBLWD+6                                          48450000
         MVC   TBRELREC,RELREC     SAVE CURRENT 'BBB'                   48500000
         MVC   TBSLOT,TWASLOT      SAVE CURRENT 'SS'                    48550000
         MVC   LGBBBSS(5),MSGBBBSS+5     OLD LAST IS NEW FIRST AND      48600000
         MVC   LGBBBSS+10(5),MSGBBBSS    OLD FIRST IS NEW PREVIOUS.     48650000
         MVC   SMBBBSS,LGBBBSS      DO SAME FOR 3277-1 BBBSS            48700000
S180     BAL   LINKREG,LOCATE      LOCATE PROPER BLOCK & SLOT.          48750000
         CLC   PARM2(3),=C'ALL'                                         48800000
         BE    J40                 GO RESUME WHERE LEFT OFF AT (ALL)    48850000
         B     S215                 YES. PREPARE MOD-1 TABLE        XXH 48900000
S190     ZAP   ITEMCNT,=P'0'       SET CTR OF OUTPUT ITEMS = 0          48950000
         MVI   QUITSW,X'00'        TURN OFF OUTPUT-FULL-SW.    @OZ31883 48970007
         SR    15,15                                                    49000000
         IC    15,DBLWD+6              UPDATE SLOT COUNTER              49050000
         SH    15,=H'1'                    FOR PAGING IN                49100000
         STC   15,SLOTCNT              LINE OR CTRL DISPLAYS.           49150000
         UNPK  DBLWD,LINEIDA(4)        MOVE LINE ADDRESS                49200000
         TR    DBLWD+4(3),HXTOEB                TO                      49250000
         MVC   LINENAME(3),DBLWD+4     SAVE AREA FOR RECAP HDR.         49300000
         MVC   LINENAME+3(5),=CL5' '        CLEAR OUT GARBAGE           49350000
         XC    PARM4,PARM4                                              49400000
         CLI   ENTRYTYP,X'91'          IS THIS AN MDR ENTRY?            49450000
         BE    S210                         YES.                        49500000
         CLI   OBRUCB,X'40'            IS THIS A REMOTE OBR ?           49550000
         BNE   S200                         NO.                         49600000
         UNPK  CLUSNAME(3),OBRCTRL(2)       MOVE MDR DUMMY LINE ADDR    49650000
         TR    CLUSNAME(2),HXTOEB                TO                     49700000
         MVC   CLUSNAME+2(6),=CL6' '        SAVE AREA FOR RECAP HDR.    49750000
         MVC   PARM4(2),CLUSNAME              MOVE  ADDR  TO PARM4      49800000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)   49850000
S200     MVC   CLUSNAME,LINENAME       MOVE OBR CTRL ADDR. TO SAVE AREA 49900000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)   49950000
S210     UNPK  CLUSNAME(3),MDRCTRL(2)       MOVE MDR CTRL ADDR.         50000000
         TR    CLUSNAME(2),HXTOEB                TO                     50050000
         MVC   CLUSNAME+2(6),=CL6' '        SAVE AREA FOR RECAP HDR.    50100000
         MVC   PARM4(2),CLUSNAME       MOVE MDR CTRL ADDR. TO PARM4     50150000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)   50200000
*********************************************************************** 50250000
*                                                                     * 50300000
*   THIS IS THE MOD-1 'LINE' AND 'CTRL' TABLE BUILD ROUTINE           * 50350000
*                                                                     * 50400000
*********************************************************************** 50450000
S215     CLI   ENTRYTYP,X'91'      IS THIS AN MDR?                  XXH 50500000
         BE    S218                YES. SAVE MDR CTRL UNIT     @OZ31879 50550007
         CLI   OBRUCB,X'40'        IS THIS A REMOTE OBR ?      @OZ31879 50560007
         BNE   S220                NO. BYPASS SAVING CTRL UNIT @OZ31879 50570007
         MVC   TBCTRL,OBRCTRL      YES. SAVE REMOTE OBR CU     @OZ31879 50580007
         B     S220                                            @OZ31879 50590007
S218     MVC   TBCTRL,MDRCTRL      SET TBCTRL = MDRCTRL        @OZ31879 50600007
S220     MVC   TBLINE,LINEIDA      SAVE CURRENT LINE ID                 50650000
         XC    RELREC,RELREC       POINT TO FIRST CONTROL BLOCK.        50700000
         BAL   LINKREG,READ        GET FIRST CONTROL BLOCK.             50750000
         L     FIOABAR,IOAREA      POINT TO FIOA AREA.                  50800000
         OC    CTRLENTS,CTRLENTS   ANY LINE ENTRIES?                    50850000
         BZ    Z30                 NO. WRITE 'NO LINE ERRORS'           50900000
         SR    DATALOOP,DATALOOP                                        50950000
         IC    DATALOOP,CTRLENTS   SET LOOP CTR FOR READING SLOTS.      51000000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT IN BLOCK.        51050000
S220A    CLC   TBLINE,SLOTLINE     IS THIS CONTROL SLOT FOR OUR LINE?   51100000
         BE    S222                YES. GO GET DETAIL BLOCK.            51150000
         LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           51200000
         BCT   DATALOOP,S220A      CHECK NEXT SLOT.                     51250000
         CLC   CTRLFWD,=F'0'       MORE CONTROL BLOCKS?                 51300000
         BE    Z10                 NO. GO WRITE 'NO LINE ERRORS'        51350000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        51400000
         BAL   LINKREG,READ                                             51450000
         L     FIOABAR,IOAREA      POINT TO INPUT RECORD AREA           51500000
         SR    DATALOOP,DATALOOP                                        51550000
         IC    DATALOOP,CTRLENTS   SET SLOT LOOP CONTROL                51600000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT.                 51650000
         B     S220A                                                    51700000
S222     ZAP   TABLECNT,=P'0'      SET CTR OF TABLE ITEMS = 0           51750000
         LA    MOD1REG,MOD1TABL    POINT TO MOD-1 TABLE                 51800000
         MVC   RELREC,SLOTRFB      MOVE POINTER TO DETAIL BLK           51850000
S222A    MVC   SVRELREC,RELREC     SAVE FOR COMPARE TO TABLE RELREC     51900000
         BAL   LINKREG,READ                                             51950000
         L     FIOABAR,IOAREA      POINT TO INPUT RECORD AREA           52000000
         SR    DATALOOP,DATALOOP                                        52050000
         LH    DATALOOP,BLKLTH     SET SLOT LOOP CONTROL                52100000
         LA    DATAREG,DATASLT1    POINT FOR FIRST SLOT                 52150000
         MVI   SLOTCNT,X'01'       SET COUNT OF DETAIL BLK SLOTS=1      52200000
         MVC   RELREC,DATAFWD      SAVE NEXT DETAIL BLK ADDR.           52250000
S222B    CLC   SVRELREC,TBRELREC   IS THIS THE RIGHT DETL BLK ?         52300000
         BNE   S222B10             NO. CONTINUE SCAN                    52350000
         CLC   SLOTCNT,TBSLOT      IS THIS THE RIGHT ENTRY ?            52400000
         BNE   S222B10             NO. CONTINUE SCAN                    52450000
S222B03  MVI   MOD1SW,X'FF'        TURN MOD-1 SWITCH ON                 52500000
S222B05  MVC   RELREC,TBRELREC     RESTORE PAGING 'BBB'                 52550000
         MVC   TWASLOT,TBSLOT      RESTORE PAGING 'SS'                  52600000
         BAL   LINKREG,LOCATE      LOCATE STARTING 'BBBSS' FOR DISP     52650000
         B     S190                RESUME PAGING SETUP                  52700000
S222B10  LA    14,MOD1TABL         POINT OT MOD-1 TABLE                 52750000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR ENTRY?                52800000
         BE    S222C               YES.                                 52850000
         CLI   ENTRYTYP,X'30'      IS IT A BTAM OBR?                    52900000
         BE    S222D               YES.                                 52950000
         CLI   ENTRYTYP,X'34'      IS IT A TCAM OBR?                    53000000
         BE    S222D               YES.                                 53050000
S222B20  SR    15,15                                                    53100000
         IC    15,SLOTCNT          ADD ONE                              53150000
         AH    15,=H'1'            TO                                   53200000
         STC   15,SLOTCNT          SLOT COUNTER.                        53250000
         SR    14,14                                                    53300000
         IC    14,DATALTH          PUT LTH OF SLOT IN WORK REG.         53350000
         AR    DATAREG,14          POINT TO NEXT DETAIL SLOT.           53400000
         SR    DATALOOP,14         MORE SLOTS IN THIS DETAIL BLK?       53450000
         BP    S222B               YES.                                 53500000
         OC    RELREC,RELREC       MORE DETAIL BLOCKS?                  53550000
         BNE   S222A               YES.                                 53600000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN MOD-1 TABLE?            53650000
         BZ    S222B05             NO. EXIT BUT DON'T TURN ON MOD-1 SW. 53700000
         B     S222B03             YES. EXIT NORMALLY                   53750000
S222C    CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?           53800000
         BE    S222C50             YES.  USE TERMINAL ADDR ONLY         53850000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?                 53900000
         BZ    S222C30             NO. ADD NEW ITEM                     53950000
S222C10  CLC   0(1,14),MDRCTRL     IS THIS CTRL UNIT IN THE TABLE ?     54000000
         BE    S222B20             YES.  BYPASS THIS ENTRY              54050000
         LA    14,2(14)            BUMP TO NEXT ENTRY                   54100000
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM COUNT         54150000
         BZ    S222C30             BRANCH IF NO MORE ITEMS TO CK        54200000
         B     S222C10                                                  54250000
S222C30  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?             54300000
         BE    S222B03             YES.                                 54350000
         MVC   0(1,MOD1REG),MDRCTRL     STORE IN TABLE                  54400000
         B     S228                                                     54450000
S222C50  CLC   TBCTRL,MDRCTRL      DOES CTRLUNIT ENTRY = REQSTED CU?XXH 54500000
         BNE   S222B20             NO. BYPASS PUTTING TERM IN TABLE XXH 54550000
         ZAP   WKTBLCNT,TABLECNT                                    XXH 54600000
         BZ    S222C70                                                  54650000
S222C60  CLC   0(1,14),MDRTERM     IS THIS TERMINAL IN THE TABLE ?      54700000
         BE    S222B20             YES. BYPASS THIS ENTRY               54750000
         LA    14,2(14)            BUMP TO NEXT ENTRY                   54800000
         SP    WKTBLCNT,=PL2'1'                                         54850000
         BZ    S222C70                                                  54900000
         B     S222C60                                                  54950000
S222C70  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?             55000000
         BE    S222B03             YES.                                 55050000
         MVC   0(1,MOD1REG),MDRTERM    PUT REMOTE TERMINAL INTO TABLE   55100000
         B     S228                                                     55150000
S222D    CLI   OBRUCB,X'10'        IS THIS A LOCAL?                     55200000
         BE    S222G               YES. GO MOVE 3-BYTE ADDR             55250000
         CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?  @OZ31879 55300007
         BE    S222D50             YES.  USE TERMINAL ADDR ONLY@OZ31879 55305007
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?        @OZ31879 55310007
         BZ    S222D30             NO. ADD NEW ITEM            @OZ31879 55315007
S222D10  CLC   0(1,14),OBRCTRL     IS THIS CTRL UNIT IN TABLE? @OZ31879 55320007
         BE    S222B20             YES.  BYPASS THIS ENTRY     @OZ31879 55325007
         LA    14,2(14)            BUMP TO NEXT ENTRY          @OZ31879 55330007
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM COUNT@OZ31879 55335007
         BZ    S222D30             BRANCH IF NO MORE ITEMS     @OZ31879 55340007
         B     S222D10                                         @OZ31879 55345007
S222D30  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?    @OZ31879 55350007
         BE    S222B03             YES.                        @OZ31879 55355007
         MVC   0(1,MOD1REG),OBRCTRL     STORE IN TABLE         @OZ31879 55360007
         B     S228                                            @OZ31879 55365007
S222D50  CLC   TBCTRL,OBRCTRL      DOES CU ENTRY = REQSTED CU? @OZ31879 55370007
         BNE   S222B20             NO. DON'T PUT TERM IN TBL   @OZ31879 55375007
         ZAP   WKTBLCNT,TABLECNT                               @OZ31879 55380007
         BZ    S222D70                                         @OZ31879 55385007
S222D60  CLC   0(1,14),OBRTERM     IS THIS TERMINAL IN THE TBL?@OZ31879 55390007
         BE    S222B20             YES. BYPASS THIS ENTRY      @OZ31879 55395007
         LA    14,2(14)            BUMP TO NEXT ENTRY          @OZ31879 55400007
         SP    WKTBLCNT,=PL2'1'                                @OZ31879 55405007
         BZ    S222D70                                         @OZ31879 55410007
         B     S222D60                                         @OZ31879 55415007
S222D70  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?    @OZ31879 55420007
         BE    S222B03             YES.                        @OZ31879 55425007
         MVC   0(1,MOD1REG),OBRTERM   PUT REMOTE TERM IN TABLE @OZ31879 55430007
         B     S228                                            @OZ31879 55435007
S222G    CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY ?           55450000
         BE    S222B20             YES. BYPASS THIS ERROR DATA          55500000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?        @OZ31879 55550007
         BZ    S225                NO. ADD NEW ITEM TO TABLE   @OZ31879 55600007
S224     CLC   0(2,14),OBRCUA      ARG MATCH TABLE ENTRY ?     @OZ31879 55650007
         BE    S222B20             YES.  BYPASS THIS ARGUMENT  @OZ31879 55700007
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM CNT  @OZ31879 55750007
         BZ    S225                NO MORE ITEMS TO CK--SO ADD @OZ31879 55800007
*                                  THIS NEW ITEM TO TABLE               55950000
         LA    14,2(14)            BUMP TO NEXT TABLE ENTRY             56000000
         B     S224                GO CK ANOTHER ENTRY         @OZ31879 56050007
S225     CP    TABLECNT,=P'32'     MORE THAN 33 ENTRIES--USER  @OZ31879 56090007
*                                  MUST BE PAGING FROM MOD-2   @OZ31879 56130007
         BE    S222B03             PREPARE TO EXIT ROUTINE.    @OZ31879 56170007
         MVC   0(2,MOD1REG),OBRCUA ADD CTRL UNIT TO MOD-1 TABLE@OZ31879 56210007
S228     LA    MOD1REG,2(MOD1REG)  UPDATE TABLE POINTER.       @OZ31879 56250007
         AP    TABLECNT,=P'1'      ADD 1 TO COUNT OF TABLE ITEMS        56350000
         B     S222B20             GO CK ANOTHER ENTRY                  56400000
*********************************************************************** 56450000
*                                                                     * 56500000
*   THIS IS THE MOD-1 TABLE SCANNER ROUTINE                           * 56550000
*                                                                     * 56600000
*********************************************************************** 56650000
MOD1SCAN LA    MOD1REG,MOD1TABL    POINT TO MOD-1 TABLE                 56700000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?                 56750000
         BZ    MOD1EXIT            NO. EXIT AND LEAVE TBARG = ADDR.     56800000
MOD1LOOP CLC   0(2,MOD1REG),TBARG  ARG MATCH TABLE ENTRY ?              56850000
         BE    MOD1PASS            YES.  BYPASS THIS ARGUMENT           56900000
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM CNT           56950000
         BZ    MOD1EXIT            NO MORERE ITEMS TO CK--SO EXIT       57000000
         LA    MOD1REG,2(MOD1REG)  BUMP TO NEXT TABLE ENTRY             57050000
         B     MOD1LOOP            GO CHECK ANOTHER ENTRY               57100000
MOD1PASS MVC   TBARG,=X'0000'      CLEAR ARGUMENT = DO NOT USE          57150000
MOD1EXIT BR    LINKREG             RETURN TO CALLER                     57200000
*********************************************************************** 57250000
*                                                                     * 57300000
*        THIS IS THE LOCATE ROUTINE                                   * 57350000
*                                                                     * 57400000
*********************************************************************** 57450000
LOCATE   ST    11,SAVE11                                                57500000
         LA    11,PARMADDR         SET UP PARM REG                      57550000
         L     15,=V(BNGIREAD)    POINT TO READ MODULE                  57600000
         BALR  14,15              LINK TO BDAM READ MODULE              57650000
         L     11,SAVE11                                                57700000
         OC    STATUS,STATUS      READ OK?                              57750000
         BZ    S230               YES.                                  57800000
         CLC   STATUS,=C'FF'       WAS EMFILE OPENED?                   57850000
         BE    Z60                 NO.  WRITE 'NOT OPEN' MSG            57900000
*        UNPK  DBLWD,STATUS(2)                                          57950000
*        MVC   IOERCODE,DBLWD+5                                         58000000
*        TR    IOERCODE,HXTOEB     MOVE BDAM RETURN CODE TO I/O ERR MSG 58050000
*        UNPK  DBLWD,RELREC(4)                                          58100000
*        MVC   IOERBLK,DBLWD+4     MOVE BLK NBR THAT WAS BEING READ     58150000
*        TR    IOERBLK,HXTOEB                                           58200000
         B     Z90                     IF REQUESTED SLOT CAN'T          58250000
*                                        BE FOUND, SEND 'SEARCHING ERR' 58300000
*********************************************************************** 58350000
S230     L     FIOABAR,IOAREA      POINT TO DATA BLK.                   58400000
         MVC   SVRELREC,RELREC     SAVE FOR LAST BBBSS'S                58450000
         CLC   PARM2(3),=C'ALL'    IS THIS 'ALL' BEING CONTINUED?       58500000
         BNE   S250                NO. GO SETUP FOR DATA BLOCK.         58550000
         CLC   TWASLOT,CTRLENTS    YES. SETUP FOR CNTRL BLOCK.          58600000
         BH    S290                QUIT IF GARBAGE KEYED IN.            58650000
         LA    DATAREG,CTRLSLT1                                         58700000
         SR    DATALOOP,DATALOOP   LOOP THRU CONTROL                    58750000
         IC    DATALOOP,CTRLENTS   BLOCK TILL REQUESTED SLOT NBR        58800000
         SR    1,1                 IS SATISFIED.                        58850000
         IC    1,TWASLOT                                                58900000
S235     BCT   1,S240                                                   58950000
         BR    LINKREG                                                  59000000
S240     BCTR  DATALOOP,0                                               59050000
         LA    DATAREG,SLOTLTH(DATAREG)                                 59100000
         B     S235                                                     59150000
S250     LH    DATALOOP,BLKLTH     SETUP LOOP NBR BYTES THIS BLK.       59200000
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM             59250000
S260     CLI   TWASLOT,2           IF RQSTED SLOT = 1, THIS IS IT.      59300000
         BL    0(LINKREG)          GO RESUME DISPLAY BUILDING.          59350000
         SR    1,1                                                      59400000
         IC    1,TWASLOT           DECREMENT SLOT COUNT BY 1.           59450000
         BCTR  1,0                                                      59500000
         STC   1,TWASLOT                                                59550000
         IC    1,0(DATAREG)        BUMP TO NEXT SLOT.                   59600000
         LTR   1,1                                                      59650000
         BZ    S290                PREVENT LOOP IF GARBAGE INPUT.       59700000
         AR    DATAREG,1                                                59750000
         SR    DATALOOP,1                                               59800000
         LTR   DATALOOP,DATALOOP   VERIFY SLOT NBR VALID FOR THIS BLK.  59850000
         BP    S260                                                     59900000
S290     MVC   ERRDATA(MSG5LTH),MSG5   IF REQUESTED SLOT CAN'T          59950000
ERRISRT  L     PCBREG,IOPCB              BE FOUND, SEND 'SEARCHING ERR' 60000000
         CALL  ASMTDLI,(ISRT,(PCBREG),ERROUT,LGERR),VL                  60050000
         B     CHECKST                                                  60100000
*********************************************************************** 60150000
Z10      CLC   PARM2(4),=C'CTRL'      IS PARM2 = CTRL ?                 60200000
         BE    Z50                    YES.                              60250000
         MVC   ERRDATA(MSG4LTH),MSG4                                    60300000
         B     ERRISRT                                                  60350000
Z20      MVC   ERRDATA(MSG1LTH),MSG1                                    60400000
         B     ERRISRT                                                  60450000
Z30      MVC   ERRDATA(MSG3LTH),MSG3                                    60500000
         B     ERRISRT                                                  60550000
Z40      MVC   ERRDATA(MSG6LTH),MSG6                                    60600000
         B     ERRISRT                                                  60650000
Z50      CLC   MSG7CTRL,=CL2' '       REMOTE CTRL UNIT PRESENT?         60700000
         BE    Z80                    NO. IT MUST BE LOCAL CTRL UNIT    60750000
         MVC   ERRDATA(MSG7LTH),MSG7                                    60800000
         B     ERRISRT                                                  60850000
Z60      MVC   ERRDATA(MSG9LTH),MSG9                                    60900000
         B     ERRISRT                                                  60950000
Z70      MVC   MSG2TERM,PARM3         MOVE SYMBOLIC NAME TO ERROR MSG   61000000
         OC    MSG2TERM,=CL8' '       CONVERT X'00' TO BLANK            61050000
         MVC   ERRDATA(MSG2LTH),MSG2                                    61100000
         B     ERRISRT                                                  61150000
Z80      MVC   MSG8CTRL,MSG7LINE      MOVE LOCAL LINE TO CTRL ADDR      61200000
         MVC   ERRDATA(MSG8LTH),MSG8  SINCE CTRL ADDR=LINE ADDR (LOCL)  61250000
         B     ERRISRT                                                  61300000
Z90      MVC   ERRDATA(MSG5LTH),MSG5                                    61350000
         B     ERRISRT                                                  61400000
Z100     MVC   ERRDATA(MSG10LTH),MSG10                         @OZ29912 61410007
         B     ERRISRT                                         @OZ29912 61420007
Z130     MVC   MSG13LN,MSG7LINE                                @OZ31886 61427007
         MVC   ERRDATA(MSG13LTH),MSG13                         @OZ31886 61434007
         B     ERRISRT                                         @OZ31886 61441007
         EJECT                                                          61450000
ERROUT   DS    0D              MAP OF TRANSACTION MESSAGE SEGMENT:      61500000
ERROLL   DC    H'121'              MESSAGE LENGTH INCL. LL,Z1,Z2,DATA   61550000
ERROZ1   DC    X'00'               FLAG FIELD - USED BY IMS INTERNALLY  61600000
ERROZ2   DC    X'00'               FLAG FIELD - NON-ZERO IF MFS EDITED  61650000
ERRDATA  DS    CL117               START OF MESSAGE DATA                61700000
MSG1     DC    CL39'BNG001A I I/O ERR READING SYS1.DEMFLOG '            61750000
         DC    CL28'    THE BDAM RETURN CODE IS'                        61800000
IOERCODE DC    CL4'0'                                                   61850000
         DC    CL7' '                                                   61900000
         DC    CL34'THE BDAM RELATIVE BLOCK NUMBER IS '                 61950000
IOERBLK  DC    CL3'0'                                                   62000000
         DC    C'  '                                                    62050000
MSG1LTH  EQU   *-MSG1                                                   62100000
MSG2     DC    CL39'BNG002I I UNABLE TO CONVERT SYMBOLIC '              62150000
         DC    C'TERMINAL NAME '                                        62200000
MSG2TERM DC    CL8' '                                                   62250000
MSG2LTH  EQU   *-MSG2                                                   62300000
MSG3     DC    CL39'BNG003I I NO ERRORS RECORDED '                      62350000
MSG3LTH  EQU   *-MSG3                                                   62400000
MSG4     DC    CL39'BNG004I I NO ERRORS RECORDED FOR   '                62450000
         DC    C'LINE '                                                 62500000
MSG4LN   DC    CL3' '                                                   62550000
MSG4LTH  EQU   *-MSG4                                                   62600000
MSG5     DC    CL39'BNG005I I ERROR NOT FOUND ON FILE FOR '             62650000
         DC    C'THE SELECTED ITEM '                                    62700000
MSG5LTH  EQU   *-MSG5                                                   62750000
MSG6     DC    CL39'BNG006I I INVALID FORMAT--CHECK PAGE 2 '            62800000
         DC    C'OF MENU FOR CORRECT FORMATS'                           62850000
MSG6LTH  EQU   *-MSG6                                                   62900000
MSG7     DC    CL39'BNG007I I NO ERRORS RECORDED FOR REMOTE'            62950000
         DC    C'LINE '                                                 63000000
MSG7LINE DC    CL3' '                                                   63050000
         DC    C'    CONTROL UNIT '                                     63100000
MSG7CTRL DC    CL2' '                                                   63150000
MSG7LTH  EQU   *-MSG7                                                   63200000
MSG8     DC    CL39'BNG008I I NO ERRORS RECORDED FOR    '               63250000
         DC    C'LOCAL CONTROL UNIT '                                   63300000
MSG8CTRL DC    CL3' '                                                   63350000
MSG8LTH  EQU   *-MSG8                                                   63400000
MSG9     DC    C'BNG009A I SYS1.DEMFLOG FILE NOT OPEN   '               63450000
MSG9LTH  EQU   *-MSG9                                                   63500000
MSG10    DC    CL10'BNG010I I '                                @OZ29912 63508007
MSG10NAM DC    CL8' '                                          @OZ29912 63516007
         DC    CL21' IS A VTAM TERMINAL. '                     @OZ29912 63524007
         DC    CL39'FOR INQUIRY, GIVE DEMF HARDWARE ADDRESS'   @OZ29912 63532007
MSG10LTH EQU   *-MSG10                                         @OZ29912 63540007
MSG13    DC    CL39'BNG013A I NO DATA BLOCKS AVAILABLE FOR '   @OZ31886 63541007
         DC    CL5'LINE '                                      @OZ31886 63542007
MSG13LN  DC    CL3' '                                          @OZ31886 63543007
         DC    CL31':  DATA BASE IN DEGRADED MODE. '           @OZ31886 63544007
         DC    CL39'MUST ALLOCATE MORE BLOCKS THAN LINES'      @OZ31886 63545007
MSG13LTH EQU   *-MSG13                                         @OZ31886 63546007
*********************************************************************** 63550000
DTLENTRY DC    C' (? ) '                                                63600000
DTLITEM  DC    CL8' '                                                   63650000
DTLCOUNT DC    CL4'0001'                                                63700000
DTLLTH   EQU   *-DTLENTRY                                               63750000
ITEMLTH  EQU   DTLITEM-DTLENTRY                                         63800000
COUNTLTH EQU   DTLCOUNT-DTLENTRY                                        63850000
*********************************************************************** 63900000
CLRNTRY  DC    XL14'3F'             USED TO CLEAR FIELDS FOR OUTPUT     63950000
         DC    XL4'403F3F3F'                                            64000000
CLRLTH   EQU   *-CLRNTRY                                                64050000
*********************************************************************** 64100000
*   THE FUNCTION/COMPANION TABLE DETERMINES WHICH PROGRAM IS TO WRITE * 64150000
*   THE REQUESTED DISPLAY AND PROVIDES THE CORRECT SCREEN AND COLUMN  * 64200000
*   HEADERS FOR THAT DISPLAY.                                         * 64250000
*********************************************************************** 64300000
TABLE    DS    0F                  FUNCTION/COMPANION TABLE             64350000
         DC    C'ALL',X'00',C'LINE',XL8'00',AL2(0)                      64400000
         DC    CL39'    RECAP OF ALL LINES HAVING ERRORS',AL2(0)        64450000
         DC    CL39'       LINEID  ERRS        LINEID  ERRS'            64500000
SLOT2    DC    C'ALL',X'40',C'LINE',XL8'00',AL2(0)                      64550000
         DC    CL39'    RECAP OF ALL LINES HAVING ERRORS',AL2(0)        64600000
         DC    CL39'       LINEID  ERRS        LINEID  ERRS'            64650000
         DC    C'LINECTRL',XL8'00',AL2(0)                               64700000
         DC    CL39'    RECAP OF LINE',AL2(0)                           64750000
         DC    CL39'      CTRLUNIT ERRS       CTRLUNIT ERRS'            64800000
         DC    C'CTRLTERM',XL8'00',AL2(0)                               64850000
         DC    CL39'RECAP OF CTRL UNIT',AL2(0)                          64900000
         DC    CL39'       TERMID  ERRS        TERMID  ERRS'            64950000
         DC    C'3270',XL4'00',C'BNGI3270',CL82' '                      65000000
         DC    C'LOCA',XL4'00',C'BNGILOCL',CL82' '                      65050000
         DC    C'REMO',XL4'00',C'BNGIRMOT',CL82' '                      65100000
         DC    C'END'                                                   65150000
TABLELTH EQU   *-TABLE                                                  65200000
TABLENTY EQU   SLOT2-TABLE                                              65250000
HDRPG    DC    C'(?) PAGE FORWARD'                                      65300000
         DC    C'(?) PAGE BACKWRD'                                      65350000
HXTOEB   DC    4XL16'00',C' ',XL15'00',7XL16'00'  THIS TABLE CONVERTS   65400000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  HEX CHARS           65450000
         DC    2XL16'00'                CHARS FA-THRU-FF BACK           65500000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  A THRU F            65550000
EBTOHX   DC    X'00000000000000000000000000000000'     00-0F  THIS      65600000
         DC    X'00000000000000000000000000000000'     10-1F  TABLE     65650000
         DC    X'00000000000000000000000000000000'     20-2F  CONVERTS  65700000
         DC    X'00000000000000000000000000000000'     30-3F  INPUT     65750000
         DC    X'00000000000000000000000000000000'     40-4F  A THRU F  65800000
         DC    X'00000000000000000000000000000000'     50-5F    TO      65850000
         DC    X'00000000000000000000000000000000'     60-6F  0A - 0F   65900000
         DC    X'00000000000000000000000000000000'     70-7F   AND      65950000
         DC    X'00000000000000000000000000000000'     80-8F  F0 - F9   66000000
         DC    X'00000000000000000000000000000000'     90-9F    TO      66050000
         DC    X'00000000000000000000000000000000'     A0-AF  00 - 09   66100000
         DC    X'00000000000000000000000000000000'     B0-BF    AND     66150000
         DC    X'000A0B0C0D0E0F000000000000000000'     C0-CF     *      66200000
         DC    X'00000000000000000000000000000000'     D0-DF   BECOME   66250000
         DC    X'00000000000000000000000000000000'     E0-EF    FF.     66300000
         DC    X'00010203040506070809000000000000'     F0-FF            66350000
*********************************************************************** 66400000
MOD1TABL DS    CL64          MAX OF 32 ENTRIES FOR MOD-1 TABLE          66450000
*                              LOCAL TERM = 2-BYTES                     66500000
*                              REMOTE CU AND TERM = 2-BYTES             66550000
TBRELREC DS    CL3           SAVE AREA FOR PAGING 'BBB'                 66600000
TBSLOT   DS    C             SAVE AREA FOR PAGING 'SS'                  66650000
TBCTRL   DS    C             SAVE AREA FOR MDR CTRL UNIT                66700000
TBLINE   DS    CL6           SAVE AREA FOR LINE ADDR OF PAGE            66750000
TBARG    DS    CL2           SAVE AREA FOR TABLE ARGUMENT               66800000
TABLECNT DS    PL2           COUNT OF ENTRIES IN TABLE                  66850000
WKTBLCNT DS    PL2           WORK AREA FOR COUNT OF TABLE ENTRIES       66900000
MOD1SW   DS    X             00 = OFF    FF = ON                        66950000
*                            IF ON, PERFORM MOD1 TABLE SCAN             67000000
*********************************************************************** 67050000
LINEID   DS    XL6                 HARDWARE LINE ADDRESS                67100000
LINENAME DS    CL8           LINE NAME SAVE AREA FOR RECAP HEADER       67150000
CTRLID   DS    X                   HARDWARE CONTROL UNIT ADDRESS        67200000
CTRLNAME DS    CL8           CTRL/CLUSTER NAME WORK AREA FOR OUTPUT     67250000
TERMNAME DS    CL8                 TERML/LOGICAL UNIT NAME WORK AREA    67300000
CLUSNAME DS    CL8           CTRL/CLUSTER NAME SAVE AREA FOR RECAP HDR. 67350000
NEWPARM  DS    C                   NEW-PARM SWITCH                      67400000
CTRPARM  DS    C                   COUNTER OF CHARS STORED IN PARM(X)   67450000
SAVETIOA DS    F                   SAVE AREA FOR ORIGINAL TIOA          67500000
TWASLOT  DS    C                   INPUT SLOT COUNT IN HEX              67550000
*                                  DISPLACEMENTS IN TIOA                67600000
SAVERCAP DS    F                   SAVEAREA FOR POINTER TO RECAP LINE   67650000
SAVEITEM DS    F                   SAVEAREA FOR POINTER TO FIRST LINE   67700000
*                                  AND CTRL DISPLAYS                    67750000
SLOTCNT  DS    C                   COUNT OF DETAIL SLOTS READ           67800000
ITEMCNT  DS    PL2                 COUNT OF OUTPUT ITEMS IN LINE        67850000
WORKCNT  DS    PL2                 ITEM WORK COUNTER                    67900000
WORK15   DS    CL15                                                     67950000
QUITSW   DS    C             USED TO STOP EDIT OF INPUT ON 3RD SBA      68000000
*                             IF 2ND SBA = L1P7                         68050000
*********************************************************************** 68100000
         EJECT                                                          68150000
FINISH   DC    AL2(FINISHE-FINISH),XL2'0',C'FUNCTION COMPLETE'          68200000
FINISHE  EQU   *                                                        68250000
* PATCH AREA AND PROGRAM CONSTANTS                                      68300000
         SPACE                                                          68350000
         DC    C'PATCH AREA S-CONS:',256S(*)                            68400000
EPSAVE   DS    F                                                        68450000
PARMADDR DS    0F                                                       68500000
IOAREA   DC    A(0)                                                     68550000
RELREC   DC    XL3'0'                                                   68600000
STATUS   DC    CL2'  '                                                  68650000
IOPCB    DC    F'0'                                                     68700000
SAVEDCB  DC    F'0'                                                     68750000
GU       DC    CL4'GU'             GET UNIQUE FUNCTION - GET MSG/RECORD 68800000
ISRT     DC    CL4'ISRT'           INSERT FUNCTION - OUTPUT TO TERMINAL 68850000
DLIOK    DC    CL2' '              DL/I STATUS SAYS OPERATION PERFORMED 68900000
DLIQC    DC    CL2'QC'             DL/I STATUS SAYS NO MORE TRANSACTION 68950000
LGALL    DC    CL8'BNGIOALL'       MFS MESSAGE OUTPUT DESCRIPTOR NAME   69000000
LGERR    DC    CL8'BNGIOERR'       MFS MESSAGE OUTPUT DESCRIPTOR NAME   69050000
* STORAGE AND WORK AREA DEFINITIONS                                     69100000
COMMAREA DS    0D                                                       69150000
PARM1    DC    D'0'                1ST INPUT PARM - DEMF                69200000
PARM2    DC    D'0'                2ND INPUT PARM - ALL/LINE/CTRL/      69250000
*                                                    3270 AND MENU      69300000
PARM3    DC    D'0'                3RD INPUT PARM                       69350000
PARM4    DC    D'0'                4TH INPUT PARM                       69400000
PARM5    DC    D'0'                5TH INPUT PARM                       69450000
PARM6    DC    D'0'                6TH INPUT PARM                       69500000
FLDCNT   DC    P'0'                COUNT OF FLD'S IN INPUT              69550000
SVRELREC DC    CL3' '        SAVE AREA FOR LINE/CTRL RELATIVE BLOCK NO. 69600000
SAVEBBSS DS    F                   SAVE POINTER TO BLK AND SLOT         69650000
DBLWD    DC    D'0'                DOUBLEWORD WORK AREA                 69700000
DUBLWD   EQU   DBLWD                                                    69750000
FULLWD   DC    F'0'                FULLWORD WORK AREA                   69800000
TWALINE  DC    D'0'          SAVE AREA FOR  IMS SYMBOLIC LINE POINTER   69850000
* THE FOLLOWING INPUT AREA IS USED FOR DEMF                             69900000
* TRANSACTION MESSAGES, WITH MAPPING AS SHOWN.                          69950000
         SPACE                                                          70000000
MSGIN    DS    0D              MAP OF TRANSACTION MESSAGE SEGMENT:      70050000
TIOATDL  DS    H                   MESSAGE LENGTH INCL. LL,Z1,Z2,DATA   70100000
MSGZ1    DS    X                   FLAG FIELD - USED BY IMS INTERNALLY  70150000
MSGZ2    DS    X                   FLAG FIELD - NON-ZERO IF MFS EDITED  70200000
TIOADBA  DS    0F                  START OF MESSAGE DATA                70250000
MSGTXCD  DS    CL5                    DEMF                              70300000
MSGKEYED DS    CL29                   29-BYTE KEY-IN AREA               70350000
MSGCMDCD DS    CL4                    ALL /LINE/CTRL/3270/MENU          70400000
MSGPGF   DS    C                      PAGE FORWARD                      70450000
MSGID    DS    CL20                   IMS SYMBOLIC NAME FOR RQSD TERMNL 70500000
MSGPGB   DS    C                      PAGE BACKWARD                     70550000
MSGBBBSS DS    CL15                   BLOCK AND SLOT INFO               70600000
MSGNTRY  DS    CL12                START OF X'ED-IN DATA                70650000
MSGEND   DS    79CL12                                                   70700000
MSGENDC  EQU   *                                                        70750000
         ORG   MSGPGF              MAP OF BNGIMENU OPTIONS              70800000
MSGALL   DS    C                        ALL LINES SCREEN                70850000
MSG3270  DS    C                        3270 SCREEN                     70900000
MSGRMOT  DS    C                        REMOTE SENSE/STATUS INFO        70950000
MSGLOCL  DS    C                        LOCAL SENSE/STATUS INFO         71000000
MSGDPRSS DS    CL7                   DEPRESS FOR PAGE 2 OF MENU         71050000
         ORG   MSGENDC                                                  71100000
*                                                                       71150000
*   FROM HERE UP MUST REMAIN IN THAT ORDER                              71200000
*                                                                       71250000
*********************************************************************** 71300000
* THE FOLLOWING AREA IS USED AS OUTPUT AREA                             71350000
* FOR TRANSACTION MESSAGES, WITH MAPPING AS SHOWN.                      71400000
MSGOUT   DS    0D              MAP OF TRANSACTION MESSAGE SEGMENT:      71450000
MSGOLL   DC    AL2(MSGLTH)         MESSAGE LENGTH INCL. LL,Z1,Z2,DATA   71500000
MSGOZ1   DC    X'00'               FLAG FIELD - USED BY IMS INTERNALLY  71550000
MSGOZ2   DC    X'00'               FLAG FIELD - NON-ZERO IF MFS EDITED  71600000
MSGODATA DS    0F                  START OF MESSAGE DATA                71650000
MSGCMD   DS    CL4                                                      71700000
MSGPG    DS    CL32                                                     71750000
LGBBBSS  DS    CL15                                                     71800000
SMBBBSS  DS    CL15                                                     71850000
MSGRECAP DS    CL39                                                     71900000
MSGHDR1  DS    CL39                                                     71950000
MSGHDR2  DS    CL41                                                     72000000
MSGODAT1 DS    13CL18                                                   72050000
MSGODAT2 DS    66CL18                                                   72100000
MSGODAT3 DS    CL12                                                     72150000
MSGENDLG DS    CL4                                                      72200000
MSGENDSM DS    CL4                                                      72250000
MSGLTH   EQU   *-MSGOUT                                                 72300000
         LTORG                                                          72350000
         END   BNGIDISP                                                 72400000
./  ADD  SSI=81180057,NAME=BNGIEXIT
         PRINT OFF                                                      00050007
         MACRO                                                          00050407
&NAME    BNGHJN &LABEL,&HJN                                             00050807
         LCLC  &HJA,&HJB                                                00051207
&HJA     SETC  '&SYSPARM'(1,4)                                          00051607
&HJB     SETC  '&SYSPARM'(5,4)                                          00052007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00052407
         B     &LABEL .                 BR AROUND CONSTANTS             00052807
         SPACE 2                                                        00053207
.NOBRNCH ANOP                                                           00053607
         AIF   ('&NAME' EQ '').NOLABEL                                  00054007
         DC    C'&NAME' .              MODULE IDENTIFIER                00054407
.NOLABEL ANOP                                                           00054807
         DC    X'&HJA' .                DATE OF MODIFICATION            00055207
         AIF   ('&HJN' NE 'HJN').DATE                                   00055607
         DC    X'&HJB' .                HJN OF MODIFICATION             00056007
.DATE    ANOP                                                           00056407
         AIF   ('&LABEL' EQ '').NOLBL                                   00056807
         SPACE 2                                                        00057207
&LABEL   DS    0H                                                       00057607
.NOLBL   ANOP                                                           00058007
         MEND                                                           00058407
         PRINT ON                                                       00058807
*********************************************************************** 00059207
*                                                                     * 00100000
* MODULE NAME = BNGIEXIT                                              * 00150000
*                                                                     * 00200000
* DESCRIPTIVE NAME = IMS DEMF USER EXIT SYMBOLIC NAME CONVERSION      * 00250000
*                    MODULE                                           * 00300000
*                                                                     * 00350000
* COPYRIGHT = NONE                                                    * 00400000
*                                                                     * 00450000
* STATUS = RELEASE 1, LEVEL 1                                         * 00500000
*                                                                     * 00550000
* FUNCTION = CONVERTS SYMBOLIC NAME TO EXPLICIT HARDWARE ADDRESSES    * 00600000
*            IN THE FORM OF CONTROL/LINE/TERMINAL FOR REMOTE TERMINAL * 00650000
*            SYMBOLIC NAME OR IN THE FORM OF TERMINAL ADDRESS ONLY    * 00700000
*            FOR LOCAL TERMINAL SYMBOLIC NAME.                        * 00750000
*                                                                     * 00800000
* NOTES = NONE                                                        * 00850000
*                                                                     * 00900000
*    DEPENDENCIES =                                                   * 00950000
*                                                                     * 01000000
*    THE FOLLOWING ARE IMS CONTROL BLOCKS AND THEIR LABELS AS USED BY * 01050000
*    DEMF IMS BNGIEXIT MODULE:                                        * 01100000
*                                                                     * 01150000
*    IMS                                                              * 01200000
*    CONTROL BLOCKS                  LABELS USED                      * 01250000
*    ----------------------------    -----------                      * 01300000
*                                                                     * 01350000
*    COMMUNICATION LINE BLOCK        CLBFLAG3                         * 01400000
*    (CLB)                           CLB3DECB                         * 01450000
*                                    CLB3CL40                         * 01500000
*                                    CLBDCB                           * 01550000
*                                                                     * 01600000
*    COMMUNICATION NAME TABLE        CNTNAME1                         * 01650000
*    (CNT)                           CNTCTBPT                         * 01700000
*                                                                     * 01750000
*    COMMUNICATION TERMINAL BLOCK    CTBCLB                           * 01800000
*    (CTB)                           CTBTERM                          * 01850000
*                                                                     * 01900000
*    SYSTEM CONTENTS DIRECTORY       SCDCNT                           * 01950000
*    (SCD)                           SCDCNTN                          * 02000000
*                                    SCDCNTL                          * 02050000
*                                                                     * 02100000
*    RESTRICTIONS = NONE                                              * 02150000
*                                                                     * 02200000
*    REGISTER CONVENTIONS =  R7  ADDRESS OF COMM TERM BLOCK (CTB)     * 02250000
*                            R9  ADDRESS OF COMM LINK BLOCK (CLB)     * 02300000
*                            R10 ADDRESS OF COMM NAME TABLE (CNT)     * 02350000
*                            R11 ADDRESS OF SYSTEM CONTENTS DIR (SCD) * 02400000
*                                                                     * 02450000
*    PATCH LABEL = BNGIPTCH                                           * 02500000
*                                                                     * 02550000
* MODULE TYPE =  IMS USER EXIT                                        * 02600000
*                                                                     * 02650000
*    PROCESSOR = ASSEMBLER H                                          * 02700000
*                                                                     * 02750000
*    MODULE SIZE = 1524 DECIMAL BYTES                                 * 02800000
*                                                                     * 02850000
*    ATTRIBUTES =  SERIALLY REUSABLE                                  * 02900000
*                                                                     * 02950000
* ENTRY POINT = BNGIEXIT                                              * 03000000
*                                                                     * 03050000
*    PURPOSE = SEE FUNCTION                                           * 03100000
*                                                                     * 03150000
*    LINKAGE = R1  LOADED WITH THE PARAM LIST POINTER                 * 03200000
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 03250000
*              R15 LOADED WITH ENTRY POINT                            * 03300000
*                                                                     * 03350000
* INPUT = PARAM LIST ITEMS USED ARE :                                 * 03400000
*                                                                     * 03450000
* OUTPUT = PARAM LIST ITEMS USED ARE :                                * 03500000
*                                                                     * 03550000
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 03600000
*               00 - OPERATION PERFORMED AS REQUESTED                 * 03650000
*                                                                     * 03700000
* EXIT-ERROR  = NONE                                                  * 03750000
*                                                                     * 03800000
* EXTERNAL REFERENCE = NONE                                           * 03850000
*                                                                     * 03900000
*    ROUTINES =                                                       * 03950000
*                                                                     * 04000000
*    DATA AREAS =                                                     * 04050000
*                                                                     * 04100000
*    CONTROL BLOCK = DCB                                              * 04150000
*                                                                     * 04200000
* TABLES = SEE DEPENDENCIES ABOVE                                     * 04250000
*                                                                     * 04300000
* MACROS = SAVE, RETURN                                               * 04350000
*                                                                     * 04400000
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 04450000
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 04450107
* CHANGE 02  02/22/78  BNGHJN MACRO ADDED                             * 04450207
*D100750                                                       @OZ29911 04450307
*A078000                                                       @OZ29911 04450407
*A060000,061000,063000                                         @OZ30477 04450507
*C103500,134500                                                @OZ30477 04450607
*                                                                     * 04550000
*********************************************************************** 04600000
BNGIEXIT  TITLE  'DEMF TRANSACTION INPUT EDIT USER EXIT FOR IMS 1.1.4'  04650000
*********************************************************************** 04700000
*                                                                     * 04750000
* SINCE AN IMS MESSAGE PROCESSING PROGRAM (BMP OR MPP) HAS NO ACCESS  * 04800000
* TO IMS CONTROL BLOCKS AND ONE DESIRABLE FEATURE OF DEMF (DISPLAY    * 04850000
* EXCEPTION MONITORING FACILITY) IS THE ABILITY TO DISPLAY A TERMINAL * 04900000
* ERROR DATA WHEN ONLY ITS SYMBOLIC NAME IS KNOWN, OR NOTHING IS KNOWN* 04950000
* EXCEPT THAT IT IS CONNECTED TO AN DEMF-SUPPORTING SOFTWARE PACKAGE, * 05000000
* IMS BEING SUCH PACKAGE, SOME WAY NEEDED TO BE FOUND TO OBTAIN LINE, * 05050000
* CONTROL UNIT, AND TERMINAL ADDRESSES, AVAILABLE ONLY IN THE IMS     * 05100000
* CONTROL REGION, AND PASS THIS DATA TO THE DEMF TRANSACTION PROCESSOR, 05150000
* EXECUTING IN ITS OWN SEPARATE REGION. DEMF DATA IS ACCESSED BY LINE,* 05200000
* CONTROL UNIT AND TERMINAL ADDRESSES, NOT BY SYMBOLIC. THE EASIEST WAY 05250000
* TO IMPLEMENT THIS FUNCTION IS BY IMS TRANSACTION INPUT EDIT USER EXIT 05300000
* THIS PROGRAM BEING SUCH EXIT FOR DEMF TRANSACTIONS. IF OMITTED FROM * 05350000
* THE IMS CONTROL REGION,THE ONLY EFFECT TO DEMF IS THAT EXCEPTION DATA 05400000
* WILL BE AVAILABLE ONLY BY LINE, CONTROL UNIT AND TERMINAL ADDRESSES * 05450000
* ENTERED BY THE OPERATOR.                                            * 05500000
*                                                                     * 05550000
* A SPECIAL OPERAND WILL BE ADDED TO DEMF TRANSACTION MESSAGES BY THIS* 05600000
* PROGRAM TO INDICATE THE LINE, CONTROL UNIT AND TERMINAL ADDRESS OF  * 05650000
* THE TERMINAL MAKING THE REQUEST & OF ANOTHER TERMINAL WHOSE SYMBOLIC* 05700000
* NAME IS KNOW. TRANSACTIONS MODIFIED BY THIS PROGRAM AND THE RESULTS * 05750000
* PASSED TO THE DEMF TRANSACTION PROCESSOR ARE AS FOLLOW:             * 05800000
*                                                                     * 05850000
*    TRANSACTION ENTERED:        TRANSACTION PASSED TO PROCESSOR:     * 05900000
*        DEMF 3270                   DEMF 3270 X'FF'LLLCCTT - REMOTE  * 05950000
*        DEMF 3270                   DEMF 3270 X'FF'TTT     - LOCAL   * 06000000
*        DEMF 3270 (VTAM TERMINAL)   DEMF 3270 X'FE'VTAMNAME - @OZ30477 06020007
*        DEMF 3270 SYMBNAME          DEMF 3270 SYMBNAME X'FF'LLLCCTT  * 06050000
*        DEMF 3270 SYMBNAME          DEMF 3270 SYMBNAME X'FF'TTT      * 06100000
* DEMF 3270 SYMBNAME(VTAM)    DEMF 3270 SYMBNAME X'FE'VTAMNAME @OZ30477 06120007
*        DEMF 3270 N1 N2 ...         INPUT PASSED TO DISP UNCHANGED   * 06150000
*        DEMF (29-BYTES) MENU (X'ED 3270 OPTION)                      * 06200000
*                                    DEMF 3270 X'FF'LLLCCTT - REMOTE  * 06250000
*                                    DEMF 3270 X'FF'TTT     - LOCAL   * 06300000
*                                    DEMF 3270 X'FE'VTAMNAME - @OZ30477 06304007
*                                                              @OZ30477 06308007
* THE X'FE' IS A SPECIAL INDICATOR MEANING THAT THE FOLLOWING  @OZ30477 06312007
* DATA IS:                                                     @OZ30477 06316007
*                                                              @OZ30477 06320007
*     VTAMNAME - VTAM NODE NAME                                @OZ30477 06324007
*                                                              @OZ30477 06328007
*     SINCE THERE IS NO WAY TO CONVERT AN IMS SYMBOLIC         @OZ30477 06332007
*     TERMINAL NAME TO A HARDWARE ADDRESS UNDER VTAM, THE      @OZ30477 06336007
*     VTAM NODE NAME ASSOCIATED WITH THE IMS SYMBOLIC NAME IS  @OZ30477 06340007
*     PASSED INSTEAD OF THE HARDWARE ADDRESS.                  @OZ30477 06344007
*                                                                     * 06350000
* THE X'FF' IS A SPECIAL INDICATOR MEANING THAT THE FOLLOWING DATA IS:* 06400000
*                                                                     * 06450000
*     LLL     - THE CHANNEL AND UNIT LINE ADDRESS FROM THE O/S UCB    * 06500000
*     CC & TT - THE CONTROL UNIT AND TERMINAL TP-LINE FOR REMOTE      * 06550000
*               ADDRESSING CHARACTERS FROM THE IMS CTB.               * 06600000
*                                                                     * 06650000
*     TTT     - THE TERMINAL TP-LINE FOR LOCAL USING ADDRESSING       * 06700000
*               CHARACTERS FROM THE O/S UCB.                          * 06750000
*                                                                     * 06800000
* THE SYMBOLIC DEVICE NAME MUST BE 1-8 CHARACTERS BUT IF THE NAME IS  * 06850000
*    3 CHARACTERS OR LESS, AT LEAST ONE MUST NOT BE HEX-EQUAL(0-9,A-F)* 06900000
*    OR THE USER MAY GET A SYMBOLIC CONVERSION WHEN HE MEANT TO       * 06950000
*    ENTER A HARDWARE ADDRESS.                                        * 07000000
*                                                                     * 07050000
*********************************************************************** 07100000
         EJECT                                                          07150000
BNGIEXIT CSECT                                                          07200000
*        PRINT NOGEN                                                    07250000
         USING *,BASE1             PROGRAM BASE                         07300000
         USING IECTDECB,CLBREG     IMS COMMUNICATION LINE BLOCK         07350000
         USING CNT,CNTREG          IMS COMMUNICATION NAME TABLE         07400000
         USING CTB,CTBREG          IMS COMMUNICATION TERMINAL BLOCK     07450000
         USING IHADCB,DCBREG       O/S DATA CONTROL BLOCK               07500000
         USING DEB,DEBREG          O/S DATA EXTENT BLOCK                07550000
         USING MSG,MSGREG          TRANSACTION MESSAGE SEGMENT BUFFER   07600000
         USING SCD,SCDREG          IMS SYSTEM CONTENTS DIRECTORY        07650000
         USING UCB,UCBREG          O/S UNIT CONTROL BLOCK               07700000
         SAVE  (14,12),,BNGIEXIT.DEMF.TRANSACTION.INPUT.EDIT.USER.EXIT  07750000
         LR    BASE1,R15           SET PROGRAM BASE                     07800000
BNGIEXIT BNGHJN SKIPID                                         @OZ29911 07820007
*        L     SCDREG,=V(XXXISCD)   SET IMS SCDREG                      07850000
*        L     SCDREG,0(SCDREG)                                         07900000
         L     MSGREG,DECAREA      SET MESSAGE SEGMENT BASE             07950000
         LA    MSGREG,0(MSGREG)    INSURE TOP BYTE IS ZERO              08000000
         XC    PARM1(40),PARM1     INSURE ALL PARMS ZEROS               08050000
         CLI   MSGZ2,0             MSG EDITED BY MFS OR BASIC? 0=BASIC  08100000
         BNE   MFSEDIT             BYPASS EXTENDING 10 BYTES IF MFS     08150000
*********************************************************************** 08200000
*                                                                     * 08250000
*        BASIC MSG EDIT PROCESSING                                    * 08300000
*                                                                     * 08350000
*********************************************************************** 08400000
         LA    DATAREG,MSGDATA     DATAREG = POINT TO INPUT DATA        08450000
         LH    DATALOOP,MSGLL      LOAD MSG LENGTH                      08500000
         SH    DATALOOP,=H'5'      SUBTRACT (LLZZ) + (1 FOR TR)         08550000
         EX    DATALOOP,TRNSLATE   CHANGE LOWER CASE TO UPPER CASE      08600000
         LA    DATALOOP,5(DATALOOP)   RESTORE LENGTH OF MSG             08650000
         AR    DATALOOP,MSGREG     POINT TO END OF MSG                  08700000
         BAL   LINKREG,EDITRTN     CALL EDIT ROUTINE                    08750000
         CLC   PARM2(5),=X'F3F2F7F000' IS 3270 REQUEST ?                08800000
         BNE   RETURN              NO.                                  08850000
         CLI   PARM3,X'00'         YES. IS SYMBOLIC NAME ENTERED ?      08900000
         BE    G3270               NO. FIND HDWR ADDR FOR RQSD TERM     08950000
         CLI   PARM4,X'00'         YES. ANY MORE PARMS ?                09000000
         BNE   RETURN              YES. MUST BE HDWR ADDRESSES          09050000
         L     CNTREG,SCDCNT       SET COMMUNICATION NAME TABLE         09100000
         LH    R0,SCDCNTN            POOL ADDRESS AND CNT COUNT         09150000
         OC    PARM3,=CL8' '       MASK TO BLANK ON BINARY ZEROS        09200000
CKNXTCNT CLC   PARM3,CNTNAME1       IS CNTNAME1 = REQUEST ?             09250000
         BE    CNTFOUND            SET CLB/CTB POINTERS IF EQUAL        09300000
         AH    CNTREG,SCDCNTL      MOVE TO NEXT COMM. NAME TABLE ENTRY  09350000
         BCT   R0,CKNXTCNT         KEEP CHECKING UNTILL ALL ARE CHECKED 09400000
*                                                                       09450000
RETURN   RETURN (14,12),T,RC=0          RETURN TO IMS WITH GOOD CODE    09500000
*                                                                       09550000
TRNSLATE TR    0(1,DATAREG),LOTOUP      TRANSLATE LOWER CASE TO UPPER   09600000
*                                                                       09650000
*                                                                       09700000
*********************************************************************** 09750000
*                                                                     * 09800000
*        BASIC EDIT PROCESSING FOR 3270 SYMBOLIC TERMINAL             * 09850000
*                                                                     * 09900000
*********************************************************************** 09950000
CNTFOUND L     CTBREG,CNTCTBPT     SET CTB ADDRESS FOR SYMBOLIC TERMNAL 10000000
         L     CLBREG,CTBCLB       SET CLB ADDRESS FOR SYMBOLIC TERMNAL 10050000
*********************************************************************** 10100000
*                                                                     * 10150000
*        BASIC EDIT PROCESSING FOR 3270 DEFAULT TERMINAL              * 10200000
*                                                                     * 10250000
*********************************************************************** 10300000
G3270    OC    CLBDCB,CLBDCB       IS CLBDCB = ZEROS, THEN THIS@OZ30477 10350007
*                                      IS VTAM TERMINAL REQUEST@OZ30477 10353007
         BNZ   G3270AA             NO. A BTAM TERMINAL REQUEST.@OZ30477 10356007
         LH    R1,MSGLL            LOAD MSG LENGTH             @OZ30477 10359007
         AR    R1,MSGREG           R1=POINT TO END OF MSG      @OZ30477 10362007
         MVI   0(R1),X'FE'        SET VTAM CONVERSION INDICATOR@OZ30477 10365007
         MVC   1(8,R1),CLBNAME    MOVE VTAM NODE NAME TO OUTPUT@OZ30477 10368007
         LH    R1,MSGLL            LOAD MSG LENGTH             @OZ30477 10371007
         LA    R1,9(R1)            BUMP R1=NEW BASIC LENGTH    @OZ30477 10374007
         STH   R1,MSGLL            STORE BACK NEW BASIC LENGTH @OZ30477 10377007
         B     RETURN                                          @OZ30477 10380007
G3270AA  BAL   LINKREG,CONVSYMN    CALL CONVERT SYMBOLIC RTN   @OZ30477 10383007
         CLI   PARM4,X'00'         IS SYMBOLIC NAME CONVERTED?          10400000
         BE    RETURN              NO                                   10450000
         LH    R1,MSGLL            LOAD MSG LENGTH                      10500000
         AR    R1,MSGREG           R1=POINT TO END OF MSG               10550000
         MVI   0(R1),X'FF'         SET SYMBOLIC CONVERSION INDICATOR    10600000
         MVC   1(3,R1),PARM4       MOVE HWR LINE/TERM ADDR TO OUTPUT    10650000
         UNPK  DBLWD,CTBTERM(3)    UNPACK 3 CNTRL & TERM ADDRESSES      10700000
         MVC   4(4,R1),DBLWD+3     MOVE CNTRL & TERM ADDR TO OUTPUT     10750000
         TR    4(4,R1),HXTOEB      CONVERT CNTRL & TERM ADDR TO EBCDIC  10800000
         LH    R1,MSGLL            LOAD MSG LENGTH                      10850000
         LA    R1,8(R1)            BUMP R1=NEW BASIC LENGTH             10900000
         STH   R1,MSGLL            STORE BACK NEW BASIC LENGTH          10950000
         B     RETURN                                                   11000000
*********************************************************************** 11050000
*                                                                     * 11100000
*        MFS MSG EDIT PROCESSING                                      * 11150000
*                                                                     * 11200000
*********************************************************************** 11250000
MFSEDIT  LA    DATAREG,MSGDATA        POINT TO KEY-IN AREA              11300000
         LA    DATALOOP,33            TRANSLATE FROM 'DEMF' ON TO END   11350000
*                                       OF 29-BYTE KEY-IN AREA          11400000
         EX    DATALOOP,TRNSLATE      CHANGE LOWER CASE TO UPPER CASE   11450000
         CLC   MSGKEYED,=CL29' '   WAS ANYTHING KEYED IN ?              11500000
         BNE   MFS0002             YES. GO EDIT INPUT                   11550000
         CLC   MSGCMDCD,=C'MENU'   IS INPUT FROM MENU SCREEN ?          11600000
         BNE   RETURN              NO. RETURN TO IMS                    11650000
         CLC   MSGDPRSS,=C'DEPRESS' IS THIS FROM MENU PAGE 1 ?          11700000
         BNE   RETURN              NO. RETURN TO IMS                    11750000
         CLI   MSG3270,C' '        IS THIS 3270 REQUEST FROM MENU ?     11800000
         BE    RETURN              NO. RETURN TO IMS                    11850000
         B     MFS3270             YES. GO FIND HARDWARE ADDRESS        11900000
MFS0002  LA    DATAREG,MSGKEYED    POINT TO KEYED-IN DATA               11950000
         LR    DATALOOP,DATAREG    SETUP DATA LOOP                      12000000
         LA    DATALOOP,29(DATALOOP) SET DATALOOP=END OF 29 BYTE AREA   12050000
         BAL   LINKREG,EDITRTN     CALL EDIT ROUTINE                    12100000
         CLC   PARM1(5),=X'F3F2F7F000' IS 3270 REQUEST ?                12150000
         BNE   RETURN              NO. RETURN TO IMS                    12200000
         CLI   PARM2,X'00'         YES. IS SYMBOLIC NAME ENTERED ?      12250000
         BE    MFS3270             NO. FIND HDWR ADDR FOR RQSD TERM     12300000
         CLI   PARM3,X'00'         YES. ANY MORE PARMS ?                12350000
         BNE   RETURN              YES. MUST BE HDWR ADDRESSES          12400000
         L     CNTREG,SCDCNT       SET COMMUNICATION NAME TABLE         12450000
         LH    R0,SCDCNTN            POOL ADDRESS AND CNT COUNT         12500000
         OC    PARM2,=CL8' '       MASK TO BLANK ON BINARY ZEROS        12550000
MFS0004  CLC   PARM2,CNTNAME1      IS CNTNAME1= REQUEST ?               12600000
         BE    MFS0006             SET CLB/CTB POINTERS IF EQUAL        12650000
         AH    CNTREG,SCDCNTL      MOVE TO NEXT COMM. NAME TABLE ENTRY  12700000
         BCT   R0,MFS0004          KEEP CHECKING UNTILL ALL ARE CHECKED 12750000
         B     RETURN              NO MATCH TO IMS SYMBOLICS, SO RETURN 12800000
*********************************************************************** 12850000
*                                                                     * 12900000
*        MFS EDIT PROCESSING FOR 3270 SYMBOLIC TERMINAL               * 12950000
*                                                                     * 13000000
*********************************************************************** 13050000
MFS0006  L     CTBREG,CNTCTBPT     SET CTB ADDRESS FOR SYMBOLIC TERMNAL 13100000
         L     CLBREG,CTBCLB       SET CLB ADDRESS FOR SYMBOLIC TERMNAL 13150000
*********************************************************************** 13200000
*                                                                     * 13250000
*        MFS EDIT PROCESSING FOR 3270 DEFAULT TERMINAL                * 13300000
*                                                                     * 13350000
*********************************************************************** 13400000
MFS3270  OC    CLBDCB,CLBDCB     IS CLBDCB = ZEROS, THEN THIS  @OZ30477 13450007
*                                   IS A VTAM TERMINAL REQUEST.@OZ30477 13453007
         BNZ   MFS0008             NO. A BTAM TERMINAL REQUSET.@OZ30477 13456007
         LA    R1,MSGKEYED   SET R1=ADDR OF 29 BYTE KEY-IN AREA@OZ30477 13459007
         MVC   MSGKEYED,=CL29' '   CLEAR KEY-IN AREA           @OZ30477 13462007
         MVC   0(5,R1),=C'3270 '   MOVE '3270 ' TO 29 BYTE AREA@OZ30477 13465007
         LA    R1,5(R1)            PRESET 'R1' PASS '3270 '    @OZ30477 13468007
         CLI   PARM2,X'00'         IS SYMBOLIC NAME IN PARM2 ? @OZ30477 13471007
         BE    MFS0005             NO. JUST ADD VTAM NAME      @OZ30477 13474007
         MVC   5(8,R1),PARM2      YES. ADD SYMBOLIC NAME TO MSG@OZ30477 13477007
         LA    R1,13(R1)        POINT PASS '3270 ' AND SYMBOLIC@OZ30477 13480007
MFS0005  MVI   0(R1),X'FE'        SET VTAM CONVERSION INDICATOR@OZ30477 13483007
         MVC   1(8,R1),CLBNAME    MOVE VTAM NODE NAME TO OUTPUT@OZ30477 13486007
         B     RETURN                                          @OZ30477 13489007
MFS0008  BAL   LINKREG,CONVSYMN   CALL CONVERT SYMBOLIC ROUTINE@OZ30477 13492007
         CLI   PARM4,X'00'         IS SYMBOLIC NAME CONVERTED?          13500000
         BE    RETURN              NO                                   13550000
         LA    R1,MSGKEYED         SET R1=ADDR OF 29 BYTE KEY-IN AREA   13600000
         MVC   MSGKEYED,=CL29' '   CLEAR KEY-IN AREA                    13650000
         MVC   0(5,R1),=C'3270 '    MOVE '3270 ' TO 29 BYTE AREA        13700000
         LA    R1,5(R1)            PRESET 'R1' PASS '3270 '             13750000
         CLI   PARM2,X'00'         IS SYMBOLIC NAME IN PARM2 ?          13800000
         BE    MFS0010             NO. JUST ADD HARDWARE ADDRESSES      13850000
         MVC   5(8,R1),PARM2       YES. ADD SYMBOLIC NAME TO MSG        13900000
         LA    R1,13(R1)           POINT PASS '3270 ' AND SYMBOLICNAME  13950000
MFS0010  MVI   0(R1),X'FF'         SET SYMBOLIC CONVERSION INDICATOR    14000000
         MVC   1(3,R1),PARM4       MOVE HWR LINE/TERM ADDR TO OUTPUT    14050000
         UNPK  DBLWD,CTBTERM(3)    UNPACK 3 CNTRL & TERM ADDRESSES      14100000
         MVC   4(4,R1),DBLWD+3     MOVE CNTRL & TERM ADDR TO OUTPUT     14150000
         TR    4(4,R1),HXTOEB      CONVERT CNTRL & TERM ADDR TO EBCDIC  14200000
         B     RETURN                                                   14250000
*********************************************************************   14300000
*                                                                   *   14350000
*        INPUT EDITING SUBROUTINE FOR BOTH BASIC AND MFS MSG        *   14400000
*                                                                   *   14450000
*********************************************************************   14500000
EDITRTN  LA    PARMREG,PARM1       POINT TO PARMS.                      14550000
         LR    R1,PARMREG                                               14600000
         MVI   NEWPARM,C'1'        TURN ON 'NEW PARM' SWITCH.           14650000
EDIT001  CLI   0(DATAREG),C'A'     IS IT AN 'A' OR HIGHER?              14700000
         BL    EDIT004             NO. CHECK NEW PARM SWITCH.           14750000
         MVI   NEWPARM,C'0'        YES. SET NEW PARM SWITCH OFF.        14800000
         MVC   0(1,R1),0(DATAREG)  PUT THIS BYTE IN THIS PARM           14850000
         CLI   PARM5,X'00'         ARE ALL PARMS USED UP?               14900000
         BNER  LINKREG             YES. RETURN TO CALLER                14950000
         LA    R1,1(R1)            BUMP PARM POINTER WORKREG.           15000000
EDIT003  LA    DATAREG,1(DATAREG)  BUMP TIOA POINTER.                   15050000
         CR    DATAREG,DATALOOP    IS THERE MORE DATA IN TIOA?          15100000
         BL    EDIT001             YES. GO PROCESS MORE DATA.           15150000
         BR    LINKREG             NO. RETURN TO CALLER.                15200000
EDIT004  CLI   NEWPARM,C'1'        IS NEW-PARM SWITCH ON?               15250000
         BE    EDIT003             YES. CHECK FOR MORE DATA.            15300000
         CLI   PARM5,X'00'         NO. ARE ALL PARMS USED UP?           15350000
         BNER  LINKREG             YES. RETURN TO CALLER                15400000
         LA    PARMREG,8(PARMREG)  NO. BUMP TO NEXT NEW PARM.           15450000
         LR    R1,PARMREG          POINT WORK REG TO NEXT PARM.         15500000
         MVI   NEWPARM,C'1'        TURN ON NEW-PARM SWICH.              15550000
         B     EDIT003             GO CHECK FOR MORE DATA.              15600000
*********************************************************************** 15650000
*        AT THIS POINT UP TO 5 PARMS HAVE BEEN EDITED AND             * 15700000
*        ARE LEFT JUSTIFIED WITH TRAILING X'00'S                      * 15750000
*********************************************************************** 15800000
*********************************************************************** 15850000
*                                                                     * 15900000
*        SUBROUTINE TO CONVERT SYMBOLIC NAME TO HARDWARE DEVICE       * 15950000
*                                                                     * 16000000
********************************************************************* * 16050000
CONVSYMN TM    CLBFLAG3,CLB3DECB     DID IMS USE THIS CLB FOR HIS OWN?  16100000
         BO    D2                  YES. GO GET DCB FROM SAVE AREA       16150000
         TM    CLBFLAG3,CLB3CL40     DID IMS USE THIS CLB FOR HIS OWN?  16200000
         BO    D2                  YES. GO GET DCB FROM SAVE AREA       16250000
         L     DCBREG,DECDCBAD     GET LINE'S DCB ADDRESS               16300000
D1       TM    DCBOFLGS,DCBOFOPN   IS DCB OPEN?                         16350000
         BZ    RETURN              LEAVE IF 'NOT AVAIL'                 16400000
         L     DEBREG,DCBDEBAD     GET LINE'S DEB ADDRESS IF OPEN       16450000
         XR    R2,R2               PREPARE FOR CALCULATIONS:            16500000
         IC    R2,DECRLN           GET ACCESS METHOD'S DD-CARD NUMBER   16550000
         BCTR  R2,0                CHANGE TO RELATIVE DD # FROM DD 1    16600000
         SLL   R2,2                MULTIPLY RELATIVE DD # BY FOUR       16650000
         L     UCBREG,DEBUCBAD(R2) GET LINE'S UCB ADDRESS               16700000
         LA    UCBREG,0(UCBREG)    DROP TOP BYTE OF UCBREG              16750000
         CLI   UCBID,UCBSTND       MAKE ONE UCB ADDRESS VALIDITY CHECK  16800000
         BNER  LINKREG             LEAVE 'NOT AVAIL', SOMETHING'S WRONG 16850000
         MVC   PARM4(3),UCBNAME    ADD LINE'S ADDRESS TO SPECIAL OPRAND 16900000
         BR    LINKREG             RETURN TO EDIT MAIN-LINE             16950000
D2       L     DCBREG,CLBDCB       LOAD DCBREG FROM CLB SAVE AREA       17000000
         B     D1                                                       17050000
*                                                                       17100000
         EJECT                                                          17150000
*********************************************************************** 17200000
BNGIPTCH DC    C'PATCH AREA S-CONS:',128S(*)                            17250000
*********************************************************************** 17300000
*                                                                       17350000
COMMAREA DS    0D       MAP OF COMMUNICATION AREA                       17400000
PARM1    DS    D          1ST INPUT PARM - DEMF                         17450000
PARM2    DS    D          2ND INPUT PARM - 3270                         17500000
PARM3    DS    D          3RD INPUT PARM - LLL OR TTT                   17550000
PARM4    DS    D          4TH INPUT PARM - CC  OR NULLS                 17600000
PARM5    DS    D          5TH INPUT PARM - TT  OR NULLS                 17650000
DBLWD    DS    D          DOUBLEWORD WORK AREA                          17700000
NEWPARM  DS    C          SWITCH TO DETERMINE START OF NEW PARM         17750000
HXTOEB   DS    0D                                                       17800000
         DC    4XL16'00',C' ',XL15'00',7XL16'00'  THIS TABLE CONVERTS   17850000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  HEX CHARS           17900000
         DC    2XL16'00'                CHARS FA-THRU-FF BACK           17950000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  A THRU F            18000000
*                                                                       18050000
LOTOUP   DS    0F       LOWER CASE TO UPPER CASE TR TABLE               18100000
         DC    X'000102030405060708090A0B0C0D0E0F'                      18150000
         DC    X'101112131415161718191A1B1C1D1E1F'                      18200000
         DC    X'202122232425262728292A2B2C2D2E2F'                      18250000
         DC    X'303132333435363738393A3B3C3D3E3F'                      18300000
         DC    X'404142434445464748494A4B4C4D4E4F'                      18350000
         DC    X'505152535455565758595A5B5C5D5E5F'                      18400000
         DC    X'606162636465666768696A6B6C6D6E6F'                      18450000
         DC    X'707172737475767778797A7B7C7D7E7F'                      18500000
         DC    X'80C1C2C3C4C5C6C7C8C98A8B8C8D8E8F'                      18550000
         DC    X'90D1D2D3D4D5D6D7D8D99A9B9C9D9E9F'                      18600000
         DC    X'A0A1E2E3E4E5E6E7E8E9AAABACADAEAF'                      18650000
         DC    X'F0F1F2F3F4F5F6F7F8F9BABBBCBDBEBF'                      18700000
         DC    X'C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF'                      18750000
         DC    X'D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF'                      18800000
         DC    X'E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF'                      18850000
         DC    X'F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF'                      18900000
         LTORG                                                          18950000
*********************************************************************** 19000000
*                                                                       19050000
DEB      DSECT ,      O/S DATA EXTENT BLOCK MAP:                        19100000
         DS    XL32     BASIC SECTION - UN-REFERENCED                   19150000
DEBUCBAD DS    F        UCB ADDRESS OF FIRST LINE FOR THE CLB/DCB       19200000
*                                                                       19250000
MSGIN    DSECT ,      MAP OF TRANSACTION MESSAGE SEGMENT:               19300000
MSG      DS    0F       START OF TRANSACTION MESSAGE SEGMENT            19350000
MSGLL    DS    H        LENGTH OF MESSAGE (INCLUDING LL,Z1,Z2)          19400000
MSGZ1    DS    X          UN-REFERENCED - SHOULD ALWAYS BE X'00'        19450000
MSGZ2    DS    X        IMS EDIT INDICATOR - =0 BASIC EDIT              19500000
*                                            >0 MFS EDIT                19550000
TIOADBA  DS    0F       START OF MESSAGE DATA (INPUT AREA)              19600000
MSGDATA  DS    0C       FIRST BYTE OF MESSAGE DATA POINTER              19650000
MSGTXCD  DS    CL5      'DEMF ' AREA                                    19700000
MSGKEYED DS    CL29     29 BYTES KEY-IN AREA                            19750000
MSGCMDCD DS    CL4      4 BYTES CMND CODE AREA                          19800000
MSGMENU  DS    0C       START OF MENU PAGE1 INPUT AREA FOR (X)          19850000
MSGALL   DS    C          MENU PAGE1 1ST (X) INPUT AREA                 19900000
MSG3270  DS    C          MENU PAGE1 2ND (X) INPUT AREA                 19950000
MSGRMOT  DS    C          MENU PAGE1 3RD (X) INPUT AREA                 20000000
MSGLOCL  DS    C          MENU PAGE1 4TH (X) INPUT AREA                 20050000
MSGDPRSS DS    CL7        MENU PAGE1 5TH INPUT AREA (FOR ENTER KEY)     20100000
*                                                                       20150000
UCB      DSECT ,      O/S UNIT CONTROL BLOCK MAP:                       20200000
         DS    XL2        UN-REFERENCED                                 20250000
UCBID    DS    X        UCB IDENTIFIER                                  20300000
UCBSTND  EQU   X'FF'    UCB IDENTIFIER VALUE                            20350000
         ORG   UCB+13     UN-REFERENCED                                 20400000
UCBNAME  DS    CL3      PRINTABLE LINE ADDRESS (CUU)                    20450000
         DCBD  DSORG=XE,DEVD=BS                                         20500000
         ICLI  CLBBASE=0,CNTBASE=0,CTBBASE=0                            20550000
         ISCD  SECTYPE=DSECT,SCDBASE=0                                  20600000
*                                                                       20650000
R0       EQU   0                                                        20700000
R1       EQU   1                                                        20750000
R2       EQU   2                                                        20800000
DATAREG  EQU   2              POINTER TO DATA TO BE EDIT                20850000
DCBREG   EQU   3                                                        20900000
DEBREG   EQU   4              O/S DATA EXTENTED BLOCK                   20950000
UCBREG   EQU   5              O/S UNIT CONTROL BLOCK                    21000000
MSGREG   EQU   6              POINTER TO INPUT MESSAGE                  21050000
CTBREG   EQU   7              COMMUNICATIONS TERMINAL BLOCK             21100000
DATALOOP EQU   8              LENGTH OF DATA TO BE EDIT                 21150000
CLBREG   EQU   9              COMMUNICATIONS LINE BLOCK                 21200000
CNTREG   EQU   10             COMMUNICATIONS NAME TABLE                 21250000
SCDREG   EQU   11             SYSTEMS CONTENTS DIRECTORY                21300000
BASE1    EQU   12             BASE REGISTER                             21350000
*UNUSED  EQU   13             POINTER TO IMS REGISTER SAVE AREA         21400000
LINKREG  EQU   14             LINKAGE REGISTER                          21450000
PARMREG  EQU   15             POINTER TO PARAMETERS 1,2,3,4             21500000
R15      EQU   15             ENTRY POINT TO THIS PROGRAM FROM IMS      21550000
         END   BNGIEXIT                                                 21600000
./  ADD  SSI=73210054,NAME=BNGILOCL
*********************************************************************** 00050068
*                                                                     * 00100068
* MODULE NAME = BNGILOCL                                              * 00150068
*                                                                     * 00200068
* DESCRIPTIVE NAME =  IMS DEMF LOCAL TERMINAL ERROR TEXT DISPLAY      * 00250068
*                                                                     * 00300068
* COPYRIGHT = NONE                                                    * 00350068
*                                                                     * 00400068
* STATUS = RELEASE 1, LEVEL 1                                         * 00450068
*                                                                     * 00500068
* FUNCTION = 1) DISPLAYS CANNED STATUS/SENSE TEXT OF ALL POSSIBLE     * 00550068
*               LOCAL TERMINAL ERROR COMBINATIONS;                    * 00600068
*            2) PROVIDES THE SELECTION DISPLAY OF EXPLANATION AND     * 00650068
*               POSSIBLE CAUSES ON THE LOCAL TERMINAL STATUS/SENSE    * 00700068
*               WHICH IS SELECTED BY DEMF USER.                       * 00750068
*                                                                     * 00800068
* NOTES = NONE                                                        * 00850068
*                                                                     * 00900068
*    DEPENDENCIES = NONE                                              * 00950068
*                                                                     * 01000068
*    RESTRICTIONS = NONE                                              * 01050068
*                                                                     * 01100068
*    REGISTER CONVENTIONS :                                           * 01150068
*    --------------------                                             * 01200068
*                                                                     * 01250068
*    ALL DEMF RECORDING DISPLAY COMPONENTS USE STANDARD REGISTER      * 01300068
*    CONVENTIONS WITH THE EXCEPTION OF THE IMS DISPLAY COMPONENTS.    * 01350068
*    CERTAIN IMS MODULES USE ADDITIONAL REGISTERS AND THE LINK MACRO  * 01400068
*    FOR PASSING OR RETRIEVING DATA PARAMETER INFORMATION AND ARE     * 01450068
*    DETAILED BELOW:                                                  * 01500068
*                                                                     * 01550068
*     MODULE    REGISTER    CONTENTS.                                 * 01600068
*    --------   --------    ------------------------------------      * 01650068
*    BNGIDISP     R5        PASSES ADDRESS OF IMS PROGRAM             * 01700068
*                           COMMUNICATION BLOCK (PCB) TO              * 01750068
*                           BNGI3270, BNGIMENU, BNGILOCL, AND         * 01800068
*                           BNGIRMOT.                                 * 01850068
*                                                                     * 01900068
*                 R11       PASSES TO BNGIREAD THE ADDRESS OF A       * 01950068
*                           PARAMETER LIST CONTAINING:                * 02000068
*                                                                     * 02050068
*                          1) 4-BYTES - ADDRESS OF I/O AREA FROM      * 02100068
*                                       BNGIREAD                      * 02150068
*                                                                     * 02200068
*                          2) 3-BYTES - RELATIVE BLOCK ADDRESS TO     * 02250068
*                                       BE READ BY BNGIREAD           * 02300068
*                                                                     * 02350068
*                          3) 2-BYTES - STATUS OF READ FROM           * 02400068
*                                       BNGIREAD                      * 02450068
*                                                                     * 02500068
*                 R12      FOR BNGI3270, PASSES THE ADDRESS OF A      * 02550068
*                          COMMUNICATION AREA CONTAINING              * 02600068
*                          UP TO SIX EDITTED PARM FIELDS, SAVE        * 02650068
*                          AND WORK AREAS, AND THE INPUT MESSAGE.     * 02700068
*                                                                     * 02750068
*                          FOR BNGILOCL, BNGIRMOT, AND BNGIMENU;      * 02800068
*                          PASSES THE ADDRESS OF THE INPUT MESSAGE.   * 02850068
*                                                                     * 02900068
*    BNGIREAD    LINK TO BNGIDCBA       RETRIEVES THE ADDRESS OF THE  * 02950068
*                (ALIAS FOR BNGISIMS)   ADDRESS OF THE SYS1.DEMFLOG   * 03000068
*                                       DCB.                          * 03050068
*                                                                     * 03100068
*                 R11      RECEIVES ADDRESS OF PARAMETER LIST         * 03150068
*                          (SEE BNGIDISP R11 FOR LIST).               * 03200068
*                                                                     * 03250068
*    BNGI3270     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 03300068
*                                                                     * 03350068
*                 R11     PASSES TO BNGIREAD THE ADDRESS OF A         * 03400068
*                         PARAMETER LIST (SEE BNGIDISP R11 FOR LIST)  * 03450068
*                                                                     * 03500068
*                 R12     RECEIVES FROM BNGIDISP THE ADDRESS OF THE   * 03550068
*                         COMMUNICATION AREA (SEE BNGIDISP R12 FOR    * 03600068
*                         CONTENTS OF AREA).                          * 03650068
*                                                                     * 03700068
*    BNGIMENU     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 03750068
*                                                                     * 03800068
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 03850068
*                         BNGIDISP.                                   * 03900068
*                                                                     * 03950068
*    BNGILOCL     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 04000068
*                                                                     * 04050068
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 04100068
*                         BNGIDISP.                                   * 04150068
*                                                                     * 04200068
*    BNGIRMOT     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 04250068
*                                                                     * 04300068
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 04350068
*                         BNGIDISP.                                   * 04400068
*                                                                     * 04450068
*    PATCH LABEL = NONE                                               * 04500068
*                                                                     * 04550068
* MODULE TYPE =  IMS DISPLAY                                          * 04600068
*                                                                     * 04650068
*    PROCESSOR = ASSEMBLER H                                          * 04700068
*                                                                     * 04750068
*    MODULE SIZE = 7218 DECIMAL BYTES                                 * 04800068
*                                                                     * 04850068
*    ATTRIBUTES = SERIALLY REUSABLE                                   * 04900068
*                                                                     * 04950068
* ENTRY POINT = BNGILOCL                                              * 05000068
*                                                                     * 05050068
*    PURPOSE = SEE FUNCTION                                           * 05100068
*                                                                     * 05150068
*    LINKAGE = R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 05200068
*                                                                     * 05250068
* INPUT = PARAM LIST ITEMS USED ARE : INPUT MESSAGE                   * 05300068
*                                                                     * 05350068
* OUTPUT = PARAM LIST ITEMS USED ARE : LOCAL INDEX AND TEXT DISPLAYS  * 05400068
*                                                                     * 05450068
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 05500068
*               00 - OPERATION PERFORMED AS REQUESTED                 * 05550068
*                                                                     * 05600068
* EXIT-ERROR  = NONE                                                  * 05650068
*                                                                     * 05700068
* EXTERNAL REFERENCE = NONE                                           * 05750068
*                                                                     * 05800068
*    ROUTINES = NONE                                                  * 05850068
*                                                                     * 05900068
*    DATA AREAS = NONE                                                * 05950068
*                                                                     * 06000068
*    CONTROL BLOCK = DCB                                              * 06050068
*                                                                     * 06100068
* TABLES = NONE                                                       * 06150068
*                                                                     * 06200068
* MACROS = SAVE, RETURN                                               * 06250068
*                                                                     * 06300068
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 06350068
* CHANGE 01   11/15/77  PROLOGUE ADDED                                * 06400068
*                                                                     * 06450068
*********************************************************************** 06500068
BNGILOCL TITLE 'DEMF LOCAL SRL TEXT MODULE'                             79599968
R0       EQU   0                                                        79649968
R1       EQU   1                                                        79699968
R2       EQU   2                                                        79749968
R3       EQU   3                                                        79799968
R4       EQU   4                                                        79849968
R5       EQU   5                                                        79899968
R6       EQU   6                                                        79949968
R7       EQU   7                                                        79999968
R8       EQU   8                                                        80049968
R9       EQU   9                                                        80099968
R10      EQU   10                                                       80149968
R11      EQU   11                                                       80199968
R12      EQU   12                                                       80249968
R13      EQU   13                                                       80299968
R14      EQU   14                                                       80349968
R15      EQU   15                                                       80399968
PCBREG   EQU   R5                                                       80449968
MSGINREG EQU   R12                                                      80499968
BASEREG  EQU   R3                                                       80549968
TPIOPCB  DSECT                                                          80599968
PCBTERMN DS    CL8                  REQUESTING TERMINAL SYMBOLIC NAME   80649968
         DS    CL2                  RESERVED                            80699968
PCBSTAT  DS    CL2                  DL/I STATUS CODE                    80749968
PCBDATE  DS    PL4                  TRANSACTION DATE STAMP              80799968
PCBTIME  DS    PL4                  TRANSACTION TIME STAMP              80849968
PCBSEQ   DS    F                    TRANSACTION SEQUENCE NUMBER         80899968
PCBMODNM DS    CL8                  MFS MSG OUTPUT DESCRIPTOR NAME      80949968
MSGINMAP DSECT                                                          80999968
MSGIN    DS    0D                   MAP OF TRANSACTION MSG SEGMENT      81049968
TIOATDL  DS    H                    DATA LENGTH                         81099968
MSGZ1    DS    X                                                        81149968
MSGZ2    DS    X                                                        81199968
MSGTXCD  DS    CL11                 DEMF LOCAL  FOR THIS MODULE         81249968
MSGEYED  DS    0CL8                 XSS=CODE  IF TEXT PAGE              81299968
X        DS    CL1                  X         IF TEXT PAGE              81349968
SSEQUAL  DS    CL3                  SS=       IF TEXT PAGE              81399968
SSCODE   DS    CL4                  CODE FOR CSW-SS IF TEXT             81449968
BNGILOCL CSECT                                                          81499968
XNGILOCL SAVE  (14,12),T,*                                              81549968
         LR    BASEREG,R15          ESTABLISH BASE REGISTER             81599968
         USING BNGILOCL,BASEREG     MODULE BASE REGISTER                81649968
         USING TPIOPCB,PCBREG       IMS TP IOPCB BASE                   81699968
         USING MSGINMAP,MSGINREG    DSECT MAP OF TRAN MSG SEG           81749968
         LR    R6,R13               GET ADDRESS OF SAVE AREA            81799968
         ST    R13,SAVEAREA+4       SAVE R13 MY SAVE AREA               81849968
         LA    R13,SAVEAREA         ADDRESS OF MY SAVE AREA             81899968
         ST    R13,8(R6)            STORE MY SAVE                       81949968
TESTCALL EQU   *                    TEST INDEX OR TEXT CALL             81999968
         CLC   SSEQUAL,QSSEQUAL+1   REQUEST FO TEXT PAGE?               82049968
         BE    TEXTPAGE             YES, GO FIND CSW-SS MSG             82099968
*                                   NO.  BUILD INDEX PAGE MSG           82149968
INDXPAGE EQU   *                    REQUEST FOR INDEX PAGE              82199968
*                                   OR UNDETERMINED CODE ENTERED        82249968
         LA    R6,CSWSSNBR          ADDR OF CSW-SS STATUS CODES         82299968
         LA    R7,MSGOINDX          ADDR OF MESSAGE OUTPUT AREA         82349968
         LA    R8,CSWSSEND          UPPER LIMIT OF CSW-SS CODES         82399968
NEXTCODE EQU   *                                                        82449968
         CR    R6,R8                TEST FOR UPPER LIMIT OF CODES       82499968
         BE    INDXOUT              END OF CSW-SS CODES-GET OUT         82549968
         MVC   0(4,R7),QSSEQUAL     MOVE ?SS= TO OUTPUT AREA            82599968
         MVC   4(4,R7),0(R6)        MOVE CSW-SS CODE TO OUTPUT AREA     82649968
         LA    R7,8(R7)             BUMP ADDR FOR NEXT ?SS=XXXX         82699968
         LA    R6,4(R6)             BUMP ADDR FOR NEXT CSW-SS CODE      82749968
         B     NEXTCODE             GO GET NEXT ?SS=XXXX                82799968
INDXOUT  EQU   *                    INDEX PAGE OUTPUT PREPARATION       82849968
         MVI   0(R7),X'3F'          INSERT 3F LAST CHARACTER OF INDEX   82899968
         LA    R6,MSGOHDR           ADDR OF MSG HEADER OUT AREA         82949968
         MVC   0(IXHDRL,R6),IXHDR   MOVE INDEX HEADER TO OUT AREA       82999968
         SR    R6,R6                CLEAR REGISTER                      83049968
         LA    R6,CSWSSLTH          LENGTH OF CSW-SS CODES              83099968
         AR    R6,R6                ADD LENGTH FOR EACH ?SS=            83149968
         LA    R6,4(R6)             ADD LENGTH OF LLZZ FIELD            83199968
         LA    R6,IXHDRL(R6)        ADD LENGTH OF HEADER                83249968
         LA    R6,1(R6)             ADD ONE FOR LENGTH OF 3F CHARACTER  83299968
         STH   R6,MSGOUTLL          STORE LENGTH IN LL FIELD            83349968
         MVC   MODNAME,LOCALI       MFS MOD NAME INDEX PAGE             83399968
         B     CALLDLI              BRANCH TO IMS DL/I CALL             83449968
TEXTPAGE EQU   *                                                        83499968
         LA    R6,CSWSSNBR          ADDR OF BEGIN OF CSW-SS CODES       83549968
         LA    R7,MSGADDR           ADDR OF FIRST MESSAGE               83599968
         LA    R8,CSWSSEND          UPPER LIMIT CHECK FOR CODES         83649968
CODETEST EQU   *                                                        83699968
         CR    R6,R8                TEST FOR LIMIT I.E. CODE NOT FOUND  83749968
         BE    INDXPAGE             BRANCH TO DISPLAY INDEX PAGE        83799968
         CLC   0(4,R6),SSCODE       COMPARE INPUT CSW-SS CODE TO TABLE  83849968
         BE    BUILDTXT             YES, BUILD TEXT PAGE MESSAGE        83899968
         LA    R6,4(R6)             NO, LOOK FOR ANOTHER CSW-SS CODE    83949968
         LA    R7,4(R7)             AND BUMP TO CORRESPONDING MESSAGE   83999968
         B     CODETEST                                                 84049968
BUILDTXT EQU   *                    TEXT PAGE OUTPUT PREPARATION        84099968
         MVI   TEXTLG+150,C' '      CLEAR BOTTOM HALF OF LG SCREEN      84109968
         MVC   TEXTLG+151(240),TEXTLG+150                               84119968
         LA    R6,MSGOHDR           ADDR MSG HEADER OUT AREA            84149968
         MVC   0(TXHDRL,R6),TXHDR   MOVE TEXT HEADER TO OUT AREA        84199968
         L     R7,0(R7)             ADDR OF MSG LENGTH                  84209968
         LA    R8,2(R7)             ADDR OF MSG TEXT TO MOVE            84219968
         LH    R7,0(R7)             GET MSG LENGTH OF THIS MSG          84229968
         LR    R9,R7                MSG LENGTH FOR MOVE LONG            84249968
         LA    R6,MSGOTEXT          ADDR MESSAGE OUTPUT AREA            84449968
         MVCL  R6,R8                MOVE MESSAGE                        84699968
         LA    R6,1(R6)             POINT TO END OF TEXT PLUS ONE       84799968
         MVI   0(R6),X'3F'          INSERT 3F CHARACTER AT END OF TEXT  84849968
         MVC   MODNAME,LOCALT       MFS MOD NAME TEXT PAGE              84899968
         MVC   TEXTSM(200),TEXTLG          MOVE LARGE SCREEN TEXT TO    84949968
         MVC   TEXTSM+200(191),TEXTLG+200      SMALL SCREEN AREA        85049968
CALLDLI  EQU   *                                                        85059968
         CALL  ASMTDLI,(ISRT,(PCBREG),MSGOUT,MODNAME),VL                85099968
*                                   TEST IMS DL/I STATUS CODE           85149968
         L     R13,SAVEAREA+4       RESTORE SAVE AREA ADDRESS           85199968
         RETURN (14,12),RC=0                                            85249968
         LTORG                                                          85299968
SAVEAREA DC    18F'0'               SAVE AREA                           85349968
ISRT     DC    CL4'ISRT'            IMS DL/I INSERT FUNCTION            85399968
LOCALI   DC    CL8'BNGIOLC1'        NAME OF MFS LOCAL INDEX PAGE MOD    85449968
LOCALT   DC    CL8'BNGIOLC2'        NAME OF MFS LOCAL TEXT  PAGE MOD    85499968
QSSEQUAL DC    CL4'?SS='            CHARACTERS FOR INDEX PAGE           85549968
MODNAME  DC    CL8' '               MFS MOD NAME FOR IMS CALL           85599968
IXHDR    DC    CL11'DEMF LOCAL '                                        85649968
         DC    CL27'STATUS INDEX,X OVER ?,ENTER'                        85699968
         DC    CL39'HIT CLEAR KEY TO EXIT DEMF'                         85749968
IXHDRL   EQU   *-IXHDR                                                  85799968
TXHDR    DC    CL11'DEMF LOCAL'                                         85849968
         DC    CL27'HIT ENTER TO REFRESH INDEX'                         85899968
TXHDRL   EQU   *-TXHDR                                                  85949968
MSGOUT   DS    0D                   MESSAGE OUTPUT AREA                 85999968
MSGOUTLL DC    AL2(MSGOLTH)         MESSAGE LENGTH LL FIELD             86049968
MSGOUTZ1 DC    X'00'                               Z1 FIELD             86099968
MSGOUTZ2 DC    X'00'                               Z2 FIELD             86149968
MSGODATA DS    0F                   BEGINNING OF MSG DATA               86199968
MSGOHDR  DS    CL38                 MESSAGE HEADER-TEXT PAGE            86249968
MSGOTEXT DS    CL7                  TEXT PAGE                           86299968
TEXTLG   DS    CL391                TEXT PAGE FOR LARGE SCREEN          86349968
TEXTSM   DS    CL391                TEXT PAGE FOR SMALL SCREEN          86399968
MSGOLTH  EQU   *-MSGOUT                                                 86409968
SETORG   DS    C                                                        86419968
         ORG   MSGODATA                                                 86449968
         DS    CL77                 MESSAGE HEADER-INDEX PAGE           86499968
MSGOINDX DS    40CL8                INDEX PAGE                          86549968
         ORG   SETORG                                                   86559968
MSGADDR  DS    0F                                                       86599968
M1       DC    AL4(MSG1) CL4'0220'                                      86649968
M2       DC    AL4(MSG2) CL4'0240'                                      86699968
M3       DC    AL4(MSG3) CL4'0280'                                      86749968
M4       DC    AL4(MSG4) CL4'0500'                                      86799968
M5       DC    AL4(MSG5) CL4'0601'                                      86849968
M6       DC    AL4(MSG6) CL4'0602'                                      86899968
M7       DC    AL4(MSG7) CL4'0608'                             11/04/77 86949968
M8       DC    AL4(MSG8) CL4'060C'                                      86999968
M9       DC    AL4(MSG9) CL4'0614'                                      87049968
M10      DC    AL4(MSG10) CL4'0640'                                     87099968
M11      DC    AL4(MSG11) CL4'0654'                                     87149968
M12      DC    AL4(MSG12) CL4'0E01'                                     87199968
M13      DC    AL4(MSG13) CL4'0E02'                                     87249968
M14      DC    AL4(MSG14) CL4'0E08'                                     87299968
M15      DC    AL4(MSG15) CL4'0E0C'                                     87349968
M16      DC    AL4(MSG16) CL4'0E20'                                     87399968
M17      DC    AL4(MSG17) CL4'0D00'                                     87449968
M18      DC    AL4(MSG18) CL4'820C'                            11/04/77 87459968
M19      DC    AL4(MSG19) CL4'8210'                                     87499968
M20      DC    AL4(MSG20) CL4'860C'                                     87599968
M21      DC    AL4(MSG21) CL4'8640'                                     87649968
M22      DC    AL4(MSG22) CL4'8654'                                     87699968
M23      DC    AL4(MSG23) CL4'0000'                                     87749968
M24      DC    AL4(MSG24) CL4'0400'                                     87799968
M25      DC    AL4(MSG25) CL4'0800'                                     87849968
M26      DC    AL4(MSG26) CL4'0C00'                                     87899968
M27      DC    AL4(MSG27) CL4'1000'                                     87949968
M28      DC    AL4(MSG28) CL4'2000'                                     87999968
M29      DC    AL4(MSG29) CL4'5000'                                     88049968
M30      DC    AL4(MSG30) CL4'HELP'                                     88099968
MSGEND   EQU   *                                                        88149968
CSWSSNBR DS    0F                                                       88199968
N1       DC    CL4'0220'                                                88249968
N2       DC    CL4'0240'                                                88299968
N3       DC    CL4'0280'                                                88349968
N4       DC    CL4'0500'                                                88399968
N5       DC    CL4'0601'                                                88449968
N6       DC    CL4'0602'                                                88499968
N7       DC    CL4'0608'                                                88549968
N8       DC    CL4'060C'                                                88599968
N9       DC    CL4'0614'                                                88649968
N10      DC    CL4'0640'                                                88699968
N11      DC    CL4'0654'                                                88749968
N12      DC    CL4'0E01'                                                88799968
N13      DC    CL4'0E02'                                                88849968
N14      DC    CL4'0E08'                                                88899968
N15      DC    CL4'0E0C'                                                88949968
N16      DC    CL4'0E20'                                                88999968
N17      DC    CL4'0D00'                                                89049968
N18      DC    CL4'820C'                                                89099968
N19      DC    CL4'8210'                                                89149968
N20      DC    CL4'860C'                                                89199968
N21      DC    CL4'8640'                                                89249968
N22      DC    CL4'8654'                                                89299968
N23      DC    CL4'0000'                                                89349968
N24      DC    CL4'0400'                                                89399968
N25      DC    CL4'0800'                                                89449968
N26      DC    CL4'0C00'                                                89499968
N27      DC    CL4'1000'                                                89549968
N28      DC    CL4'2000'                                                89599968
N29      DC    CL4'5000'                                                89649968
N30      DC    CL4'HELP'                                                89699968
CSWSSEND EQU   *                                                        89749968
CSWSSLTH EQU   CSWSSEND-CSWSSNBR                                        89799968
MSG1     DC    AL2(MSG2-*-2)                                            89849968
         DC    C'SS=0220',C'  '                                         89899968
         DC    CL29'UNIT CHECK,BUS OUT CHECK'                           89949968
         DC    C'A PARITY CHECK WAS DETECTED ON THE      '              89999968
         DC    C'COMMAND BYTE                            '              90049968
         DC    C'                                        '              90099968
MSG2     DC    AL2(MSG3-*-2)                                            90149968
         DC    C'SS=0240',C'  '                                         90199968
         DC    CL29'UNIT CHECK,INTERVENTION REQ''D'                     90249968
         DC    C'A COMMAND OTHER THAN SENSE WAS ADDRESSED'              90299968
         DC    C'TO A DEVICE THAT THE 3272 HAS RECORDED  '              90349968
         DC    C'AS UNAVAILABLE OR NOT READY             '              90399968
         DC    C'                                        '              90449968
MSG3     DC    AL2(MSG4-*-2)                                            90499968
         DC    C'SS=0280',C'  '                                         90549968
         DC    CL29'UNIT CHECK,COMMAND REJECT'                          90599968
         DC    C'AN INVALID COMMAND WAS ISSUED TO 3272'                 90649968
MSG4     DC    AL2(MSG5-*-2)                                            90699968
         DC    C'SS=0500',C'  '                                         90749968
         DC    CL29'DEVICE END,UNIT EXCEPTION'                          90799968
         DC    C'3272 ATTEMPTED TO PERFORM A SELECT OR   '              90849968
         DC    C'ERASE ALL UNPROTECTED COMMAND. AFTER RE-'              90899968
         DC    C'TURNING INITIAL STATUS,FOUND ADDRESSED  '              90949968
         DC    CL40'DEVICE BUSY'                                        90999968
         DC    C'                                        '              91049968
MSG5     DC    AL2(MSG6-*-2)                                            91099968
         DC    C'SS=0601',C'  '                                         91149968
         DC    CL29'DEVICE END,UNIT CHECK'                              91199968
         DC    CL11' ',CL29'OPERATION CHECK'                            91249968
         DC    C'A WRITE OR ERASE/WRT COMMAND,CONTAINING '              91299968
         DC    C'A WCC WITH A START PRINT BIT,IS CHAINED '              91349968
         DC    C'TO A SUBSEQUENT COMMAND'                               91399968
MSG6     DC    AL2(MSG7-*-2)                                            91449968
         DC    C'SS=0602',C'  '                                         91499968
         DC    CL29'DEVICE END,UNIT CK,CTRL CK'                         91549968
         DC    C'THE ADDRESSED DEVICE FAILED TO RESPOND  '              91599968
         DC    C'IN A SPECIFIED PERIOD OF TIME TO A      '              91649968
         DC    C'SELECT,WRITE,ERASE/WRT OR AN ERASE ALL  '              91699968
         DC    C'UNPROTECTED COMMAND                     '              91749968
MSG7     DC    AL2(MSG8-*-2)                                            91799968
         DC    C'SS=0608',C'  '                                         91849968
         DC    CL29'DEVICE END,UNIT CK,DATA CK'                         91899968
         DC    C'3272 (1) DETECTED PARITY OR CURSOR ERROR'              91949968
         DC    C'DURING A SELECT,WRITE OR ERASE/WRT CMD  '              91999968
         DC    C'OR (2) DETECTED A PARITY CK ON DATA     '              92049968
         DC    C'RECEIVED TO AN INTERNAL POLL'                          92099968
MSG8     DC    AL2(MSG9-*-2)                                            92149968
         DC    C'SS=060C',C'  '                                         92199968
         DC    CL29'DEVICE END,UNIT CHECK'                              92249968
         DC    CL11' ',CL29'DATA CHECK,UNIT SPECIFY'                    92299968
         DC    C'ADDRESSED DEVICE DETECTED PARITY CK OR  '              92349968
         DC    C'CURSOR CK DURING A SELECT,WRITE,ERASE/- '              92399968
         DC    C'WRT,OR ERASE ALL UNPROTECTED COMMAND    '              92449968
         DC    C'                                        '              92499968
MSG9     DC    AL2(MSG10-*-2)                                           92549968
         DC    C'SS=0614',C'  '                                         92599968
         DC    CL29'DEVICE END,UNIT CHECK'                              92649968
         DC    CL11' ',CL29'EQUIPMENT CHECK,UNIT SPECIFY'               92699968
         DC    C'A PRINTER CHARACTER GENERATOR ERROR     '              92749968
         DC    C'OCCURED OR PRINTER BECAME MECHANICALLY  '              92799968
         DC    C'DISABLED DURING PRINTOUT'                              92849968
MSG10    DC    AL2(MSG11-*-2)                                           92899968
         DC    C'SS=0640',C'  '                                         92949968
         DC    CL29'DEVICE END,UNIT CHECK'                              92999968
         DC    CL11' ',CL29'INTERVENTION REQUIRED'                      93049968
         DC    C'A COMMAND ATTEMPTING TO START A PRINTER '              93099968
         DC    C'FOUND IT NOT READY                      '              93149968
         DC    C'                                        '              93199968
MSG11    DC    AL2(MSG12-*-2)                                           93249968
         DC    C'SS=0654',C'  '                                         93299968
         DC    CL29'DEVICE END,UNIT CHK,INTV RQRD'                      93349968
         DC    CL11' ',CL29'EQUIPMENT CHK,UNIT SPECIFY '                93399968
         DC    C'A COMMAND TO START PRINT OPERATION FOUND'              93449968
         DC    C'PRINTER CARRIAGE MOTOR POWER OFF'                      93499968
MSG12    DC    AL2(MSG13-*-2)                                           93549968
         DC    C'SS=0E01',C'  '                                         93599968
         DC    CL29'CHANNEL END,DEVICE END'                             93649968
         DC    CL11' ',CL29'UNIT CHECK,OPERATION CHECK'                 93699968
         DC    C'ON A WRITE OR ERASE/WRT COMMAND,3272    '              93749968
         DC    C'RECEIVED ILLEGAL BUFFER ADDRESS IN DATA-'              93799968
         DC    C'STREAM,OR DATA ENDED BEFORE PROVIDING   '              93849968
         DC    C'ALL CHARACTERS REQUIRED FOR SBA,RA,SF OR'              93899968
         DC    C'EUA ORDERS'                                            93949968
MSG13    DC    AL2(MSG14-*-2)                                           93999968
         DC    C'SS=0E02',C'  '                                         94049968
         DC    CL29'CHANNEL END,DEVICE END'                             94099968
         DC    CL11' ',CL29'UNIT CHECK,CONTROL CHECK'                   94149968
         DC    C'ADDRESSED DEVICE FAILED TO RESPOND IN   '              94199968
         DC    C'TIME TO AN ERASE/WRT,UNCHAINED READ     '              94249968
         DC    C'BUFFER,READ MODIFIED OR WRITE COMMAND   '              94299968
         DC    C'                                        '              94349968
MSG14    DC    AL2(MSG15-*-2)                                           94399968
         DC    C'SS=0E08',C'  '                                         94449968
         DC    CL29'CHANNEL END,DEVICE END'                             94499968
         DC    CL11' ',CL29'UNIT CHECK,DATA CHECK'                      94549968
         DC    C'3272 DETECTED CURSOR OR PARITY CHECK ON '              94599968
         DC    C'TRANSMISSION OF DATA ON A READ BUFFER OR'              94649968
         DC    C'READ MODIFIED COMMAND'                                 94699968
MSG15    DC    AL2(MSG16-*-2)                                           94749968
         DC    C'SS=0E0C',C'  '                                         94799968
         DC    CL29'CHANNEL END,DEVICE END'                             94849968
         DC    CL11' ',CL29'UNIT CK,DATA CK,UNIT SPECIFY'               94899968
         DC    C'ADDRESSED DEVICE DETECTED PARITY OR     '              94949968
         DC    C'CURSOR CHECK ON WRITE, READ BUFFER OR   '              94999968
         DC    C'READ MODIFIED COMMAND                   '              95049968
         DC    C'                                        '              95099968
MSG16    DC    AL2(MSG17-*-2)                                           95149968
         DC    C'SS=0E20',C'  '                                         95199968
         DC    CL29'CHANNEL END,DEVICE END'                             95249968
         DC    CL11' ',CL29'UNIT CHECK,BUS OUT CHECK'                   95299968
         DC    C'3272 DETECTED A PARITY ERROR ON A CHAR- '              95349968
         DC    C'ACTER IN DATA-STREAM OF A WRITE OR ERASE'              95399968
         DC    C'/WRITE COMMAND'                                        95449968
MSG17    DC    AL2(MSG18-*-2)                                           95499968
         DC    C'SS=0D00',C'  '                                         95549968
         DC    CL29'CHANNEL END,DEVICE END'                             95599968
         DC    CL11' ',CL29'UNIT EXCEPTION'                             95649968
         DC    C'3272 ATTEMPTED A READ BUFFER,READ MOD-  '              95699968
         DC    C'IFIED,WRITE OR ERASE/WRITE COMMAND BUT  '              95749968
         DC    C'FOUND AFTER RETURNING INITIAL STATUS,   '              95799968
         DC    C'THE ADDRESSED DEVICE WAS BUSY           '              95849968
         DC    C'                                        '              95899968
MSG18    DC    AL2(MSG19-*-2)                                           95949968
         DC    C'SS=820C',C'  '                                         95999968
         DC    CL29'ATTENTION,UNIT CHECK'                               96049968
         DC    CL11' ',CL29'DATA CHECK,UNIT SPECIFY'                    96099968
         DC    C'AN IDLE DEVICE DETECTED A PARITY CHECK  '              96149968
         DC    C'OR CURSOR CHECK IN ITS BUFFER'                         96199968
MSG19    DC    AL2(MSG20-*-2)                                           96249968
         DC    C'SS=8210',C'  '                                         96299968
         DC    CL29'ATTENTION,UNIT CHECK'                               96349968
         DC    CL11' ',CL29'EQUIPMENT CHECK'                            96399968
         DC    C'AN IDLE 3272 POLLED A DEVICE TWICE AND  '              96449968
         DC    C'DETECTED A TRANSMIT PARITY CHECK EACH   '              96499968
         DC    C'TIME ON THE DATA IN THE DEVICE REPLY    '              96549968
MSG20    DC    AL2(MSG21-*-2)                                           96599968
         DC    C'SS=860C',C'  '                                         96649968
         DC    CL29'ATTENTION,DEV END,UNIT CHECK'                       96699968
         DC    CL11' ',CL29'DATA CHECK,UNIT SPECIFY'                    96749968
         DC    C'A DEVICE CHANGED FROM NOT AVAILABLE TO  '              96799968
         DC    C'AVAILABLE OR NOT READY TO READY AND DET-'              96849968
         DC    C'ECTED A CURSOR CK IN ITS BUFFER OR A PRI'              96899968
         DC    C'NTER DETECTED A PARITY CK WHILE PRINTING'              96949968
MSG21    DC    AL2(MSG22-*-2)                                           96999968
         DC    C'SS=8640',C'  '                                         97049968
         DC    CL29'ATTN,DEVICE END,UNIT CK'                            97099968
         DC    CL11' ',CL29'INTERVENTION REQUIRED'                      97149968
         DC    C'THE ADDRESSED PRINTER BECAME NOT READY  '              97199968
         DC    C'(OUT OF PAPER OR COVER OPEN)BEFORE PRINT'              97249968
         DC    C'OPERATION WAS COMPLETED                 '              97299968
         DC    C'                                        '              97349968
MSG22    DC    AL2(MSG23-*-2)                                           97399968
         DC    C'SS=8654',C'  '                                         97449968
         DC    CL29'ATTN,DEVICE END,UNIT CHECK   '                      97499968
         DC    CL11' ',CL29'INTV RQRD,EQUIPT CK,UNIT SPEC'              97509968
         DC    C'A PRINTER BECAME MECHANICALLY DISABLED  '              97549968
         DC    C'DURING A PRINTOUT AND AUTOMATIC RECOVERY'              97599968
         DC    C'WAS NOT SUCCESSFUL'                                    97649968
MSG23    DC    AL2(MSG24-*-2)                                           97699968
         DC    C'SS=0000',C'  '                                         97749968
         DC    CL29'ZERO STATUS     '                                   97799968
         DC    C'NORMAL STATUS FOR ANY COMMAND OTHER THAN'              97849968
         DC    C'NO-OP,SELECT,OR ERASE ALL UNPROTECTED   '              97899968
         DC    C'                                        '              97949968
MSG24    DC    AL2(MSG25-*-2)                                           97999968
         DC    C'SS=0400',C'  '                                         98049968
         DC    CL29'DEVICE END          '                               98099968
         DC    C'DENOTES THE FOLLOWING CHANGE IN DEVICE  '              98149968
         DC    C'STATUS--BUSY TO NOT BUSY,NOT AVAILABLE  '              98199968
         DC    C'TO AVAILABLE,BUFFER TRANSFER COMPLETE,  '              98249968
         DC    C'OR ON/OFF LINE SWITCH TO ONLINE'                       98299968
MSG25    DC    AL2(MSG26-*-2)                                           98349968
         DC    C'SS=0800',C'  '                                         98399968
         DC    CL29'CHANNEL END     '                                   98449968
         DC    C'NORMAL STATUS FOR SELECT OR EAU         '              98499968
         DC    C'                                        '              98549968
MSG26    DC    AL2(MSG27-*-2)                                           98599968
         DC    C'SS=0C00',C'  '                                         98649968
         DC    CL29'CHANNEL END,DEVICE END'                             98699968
         DC    C'NORMAL STATUS FOR A NO-OP COMMAND       '              98749968
         DC    C'                                        '              98799968
MSG27    DC    AL2(MSG28-*-2)                                           98849968
         DC    C'SS=1000',C'  '                                         98899968
         DC    CL29'BUSY            '                                   98949968
         DC    C'RESPONSE TO A COMMAND ADDRESSED TO A    '              98999968
         DC    C'DEVICE SERVICING A PRIOR ISSUED COMMAND'               99049968
MSG28    DC    AL2(MSG29-*-2)                                           99099968
         DC    C'SS=2000',C'  '                                         99149968
         DC    CL29'CONTROL UNIT END'                                   99199968
         DC    C'3272 HAD BEEN ADDRESSED WHILE BUSY,BUT  '              99249968
         DC    C'IS NOW NOT BUSY AND FREE TO ACCEPT A NEW'              99299968
         DC    C'COMMAND                                 '              99349968
         DC    C'                                        '              99399968
MSG29    DC    AL2(MSG30-*-2)                                           99449968
         DC    C'SS=5000',C'  '                                         99499968
         DC    CL29'STATUS MODIFIER,BUSY'                               99549968
         DC    C'RESPONSE TO A COMMAND ADDRESSED TO A    '              99599968
         DC    C'DEVICE OTHER THAN DEVICE WHOSE STATUS IS'              99649968
         DC    C'PENDING OR DEVICE BEING SERVICED BY 3272'              99699968
MSG30    DC    AL2(LASTMSG-*-2)                                         99749968
         DC    C'SS=HELP',C'  '                                         99799968
         DC    CL29'LOCAL STATUS/SENSE HELPER.'                         99849968
         DC    CL40'FIELDS "SS=XXXX" REFER TO 1ST BYTE OF'              99899968
         DC    CL40'CSW AND THE SENSE BYTE.  FOR INSTANCE,'             99949968
         DC    CL40'IF ERROR DISPLAY SHOWED CSW=0E00 AND'               99956968
         DC    CL40'SENSE=02, LOOK UP MSG FOR "SS=0E02"'                99963968
LASTMSG  EQU   *                                                        99970968
         END   BNGILOCL                                                 99977968
./  ADD  SSI=73210055,NAME=BNGIMENU
*********************************************************************** 00050068
*                                                                     * 00100068
* MODULE NAME = BNGIMENU                                              * 00150068
*                                                                     * 00200068
* DESCRIPTIVE NAME =  IMS DEMF MENU DISPLAY MODULE                    * 00250068
*                                                                     * 00300068
* COPYRIGHT = NONE                                                    * 00350068
*                                                                     * 00400068
* STATUS = RELEASE 1, LEVEL 1                                         * 00450068
*                                                                     * 00500068
* FUNCTION = 1) DISPLAYS THE FIRST MENU SCREEN THAT OFFERS A CHOICE   * 00550068
*               OF ALL, 3270, REMOT OR LOCAL DISPLAYS;                * 00600068
*            2) DISPLAYS THE SECOND MENU SCREEN THAT DESCRIBES THE    * 00650068
*               SYNTAX OF THE DEMF COMMANDS AND PARAMETERS WHICH USE  * 00700068
*               EXPLICIT PHYSICAL ADDRESSES OR SYMBOLIC NAMES.        * 00750068
*                                                                     * 00800068
* NOTES = SEE BELOW                                                   * 00850068
*                                                                     * 00900068
*    DEPENDENCIES = NONE                                              * 00950068
*                                                                     * 01000068
*    RESTRICTIONS = NONE                                              * 01050068
*                                                                     * 01100068
*    REGISTER CONVENTIONS :                                           * 01150068
*    --------------------                                             * 01200068
*                                                                     * 01250068
*    ALL DEMF RECORDING DISPLAY COMPONENTS USE STANDARD REGISTER      * 01300068
*    CONVENTIONS WITH THE EXCEPTION OF THE IMS DISPLAY COMPONENTS.    * 01350068
*    CERTAIN IMS MODULES USE ADDITIONAL REGISTERS AND THE LINK MACRO  * 01400068
*    FOR PASSING OR RETRIEVING DATA PARAMETER INFORMATION AND ARE     * 01450068
*    DETAILED BELOW:                                                  * 01500068
*                                                                     * 01550068
*     MODULE    REGISTER    CONTENTS.                                 * 01600068
*    --------   --------    ------------------------------------      * 01650068
*    BNGIDISP     R5        PASSES ADDRESS OF IMS PROGRAM             * 01700068
*                           COMMUNICATION BLOCK (PCB) TO              * 01750068
*                           BNGI3270, BNGIMENU, BNGILOCL, AND         * 01800068
*                           BNGIRMOT.                                 * 01850068
*                                                                     * 01900068
*                 R11       PASSES TO BNGIREAD THE ADDRESS OF A       * 01950068
*                           PARAMETER LIST CONTAINING:                * 02000068
*                                                                     * 02050068
*                          1) 4-BYTES - ADDRESS OF I/O AREA FROM      * 02100068
*                                       BNGIREAD                      * 02150068
*                                                                     * 02200068
*                          2) 3-BYTES - RELATIVE BLOCK ADDRESS TO     * 02250068
*                                       BE READ BY BNGIREAD           * 02300068
*                                                                     * 02350068
*                          3) 2-BYTES - STATUS OF READ FROM           * 02400068
*                                       BNGIREAD                      * 02450068
*                                                                     * 02500068
*                 R12      FOR BNGI3270, PASSES THE ADDRESS OF A      * 02550068
*                          COMMUNICATION AREA CONTAINING              * 02600068
*                          UP TO SIX EDITTED PARM FIELDS, SAVE        * 02650068
*                          AND WORK AREAS, AND THE INPUT MESSAGE.     * 02700068
*                                                                     * 02750068
*                          FOR BNGILOCL, BNGIRMOT, AND BNGIMENU;      * 02800068
*                          PASSES THE ADDRESS OF THE INPUT MESSAGE.   * 02850068
*                                                                     * 02900068
*    BNGIREAD    LINK TO BNGIDCBA       RETRIEVES THE ADDRESS OF THE  * 02950068
*                (ALIAS FOR BNGISIMS)   ADDRESS OF THE SYS1.DEMFLOG   * 03000068
*                                       DCB.                          * 03050068
*                                                                     * 03100068
*                 R11      RECEIVES ADDRESS OF PARAMETER LIST         * 03150068
*                          (SEE BNGIDISP R11 FOR LIST).               * 03200068
*                                                                     * 03250068
*    BNGI3270     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 03300068
*                                                                     * 03350068
*                 R11     PASSES TO BNGIREAD THE ADDRESS OF A         * 03400068
*                         PARAMETER LIST (SEE BNGIDISP R11 FOR LIST)  * 03450068
*                                                                     * 03500068
*                 R12     RECEIVES FROM BNGIDISP THE ADDRESS OF THE   * 03550068
*                         COMMUNICATION AREA (SEE BNGIDISP R12 FOR    * 03600068
*                         CONTENTS OF AREA).                          * 03650068
*                                                                     * 03700068
*    BNGIMENU     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 03750068
*                                                                     * 03800068
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 03850068
*                         BNGIDISP.                                   * 03900068
*                                                                     * 03950068
*    BNGILOCL     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 04000068
*                                                                     * 04050068
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 04100068
*                         BNGIDISP.                                   * 04150068
*                                                                     * 04200068
*    BNGIRMOT     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 04250068
*                                                                     * 04300068
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 04350068
*                         BNGIDISP.                                   * 04400068
*                                                                     * 04450068
*    PATCH LABEL = NONE                                               * 04500068
*                                                                     * 04550068
* MODULE TYPE = IMS DISPLAY                                           * 04600068
*                                                                     * 04650068
*    PROCESSOR = ASSEMBLER H                                          * 04700068
*                                                                     * 04750068
*    MODULE SIZE =  319 DECIMAL BYTES                                 * 04800068
*                                                                     * 04850068
*    ATTRIBUTES = SERIALLY REUSABLE                                   * 04900068
*                                                                     * 04950068
* ENTRY POINT = BNGIMENU                                              * 05000068
*                                                                     * 05050068
*    PURPOSE = SEE FUNCTION                                           * 05100068
*                                                                     * 05150068
*    LINKAGE = R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 05200068
*                                                                     * 05250068
* INPUT = PARAM LIST ITEMS USED ARE : INPUT MESSAGE                   * 05300068
*                                                                     * 05350068
* OUTPUT = PARAM LIST ITEMS USED ARE : PAGE 1 OR 2 OF MENU DISPLAY    * 05400068
*                                                                     * 05450068
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 05500068
*               00 - OPERATION PERFORMED AS REQUESTED                 * 05550068
*                                                                     * 05600068
* EXIT-ERROR  = NONE                                                  * 05650068
*                                                                     * 05700068
* EXTERNAL REFERENCE = NONE                                           * 05750068
*                                                                     * 05800068
*    ROUTINES = NONE                                                  * 05850068
*                                                                     * 05900068
*    DATA AREAS =  NONE                                               * 05950068
*                                                                     * 06000068
*    CONTROL BLOCK = NONE                                             * 06050068
*                                                                     * 06100068
* TABLES = NONE                                                       * 06150068
*                                                                     * 06200068
* MACROS = SAVE, RETURN                                               * 06250068
*                                                                     * 06300068
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 06350068
* CHANGE 01   11/15/77  PROLOGUE ADDED                                * 06400068
*                                                                     * 06450068
*********************************************************************** 06500068
BNGIMENU TITLE 'DISPLAY EXCEPTION MONITORING FACILITY MENU PROGRAM'     96949968
         SPACE                                                          96999968
PCB      DSECT                 MAP OF IMS PROGRAM COMMUNICATION BLOCK   97049968
         USING *,PCBREG                                                 97099968
PCBTERMN DS    CL8                 REQUESTING TERMINAL SYMBOLIC NAME    97149968
         DS    CL2                 RESERVED                             97199968
PCBSTAT  DS    CL2                 DL/I STATUS CODE                     97249968
PCBDATE  DS    PL4                 TRANSACTION DATE STAMP 00YYDDDF      97299968
PCBTIME  DS    PL4                 TRANSACTION TIME STAMP HHMMSSTH      97349968
PCBSEQ   DS    F                   TRANSACTION SEQUENCE NUMBER          97399968
PCBMODNM DS    CL8                 MFS MESSAGE OUTPUT DESCRIPTOR NAME   97449968
MSGIN    DSECT                                                          97499968
         USING *,MSGINREG                                               97549968
TIOATDL  DS    H                   MESSAGE LENGTH INCL. LL,Z1,Z2,DATA   97599968
MSGZ1    DS    X                   FLAG FIELD - USED BY IMS INTERNALLY  97649968
MSGZ2    DS    X                   FLAG FIELD - NON-ZERO IF MFS EDITED  97699968
TIOADBA  DS    0F                  START OF MESSAGE DATA                97749968
MSGTXCD  DS    CL5                 DEMF                                 97799968
MSGKEYED DS    CL29                                                     97849968
MSGCMDCD DS    CL4                 MENU                                 97899968
MSGALL   DS    C                                                        97949968
MSG3270  DS    C                                                        97999968
MSGRMOT  DS    C                                                        98049968
MSGLOCL  DS    C                                                        98099968
MSGDPRSS DS    CL7                                                      98149968
         PRINT NOGEN                                                    98199968
BNGIMENU CSECT                                                          98249968
R1       EQU   1                                                        98299968
BASE1    EQU   2                                                        98349968
PCBREG   EQU   5                   POINTER TO TP-PCB ADDRESS            98399968
MSGINREG EQU   12                  POINTER TO MSGIN AREA                98449968
R13      EQU   13                                                       98499968
         SAVE  (14,12)             SAVE CALLER'S REGISTERS              98549968
         BALR  BASE1,0                                                  98599968
         USING *,BASE1                                                  98649968
         LA    14,SAVE             POINT TO OUR SAVE AREA               98699968
         ST    14,8(13)            FORWARD CHAIN FROM OLD               98749968
         ST    13,4(14)            BACKWARD CHAIN TO OLD                98799968
         LR    13,14               FIRST BASE AND S/A FOR OUR REGS      98849968
         B     GO                                                       98899968
SAVEID   DC    C'BNGIMENU - DISPLAY EXCEPTION MEASUREMENT FACILITY FOR ,98949968
               IMS'                EYE-CATCHER                          98999968
SAVE     DS    18F                 SAVE AREA                            99049968
GO       DS    0H                                                       99099968
         CLC   MSGDPRSS,=C'DEPRESS'      IS THIS A PAGE 2 REQUEST?      99149968
         BE    A10                        YES.                          99199968
         CALL  ASMTDLI,(ISRT,(PCBREG),,MENUPG1),VL                      99249968
         B     CHECKST                                                  99299968
A10      CALL  ASMTDLI,(ISRT,(PCBREG),,MENUPG2),VL                      99349968
CHECKST  CLC   PCBSTAT,DLIOK       DID ISRT GO OK?                      99399968
         BNE   ABEND1              IF NOT, ABEND.                       99449968
         L     R13,4(R13)          RESTORE INCOMING SAVE AREA ADDRESS   99499968
         RETURN (14,12)            RETURN TO BNGIDISP                   99549968
ABEND1   ABEND 111,DUMP                                                 99599968
*********************************************************************** 99649968
ISRT     DC    CL4'ISRT'           INSERT FUNCTION - OUTPUT TO TERMINAL 99699968
DLIOK    DC    CL2' '              DL/I STATUS SAYS OPERATION PERFORMED 99749968
MENUPG1  DC    CL8'BNGIOMN1'       MFS MESSAGE OUTPUT DESCRIPTOR NAME   99799968
MENUPG2  DC    CL8'BNGIOMN2'       MFS MESSAGE OUTPUT DESCRIPTOR NAME   99849968
         LTORG                                                          99899968
         END   BNGIMENU                                                 99949968
./  ADD  SSI=73070059,NAME=BNGIPCBX
         PSBGEN  LANG=ASSEM,PSBNAME=BNGICTRL                            00003098
         END                                                            00006098
./  ADD  SSI=73210060,NAME=BNGIREAD
*********************************************************************** 00000368
*                                                                     * 00000668
* MODULE NAME = BNGIREAD                                              * 00000968
*                                                                     * 00001268
* DESCRIPTIVE NAME =  IMS DEMF BDAM MODULE                            * 00001568
*                                                                     * 00001868
* COPYRIGHT = NONE                                                    * 00002168
*                                                                     * 00002468
* STATUS = RELEASE 1, LEVEL 1                                         * 00002768
*                                                                     * 00003068
* FUNCTION = 1) LINKS TO BNGIDCBA (ALIAS FOR BNGISIMS) FOR ADDRESS OF * 00003368
*               THE ADDRESS OF THE SYS1.DEMFLOG DCB;                  * 00003668
*            2) DETERMINES IF THE FILE IS OPENED;                     * 00003968
*            3) READS THE REQUESTED RECORD INTO HIS I/O AREA;         * 00004268
*            4) PASSES THE ADDRESS OF I/O AREA AND STATUS OF READ TO  * 00004568
*               CALLER.                                               * 00004868
*                                                                     * 00005168
* NOTES = NONE                                                        * 00005468
*                                                                     * 00005768
*    DEPENDENCIES = NONE                                              * 00006068
*                                                                     * 00006368
*    RESTRICTIONS = NONE                                              * 00006668
*                                                                     * 00006968
*    REGISTER CONVENTIONS :                                           * 00007268
*    --------------------                                             * 00007568
*                                                                     * 00007868
*    ALL DEMF RECORDING DISPLAY COMPONENTS USE STANDARD REGISTER      * 00008168
*    CONVENTIONS WITH THE EXCEPTION OF THE IMS DISPLAY COMPONENTS.    * 00008468
*    CERTAIN IMS MODULES USE ADDITIONAL REGISTERS AND THE LINK MACRO  * 00008768
*    FOR PASSING OR RETRIEVING DATA PARAMETER INFORMATION AND ARE     * 00009068
*    DETAILED BELOW:                                                  * 00009368
*                                                                     * 00009668
*     MODULE    REGISTER    CONTENTS.                                 * 00009968
*    --------   --------    ------------------------------------      * 00010268
*    BNGIDISP     R5        PASSES ADDRESS OF IMS PROGRAM             * 00010568
*                           COMMUNICATION BLOCK (PCB) TO              * 00010868
*                           BNGI3270, BNGIMENU, BNGILOCL, AND         * 00011168
*                           BNGIRMOT.                                 * 00011468
*                                                                     * 00011768
*                 R11       PASSES TO BNGIREAD THE ADDRESS OF A       * 00012068
*                           PARAMETER LIST CONTAINING:                * 00012368
*                                                                     * 00012668
*                          1) 4-BYTES - ADDRESS OF I/O AREA FROM      * 00012968
*                                       BNGIREAD                      * 00013268
*                                                                     * 00013568
*                          2) 3-BYTES - RELATIVE BLOCK ADDRESS TO     * 00013868
*                                       BE READ BY BNGIREAD           * 00014168
*                                                                     * 00014468
*                          3) 2-BYTES - STATUS OF READ FROM           * 00014768
*                                       BNGIREAD                      * 00015068
*                                                                     * 00015368
*                 R12      FOR BNGI3270, PASSES THE ADDRESS OF A      * 00015668
*                          COMMUNICATION AREA CONTAINING              * 00015968
*                          UP TO SIX EDITTED PARM FIELDS, SAVE        * 00016268
*                          AND WORK AREAS, AND THE INPUT MESSAGE.     * 00016568
*                                                                     * 00016868
*                          FOR BNGILOCL, BNGIRMOT, AND BNGIMENU;      * 00017168
*                          PASSES THE ADDRESS OF THE INPUT MESSAGE.   * 00017468
*                                                                     * 00017768
*    BNGIREAD    LINK TO BNGIDCBA       RETRIEVES THE ADDRESS OF THE  * 00018068
*                (ALIAS FOR BNGISIMS)   ADDRESS OF THE SYS1.DEMFLOG   * 00018368
*                                       DCB.                          * 00018668
*                                                                     * 00018968
*                 R11      RECEIVES ADDRESS OF PARAMETER LIST         * 00019268
*                          (SEE BNGIDISP R11 FOR LIST).               * 00019568
*                                                                     * 00019868
*    BNGI3270     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 00020168
*                                                                     * 00020468
*                 R11     PASSES TO BNGIREAD THE ADDRESS OF A         * 00020768
*                         PARAMETER LIST (SEE BNGIDISP R11 FOR LIST)  * 00021068
*                                                                     * 00021368
*                 R12     RECEIVES FROM BNGIDISP THE ADDRESS OF THE   * 00021668
*                         COMMUNICATION AREA (SEE BNGIDISP R12 FOR    * 00021968
*                         CONTENTS OF AREA).                          * 00022268
*                                                                     * 00022568
*    BNGIMENU     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 00022868
*                                                                     * 00023168
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 00023468
*                         BNGIDISP.                                   * 00023768
*                                                                     * 00024068
*    BNGILOCL     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 00024368
*                                                                     * 00024668
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 00024968
*                         BNGIDISP.                                   * 00025268
*                                                                     * 00025568
*    BNGIRMOT     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 00025868
*                                                                     * 00026168
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 00026468
*                         BNGIDISP.                                   * 00026768
*                                                                     * 00027068
*    PATCH LABEL = NONE                                               * 00027368
*                                                                     * 00027668
* MODULE TYPE =  IMS BDAM READ                                        * 00027968
*                                                                     * 00028268
*    PROCESSOR = ASSEMBLER H                                          * 00028568
*                                                                     * 00028868
*    MODULE SIZE = 4414 DECIMAL BYTES                                 * 00029168
*                                                                     * 00029468
*    ATTRIBUTES = SERIALLY REUSABLE                                   * 00029768
*                                                                     * 00030068
* ENTRY POINT = BNGIREAD                                              * 00030368
*                                                                     * 00030668
*    PURPOSE = SEE FUNCTION                                           * 00030968
*                                                                     * 00031268
*    LINKAGE = R1  LOADED WITH THE PARAM LIST POINTER                 * 00031568
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 00031868
*              R15 LOADED WITH ENTRY POINT                            * 00032168
*                                                                     * 00032468
* INPUT = PARAM LIST ITEMS USED ARE :                                 * 00032768
*                                                                     * 00033068
*                      PARMADDR DS    0F                              * 00033368
*                      IOAREA   DC    A(0)                            * 00033668
*                      RELREC   DC    XL3'0'                          * 00033968
*                      STATUS   DC    CL2'  '                         * 00034268
*                                                                     * 00034568
* OUTPUT = PARAM LIST ITEMS USED ARE :                                * 00034868
*                                                                     * 00035168
*                      PARMADDR DS    0F                              * 00035468
*                      IOAREA   DC    A(0)                            * 00035768
*                      RELREC   DC    XL3'0'                          * 00036068
*                      STATUS   DC    CL2'  '                         * 00036368
*                                                                     * 00036668
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 00036968
*               00 - OPERATION PERFORMED AS REQUESTED                 * 00037268
*                                                                     * 00037568
* EXIT-ERROR  = NONE                                                  * 00037868
*                                                                     * 00038168
* EXTERNAL REFERENCE = NONE                                           * 00038468
*                                                                     * 00038768
*    ROUTINES = NONE                                                  * 00039068
*                                                                     * 00039368
*    DATA AREAS = NONE                                                * 00039668
*                                                                     * 00039968
*    CONTROL BLOCK = DCB                                              * 00040268
*                                                                     * 00040568
* TABLES = NONE                                                       * 00040868
*                                                                     * 00041168
* MACROS = SAVE, RETURN, LOAD, DELETE, READ, WAIT                     * 00041468
*                                                                     * 00041768
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 00042068
* CHANGE 01   11/15/77  PROLOGUE ADDED                                * 00042368
*                                                                     * 00042668
*********************************************************************** 00042968
BNGIREAD TITLE '- DISPLAY EXCEPTION MONITORING FACILITY (DEMF) IMS BDAM,00050068
                READ PROGRAM'                                           00100068
*********************************************************************** 00150068
* THIS SECTION DOES PROGRAM INITIALIZATION, THEN GETS A RECORD        * 00200068
*********************************************************************** 00250068
         PRINT NOGEN                                                    00300068
PARMLIST DSECT                                                          00350068
         USING *,PARMREG                                                00400068
IOAREA   DS    F               ADDRESS OF I/O AREA FOR CALLER           00450068
RELREC   DS    CL3             RELATIVE BDAM BLOCK TO READ              00500068
STATUS   DS    CL2             STATUS OF READ FOR CALLER                00550068
BNGIREAD CSECT ,                   RE-DO OF CICS DEMF (ORIGINALLY FERS) 00600068
         SAVE  (14,12)             SAVE CALLER'S REGISTERS              00650068
         BALR  BASE1,0                                                  00700068
         USING *,BASE1,BASE2                                            00750068
         LA    BASE2,2048(BASE1)    SET SECOND BASE                     00800068
         LA    BASE2,2048(BASE2)       FROM THE FIRST                   00850068
         LA    4,SAVE              POINT TO OUR SAVE AREA               00900068
         ST    4,8(R13)            FORWARD CHAIN FROM OLD               00950068
         ST    R13,4(4)            BACKWARD CHAIN TO OLD                01000068
         LR    R13,4               FIRST BASE AND S/A FOR OUR REGS      01050068
         B     GO                                                       01100068
SAVEID   DC    C'BNGIREAD - DEMF READ PROGRAM'                          01150068
SAVE     DS    18F                 SAVE AREA                            01200068
GO       DS    0H                                                       01250068
A100     L     DCBREG,SAVEDCB      LOAD BDAM DCB ADDRESS                01300068
         LTR   DCBREG,DCBREG       TEST IF WE KNOW WHERE IT IS          01350068
         BNZ   READ                BYPASS LOAD IF WE ALREADY HAVE ADDR  01400068
         LOAD  EP=BNGIDCBA         ISSUE OS LOAD FOR DCB MODULE         01450068
         LR    DCBREG,0            SAVE ENTRY POINT ADDR                01500068
         DELETE EP=BNGIDCBA        DROP THE USE COUNT FOR THE MODULE    01550068
         L     DCBREG,0(DCBREG)    GET ADDR OF ADDR OF BDAM DCB         01600068
         L     DCBREG,0(DCBREG)    GET ADDR OF BDAM DCB                 01650068
         LTR   DCBREG,DCBREG       IF EQ 0, DCB WAS NOT OPENED OK       01700068
         BZ    NOTOPEN             GO HERE IF FILE NOT AVAILABLE        01750068
         ST    DCBREG,SAVEDCB      NOW WE SAVE THE DCB ADDR             01800068
READ     DS    0H                                                       01850068
         L     4,=A(INPUTA)        GET IOAREA INTO GPR 4                01900068
         ST    4,IOAREA            PASS I/O AREA ADDR TO CALLER         01950068
         MVC   READREL,RELREC      PRIME RELATIVE BLOCK ADDRESS         02000068
         XC    RDECB,RDECB         CLEAR THE DECB FOR BDAM READ         02050068
         READ  RDECB,DI,(DCBREG),(4),4096,0,READREL                     02100068
         WAIT  ECB=RDECB           WAIT FOR COMPLETION OF READ          02150068
         MVC   STATUS,RDECB+1                                           02200068
RETURN   L     13,SAVE+4                                                02250068
         RETURN (14,12)                                                 02300068
NOTOPEN  DS    0H                        OPEN FAILURE AND GO ON         02350068
         MVC   STATUS,=C'FF'                                            02400068
         B     RETURN                                                   02450068
* PROGRAM CONSTANTS                                                     02500068
         SPACE                                                          02550068
SAVEDCB  DC    F'0'                                                     02600068
READREL  DC    XL3'0'                                                   02650068
         EJECT                                                          02700068
* REGISTER EQUATES                                                      02750068
         SPACE                                                          02800068
R0       EQU   0                                                        02850068
R1       EQU   1                                                        02900068
BASE1    EQU   2                                                        02950068
BASE2    EQU   3                                                        03000068
PARMREG  EQU   11  PARAMETER REGISTER                                   03050068
DCBREG   EQU   5   DCB REGISTER POINTER                                 03100068
LINKREG  EQU   6   SUB-ROUTINE LINKAGE                                  03150068
OUTLOOP  EQU   7   OUTPUT LOOP CONTROL                                  03200068
OUTREG   EQU   8   OUTPUT DATA SCANNER                                  03250068
PCBREG   EQU   9   IMS PROGRAM COMMUNICATION BLOCK BASE                 03300068
TABLEREG EQU   10  HEADING-DATA TABLE BASE                              03350068
R11      EQU   11  PARMS PASSED IN THIS REGISTER FROM USER              03400068
R12      EQU   12  BASE REGISTER TWO - 4096-8191                        03450068
R13      EQU   13  BASE REGISTER ONE - 0000-4095                        03500068
R14      EQU   14                                                       03550068
R15      EQU   15                                                       03600068
         SPACE                                                          03650068
         LTORG                                                          03700068
INPUTA   DS    4096C                                                    03750068
         END   BNGIREAD                                                 03800068
./  ADD  SSI=73210048,NAME=BNGIRMOT
*********************************************************************** 00000368
*                                                                     * 00000668
* MODULE NAME = BNGIRMOT                                              * 00000968
*                                                                     * 00001268
* DESCRIPTIVE NAME =  IMS DEMF REMOTE TERMINAL ERROR TEXT DISPLAY     * 00001568
*                                                                     * 00001868
* COPYRIGHT = NONE                                                    * 00002168
*                                                                     * 00002468
* STATUS = RELEASE 1, LEVEL 1                                         * 00002768
*                                                                     * 00003068
* FUNCTION = 1) DISPLAYS CANNED STATUS/SENSE TEXT OF ALL POSSIBLE     * 00003368
*               REMOTE TERMINAL ERROR COMBINATIONS;                   * 00003668
*            2) PROVIDES THE SELECTION DISPLAY OF EXPLANATION AND     * 00003968
*               POSSIBLE CAUSES ON THE REMOTE TERMINAL STATUS/SENSE   * 00004268
*               WHICH IS SELECTED BY DEMF USER.                       * 00004568
*                                                                     * 00004868
* NOTES = NONE                                                        * 00005168
*                                                                     * 00005468
*    DEPENDENCIES = NONE                                              * 00005768
*                                                                     * 00006068
*    RESTRICTIONS = NONE                                              * 00006368
*                                                                     * 00006668
*    REGISTER CONVENTIONS :                                           * 00006968
*    --------------------                                             * 00007268
*                                                                     * 00007568
*    ALL DEMF RECORDING DISPLAY COMPONENTS USE STANDARD REGISTER      * 00007868
*    CONVENTIONS WITH THE EXCEPTION OF THE IMS DISPLAY COMPONENTS.    * 00008168
*    CERTAIN IMS MODULES USE ADDITIONAL REGISTERS AND THE LINK MACRO  * 00008468
*    FOR PASSING OR RETRIEVING DATA PARAMETER INFORMATION AND ARE     * 00008768
*    DETAILED BELOW:                                                  * 00009068
*                                                                     * 00009368
*     MODULE    REGISTER    CONTENTS.                                 * 00009668
*    --------   --------    ------------------------------------      * 00009968
*    BNGIDISP     R5        PASSES ADDRESS OF IMS PROGRAM             * 00010268
*                           COMMUNICATION BLOCK (PCB) TO              * 00010568
*                           BNGI3270, BNGIMENU, BNGILOCL, AND         * 00010868
*                           BNGIRMOT.                                 * 00011168
*                                                                     * 00011468
*                 R11       PASSES TO BNGIREAD THE ADDRESS OF A       * 00011768
*                           PARAMETER LIST CONTAINING:                * 00012068
*                                                                     * 00012368
*                          1) 4-BYTES - ADDRESS OF I/O AREA FROM      * 00012668
*                                       BNGIREAD                      * 00012968
*                                                                     * 00013268
*                          2) 3-BYTES - RELATIVE BLOCK ADDRESS TO     * 00013568
*                                       BE READ BY BNGIREAD           * 00013868
*                                                                     * 00014168
*                          3) 2-BYTES - STATUS OF READ FROM           * 00014468
*                                       BNGIREAD                      * 00014768
*                                                                     * 00015068
*                 R12      FOR BNGI3270, PASSES THE ADDRESS OF A      * 00015368
*                          COMMUNICATION AREA CONTAINING              * 00015668
*                          UP TO SIX EDITTED PARM FIELDS, SAVE        * 00015968
*                          AND WORK AREAS, AND THE INPUT MESSAGE.     * 00016268
*                                                                     * 00016568
*                          FOR BNGILOCL, BNGIRMOT, AND BNGIMENU;      * 00016868
*                          PASSES THE ADDRESS OF THE INPUT MESSAGE.   * 00017168
*                                                                     * 00017468
*    BNGIREAD    LINK TO BNGIDCBA       RETRIEVES THE ADDRESS OF THE  * 00017768
*                (ALIAS FOR BNGISIMS)   ADDRESS OF THE SYS1.DEMFLOG   * 00018068
*                                       DCB.                          * 00018368
*                                                                     * 00018668
*                 R11      RECEIVES ADDRESS OF PARAMETER LIST         * 00018968
*                          (SEE BNGIDISP R11 FOR LIST).               * 00019268
*                                                                     * 00019568
*    BNGI3270     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 00019868
*                                                                     * 00020168
*                 R11     PASSES TO BNGIREAD THE ADDRESS OF A         * 00020468
*                         PARAMETER LIST (SEE BNGIDISP R11 FOR LIST)  * 00020768
*                                                                     * 00021068
*                 R12     RECEIVES FROM BNGIDISP THE ADDRESS OF THE   * 00021368
*                         COMMUNICATION AREA (SEE BNGIDISP R12 FOR    * 00021668
*                         CONTENTS OF AREA).                          * 00021968
*                                                                     * 00022268
*    BNGIMENU     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 00022568
*                                                                     * 00022868
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 00023168
*                         BNGIDISP.                                   * 00023468
*                                                                     * 00023768
*    BNGILOCL     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 00024068
*                                                                     * 00024368
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 00024668
*                         BNGIDISP.                                   * 00024968
*                                                                     * 00025268
*    BNGIRMOT     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 00025568
*                                                                     * 00025868
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 00026168
*                         BNGIDISP.                                   * 00026468
*                                                                     * 00026768
*    PATCH LABEL = NONE                                               * 00027068
*                                                                     * 00027368
* MODULE TYPE =  IMS DISPLAY                                          * 00027668
*                                                                     * 00027968
*    PROCESSOR = ASSEMBLER H                                          * 00028268
*                                                                     * 00028568
*    MODULE SIZE = 12365 DECIMAL BYTES                                * 00028868
*                                                                     * 00029168
*    ATTRIBUTES = SERIALLY REUSABLE                                   * 00029468
*                                                                     * 00029768
* ENTRY POINT = BNGIRMOT                                              * 00030068
*                                                                     * 00030368
*    PURPOSE = SEE FUNCTION                                           * 00030668
*                                                                     * 00030968
*    LINKAGE = R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 00031268
*                                                                     * 00031568
* INPUT = PARAM LIST ITEMS USED ARE : INPUT MESSAGE                   * 00031868
*                                                                     * 00032168
* OUTPUT = PARAM LIST ITEMS USED ARE : REMOTE INDEX AND TEXT DISPLAYS * 00032468
*                                                                     * 00032768
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 00033068
*               00 - OPERATION PERFORMED AS REQUESTED                 * 00033368
*                                                                     * 00033668
* EXIT-ERROR  = NONE                                                  * 00033968
*                                                                     * 00034268
* EXTERNAL REFERENCE = NONE                                           * 00034568
*                                                                     * 00034868
*    ROUTINES = NONE                                                  * 00035168
*                                                                     * 00035468
*    DATA AREAS = NONE                                                * 00035768
*                                                                     * 00036068
*    CONTROL BLOCK = DCB                                              * 00036368
*                                                                     * 00036668
* TABLES = NONE                                                       * 00036968
*                                                                     * 00037268
* MACROS = SAVE, RETURN                                               * 00037568
*                                                                     * 00037868
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 00038168
* CHANGE 01   11/15/77  PROLOGUE ADDED                                * 00038468
*                                                                     * 00038768
*********************************************************************** 00039068
BNGIRMOT TITLE 'DEMF REMOTE SRL TEXT MODULE'                            00050068
R0       EQU   0                                                        00100068
R1       EQU   1                                                        00150068
R2       EQU   2                                                        00200068
R3       EQU   3                                                        00250068
R4       EQU   4                                                        00300068
R5       EQU   5                                                        00350068
R6       EQU   6                                                        00400068
R7       EQU   7                                                        00450068
R8       EQU   8                                                        00500068
R9       EQU   9                                                        00550068
R10      EQU   10                                                       00600068
R11      EQU   11                                                       00650068
R12      EQU   12                                                       00700068
R13      EQU   13                                                       00750068
R14      EQU   14                                                       00800068
R15      EQU   15                                                       00850068
PCBREG   EQU   R5                                                       00900068
MSGINREG EQU   R12                                                      00950068
BASEREG  EQU   R3                                                       01000068
TPIOPCB  DSECT                                                          01050068
PCBTERMN DS    CL8                  REQUESTING TERMINAL SYMBOLIC NAME   01100068
         DS    CL2                  RESERVED                            01150068
PCBSTAT  DS    CL2                  DL/I STATUS CODE                    01200068
PCBDATE  DS    PL4                  TRANSACTION DATE STAMP              01250068
PCBTIME  DS    PL4                  TRANSACTION TIME STAMP              01300068
PCBSEQ   DS    F                    TRANSACTION SEQUENCE NUMBER         01350068
PCBMODNM DS    CL8                  MFS MSG OUTPUT DESCRIPTOR NAME      01400068
MSGINMAP DSECT                                                          01450068
MSGIN    DS    0D                   MAP OF TRANSACTION MSG SEGMENT      01500068
TIOATDL  DS    H                    DATA LENGTH                         01550068
MSGZ1    DS    X                                                        01600068
MSGZ2    DS    X                                                        01650068
MSGTXCD  DS    CL11                 DEMF LOCAL  FOR THIS MODULE         01700068
MSGEYED  DS    0CL8                 XSS=CODE  IF TEXT PAGE              01750068
X        DS    CL1                  X         IF TEXT PAGE              01800068
SSEQUAL  DS    CL3                  SS=       IF TEXT PAGE              01850068
SSCODE   DS    CL4                  CODE FOR CSW-SS IF TEXT             01900068
BNGIRMOT CSECT                                                          01950068
XNGIRMOT SAVE  (14,12),T,*                                              02000068
         LR    BASEREG,R15          ESTABLISH BASE REGISTER             02050068
         USING BNGIRMOT,BASEREG     MODULE BASE REGISTER                02100068
         USING TPIOPCB,PCBREG       IMS TP IOPCB BASE                   02150068
         USING MSGINMAP,MSGINREG    DSECT MAP OF TRAN MSG SEG           02200068
         LR    R6,R13               GET ADDRESS OF SAVE AREA            02250068
         ST    R13,SAVEAREA+4       SAVE R13 MY SAVE AREA               02300068
         LA    R13,SAVEAREA         ADDRESS OF MY SAVE AREA             02350068
         ST    R13,8(R6)            STORE MY SAVE                       02400068
TESTCALL EQU   *                    TEST INDEX OR TEXT CALL             02450068
         CLC   SSEQUAL,QSSEQUAL+1   REQUEST FO TEXT PAGE?               02500068
         BE    TEXTPAGE             YES, GO FIND CSW-SS MSG             02550068
*                                   NO.  BUILD INDEX PAGE MSG           02600068
INDXPAGE EQU   *                    REQUEST FOR INDEX PAGE              02650068
*                                   OR UNDETERMINED CODE ENTERED        02700068
         LA    R6,CSWSSNBR          ADDR OF CSW-SS STATUS CODES         02750068
         LA    R7,MSGOINDX          ADDR OF MESSAGE OUTPUT AREA         02800068
         LA    R8,CSWSSEND+4       *UPPER LIMIT OF CSW-SS CODES         02850068
NEXTCODE EQU   *                                                        02900068
         CR    R6,R8                TEST FOR UPPER LIMIT OF CODES       02950068
         BE    INDXOUT              END OF CSW-SS CODES-GET OUT         03000068
         MVC   0(4,R7),QSSEQUAL     MOVE ?SS= TO OUTPUT AREA            03050068
         MVC   4(4,R7),0(R6)        MOVE CSW-SS CODE TO OUTPUT AREA     03100068
         LA    R7,8(R7)             BUMP ADDR FOR NEXT ?SS=XXXX         03150068
         LA    R6,8(R6)            *BUMP ADDR FOR NEXT CSW-SS CODE      03200068
         B     NEXTCODE             GO GET NEXT ?SS=XXXX                03250068
INDXOUT  EQU   *                    INDEX PAGE OUTPUT PREPARATION       03300068
         MVI   0(R7),X'3F'          INSERT 3F LAST CHARACTER OF INDEX   03350068
         LA    R6,MSGOHDR           ADDR OF MSG HEADER OUT AREA         03400068
         MVC   0(IXHDRL,R6),IXHDR   MOVE INDEX HEADER TO OUT AREA       03450068
         SR    R6,R6                CLEAR REGISTER                      03500068
         LA    R6,CSWSSLTH          LENGTH OF CSW-SS CODES              03550068
         AR    R6,R6                ADD LENGTH FOR EACH ?SS=            03600068
         LA    R6,4(R6)             ADD LENGTH OF LLZZ FIELD            03650068
         LA    R6,IXHDRL(R6)        ADD LENGTH OF HEADER                03700068
         LA    R6,1(R6)             ADD ONE FOR LENGTH OF 3F CHARACTER  03750068
         STH   R6,MSGOUTLL          STORE LENGTH IN LL FIELD            03800068
         MVC   MODNAME,REMOTEI      MFS MOD NAME INDEX PAGE             03850068
         B     CALLDLI              BRANCH TO IMS DL/I CALL             03900068
TEXTPAGE EQU   *                                                        03950068
         LA    R6,CSWSSNBR          ADDR OF BEGIN OF CSW-SS CODES       04000068
         LA    R7,MSGADDR           ADDR OF FIRST MESSAGE               04050068
         LA    R8,CSWSSEND+4       *UPPER LIMIT CHECK FOR CODES         04100068
CODETEST EQU   *                                                        04150068
         CR    R6,R8                TEST FOR LIMIT I.E. CODE NOT FOUND  04200068
         BE    INDXPAGE             BRANCH TO DISPLAY INDEX PAGE        04250068
         CLC   0(4,R6),SSCODE       COMPARE INPUT CSW-SS CODE TO TABLE  04300068
         BE    BUILDTXT             YES, BUILD TEXT PAGE MESSAGE        04350068
         LA    R6,8(R6)            *NO, LOOK FOR ANOTHER CSW-SS CODE    04400068
         LA    R7,8(R7)            *AND BUMP TO CORRESPONDING MESSAGE   04450068
         B     CODETEST                                                 04500068
BUILDTXT EQU   *                    TEXT PAGE OUTPUT PREPARATION        04550068
         MVI   TEXTLG+150,C' '      CLEAR BOTTOM HALF OF LG SCREEN      04600068
         MVC   TEXTLG+151(240),TEXTLG+150                               04650068
         LA    R6,MSGOHDR           ADDR MSG HEADER OUT AREA            04700068
         MVC   0(TXHDRL,R6),TXHDR   MOVE TEXT HEADER TO OUT AREA        04750068
         L     R7,0(R7)             ADDR OF MSG LENGTH                  04800068
         LA    R8,2(R7)             ADDR OF MSG TEXT TO MOVE            04850068
         LH    R7,0(R7)             GET MSG LENGTH THIS MESSAGE         04900068
         LR    R9,R7                MSG LENGTH FOR MOVE LONG            04950068
         LA    R6,MSGOTEXT          ADDR MESSAGE OUTPUT AREA            05000068
         MVCL  R6,R8                MOVE MESSAGE                        05050068
         MVI   1(R6),X'3F'         *INSERT 3F CHARACTER AT END OF TEXT  05100068
         MVC   MODNAME,REMOTET      MFS MOD NAME TEXT PAGE              05150068
         MVC   TEXTSM(200),TEXTLG      MOVE LARGE SCREEN TEXT TO        05200068
         MVC   TEXTSM+200(191),TEXTLG+200    SMALL SCREEN AREA          05250068
CALLDLI  EQU   *                                                        05300068
         CALL  ASMTDLI,(ISRT,(PCBREG),MSGOUT,MODNAME),VL                05350068
*                                   TEST IMS DL/I STATUS CODE           05400068
         L     R13,SAVEAREA+4       RESTORE SAVE AREA ADDRESS           05450068
         RETURN (14,12),RC=0                                            05500068
         LTORG                                                          05550068
SAVEAREA DC    18F'0'               SAVE AREA                           05600068
ISRT     DC    CL4'ISRT'            IMS DL/I INSERT FUNCTION            05650068
REMOTEI  DC    CL8'BNGIOLC1'        NAME OF MFS REMOTE INDEX PAGE MOD   05700068
REMOTET  DC    CL8'BNGIOLC2'        NAME OF MFS REMOTE TEXT  PAGE MOD   05750068
QSSEQUAL DC    CL4'?SS='            CHARACTERS FOR INDEX PAGE           05800068
MODNAME  DC    CL8' '               MFS MOD NAME FOR IMS CALL           05850068
IXHDR    DC    CL11'DEMF REMOTE'                                        05900068
         DC    CL27'STATUS INDEX,X OVER ?,ENTER'                        05950068
         DC    CL39'HIT CLEAR KEY TO EXIT DEMF'                         06000068
IXHDRL   EQU   *-IXHDR                                                  06050068
TXHDR    DC    CL11'DEMF REMOTE'                                        06100068
         DC    CL27'HIT ENTER TO REFRESH INDEX'                         06150068
TXHDRL   EQU   *-TXHDR                                                  06200068
MSGOUT   DS    0D                   MESSAGE OUTPUT AREA                 06250068
MSGOUTLL DC    AL2(MSGOLTH)         MESSAGE LENGTH LL FIELD             06300068
MSGOUTZ1 DC    X'00'                               Z1 FIELD             06350068
MSGOUTZ2 DC    X'00'                               Z2 FIELD             06400068
MSGODATA DS    0F                   BEGINNING OF MSG DATA               06450068
MSGOHDR  DS    CL38                 MESSAGE HEADER-TEXT PAGE            06500068
MSGOTEXT DS    CL7                  TEXT PAGE                           06550068
TEXTLG   DS    CL391                TEXT PAGE FOR LARGE SCREEN          06600068
TEXTSM   DS    CL391                TEXT PAGE FOR SMALL SCREEN          06650068
MSGOLTH  EQU   *-MSGOUT                                                 06700068
SETORG   DS    C                                                        06750068
         ORG   MSGODATA                                                 06800068
         DS    CL77                 MESSAGE HEADER-INDEX PAGE           06850068
MSGOINDX DS    40CL8                INDEX PAGE                          06900068
         ORG   SETORG                                                   06950068
MSGADDR  DS    0F                                                       07000068
M1       DC    AL4(MSG1)                                                07050068
CSWSSNBR DC    CL4'404C'                                                07100068
M2       DC    AL4(MSG2),CL4'4050'                                      07150068
M3       DC    AL4(MSG3),CL4'4060'                                      07200068
M4       DC    AL4(MSG4),CL4'40C1'                                      07250068
M5       DC    AL4(MSG5),CL4'40C2'                                      07300068
M6       DC    AL4(MSG6),CL4'40C3'                                      07350068
M7       DC    AL4(MSG7),CL4'40C4'                                      07400068
M8       DC    AL4(MSG8),CL4'40C5'                                      07450068
M9       DC    AL4(MSG9),CL4'40C8'                                      07500068
M10      DC    AL4(MSG10),CL4'40D1'                                     07550068
M11      DC    AL4(MSG11),CL4'4A40'                                     07600068
M12      DC    AL4(MSG12),CL4'4C40'                                     07650068
M13      DC    AL4(MSG13),CL4'4CC1'                                     07700068
M14      DC    AL4(MSG14),CL4'4E40'                                     07750068
M15      DC    AL4(MSG15),CL4'C140'                                     07800068
M16      DC    AL4(MSG16),CL4'C240'                                     07850068
M17      DC    AL4(MSG17),CL4'C250'                                     07900068
M18      DC    AL4(MSG18),CL4'C2C4'                                     07950068
M19      DC    AL4(MSG19),CL4'C2C8'                                     08000068
M20      DC    AL4(MSG20),CL4'C2D8'                                     08050068
M21      DC    AL4(MSG21),CL4'C4C1'                                     08100068
M22      DC    AL4(MSG22),CL4'C4C4'                                     08150068
M23      DC    AL4(MSG23),CL4'C4C5'                                     08200068
M24      DC    AL4(MSG24),CL4'C4D8'                                     08250068
M25      DC    AL4(MSG25),CL4'C6C4'                                     08300068
M26      DC    AL4(MSG26),CL4'C6C8'                                     08350068
M27      DC    AL4(MSG27),CL4'C6D8'                                     08400068
M28      DC    AL4(MSG28),CL4'C840'                                     08450068
M29      DC    AL4(MSG29),CL4'C8C1'                                     08500068
M30      DC    AL4(MSG30),CL4'HELP'                                     08550068
CSWSSEND EQU   *                                                        08600068
CSWSSLTH EQU   ((CSWSSEND-CSWSSNBR+4)/8)*4                              08650068
MSG1     DC    AL2(MSG2-*-2)                                            08700068
         DC    C'SS=404C',C'  '                                         08750068
         DC    CL29'EQUIPMENT CHECK,DATA CHECK'                         08800068
         DC    C'THE 3271 DETECTED BAD PARITY ON DATA    '              08850068
         DC    C'RECEIVED FROM THE ADDRESSED DEVICE ON   '              08900068
         DC    C'A SPECIFIC OR GENERAL POLL OR A SELECT  '              08950068
         DC    C'COMMAND.                                '              09000068
         DC    C'                                        '              09050068
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT        '              09100068
         DC    C'                 EOT-TO SPEC OR GEN POLL'              09150068
MSG2     DC    AL2(MSG3-*-2)                                            09200068
         DC    C'SS=4050',C'  '                                         09250068
         DC    CL29'INTERVENTION REQUIRED'                              09300068
         DC    C'                                        '              09350068
         DC    C'THE ADDRESSED DEVICE IS NOT AVAILABLE   '              09400068
         DC    C'OR ADDRESSED PRINTER IS NOT READY ON A  '              09450068
         DC    C'SELECT,READ,WRITE,ERASE/WRITE OR COPY-  '              09500068
         DC    C'COMMAND.                                '              09550068
         DC    C'                                        '              09600068
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT.       '              09650068
         DC    C'                 EOT-TO A READ,WRITE,-  '              09700068
         DC    C'                     ERASE/WRITE OR COPY'              09750068
         DC    C'                     COMMAND.'                         09800068
MSG3     DC    AL2(MSG4-*-2)                                            09850068
         DC    C'                                        '              09900068
         DC    C'SS=4060',C'  '                                         09950068
         DC    CL29'COMMAND REJECT'                                     10000068
         DC    C'AN INVALID OR ILLEGAL COMMAND WAS       '              10050068
         DC    C'RECEIVED BY THE 3271 OR 3275.           '              10100068
         DC    C'                                        '              10150068
         DC    C'DEVICE RESPONSE= EOT-TO A READ OR WRITE '              10200068
         DC    C'                     COMMAND.'                         10250068
MSG4     DC    AL2(MSG5-*-2)                                            10300068
         DC    C'SS=40C1',C'  '                                         10350068
         DC    CL29'OPERATION CHECK'                                    10400068
         DC    C'AN INVALID COMMAND SEQUENCE,(NON RECOVER'              10450068
         DC    C'ABLE PROGRAM ERROR)                     '              10500068
         DC    C'(1)ESCAPE COMMAND SEQUENCE NOT IN SECOND'              10550068
         DC    C'DATA CHARACTER POSITION (HEX 27)        '              10600068
         DC    C'(2)DATA FOLLOWS THE COMMAND IN THE DATA-'              10650068
         DC    C'STREAM RECEIVED BY THE DEVICE.          '              10700068
         DC    C'(3)DATA-STREAM CONTAINS OTHER THAN TWO  '              10750068
         DC    C'BYTES,(COPY CONTROL CHARACTER AND FROM  '              10800068
         DC    C'ADDRESS) COMMAND IS ABORTED.            '              10850068
         DC    C'DEVICE RESPONSE= EOT-TO READ,WRT OR EAU.'              10900068
MSG5     DC    AL2(MSG6-*-2)                                            10950068
         DC    C'SS=40C2',C'  '                                         11000068
         DC    CL29'CONTROL CHECK'                                      11050068
         DC    C'                                        '              11100068
         DC    C'THE DEVICE FAILS TO RESPOND TO THE 3271 '              11150068
         DC    C'IN TIME AND CAUSES A TIMEOUT OR THE POLL'              11200068
         DC    C'FINDS A DEVICE THAT WAS PREVIOUSLY      '              11250068
         DC    C'AVAILABLE AND READY,NOW UNAVAILABLE AND '              11300068
         DC    C'TIMES OUT.                              '              11350068
         DC    C'                                        '              11400068
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT COMMAND'              11450068
         DC    C'                 EOT-TO A WRITE,SPECIFIC'              11500068
         DC    C'                     OR A GENERAL POLL.'               11550068
MSG6     DC    AL2(MSG7-*-2)                                            11600068
         DC    C'SS=40C3',C'  '                                         11650068
         DC    CL29'CONTROL CHECK,OPERATION CHECK'                      11700068
         DC    C'                                        '              11750068
         DC    C'THE FROM DEVICE FAILS TO COMPLETE AN    '              11800068
         DC    C'OPERATION OR RESPOND TO THE 3271 IN A   '              11850068
         DC    C'PREDETERMINED TIME PERIOD AND TIMES OUT.'              11900068
         DC    C'                                        '              11950068
         DC    C'DEVICE RESPONSE= EOT TO A COPY COMMAND.'               12000068
MSG7     DC    AL2(MSG8-*-2)                                            12050068
         DC    C'SS=40C4',C'  '                                         12100068
         DC    CL29'DATA CHECK'                                         12150068
         DC    C'(1)CURSOR CHECK IS DETECTED AT THE 3271 '              12200068
         DC    C'OR BAD PARITY ON DATA FROM THE ADDRESSED'              12250068
         DC    C'DEVICE,(NO DATA SENT TO TCU)(2) A PARITY'              12300068
         DC    C'CHECK DETECTED BY 3271,A SUB CHARACTER  '              12350068
         DC    C'IS SUBSTITUTED FOR THE ERROR CHARACTER  '              12400068
         DC    C'DURING TRANSMISSION TO TCU,WHEN COMPLETE'              12450068
         DC    C'THE 3271 SENDS ENQ TO INDICATE AN ERROR.'              12500068
         DC    C'THE TCU RESPONDS NAK,THE 3271 ANSWERS   '              12550068
         DC    C'EOT.ABOVE IS IN RESPONSE TO A READ,WRITE'              12600068
         DC    C'COMMAND OR A SPECIFIC OR GENERAL POLL.'                12650068
MSG8     DC    AL2(MSG9-*-2)                                            12700068
         DC    C'SS=40C5',C'  '                                         12750068
         DC    CL29'DATA CHECK,OPERATION CHECK'                         12800068
         DC    C'                                        '              12850068
         DC    C'THE 3271 DETECTS A PARITY CHECK ON THE  '              12900068
         DC    C'DATA TRANSFERRED FROM THE FROM DEVICE.  '              12950068
         DC    C'                                        '              13000068
         DC    C'DEVICE RESPONSE= EOT-TO THE COPY COMMAND'              13050068
MSG9     DC    AL2(MSG10-*-2)                                           13100068
         DC    C'SS=40C8',C'  '                                         13150068
         DC    CL29'EQUIPMENT CHECK'                                    13200068
         DC    C'                                        '              13250068
         DC    C'THE 3271 DETECTED A PARITY CHECK ON DATA'              13300068
         DC    C'RECEIVED FROM THE DEVICE.               '              13350068
         DC    C'(EQUIPMENT CHECK MAY ALSO BE COMBINED   '              13400068
         DC    C'WITH DATA CHECK,REF 40C4)               '              13450068
         DC    C'                                        '              13500068
         DC    C'DEVICE RESPONSE= EOT-TO A SELECT,READ,  '              13550068
         DC    C'                     WRITE,SPECIFIC OR  '              13600068
         DC    C'                     GENERAL POLL.'                    13650068
MSG10    DC    AL2(MSG11-*-2)                                           13700068
         DC    C'SS=40D1',C'  '                                         13750068
         DC    CL29'INTERVENTION REQUIRED'                              13800068
         DC    C'                   OPERATION CHECK      '              13850068
         DC    C'                                        '              13900068
         DC    C'THE DEVICE IS UNAVAILABLE.              '              13950068
         DC    C'                                        '              14000068
         DC    C'DEVICE RESPONSE= EOT-TO A COPY COMMAND.'               14050068
MSG11    DC    AL2(MSG12-*-2)                                           14100068
         DC    C'SS=4A40',C'  '                                         14150068
         DC    CL29'DEVICE BUSY,DEVICE END'                             14200068
         DC    C'                                        '              14250068
         DC    C'DEVICE BUSY AND DEVICE END CAN OCCUR    '              14300068
         DC    C'TOGETHER IN RESPONSE TO A SPECIFIC POLL '              14350068
         DC    C'TO A FORMATTED 3277 IF THE OPERATOR HAS '              14400068
         DC    C'PERFORMED BACKTAB OR ERASE INPUT IN     '              14450068
         DC    C'RAPID SUCCESSION.                       '              14500068
         DC    C'IGNORE DEVICE END AND TREAT AS BUSY ONLY'              14550068
         DC    C'                                        '              14600068
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC POLL'               14650068
MSG12    DC    AL2(MSG13-*-2)                                           14700068
         DC    C'SS=4C40',C'  '                                         14750068
         DC    CL29'DEVICE BUSY,UNIT SPECIFY'                           14800068
         DC    C'                                        '              14850068
         DC    C'ON A READ COMMAND,THE DEVICE WAS BUSY.  '              14900068
         DC    C'THE COMMAND WAS CHAINED TO A SPECIFIC   '              14950068
         DC    C'POLL,WRITE,ERASE/WRITE,OR COPY COMMAND  '              15000068
         DC    C'WHICH STARTED A PRINTER.                '              15050068
         DC    C'ON A COPY COMMAND, THE ADDRESSED "TO"   '              15100068
         DC    C'DEVICE WAS BUSY.                        '              15150068
         DC    C'                                        '              15200068
         DC    C'DEVICE RESPONSE= EOT-TO A READ,WRITE,OR '              15250068
         DC    C'                     A COPY COMMAND.'                  15300068
MSG13    DC    AL2(MSG14-*-2)                                           15350068
         DC    C'SS=4CC1',C'  '                                         15400068
         DC    CL29'DEVICE BUSY,UNIT SPECIFY'                           15450068
         DC    C'                OPERATION CHECK         '              15500068
         DC    C'THE DB,US AND OP CHECK STATUS AND SENSE '              15550068
         DC    C'WILL BE COMBINED IF A COPY COMMAND IS   '              15600068
         DC    C'ADDRESSED TO A BUSY "TO" DEVICE AND THE '              15650068
         DC    C'COMMAND ALSO SPECIFIES THE "FROM" DEVICE'              15700068
         DC    C'THE SAME AS THE "TO" DEVICE.            '              15750068
         DC    C'                                        '              15800068
         DC    C'DEVICE RESPONSE= EOT-TO A COPY COMMAND.'               15850068
MSG14    DC    AL2(MSG15-*-2)                                           15900068
         DC    C'SS=4E40',C'  '                                         15950068
         DC    CL29'DEVICE BUSY,UNIT SPECIFY'                           16000068
         DC    C'                  DEVICE END            '              16050068
         DC    C'                                        '              16100068
         DC    C'THE ADDRESSED DEVICE BECOMES NOT BUSY   '              16150068
         DC    C'BEFORE A SPECIFIC POLL IS ISSUED TO     '              16200068
         DC    C'RETRIEVE THE STATUS AND SENSE DATA.     '              16250068
         DC    C'                                        '              16300068
         DC    C'DEVICE RESPONSE= EOT-TO A READ OR WRITE '              16350068
         DC    C'                     COMMAND.'                         16400068
MSG15    DC    AL2(MSG16-*-2)                                           16450068
         DC    C'SS=C140',C'  '                                         16500068
         DC    CL29'TRANSMISSION CHECK'                                 16550068
         DC    C'                                        '              16600068
         DC    C'3275 DETECTED A BCC ERROR ON THE TCU    '              16650068
         DC    C'TRANSMISSION.                           '              16700068
         DC    C'(TRANSMISSION CHECK NOT USED BY 3271)   '              16750068
         DC    C'                                        '              16800068
         DC    C'DEVICE RESPONSE= EOT-TO A READ OR WRITE '              16850068
         DC    C'                     COMMAND.'                         16900068
MSG16    DC    AL2(MSG17-*-2)                                           16950068
         DC    C'SS=C240',C'  '                                         17000068
         DC    CL29'DEVICE END'                                         17050068
         DC    C'THE POLL FINDS A DEVICE (1) PREVIOUSLY- '              17100068
         DC    C'BUSY,NOW NOT BUSY OR,(2) PREVIOUSLY-    '              17150068
         DC    C'UNAVAILABLE OR NOT READY, NOW AVAILABLE '              17200068
         DC    C'AND READY. (THE 3271 RECORD IS UPDATED) '              17250068
         DC    C'NOTE: WHEN 3271 POWER IS TURNED ON, THE '              17300068
         DC    C'"DEVICE END" IS SET FOR EACH AVAILABLE  '              17350068
         DC    C'AND READY DEVICE THAT IS ATTACHED.      '              17400068
         DC    C'                                        '              17450068
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR   '              17500068
         DC    C'                     GENERAL POLL.'                    17550068
MSG17    DC    AL2(MSG18-*-2)                                           17600068
         DC    C'SS=C250',C'  '                                         17650068
         DC    CL29'DEVICE END'                                         17700068
         DC    C'                   INTERVENTION REQUIRED'              17750068
         DC    C'(1)UPON SELECTION THE ADDRESSED PRINTER '              17800068
         DC    C'IS OUT OF PAPER, ITS POWER HAS BEEN TURN'              17850068
         DC    C'ED OFF, OR ITS COVER IS OPEN.           '              17900068
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT COMMAND'              17950068
         DC    C'                                        '              18000068
         DC    C'(2) THE POLL FINDS THE PRINTER NOT READY'              18050068
         DC    C'OR NOT AVAILABLE.                       '              18100068
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR   '              18150068
         DC    C'                     GENERAL POLL.'                    18200068
MSG18    DC    AL2(MSG19-*-2)                                           18250068
         DC    C'SS=C2C4',C'  '                                         18300068
         DC    CL29'DEVICE END,DATA CHECK'                              18350068
         DC    C'                                        '              18400068
         DC    C'3275 (ONLY) DETECTS AN INTERNAL PARITY  '              18450068
         DC    C'OR CURSOR CHECK ON ITS BUFFER WHEN THE  '              18500068
         DC    C'ATTACHED PRINTER GOES "NOT BUSY".       '              18550068
         DC    C'                                        '              18600068
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR   '              18650068
         DC    C'                     GENERAL POLL.'                    18700068
MSG19    DC    AL2(MSG20-*-2)                                           18750068
         DC    C'SS=C2C8',C'  '                                         18800068
         DC    CL29'DEVICE END,EQUIPMENT CHECK'                         18850068
         DC    C'                                        '              18900068
         DC    C'THE 3275 (ONLY) DETECTED A CHARACTER    '              18950068
         DC    C'GENERATOR READOUT ERROR.                '              19000068
         DC    C'                                        '              19050068
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR   '              19100068
         DC    C'                     GENERAL POLL.'                    19150068
MSG20    DC    AL2(MSG21-*-2)                                           19200068
         DC    C'SS=C2D8',C'  '                                         19250068
         DC    CL29'DEVICE END'                                         19300068
         DC    C'  INTERVENTION REQUIRED,EQUIPMENT CHECK '              19350068
         DC    C'                                        '              19400068
         DC    C'(3275 ONLY) THE ATTACHED PRINTER, "AC-  '              19450068
         DC    C'POWER" IS TURNED OFF,OR A MECHANICAL    '              19500068
         DC    C'"HANG" CONDITION WAS DETECTED           '              19550068
         DC    C'                                        '              19600068
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR   '              19650068
         DC    C'                     GENERAL POLL.      '              19700068
MSG21    DC    AL2(MSG22-*-2)                                           19750068
         DC    C'SS=C4C1',C'  '                                         19800068
         DC    CL29'UNIT SPECIFY,OPERATION CHECK'                       19850068
         DC    C'                                        '              19900068
         DC    C'THE "FROM DEVICE" HAS A "LOCKED BUFFER" '              19950068
         DC    C'AND CANNOT BE COPIED. (PROGRAM ERROR)   '              20000068
         DC    C'                                        '              20050068
         DC    C'DEVICE RESPONSE= EOT-TO THE COPY COMMAND'              20100068
MSG22    DC    AL2(MSG23-*-2)                                           20150068
         DC    C'SS=C4C4',C'  '                                         20200068
         DC    CL29'UNIT SPECIFY,DATA CHECK'                            20250068
         DC    C'DURING POLLING,SELECT OR READ COMMANDS  '              20300068
         DC    C'THE ADDRESSED DEVICE DETECTS A "CURSOR" '              20350068
         DC    C'OR "PARITY" CHECK ON DATA THAT IS BEING '              20400068
         DC    C'TRANSFERRED TO THE CONTROL UNIT OR      '              20450068
         DC    C'DURING THE COMMAND OPERATION ON A WRITE '              20500068
         DC    C'COMMAND                                 '              20550068
         DC    C'                                        '              20600068
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT.       '              20650068
         DC    C'                 EOT-TO READ,WRITE OR   '              20700068
         DC    C'                     POLLING COMMANDS.'                20750068
MSG23    DC    AL2(MSG24-*-2)                                           20800068
         DC    C'SS=C4C5',C'  '                                         20850068
         DC    CL29'UNIT SPECIFY,DATA CHECK'                            20900068
         DC    C'              OPERATION CHECK           '              20950068
         DC    C'                                        '              21000068
         DC    C'THE "FROM DEVICE" DETECTED AN INTERNAL  '              21050068
         DC    C'CURSOR OR PARITY CHECK DURING A COPY-   '              21100068
         DC    C'COMMAND.                                '              21150068
         DC    C'                                        '              21200068
         DC    C'DEVICE RESPONSE= EOT-TO THE COPY COMMAND'              21250068
MSG24    DC    AL2(MSG25-*-2)                                           21300068
         DC    C'SS=C4D8',C'  '                                         21350068
         DC    CL29'UNIT SPECIFY'                                       21400068
         DC    C'   INTERVENTION REQUIRED,EQUIPMENT CHECK'              21450068
         DC    C'                                        '              21500068
         DC    C'A COMMAND ATTEMPTED TO START A PRINTER  '              21550068
         DC    C'OPERATION BUT THE PRINTER CARRIAGE MOTOR'              21600068
         DC    C'POWER SWITCH WAS TURNED OFF.            '              21650068
         DC    C'                                        '              21700068
         DC    C'DEVICE RESPONSE= EOT-TO A WRITE,ERASE/- '              21750068
         DC    C'                   WRITE OR COPY COMMAND'              21800068
MSG25    DC    AL2(MSG26-*-2)                                           21850068
         DC    C'SS=C6C4',C'  '                                         21900068
         DC    CL29'UNIT SPECIFY,DEVICE END'                            21950068
         DC    C'                 DATA CHECK             '              22000068
         DC    C'                                        '              22050068
         DC    C'A PARITY CHECK IS DETECTED AT THE       '              22100068
         DC    C'PRINTER                                 '              22150068
         DC    C'                                        '              22200068
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT COMMAND'              22250068
         DC    C'                 EOT-TO A SPECIFIC OR   '              22300068
         DC    C'                     GENERAL POLL.'                    22350068
MSG26    DC    AL2(MSG27-*-2)                                           22400068
         DC    C'SS=C6C8',C'  '                                         22450068
         DC    CL29'UNIT SPECIFY,DEVICE END'                            22500068
         DC    C'            EQUIPMENT CHECK             '              22550068
         DC    C'A CHARACTER GENERATOR ERROR IS DETECTED '              22600068
         DC    C'BUT THERE IS NO DATA ERROR,(BUFFER DATA-'              22650068
         DC    C'IS VALID AND REUSEABLE) OR A MECHANICAL '              22700068
         DC    C'FAILURE OCCURED.(COVER OPEN,PAPER OUTAGE'              22750068
         DC    C'OR DISABLED PRINT MECHANISM)            '              22800068
         DC    C'                                        '              22850068
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT.       '              22900068
         DC    C'                 EOT-TO A SPECIFIC OR A '              22950068
         DC    C'                     GENERAL POLL.'                    23000068
MSG27    DC    AL2(MSG28-*-2)                                           23050068
         DC    C'SS=C6D8',C'  '                                         23100068
         DC    CL29'UNIT SPECIFY,DEVICE END'                            23150068
         DC    C'   INTERVENTION REQUIRED,EQUIPMENT CHECK'              23200068
         DC    C'                                        '              23250068
         DC    C'AN UNRECOVERABLE MECHANICAL FAILURE IS  '              23300068
         DC    C'DETECTED AT THE ADDRESSED PRINTER.      '              23350068
         DC    C'                                        '              23400068
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR A '              23450068
         DC    C'                     GENERAL POLL.      '              23500068
MSG28    DC    AL2(MSG29-*-2)                                           23550068
         DC    C'SS=C840',C'  '                                         23600068
         DC    CL29'DEVICE BUSY'                                        23650068
         DC    C'                                        '              23700068
         DC    C'INDICATES NORMAL STATUS FOR A DEVICE    '              23750068
         DC    C'EXECUTING A PREVIOUSLY ISSUED COMMAND,- '              23800068
         DC    C'PRINTER OPERATION,BUFFER TRANSFER,ID-   '              23850068
         DC    C'CARD READER OPERATION OR KEYBOARD-      '              23900068
         DC    C'FUNCTIONS.                              '              23950068
         DC    C'                                        '              24000068
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT COMMAND'              24050068
         DC    C'                 EOT-TO A SPECIFIC POLL.'              24100068
MSG29    DC    AL2(MSG30-*-2)                                           24150068
         DC    C'SS=C8C1',C'  '                                         24200068
         DC    CL29'DEVICE BUSY,OPERATION CHECK'                        24250068
         DC    C'                                        '              24300068
         DC    C'ON A COPY COMMAND,THE "FROM" DEVICE IS  '              24350068
         DC    C'BUSY EXECUTING A PRINTOUT,READING FROM  '              24400068
         DC    C'THE ID CARD READER OR PERFORMING KEY-   '              24450068
         DC    C'BOARD FUNCTIONS. THE COPY COMMAND IS    '              24500068
         DC    C'ABORTED.                                '              24550068
         DC    C'                                        '              24600068
         DC    C'DEVICE RESPONSE= EOT-TO THE COPY COMMAND'              24650068
MSG30    DC    AL2(LASTMSG-*-2)                                         24700068
         DC    C'SS=HELP',C'  '                                         24750068
         DC    CL29'REMOTE STATUS MSG HELPER.'                          24800068
         DC    CL40'FIELDS "SS=XXXX" REFER TO REMOTE STATUS'            24850068
         DC    CL40'MESSAGES.  ALL COMBINATIONS ARE NOT'                24900068
         DC    CL40'DOCUMENTED.  IF YOU DON''T SEE THE ONE'             24950068
         DC    CL40'YOU NEED, SUCH AS "C2C2" DROP ONE OF THE'           25000068
         DC    CL40'INSIGNIFICANT BITS SUCH AS "DEVICE END".'           25050068
         DC    CL40'THIS WILL PRODUCE "40C2" (YOU NEED A'               25100068
         DC    CL40'6-BIT CODE CHART TO FIGURE THE HIGH-'               25150068
         DC    CL40'ORDER BITS).  NOW LOOK UP MSG FOR "40C2"'           25200068
         DC    CL40'TO SEE IF IT APPLIES TO YOUR SITUATION.'            25250068
LASTMSG  EQU   *                                                        25300068
         END   BNGIRMOT                                                 25350068
./  ADD  SSI=73210038,NAME=BNGISIMS
*********************************************************************** 00000168
*                                                                     * 00000268
* MODULE NAME = BNGISIMS                                              * 00000368
*                                                                     * 00000468
* DESCRIPTIVE NAME =  IMS DEMF OPEN/CLOSE SYS1.DEMFLOG FILE MODULE    * 00000568
*                                                                     * 00000668
* COPYRIGHT = NONE                                                    * 00000768
*                                                                     * 00000868
* STATUS = RELEASE 1, LEVEL 1                                         * 00000968
*                                                                     * 00001068
* FUNCTION = 1) OPENS/CLOSES SYS1.DEMFLOG DATA FILE FOR IMS DEMF      * 00001168
*               FUNCTION MODULES TO ACCESS TO IT;              *        00001268
*            2) LINKS TO IMS REGION CONTROLLER, DFSRRC00.             * 00001368
*                                                                     * 00001468
* NOTES = NONE                                                        * 00001568
*                                                                     * 00001668
*    DEPENDENCIES = NONE                                              * 00001768
*                                                                     * 00001868
*    RESTRICTIONS = NONE                                              * 00001968
*                                                                     * 00002068
*    REGISTER CONVENTIONS = SEE REGISTERS EQU'S BELOW                 * 00002168
*                                                                     * 00002268
*    PATCH LABEL = NONE                                               * 00002368
*                                                                     * 00002468
* MODULE TYPE =  IMS CONTROL                                          * 00002568
*                                                                     * 00002668
*    PROCESSOR = ASSEMBLER H                                          * 00002768
*                                                                     * 00002868
*    MODULE SIZE =  612 DECIMAL BYTES                                 * 00002968
*                                                                     * 00003068
*    ATTRIBUTES = REENTRANT                                           * 00003168
*                                                                     * 00003268
* ENTRY POINT = BNGIDCBA (USED BY IMS DEMF APPLICATION PGM BNGICTRL)  * 00003368
*               BNGINTRY (USED BY OS JOB SCHEDULER)                   * 00003468
*                                                                     * 00003568
*    PURPOSE = SEE FUNCTION                                           * 00003668
*                                                                     * 00003768
*    LINKAGE = R1  LOADED WITH THE PARAM LIST POINTER                 * 00003868
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 00003968
*              R15 LOADED WITH ENTRY POINT                            * 00004068
*                                                                     * 00004168
* INPUT  = N/A                                                        * 00004268
*                                                                     * 00004368
* OUTPUT = N/A                                                        * 00004468
*                                                                     * 00004568
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 00004668
*               00 - OPERATION PERFORMED AS REQUESTED                 * 00004768
*                                                                     * 00004868
* EXIT-ERROR  = NONE                                                  * 00004968
*                                                                     * 00005068
* EXTERNAL REFERENCE = NONE                                           * 00005168
*                                                                     * 00005268
*    ROUTINES = NONE                                                  * 00005368
*                                                                     * 00005468
*    DATA AREAS = NONE                                                * 00005568
*                                                                     * 00005668
*    CONTROL BLOCK = DCB                                              * 00005768
*                                                                     * 00005868
* TABLES = NONE                                                       * 00005968
*                                                                     * 00006068
* MACROS = OPEN, WTO, LINK, CLOSE, RETURN                             * 00006168
*                                                                     * 00006268
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 00006368
* CHANGE 01   11/15/77  PROLOGUE ADDED                                * 00006468
*                                                                     * 00006568
*********************************************************************** 00006668
         PRINT NOGEN                                                    00007168
         TITLE 'BNGISIMS - OPEN/CLOSE EMFILE-START IMS MPR REGION'      00007268
         SPACE 2                                                        00007368
*********************************************************************** 00007468
*                                                                     * 00007568
*     THIS PROGRAM IS ENTERED EITHER BY THE OPERATING SYSTEM JOB      * 00007668
*     SCHEDULER USING ENTRY POINT BNGINTRY OR BY THE IMS APPLICATION  * 00007768
*     PROGRAM BNGICTRL USING ENTRY POINT BNGIDCBA.                    * 00007868
*                                                                     * 00007968
*     THIS PROGRAM MUST BE LINKEDIT AS 'REENTRANT'                    * 00008068
*                                                                     * 00008868
*********************************************************************** 00009668
         DCBD  DSORG=DA                                                 00010468
BNGIDCBA CSECT                                                          00011268
         DC    A(EMFDCBA)            ADDR OF ADDR OF BDAM DCB           00012068
         ENTRY BNGINTRY                                                 00012868
BNGINTRY   SAVE  (14,12)                                                00013668
         BALR  2,0                                                      00014468
         USING *,2,3                                                    00015268
         LA    3,2048(2)             SET SECOND BASE                    00016068
         LA    3,2048(3)                 FROM THE FIRST                 00016868
         LA    4,SAVE                POINT TO OUR SAVE AREA             00017668
         ST    4,8(13)               FORWARD CHAIN FROM OLD             00018468
         ST    13,SAVE+4             BACKWARD CHAIN TO OLD              00019268
         LR    13,4                  FIRST BASE AND S/A FOR OUR REGS    00020068
         B     GO                                                       00020868
         DC    C'BNGISIMS - DEMF MODULE TO OPEN/CLOSE EMFILE AND'       00021668
         DC    C'           START IMS MESSAGE PROCESSING REGION'        00022468
SAVE     DS    18F                                                      00023268
SAVEX    DS    CL72                                                     00024068
GO       DS    0H                                                       00024868
         OPEN  (EMFDCB)                                                 00025668
         WTO   'SYS1.DEMFLOG OPENED',ROUTCDE=11                         00026468
         L     4,=A(EMFDCB)                                             00027268
         ST    4,EMFDCBA            PRIME DCB ADDRESS POINTER           00028068
         USING IHADCB,4                                                 00028868
         TM    DCBOFLGS,X'10'       OPEN SUCCESSFUL?                    00029668
         BNZ   OPENOK               YES - CONTINUE                      00030468
         WTO   'SYS1.DEMFLOG DID NOT OPEN',ROUTCDE=11                   00031268
         XC    EMFDCBA,EMFDCBA      ZERO DCB POINTER TO SHOW            00032068
OPENOK   DS    0H                        OPEN FAILURE AND GO ON         00032868
         L     13,SAVE+4                                                00033668
         L     1,24(13)                                                 00034468
         MVC   SAVEX,0(13)                                              00035268
         LINK  EP=DFSRRC00                                              00036068
         MVC   0(72,13),SAVEX                                           00036868
         L     13,8(13)                                                 00037668
         OC    EMFDCBA,EMFDCBA                                          00038468
         BZ    CLOSEBYP                                                 00039268
         XC    EMFDCB+28(4),EMFDCB+28        ZERO OUT OLD IOB ADDR      00040068
         CLOSE (EMFDCB)                                                 00040868
         WTO   'SYS1.DEMFLOG CLOSED',ROUTCDE=11                         00041668
CLOSEBYP DS    0H                                                       00042468
         L     13,SAVE+4                                                00043268
         RETURN (14,12),RC=0                                            00044068
EMFDCBA  DC    A(0)                                                     00044868
         DS    0F                                                       00045668
         DS    F                                                        00046468
EMFDCB   DCB   DDNAME=EMFILE,DSORG=DA,MACRF=(RI),OPTCD=R,RECFM=F        00047268
         LTORG                                                          00048068
         END   BNGIDCBA                                                 00048868
./  ADD  SSI=81180058,NAME=BNGI3270
         PRINT OFF                                                      00040007
         MACRO                                                          00040407
&NAME    BNGHJN &LABEL,&HJN                                             00040807
         LCLC  &HJA,&HJB                                                00041207
&HJA     SETC  '&SYSPARM'(1,4)                                          00041607
&HJB     SETC  '&SYSPARM'(5,4)                                          00042007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00042407
         B     &LABEL .                 BR AROUND CONSTANTS             00042807
         SPACE 2                                                        00043207
.NOBRNCH ANOP                                                           00043607
         AIF   ('&NAME' EQ '').NOLABEL                                  00044007
         DC    C'&NAME' .              MODULE IDENTIFIER                00044407
.NOLABEL ANOP                                                           00044807
         DC    X'&HJA' .                DATE OF MODIFICATION            00045207
         AIF   ('&HJN' NE 'HJN').DATE                                   00045607
         DC    X'&HJB' .                HJN OF MODIFICATION             00046007
.DATE    ANOP                                                           00046407
         AIF   ('&LABEL' EQ '').NOLBL                                   00046807
         SPACE 2                                                        00047207
&LABEL   DS    0H                                                       00047607
.NOLBL   ANOP                                                           00048007
         MEND                                                           00048407
         PRINT ON                                                       00048807
*********************************************************************** 00049207
*                                                                     * 00080068
* MODULE NAME = BNGI3270                                              * 00120068
*                                                                     * 00160068
* DESCRIPTIVE NAME =  IMS DEMF 3270 DISPLAY MODULE                    * 00200068
*                                                                     * 00240068
* COPYRIGHT = NONE                                                    * 00280068
*                                                                     * 00320068
* STATUS = RELEASE 1, LEVEL 1                                         * 00360068
*                                                                     * 00400068
* FUNCTION = 1) BNGI3270 IS LINKED TO BY BNGIDISP;                    * 00440068
*            2) HANDLES 3270 DISPLAY TERMINAL ERROR INFORMATION       * 00480068
*               REQUEST AND BITS PROMPTER REQUEST;                    * 00520068
*            2) LINKS TO BNGIREAD TO READ SYS1.DEMFLOG DATA FILE AND  * 00560068
*               COLLECTS THE REQUESTED 3270 ERROR INFORMATION FROM    * 00600068
*               IT;                                                   * 00640068
*            3) FORMS OUTPUT MESSAGE AND WRITES IT TO THE 3270 DISPLAY* 00680068
*               TERMINAL; (ERR INFO AND SOME OF DISPLAY MESSAGES)     * 00720068
*            4) RETURNS CONTROL TO BNGIDISP.                          * 00760068
*                                                                     * 00800068
* NOTES = NONE                                                        * 00840068
*                                                                     * 00880068
*    DEPENDENCIES = NONE                                              * 00920068
*                                                                     * 00960068
*    RESTRICTIONS = NONE                                              * 01000068
*                                                                     * 01040068
*    REGISTER CONVENTIONS :                                           * 01080068
*    --------------------                                             * 01120068
*                                                                     * 01160068
*    ALL DEMF RECORDING DISPLAY COMPONENTS USE STANDARD REGISTER      * 01200068
*    CONVENTIONS WITH THE EXCEPTION OF THE IMS DISPLAY COMPONENTS.    * 01240068
*    CERTAIN IMS MODULES USE ADDITIONAL REGISTERS AND THE LINK MACRO  * 01280068
*    FOR PASSING OR RETRIEVING DATA PARAMETER INFORMATION AND ARE     * 01320068
*    DETAILED BELOW:                                                  * 01360068
*                                                                     * 01400068
*     MODULE    REGISTER    CONTENTS.                                 * 01440068
*    --------   --------    ------------------------------------      * 01480068
*    BNGIDISP     R5        PASSES ADDRESS OF IMS PROGRAM             * 01520068
*                           COMMUNICATION BLOCK (PCB) TO              * 01560068
*                           BNGI3270, BNGIMENU, BNGILOCL, AND         * 01600068
*                           BNGIRMOT.                                 * 01640068
*                                                                     * 01680068
*                 R11       PASSES TO BNGIREAD THE ADDRESS OF A       * 01720068
*                           PARAMETER LIST CONTAINING:                * 01760068
*                                                                     * 01800068
*                          1) 4-BYTES - ADDRESS OF I/O AREA FROM      * 01840068
*                                       BNGIREAD                      * 01880068
*                                                                     * 01920068
*                          2) 3-BYTES - RELATIVE BLOCK ADDRESS TO     * 01960068
*                                       BE READ BY BNGIREAD           * 02000068
*                                                                     * 02040068
*                          3) 2-BYTES - STATUS OF READ FROM           * 02080068
*                                       BNGIREAD                      * 02120068
*                                                                     * 02160068
*                 R12      FOR BNGI3270, PASSES THE ADDRESS OF A      * 02200068
*                          COMMUNICATION AREA CONTAINING              * 02240068
*                          UP TO SIX EDITTED PARM FIELDS, SAVE        * 02280068
*                          AND WORK AREAS, AND THE INPUT MESSAGE.     * 02320068
*                                                                     * 02360068
*                          FOR BNGILOCL, BNGIRMOT, AND BNGIMENU;      * 02400068
*                          PASSES THE ADDRESS OF THE INPUT MESSAGE.   * 02440068
*                                                                     * 02480068
*    BNGIREAD    LINK TO BNGIDCBA       RETRIEVES THE ADDRESS OF THE  * 02520068
*                (ALIAS FOR BNGISIMS)   ADDRESS OF THE SYS1.DEMFLOG   * 02560068
*                                       DCB.                          * 02600068
*                                                                     * 02640068
*                 R11      RECEIVES ADDRESS OF PARAMETER LIST         * 02680068
*                          (SEE BNGIDISP R11 FOR LIST).               * 02720068
*                                                                     * 02760068
*    BNGI3270     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 02800068
*                                                                     * 02840068
*                 R11     PASSES TO BNGIREAD THE ADDRESS OF A         * 02880068
*                         PARAMETER LIST (SEE BNGIDISP R11 FOR LIST)  * 02920068
*                                                                     * 02960068
*                 R12     RECEIVES FROM BNGIDISP THE ADDRESS OF THE   * 03000068
*                         COMMUNICATION AREA (SEE BNGIDISP R12 FOR    * 03040068
*                         CONTENTS OF AREA).                          * 03080068
*                                                                     * 03120068
*    BNGIMENU     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 03160068
*                                                                     * 03200068
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 03240068
*                         BNGIDISP.                                   * 03280068
*                                                                     * 03320068
*    BNGILOCL     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 03360068
*                                                                     * 03400068
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 03440068
*                         BNGIDISP.                                   * 03480068
*                                                                     * 03520068
*    BNGIRMOT     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 03560068
*                                                                     * 03600068
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 03640068
*                         BNGIDISP.                                   * 03680068
*                                                                     * 03720068
*    PATCH LABEL = NONE                                               * 03760068
*                                                                     * 03800068
* MODULE TYPE = IMS DISPLAY                                           * 03840068
*                                                                     * 03880068
*    PROCESSOR = ASSEMBLER H                                          * 03920068
*                                                                     * 03960068
*    MODULE SIZE = 9928 DECIMAL BYTES                                 * 04000068
*                                                                     * 04040068
*    ATTRIBUTES = SERIALLY REUSABLE                                   * 04080068
*                                                                     * 04120068
* ENTRY POINT = BNGI3270                                              * 04160068
*                                                                     * 04200068
*    PURPOSE = SEE FUNCTION                                           * 04240068
*                                                                     * 04280068
*    LINKAGE = R1  LOADED WITH THE PARAM LIST POINTER                 * 04320068
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 04360068
*              R15 LOADED WITH ENTRY POINT                            * 04400068
*                                                                     * 04440068
* INPUT = PARAM LIST ITEMS USED ARE : COMMAREA (LABEL)                * 04480068
*                                                                     * 04520068
* OUTPUT = PARAM LIST ITEMS USED ARE : MSG3270 & MSGBITS (LABELS)     * 04560068
*                                                                     * 04600068
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 04640068
*               00 - OPERATION PERFORMED AS REQUESTED                 * 04680068
*                                                                     * 04720068
* EXIT-ERROR  = NONE                                                  * 04760068
*                                                                     * 04800068
* EXTERNAL REFERENCE = NONE                                           * 04840068
*                                                                     * 04880068
*    ROUTINES = LOCATE ROUTINE                                        * 04920068
*               GETTIOA ROUTINE (GET TERMINAL OUTPUT AREA)            * 04960068
*               BUOBR ROUTINE (BLOW-UP OBR ROUTINE)                   * 05000068
*               BUMDR ROUTINE (BLOW-UP MDR ROUTINE)                   * 05040068
*                                                                     * 05080068
*    DATA AREAS = NONE                                                * 05120068
*                                                                     * 05160068
*    CONTROL BLOCK = NONE                                             * 05200068
*                                                                     * 05240068
* TABLES = CALENDAR - CONVERT JULIAN DATE TO GREGORIAN DATE TABLE     * 05280068
*          LEAPTBL  - LEAP YEAR CALCULATION TABLE                     * 05320068
*          CCWTABL  - CONVERT 270X COMMAND CODE INTO ENGLISH          * 05360068
*          CSWTABL  - CONVERT LOCAL 327X STATUS OR 270X LINE STATUS   * 05400068
*                     INTO ENGLISH                                    * 05440068
*          SENSTABL - CONVERT 270X LINE SENSE CODE INTO ENGLISH       * 05480068
*          STATSTBL - CONVERT REMOTE 327X STATUS CODE INTO ENGLISH    * 05520068
*          SENS3272 - CONVERT LOCAL 327X SENSE CODE INTO ENGLISH      * 05560068
*          CCW3272  - CONVERT LOCAL 327X COMMAND CODE INTO ENGLISH    * 05600068
*          TPOPTBL  - CONVERT BTAM TP OP CODE INTO ENGLISH            * 05640068
*          IMSPTOP  - CONVERT TCAM TP OP CODE INTO ENGLISH            * 05680068
*          HXTOEB   - HEX CHARS TO EBCDIC CHARS TABLE                 * 05720068
*          EBTOHX   - EBCDIC CHARS TO HEX CHARS TABLE                 * 05760068
*                                                                     * 05800068
* MACROS = LINK, SAVE, RETURN, OPEN, READ, CHECK, CLOSE               * 05840068
*                                                                     * 05880068
***********************CHANGE ACTIVITY FOLLOWS:************************ 05920007
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 05920107
* CHANGE 02  03/23/78  BNGHJN MACRO ADDED                             * 05920207
*A109600,142000,353200,387200                                  @OZ31886 05920307
*D113600                                                       @OZ31886 05920407
*                                                                     * 06000068
*********************************************************************** 06040068
*********************************************************************** 06080068
BNGI3270 TITLE 'DISPLAY 3270 MDR AND OBR ENTRIES'                       06120068
*********************************************************************** 06160068
         SPACE                                                          06200068
PCB      DSECT                 MAP OF IMS PROGRAM COMMUNICATION BLOCK   06240068
         USING *,PCBREG          ADDRESS PASSED IN REGISTER 5 BY DISP   06280068
PCBTERMN DS    CL8                 REQUESTING TERMINAL SYMBOLIC NAME    06320068
         DS    CL2                 RESERVED                             06360068
PCBSTAT  DS    CL2                 DL/I STATUS CODE                     06400068
PCBDATE  DS    PL4                 TRANSACTION DATE STAMP 00YYDDDF      06440068
PCBTIME  DS    PL4                 TRANSACTION TIME STAMP HHMMSSTH      06480068
PCBSEQ   DS    F                   TRANSACTION SEQUENCE NUMBER          06520068
PCBMODNM DS    CL8                 MFS MESSAGE OUTPUT DESCRIPTOR NAME   06560068
*********************************************************************** 06600068
COMMAREA DSECT       MAP OF COMMUNICATION AREA PASSED TO THIS PGM       06640068
         USING *,COMMREG      IN REGISTER 12 BY DISP                    06680068
PARM1    DS    D                   1ST INPUT PARM - DEMF                06720068
PARM2    DS    D                   2ND INPUT PARM - 3270                06760068
PARM3    DS    D                   3RD INPUT PARM - LLL OR TTT          06800068
PARM4    DS    D                   4TH INPUT PARM - CC                  06840068
PARM5    DS    D                   5TH INPUT PARM - TT                  06880068
PARM6    DS    D                   6TH INPUT PARM - TT                  06920068
FLDCNT   DS    PL1                 COUNT OF FLD'S KEYED-IN IN INPUT     06960068
SVRELREC DS    CL3           SAVE AREA FOR LINE/CTRL RELATIVE BLOCK NO. 07000068
SAVEBBSS DS    F                   SAVE POINTER TO BLK AND SLOT         07040068
DBLWD    DS    D                   DOUBLEWORD WORK AREA                 07080068
DUBLWD   EQU   DBLWD                                                    07120068
FULLWD   DS    F                   FULLWORD WORK AREA                   07160068
TWATCTID DS    D             SAVE AREA FOR IMS SYMBOLIC LINE POINTER    07200068
* THE FOLLOWING AREAS ARE USED AS INPUT AREA FOR                        07240068
* TRANSACTION MESSAGES, WITH MAPPING AS SHOWN.                          07280068
         SPACE                                                          07320068
MSGIN    DS    0D              MAP OF TRANSACTION MESSAGE SEGMENT:      07360068
TIOATDL  DS    H                   MESSAGE LENGTH INCL. LL,Z1,Z2,DATA   07400068
MSGZ1    DS    X                   FLAG FIELD - USED BY IMS INTERNALLY  07440068
MSGZ2    DS    X                   FLAG FIELD - NON-ZERO IF MFS EDITED  07480068
TIOADBA  DS    0F                  START OF MESSAGE DATA                07520068
MSGTXCD  DS    CL5                                                      07560068
MSGKEYED DS    CL29                                                     07600068
MSGCMDCD DS    CL4                                                      07640068
MSGPGF   DS    C                                                        07680068
MSGID    DS    CL20                                                     07720068
MSGPGB   DS    C                                                        07760068
MSGBBBSS DS    CL15                                                     07800068
MSGNTRY  DS    CL9                                                      07840068
MSGEND   DS    39CL9                                                    07880068
********************************************************************    07920068
         SPACE                                                          07960068
DATASLOT DSECT                 MAP OF MDR AND OBR ENTRIES IN DETL BLK   08000068
         USING *,DATAREG                                                08040068
DATALTH  DS    C                   LTH OF THIS SLOT                     08080068
LINEID   DS    CL6                 LINE AND LIB ADDR                    08120068
ENTRYTYP DS    C                   ENTRY TYPE - MDR OR OBR              08160068
         DS    CL3                                                      08200068
MDRTYPE  DS    C                   TYPE HDWE - 03 EQUALS 3270           08240068
         DS    CL3                                                      08280068
DATE     DS    CL4                 DATE OF ERROR - 00YYDDDF             08320068
TIME     DS    CL4                 TIME OF ERROR - HHMMSSHH             08360068
         DS    CL8                                                      08400068
MDRCUA   DS    CL2                 MDR CHAN & UNIT ADDR                 08440068
MDRCTRL  DS    C                   MDR CTRL UNIT POLL ADDR              08480068
MDRTERM  DS    C                   MDR TERMIL POLL ADDR                 08520068
MDRSTATS DS    CL2                 REMOTE 3270 STATUS                   08560068
         DS    CL2                                                      08600068
OBRCCW   DS    CL8                 LAST CCW EXECUTED                    08640068
OBRCSW   DS    CL8                 CHANNEL STATUS WORD                  08680068
         DS    CL6                                                      08720068
OBRUCB   DS    C                                                        08760068
         DS    CL3                                                      08800068
OBRCUA   DS    CL2                 OBR CHAN & UNIT ADDR                 08840068
OBRCTRL  DS    C                   REMOTE LINE ERRORS UNDER CTRLUNIT    08880068
OBRTERM  DS    C                   REMOTE LINE ERRORS UNDER TERMINAL    08920068
         DS    CL12                                                     08960068
OBRSENSE DS    CL2                 OBR SENSE BYTES                      09000068
         SPACE                                                          09040068
         ORG   DATALTH         MAP OF 16-BYTE SLOT IN CONTROL BLOCK     09080068
CTRLPORT DS    CL6                 PORT & LIB ADDRESS                   09120068
         DS    CL4                 BLOCKS AND HITS                      09160068
CTRLFRST DS    CL3                 REL BLK ADDR 1ST BLK IN CHAIN.       09200068
         DS    CL3                 REL BLK ADDR LAST BLK IN CHAIN       09240068
SLOTLTH  EQU   *-CTRLPORT                                               09280068
FIOADBA  DSECT                 MAP OF 32-BYTE HEADER IN CONTROL BLOCK   09320068
         USING *,FIOABAR                                                09360068
CTRLLAST DS    F                   LAST USED ADDR IN DATASET            09400068
CTRLTOTL DS    F                   TOTAL BLOCKS IN DATASET              09440068
CTRLBACK DS    F                &  BACKWARD PTR IN CTRL BLK CHAIN       09480068
CTRLFWD  DS    F                   FORWARD PTR IN CTRL BLK CHAIN        09520068
CTRLENTS DS    C                   NBR ENTRIES IN THIS CTRL BLK         09560068
         DS    CL15                FOR FUTURE USE                       09600068
CTRLSLT1 DS    0C                  START OF CTRL SLOT NBR ONE.          09640068
         SPACE                                                          09680068
         ORG   FIOADBA         MAP OF 32-BYTE HEADER IN DETAIL BLOCK    09720068
DATAPORT DS    CL6                 PORT & LIB ADDR                      09760068
DATATIME DS    CL4                 TIME BLOCK CREATED                   09800068
DATADATE DS    CL4                 DATE BLOCK CREATED                   09840068
DATAFWD  DS    CL3                 FORWARD CHAIN ADDR                   09880068
DATABACK DS    CL3                 BACKWAD CHAIN ADDR                   09920068
BLKLTH   DS    CL2                 NBR BYTES USED IN THIS BLOCK         09960068
         DS    CL10                                                     10000068
DATASLT1 DS    0C                  START OF 1ST DATA SLOT               10040068
*********************************************************************** 10080068
BNGI3270 CSECT                                                          10120068
*********************************************************************** 10160068
R1       EQU   1                                                        10200068
BASE1    EQU   2                   1ST PROGRAM BASE REG.                10240068
BASE2    EQU   3                   2ND PROGRAM BASE REG.                10280068
BASE3    EQU   4                   3RD PROGRAM BASE REG.                10320068
PCBREG   EQU   5                PTR TO TP-PCB PASSED HERE               10360068
FIOABAR  EQU   6                   FIOA POINTER.                        10400068
DATAREG  EQU   7                   POINTER TO DATA IN EMF FILE BLOCK.   10440068
DATALOOP EQU   8                   LOOP REG FOR PROCESSING WITH DATAREG 10480068
OUTREG   EQU   9                   POINTER TO VARIABLE AREA IN TIOA.    10520068
OUTLOOP  EQU   10                  LOOP REG FOR PROCESSING WITH OUTREG. 10560068
LINKREG  EQU   11                  LINKAGE TO COMMON SUBROUTINES.       10600068
COMMREG  EQU   12               PTR TO COMMUNICATIONS AREA PASSED HERE  10640068
R13      EQU   13                                                       10680068
*********************************************************************** 10720068
* THIS SECTION DOES PROGRAM INITIALIZATION                              10760068
*********************************************************************** 10800068
         SAVE  (14,12)             SAVE CALLER'S REGISTERS              10880068
         BALR  BASE1,0                                                  10920068
         USING *,BASE1,BASE2,BASE3                                      10960068
BNGI3270 BNGHJN SKIPID                                         @OZ31886 10980007
         LA    BASE2,2048(BASE1)    SET SECOND BASE                     11000068
         LA    BASE2,2048(BASE2)       FROM THE FIRST                   11040068
         LA    BASE3,2048(BASE2)    SET THIRD BASE                      11080068
         LA    BASE3,2048(BASE3)       FROM THE SECOND                  11120068
         LA    14,SAVE             POINT TO OUR SAVE AREA               11160068
         ST    14,8(13)            FORWARD CHAIN FROM OLD               11200068
         ST    13,4(14)            BACKWARD CHAIN TO OLD                11240068
         LR    13,14               FIRST BASE AND S/A FOR OUR REGS      11280068
         B     A001                                                     11320068
SAVE     DS    18F                 SAVE AREA                            11400068
*******                                                                 11440068
*********************************************************************** 11480068
* THIS SECTION  RETURNS TO BNGIDISP  *                                  11520068
         EJECT                                                          11560068
*********************************************************************** 11600068
* THIS IS A COMMON READ SUBROUTINE FOR THIS PROGRAM.                    11640068
*********************************************************************** 11680068
READ     ST    11,SAVE11                                                11720068
         LA    11,PARMADDR         SET UP PARM REG                      11760068
         L     15,=V(BNGIREAD)    POINT TO READ MODULE                  11800068
         BALR  14,15              LINK TO BDAM READ MODULE              11840068
         L     11,SAVE11                                                11880068
         OC    STATUS,STATUS      READ OK?                              11920068
         BZ    0(LINKREG)         YES. RETURN TO CALLER                 11960068
         CLC   STATUS,=C'FF'       WAS EMFILE OPENED?                   12000068
         BE    Z60                 NO.  WRITE 'NOT OPEN' MSG            12040068
         UNPK  DBLWD,STATUS(3)                                          12080068
         MVC   IOERCODE,DBLWD+3                                         12120068
         TR    IOERCODE,HXTOEB     MOVE BDAM RETURN CODE TO I/O ERR MSG 12160068
         UNPK  DBLWD,RELREC(4)                                          12200068
         MVC   IOERBLK,DBLWD+4     MOVE BLK NBR THAT WAS BEING READ     12240068
         TR    IOERBLK,HXTOEB                                           12280068
         B     Z20                     IF REQUESTED SLOT CAN'T          12320068
*                                        BE FOUND, SEND 'SEARCHING ERR' 12360068
SAVE11   DS    F                                                        12400068
*********************************************************************** 12440068
*********************************************************************** 12480068
A001     CP    FLDCNT,=P'0'        WAS DATA KEYED-IN?                   12520068
         BE    J010                NO. GO EXAMINE INPUT FURTHER.        12560068
A010     XC    RELREC,RELREC       YES. THIS IS A NEW RECAP REQUEST.    12600068
         OC    PARM3,PARM3         WAS LINE ID INPUT?                   12640068
         BZ    Z40                 NO. SEND 'INVALID INPUT' MSG.        12680068
B140     MVC   DUBLWD+5(3),PARM3                                        12720068
         TR    DUBLWD,EBTOHX            GET LINE,                       12760068
         PACK  DUBLWD(3),DUBLWD+5(4)    CONTROL UNIT,                   12800068
         MVC   HEXLINE,DUBLWD           AND                             12840068
         MVC   DUBLWD+5(3),PARM4        TERMINAL                        12880068
         TR    DUBLWD,EBTOHX            ADDRESS                         12920068
         PACK  DUBLWD(2),DUBLWD+5(3)    INTO HEX                        12960068
         MVC   HEXCTRL,DUBLWD           FORMAT                          13000068
         MVC   DUBLWD+5(3),PARM5        FOR COMPARING                   13040068
         TR    DUBLWD,EBTOHX            TO DATA IN                      13080068
         PACK  DUBLWD(2),DUBLWD+5(3)    DISK FILE.                      13120068
         MVC   HEXTERM,DUBLWD                                           13160068
         MVC   LGBBBSS,=C'BBBSSBBBSSBBBSS'   INITIALIZE PAGING BBBSS'S  13200068
         MVC   SMBBBSS,=C'BBBSSBBBSSBBBSS'   INITIALIZE PAGING BBBSS'S  13240068
         BAL   LINKREG,GETTIOA     SETUP NEW OUTPUT AREA WITH HDRS.     13280068
D080     BAL   LINKREG,READ                                             13320068
D190     L     FIOABAR,IOAREA      POINT TO FILE I/O AREA.              13360068
         SR    DATALOOP,DATALOOP   SETUP TO LOOP ON NBR OF              13400068
         IC    DATALOOP,CTRLENTS   ENTRIES IN THIS CNTRL BLK.           13440068
         LTR   DATALOOP,DATALOOP   VERIFY THAT THE DATA SET             13480068
         BZ    Z50                 IS NOT EMPTY. IF SO, WRT NO ERRS MSG 13520068
E030     LA    DATAREG,CTRLSLT1    POINT TO FIRST CTRL SLOT.            13560068
E040     OC    PARM4,PARM4         WAS A CTRL UNIT ADDR INPUT?          13600068
         BNZ   E110                YES. LINE ID IS CORRECT.             13640068
         XC    DUBLWD,DUBLWD       NO. THIS MUST BE RQST FOR LOCAL.     13680068
         MVC   DUBLWD(3),HXLINLIB  ROUND CUA ADDR DOWN                  13720068
         NI    DUBLWD+2,B'11100000'     TO EVEN CHAN ADDR.              13760068
         CLC   DUBLWD(6),CTRLPORT       LOOK FOR EQUAL LINE ADDRESS.    13800068
         B     E120             &                                       13840068
E110     CLC   HXLINLIB,CTRLPORT   IS THIS SLOT = RQSTD LINE ADDR?      13880068
E120     BE    E200                YES. GO READ ITS DATA BLOCK.         13920068
         LA    DATAREG,SLOTLTH(DATAREG)  NO. BUMP TO NEXT CTRL SLOT.    13960068
         BCT   DATALOOP,E040            MORE SLOTS TO LOOK AT?          14000068
         OC    CTRLBACK,CTRLBACK        NO. IS THERE ANOTHER CTRL BLK?  14040068
         BZ    Z50                           NO. SEND 'NO ERRS' MSG.    14080068
         MVC   RELREC,CTRLBACK+1        YES. SAVE NEXT BLOCK ADDR.      14120068
         B     D080                                                     14160068
E200     MVC   RELREC,CTRLFRST     MOVE DATA BLOCK ADDR.                14200068
         OC    RELREC,RELREC       IS THERE ANY DATA BLOCKS ?  @OZ31886 14210007
         BZ    T190                NO, WRITE 'NO DATA BLKS MSG'@OZ31886 14220007
F020     DS    0H                                                       14240068
         BAL   LINKREG,READ                                             14280068
F050     L     FIOABAR,IOAREA      POINT TO DATA BLOCK.                 14320068
         XC    TWASLOT,TWASLOT     INITIALIZE SLOT COUNT TO 1.          14360068
         LH    DATALOOP,BLKLTH     SETUP TO LOOP ON NBR BYTES IN REC.   14400068
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM.            14440068
F080     SR    14,14                                                    14480068
         IC    14,TWASLOT          PUT SLOT COUNT IN REG 14             14520068
         LA    14,1(14)            ADD 1 TO SLOT COUNT                  14560068
         STC   14,TWASLOT          STORE BACK                           14600068
F090     CLI   ENTRYTYP,X'91'      IS THIS ENTRY AN MDR RECORD?         14640068
         BNE   H060                NO. TEST FURTHER.                    14680068
         CLI   MDRTYPE,X'03'       YES. IS IT A 3270?                   14720068
         BE    G060                YES. TEST FURTHER.                   14760068
F120     SR    1,1                 NO. BUMP                             14800068
         IC    1,0(DATAREG)        TO NEXT DATA ITEM.                   14840068
         LTR   1,1                 PREVENT ENDLESS LOOP                 14880068
         BZ    F240                IN CASE GARBAGE IN RECORD.           14920068
         AR    DATAREG,1                                                14960068
         SR    DATALOOP,1          ALL DONE WITH THIS BLOCK?            15000068
         LTR   DATALOOP,DATALOOP                                        15040068
         BP    F080                NO. PROCESS NEXT ITEM.               15080068
         OC    DATAFWD,DATAFWD     YES. IS THERE ANOTHER BLOCK?         15120068
         BZ    F240                NO. GO WIND UP OUTPUT.               15160068
         MVC   RELREC,DATAFWD      YES. GET CHAIN ADDR AND              15200068
         B     F020                GO READ NEXT BLOCK.                  15240068
*********************************************************************** 15280068
*    PREPARE TO WRITE SCREEN AND RETURN                   ************* 15320068
*********************************************************************** 15360068
F240     CLI   OUTSWCH,X'FF'       WAS ANY OUTPUT CREATED?              15400068
         BNE   Z50                 NO. SEND 'NO ERRS' MSG.              15440068
G020     CALL  ASMTDLI,(ISRT,(PCBREG),MSG3270,S3270),VL                 15480068
CHECKST  CLC   PCBSTAT,DLIOK       DID ISRT GO OK?                      15520068
         BNE   ABEND1              IF NOT, ABEND, ELSE RETURN TO CALLER 15560068
         L     R13,4(R13)          RESTORE INCOMING SAVE AREA ADDRESS   15600068
         RETURN (14,12)            RELINQUISH CONTROL                   15640068
ABEND1   ABEND 666,DUMP                                                 15680068
*********************************************************************** 15720068
G060     CLC   MDRCTRL,HEXCTRL     IS THIS MDR FOR RQSTED CTRL UNIT?    15760068
         BNE   F120                NO. SKIP IT.                         15800068
         CLC   MDRTERM,HEXTERM     YES. IS IT FOR REQUESTED TERML?      15840068
         BNE   F120                NO. SKIP IT.                         15880068
         MVC   0(MDRLTH,OUTREG),MDRHDR   YES. SETUP BUILD 1 MDR LINE.   15920068
         UNPK  DUBLWD,MDRSTATS(3)                                       15960068
         TR    DUBLWD,HXTOEB       FILL IN REMOTE STATUS BYTES.         16000068
         MVC   (MDRSTAT-MDRHDR)(4,OUTREG),DUBLWD+3                      16040068
G100     UNPK  DUBLWD,RELREC(4)                                         16080068
         TR    DUBLWD,HXTOEB       FILL IN THIS BLK NBR.                16120068
         MVC   (MDRBBBSS-MDRHDR)(3,OUTREG),DUBLWD+4                     16160068
         UNPK  DUBLWD,TWASLOT(2)                                        16200068
         TR    DUBLWD,HXTOEB       FILL IN THIS SLOT NBR.               16240068
         MVC   (MDRBBBSS+3-MDRHDR)(2,OUTREG),DUBLWD+5                   16280068
         LA    14,LGBBBSS       POINT TO OUTPUT PAGING BBBSS FIELDS.    16320068
         CLC   0(5,14),=C'BBBSS' IS 'FIRST' FILLED IN?                  16360068
         BNE   G200             YES. SKIP IT.                           16400068
         MVC   0(5,14),(MDRBBBSS-MDRHDR)(OUTREG) NO. DO IT.             16440068
         CLC   10(5,14),=C'BBBSS' HOW ABOUT 'PREV'?                     16480068
         BNE   G200             ALREADY THERE; SKIP IT.                 16520068
         MVC   10(5,14),0(14)  NO. USE 'FIRST'                          16560068
G200     MVC   5(5,14),(MDRBBBSS-MDRHDR)(OUTREG)  FILL IN 'LAST' BBBSS  16600068
         CLI   QUITSW,X'FF'       IS 3277-1 SCREEN FULL?                16640068
         BE    G220               YES.                                  16680068
         MVC   SMBBBSS,LGBBBSS    NO. SO DO SAME FOR 3277-1 PAGE BBBSS  16720068
G220     UNPK  DUBLWD,TIME                                              16760068
         MVC   (MDRHRS-MDRHDR)(2,OUTREG),DUBLWD+1   FILL IN HOURS       16800068
         MVC   (MDRMINS-MDRHDR)(2,OUTREG),DUBLWD+3     AND MINUTES.     16840068
G230     MVI   OUTSWCH,X'FF'       INDICATE SOME OUTPUT WAS CREATED.    16880068
         CP    DATE,PCBDATE        DID THIS ERROR HAPPEN TODAY?         16920068
         BE    G240                YES,BR HIGH INTENSITY                16960068
         MVC   DATDATE,PCBDATE     MOVE PCB DATE TO WORK AREA           17000068
         SP    DATDATE,=P'1'       MAKE DATE YESTERDAY                  17040068
         CP    DATE,DATDATE        DID IT HAPPEN YESTERDAY              17080068
         BNE   G230A               NO,BR LEAVE INTENSITY NORMAL         17120068
         CLC   TIME,PCBTIME        IS IT OLDER THAN 24 HRS?             17160068
         BNL   G240                NO,BR MAKE IT HIGH INTENSITY         17200068
G230A    LA    R1,LEAPTBL                                               17240068
G231     CLC   DATE+1(1),0(1)      SEE IF                               17280068
         BE    G232                ERROR HAPPENED                       17320068
         LA    R1,1(R1)            IN LEAP YEAR                         17360068
         CLI   0(R1),X'FF'         IS IT END OF TABLE                   17400068
         BNE   G231                NO,BR TRY NEXT YEAR                  17440068
         ZAP   CALENDAR+8(2),=P'28' NOT LEAP YEAR                       17480068
         B     G233                CONTINUE                             17520068
G232     ZAP   CALENDAR+8(2),=P'29' YES,LEAP YEAR                       17560068
G233     LA    15,CALENDAR                                              17600068
G234     MVN   DATE+3(1),=X'0C'    MAKE SURE SIGN IS CORRECT            17640068
         CLC   DATE+2(2),3(15)    COMPUTE MONTH                         17680068
         BNH   G235                AND DAY FROM                         17720068
         SP    DATE+2(2),3(2,15)  DAY NUMBER                            17760068
         LA    15,5(15)                                                 17800068
         B     G234                                                     17840068
G235     MVC   (MDRHRS-MDRHDR)(3,OUTREG),0(15)  MOVE MONTH AND          17880068
         UNPK  (MDRMINS-MDRHDR)(2,OUTREG),DATE+2(2)   DAY TO OUTPUT     17920068
         OI    (MDRMINS+1-MDRHDR)(OUTREG),X'F0'                         17960068
         B     H030                                                     18000068
G240     MVC   0(2,OUTREG),PHN     YES. MAKE IT HIGH INTENSITY.         18040068
         MVC   3(2,OUTREG),UHA       YES. MAKE IT HIGH INTENSITY.       18080068
         MVC   14(2,OUTREG),PHN        YES. MAKE IT HIGH INTENSITY.     18120068
H030     LA    OUTREG,MDRLTH(OUTREG)    BUMP TO NEXT OUTPUT SLOT.       18160068
         BCT   OUTLOOP,F120        MORE TIOA ROOM LEFT?                 18200068
         CLI   QUITSW,X'FF'        OUTPUT AREA FILLED FOR 3277-2?       18240068
         BE    G020                YES. GO WIND UP OUTPUT               18280068
         MVI   QUITSW,X'FF'        NO. TURN ON OUTPUTING-FOR-3277-2 SW. 18320068
         LA    OUTLOOP,33          SET UP OUTPUT COUNTER                18360068
         LA    14,SMBBBSS          FILL IN 'LAST' BLK & SLOT ADDR       18400068
         UNPK  DUBLWD,RELREC(4)       FOR 3277-1                        18440068
         TR    DUBLWD,HXTOEB                                            18480068
         MVC   5(3,14),DUBLWD+4                                         18520068
         UNPK  DUBLWD,TWASLOT(2)                                        18560068
         TR    DUBLWD,HXTOEB                                            18600068
         MVC   8(2,14),DUBLWD+5                                         18640068
         B     F120                GO PROCESS MORE SLOTS.               18680068
*********************************************************************** 18720068
H060     CLI   ENTRYTYP,X'91'      IS THIS ENTRY AN OBR?                18760068
         BE    F120                NO. SKIP IT.                         18800068
         CLI   OBRUCB,X'40'        IS THIS A REMOTE OBR ?               18840068
         BNE   H080                NO. BYPASS CHECKING POLL CHARS       18880068
         CLC   OBRCTRL,HEXCTRL     IS IT THE REQUESTED CTRL UNIT ?      18920068
         BNE   F120                NO. SKIP IT.                         18960068
         CLC   OBRTERM,HEXTERM     IS IT THE REQUESTED TERMINAL ?       19000068
         BNE   F120                NO. SKIP IT.                         19040068
H080     CLC   OBRCUA,HEXLINE      YES. IS IT THE REQUESTED CUA ADDR?   19080068
         BNE   F120                NO. SKIP IT.                         19120068
         MVC   0(MDRLTH,OUTREG),MDRHDR  YES. SETUP COMMON MDR/OBR HDR.  19160068
         UNPK  DUBLWD,OBRCSW+4(3)                                       19200068
         TR    DUBLWD,HXTOEB       FILL IN CSW BYTES                    19240068
         MVC   (OBRSNS-MDRHDR)(4,OUTREG),DUBLWD+3                       19280068
         UNPK  DUBLWD,OBRSENSE(3)                                       19320068
         TR    DUBLWD,HXTOEB       FILL IN SENSE BYTES.                 19360068
         MVC   (MDRSTAT-MDRHDR)(4,OUTREG),DUBLWD+3                      19400068
         NI    OBRCCW+5,X'3F'      CLEAN UP TP OP CODE.                 19440068
         UNPK  DUBLWD,OBRCCW+5(2)                                       19480068
         TR    DUBLWD,HXTOEB       FILL IN TP OP CODE.                  19520068
         MVC   (OBRTPOP+1-MDRHDR)(2,OUTREG),DUBLWD+5                    19560068
         MVI   (OBRTPOP-1-MDRHDR)(OUTREG),C'B'                          19600068
         CLI   ENTRYTYP,X'34'      IS THIS A TCAM OBR?                  19640068
         BNE   J005                NO. LEAVE 'B' IN FOR BTAM            19680068
         MVI   (OBRTPOP-1-MDRHDR)(OUTREG),C'T'    T=TCAM                19720068
J005     UNPK  DUBLWD,OBRCCW(2)                                         19760068
         TR    DUBLWD,HXTOEB       FILL IN CHANL COMMAND.               19800068
         MVC   (OBRCMD-MDRHDR)(2,OUTREG),DUBLWD+5                       19840068
         B     G100                GO FILL IN DATA COMMON TO MDR/OBR.   19880068
*********************************************************************** 19920068
*     THIS SECTION DOES PAGING                         **************** 19960068
*********************************************************************** 20000068
J010     CLC   MSGNTRY(4),=C'BITS'   IS THIS A RETURN FROM BITS         20040068
*                                       PROMPTER SCREEN.                20080068
         BE    J140                  YES.                               20120068
J050     CLC   PARM4(4),=C'PAGE'   IS THIS A 'PAGE' REQUEST?            20160068
         BNE   L160                NO. MUST BE 'BLOWUP' REQUEST.        20200068
         CLC   PARM5(7),=C'FORWARD'      IS IT PAGE FORWARD?            20240068
         BNE   J190                NO. MUST BE PAGE BACKWARD.           20280068
*********************************************************************** 20320068
*      PAGE FORWARD SECTION                       ********************* 20360068
*********************************************************************** 20400068
J080     MVC   LGBBBSS(5),MSGBBBSS+5    PROMOTE LAST & FIRST FROM OLD   20440068
         MVC   LGBBBSS+10(5),MSGBBBSS        TO NEW FIRST & PREVIOUS.   20480068
         MVC   SMBBBSS,LGBBBSS       DO THE SAME FOR SMALL BBBSS'S      20520068
         TR    MSGBBBSS+5(5),EBTOHX     GET OLD 'LAST' BLK              20560068
         PACK  DUBLWD,MSGBBBSS+5(6)                 AND SLOT IN HEX.    20600068
J110     MVC   RELREC,DUBLWD+3     SETUP TO READ APPROPRIATE BLK.       20640068
         MVC   TWASLOT(1),DUBLWD+6  SETUP TO LOCATE APPROPRIATE SLOT.   20680068
         B     K010       GO READ BLK WHERE DISPLAY WILL RESUME.        20720068
*********************************************************************** 20760068
*      RECREATE PREVIOUS SCREEN FROM BITS PROMPTER      *************** 20800068
*********************************************************************** 20840068
J140     MVC   LGBBBSS(5),MSGBBBSS    RESTORE OLD 'FIRST' AND           20880068
         MVC   LGBBBSS+10(5),MSGBBBSS+10       PREVIOUS.                20920068
         MVC   SMBBBSS,LGBBBSS       DO THE SAME FOR SMALL BBBSS'S      20960068
         TR    MSGBBBSS(5),EBTOHX      GET OLD 'FIRST' ADDRESS          21000068
         PACK  DUBLWD,MSGBBBSS(6)           AND SLOT IN HEX.            21040068
         B     J110                                                     21080068
*********************************************************************** 21120068
*      PAGE BACKWARD SECTION                      ********************* 21160068
*********************************************************************** 21200068
J190     MVC   LGBBBSS(5),MSGBBBSS+10  OLD 'PREVIOUS' NOW BECOMES NEW   21240068
         MVC   LGBBBSS+10(5),LGBBBSS       'FIRST' AND 'PREVIOUS'       21280068
         MVC   SMBBBSS,LGBBBSS       DO THE SAME FOR SMALL BBBSS'S      21320068
         TR    MSGBBBSS+10(5),EBTOHX    GET OLD 'PREVIOUS'              21360068
         PACK  DUBLWD,MSGBBBSS+10(6)             IN HEX.                21400068
         B     J110                                                     21440068
*********************************************************************** 21480068
*      LOCATE SLOT FOR PAGING                     ********************* 21520068
*********************************************************************** 21560068
K010     BAL   LINKREG,LOCATE      LOCATE SLOT TO RESUME AT.            21600068
         XC    PARM4(16),PARM4     ZERO OUT INPUT PARMS.                21640068
         CLI   ENTRYTYP,X'91'     IS THIS AN MDR?                       21680068
         BE    K020               YES. LINE ADDR IS OK.                 21720068
         XC    HXLINLIB,HXLINLIB  NO. DON'T USE ROUNDED DOWN ADDR.      21760068
         MVC   HXLINLIB+1(2),OBRCUA  GET ACTUAL CUA INSTEAD.            21800068
         B     K030                                                     21840068
K020     MVC   HXLINLIB,LINEID                                          21880068
K030     UNPK  DUBLWD,HEXLINE(3)   RESTORE LINE NBR FROM DATA           21920068
         TR    DUBLWD,HXTOEB       BLOCK AS IF IT HAD BEEN KEYED IN.    21960068
         MVC   PARM3(3),DUBLWD+4                                        22000068
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR RECORD?               22040068
         BNE   L110                NO. SKIP POLLING CHARS.              22080068
         MVC   HEXCTRL,MDRCTRL     YES.                                 22120068
         MVC   HEXTERM,MDRTERM     RESTORE CTRL UNIT ADDR               22160068
         UNPK  DUBLWD,HEXCTRL(3)   AND TERMINAL ADDR                    22200068
         TR    DUBLWD,HXTOEB       AS IF THEY HAD                       22240068
         MVC   PARM4(2),DUBLWD+3   BEEN KEYED IN.                       22280068
         MVC   PARM5(2),DUBLWD+5                                        22320068
         B     L130                                                     22360068
L110     CLI   OBRUCB,X'40'        IS THIS A REMOTE OBR ?               22400068
         BNE   L130                NO. SKIP POLL CHARS                  22440068
         MVC   HEXCTRL,OBRCTRL     YES.                                 22480068
         MVC   HEXTERM,OBRTERM     RESTORE CTRL UNIT ADDR               22520068
         UNPK  DUBLWD,HEXCTRL(3)   AND TERMINAL ADDR                    22560068
         TR    DUBLWD,HXTOEB       AS IF THEY HAD                       22600068
         MVC   PARM4(2),DUBLWD+3   BEEN KEYED IN.                       22640068
         MVC   PARM5(2),DUBLWD+5                                        22680068
L130     BAL   LINKREG,GETTIOA     SETUP OUTPUT AREA WITH HEADERS.      22720068
         B     F090                   GO BUILD ANOTHER PAGE.            22760068
*********************************************************************** 22800068
*     BITS PROMPTER OR COMPANION REQUEST?     ************************* 22840068
*********************************************************************** 22880068
L160     CLC   PARM2(4),=C'TERM'   IS THIS A 'COMPANION' INPUT?         22920068
         BE    L200                YES. GO HUNT FOR CTRL & LINE ADDR.   22960068
*                                                                       23000068
*     BITS PROMPTER  REQUEST      *************************             23040068
*                                                                       23080068
         OC    MSGNTRY+4(5),MSGNTRY+4    WAS ANY ERRORS SELECTED?       23120068
         BZ    J080                       NO. DO A PAGE FORWARD.        23160068
         TR    MSGNTRY+4(5),EBTOHX     YES. GET REQUESTED ITEM ADDR.    23200068
         PACK  DUBLWD,MSGNTRY+4(6)            AND SLOT NUMBER.          23240068
         MVC   RELREC,DUBLWD+3                INTO HEX.                 23280068
         MVC   TWASLOT(1),DUBLWD+6                                      23320068
         BAL   LINKREG,LOCATE      LOCATE APPROPRIATE SLOT IN DATA BLK. 23360068
         B     M010                                                     23400068
*********************************************************************** 23440068
*      PREPARE TO DO 3270 SCREEN FROM COMPANION 'CTRL' DISPLAY    ***** 23480068
*********************************************************************** 23520068
L200     TR    MSGBBBSS,EBTOHX  MSGBBBSS IS BBBSS OF CTRL UNIT DISPLAY. 23560068
         PACK  DUBLWD,MSGBBBSS(6)  GET ITS BLK & SLT IN HEX.            23600068
         MVC   RELREC,DUBLWD+3                                          23640068
         MVC   TWASLOT(1),DUBLWD+6                                      23680068
         BAL   LINKREG,LOCATE      LOCATE BLK & SLOT OF PREVIOUS DISPLY 23720068
         XC    PARM3,PARM3         ERASE BBBSS GARBAGE.                 23760068
         UNPK  PARM3(4),DATAPORT+1(3)   MOVE LINE ADDR FROM RECORD.     23800068
         MVI   PARM3+3,X'00'                                            23840068
         TR    PARM3,HXTOEB        MAKE IT LOOK LIKE IT WAS KEYED IN.   23880068
         XC    PARM4,PARM4         INDICATE A LOCAL TERMINAL IF OBR.    23920068
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR?                      23960068
         BNE   L280                NO. SKIP POLLING CHARACTERS.         24000068
         UNPK  PARM4(3),MDRCTRL(2)  GET CTRL UNIT POLL CHAR.            24040068
         MVI   PARM4+2,X'00'                                            24080068
         TR    PARM4,HXTOEB        MAKE IT LOOK LIKE IT WAS KEYED IN.   24120068
         XC    PARM5,PARM5         ZERO-OUT PARM5                       24160068
         MVC   PARM5(2),MSGNTRY+4  MAKE PARM5 LIKE IT WAS KEYED IN      24200068
         B     A010                                                     24240068
L280     CLI   OBRUCB,X'40'        IS THIS A REMOTE OBR ?               24280068
         BE    L290                YES.                                 24320068
         MVC   PARM3,MSGNTRY+4     UNROUND TERML ADDRESS-A LOCAL TERM   24360068
         B     A010                                                     24400068
L290     UNPK  PARM4(3),OBRCTRL(2) GET CTRL UNIT POLL CHAR.             24440068
         MVI   PARM4+2,X'00'                                            24480068
         TR    PARM4,HXTOEB        MAKE IT LOOK LIKE IT WAS KEYED IN.   24520068
         XC    PARM5,PARM5         ZERO-OUT PARM5                       24560068
         MVC   PARM5(2),MSGNTRY+4  MAKE PARM5 LIKE IT WAS KEYED IN      24600068
         B     A010                                                     24640068
*********************************************************************** 24680068
*      PREPARE 'TIME AND DATE' FOR BITS PROMPTER SCREEN       ********* 24720068
*********************************************************************** 24760068
M010     MVI   MSGBDATA,C' '                                            24800068
         MVC   MSGBDATA+1(219),MSGBDATA   CLEAR OUTPUT AREA 320 BYTES   24840068
         MVC   MSGBDATA+220(100),MSGBDATA   FINISH CLEARING OUTPUT      24880068
         MVC   BITBBBSS,MSGBBBSS          MOVE BBBSS TO BITS PROMPTER   24920068
         MVC   MSGBID,MSGID               MOVE MSGID TO BITS PROMPTER   24960068
         XC    PARM3(24),PARM3            CLEAR PARMS FOR HDWR ADDR     25000068
         UNPK  PARM3(4),DATAPORT+1(3)     MOVE LINE ADDR                25040068
         MVI   PARM3+3,X'00'                                            25080068
         TR    PARM3,HXTOEB               MAKE IT READY FOR OUTPUT      25120068
         CLI    ENTRYTYP,X'91'             IS THIS AN MDR?              25160068
         BNE    M020                       NO. SKIP POLLING CHARS       25200068
         UNPK   PARM4(3),MDRCTRL(2)         GET CTRL UNIT POLL CHAR     25240068
         MVI    PARM4+2,X'00'                                           25280068
         TR     PARM4,HXTOEB               MAKE IT READY FOR OUTPUT     25320068
         UNPK   PARM5(3),MDRTERM(2)        GET TERMINAL POLL CHAR       25360068
         MVI    PARM5+2,X'00'                                           25400068
         TR     PARM5,HXTOEB          MAKE IT READY FOT OUTPUT          25440068
         B      M050                                                    25480068
M020     CLI    OBRUCB,X'40'          IS THIS A REMOTE OBR ?            25520068
         BNE    M030                  NO. SKIP POLL CHARS               25560068
         UNPK   PARM4(3),OBRCTRL(2)         GET CTRL UNIT POLL CHAR     25600068
         MVI    PARM4+2,X'00'                                           25640068
         TR     PARM4,HXTOEB               MAKE IT READY FOR OUTPUT     25680068
         UNPK   PARM5(3),OBRTERM(2)        GET TERMINAL POLL CHAR       25720068
         MVI    PARM5+2,X'00'                                           25760068
         TR     PARM5,HXTOEB          MAKE IT READY FOT OUTPUT          25800068
         B      M050                                                    25840068
M030     UNPK   PARM3(4),OBRCUA(3)   GET UNROUNDED LOCAL TERM ADDR      25880068
         MVI    PARM3+3,X'00'                                           25920068
         TR     PARM3,HXTOEB          MAKE IT READY FOR OUTPUT          25960068
M050     LA     OUTREG,MSBRECAP       POINT TO BITS RECAP HDR           26000068
         MVC    0(HDR4LTH,OUTREG),HDR4     MOVE RECAP HDR TO OUTPUT     26040068
         OC     PARM5,PARM5           TEST TERMINAL ADDR INPUT?         26080068
         BZ     M055                                                    26120068
         MVC    (HDR4TERM-HDR4)(2,OUTREG),PARM5    FILL IN TERML ADDR   26160068
         MVC    (HDR4CTRL-HDR4)(2,OUTREG),PARM4    FILL IN CTRL ADDR    26200068
M055     MVC    (HDR4LINE-HDR4)(3,OUTREG),PARM3    FILL IN LINE ADDR    26240068
         CLC    (HDR4TERM-HDR4)(2,OUTREG),=C'  '   IS TERML BLANK?      26280068
         BNE    M060                   NO.  LET IT GO.                  26320068
         MVC    6(6,OUTREG),=C'LOCAL '    YES.  CHANGE TO               26360068
         MVC   12(3,OUTREG),PARM3          LOCAL FORMAT.                26400068
         MVC   15(24,OUTREG),=24C' '                                    26440068
M060     LA    OUTREG,MSGBDATA          POINT TO  OUTAREA.              26480068
         UNPK  DUBLWD,TIME         MOVE TIME OF                         26520068
         MVC   0(2,OUTREG),DUBLWD+1     ERROR TO OUTPUT.                26560068
         MVI   2(OUTREG),C':'                                           26600068
         MVC   3(2,OUTREG),DUBLWD+3                                     26640068
         LA    1,LEAPTBL                                                26680068
M090     CLC   DATE+1(1),0(1)           FIGURE OUT IF                   26720068
         BE    M100                     ERROR HAPPENED                  26760068
         LA    1,1(1)                   DURING LEAP YEAR.               26800068
         CLI   0(1),X'FF'                                               26840068
         BNE   M090                                                     26880068
         ZAP   CALENDAR+8(2),=P'28'                                     26920068
         B     M110                                                     26960068
M100     ZAP   CALENDAR+8(2),=P'29'                                     27000068
M110     LA    15,CALENDAR                                              27040068
M120     MVN   DATE+3(1),=X'0C'    PROTECT AGAINST GARBAGE IN PACKED    27080068
         CLC   DATE+2(2),3(15)     FIELD.  COMPUTE MONTH AND            27120068
         BNH   M130                     DAY FROM DAY NUMBER.            27160068
         SP    DATE+2(2),3(2,15)                                        27200068
         LA    15,5(15)                                                 27240068
         B     M120                                                     27280068
M130     MVC   6(3,OUTREG),0(15)        MOVE MONTH TO OUTPUT.           27320068
         UNPK  9(2,OUTREG),DATE+2(2)    MOVE DAY TO OUTPUT.             27360068
         OI    10(OUTREG),X'F0'                                         27400068
         MVC   LINESZ,=H'40'                                            27440068
         MVC   LINELOOP,=H'4'                                           27480068
M140     CLI   ENTRYTYP,X'91'      IS THIS ENTRY AN OBR?                27520068
         BNE   M160                YES.                                 27560068
         BAL   LINKREG,BUMDR       NO. BLOW UP AN MDR ENTRY.            27600068
M150     MVC   MSGBSM(220),MSGBDATA     MOVE BITS SCREEN DATA TO        27640068
         MVC   MSGBSM+220(100),MSGBDATA+220   SMALL SCREEN OUTPUT AREA  27680068
         CALL  ASMTDLI,(ISRT,(PCBREG),MSGBITS,BITSCR),VL                27720068
         B     CHECKST                                                  27760068
*********************************************************************** 27800068
*     BLOWUP OF 'OBR' ERRORS                  ************************* 27840068
*********************************************************************** 27880068
M160     BAL   LINKREG,BUOBR       BLOWUP AN OBR ENTRY.                 27920068
         B     M150                                                     27960068
BUOBR    MVC   13(5,OUTREG),=C'TP-OP'   MOVE THE                        28000068
         UNPK  DUBLWD,OBRCCW+5(2)       TP OP CODE                      28040068
         TR    DUBLWD,HXTOEB            TO OUTPUT AREA.                 28080068
         MVC   19(2,OUTREG),DUBLWD+5                                    28120068
         LA    15,TPOPTBL                                               28160068
         CLI   ENTRYTYP,X'34'       IS THIS A TCAM OBR?                 28200068
         BNE   O060                 NO. REG 15 POINTS AT BTAM           28240068
         L     15,=A(TCAMTPOP)      YES. POINT TO TCAM TPOP TABLE       28280068
O060     CLC   0(2,15),DUBLWD+5                                         28320068
         BE    O120                                                     28360068
         CLC   0(2,15),=X'FFFF'                                         28400068
         BE    O120                                                     28440068
         LA    15,20(15)                                                28480068
         B     O060                                                     28520068
O120     MVC   22(18,OUTREG),2(15) MOVE EXPLANATION OF TP OP CODE.      28560068
         AH    OUTREG,LINESZ       BUMP TO NEXT LINE OF OUTPUT.         28600068
O170     MVC   0(11,OUTREG),=C'DATA LENGTH'                             28640068
         UNPK  DUBLWD,OBRCCW+6(3)                                       28680068
         TR    DUBLWD,HXTOEB       MOVE DATA LENGTH.                    28720068
         MVC   12(4,OUTREG),DUBLWD+3                                    28760068
         MVC   21(14,OUTREG),=C'RESIDUAL COUNT'                         28800068
         UNPK  DUBLWD,OBRCSW+6(3)                                       28840068
         TR    DUBLWD,HXTOEB                                            28880068
         MVC   36(4,OUTREG),DUBLWD+3                                    28920068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE.            28960068
         MVC   0(15,OUTREG),=C'CHANNEL COMMAND'                         29000068
         UNPK  DUBLWD,OBRCCW(2)                                         29040068
         TR    DUBLWD,HXTOEB       MOVE THE CHANNEL COMMAND.            29080068
         MVC   16(2,OUTREG),DUBLWD+5                                    29120068
         LA    15,CCWTABL                                               29160068
         CLI   OBRUCB,X'40'     IS THIS A REMOTE?                       29200068
         BE    P070             YES. USE 270X COMMANDS.                 29240068
         L     15,=A(CCW3272)   NO. USE THE 3272 COMMANDS.              29280068
P070     CLC   0(2,15),DUBLWD+5                                         29320068
         BE    P130                                                     29360068
         CLC   0(2,15),=X'FFFF'                                         29400068
         BE    P130                                                     29440068
         LA    15,20(15)                                                29480068
         B     P070                                                     29520068
P130     MVC   19(18,OUTREG),2(15) MOVE CCW EXPLANATION.                29560068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE.            29600068
         MVC   4(5,OUTREG),=C'SENSE'    MOVE SENSE & STATUS HEADERS.    29640068
         MVC   24(6,OUTREG),=C'STATUS'                                  29680068
         UNPK  DUBLWD,OBRSENSE(3)  MOVE OBR SENSE                    XH 29720068
         TR    DUBLWD,HXTOEB           BYTES                         XH 29760068
         MVC   10(4,OUTREG),DUBLWD+3     TO OUTPUT AREA              XH 29800068
         UNPK  DUBLWD,OBRCSW+4(3)  MOVE OBR STATUS                   XH 29840068
         TR    DUBLWD,HXTOEB           BYTES                         XH 29880068
         MVC   31(4,OUTREG),DUBLWD+3     TO OUTPUT AREA              XH 29920068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUTLINE.             29960068
         LR    14,OUTREG           TEMPORARY POINTER TO SENSE OUTPUT.   30000068
         LH    1,LINELOOP          LIMIT DISPLAY IF MOD 1 SCREEN.       30040068
         LA    15,SENSTABL                                              30080068
         CLI   OBRUCB,X'40'     IS THIS REMOTE?                         30120068
         BE    P200             YES, USE 270X SENSE                     30160068
         L     15,=A(SENS3272)   NO, USE 3272 SENSE                     30200068
P200     MVC   DUBLWD(1),OBRSENSE  SETUP TO TEST SENSE BITS.            30240068
         NC    DUBLWD(1),0(15)                                          30280068
         CLC   DUBLWD(1),0(15)                                          30320068
         BE    Q050                                                     30360068
Q010     LA    15,19(15)           BUMP TO NEXT SLOT IN SENSE TABL.     30400068
         CLI   0(15),X'FF'                                              30440068
         BNE   P200                                                     30480068
         B     Q080                                                     30520068
Q050     MVC   0(18,14),1(15)      MOVE EXPLANATION OF 1 SENSE BIT.     30560068
         AH    14,LINESZ           BUMP TO NEXT SENSE OUTPUT AREA.      30600068
         BCT   1,Q010              ANY TIOA ROOM LEFT?                  30640068
Q080     ST    14,SAVE14                                                30680068
         LR    14,OUTREG           NO. SETUP TO LOOK AT STATUS BITS.    30720068
         LH    1,LINELOOP                                               30760068
         LA    15,CSWTABL                                               30800068
Q110     MVC   DUBLWD(2),OBRCSW+4                                       30840068
         NC    DUBLWD(2),0(15)                                          30880068
         CLC   DUBLWD(2),0(15)                                          30920068
         BE    Q180                                                     30960068
Q150     LA    15,20(15)                                                31000068
         CLI   0(15),X'FF'                                              31040068
         BNE   Q110                                                     31080068
         B     Q210                                                     31120068
Q180     MVC   20(18,14),2(15)     MOVE EXPLANATION OF 1 CSW STATUS BIT 31160068
         AH    14,LINESZ           BUMP TO NEXT OUTPUT SLOT             31200068
         BCT   1,Q150              ANY TIOA ROOM LEFT?                  31240068
Q210     C     14,SAVE14           NO.                                  31280068
         BH    R010                                                     31320068
         L     14,SAVE14           SET OUTPUT REG TO HIGHER             31360068
R010     LR    OUTREG,14           OUTPUT ADDRESS (SENSE OR STATUS).    31400068
         BR    LINKREG                                                  31440068
*********************************************************************** 31480068
*     BLOWUP OF 'MDR' ERRORS                  ************************* 31520068
*********************************************************************** 31560068
BUMDR    MVC   24(6,OUTREG),=C'SENSE'  MOVE STATUS HDR.                 31600068
         UNPK  DUBLWD,MDRSTATS(3)  MOVE MDR                          XH 31640068
         TR    DUBLWD,HXTOEB          STATUS BYTES                   XH 31680068
         MVC   31(4,OUTREG),DUBLWD+3     TO OUTPUT AREA              XH 31720068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE.            31760068
         LR    14,OUTREG                                                31800068
         LH    1,LINELOOP                                               31840068
         AR    1,1                 LIMIT MOD 1 TO 7 BITS MAX.           31880068
         BCTR  1,0                                                      31920068
         LA    15,STATSTBL                                              31960068
R080     MVC   DUBLWD(2),MDRSTATS  SETUP TO LOOK AT REMOTE STATUS TBL.  32000068
         NC    DUBLWD(2),0(15)                                          32040068
         CLC   DUBLWD(2),0(15)                                          32080068
         BE    R170                                                     32120068
R120     LA    15,20(15)                                                32160068
         CLI   0(15),X'FF'                                              32200068
         BNE   R080                                                     32240068
         B     R200                                                     32280068
R170     MVC   20(18,14),2(15)     MOVE EXPLANATION OF 1 REMOTE STATUS  32320068
         AH    14,LINESZ           BUMP TO NEXT OUTPUT AREA             32360068
         BCT   1,R120              ANY TIOA ROOM LEFT?                  32400068
R200     LR    OUTREG,14           NO. SETUP TO COMPUTE DATA LTH.       32440068
         BR    LINKREG             RETURN TO MAIN LINE.                 32480068
*********************************************************************** 32520068
*   THIS IS THE LOCATE ROUTINE                                          32560068
*********************************************************************** 32600068
LOCATE   ST    11,SAVE11                                                32640068
         LA    11,PARMADDR         SET UP PARM REG                      32680068
         L     15,=V(BNGIREAD)    POINT TO READ MODULE                  32720068
         BALR  14,15              LINK TO BDAM READ MODULE              32760068
         L     11,SAVE11                                                32800068
         OC    STATUS,STATUS      READ OK?                              32840068
         BZ    S030               YES.                                  32880068
         CLC   STATUS,=C'FF'       WAS EMFILE OPENED?                   32920068
         BE    Z60                 NO.  WRITE 'NOT OPEN' MSG            32960068
*        UNPK  DBLWD,STATUS(3)                                          33000068
*        MVC   IOERCODE,DBLWD+3                                         33040068
*        TR    IOERCODE,HXTOEB     MOVE BDAM RETURN CODE TO I/O ERR MSG 33080068
*        UNPK  DBLWD,RELREC(4)                                          33120068
*        MVC   IOERBLK,DBLWD+4     MOVE BLK NBR THAT WAS BEING READ     33160068
*        TR    IOERBLK,HXTOEB                                           33200068
         B     Z90                     IF REQUESTED SLOT CAN'T          33240068
*                                        BE FOUND, SEND 'SEARCHING ERR' 33280068
S030     L     FIOABAR,IOAREA      POINT TO DATA BLK.                   33320068
         LH    DATALOOP,BLKLTH     SETUP LOOP NBR BYTES THIS BLK.       33360068
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM             33400068
         MVC   WRKSLOT,TWASLOT     MOVE SLOT COUNT TO WORK AREA         33440068
S060     CLI   WRKSLOT,2           IF RQSTED SLOT = 1, THIS IS IT.      33480068
         BL    0(LINKREG)          GO RESUME DISPLAY BUILDING.          33520068
         SR    1,1                                                      33560068
         IC    1,WRKSLOT           DECREMENT SLOT COUNT BY 1.           33600068
         BCTR  1,0                                                      33640068
         STC   1,WRKSLOT                                                33680068
         IC    1,0(DATAREG)        BUMP TO NEXT SLOT.                   33720068
         LTR   1,1                                                      33760068
         BZ    S190                PREVENT LOOP IF GARBAGE INPUT.       33800068
         AR    DATAREG,1                                                33840068
         SR    DATALOOP,1                                               33880068
         LTR   DATALOOP,DATALOOP   VERIFY SLOT NBR VALID FOR THIS BLK.  33920068
         BP    S060                                                     33960068
S190     MVC   ERRDATA(MSG5LTH),MSG5   IF REQUESTED SLOT CAN'T          34000068
ERRISRT  CALL  ASMTDLI,(ISRT,(PCBREG),ERROUT,LGERR),VL                  34040068
         B     CHECKST                                                  34080068
*********************************************************************** 34120068
GETTIOA  MVC   MSGOID,=CL20' '        CLEAR MSG ID AREA                 34160068
         OC    TWATCTID,TWATCTID   IF NO INPUT WAS SPECIFIED,           34200068
         BZ    T130                SHOW USER HIS TERMINAL ID.           34240068
         MVC   MSGOID(10),=C'   IMS ID='                                34280068
         MVC   MSGOID+10(8),TWATCTID                                    34320068
T130     LA    OUTREG,MSGRECAP     POINT TO RECAP OUTPUT HEADER         34360068
         MVC   0(HDR4LTH,OUTREG),HDR4    MOVE RECAP HEADER TO OUTPUT    34400068
         OC    PARM5,PARM5         IF NO TERM ADDR INPUT, SHOW ONLY LIN 34440068
         BZ    T150                                                     34480068
         MVC   (HDR4TERM-HDR4)(2,OUTREG),PARM5   FILL IN THE            34520068
         MVC   (HDR4CTRL-HDR4)(2,OUTREG),PARM4     ID OF THIS TERML     34560068
T150     DS    0H                                                       34600068
         MVC   (HDR4LINE-HDR4)(3,OUTREG),PARM3    CTRL UNIT, AND LINE.  34640068
         CLC   (HDR4TERM-HDR4)(2,OUTREG),=C'  '  IS TERML BLANK?        34680068
         BNE   T160                      NO. LET IT GO.                 34720068
         MVC   6(6,OUTREG),=C'LOCAL '    YES, CHANGE TO                 34760068
         MVC   12(3,OUTREG),PARM3        LOCAL FORMAT.                  34800068
         MVC   15(24,OUTREG),=24C' '                                    34840068
T160     LA    OUTREG,MGODAT1A     SETUP OUTPUT REG TO POINT AT DATA    34880068
         MVC   MSGHDR1,HDR6        MOVE COLUMN HEADERS                  34920068
         MVC   MSGHDR2,HDR6         TO OUTPUT.                          34960068
         LA    OUTLOOP,7           SETUP TO SHOW 7 ITEMS ON MOD 1.      35000068
         LA    14,40               SETUP TO INITIALIZE OUTPUT ENTRIES   35040068
         LA    15,MGODAT1A         POINT TO FIRST ENTRY IN OUTPUT.      35080068
T170     MVC   0(7,15),=X'00B04000B0403F'  SET TO UNPROT,NORM,ALPHA     35120068
         MVC   14(4,15),=X'00B0403F'          AND ERASE FIELDS ON SCR   35160068
         LA    15,43(15)           BUMP TO NEXT ENTRY                   35200068
         BCT   14,T170             BRANCH IF MORE ENTRIES TO CLEAR      35240068
         MVI   QUITSW,X'00'        TURN OFF OUTPUT-FOR-3277-2 SWITCH    35280068
T180     BR    LINKREG             RETURN TO MAIN LINE.                 35320068
T190     OC    PARM3,=CL8' '            INSURE NO X'00'        @OZ31886 35328007
         MVC   MSG13LN,PARM3            MOVE LINE NO. INTO MSG @OZ31886 35336007
         MVC   ERRDATA(MSG13LTH),MSG13  MOVE MESSAGE           @OZ31886 35344007
         B     ERRISRT                  GO WRITE MESSAGE       @OZ31886 35352007
Z10      MVC   ERRDATA(MSG4LTH),MSG4                                    35360068
         B     ERRISRT                                                  35400068
Z20      MVC   ERRDATA(MSG1LTH),MSG1                                    35440068
         B     ERRISRT                                                  35480068
Z30      MVC   ERRDATA(MSG3LTH),MSG3                                    35520068
         B     ERRISRT                                                  35560068
Z40      MVC   ERRDATA(MSG6LTH),MSG6                                    35600068
         B     ERRISRT                                                  35640068
Z50      CLI   PARM4,X'00'          IS FULL ADDRESS AVAILABLE ?         35680068
         BE    Z50A                 NO. JUST SHOW TERMINAL ADDR         35720068
         CLC   PARM4(2),=C'00'                                          35760068
         BE    Z50A                 NO. JUST SHOW TERMINAL ADDR         35800068
         MVC   ERRDATA(MSG11LTH),MSG11   MOVE 'NO ERRS' MSG TO OUTPUT   35840068
         OC    PARM3(24),=CL24' '   CHANGE  X'00'  TO  X'40'            35880068
         LA    15,ERRDATA           POINT TO OUTPUT AREA                35920068
         MVC   (MSG11TRM-MSG11)(2,15),PARM5  MOVE TERML TO OUTPUT       35960068
         MVC   (MSG11CU-MSG11)(2,15),PARM4   MOVE CTRL UNIT TO OUTPUT   36000068
         MVC   (MSG11LIN-MSG11)(3,15),PARM3  MOVE LINE      TO OUTPUT   36040068
         CLI   TWATCTID,X'00'           SYMBOLIC ADDR PRESENT ?         36080068
         BE    Z50C                     NO.  WRITE MSG                  36120068
         MVC   (MSG11ID-MSG11)(10,15),=C'   IMS ID='                    36160068
         MVC   (MSG11ID+10-MSG11)(8,15),TWATCTID                        36200068
         B     Z50C                                                     36240068
Z50A     OC    PARM3,=CL8' '          CHANGE  X'00'  TO  X'40'          36280068
         MVC   MSG12TRM,PARM3         MOVE TERML TO OUTPUT              36320068
         LA    15,MSG12ID             POINT TO END OF ADDRESS           36360068
         MVC   MSG12ID,=CL20' '       CLEAR OUT SYMBOLIC ID AREA        36400068
         CLI   TWATCTID,X'00'         SYMBOLIC NAME PRESENT ?           36440068
         BE    Z50B                   NO.                               36480068
         MVC   0(10,15),=C'   IMS ID='                                  36520068
         MVC   10(8,15),TWATCTID                                        36560068
Z50B     MVC   ERRDATA(MSG12LTH),MSG12 MOVE MSG12 TO OUTPUT AREA        36600068
Z50C     B     ERRISRT                                                  36640068
Z60      MVC   ERRDATA(MSG9LTH),MSG9                                    36680068
         B     ERRISRT                                                  36720068
Z90      MVC   ERRDATA(MSG5LTH),MSG5                                    36760068
         B     ERRISRT                                                  36800068
         EJECT                                                          36840068
ERROUT   DS    0D              MAP OF TRANSACTION MESSAGE SEGMENT:      36880068
ERROLL   DC    H'121'              MESSAGE LENGTH INCL. LL,Z1,Z2,DATA   36920068
ERROZ1   DC    X'00'               FLAG FIELD - USED BY IMS INTERNALLY  36960068
ERROZ2   DC    X'00'               FLAG FIELD - NON-ZERO IF MFS EDITED  37000068
ERRDATA  DS    CL117               START OF MESSAGE DATA                37040068
MSG1     DC    CL39'BNG001A I I/O ERR READING SYS1.DEMFLOG '            37080068
         DC    CL28'    THE BDAM RETURN CODE IS'                        37120068
IOERCODE DC    CL4'0'                                                   37160068
         DC    CL7' '                                                   37200068
         DC    CL34'THE BDAM RELATIVE BLOCK NUMBER IS '                 37240068
IOERBLK  DC    CL3'0'                                                   37280068
         DC    C'  '                                                    37320068
MSG1LTH  EQU   *-MSG1                                                   37360068
MSG3     DC    C'BNG003I I NO ERRORS RECORDED '                         37400068
MSG3LTH  EQU   *-MSG3                                                   37440068
MSG4     DC    C'BNG004I I NO ERRORS RECORDED FOR LINE '                37480068
NOLINE   DC    CL3' '                                                   37520068
MSG4LTH  EQU   *-MSG4                                                   37560068
MSG5     DC    CL39'BNG005I I ERROR NOT FOUND ON FILE FOR '             37600068
         DC    C'THE SELECTED ITEM '                                    37640068
MSG5LTH  EQU   *-MSG5                                                   37680068
MSG6     DC    C'BNG006I I INVALID FORMAT--CHECK PAGE 2'                37720068
         DC    C'OF MENU FOR CORRECT FORMATS'                           37760068
MSG6LTH  EQU   *-MSG6                                                   37800068
MSG9     DC    C'BNG009A I SYS1.DEMFLOG FILE NOT OPEN   '               37840068
MSG9LTH  EQU   *-MSG9                                                   37880068
MSG10    DC    AL2(MSG10LTH-4),X'0000'                                  37920068
         DC    CL10'BNG010I I '                                         37960068
MSG10ID  DC    CL8' ',CL21' IS A VTAM TERMINAL. '                       38000068
         DC    CL39'FOR INQUIRY,GIVE DEMF HARDWARE ADDRESS.'            38040068
MSG10LTH EQU   *-MSG10                                                  38080068
MSG11    DC    CL39'BNG011I I NO ERRORS RECORDED FOR REMOTE'            38120068
         DC    CL9'TERMINAL '                                           38160068
MSG11TRM DC    CL2' '                                                   38200068
         DC    CL20'       ON CTRL UNIT '                               38240068
MSG11CU  DC    CL2' '                                                   38280068
         DC    CL14'      ON LINE '                                     38320068
MSG11LIN DC    CL3' '                                                   38360068
         DC    CL8' '                                                   38400068
MSG11ID  DC    CL20' '          IMS SYMBOLIC NAME                       38440068
MSG11LTH EQU   *-MSG11                                                  38480068
MSG12    DC    CL39'BNG012I I NO ERRORS RECORDED FOR LOCAL '            38520068
         DC    CL9'TERMINAL '                                           38560068
MSG12TRM DC    CL3' '                                                   38600068
         DC    CL7' '                                                   38640068
MSG12ID  DC    CL20' '          IMS SYMBOLIC NAME                       38680068
MSG12LTH EQU   *-MSG12                                                  38720068
MSG13    DC    CL39'BNG013A I NO DATA BLOCKS AVAILABLE FOR '   @OZ31886 38725007
         DC    CL5'LINE '                                      @OZ31886 38730007
MSG13LN  DC    CL3' '                                          @OZ31886 38735007
         DC    CL31':  DATA BASE IN DEGRADED MODE. '           @OZ31886 38740007
         DC    CL39'MUST ALLOCATE MORE BLOCKS THAN LINES'      @OZ31886 38745007
MSG13LTH EQU   *-MSG13                                         @OZ31886 38750007
********************************************************************    38760068
DTLENTRY DC    C' (? ) '                                                38800068
DTLITEM  DC    CL8' '                                                   38840068
DTLCOUNT DC    CL4'0001'                                                38880068
DTLLTH   EQU   *-DTLENTRY                                               38920068
ITEMLTH  EQU   DTLITEM-DTLENTRY                                         38960068
COUNTLTH EQU   DTLCOUNT-DTLENTRY                                        39000068
*********************************************************************** 39040068
CLRNTRY  DC    XL14'3F'             USED TO CLEAR FIELDS FOR OUTPUT     39080068
         DC    XL4'403F3F3F'                                            39120068
CLRLTH   EQU   *-CLRNTRY                                                39160068
*********************************************************************** 39200068
*  THE FUNCTION/COMPANION TABLE DETERMINES WHICH PROGRAM IS TO WRITE    39240068
*   THE REQUESTED DISPLAY AND PROVIDES THE CORRECT SCREEN AND COLUMN    39280068
*   HEADERS FOR THAT DISPLAY.                                           39320068
*********************************************************************** 39360068
* STORAGE AND WORK AREA DEFINITIONS                                     39400068
*********************************************************************** 39440068
QUITSW   DS    C             USED TO SETUP PAGING BBBSS FOR 3277-1      39480068
PARMADDR DS    0F                                                       39520068
IOAREA   DC    A(0)                ADDR OF RECORD READ PASSED HERE      39560068
RELREC   DC    XL3'0'              REL BLK ADDR TO BE READ              39600068
STATUS   DC    CL2'  '             STATUS OF READ PASSED HERE           39640068
ISRT     DC    CL4'ISRT'           INSERT FUNCTION - OUTPUT TO TERMINAL 39680068
DLIOK    DC    CL2' '              DL/I STATUS SAYS OPERATION PERFORMED 39720068
S3270    DC    CL8'BNGIO327'       MFS MESSAGE OUTPUT DESCRIPTOR NAME   39760068
LGERR    DC    CL8'BNGIOERR'       MFS MESSAGE OUTPUT DESCRIPTOR NAME   39800068
BITSCR   DC    CL8'BNGIOBIT'       MFS MESSAGE OUTPUT DESCRIPTOR NAME   39840068
DATDATE  DS    F                   WORK AREA FOR DATE                   39880068
*********************************************************************** 39920068
* THE FOLLOWING AREA IS USED AS OUTPUT AREA                             39960068
* FOR TRANSACTION MESSAGES, WITH MAPPING AS SHOWN.                      40000068
*********************************************************************** 40040068
MSG3270  DS    0D              MAP OF 3270 TRANSACTION MESSAGE          40080068
MSGOLL   DC    AL2(MSGLTH)         MESSAGE LENGTH INCL. LL,Z1,Z2,DATA   40120068
MSGOZ1   DC    X'00'               FLAG FIELD - USED BY IMS INTERNALLY  40160068
MSGOZ2   DC    X'00'               FLAG FIELD - NON-ZERO IF MFS EDITED  40200068
MSGODATA DS    0F                  START OF MESSAGE DATA                40240068
MSGOID   DS    CL20             CONTAINS IMS SYMBOLIC NAME              40280068
LGBBBSS  DS    CL15             PAGING BBBSS'S FOR 3277-2               40320068
SMBBBSS  DS    CL15             PAGING BBBSS'S FOR 3277-1               40360068
MSGRECAP DS    CL39             RECAP HEADER LINE                       40400068
MSGHDR1  DS    CL39             FILE/STATUS/SENSE/TPOP/CMD/ HEADER      40440068
MSGHDR2  DS    CL39             FILE/STATUS/SENSE/TPOP/CMD/ HEADER      40480068
MGODAT1A DS    CL2         ATTR   *  THESE FIELDS FORM THE REPEATING    40520068
MSGODAT1 DS    CL1         DATA   *  OUTPUT PATTERN WHEREIN THE FIRST   40560068
MGODAT2A DS    CL2         ATTR   * TWO BYTES ARE USED TO SET ATTRIBUTE 40600068
MSGODAT2 DS    CL9         DATA   * BYTES AND THE NEXT FIELD IS DATA    40640068
MGODAT3A DS    CL2         ATTR   * --- IN ALL,43 BYTES ARE REQUIRED    40680068
MSGODAT3 DS    CL27        DATA   *                                     40720068
MSGOREST DS    39CL43      MORE   **  39 MORE OF THE ABOVE TYPE FIELDS  40760068
MSGLTH   EQU   *-MSG3270                                                40800068
FILLER   DC    16X'FF'                                                  40840068
*********************************************************************** 40880068
* THE FOLLOWING AREA IS USED AS OUTPUT AREA                             40920068
* FOR TRANSACTION MESSAGES, WITH MAPPING AS SHOWN.                      40960068
*********************************************************************** 41000068
MSGBITS  DS    0D              MAP OF BITS PROMPTER TRANSACTION MESSAGE 41040068
MSGBLL   DC    AL2(MSGBLTH)        MESSAGE LENGTH INCL. LL,Z1,Z2,DATA   41080068
MSGBZ1   DC    X'00'               FLAG FIELD - USED BY IMS INTERNALLY  41120068
MSGBZ2   DC    X'00'               FLAG FIELD - NON-ZERO IF MFS EDITED  41160068
MSGDATAS DS    0F                  START OF MESSAGE DATA                41200068
MSGBID   DS    CL20             CONTAINS IMS SYMBOLIC NAME              41240068
BITBBBSS DS    CL15             PAGING BBBSS'S FOR 3277-2 AND 3277-1    41280068
MSBRECAP DS    CL38             RECAP HEADER LINE                       41320068
MSGBDATA DS    8CL40            FILE/STATUS/SENSE/TPOP/CMD/ INFO        41360068
MSGBSM   DS    8CL40            FILE/STATUS/SENSE/TPOP/CMD SMALL        41400068
MSGBLTH  EQU   *-MSG3270                                                41440068
********************************************************************    41480068
UNA      DC    X'0080'             UNPROT,NORMAL,ALPHA                  41520068
UHA      DC    X'0088'             UNPROT,HI,ALPHA                      41560068
PNN      DC    X'00B0'             PROT,NORMAL,NUMERIC                  41600068
PHN      DC    X'00B8'             PROT,HI,NUMERIC                      41640068
********************************************************************    41680068
HDR4     DC    C'RECAP REMOTE '                                         41720068
HDR4TERM DC    CL2'  ',C' ON CU '                                       41760068
HDR4CTRL DC    CL2'  ',C' ON LINE '                                     41800068
HDR4LINE DC    CL3'999',CL2' '                                          41840068
HDR4LTH  EQU   *-HDR4                                                   41880068
********************************************************************    41920068
HDR6     DC    CL39'      FILE#  TIME SENSE STATUS TPOP CMD'            41960068
********************************************************************    42000068
*     DETAIL ENTRY WITH ATTRIBUTE BYTES     TOTAL = 43 BYTES            42040068
********************************************************************    42080068
MDRHDR   DS    0F                                                       42120068
MDRATTR1 DC    XL2'00B0'                                                42160068
         DC    C'('                                                     42200068
MDRATTR2 DC    XL2'0080'                                                42240068
         DC    C'? ) '                                                  42280068
MDRBBBSS DC    CL5'BBBSS'                                               42320068
MDRATTR3 DC    XL2'00B0'                                                42360068
MDRHRS   DC    CL2'24',C':'                                             42400068
MDRMINS  DC    CL2'60',C'  '                                            42440068
MDRSTAT  DC    CL4'XXXX',C'   '                                         42480068
OBRSNS   DC    CL4'    ',C'  '                                          42520068
OBRTPOP  DC    CL2'  ',C'  '                                            42560068
OBRCMD   DC    CL2'  ',C' '                                             42600068
MDRLTH   EQU   *-MDRHDR                                                 42640068
********************************************************************    42680068
         LTORG                                                          42720068
CALENDAR DC    C'JAN',PL2'31'                                           42760068
         DC    C'FEB',PL2'28'                                           42800068
         DC    C'MAR',PL2'31'                                           42840068
         DC    C'APR',PL2'30'                                           42880068
         DC    C'MAY',PL2'31'                                           42920068
         DC    C'JUN',PL2'30'                                           42960068
         DC    C'JUL',PL2'31'                                           43000068
         DC    C'AUG',PL2'31'                                           43040068
         DC    C'SEP',PL2'30'                                           43080068
         DC    C'OCT',PL2'31'                                           43120068
         DC    C'NOV',PL2'30'                                           43160068
         DC    C'DEC',PL2'31'                                           43200068
LEAPTBL  DC    X'768084889296FF'                                        43240068
EBTOHX   DC    X'00000000000000000000000000000000'     00-0F  THIS      43280068
         DC    X'00000000000000000000000000000000'     10-1F  TABLE     43320068
         DC    X'00000000000000000000000000000000'     20-2F  CONVERTS  43360068
         DC    X'00000000000000000000000000000000'     30-3F  INPUT     43400068
         DC    X'00000000000000000000000000000000'     40-4F  A THRU F  43440068
         DC    X'000000000000000000000000FF000000'     50-5F    TO      43480068
         DC    X'00000000000000000000000000000000'     60-6F  0A - 0F   43520068
         DC    X'00000000000000000000000000000000'     70-7F   AND      43560068
         DC    X'00000000000000000000000000000000'     80-8F  F0 - F9   43600068
         DC    X'00000000000000000000000000000000'     90-9F    TO      43640068
         DC    X'00000000000000000000000000000000'     A0-AF  00 - 09   43680068
         DC    X'00000000000000000000000000000000'     B0-BF    AND     43720068
         DC    X'000A0B0C0D0E0F000000000000000000'     C0-CF     *      43760068
         DC    X'00000000000000000000000000000000'     D0-DF   BECOME   43800068
         DC    X'00000000000000000000000000000000'     E0-EF    FF.     43840068
         DC    X'00010203040506070809000000000000'     F0-FF            43880068
HXTOEB   DC    4XL16'00',C' ',XL15'00',7XL16'00'  THIS TABLE CONVERTS   43920068
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  HEX CHARS           43960068
         DC    2XL16'00'                CHARS FA-THRU-FF BACK           44000068
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  A THRU F            44040068
CCWTABL  DC    CL20'00TEST IO'                                          44080068
         DC    CL20'01WRITE'                                            44120068
         DC    CL20'02READ'                                             44160068
         DC    CL20'03NO OP'                                            44200068
         DC    CL20'04SENSE'                                            44240068
         DC    CL20'05WRITE WRAP'                                       44280068
         DC    CL20'06READ PREPARE'                                     44320068
         DC    CL20'09WRITE POLL'                                       44360068
         DC    CL20'0AREAD INHIBIT'                                     44400068
         DC    CL20'0DWRITE BREAK'                                      44440068
         DC    CL20'0EREAD SEARCH'                                      44480068
         DC    CL20'13SAD ZERO'                                         44520068
         DC    CL20'17SAD ONE'                                          44560068
         DC    CL20'1BSAD TWO'                                          44600068
         DC    CL20'1EADDRESS PREPARE'                                  44640068
         DC    CL20'1FSAD THREE'                                        44680068
         DC    CL20'23SET MODE'                                         44720068
         DC    CL20'27ENABLE'                                           44760068
         DC    CL20'29WRITE DIAL'                                       44800068
         DC    CL20'2FDISABLE'                                          44840068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           44880068
TPOPTBL  DC    CL20'00ON LINE TEST'                                     44920068
         DC    CL20'01DISABLE'                                          44960068
         DC    CL20'02WRITE EOA EOT EOT'                                45000068
         DC    CL20'03WRT POLL/ADDR CHRS'                               45040068
         DC    CL20'04WRITE SPACE'                                      45080068
         DC    CL20'05RD RSP TO POLLING'                                45120068
         DC    CL20'06RD RSP TO ADDRESSING'                             45160068
         DC    CL20'07READ ID RESPONSE'                                 45200068
         DC    CL20'08WRITE EOA'                                        45240068
         DC    CL20'09NOP OR TIC'                                       45280068
         DC    CL20'0AREAD INDEX'                                       45320068
         DC    CL20'0BREAD INQUIRY'                                     45360068
         DC    CL20'0CRD RSP TO INQUIRY'                                45400068
         DC    CL20'10WRT LINE ADDRESS'                                 45440068
         DC    CL20'11RD OR WRT TEXT'                                   45480068
         DC    CL20'12RD SKIP OR TIC'                                   45520068
         DC    CL20'13WRITE DLE ETX'                                    45560068
         DC    CL20'20RD RSP TO TEXT'                                   45600068
         DC    CL20'21ALL RESET COMMANDS'                               45640068
         DC    CL20'22READ SKIP'                                        45680068
         DC    CL20'23WRITE BREAK'                                      45720068
         DC    CL20'24OPEN LOPEN CLOSE'                                 45760068
         DC    CL20'25RD RSP TO TEXT'                                   45800068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           45840068
CSWTABL  DC    B'1000000000000000',CL18'ATTENTION'                      45880068
         DC    B'0100000000000000',CL18'STATUS MODIFIER'                45920068
         DC    B'0010000000000000',CL18'CTRL UNIT END'                  45960068
         DC    B'0001000000000000',CL18'BUSY'                           46000068
         DC    B'0000100000000000',CL18'CHANNEL END'                    46040068
         DC    B'0000010000000000',CL18'DEVICE END'                     46080068
         DC    B'0000001000000000',CL18'UNIT CHECK'                     46120068
         DC    B'0000000100000000',CL18'UNIT EXCEPTION'                 46160068
         DC    B'0000000010000000',CL18'PGRM CTRLD INTRPT'              46200068
         DC    B'0000000001000000',CL18'INCORRECT LENGTH'               46240068
         DC    B'0000000000100000',CL18'PROGRAM CHECK'                  46280068
         DC    B'0000000000010000',CL18'PROTECTION CHECK'               46320068
         DC    B'0000000000001000',CL18'CHANL DATA CHECK'               46360068
         DC    B'0000000000000100',CL18'CHANL CTRL CHECK'               46400068
         DC    B'0000000000000010',CL18'INTFACE CTRL CK'                46440068
         DC    B'0000000000000001',CL18'CHAINING CHECK'                 46480068
         DC    X'FF'                                                    46520068
SENSTABL DC    B'10000000',CL18'COMMAND REJECT'                         46560068
         DC    B'01000000',CL18'INTERVENTION REQD'                      46600068
         DC    B'00100000',CL18'BUS OUT CHECK'                          46640068
         DC    B'00010000',CL18'EQUIPMENT CHECK'                        46680068
         DC    B'00001000',CL18'DATA CHECK'                             46720068
         DC    B'00000100',CL18'OVERRUN'                                46760068
         DC    B'00000010',CL18'LOST DATA'                              46800068
         DC    B'00000001',CL18'TIMEOUT'                                46840068
         DC    X'FF'                                                    46880068
STATSTBL DC    B'0010000000000000',CL18'RESERVED'                       46920068
         DC    B'0001000000000000',CL18'RESERVED'                       46960068
         DC    B'0000100000000000',CL18'DEVICE BUSY'                    47000068
         DC    B'0000010000000000',CL18'UNIT SPECIFY'                   47040068
         DC    B'0000001000000000',CL18'DEVICE END'                     47080068
         DC    B'0000000100000000',CL18'TRANSMISSION CHECK'             47120068
         DC    B'0000000000100000',CL18'COMMAND REJECT'                 47160068
         DC    B'0000000000010000',CL18'INTERVENTION REQD'              47200068
         DC    B'0000000000001000',CL18'EQUIPMENT CHECK'                47240068
         DC    B'0000000000000100',CL18'DATA CHECK'                     47280068
         DC    B'0000000000000010',CL18'CONTROL CHECK'                  47320068
         DC    B'0000000000000001',CL18'OPERATION CHECK'                47360068
         DC    X'FF'                                                    47400068
SENS3272 DC B'10000000',CL18'COMMAND REJECT'                            47440068
         DC B'01000000',CL18'INTERVENTION REQD'                         47480068
         DC B'00100000',CL18'BUS OUT CHECK'                             47520068
         DC B'00010000',CL18'EQUIPMENT CHECK'                           47560068
         DC B'00001000',CL18'DATA CHECK'                                47600068
         DC B'00000100',CL18'UNIT SPECIFY'                              47640068
         DC B'00000010',CL18'CONTROL CHECK'                             47680068
         DC B'00000001',CL18'OPERATION CHECK'                           47720068
         DC    X'FF'                                                    47760068
CCW3272  DC    CL20'01WRITE'                                            47800068
         DC    CL20'05ERASE WRITE'                                      47840068
         DC    CL20'02READ BUFFER'                                      47880068
         DC    CL20'06READ MODIFIED'                                    47920068
         DC    CL20'0BSELECT'                                           47960068
         DC    CL20'0FERASE ALL PROTECTD'                               48000068
         DC    CL20'03NO OP'                                            48040068
         DC    CL20'04SENSE'                                            48080068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           48120068
TCAMTPOP DC    CL20'01WRT EOT FOR SELECT'                               48160068
         DC    CL20'02OPEN TP OP CODE'                                  48200068
         DC    CL20'03WRITE POLL CHARS'                                 48240068
         DC    CL20'04RD RSPNS TO POLL'                                 48280068
         DC    CL20'05WRITE PAD CHARS'                                  48320068
         DC    CL20'06ENABLE DIAL LINE'                                 48360068
         DC    CL20'07WRT ADDR SEQUENCE'                                48400068
         DC    CL20'08READ RSPNS TO ADDR'                               48440068
         DC    CL20'09WRITE EOA SEQUENCE'                               48480068
         DC    CL20'0ARD RSPNS EOB/ETB'                                 48520068
         DC    CL20'0BWRITE CPU ID'                                     48560068
         DC    CL20'0CREAD ENQ'                                         48600068
         DC    CL20'0DWRITE ENQ'                                        48640068
         DC    CL20'0ERD RSPNS TO ENQ'                                  48680068
         DC    CL20'0FWRITE DLE EOT'                                    48720068
         DC    CL20'10READ ID (TSO)'                                    48760068
         DC    CL20'11NON-R/W CCW'                                      48800068
         DC    CL20'12WRITE BREAK (TSO)'                                48840068
         DC    CL20'13WRT ENQ AFTER SEL'                                48880068
         DC    CL20'14READ LCOUT'                                       48920068
         DC    CL20'15WRT RSP BEFOR TXT'                                48960068
         DC    CL20'16WRITE RESPONSE'                                   49000068
         DC    CL20'17WRITE TONE'                                       49040068
         DC    CL20'18BSC READ ID ENQ'                                  49080068
         DC    CL20'1ABSC READ ID ACK'                                  49120068
         DC    CL20'1CABORT SEND/RECIEV'                                49160068
         DC    CL20'1EREAD TWX ID'                                      49200068
         DC    CL20'20BUF TRM RESET BLK'                                49240068
         DC    CL20'22CLOSE SDR RECRDNG'                                49280068
         DC    CL20'24WRT RESET AFT SEL'                                49320068
         DC    CL20'51READ SKIP LOOP'                                   49360068
         DC    CL20'53WRT IDLES LOOP'                                   49400068
         DC    CL20'57WRT DLE STX'                                      49440068
         DC    CL20'59WRT DLE ETB(ETX)'                                 49480068
         DC    CL20'5BWRT ENQ RSP TO TXT'                               49520068
         DC    CL20'FFTEXT CCW'                                         49560068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           49600068
TWASLOT  DC    X'00'               SLOT COUNTER.                        49640068
WRKSLOT  DS    C                   SLOT CTR WORKAREA FOR LOCATE RTN     49680068
SAVE14   DS    F                   SAVE AREA.                           49720068
TWAOUT   DS    F                   SAVE OUTPUT HDR ADDR                 49760068
LINELOOP DS    H                   NBR LINE ITEMS PER LINESZ.           49800068
OUTSWCH  DS    C                                                        49840068
LINESZ   DS    H                   LINE SIZE                            49880068
HXLINLIB DS    0CL6                LINE ADDRESS INCLUDING               49920068
         DS    C                                                        49960068
HEXLINE  DS    CL2                      VTAM LIB ADDR                   50000068
HEXLIB   DS    CL3                      IN HEX FORMAT.                  50040068
HEXCTRL  DS    C                   CTRL UNIT POLL CHAR.                 50080068
HEXTERM  DS    C                   TERML POLL CHAR.                     50120068
NEWFIRST DS    CL5                 SAVE AREA FOR OLD BLK & SLOT NBR.    50160068
NEWPREV  DS    CL5                 SAVE AREA FOR OLD BLK & SLOT NBR.    50200068
         END   BNGI3270                                                 50240068
./  ADD  SSI=81580199,NAME=BNGLOGR2
 TITLE 'BNGLOGER - MVS LOGGER MODULE - WRITES TO SYS1.DEMFLOG D.S.'     00050007
         PRINT OFF                                                      00100007
         MACRO                                                          00100407
&NAME    BNGHJN &LABEL,&HJN                                             00100807
         LCLC  &HJA,&HJB                                                00101207
&HJA     SETC  '&SYSPARM'(1,4)                                          00101607
&HJB     SETC  '&SYSPARM'(5,4)                                          00102007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00102407
         B     &LABEL .                 BR AROUND CONSTANTS             00102807
         SPACE 2                                                        00103207
.NOBRNCH ANOP                                                           00103607
         AIF   ('&NAME' EQ '').NOLABEL                                  00104007
         DC    C'&NAME' .              MODULE IDENTIFIER                00104407
.NOLABEL ANOP                                                           00104807
         DC    X'&HJA' .                DATE OF MODIFICATION            00105207
         AIF   ('&HJN' NE 'HJN').DATE                                   00105607
         DC    X'&HJB' .                HJN OF MODIFICATION             00106007
.DATE    ANOP                                                           00106407
         AIF   ('&LABEL' EQ '').NOLBL                                   00106807
         SPACE 2                                                        00107207
&LABEL   DS    0H                                                       00107607
.NOLBL   ANOP                                                           00108007
         MEND                                                           00108407
         PRINT ON                                                       00108807
*********************************************************************** 00109207
*                                                                     * 00150007
* MODULE NAME = BNGLOGER                                              * 00200007
*                                                                     * 00250007
* DESCRIPTIVE NAME = MVS LOGGER FUNCTION OF DEMF RECORDING SUSBSYSTEM * 00300007
*                                                                     * 00350007
* COPYRIGHT = NONE                                                    * 00400007
*                                                                     * 00450007
* STATUS = RELEASE 1, LEVEL 1                                         * 00500007
*                                                                     * 00550007
* FUNCTION =   THIS MODULE IS PART OF THE DISPLAY EXCECPTION MONITOR. * 00600007
*              FACILITY.  IT RUNS AS A SYSTEM TASK THAT IS STARTED    * 00650007
*              FROM THE OPERATOR CONSOLE.  IT IS POSTED BY THE LOGREC * 00700007
*              RECORDER MODULE, SVC 76, AND WILL WRITE TO THE DEMF    * 00750007
*              DATA SET, RECORDS WHICH HAVE BEEN QUEUED IN A BUFFER   * 00800007
*              AREA BY THE SVC 76 ROUTINE.  THESE RECORDS ARE TELE-   * 00850007
*              PROCESSING MDR AND OBR RECORDS WHICH WILL LATER BE     * 00900007
*              RETRIEVED, FORMATTED, AND SENT TO A REMOTE TERMINAL    * 00950007
*              WHICH HAS MADE A REQUEST FOR INFORMATION ABOUT THE     * 01000007
*              ERROR ACTIVITY  FOR A GIVEN LINE OR LINES.  THIS       * 01050007
*              MODULE DOES NOT HANDLE THE RETRIEVAL AND FORMATTING    * 01100007
*              FUNCTIONS.  WHEN POSTED, IT WILL DETERMINE WHICH       * 01150007
*              BUFFER OR BUFFERS HAVE BEEN FILLED , AND WILL WRITE    * 01200007
*              THEM OUT TO THE DEMF DATA SET.  THE RECORDS ARE GROUPED* 01250007
*              ACCORDING TO LINE ADDRESS, AND WRITTEN TO A BDAM DATA  * 01300007
*              SET.  AFTER COMPLETION OF THE WRITE, THE MODULE WILL   * 01350007
*              ISSUE A WAIT  ON AN ECB WHICH WILL BE POSTED BY SVC 76 * 01400007
*              WHEN IT HAS AGAIN FILLED A BUFFER.                     * 01450007
*              THIS MODULE ALSO INITIALIZES THE COMMON DATA AREA IN   * 01500007
*              THE NUCLEUS  WITH THE BUFFER AREA ADDRESS AND SETS A   * 01550007
*              FLAG TO BE TESTED BY SVC 76 TO DETERMINE IF DEMF IS    * 01600007
*              ACTIVE.  A GETMAIN IS DONE FOR A BUFFER AREA.  IF ANY  * 01650007
*              ERROR CONDITIONS ARE ENCOUNTERED, A MESSAGE WILL BE    * 01700007
*              ISSUED AND THE STAE ROUTINE IS ENTERED TO RESET SYSTEM * 01750007
*              FLAGS AND TERMINATE LOGGING.                           * 01800007
*                                                                     * 01850007
* NOTES = NONE                                                        * 01900007
*                                                                     * 01950007
*    DEPENDENCIES = NONE                                              * 02000007
*                                                                     * 02050007
*    RESTRICTIONS = NONE                                              * 02100007
*                                                                     * 02150007
*    REGISTER CONVENTIONS = SEE REGISTERS EQU'S BELOW                 * 02200007
*                                                                     * 02250007
*    PATCH LABEL = PTCHAREA  (12 FULL WORDS)                          * 02300007
*                                                                     * 02350007
* MODULE TYPE = CONTROL                                               * 02400007
*                                                                     * 02450007
*    PROCESSOR = ASSEMBLER H                                          * 02500007
*                                                                     * 02550007
*    MODULE SIZE = 11920 DECIMAL BYTES                                * 02600007
*                                                                     * 02650007
*    ATTRIBUTES = SERIALLY REUSABLE                                   * 02700007
*                                                                     * 02750007
* ENTRY POINT = BNGLOGER                                              * 02800007
*                                                                     * 02850007
*    PURPOSE = SEE FUNCTION                                           * 02900007
*                                                                     * 02950007
*    LINKAGE = START COMMAND FROM SYSTEM OPERATOR.                    * 03000007
*              POST MACRO ISSUED BY IFBSVC76 ROUTINE (SVC 76).        * 03050007
*                                                                     * 03100007
* INPUT = ONE OR MORE INCIDENT RECORDS QUEUED IN THE BUFFER AREA,     * 03150007
*         AND THE CORRESPONDING BYTE IN THE BUFFER TABLE HAVING ITS   * 03200007
*         HIGH ORDER BIT SET TO ONE.                                  * 03250007
*                                                                     * 03300007
* OUTPUT = DEPENDING ON THE INPUT, ZERO, ONE OR MORE RECORDS WRITTEN  * 03350007
*          TO THE SYS1.DEMFLOG DATA SET.                              * 03400007
*                                                                     * 03450007
* EXIT-NORMAL = REGISTER 15 RETURN CODES RETURNED TO CALLER :         * 03500007
*               00 - OPERATION PERFORMED AS REQUESTED                 * 03550007
*                                                                     * 03600007
* EXIT-ERROR = NONE                                                   * 03650007
*                                                                     * 03700007
* EXTERNAL REFERENCE = SEE BELOW                                      * 03750007
*                                                                     * 03800007
*    ROUTINES = NONE                                                  * 03850007
*                                                                     * 03900007
*    DATA AREAS = BUFFER AREA USED BY IFBSVC76 AND BNGLOGER.          * 03950007
*                                                                     * 04000007
*    CONTROL BLOCK = CVT,IFBDCB00                                     * 04050007
*                                                                     * 04100007
* TABLES = CTRLTBL  - USED BY TRT IN IFBSVC76 TO FIND FREE BUFFER     * 04150007
*          BUFFTBL  - USED BY TRT IN IFBSVC76 TO FIND FREE BUFFER     * 04200007
*                                                                     * 04250007
* MACROS = CVT,DCB,GETMAIN,FREEMAIN,ESTAE,ENQ,DEQ,OPEN,CLOSE,WTO,WTOR,* 04300007
*          WAIT,READ,WRITE,CHECK,TIME,IHAPSA,MODESET.                 * 04350007
*                                                                     * 04400007
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 04450007
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 04450107
* CHANGE 02  02/24/78  BNGHJN MACRO ADDED                             * 04450207
*C200500                                                       @OZ29853 04450307
*A078000,178500,183500                                         @OZ29853 04450407
*A074500,157000,157500,163000                                  @OZ29866 04450507
*C149500,153500,377000,378500                                  @OZ29866 04450607
*                                                                     * 04550007
*********************************************************************** 04600007
         EJECT                                                          04650007
********                *****   REGISTER EQUATES   ****           ****  04700007
R0       EQU   0                       REGISTER 0                       04750007
R1       EQU   1                       REGISTER 1                       04800007
R2       EQU   2                       REGISTER 2                       04850007
R3       EQU   3                       REGISTER 3                       04900007
R4       EQU   4                       REGISTER 4                       04950007
R5       EQU   5                       REGISTER 5                       05000007
R6       EQU   6                       REGISTER 6                       05050007
R7       EQU   7                       REGISTER 7                       05100007
R8       EQU   8                       REGISTER 8                       05150007
R9       EQU   9                       REGISTER 9                       05200007
R10      EQU   10                      REGISTER 10                      05250007
R11      EQU   11                      REGISTER 11                      05300007
R12      EQU   12                      REGISTER 12                      05350007
R13      EQU   13                      REGISTER 13                      05400007
R14      EQU   14                      REGISTER 14                      05450007
R15      EQU   15                      REGISTER 15                      05500007
*                                                                       05550007
SAVEREG  EQU   13                      SAVE AND CONSTANT AREA REG.      05600007
BASEREG  EQU   12                      MODULE BASE REG.                 05650007
BUFFREG  EQU   11                      DEMF BUFFER AREA REG.            05700007
CVTREG   EQU   3                       CVT BASE REG.                    05750007
RETREG   EQU   14                      RETURN REGISTER                  05800007
ENTREG   EQU   15                      ENTRY REGISTER                   05850007
IFBREG   EQU   10                      IFBDCB NUCLEUS CSECT REGISTER.   05900007
DATAREG  EQU   8                       RECORD POINTER REGISTER.         05950007
LINKREG  EQU   2                       LINKAGE REGISTER.                06000007
BASERG2  EQU   6                       SECOND BASE REGISTER.            06050007
SLOTREG  EQU   3                                                        06100007
BCTREG   EQU   4                                                        06150007
*                                                                       06200007
*                                                                       06250007
*                                                                       06300007
********                 ***** MISCELLANEOUS EQUATES *****              06350007
         CVT   DSECT=YES                                                06400007
         PRINT NOGEN                                                    06450007
         IHAPSA                                                         06500007
         PRINT GEN                                                      06550007
*                                                                       06600007
DCBDISP  EQU   16                      LOGREC DCB DISP. IN IFBDCB CSECT 06650007
OPENBIT  EQU   16                      DCB OPEN BIT.                    06700007
DCBOFLGS EQU   48                      DISP IN DCB TO OPEN FLAGS.       06750007
         SPACE 2                                                        06800007
ONE      EQU   1                   FOR DISPLACEMENT                     06850007
TWO      EQU   2                   FOR DISPLACEMENT                     06900007
EIGHT    EQU   8                   FOR DISPLACEMENT                     06950007
TWEL     EQU   12                  FOR DISPLACEMENT                     07000007
PRESIZE  EQU   7                   PREFIX LENGTH OF DEMFILE RECORD      07050007
MDR      EQU   X'91'               MDR RECORD TYPE                      07100007
OBRBT    EQU   X'30'               OBR - BTAM RECORD TYPE               07150007
OBRTC    EQU   X'34'               OBR - TCAM RECORD TYPE               07200007
DDIDISP  EQU   64                  DISP IN LONG OBR TO DEV DEP INFO     07250007
ZERO     EQU   0                                                        07300007
M3270EP  EQU   X'03'               MDR 3270 EP MODE                     07350007
OBRNA1   EQU   X'E0'               UNWANTED OBRS: SDR CTRS,TEMP,SHORT   07400007
OBRNA2   EQU   X'60'               UNWANTED OBRS: CTR OVFLO, EOD        07450007
OBRCCTT  EQU   X'01'          OBR TCAM 3270 SW; ON IF CC/TT    @OZ29866 07455007
*                             VALID                            @OZ29866 07460007
ODEVCOM  EQU   X'40'          OBR DEVICE CLASS = COMMUNICATONS @OZ29866 07465007
ODEVUNT2 EQU   X'90'          OBR UNIT TYPE = SYNC ADAPT TYP 2 @OZ29866 07470007
ODEVNOT2 EQU   X'60'          OBR UNIT TYPE=NOT SYNC ADAP 2    @OZ29866 07475007
ODEVMOD3 EQU   X'07'          OBR MODEL BITS = BISYNCH 3       @OZ29866 07480007
ODEVNOT3 EQU   X'08'          OBR MODEL BITS = NOT BISYNCH 3   @OZ29866 07485007
BTAMSYN  EQU   X'32'          OBR BTAM CONTROL CHARACTER: SYN  @OZ29866 07490007
         EJECT                                                          07500007
BNGLOGER CSECT                                                          07550007
*                                                                       07600007
         STM   R14,R12,12(R13)         SAVE REGISTERS.                  07650007
         LR    R12,R15                 LOAD FIRST BASE REG.             07700007
         USING BNGLOGER,BASEREG,BASERG2  NOTIFY ASM OF BASE REGS.       07750007
*                                                                       07800007
BNGLOGR2 BNGHJN SKIPID                                         @OZ29853 07820007
         LA    BASERG2,BNGLOGER+4095     INITIALIZE                     07850007
         LA    BASERG2,1(BASERG2)      SECOND BASE REGISTER.            07900007
***                                                                     07950007
         GETMAIN   R,LV=96,SP=0        GET STORAGE FOR SAVE AREA.       08000007
***                                                                     08050007
         ST    SAVEREG,4(R1)           PERFORM SAVE AREA CHAINING.      08100007
         ST    R1,8(SAVEREG)           POINT LSA TO HSA.                08150007
         LR    SAVEREG,R1              R13 NOW POINTS TO NEW SAVE.      08200007
         USING SAVE,SAVEREG            EST. ADDRESSABILITY.             08250007
***                                                                     08300007
         GETMAIN   R,LV=4096,SP=241    GET BUFFER AREA STORAGE.         08350007
***                                                                     08400007
         LR    BUFFREG,R1              POINT BUFFREG TO BUFF AREA.      08450007
         USING BUFFER,BUFFREG      SET UP BUFFER ADDRESSABILITY         08500007
         SPACE 2                                                        08550007
*  INITIALIZATION OF BUFFER CONTROL AREA                                08600007
         SPACE 2                                                        08650007
         MVI   BUFFLAG1,ZERO       CLEAR FLAG1                          08700007
         MVI   BUFFLAG2,ZERO       CLEAR FLAG2                          08750007
         SPACE 2                                                        08800007
*                                                                       08850007
*****              LOCATE IFBDCB CSECT IN NUCLEUS AND INITIALIZE  ****  08900007
*****              CONSTANTS IN THE DEMF AREA.                    ****  08950007
*                                                                       09000007
         L     CVTREG,CVTPTR       FIND CVT                             09050007
         USING CVTMAP,CVTREG       ESTABLISH CVT ADDRESSABILITY         09100007
         L     IFBREG,CVTDCB       GET POINTER TO LOGREC DCB            09150007
         DROP  CVTREG                                                   09200007
         LA    CVTREG,DCBDISP      DISP OF LOGREC DCB IN IFBDCB00       09250007
         SR    IFBREG,CVTREG       POINT TO START OF MODULE             09300007
         USING IFBDCB,IFBREG           ESTABLISH DSECT ADDRESSABILITY   09350007
         SPACE 1                                                        09400007
         STM   IFBREG,BASEREG,ESTAEP    SAVE REGS A,B,C                 09450007
         ST    BASERG2,ESTAEP+TWEL      SAVE REG 6                      09500007
         ESTAE STAERTN,CT,PARAM=ESTAEP,XCTL=NO,PURGE=QUIESCE,ASYNCH=YESX09550007
               ,TERM=YES                                                09600007
         SPACE 1                                                        09650007
         MODESET KEY=ZERO          PROTECT KEY ZERO                     09700007
         TS    IFBFLGS1            IS DEMF ALREADY ACTIVE?(TEST HI BIT) 09750007
         BC    4,REJECT                YES, CAN'T HAVE ANOTHER          09800007
         SPACE 1                                                        09850007
         ST    BUFFREG,IFBBUFP         ST BUFF AREA PTR IN COMM AREA    09900007
         MVC   BUFBYTES(L'BUFFTBL),BUFFTBL  BUSY BYTES TO COMM AREA     09950007
         SPACE 1                                                        10000007
         LA    R7,PRESIZE          INIT PREFIX SIZE                     10050007
         STH   R7,BUFPRESZ         STORE IN BUFFER CONTROL              10100007
         LA    R7,BUFECB               POINT TO DEMF TASK ECB.          10150007
         ST    R7,ECBPTR               INIT. ECB LIST.                  10200007
         SPACE 1                                                        10250007
         USING PSA,0                                                    10300007
         MVC   IFBASCBP,PSAAOLD    MOVE ASCB PTR INTO DCB EXTENSION     10350007
         MODESET KEY=NZERO         PROTECTION KEY TCB                   10400007
         SPACE 2                                                        10450007
***                                                                     10500007
         OPEN  (LOGDCB,UPDAT)          OPEN DEMF DATA SET               10550007
***                                                                     10600007
         TM    LOGDCB+DCBOFLGS,OPENBIT DCB OPENED O.K.?                 10650007
         BZ    ERROPEN                 BR IF NO TO ERROR RTN.           10700007
***                                                                     10750007
         WTOR  'BNG900A DEMF ACTIVE. REPLY ''END DEMF'' TO TERMINATE.',X10800007
               REPLY,8,STOPECB,ROUTCDE=(1)                              10850007
***                                                                     10900007
WAITLOG  EQU   *                                                        10950007
         XC    BUFECB(4),BUFECB        CLEAR ECB FOR WAIT.              11000007
*   RESET ALL WTO ERROR FLAGS                                           11050007
         NI    BUFFLAG1,FOXS-(BUFBIGRC+BUFBIGRW+BUFBFULL+BUFBFULW)      11100007
WAIT2    EQU   *                                                        11150007
***                                                                     11200007
         WAIT  ECBLIST=ECBPTR          WAIT FOR SVC 76 POST.            11250007
***                                                                     11300007
         TM    STOPECB,X'40'       DID OPER REQUEST END?                11350007
         BO    CHEKSTOP            BR IF YES TO TEST REPLY.             11400007
*********************************************************************** 11450007
*                                                                     * 11500007
*              THE FOLLOWING CODE FINDS THE BUFFERS FILLED BY SVC     * 11550007
*              76 AND BRANCHES TO THE BDAM WRITE ROUTINE PUT          * 11600007
*              THE RECORD IN ITS 'BUCKET'.  AFTER THIS, THE BUFFER    * 11650007
*              TABLE IS SEARCHED AGAIN, IN CASE ANOTHER BUFFER WAS    * 11700007
*              FILLED DURING THE TIME WE WERE EXECUTING .  A NO-HIT   * 11750007
*              TABLE SEARCH RESULTS IN A WAIT FOR ANOTHER POST.       * 11800007
*                                                                     * 11850007
*********************************************************************** 11900007
*                                                                       11950007
FINDBUF  EQU   *                                                        12000007
         SR    R1,R1                   ZERO REGISTERS FOR               12050007
         SR    R2,R2                   TRT INSTRUCTION.                 12100007
***                                                                     12150007
         LA    R3,BUFBYTES             POINT TO BUSY BYTES              12200007
         TRT   ZERO(BUFFS,R3),CTRLTBL     SEARCH FOR ACTIVE BUFFER.     12250007
***                                                                     12300007
         BC    8,WAITLOG               NO ACTIVE ENTRIES, GO WAIT.      12350007
         BC    4,BUFOUND               BR IF BUFFER FOUND.              12400007
         MVI   EOTIND,X'FF'            INDICATE BUFFER FOUND IS LAST.   12450007
BUFOUND  EQU   *                                                        12500007
         SPACE 2                                                        12550007
*  MESSAGE HANDLER                                                      12600007
         SPACE 2                                                        12650007
         ST    R1,CURRBUF          SAVE CURRENT BUFFER PTR              12700007
         TM    BUFFLAG1,BUFNOLOG+BUFBIGRC+BUFBFULL ANY ON?              12750007
         BZ    NOMSG                                                    12800007
         SPACE 2                                                        12850007
         TM    BUFFLAG1,BUFNOLOG+BUFNOLGW   LOGREC RECORDING            12900007
         BC    9,SKIP1             SKIP IF BOTH OR NEITHER BIT ON       12950007
         WTO   'BNG907I SYS1.LOGREC RECORDING OF DEMF RECORDS INHIBITEDX13000007
               .',ROUTCDE=(2)                                           13050007
         OI    BUFFLAG1,BUFNOLGW   INHIBIT WTO SECOND TIME              13100007
SKIP1    EQU   *                                                        13150007
         TM    BUFFLAG1,BUFBIGRC+BUFBIGRW    RECORD TOO BIG             13200007
         BC    9,SKIP2             SKIP IF BOTH OR NEITHER BIT ON       13250007
         WTO   'BNG908I SYS1.LOGREC RECORD(S) TOO BIG FOR DEMF BUFFER. X13300007
               RECORD(S) LOST.',ROUTCDE=(2)                             13350007
         OI    BUFFLAG1,BUFBIGRW   INHIBIT WTO SECOND TIME              13400007
SKIP2    EQU   *                                                        13450007
         TM    BUFFLAG1,BUFBFULL+BUFBFULW    BUFFERS FULL               13500007
         BC    9,NOMSG             SKIP IF BOTH OR NEITHER BIT ON       13550007
         WTO   'BNG909I DEMF BUFFERS FULL. RECORD(S) LOST.',ROUTCDE=(2) 13600007
         OI    BUFFLAG1,BUFBFULW   INHIBIT WTO SECOND TIME              13650007
NOMSG    EQU   *                                                        13700007
         SPACE 2                                                        13750007
*  TEST FOR ACCEPTABLE INPUT RECORD TYPES                               13800007
         SPACE 2                                                        13850007
         L     R1,CURRBUF          POINT TO BUFFER BYTE TABLE HIT       13900007
         LR    DATAREG,R2              LOAD BUFF DISP IN MULTIPLIER.    13950007
         MH    DATAREG,BUFSIZE         REG2 INDEX CONTAINS BUFF NO.     14000007
         SH    DATAREG,BUFSIZE         DECREMENT TO CONV TO DISP.       14050007
         AR    DATAREG,BUFFREG         REG8 NOW POINTS TO ACTIVE BUFF.  14100007
         USING BTCAM,DATAREG       DSECT ADDRESSABILITY                 14150007
         CLI   BTTYPE,MDR          MDR RECORD TYPE?                     14200007
         BNE   OBR1                NO, TEST FOR OBR                     14250007
         SPACE 2                                                        14300007
* HERE FOR MDR TYPE                                                     14350007
         CLI   MDRSWTCH,M3270EP    3270 EP MODE?                        14400007
         BE    RECOK               YES, PROCESS IT                      14450007
         B     COMPL               NO, TERMINATE PROCESSING THIS RECORD 14500007
         SPACE 2                                                        14550007
OBR1     EQU   *                                                        14600007
         TM    BTSWTCH,OBRNA1      ANY UNWANTED OBR TYPES?              14650007
         BC    5,COMPL             YES, TERMINATE PROCESSING THIS       14700007
         SPACE 2                                                        14750007
*  HERE OBR RECORDS                                                     14800007
         SPACE 2                                                        14850007
* COMMON BTAM-TCAM PROCESSING                                           14900007
         LA    R7,DDIDISP+PRESIZE(DATAREG)  POINT TO DEV DEP   @OZ29866 14950007
*                                           INFORMATION        @OZ29866 14960007
         SR    R9,R9               CLEAR WORK REG                       15000007
         IC    R9,BTDDDWD          DEV DEP DATA LENGTH (IN DWORDS)      15050007
         SLL   R9,3                MULT BY 8 TO GET BYTES               15100007
         LA    R7,0(R7,R9)         ADDR PAST DEV DEP DATA               15150007
         SR    R9,R9               CLEAR WORK REG                       15200007
         IC    R9,BTSDRCT          GET STAT BYTE COUNT                  15250007
         LA    R7,0(R7,R9)         ADDR OF SENSE BYTES                  15300007
         MVC   BTPOLL,BTCCTT       MOVE POLLING CHARS IN OBR   @OZ29866 15350007
         SPACE 2                                                        15400007
* OBR-BTAM PROCESSING FOR COMMON DISPLAY FORMAT                         15450007
         CLI   BTTYPE,OBRBT        OBR-BTAM RECORD TYPE?                15500007
         BNE   OBR2                NO, TEST FOR OBR-TCAM                15550007
         MVC   BTSENSE1,ZERO(R7)   MOVE TO SENSE 1 FROM CALC. ADDR.     15600007
         MVC   BTBTOP,ONE(R7)      MOVE BTAM OP CODE                    15650007
         MVI   BTSENSE2,ZERO       CLEAR SENSE BYTE 2                   15700007
         SPACE 2                                               @OZ29866 15701007
*    TEST DEVICE TYPE FIELD IN OBR FOR BISYNCH 3 DEVICES.      @OZ29866 15702007
*    IF ALL TESTS OK, THEN CHECK CC IN BTCCTT (BTPOLL)         @OZ29866 15703007
         SPACE 1                                               @OZ29866 15704007
         CLI   BTDEVTP2,ODEVCOM    OBR DEV TYPE=COMMUNICATONS? @OZ29866 15705007
         BNE   OBR12               NO, SET F'S                 @OZ29866 15706007
         TM    BTDEVTP3,ODEVUNT2   OBR UNIT TYPE=SYNC ADAPT 2? @OZ29866 15707007
         BNO   OBR12               NO, SET F'S                 @OZ29866 15708007
         TM    BTDEVTP3,ODEVNOT2   OBR UNIT OTHER THAN SYN 2?  @OZ29866 15709007
         BNZ   OBR12               YES, SET F'S                @OZ29866 15710007
         TM    BTDEVTP0,ODEVMOD3   OBR MODEL BITS = BISYNCH 3? @OZ29866 15711007
         BNO   OBR12               NO, SET F'S                 @OZ29866 15712007
         TM    BTDEVTP0,ODEVNOT3   OBR MODEL BITS OTHER THAN   @OZ29866 15713007
*                                  BSC 3 ?                     @OZ29866 15714007
         BNZ   OBR12               YES, SET F'S                @OZ29866 15715007
         SPACE 2                                               @OZ29866 15716007
*    HERE IF DEVICE IS BISYNCH 3, NOW CHECK FOR VALID CC       @OZ29866 15717007
         SPACE 1                                               @OZ29866 15718007
         CLC   BTPOLL(ONE),BTPOLL+ONE    ARE BYTES EQUAL?      @OZ29866 15719007
         BNE   OBR12               NO, SO INVALID CC, SET FF'S @OZ29866 15720007
         CLI   BTPOLL,BTAMSYN      BTAM CONTROL CHAR? (SYN)    @OZ29866 15721007
         BE    OBR12               YES, SET FF'S               @OZ29866 15722007
         CLI   BTPOLL,ZERO         IS CU POLL CHAR ZERO?       @OZ29866 15723007
         BE    OBR12               YES, CONTROL UNIT IS VALID  @OZ29866 15724007
*    HERE IS VALID CC, JUST SET TERM FF                        @OZ29866 15725007
         MVI   BTPOLL+ONE,FOXS     INSERT FF TERM POLL CHAR    @OZ29866 15726007
         B     RECOK               PROCESS IT                           15750007
OBR12    EQU   *                                               @OZ29866 15760007
         MVC   BTPOLL,HEXFF        INSERT F'S INTO OBR         @OZ29866 15770007
         B     RECOK               PROCESS IT                  @OZ29866 15780007
         SPACE 2                                                        15800007
* OBR-TCAM PROCESSING FOR COMMON DISPLAY FORMAT                         15850007
*                                                                       15900007
OBR2     EQU   *                                                        15950007
         CLI   BTTYPE,OBRTC        OBR TCAM RECORD TYPE?                16000007
         BNE   COMPL               NO, TERMINATE PROCESSING THIS RECORD 16050007
         TM    BTFLAG,OBRNA2       UNWANTED RECORD TYPES?               16100007
         BC    5,COMPL             YES,TERM PROCESSING THIS RECORD      16150007
         MVC   BTSENSE1,ONE(R7)    MOVE SECOND SENSE TO FIRST           16200007
         MVI   BTSENSE2,ZERO       CLEAR SECOND SENSE BYTE              16250007
         MVC   BTCCW,BTTCOP        MOVE TCAM OP CODE INTO CCW 6TH BYTE  16300007
         TM    BTSWTCH,OBRCCTT     ARE CU/TERM POLL CHARS VALID@OZ29866 16310007
         BO    RECOK               YES, CONTINUE               @OZ29866 16320007
         MVC   BTPOLL,HEXFF        INSERT F'S INTO OBR         @OZ29866 16330007
         SPACE 2                                                        16350007
RECOK    EQU   *                                                        16400007
         ST    R1,CURRBUF              SAVE CURRENT BUFFER DISP IN TBL. 16450007
         BAL   LINKREG,EMFWRT          GO WRITE RECORD IN DEMF DATASET. 16500007
         L     R1,CURRBUF              POINT TO LAST TBL BYTE HIT.      16550007
         SPACE 2                                                        16600007
COMPL    EQU   *                                                        16650007
         NI    0(R1),X'7F'             RESET BUFFER ACTIVE INDICATOR.   16700007
         TM    EOTIND,X'FF'            WAS LAST HIT ON END OF TABLE?    16750007
         BZ    FINDBUF                 BR IF NO TO SCAN TBL AGAIN.      16800007
         MVI   EOTIND,X'00'            IF YES RESET LAST BYTE IND.      16850007
         B     WAITLOG                 AND GO TO WAIT FOR NEXT POST.    16900007
CHEKSTOP EQU   *                                                        16950007
         OC    REPLY(ENDSIZE),CAPS     FOLD REPLY TO CAPITALS           17000007
         CLC   REPLY(ENDSIZE),ENDDEMF  DID OPER REPLY CORRECTLY?        17050007
         BE    RETURN                  IF YES BR TO GO AWAY.            17100007
         XC    REPLY(ENDSIZE),REPLY    NO, INIT FOR REISSUE OF WTOR.    17150007
         XC    STOPECB(4),STOPECB      CLEAR ECB FOR WAIT.              17200007
         WTOR  'BNG901A INVALID REPLY. TO TERMINATE DEMF, ENTER ''END DX17250007
               EMF''.',REPLY,8,STOPECB,ROUTCDE=(1)                      17300007
         B     WAIT2               GO WAIT FOR SVC 76 OR END.           17350007
REJECT   DS    0H                                                       17400007
         WTO   'BNG902I DEMF ALREADY ACTIVE. REQUEST IGNORED.',        X17450007
               ROUTCDE=(2)                                              17500007
         B     RETURN1                                                  17550007
RETURN   EQU   *                                                        17600007
         ENQ   (BNGADR,BUFFRADR,E,6,SYSTEMS),RET=NONE  ENQ ON BUFFER    17650007
         MODESET KEY=ZERO          PROTECTION KEY ZERO                  17700007
         NI    IFBFLGS1,X'7F'   INDICATE DEMF NO LONGER ACTIVE.         17750007
         MODESET KEY=NZERO         PROTECTION KEY TCB                   17800007
         DEQ   (BNGADR,BUFFRADR,6,SYSTEMS),RET=HAVE  DEQ ON BUFFER      17850007
         TM    LOGDCB+DCBOFLGS,OPENBIT  OPEN FAILURE?          @OZ29853 17860007
         BZ    RETURN2                  YES, GO TO RETURN2     @OZ29853 17870007
         TM    STAEFLAG,STAEON     STAE EXIT ENTERED?                   17900007
         BO    STAE1               YES, PRINT ABNORM MSG                17950007
         WTO   'BNG903I DEMF BEING TERMINATED.',ROUTCDE=(2)             18000007
         B     STAE2               SKIP ABNORM MSG                      18050007
STAE1    EQU   *                                                        18100007
         WTO   'BNG910I DEMF BEING ABNORMALLY TERMINATED.',ROUTCDE=(2)  18150007
STAE2    EQU   *                                                        18200007
         CLOSE (LOGDCB)                                                 18250007
RETURN1  EQU   *                                                        18300007
         MODESET KEY=NZERO         PROTECTION KEY TCB                   18350007
RETURN2  EQU   *                                               @OZ29853 18370007
         TM    STAEFLAG,STAEON     STAE EXIT ENTERED?                   18400007
         BO    STAE3               YES, SKIP STAE CANCEL                18450007
         STAE  0                                                        18500007
STAE3    EQU   *                                                        18550007
         FREEMAIN R,LV=4096,SP=241,A=(BUFFREG)                          18600007
         TM    STAEFLAG,STAEON          STAE EXIT ENTERED?              18650007
         BO    STAE4                    YES, TERMINATE                  18700007
         L     SAVEREG,HSAPTR      RELOAD REG 13.                       18750007
         L     R1,EIGHT(SAVEREG)   LOAD ADDR OF SAVE AREA               18800007
         FREEMAIN R,LV=96,SP=0,A=(R1)                                   18850007
         LM    R14,R12,REGSAVE     RESTORE REGISTERS.                   18900007
STAE4    EQU   *                                                        18950007
         SR    R15,R15             INDICATE ZERO RETURN CODE.           19000007
         BR    R14                 RETURN TO SYSTEM.                    19050007
         SPACE 5                                                        19100007
STAERTN  EQU   *                   STAE EXIT ROUTINE                    19150007
         USING STAERTN,R15         ESTABLISH TEMP ADDR.                 19200007
         C     R0,STAETEST         TEST FOR SDWA CORE                   19250007
         BE    NOSDWA              NO SDWA, USE REG 1                   19300007
         L     R2,ZERO(R1)         PTR TO PARMS                         19350007
NOSDWA   EQU   *                                                        19400007
         LM    IFBREG,BASEREG,ZERO(R2) RESTORE REGS A,B,C               19450007
         L     BASERG2,TWEL(R2)    RESTOR REG 6                         19500007
         DROP  R15                 DROP TEMP ADDR.                      19550007
         USING BNGLOGER,BASEREG,BASERG2  RESTORE ORIG ADDR              19600007
         OI    STAEFLAG,STAEON     SET STAE ERROR FLAG                  19650007
         B     RETURN              GO TO NORMAL TERMINATION             19700007
         SPACE 5                                                        19750007
ERROPEN  EQU   *                                                        19800007
***                                                                     19850007
         WTO   'BNG904I ERROR OPENING SYS1.DEMFLOG DATA SET. DEMF NOT AX19900007
               CTIVATED.',ROUTCDE=(2)                                   19950007
***                                                                     20000007
         B     RETURN                                          @OZ29853 20050007
***                                                                     20100007
         EJECT                                                          20150007
* THIS ROUTINE WILL WRITE TO DISK A VARIABLE LTH MDR OR OBR RECORD.     20200007
*                                                                       20250007
         USING EMFSLOT,SLOTREG     SETUP TO PROCESS A SLOT IN CTRL REC. 20300007
EMFWRT   STM   0,15,EMFSAVE                                             20350007
         TM    7(DATAREG),X'30'    IF THIS IS ANY OBR RECORD            20400007
         BNO   EMFLOG4             FOR A                                20450007
         CLI   61(DATAREG),X'10'   GRAPHICS DEVICE, ALTER THE           20500007
         BNE   EMFLOG4             UNIT ADDR SO ALL 3277'S FALL         20550007
         NI    3(DATAREG),B'11100000'   INTO COMMON CTRL UNIT BUCKET.   20600007
EMFLOG4  DS    0H                                                       20650007
         XC    EMFREL,EMFREL       SET RELATIVE BLK ADDR TO ZERO.       20700007
EMFLOG5  READ  ECBA3,DI,LOGDCB,EMFCTRL,4096,0,EMFREL  READ ZERO BLK.    20750007
         CHECK ECBA3                                                    20800007
         LA    SLOTREG,EMFSLOT1    POINT TO 1ST ENTRY IN CTRL BLK.      20850007
         SR    BCTREG,BCTREG       SETUP TO LOOP ON NBR                 20900007
         IC    BCTREG,EMFENTS      OF ENTRIES.                          20950007
         LTR   BCTREG,BCTREG                                            21000007
         BZ    EMFLOG15            MUST BE 1ST ERROR OF THE DAY.        21050007
EMFLOG10 CLC   EMFPORT,1(DATAREG)  IS THIS ENTRY EQUAL OUR ITEM TO LOG? 21100007
         BE    EMFLOG40            YES. GO READ DATA BLOCK.             21150007
         LA    SLOTREG,SLOTLTH(SLOTREG)     NO. LOOP TO NEXT SLOT.      21200007
         BCT   BCTREG,EMFLOG10                                          21250007
         OC    EMFNEXT,EMFNEXT     NOT IN THIS BLK.  ANOTHER BLK EXIST? 21300007
         BZ    EMFLOG15            NO.  CREATE A CONTROL ENTRY.         21350007
         MVC   EMFREL,EMFNEXT+1    YES. SETUP TO READ THAT              21400007
         B     EMFLOG5               CHAIN RECORD.                      21450007
EMFLOG15 BAL   LINKREG,EMFGETAD    GET A NEW BLOCK ADDRESS.             21500007
         STCM  0,7,EMFBLK          STORE AS DATA BLK ADDRESS.           21550007
         LA    0,DATAREA1          ZERO OUT THE DATA AREA.              21600007
         LH    1,H4096                                                  21650007
         LA    14,*                                                     21700007
         SR    15,15                                                    21750007
         MVCL  0,14                                                     21800007
         MVC   DATPORT,1(DATAREG)  INITIALIZE HEADER                    21850007
         TIME  DEC                                                      21900007
         STCM  0,15,DATTIME        PORTION OF THE                       21950007
         STCM  1,15,DATDATE        DATA RECORD.                         22000007
         LA    0,DATSLOT1                                               22050007
         SR    1,1                                                      22100007
         IC    1,0(DATAREG)        MOVE THE DATA TO BE LOGGED           22150007
         LR    14,DATAREG          INTO THE FIRST SLOT.                 22200007
         LR    15,1                                                     22250007
         MVCL  0,14                                                     22300007
         MVC   DATLTH+1(1),DATSLOT1  SET TOTAL LTH = THIS DATA.         22350007
         WRITE ECBB7,DI,LOGDCB,DATAREA1,4096,0,EMFBLK  WRITE DATA BLK.  22400007
         CHECK ECBB7                                                    22450007
         OC    EMFREL,EMFREL       IS CTRL RECORD ZERO IN CORE?         22500007
         BZ    EMFLOG20            YES.  CONTINUE.                      22550007
         XC    EMFREL,EMFREL       NO.  RE-READ IT.                     22600007
         READ  ECBB15,DI,LOGDCB,EMFCTRL,4096,0,EMFREL                   22650007
         CHECK ECBB15                                                   22700007
EMFLOG20 DS    0H                                                       22750007
         CLI   EMFENTS,254         IS CTRL BLOCK FULL?                  22800007
         BE    EMFLOG30            YES. GO CREATE OVERFLOW.             22850007
         LA    SLOTREG,EMFSLOT1    NO. LOCATE NEXT                      22900007
         SR    BCTREG,BCTREG       AVAILABLE                            22950007
         IC    BCTREG,EMFENTS      SLOT.                                23000007
         LTR   BCTREG,BCTREG                                            23050007
         BZ    EMFLOG26            MUST BE 1ST ERROR OF THE DAY.        23100007
EMFLOG25 LA    SLOTREG,SLOTLTH(SLOTREG)                                 23150007
         BCT   BCTREG,EMFLOG25                                          23200007
         IC    BCTREG,EMFENTS      ADD 1 TO NBR                         23250007
EMFLOG26 LA    BCTREG,1(BCTREG)    OF ENTRIES IN                        23300007
         STC   BCTREG,EMFENTS      THIS BLOCK.                          23350007
EMFLOG27 MVC   EMFPORT,1(DATAREG)  FILL IN THE PORT ADDRESS,            23400007
         MVC   EMFBLKS,H1       SET TOTAL BLOCKS = 1,                   23450007
         MVC   EMFHITS,H1       TOTAL HITS = 1,                         23500007
         MVC   EMFSTART,EMFBLK     AND THE DATA BLK ADDR AS             23550007
         MVC   EMFEND,EMFBLK       1ST AND LAST IN THE CHAIN.           23600007
         WRITE ECBB23,DI,LOGDCB,EMFCTRL,4096,0,EMFREL  REWRITE CTRL BLK 23650007
         CHECK ECBB23                                                   23700007
         LM    0,15,EMFSAVE                                             23750007
         BR    LINKREG                                                  23800007
EMFLOG30 BAL   LINKREG,EMFGETAD    GET A NEW BLK ADDR FOR NEW CTRL BLK. 23850007
         STCM  0,7,EMFREL          STORE THE NEW ADDRESS.               23900007
         WRITE ECBC3,DI,LOGDCB,EMFCTRL,4096,0,EMFREL  WRITE OLD CTRL    23950007
         CHECK ECBC3                                                    24000007
         MVC   EMFNEXT+1(3),EMFREL    PROMOTE THE BACK CHAIN FIELD.     24050007
         XC    EMFREL,EMFREL       RESET ADDR TO ZERO CTRL RECORD.      24100007
         OC    EMFFIRST,EMFFIRST   IF THIS WAS THE 1ST TIME             24150007
         BNZ   EMFLOG35            TO CREATE AN OVERFLOW, ALSO          24200007
         MVC   EMFFIRST,EMFNEXT    PROMOTE 1ST ADDR IN CHAIN.           24250007
EMFLOG35 MVI   EMFENTS,X'00'                                            24300007
         LA    0,EMFSLOT1          ZERO OUT THE COUNT AND DATA          24350007
         LA    1,EMFBLOCK-EMFSLOT1                                      24400007
         LA    14,*                                                     24450007
         LA    15,0                                                     24500007
         MVCL  0,14                                                     24550007
         LA    SLOTREG,EMFSLOT1    POINT TO 1ST SLOT,                   24600007
         MVI   EMFENTS,1           SET NBR ENTRIES = 1,                 24650007
         B     EMFLOG27            AND GO MAKE CTRL ENTRY.              24700007
EMFLOG40 MVC   EMFBLK,EMFEND       MOVE ADDR OF NEWEST BLK IN CHAIN.    24750007
         READ  ECBD2,DI,LOGDCB,DATAREA1,4096,0,EMFBLK  READ DATA BLK.   24800007
         CHECK ECBD2                                                    24850007
         LH    1,DATLTH            IS THERE ENOUGH ROOM                 24900007
         SR    0,0                 LEFT IN THIS BLOCK                   24950007
         IC    0,0(DATAREG)        FOR THIS DATA ITEM?                  25000007
         AR    1,0                                                      25050007
         C     1,=A(DATEND-DATSLOT1)                                    25100007
         BH    EMFLOG50            NO. GO BUILD DATA BLK CHAIN.         25150007
EMFLOG45 LA    0,DATSLOT1          YES.                                 25200007
         AH    0,DATLTH            POINT TO NEXT AVAILABLE POSITION.    25250007
         SR    1,1                                                      25300007
         IC    1,0(DATAREG)                                             25350007
         LH    15,DATLTH                                                25400007
         AR    15,1                                                     25450007
         STH   15,DATLTH                                                25500007
         LR    14,DATAREG                                               25550007
         LR    15,1                                                     25600007
         MVCL  0,14                MOVE IN THE ITEM TO BE LOGGED.       25650007
         WRITE ECBD17,DI,LOGDCB,DATAREA1,4096,0,EMFBLK  REWRITE DATA.   25700007
         CHECK ECBD17                                                   25750007
         LH    1,EMFHITS                                                25800007
         LA    1,1(1)              ADD 1 TO NBR HITS ON THIS LINE.      25850007
         STH   1,EMFHITS                                                25900007
         WRITE ECBD22,DI,LOGDCB,EMFCTRL,4096,0,EMFREL  REWRITE CTRL BLK 25950007
         CHECK ECBD22                                                   26000007
         LM    0,15,EMFSAVE                                             26050007
         BR    LINKREG                                                  26100007
EMFLOG50 BAL   LINKREG,EMFGETAD    GET A NEW BLOCK ADDRESS.             26150007
         STCM  0,7,EMFNEW          SAVE IT.                             26200007
         STCM  0,7,DATFWD          MAKE IT NEW FORWARD ADDRESS.         26250007
         WRITE ECBE4,DI,LOGDCB,DATAREA1,4096,0,EMFBLK  UPDATE OLD BLK.  26300007
         CHECK ECBE4                                                    26350007
         XC    DATFWD,DATFWD       FIX UP NEW BLOCK WITH NO FORWARD     26400007
         MVC   DATBACK,EMFBLK      CHAIN, BACK CHAIN POINTS TO OLD FULL 26450007
         MVC   EMFBLK,EMFNEW       BLOCK, AND SETUP TO USE NEW ADDRESS. 26500007
         MVC   EMFEND,EMFNEW       MAKE CTRL BLK POINT TO NEW BLOCK.    26550007
         LH    1,EMFBLKS           ADD 1 TO NBR BLKS IN CHAIN.          26600007
         LA    1,1(1)                                                   26650007
         STH   1,EMFBLKS                                                26700007
         XC    DATLTH,DATLTH                                            26750007
         LA    0,DATSLOT1                                               26800007
         LA    1,DATEND-DATSLOT1                                        26850007
         LA    14,*                                                     26900007
         SR    15,15                                                    26950007
         MVCL  0,14                ZERO OUT THE DATA RECORD.            27000007
         B     EMFLOG45            GO MAKE ENTRY IN NEW BLOCK.          27050007
*  THIS SUBROUTINE WILL ACQUIRE AND RETURN IN REGISTER 0 A USABLE       27100007
*  DISK ADDRESS, EVEN IF IT HAS TO TAKE THE OLDEST BLOCK OUT OF THE     27150007
*  LONGEST CHAIN AND RE-USE IT.                                         27200007
EMFGETAD DS    0H                                                       27250007
         MVC   SAVECTL,EMFREL      SAVE ADDR OF THIS CTRL BLK.          27300007
         ST    SLOTREG,SAVESLOT    SAVE ITS POSITION IN THE BLK.        27350007
         MVC   SAVEBLK,EMFBLK                                           27400007
         OC    EMFREL,EMFREL       IS CTRL BLK ZERO IN CORE?            27450007
         BZ    EMFGET10            YES.                                 27500007
         XC    EMFREL,EMFREL       NO.  RESET REL BLK ADDR AND READ IT. 27550007
         READ  ECBG3,DI,LOGDCB,EMFCTRL,4096,0,EMFREL                    27600007
         CHECK ECBG3                                                    27650007
EMFGET10 L     1,EMFLAST           IS THE LAST USED ADDRESS             27700007
         LA    1,1(1)              EQUAL TO THE TOTAL NUMBER            27750007
         C     1,EMFTOTAL          OF BLKS ALLOCATED TO THE FILE?       27800007
         BE    EMFGET30            YES. GO PURGE AN OLD BLOCK.          27850007
         ST    1,EMFLAST           NO. ASSIGN A NEW NUMBER.             27900007
         SRL   1,2                 COMPUTE LAST-USED PLUS 25%           27950007
         A     1,EMFLAST                                                28000007
         C     1,EMFTOTAL          IF RESULT IS LESS THAN TOTAL NBR     28050007
         BL    EMFGET15            RECORDS, FILE ISN'T 80% FULL YET.    28100007
         TM    BUFFLAG2,BUF80P     WAS 80 PCT WTO WRITTEN ONCE?         28150007
         BNZ   EMFGET15            ONLY WRITE 80% MSG TO OPER ONCE.     28200007
         WTO   'BNG905I DEMF DATA SET IS 80 PERCENT FULL.',ROUTCDE=(2)  28250007
         OI    BUFFLAG2,BUF80P     SET 80-PCT-WTO FLAG                  28300007
EMFGET15 WRITE ECBG17,DI,LOGDCB,EMFCTRL,4096,0,EMFREL  REWRITE CTRL BLK 28350007
         CHECK ECBG17                                                   28400007
         MVC   EMFNEW,EMFLAST+1    RETURN REQUESTED ADDRESS.            28450007
EMFGET20 DS    0H                                                       28500007
         L     SLOTREG,SAVESLOT    RESTORE POINTER TO SLOT BEING USED.  28550007
         CLC   SAVECTL,EMFREL      SAME REC WE CAME IN WITH?            28600007
         BE    EMFGET25                                                 28650007
         MVC   EMFREL,SAVECTL      NO. RESTORE CTRL BLK NBR.            28700007
         READ  ECBG20,DI,LOGDCB,EMFCTRL,4096,0,EMFREL  REFRESH CTRL BLK 28750007
         CHECK ECBG20                                                   28800007
EMFGET25 DS    0H                                                       28850007
         CLC   SAVEBLK,EMFBLK      IS DATA BLK SAME ONE WE CAME IN WITH 28900007
         BE    EMFGET28            YES. GET OUT.                        28950007
         MVC   EMFBLK,SAVEBLK      RESTORE BLOCK ADDRESS.               29000007
         READ  ECBG28,DI,LOGDCB,DATAREA1,4096,0,EMFBLK                  29050007
         CHECK ECBG28                                                   29100007
EMFGET28 DS    0H                                                       29150007
         SR    0,0                                                      29200007
         ICM   0,7,EMFNEW                                               29250007
         BR    LINKREG             RETURN TO CALLER WITH NEW ADDR IN 0. 29300007
EMFGET30 TM    BUFFLAG2,BUF100P    WAS 100 PCT WTO WRITTEN ONCE?        29350007
         BNZ   EMFGET35            YES, SKIP WTO                        29400007
         WTO   'BNG906I DEMF DATA SET IS 100 PERCENT FULL. GOING INTO RX29450007
               E-USE MODE.',ROUTCDE=(2)                                 29500007
         OI    BUFFLAG2,BUF100P    SET 100-PCT-WTO FLAG                 29550007
EMFGET35 LA    SLOTREG,EMFSLOT1    POINT TO 1ST SLOT IN CTRL BLK.       29600007
         SR    BCTREG,BCTREG       SETUP TO LOOP ON NBR                 29650007
         IC    BCTREG,EMFENTS      OF ENTRIES IN BLOCK.                 29700007
         LR    1,SLOTREG           PRIME A WORK REGISTER.               29750007
EMFGET37 CLC   EMFBLKS,(EMFBLKS-EMFPORT)(1)  IS THIS BUCKET LONGER      29800007
         BNH   EMFGET40                          THAN PREVIOUS?         29850007
         LR    1,SLOTREG           YES. SAVE ITS ADDRESS.               29900007
EMFGET40 LA    SLOTREG,SLOTLTH(SLOTREG)                                 29950007
         BCT   BCTREG,EMFGET37     HERE WE HAVE LONGEST/OLDEST BUCKET.  30000007
         LR    SLOTREG,1           POINT TO LONGEST/OLDEST.             30050007
         MVC   EMFBLK,EMFSTART         READ FIRST BLOCK.                30100007
         READ  ECBH13,DI,LOGDCB,DATAREA1,4096,0,EMFBLK                  30150007
         CHECK ECBH13                                                   30200007
         MVC   EMFNEW,EMFSTART     SAVE ADDR BEING FREED UP.            30250007
         MVC   EMFSTART,DATFWD     NOW 2ND BLK BECOMES 1ST BLOCK.       30300007
         LH    0,EMFBLKS                                                30350007
         BCTR  0,0                 REDUCE NBR BLKS THIS CHAIN BY 1.     30400007
         STH   0,EMFBLKS                                                30450007
         WRITE ECBH17,DI,LOGDCB,EMFCTRL,4096,0,EMFREL                   30500007
         CHECK ECBH17                                                   30550007
         MVC   EMFBLK,EMFSTART         READ NEW FIRST BLOCK.            30600007
         READ  ECBH20,DI,LOGDCB,DATAREA1,4096,0,EMFBLK                  30650007
         CHECK ECBH20                                                   30700007
         XC    DATBACK,DATBACK     ZERO BACK-CHAIN OF NEW 1ST BLK.      30750007
         MVC   EMFBLK,EMFSTART         REWRITE NEW FIRST BLOCK.         30800007
         WRITE ECBH24,DI,LOGDCB,DATAREA1,4096,0,EMFBLK                  30850007
         CHECK ECBH24                                                   30900007
         B     EMFGET20                                                 30950007
         EJECT                                                          31000007
********           *****    CONSTANTS AND DEFINED AREAS    *****        31050007
****                                                                    31100007
LOGDCB   DCB   DDNAME=DEMFLOG,DSORG=DA,MACRF=(RIC,WIC),OPTCD=R,RECFM=F  31150007
****                                                                    31200007
CTRLTBL  DC    XL128'00'               DUMMY PORTION OF TABLE.          31250007
         DC    XL40'0102030405060708090A0B0C0D0E0F101112131415161718191X31300007
               A1B1C1D1E1F202122232425262728'                           31350007
         DC    XL88'00'               DUMMY AREA.                       31400007
***                                                                     31450007
BUFFTBL  DC    XL41'000102030405060708090A0B0C0D0E0F1011121314151617181X31500007
               91A1B1C1D1E1F20212223242526277F'                         31550007
BUFFS    EQU   40                  SIZE OF BUFFTBL-1                    31600007
***                                                                     31650007
EOTIND   DC    X'00'                   CURRENT BUFF LAST INDICATOR.     31700007
CURRBUF  DC    F'0'                    PTR TO CURRENT BUFFER BYTE.      31750007
BUFSIZE  DC    H'100'                  BUFFER SIZE VALUE.               31800007
ECBPTR   DC    F'0'                    EMF TASK ECB PTR.                31850007
STOPTR   DC    X'80'               END OF ECB LIST IND.                 31900007
         DC    AL3(STOPECB)        TERMINATION ECB.                     31950007
STOPECB  DC    F'0'                                                     32000007
REPLY    DC    D'0'                                                     32050007
CAPS     DC    X'4040404040404040' TO FOLD REPLY INTO CAPS              32100007
H4096    DC    H'4096'             CONSTANT                             32150007
H1       DC    H'1'                CONSTANT                             32200007
HEXFF    DC    X'FFFF'             DISPLAYS REQUIRE X'FFFF' IN OBR REC  32250007
FOXS     EQU   X'FF'               FOR RESETTING FLAGS                  32300007
ENDDEMF  DC    C'END DEMF'         EXACT REPLY MESSAGE TO TERM DEMF     32350007
BNGADR   DC    C'BNGLOGER'         QNAME FOR ENQ AND DEQ                32400007
BUFFRADR DC    C'BUFFER'           RNAME FOR ENQ AND DEQ                32450007
ESTAEP   DC    4F'0'               ESTAE PARMS (REG SAVE)               32500007
STAETEST DC    F'12'               STAE STORAGE TYPE TEST               32550007
STAEFLAG DC    X'00'               SWITCH SET WHEN ESTAE ENTERED        32600007
STAEON   EQU   X'80'               USED WHEN ESTAE ENTERED              32650007
ENDSIZE  EQU   8                   LENGTH OF 'END DEMF' MESSAGE         32700007
PTCHAREA DC    12F'0'              PATCH AREA                           32750007
         LTORG                                                          32800007
SAVESLOT DS    F                   SAVE POINTER TO SLOT IN USE.         32850007
SAVECTL  DS    CL3                 SAVE CTRL REC ADDRESS.               32900007
SAVEBLK  DS    CL3                 SAVE DATA BLK ADDRESS.               32950007
EMFREL   DS    CL3                 RELATIVE BLK FOR CTRL REC I/O        33000007
EMFBLK   DS    CL3                 REL BLK FOR DATA RECORD I/O          33050007
         DS    0F                                                       33100007
         DC    X'00'                                                    33150007
EMFNEW   DS    CL3                 SAVE AREA FOR NEW RELATIVE BLK ADDR  33200007
EMFSAVE  DS    16F                                                      33250007
         DS    D                                                        33300007
EMFCTRL  DS    0C                  I/O AREA COR CONTROL RECORDS.        33350007
EMFLAST  DS    F                   LAST USED BLOCK ADDRESS.             33400007
EMFTOTAL DS    F                   TOTAL BLOCKS IN DATASET.             33450007
EMFFIRST DS    F                   FIRST CTRL BLK IN CTRL CHAIN.        33500007
EMFNEXT  DS    F                   NEXT (BACKWARD) CTRL BLK IN CHAIN.   33550007
EMFENTS  DS    C                   NBR ENTRIES IN THIS CTRL BLK.        33600007
EMFRSVD  DS    CL15                RESERVED FOR FUTURE USE.             33650007
EMFSLOT1 DS    CL16          1ST OF 254 16-BYTE SLOTS IN CTRL BLK.      33700007
SLOTLTH  EQU   *-EMFSLOT1          LENGTH OF ONE SLOT.                  33750007
         ORG   EMFCTRL+4096        REST OF BLOCK                        33800007
EMFBLOCK EQU   *                   ENF OF CONTROL BLOCK.                33850007
DATAREA1 DS    0C                  AREA TO READ 1ST DATA BLOCK INTO.    33900007
DATPORT  DS    CL6                 PORT AND LIB ADDRESS                 33950007
DATTIME  DS    CL4                 TIME OF ERROR.                       34000007
DATDATE  DS    CL4                 DATE OF ERROR.                       34050007
DATFWD   DS    CL3                 FORWARD CHAIN ADDRESS.               34100007
DATBACK  DS    CL3                 BACKWARD CHAIN ADDRESS.              34150007
DATLTH   DS    CL2                 NBR BYTES USED IN THIS BLOCK.        34200007
         DS    CL10         RESERVED FOR FUTURE USER                    34250007
DATSLOT1 DS    C                   DATA BEGINS HERE.                    34300007
         ORG   DATAREA1+4096                                            34350007
DATEND   EQU   *                   END OF DATA BLOCK                    34400007
         SPACE 2                                                        34450007
********           *****     DSECTS     *****              *****        34500007
         SPACE 2                                                        34550007
IFBDCB   DSECT                                                          34600007
IFBWORK  DS    89F                     ORIG IFBDCB CSECT CODE.          34650007
IFBBUFP  DS    1F                      BUFFER AREA POINTER.             34700007
IFBASCBP DS    1F                      MVS ASCB POINTER                 34750007
         DS    4F                      RESERVED                         34800007
IFBFLGS1 DS    XL1                     DEMF                             34850007
IFBFLGS2 DS    XL1                      STATUS                          34900007
IFBFLGS3 DS    XL1                       FLAGS                          34950007
IFBFLGS4 DS    XL1                                                      35000007
         SPACE 2                                                        35050007
SAVE     DSECT                                                          35100007
SAVERSVD DC    F'0'                    RESERVED                         35150007
HSAPTR   DC    F'0'                    HIGHER SAVE AREA PTR.            35200007
LSAPTR   DC    F'0'                    LOWER SAVE AREA PTR.             35250007
REGSAVE  DC    15F'0'                  SAVE FOR REGS 14-12              35300007
WORKAREA DC    6F'0'                   WORK AREA FOR EMF.               35350007
         SPACE 2                                                        35400007
EMFSLOT  DSECT                     DSECT FOR ONE CONTROL SLOT           35450007
EMFPORT  DS    CL6                 PORT ADDRESS AND/OR LIB NAME.        35500007
EMFBLKS  DS    CL2                 NBR BLKS IN THIS DETAIL CHAIN.       35550007
EMFHITS  DS    CL2                 TOTAL NBR HITS ON THIS LINE.         35600007
EMFSTART DS    CL3                 1ST BLOCK IN THIS CHAIN. (OLDEST)    35650007
EMFEND   DS    CL3                 LAST BLOCK IN THIS CHAIN. (NEWEST)   35700007
         SPACE 2                                                        35750007
BUFFER   DSECT                                                          35800007
         DS    4000C                                                    35850007
BUFECB   DS    1F                  TASK ECB                             35900007
BUFPOSTL DS    3F                  POST LIST (MVS)                      35950007
BUFPRESZ DS    1H                  PREFIX SIZE                          36000007
BUFBYTES DS    41C                 BUSY BYTES                           36050007
BUFFLAG1 DS    XL1                 DEMF BUFFER FLAGS 1                  36100007
*  1... .... (X'80')  BUFNOLOG  DO NOT WRITE TO LOGREC IF ON EMFILE     36150007
*  .1.. .... (X'40')  BUFBIGRC  RECORD TOO BIG FOR BUFFER               36200007
*  ..1. .... (X'20')  BUFBFULL  BUFFERS FULL                            36250007
*                                                                       36300007
*  .... 1... (X'08')  BUFNOLGW    NO LOGREC RECORD IF ON EMFILE         36350007
*  .... .1.. (X'04')  BUFBIGRW    RECORD TOO BIG FOR BUFFER             36400007
*  .... ..1. (X'02')  BUFBFULW    BUFFERS FULL                          36450007
BUFFLAG2 DS    XL1                 DEMF BUFFER FLAGS 2                  36500007
*  .1.. .... (X'40')  BUF80P      SET WHEN 80 PERCENT WTO WRITTEN       36550007
*  ..1. .... (X'20')  BUF100P     SET WHEN 100 PERCENT WTO WRITTEN      36600007
         SPACE 2                                                        36650007
BUFNOLOG EQU   X'80'               NO LOGREC RECORD IF SENT TO EMFILE   36700007
BUFBIGRC EQU   X'40'               RECORD TOO BIG FOR BUFFER            36750007
BUFBFULL EQU   X'20'               BUFFERS FULL                         36800007
BUFNOLGW EQU   X'08'               WTO 'NOLOGREC' MSG                   36850007
BUFBIGRW EQU   X'04'               WTO 'RECORD TOO BIG' MSG             36900007
BUFBFULW EQU   X'02'               WTO 'BUFFERS FULL' MSG               36950007
         SPACE 1                                                        37000007
BUF80P   EQU   X'40'               WTO '80 PERCENT' MSG                 37050007
BUF100P  EQU   X'20'               WTO '100 PERCENT' MSG                37100007
         SPACE 2                                                        37150007
BTCAM    DSECT                                                          37200007
         DS    CL7                 PREFIX                               37250007
BTTYPE   DS    CL1                 MDR:91, OBR-BTAM:30, OBR-TCAM:34     37300007
         DS    CL2                 RESERVED                             37350007
BTSWTCH  DS    CL1                 OBR SWITCHES                         37400007
MDRSWTCH DS    CL1                 MDR SWITCHES                         37450007
         DS    CL32                RESERVED                             37500007
BTCCW    DS    CL1                 CCW BYTE 6 FOR TCAM OP CODE          37550007
         DS    CL10                RESERVED                             37600007
BTDDDWD  DS    CL1                 DEV DEP DATA LENGTH (IN DWORDS)      37650007
         DS    CL1                 RESERVED                    @OZ29866 37700007
BTCCTT   DS    CL2                 CU/TERM POLLING CHARS       @OZ29866 37707007
BTDEVTP0 DS    CL1                 DEVICE TYPE BYTE 0          @OZ29866 37714007
BTDEVTP1 DS    CL1                 DEVICE TYPE BYTE 1          @OZ29866 37721007
BTDEVTP2 DS    CL1                 DEVICE TYPE BYTE 2          @OZ29866 37728007
BTDEVTP3 DS    CL1                 DEVICE TYPE BYTE 3          @OZ29866 37735007
BTSDRCT  DS    CL1                 STAT. BYTE COUNT                     37750007
         DS    CL3                 RESERVED                             37800007
BTPOLL   DS    CL2                 POLL ADDRESS (X'CCTT')      @OZ29866 37850007
         DS    CL2                 RESERVED                             37900007
* START OF DEVICE DEPENDENT DATA                                        37950007
         DS    CL5                 RESERVED                             38000007
BTTCOP   DS    CL1                 TCAM TP OP CODE                      38050007
BTFLAG   DS    CL1                 OBR/SDR FLAG                         38100007
         DS    CL2                 RESERVED                             38150007
BTBTOP   DS    CL1                 BTAM OP CODE                         38200007
BTSENSE1 DS    CL1                 SENSE BYTE 1                         38250007
BTSENSE2 DS    CL1                 SENSE BYTE 2                         38300007
         DS    CL6                 RESERVED                             38350007
         END   BNGLOGER                                                 38400007
./  ADD  SSI=81160219,NAME=BNGTDISP
         PRINT OFF                                                      00050007
         MACRO                                                          00050407
&NAME    BNGHJN &LABEL,&HJN                                             00050807
         LCLC  &HJA,&HJB                                                00051207
&HJA     SETC  '&SYSPARM'(1,4)                                          00051607
&HJB     SETC  '&SYSPARM'(5,4)                                          00052007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00052407
         B     &LABEL .                 BR AROUND CONSTANTS             00052807
         SPACE 2                                                        00053207
.NOBRNCH ANOP                                                           00053607
         AIF   ('&NAME' EQ '').NOLABEL                                  00054007
         DC    C'&NAME' .              MODULE IDENTIFIER                00054407
.NOLABEL ANOP                                                           00054807
         DC    X'&HJA' .                DATE OF MODIFICATION            00055207
         AIF   ('&HJN' NE 'HJN').DATE                                   00055607
         DC    X'&HJB' .                HJN OF MODIFICATION             00056007
.DATE    ANOP                                                           00056407
         AIF   ('&LABEL' EQ '').NOLBL                                   00056807
         SPACE 2                                                        00057207
&LABEL   DS    0H                                                       00057607
.NOLBL   ANOP                                                           00058007
         MEND                                                           00058407
         PRINT ON                                                       00058807
*********************************************************************** 00059207
*                                                                     * 00100000
* MODULE NAME = BNGTDISP                                              * 00150000
*                                                                     * 00200000
* DESCRIPTIVE NAME = TCAM DEMF DISPLAY CONTROL MODULE                 * 00250000
*                                                                     * 00300000
* COPYRIGHT = NONE                                                    * 00350000
*                                                                     * 00400000
* STATUS = RELEASE 1, LEVEL 1                                         * 00450000
*                                                                     * 00500000
* FUNCTION = 1) EDITS THE INPUT INTO 6 PARM FIELDS WITH LEFT JUSTIFY; * 00550000
*            2) DOES SYNTAX CHECK ON DEMF COMMANDS AND PARAMETERS;    * 00600000
*            3) DETERMINES WHETHER THE REQUEST IS FOR MENU,REMOTE,    * 00650000
*               LOCAL OR 3270 SCREEN ERROR DISPLAY AND PASSES CONTROL * 00700000
*               TO BNGTMENU,BNGTRMOT,BNGTLOCL OR BNGT3270 SEGMENT     * 00750000
*               ACCORDINGLY WITH PARAMETERS;                          * 00800000
*            4) HANDLES ALL,LINE AND CTRL ERROR DISPLAY REQUEST AND   * 00850000
*               WRITES ITS ERROR INFORMATION TO THE 3270 DISPLAY      * 00900000
*               TERMINAL AND ISSUES SOME OF THE DISPLAY MESSAGES;     * 00950000
*            5) ACCESSES SYS1.DEMFLOG DATA FILE FOR ALL,LINE AND CTRL * 01000000
*               ERROR DISPLAY REQUEST.                                * 01050000
*                                                                     * 01100000
* NOTES = NONE                                                        * 01150000
*                                                                     * 01200000
*    DEPENDENCIES = NONE                                              * 01250000
*                                                                     * 01300000
*    RESTRICTIONS = NONE                                              * 01350000
*                                                                     * 01400000
*    REGISTER CONVENTIONS = R10 RECEIVES ADDRESS OF I/O MESSAGE AREA  * 01450000
*                           FROM BNGTQEMF                             * 01500000
*                                                                     * 01550000
*    PATCH LABEL = NONE                                               * 01600000
*                                                                     * 01650000
* MODULE TYPE = TCAM DISPLAY CONTROL                                  * 01700000
*                                                                     * 01750000
*    PROCESSOR = ASSEMBLER H                                          * 01800000
*                                                                     * 01850000
*    MODULE SIZE = 9821 DECIMAL BYTES                                 * 01900000
*                                                                     * 01950000
*    ATTRIBUTES = SERIALLY REUSABLE                                   * 02000000
*                                                                     * 02050000
* ENTRY POINT = BNGTDISP                                              * 02100000
*                                                                     * 02150000
*    PURPOSE = SEE FUNCTION                                           * 02200000
*                                                                     * 02250000
*    LINKAGE = R1  LOADED WITH THE PARAM LIST POINTER                 * 02300000
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 02350000
*              R15 LOADED WITH ENTRY POINT                            * 02400000
*                                                                     * 02450000
* INPUT = PARAM LIST ITEMS USED ARE :                                 * 02500000
*         IN MESSAGE ADDRESS  = TCAMFLDS (R10)                        * 02550000
*         IN MESSAGE COUNT    = VARIABLE (MAXIMUM=117 BYTES)          * 02600000
*                                                                     * 02650000
* OUTPUT = PARAM LIST ITEMS USED ARE :                                * 02700000
*         OUT MESSAGE ADDRESS = TIOADBAO (R10)                        * 02750000
*         OUT MESSAGE COUNT   = VARIABLE (MAXIMUM=2008 BYTES)         * 02800000
*                                                                     * 02850000
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 02900000
*               00 - OPERATION PERFORMED AS REQUESTED                 * 02950000
*                                                                     * 03000000
* EXIT-ERROR  = SYNAD ROUTINE AT LABEL - F190                         * 03050000
*                                                                     * 03100000
* EXTERNAL REFERENCE = BNGTLOCL,BNGTRMOT,BNGTMENU AND BNGT3270        * 03150000
*                                                                     * 03200000
*    ROUTINES = LOCATE ROUTINE                                        * 03250000
*               MOD1SCAN ROUTINE                                      * 03300000
*               MOD1 TABLE BUILD (AT LABEL S215) ROUTINE              * 03350000
*                                                                     * 03400000
*    DATA AREAS = SEE INPUT AND OUTPUT ABOVE                          * 03450000
*                                                                     * 03500000
*    CONTROL BLOCK = DCB (AT LABEL EMFILE)                            * 03550000
*                                                                     * 03600000
* TABLES = TABLE    - FUNCTION/COMPANION TABLE                        * 03650000
*          MOD1TAB  - 3277 MODEL 1 TABLE                              * 03700000
*          HXTOEB   - HEX CHARS TO EBCDIC CHARS TABLE                 * 03750000
*          EBTOHX   - EBCDIC CHARS TO HEX CHARS TABLE                 * 03800000
*          LOTOUP   - LOWER TO UPPER CASE CHARS TABLE                 * 03850000
*                                                                     * 03900000
* MACROS = LINK, SAVE, RETURN, OPEN, READ, CHECK, CLOSE               * 03950000
*                                                                     * 04000000
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 04050000
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 04050107
* CHANGE 02  02/22/78  BNGHJN MACRO ADDED                             * 04050207
*A091000                                                       @OZ30479 04050307
*D097500                                                       @OZ30479 04050407
*C152500,157000-159000                                         @OZ30479 04050507
*C477500                                                       @OZ30478 04050607
*C097000                                                       @OZ30675 04050707
*A490500                                                       @OZ31880 04050807
*D411500-412500                                                @OZ31877 04050907
*C414000-414500,506500-507000,554000-555000,556500-560000      @OZ31877 04051007
*C561500-564000                                                @OZ31877 04051107
*A369500,613000,636500                                         @OZ31884 04051207
*                                                                     * 04150000
*********************************************************************** 04200000
  TITLE 'DISPLAY AUDITS INPUT AND DISPLAYS ALL LINES,LINE, CTRL'        04250000
TCAMFLDS DSECT                                                          04300000
         USING *,10                                                     04350000
TIOATDL  DC    X'0000'      TERMINAL DATA LENGTH                        04400000
TCTTETT  DS    CL1    91=REMOTE  99=LOCAL 3270                          04450000
TCTTETM  DS    CL1      F1= MODEL 1  F2=MODEL 2 3270                    04500000
TCTTEGU  DS    0H                                                       04550000
TCTTELRN DS CL3     LINE ADDRESS REL LINE #                             04600000
TCTTETA  DS    CL1      CONTROL UNIT ADDRESS                            04650000
         DS    CL1     TERMINAL ADDRESS REMOTE                          04700000
TIOADBA  DS    CL100          TERMINAL INPUT AREA                       04750000
TCTTETI  DS CL8      TCAM SYMBOLIC ADDRESS                              04800000
TIOWCC   DS    CL1        C2 CHARACTER FULL SCREEN WRTIE                04850000
TIOADBAO DS    CL2000    TERMINAL OUTPUT AREA                           04900000
DECB     DSECT                     USED IN FILE I/O ERROR ROUTINE       04950000
         DS    CL1                                                      05000000
EXCPBITS DS    CL2                 ADR OD EXCP BITS PLACED BY SUPVR     05050000
         DS    CL1                                                      05100000
SLOTS    DSECT           MAP OF ENTRIES IN CONTROL BLOCK                05150000
         USING SLOTS,DATAREG                                            05200000
SLOTLINE DS    CL6                CHANNEL ADDRESS(PORT OR LIB)          05250000
SLOTNBC  DS    CL2                NUMBER OF BLOCKS IN THIS CHAIN        05300000
SLOTHITS DS    CL2                TOTAL HITS ON THIS LINE               05350000
SLOTRFB  DS    CL3                RELATIVE ADDRESS FIRST BLOCK IN CHAIN 05400000
SLOTRLB  DS    CL3                RELATIVE ADDRESS LAST BLOCK IN CHAIN  05450000
SLOTLTH  EQU   *-SLOTS                                                  05500000
         ORG   SLOTS         MAP OF MDR AND OBR IN DETAIL BLOCKS        05550000
DATALTH  DS    C                   LTH OF THIS SLOT                     05600000
LINEIDA  DS    CL6                 LINE AND LIB ADDR                    05650000
ENTRYTYP DS    C                   ENTRY TYPE - MDR OR OBR              05700000
         DS    CL3                                                      05750000
MDRTYPE  DS    C                   TYPE HDWE - 03 EQUALS 3270           05800000
         DS    CL3                                                      05850000
DATE     DS    CL4                 DATE OF ERROR - 00YY0DDF             05900000
TIME     DS    CL4                 TIME OF ERROR - HHMMSSHH             05950000
         DS    CL8                                                      06000000
MDRCUA   DS    CL2                 MDR CHAN & UNIT ADDR                 06050000
MDRCTRL  DS    C                   MDR CTRL UNIT POLL ADDR              06100000
MDRTERM  DS    C                   MDR TERMIL POLL ADDR                 06150000
MDRSTATS DS    CL2                 REMOTE 3270 STATUS                   06200000
         DS    CL2                                                      06250000
OBRCCW   DS    CL8                 LAST CCW EXECUTED                    06300000
OBRCSW   DS    CL8                 CHANNEL STATUS WORD                  06350000
         DS    CL6                                                      06400000
OBRUCB   DS    C                                                        06450000
         DS    CL3                                                      06500000
OBRCUA   DS    CL2                 OBR CHAN & UNIT ADDR                 06550000
OBRCTRL  DS    C                                                        06600000
OBRTERM  DS    C                                                        06650000
         DS    CL12                                                     06700000
OBRSENSE DS    CL2                 OBR SENSE BYTES                      06750000
*********************************************************************** 06800000
SBA      EQU   X'11'          SET BUFFER ADDRESS                        06850000
SF       EQU   X'1D'          START FIELD                               06900000
IC       EQU   X'13'          INSERT CURSOR                             06950000
UNA      EQU   X'40'          UNPROTECTED,NORMAL INTENSITY, ALPHAMERIC  07000000
UMN      EQU   X'41'               UNPROT,NORMAL,MODIFIED               07050000
PNA      EQU   X'60'          PROTECTED, NORMAL INTENSITY, ALPHAMERIC   07100000
PHA      EQU   X'E8'              PROTECTED, HIGH INTENSITY, ALPHAMERIC 07150000
MNP      EQU   X'61'               PROT,MODIFIED,NORMAL                 07200000
PIA      EQU   X'6D'               PROTECTED,MODIFIED,INVISIBLE,ALPHA   07250000
L1P1     EQU   X'4040'        LINE 1, POSITION 1  BUFFER ADDRESS.       07300000
L1P7     EQU   X'40C6'        LINE 1, POSITION 7  BUFFER ADDRESS.       07350000
L1P36    EQU   X'40E3'        LINE 1, POSITION 36 BUFFER ADDRESS.       07400000
L2P1     EQU   X'C150'        LINE 2, POSITION 1  BUFFER ADDRESS.       07450000
L2P4     EQU   X'C1D3'                                                  07500000
L2P44    EQU   X'C17B'                                                  07550000
L3P1     EQU   X'C260'                                                  07600000
L3P4     EQU   X'C1D3'                                                  07650000
L4P1     EQU   X'C3F0'       LINE 4, POSITION 1  BUFFER ADDRESS.        07700000
L4P4     EQU   X'C17B'                                                  07750000
L6P26    EQU   X'C6E9'       LINE 6 POS 26 BUFFER ADDRESS               07800000
R0       EQU   0             USED IN FILE I/O ERROR ROUTINE             07850000
R1       EQU   1                                                        07900000
REG1     EQU   1                                                        07950000
BASE1    EQU   3             BASE REGISTER ONE = 0-4095                 08000000
BASE2    EQU   4             BASE REGISTER TWO = 4096-8191              08050000
BASE3    EQU    12           BASE REGISTER THREE 8192 - 12287           08100000
TIOABAR  EQU   5             POINTS TO TIOA                             08150000
MOD1REG  EQU   5             POINTS TO MOD-1 TABLE (MOD1TABL)           08200000
FIOABAR  EQU   6             POINTS TO FIOA                             08250000
PARMREG  EQU   6             POINTS TO PARM AREA                        08300000
OUTREG   EQU   7             POINTS TO DATA IN TIOA AREA                08350000
OUTLOOP  EQU   8             USED FOR LOOPING THRU DATA IN TIOA AREA    08400000
R8       EQU   8             USED IN FILE I/O ERROR ROUTINE             08450000
DATAREG  EQU   9             POINTS TO DATA IN FIOA AREA                08500000
DATALOOP EQU   2             USED FOR LOOPING THRU DATA IN FIOA AREA    08550000
TABLEREG EQU   11                 POINTS TO FUNCTION/COMPANION TABLE    08600000
LINKREG  EQU   11                 SUBROUTINE LINKAGE                    08650000
R11      EQU   11                                                       08700000
R13      EQU   13                                                       08750000
R14      EQU   14                                                       08800000
R15      EQU   15                                                       08850000
*********************************************************************** 08900000
BNGTDISP CSECT                                                          08950000
         SAVE  (14,12)             SAVE CALLERS REGS                    09000000
         BALR  BASE1,0             ADDRESS ABILITY                      09050000
         USING *,BASE1,BASE2,BASE3                                      09100000
BNGTDISP BNGHJN SKIPID                                         @OZ30479 09120007
         ST     R13,SAVREG      SAVE CALLERS SAVE REG                   09150000
         LA    R13,SAVAREA                                              09200000
         LA    BASE2,2048(BASE1)                                        09250000
         LA    BASE2,2048(BASE2)                                        09300000
         LA    BASE3,2048(BASE2)                                        09350000
         LA    BASE3,2048(BASE3)                                        09400000
         LA    TIOABAR,TIOADBA       LOAD ADDRESS OF INPUT AREA         09450000
         ST    TIOABAR,TCTTEDA       SAVE INPUT AREA ADDRESS            09500000
         LA    FIOABAR,FIOADBA       LOAD ADDRESS OF FILE AREA          09550000
         ST    R14,TCAFCAAA        STORE RETURN ADDRESS IN  THIS FIELD  09600000
         ST    FIOABAR,TCAFCAA                                          09650000
         LA    BASE1,EMFILE             POINT R3 TO EMFILE     @OZ30675 09700007
         B     PROGSTRT                                        @OZ30675 09709007
         DROP  BASE1                                           @OZ30675 09718007
***************************************************************@OZ30675 09727007
* NOTE: ANY CHANGE BETWEEN THIS POINT AND LABLE 'PROGSTRT'     @OZ30675 09736007
*      REQUIRES A LIKE CHANGE TO BNGTDISP DSECT IN BNGT3270,   @OZ30675 09745007
*      BNGTMENU, BNGTLOCL, AND IN BNGTRMOT.                    @OZ30675 09754007
***************************************************************@OZ30675 09763007
         USING EMFILE,BASE1                                    @OZ30675 09772007
EMFILE DCB DDNAME=EMFILE,DSORG=DA,MACRF=(RIC),OPTCD=R,                 X09800000
               RECFM=F,SYNAD=F190                                       09850000
SAVREG   DS    A                   RETURN SAVE AREA ADDRESS             09900000
SAVAREA  DS    18F                 DEMFDISP SAVE AREA                   09950000
TCAFCAAA DS    A                   TCAM RETURN ADDRESS                  10000000
TCTTEDA  DS    A                   ADDRESS OF PASSED FIELD              10050000
TCAPCPI  DC    CL8'00'        SYMBOLIC PROGRAM NAME TO LINK TO          10100000
TCAFCAA  DS    A                   FILE I/O AREA                        10150000
         DS    0H                                                       10200000
* INSERT PARM1 AND OTHER DC'S HERE                                      10250000
PARM1    DS    D                   1ST INPUT PARM - DEMF                10300000
PARM2    DS    D                   2ND INPUT PARM - ALL/LINE/CTRL/      10350000
*                                       TERM   24230000                 10400000
PARM3    DS    D                   3RD INPUT PARM                       10450000
PARM4    DS    D                   4TH INPUT PARM                       10500000
PARM5    DS    D                   5TH INPUT PARM                       10550000
PARM6    DS    D                   6TH INPUT PARM                       10600000
SBACNT   DS    PL1                 COUNT OF SBA'S IN INPUT              10650000
RELREC   DS    CL3                 BDAM RELATIVE BLOCK ADDRESS          10700000
SVRELREC DS    CL3           SAVE AREA FOR LINE/CTRL RELATIVE BLOCK NO. 10750000
DBLWD    DS    D                   DOUBLEWORD WORK AREA                 10800000
DUBLWD   EQU   DBLWD                                                    10850000
FULLWD   DS    F                   FULLWORD WORK AREA                   10900000
TWALINE  DS     F          SAVE AREA FOR TCAM SYMBOLIC LINE POINTER     10950000
*   THE TWA FROM HERE UP MUST REMAIN IN THAT ORDER TO MATCH TWALINE     11000000
*         WITH TWATCTID IN THE 3270 PROGRAM.                            11050000
LINEID   DS    XL6                 HARDWARE LINE ADDRESS                11100000
LINENAME DS    CL8           LINE NAME SAVE AREA FOR RECAP HEADER       11150000
CTRLID   DS    X                   HARDWARE CONTROL UNIT ADDRESS        11200000
CTRLNAME DS    CL8           CTRL/CLUSTER NAME WORK AREA FOR OUTPUT     11250000
TERMNAME DS    CL8                 TERML/LOGICAL UNIT NAME WORK AREA    11300000
CLUSNAME DS    CL8           CTRL/CLUSTER NAME SAVE AREA FOR RECAP HDR. 11350000
NEWPARM  DS    C                   NEW-PARM SWITCH                      11400000
CTRPARM  DS    C                   COUNTER OF CHARACTERS IN PARM(X)     11450000
SAVETIOA DS    F                   SAVE AREA FOR ORIGINAL TIOA          11500000
SAVEBBSS DS    F                   SAVE POINTER TO BLK AND SLOT         11550000
TWASLOT  DS    C                   INPUT SLOT COUNT IN HEX              11600000
*                                  DISPLACEMENTS IN TIOA                11650000
SAVERCAP DS    F                   SAVEAREA FOR POINTER TO RECAP LINE   11700000
SAVEITEM DS    F                   SAVEAREA FOR POINTER TO FIRST LINE   11750000
*                                  AND CTRL DISPLAYS                    11800000
SLOTCNT  DS    C                   COUNT OF DETAIL SLOTS READ           11850000
ITEMCNT  DS    PL2                 COUNT OF OUTPUT ITEMS IN LINE        11900000
WORKCNT  DS    PL2                 ITEM WORK COUNTER                    11950000
WORK15   DS    CL15                                                     12000000
QUITSW   DS    C             USED TO STOP EDIT OF INPUT ON 3RD SBA      12050000
*                             IF 2ND SBA = L1P7 OR L6P26  ***ALSO*** XH 12100000
*                            USED AS MOD-1 OUTPUT-FULL-SWITCH        XH 12150000
*                               00 = NOT FULL   FF = OUTPUT FULL BUT XH 12200000
*             CONTINUE SCANNINGDATABASEFOR CORRECT ERROR COUNTSXH       12250000
         DC    C'FILE I/O AREA'                                         12300000
         CNOP  0,4                                                      12350000
         USING *,FIOABAR                                                12400000
DFHFIOA  DS    0H      FILE I/O AREA ADDRESS                            12450000
FIOADBA  DC    4096X'00'             FILE INPUT AREA                    12500000
ENDDATA  DC    X'FFFFFFFF'         MARK END OF FILE RECORD              12550000
         ORG FIOADBA                                                    12600000
CTRLLAST DS    F                   LAST USED ADDR IN DATASET            12650000
CTRLTOTL DS    F                   TOTAL BLOCKS IN DATASET              12700000
CTRLBACK DS    F                   BACKWARD PTR IN CTRL BLK CHAIN       12750000
CTRLFWD  DS    F                   FORWARD PTR IN CTRL BLK CHAIN        12800000
CTRLENTS DS    C                   NBR ENTRIES IN THIS CTRL BLK         12850000
         DS    CL15                FOR FUTURE USE                       12900000
CTRLSLT1 DS    0C                  START OF CTRL SLOT NBR ONE.          12950000
         ORG   FIOADBA                                                  13000000
DATAPORT DS    CL6                 PORT & LIB ADDR                      13050000
DATATIME DS    CL4                 TIME BLOCK CREATED                   13100000
DATADATE DS    CL4                 DATE BLOCK CREATED                   13150000
DATAFWD  DS    CL3                 FORWARD CHAIN ADDR                   13200000
DATABACK DS    CL3                 BACKWAD CHAIN ADDR                   13250000
BLKLTH   DS    CL2                 NBR BYTES USED IN THIS BLOCK         13300000
         DS    CL10                                                     13350000
DATASLT1 DS    0C                  START OF 1ST DATA SLOT               13400000
         ORG   ENDDATA+8                                                13450000
PROGSTRT EQU    *                                                       13500000
         L     TIOABAR,TCTTEDA                                          13550000
         ZAP   SBACNT,=P'0'        SET SBA COUNTER TO ZERO.             13600000
         TR    TIOADBA(80),LOTOUP  TRANSLATE LOWER CASE TO UPPER CASE.  13650000
         LA    DATAREG,TIOADBA      POINT TO 1ST BYTE IN TIOA.          13700000
         LR    DATALOOP,DATAREG    SETUP DATA LOOP                      13750000
         AH    DATALOOP,TIOATDL    DATALOOP = INPUT END POINTER         13800000
         LA    PARMREG,PARM1       POINT TO PARMS.                      13850000
         XC    PARM1(48),PARM1     ZERO OUT PARM FIELDS                 13900000
         LR    R14,PARMREG                                              13950000
         MVI   QUITSW,X'00'        INIT QUITSW = 00                     14000000
         MVI   NEWPARM,C'1'        TURN ON 'NEW PARM' SWITCH.           14050000
         MVI   CTRPARM,X'00'       INIT PARM COUNTER = ZERO             14100000
A160     CLI   0(DATAREG),SBA      IS THIS BYTE AN SBA?                 14150000
         BNE   A210                NO. CHECK IT FURTHER.                14200000
         CLI   QUITSW,X'FF'            QUIT SWITCH ON?                  14250000
         BE    C10                          YES.  QUIT EDIT.            14300000
         CLC   1(2,DATAREG),=AL2(L1P7)  IS 2ND SBA = LINE 1 POSN 7      14350000
         BE    A170                NO,CONTINUE EDIT                     14400000
         CLC   1(2,DATAREG),=AL2(L6P26) IS 2ND SBA = LINE 6 POS 26      14450000
         BNE   A180                              NO. CONTINUE EDIT      14500000
A170     MVI   QUITSW,X'FF'        TURN QUIT SWITCH ON                  14550000
A180     AP    SBACNT,=P'1'        YES. ADD TO TO SBA COUNTER.          14600000
         LA    DATAREG,2(DATAREG)  BUMP TIOA POINTER BY 2.              14650000
         B     B80                                                      14700000
A210     CLI   0(DATAREG),C'A'     IS IT AN 'A' OR HIGHER?              14750000
         BL    B80                 NO. CHECK NEW PARM SWITCH.           14800000
         CLI   NEWPARM,C'1'        IS FIRST CHAR FOR PARM(X)?           14850000
         BNE   B10                 NO.                                  14900000
         MVI   NEWPARM,C'0'        YES. SET FIRST CHAR IN FOR PARM      14950000
         MVI   CTRPARM,X'00'       SET PARM CHAR CTR = 0                15000000
B10      IC    R11,CTRPARM         LOAD R11 = CTRPARM                   15050000
         LA    R11,1(R11)          ADD CTRPARM = CTRPARM + 1            15100000
         STC   R11,CTRPARM         STORE NEW CTR BACK CTRPARM           15150000
         CLI   CTRPARM,X'08'       IS CHAR COUNT IN PARM OVER 8 ?       15200000
         BH    B50                 YES.                        @OZ30479 15250007
         MVC   0(1,14),0(DATAREG)  PUT THIS BYTE IN THIS PARM           15300000
         CLI   PARM6+7,X'00'       ARE ALL PARMS USED UP?               15350000
         BNE   C10                 YES. GOTO SYNTAX CHECKING ROUTINE    15400000
         LA    14,1(14)            BUMP PARM POINTER WORKREG.           15450000
B40      LA    DATAREG,1(DATAREG)  BUMP TIOA POINTER.                   15500000
         CR    DATAREG,DATALOOP    IS THERE MORE DATA IN TIOA?          15550000
         BL    A160                YES. GO PROCESS MORE DATA.           15600000
         B     C10                 NO. GOTO SYNTAX CHECKING ROUTINE     15650000
B50      CLC   PARM2(5),=X'F3F2F7F000'  IS THIS 3270 INPUT ?   @OZ30479 15700007
         BNE   B40                      NO.                    @OZ30479 15740007
         CP    SBACNT,=P'2'        IS THIS NON-XED INPUT ?     @OZ30479 15780007
         BH    B40                 NO.                         @OZ30479 15820007
         B     Z40                 SEND INVALID SYNTAX MSG.    @OZ30479 15860007
B80      CLI   NEWPARM,C'1'        IS NEW-PARM SWITCH ON?               15950000
         BE    B40                 YES. CHECK FOR MORE DATA.            16000000
         CLI   PARM6,X'00'         NO. ARE ALL PARMS USED UP?           16050000
         BNE   C10                 YES. GOTO SYNTAX CHECKING ROUTINE    16100000
         LA    PARMREG,8(PARMREG)  NO. BUMP TO NEXT NEW PARM.           16150000
         LR    14,PARMREG          POINT WORK REG TO NEXT PARM.         16200000
         MVI   NEWPARM,C'1'        TURN ON NEW-PARM SWICH.              16250000
         B     B40                 GO CHECK FOR MORE DATA.              16300000
*********************************************************************** 16350000
*                                                                     * 16400000
*        SYNTAX CHECKING ROUTINE                                      * 16450000
*                                                                     * 16500000
*********************************************************************** 16550000
C10      CLI   QUITSW,X'FF'            IS SBA QUIT SWT ON ?             16600000
         BE    C15                     YES. DATA ENTERED FROM 29 AREA   16650000
         CP    SBACNT,=P'1'            NO. IS SBACNT > 1 ?              16700000
         BH    CC10                    YES. BYPASS SYNTAX CHECK         16750000
         CLI   PARM2,X'00'             IS PARM2 BLANK ?                 16800000
         BE    D80                     YES. GOTO BNGTMENU               16850000
C15      CLC   PARM2(5),=X'D4C5D5E400' IS PARM2=MENU ?                  16900000
         BNE   C20                     NO                               16950000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  17000000
         BE    D80                     YES. GOTO BNGTMENU               17050000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  17100000
C20      CLC   PARM2(4),=X'C1D3D300'   IS PARM2 = ALL ?                 17150000
         BNE   C30                     NO                               17200000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  17250000
         BE    CC10                    YES.GO SCHEDULE APPROPRIATE PGM  17300000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  17350000
C30      CLC   PARM2(6),=X'D3D6C3C1D300'  IS PARM2 = LOCAL ?            17400000
         BNE   C40                        NO                            17450000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  17500000
         BE    CC10                    YES.GO SCHEDULE APPROPRIATE PGM  17550000
         CLC   PARM3+1(2),=C'SS'       IS LOCAL/REMOTE SCREEN ?         17600000
         BE    CC10                    YES.                             17650000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  17700000
C40      CLC   PARM2(6),=X'D9C5D4D6E3C5' IS PARM2 = REMOTE ?            17750000
         BNE   C50                     NO.                              17800000
         CLC   PARM2+7(1),=C'S'        IS REMOTE SCREEN ?               17850000
         BE    C45                     YES.                             17900000
         CLI   PARM2+6,X'00'           IS REMOTE SYNTAX ERROR ?         17950000
         BNE   Z40                     YES. GO ISSUE INVALID FORMAT MSG 18000000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  18050000
         BE    CC10                    YES.GO SCHEDULE APPROPRIATE PGM  18100000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  18150000
C45      CLI   PARM3,X'00'             IS REMOTE SCREEN ?               18200000
         BNE   CC10                    YES.                             18250000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  18300000
C50      CLC   PARM2(5),=X'D3C9D5C500' IS PARM2 = LINE ?                18350000
         BNE   C60                     NO                               18400000
         CLI   PARM4,X'00'             IS PARM4 = 00 ?                  18450000
         BNE   Z40                     NO. GO ISSUE INVALID FORMAT MSG  18500000
C55      CLI   PARM3+3,X'00'           LINE ADDR = 4 OR MORE ?          18550000
         BNE   Z40                     YES.                             18600000
         CLI   PARM3+2,X'00'           LINE ADDR = 2 OR LESS ?          18650000
         BE    Z40                     YES.                             18700000
         LA    DATALOOP,3              SET FOR SCAN 3 CHARS             18750000
         LA    DATAREG,PARM3           SET DATAREG = PARM3 PTR          18800000
C57      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         18850000
         BNL   C59                     YES. IT IS NUMERIC               18900000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          18950000
         BH    Z40                     YES. IT IS INVALID FORMAT        19000000
C59      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       19050000
         BCT   DATALOOP,C57            LOOP                             19100000
         B     CC10                    NO. GO SCHEDULE APPROPRIATE PGM  19150000
C60      CLC   PARM2(5),=X'C3E3D9D300' IS PARM2 = CTRL ?                19200000
         BNE   C70                     NO                               19250000
         CLI   PARM5,X'00'             IS PARM5 = 00 ?                  19300000
         BNE   Z40                     NO.                              19350000
         CLI   PARM4,X'00'             IS PARM4 = 00 ?                  19400000
         BE    C55                     YES.                             19450000
C65      CLI   PARM4+2,X'00'           CTRL ADDR = 3 OR MORE ?          19500000
         BNE   Z40                     YES.                             19550000
         CLI   PARM4+1,X'00'           CTRL ADDR = 1 OR LESS ?          19600000
         BE    Z40                     YES.                             19650000
C66      LA    DATALOOP,2              SET FOR SCAN 2 CHARS             19700000
         LA    DATAREG,PARM4           SET DATAREG = PARM4 PTR          19750000
C67      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         19800000
         BNL   C69                     YES. IT IS NUMERIC               19850000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          19900000
         BH    Z40                     YES. IT IS INVALID FORMAT        19950000
C69      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       20000000
         BCT   DATALOOP,C67            LOOP                             20050000
         B     C55                     NO. GO CHECK LINE ADDR (PARM3)   20100000
C70      CLC   PARM2(5),=X'F3F2F7F000' IS PARM2 = 3270 ?                20150000
         BNE   Z40                     NO.                              20200000
         CLI   PARM6,X'00'             IS PARM6 = 00 ?                  20250000
         BNE   Z40                     NO.                              20300000
         CLI   PARM5,X'00'             IS PARM5 = 00 ?                  20350000
         BE    C75                     YES.                             20400000
         CLI   PARM5+2,X'00'           IS TERMINAL ADDR = 3 OR MORE ?   20450000
         BNE   Z40                     YES.                             20500000
         CLI   PARM5+1,X'00'           IS TERMINAL ADDR = 1 OR LESS ?   20550000
         BE    Z40                     YES.                             20600000
         LA    DATALOOP,2              SET FOR SCAN 2 CHARS             20650000
         LA    DATAREG,PARM5           SET DATAREG = PARM5 PTR          20700000
C72      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         20750000
         BNL   C74                     YES. IT IS NUMERIC               20800000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          20850000
         BH    Z40                     YES. IT IS INVALID FORMAT        20900000
C74      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       20950000
         BCT   DATALOOP,C72            LOOP                             21000000
         B     C65                     NO. GO CHK LINE AND CTRL         21050000
C75      CLI   PARM4,X'00'             IS PARM4 = 00 ?                  21100000
         BNE   Z40                     NO.                              21150000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  21200000
         BE    D10                     YES. BRANCH TO BNGT3270          21250000
         CLI   PARM3+3,X'00'           IS TERM/LINE = 4 OR MORE ?       21300000
         BNE   Z70                     YES. GO ISSUE SYMBOLIC ERR MSG   21350000
         CLI   PARM3+2,X'00'           IS TERM/LINE = 2 OR LESS ?       21400000
         BE    Z70                     YES. GO ISSUE SYMBOLIC ERR MSG   21450000
         LA    DATALOOP,3              SET FOR SCAN 3 CHARS             21500000
         LA    DATAREG,PARM3           SET DATAREG = PARM3 PTR          21550000
C77      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         21600000
         BNL   C79                     YES. IT IS NUMERIC               21650000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          21700000
         BH    Z70                     YES. IT IS SYMBOLIC ERROR        21750000
C79      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       21800000
         BCT   DATALOOP,C77            LOOP                             21850000
*        B     CC10                    NO SYMBOLIC ERROR FOUND          21900000
*********************************************************************** 21950000
*                                                                     * 22000000
*        AT THIS POINT UP TO 5 PARMS HAVE BEEN EDITED AND             * 22050000
*        ARE LEFT JUSTIFIED WITH TRAILING X'00'S                      * 22100000
*                                                                     * 22150000
*********************************************************************** 22200000
CC10     CP    SBACNT,=P'3'        CNT OF SBA LESS THAN THREE           22250000
         BL    D10                 YES,THIS IS INIT ENTRY               22300000
*********************************************************************** 22350000
*                                                                     * 22400000
*        ENTRY IS FROM A FORMATTED SCREEN. THEREFORE,                 * 22450000
*        THIS SECTION TRANSFERS CONTROL TO APPROPRIATE                * 22500000
*        COMPANION PROGRAM.                                           * 22550000
*                                                                     * 22600000
*********************************************************************** 22650000
         CLC   PARM2(4),=C'MENU'   IS THIS MENU SCREEN ?                22700000
         BE    D32                 YES. GO CHECK MENU PARAMETERS        22750000
         CLI   TIOADBA+35,C'%'     IS THIS FROM BITS PROMPTER SCR ?  XH 22800000
         BE    C190                YES. GOTO BNGT3270                XH 22850000
         CLI   PARM4,X'00'         IS PARM4 BLANK ?                     22900000
         BE    D80                 YES. USER DID NOT X ANY ENTRIES      22950000
         CLC   TIOADBA+15(2),=X'C1D3'   IS THIS A PAGE FORWARD-LG    XH 23000000
*                                            OR A PAGE BACKWARD-SM?  XH 23050000
         BNE   CC40                YES.                              XH 23100000
         CLI   TCTTETM,X'F1'       IS THIS A 3277-1?                 XH 23150000
         BE    CC60                YES. DO PAGE BACKWARD-SM.         XH 23200000
         B     CC50                NO. DO PAGE FORWARD-LG.           XH 23250000
CC40     CLC   TIOADBA+15(2),=X'C17B'   IS THIS A PAGE BACKWRD-LG?   XH 23300000
         BE    CC60                YES.                              XH 23350000
         CLC   TIOADBA+15(2),=X'406B'   IS THIS A PAGE FORWARD-SM?   XH 23400000
         BNE   C109                NO. MUST BE BLOWUP REQUEST        XH 23450000
CC50     MVC   PARM4(4),=C'PAGE'    SET UP PARMS FOR PAGING          XH 23500000
         MVC   PARM5(7),=C'FORWARD'     FORWARD.                     XH 23550000
         B     D10                  GO TO APPROPRIATE PGM.           XH 23600000
CC60     MVC   PARM4(4),=C'PAGE'    SET UP PARMS FOR PAGING          XH 23650000
         MVC   PARM5(7),=C'BACKWRD'     BACKWARD.                    XH 23700000
         B     D10                  GO TO APPROPRIATE PGM.           XH 23750000
C109     LA    TABLEREG,TABLE      POINT AT FUNCT/COMP TABLE            23800000
C110     CLC   0(4,TABLEREG),PARM2  PROGRAM NAME IN TABLE               23850000
         BE    C170                YES,PROGRAM NAME FOUND               23900000
         CLC   0(3,TABLEREG),=C'END' END OF TABLE                       23950000
         BE    D30                 YES,GO TO MENU                       24000000
         LA    TABLEREG,TABLENTY(TABLEREG)  BUMP TO NEXT ENTRY          24050000
         B     C110                GO CHECK NEXT ENTRY                  24100000
C170     OC    4(4,TABLEREG),4(TABLEREG)  IS THERE A COMPANION PROGRAM  24150000
         BZ    D10                 NO                                   24200000
         MVC   PARM2(4),4(TABLEREG)  MOVE COMPANION NAME TO PARM2       24250000
         CLC   PARM2(4),=C'TERM'     WAS IT TERL AS COMPANION?          24300000
         BNE   D10                   NO,GO SEARCH TABLE AGAIN           24350000
C190     LINK  EP=BNGT3270           YES,GO TO TERMINAL PROGRAM      XH 24400000
         L     R13,SAVREG                                               24450000
         RETURN  (14,12)             RETURN TO IEDQEMF                  24500000
*********************************************************************** 24550000
*                                                                     * 24600000
*      THIS SECTION TRANSFERS CONTROL TO THE APPROPRIATE PROGRAM.     * 24650000
*                                                                     * 24700000
*********************************************************************** 24750000
D10      LA    TABLEREG,TABLE      POINT AT FUNCT/COMPANION TABLE       24800000
D20      CLC   0(4,TABLEREG),PARM2  PROGRAM NAME IN TABLE               24850000
         BE    D25                 YES                                  24900000
         CLC   0(3,TABLEREG),=C'END'  END OF TABLE                      24950000
         BE    D30                 YES,GO TO MENU PROGRAM               25000000
         LA    TABLEREG,TABLENTY(TABLEREG)  BUMP TO NEXT ENTRY          25050000
         B     D20                 GO CHECK NEXT ENTRY OF TABLE         25100000
D25      CLI   4(TABLEREG),X'00'           IS THERE A PROG NAME TO XCTL 25150000
         BNE   E10                 NO.USE THIS PROGRAM DEMFDISP         25200000
         MVC   TCAPCPI,8(TABLEREG)      STORE NAME IN TCA.              25250000
         LINK  EPLOC=TCAPCPI                                            25300000
         L     R13,SAVREG    POINT TO TCAM SAVAREA                      25350000
         RETURN  (14,12)                                                25400000
D30      CLC   PARM2(4),=C'MENU'   IS IT FROM MENU                      25450000
         BNE   D80                 NO,BR                                25500000
D32      CLI   TCTTETM,X'F1'       IS THIS 1 3277 MOD1?                 25550000
         BE    D50                 YES,BR                               25600000
         CLC   TIOADBA+15(2),=X'4AD6'   LARGE MENU 'ALL' = L9P23        25650000
         BE     D40                YES,BR                               25700000
         CLC   TIOADBA+15(2),=X'4BE6'   LARGE MENU '3270'= L10P23       25750000
         BE    D41                 YES,BR                               25800000
         CLC   TIOADBA+15(2),=X'4CF6'   LARGE MENU 'REMOT' = L11P23     25850000
         BE    D42                 YES,BR                               25900000
         CLC   TIOADBA+15(2),=X'4FD6'   LARGE MENU 'LOCL' = L13P23      25950000
         BNE   D80                 NO,MUST BE FOR MENU                  26000000
D35      LINK  EP=BNGTLOCL          ***************                     26050000
         L     R13,SAVREG                                               26100000
         RETURN   (14,12)                                               26150000
D40      MVC   PARM2(3),=C'ALL'    SET UP TO                            26200000
         LA    TABLEREG,TABLE          DO                               26250000
         ZAP   SBACNT,=P'1'        ALL LINES                            26300000
         B     E10                                                      26350000
D41      XC    PARM2(32),PARM2     CLEAR PARMS FOR XFER                 26400000
         MVC   PARM2(4),=C'3270'   SET UP TO DO                         26450000
         ZAP   SBACNT,=P'1'        3270 DISPLAY                         26500000
         LINK  EP=BNGT3270                                              26550000
         L     R13,SAVREG                                               26600000
         RETURN   (14,12)                                               26650000
D42      LINK   EP=BNGTRMOT                                             26700000
         L     R13,SAVREG                                               26750000
         RETURN   (14,12)                                               26800000
D50      CLC   TIOADBA+15(2),=X'C17A'   SMALL MENU 'ALL' = L4P3         26850000
         BE    D40                 YES,BR                               26900000
         CLC   TIOADBA+15(2),=X'C2E2'   SMALL MENU '3270' = L5P3        26950000
         BE    D41                 YES,BR                               27000000
         CLC   TIOADBA+15(2),=X'C34A'   SMALL MENU 'RMOT' = L6P3        27050000
         BE    D42                 YES,BR                               27100000
         CLC   TIOADBA+15(2),=X'C45A'   SMALL MENU 'LOCL' = L8P3        27150000
         BE    D35                 YES,BR                               27200000
D80      LINK   EP=BNGTMENU                                             27250000
         L     R13,SAVREG                                               27300000
         RETURN  (14,12)                                                27350000
*********************************************************************** 27400000
*                                                                     * 27450000
*        AT THIS POINT IT HAS BEEN DETERMINED THAT THE REQUEST IS FOR * 27500000
*        ALL LINES, LINE, OR CTRL.THIS MODULE HANDLES THOSE DISPLAYS. * 27550000
*                                                                     * 27600000
*********************************************************************** 27650000
         EJECT                                                          27700000
*********************************************************************** 27750000
*                                                                     * 27800000
*        THIS SECTION CREATES THE COMMON HEADER FOR                   * 27850000
*        ALL LINES, ONE LINE, AND CTRL.                               * 27900000
*                                                                     * 27950000
*********************************************************************** 28000000
E10      MVC   SAVETIOA,TCTTEDA    SAVE ORIGINAL TIOA ADDRESS.          28050000
* THIS FIVE LINES OF CODE RE INITIALIZES T I/O AREA TO 40'S             28100000
         LA    0,TIOADBAO          FIELD TO BE CLEARED                  28150000
         LA    1,2000              LENGTH OF FIELD TO BE CLEARED        28200000
         L     DATAREG,=X'40000001'   LENGTH AND PADDING CHARACTER      28250000
         LA    OUTLOOP,FORTY       LOAD FILL CHARACTERS                 28300000
         MVCL  0,OUTLOOP           MOVE 2000 BLANKS TO TIOA             28350000
*  NOW FIELD SHOULD BE ALL X'40'S                                       28400000
         LA    TIOABAR,TIOADBAO    OUTPUT TIOA                          28450000
         ST    TIOABAR,TCTTEDA     POINT TO NEW TIOA                    28500000
         LA    OUTREG,TIOADBAO     POINT TO START OF OUTPUT DATA AREA   28550000
         MVC   0(HDR1LTH,OUTREG),HDR1  MOVE STANDARD FIRST LINE.        28600000
         MVC   HDR1LTH(4,OUTREG),0(TABLEREG)  MOVE NAME OF THIS         28650000
*                                       DISPLAY TO TIOA.                28700000
         OC    HDR1LTH(4,OUTREG),=CL4' '   CHANGE ALL'00' TO ALL' '     28750000
         LA    OUTREG,HDR1LTH+4(OUTREG)  UPDATE DATA POINTER.           28800000
         CLI   TCTTETM,X'F1'       IS THIS A 3277 MODEL 1?              28850000
         BE    E150                YES.                                 28900000
         MVC   0(3,OUTREG),HDR1X   MOVE SBA L2P1 FOR MOD 2.             28950000
         LA    OUTREG,3(OUTREG)                                         29000000
E150     MVC   0(HDR2LTH,OUTREG),HDR2   MOVE PAGE-FOWARD HEADER TO TIOA 29050000
         MVC   HDR2LTH(HDR3LTH,OUTREG),HDR3  MOVE PAGE-BACK HEADER      29100000
         LA    OUTREG,HDR2LTH+HDR3LTH-15(OUTREG)                        29150000
         ST    OUTREG,SAVEBBSS     SAVE POINTER TO BBBSS IN TIOA        29200000
         LA    OUTREG,15(OUTREG)                                        29250000
         ST    OUTREG,SAVERCAP     SAVE POINTER TO RECAP LINE           29300000
         MVC   0(41,OUTREG),16(TABLEREG)  MOVE RECAP HEADER TO TIOA     29350000
         LA    OUTREG,41(OUTREG)                                        29400000
         CLI   TCTTETM,C'1'        IS THIS A MODEL 1?                   29450000
         BE    F30                 YES.                                 29500000
         MVC   0(3,OUTREG),HDR3X   MOVE SBA L4P1 FOR MOD 2.             29550000
         LA    OUTREG,3(OUTREG)                                         29600000
F30      MVC   0(41,OUTREG),57(TABLEREG)   MOVE COLUMN HEADER TO TIOA.  29650000
         LA    OUTREG,41(OUTREG)                                        29700000
         ST    OUTREG,SAVEITEM     SAVE POINTER TO FIRST LINE ITEM      29750000
         CLI   TCTTETM,X'F1'       IS THIS A MODEL 1?                   29800000
         BE    F130                YES.                                 29850000
         MVC   0(41,OUTREG),57(TABLEREG)   MOVE COLUMN HEADER AGAIN     29900000
         LA    OUTREG,41(OUTREG)                                        29950000
         ST    OUTREG,SAVEITEM     SAVE POINTER TO FIRST LINE ITEM      30000000
         LA    OUTLOOP,80          SETUP FOR 80 LINE ITEMS FOR MOD 2    30050000
         B     F150                                                     30100000
F130     LA    OUTLOOP,R14         SETUP FOR 14 LINE ITEMS FOR MOD 1    30150000
*********************************************************************** 30200000
*        THIS SECTION BUILDS THE APPROPRIATE DISPLAY                    30250000
*********************************************************************** 30300000
F150     CP    SBACNT,=P'2'        IS COUNT OF SBA'S LESS THAN 3?       30350000
         BH    R10                 NO. GO TO CONTINUATION SCREEN.       30400000
F180     XC    RELREC,RELREC       POINT TO FIRST CONTROL BLOCK.        30450000
         OPEN  (EMFILE,(INPUT))                                         30500000
         READ  ECB1,DI,EMFILE,FIOADBA,4096,0,RELREC                     30550000
         CHECK ECB1                                                     30600000
         CLOSE EMFILE                                                   30650000
         B     G120                                                     30700000
F190     LR    R8,R0               DECB ADDRESS IN REG8                 30750000
         USING DECB,R8                                                  30800000
         UNPK  DBLWD,EXCPBITS(3)   ERROR BITS IN DECB                   30850000
         DROP  R8                                                       30900000
         MVC   IOERCODE,DBLWD+3                                         30950000
         TR     IOERCODE,HXTOEB    MOVE TCAM RETURN CODE TO I/O ERR MSG 31000000
         UNPK  DBLWD,RELREC(4)                                          31050000
         MVC   IOERBLK,DBLWD+4     MOVE BLK NBR THAT WAS BEING READ     31100000
         TR    IOERBLK,HXTOEB                                           31150000
         MVC   TIOADBAO(IOERLTH),IOERMSG                                31200000
         LA    R8,IOERLTH                                               31250000
         STH   R8,TIOATDL                                               31300000
         CLOSE  EMFILE                                                  31350000
F240     L     R13,SAVREG          RETURN TO WRIITE SCREEN              31400000
         RETURN   (14,12)                                               31450000
FORTY    DC    X'40404040'                                              31500000
IOERMSG  DC    AL1(SBA),AL2(L1P1),AL1(SF,UNA),C'DEMF ',AL1(IC)          31550000
         DC    CL34' ',AL1(SF,PNA),CL39' '                              31600000
         DC    CL39'BNG001A T I/O ERR READING SYS1.DEMFLOG '            31650000
         DC    CL28'    THE BDAM RETURN CODE IS '                       31700000
IOERCODE DC    CL4'0000'                                                31750000
         DC    CL8' '                                                   31800000
         DC    CL34'THE BDAM RELATIVE BLOCK NUMBER IS '                 31850000
IOERBLK  DC    CL3'000'                                                 31900000
IOERLTH  EQU   *-IOERMSG                                                31950000
G120     L     FIOABAR,TCAFCAA     POINT TO FIOA AREA.                  32000000
         OC    CTRLENTS,CTRLENTS   ANY LINE ENTRIES?                    32050000
         BZ    Z30                 NO. WRITE 'NO LINE ERRORS'           32100000
         SR    DATALOOP,DATALOOP                                        32150000
         IC    DATALOOP,CTRLENTS   SET LOOP CTR FOR READING SLOTS.      32200000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT IN BLOCK.        32250000
         CLC   PARM2(3),=C'ALL'    DOES PARM2 = ALL?                    32300000
         BE    J10                 YES.                                 32350000
         OC    PARM3,PARM3         WAS A LINE ADDRESS ENTERED?          32400000
         BZ    Z40                 NO. WRITE 'NO LINE ENTERED'          32450000
         MVC   LINENAME,PARM3      MOVE LINE ADDRESS TO SAVE AREA       32500000
         MVC   CLUSNAME,PARM4      MOVE CONTROL UNIT NAME TO SAVE       32550000
         MVC   MSG7CTRL(2),PARM4   MOVE CTRL ADDR TO ERR MSG AREA       32600000
         OC    MSG7CTRL(2),=CL2' ' MAKE IT UPPER CASE                   32650000
         MVC   NOLINE,PARM3        MOVE LINE ADDRESS TO 'NO ERROR' MSG  32700000
         OC    NOLINE,=CL8' '                                           32750000
         MVC   MSG7LINE(3),NOLINE  MOVE LINE ADDR TO NO ERR FOR CONTROL 32800000
H40      TR    PARM3(3),EBTOHX     CHANGE F0C6F2 TO 000F02 ETC.         32850000
         PACK  DBLWD,PARM3(4)      PACK LINE ADDRESS                    32900000
         MVC   LINEID(3),DBLWD+4   MOVE GOOD PORTION TOSAVE AREA        32950000
         MVC   LINEID+3(3),=XL3'000000'                                 33000000
H80      CLC   SLOTLINE,LINEID     IS THIS CONTROL SLOT FOR OUR LINE?   33050000
         BE    L60                 YES. GO GET DETAIL BLOCK.            33100000
         LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           33150000
         BCT   DATALOOP,H80        CHECK NEXT SLOT.                     33200000
         CLC   CTRLFWD,=F'0'       MORE CONTROL BLOCKS?                 33250000
         BE    Z10                 NO. GO WRITE 'NO LINE ERRORS'        33300000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        33350000
         OPEN  (EMFILE,(INPUT))                                         33400000
         READ  ECB2,DI,EMFILE,FIOADBA,4096,0,RELREC                     33450000
         CHECK ECB2                                                     33500000
         CLOSE EMFILE                                                   33550000
H180     L     FIOABAR,TCAFCAA     POINT TO FIOA                        33600000
         SR    DATALOOP,DATALOOP                                        33650000
         IC    DATALOOP,CTRLENTS   SET SLOT LOOP CONTROL                33700000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT.                 33750000
         B     H80                                                      33800000
         EJECT                                                          33850000
*********************************************************************** 33900000
*        THIS SECTION FORMATS 'ALL LINE' ENTRIES                        33950000
*********************************************************************** 34000000
J10      L     R14,SAVEBBSS        LOAD SAVED ADDR OF BLK/SLOT TIOA.    34050000
         MVC   0(5,R14),=C'00001'  MOVE 00001 TO FIRST AND              34100000
         MVC   10(5,R14),0(R14)    PREVIOUS BBBSS'S                     34150000
J40      MVC   PARM1(6),SLOTLINE   SETUP LINE ADDRESS FOR               34200000
J110     UNPK  DBLWD,SLOTLINE(4)        UNPK LINE ADDR IN WORKAREA      34250000
         TR    DBLWD+4(3),HXTOEB        CONVERT TO EBCDIC               34300000
         MVC   DTLITEM,=CL8' '     CLEAR DETAIL LINE ITEM               34350000
         MVC   DTLITEM(3),DBLWD+4  PUT LINE ADDR IN DETAIL ENTRY        34400000
J150     LH    R14,SLOTHITS        PUT LINE ERRORS IN REG.              34450000
         CVD   R14,DBLWD           CONVERT TO DECIMAL                   34500000
         UNPK  DTLCOUNT,DBLWD+5(3)      PUT LINE ERROR COUNT            34550000
         OI    DTLCOUNT+3,X'F0'         IN OUTPUT                       34600000
         MVC   0(DTLLTH,OUTREG),DTLENTRY   MOVE DETAIL ENTRY TO OUTPUT  34650000
         MVC   DTLCOUNT,=C'0001'      RESTORE PROGRAM CONSTANT.         34700000
         LA    OUTREG,DTLLTH(OUTREG)    UPDATE OUTPUT POINTER           34750000
         BCT   DATALOOP,K100       MORE SLOTS IN THIS CTRL BLK?         34800000
         CLC   CTRLFWD,=F'0'       NO. MORE CTRL BLKS?                  34850000
         BE    K120                NO. PREPARE TO EXIT.                 34900000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        34950000
         OPEN  (EMFILE,(INPUT))                                         35000000
         READ  ECB3,DI,EMFILE,FIOADBA,4096,0,RELREC                     35050000
         CHECK ECB3                                                     35100000
         CLOSE EMFILE                                                   35150000
K50      L     FIOABAR,TCAFCAA     POINT TO FIOA                        35200000
         SR    DATALOOP,DATALOOP                                        35250000
         IC    DATALOOP,CTRLENTS   SET LOOP CONTROL.                    35300000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT                  35350000
         B     J40                                                      35400000
K100     LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           35450000
         BCT   OUTLOOP,J40         ROOM LEFT IN TIOA?                   35500000
K120     L     R15,SAVEBBSS        NO. POINT TO BLK/SLT AREA IN TIOA.   35550000
         UNPK  DBLWD,RELREC(4)     STORE BDAM RELATIVE                  35600000
         TR    DBLWD,HXTOEB        CONTROL BLK NUMBER                   35650000
         MVC   5(3,R15),DBLWD+4    (LAST BBBSS) IN OUTPUT               35700000
         SR    R14,R14                                                  35750000
         IC    R14,CTRLENTS        GET ORIGINAL COUNT OF SLOTS          35800000
         SR    R14,DATALOOP        DETERMINE LAST SLOT READ.            35850000
         STC   R14,DBLWD+6         STORE                                35900000
         UNPK  DBLWD(3),DBLWD+6(2) SLOT NUMBER                          35950000
         TR    DBLWD,HXTOEB        (LAST BBBSS)                         36000000
         MVC   8(2,R15),DBLWD      IN OUTPUT.                           36050000
K230     LA    R14,TIOADBAO         COMPUTE LENGTH OF                   36100000
         SR    OUTREG,R14          DATA IN TIOA.                        36150000
         STH   OUTREG,TIOATDL      STORE LENGTH IN TIOA                 36200000
         L     R13,SAVREG                                               36250000
         RETURN   (14,12)            WRITE TO TCAM                      36300000
*********************************************************************** 36350000
*  THIS SECTION PREPARES THE 'LINE' OR 'CTRL' DISPLAY                   36400000
*********************************************************************** 36450000
L60      MVI   QUITSW,X'00'        TURN OFF OUTPUT-FULL-SW.          XH 36800000
         ZAP   ITEMCNT,=P'0'       SET CTR OF OUTPUT ITEMS = 0          36850000
         MVC   RELREC,SLOTRFB      SAVE POINTER TO DETAIL BLK           36900000
L140     MVC   SVRELREC,RELREC     SAVE FOR LAST BBBSS'S                36950000
         OC    RELREC,RELREC       IS THERE ANY DATA BLOCKS ?  @OZ31884 36960007
         BZ    Z130                NO, WRITE 'NO DATA BLKS MSG'@OZ31884 36970007
         OPEN  (EMFILE,(INPUT))                                         37000000
         READ  ECB4,DI,EMFILE,FIOADBA,4096,0,RELREC                     37050000
         CHECK ECB4                                                     37100000
         CLOSE EMFILE                                                   37150000
L170     L     FIOABAR,TCAFCAA     POINT TO FIOA                        37200000
         SR    DATALOOP,DATALOOP                                        37250000
         LH    DATALOOP,BLKLTH     SET SLOT LOOP CONTROL                37300000
         LA    DATAREG,DATASLT1    POINT FOR FIRST SLOT                 37350000
L210     MVI   SLOTCNT,X'00'       ZERO OUT DETAIL SLOT COUNTER.        37400000
         OC    LINENAME,=CL8' '                                         37450000
         OC    CLUSNAME,=CL8' '                                         37500000
L220     L     1,SAVERCAP               POINT TO RECAP HEADER           37550000
         CLC   PARM2(4),=C'LINE'        PARM2 = LINE?                   37600000
         BE    L230                         YES.                        37650000
         CLC   PARM4,=CL8' '       IS PARM4 BLANK                       37700000
         BE    L225                YES,MUST BE LOCAL                    37750000
         OC    PARM4,PARM4         OR IS PARM4 ZERO                     37800000
         BE    L225                YES,MUST BE LOACL                    37850000
         MVC   22(3,1),CLUSNAME         MOVE CONTROL UNIT TO HEADER     37900000
         MVC   25(8,1),=C'ON LINE '                                     37950000
         MVC   33(3,R1),LINENAME        MOVE LINE ADDR. TO HEADER       38000000
         B     M10                                                      38050000
L225     MVC   11(19,R1),=C'LOCAL CONTROL UNIT '                        38100000
         MVC   30(8,R1),LINENAME   MOVE CNTRL UNIT TO HEADER            38150000
         B     M10                                                      38200000
L230     MVC   21(8,R1),LINENAME        MOVE LINE ADDR. TO HEADER       38250000
*********************************************************************** 38300000
*    THIS SECTION FORMATS A 'LINE' ITEM OR A 'CTRL' ITEM.               38350000
*********************************************************************** 38400000
M10      MVC   CTRLNAME,=D'0'      ZERO  OUT CONTROL UNIT WORK AREA.    38450000
         MVC   TERMNAME,=CL8' '    BLANK OUT TERMINAL WORK AREA.        38500000
         MVC   RELREC,DATAFWD      SAVE NEXT DETAIL BLK ADDR.           38550000
         MVC   TBARG,=CL2' '       CLEAR MOD-1 TABLE ARGUMENT        XH 38600000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR ENTRY?                38650000
         BE    N10                 YES.                                 38700000
         CLI   ENTRYTYP,X'30'      IS IT AN OBR ENTRY?                  38750000
         BE    N80                 YES.                                 38800000
         CLI   ENTRYTYP,X'34'      IS IT TCAM OBR?                      38850000
         BE    N80                 YES,BR                               38900000
M100     CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY?            38950000
         BE    N150                YES.                                 39000000
         OC    CTRLNAME,=CL8' '                                         39050000
         OC    PARM4,=CL8' '                                            39100000
         CLC   PARM4,CTRLNAME      IS PARM 4 = REMOTE CTRL UNIT NAME?   39150000
         BE    N150                YES. PROCESS ENTRY                   39200000
         CLI   PARM4,X'40'         IS PARM4 ZERO ?                      39250000
         BNE   M140                NO. MUST BE REMOTE--BYPASS CK LOCAL  39300000
         OC    LINENAME,=CL8' '                                         39350000
         CLC   LINENAME,CTRLNAME   IS LINENAME = LOCAL CTRL UNIT ?      39400000
         BE    N150                YES. PROCESS ENTRY                   39450000
M140     SR    R15,R15                                               XH 39500000
         IC    R15,SLOTCNT         ADD ONE                           XH 39550000
         AH    R15,=H'1'           TO                                XH 39600000
         STC   R15,SLOTCNT         SLOT COUNTER.                     XH 39650000
M160     SR    R14,R14                                               XH 39700000
         IC    R14,DATALTH         PUT LTH OF SLOT IN WORK REG          39750000
         AR    DATAREG,R14         POINT TO NEXT DETAIL SLOT.           39800000
         SR    DATALOOP,R14        MORE SLOTS IN THIS DETAIL BLK?       39850000
         BP    M10                 YES.                                 39900000
         OC    RELREC,RELREC       MORE DETAIL BLOCKS?                  39950000
         BNE   L140                YES.                                 40000000
M240     ZAP   WORKCNT,ITEMCNT                                          40050000
         BZ    Z50                                                      40100000
         B     K230                                                     40150000
N10      CLI   MOD1SW,X'00'        MOD-1 SWITCH OFF ?                XH 40200000
         BE    N30                 YES. BYPASS MOD-1 SCANNER CHECK   XH 40250000
         CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?        XH 40300000
         BE    N20                 YES. USE REMOTE TERMINAL ADDR     XH 40350000
         MVC   TBARG(1),MDRCTRL    SET TBARG = REMOTE CTRL UNIT      XH 40400000
         B     N25                 GO CK ADDR AGAINST MOD-1 TABLE    XH 40450000
N20      MVC   TBARG(1),MDRTERM    SET TBARG = REMOTE TERMINAL       XH 40500000
N25      BAL   LINKREG,MOD1SCAN    CK IF REMOTE CU OR TERMINAL       XH 40550000
         CLC   TBARG,=X'0000'        IN MOD-1 TABLE?                 XH 40600000
         BE    M140                YES. BYPASS THIS ERROR ENTRY      XH 40650000
N30      UNPK  CTRLNAME(3),MDRCTRL(2)   MDR - PUT CONTROL UNIT       XH 40700000
         TR    CTRLNAME(2),HXTOEB       NAME                            40750000
         MVI   CTRLNAME+2,X'00'         IN WORK AREA.                   40800000
         UNPK  TERMNAME(3),MDRTERM(2)   PUT TERMINAL                    40850000
         TR    TERMNAME(2),HXTOEB       NAME                            40900000
         MVI   TERMNAME+2,C' '          IN WORK AREA.                   40950000
         B     M100                                                     41000000
N80      CLI   OBRUCB,X'10'        IS THIS A LOCAL                      41050000
         BE    N110                YES, GO MOVE 3 BYTE ADDRESS          41100000
N85      CLI   MOD1SW,X'00'        IS MOD-1 SWITCH OFF ?             XH 41300000
         BE    N95                 YES. BYPASS MOD-1 SCANNER CHECK   XH 41350000
         CLC   PARM2(4),=C'CTRL'      IS THIS A 'CTRL' DISPLAY?@OZ31877 41400007
         BE    N88                    YES. USE REMOTE TERM ADDR@OZ31877 41410007
         MVC   TBARG(1),OBRCTRL       PASS REMOTE CU TO MOD-1  @OZ31877 41420007
         B     N90                    GO CK ADDR AGAINST MOD-1 @OZ31877 41430007
N88      MVC   TBARG(1),OBRTERM       PASS REMOTE TERM ADDR    @OZ31877 41440007
*                                     TO MOD-1                 @OZ31877 41450007
N90      BAL   LINKREG,MOD1SCAN       CK IF REMOTE CU OR TERM  @OZ31877 41460007
         CLC   TBARG,=X'0000'        ADDR FOR REMOTE LINE ERRORS     XH 41500000
*                                    IS IN MOD-1 TABLE ?             XH 41550000
         BE    M140                YES. BYPASS THIS ERROR ENTRY      XH 41600000
N95      UNPK  DBLWD,OBRCTRL(2)    OBR - MOVE 1 BYTE REMOTE CU ADR   XH 41650000
         TR    DBLWD+4(3),HXTOEB                                        41700000
         MVC   CTRLNAME(2),DBLWD+5 TO WORK AREA                         41750000
         UNPK  DBLWD,OBRTERM(2)    MOVE 1-BYTE REMOTE TERML ADDR        41800000
         TR    DBLWD+4(3),HXTOEB                                        41850000
         MVC   TERMNAME(2),DBLWD+5 WORK AREA.                           41900000
         B     M100                                                     41950000
N110     CLI   MOD1SW,X'00'        IS MOD-1 SWITCH OFF ?             XH 42000000
         BE    N130                YES. BYPASS MOD-1 SCANNER CHECK   XH 42050000
         MVC   TBARG,OBRCUA        SET TBARG = LOCAL TERMINAL ADDR   XH 42100000
         BAL   LINKREG,MOD1SCAN    CK IF LOCAL TERMINAL IS IN        XH 42150000
         CLC   TBARG,=X'0000'           MOD-1 TABLE ?                XH 42200000
         BE    M140                YES. BYPASS THIS ERROR ENTRY      XH 42250000
N130     UNPK  DBLWD,LINEIDA(4)    OBR - MOVE 3-BYTE CONTROL UNIT    XH 42300000
         TR    DBLWD+4(3),HXTOEB        ADDRESS(POSSIBLY ROUNDED)       42350000
         MVC   CTRLNAME(3),DBLWD+4      TO WORK AREA.                   42400000
         UNPK  DBLWD,OBRCUA(3)          MOVE REAL 3-BYTE CONTROL        42450000
         TR    DBLWD+4(3),HXTOEB        UNIT ADDRESS                    42500000
         MVC   TERMNAME(3),DBLWD+4      WORK AREA.                      42550000
         B     M100                                                     42600000
N150     OC    CTRLNAME,=CL8' '                                         42650000
         L     R14,SAVEITEM        POINT TO FIRST ITEM IN TIOA          42700000
         ZAP   WORKCNT,ITEMCNT     ANY ITEMS IN TIOA?                   42750000
         BZ    P50         NO,ADD NEW ITEM          WAS B P90 111111    42800000
N170     CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY?            42850000
         BE    P20                 YES.                                 42900000
         CLC   TERMNAME,ITEMLTH(R14)    WORKTERMINAL = TIOA TERMINAL?   42950000
         BE    P40                 YES.                                 43000000
N230     LA    R14,DTLLTH(R14)     BUMP TO NEXT ITEM                    43050000
         SP    WORKCNT,=PL2'1'     SUBT ONE FROM ITEM COUNTER.          43100000
         BZ    P90     ANY ITEMS?  NO. ADD NEW ITEM.                    43150000
         B     N170                                                     43200000
P20      CLC   CTRLNAME,ITEMLTH(R14)    WORK CTRL = TIOA CTRL?          43250000
         BNE   N230                NO.                                  43300000
P40      PACK  FULLWD(3),COUNTLTH(4,R14) ADD                            43350000
         AP    FULLWD(3),=P'1'          ONE                             43400000
         UNPK  COUNTLTH(4,R14),FULLWD(3) TO                             43450000
         OI    COUNTLTH+3(R14),X'F0'    COUNT FIELD.                    43500000
         B     M140                GO CHECK NEXT SLOT.                  43550000
P50      CLC   PARM2(4),=C'LINE'   IS IT LINE                  11111    43600000
         BE    P170                YES,BR                      11111    43650000
         SR    R15,R15                                         11111    43700000
         IC    R15,SLOTCNT                                     11111    43750000
         AH    R15,=H'1'                                       11111    43800000
         STC   R15,SLOTTTR                                     11111    43850000
         L     R15,SAVEBBSS                                    11111    43900000
         UNPK  DBLWD(3),SLOTTTR(2)                             11111    43950000
         TR    DBLWD,HXTOEB                                    11111    44000000
         MVC   3(2,R15),DBLWD                                  11111    44050000
P90      CLI   QUITSW,X'FF'        MOD-1 OUTPUT-FULL-SW ON ?         XH 44100000
         BE    M140                YES. BYPASS PUTTING ADDR IN OUTPUTXH 44150000
         CLC   PARM2(4),=C'LINE'        IS THIS A 'LINE' DISPLAY?    XH 44200000
         BE    P170                     YES.                            44250000
         MVC   DTLITEM,TERMNAME    NO. MOVE TERMINAL                    44300000
P120     MVC   0(DTLLTH,OUTREG),DTLENTRY  TO OUTPUT                     44350000
         LA    OUTREG,DTLLTH(OUTREG)    UPDATE OUTPUT POINTER.          44400000
         AP    ITEMCNT,=P'1'       ADD 1 TO COUNT OF OUTPUT ITEMS.      44450000
         SR    R15,R15                                               XH 44500000
         IC    R15,SLOTCNT         ADD ONE                           XH 44550000
         AH    R15,=H'1'           TO                                XH 44600000
         STC   R15,SLOTCNT         SLOT COUNTER.                     XH 44650000
         L     R15,SAVEBBSS        NO. POINT TO BLK/SLT AREA IN TIOA.XH 44700000
         UNPK  DBLWD,SVRELREC(4)   STORE BDAM RELATIVE               XH 44750000
         TR    DBLWD,HXTOEB        CONTROL BLK NUMBER                XH 44800000
         MVC   5(3,R15),DBLWD+4    (LAST BBBSS) IN OUTPUT            XH 44850000
         SR    R14,R14                                               XH 44900000
         UNPK  DBLWD(3),SLOTCNT(2)      STORE SLOT NUMBER IN         XH 44950000
         TR    DBLWD,HXTOEB        (LAST BBBSS)                      XH 45000000
         MVC   8(2,R15),DBLWD      IN OUTPUT.                        XH 45050000
         CP    ITEMCNT,=P'1'       IS THIS THE FIRST ITEM IN TIOA ?  XH 45100000
         BNE   P140                NO. BYPASS UPDATING FIRST BBBSS   XH 45150000
         MVC   0(5,15),5(15)       SET FIRST BBBSS = LAST BBBSS      XH 45200000
         CLC   10(5,15),=C'BBBSS'  IS PREV BBBSS FILLED IN ?         XH 45250000
         BNE   P140                YES. BYPASS UPDATING PREV BBBSS   XH 45300000
         MVC   10(5,15),0(15)      SET PREV BBBSS = FIRST BBBSS      XH 45350000
P140     BCT   OUTLOOP,M160        MORE ROOM IN TIOA?                XH 45400000
         CLI   TCTTETM,X'F2'       IS THIS A 3270-2 ?                XH 45450000
         BE    M240                YES. PREPARE TO EXIT              XH 45500000
         MVI   QUITSW,X'FF'        TURN ON OUTPUT-FULL-SW FOR MOD-1  XH 45550000
         B     M160                CONTINUE SCANNING REST OF DATABASEXH 45600000
P170     MVC   DTLITEM,CTRLNAME    SETUP CONTROL UNIT ADDRESS           45650000
         B     P120                     FOR OUTPUT.                     45700000
         EJECT                                                          45750000
*********************************************************************** 45800000
*     THIS SECTION PREPARES FOR AN ENTRY BLOWUP OR FOR PAGING.          45850000
*********************************************************************** 45900000
R10      L     R14,SAVETIOA        RESTORE POINTER TO INPUT DATA.       45950000
         CLC   PARM4(4),=C'PAGE'   IS THIS A 'PAGE' REQUEST?            46000000
         BE    S010                YES,BR CK FOR FWD OR BACK            46050000
         OC    PARM5,PARM5         MAKE SURE A FIELD WAS X'ED   22222   46100000
         BZ    Z40                 BR,ZERO NO FIELD WAS X'ED    22222   46150000
         CLC   PARM2(4),=C'LINE'   NO. THIS MUST BE COMPANION REQUEST.  46200000
         BNE   R010                IF NOT LINE DISPLAY, GO READ RECORD. 46250000
         MVC   PARM3,PARM5         IS LINE, MOVE THE X'D FIELD TO PRM3. 46300000
         MVC   LINENAME,PARM5           MOVE LINE ADDRESS TO SAVE AREA  46350000
         XC    PARM4(16),PARM4      AS IF LINE ID HAD BEEN KEYED IN.    46400000
         B     F180                GO DO LINE DISPLAY AS IF THIS WERE   46450000
*                                  AN INITIAL 'LINE' INPUT.             46500000
R010     MVC   CLUSNAME,PARM5           MOVE CONTROL UNIT ADDR TO SAVE  46550000
         MVC   PARM4,PARM5         MOVE X'D CTRL UNIT TO PARM4 AS IF    46600000
         XC    PARM5,PARM5           IT HAD BEEN KEYED IN.              46650000
         MVC   PARM1,PARM4         PUT CTRL NAME IN PARM1 FOR TABLE     46700000
         OC    PARM1,=CL8' '                                            46750000
         TR    17(3,R14),EBTOHX    GET BLOCK NUMBER OF                  46800000
         PACK  DBLWD,17(4,R14)        REQUESTED LINE INTO HEX.          46850000
         MVC   RELREC,DBLWD+4                                           46900000
         OPEN  (EMFILE,(INPUT))                                         46950000
         READ  ECB5,DI,EMFILE,FIOADBA,4096,0,RELREC                     47000000
         CHECK ECB5                                                     47050000
         CLOSE EMFILE                                                   47100000
R170     L     FIOABAR,TCAFCAA                                          47150000
         XC    PARM3,PARM3                                              47200000
         UNPK  DBLWD,DATAPORT(4)        MOVE LINE ID                    47250000
         TR    DBLWD+4,HXTOEB           FROM PREVIOUS BLOCK             47300000
         MVC   LINENAME(3),DBLWD+4     TO PARM3 AS IF IT HAD BEEN       47350000
         MVC   PARM3(6),LINENAME        KEYED IN.                       47400000
         CLC   PARM3,PARM4         IS THIS A LOCAL CTRL UNIT?           47450000
         BNE   F180                NO,BR GO TO PROCESS REMOTE           47500000
         XC    PARM4,PARM4         YES,CLEAR REDUDANT CU ADR            47550000
         B     F180                GO DO A 'CTRL' DISPLAY AS IF ABOVE   47600000
*                                  CTRL & LINE HAD BEEN TYPED IN.       47650000
S010     DS    0H                                                       47700000
         CLC   19(2,R14),=X'C1D3'  IS THIS A PAGE FORWARD-LG   @OZ30478 47750007
*                                       OR A PAGE BACKWARD-SM? @OZ30478 47755007
         BE    S090                YES.                        @OZ30478 47760007
         CLC   19(2,R14),=X'C17B'  IS THIS A PAGE BACKWRD-LG?  @OZ30478 47765007
         BE    S090                YES.                        @OZ30478 47770007
         CLC   19(2,R14),=X'406B'  IS THIS A PAGE FORWARD-SM?  @OZ30478 47775007
         BNE   S100                NO OTHER PAGE REQUEST       @OZ30478 47780007
S090     LA    R14,4(14)             BUMP WORK REG BY 4        @OZ30478 47785007
S100     MVC   WORK15,21(R14)      CONVERT BBBSS'S TO HEX      @OZ30478 47790007
         TR    WORK15,EBTOHX                                            47800000
         CLC   PARM5(4),=C'FORW'   IS IT A 'PAGE FORWARD' REQUEST?      47850000
         BE    S110                YES.                                 47900000
         PACK  DBLWD,WORK15+10(6)                                       47950000
         MVC   RELREC,DBLWD+3      THE 'PREVIOUS' BLOCK.                48000000
         MVC   TWASLOT,DBLWD+6     AND SLOT TO RESUME AT.               48050000
         MVC   TBRELREC,RELREC     SAVE CURRENT 'BBB'                XH 48100000
         MVC   TBSLOT,TWASLOT      SAVE CURRENT 'SS'                 XH 48150000
         L     R15,SAVEBBSS        POINT TO NEW OUTPUT HEADER.          48200000
         MVC   0(5,R15),31(R14)    OLD PREVIOUS NOW BECOMES NEW      XH 48250000
         MVC   10(5,R15),31(R14)   FIRST AND PREVIOUS.               XH 48300000
         B     S180                                                     48350000
S110     DS    0H                                                       48400000
         PACK  DBLWD,WORK15+5(6)                                        48450000
         MVC   RELREC,DBLWD+3      PLACE TO PAGE FORWARD FROM           48500000
         MVC   TWASLOT,DBLWD+6                                          48550000
         MVC   TBRELREC,RELREC     SAVE CURRENT 'BBB'                XH 48600000
         MVC   TBSLOT,TWASLOT      SAVE CURRENT 'SS'                 XH 48650000
         L     R15,SAVEBBSS        POINT TO NEW OUTPUT HEADER.          48700000
         MVC   0(5,R15),26(R14)    OLD LAST IS NEW FIRST AND         XH 48750000
         MVC   10(5,R15),21(R14)   OLD FIRST IS NEW PREVIOUS.        XH 48800000
S180     BAL   LINKREG,LOCATE      LOCATE PROPER BLOCK & SLOT.          48850000
         CLC   PARM2(3),=C'ALL'                                         48900000
         BE    J40                 GO RESUME WHERE LEFT OFF AT (ALL)    48950000
         B     S215                PERFORM MOD-1 TABLE BUILD         XH 49000000
S190     ZAP   ITEMCNT,=P'0'       SET CTR OF OUTPUT ITEMS = 0       XH 49050000
         MVI   QUITSW,X'00'        TURN OFF OUTPUT-FULL-SW.    @OZ31880 49070007
         SR    R15,R15                                                  49100000
         IC    R15,DBLWD+6             UPDATE SLOT COUNTER              49150000
         SH    R15,=H'1'                   FOR PAGING IN                49200000
         STC   R15,SLOTCNT             LINE OR CTRL DISPLAYS.           49250000
S200     UNPK  DBLWD,LINEIDA(4)        MOVE LINE ADDRESS                49300000
         TR    DBLWD+4(3),HXTOEB                TO                      49350000
         MVC   LINENAME(3),DBLWD+4     SAVE AREA FOR RECAP HDR.         49400000
         MVC   LINENAME+3(5),=CL5' '        CLEAR OUT GARBAGE           49450000
         XC    PARM4,PARM4                                              49500000
         CLI   ENTRYTYP,X'91'          IS THIS AN MDR ENTRY?            49550000
         BE    S210                         YES.                        49600000
         CLI   OBRUCB,X'40'            IS THIS A REMOTE OBR ?        XH 49650000
         BNE   S205                         NO.                      XH 49700000
         UNPK  CLUSNAME(3),OBRCTRL(2)       MOVE MDR DUMMY LINE ADDR XH 49750000
         TR    CLUSNAME(2),HXTOEB                TO                  XH 49800000
         MVC   CLUSNAME+2(6),=CL6' '        SAVE AREA FOR RECAP HDR. XH 49850000
         MVC   PARM4(2),CLUSNAME              MOVE  ADDR  TO PARM4   XH 49900000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)XH 49950000
S205     MVC   CLUSNAME,LINENAME       MOVE OBR CTRL ADDR. TO SAVE ARXH 50000000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)XH 50050000
S210     UNPK  CLUSNAME(3),MDRCTRL(2)       MOVE MDR CTRL ADDR.         50100000
         TR    CLUSNAME(2),HXTOEB                TO                     50150000
         MVC   CLUSNAME+2(6),=CL6' '        SAVE AREA FOR RECAP HDR.    50200000
         MVC   PARM4(2),CLUSNAME       MOVE MDR CTRL ADDR. TO PARM4     50250000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)   50300000
*********************************************************************** 50350000
*                                                                     * 50400000
*   THIS IS THE MOD-1 'LINE' AND 'CTRL' TABLE BUILD ROUTINE           * 50450000
*                                                                     * 50500000
*********************************************************************** 50550000
S215     CLI   ENTRYTYP,X'91'      IS THIS AN MDR ?                     50600000
         BE    S218                YES. SAVE MDR CTRL UNIT     @OZ31877 50650007
         CLI   OBRUCB,X'40'        IS THIS A REMOTE OBR ?      @OZ31877 50660007
         BNE   S220                NO. BYPASS SAVING CTRL UNIT @OZ31877 50670007
         MVC   TBCTRL,OBRCTRL      YES. SAVE REMOTE OBR CU     @OZ31877 50680007
         B     S220                                            @OZ31877 50690007
S218     MVC   TBCTRL,MDRCTRL      SET TBCTRL = MDRCTRL        @OZ31877 50700007
S220     MVC   TBLINE,LINEIDA      SAVE CURRENT LINE ID                 50750000
         XC    RELREC,RELREC       POINT TO FIRST CONTROL BLOCK.        50800000
         BAL   LINKREG,READ        GET FIRST CONTROL BLOCK.             50850000
         L     FIOABAR,TCAFCAA     POINT TO FIOA AREA.                  50900000
         OC    CTRLENTS,CTRLENTS   ANY LINE ENTRIES?                    50950000
         BZ    Z30                 NO. WRITE 'NO LINE ERRORS'           51000000
         SR    DATALOOP,DATALOOP                                        51050000
         IC    DATALOOP,CTRLENTS   SET LOOP CTR FOR READING SLOTS.      51100000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT IN BLOCK.        51150000
S220A    CLC   TBLINE,SLOTLINE     IS THIS CONTROL SLOT FOR OUR LINE?   51200000
         BE    S222                YES. GO GET DETAIL BLOCK.            51250000
         LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           51300000
         BCT   DATALOOP,S220A      CHECK NEXT SLOT.                     51350000
         CLC   CTRLFWD,=F'0'       MORE CONTROL BLOCKS?                 51400000
         BE    Z10                 NO. GO WRITE 'NO LINE ERRORS'        51450000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        51500000
         BAL   LINKREG,READ                                             51550000
         L     FIOABAR,TCAFCAA     POINT TO INPUT RECORD AREA           51600000
         SR    DATALOOP,DATALOOP                                        51650000
         IC    DATALOOP,CTRLENTS   SET SLOT LOOP CONTROL                51700000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT.                 51750000
         B     S220A                                                    51800000
S222     ZAP   TABLECNT,=P'0'      SET CTR OF TABLE ITEMS = 0           51850000
         LA    MOD1REG,MOD1TABL    POINT TO MOD-1 TABLE                 51900000
         MVC   RELREC,SLOTRFB      MOVE POINTER TO DETAIL BLK           51950000
S222A    MVC   SVRELREC,RELREC     SAVE FOR COMPARE TO TABLE RELREC     52000000
         BAL   LINKREG,READ                                             52050000
         L     FIOABAR,TCAFCAA     POINT TO INPUT RECORD AREA           52100000
         SR    DATALOOP,DATALOOP                                        52150000
         LH    DATALOOP,BLKLTH     SET SLOT LOOP CONTROL                52200000
         LA    DATAREG,DATASLT1    POINT FOR FIRST SLOT                 52250000
         MVI   SLOTCNT,X'01'       SET COUNT OF DETAIL BLK SLOTS=1      52300000
         MVC   RELREC,DATAFWD      SAVE NEXT DETAIL BLK ADDR.           52350000
S222B    CLC   SVRELREC,TBRELREC   IS THIS THE RIGHT DETL BLK ?         52400000
         BNE   S222B10             NO. CONTINUE SCAN                    52450000
         CLC   SLOTCNT,TBSLOT      IS THIS THE RIGHT ENTRY ?            52500000
         BNE   S222B10             NO. CONTINUE SCAN                    52550000
S222B03  MVI   MOD1SW,X'FF'        TURN MOD-1 SWITCH ON                 52600000
S222B05  MVC   RELREC,TBRELREC     RESTORE PAGING 'BBB'                 52650000
         MVC   TWASLOT,TBSLOT      RESTORE PAGING 'SS'                  52700000
         BAL   LINKREG,LOCATE      LOCATE STARTING 'BBBSS' FOR DISP     52750000
         B     S190                RESUME PAGING SETUP                  52800000
S222B10  LA    14,MOD1TABL         POINT OT MOD-1 TABLE                 52850000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR ENTRY?                52900000
         BE    S222C               YES.                                 52950000
         CLI   ENTRYTYP,X'30'      IS IT A BTAM OBR?                    53000000
         BE    S222D               YES.                                 53050000
         CLI   ENTRYTYP,X'34'      IS IT A TCAM OBR?                    53100000
         BE    S222D               YES.                                 53150000
S222B20  SR    15,15                                                    53200000
         IC    15,SLOTCNT          ADD ONE                              53250000
         AH    15,=H'1'            TO                                   53300000
         STC   15,SLOTCNT          SLOT COUNTER.                        53350000
         SR    14,14                                                    53400000
         IC    14,DATALTH          PUT LTH OF SLOT IN WORK REG.         53450000
         AR    DATAREG,14          POINT TO NEXT DETAIL SLOT.           53500000
         SR    DATALOOP,14         MORE SLOTS IN THIS DETAIL BLK?       53550000
         BP    S222B               YES.                                 53600000
         OC    RELREC,RELREC       MORE DETAIL BLOCKS?                  53650000
         BNE   S222A               YES.                                 53700000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN MOD-1 TABLE?            53750000
         BZ    S222B05             NO. EXIT BUT DON'T TURN ON MOD-1 SW. 53800000
         B     S222B03             YES. EXIT NORMALLY                   53850000
S222C    CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?           53900000
         BE    S222C50             YES.  USE TERMINAL ADDR ONLY         53950000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?                 54000000
         BZ    S222C30             NO. ADD NEW ITEM                     54050000
S222C10  CLC   0(1,14),MDRCTRL     IS THIS CTRL UNIT IN THE TABLE ?     54100000
         BE    S222B20             YES.  BYPASS THIS ENTRY              54150000
         LA    14,2(14)            BUMP TO NEXT ENTRY                   54200000
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM COUNT         54250000
         BZ    S222C30             BRANCH IF NO MORE ITEMS TO CK        54300000
         B     S222C10                                                  54350000
S222C30  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?             54400000
         BE    S222B03             YES.                                 54450000
         MVC   0(1,MOD1REG),MDRCTRL     STORE IN TABLE                  54500000
         B     S228                                                     54550000
S222C50  CLC   TBCTRL,MDRCTRL      DOES CTRL UNIT ENTRY = REQUESTED CU? 54600000
         BNE   S222B20             NO. BYPASS PUTTING TERMINAL IN TABLE 54650000
         ZAP   WKTBLCNT,TABLECNT                                        54700000
         BZ    S222C70                                                  54750000
S222C60  CLC   0(1,14),MDRTERM     IS THIS TERMINAL IN THE TABLE ?      54800000
         BE    S222B20             YES. BYPASS THIS ENTRY               54850000
         LA    14,2(14)            BUMP TO NEXT ENTRY                   54900000
         SP    WKTBLCNT,=PL2'1'                                         54950000
         BZ    S222C70                                                  55000000
         B     S222C60                                                  55050000
S222C70  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?             55100000
         BE    S222B03             YES.                                 55150000
         MVC   0(1,MOD1REG),MDRTERM    PUT REMOTE TERMINAL INTO TABLE   55200000
         B     S228                                                     55250000
S222D    CLI   OBRUCB,X'10'        IS THIS A LOCAL?                     55300000
         BE    S222G               YES. GO MOVE 3-BYTE ADDR             55350000
         CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?  @OZ31877 55400007
         BE    S222D50             YES.  USE TERMINAL ADDR ONLY@OZ31877 55405007
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?        @OZ31877 55410007
         BZ    S222D30             NO. ADD NEW ITEM            @OZ31877 55415007
S222D10  CLC   0(1,14),OBRCTRL     IS THIS CTRL UNIT IN TABLE? @OZ31877 55420007
         BE    S222B20             YES.  BYPASS THIS ENTRY     @OZ31877 55425007
         LA    14,2(14)            BUMP TO NEXT ENTRY          @OZ31877 55430007
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM COUNT@OZ31877 55435007
         BZ    S222D30             BRANCH IF NO MORE ITEMS     @OZ31877 55440007
         B     S222D10                                         @OZ31877 55445007
S222D30  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?    @OZ31877 55450007
         BE    S222B03             YES.                        @OZ31877 55455007
         MVC   0(1,MOD1REG),OBRCTRL     STORE IN TABLE         @OZ31877 55460007
         B     S228                                            @OZ31877 55465007
S222D50  CLC   TBCTRL,OBRCTRL      DOES CU ENTRY = REQSTED CU? @OZ31877 55470007
         BNE   S222B20             NO. DON'T PUT TERM IN TBL   @OZ31877 55475007
         ZAP   WKTBLCNT,TABLECNT                               @OZ31877 55480007
         BZ    S222D70                                         @OZ31877 55485007
S222D60  CLC   0(1,14),OBRTERM     IS THIS TERMINAL IN THE TBL?@OZ31877 55490007
         BE    S222B20             YES. BYPASS THIS ENTRY      @OZ31877 55495007
         LA    14,2(14)            BUMP TO NEXT ENTRY          @OZ31877 55500007
         SP    WKTBLCNT,=PL2'1'                                @OZ31877 55505007
         BZ    S222D70                                         @OZ31877 55510007
         B     S222D60                                         @OZ31877 55515007
S222D70  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?    @OZ31877 55520007
         BE    S222B03             YES.                        @OZ31877 55525007
         MVC   0(1,MOD1REG),OBRTERM   PUT REMOTE TERM IN TABLE @OZ31877 55530007
         B     S228                                            @OZ31877 55535007
S222G    CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY ?           55550000
         BE    S222B20             YES. BYPASS THIS ERROR DATA          55600000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?        @OZ31877 55650007
         BZ    S225                NO. ADD NEW ITEM TO TABLE   @OZ31877 55700007
S224     CLC   0(2,14),OBRCUA      ARG MATCH TABLE ENTRY ?     @OZ31877 55750007
         BE    S222B20             YES.  BYPASS THIS ARGUMENT  @OZ31877 55800007
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM CNT  @OZ31877 55850007
         BZ    S225                NO MORE ITEMS TO CK--SO ADD @OZ31877 55900007
*                                  THIS NEW ITEM TO TABLE               56050000
         LA    14,2(14)            BUMP TO NEXT TABLE ENTRY             56100000
         B     S224                GO CK ANOTHER ENTRY         @OZ31877 56150007
S225     CP    TABLECNT,=P'32'     MORE THAN 33 ENTRIES--USER  @OZ31877 56190007
*                                  MUST BE PAGING FROM MOD-2   @OZ31877 56230007
         BE    S222B03             PREPARE TO EXIT ROUTINE.    @OZ31877 56270007
         MVC   0(2,MOD1REG),OBRCUA ADD CTRL UNIT TO MOD-1 TABLE@OZ31877 56310007
S228     LA    MOD1REG,2(MOD1REG)  UPDATE TABLE POINTER.       @OZ31877 56350007
         AP    TABLECNT,=P'1'      ADD 1 TO COUNT OF TABLE ITEMS        56450000
         B     S222B20             GO CK ANOTHER ENTRY                  56500000
*********************************************************************** 56550000
**                                                                      56600000
*   THIS IS A COMMON READ SUBROUTINE FOR MOD-1 CHANGE                 * 56650000
**                                                                      56700000
*********************************************************************** 56750000
READ     OPEN  (EMFILE,(INPUT))                                         56800000
         READ  ECB9,DI,EMFILE,FIOADBA,4096,0,RELREC                     56850000
         CHECK ECB9                                                     56900000
         CLOSE EMFILE                                                   56950000
         BR    LINKREG                                                  57000000
*********************************************************************** 57050000
*                                                                     * 57100000
*   THIS IS THE MOD-1 TABLE SCANNER ROUTINE                           * 57150000
*                                                                     * 57200000
*********************************************************************** 57250000
MOD1SCAN LA    MOD1REG,MOD1TABL    POINT TO MOD-1 TABLE                 57300000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?                 57350000
         BZ    MOD1EXIT            NO. EXIT AND LEAVE TBARG = ADDR.     57400000
MOD1LOOP CLC   0(2,MOD1REG),TBARG  ARG MATCH TABLE ENTRY ?              57450000
         BE    MOD1PASS            YES.  BYPASS THIS ARGUMENT           57500000
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM CNT           57550000
         BZ    MOD1EXIT            NO MORERE ITEMS TO CK--SO EXIT       57600000
         LA    MOD1REG,2(MOD1REG)  BUMP TO NEXT TABLE ENTRY             57650000
         B     MOD1LOOP            GO CHECK ANOTHER ENTRY               57700000
MOD1PASS MVC   TBARG,=X'0000'      CLEAR ARGUMENT = DO NOT USE          57750000
MOD1EXIT BR    LINKREG             RETURN TO CALLER                     57800000
*********************************************************************** 57850000
*   THIS IS THE LOCATE ROUTINE                                          57900000
*********************************************************************** 57950000
LOCATE   OPEN  (EMFILE,(INPUT))                                         58000000
         READ  ECB6,DI,EMFILE,FIOADBA,4096,0,RELREC                     58050000
         CHECK ECB6                                                     58100000
         CLOSE EMFILE                                                   58150000
S230     L     FIOABAR,TCAFCAA     POINT TO DATA BLK.                   58200000
         MVC   SVRELREC,RELREC     SAVE FOR LAST BBBSS'S                58250000
         CLC   PARM2(3),=C'ALL'    IS THIS 'ALL' BEING CONTINUED?       58300000
         BNE   S250                NO. GO SETUP FOR DATA BLOCK.         58350000
         CLC   TWASLOT,CTRLENTS    YES. SETUP FOR CNTRL BLOCK.          58400000
         BH    S290                QUIT IF GARBAGE KEYED IN.            58450000
         LA    DATAREG,CTRLSLT1                                         58500000
         SR    DATALOOP,DATALOOP   LOOP THRU CONTROL                    58550000
         IC    DATALOOP,CTRLENTS   BLOCK TILL REQUESTED SLOT NBR        58600000
         SR    1,1                 IS SATISFIED.                        58650000
         IC    1,TWASLOT                                                58700000
S235     BCT   1,S240                                                   58750000
         BR    LINKREG                                                  58800000
S240     BCTR  DATALOOP,0                                               58850000
         LA    DATAREG,SLOTLTH(DATAREG)                                 58900000
         B     S235                                                     58950000
S250     LH    DATALOOP,BLKLTH     SETUP LOOP NBR BYTES THIS BLK.       59000000
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM             59050000
S260     CLI   TWASLOT,2           IF RQSTED SLOT = 1, THIS IS IT.      59100000
         BLR    LINKREG         GO RESUME DISPLAY BUILDING TO MAIN LINE 59150000
         SR    1,1                                                      59200000
         IC    1,TWASLOT           DECREMENT SLOT COUNT BY 1.           59250000
         BCTR  1,0                                                      59300000
         STC   1,TWASLOT                                                59350000
         IC    1,0(DATAREG)        BUMP TO NEXT SLOT.                   59400000
         LTR   1,1                                                      59450000
         BZ    S290                PREVENT LOOP IF GARBAGE INPUT.       59500000
         AR    DATAREG,1                                                59550000
         SR    DATALOOP,1                                               59600000
         LTR   DATALOOP,DATALOOP   VERIFY SLOT NBR VALID FOR THIS BLK.  59650000
         BP    S260                                                     59700000
S290     MVC   TIOADBAO(MSG5LTH),MSG5   IF RQSTED SLOT CAN'T            59750000
         MVC   TIOATDL,=AL2(MSG5LTH)    BE FOUND, SEND 'INVALID INPUT'  59800000
         L     R13,SAVREG                                               59850000
         RETURN (14,12)              WRITE SCREEN TO TCAM               59900000
*********************************************************************** 59950000
Z10      CLC   PARM2(4),=C'CTRL'     IS THIS A CTRL DISPLAY?            60000000
         BE    Z50                   YES. GOTO CTRL ERROR MSG           60050000
         MVC   TIOADBAO(MSG4LTH),MSG4                                   60100000
         LA    R8,MSG4LTH            ONE ADDED FOR BOUNDRY ALIGNMENT    60150000
         B     Z80                   GO WRITE SCREEN ON TCAM            60200000
Z30      MVC   TIOADBAO(MSG3LTH),MSG3                                   60250000
         LA    R8,MSG3LTH                                               60300000
         B     Z80                   GO WRITE SCREEN ON TCAM            60350000
Z40      MVC   TIOADBAO(MSG6LTH),MSG6                                   60400000
         LA    R8,MSG6LTH                                               60450000
         B     Z80                   GO WRITE SCREEN ON TCAM            60500000
Z50      CLC   MSG7CTRL,=CL2' '                                         60550000
         BNE   Z60                                                      60600000
         MVC   MSG8CTRL,MSG7LINE     LOAD LOCAL CTRL UNIT ADDR          60650000
         MVC   TIOADBAO(MSG8LTH),MSG8                                   60700000
         LA    R8,MSG8LTH                                               60750000
         B     Z80                   GO WRITE SCREEN ON TCAM            60800000
Z60      MVC   TIOADBAO(MSG7LTH),MSG7                                   60850000
         LA    R8,MSG7LTH                                               60900000
         B     Z80                   GO WRITE SCREEN ON TCAM            60950000
Z70      MVC   MSG1TERM,PARM3        MOVE SYMBOLIC NAME TO ERROR MSG    61000000
         OC    MSG1TERM,=CL8' '      CONVERT X'00' TO BLANK             61050000
         MVC   TIOADBAO(MSG1LTH),MSG1                                   61100000
         LA    R8,MSG1LTH                                               61150000
Z80      STH   R8,TIOATDL            SET MSG LNGTH FOR TCAM MSG HANDLR  61200000
         L     R13,SAVREG            RESTORE REG                        61250000
         RETURN (14,12)              GO WRITE SCREEN ON TCAM            61300000
Z130     MVC   MSG13LN,MSG7LINE                                @OZ31884 61310007
         MVC   TIOADBAO(MSG13LTH),MSG13                        @OZ31884 61320007
         LA    R8,MSG13LTH                                     @OZ31884 61330007
         B     Z80                                             @OZ31884 61340007
*                                                                       61350000
MSG1     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    61400000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           61450000
         DC    C'BNG002I T UNABLE TO CONVERT SYMBOLIC '                 61500000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           61550000
         DC    C'TERMINAL NAME '                                        61600000
MSG1TERM DC    CL8' '                                                   61650000
MSG1LTH  EQU   *-MSG1                                                   61700000
MSG3     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    61750000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           61800000
         DC    C'BNG003I T NO ERRORS RECORDED'                          61850000
MSG3LTH  EQU   *-MSG3                                                   61900000
MSG4     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    61950000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           62000000
         DC    C'BNG004I T NO ERRORS RECORDED FOR '                     62050000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           62100000
         DC    C'LINE '                                                 62150000
NOLINE   DC    CL3' '                                                   62200000
MSG4LTH  EQU   *-MSG4                                                   62250000
MSG5     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    62300000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           62350000
         DC    C'BNG005I T ERROR NOT FOUND ON FILE FOR '                62400000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           62450000
         DC    C'THE SELECTED ITEM '                                    62500000
MSG5LTH  EQU   *-MSG5                                                   62550000
MSG6     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    62600000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           62650000
         DC    C'BNG006I T INVALID FORMAT--CHECK PAGE 2 '               62700000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           62750000
         DC    C'OF MENU FOR CORRECT FORMATS'                           62800000
MSG6LTH  EQU   *-MSG6                                                   62850000
MSG7     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    62900000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           62950000
         DC    C'BNG007I T NO ERRORS RECORDED FOR REMOTE'               63000000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           63050000
         DC    C'LINE '                                                 63100000
MSG7LINE DC    CL3' '                                                   63150000
         DC    C'    CONTROL UNIT '                                     63200000
MSG7CTRL DC    CL2' '                                                   63250000
MSG7LTH  EQU   *-MSG7                                                   63300000
MSG8     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    63350000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           63400000
         DC    C'BNG008I T NO ERRORS RECORDED FOR '                     63450000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           63500000
         DC    C'LOCAL CONTROL UNIT '                                   63550000
MSG8CTRL DC    CL3' '                                                   63600000
MSG8LTH  EQU   *-MSG8                                                   63650000
MSG13    DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    63655007
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                  @OZ31884 63660007
         DC    CL39'BNG013A T NO DATA BLOCKS AVAILABLE FOR '   @OZ31884 63665007
         DC    CL5'LINE '                                      @OZ31884 63670007
MSG13LN  DC    CL3' '                                          @OZ31884 63675007
         DC    CL31':  DATA BASE IN DEGRADED MODE. '           @OZ31884 63680007
         DC    CL39' MUST ALLOCATE MORE BLOCKS THAN LINES'     @OZ31884 63685007
MSG13LTH EQU   *-MSG13                                         @OZ31884 63690007
********************************************************************    63700000
HDR3X    DC    AL1(SBA),AL2(L4P1)                                       63750000
HDR1X    DC    AL1(SBA),AL2(L2P1)                                       63800000
DTLENTRY DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'? ) '                     63850000
DTLITEM  DC    CL8' '                                                   63900000
         DC    AL1(SF,PNA)                                              63950000
DTLCOUNT DC    CL4'0001'                                                64000000
DTLLTH   EQU   *-DTLENTRY                                               64050000
ITEMLTH  EQU   DTLITEM-DTLENTRY                                         64100000
COUNTLTH EQU   DTLCOUNT-DTLENTRY                                        64150000
*********************************************************************** 64200000
*  THE FUNCTION/COMPANION TABLE DETERMINES WHICH PROGRAM IS TO WRITE    64250000
*   THE REQUESTED DISPLAY AND PROVIDES THE CORRECT SCREEN AND COLUMN    64300000
*   HEADERS FOR THAT DISPLAY.                                           64350000
*********************************************************************** 64400000
TABLE    DS    0C                  FUNCTION/COMPANION TABLE             64450000
         DC    C'ALL',X'00',C'LINE',XL8'00',AL1(SF,PNA)                 64500000
         DC    CL39'    RECAP OF ALL LINES HAVING ERRORS',AL1(SF,PNA)   64550000
         DC    CL39'       LINEID  ERRS        LINEID  ERRS'            64600000
SLOT2    DC    C'LINECTRL',XL8'00',AL1(SF,PNA)                          64650000
         DC    CL17'    RECAP OF LINE',AL1(SF,PNA),CL20' ',AL1(SF,PNA)  64700000
         DC    CL39'      CTRLUNIT ERRS       CTRLUNIT ERRS'            64750000
         DC    C'CTRLTERM',XL8'00',AL1(SF,PNA)                          64800000
         DC    CL18'RECAP OF CTRL UNIT',AL1(SF,PNA),CL19' ',AL1(SF,PNA) 64850000
         DC    CL39'       TERMID  ERRS        TERMID  ERRS'            64900000
         DC      C'3270',XL4'00',C'BNGT3270',CL82' '                    64950000
         DC    C'LOCA',XL4'00',C'BNGTLOCL',CL82' '                      65000000
         DC    C'REMO',XL4'00',C'BNGTRMOT',CL82' '                      65050000
         DC    C'END'                                                   65100000
TABLELTH EQU   *-TABLE                                                  65150000
TABLENTY EQU   SLOT2-TABLE                                              65200000
HDR1     DS    0C                                                       65250000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF'                   65300000
         DC    AL1(SF,UNA,IC),AL1(SBA),AL2(L1P36),AL1(SF,MNP)           65350000
HDR1LTH  EQU   *-HDR1                                                   65400000
HDR2     DS    0C                                                       65450000
         DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'?'                        65500000
         DC    AL1(SF,PNA),C') PAGE FORWARD'                            65550000
         DC    AL1(SF,PNA)                                              65600000
         DC    CL20' '                                                  65650000
HDR2LTH  EQU   *-HDR2                                                   65700000
HDR3     DS    0C                                                       65750000
         DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'?'                        65800000
         DC    AL1(SF,PNA),C') PAGE BACKWRD'                            65850000
         DC    AL1(SF,PNA)                                              65900000
         DC    CL4' '                                                   65950000
         DC    AL1(SF,PIA)                                              66000000
         DC    CL15'BBBSSBBBSSBBBSS'     BBBSSBBBSSBBBSS BLOCK &SLOT    66050000
HDR3LTH  EQU   *-HDR3                                                   66100000
*********************************************************************** 66150000
MOD1TABL DC    CL64' '       MAX OF 32 ENTRIES FOR MOD-1 TABLE          66200000
*                              LOCAL TERM = 2-BYTES                     66250000
*                              REMOTE CU AND TERM = 2-BYTES             66300000
TBRELREC DS    CL3           SAVE AREA FOR PAGING 'BBB'                 66350000
TBSLOT   DS    C             SAVE AREA FOR PAGING 'SS'                  66400000
TBCTRL   DS    C             SAVE AREA FOR MDR CTRL UNIT                66450000
TBLINE   DS    CL6           SAVE AREA FOR LINE ADDR OF PAGE            66500000
TBARG    DS    CL2           SAVE AREA FOR TABLE ARGUMENT               66550000
TABLECNT DC    PL2'0'        COUNT OF ENTRIES IN TABLE                  66600000
WKTBLCNT DC    PL2'0'        WORK AREA FOR COUNT OF TABLE ENTRIES       66650000
MOD1SW   DC    X'00'         00 = SWT OFF    FF = SWT ON                66700000
*                            IF ON, PERFORM MOD1 TABLE SCAN             66750000
*********************************************************************** 66800000
         DS    0H                                                       66850000
HXTOEB   DC    4XL16'00',C' ',XL15'00',7XL16'00'  THIS TABLE CONVERTS   66900000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  HEX CHARS           66950000
         DC    2XL16'00'                CHARS FA-THRU-FF BACK           67000000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  A THRU F            67050000
EBTOHX   DC    X'00000000000000000000000000000000'     00-0F  THIS      67100000
         DC    X'00000000000000000000000000000000'     10-1F  TABLE     67150000
         DC    X'00000000000000000000000000000000'     20-2F  CONVERTS  67200000
         DC    X'00000000000000000000000000000000'     30-3F  INPUT     67250000
         DC    X'00000000000000000000000000000000'     40-4F  A THRU F  67300000
         DC    X'00000000000000000000000000000000'     50-5F    TO      67350000
         DC    X'00000000000000000000000000000000'     60-6F  0A - 0F   67400000
         DC    X'00000000000000000000000000000000'     70-7F   AND      67450000
         DC    X'00000000000000000000000000000000'     80-8F  F0 - F9   67500000
         DC    X'00000000000000000000000000000000'     90-9F    TO      67550000
         DC    X'00000000000000000000000000000000'     A0-AF  00 - 09   67600000
         DC    X'00000000000000000000000000000000'     B0-BF    AND     67650000
         DC    X'000A0B0C0D0E0F000000000000000000'     C0-CF     *      67700000
         DC    X'00000000000000000000000000000000'     D0-DF   BECOME   67750000
         DC    X'00000000000000000000000000000000'     E0-EF    FF.     67800000
         DC    X'00010203040506070809000000000000'     F0-FF            67850000
LOTOUP   DS    0C          LOWER CASE TO UPPER CASE TR TABLE            67900000
         DC    X'000102030405060708090A0B0C0D0E0F'                      67950000
         DC    X'101112131415161718191A1B1C1D1E1F'                      68000000
         DC    X'202122232425262728292A2B2C2D2E2F'                      68050000
         DC    X'303132333435363738393A3B3C3D3E3F'                      68100000
         DC    X'404142434445464748494A4B4C4D4E4F'                      68150000
         DC    X'505152535455565758595A5B5C5D5E5F'                      68200000
         DC    X'606162636465666768696A6B6C6D6E6F'                      68250000
         DC    X'707172737475767778797A7B7C7D7E7F'                      68300000
         DC    X'80C1C2C3C4C5C6C7C8C98A8B8C8D8E8F'                      68350000
         DC    X'90D1D2D3D4D5D6D7D8D99A9B9C9D9E9F'                      68400000
         DC    X'A0A1E2E3E4E5E6E7E8E9AAABACADAEAF'                      68450000
         DC    X'F0F1F2F3F4F5F6F7F8F9BABBBCBDBEBF'                      68500000
         DC    X'C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF'                      68550000
         DC    X'D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF'                      68600000
         DC    X'E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF'                      68650000
         DC    X'F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF'                      68700000
SLOTTTR  DC    C' '                                                     68750000
         LTORG                                                          68800000
CSECTIED DC    C'BNGTDISP END'                                          68850000
         END                                                            68900000
./  ADD  SSI=81160221,NAME=BNGTLOCL
         PRINT OFF                                                      00050007
         MACRO                                                          00050407
&NAME    BNGHJN &LABEL,&HJN                                             00050807
         LCLC  &HJA,&HJB                                                00051207
&HJA     SETC  '&SYSPARM'(1,4)                                          00051607
&HJB     SETC  '&SYSPARM'(5,4)                                          00052007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00052407
         B     &LABEL .                 BR AROUND CONSTANTS             00052807
         SPACE 2                                                        00053207
.NOBRNCH ANOP                                                           00053607
         AIF   ('&NAME' EQ '').NOLABEL                                  00054007
         DC    C'&NAME' .              MODULE IDENTIFIER                00054407
.NOLABEL ANOP                                                           00054807
         DC    X'&HJA' .                DATE OF MODIFICATION            00055207
         AIF   ('&HJN' NE 'HJN').DATE                                   00055607
         DC    X'&HJB' .                HJN OF MODIFICATION             00056007
.DATE    ANOP                                                           00056407
         AIF   ('&LABEL' EQ '').NOLBL                                   00056807
         SPACE 2                                                        00057207
&LABEL   DS    0H                                                       00057607
.NOLBL   ANOP                                                           00058007
         MEND                                                           00058407
         PRINT ON                                                       00058807
*********************************************************************** 00059207
*                                                                     * 00100007
* MODULE NAME = BNGTLOCL                                              * 00150007
*                                                                     * 00200007
* DESCRIPTIVE NAME = TCAM DEMF LOCAL TERMINAL ERROR TEXT DISPLAY      * 00250007
*                                                                     * 00300007
* COPYRIGHT = NONE                                                    * 00350007
*                                                                     * 00400007
* STATUS = RELEASE 1, LEVEL 1                                         * 00450007
*                                                                     * 00500007
* FUNCTION = 1) DISPLAYS CANNED STATUS/SENSE TEXT OF ALL POSSIBLE     * 00550007
*               LOCAL TERMINAL ERROR COMBINATIONS;                    * 00600007
*            2) PROVIDES THE SELECTION DISPLAY OF EXPLANATION AND     * 00650007
*               POSSIBLE CAUSES ON THE LOCAL TERMINAL STATUS/SENSE    * 00700007
*               WHICH IS SELECTED BY DEMF USER.                       * 00750007
*                                                                     * 00800007
* NOTES = NONE                                                        * 00850007
*                                                                     * 00900007
*    DEPENDENCIES = NONE                                              * 00950007
*                                                                     * 01000007
*    RESTRICTIONS = NONE                                              * 01050007
*                                                                     * 01100007
*    REGISTER CONVENTIONS = R10 CONTAINS ADDRESS OF INPUT MESSAGE     * 01150007
*                                                                     * 01200007
*    PATCH LABEL = NONE                                               * 01250007
*                                                                     * 01300007
* MODULE TYPE = TCAM DISPLAY                                          * 01350007
*                                                                     * 01400007
*    PROCESSOR = ASSEMBLER H                                          * 01450007
*                                                                     * 01500007
*    MODULE SIZE = 6353 DECIMAL BYTES                                 * 01550007
*                                                                     * 01600007
*    ATTRIBUTES = SERIALLY REUSABLE                                   * 01650007
*                                                                     * 01700007
* ENTRY POINT = BNGTLOCL                                              * 01750007
*                                                                     * 01800007
*    PURPOSE = SEE FUNCTION                                           * 01850007
*                                                                     * 01900007
*    LINKAGE = R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 01950007
*                                                                     * 02000007
* INPUT = PARAM LIST ITEMS USED ARE :                                 * 02050007
*         IN MESSAGE ADDRESS  = TCAMFLDS (R10)                        * 02100007
*         IN MESSAGE COUNT    = VARIABLE (MAXIMUM=109 BYTES)          * 02150007
*                                                                     * 02200007
* OUTPUT = PARAM LIST ITEMS USED ARE :                                * 02250007
*         OUT MESSAGE ADDRESS = TIOADBAO (R10)                        * 02300007
*         OUT MESSAGE COUNT   = VARIABLE (MAXIMUM=2009 BYTES)         * 02350007
*                                                                     * 02400007
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 02450007
*               00 - OPERATION PERFORMED AS REQUESTED                 * 02500007
*                                                                     * 02550007
* EXIT-ERROR  = NONE                                                  * 02600007
*                                                                     * 02650007
* EXTERNAL REFERENCE = NONE                                           * 02700007
*                                                                     * 02750007
*    ROUTINES = NONE                                                  * 02800007
*                                                                     * 02850007
*    DATA AREAS = NONE                                                * 02900007
*                                                                     * 02950007
*    CONTROL BLOCK = DCB                                              * 03000007
*                                                                     * 03050007
* TABLES = NONE                                                       * 03100007
*                                                                     * 03150007
* MACROS = SAVE, RETURN                                               * 03200007
*                                                                     * 03250007
**********************CHANGE ACTIVITY FOLLOES:************************* 03300007
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 03300107
* CHANGE 02  03/02/78  BNGHJN MACRO ADDED                             * 03300207
*C042000-049500                                                @OZ30675 03300307
*A086000                                                       @OZ30675 03300407
*D088500                                                       @OZ30675 03300507
*                                                                     * 03400007
*********************************************************************** 03450007
TCAMFLDS DSECT                                                          03500007
         USING *,10                                                     03550007
TIOATDL  DC    X'0000'    TERMINAL DATA LENGTH                          03600007
TCTTETT  DS    CL1   91=REMOTE  99=LOCAL 3270                           03650007
TCTTETM  DS    CL1    F1=MODEL 1  F2=MODEL 2 3270                       03700007
TCTTEGU  DS    0H     EUATE LOCAL LINE ADDRESES                         03750007
TCTLERLN DS    CL3     LINE ADDRESS RELATIVE LINE #                     03800007
TCTTETA  DS    CL1   CONTROL UNIT ADDRESS                               03850007
         DS    CL1     TERNINAL ADDRESS REMOTE                          03900007
TIOADBA  DS    CL100        TERMINAL INPUT AREA                         03950007
TCTTETI  DS    CL8          TCAM  SYMBOLIC ADDRESS                      04000007
TIOWCC   DC    X'C3'       WRITE ERASE                                  04050007
TIOADBAO DS    CL2000     TERMINAL OUTPUT AREA                          04100007
BNGTDISP DSECT                                                          04150007
         DS    4F                                              @OZ30675 04200007
         USING EMFILE,3                                        @OZ30675 04250007
EMFILE DCB DDNAME=EMFILE,DSORG=DA,MACRF=(RIC),OPTCD=R,                 X05000007
               RECFM=F                                                  05050007
SAVREG   DS    A                   RETURN SAVE AREA ADDRESS             05100007
SAVAREA  DS    18F                 DEMFDISP SAVE AREA                   05150007
TCAFCAAA DS    A                                                        05200007
TCTTEDA  DS    A                   ADDRESS OF PASSED FIELD              05250007
TCAPCPI  DC    CL8'00'    SYMBOLIC PROGRAM NAME TO LINK TO              05300007
TCAFCAA  DS    A                   FILE I/O AREA ADDRESS                05350007
         DS    0H                                                       05400007
TWAAREA  EQU   *        START OF TRANSACTION WORK AREA PAASE PARMS      05450007
PARM1    DS    D                   1ST INPUT FIELD.                     05500007
PARM2    DS    D                   2ND INPUT FIELD.                     05550007
PARM3    DS    D                   3RD INPUT FIELD.                     05600007
PARM4    DS    D                   4TH INPUT FIELD.                     05650007
PARM5    DS    D                   5TH INPUT FIELD.                     05700007
TWASBAS  DS    PL1                 COUNT OF SBA'S IN INPUT MSG.         05750007
TWAREL   DS    CL3                 FILE CONTROL RELATIVE BLK ADDR.      05800007
         DS    CL3            SAVE AREA FOR LINE/CTRLREL BLOCK NO.      05850007
DUBLWD   DS    D                   WORK AREA                            05900007
TWATIOA  DS    F                   SAVE INPUT ADDRESS.                  05950007
TWATCTID DS    F                   SAVE TERML ID.                       06000007
TWASLOT  DS    F                   SLOT COUNTER.                        06050007
SAVE14   DS    F                   SAVE AREA.                           06100007
TWAOUT   DS    F                   SAVE OUTPUT HDR ADDR                 06150007
LINESZ   DS    H                   LINE SIZE (3277 MOD 1 OR MOD 2)      06200007
LINELOOP DS    H                   NBR LINE ITEMS PER LINESZ.           06250007
OUTSWCH  DS    C                                                        06300007
TEXTSW   DC    X'00'                                                    06350007
HXLINLIB DS    0CL6                LINE ADDRESS INCLUDING               06400007
         DS    C                                                        06450007
HEXLINE  DS    CL2                      VTAM LIB ADDR                   06500007
HEXLIB   DS    CL3                      IN HEX FORMAT.                  06550007
HEXCTRL  DS    C                   CTRL UNIT POLL CHAR.                 06600007
HEXTERM  DS    C                   TERML POLL CHAR.                     06650007
NEWFIRST DS    CL5                 SAVE AREA FOR OLD BLK & SLOT NBR.    06700007
NEWPREV  DS    CL5                 SAVE AREA FOR OLD BLK & SLOT NBR.    06750007
        CNOP   0,4                                                      06800007
*                             IF 2ND SBA = L1P7                         06850007
         ORG   PARM5+X'71'         JUMP PAST DEMFDISP WORK AREA         06900007
         DC    C'FILE I/O AREA'                                         06950007
         CNOP  0,4                                                      07000007
DFHFIOA  DS    0H      FILE I/O AREA ADDRESS                            07050007
FIOADBA  DC    4096X'00'        FILE INPUT AREA                         07100007
ENDDATA  DC    X'FFFFFFFF'     MARK END OF DATA                         07150007
         ORG   ENDDATA+8                                                07200007
PROGSTRT EQU   *                                                        07250007
         TITLE 'BNTG LOCAL SRL TEXT MODULE'                             07300007
BNGTLOCL CSECT                                                          07350007
BASEREG  EQU   2                                                        07400007
TCTTEAR  EQU   5                                                        07450007
TIOABAR  EQU   5                                                        07500007
FIOABAR  EQU   6                                                        07550007
SBAREG   EQU   7                                                        07600007
OUTREG   EQU   8                                                        07650007
LINKREG  EQU   12                                                       07700007
DATAREG  EQU   9                                                        07750007
MSGREG   EQU   6                                                        07800007
LIMITREG EQU   11                                                       07850007
NEXTREG  EQU   8                                                        07900007
LTHREG   EQU   7                                                        07950007
INREG    EQU   7                                                        08000007
L18P21   EQU   X'D5E4'   MOD2 SCREEN                                    08050007
SML12P1  EQU   X'C6F8'   MOD1 SCREEN                                    08100007
SBA      EQU   X'11'                        SET BUFFER ADDR COMMAND     08150007
SF       EQU   X'1D'                        START FIELD COMMAND         08200007
IC       EQU   X'13'                        INSERT CURSOR COMMAND       08250007
UNA      EQU   X'40'     UNPROTECTED,NORMAL INTENSITY,ALPHAMERIC        08300007
MNA      EQU   X'61'     MODIFIED,NORMAL INTENSITY,ALPHAMERIC           08350007
PDA      EQU   X'E8'     PROTECTED,HIGH INTENSITY,ALPHAMERIC            08400007
PDM      EQU   X'E9'     PROTECTED,HIGH INTENSITY,MODIFIED              08450007
PNA      EQU   X'60'     PROTECTED,NORMAL INTENSITY,ALPHAMERIC          08500007
         BALR  BASEREG,0                                                08550007
         USING *,BASEREG                                                08600007
BNGTLOCL BNGHJN SKIPID                                         @OZ30675 08620007
         SAVE  (14,12)                                                  08650007
         ST    13,SAVREGL           SAVE RESTORE REG                    08700007
         LA    13,SAVAREAL      SAVE AREA FOR LOCAL                     08750007
         B     B5                                                       08800007
SAVEREG  DS    F                                                        08900007
HALFWORD DS    H                                                        08950007
SBACTR   DS    PL1                                                      09000007
SAVREGL  DC    A(0)                                                     09050007
SAVAREAL DS    18F                          REG SAVE AREA               09100007
B5       L     TCTTEAR,TCAFCAAA                                         09150007
         L     TIOABAR,TCTTEDA                                          09200007
         LA    INREG,TIOADBA                LOCATE INPUT DATA.          09250007
         MVI   INDEXSW,X'00'                SET INDEXSW = OFF           09300007
         CLI   0(INREG),SBA                                             09350007
         BNE   B12                                                      09400007
         LA    INREG,3(INREG)                                           09450007
B12      CLC   15(3,INREG),=C'SS='          IS THIS A RQUEST FOR TEXT?  09500007
         BE    D1                           YES. GO LOCATE IT.          09550007
         MVI   INDEXSW,X'FF'                SET INDEXSW = ON            09600007
B14      EQU   *                            NO. BUILD AN INDEX PAGE.    09650007
         LA    LTHREG,IXHDRLTH+3+(44*(SSLTH+4))+(11*SBALTH)             09700007
         BAL   LINKREG,GETTIOA              FREE INAREA & GET OUTAREA.  09750007
         MVC   0(IXHDRLTH,OUTREG),IXHDR     MOVE INDEX HEADER LINE.     09800007
         LA    OUTREG,IXHDRLTH(OUTREG)                                  09850007
         LA    MSGREG,MSG1                  SETUP TO LOCATE ALL         09900007
         L     LIMITREG,=A(LASTMSG)         'SS=????' FIELDS.           09950007
         ZAP   SBACTR,=P'4'                 SETUP FOR 4 PER LINE.       10000007
B22      CLC   0(3,MSGREG),=X'60E2E2'          IS THIS A SENSE/STATUS?  10050007
         BE    C8                           YES. ADD IT TO OUTAREA.     10100007
B24      LA    MSGREG,1(MSGREG)             NO. CONTINUE LOOKING.       10150007
         CR    MSGREG,LIMITREG              ALL DONE?                   10200007
         BL    B22                          NO.                         10250007
         CLI   TCTTETM,C'2'                 IS THIS FOR MOD2 SCREEN?    10300007
         BNE   C3                           NO.                         10350007
         LA    SBAREG,SBA192C               LOAD LAST SBA ATTR ADDR     10400007
         MVC   0(5,OUTREG),0(SBAREG)        MOVE LAST PROTECTED ATTR    10450007
         LA    OUTREG,5(OUTREG)             BUMP 5 BYTES                10500007
C3       CLI   INDEXSW,X'FF'                IS INDEXSW ON ?             10550007
         BNE   C6                           NO.                         10600007
         CLI   TCTTETM,X'F1'                IS THIS A 3277-1 ?          10650007
         BE    C5                           YES.                        10700007
         MVC   0(HITMSGLL,OUTREG),HITMSGL   MOVE 'HIT CLEAR KEY' MSG    10750007
         LA    OUTREG,HITMSGLL(OUTREG)      BUMP OUTPUT POINTER         10800007
         B     C6                                                       10850007
C5       MVC   0(HITMSGSL,OUTREG),HITMSGS   MOVE 'HIT CLEAR KEY' MSG    10900007
         LA    OUTREG,HITMSGSL(OUTREG)      BUMP OUTPUT POINTER         10950007
C6       LA    1,TIOADBAO                    YES,                       11000007
         SR    OUTREG,1                     COMPUTE FINAL               11050007
         STH   OUTREG,TIOATDL               DATA LENGTH.                11100007
         L     13,SAVREGL                   RELOAD  CALLERS SAV AREA    11150007
         RETURN (14,12)                                                 11200007
*********************************************************************** 11250007
*                                                                     * 11300007
*        RETURN                                                       * 11350007
*                                                                     * 11400007
*********************************************************************** 11450007
C8       CP    SBACTR,=P'4'                 BEGINNING A NEW LINE?       11500007
         BNE   C14                          NO.                         11550007
         CLI   TCTTETM,C'2'                 IS THIS FOR MOD2 DISPLAY?   11600007
         BE    C12                          YES.                        11650007
C11      MVC   0(3,OUTREG),0(SBAREG) XXXX   NO. (MOD1) MOVE NEXT        11700007
         LA    SBAREG,3(SBAREG) XXXX        SBA SEQUENCE                11750007
         LA    OUTREG,3(OUTREG) XXXX        TO OUTPUT AREA.             11800007
         B     C13                                                      11850007
C12      MVC   0(8,OUTREG),0(SBAREG) XXXX   YES. MOVE NEXT              11900007
         LA    SBAREG,8(SBAREG) XXXX        SBA SEQUENCE                11950007
         LA    OUTREG,8(OUTREG) XXXX        TO OUTPUT AREA.             12000007
C13      ZAP   SBACTR,=P'0'                                             12050007
C14      MVC   0(SSLTH,OUTREG),SSMSG        MOVE THIS ITEM              12100007
         MVC   SSLTH(4,OUTREG),4(MSGREG)    TO OUTPUT AREA.             12150007
         LA    OUTREG,(SSLTH+4)(OUTREG)                                 12200007
         AP    SBACTR,=P'1'                 ADD 1 TO ITEMS THIS LINE.   12250007
         B     B24                                                      12300007
D1       L     LIMITREG,=A(LASTMSG)         POINT TO LAST MSG.          12350007
         LA    MSGREG,MSG1                  POINT TO 1ST MSG.           12400007
         LR    NEXTREG,MSGREG                                           12450007
D3       MVC   HALFWORD,0(MSGREG)                                       12500007
         AH    NEXTREG,HALFWORD             POINT TO NEXT MSG.          12550007
         ST    MSGREG,SAVEREG                                           12600007
D4       CLC   0(7,MSGREG),15(INREG)        IS THIS THE DESIRED MSG?    12650007
         BE    D12                          YES, MOVE IT TO OUTAREA.    12700007
         LA    MSGREG,1(MSGREG)             NO. STILL IN THIS MSG?      12750007
         CR    MSGREG,NEXTREG                                           12800007
         BL    D4                           YES. KEEP LOOKING.          12850007
         CR    MSGREG,LIMITREG              ALL MSGS LOOKED AT?         12900007
         BL    D3                           NO. RESET ON NEXT MSG.      12950007
         B     B14                          YES. BAD INPUT; SHOW INDEX. 13000007
D12      L     MSGREG,SAVEREG               RESTORE START OF THIS MSG.  13050007
         LA    LTHREG,PGHDRLTH+(12*SBALTH)                              13100007
         MVC   HALFWORD,0(MSGREG)                                       13150007
         AH    LTHREG,HALFWORD              COMPUTE LTH THIS MSG & HDR. 13200007
         MVI   TEXTSW,X'FF'                 SET GETTIOA SUBR SWT        13250007
         BAL   LINKREG,GETTIOA              FREE INAREA & GET OUTAREA.  13300007
         MVC   0(PGHDRLTH,OUTREG),PGHDR     MOVE PAGE HDR LINE.         13350007
         LA    OUTREG,PGHDRLTH(OUTREG)                                  13400007
         MVC   HALFWORD,0(MSGREG)                                       13450007
         LH    1,HALFWORD                   GET TRUE LENGTH             13500007
         SH    1,=H'2'                      OF THIS MSG.                13550007
D20      CH    1,=H'40'                     ONE MORE FULL LINE TO DO?   13600007
         BH    E2                           YES. MOVE IT.               13650007
         MVC   0(3,OUTREG),0(SBAREG)        NO. MOVE THE                13700007
         EX    1,MOVE                       REMAINDER AND               13750007
         AR    OUTREG,1                     GET OUT.                    13800007
         LA    OUTREG,3(OUTREG)                                         13850007
         B     C3                                                       13900007
E2       MVC   0(3,OUTREG),0(SBAREG)        MOVE NEXT SBA SEQUENCE.     13950007
         LA    SBAREG,3(SBAREG)                                         14000007
         CLI   2(MSGREG),SF       IF THIS IS A LINE                     14050007
         BNE   E5                 CONTAINING ATTRIBUTES,                14100007
         MVC   3(2,OUTREG),2(MSGREG)   MOVE                             14150007
         LA    OUTREG,2(OUTREG)        TWO EXTRA                        14200007
         LA    MSGREG,2(MSGREG)        BYTES.                           14250007
         SH    1,=H'2'                                                  14300007
E5       MVC   3(40,OUTREG),2(MSGREG)       MOVE 40 CHARS OF TEXT.      14350007
         LA    OUTREG,43(OUTREG)                                        14400007
         LA    MSGREG,40(MSGREG)                                        14450007
         SH    1,=H'40'                     DECREMENT RESIDUAL COUNT.   14500007
         B     D20                                                      14550007
**  NEXT SEQUENCE REINTIALIZES TIOA TO BLANKS                           14600007
GETTIOA  LA    0,TIOADBAO            FIELD TO BE CLEARED                14650007
         LA    1,2000                LENGTH OF FIELD OT BE CLEARED      14700007
         L     DATAREG,=X'40000001'  LENGTH AND PADDING CHARACTER       14750007
         LA    OUTREG,FORTY          LOAD ADDRESS OF CLEAR DATA         14800007
         MVCL  0,OUTREG              MOVE 2000 CLEAR DATA TO TIOA       14850007
**  END OF INITIALIZE CODE                                              14900007
         LA    TIOABAR,TIOADBAO                                         14950007
         ST    TIOABAR,TCTTEDA            SAVE OUTPUT AREA ADDR         15000007
         LA    SBAREG,SBA1920                                           15050007
         CLI   TCTTETM,C'2'                 SETUP ON LIST OF 12         15100007
         BE    G11                          SBA SEQUENCES FOR           15150007
G10      LA    SBAREG,SBA480 XXXX           APPROPRIATE TERM MODEL.     15200007
G1A      MVC   TIOADBAO(3),0(SBAREG) XXXX                               15250007
         LA    SBAREG,3(SBAREG) XXXX        PRIME OUTAREA FOR LINE 1    15300007
         LA    OUTREG,TIOADBAO+3 XXXX        AND SETUP OUTREG FOR       15350007
         BR    LINKREG                                                  15400007
G11      CLI   TEXTSW,X'FF'                 IS TEXTSW ON?               15450007
         BNE   G12                          NOT ON.                     15500007
         LA    SBAREG,SBATXT2               SET SBAREG = SBATXT2 PTR    15550007
         B     G1A                                                      15600007
G12      LA    SBAREG,SBA192A                                           15650007
         MVC   TIOADBAO(5),0(SBAREG) XXXX                               15700007
         MVC   TIOADBAO+5(5),5(SBAREG) XXXX                             15750007
         MVC   TIOADBAO+10(3),10(SBAREG) XXXX                           15800007
         LA    SBAREG,13(SBAREG) XXXX       PRIME OUTAREA FOR LINE 1    15850007
         LA    OUTREG,TIOADBAO+13 XXXX       AND SETUP OUTREG FOR       15900007
         BR    LINKREG                      REMAINING DATA.             15950007
FORTY    DC    X'40404040'                                              16000007
SBALTH   EQU   3                                                        16050007
SBA192A  DC    X'1140401D6C'       AL1(SBA),AL2(L1P1),AL1(SF,PIA)       16100007
SBA1920  DC    X'11C7601D6C11C7F411C8F01D6C11C9C4114A401D6C114AD4'      16150007
         DC    X'114B501D6C114BE4114C601D6C114CF4114DF01D6C114EC4'      16200007
         DC    X'114F401D6C114FD41150501D6C1150E411D1601D6C11D1F4'      16250007
         DC    X'11D2F01D6C11D3C411D4401D6C11D4D411D5501D6C11D5E4'      16300007
SBA192C  DC    X'11D2C81D6C'       AL1(SBA),AL2(L15P41),AL1(SF,PIA)     16350007
SBA480   DC    X'1140401140E811C15011C1F811C26011C3C8'                  16400007
         DC    X'11C3F011C4D811C54011C5E811C65011C6F8'                  16450007
SBATXT2  DC    X'11C7F411C9C4114AD4'                                    16500007
         DC    X'114BE4114CF4114EC4'                                    16550007
         DC    X'114FD41150E411D1F4'                                    16600007
         DC    X'11D3C411D4D411D5E4'                                    16650007
SSMSG    DC    AL1(SF,UNA),C'?SS='                                      16700007
SSLTH    EQU   *-SSMSG                                                  16750007
IXHDR    DC    AL1(IC,SF,MNA),C'DEMF LOCAL '                            16800007
         DC    AL1(SF,PNA),C'STATUS INDEX,X OVER ?,ENTER'               16850007
IXHDRLTH EQU   *-IXHDR                                                  16900007
PGHDR    DC    AL1(IC,SF,MNA),C'DEMF LOCAL '                            16950007
         DC    AL1(SF,PNA),C'HIT ENTER TO REFRESH INDEX'                17000007
PGHDRLTH EQU   *-PGHDR                                                  17050007
HITMSGS  DC    AL1(SBA),AL2(SML12P1),AL1(SF,PNA)                        17100007
         DC    C'HIT CLEAR KEY TO EXIT DEMF'                            17150007
HITMSGSL EQU   *-HITMSGS                                                17200007
HITMSGL  DC    AL1(SBA),AL2(L18P21),AL1(SF,PNA)                         17250007
         DC    C'HIT CLEAR KEY TO EXIT DEMF'                            17300007
HITMSGLL EQU   *-HITMSGL                                                17350007
INDEXSW  DC    X'00'           INDEX SWITCH 00=OFF  FF=ON               17400007
MOVE     MVC   3(1,OUTREG),2(MSGREG)                                    17450007
         LTORG                                                          17500007
MSG1     DC    AL2(MSG2-*)                                              17550007
         DC    AL1(SF,PNA),C'SS=0220',AL1(SF,PNA),C'  '                 17600007
         DC    CL29'UNIT CHECK,BUS OUT CHECK'                           17650007
         DC    C'A PARITY CHECK WAS DETECTED ON THE      '              17700007
         DC    C'COMMAND BYTE                            '              17750007
         DC    C'                                        '              17800007
         DC    AL1(SF,PNA),C'SS=0240',AL1(SF,PNA),C'  '                 17850007
         DC    CL29'UNIT CHECK,INTERVENTION REQ''D'                     17900007
         DC    C'A COMMAND OTHER THAN SENSE WAS ADDRESSED'              17950007
         DC    C'TO A DEVICE THAT THE 3272 HAS RECORDED  '              18000007
         DC    C'AS UNAVAILABLE OR NOT READY             '              18050007
         DC    C'                                        '              18100007
         DC    AL1(SF,PNA),C'SS=0280',AL1(SF,PNA),C'  '                 18150007
         DC    CL29'UNIT CHECK,COMMAND REJECT'                          18200007
         DC    C'AN INVALID COMMAND WAS ISSUED TO 3272'                 18250007
MSG2     DC    AL2(MSG3-*)                                              18300007
         DC    AL1(SF,PNA),C'SS=0500',AL1(SF,PNA),C'  '                 18350007
         DC    CL29'DEVICE END,UNIT EXCEPTION'                          18400007
         DC    C'3272 ATTEMPTED TO PERFORM A SELECT OR   '              18450007
         DC    C'ERASE ALL UNPROTECTED COMMAND. AFTER RE-'              18500007
         DC    C'TURNING INITIAL STATUS,FOUND ADDRESSED  '              18550007
         DC    CL40'DEVICE BUSY'                                        18600007
         DC    C'                                        '              18650007
         DC    AL1(SF,PNA),C'SS=0601',AL1(SF,PNA),C'  '                 18700007
         DC    CL29'DEVICE END,UNIT CHECK'                              18750007
         DC    CL11' ',CL29'OPERATION CHECK'                            18800007
         DC    C'A WRITE OR ERASE/WRT COMMAND,CONTAINING '              18850007
         DC    C'A WCC WITH A START PRINT BIT,IS CHAINED '              18900007
         DC    C'TO A SUBSEQUENT COMMAND'                               18950007
MSG3     DC    AL2(MSG4-*)                                              19000007
         DC    AL1(SF,PNA),C'SS=0602',AL1(SF,PNA),C'  '                 19050007
         DC    CL29'DEVICE END,UNIT CK,CTRL CK'                         19100007
         DC    C'THE ADDRESSED DEVICE FAILED TO RESPOND  '              19150007
         DC    C'IN A SPECIFIED PERIOD OF TIME TO A      '              19200007
         DC    C'SELECT,WRITE,ERASE/WRT OR AN ERASE ALL  '              19250007
         DC    C'UNPROTECTED COMMAND                     '              19300007
         DC    AL1(SF,PNA),C'SS=0608',AL1(SF,PNA),C'  '                 19350007
         DC    CL29'DEVICE END,UNIT CK,DATA CK'                         19400007
         DC    C'3272 (1) DETECTED PARITY OR CURSOR ERROR'              19450007
         DC    C'DURING A SELECT,WRITE OR ERASE/WRT CMD  '              19500007
         DC    C'OR (2) DETECTED A PARITY CK ON DATA     '              19550007
         DC    C'RECEIVED TO AN INTERNAL POLL'                          19600007
MSG4     DC    AL2(MSG5-*)                                              19650007
         DC    AL1(SF,PNA),C'SS=060C',AL1(SF,PNA),C'  '                 19700007
         DC    CL29'DEVICE END,UNIT CHECK'                              19750007
         DC     CL11' ',CL29'DATA CHECK,UNIT SPECIFY'                   19800007
         DC    C'ADDRESSED DEVICE DETECTED PARITY CK OR  '              19850007
         DC    C'CURSOR CK DURING A SELECT,WRITE,ERASE/- '              19900007
         DC    C'WRT,OR ERASE ALL UNPROTECTED COMMAND    '              19950007
         DC    C'                                        '              20000007
         DC    AL1(SF,PNA),C'SS=0614',AL1(SF,PNA),C'  '                 20050007
         DC    CL29'DEVICE END,UNIT CHECK'                              20100007
         DC    CL11' ',CL29'EQUIPMENT CHECK,UNIT SPECIFY'               20150007
         DC    C'A PRINTER CHARACTER GENERATOR ERROR     '              20200007
         DC    C'OCCURED OR PRINTER BECAME MECHANICALLY  '              20250007
         DC    C'DISABLED DURING PRINTOUT'                              20300007
MSG5     DC    AL2(MSG6-*)                                              20350007
         DC    AL1(SF,PNA),C'SS=0640',AL1(SF,PNA),C'  '                 20400007
         DC    CL29'DEVICE END,UNIT CHECK'                              20450007
         DC    CL11' ',CL29'INTERVENTION REQUIRED'                      20500007
         DC    C'A COMMAND ATTEMPTING TO START A PRINTER '              20550007
         DC    C'FOUND IT NOT READY                      '              20600007
         DC    C'                                        '              20650007
         DC    AL1(SF,PNA),C'SS=0654',AL1(SF,PNA),C'  '                 20700007
         DC    CL29'DEV END,UNIT CK,INTV REQUIRED'                      20750007
         DC    CL11' ',CL29'EQUIPT CHECK,UNIT SPECIFY  '                20800007
         DC    C'A COMMAND TO START PRINT OPERATION FOUND'              20850007
         DC    C'PRINTER CARRIAGE MOTOR POWER OFF'                      20900007
MSG6     DC    AL2(MSG7-*)                                              20950007
         DC    AL1(SF,PNA),C'SS=0E01',AL1(SF,PNA),C'  '                 21000007
         DC    CL29'CHANNEL END,DEVICE END'                             21050007
         DC    CL11' ',CL29'UNIT CHECK,OPERATION CHECK'                 21100007
         DC    C'ON A WRITE OR ERASE/WRT COMMAND,3272    '              21150007
         DC    C'RECEIVED ILLEGAL BUFFER ADDRESS IN DATA-'              21200007
         DC    C'STREAM,OR DATA ENDED BEFORE PROVIDING   '              21250007
         DC    C'ALL CHARACTERS REQUIRED FOR SBA,RA,SF OR'              21300007
         DC    C'EUA ORDERS'                                            21350007
MSG7     DC    AL2(MSG8-*)                                              21400007
         DC    AL1(SF,PNA),C'SS=0E02',AL1(SF,PNA),C'  '                 21450007
         DC    CL29'CHANNEL END,DEVICE END'                             21500007
         DC    CL11' ',CL29'UNIT CHECK,CONTROL CHECK'                   21550007
         DC    C'ADDRESSED DEVICE FAILED TO RESPOND IN   '              21600007
         DC    C'TIME TO AN ERASE/WRT,UNCHAINED READ     '              21650007
         DC    C'BUFFER,READ MODIFIED OR WRITE COMMAND   '              21700007
         DC    C'                                        '              21750007
         DC    AL1(SF,PNA),C'SS=0E08',AL1(SF,PNA),C'  '                 21800007
         DC    CL29'CHANNEL END,DEVICE END'                             21850007
         DC    CL11' ',CL29'UNIT CHECK,DATA CHECK'                      21900007
         DC    C'3272 DETECTED CURSOR OR PARITY CHECK ON '              21950007
         DC    C'TRANSMISSION OF DATA ON A READ BUFFER OR'              22000007
         DC    C'READ MODIFIED COMMAND'                                 22050007
MSG8     DC    AL2(MSG9-*)                                              22100007
         DC    AL1(SF,PNA),C'SS=0E0C',AL1(SF,PNA),C'  '                 22150007
         DC    CL29'CHANNEL END,DEVICE END'                             22200007
         DC    CL11' ',CL29'UNIT CK,DATA CK,UNIT SPECIFY'               22250007
         DC    C'ADDRESSED DEVICE DETECTED PARITY OR     '              22300007
         DC    C'CURSOR CHECK ON WRITE, READ BUFFER OR   '              22350007
         DC    C'READ MODIFIED COMMAND                   '              22400007
         DC    C'                                        '              22450007
         DC    AL1(SF,PNA),C'SS=0E20',AL1(SF,PNA),C'  '                 22500007
         DC    CL29'CHANNEL END,DEVICE END'                             22550007
         DC    CL11' ',CL29'UNIT CHECK,BUS OUT CHECK'                   22600007
         DC    C'3272 DETECTED A PARITY ERROR ON A CHAR- '              22650007
         DC    C'ACTER IN DATA-STREAM OF A WRITE OR ERASE'              22700007
         DC    C'/WRITE COMMAND'                                        22750007
MSG9     DC    AL2(MSG10-*)                                             22800007
         DC    AL1(SF,PNA),C'SS=0D00',AL1(SF,PNA),C'  '                 22850007
         DC    CL29'CHANNEL END,DEVICE END'                             22900007
         DC    CL11' ',CL29'UNIT EXCEPTION'                             22950007
         DC    C'3272 ATTEMPTED A READ BUFFER,READ MOD-  '              23000007
         DC    C'IFIED,WRITE OR ERASE/WRITE COMMAND BUT  '              23050007
         DC    C'FOUND AFTER RETURNING INITIAL STATUS,   '              23100007
         DC    C'THE ADDRESSED DEVICE WAS BUSY           '              23150007
         DC    C'                                        '              23200007
         DC    AL1(SF,PNA),C'SS=820C',AL1(SF,PNA),C'  '                 23250007
         DC    CL29'ATTENTION,UNIT CHECK'                               23300007
         DC    CL11' ',CL29'DATA CHECK,UNIT SPECIFY'                    23350007
         DC    C'AN IDLE DEVICE DETECTED A PARITY CHECK  '              23400007
         DC    C'OR CURSOR CHECK IN ITS BUFFER'                         23450007
MSG10    DC    AL2(MSG11-*)                                             23500007
         DC    AL1(SF,PNA),C'SS=8210',AL1(SF,PNA),C'  '                 23550007
         DC    CL29'ATTENTION,UNIT CHECK'                               23600007
         DC    CL11' ',CL29'EQUIPMENT CHECK'                            23650007
         DC    C'AN IDLE 3272 POLLED A DEVICE TWICE AND  '              23700007
         DC    C'DETECTED A TRANSMIT PARITY CHECK EACH   '              23750007
         DC    C'TIME ON THE DATA IN THE DEVICE REPLY    '              23800007
         DC    AL1(SF,PNA),C'SS=860C',AL1(SF,PNA),C'  '                 23850007
         DC    CL29'ATTENTION,DEV END,UNIT CHECK'                       23900007
         DC    CL11' ',CL29'DATA CHECK,UNIT SPECIFY'                    23950007
         DC    C'A DEVICE CHANGED FROM NOT AVAILABLE TO  '              24000007
         DC    C'AVAILABLE OR NOT READY TO READY AND DET-'              24050007
         DC    C'ECTED A CURSOR CK IN ITS BUFFER OR A PRI'              24100007
         DC    C'NTER DETECTED A PARITY CK WHILE PRINTING'              24150007
MSG11    DC    AL2(MSG12-*)                                             24200007
         DC    AL1(SF,PNA),C'SS=8640',AL1(SF,PNA),C'  '                 24250007
         DC    CL29'ATTN,DEVICE END,UNIT CK'                            24300007
         DC    CL11' ',CL29'INTERVENTION REQUIRED'                      24350007
         DC    C'THE ADDRESSED PRINTER BECAME NOT READY  '              24400007
         DC    C'(OUT OF PAPER OR COVER OPEN)BEFORE PRINT'              24450007
         DC    C'OPERATION WAS COMPLETED                 '              24500007
         DC    C'                                        '              24550007
         DC    AL1(SF,PNA),C'SS=8654',AL1(SF,PNA),C'  '                 24600007
         DC    CL29'ATTN,DEV END,UNIT CK,INTV RQD'                      24650007
         DC    CL11' ',CL29'EQUIPMENT CHECK,UNIT SPECIFY'               24700007
         DC    C'A PRINTER BECAME MECHANICALLY DISABLED  '              24750007
         DC    C'DURING A PRINTOUT AND AUTOMATIC RECOVERY'              24800007
         DC    C'WAS NOT SUCCESSFUL'                                    24850007
MSG12    DC    AL2(MSG13-*)                                             24900007
         DC    AL1(SF,PNA),C'SS=0000',AL1(SF,PNA),C'  '                 24950007
         DC    CL29'ZERO STATUS     '                                   25000007
         DC    C'NORMAL STATUS FOR ANY COMMAND OTHER THAN'              25050007
         DC    C'NO-OP,SELECT,OR ERASE ALL UNPROTECTED   '              25100007
         DC    C'                                        '              25150007
         DC    AL1(SF,PNA),C'SS=0400',AL1(SF,PNA),C'  '                 25200007
         DC    CL29'DEVICE END          '                               25250007
         DC    C'DENOTES THE FOLLOWING CHANGE IN DEVICE  '              25300007
         DC    C'STATUS--BUSY TO NOT BUSY,NOT AVAILABLE  '              25350007
         DC    C'TO AVAILABLE,BUFFER TRANSFER COMPLETE,  '              25400007
         DC    C'OR ON/OFF LINE SWITCH TO ONLINE'                       25450007
MSG13    DC    AL2(MSG14-*)                                             25500007
         DC    AL1(SF,PNA),C'SS=0800',AL1(SF,PNA),C'  '                 25550007
         DC    CL29'CHANNEL END     '                                   25600007
         DC    C'NORMAL STATUS FOR SELECT OR EAU         '              25650007
         DC    C'                                        '              25700007
         DC    AL1(SF,PNA),C'SS=0C00',AL1(SF,PNA),C'  '                 25750007
         DC    CL29'CHANNEL END,DEVICE END'                             25800007
         DC    C'NORMAL STATUS FOR A NO-OP COMMAND       '              25850007
         DC    C'                                        '              25900007
         DC    AL1(SF,PNA),C'SS=1000',AL1(SF,PNA),C'  '                 25950007
         DC    CL29'BUSY            '                                   26000007
         DC    C'RESPONSE TO A COMMAND ADDRESSED TO A    '              26050007
         DC    C'DEVICE SERVICING A PRIOR ISSUED COMMAND'               26100007
MSG14    DC    AL2(MSG15-*)                                             26150007
         DC    AL1(SF,PNA),C'SS=2000',AL1(SF,PNA),C'  '                 26200007
         DC    CL29'CONTROL UNIT END'                                   26250007
         DC    C'3272 HAD BEEN ADDRESSED WHILE BUSY,BUT  '              26300007
         DC    C'IS NOW NOT BUSY AND FREE TO ACCEPT A NEW'              26350007
         DC    C'COMMAND                                 '              26400007
         DC    C'                                        '              26450007
         DC    AL1(SF,PNA),C'SS=5000',AL1(SF,PNA),C'  '                 26500007
         DC    CL29'STATUS MODIFIER,BUSY'                               26550007
         DC    C'RESPONSE TO A COMMAND ADDRESSED TO A    '              26600007
         DC    C'DEVICE OTHER THAN DEVICE WHOSE STATUS IS'              26650007
         DC    C'PENDING OR DEVICE BEING SERVICED BY 3272'              26700007
MSG15    DC    AL2(LASTMSG-*)                                           26750007
         DC    AL1(SF,PNA),C'SS=HELP',AL1(SF,PNA),C'  '                 26800007
         DC    CL29'LOCAL STATUS/SENSE HELPER.'                         26850007
         DC    CL40'FIELDS "SS=XXXX" REFER TO 1ST BYTE OF'              26900007
         DC    CL40'CSW AND THE SENSE BYTE.  FOR INSTANCE,'             26950007
         DC    CL40'IF ERROR DISPLAY SHOWED CSW=0E00 AND'               27000007
         DC    CL40'SENSE=02, LOOK UP MSG FOR "SS=0E02"'                27050007
LASTMSG  EQU   *                                                        27100007
LOCALID  DC    C'BNGTLOCL END'                                          27150007
         END                                                            27200007
./  ADD  SSI=81160225,NAME=BNGTMENU
         PRINT OFF                                                      00050007
         MACRO                                                          00050407
&NAME    BNGHJN &LABEL,&HJN                                             00050807
         LCLC  &HJA,&HJB                                                00051207
&HJA     SETC  '&SYSPARM'(1,4)                                          00051607
&HJB     SETC  '&SYSPARM'(5,4)                                          00052007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00052407
         B     &LABEL .                 BR AROUND CONSTANTS             00052807
         SPACE 2                                                        00053207
.NOBRNCH ANOP                                                           00053607
         AIF   ('&NAME' EQ '').NOLABEL                                  00054007
         DC    C'&NAME' .              MODULE IDENTIFIER                00054407
.NOLABEL ANOP                                                           00054807
         DC    X'&HJA' .                DATE OF MODIFICATION            00055207
         AIF   ('&HJN' NE 'HJN').DATE                                   00055607
         DC    X'&HJB' .                HJN OF MODIFICATION             00056007
.DATE    ANOP                                                           00056407
         AIF   ('&LABEL' EQ '').NOLBL                                   00056807
         SPACE 2                                                        00057207
&LABEL   DS    0H                                                       00057607
.NOLBL   ANOP                                                           00058007
         MEND                                                           00058407
         PRINT ON                                                       00058807
*********************************************************************** 00059207
*                                                                     * 00100007
* MODULE NAME = BNGTMENU                                              * 00150007
*                                                                     * 00200007
* DESCRIPTIVE NAME = TCAM DEMF MENU DISPLAY MODULE                    * 00250007
*                                                                     * 00300007
* COPYRIGHT = NONE                                                    * 00350007
*                                                                     * 00400007
* STATUS = RELEASE 1, LEVEL 1                                         * 00450007
*                                                                     * 00500007
* FUNCTION = 1) DISPLAYS THE FIRST MENU SCREEN THAT OFFERS A CHOICE   * 00550007
*               OF ALL, 3270, REMOT OR LOCAL DISPLAYS;                * 00600007
*            2) DISPLAYS THE SECOND MENU SCREEN THAT DESCRIBES THE    * 00650007
*               SYNTAX OF THE DEMF COMMANDS AND PARAMETERS WHICH USE  * 00700007
*               EXPLICIT PHYSICAL ADDRESSES OR SYMBOLIC NAMES.        * 00750007
*                                                                     * 00800007
* NOTES = SEE BELOW                                                   * 00850007
*                                                                     * 00900007
*    DEPENDENCIES = NONE                                              * 00950007
*                                                                     * 01000007
*    RESTRICTIONS = NONE                                              * 01050007
*                                                                     * 01100007
*    REGISTER CONVENTIONS = R10 CONTAINS ADDRESS OF INPUT MESSAGE     * 01150007
*                                                                     * 01200007
*    PATCH LABEL = NONE                                               * 01250007
*                                                                     * 01300007
* MODULE TYPE = TCAM DISPLAY                                          * 01350007
*                                                                     * 01400007
*    PROCESSOR = ASSEMBLER H                                          * 01450007
*                                                                     * 01500007
*    MODULE SIZE = 2208 DECIMAL BYTES                                 * 01550007
*                                                                     * 01600007
*    ATTRIBUTES = SERIALLY REUSABLE                                   * 01650007
*                                                                     * 01700007
* ENTRY POINT = BNGTMENU                                              * 01750007
*                                                                     * 01800007
*    PURPOSE = SEE FUNCTION                                           * 01850007
*                                                                     * 01900007
*    LINKAGE = R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 01950007
*                                                                     * 02000007
* INPUT = PARAM LIST ITEMS USED ARE : INPUT MESSAGE                   * 02050007
*                                                                     * 02100007
* OUTPUT = PARAM LIST ITEMS USED ARE : PAGE 1 OR 2 OF MENU DISPLAY    * 02150007
*                                                                     * 02200007
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 02250007
*               00 - OPERATION PERFORMED AS REQUESTED                 * 02300007
*                                                                     * 02350007
* EXIT-ERROR  = NONE                                                  * 02400007
*                                                                     * 02450007
* EXTERNAL REFERENCE = NONE                                           * 02500007
*                                                                     * 02550007
*    ROUTINES = NONE                                                  * 02600007
*                                                                     * 02650007
*    DATA AREAS =  NONE                                               * 02700007
*                                                                     * 02750007
*    CONTROL BLOCK = NONE                                             * 02800007
*                                                                     * 02850007
* TABLES = NONE                                                       * 02900007
*                                                                     * 02950007
* MACROS = SAVE, RETURN                                               * 03000007
*                                                                     * 03050007
*****************CHANGE ACTIVITY FOLLOWS:****************************** 03100007
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 03100107
* CHANGE 02  03/02/78  BNGHJN MACRO ADDED                             * 03100207
*C057000-058500,040000-048500                                  @OZ30675 03100307
*                                                                     * 03150007
*                                                                     * 03200007
*********************************************************************** 03250007
         TITLE 'EXCEPTION MANAGEMENT FACILITY MENU PROGRAM'             03300007
TCAMBUF  DSECT                                                          03350007
         USING  *,10                                                    03400007
TIOATDL  DC    X'0000'    TERMINAL DATA LENGHH                          03450007
TCTTETT  DS    CL1         91= REMOTE 99 = LOCAL                        03500007
TCTTETM  DS    CL1           F1 = MOD 1  F2 V MOD 2                     03550007
TCTLERLN DS    CL3           LINE ADRESS                                03600007
TCTTEQU  EQU   TCTLERLN      LOCAL LINE ADDRESS                         03650007
TCTTETA  DS    CL1           CONTROL UNIT ADDRES                        03700007
         DS    CL1          TERMINAL ADRESS REMOTE                      03750007
TIOADBA  DS    CL100         TERMINAL INPUT AREA                        03800007
TCTTETTI DS    CL8     TCAM SYMBOLIC ADDRESS                            03850007
TIOWCC   DS    CL1            C3 SCREEN CONTROL CHARACTER               03900007
TIOADBAO DS    CL2000        TERMINAL OUTPUT AREA                       03950007
BNGTDISP DSECT                                                          03970007
         DS    4F                                              @OZ30675 04000007
         USING EMFILE,3                                        @OZ30675 04050007
EMFILE DCB DDNAME=EMFILE,DSORG=DA,MACRF=(RIC),OPTCD=R,                 X04900007
               RECFM=F                                                  04950007
SAVREG   DS    A        RETURN SAVE AREA ADDRESS                        05000007
SAVAREA  DS    18F      BNGTDISP SAVE AREA                              05050007
TCAFCAAA DS    A         TCAM RETURN ADDRESS                            05100007
TCTTEDA  DS    A     ADDRESS OF PASSED FIELD                            05150007
TCAPCPI  DC    CL8'00'    SYMBOLIC PROGRAM NAME TO LINK TO              05200007
TCAFCAA  DS    A                                                        05250007
         DS    0H                                                       05300007
PARM1    DS    D                                                        05350007
TIOABAR  EQU   5                                                        05400007
TCTTEAR  EQU   6                                                        05450007
BNGTMENU CSECT                                                          05500007
         USING *,11                                                     05550007
         SAVE (14,12)                                                   05600007
         LR    11,15                                                    05650007
BNGTMENU BNGHJN SKIPID                                         @OZ30675 05700007
         ST    13,SAVREG1                                               05900007
         LA    13,SAVAREA1                                              05950007
         LA    TIOABAR,TIOADBAO    LOAD OUTPUT AREA IN IO REG           06000007
         ST    TIOABAR,TCTTEDA      THIS IS NEW OUTPUT AREA             06050007
         CLC   TIOADBA+15(2),=X'D1F5'  (L15P22) PAGE 2 REQ FROM LARGE   06100007
         BE    B10                 YES,BR                               06150007
         CLC   TIOADBA+15(2),=X'C5E9'  (L10P2SM) PAGE 2 REQ FROM SMALL  06200007
         BNE   C10                 NO,BR                                06250007
B10      MVC   PARM1(4),=C'PAGE'   MOVE PAGE TO PARM                    06300007
C10      CLI   TCTTETM,C'1'        IS THIS A SMALL SCREEN?              06350007
         BE    SMALL               YES. USE SMALL MENU.                 06400007
         CLC   PARM1(4),=C'PAGE'   IS THIS A PAGE 2 REQUEST             06450007
         BE    PAGE2LG             YES,BR                               06500007
         LA    1,LG1LTH                                                 06550007
         LA    14,LG1MSG                                                06600007
EXIT     LR    0,5                                                      06650007
         STH   1,TIOATDL    STORE LENGTH INTO PARM                      06700007
         SPACE                                                          06750007
         LR    15,1                                                     06800007
         MVCL  0,14                                                     06850007
         L     13,SAVREG1                                               06900007
         RETURN (14,12)                                                 06950007
SMALL    CLC   PARM1(4),=C'PAGE'   IS THIS A PAGE 2 REQUEST?            07000007
         BE    PAGE2SM            YES.                                  07050007
         LA    1,SM1LTH         POINT TO SMALL 1 MENU                   07100007
         LA    14,SM1MSG                                                07150007
         B     EXIT                                                     07200007
PAGE2SM  LA    1,SM2LTH         POINT TO SMALL 2 MENU                   07250007
         LA    14,SM2MSG                                                07300007
         B     EXIT                                                     07350007
PAGE2LG  LA    1,LG2LTH         POINT TO LARGE 2 MENU                   07400007
         LA    14,LG2MSG                                                07450007
         B     EXIT                                                     07500007
SAVREG1  DS    A          ADDRESS SAVE AREA RETURN                      07550007
SAVAREA1  DS    18F  BNGTMENU SAVE AREA                                 07600007
*********************************************************************** 07650007
SBA      EQU   X'11'               SET BUFFER ADDRESS                   07700007
SF       EQU   X'1D'               START FIELD                          07750007
IC       EQU   X'13'               INSERT CURSOR                        07800007
PNA      EQU   X'60'               PROTECTED,NORMAL,ALPHAMERIC          07850007
PHA      EQU   X'E8'               PROTECTED,HIGH INTENSITY,ALPHAMERIC  07900007
UNA      EQU   X'40'               UNPROT,NORMAL,ALPHAMERIC             07950007
MNP      EQU   X'61'               MODIFIED,NORMAL,PROTECTED,ALPHAMERIC 08000007
L1P1     EQU   X'4040'             LINE 1 POSITION 1                    08050007
L1P35    EQU   X'40E2'                                                  08100007
L1P36    EQU   X'40E3'                                                  08150007
L2P1LG   EQU   X'C150'             LINE 2 POSITION 1 -LARGE SCREEN      08200007
L2P29SM  EQU   X'C1C4'             LINE 2 POSITION 29-SMALL SCREEN      08250007
L2P70    EQU   X'C2D5'                                                  08300007
L3P1SM   EQU   X'C150'             LINE 3 POSITION 1 -SMALL SCREEN      08350007
L4P1SM   EQU   X'C1F8'             LINE 4 POSITION 1 -SMALL SCREEN      08400007
L4P2SM   EQU   X'C1F9'                                                  08450007
L4P4SM   EQU   X'C17B'                                                  08500007
L4P15SM  EQU   X'C2C6'                                                  08550007
L5P1SM   EQU   X'C260'                                                  08600007
L5P2SM   EQU   X'C261'                                                  08650007
L5P4SM   EQU   X'C2E3'                                                  08700007
L5P15SM  EQU   X'C26E'                                                  08750007
L6P1SM   EQU   X'C3C8'                                                  08800007
L6P2SM   EQU   X'C3C9'                                                  08850007
L6P4SM   EQU   X'C34B'                                                  08900007
L6P15SM  EQU   X'C3D6'                                                  08950007
L7P16SM  EQU   X'C37F'                                                  09000007
L8P1SM   EQU   X'C4D8'                                                  09050007
L8P2SM   EQU   X'C4D9'                                                  09100007
L8P4SM   EQU   X'C45B'                                                  09150007
L8P15SM  EQU   X'C4E6'                                                  09200007
L9P16SM  EQU   X'C54F'                                                  09250007
L10P1SM  EQU   X'C5E8'                                                  09300007
L10P2SM  EQU   X'C5E9'                                                  09350007
L10P3SM  EQU   X'C56A'                                                  09400007
L10P4SM  EQU   X'C56B'                                                  09450007
L11P5SM  EQU   X'C6D4'                                                  09500007
L12P5SM  EQU   X'C67C'                                                  09550007
L3P3LG   EQU   X'C2E2'                                                  09600007
L3P25LG  EQU   X'C2F8'                                                  09650007
L4P1LG   EQU   X'C3F0'                                                  09700007
L4P23LG  EQU   X'C4C6'                                                  09750007
L5P1LG   EQU   X'C540'                                                  09800007
L5P23LG  EQU   X'C5D6'                                                  09850007
L6P1LG   EQU   X'C650'                                                  09900007
L6P20LG  EQU   X'C6E3'                                                  09950007
L6P23LG  EQU   X'C6E6'                                                  10000007
L7P1LG   EQU   X'C760'                                                  10050007
L7P21LG  EQU   X'C7F4'                                                  10100007
L7P23LG  EQU   X'C7F6'                                                  10150007
L8P1LG   EQU   X'C8F0'                                                  10200007
L8P21LG  EQU   X'C9C4'                                                  10250007
L8P23LG  EQU   X'C9C6'                                                  10300007
L9P1LG   EQU   X'4A40'                                                  10350007
L9P21LG  EQU   X'4AD4'                                                  10400007
L9P23LG  EQU   X'4AD6'                                                  10450007
L10P21LG EQU   X'4BE4'                                                  10500007
L10P23LG EQU   X'4BE6'                                                  10550007
L12P1LG  EQU   X'4DF0'                                                  10600007
*                                                                       10650007
L6P56    EQU   X'C7C7'                                                  10700007
L6P61    EQU   X'C74C'                                                  10750007
L7P50    EQU   X'C8D1'                                                  10800007
L9P22LG  EQU   X'4AD5'                                                  10850007
L9P24LG  EQU   X'4AD7'                                                  10900007
L9P35LG  EQU   X'4AE2'                                                  10950007
L10P22LG EQU   X'4BE5'                                                  11000007
L10P24LG EQU   X'4BE7'                                                  11050007
L10P35LG EQU   X'4BF2'                                                  11100007
L11P21LG EQU   X'4CF4'                                                  11150007
L11P22LG EQU   X'4CF5'                                                  11200007
L11P24LG EQU   X'4CF7'                                                  11250007
L11P35LG EQU   X'4DC2'                                                  11300007
L12P36LG EQU   X'4ED3'                                                  11350007
L13P21   EQU   X'4FD4'                                                  11400007
L13P22   EQU   X'4FD5'                                                  11450007
L13P24   EQU   X'4FD7'                                                  11500007
L13P35   EQU   X'4FE2'                                                  11550007
L14P36   EQU   X'50F3'                                                  11600007
L15P21   EQU   X'D1F4'                                                  11650007
L15P22   EQU   X'D1F5'                                                  11700007
L15P23   EQU   X'D1F6'                                                  11750007
L15P24   EQU   X'D1F7'                                                  11800007
L16P25   EQU   X'D3C8'                                                  11850007
L17P25   EQU   X'D4D8'                                                  11900007
*********************************************************************** 11950007
LG1MSG   DC    AL1(SBA),AL2(L6P20LG),AL1(SF,MNP)                        12000007
         DC    C'DEMF',AL1(SF,UNA),AL1(SBA),AL2(L6P56),AL1(SF,MNP)      12050007
         DC    C'MENU',AL1(SBA),AL2(L6P61),AL1(SF,PNA)                  12100007
 DC AL1(SBA),AL2(L7P21LG),C'TCAM VERSION'                               12150007
 DC AL1(SBA),AL2(L7P50),C'PAGE 1 OF 2'                                  12200007
 DC AL1(SBA),AL2(L8P21LG),C'TYPE IN COMMAND OR X IN ? TO DISPLAY:'      12250007
 DC AL1(SBA),AL2(L9P21LG),C'(',AL1(SBA),AL2(L9P22LG),AL1(SF,UNA)        12300007
 DC AL1(IC),C'?'                                                        12350007
 DC AL1(SBA),AL2(L9P24LG),AL1(SF,PNA),C')ALL'                           12400007
 DC AL1(SBA),AL2(L9P35LG),C'RECAP OF ERRS ON ALL LINES'                 12450007
 DC AL1(SBA),AL2(L10P21LG),C'(',AL1(SBA),AL2(L10P22LG),AL1(SF,UNA),C'?' 12500007
 DC AL1(SBA),AL2(L10P24LG),AL1(SF,PNA),C')3270'                         12550007
 DC AL1(SBA),AL2(L10P35LG),C'ERR DATA ON YOUR TERMINAL'                 12600007
 DC AL1(SBA),AL2(L11P21LG),C'(',AL1(SBA),AL2(L11P22LG),AL1(SF,UNA),C'?' 12650007
 DC AL1(SBA),AL2(L11P24LG),AL1(SF,PNA),C')REMOTE'                       12700007
 DC AL1(SBA),AL2(L11P35LG),C'TEXT OF REMOTE 327X STATUS'                12750007
 DC AL1(SBA),AL2(L12P36LG),C' AND SENSE COMBINATIONS'                   12800007
 DC AL1(SBA),AL2(L13P21),C'(',AL1(SBA),AL2(L13P22),AL1(SF,UNA),C'?'     12850007
 DC AL1(SBA),AL2(L13P24),AL1(SF,PNA),C')LOCAL'                          12900007
 DC AL1(SBA),AL2(L13P35),C'TEXT OF LOCAL 327X STATUS'                   12950007
 DC AL1(SBA),AL2(L14P36),C' AND SENSE COMBINATIONS'                     13000007
*DC AL1(SBA),AL2(L15P21),C' ',AL1(SBA),AL2(L15P22),AL1(SF,MNP),C' '     13050007
 DC AL1(SBA),AL2(L15P21),AL1(SF,MNP),C'DEPRESS '                        13100007
 DC AL1(SF,PNA),C'ENTER FOR PAGE TWO'                                   13150007
 DC C'--CONTAINS'                                                       13200007
 DC AL1(SBA),AL2(L16P25),C'COMMAND FORMATS USED TO DIRECTLY'            13250007
 DC AL1(SBA),AL2(L17P25),C'ADDRESS A LINE, CTRL UNIT, OR TERML'         13300007
LG1LTH   EQU   *-LG1MSG                                                 13350007
LG2MSG   DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP)                           13400007
         DC    C'DEMF',AL1(SF,UNA,IC),AL1(SBA),AL2(L1P35),AL1(SF,MNP)   13450007
         DC    C'MENU',AL1(SF,PNA)                                      13500007
 DC AL1(SBA),AL2(L2P1LG),C'TCAM VERSION'                                13550007
 DC AL1(SBA),AL2(L2P70),C'PAGE 2 OF 2'                                  13600007
 DC AL1(SBA),AL2(L3P3LG),C'KEY IN:'                                     13650007
 DC AL1(SBA),AL2(L3P25LG),C'YOU WILL SEE:'                              13700007
 DC AL1(SBA),AL2(L4P1LG),C'DEMF LINE LLL',AL1(SBA),AL2(L4P23LG)         13750007
 DC C'ERRS BY CONTROL UNIT ON SELECTED LINE LLL'                        13800007
 DC AL1(SBA),AL2(L5P1LG),C'DEMF CTRL LLL CC',AL1(SBA),AL2(L5P23LG)      13850007
 DC C'ERRS BY TERMINAL ON REMOTE CONTROL UNIT LLL CC'                   13900007
 DC AL1(SBA),AL2(L6P1LG),C'DEMF CTRL CCC',AL1(SBA),AL2(L6P23LG)         13950007
 DC C'ERRS BY TERMINAL ON LOCAL CONTROL UNIT CCC'                       14000007
 DC AL1(SBA),AL2(L7P1LG),C'DEMF 3270 LLL CC TT',AL1(SBA),AL2(L7P23LG)   14050007
 DC C'ERR DESCRIPTIVE DATA OF REMOTE TERMINAL LLL CC TT'                14100007
 DC AL1(SBA),AL2(L8P1LG),C'DEMF 3270 TTT',AL1(SBA),AL2(L8P23LG)         14150007
 DC C'ERR DESCRIPTIVE DATA OF LOCAL TERMINAL TTT'                       14200007
 DC AL1(SBA),AL2(L9P1LG),C'DEMF 3270 SYMBNAME',AL1(SBA),AL2(L9P23LG)    14250007
 DC C'ERR DESCRIPTIVE DATA OF LOCAL OR REMOTE TERMINAL'                 14300007
 DC AL1(SBA),AL2(L10P23LG),C'WITH TCAM NAME',AL1(SBA),AL2(L12P1LG)      14350007
 DC C'TYPE X IN PLACE OF ? ON ALL DISPLAYS TO PAGE OR VIEW LOWER'       14400007
 DC C' LEVEL OF DETAIL'                                                 14450007
LG2LTH   EQU   *-LG2MSG                                                 14500007
SM1MSG   DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP)                           14550007
         DC    C'DEMF',AL1(SF,UNA),AL1(SBA),AL2(L1P35),AL1(SF,MNP)      14600007
         DC    C'MENU',AL1(SF,PNA),C'TCAM VERSION'                      14650007
 DC AL1(SBA),AL2(L2P29SM),C'PAGE 1 OF 2'                                14700007
 DC AL1(SBA),AL2(L3P1SM),C'TYPE IN COMMAND OR X IN ? TO DISPLAY:'       14750007
 DC AL1(SBA),AL2(L4P1SM),C'(',AL1(SBA),AL2(L4P2SM),AL1(SF,UNA)          14800007
 DC AL1(IC),C'?'                                                        14850007
 DC AL1(SBA),AL2(L4P4SM),AL1(SF,PNA),C')ALL'                            14900007
 DC AL1(SBA),AL2(L4P15SM),C'RECAP OF ERRS ON ALL LINES'                 14950007
 DC AL1(SBA),AL2(L5P1SM),C'(',AL1(SBA),AL2(L5P2SM),AL1(SF,UNA),C'?'     15000007
 DC AL1(SBA),AL2(L5P4SM),AL1(SF,PNA),C')3270'                           15050007
 DC AL1(SBA),AL2(L5P15SM),C'ERR DATA ON YOUR TERMINAL'                  15100007
 DC AL1(SBA),AL2(L6P1SM),C'(',AL1(SBA),AL2(L6P2SM),AL1(SF,UNA),C'?'     15150007
 DC AL1(SBA),AL2(L6P4SM),AL1(SF,PNA),C')REMOTE'                         15200007
 DC AL1(SBA),AL2(L6P15SM),C'TEXT OF REMOTE 327X STATUS'                 15250007
 DC AL1(SBA),AL2(L7P16SM),C' AND SENSE COMBINATIONS'                    15300007
 DC AL1(SBA),AL2(L8P1SM),C'(',AL1(SBA),AL2(L8P2SM),AL1(SF,UNA),C'?'     15350007
 DC AL1(SBA),AL2(L8P4SM),AL1(SF,PNA),C')LOCAL'                          15400007
 DC AL1(SBA),AL2(L8P15SM),C'TEXT OF LOCAL 327X STATUS'                  15450007
 DC AL1(SBA),AL2(L9P16SM),C' AND SENSE COMBINATIONS'                    15500007
*DC AL1(SBA),AL2(L10P1SM),C' ',AL1(SBA),AL2(L10P2SM),AL1(SF,MNP),C' '   15550007
 DC AL1(SBA),AL2(L10P1SM),AL1(SF,MNP),C'DEPRESS '                       15600007
 DC AL1(SF,PNA),C'ENTER FOR PAGE TWO'                                   15650007
 DC C'--CONTAINS'                                                       15700007
 DC AL1(SBA),AL2(L11P5SM),C'COMMAND FORMATS USED TO DIRECTLY'           15750007
 DC AL1(SBA),AL2(L12P5SM),C'ADDRESS A LINE, CTRL UNIT, OR TERM'         15800007
SM1LTH   EQU   *-SM1MSG                                                 15850007
SM2MSG   DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP)                           15900007
         DC    C'DEMF',AL1(SF,UNA,IC),AL1(SBA),AL2(L1P35),AL1(SF,MNP)   15950007
         DC    C'MENU',AL1(SF,PNA)                                      16000007
         DC    CL40'TCAM VERSION                PAGE 2 OF 2'            16050007
         DC    CL40'  KEY IN:               YOU WILL SEE:'              16100007
         DC    CL40'DEMF LINE LLL       ERRS BY CONTROL UNIT'           16150007
         DC    CL40'DEMF CTRL LLL CC    ERRS BY REMOTE TERML'           16200007
         DC    CL40'DEMF CTRL CCC       ERRS BY LOCAL TERML'            16250007
         DC    CL40'DEMF 3270 LLL CC TT STATUS OF RMOT TERML'           16300007
         DC    CL40'DEMF 3270 TTT       STATUS OF LOCL TERML'           16350007
         DC    CL40'DEMF 3270 SYMBNAME  STATUS OF RMT OR LOC'           16400007
         DC    CL40'                    TERML WITH TCAM NAME'           16450007
         DC    CL40'TYPE X IN PLACE OF ? ON ALL DISPLAYS TO'            16500007
         DC    CL40' PAGE OR VIEW LOWER LEVEL OF DETAIL'                16550007
SM2LTH   EQU   *-SM2MSG                                                 16600007
         LTORG                                                          16650007
         END   BNGTMENU                                                 16700007
./  ADD  SSI=81730354,NAME=BNGTQEMA
         PRINT OFF                                                      00050007
         MACRO                                                          00050407
&NAME    BNGHJN &LABEL,&HJN                                             00050807
         LCLC  &HJA,&HJB                                                00051207
&HJA     SETC  '&SYSPARM'(1,4)                                          00051607
&HJB     SETC  '&SYSPARM'(5,4)                                          00052007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00052407
         B     &LABEL .                 BR AROUND CONSTANTS             00052807
         SPACE 2                                                        00053207
.NOBRNCH ANOP                                                           00053607
         AIF   ('&NAME' EQ '').NOLABEL                                  00054007
         DC    C'&NAME' .              MODULE IDENTIFIER                00054407
.NOLABEL ANOP                                                           00054807
         DC    X'&HJA' .                DATE OF MODIFICATION            00055207
         AIF   ('&HJN' NE 'HJN').DATE                                   00055607
         DC    X'&HJB' .                HJN OF MODIFICATION             00056007
.DATE    ANOP                                                           00056407
         AIF   ('&LABEL' EQ '').NOLBL                                   00056807
         SPACE 2                                                        00057207
&LABEL   DS    0H                                                       00057607
.NOLBL   ANOP                                                           00058007
         MEND                                                           00058407
         PRINT ON                                                       00058807
*********************************************************************** 00059207
*                                                                     * 00100000
* MODULE NAME = BNGTQEMA                                              * 00150000
*                                                                     * 00200000
* DESCRIPTIVE NAME = TCAM DEMF QUEUE CONTROL MODULE                   * 00250000
*                                                                     * 00300000
* COPYRIGHT = NONE                                                    * 00350000
*                                                                     * 00400000
* STATUS = RELEASE 1, LEVEL 1                                         * 00450000
*                                                                     * 00500000
* FUNCTION = 1) DETERMINES WHETHER THE REQUEST PASSED OVER FROM MCP   * 00550000
*               IS 'DEMF' REQUEST, IF NOT, PASS CONTROL BACK TO MCP   * 00600000
*               WITH ERROR INDICATION;                                * 00650000
*            2) IF THE REQUEST IS 'DEMF', FORWARD DEMF MESSAGE QUEUE  * 00700000
*               TO MCP WHEN PASSING CONTROL BACK TO IT;               * 00750000
*            3) INITIATES SOME MESSAGE REQUESTS TO BNGTQEMF MODULE    * 00800000
*               FOR BEING DISPLAYED TO THE 3270 DISPLAY TERMINAL.     * 00850000
*                                                                     * 00900000
* NOTES = NONE                                                        * 00950000
*                                                                     * 01000000
*    DEPENDENCIES = NONE                                              * 01050000
*                                                                     * 01100000
*    RESTRICTIONS = NONE                                              * 01150000
*                                                                     * 01200000
*    REGISTER CONVENTIONS = SEE REGISTERS EQU'S BELOW                 * 01250000
*                                                                     * 01300000
*    PATCH LABEL = PATCH                                       @OY20942 01350007
*                                                                     * 01400000
* MODULE TYPE =  TCAM DISPLAY                                         * 01450000
*                                                                     * 01500000
*    PROCESSOR = ASSEMBLER H                                          * 01550000
*                                                                     * 01600000
*    MODULE SIZE =  972 DECIMAL BYTES                                 * 01650000
*                                                                     * 01700000
*    ATTRIBUTES =                                                     * 01750000
*                                                                     * 01800000
* ENTRY POINT = BNGTQEMA                                              * 01850000
*                                                                     * 01900000
*    PURPOSE = SEE FUNCTION                                           * 01950000
*                                                                     * 02000000
*    LINKAGE = R1  LOADED WITH THE PARAM LIST POINTER                 * 02050000
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 02100000
*              R15 LOADED WITH ENTRY POINT                            * 02150000
*                                                                     * 02200000
* INPUT = PARAM LIST ITEMS USED ARE :                                 * 02250000
*                                                                     * 02300000
* OUTPUT = PARAM LIST ITEMS USED ARE :                                * 02350000
*                                                                     * 02400000
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 02450000
*               00 - OPERATION PERFORMED AS REQUESTED                 * 02500000
*                                                                     * 02550000
* EXIT-ERROR  = NONE                                                  * 02600000
*                                                                     * 02650000
* EXTERNAL REFERENCE = NONE                                           * 02700000
*                                                                     * 02750000
*    ROUTINES =                                                       * 02800000
*                                                                     * 02850000
*    DATA AREAS =                                                     * 02900000
*                                                                     * 02950000
*    CONTROL BLOCK = DCB                                              * 03000000
*                                                                     * 03050000
* TABLES = NONE                                                       * 03100000
*                                                                     * 03150000
* MACROS = RETURN                                                     * 03200000
*                                                                     * 03250000
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 03300000
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 03300107
* CHANGE 02  02/22/78  BNGHJN MACRO ADDED                             * 03300207
*C061000-062500,197000                                         @OZ29913 03300307
*A226500                                                       @OZ29913 03300407
*D198500                                                       @OZ29913 03300507
*C081000-085000,172500                                         @OZ29899 03300607
*C173500-174000                                                @OZ29898 03300707
*C013500                                                       @OY20942 03300807
*A088000,226820                                                @OY20942 03300907
*                                                                     * 03400000
*********************************************************************** 03450000
BNGTQEMA CSECT                                                          03500000
**********************************************************************  03550000
* THIS MODULE IS LINKED WITH THE USER MCP BY ISSUING THE MACRO          03600000
* DEMF IN A MESSAGE HANDLER.  IT IS PASSED A PARM FIELD IN THE          03650000
* DEMF MACRO,WHICH IT USES TO PASS TO THE DEMF DISPLAY PROGRAMS         03700000
* THE LINE ADDRESS THE MODEL TYPE AND WHETHER THE TERMINAL IS A         03750000
* LOCAL OR REMOTE DEVICE.                                               03800000
*  INPUT   REGISTER ONE ADDRESS OF PARM FIELD IN MCP                    03850000
*          ADDRESS OF BUFFER AT AVTADBUF IN AVT                         03900000
*  OUTPUT  HARDWARE ADDRESS, MODEL AND TYPE IN PARM FIELD IF DEMF       03950000
*  RETURN CODES                                                         04000000
*     NOT A DEMF REQUEST   RC8 BR TO NSI                                04050000
*     DEMF REQUEST         RC0 BR TO NSI +4                             04100000
**********************************************************************  04150000
R0       EQU   0                                                        04200000
R1       EQU   1                                                        04250000
R2       EQU   2                                                        04300000
RWK      EQU   2                                                        04350000
RSCB     EQU   3                   TCAM SCB REG                         04400000
RLCB     EQU   4                   TCAM LCB REG                         04450000
RWK2     EQU   5                                                        04500000
RBFR     EQU   6                   TCAM BUFFER REG                      04550000
R7       EQU   7                                                        04600000
R8       EQU   8                   EMF PARM REG                         04650000
RAVT     EQU   9                   TCAM AVT REG                         04700000
R10      EQU   10                                                       04750000
R11      EQU   11                                                       04800000
RBASE    EQU   12                  BASE REGISTER                        04850000
R13      EQU   13                                                       04900000
R14      EQU   14                                                       04950000
R15      EQU   15                                                       05000000
M3270    EQU   X'04'                                                    05050000
EMF327L  EQU   X'02'                                                    05100000
ENTKY    EQU   X'7D'                                                    05150000
SBA      EQU   X'11'                                                    05200000
RC8      EQU   8                   RETURN CODE WHEN DENO DEMF           05250000
R3270    EQU   X'91'                                                    05300000
L3270    EQU   X'99'                                                    05350000
MODONE   EQU   X'F1'                                                    05400000
UCBMONE  EQU   X'11'                                                    05450000
CVTOFF   EQU   16                                                       05500000
SOH      EQU   X'02'                                                    05550000
FOX0     EQU   240                                                      05600000
FOXONE   EQU   241                                                      05650000
FOXFOX   EQU   255                                                      05700000
MODTWO   EQU   242                                                      05750000
TERMSK   EQU   224                 MASK FOR TERMINAL IN TRM ENTRY       05800000
TRMLGB   EQU   128                 MASK FOR LGB INSTEAD OF TRM          05850000
TRMVTAM  EQU   16                  MASK FOR VTAM OR NCP TERMINAL ENTRY  05900000
         EJECT                                                          05950000
****  FOLLOWING IS INITILAZATION CODE FOR PROGRAM                       06000000
         USING BNGTQEMA,R15                                             06050000
BNGTQEMA BNGHJN GO                                             @OZ29913 06100007
         STM   R14,RBASE,12(R13)       SAVE CALLERS REGISTERS           06300000
         L     RAVT,CVTOFF             LOAD CVT ADDRESS                 06350000
         L     RAVT,AVTCVTPT(,RAVT)    LOAD TCX ADDRESS                 06400000
         L     RAVT,AVTZERO(,RAVT)     LOAD AVT ADDRESS                 06450000
         USING IEDQAVTD,RAVT                                            06500000
         LR    RBASE,R13              LOAD CALLERS ADDRESS              06550000
         LA    R13,72(R13)            LOAD MY SAVE ADDRESS              06600000
         ST    RBASE,4(R13)           CONTENTS OF RAVT STORED           06650000
         ST    R13,8(RBASE)           STORE SAVE ADDRESS                06700000
         L     RBFR,AVTADBUF          INIT BUFFER REG                   06750000
         USING IEDQPRF,RBFR                                             06800000
         L     RLCB,PRFLCB-1          INIT LCB REG                      06850000
         USING IEDQLCB,RLCB                                             06900000
         L     RSCB,LCBSCBA-1         SET UP SCB REG                    06950000
         USING IEDQSCB,RSCB                                             07000000
         LR    RBASE,R15              SWITCH BASE REGS                  07050000
         USING BNGTQEMA,RBASE                                           07100000
         DROP  R15                                                      07150000
         LR    R8,R1                  LOAD PARM REG                     07200000
         USING EMF,R8                                                   07250000
         EJECT                                                          07300000
****  FOLLOWING DETERMINES IF THIS IS A DEMF REQUEST AND IF SO, IS      07350000
****  IT FROM A 3270 TERMINAL.                                          07400000
         XC    0(10,R8),0(R8)         CLEAR PARM AREA                   07450000
         TM    PRFSTAT1,PRFTSMSG+PRFNHDRN   TSO OR TXT BFR?             07500000
         BNZ   NODEMF                 RETURN IF EITHER                  07550000
         TM    SCBSTATE,SCBLCK1N       IS TERMINAL LOCKED ?             07600000
         BO    NODEMF                  RETURN IF IT IS                  07650000
         LH    R1,PRFSRCE              GET SOURCE INDEX                 07700000
         N     R1,AVTCLRHI           IS IT ZERO                         07750000
         BZ    NODEMF                  RETURN IF SO                     07800000
         L     R15,AVTRNMPT            LOAD TNT LOOK-UP ADDRESS         07850000
         BALR  R14,R15                 DO TNT LOOK-UP                   07900000
         SR    R15,R15                 ZERO WORK REG                    07950000
         IC    R15,16(R1)              GET CH TABLE INDES               08000000
         BCTR  R15,0                   SUBTRACT ONE                     08050000
         SR    RWK2,RWK2               CLEAR REG               @OZ29899 08100007
         LA    RWK2,4                  LOAD REG WITH A FOUR (4)@OZ29899 08140007
         SR    RAVT,RWK2               BACK AVT UP FOUR (4)    @OZ29899 08180007
         CLI   2(RAVT),X'C1'           IS IT C'A' = TCAM10 ?   @OZ29899 08220007
         BE    TCAM10                  YES, BRANCH             @OZ29899 08260007
         SLL   R15,2                   NO, TCAM9, MULT BY FOUR @OZ29899 08300007
         B     CONT                                            @OZ29899 08340007
TCAM10   MH    R15,=H'6'               TCAM10, MULT BY SIX     @OZ29899 08380007
CONT     AR    RAVT,RWK2               RESTORE RAVT BACK       @OZ29899 08420007
         A     R15,AVTCSTCS            ADD TO START OF TABLE            08550000
         TM    1(R15),M3270            IS IT A 3270 ?                   08600000
         BZ    NODEMF                  NO, RETURN                       08650000
         TM    11(R1),TRMVTAM      IS THIS A NCP TERMINAL?              08700000
         BO    NODEMF              YES,DO NOT HONOR REQUEST             08750000
         LA    RWK,14                  LOAD MAX DISL TO SCAN            08800000
         SR    RWK2,RWK2                CLEAR REG FOR WORK     @OY20942 08805007
         LH    RWK2,PRFSIZE             GET LENGTH OF BUFFER   @OY20942 08810007
         CH    RWK2,MAXSIZE             MORE DATA THAN WE NEED @OY20942 08815007
         BH    DEFLEN                   YES, TAKE DEFAULT      @OY20942 08820007
         SH    RWK2,X1E                 REDUCE BY BUFFER HDR   @OY20942 08825007
         BNP   DEFLEN                     LENGTH FOR DATA LEN  @OY20942 08830007
         LR    RWK,RWK2                 SET UP SCAN REG        @OY20942 08835007
DEFLEN   EQU   *                                               @OY20942 08840007
         SR    RWK2,RWK2               CLEAR WORK REG                   08850000
         IC    RWK2,LCBISZE            GET IDLES                        08900000
         AR    RWK2,RBFR               ADD BUFFER ADDRESS               08950000
         LA    RWK2,42(0,RWK2)         ADD SIZE OF TCAM HDR             09000000
SECCMP   CLI   0(RWK2),ENTKY     IS THIS ENTER KEY                      09050000
         BE    FIRSTCMP            YES,BR                               09100000
         LA    RWK2,1(0,RWK2)      BUMP UP SCAN ADDRESS                 09150000
         BCT   RWK,SECCMP          DEC AND CONTINUE SCAN FOR ENTER KEY  09200000
         B     NODEMF              DID NOT HIT ENTER KEY                09250000
FIRSTCMP CLC   0(4,RWK2),DEMFCON       IS THIS EMF REQUEST              09300000
         BE    FNDEMF                  YES BR CONTINUE                  09350000
         CLC   0(4,RWK2),DEMFLOW       MAYBE IN LOWER CASE              09400000
         BE    FNDEMF                  YES,BR                           09450000
         LA    RWK2,1(0,RWK2)                                           09500000
         BCT   RWK,FIRSTCMP                                             09550000
         B     NODEMF                                                   09600000
         EJECT                                                          09650000
FNDEMF   EQU   *                                                        09700000
* AT THIS POINT WE HAVE DETERMINED THAT THIS MESSAGE IS A REQUEST       09750000
* FOR DEMF.  THIS MODULE WILL NOW INSERT CERTAIN INFORMATION IN THE     09800000
* PARM FIELD OF THE DEMF MACRO FOR THIS REQUEST                         09850000
*         IF THE REQUEST IS FROM A LOCAL 3270                           09900000
*             1. THE LINE ADDRESS                                       09950000
*             2. MODEL TYPE                                             10000000
*          IF THE REQUEST IS FROM A REMOTE 3270                         10050000
*              1. THE LINE ADDRESS                                      10100000
*              2. THE CONTROL UNIT POLL CHAR                            10150000
*              3. THE TERMINAL POLL CHAR                                10200000
* IF THE REQUEST IS FOR TERMINAL INFORMATION BY SYMBOLIC NAME, CHECKS   10250000
* ARE MADE IF THE REQUESTED INFORMATION IS FOR A TCAM TERMINAL WHOSE    10300000
* LINE IS OPENED AND NOT NCP.  IF SO, THE PARM FIELD OF THE DEMF MACRO  10350000
* IS OVERLAYED WITH THE HARDWARE ADDRESS AND MODEL TYPE OF THE REQUEST  10400000
**********************************************************************  10450000
         OC    0(4,RWK2),FORTY         MAKE IT UPPERCASE                10500000
         MVI   EMFSTAT,R3270           TURM ON REMOTE FLAG              10550000
         TM    2(R15),EMF327L          IS THIS A LOCAL                  10600000
         BZ    RMT3270                 NO BR ITS A REMOTE               10650000
         MVI   EMFSTAT,L3270           TURN ON LOCAL FLAG               10700000
*********    DETERMINE LINE ADDRESS AND STORE IT     *********          10750000
*********    IN PARM FIELD OF IEDEMFCB                          *****   10800000
RMT3270  SR    R7,R7                   CLEAR REGISTER                   10850000
         IC    R7,LCBUCBX              RELATIVE LINE NUMBER             10900000
         L     RWK,LCBDCBPT            GET DCB ADR                      10950000
         L     RWK,44(RWK)             LOAD ADR OF DEB                  11000000
         LA    RWK,32(RWK)             POINT TO LIST OF UCB             11050000
         LA    R7,1(R7)                BUMP BY ONE FOR BCT              11100000
DO574    BCT   R7,DO576                                                 11150000
         B     DO578                                                    11200000
DO576    LA    RWK,4(RWK)              BCT TO RLN UCB                   11250000
         B     DO574                                                    11300000
DO578    L     RWK,0(RWK)              POINT TO UCB                     11350000
         MVC   EMFLADR(3),13(RWK)      MOVE LINE ADR                    11400000
*********   FOLLOWING CODE FINDS MODEL TYPE OF 3270 FROM UCB   ****     11450000
         MVI   EMFMODEL,MODTWO         ASSUME 3277 MODEL TWO            11500000
         CLI   EMFSTAT,R3270           IS INPUT FROM A REMOTE 3270      11550000
         BE    MODEL2                  YES,BR MODEL NOT IN UCB          11600000
         TM    16(RWK),UCBMONE         IS IT A 3277 MODEL ONE           11650000
         BNO   MODEL2                  BR, IT IS A MODEL TWO            11700000
         MVI   EMFMODEL,MODONE         MAKE IT A MODEL ONE              11750000
MODEL2   EQU   *                                                        11800000
         EJECT                                                          11850000
*********  DETERMINE IF USER ENTERED TERMINAL SYMBOLIC NAME   ***       11900000
*********  AND IF SO CONVERT IT TO HARDWARE ADDRESS           ***       11950000
         LA    R7,12(0,RBFR)       BUFFER ADR PLUS PREFIX               12000000
         AH    R7,PRFSIZE          ADD DATA SIZE                        12050000
         SR    R7,RWK2             LGTH OF DATA ENTERED IN R7           12100000
         BNP   DO579               BR,IF R7 NOT PLUS NO DATA ENTERED    12150000
         STH   R7,LTHSAVE          SAVE LTH OF DATA ENTERED             12200000
         CLI   LTHSAVE+1,10        WAS MORE THAN 10 CHAR ENTERED        12250000
         BNH   DO579               BR,LESS THAN 11 CHAR ENTERED         12300000
         CLI   4(RWK2),SBA         IS IT FROM FORMATTED SCREEN?         12350000
         BNE   DO5781              BR,NO                                12400000
         LA    RWK2,2(0,RWK2)      ADD TWO FOR THE CU TERM POLL CHARS   12450000
         BCTR  R7,R0               SUBTRACT                             12500000
         BCTR  R7,R0               TWO FROM LTH ENTERED                 12550000
         STH   R7,LTHSAVE          SAVE IT                              12600000
         CLI   LTHSAVE+1,10        IS LTH GREATER THAN 10               12650000
         BNH   DO579               BR,NO NOT SYMBOLIC NAME CONVERT      12700000
DO5781   EQU   *                                                        12750000
         CLC   5(4,RWK2),=C'3270'  IS 3270 2ND PARM                     12800000
         BNE   DO579               BR,NO NEED TO CONVERT NAME           12850000
         CLI   10(RWK2),240        WAS A NUMERICAL LINE ENTERED         12900000
         BNL   DO579               BR,YES DO NOT CONVERT                12950000
         CLI   9(RWK2),SBA         IS IT SBA                            13000000
         BE    DO579               YES,BR DID NOT ENTER SYMBOLIC NAME   13050000
         LA    R11,10(0,RWK2)      POINT R11 TO SYMBOLIC NAME           13100000
         LA    RBFR,0(0,RBFR)      CLEAR HIGH ORDER BYTE                13150000
         SR    R11,RBFR            R11 HAS AMOUNT OF DATE TO SYM NAME   13200000
         LA    R10,12(0)           BUFFER PREFIX LGTH IN R10            13250000
         AH    R10,PRFSIZE         PLUS LGTH OF DATA ENTERED            13300000
         SR    R10,R11             MINUS LENGTH UP TO SYMBOLIC NAME     13350000
*                                 EQUALS LENGTH OF SYMBOLIC NAME IN R10 13400000
         BNP   DO579               BR, IF NOT PLUS DID NOT ENTER        13450000
*                                  SYMBOLIC NAME.  IF R10 IS PLUS IT    13500000
*                                  CONTAINS LENGTH OF NAME PLUS ANY     13550000
*                                  SPACES PLUS TRAILING LINE CONTROL    13600000
***   GETTING TO THIS POINT MEANS USER ENTERED A DEMF REQUEST BY        13650000
***   SYMBOLIC NAME. SO CHECK IT TO SEE IF WE CAN CONVERT IT TO A       13700000
***   HARDWARE ADDRESS.                                                 13750000
         SR    R7,R7               CLEAR FOR LATER USE                  13800000
         LA    R10,1(0,R10)        SET R10 UP ONE FOR BCT               13850000
         LA    RWK,10(0,RWK2)      POINT RWK TO SYMBOLIC NAME           13900000
RFOUND   L     R11,AVTRNMPT        TNT ADDRESS                          13950000
         USING IEDQTNT,R11         R11 WILL HAVE TNT PREFIX             14000000
         SR    R15,R15             CLEAR REG                            14050000
         IC    R15,TNTENLEN        MAXIMUM TERMNAME LTH IN R15          14100000
         CLR   R15,R10             IS MAX LTH GREATER THAN DATA ENTERED 14150000
         BNL   AGAIN               YES,BR LEAVE R10 AS IS               14200000
         LR    R10,R15             LIMIT SEARCH TO MAX TERMNAME LENGTH  14250000
AGAIN    LA    R7,1(0,R7)          ADD ONE TO LENGTH OF NAME ENTERED    14300000
         CLI   0(RWK),90           IS IT A VALID CHAR                   14350000
         BNL   NOTFOUND            BR,HAVE NOT FOUND LAST CHAR          14400000
         B     FOUND                                                    14450000
NOTFOUND LA    RWK,1(0,RWK)        LOOK AT NEXT CHAR                    14500000
         BCT   R10,AGAIN           BR,STILL GOT DATA TO LOOK AT         14550000
FOUND    BCTR  R7,R0               SUBTRACT ONE FOR EXEC MOVE           14600000
         BCTR  R7,R0               ONE MORE                             14650000
         CLR   R15,R7              MAKE SURE NAME ENTERED IS NOT        14700000
         BNL   NOREV               LONGER THAN MAXIMUM LENGTH           14750000
         LR    R7,R15              OF TERMINAL NAMES IN TCAMS TNT       14800000
         BCTR  R7,R0                                                    14850000
NOREV    EQU   *                                                        14900000
         MVC   SYMNAME,FORTY       CLEAR TO BLANKS                      14950000
         EX    R7,MVNAME           OR NAME INTO FIELD INTO UPPER CASE   15000000
         STC   R7,R7SAVE           SAVE LENGTH OF NAME FOR LATER USE    15050000
         ST    RWK2,RWK2SAVE       SAVE ADR OF DATA ENTERED FOR LATER   15100000
         SR    RWK,RWK             CLEAR                                15150000
         LH    RWK2,TNTLEN         GET NUMBER OF TERMINAL ENTRIES       15200000
         N     RWK2,AVTCLRHI       CLEAR LEFT HALF OF REGISTER          15250000
         SR    R10,R10             CLEAR                                15300000
         IC    R10,TNTENLEN        MAXIMUM TERMNAME LENGTH              15350000
         BCTR  R10,R0              SUB ONE FOR EXEC                     15400000
         LA    R7,TNTFIRST         GET FIRST ENTRY ADDRESS              15450000
         DROP  R11                                                      15500000
TESTTRM  EQU   *                                                        15550000
         LA    RWK,1(RWK)          UPDATE OFFSET CNTR                   15600000
         CR    RWK,RWK2            END OF TNT                           15650000
         BH    DO590               NO SYMBOLIC NAME IN TCAM TNT         15700000
         EX    R10,COMPNAME        COMPARE NAMES                        15750000
         BE    NAMEMAT             NAME                                 15800000
         LA    R7,4(R10,R7)        POINT TO NEXT ENTRY                  15850000
         B     TESTTRM             CHECK NEXT ENTRY                     15900000
NAMEMAT  EQU   *                                                        15950000
***   GETTING TO HERE MEANS USER ENTERED A SYMBOLIC NAME THAT IS IN     16000000
***   TCAM TERMINAL NAME TABLE.  SO CHECK TO SEE IF IT IS A TCAM        16050000
***   TERMINAL THAT WE CAN CONVERT TO A HARDWARE ADDRESS.               16100000
         LA    R7,0(R7,R10)        ADD LENGTH TO GET ADR OF TRM         16150000
         MVC   TERMADR,0(R7)       MOVE ADR TO WORD FOR LOAD            16200000
         L     R10,TERMADR         TERMINAL TRM IN REG10                16250000
*              CHECK TO ENSURE THIS IS A TERMINAL ENTRY                 16300000
         CLI   5(R10),TRMLGB       IS THIS A NCP LGB                    16350000
         BE    FO2                 BR,YES A NCP TERMINAL DONOT CONVERT  16400000
         TM    11(R10),TRMVTAM     IS THIS A VTAM TERMINAL ENTRY        16450000
         BO    FO3                 BR,YES DO NOT CONVERT                16500000
         TM    0(R10),TERMSK       IS THIS A TCAM TERMINAL ENTRY        16550000
         BNE   DO590               BR,NO NOT A TERMINAL ENTRYSO IT      16600000
*                                  WILL NOT HAVE ADDRESSING CHARACTERS  16650000
         L     R7,0(R10)           QCB ADR IN R7                        16700000
         L     RWK2,32(R7)         DCB OR LGB ADR IN RWK2               16750000
         CLI   27(RWK2),64         IS THIS A DCB, IS IT NON NCP         16800000
         BNE   FO3                 BR IT IS A NCP TERMINAL,NO CONVERT   16850000
         TM    48(RWK2),16       IS THE DCB OPENED?                     16900000
         BNO   FO5                 BR,NO CAN NOT FIND LINE ADR          16950000
***  GETTING TO HERE MEANS WE HAVE A TCAM TERMINAL ENTRY THAT WE        17000000
***  WILL CONVERT TO A REAL HARDWARE ADDRESS.                           17050000
         SR    R15,R15                                                  17100000
         IC    R15,16(R10)         GET CH TABLE INDEX                   17150000
         BCTR  R15,0               SUB ONE                              17200000
         SR    RWK2,RWK2               CLEAR REG               @OZ29899 17250007
         LA    RWK2,4                  LOAD REG WITH A FOUR (4)@OZ29899 17255007
         SR    RAVT,RWK2               BACK AVT UP FOUR (4)    @OZ29899 17260007
         CLI   2(RAVT),X'C1'           IS IT C'A' = TCAM10 ?   @OZ29899 17265007
         BE    TCAM10A                 YES, BRANCH             @OZ29899 17270007
         SLL   R15,2                   NO, TCAM9, MULT BY FOUR @OZ29899 17275007
         B     CONTA                                           @OZ29899 17280007
TCAM10A  MH    R15,=H'6'               TCAM10, MULT BY SIX     @OZ29899 17285007
CONTA    AR    RAVT,RWK2               RESTORE RAVT BACK       @OZ29899 17290007
         A     R15,AVTCSTCS        ADD TO START OF TABLE                17300000
         TM    1(R15),M3270        IS IT A 3270 ?              @OZ29898 17350007
         BZ    FO6                 NO, DO NOT CONVERT          @OZ29898 17380007
         MVI   STATSW,R3270        TURN ON REMOTE                       17450000
         TM    2(R15),EMF327L      IS IT A LOCAL                        17500000
         BZ    UPFOUR              NO,BR IT IS A REMOTE                 17550000
         MVI   STATSW,L3270                                             17600000
UPFOUR   EQU   *                                                        17650000
         SR    RWK2,RWK2           CLEAR                                17700000
         IC    RWK2,32(R7)         RELATIVE LINE NUM IN R7              17750000
         L     RWK,32(0,R7)        LOAD ADR OF DCB IN RWK               17800000
         L     RWK,44(0,RWK)       LOAD ADR OF DEB IN RWK               17850000
*                                  FOLLOWING CHECKS TO SEE IF THE LINE  17900000
*                                  IS OPEN. AT X'10' IN THE DEB IS THE  17950000
*                                  NUMBER OF EXTENTS, SO A COMPARISION  18000000
*                                  IS MADE BETWEEN THE NO. OF EXTENTS   18050000
*                                  AND THE REL. LINE NO.  THE REL LINE  18100000
*                                  NO. BEING HIGHER MEANS THE LINE IS   18150000
*                                  NOT OPEN AND WE CAN NOT GET LINE ADR 18200000
         SR    R11,R11             CLEAR                                18250000
         IC    R11,16(0,RWK)       INSERT NO. EXTENT IN R11 FROM DEB    18300000
         CR    R11,RWK2            COMPARE NO. EXTENTS TO REL LINE NO.  18350000
         BL    FO7                 BR, CANNOT CONVERT TO HARDWARE ADR   18400000
*                                  BECAUSE LINE IS NOT OPENED.          18450000
*                                  ***       END OF ROUTINE      ***    18500000
         LA    RWK,32(RWK)         POINT TO LIST OF UCBS                18550000
CO574    BCT   RWK2,CO576                                               18600000
         B     CO578                                                    18650000
CO576    LA    RWK,4(RWK)          BCT TO RLN                           18700000
         B     CO574                                                    18750000
CO578    SR    R7,R7               CLEAR                                18800000
         IC    R7,R7SAVE           RESTORE SYMBOLIC NAME LTH IN R7      18850000
         LA    R7,FOX0(0,R7)       TURN ON F0 BITS TO INDICATE SWITCH   18900000
         STC   R7,EMFSIZE          STORE IT IN SIZE FIELD FOR QEMF      18950000
         L     RWK,0(RWK)          POINT TO UCB                         19000000
         MVC   EMFLADR(3),13(RWK)  MOVE LINE ADR                        19050000
         MVC   EMFSTAT,STATSW      MOVE LOCAL-REMOTE INDICATOR          19100000
         CLI   STATSW,L3270       IS IT A LOCAL 3270                    19150000
         BE    DO590               YES,BR ALL FINISHED CONVERTING       19200000
         TM    0(R10),2            ARE OPTIONS FIELDS USED              19250000
         BZ    NOOPT               BR,NO OPTIONS FIELDS                 19300000
         SR    R7,R7               CLEAR                                19350000
         IC    R7,17(0,R10)        GET NO. OF OPTION FIELDS             19400000
         LA    R7,3(R10,R7)        ADD OFFSET                           19450000
NOOPT    EQU   *                   REG7 POINTS INTO TRM AT-17 BEFORE    19500000
*                                  ADDRESSING CHARACTERS                19550000
         SR    RWK,RWK             CLEAR                                19600000
         IC    RWK,18(0,R7)        GET CTRL UNIT ADR                    19650000
         LA    RWK,CUTBL(RWK)           POINT TO CU ADDR CHAR  @OZ29913 19700007
         MVC   EMFCTADR(1),0(RWK)       STORE IT IN EMF PARM   @OZ29913 19710007
         IC    RWK,20(0,R7)        GET TERMINAL ADR                     19750000
         STC   RWK,EMFCUADR        STORE IT IN EMF PARM                 19800000
         B     DO590               FINISHED CONVERT RETURN              19900000
DO579    CLI   EMFSTAT,L3270           IS IT A 3270 LOCAL               19950000
         BE    DO590                   YES, BR                          20000000
*  IT IS A REMOTE 3270 SO GET TERMINAL  ADDRESSING CHARACTERS INTO PAR  20050000
         SR    RWK2,RWK2               CLEAR                            20100000
         IC    RWK2,LCBISZE            GET IDLES                        20150000
         AR    RWK2,RBFR               ADD BUFFER ADDRESS               20200000
         LA    RWK2,42(0,RWK2)         ADD SIZE OF HEADER               20250000
*        RWK2 POINTS TO FIRST DATA BYT E                                20300000
         CLI   0(RWK2),X'02'           IS IT STX                        20350000
         BNE   DO580                   NO MUST BE ADDRESS               20400000
         LA    RWK2,1(0,RWK2)          POINT TO ADDRESS                 20450000
DO580    MVC   EMFCTADR(2),0(RWK2)     MOVE ADR TO PARM                 20500000
DO590    EQU   *                                                        20550000
         L     RWK,4(R13)          LOAD WORK REG TO BUMP RETURN         20600000
         L     RWK2,12(RWK)        PLUS FOUR FOR GOOD RETURN            20650000
         LA    RWK2,4(0,RWK2)                                           20700000
         ST    RWK2,12(RWK)                                             20750000
RETURN   EQU   *                                                        20800000
         L     R13,4(R13)           ADR OF PREVIOUS SACE AREA           20850000
         L     R14,12(R13)          LOAD RET ADR                        20900000
         LM    R2,RBASE,28(R13)     RESTORE REST OF REGS                20950000
         MVI   12(R13),X'FF'        SER BYTE                            21000000
         BR    R14                     RETURN                           21050000
NODEMF   EQU   *                                                        21100000
         MVI   EMFRTCD,RC8         MOVE RET CODE ON NO DEMF             21150000
         B     RETURN                                                   21200000
FOO      STC   RWK,EMFLADR+1       STORE IT IN PARM FIELD               21250000
         MVI   EMFLADR,FOXFOX      INDICATE EMFLADR IS A SWITCH         21300000
         MVC   EMFLADR+2(1),R7SAVE MOVE TRM LNGTH TO PARM               21350000
         B     DO590               GET OUT,FINISHED                     21400000
FO2      LA    RWK,2(0)            INSERT ERROR CODE  NCP LGB           21450000
         B     FOO                                                      21500000
FO3      LA    RWK,3(0)                               VTAM TERMINAL     21550000
         B     FOO                                                      21600000
FO5      LA    RWK,5(0)                               DCB NOT OPENED    21650000
         B     FOO                                                      21700000
FO6      LA    RWK,6(0)                               NOT A 3270 TRM    21750000
         B     FOO                                                      21800000
FO7      LA    RWK,7(0)                               LINE NOT OPENED   21850000
         B     FOO                                                      21900000
MVNAME   OC    SYMNAME(0),10(RWK2)    EX INST MOVE TERM NAME            21950000
COMPNAME CLC   SYMNAME(0),0(R7)  EX INST                                22000000
R7SAVE   DC    CL1' '                                                   22050000
STATSW   DC    CL1' '                                                   22100000
         DC    CL2' '                                                   22150000
DEMFCON  DC    C'DEMF'                                                  22200000
DEMFLOW  DC    X'84859486'             LOWER CASE DEMF                  22250000
FORTY    DC    CL8' '                  USED TO MAKE UPPER CASE          22300000
SYMNAME  DC    CL8' '              WORK SPACE FOR CONVERT ROUTINE       22350000
         DC    CL4'0000'                                                22400000
         CNOP  0,4                                                      22450000
TERMADR  DC    CL4' '              THESE TWO WORDS MUST BE ON WORD      22500000
RWK2SAVE DC    CL4' '              BOUNDRY FOR LOAD AND STORE INSTS     22550000
LTHSAVE  DC    XL2'00'                                                  22600000
         CNOP   0,4                                                     22650000
CUTBL    DC    X'00000000000000000000000000000000'             @OZ29913 22652007
         DC    X'00000000000000000000000000000000'             @OZ29913 22654007
         DC    X'20215E24243C262928292A2B2E202E41'             @OZ29913 22656007
         DC    X'264A4B4C4D4E4F5051525D3B3C3B2B21'             @OZ29913 22658007
         DC    X'2A4142434445464748494A4B4C4D4E4F'             @OZ29913 22660007
         DC    X'50515242434445464748495B5C5D5E28'             @OZ29913 22662007
         DC    X'40C100000000000000004A4B4C4D4E4F'             @OZ29913 22664007
         DC    X'000000000000000000005A5B5C5D5E5F'             @OZ29913 22666007
         DC    X'00000000000000000000000000000000'             @OZ29913 22668007
         DC    X'00000000000000000000000000000000'             @OZ29913 22670007
         DC    X'00000000000000000000000000000000'             @OZ29913 22672007
         DC    X'00000000000000000000000000000000'             @OZ29913 22674007
         DC    X'00C1C2C3C4C5C6C7C8C9000000000000'             @OZ29913 22676007
         DC    X'00D1D2D3D4D5D6D7D8D9000000000000'             @OZ29913 22678007
         DC    X'0000C2C3C4C5C6C7C8C9000000000000'             @OZ29913 22680007
         DC    X'50D1D2D3D4D5D6D7D8D9000000000000'             @OZ29913 22682007
         DS    0F                                              @OY20942 22685007
MAXSIZE  DC    X'002C'                                         @OY20942 22688007
X1E      DC    X'001E'                                         @OY20942 22691007
PATCH    DS    20F                                             @OY20942 22694007
EMF      DSECT                                                          22700000
EMFSIZE  DS    CL2                                                      22750000
EMFSTAT  DS    CL1                                                      22800000
EMFMODEL DS    CL1                                                      22850000
EMFLADR  DS    CL3                                                      22900000
EMFCTADR DS    CL1                                                      22950000
EMFCUADR DS    CL1                                                      23000000
EMFRTCD  DS    CL1                                                      23050000
*****    FOLLOWING DSECTS ARE TCAM RELEASE DEPENDENT. WHENEVER A        23100000
*****    NEW LEVEL OF TCAM IS INSTALLED THESE DSECTS SHOULD BE          23150000
*****    CHECKED TO SEE IF THEY HAVE CHANGED.                           23200000
IEDQAVTD DSECT                                                          23250000
AVTDUM   DS    82F                 NOT USED FILLER ONLY                 23300000
AVTCSTCS DS    F                                                        23350000
AVTDUM1  DS    23F                 NOT USED FILLER ONLY                 23400000
AVTRNMPT DS    A                                                        23450000
AVTDUM2  DS    72F                                                      23500000
AVTCLRHI DS    2X                                                       23550000
AVTDUM3  DS    XL2                                                      23600000
AVTADBUF DS    A                                                        23650000
AVTZERO  EQU   00                                                       23700000
AVTCVTPT EQU   240                                                      23750000
IEDQLCB  DSECT                                                          23800000
LCBDUM1 DS 7F                                                           23850000
LCBISZE  DS  XL1                                                        23900000
LCBDUM2  DS XL3                                                         23950000
LCBDUM3  DS 5F                                                          24000000
LCBDCBPT DS A                                                           24050000
LCBDUM5  DS 2F                                                          24100000
LCBUCBX  DS    XL1                                                      24150000
LCBDUM6  DS    XL3                                                      24200000
LCBDUM7  DS    6F                                                       24250000
LCBDUM4  DS XL1                                                         24300000
LCBSCBA  DS AL3                                                         24350000
IEDQPRF DSECT                                                           24400000
PRFDUM DS 3F                                                            24450000
PRFDUM1 DS XL1                                                          24500000
PRFLCB DS  AL3                                                          24550000
PRFSRCE DS H                                                            24600000
PRFSIZE DS H                                                            24650000
PRFSTAT1 DS XL1                                                         24700000
PRFTSMSG EQU X'10'                                                      24750000
PRFNHDRN EQU X'01'                                                      24800000
IEDQTNT  DSECT                                                          24850000
TNTDUM1  DS    CL40                                                     24900000
TNTENLEN DS    CL1                                                      24950000
TNTDUM2  DS    CL3                                                      25000000
TNTLEN   DS    H                                                        25050000
TNTDUM3  DS    CL36                                                     25100000
TNTFIRST DS    C                                                        25150000
IEDQSCB DSECT                                                           25200000
SCBSTATE DS XL1                                                         25250000
SCBLCK1N EQU X'20'                                                      25300000
         END                                                            25350000
./  ADD  SSI=81730355,NAME=BNGTQEMF
         PRINT OFF                                                      00050007
         MACRO                                                          00050407
&NAME    BNGHJN &LABEL,&HJN                                             00050807
         LCLC  &HJA,&HJB                                                00051207
&HJA     SETC  '&SYSPARM'(1,4)                                          00051607
&HJB     SETC  '&SYSPARM'(5,4)                                          00052007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00052407
         B     &LABEL .                 BR AROUND CONSTANTS             00052807
         SPACE 2                                                        00053207
.NOBRNCH ANOP                                                           00053607
         AIF   ('&NAME' EQ '').NOLABEL                                  00054007
         DC    C'&NAME' .              MODULE IDENTIFIER                00054407
.NOLABEL ANOP                                                           00054807
         DC    X'&HJA' .                DATE OF MODIFICATION            00055207
         AIF   ('&HJN' NE 'HJN').DATE                                   00055607
         DC    X'&HJB' .                HJN OF MODIFICATION             00056007
.DATE    ANOP                                                           00056407
         AIF   ('&LABEL' EQ '').NOLBL                                   00056807
         SPACE 2                                                        00057207
&LABEL   DS    0H                                                       00057607
.NOLBL   ANOP                                                           00058007
         MEND                                                           00058407
         PRINT ON                                                       00058807
*********************************************************************** 00059207
*                                                                     * 00100000
* MODULE NAME = BNGTQEMF                                              * 00150000
*                                                                     * 00200000
* DESCRIPTIVE NAME = TCAM DEMF MESSAGE QUEUE CONTROL MODULE           * 00250000
*                                                                     * 00300000
* COPYRIGHT = NONE                                                    * 00350000
*                                                                     * 00400000
* STATUS = RELEASE 1, LEVEL 1                                         * 00450000
*                                                                     * 00500000
* FUNCTION = 1) GETS INPUT MESSAGES FROM TCAM MESSAGE QUEUE(BNGTIN);  * 00550000
*            2) ACQUIRES STORAGE FOR BOTH INPUT AND OUTPUT MESSAGES   * 00600000
*               (2117 BYTES);                                         * 00650000
*            3) MOVES INPUT MESSAGE TO NEWLY ACQUIRED STORAGE AREA;   * 00700000
*            4) LINKS TO BNGIDISP WITH ADDRESS OF NEW STORAGE AREA;   * 00750000
*            5) WHEN CONTROL RETURNS TO BNGTQEMF, PUTS MESSAGE TO     * 00800000
*               OUTPUT MESSAGE QUEUE(BNGTQ) TO 3277 DISPLAY TERMINAL. * 00850000
*                                                                     * 00900000
* NOTES = NONE                                                        * 00950000
*                                                                     * 01000000
*    DEPENDENCIES = NONE                                              * 01050000
*                                                                     * 01100000
*    RESTRICTIONS = NONE                                              * 01150000
*                                                                     * 01200000
*    REGISTER CONVENTIONS = R10 CONTAINS ADDRESS OF I/O MESSAGE       * 01250000
*                                                                     * 01300000
*    PATCH LABEL = PATCH                                       @OY20942 01350007
*                                                                     * 01400000
* MODULE TYPE = TCAM MESSAGE QUEUE CONTROL                            * 01450000
*                                                                     * 01500000
*    PROCESSOR = ASSEMBLER H                                          * 01550000
*                                                                     * 01600000
*    MODULE SIZE = 1775 DECIMAL BYTES                                 * 01650000
*                                                                     * 01700000
*    ATTRIBUTES =                                                     * 01750000
*                                                                     * 01800000
* ENTRY POINT = BNGTQEMF                                              * 01850000
*                                                                     * 01900000
*    PURPOSE = SEE FUNCTION                                           * 01950000
*                                                                     * 02000000
*    LINKAGE = R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 02050000
*                                                                     * 02100000
* INPUT = PARAM LIST ITEMS USED ARE :                                 * 02150000
*         INPUT MESSAGE (MAX 117 BYTES)                               * 02200000
*                                                                     * 02250000
* OUTPUT = PARAM LIST ITEMS USED ARE :                                * 02300000
*         OUTPUT MESSAGE (MAX = 2008 BYTES)                           * 02350000
*                                                                     * 02400000
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 02450000
*               00 - OPERATION PERFORMED AS REQUESTED                 * 02500000
*                                                                     * 02550000
* EXIT-ERROR  = SYNAD ROUTINE AT LABEL - SNNAD                        * 02600000
*                                                                     * 02650000
* EXTERNAL REFERENCE = NONE                                           * 02700000
*                                                                     * 02750000
*    ROUTINES = NONE                                                  * 02800000
*                                                                     * 02850000
*    DATA AREAS = NONE                                                * 02900000
*                                                                     * 02950000
*    CONTROL BLOCK = DCB                                              * 03000000
*                                                                     * 03050000
* TABLES = NONE                                                       * 03100000
*                                                                     * 03150000
* MACROS = DCBD, OPEN, CLOSE, WTO, FREEMAIN, ABEND, LINK, GETMAIN     * 03200000
*                                                                     * 03250000
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 03300000
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 03300107
* CHANGE 02  02/22/78  BNGHJN MACRO ADDED                             * 03300207
*C061500-063000,082000                                         @OX21274 03300307
*C013500,068500,123000,124000,155500                           @OY20942 03300407
*D125500                                                       @OY20942 03300507
*A126000,126500,158500                                         @OY20942 03300607
*                                                                     * 03400000
*********************************************************************** 03450000
BNGTQEMF CSECT                                                          03500000
R0       EQU   0                                                        03550000
R1       EQU   1                                                        03600000
RWK      EQU   2                                                        03650000
RWK3     EQU   3                                                        03700000
RWK4     EQU   4                                                        03750000
R4       EQU   4                                                        03800000
RIN      EQU   5                                                        03850000
R5       EQU   5                                                        03900000
ROUT     EQU  10                                                        03950000
RINDCB   EQU   7                                                        04000000
ROUTDCB  EQU   8                                                        04050000
RLNK     EQU   9                                                        04100000
RBASE    EQU   12                                                       04150000
RSAVE    EQU   13                                                       04200000
RRET     EQU   14                                                       04250000
RFOX     EQU   15                                                       04300000
GOODOPEN EQU   16                                                       04350000
SEVETEEN EQU   0017                                                     04400000
SBA      EQU   X'11'                                                    04450000
L1P1     EQU   X'4040'                                                  04500000
SF       EQU   X'1D'                                                    04550000
UNA      EQU   X'40'                                                    04600000
UDM      EQU   X'C1'                                                    04650000
PI       EQU   X'E8'                                                    04700000
IC       EQU   X'13'                                                    04750000
L2P1     EQU   X'C150'             3270 LINE2 COLUMN1                   04800000
L3270    EQU   X'99'               LOCAL 3270 MASK                      04850000
ENTKY    EQU   X'7D'               3270 ENTER KEY MASK                  04900000
FOX0     EQU   240                                                      04950000
FOXONE   EQU   241                 MASK TO INDICATE DEMF 3270 ENTERED   05000000
FOXFOX   EQU   255                 MASK TO INDICATE 2ND BYTE IS SW.     05050000
STX      EQU   X'02'               MASK FOR STX                         05100000
RESKYBD  EQU   X'C3'               MASK FOR WCC CHAR TO RESET KEYBOARD  05150000
         EJECT                                                          05200000
*                                                                       05250000
*        THIS MODULE RUNS AS A APPLICATION PROGRAM OF TCAM.  IT CAN BE  05300000
*        ATTACHED IN THE MCP AT INITILAZATION TIME OR RUN AS A          05350000
*        SEPARATE TASK.                                                 05400000
*********  FOLLOWING MUST BE CODED IN USER MCP                    ****  05450000
*        BNGTPCB    PCB    BUFSIZE=502,MH=BNGTMH,BUFIN=4                05500000
*        BNGTQ    TPROCESS   PCB=BNGTPCB              DEMF PCB FOR PUT  05550000
*        BNGTIN   TPROCESS   PCB=BNGTPCB,QUEUES=MO    DEMF FOR GET      05600000
*********  FOLLOWING DD CARDS MUST BE IN JCL THAT STARTS THIS TASK **** 05650000
*        //BNGTINE  DD QNAME=BNGTIN                                     05700000
*        //BNGTOTE  DD QNAME=BNGTQ                                      05750000
*********************************************************************** 05800000
*                                                                       05850000
         EJECT                                                          05900000
***    INITILAZATION CODE                                               05950000
         STM   RRET,RBASE,12(RSAVE)    SAVE CALLERS REGS                06000000
         LR    RBASE,RFOX              SET MY BASE                      06050000
         USING BNGTQEMF,RBASE                                           06100000
BNGTQEMF BNGHJN SKIPID                                         @OX21274 06150007
         LA    RFOX,SAVE               POINT TO MY SAVE AREA            06350000
         ST    RSAVE,4(RFOX)           STORE HIS SAVE ADDR IN MINE      06400000
         ST    RFOX,8(RSAVE)           STORE MY SAVE ADDR IN HIS        06450000
         LR    RSAVE,RFOX              SET UP MY SAVE REG               06500000
         OPEN  (OUTDCB,(OUTPUT))     OPENOUTPUT DCB                     06550000
         LA    ROUTDCB,OUTDCB          LOAD DCB ADDRESS                 06600000
         USING IHADCB,ROUTDCB                                           06650000
         TM    DCBOFLGS,GOODOPEN    WAS OPEN GOOD                       06700000
         BO    NEXT                    YES,BRANCH                       06750000
OPENERR  WTO   'BNG402I T OPEN FAILED FOR DEMF'                         06800000
         B     CLOSDWN                  SHUTDOWN               @OY20942 06850007
NEXT     OPEN (INDCB,(INPUT))                                           06900000
         DROP  ROUTDCB                                                  06950000
         LA    RINDCB,INDCB        SET UP INPUT DCB REG                 07000000
         USING IHADCB,RINDCB                                            07050000
         TM    DCBOFLGS,GOODOPEN                                        07100000
         BNO   OPENERR                                                  07150000
OPENOK   EQU   *                                                        07200000
         WTO  'BNG400I  T DEMF SUBTASK ACTIVE'                          07250000
         EJECT                                                          07300000
***   WAIT HERE IN THE TCAM GET ROUTINE UNTIL TCAM PUTS A DEMF          07350000
***   REQUEST MESSAGE ON OUR QUEUE.                                     07400000
GET      GET   INDCB,INPUT             GET MESSAGE                      07450000
         B     READTAB(RFOX)       CHECK GOOD RETURN                    07500000
READTAB  B     GETMAIN             R/C 0 GOOD READ CONTINUE             07550000
         B     READER              R/C 4 SHOULD NOR OCCUR               07600000
         B     READER              R/C 8 SHOULD NOT OCCUR               07650000
         B     READER              R/C C SHOULD NOT OCCUR               07700000
         B     READER              R/C 10 BLKSIZE =0 OR LRECL=0         07750000
         B     REOPEN              R/C 14 TCAM CLOSED QUE               07800000
         DC    3F'0'               IN CASE MORE RETURN CODES PC         07850000
REOPEN   CLOSE INDCB               TCAM CLOSED QUE SO WE HAVE TO        07900000
         OPEN  (INDCB,(INPUT))     CLOSE DCB AND REOPEN                 07950000
         B     GET                 CONTINUE                             08000000
         EJECT                                                          08050000
***   WE HAVE A DEMF REQUEST. GET STORAGE NEEDED BY THE DISPLAY         08100000
***   PROGRAMS TO WRITE TO THE TERMINAL.                                08150000
GETMAIN  EQU   *                                               @OX21274 08200007
         GETMAIN  R,LV=2117        GET STORAGE FOR OUTPUT               08250000
         LR    ROUT,R1           SET UP OUTPUT REG OF GOTTEN STORAGE    08300000
**              FOLLOWING FIVE INSTRUCTIONS CLEAR INPUT AREA            08350000
         LR    R0,R1               ADDR OF FIELD TO BE CLEARED          08400000
         LA    R1,117              LENGTH OF FIELD TO CLEAR             08450000
         L     R5,=X'00000001'     LENGHT AND PADDING CHAR              08500000
         LA    R4,ZERO             FILL CHAR                            08550000
         MVCL  0,R4                CLEAR FIELD                          08600000
         LA    RIN,INPUT           GET INPUT I/O AREA                   08650000
         USING INDSECT,RIN                                              08700000
         USING OUTDSECT,ROUT                                            08750000
         MVC   EMFDATA,INAREA        MOVE PARM FIELDS TO FORMAT SECT    08800000
         MVC   EMFNAME,INNAME      MOVE NAME OF TERML TO PARM           08850000
         MVI   EMFOTDAD,RESKYBD    WCC OF C3 TO RESET KEYBOARD          08900000
         CLI   INLADR,FOXFOX       IS 2ND BYTE A SWITCH                 08950000
         BE    MSGOUT              YES,BR PUT OUT ERROR MESSAGE         09000000
         TM    TSWITCH,FOX0        IS THIS BYTE A SWITCH TO INDICATE    09050000
*                                  USER ENTERED SYMBOLIC NAME AND WE    09100000
*                                  MUST BLANK IT OUT OF THE DATA STREAM 09150000
*                                  AND SAVE IT.                         09200000
         BO    SYMBOLIC            BR,YES                               09250000
FO9      SR    RWK,RWK             CLEAR WORK REG                       09300000
         LH    RWK,DCBLRECL        GET RECORD LENGTH IN REG             09350000
         LA    RWK3,SEVETEEN       ADD HEADER+8 FOR NAME+9 FOR PARM     09400000
         CLI   INDATA,SBA          IS FIRST BYTE SBA                    09450000
         BE    BYPASS              YES,BR SET CORRECTLY NOW             09500000
         CLI   INDATA,ENTKY        IS FIRST BYTE ENTER KEY              09550000
         BE    ADDTHREE            YES,BR                               09600000
         CLI   INDATA,STX          IS FIRST BYTE OF DATA STX            09650000
         BE    ADDSIX              YES,BR                               09700000
         B     ADDFIVE             MUST BE CUA,TA,ENTKY,BA,BA           09750000
ADDSIX   LA    RWK3,1(RWK3)        STX,CUA,TA,ENTKY,BA,BA               09800000
ADDFIVE  LA    RWK3,2(RWK3)            CUA,TA,ENTKY,BA,BA               09850000
ADDTHREE LA    RWK3,3(RWK3)                   ENTKY,BA,BA               09900000
BYPASS   SR    RWK,RWK3            GET REAL INPUT LENGTH                09950000
         STH   RWK,EMFSIZE         MOVE IN SIZE FOR SCREEN FORMAT       10000000
         AR    RWK3,RIN            POINT RWK3 TO FIRST BYTE TO BE MOVED 10050000
         BCTR  RWK,0               SUB ONE FOR EXEC'D MOVE              10100000
         EX    RWK,EXECMVE         MOVE DATA                            10150000
         EJECT                                                          10200000
         LINK  EP=BNGTDISP         LINK TO DEMF SCREEN FORMAT PROGRAM   10250000
         TM    TSWITCH,FOX0        IS THE SYMBOLIC NAME SWITCH SET      10300000
         BO    GO1                 BR,YES                               10350000
         CLI   EMFLADR,X'FF'       DO WE NEED TO INSERT TCAMID=?        10400000
         BE    F10                 YES,BR - SET BY BNGT3270             10450000
GO9      SR    RWK,RWK             CLEAR                                10500000
         LH    RWK,EMFSIZE         GET SIZE                             10550000
         LA    RWK,9(0,RWK)        ADD NINE FOR WCC CHAR AND 8 BYTE     10600000
         DROP  RINDCB                  TERMINAL NAME                    10650000
         USING IHADCB,ROUTDCB                                           10700000
WRITE1   STH   RWK,DCBLRECL           STORE SIZE TO WRITE IN DCB        10750000
WRITE    PUT   OUTDCB,EMFWRITE         WRITE DATA TO TERMINAL           10800000
         B     TABLE(RFOX)             TABLE OF RETURN CODES            10850000
TABLE    B     RELCORE                 WRITE WAS SUCCESSFUL             10900000
         B     CLOSDWN                 MCP HAS CLOSED DOWN              10950000
         B WRITER                      SHOULD NOT OCCUR                 11000000
         B INVTERM                     TERMINAL NAME INVALID            11050000
         B     WRITE                   WRITE WAS BUSY RETRY             11100000
         DC    3F'0'                   JUST IN CASE MORE RETURN CODES   11150000
RELCORE  LR    R1,ROUT                 INIT R1 FOR FREEMAIN             11200000
         FREEMAIN  R,LV=2117,A=(1)                                      11250000
         B     GET                                                      11300000
SYMBOLIC SR    RWK,RWK             CLEAR                                11350000
         MVC   SYMLTH,TSIZE        MOVE SIZE TO AREA                    11400000
         NC    SYMLTH,ZEROFOX      REMOVE SWITCH INDICATOR BYTES        11450000
         IC    RWK,SYMLTH          LTH OF NAME ENTERED MINUS ONE        11500000
         SR    RWK4,RWK4           CLEAR                                11550000
         LA    RWK4,TDATA          POINT RWK4 TO INPUT AREA             11600000
FO1      CLC   0(4,RWK4),=C'3270'  IS THIS 3270                         11650000
         BE    FO2                 BR,YES                               11700000
         LA    RWK4,1(0,RWK4)      LOOK AT NEXT BYTE                    11750000
         B     FO1                                                      11800000
FO2      MVC   FO6,FORTYS                                               11850000
         EX    RWK,FO3                                                  11900000
         EX    RWK,FO4                                                  11950000
         B     FO9                                                      12000000
FO3      MVC   FO6(0),5(RWK4)                                           12050000
FO4      MVC   5(0,RWK4),FORTYS                                         12100000
EXECMVE  MVC   EMFINDAT(0),0(RWK3)     MOVE DATA TO FORMAT INPUT AREA   12150000
         EJECT                                                          12200000
READER   WTO   'BNG403I T READ ERROR FILE INDCB PGM=BNGTQEMF'           12250000
         B     CLOSDWN                  SHUTDOWN               @OY20942 12300007
WRITER   WTO   'BNG404I T WRITE ERROR FILE OUTDCB PGM=BNGTQEMF'         12350000
         B     CLOSDWN                  SHUTDOWN               @OY20942 12400007
INVTERM  EQU   *                                                        12450000
         WTO   'BNG405I T INVALID TCAM TERMINAL NAME'                   12500000
CLOSDWN  EQU   *                                                        12600000
         DROP  ROUTDCB                                         @OY20942 12608007
         LA    RINDCB,INDCB             GET DCB ADDRESS        @OY20942 12616007
         USING IHADCB,RINDCB                                   @OY20942 12624007
         TM    DCBOFLGS,GOODOPEN        IS DATA SET OPEN       @OY20942 12632007
         BNO   CKOUT                    NO, DON'T CLOSE THEN   @OY20942 12640007
         CLOSE INDCB                                                    12650000
CKOUT    EQU   *                                               @OY20942 12657007
         DROP  RINDCB                                          @OY20942 12664007
         LA    ROUTDCB,OUTDCB           GET DCB ADDRESS        @OY20942 12671007
         USING IHADCB,ROUTDCB                                  @OY20942 12678007
         TM    DCBOFLGS,GOODOPEN        IS DATA SET OPEN       @OY20942 12685007
         BNO   EXIT                     NO, DON'T CLOSE THEN   @OY20942 12692007
         CLOSE OUTDCB                                                   12700000
EXIT     EQU   *                                                        12750000
         WTO   'BNG401I T DEMF SUBTASK CLOSED DOWN'                     12800000
         L     RSAVE,4(RSAVE)          GET CALLERS SAVE                 12850000
         LM    RRET,RBASE,12(RSAVE)    RESTORE CALLERS REGS             12900000
         SR    RFOX,RFOX               DO RETURN CODE THING             12950000
         BR    RRET                    RETURN TO CALLER                 13000000
SNNAD    EQU   *                                                        13050000
         CLOSE INDCB                                                    13100000
         OPEN  (INDCB,(INPUT))                                          13150000
         B     GETMAIN                                                  13200000
         EJECT                                                          13250000
F10      MVC   FO6,INNAME          MOVE INPUT TERMINAL NAME             13300000
GO1      LA    RWK,131(ROUT)       POINT TO SYMBOLIC NAME IN OUTPUT     13350000
         CLC   135(7,ROUT),=C'BNG011I' IS IT MSG11 ERROR MSG?           13400000
         BE    GO3                 YES.                                 13450000
         CLC   135(7,ROUT),=C'BNG012I' IS IT MSG12 ERROR MSG?           13500000
         BE    GO2                 YES.                                 13550000
         MVC   38(16,RWK),TCAMID   MOVE IN SYMBOLIC NAME FOR 3270 SCR   13600000
         B     GO9                                                      13650000
GO2      MVC   70(16,RWK),TCAMID   MOVE IN SYMBOLIC NAME MSG12          13700000
         B     GO9                                                      13750000
GO3      MVC   107(16,RWK),TCAMID  MOVE IN SYMBOLIC NAME MSG11          13800000
         B     GO9                                                      13850000
         EJECT                                                          13900000
MSGOUT   EQU   *         THIS ROUTINE IS ENTERED WHEN THE SWITCH        13950000
***                      INDICATE A INVALID SYMBOLIC NAME HAS BEEN      14000000
***                      ENTERED AND WE WILL SEND A MESSAGE BACK TO     14050000
***                     THE USER TERMINAL.                              14100000
         NI    MSGNUM+2,FOX0       TURN OFF LOW ORDER BITS              14150000
         OC    MSGNUM+2(1),EMFLADR+1    MOVE MSG NO. TO OUTPUT          14200000
         SR    RWK,RWK             CLEAR                                14250000
         IC    RWK,EMFLADR+1                                            14300000
         BCTR  RWK,R0              SUB ONE                              14350000
         MH    RWK,THIRTY8         MULT BY MSG LENGTH                   14400000
         LA    RWK,MSG1(RWK)       GET ADR OF MSG                       14450000
         MVC   EMFOTDAE+MSGLTH(MSG1LTH),0(RWK)  MOVE MSG TO OUTPUT      14500000
         MVC   MSGTERM,FORTYS      CLEAR NAME AREA TO BLANKS            14550000
         LA    RWK,INPUT+17        POINT REG TO INPUT AREA              14600000
         LA    R1,25               SET UP R1 TO LIMIT SCAN              14650000
RETRY    CLC   0(4,RWK),=C'3270'   IS IT 3270                           14700000
         BE    DO1                 YES,BR FOUND INPUT                   14750000
         LA    RWK,1(0,RWK)        ADD ONE TO INPUT POINTER             14800000
         BCT   R1,RETRY            LOOK AT NEXT POSITIONS OF INPUT      14850000
         B     DO3                 DID NOT FIND VALID NAME EXIT         14900000
DO1      CLI   5(RWK),X'4F'        IS A VALID SYMBOLIC                  14950000
         BL    DO3                 NO,BR EXIT                           15000000
         SR    RWK3,RWK3           CLEAR                                15050000
         IC    RWK3,EMFLADR+2      INSERT TRM NAME LENGTH MINUS ONE     15100000
         EX    RWK3,DO2            MOVE TRM NAME TO OUTPUT AREA         15150000
DO3      MVC   EMFOTDAE(MSGLTH),MSG  MOVE MSG HDR TO OUTPUT AREA        15200000
         LA    RWK,79              PUT MSG LENGTH IN DCB                15250000
         B     WRITE1                                                   15300000
DO2      MVC   MSGTERM(0),5(RWK) EXED INST TO MOVE TRM NAME             15350000
         EJECT                                                          15400000
INDCB    DCB   BLKSIZE=117,DDNAME=BNGTINE,DSORG=PS,LRECL=117,          X15450000
               MACRF=GM,OPTCD=WU,RECFM=U,                              X15500000
               EODAD=CLOSDWN,SYNAD=SNNAD,BUFL=117              @OY20942 15550007
OUTDCB   DCB   RECFM=U,                MESSAGE PROCESSING              X15600000
               DDNAME=BNGTOTE,         DD CARD MUST BE THIS NAME       X15650000
               DSORG=PS,               TCAM DCB                        X15700000
               LRECL=2008,             MESSAGE LENGTH ,WILL GET CHAMGE X15750000
               MACRF=PM,         PUT USED                              X15800000
               OPTCD=WU                MUST HAVE DESTINATION NAME       15850000
PATCH    DS    20F                                             @OY20942 15870007
         EJECT                                                          15900000
SAVE     DC    18F'0'                                                   15950000
ZERO     DC    X'00000000'                                              16000000
FORTYS   DC    CL9'         '                                           16050000
INPUT    DC    CL117'0'                                                 16100000
         ORG   INPUT                                                    16150000
TNAME    DS    CL8                                                      16200000
TSWITCH  DS    CL1                                                      16250000
         ORG   TSWITCH                                                  16300000
TSIZE    DS    CL2                                                      16350000
TSTAT    DS    CL1                                                      16400000
TMODEL   DS    CL1                                                      16450000
TLADR    DS    CL3                                                      16500000
TTADR    DS    CL1                                                      16550000
TCUADR   DS    CL1                                                      16600000
TDATA    DS    CL100                                                    16650000
SYMLTH   DC    CL1' '                                                   16700000
ZEROFOX  DC    X'0F'                                                    16750000
TCAMID   DC    C'TCAM ID='                                              16800000
FO6      DC    CL8' '              SAVE AREA FOR SYMBOLIC NAME          16850000
         CNOP  0,4                                                      16900000
THIRTY8  DC    XL2'0026'                                                16950000
MSG      DS    0C'0'                                                    17000000
         ORG   MSG                                                      17050000
MSGHDR   DC    AL1(SBA),AL2(L1P1),AL1(SF,UDM),C'DEMF ',AL1(IC)          17100000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PI)                            17150000
MSGID    DC    C'BNG'                                                   17200000
MSGNUM   DC    C'450I T'                                                17250000
         DC    C' '                                                     17300000
MSGTERM  DC    CL9' '                                                   17350000
MSGLTH   EQU   *-MSG                                                    17400000
MSG1     DC   C'IS NOT A TCAM TERM                    '                 17450000
MSG1LTH  EQU  *-MSG1                                                    17500000
MSG2     DC   C'IS A NCP LGB                          '                 17550000
MSG3     DC   C'IS A VTAM TERMINAL                    '                 17600000
MSG4     DC   C'IS EITHER A TPROCESS ,LOG,TLIST ENTRY '                 17650000
MSG5     DC   C'DCB FOR THIS TERMINL NOT OPENED       '                 17700000
MSG6     DC   C'IS NOT A 3270 TYPE   TERMINAL         '                 17750000
MSG7     DC   C'LINE NOT OPENED FOR  THIS TERMINAL    '                 17800000
         EJECT                                                          17850000
INDSECT  DSECT                                                          17900000
INNAME   DS    CL8                                                      17950000
INSIZE   DS    CL2                                                      18000000
INAREA   DS    CL7                                                      18050000
         ORG   INAREA                                                   18100000
INSTAT   DS    CL1                                                      18150000
INMODEL  DS    CL1                                                      18200000
INLADR   DS    CL3    NORMALLY INPUT TERMINAL LINE ADDRESS UNLESS       18250000
*                     BYTE ONE IS A X'FF' THEN BYTE TWO IS A ERROR      18300000
*                     CODE EXPLAINED BELOW, AND BYTE THREE IS THE       18350000
*                     LENGTH MINUS ONE OF THE SYMBOLIC NAME ENTERED.    18400000
*                     BYTE TWO                                          18450000
*                     01  NAME IS NOT A TCAM TERMINAL                   18500000
*                     02  NAME IS A NCP LGB                             18550000
*                     03  NAME IS A VTAM OR NCP TERMINAL                18600000
*                     04  NAME IS EITHER A TPROCESS,LOG,TLIST ENTRY     18650000
*                     05  DCB FOR THIS TERMINAL NOT OPENED              18700000
*                     06  NAME IS NOT A 3270 TERMINAL                   18750000
*                     07  LINE NOT OPENED FOR THIS ENTRY                18800000
INCTADR  DS    CL1                                                      18850000
INCUADR  DS    CL1                                                      18900000
INDATA   DS    CL100                                                    18950000
         EJECT                                                          19000000
OUTDSECT DSECT                                                          19050000
EMFSIZE  DS    CL2                                                      19100000
EMFDATA  DS    CL7                                                      19150000
         ORG   EMFDATA                                                  19200000
EMFSTAT  DS    CL1                                                      19250000
EMFMODEL DS    CL1                                                      19300000
EMFLADR  DS    CL3                                                      19350000
EMFCTADR DS    CL1                                                      19400000
EMFCUADR DS    CL1                                                      19450000
EMFINDAT DS    CL100                                                    19500000
EMFWRITE DS    0XL2008                                                  19550000
EMFNAME  DS    CL8                                                      19600000
EMFOTDAD DS    CL1                                                      19650000
EMFOTDAE DS    1999XL1                                                  19700000
         EJECT                                                          19750000
         PRINT   NOGEN                                                  19800000
         DCBD  DSORG=(PS)                                               19850000
         END   BNGTQEMF                                                 19900000
./  ADD  SSI=81160227,NAME=BNGTRMOT
         PRINT OFF                                                      00050007
         MACRO                                                          00050407
&NAME    BNGHJN &LABEL,&HJN                                             00050807
         LCLC  &HJA,&HJB                                                00051207
&HJA     SETC  '&SYSPARM'(1,4)                                          00051607
&HJB     SETC  '&SYSPARM'(5,4)                                          00052007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00052407
         B     &LABEL .                 BR AROUND CONSTANTS             00052807
         SPACE 2                                                        00053207
.NOBRNCH ANOP                                                           00053607
         AIF   ('&NAME' EQ '').NOLABEL                                  00054007
         DC    C'&NAME' .              MODULE IDENTIFIER                00054407
.NOLABEL ANOP                                                           00054807
         DC    X'&HJA' .                DATE OF MODIFICATION            00055207
         AIF   ('&HJN' NE 'HJN').DATE                                   00055607
         DC    X'&HJB' .                HJN OF MODIFICATION             00056007
.DATE    ANOP                                                           00056407
         AIF   ('&LABEL' EQ '').NOLBL                                   00056807
         SPACE 2                                                        00057207
&LABEL   DS    0H                                                       00057607
.NOLBL   ANOP                                                           00058007
         MEND                                                           00058407
         PRINT ON                                                       00058807
*********************************************************************** 00059207
*                                                                     * 00100007
* MODULE NAME = BNGTRMOT                                              * 00150007
*                                                                     * 00200007
* DESCRIPTIVE NAME = TCAM DEMF REMOTE TERMINAL ERROR TEXT DISPLAY     * 00250007
*                                                                     * 00300007
* COPYRIGHT = NONE                                                    * 00350007
*                                                                     * 00400007
* STATUS = RELEASE 1, LEVEL 1                                         * 00450007
*                                                                     * 00500007
* FUNCTION = 1) DISPLAYS CANNED STATUS/SENSE TEXT OF ALL POSSIBLE     * 00550007
*               REMOTE TERMINAL ERROR COMBINATIONS;                   * 00600007
*            2) PROVIDES THE SELECTION DISPLAY OF EXPLANATION AND     * 00650007
*               POSSIBLE CAUSES ON THE REMOTE TERMINAL STATUS/SENSE   * 00700007
*               WHICH IS SELECTED BY DEMF USER.                       * 00750007
*                                                                     * 00800007
* NOTES = NONE                                                        * 00850007
*                                                                     * 00900007
*    DEPENDENCIES = NONE                                              * 00950007
*                                                                     * 01000007
*    RESTRICTIONS = NONE                                              * 01050007
*                                                                     * 01100007
*    REGISTER CONVENTIONS = R10 CONTAINS ADDRESS OF INPUT MESSAGE     * 01150007
*                                                                     * 01200007
*    PATCH LABEL = NONE                                               * 01250007
*                                                                     * 01300007
* MODULE TYPE = TCAM DISPLAY                                          * 01350007
*                                                                     * 01400007
*    PROCESSOR = ASSEMBLER H                                          * 01450007
*                                                                     * 01500007
*    MODULE SIZE = 11678 DECIMAL BYTES                                * 01550007
*                                                                     * 01600007
*    ATTRIBUTES = SERIALLY REUSABLE                                   * 01650007
*                                                                     * 01700007
* ENTRY POINT = BNGTRMOT                                              * 01750007
*                                                                     * 01800007
*    PURPOSE = SEE FUNCTION                                           * 01850007
*                                                                     * 01900007
*    LINKAGE = R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 01950007
*                                                                     * 02000007
* INPUT = PARAM LIST ITEMS USED ARE :                                 * 02050007
*         IN MESSAGE ADDRESS  = TCAMFLDS (R10)                        * 02100007
*         IN MESSAGE COUNT    = VARIABLE (MAXIMUM=109 BYTES)          * 02150007
*                                                                     * 02200007
* OUTPUT = PARAM LIST ITEMS USED ARE :                                * 02250007
*         OUT MESSAGE ADDRESS = TIOADBAO (R10)                        * 02300007
*         OUT MESSAGE COUNT   = VARIABLE (MAXIMUM=2009 BYTES)         * 02350007
*                                                                     * 02400007
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 02450007
*               00 - OPERATION PERFORMED AS REQUESTED                 * 02500007
*                                                                     * 02550007
* EXIT-ERROR  = NONE                                                  * 02600007
*                                                                     * 02650007
* EXTERNAL REFERENCE = NONE                                           * 02700007
*                                                                     * 02750007
*    ROUTINES = NONE                                                  * 02800007
*                                                                     * 02850007
*    DATA AREAS = NONE                                                * 02900007
*                                                                     * 02950007
*    CONTROL BLOCK = DCB                                              * 03000007
*                                                                     * 03050007
* TABLES = NONE                                                       * 03100007
*                                                                     * 03150007
* MACROS = SAVE, RETURN                                               * 03200007
*                                                                     * 03250007
*********************CHANGE ACTIVITY FOLLOWS:************************** 03300007
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 03300107
* CHANGE 02  03/02/78  BNGHJN MACRO ADDED                             * 03300207
*C042000-049500                                                @OZ30675 03300307
*D088000                                                       @OZ30675 03300407
*A085500                                                       @OZ30675 03300507
*                                                                     * 03400007
*********************************************************************** 03450007
TCAMFLDS DSECT                                                          03500007
         USING *,10                                                     03550007
TIOATDL  DC    X'0000'    TERMINAL DATA LENGTH                          03600007
TCTTETT  DS    CL1   91=REMOTE  99=LOCAL 3270                           03650007
TCTTETM  DS    CL1    F1=MODEL 1  F2=MODEL 2 3270                       03700007
TCTTEGU  DS    0H     EUATE LOCAL LINE ADDRESES                         03750007
TCTLERLN DS    CL3     LINE ADDRESS RELATIVE LINE #                     03800007
TCTTETA  DS    CL1   CONTROL UNIT ADDRESS                               03850007
         DS    CL1     TERNINAL ADDRESS REMOTE                          03900007
TIOADBA  DS    CL100        TERMINAL INPUT AREA                         03950007
TCTTETI  DS    CL8          TCAM  SYMBOLIC ADDRESS                      04000007
TIOWCC   DC    X'C3'       WRITE ERASE                                  04050007
TIOADBAO DS    CL2000     TERMINAL OUTPUT AREA                          04100007
BNGTDISP DSECT                                                          04150007
         DS    4F                                              @OZ30675 04200007
         USING EMFILE,3                                        @OZ30675 04250007
EMFILE DCB DDNAME=EMFILE,DSORG=DA,MACRF=(RIC),OPTCD=R,                 X05000007
               RECFM=F                                                  05050007
SAVREG   DS    A                   RETURN SAVE AREA ADDRESS             05100007
SAVAREA  DS    18F                 BNGTDISP SAVE AREA                   05150007
TCAFCAAA DS    A                                                        05200007
TCTTEDA  DS    A                   ADDRESS OF PASSED FIELD              05250007
TCAPCPI  DC    CL8'00'    SYMBOLIC PROGRAM NAME TO LINK TO              05300007
TCAFCAA  DS    A                                                        05350007
         DS    0H                                                       05400007
TWAAREA  EQU   *        START OF TRANSACTION WORK AREA PAASE PARMS      05450007
PARM1    DS    D                   1ST INPUT FIELD.                     05500007
PARM2    DS    D                   2ND INPUT FIELD.                     05550007
PARM3    DS    D                   3RD INPUT FIELD.                     05600007
PARM4    DS    D                   4TH INPUT FIELD.                     05650007
PARM5    DS    D                   5TH INPUT FIELD.                     05700007
TWASBAS  DS    PL1                 COUNT OF SBA'S IN INPUT MSG.         05750007
TWAREL   DS    CL3                 FILE CONTROL RELATIVE BLK ADDR.      05800007
         DS    CL3            SAVE AREA FOR LINE/CTRLREL BLOCK NO.      05850007
DUBLWD   DS    D                   WORK AREA                            05900007
TWATIOA  DS    F                   SAVE INPUT ADDRESS.                  05950007
TWATCTID DS    F                   SAVE TERML ID.                       06000007
TWASLOT  DS    F                   SLOT COUNTER.                        06050007
SAVE14   DS    F                   SAVE AREA.                           06100007
TWAOUT   DS    F                   SAVE OUTPUT HDR ADDR                 06150007
LINESZ   DS    H                   LINE SIZE (3277 MOD 1 OR MOD 2)      06200007
LINELOOP DS    H                   NBR LINE ITEMS PER LINESZ.           06250007
OUTSWCH  DS    C                                                        06300007
         DS    C                                                        06350007
TEXTSW   DC    X'00'                                                    06400007
HEXLINE  DS    CL2                                                      06450007
HEXLIB   DS    CL3                                                      06500007
HEXCTRL  DS    C                   CTRL UNIT POLL CHAR.                 06550007
HEXTERM  DS    C                   TERML POLL CHAR.                     06600007
NEWFIRST DS    CL5                 SAVE AREA FOR OLD BLK & SLOT NBR.    06650007
NEWPREV  DS    CL5                 SAVE AREA FOR OLD BLK & SLOT NBR.    06700007
        CNOP   0,4                                                      06750007
*                             IF 2ND SBA = L1P7                         06800007
         ORG   PARM5+X'71'         JUMP PAST BNGTDISP WORK AREA         06850007
         DC    C'FILE I/O AREA'                                         06900007
         CNOP  0,4                                                      06950007
DFHFIOA  DS    0H      FILE I/O AREA ADDRESS                            07000007
FIOADBA  DC    4096X'00'        FILE INPUT AREA                         07050007
ENDDATA  DC    X'FFFFFFFF'     MARK END OF DATA                         07100007
         ORG   ENDDATA+8                                                07150007
PROGSTRT EQU   *                                                        07200007
         TITLE 'DEMF REMOTE SRL TEXT MODULE'                            07250007
BNGTRMOT CSECT                                                          07300007
BASEREG  EQU   2                                                        07350007
TCTTEAR  EQU   5                                                        07400007
TIOABAR  EQU   5                                                        07450007
FIOABAR  EQU   6                                                        07500007
SBAREG   EQU   7                                                        07550007
OUTREG   EQU   8                                                        07600007
LINKREG  EQU   12                                                       07650007
DATAREG  EQU   9                                                        07700007
MSGREG   EQU   6                                                        07750007
LIMITREG EQU   11                                                       07800007
NEXTREG  EQU   8                                                        07850007
LTHREG   EQU   7                                                        07900007
INREG    EQU   7                                                        07950007
L18P21   EQU   X'D5E4'   MOD2 SCREEN                                    08000007
SML12P1  EQU   X'C6F8'   MOD1 SCREEN                                    08050007
SBA      EQU   X'11'                        SET BUFFER ADDR COMMAND     08100007
SF       EQU   X'1D'                        START FIELD COMMAND         08150007
IC       EQU   X'13'                        INSERT CURSOR COMMAND       08200007
UNA      EQU   X'40'     UNPROTECTED,NORMAL INTENSITY,ALPHAMERIC        08250007
MNA      EQU   X'61'     MODIFIED,NORMAL INTENSITY,ALPHAMERIC           08300007
PDA      EQU   X'E8'     PROTECTED,HIGH INTENSITY,ALPHAMERIC            08350007
PDM      EQU   X'E9'     PROTECTED,HIGH INTENSITY,MODIFIED              08400007
PNA      EQU   X'60'     PROTECTED,NORMAL INTENSITY,ALPHAMERIC          08450007
         BALR  BASEREG,0                                                08500007
         USING *,BASEREG                                                08550007
BNGTRMOT BNGHJN SKIPID                                         @OZ30675 08570007
         SAVE  (14,12)                                                  08600007
         ST    13,SAVREGR                                               08650007
         LA    13,SAVAREAR           REGISTER STORAGE AREA              08700007
         B     B5                                                       08750007
         DS    0H                                                       08850007
FORTY    DC    X'40404040'                                              08900007
SAVREGR  DC    A(0)                         SAVE REG ADDRESS            08950007
SAVAREAR DS    18F                          SAVE AREA                   09000007
SAVEREG  DS    F                                                        09050007
HALFWORD DS    H                                                        09100007
SBACTR   DS    PL1                                                      09150007
B5       L     TIOABAR,TCTTEDA                                          09200007
         MVI   INDEXSW,X'00'                SET INDEXSW = OFF           09250007
         LA    INREG,TIOADBA                LOCATE INPUT DATA.          09300007
         CLI   0(INREG),SBA                                             09350007
         BNE   B12                                                      09400007
         LA    INREG,3(INREG)                                           09450007
B12      CLC   15(3,INREG),=C'SS='          IS THIS A RQUEST FOR TEXT?  09500007
         BE    D1                           YES. GO LOCATE IT.          09550007
         MVI   INDEXSW,X'FF'                SET INDEXSW = ON            09600007
B14      EQU   *                            NO. BUILD AN INDEX PAGE.    09650007
         LA    LTHREG,IXHDRLTH+3+(44*(SSLTH+4))+(11*SBALTH)             09700007
         BAL   LINKREG,GETTIOA              FREE INAREA & GET OUTAREA.  09750007
         MVC   0(IXHDRLTH,OUTREG),IXHDR     MOVE INDEX HEADER LINE.     09800007
         LA    OUTREG,IXHDRLTH(OUTREG)                                  09850007
         LA    MSGREG,MSG1                  SETUP TO LOCATE ALL         09900007
         L     LIMITREG,=A(LASTMSG)         'SS=????' FIELDS.           09950007
         ZAP   SBACTR,=P'4'                 SETUP FOR 4 PER LINE.       10000007
B22      CLC   0(3,MSGREG),=X'60E2E2'          IS THIS A SENSE/STATUS?  10050007
         BE    C8                           YES. ADD IT TO OUTAREA.     10100007
B24      LA    MSGREG,1(MSGREG)             NO. CONTINUE LOOKING.       10150007
         CR    MSGREG,LIMITREG              ALL DONE?                   10200007
         BL    B22                          NO.                         10250007
         CLI   TCTTETM,C'2'                 IS THIS FOR MOD2 SCREEN?    10300007
         BNE   C3                           NO.                         10350007
         LA    SBAREG,SBA192C               LOAD LAST SBA ATTR ADDR     10400007
         MVC   0(5,OUTREG),0(SBAREG)        MOVE LAST PROTECTED ATTR    10450007
         LA    OUTREG,5(OUTREG)             BUMP 5 BYTES                10500007
C3       CLI   INDEXSW,X'FF'                IS INDEXSW ON ?             10550007
         BNE   C6                           NO.                         10600007
         CLI   TCTTETM,X'F1'                IS THIS A 3277-1 ?          10650007
         BE    C5                           YES.                        10700007
         MVC   0(HITMSGLL,OUTREG),HITMSGL   MOVE 'HIT CLEAR KEY' MSG    10750007
         LA    OUTREG,HITMSGLL(OUTREG)      BUMP OUTPUT POINTER         10800007
         B     C6                                                       10850007
C5       MVC   0(HITMSGSL,OUTREG),HITMSGS   MOVE 'HIT CLEAR KEY' MSG    10900007
         LA    OUTREG,HITMSGSL(OUTREG)      BUMP OUTPUT POINTER         10950007
C6       LA    1,TIOADBAO                    YES,                       11000007
         SR    OUTREG,1                     COMPUTE FINAL               11050007
         STH   OUTREG,TIOATDL               DATA LENGTH.                11100007
         L     13,SAVREGR                   RELOAD  CALLERS SAV AREA    11150007
         RETURN (14,12)                                                 11200007
*********************************************************************** 11250007
*                                                                     * 11300007
*        RETURN                                                       * 11350007
*                                                                     * 11400007
*********************************************************************** 11450007
C8       CP    SBACTR,=P'4'                 BEGINNING A NEW LINE?       11500007
         BNE   C14                          NO.                         11550007
         CLI   TCTTETM,C'2'                 IS THIS FOR MOD2 DISPLAY?   11600007
         BE    C12                          YES.                        11650007
C11      MVC   0(3,OUTREG),0(SBAREG) XXXX   NO. (MOD1) MOVE NEXT        11700007
         LA    SBAREG,3(SBAREG) XXXX        SBA SEQUENCE                11750007
         LA    OUTREG,3(OUTREG) XXXX        TO OUTPUT AREA.             11800007
         B     C13                                                      11850007
C12      MVC   0(8,OUTREG),0(SBAREG) XXXX   YES. MOVE NEXT              11900007
         LA    SBAREG,8(SBAREG) XXXX        SBA SEQUENCE                11950007
         LA    OUTREG,8(OUTREG) XXXX        TO OUTPUT AREA.             12000007
C13      ZAP   SBACTR,=P'0'                                             12050007
C14      MVC   0(SSLTH,OUTREG),SSMSG        MOVE THIS ITEM              12100007
         MVC   SSLTH(4,OUTREG),4(MSGREG)    TO OUTPUT AREA.             12150007
         LA    OUTREG,(SSLTH+4)(OUTREG)                                 12200007
         AP    SBACTR,=P'1'                 ADD 1 TO ITEMS THIS LINE.   12250007
         B     B24                                                      12300007
D1       L     LIMITREG,=A(LASTMSG)         POINT TO LAST MSG.          12350007
         LA    MSGREG,MSG1                  POINT TO 1ST MSG.           12400007
         LR    NEXTREG,MSGREG                                           12450007
D3       MVC   HALFWORD,0(MSGREG)                                       12500007
         AH    NEXTREG,HALFWORD             POINT TO NEXT MSG.          12550007
         ST    MSGREG,SAVEREG                                           12600007
D4       CLC   0(7,MSGREG),15(INREG)        IS THIS THE DESIRED MSG?    12650007
         BE    D12                          YES, MOVE IT TO OUTAREA.    12700007
         LA    MSGREG,1(MSGREG)             NO. STILL IN THIS MSG?      12750007
         CR    MSGREG,NEXTREG                                           12800007
         BL    D4                           YES. KEEP LOOKING.          12850007
         CR    MSGREG,LIMITREG              ALL MSGS LOOKED AT?         12900007
         BL    D3                           NO. RESET ON NEXT MSG.      12950007
         B     B14                          YES. BAD INPUT; SHOW INDEX. 13000007
D12      L     MSGREG,SAVEREG               RESTORE START OF THIS MSG.  13050007
         LA    LTHREG,PGHDRLTH+(12*SBALTH)                              13100007
         MVC   HALFWORD,0(MSGREG)                                       13150007
         AH    LTHREG,HALFWORD              COMPUTE LTH THIS MSG & HDR. 13200007
         MVI   TEXTSW,X'FF'                 SET GETTIOA SUBR SWT        13250007
         BAL   LINKREG,GETTIOA              FREE INAREA & GET OUTAREA.  13300007
         MVC   0(PGHDRLTH,OUTREG),PGHDR     MOVE PAGE HDR LINE.         13350007
         LA    OUTREG,PGHDRLTH(OUTREG)                                  13400007
         MVC   HALFWORD,0(MSGREG)                                       13450007
         LH    1,HALFWORD                   GET TRUE LENGTH             13500007
         SH    1,=H'2'                      OF THIS MSG.                13550007
D20      CH    1,=H'40'                     ONE MORE FULL LINE TO DO?   13600007
         BH    E2                           YES. MOVE IT.               13650007
         MVC   0(3,OUTREG),0(SBAREG)        NO. MOVE THE                13700007
         EX    1,MOVE                       REMAINDER AND               13750007
         AR    OUTREG,1                     GET OUT.                    13800007
         LA    OUTREG,3(OUTREG)                                         13850007
         B     C3                                                       13900007
E2       MVC   0(3,OUTREG),0(SBAREG)        MOVE NEXT SBA SEQUENCE.     13950007
         LA    SBAREG,3(SBAREG)                                         14000007
         CLI   2(MSGREG),SF       IF THIS IS A LINE                     14050007
         BNE   E5                 CONTAINING ATTRIBUTES,                14100007
         MVC   3(2,OUTREG),2(MSGREG)   MOVE                             14150007
         LA    OUTREG,2(OUTREG)        TWO EXTRA                        14200007
         LA    MSGREG,2(MSGREG)        BYTES.                           14250007
         SH    1,=H'2'                                                  14300007
E5       MVC   3(40,OUTREG),2(MSGREG)       MOVE 40 CHARS OF TEXT.      14350007
         LA    OUTREG,43(OUTREG)                                        14400007
         LA    MSGREG,40(MSGREG)                                        14450007
         SH    1,=H'40'                     DECREMENT RESIDUAL COUNT.   14500007
         B     D20                                                      14550007
**  NEXT SEQUENCE OF INST CLEARS OUTPUT TIOA TO BLANKS                  14600007
GETTIOA  LA    0,TIOADBAO                   FIELD TO BE CLEARED         14650007
         LA    1,2000                       LENGTH OF FIELD TO CLEAR    14700007
         L     DATAREG,=X'40000001'          LENGTH AND PADDING CHAR    14750007
         LA    OUTREG,FORTY                 LOAD ADDRESS OF CLEAR BYTE  14800007
         MVCL  0,OUTREG                     MOVE 2000 BYTES OF 40'S     14850007
**    END OF INITIALIZE CODE                                            14900007
         LA    TIOABAR,TIOADBAO             THE RIGHT SIZE.             14950007
         ST    TIOABAR,TCTTEDA                                          15000007
         LA    SBAREG,SBA1920                                           15050007
         CLI   TCTTETM,C'2'                 SETUP ON LIST OF 12         15100007
         BE    G11                          SBA SEQUENCES FOR           15150007
G10      LA    SBAREG,SBA480 XXXX           APPROPRIATE TERM MODEL.     15200007
G1A      MVC   TIOADBAO(3),0(SBAREG) XXXX                               15250007
         LA    SBAREG,3(SBAREG) XXXX        PRIME OUTAREA FOR LINE 1    15300007
         LA    OUTREG,TIOADBAO+3 XXXX        AND SETUP OUTREG FOR       15350007
         BR    LINKREG                                                  15400007
G11      CLI   TEXTSW,X'FF'                 IS TEXTSW ON?               15450007
         BNE   G12                          NOT ON.                     15500007
         LA    SBAREG,SBATXT2               SET SBAREG = SBATXT2 PTR    15550007
         B     G1A                                                      15600007
G12      LA    SBAREG,SBA192A                                           15650007
         MVC   TIOADBAO(5),0(SBAREG) XXXX                               15700007
         MVC   TIOADBAO+5(5),5(SBAREG) XXXX                             15750007
         MVC   TIOADBAO+10(3),10(SBAREG) XXXX                           15800007
         LA    SBAREG,13(SBAREG) XXXX       PRIME OUTAREA FOR LINE 1    15850007
         LA    OUTREG,TIOADBAO+13 XXXX       AND SETUP OUTREG FOR       15900007
         BR    LINKREG                      REMAINING DATA.             15950007
SBALTH   EQU   3                                                        16000007
SBA192A  DC    X'1140401D6C'       AL1(SBA),AL2(L1P1),AL1(SF,PIA)       16050007
SBA1920  DC    X'11C7601D6C11C7F411C8F01D6C11C9C4114A401D6C114AD4'      16100007
         DC    X'114B501D6C114BE4114C601D6C114CF4114DF01D6C114EC4'      16150007
         DC    X'114F401D6C114FD41150501D6C1150E411D1601D6C11D1F4'      16200007
         DC    X'11D2F01D6C11D3C411D4401D6C11D4D411D5501D6C11D5E4'      16250007
SBA192C  DC    X'11D2C81D6C'       AL1(SBA),AL2(L15P41),AL1(SF,PIA)     16300007
SBA480   DC    X'1140401140E811C15011C1F811C26011C3C8'                  16350007
         DC    X'11C3F011C4D811C54011C5E811C65011C6F8'                  16400007
SBATXT2  DC    X'11C7F411C9C4114AD4'                                    16450007
         DC    X'114BE4114CF4114EC4'                                    16500007
         DC    X'114FD41150E411D1F4'                                    16550007
         DC    X'11D3C411D4D411D5E4'                                    16600007
SSMSG    DC    AL1(SF,UNA),C'?SS='                                      16650007
SSLTH    EQU   *-SSMSG                                                  16700007
IXHDR    DC    AL1(IC,SF,MNA),C'DEMF REMOTE'                            16750007
         DC    AL1(SF,PNA),C'STATUS INDEX,X OVER ?,ENTER'               16800007
IXHDRLTH EQU   *-IXHDR                                                  16850007
PGHDR    DC    AL1(IC,SF,MNA),C'DEMF REMOTE'                            16900007
         DC    AL1(SF,PNA),C'HIT ENTER TO REFRESH INDEX'                16950007
PGHDRLTH EQU   *-PGHDR                                                  17000007
HITMSGS  DC    AL1(SBA),AL2(SML12P1),AL1(SF,PNA)                        17050007
         DC    C'HIT CLEAR KEY TO EXIT DEMF'                            17100007
HITMSGSL EQU   *-HITMSGS                                                17150007
HITMSGL  DC    AL1(SBA),AL2(L18P21),AL1(SF,PNA)                         17200007
         DC    C'HIT CLEAR KEY TO EXIT DEMF'                            17250007
HITMSGLL EQU   *-HITMSGL                                                17300007
INDEXSW  DC    X'00'           INDEX SWITCH 00=OFF  FF=ON               17350007
MOVE     MVC   3(1,OUTREG),2(MSGREG)                                    17400007
         LTORG                                                          17450007
MSG1     DC    AL2(MSG2-*)                                              17500007
         DC    C'                                        '              17550007
         DC    AL1(SF,PNA),C'SS=404C',AL1(SF,PNA),C'  '                 17600007
         DC    CL29'EQUIPMENT CHECK,DATA CHECK'                         17650007
         DC    C'THE 3271 DETECTED BAD PARITY ON DATA    '              17700007
         DC    C'RECEIVED FROM THE ADDRESSED DEVICE ON   '              17750007
         DC    C'A SPECIFIC OR GENERAL POLL OR A SELECT  '              17800007
         DC    C'COMMAND.                                '              17850007
         DC    C'                                        '              17900007
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT        '              17950007
         DC    C'                 EOT-TO SPEC OR GEN POLL'              18000007
MSG2     DC    AL2(MSG3-*)                                              18050007
         DC    AL1(SF,PNA),C'SS=4050',AL1(SF,PNA),C'  '                 18100007
         DC    CL29'INTERVENTION REQUIRED'                              18150007
         DC    C'                                        '              18200007
         DC    C'THE ADDRESSED DEVICE IS NOT AVAILABLE   '              18250007
         DC    C'OR ADDRESSED PRINTER IS NOT READY ON A  '              18300007
         DC    C'SELECT,READ,WRITE,ERASE/WRITE OR COPY-  '              18350007
         DC    C'COMMAND.                                '              18400007
         DC    C'                                        '              18450007
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT.       '              18500007
         DC    C'                 EOT-TO A READ,WRITE,-  '              18550007
         DC    C'                     ERASE/WRITE OR COPY'              18600007
         DC    C'                     COMMAND.'                         18650007
MSG3     DC    AL2(MSG4-*)                                              18700007
         DC    C'                                        '              18750007
         DC    AL1(SF,PNA),C'SS=4060',AL1(SF,PNA),C'  '                 18800007
         DC    CL29'COMMAND REJECT'                                     18850007
         DC    C'AN INVALID OR ILLEGAL COMMAND WAS       '              18900007
         DC    C'RECEIVED BY THE 3271 OR 3275.           '              18950007
         DC    C'                                        '              19000007
         DC    C'DEVICE RESPONSE= EOT-TO A READ OR WRITE '              19050007
         DC    C'                     COMMAND.'                         19100007
MSG4     DC    AL2(MSG5-*)                                              19150007
         DC    AL1(SF,PNA),C'SS=40C1',AL1(SF,PNA),C'  '                 19200007
         DC    CL29'OPERATION CHECK'                                    19250007
         DC    C'AN INVALID COMMAND SEQUENCE,(NON RECOVER'              19300007
         DC    C'ABLE PROGRAM ERROR)                     '              19350007
         DC    C'(1)ESCAPE COMMAND SEQUENCE NOT IN SECOND'              19400007
         DC    C'DATA CHARACTER POSITION (HEX 27)        '              19450007
         DC    C'(2)DATA FOLLOWS THE COMMAND IN THE DATA-'              19500007
         DC    C'STREAM RECEIVED BY THE DEVICE.          '              19550007
         DC    C'(3)DATA-STREAM CONTAINS OTHER THAN TWO  '              19600007
         DC    C'BYTES,(COPY CONTROL CHARACTER AND FROM  '              19650007
         DC    C'ADDRESS) COMMAND IS ABORTED.            '              19700007
         DC    C'DEVICE RESPONSE= EOT-TO READ,WRT OR EAU.'              19750007
MSG5     DC    AL2(MSG6-*)                                              19800007
         DC    AL1(SF,PNA),C'SS=40C2',AL1(SF,PNA),C'  '                 19850007
         DC    CL29'CONTROL CHECK'                                      19900007
         DC    C'                                        '              19950007
         DC    C'THE DEVICE FAILS TO RESPOND TO THE 3271 '              20000007
         DC    C'IN TIME AND CAUSES A TIMEOUT OR THE POLL'              20050007
         DC    C'FINDS A DEVICE THAT WAS PREVIOUSLY      '              20100007
         DC    C'AVAILABLE AND READY,NOW UNAVAILABLE AND '              20150007
         DC    C'TIMES OUT.                              '              20200007
         DC    C'                                        '              20250007
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT COMMAND'              20300007
         DC    C'                 EOT-TO A WRITE,SPECIFIC'              20350007
         DC    C'                     OR A GENERAL POLL.'               20400007
MSG6     DC    AL2(MSG7-*)                                              20450007
         DC    AL1(SF,PNA),C'SS=40C3',AL1(SF,PNA),C'  '                 20500007
         DC    CL29'CONTROL CHECK,OPERATION CHECK'                      20550007
         DC    C'                                        '              20600007
         DC    C'THE FROM DEVICE FAILS TO COMPLETE AN    '              20650007
         DC    C'OPERATION OR RESPOND TO THE 3271 IN A   '              20700007
         DC    C'PREDETERMINED TIME PERIOD AND TIMES OUT.'              20750007
         DC    C'                                        '              20800007
         DC    C'DEVICE RESPONSE= EOT TO A COPY COMMAND.'               20850007
MSG7     DC    AL2(MSG8-*)                                              20900007
         DC    AL1(SF,PNA),C'SS=40C4',AL1(SF,PNA),C'  '                 20950007
         DC    CL29'DATA CHECK'                                         21000007
         DC    C'(1)CURSOR CHECK IS DETECTED AT THE 3271 '              21050007
         DC    C'OR BAD PARITY ON DATA FROM THE ADDRESSED'              21100007
         DC    C'DEVICE,(NO DATA SENT TO TCU)(2) A PARITY'              21150007
         DC    C'CHECK DETECTED BY 3271,A SUB CHARACTER  '              21200007
         DC    C'IS SUBSTITUTED FOR THE ERROR CHARACTER  '              21250007
         DC    C'DURING TRANSMISSION TO TCU,WHEN COMPLETE'              21300007
         DC    C'THE 3271 SENDS ENQ TO INDICATE AN ERROR.'              21350007
         DC    C'THE TCU RESPONDS NAK,THE 3271 ANSWERS   '              21400007
         DC    C'EOT.ABOVE IS IN RESPONSE TO A READ,WRITE'              21450007
         DC    C'COMMAND OR A SPECIFIC OR GENERAL POLL.'                21500007
MSG8     DC    AL2(MSG9-*)                                              21550007
         DC    AL1(SF,PNA),C'SS=40C5',AL1(SF,PNA),C'  '                 21600007
         DC    CL29'DATA CHECK,OPERATION CHECK'                         21650007
         DC    C'                                        '              21700007
         DC    C'THE 3271 DETECTS A PARITY CHECK ON THE  '              21750007
         DC    C'DATA TRANSFERRED FROM THE FROM DEVICE.  '              21800007
         DC    C'                                        '              21850007
         DC    C'DEVICE RESPONSE= EOT-TO THE COPY COMMAND'              21900007
MSG9     DC    AL2(MSG10-*)                                             21950007
         DC    AL1(SF,PNA),C'SS=40C8',AL1(SF,PNA),C'  '                 22000007
         DC    CL29'EQUIPMENT CHECK'                                    22050007
         DC    C'                                        '              22100007
         DC    C'THE 3271 DETECTED A PARITY CHECK ON DATA'              22150007
         DC    C'RECEIVED FROM THE DEVICE.               '              22200007
         DC    C'(EQUIPMENT CHECK MAY ALSO BE COMBINED   '              22250007
         DC    C'WITH DATA CHECK,REF 40C4)               '              22300007
         DC    C'                                        '              22350007
         DC    C'DEVICE RESPONSE= EOT-TO A SELECT,READ,  '              22400007
         DC    C'                     WRITE,SPECIFIC OR  '              22450007
         DC    C'                     GENERAL POLL.'                    22500007
MSG10    DC    AL2(MSG11-*)                                             22550007
         DC    AL1(SF,PNA),C'SS=40D1',AL1(SF,PNA),C'  '                 22600007
         DC    CL29'INTERVENTION REQUIRED'                              22650007
         DC    C'           OPERATION CHECK              '              22700007
         DC    C'                                        '              22750007
         DC    C'THE DEVICE IS UNAVAILABLE.              '              22800007
         DC    C'                                        '              22850007
         DC    C'DEVICE RESPONSE= EOT-TO A COPY COMMAND.'               22900007
MSG11    DC    AL2(MSG12-*)                                             22950007
         DC    AL1(SF,PNA),C'SS=4A40',AL1(SF,PNA),C'  '                 23000007
         DC    CL29'DEVICE BUSY,DEVICE END'                             23050007
         DC    C'                                        '              23100007
         DC    C'DEVICE BUSY AND DEVICE END CAN OCCUR    '              23150007
         DC    C'TOGETHER IN RESPONSE TO A SPECIFIC POLL '              23200007
         DC    C'TO A FORMATTED 3277 IF THE OPERATOR HAS '              23250007
         DC    C'PERFORMED BACKTAB OR ERASE INPUT IN     '              23300007
         DC    C'RAPID SUCCESSION.                       '              23350007
         DC    C'IGNORE DEVICE END AND TREAT AS BUSY ONLY'              23400007
         DC    C'                                        '              23450007
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC POLL'               23500007
MSG12    DC    AL2(MSG13-*)                                             23550007
         DC    AL1(SF,PNA),C'SS=4C40',AL1(SF,PNA),C'  '                 23600007
         DC    CL29'DEVICE BUSY,UNIT SPECIFY'                           23650007
         DC    C'                                        '              23700007
         DC    C'ON A READ COMMAND,THE DEVICE WAS BUSY.  '              23750007
         DC    C'THE COMMAND WAS CHAINED TO A SPECIFIC   '              23800007
         DC    C'POLL,WRITE,ERASE/WRITE,OR COPY COMMAND  '              23850007
         DC    C'WHICH STARTED A PRINTER.                '              23900007
         DC    C'ON A COPY COMMAND, THE ADDRESSED "TO"   '              23950007
         DC    C'DEVICE WAS BUSY.                        '              24000007
         DC    C'                                        '              24050007
         DC    C'DEVICE RESPONSE= EOT-TO A READ,WRITE,OR '              24100007
         DC    C'                     A COPY COMMAND.'                  24150007
MSG13    DC    AL2(MSG14-*)                                             24200007
         DC    AL1(SF,PNA),C'SS=4CC1',AL1(SF,PNA),C'  '                 24250007
         DC    CL29'DEVICE BUSY,UNIT SPECIFY'                           24300007
         DC    C'           OPERATION CHECK              '              24350007
         DC    C'THE DB,US AND OP CHECK STATUS AND SENSE '              24400007
         DC    C'WILL BE COMBINED IF A COPY COMMAND IS   '              24450007
         DC    C'ADDRESSED TO A BUSY "TO" DEVICE AND THE '              24500007
         DC    C'COMMAND ALSO SPECIFIES THE "FROM" DEVICE'              24550007
         DC    C'THE SAME AS THE "TO" DEVICE.            '              24600007
         DC    C'                                        '              24650007
         DC    C'DEVICE RESPONSE= EOT-TO A COPY COMMAND.'               24700007
MSG14    DC    AL2(MSG15-*)                                             24750007
         DC    AL1(SF,PNA),C'SS=4E40',AL1(SF,PNA),C'  '                 24800007
         DC    CL29'DEVICE BUSY,UNIT SPECIFY'                           24850007
         DC    C'           DEVICE END                   '              24900007
         DC    C'                                        '              24950007
         DC    C'THE ADDRESSED DEVICE BECOMES NOT BUSY   '              25000007
         DC    C'BEFORE A SPECIFIC POLL IS ISSUED TO     '              25050007
         DC    C'RETRIEVE THE STATUS AND SENSE DATA.     '              25100007
         DC    C'                                        '              25150007
         DC    C'DEVICE RESPONSE= EOT-TO A READ OR WRITE '              25200007
         DC    C'                     COMMAND.'                         25250007
MSG15    DC    AL2(MSG16-*)                                             25300007
         DC    AL1(SF,PNA),C'SS=C140',AL1(SF,PNA),C'  '                 25350007
         DC    CL29'TRANSMISSION CHECK'                                 25400007
         DC    C'                                        '              25450007
         DC    C'3275 DETECTED A BCC ERROR ON THE TCU    '              25500007
         DC    C'TRANSMISSION.                           '              25550007
         DC    C'(TRANSMISSION CHECK NOT USED BY 3271)   '              25600007
         DC    C'                                        '              25650007
         DC    C'DEVICE RESPONSE= EOT-TO A READ OR WRITE '              25700007
         DC    C'                     COMMAND.'                         25750007
MSG16    DC    AL2(MSG17-*)                                             25800007
         DC    AL1(SF,PNA),C'SS=C240',AL1(SF,PNA),C'  '                 25850007
         DC    CL29'DEVICE END'                                         25900007
         DC    C'THE POLL FINDS A DEVICE (1) PREVIOUSLY- '              25950007
         DC    C'BUSY,NOW NOT BUSY OR,(2) PREVIOUSLY-    '              26000007
         DC    C'UNAVAILABLE OR NOT READY, NOW AVAILABLE '              26050007
         DC    C'AND READY. (THE 3271 RECORD IS UPDATED) '              26100007
         DC    C'NOTE: WHEN 3271 POWER IS TURNED ON, THE '              26150007
         DC    C'"DEVICE END" IS SET FOR EACH AVAILABLE  '              26200007
         DC    C'AND READY DEVICE THAT IS ATTACHED.      '              26250007
         DC    C'                                        '              26300007
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR   '              26350007
         DC    C'                     GENERAL POLL.'                    26400007
MSG17    DC    AL2(MSG18-*)                                             26450007
         DC    AL1(SF,PNA),C'SS=C250',AL1(SF,PNA),C'  '                 26500007
         DC    CL29'DEVICE END'                                         26550007
         DC    C'           INTERVENTION REQUIRED        '              26600007
         DC    C'(1)UPON SELECTION THE ADDRESSED PRINTER '              26650007
         DC    C'IS OUT OF PAPER, ITS POWER HAS BEEN TURN'              26700007
         DC    C'ED OFF, OR ITS COVER IS OPEN.           '              26750007
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT COMMAND'              26800007
         DC    C'                                        '              26850007
         DC    C'(2) THE POLL FINDS THE PRINTER NOT READY'              26900007
         DC    C'OR NOT AVAILABLE.                       '              26950007
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR   '              27000007
         DC    C'                     GENERAL POLL.'                    27050007
MSG18    DC    AL2(MSG19-*)                                             27100007
         DC    AL1(SF,PNA),C'SS=C2C4',AL1(SF,PNA),C'  '                 27150007
         DC    CL29'DEVICE END,DATA CHECK'                              27200007
         DC    C'                                        '              27250007
         DC    C'3275 (ONLY) DETECTS AN INTERNAL PARITY  '              27300007
         DC    C'OR CURSOR CHECK ON ITS BUFFER WHEN THE  '              27350007
         DC    C'ATTACHED PRINTER GOES "NOT BUSY".       '              27400007
         DC    C'                                        '              27450007
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR   '              27500007
         DC    C'                     GENERAL POLL.'                    27550007
MSG19    DC    AL2(MSG20-*)                                             27600007
         DC    AL1(SF,PNA),C'SS=C2C8',AL1(SF,PNA),C'  '                 27650007
         DC    CL29'DEVICE END,EQUIPMENT CHECK'                         27700007
         DC    C'                                        '              27750007
         DC    C'THE 3275 (ONLY) DETECTED A CHARACTER    '              27800007
         DC    C'GENERATOR READOUT ERROR.                '              27850007
         DC    C'                                        '              27900007
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR   '              27950007
         DC    C'                     GENERAL POLL.'                    28000007
MSG20    DC    AL2(MSG21-*)                                             28050007
         DC    AL1(SF,PNA),C'SS=C2D8',AL1(SF,PNA),C'  '                 28100007
         DC    CL29'DEVICE END,INTV REQUIRED'                           28150007
         DC    C'           EQUIPMENT CHECK              '              28200007
         DC    C'                                        '              28250007
         DC    C'(3275 ONLY) THE ATTACHED PRINTER, "AC-  '              28300007
         DC    C'POWER" IS TURNED OFF,OR A MECHANICAL    '              28350007
         DC    C'"HANG" CONDITION WAS DETECTED           '              28400007
         DC    C'                                        '              28450007
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR   '              28500007
         DC    C'                     GENERAL POLL.      '              28550007
MSG21    DC    AL2(MSG22-*)                                             28600007
         DC    AL1(SF,PNA),C'SS=C4C1',AL1(SF,PNA),C'  '                 28650007
         DC    CL29'UNIT SPECIFY,OPERATION CHECK'                       28700007
         DC    C'                                        '              28750007
         DC    C'THE "FROM DEVICE" HAS A "LOCKED BUFFER" '              28800007
         DC    C'AND CANNOT BE COPIED. (PROGRAM ERROR)   '              28850007
         DC    C'                                        '              28900007
         DC    C'DEVICE RESPONSE= EOT-TO THE COPY COMMAND'              28950007
MSG22    DC    AL2(MSG23-*)                                             29000007
         DC    AL1(SF,PNA),C'SS=C4C4',AL1(SF,PNA),C'  '                 29050007
         DC    CL29'UNIT SPECIFY,DATA CHECK'                            29100007
         DC    C'DURING POLLING,SELECT OR READ COMMANDS  '              29150007
         DC    C'THE ADDRESSED DEVICE DETECTS A "CURSOR" '              29200007
         DC    C'OR "PARITY" CHECK ON DATA THAT IS BEING '              29250007
         DC    C'TRANSFERRED TO THE CONTROL UNIT OR      '              29300007
         DC    C'DURING THE COMMAND OPERATION ON A WRITE '              29350007
         DC    C'COMMAND                                 '              29400007
         DC    C'                                        '              29450007
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT.       '              29500007
         DC    C'                 EOT-TO READ,WRITE OR   '              29550007
         DC    C'                     POLLING COMMANDS.'                29600007
MSG23    DC    AL2(MSG24-*)                                             29650007
         DC    AL1(SF,PNA),C'SS=C4C5',AL1(SF,PNA),C'  '                 29700007
         DC    CL29'UNIT SPECIFY,DATA CHECK   '                         29750007
         DC    C'           OPERATION CHECK              '              29800007
         DC    C'                                        '              29850007
         DC    C'THE "FROM DEVICE" DETECTED AN INTERNAL  '              29900007
         DC    C'CURSOR OR PARITY CHECK DURING A COPY-   '              29950007
         DC    C'COMMAND.                                '              30000007
         DC    C'                                        '              30050007
         DC    C'DEVICE RESPONSE= EOT-TO THE COPY COMMAND'              30100007
MSG24    DC    AL2(MSG25-*)                                             30150007
         DC    AL1(SF,PNA),C'SS=C4D8',AL1(SF,PNA),C'  '                 30200007
         DC    CL29'UNIT SPECIFY,INTV REQUIRED'                         30250007
         DC    C'           EQUIPMENT CHECK              '              30300007
         DC    C'                                        '              30350007
         DC    C'A COMMAND ATTEMPTED TO START A PRINTER  '              30400007
         DC    C'OPERATION BUT THE PRINTER CARRIAGE MOTOR'              30450007
         DC    C'POWER SWITCH WAS TURNED OFF.            '              30500007
         DC    C'                                        '              30550007
         DC    C'DEVICE RESPONSE= EOT-TO A WRITE,ERASE/- '              30600007
         DC    C'                   WRITE OR COPY COMMAND'              30650007
MSG25    DC    AL2(MSG26-*)                                             30700007
         DC    AL1(SF,PNA),C'SS=C6C4',AL1(SF,PNA),C'  '                 30750007
         DC    CL29'UNIT SPECIFY,DEVICE END'                            30800007
         DC    C'           DATA CHECK                   '              30850007
         DC    C'                                        '              30900007
         DC    C'A PARITY CHECK IS DETECTED AT THE       '              30950007
         DC    C'PRINTER                                 '              31000007
         DC    C'                                        '              31050007
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT COMMAND'              31100007
         DC    C'                 EOT-TO A SPECIFIC OR   '              31150007
         DC    C'                     GENERAL POLL.'                    31200007
MSG26    DC    AL2(MSG27-*)                                             31250007
         DC    AL1(SF,PNA),C'SS=C6C8',AL1(SF,PNA),C'  '                 31300007
         DC    CL29'UNIT SPECIFY,DEVICE END'                            31350007
         DC    C'           EQUIPMENT CHECK              '              31400007
         DC    C'A CHARACTER GENERATOR ERROR IS DETECTED '              31450007
         DC    C'BUT THERE IS NO DATA ERROR,(BUFFER DATA-'              31500007
         DC    C'IS VALID AND REUSEABLE) OR A MECHANICAL '              31550007
         DC    C'FAILURE OCCURED.(COVER OPEN,PAPER OUTAGE'              31600007
         DC    C'OR DISABLED PRINT MECHANISM)            '              31650007
         DC    C'                                        '              31700007
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT.       '              31750007
         DC    C'                 EOT-TO A SPECIFIC OR A '              31800007
         DC    C'                     GENERAL POLL.'                    31850007
MSG27    DC    AL2(MSG28-*)                                             31900007
         DC    AL1(SF,PNA),C'SS=C6D8',AL1(SF,PNA),C'  '                 31950007
         DC    CL29'UNIT SPECIFY,DEVICE END'                            32000007
         DC    C'           INTV REQUIRED,EQUIPMENT CHECK'              32050007
         DC    C'                                        '              32100007
         DC    C'AN UNRECOVERABLE MECHANICAL FAILURE IS  '              32150007
         DC    C'DETECTED AT THE ADDRESSED PRINTER.      '              32200007
         DC    C'                                        '              32250007
         DC    C'DEVICE RESPONSE= EOT-TO A SPECIFIC OR A '              32300007
         DC    C'                     GENERAL POLL.      '              32350007
MSG28    DC    AL2(MSG29-*)                                             32400007
         DC    AL1(SF,PNA),C'SS=C840',AL1(SF,PNA),C'  '                 32450007
         DC    CL29'DEVICE BUSY'                                        32500007
         DC    C'                                        '              32550007
         DC    C'INDICATES NORMAL STATUS FOR A DEVICE    '              32600007
         DC    C'EXECUTING A PREVIOUSLY ISSUED COMMAND,- '              32650007
         DC    C'PRINTER OPERATION,BUFFER TRANSFER,ID-   '              32700007
         DC    C'CARD READER OPERATION OR KEYBOARD-      '              32750007
         DC    C'FUNCTIONS.                              '              32800007
         DC    C'                                        '              32850007
         DC    C'DEVICE RESPONSE= RVI-TO A SELECT COMMAND'              32900007
         DC    C'                 EOT-TO A SPECIFIC POLL.'              32950007
MSG29    DC    AL2(MSG30-*)                                             33000007
         DC    AL1(SF,PNA),C'SS=C8C1',AL1(SF,PNA),C'  '                 33050007
         DC    CL29'DEVICE BUSY,OPERATION CHECK'                        33100007
         DC    C'                                        '              33150007
         DC    C'ON A COPY COMMAND,THE "FROM" DEVICE IS  '              33200007
         DC    C'BUSY EXECUTING A PRINTOUT,READING FROM  '              33250007
         DC    C'THE ID CARD READER OR PERFORMING KEY-   '              33300007
         DC    C'BOARD FUNCTIONS. THE COPY COMMAND IS    '              33350007
         DC    C'ABORTED.                                '              33400007
         DC    C'                                        '              33450007
         DC    C'DEVICE RESPONSE= EOT-TO THE COPY COMMAND'              33500007
MSG30    DC    AL2(LASTMSG-*)                                           33550007
         DC    AL1(SF,PNA),C'SS=HELP',AL1(SF,PNA),C'  '                 33600007
         DC    CL29'REMOTE STATUS MSG HELPER.'                          33650007
         DC    CL40'FIELDS "SS=XXXX" REFER TO REMOTE STATUS'            33700007
         DC    CL40'MESSAGES.  ALL COMBINATIONS ARE NOT'                33750007
         DC    CL40'DOCUMENTED.  IF YOU DON''T SEE THE ONE'             33800007
         DC    CL40'YOU NEED, SUCH AS "C2C2" DROP ONE OF THE'           33850007
         DC    CL40'INSIGNIFICANT BITS SUCH AS "DEVICE END".'           33900007
         DC    CL40'THIS WILL PRODUCE "40C2" (YOU NEED A'               33950007
         DC    CL40'6-BIT CODE CHART TO FIGURE THE HIGH-'               34000007
         DC    CL40'ORDER BITS).  NOW LOOK UP MSG FOR "40C2"'           34050007
         DC    CL40'TO SEE IF IT APPLIES TO YOUR SITUATION.'            34100007
LASTMSG  EQU   *                                                        34150007
REMOTID  DC    C'BNGTRMOT END'                                          34200007
         END                                                            34250007
./  ADD  SSI=81160228,NAME=BNGT3270
         PRINT OFF                                                      00050007
         MACRO                                                          00050407
&NAME    BNGHJN &LABEL,&HJN                                             00050807
         LCLC  &HJA,&HJB                                                00051207
&HJA     SETC  '&SYSPARM'(1,4)                                          00051607
&HJB     SETC  '&SYSPARM'(5,4)                                          00052007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00052407
         B     &LABEL .                 BR AROUND CONSTANTS             00052807
         SPACE 2                                                        00053207
.NOBRNCH ANOP                                                           00053607
         AIF   ('&NAME' EQ '').NOLABEL                                  00054007
         DC    C'&NAME' .              MODULE IDENTIFIER                00054407
.NOLABEL ANOP                                                           00054807
         DC    X'&HJA' .                DATE OF MODIFICATION            00055207
         AIF   ('&HJN' NE 'HJN').DATE                                   00055607
         DC    X'&HJB' .                HJN OF MODIFICATION             00056007
.DATE    ANOP                                                           00056407
         AIF   ('&LABEL' EQ '').NOLBL                                   00056807
         SPACE 2                                                        00057207
&LABEL   DS    0H                                                       00057607
.NOLBL   ANOP                                                           00058007
         MEND                                                           00058407
         PRINT ON                                                       00058807
*********************************************************************** 00059207
*                                                                     * 00100000
* MODULE NAME = BNGT3270                                              * 00150000
*                                                                     * 00200000
* DESCRIPTIVE NAME = TCAM DEMF 3270 DISPLAY MODULE                    * 00250000
*                                                                     * 00300000
* COPYRIGHT = NONE                                                    * 00350000
*                                                                     * 00400000
* STATUS = RELEASE 1, LEVEL 1                                         * 00450000
*                                                                     * 00500000
* FUNCTION = 1) BNGT3270 IS LINKED TO BY BNGTDISP;                    * 00550000
*            2) HANDLES 3270 DISPLAY TERMINAL ERROR INFORMATION       * 00600000
*               REQUEST AND BITS PROMPTER REQUEST;                    * 00650000
*            3) ACCESSES SYS1.DEMFLOG DATA FILE AND COLLECTS THE      * 00700000
*               REQUESTED 3270 ERROR INFORMATION FROM IT;             * 00750000
*            4) FORMS OUTPUT MESSAGE AND WRITES IT TO THE 3270 DISPLAY* 00800000
*               TERMINAL; (ERR INFO AND SOME OF DISPLAY MESSAGES)     * 00850000
*            5) RETURNS CONTROL TO BNGTDISP.                          * 00900000
*                                                                     * 00950000
* NOTES = NONE                                                        * 01000000
*                                                                     * 01050000
*    DEPENDENCIES = NONE                                              * 01100000
*                                                                     * 01150000
*    RESTRICTIONS = NONE                                              * 01200000
*                                                                     * 01250000
*    REGISTER CONVENTIONS = R10 RECEIVES ADDRESS OF I/O MESSAGE AREA  * 01300000
*                           FROM BNGTDISP                             * 01350000
*                                                                     * 01400000
*    PATCH LABEL = NONE                                               * 01450000
*                                                                     * 01500000
* MODULE TYPE = TCAM DISPLAY                                          * 01550000
*                                                                     * 01600000
*    PROCESSOR = ASSEMBLER H                                          * 01650000
*                                                                     * 01700000
*    MODULE SIZE = 7623 DECIMAL BYTES                                 * 01750000
*                                                                     * 01800000
*    ATTRIBUTES = SERIALLY REUSABLE                                   * 01850000
*                                                                     * 01900000
* ENTRY POINT = BNGT3270                                              * 01950000
*                                                                     * 02000000
*    PURPOSE = SEE FUNCTION                                           * 02050000
*                                                                     * 02100000
*    LINKAGE = R1  LOADED WITH THE PARAM LIST POINTER                 * 02150000
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 02200000
*              R15 LOADED WITH ENTRY POINT                            * 02250000
*                                                                     * 02300000
* INPUT = PARAM LIST ITEMS USED ARE :                                 * 02350000
*         IN MESSAGE ADDRESS  = TCAMFLDS (R10)                        * 02400000
*         IN MESSAGE COUNT    = VARIABLE (MAXIMUM=117 BYTES)          * 02450000
*                                                                     * 02500000
* OUTPUT = PARAM LIST ITEMS USED ARE :                                * 02550000
*         OUT MESSAGE ADDRESS = TIOADBAO (R10)                        * 02600000
*         OUT MESSAGE COUNT   = VARIABLE (MAXIMUM=2008 BYTES)         * 02650000
*                                                                     * 02700000
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 02750000
*               00 - OPERATION PERFORMED AS REQUESTED                 * 02800000
*                                                                     * 02850000
* EXIT-ERROR  = SYNAD ROUTINE AT LABEL - F1900                        * 02900000
*                                                                     * 02950000
* EXTERNAL REFERENCE = NONE                                           * 03000000
*                                                                     * 03050000
*    ROUTINES = LOCATE ROUTINE                                        * 03100000
*               GETTIOA ROUTINE (GET TERMINAL OUTPUT AREA)            * 03150000
*               BUOBR ROUTINE (BLOW-UP OBR ROUTINE)                   * 03200000
*               BUMDR ROUTINE (BLOW-UP MDR ROUTINE)                   * 03250000
*                                                                     * 03300000
*    DATA AREAS = SEE INPUT AND OUTPUT ABOVE                          * 03350000
*                                                                     * 03400000
*    CONTROL BLOCK = DCB (AT LABEL EMFILE)                            * 03450000
*                                                                     * 03500000
* TABLES = CALENDAR - CONVERT JULIAN DATE TO GREGORIAN DATE TABLE     * 03550000
*          LEAPTBL  - LEAP YEAR CALCULATION TABLE                     * 03600000
*          CCWTABL  - CONVERT 270X COMMAND CODE INTO ENGLISH          * 03650000
*          CSWTABL  - CONVERT LOCAL 327X STATUS OR 270X LINE STATUS   * 03700000
*                     INTO ENGLISH                                    * 03750000
*          SENSTABL - CONVERT 270X LINE SENSE CODE INTO ENGLISH       * 03800000
*          STATSTBL - CONVERT REMOTE 327X STATUS CODE INTO ENGLISH    * 03850000
*          SENS3272 - CONVERT LOCAL 327X SENSE CODE INTO ENGLISH      * 03900000
*          CCW3272  - CONVERT LOCAL 327X COMMAND CODE INTO ENGLISH    * 03950000
*          TPOPTBL  - CONVERT BTAM TP OP CODE INTO ENGLISH            * 04000000
*          TCAMPTOP - CONVERT TCAM TP OP CODE INTO ENGLISH            * 04050000
*          HXTOEB   - HEX CHARS TO EBCDIC CHARS TABLE                 * 04100000
*          EBTOHX   - EBCDIC CHARS TO HEX CHARS TABLE                 * 04150000
*                                                                     * 04200000
* MACROS = LINK, SAVE, RETURN, OPEN, READ, CHECK, CLOSE, TIME         * 04250000
*                                                                     * 04300000
******************CHANGE ACTIVITIES AS FOLLOWS:************************ 04350000
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 04350107
* CHANGE 02  02/27/78  BNGHJN MACRO ADDED                             * 04350207
*A143000,287000                                                @OZ30478 04350307
*D144500-145000                                                @OZ30478 04350407
*C081500-089000                                                @OZ30675 04350507
*A207500,485000,543500                                         @OZ31884 04350607
*D636000-639000                                                @OZ31884 04350707
*                                                                     * 04400000
*                                                                     * 04450000
*********************************************************************** 04500000
R0       EQU   0                                                        04550000
R1       EQU   1              REGISTER ONE                              04600000
R8       EQU   8                                                        04650000
REG9     EQU   9                                                        04700000
BASE1    EQU   2                   1ST PROGRAM BASE REG.                04750000
BASE2    EQU   4                   2ND PROGRAM BASE REG.                04800000
TIOABAR  EQU   5                   TIOA POINTER.                        04850000
FIOABAR  EQU   6                   FIOA POINTER.                        04900000
DATAREG  EQU   7                   POINTER TO DATA IN EMF FILE BLOCK.   04950000
DATALOOP EQU   8                   LOOP REG FOR PROCESSING WITH DATAREG 05000000
OUTREG   EQU   9                   POINTER TO VARIABLE AREA IN TIOA.    05050000
LINKREG  EQU   11                  LOOP REG FOR PROCESSING WITH OUTREG. 05100000
OUTLOOP  EQU   12                  LINKAGE TO COMMON SUBROUTINES.       05150000
R14      EQU   14                                                       05200000
R15      EQU   15                                                       05250000
SBA      EQU   X'11'                                                    05300000
SF       EQU   X'1D'                                                    05350000
IC       EQU   X'13'                                                    05400000
UMN      EQU   X'41'               UNPROT,NORMAL,MODIFIED               05450000
UNA      EQU   X'40'                                                    05500000
PNA      EQU   X'60'                                                    05550000
UHA      EQU   X'C8'                                                    05600000
PDA      EQU   X'E8'                                                    05650000
PIA      EQU   X'6D'                                                    05700000
MNP      EQU   X'61'                                                    05750000
SML2P1   EQU   X'40E8'                                                  05800000
SML3P1   EQU   X'C150'                                                  05850000
SML4P1   EQU   X'C1F8'                                                  05900000
L1P1     EQU   X'4040'                                                  05950000
L2P1     EQU   X'C150'                                                  06000000
L3P1     EQU   X'C260'                                                  06050000
L4P1     EQU   X'C3F0'                                                  06100000
SML5P1   EQU   X'C260'   LINE 5 POSITION 1 FOR MOD-1 SCREEN             06150000
L1P36    EQU   X'40E3'                                                  06200000
L1P7     EQU   X'40C6'                                                  06250000
L3P39    EQU   X'C1F6'                                                  06300000
L2P79    EQU   X'C25E'                                                  06350000
L6P26    EQU   X'C6E9'                                                  06400000
TCAMOBR  EQU   X'34'                                                    06450000
BTAMOBR  EQU   X'30'                                                    06500000
TCAMFLDS DSECT                                                          06550000
         USING *,10                                                     06600000
TIOATDL  DC    X'0000'    TERMINAL DATA LENGTH                          06650000
TCTTETT  DS    CL1   91=REMOTE  99=LOCAL 3270                           06700000
TCTTETM  DS    CL1    F1=MODEL 1  F2=MODEL 2 3270                       06750000
TCTTEGU  DS    0H     EUATE LOCAL LINE ADDRESES                         06800000
TCTLERLN DS    CL3     LINE ADDRESS RELATIVE LINE #                     06850000
TCTTETA  DS    CL1   CONTROL UNIT ADDRESS                               06900000
         DS    CL1     TERNINAL ADDRESS REMOTE                          06950000
TIOADBA  DS    CL100        TERMINAL INPUT AREA                         07000000
TCTTETI  DS    CL8          TCAM  SYMBOLIC ADDRESS                      07050000
TIOWCC   DC    X'C3'       WRITE ERASE                                  07100000
TIOADBAO DS    CL2000     TERMINAL OUTPUT AREA                          07150000
         ORG   TIOADBA             POINT TO INPUT AREA                  07200000
SBA1     DS    CL3                 IST SBA POSITION                     07250000
CODE     DS    CL4                 TRANS CODE.                          07300000
SBA2     DS    CL3                 2ND SBA                              07350000
PGRM     DS    CL4                 PROGRAM NAME.                        07400000
SBA3     DS    CL3                 3RD SBA.                             07450000
FLP      DS    CL15                FIRST/LAST/PREVIOUS IF BLOWUP RQST.  07500000
SBA4     DS    CL3                 4TH SBA.                             07550000
BUX      DS    CL4                 X FOR BLOWUP REQUEST.                07600000
TIOITEM  DS    CL5                 ITEM ADDRESS TO BLOWUP.              07650000
         ORG   FLP                                                      07700000
         DS    C                   FOR FORWARD AND BACKWARD PAGE REQ XH 07750000
         DS    CL3                 ALTERNATE POSN FOR 4TH SBA           07800000
TIOFIRST DS    CL5                 BLK & SLT 1ST ITEM ON SCREN.         07850000
TIOLAST  DS    CL5                 BLK & SLT FOR LAST                   07900000
TIOPREV  DS    CL5                 BLK & SLT 1ST ITEM PREVIOUS SCREEN.  07950000
         DS    CL3                 5TH SBA                              08000000
RTNX     DS    C                   X FOR RETURN FROM BLOWUP             08050000
BNGTDISP DSECT                                                          08100000
         DS    4F                                              @OZ30675 08150007
         USING EMFILE,3                                        @OZ30675 08200007
EMFILE DCB DDNAME=EMFILE,DSORG=DA,MACRF=(RIC),OPTCD=R,                 X08950000
               RECFM=F                                                  09000000
SAVREG   DS    A                   RETURN SAVE AREA ADDRESS             09050000
SAVAREA  DS    18F                 DEMFDISP SAVE AREA                   09100000
TCAFCAAA DS    A                                                        09150000
TCTTEDA  DS    A                   ADDRESS OF PASSED FIELD              09200000
TCAPCPI  DC    CL8'00'    SYMBOLIC PROGRAM NAME TO LINK TO              09250000
TCAFCAA  DS    A                   FILE I/O AREA ADDRESS                09300000
         DS    0H                                                       09350000
TWAAREA  EQU   *        START OF TRANSACTION WORK AREA PAASE PARMS      09400000
PARM1    DS    D                   1ST INPUT FIELD.                     09450000
PARM2    DS    D                   2ND INPUT FIELD.                     09500000
PARM3    DS    D                   3RD INPUT FIELD.                     09550000
PARM4    DS    D                   4TH INPUT FIELD.                     09600000
PARM5    DS    D                   5TH INPUT FIELD.                     09650000
PARM6    DS    D                   6TH INPUT FIELD.                     09700000
TWASBAS  DS    PL1                 COUNT OF SBA'S IN INPUT MSG.         09750000
TWAREL   DS    CL3                 FILE CONTROL RELATIVE BLK ADDR.      09800000
         DS    CL3            SAVE AREA FOR LINE/CTRLREL BLOCK NO.      09850000
DUBLWD   DS    D                   WORK AREA                            09900000
TWATIOA  DS    F                   SAVE INPUT ADDRESS.                  09950000
TWATCTID DS    F                   SAVE TERML ID.                       10000000
TWASLOT  DS    F                   SLOT COUNTER.                        10050000
SAVE14   DS    F                   SAVE AREA.                           10100000
TWAOUT   DS    F                   SAVE OUTPUT HDR ADDR                 10150000
LINESZ   DS    H                   LINE SIZE (3277 MOD 1 OR MOD 2)      10200000
LINELOOP DS    H                   NBR LINE ITEMS PER LINESZ.           10250000
OUTSWCH  DS    C                                                        10300000
HXLINLIB DS    0CL6                LINE ADDRESS INCLUDING               10350000
         DS    C                                                        10400000
HEXLINE  DS    CL2                                                      10450000
HEXLIB   DS    CL3                                                      10500000
HEXCTRL  DS    C                   CTRL UNIT POLL CHAR.                 10550000
HEXTERM  DS    C                   TERML POLL CHAR.                     10600000
NEWFIRST DS    CL5                 SAVE AREA FOR OLD BLK & SLOT NBR.    10650000
NEWPREV  DS    CL5                 SAVE AREA FOR OLD BLK & SLOT NBR.    10700000
BITFIRST DS    CL5                 SAVE AREA FOR FIRST BLK & SLOT NBR.  10750000
BITLAST  DS    CL5                 SAVE AREA FOR LAST  BLK & SLOT NBR.  10800000
BITPREV  DS    CL5                 SAVE AREA FOR PREV  BLK & SLOT NBR.  10850000
        CNOP   0,4                                                      10900000
*                             IF 2ND SBA = L1P7                         10950000
         ORG   PARM6+X'70'         JUMP PAST DEMFDISP WORK AREA         11000000
WORK15   DS    CL5                                                      11050000
WORK16   DS    CL5                                                      11100000
         DS    CL6                                                      11150000
         DC    C'FILE I/O AREA'                                         11200000
         CNOP  0,4                                                      11250000
         USING *,FIOABAR                                                11300000
DFHFIOA  DS    0H      FILE I/O AREA ADDRESS                            11350000
FIOADBA  DC    4096X'00'        FILE INPUT AREA                         11400000
ENDDATA  DC    X'FFFFFFFF'     MARK END OF DATA                         11450000
         ORG   ENDDATA+8                                                11500000
PROGSTRT EQU   *                                                        11550000
         ORG   FIOADBA                                                  11600000
CTRLLAST DS    F                   LAST USED ADDR IN DATASET            11650000
CTRLTOTL DS    F                   TOTAL BLOCKS IN DATASET              11700000
CTRLBACK DS    F                   BACKWARD PTR IN CTRL BLK CHAIN       11750000
CTRLFWD  DS    F                   FORWARD PTR IN CTRL BLK CHAIN        11800000
CTRLENTS DS    C                   NBR ENTRIES IN THIS CTRL BLK         11850000
         DS    CL15                FOR FUTURE USE                       11900000
CTRLSLT1 DS    0C                  START OF CTRL SLOT NBR ONE.          11950000
         ORG  FIOADBA                                                   12000000
DATAPORT DS    CL6                 PORT & LIB ADDR                      12050000
DATATIME DS    CL4                 TIME BLOCK CREATED                   12100000
DATADATE DS    CL4                 DATE BLOCK CREATED                   12150000
DATAFWD  DS    CL3                 FORWARD CHAIN ADDR                   12200000
DATABACK DS    CL3                 BACKWAD CHAIN ADDR                   12250000
BLKLTH   DS    CL2                 NBR BYTES USED IN THIS BLOCK         12300000
         DS    CL10                                                     12350000
DATASLT1 DS    0C                  START OF 1ST DATA SLOT               12400000
DATASLOT DSECT                                                          12450000
         USING *,DATAREG                                                12500000
DATALTH  DS    C                   LTH OF THIS SLOT                     12550000
LINEID   DS    CL6                 LINE AND LIB ADDR                    12600000
ENTRYTYP DS    C                   ENTRY TYPE - MDR OR OBR              12650000
         DS    CL3                                                      12700000
MDRTYPE  DS    C                   TYPE HDWE - 03 EQUALS 3270           12750000
         DS    CL3                                                      12800000
DATE     DS    CL4                 DATE OF ERROR - 00YY0DDF             12850000
TIME     DS    CL4                 TIME OF ERROR - HHMMSSHH             12900000
         DS    CL8                                                      12950000
MDRCUA   DS    CL2                 MDR CHAN & UNIT ADDR                 13000000
MDRCTRL  DS    C                   MDR CTRL UNIT POLL ADDR              13050000
MDRTERM  DS    C                   MDR TERMIL POLL ADDR                 13100000
MDRSTATS DS    CL2                 REMOTE 3270 STATUS                   13150000
         DS    CL2                                                      13200000
OBRCCW   DS    CL8                 LAST CCW EXECUTED                    13250000
OBRCSW   DS    CL8                 CHANNEL STATUS WORD                  13300000
OBRDVDEP DS    CL1                                                      13350000
         DS    CL5                                                      13400000
OBRUCB   DS    C                                                        13450000
         DS    CL1                                                      13500000
OBRSDR   DS    CL1                 NUMBER BYTES OF STATICAL DATA        13550000
         DS    CL1                                                      13600000
OBRCUA   DS    CL2                 OBR CHAN & UNIT ADDR                 13650000
OBRPOLL  DS    CL2                 POLL CHAR                            13700000
         DS    CL12                                                     13750000
OBRSENSE DS    CL2                 OBR SENSE BYTES                      13800000
         ORG   DATALTH                                                  13850000
CTRLPORT DS    CL6                 PORT & LIB ADDRESS                   13900000
         DS    CL4                                                      13950000
CTRLFRST DS    CL3                 REL BLK ADDR 1ST BLK IN CHAIN.       14000000
         DS    CL3                                                      14050000
SLOTLTH  EQU   *-CTRLPORT                                               14100000
BNGT3270 CSECT                                                          14150000
         SAVE  (14,12)       SAVE CALLERS REGISTER                      14200000
         BALR  BASE1,0                                                  14250000
         USING *,BASE1,BASE2                                            14300000
BNGC3270 BNGHJN SKIPID                                         @OZ30478 14320007
         LA    BASE2,2048(BASE1)   SETUP PROGRAM BASE REGS.             14350000
         LA    BASE2,2048(BASE2)                                        14400000
A0000    ST    13,SAV3270R                                              14550000
         LA    13,SAV3270A                                              14600000
         L     TIOABAR,TCTTEDA     POINT TO TIOA INPUT AREA.            14650000
         L     FIOABAR,TCAFCAA  INITIALIZE FILE REG TO POINT FILE AREA  14700000
         OPEN  (EMFIL1,(INPUT))                                         14750000
         CP    TWASBAS,=P'2'       WERE LESS THAN 2 FIELDS INPUT?       14800000
         BNL   J010                NO. GO EXAMINE INPUT FURTHER.        14850000
A010     XC    TWAREL,TWAREL       YES. THIS IS A NEW RECAP REQUEST.    14900000
         CLC   PARM3(3),=C'ALL'    IF PARM 3 IS ONE OF THE DEMF         14950000
         BE    A140                DISPLAY CODES, THIS INPUT WAS FROM   15000000
         CLC   PARM3(4),=C'CTRL'          FORMATTED SCREEN.             15050000
         BE    A140                ZERO IT OUT AND TRY AGAIN.           15100000
         CLC   PARM3(4),=C'LINE'                                        15150000
         BE    A140                                                     15200000
         CLC   PARM3(4),=C'3270'                                        15250000
         BE    A140                                                     15300000
         CLC   PARM4(3),=C'ALL'                                         15350000
         BE    A130                                                     15400000
         CLC   PARM4(4),=C'CTRL'                                        15450000
         BE    A130                                                     15500000
         CLC   PARM4(4),=C'LINE'                                        15550000
         BE    A130                                                     15600000
         CLC   PARM4(4),=C'3270'                                        15650000
         BE    A130                                                     15700000
         CLC   PARM5(3),=C'ALL'                                         15750000
         BE    A120                                                     15800000
         CLC   PARM5(4),=C'CTRL'                                        15850000
         BE    A120                                                     15900000
         CLC   PARM5(4),=C'LINE'                                        15950000
         BE    A120                                                     16000000
         CLC   PARM5(5),=C'3270'                                        16050000
         BE    A120                                                     16100000
         OC    PARM3,PARM3         WAS LINE ID INPUT?                   16150000
         BNZ   B140                YES. GO SEARCH CTRL BLK FOR IT.      16200000
****************************************************************        16250000
*  THIS CODE INSERTS LINE, CTRL AND TERMINAL ADDRESS OF THE    *        16300000
*  TERMINAL OF THE USER IF HE ENTERS ONLY DEMF 3270                     16350000
****************************************************************        16400000
         MVC   DUBLWD+5(3),TCTLERLN     MOVE LINE ADDRESS TO WORK       16450000
         TR    DUBLWD,EBTOHX                 TR LINE ADDRESS            16500000
         PACK  DUBLWD(3),DUBLWD+5(4)        PACK IT                     16550000
         MVC   HEXLINE,DUBLWD        MOVE IT TO BE USED LATER           16600000
         MVC   HEXCTRL,TCTTETA                 MOVE IN CTRL UNIT        16650000
         MVC   HEXTERM,TCTTETA+1         MOVE IN TERMINAL ADDRESS       16700000
         MVC   PARM3(3),TCTLERLN             MOVE IN LINE NUMBER        16750000
         MVI   TCTLERLN,X'FF'      IND TO BNGTQEMF TCAMID SHOULD BE INS 16800000
         CLI   TCTTETT,X'99'            IS THIS A LOCAL 3270            16850000
         BE    D079                     YES,BR NOT CTRL AOR TERM ADR    16900000
         UNPK  DUBLWD,TCTTETA(2)                                        16950000
         TR    DUBLWD,HXTOEB                                            17000000
         MVC   PARM4(2),DUBLWD+5    MOVE IN CTRL ADDRESS                17050000
         UNPK  DUBLWD,TCTTETA+1(2)                                      17100000
         TR    DUBLWD,HXTOEB                                            17150000
         MVC   PARM5(2),DUBLWD+5       MOVE IN TERMINAL ADDRESS         17200000
         B     D079                                                     17250000
******************                                                      17300000
* THIS SECTION OF CODE SHOULD NOT BE ENTERED AS  SYMBOLIC               17350000
*    ADDRESS FOR TCAM DEMF ARE NOT SUPPORTED                            17400000
****************                                                        17450000
A120     XC    PARM5,PARM5                                              17500000
         B     A010                                                     17550000
A130     XC    PARM4(16),PARM4                                          17600000
         B     A010                                                     17650000
A140     XC    PARM3(24),PARM3     ZERO OUT PARMS 3, 4, AND 5.          17700000
         B     A010                                                     17750000
*                                                                       17800000
* AT THIS POINT, IF NO INPUT LINE/CTRL/TERM WAS SPECIFIED, THE          17850000
* ADDRESS PERTAINING TO THE REQUESTOR'S TERMINAL HAS BEEN PLACED        17900000
* IN THE INPUT PARMS AS IF THEY HAD BEEN KEYED IN.                      17950000
*                                                                       18000000
B140     MVC   DUBLWD+5(3),PARM3                                        18050000
         TR    DUBLWD,EBTOHX            GET LINE,                       18100000
         PACK  DUBLWD(3),DUBLWD+5(4)    CONTROL UNIT,                   18150000
         MVC   HEXLINE,DUBLWD           AND                             18200000
         MVC   DUBLWD+5(3),PARM4        TERMINAL                        18250000
         TR    DUBLWD,EBTOHX            ADDRESS                         18300000
         PACK  DUBLWD(2),DUBLWD+5(3)    INTO HEX                        18350000
         MVC   HEXCTRL,DUBLWD           FORMAT                          18400000
         MVC   DUBLWD+5(3),PARM5        FOR COMPARING                   18450000
         TR    DUBLWD,EBTOHX            TO DATA IN                      18500000
         PACK  DUBLWD(2),DUBLWD+5(3)    DISK FILE.                      18550000
         MVC   HEXTERM,DUBLWD                                           18600000
D079     ST    TIOABAR,TWATIOA     SAVE ADDR OF ORIGINAL INPUT AREA.    18650000
         BAL   LINKREG,GETTIOA     SETUP NEW OUTPUT AREA WITH HDRS.     18700000
D080     MVC   FILREC,TWAREL                                            18750000
         READ  ECB1,DI,EMFIL1,(6),4096,0,FILREC                         18800000
         CHECK ECB1                                                     18850000
         B     D190    BRANCH AROUND I/O ERRRO RTNE                     18900000
F1900    MVC   TIOADBAO(IOERRLTH),IOERRMSG                              18950000
         MVC   TIOATDL,=AL2(IOERRLTH)                                   19000000
         UNPK  DUBLWD,TWAREL(4)         SETUP I/O ERROR MSG WITH        19050000
         TR    DUBLWD,HXTOEB            BLOCK NBR THAT                  19100000
         MVC TIOADBAO+(IOBLOCK-IOERRMSG)(6),DUBLWD+1  WAS BEING READ,   19150000
         LR    R8,R0               DECB ADR IN R8                       19200000
         USING DECB,R8                                                  19250000
         UNPK  DUBLWD,EXCPBITS(3)       AND THE BDAM FILE               19300000
         DROP  R8                                                       19350000
         TR    DUBLWD,HXTOEB            EXCEPTION RETURN CODE.          19400000
         MVC   TIOADBAO+(IOCODE-IOERRMSG)(4),DUBLWD+3                   19450000
D170     CLOSE EMFIL1                                                   19500000
         L     13,SAV3270R                                              19550000
         RETURN  (14,12)                                                19600000
D190     L     FIOABAR,TCAFCAA     POINT TO FILE I/O AREA.              19650000
         SR    DATALOOP,DATALOOP   SETUP TO LOOP ON NBR OF              19700000
         IC    DATALOOP,CTRLENTS   ENTRIES IN THIS CNTRL BLK.           19750000
         LTR   DATALOOP,DATALOOP   VERIFY THAT THE DATA SET             19800000
         BNZ   E030                IS NOT EMPTY.                        19850000
         B     Z50                                                      19900000
E030     LA    DATAREG,CTRLSLT1    POINT TO FIRST CTRL SLOT.            19950000
E040     OC    PARM4,PARM4         WAS A CTRL UNIT ADDR INPUT?          20000000
         BNZ   E110                YES. LINE ID IS CORRECT.             20050000
         XC    DUBLWD,DUBLWD       NO. THIS MUST BE RQST FOR LOCAL.     20100000
         MVC   DUBLWD(3),HXLINLIB  ROUND CUA ADDR DOWN                  20150000
         NI    DUBLWD+2,B'11100000'     TO EVEN CHAN ADDR.              20200000
         CLC   DUBLWD(6),CTRLPORT       LOOK FOR EQUAL LINE ADDRESS.    20250000
         B     E120                                                     20300000
E110     CLC   HXLINLIB,CTRLPORT   IS THIS SLOT = RQSTD LINE ADDR?      20350000
E120     BE    E200                YES. GO READ ITS DATA BLOCK.         20400000
         LA    DATAREG,SLOTLTH(DATAREG)  NO. BUMP TO NEXT CTRL SLOT.    20450000
         BCT   DATALOOP,E040            MORE SLOTS TO LOOK AT?          20500000
         OC    CTRLBACK,CTRLBACK        NO. IS THERE ANOTHER CTRL BLK?  20550000
         BZ    Z50                 NO. SEND 'NO ERRS' MSG.              20600000
         MVC   TWAREL,CTRLBACK+1        YES. SAVE NEXT BLOCK ADDR.      20650000
         B     D080                                                     20700000
E200     MVC   TWAREL,CTRLFRST     MOVE DATA BLOCK ADDR.                20750000
         OC    TWAREL,TWAREL       IS THERE ANY DATA BLOCKS ?  @OZ31884 20760007
         BZ    T190                NO, WRITE 'NO DATA BLKS MSG'@OZ31884 20770007
F020     MVC   FILREC,TWAREL        ALIGN AND MKE RELOCATABLE           20800000
         READ  ECB2,DI,EMFIL1,(6),4096,0,FILREC                         20850000
         CHECK ECB2                                                     20900000
F050     L     FIOABAR,TCAFCAA     POINT TO DATA BLOCK.                 20950000
         XC    TWASLOT,TWASLOT     INITIALIZE SLOT COUNT TO 1.          21000000
         LH    DATALOOP,BLKLTH     SETUP TO LOOP ON NBR BYTES IN REC.   21050000
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM.            21100000
F080     DS    0H                                                       21150000
         L     R15,TWASLOT         ADD 1 TO SLOT COUNT.                 21200000
         LA    R15,1(R15)      ADD ONE TO REG                           21250000
         ST    R15,TWASLOT                                              21300000
         CLI   ENTRYTYP,X'91'      IS THIS ENTRY AN MDR RECORD?         21350000
         BNE   H060                NO. TEST FURTHER.                    21400000
         CLI   MDRTYPE,X'03'       YES. IS IT A 3270?                   21450000
         BE    G060                YES. TEST FURTHER.                   21500000
F120     SR    R1,R1               NO. BUMP                             21550000
         IC    R1,0(DATAREG)     TO NEXT DATA ITEM.                     21600000
         LTR   R1,R1               PRECENT ENDLESS LOOP                 21650000
         BZ    F240                IN CASE GARBAGE IN RECORD.           21700000
         AR    DATAREG,R1                                               21750000
         SR    DATALOOP,R1         ALL DONE WITH THIS BLOCK?            21800000
         LTR   DATALOOP,DATALOOP                                        21850000
         BP    F080                NO. PROCESS NEXT ITEM.               21900000
         OC    DATAFWD,DATAFWD     YES. IS THERE ANOTHER BLOCK?         21950000
         BZ    F240                NO. GO WIND UP OUTPUT.               22000000
         MVC   TWAREL,DATAFWD      YES. GET CHAIN ADDR AND              22050000
         B     F020                GO READ NEXT BLOCK.                  22100000
F240     CLI   OUTSWCH,X'FF'       WAS ANY OUTPUT CREATED?              22150000
         BNE   Z50                 NO. SEND 'NO ERRS' MSG.              22200000
G020     LA    1,TIOADBAO           YES. COMPUTE                        22250000
         SR    OUTREG,1            TOTAL DATA LTH.                      22300000
         STH   OUTREG,TIOATDL                                           22350000
         B     D170                GO TRANSMIT DISPLAY.                 22750000
G060     CLC   MDRCTRL,HEXCTRL     IS THIS MDR FOR RQSTED CTRL UNIT?    22800000
         BNE   F120                NO. SKIP IT.                         22850000
         CLC   MDRTERM,HEXTERM     YES. IS IT FOR REQUESTED TERML?      22900000
         BNE   F120                NO. SKIP IT.                         22950000
         MVC   0(MDRLTH,OUTREG),MDRHDR   YES. SETUP BUILD 1 MDR LINE.   23000000
         UNPK  DUBLWD,MDRSTATS(3)                                       23050000
         TR    DUBLWD,HXTOEB       FILL IN REMOTE STATUS BYTES.         23100000
         MVC   (MDRSTAT-MDRHDR)(4,OUTREG),DUBLWD+3                      23150000
G100     UNPK  DUBLWD,TWAREL(4)                                         23200000
         TR    DUBLWD,HXTOEB       FILL IN THIS BLK NBR.                23250000
         MVC   (MDRBBBSS-MDRHDR)(3,OUTREG),DUBLWD+4                     23300000
         UNPK  DUBLWD,TWASLOT(5)                                        23350000
         TR    DUBLWD,HXTOEB       FILL IN THIS SLOT NBR.               23400000
         MVC   (MDRBBBSS+3-MDRHDR)(2,OUTREG),DUBLWD+5                   23450000
         L     R14,TWAOUT          POINT TO OUTPUT BBBSS FIELDS         23500000
         CLC   (BBBSS-HDR3)(5,R14),=C'BBBSS' IS 'FIRST' FILLED IN?      23550000
         BNE   G200                YES,SKIP IT                          23600000
         MVC   (BBBSS-HDR3)(5,R14),(MDRBBBSS-MDRHDR)(OUTREG) NO,DO IT.  23650000
         CLC   (BBBSS+10-HDR3)(5,R14),=C'BBBSS'  HOW ABOUT 'PREV'?      23700000
         BNE   G200                ALREADY THERE SKIP IT.               23750000
         MVC   (BBBSS+10-HDR3)(5,R14),(BBBSS-HDR3)(R14)  NO USE 'FIRST' 23800000
G200     MVC   (BBBSS+5-HDR3)(5,R14),(MDRBBBSS-MDRHDR)(OUTREG) FILL  XH 23850000
*                                                  IN 'LAST' BBBSS      23900000
         UNPK  DUBLWD,TIME                                              23950000
         MVC   (MDRHRS-MDRHDR)(2,OUTREG),DUBLWD+1   FILL IN HOURS       24000000
         MVC   (MDRMINS-MDRHDR)(2,OUTREG),DUBLWD+3     AND MINUTES.     24050000
G230     MVI   OUTSWCH,X'FF'       INDICATE SOME OUTPUT WAS CREATED.    24100000
         TIME    DEC          GET SYSTEM TIME                           24150000
         STCM  0,15,DATTIME        STORE TIME                           24200000
         STCM  1,15,DATDATE        STORE DATE                           24250000
         CP    DATE,DATDATE        DID ERROR HAPPEN TODAY?              24300000
         BE    G240                YES,BR HIGH INTENSITY                24350000
         SP    DATDATE,=P'1'       MAKE DATE YESTERDAY                  24400000
         CP    DATE,DATDATE        DID IT HAPPEN YESTERDAY              24450000
         BNE   G230A               NO,BR LEAVE INTENSITY NORMAL         24500000
         CLC   TIME,DATTIME        IS IT OLDER THAN 24 HRS?             24550000
         BNL   G240                NO,BR MAKE IT HIGH INTENSITY         24600000
G230A    LA    R1,LEAPTBL                                               24650000
G231     CLC   DATE+1(1),0(1)      SEE IF                               24700000
         BE    G232                ERROR HAPPENED                       24750000
         LA    R1,1(R1)            IN LEAP YEAR                         24800000
         CLI   0(R1),X'FF'         IS IT END OF TABLE                   24850000
         BNE   G231                NO,BR TRY NEXT YEAR                  24900000
         ZAP   CALENDAR+8(2),=P'28' NOT LEAP YEAR                       24950000
         B     G233                CONTINUE                             25000000
G232     ZAP   CALENDAR+8(2),=P'29' YES,LEAP YEAR                       25050000
G233     LA    R15,CALENDAR                                             25100000
G234     MVN   DATE+3(1),=X'0C'    MAKE SURE SIGN IS CORRECT            25150000
         CLC   DATE+2(2),3(R15)    COMPUTE MONTH                        25200000
         BNH   G235                AND DAY FROM                         25250000
         SP    DATE+2(2),3(2,R15)  DAY NUMBER                           25300000
         LA    R15,5(R15)                                               25350000
         B     G234                                                     25400000
G235     MVC   (MDRHRS-MDRHDR)(3,OUTREG),0(R15)  MOVE MONTH AND         25450000
         UNPK  (MDRMINS-MDRHDR)(2,OUTREG),DATE+2(2)   DAY TO OUTPUT     25500000
         OI    (MDRMINS+1-MDRHDR)(OUTREG),X'F0'                         25550000
         B     H030                                                     25600000
G240     MVI   1(OUTREG),PDA       YES.                                 25650000
         MVI   4(OUTREG),UHA                                            25700000
         MVI   15(OUTREG),PDA                                           25750000
H030     LA    OUTREG,MDRLTH(OUTREG)    BUMP TO NEXT OUTPUT SLOT.       25800000
         BCT   OUTLOOP,F120        MORE TIOA ROOM LEFT?                 25850000
         B     G020                NO. GO WIND UP OUTPUT.               25900000
H060     CLI   ENTRYTYP,X'91'      IS THIS ENTRY AN OBR?                25950000
         BE    F120                NO. SKIP IT.                         26000000
         CLC   OBRCUA,HEXLINE      YES. IS IT REQUESTED CUA ADDR?       26050000
         BNE   F120                NO. SKIP IT.                         26100000
         CLI   OBRUCB,X'10'        IS THIS A LOCAL                      26150000
         BE    H070                YES,BR                               26200000
         CLC   OBRPOLL(1),HEXCTRL  IS THIS OBR FOR RQSTED CTRL UNIT?    26250000
         BNE   F120                NO,SKIP IT                           26300000
         CLC   OBRPOLL+1(1),HEXTERM IS THIS OBR FOR RQSTED TERMINAL?    26350000
         BNE   F120                NO,SKIP IT                           26400000
H070     MVC   0(MDRLTH,OUTREG),MDRHDR  YES. SETUP COMMON MDR/OBR HDR.  26450000
         UNPK  DUBLWD,OBRCSW+4(3)                                       26500000
         TR    DUBLWD,HXTOEB       FILL IN CSW STATUS                   26550000
         MVC   (OBRSNS-MDRHDR)(4,OUTREG),DUBLWD+3                       26600000
         UNPK  DUBLWD,OBRSENSE(3)                                    XH 27050000
         TR    DUBLWD,HXTOEB       FILL IN SENSE BYTES.                 27100000
         MVC   (MDRSTAT-MDRHDR)(4,OUTREG),DUBLWD+3                   XH 27150000
         NI    OBRCCW+5,X'3F'      CLEAN UP TP OP CODE.                 27200000
         UNPK  DUBLWD,OBRCCW+5(2)                                       27250000
         TR    DUBLWD,HXTOEB       FILL IN TP OP CODE.                  27300000
         MVC   (OBRTPOP+1-MDRHDR)(2,OUTREG),DUBLWD+5                    27350000
         MVI   (OBRTPOP-1-MDRHDR)(OUTREG),C'B'                          27400000
         CLI   ENTRYTYP,TCAMOBR    IS THIS A TCAM OBR?                  27450000
         BNE   J005                NO, LEAVE 'B' FOR BTAM               27500000
         MVI   (OBRTPOP-1-MDRHDR)(OUTREG),C'T'    T=TCAM                27550000
J005     UNPK  DUBLWD,OBRCCW(2)                                         27600000
         TR    DUBLWD,HXTOEB       FILL IN CHANL COMMAND.               27650000
         MVC   (OBRCMD-MDRHDR)(2,OUTREG),DUBLWD+5                       27700000
         B     G100                GO FILL IN DATA COMMON TO MDR/OBR.   27750000
J010     CLC   TIOADBA+8(2),=AL2(L1P7)  IS SECOND FIELD LINE 1 POSN 7?  27800000
         BE    A010                YES. THIS IS NEW INPUT.              27850000
         CLC   TIOADBA+8(2),=AL2(L6P26) IS SECOND FIELD L2P26 FROM MENU 27900000
         BE    A010                YES,BR THIS IS NEW INPUT             27950000
         LA    R14,TIOADBA         SCAN THE INPUT TO SEE                28000000
J020     CLI   0(R14),C'%'         IF THE SPECIAL CHAR                  28050000
         BE    J140                '%" IS PRESENT WHICH                 28100000
         CLI   0(R14),X'00'        WAS PUT OUT BY THE BLOWUP            28150000
         BE    J050                ROUTINE TO INDICATE A                28200000
         LA    R14,1(R14)          ROUTINE FROM BLOWUP.                 28250000
         B     J020                                                     28300000
J050     CLC   PARM3(5),=C'BBBSS'  IF NO FIELDS WERE SELECTED, GO TO    28350000
         BE    S190                    INVALID INPUT REQUEST.           28400000
         CLC   PARM4(4),=C'PAGE'   IS THIS A 'PAGE' REQUEST?            28450000
         BNE   L160                NO. MUST BE 'BLOWUP' REQUEST.        28500000
         CLC   TIOFIRST,=C'BBBSS'  WAS A GOOD DISPLAY ON SCREEN?        28550000
         BE    S190                    NO. TRIED TO PAGE FROM NO-ERRS   28600000
         CP    TWASBAS,=P'4'       YES. IS IT RETURN FROM BLOWUP?       28650000
         CLC   19(2,R14),=X'C1D3'       PAGE REQUEST           @OZ30478 28700007
         BE    ALTBBB                   YES, POINT TO NEXT FLD @OZ30478 28702007
         CLC   19(2,R14),=X'C17B'       PAGE BKWRD LARGE SCREEN@OZ30478 28704007
         BE    ALTBBB                   YES, POINT TO NEXT FLD @OZ30478 28706007
         CLC   19(2,R14),=X'406B'       PAGE FRWRD SMALL SCREEN@OZ30478 28708007
         BE    ALTBBB                   YES, POINT TO NEXT FLD @OZ30478 28710007
         B     PTOK                     NO, POINTER IS OK      @OZ30478 28712007
ALTBBB   CLC   PARM5(7),=C'FORWARD'     IS IT PAGE FORWARD     @OZ30478 28714007
         BNE   J191                     NO, MUST BE BACKWARD   @OZ30478 28716007
         MVC   NEWFIRST,TIOLAST+4       OLD LAST TO NEW FIRST  @OZ30478 28718007
         MVC   NEWPREV,TIOFIRST+4       OLD FIRST TO NEW PREV  @OZ30478 28720007
         TR    TIOLAST+4,EBTOHX         TRANSLATE OLD LAST     @OZ30478 28722007
         PACK  DUBLWD,TIOLAST+4(6)      INTO HEX               @OZ30478 28724007
         B     J110                     CONTINUE               @OZ30478 28726007
J191     MVC   NEWFIRST,TIOPREV+4       OLD PREV TO NEW FIRST  @OZ30478 28728007
         MVC   NEWPREV,TIOPREV+4        OLD PREV TO NEW PREV   @OZ30478 28730007
         TR    TIOPREV+4,EBTOHX         TRANSLATE OLD PREV     @OZ30478 28732007
         PACK  DUBLWD,TIOPREV+4(6)      INTO HEX               @OZ30478 28734007
         B     J110                     CONTINUE               @OZ30478 28736007
PTOK     EQU   *                                               @OZ30478 28738007
         CLC   PARM5(7),=C'FORWARD'  NO. IS IT PAGE FORWARD?            28750000
         BNE   J190                NO. MUST BE PAGE BACKWARD.           28800000
         MVC   NEWFIRST,TIOLAST    YES. PROMOTE LAST & FIRST FROM OLD   28850000
         MVC   NEWPREV,TIOFIRST    SCREEN TO NEW FIRST & PREVIOUS.      28900000
         TR    TIOLAST,EBTOHX                                           28950000
         PACK  DUBLWD,TIOLAST(6)   GET OLD 'LAST' BLK & SLOT IN HEX.    29000000
J110     MVC   TWAREL,DUBLWD+3     SETUP TO READ APPROPRIATE BLK.       29050000
         MVC   TWASLOT(1),DUBLWD+6  SETUP TO LOCATE APPROPRIATE SLOT.   29100000
         B     K010       GO READ BLK WHERE DISPLAY WILL RESUME.        29150000
J140     SH    R14,=H'18'          BACKUP TO BBBSS FIELD                29200000
         MVC   BITFIRST(15),0(R14) ALIGN IT IN CASE NO PAGE ENTERED  XH 29250000
         MVC   NEWFIRST,BITFIRST   RESTORE OLD 'FIRST' & 'PREVIOUS'  XH 29300000
         MVC   NEWPREV,BITPREV     AS NEW 'FIRST' & 'PREVIOUS'       XH 29350000
         TR    BITFIRST,EBTOHX                                       XH 29400000
         PACK  DUBLWD,BITFIRST(6)  GET OLD 'FIRST' ADDR & SLOT IN HEXXH 29450000
         B     J110                                                     29500000
J190     MVC   NEWFIRST,TIOPREV    OLD 'PREVIOUS' NOW BECOMES NEW       29550000
         MVC   NEWPREV,TIOPREV     'PREVIOUS' AND 'FIRST'               29600000
         TR    TIOPREV,EBTOHX                                           29650000
         PACK  DUBLWD,TIOPREV(6)   GET OLD 'PREVIOUS' IN HEX.           29700000
         B     J110                                                     29750000
K010     BAL   LINKREG,LOCATE      LOCATE SLOT TO RESUME AT.            29800000
         XC    PARM4(16),PARM4     ZERO OUT INPUT PARMS.                29850000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR?                      29900000
         BE    K020                YES,LINE ADDRESS IS OK               29950000
         XC    HXLINLIB,HXLINLIB   NO,DON'T USE ROUNDED DOWN ADDR       30000000
         MVC   HXLINLIB+1(2),OBRCUA   GET ACTUAL CUA INSTEAD            30050000
         B     K030                                                     30100000
K020     MVC   HXLINLIB,LINEID                                          30150000
K030     UNPK  DUBLWD,HEXLINE(3)   RESTORE LINE NBR FROM DATA           30200000
         TR    DUBLWD,HXTOEB       BLOCK AS IF IT HAD BEEN KEYED IN.    30250000
         MVC   PARM3(3),DUBLWD+4                                        30300000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR RECORD?               30350000
         BE    K040                YES,PUT IN POLL CHARRS.              30400000
         CLI   OBRUCB,X'10'        IS THIS A LOCAL                      30450000
         BE    L110                YES,BR NO POLL CHARS                 30500000
         MVC   HEXCTRL,OBRPOLL     MOVE CNTRL UNIT ADDR                 30550000
         MVC   HEXTERM,OBRPOLL+1   MOVE TERMINAL ADDR                   30600000
         B     K050                                                     30650000
K040     MVC   HEXCTRL,MDRCTRL     YES.                                 30700000
         MVC   HEXTERM,MDRTERM     RESTORE CTRL UNIT ADDR               30750000
K050     UNPK  DUBLWD,HEXCTRL(3)   AND TERMINAL ADDR                    30800000
         TR    DUBLWD,HXTOEB       AS IF THEY HAD                       30850000
         MVC   PARM4(2),DUBLWD+3   BEEN KEYED IN.                       30900000
         MVC   PARM5(2),DUBLWD+5                                        30950000
L110     BAL   LINKREG,GETTIOA     SETUP OUTPUT AREA WITH HEADERS.      31000000
         L     R15,TWAOUT                                               31050000
         MVC   (BBBSS-HDR3)(5,R15),NEWFIRST FINISH HEADER WITH ADDR     31100000
         MVC   (BBBSS+10-HDR3)(5,R15),NEWPREV  OF FIRST & PREVIOUS BLK. 31150000
         B     F080                GO BUILD ANOTHER PAGE.               31200000
L160     CLC   PARM2(4),=C'TERM'     IS THIS COMPANION INPUT?           31250000
         BE    L200                YES. GO HUNT FOR CTRL & LINE ADDR.   31300000
**       FOLLOWING TEN  INSTRUCTIONS CHECK IF A FIELD WAS X'ED   33333  31350000
**       ON A BLOWUP REQUEST                                     33333  31400000
         MVC   WORK15,TIOITEM      MOVE XED FIELD TO WORK AREA   33333  31450000
         TR    WORK15,EBTOHX       TRANS TO HEX                  33333  31500000
         MVC   WORK16,FLP          MOVE FIRST BBBSS TO WORK AREA 33333  31550000
         TR    WORK16,EBTOHX       TRANSLATE TO HEX              33333  31600000
         MVC   WORK16,FLP+5        MOVE LAST BBBSS TO WORK ARE   33333  31750000
         TR    WORK16,EBTOHX       TRANSLATE TO HEX              33333  31800000
         TR    TIOITEM,EBTOHX      OK. GET REQUESTED ITEM ADDR.         31950000
         PACK  DUBLWD,TIOITEM(6)        AND SLOT NUMBER.                32000000
         MVC   TWAREL,DUBLWD+3          INTO HEX.                       32050000
         MVC   TWASLOT(1),DUBLWD+6                                      32100000
         BAL   LINKREG,LOCATE      LOCATE APPROPRIATE SLOT IN DATA BLK. 32150000
** INITIALIZE I/O AREA                                                  32200000
** TO ALL 40'S SO THAT BLOW UP WILL FORMAT PROPERLY                     32250000
         ST    DATALOOP,R8SAVE     SAVE REGISTER EIGHT                  32300000
         LA    0,TIOADBAO          FIELD ADDRESS TO BE CLEARED          32350000
         LA    1,2000              LENGTH OF FIELD TO BE CLEARED        32400000
         L     REG9,=X'40000001'  LENGTH AND PADDING CHARACTER          32450000
         LA    DATALOOP,FORTY      PLACE 40'S IN INITIALIZED AREA       32500000
         MVCL  0,DATALOOP          MOVE CHARACTER TO FIELD              32550000
         L     DATALOOP,R8SAVE     RESTORE REGISTER EIGHT               32600000
**    END OF STORAGE INITAILIZATION CODE                                32650000
         LA    TIOABAR,TIOADBAO    RELOAD OUTPUT AREA                   32700000
         ST    TIOABAR,TCTTEDA     FOR THE BLOWUP DISPLAY.              32750000
         XC    P,P                 CLEAR AREA                           32800000
         CLI   ENTRYTYP,BTAMOBR    IS THIS A OBR?                       32850000
         BE    L161                YES,BR HANDLE OBR                    32900000
         CLI   ENTRYTYP,TCAMOBR    IS THIS A TCAM OBR                   32950000
         BE    L161                YES,BR WILL ONLY HAVE LINE ADR       33000000
         UNPK  P3(4),DATAPORT+1(3) MOVE LINE ADR FROM RECORD            33050000
         MVI   P3+3,X'00'                                               33100000
         TR    P3,HXTOEB           PUT IT IN DISPLAY FORMAT             33150000
         UNPK  P4(3),MDRCTRL(2)    NO,GET CTRL UNIT POLL CHAR           33200000
         MVI   P4+2,X'00'                                               33250000
         TR    P4,HXTOEB           PUT IT IN DISPLAY FORMAT             33300000
         UNPK  P5(3),MDRTERM(2)    GET TERMINAL POLL CHAR               33350000
         MVI   P5+2,X'00'                                               33400000
         TR    P5,HXTOEB           PUT IT IN DISPLAY FORMAT             33450000
         B     L162                                                     33500000
L161     UNPK  P3(4),OBRCUA(3)     GET  LINE ADR FROM MDR RECORD        33550000
         MVI   P3+3,X'00'                                               33600000
         TR    P3,HXTOEB           PUT IT IN DISPLAY FORMAT             33650000
         CLI   OBRUCB,X'10'        IS THIS A LOCAL                      33700000
         BE    L162                YES,BR NO POLLING CHARS              33750000
         UNPK  P4(3),OBRPOLL(2)    GET CNTRL UNIT POLL CHARS            33800000
         MVI   P4+2,X'00'                                               33850000
         TR    P4,HXTOEB           PUT IT IN DISPLAY FORMAT             33900000
         UNPK  P5(3),OBRPOLL+1(2)  GET TERMINAL POLL CHARS              33950000
         MVI   P5+2,X'00'                                               34000000
         TR    P5,HXTOEB                                                34050000
L162     EQU   *                                                        34100000
         MVC   TIOADBAO(HDR1LTH),HDR1         SET UP                    34150000
         MVC   TIOADBAO+HDR1LTH(4),=C'3270'   FIRST LINE HEADER         34200000
         LA    OUTREG,TIOADBAO+HDR1LTH+4      BUMP OUTPUT ADDRESS       34250000
         CLI   TCTTETM,C'2'        IS THIS A MODEL TWO SCREEN           34300000
         BNE   L163                                                     34350000
         MVC   0(3,OUTREG),HDR2    YES,ADD ANOTHER SBA                  34400000
         LA    OUTREG,3(OUTREG)    THIS 80 CHAR SCREEN                  34450000
L163     MVC   0(HDR3LTH,OUTREG),HDR3     MOVE PAGE REQUEST LINE        34500000
         MVC   (BBBSS-HDR3)(15,OUTREG),TIOADBA+17 MOVE BBBSS            34550000
         LA    OUTREG,HDR3LTH(OUTREG)     BUMP OUTREG ADDRESS           34600000
         MVC   0(HDR4LTH,OUTREG),HDR4     MOVE THE RECAP LINE HDR       34650000
         OC    P5,P5               IS THERE A TERMINAL ADDRESS          34700000
         BZ    L165                NO,BR TO SHOW ONLY LINE ADR          34750000
         MVC   (HDR4TERM-HDR4)(2,OUTREG),P5    FILL IN THE              34800000
         MVC   (HDR4CTRL-HDR4)(2,OUTREG),P4    ID OF THIS TERMINAL      34850000
         MVC   (HDR4LINE-HDR4)(3,OUTREG),P3    CTRL UNIT AND LINE       34900000
L164     CLI   TCTTETM,C'2'        IS THIS SCREEN A MODEL 2?            34950000
         BE    M060                YES. MOVE APPROPRIATE HEADER.        35000000
         MVC   TIOADBAO+152(BUHDR1LT),BUHDR1   NO. MOVE MODEL 1 BLOWUP  35050000
         LA    OUTREG,TIOADBAO+BUHDR1LT+152  POINT TO NEXT BYTE OF OUTA 35100000
         B     M080                                                     35150000
L165     MVC   8(6,OUTREG),=C'LOCAL '   SO CHANGE HEADER TO             35200000
         MVC   14(3,OUTREG),P3          LOCAL FORMAT                    35250000
         MVC   17(24,OUTREG),=24C' '    BLANK OUT REST OF LINE          35300000
         B     L164                                                     35350000
L200     TR    PARM3,EBTOHX        PARM3 IS BBBSS OF CTRL UNIT DISPLAY. 35400000
         PACK  DUBLWD,PARM3(6)     GET ITS BLK & SLT IN HEX.            35450000
         MVC   TWAREL,DUBLWD+3                                          35500000
         MVC   TWASLOT(1),DUBLWD+6                                      35550000
         BAL   LINKREG,LOCATE      LOCATE BLK & SLOT OF PREVIOUS DISPLY 35600000
         XC    PARM3,PARM3         ERASE BBBSS GARBAGE.                 35650000
         UNPK  PARM3(4),DATAPORT+1(3)   MOVE LINE ADDR FROM RECORD.     35700000
         MVI   PARM3+3,X'00'                                            35750000
         TR    PARM3,HXTOEB        MAKE IT LOOK LIKE IT WAS KEYED IN.   35800000
         XC    PARM4,PARM4                                              35850000
         CLI   ENTRYTYP,X'91'      IS THIS AN OBR?                      35900000
         BNE   L270                YES,BR HANDLE OBR RECORD    .        35950000
         UNPK  PARM4(3),MDRCTRL(2) NO. GET CTRL UNIT POLL CHAR.         36000000
         MVI   PARM4+2,X'00'                                            36050000
         TR    PARM4,HXTOEB        MAKE IT LOOK LIKE IT WAS KEYED IN.   36100000
         B     A010                                                     36150000
L270     CLI   OBRUCB,X'10'        IS THIS A LOCAL                      36200000
         BE    L280                YES,BR NO POLL CHARS                 36250000
         UNPK  PARM4(3),OBRPOLL(2) GET CNTRL UNIT POLL CHARS            36300000
         MVI   PARM4+2,X'00'                                            36350000
         TR    PARM4,HXTOEB        MAKE IT LOOK LIKE IT WAS KEYED IN    36400000
         B     A010                                                     36450000
L280     MVC   PARM3,PARM5         UNROUND TERML ADDRESS                36500000
         XC    PARM5,PARM5         ERASE GARBAGE IF LOCAL CU.           36550000
L300     B     A010                                                     36600000
M060     MVC   TIOADBAO+152(BUHDR2LT),BUHDR2  MOVE MODEL 2 BLOWUP HDR   36650000
         LA    OUTREG,TIOADBAO+BUHDR2LT+152 POINT TO NEXT BYTE OF OUTAR 36700000
M080     UNPK  DUBLWD,TIME         MOVE TIME OF                         36750000
         MVC   0(2,OUTREG),DUBLWD+1     ERROR TO OUTPUT.                36800000
         MVI   2(OUTREG),C':'                                           36850000
         MVC   3(2,OUTREG),DUBLWD+3                                     36900000
         LA    1,LEAPTBL                                                36950000
M090     CLC   DATE+1(1),0(1)           FIGURE OUT IF                   37000000
         BE    M100                     ERROR HAPPENED                  37050000
         LA    1,1(1)                 DURING LEAP YEAR.                 37100000
         CLI   0(1),X'FF'                                               37150000
         BNE   M090                                                     37200000
         ZAP   CALENDAR+8(2),=P'28'                                     37250000
         B     M110                                                     37300000
M100     ZAP   CALENDAR+8(2),=P'29'                                     37350000
M110     LA    R15,CALENDAR                                             37400000
M120     MVN   DATE+3(1),=X'0C'    PROTECT AGAINST GARBAGE IN PACKED    37450000
         CLC   DATE+2(2),3(R15)    FIELD.  COMPUTE MONTH AND            37500000
         BNH   M130                     DAY FROM DAY NUMBER.            37550000
         SP    DATE+2(2),3(2,R15)                                       37600000
         LA    R15,5(R15)                                               37650000
         B     M120                                                     37700000
M130     MVC   6(3,OUTREG),0(R15)       MOVE MONTH TO OUTPUT.           37750000
         UNPK  9(2,OUTREG),DATE+2(2)    MOVE DAY TO OUTPUT.             37800000
         OI    10(OUTREG),X'F0'                                         37850000
         MVC   LINESZ,=H'40'                                            37900000
         MVC   LINELOOP,=H'4'                                           37950000
         CLI   TCTTETM,C'2'        SETUP CORRECT LINE SIZE & NBR        38000000
         BNE   M140                     ITEMS FOR SCREEN MODEL.         38050000
         MVC   LINESZ,=H'80'                                            38100000
         MVC   LINELOOP,=H'12'                                          38150000
M140     EQU   *                                                        38200000
         CLI   ENTRYTYP,X'91'      IS THIS ENTRY AN OBR?                38250000
         BNE   M160                YES.                                 38300000
         BAL   LINKREG,BUMDR       NO. BLOW UP AN MDR ENTRY.            38350000
M150     LA    R1,TIOADBAO                                              38400000
         SR    OUTREG,R1                                                38450000
         STH   OUTREG,TIOATDL      FINISH UP THE OUTPUT.                38500000
         CLOSE EMFIL1                                                   38550000
         L     13,SAV3270R                                              38600000
         RETURN  (14,12)                                                38650000
M160     BAL   LINKREG,BUOBR       BLOWUP AN OBR ENTRY.                 38700000
         B     M150                                                     38750000
BUOBR    MVC   13(5,OUTREG),=C'TP-OP'   MOVE THE                        38800000
         UNPK  DUBLWD,OBRCCW+5(2)       TP OP CODE                      38850000
         TR    DUBLWD,HXTOEB            TO OUTPUT AREA.                 38900000
         MVC   19(2,OUTREG),DUBLWD+5                                    38950000
         LA    R15,TPOPTBL                                              39000000
         CLI   ENTRYTYP,TCAMOBR    IS THIS A TCAM OBR?                  39050000
         BNE   O060                NO,REG15 POINTS AT BTAM              39100000
         L     R15,=A(TCAMTPOP)    YES,POINT REG15 TO TCAM TPOP TABLE   39150000
O060     CLC   0(2,R15),DUBLWD+5                                        39200000
         BE    O120                                                     39250000
         CLC   0(2,R15),=X'FFFF'                                        39300000
         BE    O120                                                     39350000
         LA    R15,20(R15)                                              39400000
         B     O060                                                     39450000
O120     MVC   22(18,OUTREG),2(R15) MOVE EXPLANATION OF TP OP CODE.     39500000
         AH    OUTREG,LINESZ       BUMP TO NEXT LINE OF OUTPUT.         39550000
O170     MVC   0(11,OUTREG),=C'DATA LENGTH'                             39600000
         UNPK  DUBLWD,OBRCCW+6(3)                                       39650000
         TR    DUBLWD,HXTOEB       MOVE DATA LENGTH.                    39700000
         MVC   12(4,OUTREG),DUBLWD+3                                    39750000
         MVC   21(14,OUTREG),=C'RESIDUAL COUNT'                         39800000
         UNPK  DUBLWD,OBRCSW+6(3)                                       39850000
         TR    DUBLWD,HXTOEB                                            39900000
         MVC   36(4,OUTREG),DUBLWD+3                                    39950000
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE.            40000000
         MVC   0(15,OUTREG),=C'CHANNEL COMMAND'                         40050000
         UNPK  DUBLWD,OBRCCW(2)                                         40100000
         TR    DUBLWD,HXTOEB       MOVE THE CHANNEL COMMAND.            40150000
         MVC   16(2,OUTREG),DUBLWD+5                                    40200000
         LA    R15,CCWTABL                                              40250000
         CLI   OBRUCB,X'40'        IS THIS A REMOTE?                    40300000
         BE    P070                YES,USE 270X COMMANDS                40350000
         L     R15,=A(CCW3272)     NO,USE THE 3272 COMMANDS             40400000
P070     CLC   0(2,R15),DUBLWD+5                                        40450000
         BE    P130                                                     40500000
         CLC   0(2,R15),=X'FFFF'                                        40550000
         BE    P130                                                     40600000
         LA    R15,20(R15)                                              40650000
         B     P070                                                     40700000
P130     MVC   19(18,OUTREG),2(R15) MOVE CCW EXPLANATION.               40750000
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE.            40800000
         MVC   4(5,OUTREG),=C'SENSE'    MOVE SENSE & STATUS HEADERS.    40850000
         MVC   24(6,OUTREG),=C'STATUS'                                  40900000
         UNPK  DUBLWD,OBRSENSE(3)  MOVE SENSE                        XH 41400000
         TR    DUBLWD,HXTOEB       BYTES TO                             41450000
         MVC   10(4,OUTREG),DUBLWD+3    OUTPUT AREA                  XH 41500000
         UNPK  DUBLWD,OBRCSW+4(3)  MOVE OBR STATUS                      41550000
         TR    DUBLWD,HXTOEB       BYTES TO                             41600000
         MVC   31(4,OUTREG),DUBLWD+3    OUTPUT AREA                     41650000
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE             41700000
         LR    R14,OUTREG          TEMPORARY POINTER TO SENSE OUTPUT.   41750000
         LH    R1,LINELOOP         LIMIT DISPLAY IF MOD 1 SCREEN.       41800000
         LA    R15,SENSTABL                                             41850000
         CLI   OBRUCB,X'40'        IS THIS A REMOTE?                    41900000
         BE    P200                YES USE 270X SENSE                   41950000
         L     R15,=A(SENS3272)    NO,USE 3272 SENSE                    42000000
P200     MVC   DUBLWD(1),OBRSENSE  SETUP TO TEST SENSE BITS.         XH 42050000
         NC    DUBLWD(1),0(R15)                                         42100000
         CLC   DUBLWD(1),0(R15)                                         42150000
         BE    Q050                                                     42200000
Q010     LA    R15,19(R15)         BUMP TO NEXT SLOT IN SENSE TABL.     42250000
         CLI   0(R15),X'FF'                                             42300000
         BNE   P200                                                     42350000
         B     Q080                                                     42400000
Q050     MVC   0(18,R14),1(R15)    MOVE EXPLANATION OF 1 SENSE BIT.     42450000
         AH    R14,LINESZ          BUMP TO NEXT SENSE OUTPUT AREA.      42500000
         BCT   R1,Q010             ANY TIOA ROOM LEFT?                  42550000
Q080     ST    R14,SAVE14                                               42600000
         LR    R14,OUTREG          NO. SETUP TO LOOK AT STATUS BITS.    42650000
         LH    R1,LINELOOP                                              42700000
         LA    R15,CSWTABL                                              42750000
Q110     MVC   DUBLWD(2),OBRCSW+4                                       42800000
         NC    DUBLWD(2),0(R15)                                         42850000
         CLC   DUBLWD(2),0(R15)                                         42900000
         BE    Q180                                                     42950000
Q150     LA    R15,20(R15)                                              43000000
         CLI   0(R15),X'FF'                                             43050000
         BNE   Q110                                                     43100000
         B     Q210                                                     43150000
Q180     MVC   20(18,R14),2(R15)   MOVE EXPLANATION OF 1 CSW STATUS BIT 43200000
         AH    R14,LINESZ         BUMP TO NEXT OUTPUT SLOT              43250000
         BCT   R1,Q150             ANY TIOA ROOM LEFT?                  43300000
Q210     C     R14,SAVE14          NO.                                  43350000
         BH    R010                                                     43400000
         L     R14,SAVE14          SET OUTPUT REG TO HIGHER             43450000
R010     LR    OUTREG,R14          OUTPUT ADDRESS (SENSE OR STATUS).    43500000
         BR    LINKREG                                                  43550000
BUMDR    MVC   24(6,OUTREG),=C'SENSE '  MOVE SENSE HDR.                 43600000
         UNPK  DUBLWD,MDRSTATS(3)  MOVE MDR                             43650000
         TR    DUBLWD,HXTOEB       STATUS BYTES                         43700000
         MVC   31(4,OUTREG),DUBLWD+3    TO OUTPUT AREA                  43750000
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE.            43800000
         LR    R14,OUTREG                                               43850000
         LH    R1,LINELOOP                                              43900000
         AR    R1,R1               LIMIT MOD 1 TO 7 BITS MAX.           43950000
         BCTR  R1,R0                                                    44000000
         LA    R15,STATSTBL                                             44050000
R080     MVC   DUBLWD(2),MDRSTATS  SETUP TO LOOK AT REMOTE STATUS TBL.  44100000
         NC    DUBLWD(2),0(R15)                                         44150000
         CLC   DUBLWD(2),0(R15)                                         44200000
         BE    R170                                                     44250000
R120     LA    R15,20(R15)                                              44300000
         CLI   0(R15),X'FF'                                             44350000
         BNE   R080                                                     44400000
         B     R200                                                     44450000
R170     MVC   20(18,R14),2(R15)   MOVE EXPLANATION OF 1 REMOTE STATUS  44500000
         AH    R14,LINESZ          BUMP TO NEXT OUTPUT AREA             44550000
         BCT   R1,R120             ANY TIOA ROOM LEFT?                  44600000
R200     LR    OUTREG,R14          NO. SETUP TO COMPUTE DATA LTH.       44650000
         BR    LINKREG             RETURN TO MAIN LINE.                 44700000
LOCATE   MVC   FILREC,TWAREL                                            44750000
         READ  ECB3,DI,EMFIL1,(6),4096,0,FILREC                         44800000
         CHECK ECB3                                                     44850000
S030     L     FIOABAR,TCAFCAA     POINT TO DATA BLK.                   44900000
         LH    DATALOOP,BLKLTH     SETUP LOOP NBR BYTES THIS BLK.       44950000
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM             45000000
         SR    R1,R1               PREPARE SLOT NBR FOR                 45050000
         IC    R1,TWASLOT          PUTTING OUT IN DISPLAY               45100000
         BCTR  R1,R0                                                    45150000
         STC   R1,TWASLOT+3                                             45200000
S060     CLI   TWASLOT,2           IF RQSTED SLOT = 1, THIS IS IT.      45250000
         BL    S220                GO RESUME DISPLAY BUILDING.          45300000
         SR    R1,R1                                                    45350000
         IC    R1,TWASLOT          DECREMENT SLOT COUNT BY 1.           45400000
         BCTR  R1,R0                                                    45450000
         STC   R1,TWASLOT                                               45500000
         IC    1,0(DATAREG)      BUMP TO NEXT SLOT.                     45550000
         LTR   1,1                                                      45600000
         BZ    S190                PREVENT LOOP IF GARBAGE INPUT.       45650000
         AR    DATAREG,1                                                45700000
         SR    DATALOOP,1                                               45750000
         LTR   DATALOOP,DATALOOP   VERIFY SLOT NBR VALID FOR THIS BLK.  45800000
         BP    S060                                                     45850000
S190     DS    0H                                                       45900000
         MVC   TIOADBAO(INVLTH),INVMSG  IF RQSTED SLOT CAN'T            45950000
         MVC   TIOATDL,=AL2(INVLTH)     BE FOUND, SEND 'INVALID INPUT'  46000000
         B     D170                                                     46050000
S220     BR    LINKREG             RETURN TO MAIN LINE.                 46100000
GETTIOA  LA     TIOABAR,TIOADBAO     POINT  TO TCAM OUTPUT AREA         46150000
* NEXT 5 LINES INITIALIZES TIOA TO 40'S                                 46200000
         ST    DATALOOP,R8SAVE     SAVE REGIDTER EIGHT                  46250000
         LA    0,TIOADBAO          FIELD TO BE CLEARED                  46300000
         LA    1,2000              LENGTH OF FIELD TO BE CLEARED        46350000
         L     REG9,=X'40000001'   LENGTH AND PADDING CHARACTER         46400000
         LA    DATALOOP,FORTY      FILL  CHARACTER                      46450000
         MVCL  0,DATALOOP          MOVE FILL CHARACTER TO CLEAR FIELD   46500000
         L     DATALOOP,R8SAVE     RESTORE REGISTER EIGHT               46550000
* END OF INITIALIZE CODE                                                46600000
         ST    TIOABAR,TCTTEDA     ENOUGH FOR A MODEL-2 DISPLAY.        46650000
         MVC   TIOADBAO(HDR1LTH),HDR1                                   46700000
         MVC   TIOADBAO+HDR1LTH(4),=C'3270'    SET UP 1ST LINE OF HDR   46750000
         LA    OUTREG,TIOADBAO+HDR1LTH+4   BUMP OUTPUT AREA ADDRESS     46800000
         CLI   TCTTETM,C'2'        IS THIS SCREEN A MODEL 2?            46850000
         BNE   T120                NO. 1ST LINE IS OK.                  46900000
         MVC   0(3,OUTREG),HDR2    YES. ADD ANOTHER SBA TO FINISH       46950000
         LA    OUTREG,3(OUTREG)    THIS 80-CHAR LINE.                   47000000
T120     MVC   0(HDR3LTH,OUTREG),HDR3   MOVE THE 'PAGE' REQUEST LINES.  47050000
T130     ST    OUTREG,TWAOUT       SAVE THIS ADDR TO FILL IN BLK NBRS.  47100000
         LA    OUTREG,HDR3LTH(OUTREG)                                   47150000
         MVC   0(HDR4LTH,OUTREG),HDR4   MOVE THE RECAP LINE HDR.        47200000
         OC    PARM5,PARM5         IF NO TERM ADDR INPUT, SHOW ONLY LIN 47250000
         BZ    T150                                                     47300000
         MVC   (HDR4TERM-HDR4)(2,OUTREG),PARM5   FILL IN THE            47350000
         MVC   (HDR4CTRL-HDR4)(2,OUTREG),PARM4    ID OF THIS TERML      47400000
T150     DS    0H                                                       47450000
         MVC   (HDR4LINE-HDR4)(3,OUTREG),PARM3    CTRL UNIT, AND LINE.  47500000
         CLC   (HDR4TERM-HDR4)(2,OUTREG),=C'  '   IS THIS TERML BLANK?  47550000
         BNE   T160                     NO,LET IT GO                    47600000
         MVC   8(6,OUTREG),=C'LOCAL '   YES,CHANGE TO                   47650000
         MVC   14(3,OUTREG),PARM3       LOCAL FORMAT                    47700000
         MVC   17(24,OUTREG),=24C' '                                    47750000
T160     DS    0H                                                       47800000
         LA    OUTREG,HDR4LTH(OUTREG)                                   47850000
         CLI   TCTTETM,C'2'        IS THIS A BIG SCREEN?                47900000
         BNE   T170                NO. THIS LINE IS OK.                 47950000
         MVC   0(3,OUTREG),HDR5    YES. ADD ANOTHER SBA TO              48000000
         LA    OUTREG,3(OUTREG)  GET US PAST 40 MORE CHARS.             48050000
T170     MVC   0(HDR6LTH,OUTREG),HDR6   MOVE COLUMN HEADERS.            48100000
         LA    OUTREG,HDR6LTH(OUTREG)                                   48150000
         LA    OUTLOOP,7           SETUP TO SHOW 7 ITEMS ON MOD 1.      48200000
         CLI   TCTTETM,C'2'        IS THIS A BIG SCREEN?                48250000
         BNE   T180                NO. RETURN TO MAIN LINE.             48300000
         MVC   0(HDR6LTH,OUTREG),HDR6   YES. MOVE ANOTHER COLUMN HDR.   48350000
         LA    OUTREG,HDR6LTH(OUTREG)                                   48400000
         LA    OUTLOOP,40          SETUP TO SHOW 40 ITEMS ON MOD 2.     48450000
T180     BR    LINKREG             RETURN TO MAIN LINE.                 48500000
T190     MVC   TIOADBA(MSG13LTH),MSG13  MOVE IN THE MSG        @OZ31884 48507007
         MVC   TIOATDL,=AL2(MSG13LTH)   MOVE IN THE LENGTH     @OZ31884 48514007
         OC    PARM3(3),=CL3' '         INSURE NO X'00'        @OZ31884 48521007
         MVC   TIOADBA+(MSG13LN-MSG13)(3),PARM3 PUT IN LINE NO.@OZ31884 48528007
         LA    R8,MSG13LTH              SET UP MESSAGE LENGTH  @OZ31884 48535007
         B     Z50D                     GO WRITE MESSAGE       @OZ31884 48542007
Z50      CLI   PARM4,X'00'          IS FULL ADDRESS AVAILABLE ?         48550000
         BE    Z50A                 NO. JUST SHOW TERMINAL ADDR         48600000
         CLC   PARM4(2),=C'00'                                          48650000
         BE    Z50A                 NO. JUST SHOW TERMINAL ADDR         48700000
         MVC   TIOADBAO(MSG11LTH),MSG11  MOVE 'NO ERRS' MSG TO OUTPUT   48750000
         OC    PARM3(24),=CL24' '   CHANGE  X'00'  TO  X'40'            48800000
         LA    15,TIOADBAO          POINT TO OUTPUT AREA                48850000
         MVC   (MSG11TRM-MSG11)(2,15),PARM5  MOVE TERML TO OUTPUT       48900000
         MVC   (MSG11CU-MSG11)(2,15),PARM4   MOVE CTRL UNIT TO OUTPUT   48950000
         MVC   (MSG11LIN-MSG11)(3,15),PARM3  MOVE LINE      TO OUTPUT   49000000
         B     Z50C                                                     49250000
Z50A     OC    PARM3,=CL8' '          CHANGE  X'00'  TO  X'40'          49300000
         MVC   MSG12TRM,PARM3         MOVE TERML TO OUTPUT              49350000
Z50B     MVC   TIOADBAO(MSG12LTH),MSG12 MOVE MSG12 TO OUTPUT AREA       49700000
         LA    R8,MSG12LTH                                              49750000
         B     Z50D                                                     49800000
Z50C     LA    R8,MSG11LTH                                              49850000
Z50D     STH   R8,TIOATDL                                               49900000
         L     13,SAV3270R                                              49950000
         RETURN (14,12)                                                 50000000
*                                                                       50050000
EMFIL1 DCB DDNAME=EMFILE,DSORG=DA,MACRF=(RIC),OPTCD=R,                 X50100000
               RECFM=F,SYNAD=F1900                                      50150000
SAV3270R DS    A         CALLERS SAV AREA REGISTER ADDRESS              50200000
SAV3270A DS    18F   3270 PROGRAM SAVAREA                               50250000
P        DS    XL24'00'            PARM AREA FOR BLOWUP                 50300000
         ORG   P                                                        50350000
P3       DC    XL8'00'                                                  50400000
P4       DC    XL8'00'                                                  50450000
P5       DC    XL8'00'                                                  50500000
FORTY    DC    X'40404040'                                              50550000
HDR1     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF'                   50600000
         DC    AL1(SF,UNA,IC),AL1(SBA),AL2(L1P36),AL1(SF,MNP)           50650000
HDR1LTH  EQU   *-HDR1                                                   50700000
HDR2     DC    AL1(SBA),AL2(L2P1)                                       50750000
HDR3     DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'?'                        50800000
         DC    AL1(SF,PNA),C') PAGE FORWARD'                            50850000
         DC    AL1(SF,PNA),C' '                                         50900000
HDR3ID   DC    C'                   '                                   50950000
         DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'?'                        51000000
         DC    AL1(SF,PNA),C') PAGE BACKWRD'                            51050000
         DC    AL1(SF,PIA)                                              51100000
BBBSS    DC    C'BBBSSBBBSSBBBSS',AL1(SF,PNA),C'    '                   51150000
HDR3LTH  EQU   *-HDR3                                                   51200000
HDR4     DC    AL1(SF,PNA),C'RECAP REMOTE '                             51250000
HDR4TERM DC    CL2'  ',C' ON CU '                                       51300000
HDR4CTRL DC    CL2'  ',C' ON LINE '                                     51350000
HDR4LINE DC    CL3'999',C'  '                                           51400000
HDR4LTH  EQU   *-HDR4                                                   51450000
HDR5     DC    AL1(SBA),AL2(L4P1)                                       51500000
HDR6     DC    AL1(SF,PNA),C'      FILE#  TIME SENSE STATUS TPOP CMD'   51550000
HDR6LTH  EQU   *-HDR6                                                   51600000
IOERRMSG DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    51650000
         DC    XL34'00',AL1(SF,PNA),CL39' '                             51700000
         DC    CL39'BNG001A T I/O ERR READING SYS1.DEMFLOG '            51750000
         DC    CL28'    THE BDAM RETURN CODE IS '                       51800000
IOCODE   DC    CL4'0000'                                                51850000
         DC    CL8' '                                                   51900000
         DC    CL34'THE BDAM RELATIVE BLOCK NUMBER IS '                 51950000
IOBLOCK  DC    CL3'000'                                                 52000000
IOERRLTH EQU   *-IOERRMSG                                               52050000
MSG11    DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    52100000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           52150000
         DC    C'BNG011I T NO ERRORS RECORDED FOR REMOTE'               52200000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           52250000
         DC    CL9'TERMINAL '                                           52300000
MSG11TRM DC    CL2' '                                                   52350000
         DC    CL20'       ON CTRL UNIT '                               52400000
MSG11CU  DC    CL2' '                                                   52450000
         DC    AL1(SBA),AL2(L4P1),AL1(SF,PNA)                           52500000
         DC    CL8'ON LINE '                                            52550000
MSG11LIN DC    CL3' '                                                   52600000
         DC    CL8' '                                                   52650000
MSG11ID  DC    CL20' '          IMS SYMBOLIC NAME                       52700000
MSG11LTH EQU   *-MSG11                                                  52750000
MSG12    DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    52800000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           52850000
         DC    C'BNG012I T NO ERRORS RECORDED FOR LOCAL '               52900000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           52950000
         DC    CL9'TERMINAL '                                           53000000
MSG12TRM DC    CL3' '                                                   53050000
         DC    CL7' '                                                   53100000
MSG12ID  DC    CL20' '          IMS SYMBOLIC NAME                       53150000
MSG12LTH EQU   *-MSG12                                                  53200000
MDRHDR   DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'? ) '                     53250000
MDRBBBSS DC    CL5'BBBSS',AL1(SF,PNA)                                   53300000
MDRHRS   DC    CL2'24',C':'                                             53350000
MDRMINS  DC    CL2'60',C'  '                                            53400000
MDRSTAT  DC    CL4'XXXX',C'   '                                         53450000
OBRSNS   DC    CL4'    ',C'  '                                          53500000
OBRTPOP  DC    CL2'  ',C'  '                                            53550000
OBRCMD   DC    CL2'  ',C' '                                             53600000
MDRLTH   EQU   *-MDRHDR                                                 53650000
BUHDR1   DC    AL1(SBA),AL2(L1P7),AL1(IC)                               53700000
         DC   AL1(SBA),AL2(L3P39),AL1(SF,PIA),C'%',AL1(SBA),AL2(SML5P1) 53750000
         DC    X'3CC75F40',AL1(SBA),AL2(SML5P1)                         53800000
BUHDR1LT EQU   *-BUHDR1                                                 53850000
BUHDR2   DC    AL1(SBA),AL2(L1P7),AL1(IC)                               53900000
         DC    AL1(SBA),AL2(L2P79),AL1(SF,PIA),C'%',AL1(SBA),AL2(L4P1)  53950000
         DC    X'3C5D7F40',AL1(SBA),AL2(L4P1)                           54000000
BUHDR2LT EQU   *-BUHDR2                                                 54050000
INVMSG   DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    54100000
         DC    XL34'00',AL1(SBA),AL2(L2P1),AL1(SF,PNA)                  54150000
         DC    CL39'BNG005I T ERROR NOT FOUND ON FILE FOR '             54200000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           54250000
         DC    C'THE SELECTED ITEM '                                    54300000
INVLTH   EQU   *-INVMSG                                                 54350000
MSG13    DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    54353007
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                  @OZ31884 54356007
         DC    CL39'BNG013A T NO DATA BLOCKS AVAILABLE FOR '   @OZ31884 54359007
         DC    CL5'LINE '                                      @OZ31884 54362007
MSG13LN  DC    CL3' '                                          @OZ31884 54365007
         DC    CL31':  DATA BASE IN DEGRADED MODE. '           @OZ31884 54368007
         DC    CL39' MUST ALLOCATE MORE BLOCKS THAN LINES'     @OZ31884 54371007
MSG13LTH EQU   *-MSG13                                         @OZ31884 54374007
         DS    0F                       ALIGN ON FULL WORD     @OZ31884 54377007
R8SAVE   DC    X'00000000'              SAVE AREA REG 8        @OZ31884 54380007
DATTIME  DC    X'00000000'              SAVE AREA FOR TIME     @OZ31884 54383007
DATDATE  DC    PL4'0'                   SAVE AREA FOR DATE     @OZ31884 54386007
FILREC   DC    X'000000'                WORK AREA FOR FILE REC @OZ31884 54389007
SENSAV   DC    XL1'00'                  OBR SENSE WORK AREA    @OZ31884 54392007
         DS    XL3                      SPARE                  @OZ31884 54395007
         LTORG                                                          54400000
CALENDAR DC    C'JAN',PL2'31'                                           54450000
         DC    C'FEB',PL2'28'                                           54500000
         DC    C'MAR',PL2'31'                                           54550000
         DC    C'APR',PL2'30'                                           54600000
         DC    C'MAY',PL2'31'                                           54650000
         DC    C'JUN',PL2'30'                                           54700000
         DC    C'JUL',PL2'31'                                           54750000
         DC    C'AUG',PL2'31'                                           54800000
         DC    C'SEP',PL2'30'                                           54850000
         DC    C'OCT',PL2'31'                                           54900000
         DC    C'NOV',PL2'30'                                           54950000
         DC    C'DEC',PL2'31'                                           55000000
LEAPTBL  DC    X'768084889296FF'                                        55050000
EBTOHX   DC    X'00000000000000000000000000000000'     00-0F  THIS      55100000
         DC    X'00000000000000000000000000000000'     10-1F  TABLE     55150000
         DC    X'00000000000000000000000000000000'     20-2F  CONVERTS  55200000
         DC    X'00000000000000000000000000000000'     30-3F  INPUT     55250000
         DC    X'00000000000000000000000000000000'     40-4F  A THRU F  55300000
         DC    X'000000000000000000000000FF000000'     50-5F    TO      55350000
         DC    X'00000000000000000000000000000000'     60-6F  0A - 0F   55400000
         DC    X'00000000000000000000000000000000'     70-7F   AND      55450000
         DC    X'00000000000000000000000000000000'     80-8F  F0 - F9   55500000
         DC    X'00000000000000000000000000000000'     90-9F    TO      55550000
         DC    X'00000000000000000000000000000000'     A0-AF  00 - 09   55600000
         DC    X'00000000000000000000000000000000'     B0-BF    AND     55650000
         DC    X'000A0B0C0D0E0F000000000000000000'     C0-CF     *      55700000
         DC    X'00000000000000000000000000000000'     D0-DF   BECOME   55750000
         DC    X'00000000000000000000000000000000'     E0-EF    FF.     55800000
         DC    X'00010203040506070809000000000000'     F0-FF            55850000
HXTOEB   DC    4XL16'00',C' ',XL15'00',7XL16'00'  THIS TABLE CONVERTS   55900000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  HEX CHARS           55950000
         DC    2XL16'00'                CHARS FA-THRU-FF BACK           56000000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  A THRU F            56050000
CCWTABL  DC    CL20'00TEST IO'                                          56100000
         DC    CL20'01WRITE'                                            56150000
         DC    CL20'02READ'                                             56200000
         DC    CL20'03NO OP'                                            56250000
         DC    CL20'04SENSE'                                            56300000
         DC    CL20'05TEST WRITE'                                       56350000
         DC    CL20'06READ PREPARE'                                     56400000
         DC    CL20'07STEP COUNT'                                       56450000
         DC    CL20'09WRITE POLL'                                       56500000
         DC    CL20'0AREAD INHIBIT'                                     56550000
         DC    CL20'0DWRITE BREAK'                                      56600000
         DC    CL20'0EREAD SEARCH'                                      56650000
         DC    CL20'11WRITE W/TIME OUT'                                 56700000
         DC    CL20'12TEST READ'                                        56750000
         DC    CL20'13SAD ZERO'                                         56800000
         DC    CL20'15WRAP'                                             56850000
         DC    CL20'17SAD ONE'                                          56900000
         DC    CL20'19POLL SOH'                                         56950000
         DC    CL20'1BSAD TWO'                                          57000000
         DC    CL20'1D DIAGNOSTIC POLL'                                 57050000
         DC    CL20'1EADDRESS PREPARE'                                  57100000
         DC    CL20'1FSAD THREE'                                        57150000
         DC    CL20'23SET MODE'                                         57200000
         DC    CL20'27ENABLE'                                           57250000
         DC    CL20'29WRITE DIAL'                                       57300000
         DC    CL20'2FDISABLE'                                          57350000
         DC    CL20'33TEST SYNC'                                        57400000
         DC    CL20'37SENFEOT'                                          57450000
         DC    CL20'3BSEND INQUIRY'                                     57500000
         DC    CL20'41WRITE BREAK'                                      57550000
         DC    CL20'42READ CLEAR'                                       57600000
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           57650000
TPOPTBL  DC    CL20'00ON LINE TEST'                                     57700000
         DC    CL20'01DISABLE'                                          57750000
         DC    CL20'02WRITE EOA EOT EOT'                                57800000
         DC    CL20'03WRT POLL/ADDR CHRS'                               57850000
         DC    CL20'04WRITE SPACE'                                      57900000
         DC    CL20'05RD RSP TO POLLING'                                57950000
         DC    CL20'06RD RSP TO ADDRESSING'                             58000000
         DC    CL20'07READ ID RESPONSE'                                 58050000
         DC    CL20'08WRITE EOA'                                        58100000
         DC    CL20'09NOP OR TIC'                                       58150000
         DC    CL20'0AREAD INDEX'                                       58200000
         DC    CL20'0BREAD INQUIRY'                                     58250000
         DC    CL20'0CRD RSP TO INQUIRY'                                58300000
         DC    CL20'10WRT LINE ADDRESS'                                 58350000
         DC    CL20'11RD OR WRT TEXT'                                   58400000
         DC    CL20'12RD SKIP OR TIC'                                   58450000
         DC    CL20'13WRITE DLE ETX'                                    58500000
         DC    CL20'20RD RSP TO TEXT'                                   58550000
         DC    CL20'21ALL RESET COMMANDS'                               58600000
         DC    CL20'22READ SKIP'                                        58650000
         DC    CL20'23WRITE BREAK'                                      58700000
         DC    CL20'24OPEN LOPEN CLOSE'                                 58750000
         DC    CL20'25RD RSP TO TEXT'                                   58800000
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           58850000
CSWTABL  DC    B'1000000000000000',CL18'ATTENTION'                      58900000
         DC    B'0100000000000000',CL18'STATUS MODIFIER'                58950000
         DC    B'0010000000000000',CL18'CTRL UNIT END'                  59000000
         DC    B'0001000000000000',CL18'BUSY'                           59050000
         DC    B'0000100000000000',CL18'CHANNEL END'                    59100000
         DC    B'0000010000000000',CL18'DEVICE END'                     59150000
         DC    B'0000001000000000',CL18'UNIT CHECK'                     59200000
         DC    B'0000000100000000',CL18'UNIT EXCEPTION'                 59250000
         DC    B'0000000010000000',CL18'PGRM CTRLD INTRPT'              59300000
         DC    B'0000000001000000',CL18'INCORRECT LENGTH'               59350000
         DC    B'0000000000100000',CL18'PROGRAM CHECK'                  59400000
         DC    B'0000000000010000',CL18'PROTECTION CHECK'               59450000
         DC    B'0000000000001000',CL18'CHANL DATA CHECK'               59500000
         DC    B'0000000000000100',CL18'CHANL CTRL CHECK'               59550000
         DC    B'0000000000000010',CL18'INTFACE CTRL CK'                59600000
         DC    B'0000000000000001',CL18'CHAINING CHECK'                 59650000
         DC    X'FF'                                                    59700000
SENSTABL DC    B'10000000',CL18'COMMAND REJECT'                         59750000
         DC    B'01000000',CL18'INTERVENTION REQD'                      59800000
         DC    B'00100000',CL18'BUS OUT CHECK'                          59850000
         DC    B'00010000',CL18'EQUIPMENT CHECK'                        59900000
         DC    B'00001000',CL18'DATA CHECK'                             59950000
         DC    B'00000100',CL18'OVERRUN'                                60000000
         DC    B'00000010',CL18'LOST DATA'                              60050000
         DC    B'00000001',CL18'TIMEOUT'                                60100000
         DC    X'FF'                                                    60150000
STATSTBL DC    B'0010000000000000',CL18'RESERVED'                       60200000
         DC    B'0001000000000000',CL18'RESERVED'                       60250000
         DC    B'0000100000000000',CL18'DEVICE BUSY'                    60300000
         DC    B'0000010000000000',CL18'UNIT SPECIFY'                   60350000
         DC    B'0000001000000000',CL18'DEVICE END'                     60400000
         DC    B'0000000100000000',CL18'TRANSMISSION CHECK'             60450000
         DC    B'0000000000100000',CL18'COMMAND REJECT'                 60500000
         DC    B'0000000000010000',CL18'INTERVENTION REQD'              60550000
         DC    B'0000000000001000',CL18'EQUIPMENT CHECK'                60600000
         DC    B'0000000000000100',CL18'DATA CHECK'                     60650000
         DC    B'0000000000000010',CL18'CONTROL CHECK'                  60700000
         DC    B'0000000000000001',CL18'OPERATION CHECK'                60750000
         DC    X'FF'                                                    60800000
SENS3272 DC    B'10000000',CL18'COMMAND REJECT'                         60850000
         DC    B'01000000',CL18'INTERVENTION REQD'                      60900000
         DC    B'00100000',CL18'BUS OUT CHECK'                          60950000
         DC    B'00010000',CL18'EQUIPMENT CHECK'                        61000000
         DC    B'00001000',CL18'DATA CHECK'                             61050000
         DC    B'00000100',CL18'UNIT SPECIFY'                           61100000
         DC    B'00000010',CL18'CONTROL CHECK'                          61150000
         DC    B'00000001',CL18'OPERATION CHECK'                        61200000
         DC    X'FF'                                                    61250000
CCW3272  DC    CL20'01WRITE'                                            61300000
         DC    CL20'05ERASE WRITE'                                      61350000
         DC    CL20'02READ BUFFER'                                      61400000
         DC    CL20'06READ MODIFIED'                                    61450000
         DC    CL20'0BSELECT'                                           61500000
         DC    CL20'0FERASE ALL PROTECTD'                               61550000
         DC    CL20'03NO OP'                                            61600000
         DC    CL20'04SENSE'                                            61650000
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           61700000
TCAMTPOP DC    CL20'01WRT EOT FOR SELECT'                               61750000
         DC    CL20'02OPEN TP OP CODE'                                  61800000
         DC    CL20'03WRITE POLL CHARS'                                 61850000
         DC    CL20'04RD RSPNS TO POLL'                                 61900000
         DC    CL20'05WRITE PAD CHARS'                                  61950000
         DC    CL20'06ENABLE DIAL LINE'                                 62000000
         DC    CL20'07WRT ADDR SEQUENCE'                                62050000
         DC    CL20'08READ RSPNS TO ADDR'                               62100000
         DC    CL20'09WRITE EOA SEQUENCE'                               62150000
         DC    CL20'0ARD RSPNS EOB/ETB'                                 62200000
         DC    CL20'0BWRITE CPU ID'                                     62250000
         DC    CL20'0CREAD ENQ'                                         62300000
         DC    CL20'0DWRITE ENQ'                                        62350000
         DC    CL20'0ERD RSPNS TO ENQ'                                  62400000
         DC    CL20'0FWRITE DLE EOT'                                    62450000
         DC    CL20'10READ ID (TSO)'                                    62500000
         DC    CL20'11NON-R/W CCW'                                      62550000
         DC    CL20'12WRITE BREAK (TSO)'                                62600000
         DC    CL20'13WRT ENQ AFTER SEL'                                62650000
         DC    CL20'14READ LCOUT'                                       62700000
         DC    CL20'15WRT RSP BEFOR TXT'                                62750000
         DC    CL20'16WRITE RESPONSE'                                   62800000
         DC    CL20'17WRITE TONE'                                       62850000
         DC    CL20'18BSC READ ID ENQ'                                  62900000
         DC    CL20'1ABSC READ ID ACK'                                  62950000
         DC    CL20'1CABORT SEND/RECIEV'                                63000000
         DC    CL20'1EREAD TWX ID'                                      63050000
         DC    CL20'20BUF TRM RESET BLK'                                63100000
         DC    CL20'22 CLOSE SDR RECRDNG'                               63150000
         DC    CL20'24WRT RESET AFT SEL'                                63200000
         DC    CL20'51READ SKIP LOOP'                                   63250000
         DC    CL20'53WRT IDLES LOOP'                                   63300000
         DC    CL20'57WRT DLE STX'                                      63350000
         DC    CL20'59WRT DLE ETB(ETX)'                                 63400000
         DC    CL20'5BWRT ENQ RSP TO TXT'                               63450000
         DC    CL20'FFTEXT CCW'                                         63500000
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           63550000
DECB     DSECT                                                          63950000
         DS    CL1                                                      64000000
EXCPBITS DS    CL2                 EXCEPTIONS BITS IN DECB              64050000
         DS    CL1                                                      64100000
T3270ID  DC    C'BNGT3270 END'                                          64150000
         END                                                            64200000
