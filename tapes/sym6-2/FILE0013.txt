./  ADD  SSI=63150707,NAME=IGCMSG6C
         TITLE 'IGCMSG6C - PUT OUT ERROR MESSAGES                      *00001000
                        '                                               00002000
IGCMSG6C CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(16)                                             0001 00007000
         DC    C'IGCMSG6C  76.315'                                 0001 00008000
         DROP  @15                                                      00009000
@PROLOG  STM   @14,@12,12(@13)                                     0001 00010000
         BALR  @12,0                                               0001 00011000
@PSTART  DS    0H                                                  0001 00012000
         USING @PSTART,@12                                         0001 00013000
         L     @00,@SIZDATD                                        0001 00014000
         GETMAIN  R,LV=(0)                                              00015000
         LR    @11,@01                                             0001 00016000
         USING @DATD,@11                                           0001 00017000
         ST    @13,@SA00001+4                                      0001 00018000
         LM    @00,@01,20(@13)                                     0001 00019000
         ST    @11,8(,@13)                                         0001 00020000
         LR    @13,@11                                             0001 00021000
         XC    @ZTEMPS(@ZLEN),@ZTEMPS                                   00022000
         MVC   @PC00001(4),0(@01)                                  0001 00023000
*                                   /* CHARACTER STRING              */ 00024000
*                                                                  0026 00025000
*   /*****************************************************************/ 00026000
*   /*                                                               */ 00027000
*   /* LOCATE CORRECT INSTRUCTIONS                                   */ 00028000
*   /*                                                               */ 00029000
*   /*****************************************************************/ 00030000
*                                                                  0026 00031000
*   INSTPTR=ADDR(INSTENTX(1));                                     0026 00032000
         LA    @10,OPTABLE                                         0026 00033000
         L     @05,@PC00001                                        0026 00034000
         AH    @10,OPID(,@05)                                      0026 00035000
         L     @10,PRETTAB(,@10)                                   0026 00036000
         AH    @10,OPRETCOD(,@05)                                  0026 00037000
         AL    @10,@CF00192                                        0026 00038000
         L     INSTPTR,PINSTTAB(,@10)                              0026 00039000
         LA    INSTPTR,INSTENTX+8(,INSTPTR)                        0026 00040000
*   MSGINDEX=LENGTH(MSGID)+1;       /* START WITH FIRST BYTE OF    0027 00041000
*                                      MESSAGE AREA PAST MESSAGE   0027 00042000
*                                      IDENTIFIER                    */ 00043000
         LA    MSGINDEX,9                                          0027 00044000
*   RESPECIFY                                                      0028 00045000
*     INSTENTX BASED(INSTPTR);                                     0028 00046000
*                                                                  0028 00047000
*   /*****************************************************************/ 00048000
*   /*                                                               */ 00049000
*   /* PROCESS ALL INSTRUCTIONS                                      */ 00050000
*   /*                                                               */ 00051000
*   /*****************************************************************/ 00052000
*                                                                  0029 00053000
*   DO WHILE ADDR(INST)Â¬=0;                                        0029 00054000
         B     @DE00029                                            0029 00055000
@DL00029 DS    0H                                                  0030 00056000
*     IF INSTTYPE=MVECLLER THEN     /* LOCATE NEXT DATA TO MOVE      */ 00057000
         CLI   INSTTYPE(INSTPTR),2                                 0030 00058000
         BNE   @RF00030                                            0030 00059000
*       DO;                         /* USER PROVIDED DATA            */ 00060000
*         IF INSTULEN=0 THEN        /* USE USER PROVIDED LENGTH IF 0032 00061000
*                                      PASSED                        */ 00062000
         CLI   INSTULEN(INSTPTR),0                                 0032 00063000
         BNE   @RF00032                                            0032 00064000
*           DO;                                                    0033 00065000
*             WORDPTR=ADDR(USERXDTA);/* USER CHARACTER STRING        */ 00066000
         LH    @10,INSTINDX(,INSTPTR)                              0034 00067000
         SLA   @10,2                                               0034 00068000
         L     @15,@PC00001                                        0034 00069000
         L     @10,USERPTR-4(@10,@15)                              0034 00070000
         LA    WORDPTR,USERXDTA(,@10)                              0034 00071000
*             MAXSIZE=USERXLEN;     /* USER LENGTH FOR STRING        */ 00072000
         LH    MAXSIZE,USERXLEN(,@10)                              0035 00073000
*           END;                                                   0036 00074000
*         ELSE                                                     0037 00075000
*           DO;                                                    0037 00076000
         B     @RC00032                                            0037 00077000
@RF00032 DS    0H                                                  0038 00078000
*             WORDPTR=USERPTR(INSTINDX);/* USER CHARACTER STRING     */ 00079000
         LH    @10,INSTINDX(,INSTPTR)                              0038 00080000
         SLA   @10,2                                               0038 00081000
         L     @15,@PC00001                                        0038 00082000
         L     WORDPTR,USERPTR-4(@10,@15)                          0038 00083000
*             MAXSIZE=INSTULEN;     /* DEFAULT LENGTH FOR STRING     */ 00084000
         SLR   MAXSIZE,MAXSIZE                                     0039 00085000
         IC    MAXSIZE,INSTULEN(,INSTPTR)                          0039 00086000
*           END;                                                   0040 00087000
*                                                                  0040 00088000
*         /***********************************************************/ 00089000
*         /*                                                         */ 00090000
*         /* CORRECT SIZE PASSED BY USER BY REMOVEING TRAILING BLANKS*/ 00091000
*         /*                                                         */ 00092000
*         /***********************************************************/ 00093000
*                                                                  0041 00094000
*         DO MAXSIZE=MAXSIZE TO 1 BY-1 WHILE WORDPTR->THEWORD(MAXSIZE)= 00095000
*               ' ';                                               0041 00096000
@RC00032 B     @DE00041                                            0041 00097000
@DL00041 LR    @10,WORDPTR                                         0041 00098000
         ALR   @10,MAXSIZE                                         0041 00099000
         BCTR  @10,0                                               0041 00100000
         CLI   THEWORD(@10),C' '                                   0041 00101000
         BNE   @DC00041                                            0041 00102000
*         END;                                                     0042 00103000
         BCTR  MAXSIZE,0                                           0042 00104000
@DE00041 LTR   MAXSIZE,MAXSIZE                                     0042 00105000
         BP    @DL00041                                            0042 00106000
@DC00041 DS    0H                                                  0043 00107000
*       END;                                                       0043 00108000
*     ELSE                                                         0044 00109000
*       DO;                         /* CHARACTER CONSTANT DATA       */ 00110000
         B     @RC00030                                            0044 00111000
@RF00030 DS    0H                                                  0045 00112000
*         WORDPTR=ADDR(INSTDATA);                                  0045 00113000
         L     @10,INSTADDR-1(,INSTPTR)                            0045 00114000
         LA    @10,0(,@10)                                         0045 00115000
         LA    WORDPTR,INSTDATA(,@10)                              0045 00116000
*         MAXSIZE=INSTLEN;                                         0046 00117000
         SLR   MAXSIZE,MAXSIZE                                     0046 00118000
         IC    MAXSIZE,INSTLEN(,@10)                               0046 00119000
*       END;                                                       0047 00120000
*     CALL COPYWORD;                /* PUT TEXT IN MESSAGE           */ 00121000
@RC00030 BAL   @14,COPYWORD                                        0048 00122000
*     INSTPTR=INSTPTR+LENGTH(INSTENT);/* POINT TO NEXT INSTRUCTION   */ 00123000
         AH    INSTPTR,@CH00190                                    0049 00124000
*   END;                                                           0050 00125000
@DE00029 L     @10,INSTADDR-1(,INSTPTR)                            0050 00126000
         LA    @10,0(,@10)                                         0050 00127000
         LTR   @10,@10                                             0050 00128000
         BNZ   @DL00029                                            0050 00129000
*   CALL WTORTN;                    /* PUT OUT REST OF MESSAGE       */ 00130000
         BAL   @14,WTORTN                                          0051 00131000
*COPYWORD:                                                         0052 00132000
*   PROC;                                                          0052 00133000
*                                                                  0052 00134000
@EL00001 L     @13,4(,@13)                                         0052 00135000
@EF00001 L     @00,@SIZDATD                                        0052 00136000
         LR    @01,@11                                             0052 00137000
         FREEMAIN R,LV=(0),A=(1)                                        00138000
@ER00001 LM    @14,@12,12(@13)                                     0052 00139000
         BR    @14                                                 0052 00140000
COPYWORD STM   @14,@03,@SA00002                                    0052 00141000
         STM   @05,@12,@SA00002+24                                 0052 00142000
*/********************************************************************/ 00143000
*/* FUNCTION: COPIES CHARACTER STING INTO WTO PARAMETER LIST.        */ 00144000
*/*   CALLS WTORTN TO PUT OUT CURRENT LINE IF THE BUFFER IS FILLED.  */ 00145000
*/********************************************************************/ 00146000
*                                                                  0053 00147000
*   IXWORD=1;                       /* INDEX INTO CURRENT WORD       */ 00148000
*                                                                  0053 00149000
         LA    @10,1                                               0053 00150000
         LR    IXWORD,@10                                          0053 00151000
*   /*****************************************************************/ 00152000
*   /*                                                               */ 00153000
*   /* PROCESS THE CURRENT CHARACTER STRING                          */ 00154000
*   /*                                                               */ 00155000
*   /*****************************************************************/ 00156000
*                                                                  0054 00157000
*   DO IXFIELD=1 TO MAXSIZE;                                       0054 00158000
*                                                                  0054 00159000
         LR    IXFIELD,@10                                         0054 00160000
         B     @DE00054                                            0054 00161000
@DL00054 DS    0H                                                  0055 00162000
*     /***************************************************************/ 00163000
*     /*                                                             */ 00164000
*     /* CHECK IF ANY MORE ROOM IN BUFFER                            */ 00165000
*     /*                                                             */ 00166000
*     /***************************************************************/ 00167000
*                                                                  0055 00168000
*     IF MSGINDEX+IXWORD>=LENGTH(WTOXX03) THEN                     0055 00169000
         LR    @10,MSGINDEX                                        0055 00170000
         ALR   @10,IXWORD                                          0055 00171000
         CH    @10,@CH00087                                        0055 00172000
         BL    @RF00055                                            0055 00173000
*       CALL WTORTN;                /* FULL PUT IT OUT               */ 00174000
*                                                                  0056 00175000
         BAL   @14,WTORTN                                          0056 00176000
*     /***************************************************************/ 00177000
*     /*                                                             */ 00178000
*     /* CHECK FOR END OF WORD                                       */ 00179000
*     /*                                                             */ 00180000
*     /***************************************************************/ 00181000
*                                                                  0057 00182000
*     IF WORDPTR->THEWORD(IXWORD)=' '|IXFIELD=MAXSIZE THEN         0057 00183000
@RF00055 LR    @10,WORDPTR                                         0057 00184000
         ALR   @10,IXWORD                                          0057 00185000
         BCTR  @10,0                                               0057 00186000
         CLI   THEWORD(@10),C' '                                   0057 00187000
         BE    @RT00057                                            0057 00188000
         CR    IXFIELD,MAXSIZE                                     0057 00189000
         BNE   @RF00057                                            0057 00190000
@RT00057 DS    0H                                                  0058 00191000
*       DO;                                                        0058 00192000
*         WTOXX03(MSGINDEX:MSGINDEX+IXWORD-1)=WORDPTR->THEWORD(1:IXWORD 00193000
*             );                    /* MOVE THE WORD                 */ 00194000
*                                                                  0059 00195000
         LA    @10,WTOXX03-1(MSGINDEX)                             0059 00196000
         LR    @07,IXWORD                                          0059 00197000
         BCTR  @07,0                                               0059 00198000
         EX    @07,@SM00193                                        0059 00199000
*         /***********************************************************/ 00200000
*         /*                                                         */ 00201000
*         /* CORRECT CURRENT DATA POINTERS                           */ 00202000
*         /*                                                         */ 00203000
*         /***********************************************************/ 00204000
*                                                                  0060 00205000
*         WORDPTR=WORDPTR+IXWORD;   /* NEXT WORD                     */ 00206000
         ALR   WORDPTR,IXWORD                                      0060 00207000
*         MSGINDEX=MSGINDEX+IXWORD; /* NEXT FREE SPOT WTO PARAMETER     00208000
*                                      LIST                          */ 00209000
         ALR   MSGINDEX,IXWORD                                     0061 00210000
*         IXWORD=1;                 /* PROCESS NEW WORD NEXT         */ 00211000
         LA    IXWORD,1                                            0062 00212000
*       END;                                                       0063 00213000
*     ELSE                                                         0064 00214000
*       IXWORD=IXWORD+1;            /* PT TO NEXT BYTE IN WORD       */ 00215000
         B     @RC00057                                            0064 00216000
@RF00057 AH    IXWORD,@CH00042                                     0064 00217000
*   END;                                                           0065 00218000
@RC00057 AH    IXFIELD,@CH00042                                    0065 00219000
@DE00054 CR    IXFIELD,MAXSIZE                                     0065 00220000
         BNH   @DL00054                                            0065 00221000
*   END COPYWORD;                                                  0066 00222000
@EL00002 DS    0H                                                  0066 00223000
@EF00002 DS    0H                                                  0066 00224000
@ER00002 LM    @14,@03,@SA00002                                    0066 00225000
         LM    @05,@12,@SA00002+24                                 0066 00226000
         BR    @14                                                 0066 00227000
*WTORTN:                                                           0067 00228000
*   PROC;                                                          0067 00229000
*                                                                  0067 00230000
WTORTN   STM   @14,@03,12(@13)                                     0067 00231000
         STM   @05,@12,40(@13)                                     0067 00232000
*/********************************************************************/ 00233000
*/*FUNCTION - FORMATS WTO PARAMETER LIST AND ISSUES A WTO ON THE     */ 00234000
*/*  CURRENT PORTION OF THE MESSAGE.                                 */ 00235000
*/********************************************************************/ 00236000
*                                                                  0068 00237000
*   WTOXX01=WTOX01+MSGINDEX-LENGTH(WTOX03)-1;/* LENGTH               */ 00238000
         LR    @10,MSGINDEX                                        0068 00239000
         AH    @10,WTOX01                                          0068 00240000
         BCTR  @10,0                                               0068 00241000
         BCTR  @10,0                                               0068 00242000
         STH   @10,WTOXX01                                         0068 00243000
*   WTOXX02=WTOX02;                 /* MCS FLAG                      */ 00244000
         MVC   WTOXX02(2),WTOX02                                   0069 00245000
*   WTOXX03(1:LENGTH(MSGID))=MSGID; /* PLACE MESSAGE ID IN EACH LINE */ 00246000
         LA    @10,OPTABLE                                         0070 00247000
         L     @05,@PC00001                                        0070 00248000
         AH    @10,OPID(,@05)                                      0070 00249000
         L     @10,PRETTAB(,@10)                                   0070 00250000
         AH    @10,OPRETCOD(,@05)                                  0070 00251000
         AL    @10,@CF00192                                        0070 00252000
         L     @10,PINSTTAB(,@10)                                  0070 00253000
         MVC   WTOXX03(8),MSGID(@10)                               0070 00254000
*   WTOXX04=WTOX04;                 /* DESCRIPTOR CODES              */ 00255000
         LA    @10,WTOXX03                                         0071 00256000
         BCTR  @10,0                                               0071 00257000
         ALR   @10,MSGINDEX                                        0071 00258000
         MVC   WTOXX04(2,@10),WTOX04                               0071 00259000
*   WTOXX05=WTOX05;                 /* ROUTING CODES                 */ 00260000
*                                                                  0072 00261000
         MVC   WTOXX05(2,@10),WTOX05                               0072 00262000
*   /*****************************************************************/ 00263000
*   /*                                                               */ 00264000
*   /* PUT THE MESSAGE OUT                                           */ 00265000
*   /*                                                               */ 00266000
*   /*****************************************************************/ 00267000
*                                                                  0073 00268000
*   DO;                             /* WTOP MF(E,WTOXX)              */ 00269000
*     RFY                                                          0074 00270000
*       GPR01P RSTD;                /* RESTRICT REG 1                */ 00271000
*     GPR01P=ADDR(WTOXX);           /* ADDRESS CONTROL PROGRAM LIST  */ 00272000
         LA    GPR01P,WTOXX                                        0075 00273000
*     SVC(35);                      /* ISSUE WTO SVC                 */ 00274000
         SVC   35                                                  0076 00275000
*     RFY                                                          0077 00276000
*       GPR01P UNRSTD;              /* RELEASE REG 1                 */ 00277000
*   END;                            /* WTOP MF(E,WTOXX)              */ 00278000
*   MSGINDEX=LENGTH(MSGID)+1;       /* POINT TO START OF MESSAGE   0079 00279000
*                                      BUFFER AGAIN                  */ 00280000
         LA    MSGINDEX,9                                          0079 00281000
*   END WTORTN;                                                    0080 00282000
@EL00003 DS    0H                                                  0080 00283000
@EF00003 DS    0H                                                  0080 00284000
@ER00003 LM    @14,@03,12(@13)                                     0080 00285000
         LM    @05,@12,40(@13)                                     0080 00286000
         BR    @14                                                 0080 00287000
*   END IGCMSG6C;                                                  0081 00288000
@DATA    DS    0H                                                       00289000
@CH00042 DC    H'1'                                                     00290000
@CH00190 DC    H'4'                                                     00291000
@CH00087 DC    H'72'                                                    00292000
@SM00193 MVC   0(0,@10),THEWORD(WORDPTR)                                00293000
@DATD    DSECT                                                          00294000
         DS    0F                                                       00295000
@SA00001 DS    18F                                                      00296000
@PC00001 DS    1F                                                       00297000
@SA00002 DS    14F                                                      00298000
@ZTEMPS  DS    C                                                        00299000
@ZTEMPND EQU   *                                                        00300000
@ZLEN    EQU   @ZTEMPND-@ZTEMPS                                         00301000
IGCMSG6C CSECT                                                          00302000
         DS    0F                                                       00303000
@CF00192 DC    F'-4'                                                    00304000
@DATD    DSECT                                                          00305000
         DS    0D                                                       00306000
WTOXX    DS    CL80                                                     00307000
         ORG   WTOXX                                                    00308000
WTOXX01  DS    FL2                                                      00309000
WTOXX02  DS    BL2                                                      00310000
WTOXX03  DS    CL72                                                     00311000
@NM00003 DS    2BL2                                                     00312000
         ORG   WTOXX+80                                                 00313000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                00314000
@ENDDATD EQU   *                                                        00315000
IGCMSG6C CSECT                                                          00316000
         DS    0F                                                       00317000
@SIZDATD DC    AL1(0)                                                   00318000
         DC    AL3(@ENDDATD-@DATD)                                      00319000
         DS    0D                                                       00320000
WTOX     DS    CL9                                                      00321000
         ORG   WTOX                                                     00322000
WTOX01   DC    H'5'                                                     00323000
WTOX02   DC    B'1000000000000000'                                      00324000
WTOX03   DC    CL1'?'                                                   00325000
WTOX04   DC    B'0000000000000000'                                      00326000
WTOX05   DC    B'0000000010100000'                                      00327000
         ORG   WTOX+9                                                   00328000
         DS    CL3                                                      00329000
SECN05B  DS    CL12                                                     00330000
         ORG   SECN05B                                                  00331000
@NM00005 DC    AL4(IHJ101I)                                             00332000
         DC    AL4(IHJ101I)                                             00333000
         DC    F'0'                                                     00334000
         ORG   SECN05B+12                                               00335000
SECK05B  DS    CL12                                                     00336000
         ORG   SECK05B                                                  00337000
@NM00031 DC    AL4(IHJ102I)                                             00338000
         DC    AL4(IHJ102I)                                             00339000
         DC    F'0'                                                     00340000
         ORG   SECK05B+12                                               00341000
IHJ101I  DS    CL32                                                     00342000
         ORG   IHJ101I                                                  00343000
@NM00006 DC    CL8'IHJ101I'                                             00344000
@NM00007 DS    CL4                                                      00345000
         ORG   @NM00007                                                 00346000
@NM00008 DC    AL1(1)                                                   00347000
@NM00009 DC    AL3(AMSG)                                                00348000
         ORG   IHJ101I+12                                               00349000
@NM00010 DS    CL4                                                      00350000
         ORG   @NM00010                                                 00351000
@NM00011 DC    AL1(1)                                                   00352000
@NM00012 DC    AL3(CMSG)                                                00353000
         ORG   IHJ101I+16                                               00354000
@NM00013 DS    CL4                                                      00355000
         ORG   @NM00013                                                 00356000
@NM00014 DC    AL1(2)                                                   00357000
@NM00015 DC    AL1(44)                                                  00358000
@NM00016 DC    H'1'                                                     00359000
         ORG   IHJ101I+20                                               00360000
@NM00017 DS    CL4                                                      00361000
         ORG   @NM00017                                                 00362000
@NM00018 DC    AL1(1)                                                   00363000
@NM00019 DC    AL3(COMMA)                                               00364000
         ORG   IHJ101I+24                                               00365000
@NM00020 DS    CL4                                                      00366000
         ORG   @NM00020                                                 00367000
@NM00021 DC    AL1(2)                                                   00368000
@NM00022 DC    AL1(6)                                                   00369000
@NM00023 DC    H'2'                                                     00370000
         ORG   IHJ101I+28                                               00371000
@NM00024 DC    F'0'                                                     00372000
         ORG   IHJ101I+32                                               00373000
AMSG     DS    CL24                                                     00374000
         ORG   AMSG                                                     00375000
@NM00025 DC    AL1(23)                                                  00376000
@NM00026 DC    CL23'USER NOT AUTHORIZED TO '                            00377000
         ORG   AMSG+24                                                  00378000
CMSG     DS    CL15                                                     00379000
         ORG   CMSG                                                     00380000
@NM00027 DC    AL1(14)                                                  00381000
@NM00028 DC    CL14'DASD DATA SET='                                     00382000
         ORG   CMSG+15                                                  00383000
COMMA    DS    CL2                                                      00384000
         ORG   COMMA                                                    00385000
@NM00029 DC    AL1(1)                                                   00386000
@NM00030 DC    CL1','                                                   00387000
         ORG   COMMA+2                                                  00388000
         DS    CL3                                                      00389000
IHJ102I  DS    CL20                                                     00390000
         ORG   IHJ102I                                                  00391000
@NM00032 DC    CL8'IHJ102I'                                             00392000
@NM00033 DS    CL4                                                      00393000
         ORG   @NM00033                                                 00394000
@NM00034 DC    AL1(1)                                                   00395000
@NM00035 DC    AL3(MSG102)                                              00396000
         ORG   IHJ102I+12                                               00397000
@NM00036 DS    CL4                                                      00398000
         ORG   @NM00036                                                 00399000
@NM00037 DC    AL1(2)                                                   00400000
@NM00038 DC    AL1(6)                                                   00401000
@NM00039 DC    H'1'                                                     00402000
         ORG   IHJ102I+16                                               00403000
@NM00040 DC    F'0'                                                     00404000
         ORG   IHJ102I+20                                               00405000
MSG102   DS    CL41                                                     00406000
         ORG   MSG102                                                   00407000
@NM00041 DC    AL1(40)                                                  00408000
@NM00042 DC    CL40'USER NOT RACF AUTHORIZED TO TAPE VOLUME='           00409000
         ORG   MSG102+41                                                00410000
PATCH    DS    CL100                                                    00411000
         DS    CL3                                                      00412000
OPTABLE  DC    AL4(SECN05B)                                             00413000
         DC    AL4(SECK05B)                                             00414000
         DS    1XL4                                                     00415000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00416000
@01      EQU   01                                                       00417000
@02      EQU   02                                                       00418000
@03      EQU   03                                                       00419000
@04      EQU   04                                                       00420000
@05      EQU   05                                                       00421000
@06      EQU   06                                                       00422000
@07      EQU   07                                                       00423000
@08      EQU   08                                                       00424000
@09      EQU   09                                                       00425000
@10      EQU   10                                                       00426000
@11      EQU   11                                                       00427000
@12      EQU   12                                                       00428000
@13      EQU   13                                                       00429000
@14      EQU   14                                                       00430000
@15      EQU   15                                                       00431000
IXFIELD  EQU   @06                                                      00432000
MAXSIZE  EQU   @03                                                      00433000
WORDPTR  EQU   @05                                                      00434000
IXWORD   EQU   @02                                                      00435000
INSTPTR  EQU   @02                                                      00436000
MSGINDEX EQU   @04                                                      00437000
GPR01P   EQU   @01                                                      00438000
GPR00F   EQU   @00                                                      00439000
GPR00P   EQU   @00                                                      00440000
GPR01F   EQU   @01                                                      00441000
GPR14F   EQU   @14                                                      00442000
GPR14P   EQU   @14                                                      00443000
GPR15F   EQU   @15                                                      00444000
GPR15P   EQU   @15                                                      00445000
@NM00001 EQU   0                                                        00446000
RETTAB   EQU   @NM00001                                                 00447000
PRETTAB  EQU   0                                                        00448000
INSTTAB  EQU   0                                                        00449000
MSGID    EQU   INSTTAB                                                  00450000
INSTENT  EQU   INSTTAB+8                                                00451000
PINSTTAB EQU   0                                                        00452000
INSTENTX EQU   0                                                        00453000
INSTTYPE EQU   INSTENTX                                                 00454000
INSTADDR EQU   INSTENTX+1                                               00455000
INSTULEN EQU   INSTADDR                                                 00456000
INSTINDX EQU   INSTADDR+1                                               00457000
INST     EQU   0                                                        00458000
INSTLEN  EQU   INST                                                     00459000
INSTDATA EQU   INST+1                                                   00460000
@NM00002 EQU   0                                                        00461000
USERXLEN EQU   @NM00002                                                 00462000
USERXDTA EQU   @NM00002+2                                               00463000
@NM00004 EQU   0                                                        00464000
WTOXX04  EQU   @NM00004                                                 00465000
WTOXX05  EQU   @NM00004+2                                               00466000
THEWORD  EQU   0                                                        00467000
IKEBC    EQU   0                                                        00468000
IKEBF15  EQU   0                                                        00469000
IKEBF31  EQU   0                                                        00470000
IKEBP15  EQU   0                                                        00471000
IKEBP31  EQU   0                                                        00472000
IKEBP8   EQU   0                                                        00473000
PARMLIST EQU   0                                                        00474000
OPID     EQU   PARMLIST                                                 00475000
OPRETCOD EQU   PARMLIST+2                                               00476000
USERPTR  EQU   PARMLIST+4                                               00477000
@PB00003 EQU   @EL00001                                                 00478000
@PB00002 EQU   @PB00003                                                 00479000
@ENDDATA EQU   *                                                        00480000
         END   IGCMSG6C,(C'PLS2218',0701,76315)                         00481000
./  ADD  SSI=82070233,NAME=IGC0G05B
         TITLE 'IGC0G05B  JFCB PROCESSOR - TABLE BUILD MODULE          *00090018
                      REPOSITION I/O  RESTART-SVC 52  OS/360'           00180018
IGC0G05B CSECT                                                          00270018
*          RELEASE 18 DELETIONS                                         00360018
*          RELEASE 19 DELETIONS                                         00450018
*0512390600,524700,540000,558000,564300-565200,586800,633600-    A26097 00460019
*0512635400,639000-639900,643100,649800,655200,657900-658800,    A26097 00470019
*0512662400,665100                                               A26097 00480019
*0512175500,242100                                               A28676 00490019
*          RELEASE 20 DELETIONS                                         00540018
*0931285240,307200-307500                                        A33998 00550020
*0931252900,256500                                               S20038 00560020
*0931514200,514500                                               A33084 00580020
*0931526500,623700,633700                                        A33983 00600020
*0931019800-035100,045900,047700,051300,147700-147760,147800-    M3408  00605020
*0931148060,148100-148420,148460,151200-152100,152300-152800,    M3408  00610020
*0931153100-153350,153400,153600,284790,285210,344700,353700,    M3408  00615020
*0931362700-630900,633700,636300-638100,643700,644100,656100,    M3408  00620020
*0931657000,659700-666400                                        M3408  00625020
*0931252000-253800                                               A38124 00627020
*          RELEASE 21 DELETIONS                                         00630018
*          RELEASE 22 DELETIONS                                         00720018
*          RELEASE 23 DELETIONS                                         00810018
*          RELEASE 24 DELETIONS                                         00900018
*          RELEASE 25 DELETIONS                                         00990018
*          RELEASE 26 DELETIONS                                         01080018
*      MVS RELEASE 3.7 CHANGES ADDITIONS DELETIONS                      01110037
*A186242-186252,A311577-311635                                 @ZA12948 01130037
*C230400,C321900,A321900                                       @ZA24633 01150037
* APAR OZ31483 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 01160037
*C148440,153888,302400,309920                                  @ZSUT222 01162037
*A634200-635200,655800                                         @ZSUT222 01164037
*STATUS CHANGE LEVEL 003                                                01170020
*                                                                       01260018
*TITLE -       TABLE BUILD MODULE                                       01350018
*                                                                       01440018
*STATUS -      INITIAL CODE                                             01530018
*                                                                       01620018
*FUNCTION -    THIS MODULE COUNTS THE DATA SETS ASSOCIATED WITH THE     01710018
*              TASK TO BE RESTARTED AND CONSTRUCTS A TABLE ENTRY FOR    01800018
*              FOR EVERY ONE EXCEPT THE VSAM DATA SETS. THE TIOT        01850002
*              OFFSETS ARE UPDATED. THE DSAB POINTERS TO THE DEB AND    01900002
*              VICE VERSA ARE UPDATED. TCAM DATA SETS ARE FLAGGED.      01950002
*              THE RESTART DATA SET IS FLAGGED. THE SSOB,DEB AND SSIB   02000002
*              POINTERS ARE UPDATED. ALL CHECKPOINT DATA SETS ARE       02050002
*              CHECKED TO MAKE SURE THEY ARE SECURE. THE PORTION        02100002
*              OF THE WORK AREA NOT USED FOR 48 BYTE ENTRIES IS USED    02150002
*              FOR I/O BUFFERS AND IS SPLIT INTO AS MANY 304 BYTE       02200002
*              BUFFERS AS POSSIBLE.                                     02250002
*                                                                       02490020
*              THIS MODULE WAS SPLIT FOR RELEASE 20.  THE REMAINDER     02790020
*              OF THE TABLE BUILD ROUTINE IS NOW MODULE IGC0G95B.       03090020
*                                                                       03600018
*ENTRYPOINT -  IGC0G05B  CSECT                                          03690018
*                                                                       03780018
*INPUT -       REGISTER 1 - POINTER TO THE RESTART WORKAREA (RSTWA)     03870018
*                           SEE DSECT AT END OF MODULE                  03960018
*                                                                       04050018
*OUTPUT -      REGISTER 8 - POINTER TO BEGINNING OF DATA SET INFO TABLE 04140018
*                                                                       04230018
*              REGISTER 1 - POINTER TO BEGINNING OF RSTWA WORKAREA      04320018
*                           (SEE DSECT AT END OF TABLE)                 04410018
*                                                                       04500018
*ENTERNAL RTN- NONE                                                     04590020
*                                                                       04680018
*EXITS -       NORMAL TO IGC0G95B VIA XCTL                              04770020
*                                                                       04860018
*              ON ERROR CONDITION TO IGC0V05B VIA XCTL                  04950018
*                   RET CODE =  33 - DD CARD MISSING IN TIOT   @ZSUT222 05040037
*                   RET CODE =  99 - DSAB MISSING              @ZSUT222 05050037
*                                                                       05090002
*                                                                       05220018
*TABLES/WORKAREAS                                                       05310018
*                                                                       05400018
*********************************************************************** 05490018
*                                                                     * 05580018
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 05670018
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 05760018
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 05850018
*    IS 48 BYTES LONG.                                                * 05940018
*                                                                     * 06030018
*********************************************************************** 06120018
*                                                                       06210018
*        ------------------- 4 BYTES -----------------                  06300018
*                                                                       06390018
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  06480018
*        +DATA SET  +           DCB                  +                  06570018
*        + ORGN.    +         ADDRESS                +                  06660018
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                06750018
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  06840018
*        + NO. 1    +         ADDRESS                +                  06930018
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  07020018
*        +NUMBER    +         JFCB TTR               +                  07110018
*        + OF VOLS  +         ADDRESS                +                  07200018
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               07290018
*                                                                       07380018
*     12 +++++++++++++++++++++++                                        07470018
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   07560018
*        +INFO BYTE + NUMBER   +                                        07650018
*        +++++++++++++++++++++++                                        07740018
*                                                                       07830018
*     12 +++++++++++++++++++++++                                        07920018
*        +    OLD   TIOT       +        DA AND UNIT RECORD              08010018
*        +      OFFSET         +                                        08100018
*        +++++++++++++++++++++++                                        08190018
*                                                                       08280018
*                              +++++++++++++++++++++++                  08370018
*                              +FLAG BYTE +FLAG BYTE +                  08460018
*                              +  NO. 2   +  NO. 3   +                  08550018
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  08640018
*        +FLAG BYTE +FLAG BYTE +                     +                  08730018
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  08820018
*        +++++++++++++++++++++++                     + 20               08910018
*        +                                           +                  09000018
*        +                                           +                  09090018
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  09180018
*        +                                           +                  09270018
*        +   VOLUME ID NO. 2                         +                  09360018
*        +                     +++++++++++++++++++++++ 28               09450018
*        +                     +                     +                  09540018
*        +                     +   VOLUME ID NO. 3   +                  09630018
*     32 +++++++++++++++++++++++                     +                  09720018
*        +                                           +                  09810018
*        +                                           +                  09900018
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               09990018
*        +                                           +                  10080018
*        +   VOLUME ID NO. 4                         +                  10170018
*     40 +                     +++++++++++++++++++++++                  10260018
*        +                     +                     +                  10350018
*        +                     +                     +                  10440018
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               10530018
*        +                                           +                  10620018
*        +                                           +                  10710018
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               10800018
*                                                                       10890018
*                                                                       10980018
*           A  DCBTABLE,                                                11070018
*                                                                       11160018
*           B  BUFFER AREA,                                             11250018
*                                                                       11340018
*           C  SEE DSECTS AT END OF LISTING.                            11430018
*                                                                       11520018
*ATTRIBUTES                                                             11610018
*                                                                       11700018
*          A RE-ENTRANT                                                 11790018
*          B RE-USABLE                                                  11880018
*          C ENABLED                                                    11970018
*          D PRIVIALEGED                                                12060018
*                                                                       12150018
*********************************************************************   12240018
*                                                                       12330018
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               12420018
*                                                                       12510018
*********************************************************************** 12600018
*                                                                       12690018
WRKR1    EQU   0                        WDRK/PARAMETER REGISTER         12780018
WRKR2    EQU   1                        WDRK/PARAMETER REGISTER         12870018
DCBR     EQU   2                        CURRENT DCB REGISTER            12960018
BASER    EQU   3                        BASE REGISTER                   13050018
DEBR     EQU   4                        CURRENT DEB REGISTER            13140018
UCBR     EQU   5                        CURRENT UCB REGISTER            13230018
TIOTR    EQU   6                        NEW TIOT REGISTER               13320018
TCBR     EQU   7                        TCB REGISTER                    13410018
TABLR    EQU   8                        BEGINNING TO DCB TABLE REG      13500018
CTABLR   EQU   9                        CURRENT ENTRY IN DCB TABLE      13590018
BUFR     EQU   10                       USER BUFFER AREA                13680018
DSCNTR   EQU   11                       WORK REGISTER                   13770018
WRKR3    EQU   12                       WORK/DEB PREFIX REGISTER Y02076 13820002
WRKR4    EQU   13                       WORK/CURRNT DSAB REGISTERY02076 13870002
WRKR5    EQU   14                       WORK/PARAMETER REGISTER         14040018
WRKR6    EQU   15                       WORK/PARAMETER REGISTER         14130018
*                                                                       14220018
*********************************************************************** 14310018
*                                                                       14400018
*    OFFSETS TO BE USED IN REPI/O PHASE                                 14490018
*                                                                       14580018
*********************************************************************** 14670018
*                                                                       14760018
IS       EQU   X'80'                    INDEXED SEQUENCIAL              14762018
PS       EQU   X'40'                    PHYSICAL SEQUENCIAL             14764018
DA       EQU   X'20'                    DIRECT ACCESS                   14766018
PO       EQU   X'02'                    PARTITIONED ORGANIZATION        14768018
VS       EQU   X'01'                    VIRTUAL SEQUENTIAL       Y02076 14770002
TABENT   EQU   48                       TABLE ENTRY LENGTH              14808018
ERR033   EQU   33                       MISSING DD CARD        @ZSUT222 14844037
BUFSEG   EQU   304                                                      14850018
TIOTBASE EQU   24                                                       15030018
BLANK    EQU   C' '                     BLANK CHARACTER                 15220018
NODDENT  EQU   X'00'                    NO DD ENTRY                     15290018
DEBID    EQU   X'0F'                    DEB IDENTIFICATION              15300018
TCAMID1  EQU   X'C0'                    UNIQUE TCAM DEB CODE     M3408  15302020
TCAMID2  EQU   X'CF'                    UNIQUE TCAM DEB CODE     M3408  15304020
RSTCAM   EQU   X'04'                    MASTER TCAM FLAG         M3408  15308020
ERR099   EQU   99                       NO DSAB FOUND ERROR    @ZSUT222 15388837
SUBSYSDS EQU   X'80'                    SUBSYSTEM INDICATOR      Y02076 15389602
D0       EQU   0                   ZERO                          Y02076 15389702
D1       EQU   1                   ONE                           Y02076 15389802
D2       EQU   2                   TWO                           Y02076 15389902
D3       EQU   3                   THREE                         Y02076 15419902
D4       EQU   4                   FOUR                          Y02076 15429902
D5       EQU   5                   FIVE                          Y02076 15439902
D6       EQU   6                   SIX                           Y02076 15449902
D7       EQU   7                   SEVEN                         Y02076 15459902
D8       EQU   8                   EIGHT                         Y02076 15469902
D9       EQU   9                   NINE                          Y02076 15473202
D16      EQU   16                  SIXTEEN                       YM5360 15475202
*                                                                       15476702
*********************************************************************** 15480018
*                                                                       15570018
         BALR  BASER,0                  ESTABLISH ADDRESSABILITY        15660018
         USING *,BASER                  ESTABLISH BASE REGISTER         15750018
         B     BEGIN               BRANCH AROUND EYE CATCHER     Y01909 15800000
         CNOP  0,8                 ALIGN TO A DBL WORD BOUNDARY  Y01909 15810000
         DC    CL8'IGC0G05B'       MODULE NAME                 @ZSUT222 15820037
         DC    CL8'&SYSDATE'       LAST DATE SHIPPED           @ZSUT222 15822037
         DC    CL8'@ZSUT222'       LAST CODE SHIPPED           @ZSUT222 15824037
BEGIN    EQU   *                                                 Y01909 15830000
*                                                                       15840018
         USING IHADCB,DCBR                                              15930018
         USING UCBOB,UCBR                                               16020018
         USING TIOENTRY,WRKR5                                           16200018
         USING DEBBASIC,DEBR                                     Y02076 16380002
         USING TCB,TCBR                                                 16430002
         USING TABL,CTABLR                                              16480002
         USING RSTWA,BUFR                                               16650018
*                                                                       16740018
         LR    BUFR,WRKR2               GET WORK AREA (RESTART) ADDR    16830018
*                                                                       16920018
         L     WRKR2,RSWAOFST           OFFSET TO REPI/O AREA           17010018
         LA    TABLR,0(WRKR2,BUFR)      POINT TO REPI/O AREA            17100018
*                                                                       17190018
         SR    DSCNTR,DSCNTR            INITIALIZE REGISTER             17280018
         L     TCBR,RSTCBAD             GET USER TCB                    17370018
*                                                                       17460018
         L     DEBR,RSINT               GET 1ST DEB ADDR         A28676 17550019
         LA    DEBR,D0(DEBR)            ADR ONLY                 Y02076 17560002
         MVC   RSPPM(8),NORMALXT        SET UP XCTL LIST         A26097 17590019
*                                                                       17640018
*********************************************************************** 17730018
*                                                                       17820018
*    THE FOLLOWING SECTION OF CODE WILL COMPUTE NO. OF DATA SETS IN USE 17910018
*                                                                       18000018
*********************************************************************** 18090018
*                                                                       18180018
REPDCB00 EQU   *                                                        18270018
*                                                                       18360018
         LA    DSCNTR,1(DSCNTR)         INCREMENT DEB COUNT BY ONE      18450018
         USING DEBPREFX,WRKR3                                    Y02076 18500002
         LR    WRKR3,DEBR               LOAD BASE REGISTER       Y02076 18590002
         SH    WRKR3,DEBPROFF           OFFSET BACK TO DEB PREF  Y02076 18600002
         CLI   DEBAMTYP,VS              VSAM DATA SET            Y02076 18610002
         BNE   REPDCBX0                 NO  NEXT DEB             Y02076 18620002
         BCTR  DSCNTR,D0                DONT COUNT VSAM DATA SET Y02076 18622002
REPDCBX0 EQU   *                        INSTR MUST FOLLOW        Y02076 18624002
         CLI   DEBAMTYP,IS              IS IT AN ISAM DEB      @ZA12948 18624237
         BNE   REPDCBY0                 NO - NEXT DEB          @ZA12948 18624437
         TM    DEBFLGS1,DEBCINDI        COMPT INTF PROCESSING  @ZA12948 18624637
         BNO   REPDCBY0                 NO - NEXT DEB          @ZA12948 18624837
         BCTR  DSCNTR,D0                DONT COUNT ISAM CI DEB @ZA12948 18625037
REPDCBY0 EQU   *                                               @ZA12948 18625237
         L     DEBR,DEBDEBAD            LINK TO NEXT POSSIBLE DED       18626002
         LA    DEBR,0(DEBR)             CLEAR HIGH ORDER BYTE           18630002
         LTR   DEBR,DEBR                WAS THERE ANOTHER DEB IN CHAIN  18720018
         BNZ   REPDCB00                 YES BRANCH TO COUNT DEB         18810018
         DROP  WRKR3                                             Y02076 18860002
*                                                                       18900018
*********************************************************************** 18990018
*                                                                       19080018
*    ALL DEBS HAVE BEEN COUNTED, AT THIS POINT COMPUTE AMOUNT OF SPACE  19170018
*    REQUIRED FOR THE DCB TABLE. EACH DCB ENTRY IS 48 BYTES LONG....    19260018
*                                                                       19350018
*********************************************************************** 19440018
*                                                                       19530018
         SR    WRKR3,WRKR3              ZERO OUT WRKR3                  19620018
         LA    WRKR4,TABENT             SIZE OF TABLE ENTRY             19710018
         MR    WRKR3,DSCNTR             CALCULATE TABLSIZE IN WRKR6     19800018
*                                                                       19890018
         L     WRKR2,RSDCBFLG           GET LEN. OF ENTIRE WORK AREA    19980018
         SH    WRKR2,SSCRLNGT           SUBTR SSCR LENGTH        Y02076 20030002
         ST    WRKR2,RSDCBFLG           SAVE FOR CLEARING        Y02076 20040002
         SR    WRKR2,WRKR4              BUFFER LEN. MINUS TABLE SIZE    20070018
         LA    UCBR,0(WRKR4,TABLR)      ADDRESS OF BUFFER AREA          20160018
*                                                                       20250018
*   THE BUFFER MUST BE ON A DOUBLE WORD BOUNDARY                        20340018
*                                                                       20430018
         LA    UCBR,4(UCBR)             ADD FOUR TO ADDRESS             20520018
         SRL   UCBR,3                   CLEAR RIGHTMOST 3 BITS          20610018
         SLL   UCBR,3                   RESTORE DOUBLE WORD BOUNDARY    20700018
         L     WRKR4,RSDCBFLG           SETUP PARM TO CLEAR CORE -SIZE  20790018
         LR    WRKR3,TABLR              SETUP PARM TO CLEAR CORE -ADDR  20880018
*                                                                       20970018
         BCTR  WRKR4,0                  REDUCE AMOUNT TO CLEAR BY ONE   21060018
         LA    WRKR5,255                LOAD MAX TO CLEAR PER ONE SHOT  21150018
*                                                                       21240018
COMPARE  CR    WRKR4,WRKR5              IS AMOUNT TO CLEAR GREATER 255  21330018
         BC    12,ONECLEAR              BR IF NOT GREATER TO 'ONECLEAR' 21420018
*                                                                       21510018
*   THE FOLLOWING IS PERFORMED EACH TIME AMOUNT LEFT TO BE CLEARED (IN  21600018
*   WRKR6 ) IS GREATER THAN 256 BYTES                                   21690018
*                                                                       21780018
         EX    WRKR5,CLEAR              CLEAR 256 BYTES VIA 'CLEAR'     21870018
         SR    WRKR4,WRKR5              SUB. 255 FROM AMOUNT TO BE CLRD 21960018
         BCTR  WRKR4,0                  SUB. ONE MORE BYTE              22050018
         LA    WRKR3,256(WRKR3)         BUMP ADDR COUNTER BY 256        22140018
         B     COMPARE                  CYCLE THRU ONCE MORE            22230018
*                                                                       22320018
CLEAR    XC    0(1,WRKR3),0(WRKR3)      THE ACTUAL CLEAR INSTRUCTION    22410018
*                                                                       22500018
ONECLEAR EX    WRKR4,CLEAR              CLEARS LESS THAN 256 BYTES      22590018
*                                                                       22680018
         L     WRKR6,RSTIOTAD           GET TASKS OLD TIOT              22770018
         LR    CTABLR,TABLR             INIT. CURR. ENTRY REG.          22860018
*                                                                       22950018
         ST    WRKR2,RSSSCR             SAVE LENGTH IN BUF SEG @ZA24633 23040037
*                                                                       23130018
*********************************************************************** 23220018
*                                                                       23310018
*    THIS IS THE TIOT THAT WAS IN USE AT CHKPT TIME AND IS PASSED BY    23400018
*    RESTART ROUTINES TO REPI/O. IT IS REQUIRED TO FIND THE DDNAMES     23490018
*    ASSOCIATED WITH THE OPENED DATA SETS AT RESTART TIME...........    23580018
*                                                                       23670018
*********************************************************************** 23760018
*                                                                       23850018
         L     TIOTR,TCBTIO             GET CURRENT TIOT FROM TCB       23900002
         LA    TIOTR,D0(TIOTR)          ADR ONLY                 Y02076 23950002
         L     DEBR,RSINT               GET 1ST DEB ADDR         A28676 24210019
         LA    DEBR,D0(DEBR)            ADR ONLY                 Y02076 24260002
*                                                                       24300018
*********************************************************************** 24390018
*                                                                       24480018
*        PLACE THE ADDRESS OF THE DCB IN THE DCB TABLE           YM7053 24530002
*        IN PREPARATION FOR THE JFCB READ                        YM7053 24580002
*                                                                       24750018
*********************************************************************** 24840018
*                                                                       24930018
REPDCB01 EQU   *                                                 YM7053 24980002
         LR    WRKR5,TIOTR              SAVE TIOT ADDRESS        YM7053 25030002
         MVC   TABDCBAD(3),DEBDCBAD+1   MOVE THIS DEB'S DCB ADDR A38124 25210020
*                                       TO TABLE ENTRY                  25310020
         ST    DEBR,TABVLID4            SAVE CURRENT DEB POINTER YM7053 25360002
*                                                                       25470018
REPDCBB1 EQU   *                        INSTR MUST FOLLOW        Y02076 25472002
         CLI   DEBNMSUB,TCAMID1         Q - TCAM DEB (1ST        M3408  25476020
*                                       CHANCE)                  M3408  25482020
         BE    REPDCB20                 YES, SET TCAM FLAGS      M3408  25488020
         CLI   DEBNMSUB,TCAMID2         Q - TCAM DEB (2ND        M3408  25494020
*                                       CHANCE)                  M3408  25500020
         BNE   REPDCB40                 NO, BYPASS SETTING FLAGS M3408  25506020
REPDCB20 EQU   *                                                 M3408  25512020
         OI    RSFLAG2,RSTCAM           SET MASTER TCAM          M3408  25518020
*                                       INDICATOR                M3408  25524020
         OI    TABFLG1,TABTCAM          SET TCAM TABLE ENTRY     M3408  25530002
*                                       FLAG                     M3408  25536020
REPDCB40 EQU   *                                                 M3408  25542020
         SR    WRKR2,WRKR2              INITIALIZE REGISTER             26640018
*                                                                       26910018
*********************************************************************** 27000018
*                                                                       27090018
*    THE TIOT OFFSETS WILL BE CORRECTED TO POINT TO THE NEW TIOT IN     27180018
*    THE NEXT SECTION OF CODE. IF A DDNAME CANNOT BE FOUND IN TIOT      27270018
*    THE REPI/O WILL RETURN TO RESTART WITH ERROR CODE.                 27360018
*                                                                       27450018
*********************************************************************** 27540018
*                                                                       27630018
REPDCB02 EQU   *                                                        27720018
*                                                                       27810018
         LA    WRKR3,TIOTBASE           OFFSET FOR FIRST DDNAME         27990018
         LA    WRKR5,0(WRKR3,WRKR5)     BYPASS BASIC SECTION OF TIOT    28080018
*                                                                       28170018
         L     DCBR,TABDCBAD-1          GET DCB TO PROCESS              28260018
         LH    WRKR4,DCBTIOT            GET OFFSET FOR DDNAME IN TIOT   28350018
         AR    WRKR4,WRKR6              POINT TO DDNAME IN OLD TIOT     28440018
         TM    TIOELINK-TIOENTRY(WRKR4),TIOESSDS WAS DS A        YM7399 28442002
*                                       SUBSYSTEM DS AT CHKPT    YM7399 28442402
*                                       TIME                     YM7399 28442802
         BZ    REPDCX15                 IF NOT, BRANCH           YM7399 28442902
         OI    TABFLG2,TABOSSDS         SET OLD-SUBSYSTEM FLAG   YM7399 28447902
REPDCX15 EQU   *                        NON-SUBSYSTEM ENTRY      YM7399 28449902
*                                                                       28455002
*                                                                       28460002
* IF A CONCATNATED DATA SET IS BEING PROCESSED THE POINTER IN           28465002
* THE OLD TIOT MUST POINT TO THE NON-BLANK DDNAME AND THE               28470002
* DISPLACEMENT SAVED. AFTER THE SEARCH IS SATISFIED THE                 28475002
* DISPLACEMENT WILL BE ADDED TO THE NEW TIOT DISPLACEMENT.              28480002
*                                                                       28485002
         LA    DEBR,D1                  ONE TO DEBR, REQUIRED IF YM7053 28490002
*                                       DDNAME NON BLANK         YM7053 28495002
         CLI   D4(WRKR4),BLANK          IS THIS DDNAME BLANK?    YM7053 28500002
         BNE   REPDCB03                 NO, CONTINUE PROCESSING  YM7053 28505002
         LA    WRKR6,TIOTBASE(WRKR6)    POINT TO 1ST DDNAME IN OLD TIOT 28510002
*                                                                       28515002
REPDCBX1 EQU   *                                                        28520002
*                                                                       28525002
         ST    WRKR6,20(CTABLR)         SAVE NON-BLANK DD ADDR   M3408  28530002
         SR    DEBR,DEBR                INIT DD ENTRY COUNTER    A33998 28535002
*                                                                       28540002
REPDCBX2 EQU   *                                                        28545002
*                                                                       28550002
         LA    DEBR,1(,DEBR)            BUMP DD ENTRY COUNTER    A33998 28555002
         CR    WRKR6,WRKR4              ARE POINTERS EQUAL              28560002
         BE    REPDCBX4                 BRANCH IF EQUAL                 28565002
         IC    WRKR2,0(WRKR6)           INSERT LENGTH                   28570002
         AR    WRKR6,WRKR2              INCREMENT TO NEXT POINTER       28575002
         CLI   4(WRKR6),BLANK           BLANK DDNAME                    28580002
         BE    REPDCBX2                 BRANCH IF YES                   28585002
         B     REPDCBX1                 CHECK NEXT ENTRY                28590002
*                                                                       28595002
REPDCBX4 EQU   *                                                        28600002
*                                                                       28605002
         L     WRKR4,20(CTABLR)         GET NON-BLANK DD ADDR    M3408  28610002
*                                                                       28615002
REPDCB03 EQU   *                                                        28620018
*                                                                       28710018
         CLC   4(8,WRKR4),TIOEDDNM      LOOK FOR DDNAME IN NEW TIOT     28800018
         BE    REPDCB04                 IF FOUND BRANCH                 28890018
*                                                                       28980018
         IC    WRKR2,TIOELNGH           GET CURRENT ENTRY LNGH IN TIOT  29070018
         AR    WRKR5,WRKR2              INCREMENT TO NEXT DDNAME        29160018
         AR    WRKR3,WRKR2              INCREMENT OFFSET BEING GENRTED  29250018
*                                                                       29340018
         CLI   TIOELNGH,NODDENT         DOES ANOTHER DD ENTRY EXIST     29430018
         BNE   REPDCB03                 YES BRANCH TO LOOK AT NAME      29520018
*                                                                       29610018
*********************************************************************** 29700018
*                                                                       29790018
*    DDNAME MISSING FROM NEW TIOT - CANNOT RESTART PROPERLY             29880018
*                                                                       29970018
*********************************************************************** 30060018
*                                                                       30150018
         MVI   RSRETCOD+1,ERR033        MISSING DD CARD ERROR  @ZSUT222 30240037
         B     REPDCBER                 BRANCH TO ERROR EXIT            30330018
*                                                                       30420018
REPDCB04 EQU   *                                                        30510018
*                                                                       30600018
         MVC   TABTPLBL(2),DCBTIOT      SAVE OLD OFFSET IN TABTPLBL     30690018
         B     REPDC04B                                          A33998 30700020
REPDC04A EQU   *                                                 A33998 30710020
         IC    WRKR2,TIOELNGH           GET THIS ENTRY'S LNGTH   A33998 30720020
         AR    WRKR5,WRKR2              POINT TO NEXT ENTRY      A33998 30730020
         AR    WRKR3,WRKR2              UPDATE ENTRY OFFSET      A33998 30740020
REPDC04B EQU   *                                                 A33998 30750020
         BCT   DEBR,REPDC04A            LOOP BACK TO PROCESS     A33998 30760020
*                                       CONCAT. ENTRIES          A33998 30770020
         STH   WRKR3,DCBTIOT            SAVE NEW OFFSET IN DCB          30780018
         MVC   TABJFCB(3),TIOEJFCB      SAVE JFCB(S) TTR IN TABLE       30870018
**********************************************************************  30920002
*                                                                    *  30930002
*              RESOLVE ALL DSAB POINTER ADDRESSES IN ALL DEB         *  30940002
*              EXTENTIONS AND THE SSOB'S FOR SUBSYSTEM DATA SETS     *  30950002
*              DUE TO RELOCATION AT RESTART TIME.   THE SUBSYSTEM    *  30952002
*              INDICATOR IN THE 48 BYTE OPEN DATA SET ENTRIES WILL   *  30954002
*              BE SET FOR ALL SYSIN/SYSOUT DATA SETS.                *  30956002
*                                                                    *  30958002
**********************************************************************  30958402
         AR    WRKR3,TIOTR              CALC ABS DD ENTRY OFFSET Y02076 30958802
         L     WRKR4,TCBJSCB            ADDRESSABILITY FOR JSCB  Y02076 30959202
         USING IEZJSCB,WRKR4                                     Y02076 30959602
         L     WRKR4,JSCDSABQ           ADDRESSABILITY FOR QDB   Y02076 30959702
         USING QDB,WRKR4                                         Y02076 30959802
         L     WRKR4,QDBFELMP           ADDRESSABILITY FOR DSAB  Y02076 30959902
         USING DSAB,WRKR4                                        Y02076 30973202
REPDC04C EQU   *                        INSTR MUST FOLLOW        Y02076 30975202
         CLM   WRKR3,D7,DSABTIOT+D1     CORRECT DSAB             Y02076 30983202
         BE    REPDC04E                 YES  DO DEB WORK         Y02076 30985202
         CLC   DSABFCHN+D1(D3),DSABCHNE END OF DSAB CHAIN        Y02076 30985602
         BE    REPDC04D                 YES ERROR DSAB NOT FOUND Y02076 30986002
         L     WRKR4,DSABFCHN           STEP TO NEXT DSAB ADDRESSY02076 30986402
         B     REPDC04C                 TEST NEXT DSAB           Y02076 30986502
REPDC04D EQU   *                        INSTR MUST FOLLOW        Y02076 30988102
         MVI   RSRETCOD+D1,ERR099       NO DSAB FOUND ERROR    @ZSUT222 30992037
         B     REPDCBER                 BRANCH TO ERROR EXIT     Y02076 30993602
REPDC04E EQU   *                        INSTR MUST FOLLOW        Y02076 30995102
         L     WRKR5,TABVLID4           ADDRESSABILITY FOR DEB   YM7053 30995202
         LA    WRKR5,D0(WRKR5)          ADR ONLY                 Y02076 30995902
         SH    WRKR5,DEBPROFF           OFFSET BACK TO DEB PREFIXY02076 30996802
         USING DEBPREFX,WRKR5                                    Y02076 30998402
         L     WRKR5,DEBXTNP            ADDRESSABILITY FOR DEB EXY02076 31000002
         USING DEBXTN,WRKR5                                      Y02076 31009102
         STCM  WRKR4,D7,DEBXDSAB+D1     STORE CORRECT DSAB ADR   Y02076 31019102
         LR    WRKR5,WRKR4              SAVE DSAB ADR            Y02076 31019502
         LH    WRKR4,DCBTIOT            ADDRESSABILITY FOR TIOT DY02076 31021102
         AR    WRKR4,TIOTR              ADR IN TIOT              Y02076 31021202
         USING TIOENTRY,WRKR4                                    Y02076 31021602
         TM    TIOELINK,TIOESSDS        IS IT A SUBSYS DATA SET  YM7399 31021902
         BZ    REPDCBC1                 TEST FOR CHKPT DATA SET  Y02076 31022302
         OI    TABFLG1,TABSYS           IND SUB SYS DATA SET     Y02076 31022402
**********************************************************************  31022702
*                                                                    *  31027202
*              UPDATE SUBSYSTEM SSOB/SSIB                            *  31029202
*                                                                    *  31031202
**********************************************************************  31031602
         L     DEBR,TABVLID4            SET UP DEB ADDRESSABILITYYM7053 31031702
         LA    DEBR,D0(DEBR)            ADR ONLY                 Y02076 31033702
         L     WRKR6,DEBECBAD           GET ADR OF DCB SINCE     YM5313 31035702
         USING IHADCB,WRKR6               DEBDCBAD PTS TO ACB    YM5313 31037702
         STCM  DEBR,D7,DCBDEBAD+D1      DEB ADR INTO DCB         YM5313 31037802
         L     DCBR,TABDCBAD-D1         GET ACB ADDRESS          YM7337 31039302
         MVC   DCBTIOT,DCBTIOT-IHADCB(DCBR) UPDATE TIOT OFFSET   YM7337 31041302
         DROP  WRKR6                                             YM5313 31042002
         SR    WRKR4,WRKR4                                       Y02076 31043502
         LA    WRKR4,DEBBASND           GET END BASIC SECT       Y02076 31045002
         LA    WRKR4,D4(WRKR4)          ADR START OF SSIB        Y02076 31046502
         ST    WRKR4,RSERAS00           SAVE SSIB ADR            Y02076 31048002
         USING SSIB,WRKR4                                        Y02076 31049502
         AH    WRKR4,SSIBLEN            POINT TO SSOB            Y02076 31051002
         DROP  WRKR4                                             Y02076 31052502
         USING SSOB,WRKR4                                        Y02076 31054002
         LH    WRKR6,SSOBLEN            SSOB LENGTH=FUN SEC SSOB Y02076 31055502
         AR    WRKR6,WRKR4              BEGINNING ADDRESS        Y02076 31057002
         STCM  WRKR6,D7,SSOBINDV+D1                              Y02076 31058502
         L     WRKR6,RSERAS00           GET ADR OF SSIB          Y02076 31060002
         STCM  WRKR6,D7,SSOBSSIB+D1     SSIB STORE IT IN SSOBSSIBY02076 31070702
         USING DSAB,WRKR5                                        Y02076 31072702
         USING SSIB,WRKR6                                        Y02076 31074702
         MVC   SSIBSSNM(D4),DSABSSNM    SUB SYSTEM NAME TO SSIB  Y02076 31076702
         L     WRKR4,SSOBINDV                                    Y02076 31079102
         USING SSDABGN,WRKR4                                     Y02076 31079502
         STCM  DEBR,D7,SSDADEBP+D1      ADDRESS OF DEB TO SSOB   Y02076 31079902
         MVC   SSDASSCM(D4),DSABSSCM    SDB PTR INTO SSOB EXT.   YM5360 31089902
         DROP  WRKR5                                             YM5360 31091902
         L     WRKR5,TABJFCB-D1         GET JFCB ADDRESS         YM5360 31093902
         LA    WRKR5,D16(,WRKR5)        POSITION OVER SWA PREFIX YM5360 31095902
         ST    WRKR5,SSDAJFCB           STORE IN SSOB EXT.       YM5360 31097902
*********************************************************************** 31098402
*              FOR ALL SECURE CHECKPOINT DATA SET'S AT RESTART TIME   * 31100402
*              UPDATE THE REAL USER'S DCB WITH THE NEW DEB ADDRESS    * 31102402
*              AND TIOT OFFSET.  IF THE RESTART DATA SET IS FOUND     * 31102802
*              INDICATE SUCH IN ITS 48 BYTE ENTRY.                    * 31103202
*********************************************************************** 31103602
REPDCBC1 EQU   *                        INSTR MUST FOLLOW        Y02076 31103702
         L     DCBR,TABDCBAD-D1         CURRENT DCB ADR          Y02076 31104002
         L     DEBR,TABVLID4            CURRENT DEB ADR          YM7053 31104102
         LA    DEBR,D0(DEBR)            ADR ONLY                 Y02076 31104502
         LR    WRKR4,DEBR                                        Y02076 31106102
         SH    WRKR4,DEBPROFF           ADR DEB PREFIX           Y02076 31108102
         USING DEBPREFX,WRKR4                                    Y02076 31108202
         L     WRKR4,DEBXTNP            DEB EXTENTION ADR        Y02076 31108502
         USING DEBXTN,WRKR4                                      Y02076 31108902
         L     WRKR4,DEBXDSAB           DSAB ADDRESS TO BASE REG Y02076 31110502
         USING DSAB,WRKR4                                        Y02076 31112502
         TM    DSABFLG4,DSABCKDS        CHECK POINT DATA SET     Y02076 31112902
         BNO   REPDC04F                 NO  NEXT DCB             Y02076 31113502
         CLC   TABDCBAD(D3),RSCKDCB+D1        RS CK PT DATA SET  Y02076 31113902
         BNE   REPDCB4X                 NO TEST SECURITY FLAG    Y02076 31114702
         OI    TABFLG2,TABRSDS          INDICATE RESTART DATA ST Y02076 31114802
REPDCB4X EQU   *                        INSTR MUST FOLLOW        Y02076 31116102
         TM    DSABFLG4,DSABCKSI        SEC INTERFACE IN EFFECT  Y02076 31118102
         BNO   REPDC04F                 IF NOT, BRANCH           YM7337 31118502
         DROP  DCBR                                              YM5313 31118602
         USING IHADCB,WRKR2                                      Y02076 31118702
         L     WRKR2,TABDCBAD-D1        PROTECTED DCB ADR        Y02076 31118802
         AH    WRKR2,USCKPDSA           USERS REAL DCB ADR       Y02076 31120702
         L     WRKR2,D0(WRKR2)          DCB ADR                  Y02076 31122702
         STCM  DEBR,D7,DCBDEBAD+D1      STORE CURRENT DEB ADR    YM5313 31123102
         MVC   DCBTIOT,DCBTIOT-IHADCB(DCBR) UPDATE TIOT OFFSET   YM7337 31123202
         SR    WRKR2,WRKR2                                       Y02076 31123502
REPDC04F EQU   *                        NEXT DCB                 YM7337 31125902
         L     WRKR6,RSTIOTAD           GET TASKS OLD TIOT              31128402
         USING DEBPREFX,WRKR3                                    Y02076 31130702
         LR    WRKR3,DEBR               LOAD BASE REGISTER       Y02076 31131502
         SH    WRKR3,DEBPROFF           OFFSET BACK TO DEB PREFIXY02076 31131902
         CLI   DEBAMTYP,VS              VSAM DATA SET            Y02076 31132002
         BNE   REPDCBA1                 NEXT DEB & TABL ENT      YM7053 31132102
         XC    TABDSORG(TABENT),TABDSORG  ZERO OUT VSAM ENTRY    YM7053 31150002
         B     REPDCB4A                 GO GET NEXT DEB          YM7053 31154002
REPDCBA1 EQU   *                        INSTR MUST FOLLOW        Y02076 31156502
         CLI   DEBAMTYP,IS              IS IT ISAM             @ZA12948 31157537
         BNE   REPDCBA5                 NO -NEXT ENTRY         @ZA12948 31158537
         TM    DEBFLGS1,DEBCINDI        ISAM CI PROCESSING     @ZA12948 31159537
         BNO   REPDCBA5                 NO - NEXT ENTRY        @ZA12948 31160537
         XC    TABDSORG(TABENT),TABDSORG XERO ISAM CI ENTRY    @ZA12948 31161537
         B     REPDCB4A                 PROCESS NEXT DEB       @ZA12948 31162537
REPDCBA5 EQU   *                                               @ZA12948 31163537
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TO NXT NTRY    Y02076 31166502
REPDCB4A L     DEBR,DEBDEBAD            GET NEXT POSSIBLE DEB ADDR      31176502
         LA    DEBR,D0(DEBR)            ADR ONLY                 Y02076 31178502
         LTR   DEBR,DEBR                IS IT END OF DEB CHAIN   Y02076 31180502
         BNZ   REPDCB01                 BRANCH IF NO             YM7053 31180902
         DROP  WRKR2,WRKR4,WRKR6                                 Y02076 31181202
*                                                                       31205602
*********************************************************************** 31230018
*                                                                       31320018
*    ALL OPENED DATA SETS HAVE BEEN LOCATED WITHIN NEW TIOT             31410018
*                                                                       31500018
*    THE NEXT SECTION OF CODE WILL ESTABLISH THE WORK AREA WITHIN THE   31590018
*    USERS BUFFER THAT WILL BE USED TO PROCESS JFCB(S)                  31680018
*                                                                       31770018
*    REGISTERS STILL IN USE AT THIS TIME ARE -                          31860018
*    TCBR,BUFR,TIOTR,TABLR,DSCNTR,AND BASER. ALL OTHERS MAY BE RESET    31950018
*                                                                       32040018
*********************************************************************** 32130018
*                                                                       32220018
         SR    WRKR5,WRKR5              INITIALIZE REGISTER             32310018
*                                                                       32400018
         L     WRKR6,RSSSCR             GET LENGTH OF BUFFER   @ZA24633 32490037
         ST    WRKR5,RSSSCR             ZERO SSCR FIELD        @ZA24633 32520037
         LA    WRKR3,BUFSEG             SIZE OF A BUFFER SEGMENT        32580018
         LR    CTABLR,TABLR             INIT. CURR. ENTRY REG.          32670018
*                                                                       32760018
         DR    WRKR5,WRKR3              COMPUTE NO. SEGMENTS IN BUFFER  32850018
*                                                                       32940018
*********************************************************************** 33030018
*                                                                       33120018
*    AT THIS POINT WRKR6 HAS NUMBER OF BUFFER SEGMENTS AVAILABLE TO     33210018
*    OVERLAP I/O WITH, WRKR5 HAS REMAINDER OF BUFFER THAT CANT BE USED  33300018
*                                                                       33390018
*********************************************************************** 33480018
*                                                                       33570018
         LR    WRKR1,DSCNTR             TOTAL NO. DATA SETS TO PROCESS  33660018
         LR    WRKR2,WRKR6              NO. SEGMENTS AVAILABLE TO USE   33750018
*                                                                       33840018
REPDCB05 EQU   *                                                        33930018
*                                                                       34020018
         LR    WRKR4,UCBR               INITIALIZE BEGINNING OF BUFFER  34110018
*                                                                       34200018
REPDCB06 EQU   *                                                        34290018
*                                                                       34380018
         ST    WRKR4,0(,WRKR4)          DUMP AND MOVE SEGMENT    M3408  34440020
         MVC   TABSEGAD(3),1(WRKR4)     ADDR TO PRESERVE TABFLG1 M3408  34500020
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TO NEXT ENTRY         34560018
*                                                                       34650018
         BCT   WRKR1,REPDCB07           PROCESS ALL DATA SETS           34740018
*                                                                       34830018
*    THIS RTN WILL FLAG THE LAST TABL ENTRY WITH A X'08' IN TABFLG1   * 34920018
*                                                                       35010018
         LA    WRKR2,TABENT                                             35100018
         SR    CTABLR,WRKR2                                             35190018
         OI    TABFLG1,TABLAST          FLAG LAST ENTRY                 35280002
         LR    WRKR3,WRKR6              LOAD NO. OF SEGMENTS     M34083 35310020
*                                       INTO WRKR                M3408  35340020
         B     REPDCBEX                 FINISH PROCESSING        M3408  35400020
*                                                                       35460018
REPDCB07 EQU   *                                                        35550018
*                                                                       35640018
         LA    WRKR4,0(WRKR4,WRKR3)     INCREMENT TO NEXT SEGMENT       35730018
         BCT   WRKR2,REPDCB06           BUFFER SEGMENT AVAILABLE BRANCH 35820018
*                                                                       35910018
         LR    WRKR2,WRKR6              INITIALIZES NO. BUFFER SEGMENTS 36000018
         B     REPDCB05                 CONTINUE TO SET UP TABLE        36090018
*                                                                       36180018
REPDCBER EQU   *                                                        63180018
*                                                                       63270018
         MVC   RSPPM+4(2),ERREXIT       SET RESTART EXIT LOAD ID M3408  63370020
         MVC   RSREGSAV(8),MODID        SAVE NAME OF MOD. THAT @ZSUT222 63420037
*                                       DETECTED THE ERROR     @ZSUT222 63450037
         STM   0,15,RSREGSAV+8          SAVE CURRENT REGISTERS @ZSUT222 63520037
*                                                                       64080018
REPDCBEX EQU   *                                                        64170018
*                                                                       64260018
         LA    WRKR6,RSPPM+8            SET UP FOR XCTL          A26097 64310019
         LR    WRKR2,BUFR               POINT REG 1 TO THE RESTART W/A  64390018
*                                                                       64440018
*********************************************************************** 64530018
*                                                                       64620018
         XCTL  EPLOC=RSPPM,SF=(E,(15))                           A26097 64820019
*                                                                       65070018
*********************************************************************   65160018
*                                                                       65250018
*     CONSTANTS USED IN REPI/O                                          65340018
*                                                                       65430018
NORMALXT DC    C'IGC0G95B'              TABLE COMPLETION LOAD ID M3408  65530020
MODID    DC    CL8'IGC0G05B'            MODULE ID              @ZSUT222 65580037
ERREXIT  DC    C'V0'                    RESTART EXIT LOAD ID     M3408  65630020
SSCRLNGT DC    H'4096'                  SSCR BUFR LNGTH          Y02076 65632002
DEBPROFF DC    H'16'                    OFFSET FOR DEB PREFIX    Y02076 65640002
USCKPDSA DC    H'-4'                    OFFSET FOR USER CKP D SETY02076 65650002
DSABCHNE DC    X'000000'                DSAB END OF CHAIN MASK   Y02076 65670002
*                                                                     * 65680000
*        MAINTENANCE SPACE                                       Y01909 65730000
*                                                                     * 65780000
PATCH    DC    XL((*-IGC0G05B)/20)'00'   FIVE PERCENT SPACE      Y01909 65830000
*                                                                     * 65880000
         EJECT                                                          66690018
         IEZJSCB                                                        66740002
         EJECT                                                          66790002
         IEEVRSWA VER=3                 USE AOS2 VERSION OF WA          66830000
         EJECT                                                          66870018
RSDSECT  DSECT                                                          66960018
*                                                                       67050018
*    DATA EXTENT BLOCK                                                  67140018
*                                                                       67230018
RSDEB    DS    0CL48                                                    67320018
RSDEBTCB DC    X'00000000'              TCB ADDRESS                     67410018
RSDEBDEB DC    X'00000000'              DEB ADDRESS                     67500018
*                                                                       67590018
*    DATA CONTROL BLOCK                                                 67680018
*                                                                       67770018
RSDEBOFL DS    0CL1                                                     67860018
RSDEBIRB DC    X'00000000'              IRB ADDRESS                     67950018
RSDEBSYS DC    X'00000000'              1ST IOB ADDR IN SYS.PURGE CHAIN 68040018
RSDEBUSR DC    X'00000000'              1ST IOB ADDR IN USER PRGE CHAIN 68130018
RSDEBECB DC    X'00000000'              PARM.LIST ADDR TO PURGE ECB     68220018
RSDEBID  DS    0CL1                                                     68310018
RSDEBDCB DC    AL4(RSDCBREP)            DCB ADDR                        68400018
RSDEBAPP DS    CL4                      I/O APPENDAGE VECTOR TABLE      68490018
RSDEBMOD DS    0CL1                                                     68580018
RSDEBUCB DS    F                        UCB ADDRESS                     68670018
RSDEBBIN DS    H                        BIN NUMBER                      68760018
RSDEBSCC DS    H                        CYLINDER START ADDRESS          68850018
RSDEBSHH DS    H                        TRACK START ADDRESS             68940018
RSDEBECC DS    H                        CYLINDER END ADDRESS            69030018
RSDEBEHH DS    H                        TRACK END ADDRESS               69120018
RSDEBNTR DS    H                        NO. OF TRACKS IN THIS EXTENT    69210018
*                                                                       69300018
*    EVENT CONTROL BLOCK                                                69390018
*                                                                       69480018
RSECBAD  DS    CL4                      ECB ADDRESS                     69570018
RSDCBDEB DC    AL4(RSDEB)               DEB ADDRESS                     69660018
*                                                                       69750018
RSDCBREP EQU   RSDEB+8                  POINT TO RELATIVE BEGINNING DCB 69840018
*                                                                       69930018
*    INPUT OUTPUT BLOCK                                                 70020018
*                                                                       70110018
RSIOB    DS    0CL40                                                    70200018
RSIOBFG1 DC    X'00'                    I/O FLAGS BYTE 1                70290018
RSIOBFG2 DC    X'00'                    I/O FLAGS BYTE 2                70380018
RSIOBSN1 DS    CL1                      FIRST SENSE BYTE                70470018
RSIOBSN2 DS    CL1                      SECOND SENSE BYTE               70560018
RSIOBECB DC    AL4(RSECBAD)             ECB ADDRESS                     70650018
RSIOBCSW DS    D                        LAST CSW                        70740018
RSIOBCPA DS    AL4(RSCCW1)              CHANNEL PROGRAM ADDRESS         70830018
RSIOBDCB DS    AL4(RSDCBREP)            DCB ADDRESS                     70920018
RSIOBRCP DS    CL4                      RESTART ADDRESS FOR IOS         71010018
RSIOBINC DS    H                        INCREMENT BLOCK COUNT           71100018
RSIOBECT DS    H                        NO. OF ERROR ENTRIES            71190018
RSIOBDAD DS    D                        SEEK ADDRESS FOR DA             71280018
*                                                                       71370018
*    CHANNEL PROGRAM                                                    71460018
*                                                                       71550018
RSCCWLST DS    0CL24                                                    71640018
RSCCW1   DS    D                        CCW1                            71730018
RSCCW2   DS    D                        CCW2                            71820018
RSCCW3   DS    D                        CCW3                            71910018
*                                                                       72000018
*    BUFFER SEGMENT FOR EXTERNAL BLOCKS                                 72090018
*                                                                       72180018
RSBUFSEG DS    0CL176                                                   72270018
RSJFCB   EQU   RSBUFSEG                                                 72360018
*                                                                       72450018
*********************************************************************** 72540018
*                                                                       72630018
*                  JFCB                                                 72720018
*                                                                       72810018
*********************************************************************** 72900018
*                                                                       72990018
JFCBDSNM DS    CL44                         DATA SET NAME               73080018
JFCBELNM DS    CL8                          ELEMENT NAME OR VERSION     73170018
JFCBTSDM DS    CL1                          TASK SCHEDULER - DATA       73260018
*                                            MANAGEMENT INTERFACE BYTE  73350018
JFCBSYSC DS    CL13                         SYSTEM CODE                 73440018
JFCBLTYP DS    CL1                          LABEL TYPE AND USER'S-LABEL 73530018
*                                            INDICATOR                  73620018
         DS    CL1                          NOT USED                    73710018
JFCBFLSQ DS    CL2                          FILE SEQUENCE NUMBER        73800018
JFCBVLSQ DS    CL2                          VOLUME SEQUENCE NUMBER      73890018
JFCBMASK DS    CL8                          DATA MANAGEMENT MASK        73980018
JFCBCRDT DS    CL3                          DATA SET CREATION DATE      74070018
JFCBXPDT DS    CL3                          DATA SET EXPIRATION DATE    74160018
JFCBIND1 DS    CL1                          INDICATOR BYTE 1            74250018
JFCBRLSE EQU   64                            BITS 0 AND 1 - EXTERNAL    74340018
*                                            STORAGE RELEASE INDICATOR  74430018
JFCBLOCT EQU   16                            BITS 2 AND 3 - DATA SET    74520018
*                                            HAS BEEN LOCATED           74610018
JFCBNEWV EQU   4                             BITS 4 AND 5 - NEW VOLUME  74700018
*                                            ADDED TO DATA SET          74790018
JFCBPMEM EQU   1                             BITS 6 AND 7 - DATA SET IS 74880018
*                                            A MEMBER OF A PODS OR GDG  74970018
JFCBIND2 DS    CL1                          INDICATOR BYTE 2            75060018
JFCBSTAT EQU   64                            BITS 0 AND 1 - DATA SET    75150018
*                                            STATUS (NEW, OLD, OR MOD)  75240018
JFCBSCTY EQU   16                            BITS 2 AND 3 - DATA SET    75330018
*                                            SECURITY INDICATOR         75420018
JFCBUFNO DS    0AL1                                                     75510018
JFCBUFRQ DS    AL1                      BUFFER REQUESTED                75600018
JFCBFTEK DS    0BL1                                                     75690018
JFCBFALN DS    BL1                      BUFFER ALIGNMENT                75780018
JFCBUFL  DS    AL2                      BUFFER LENGTH                   75870018
JFCEROPT DS    BL1                      ERROR ROUTINE                   75960018
JFCTRTCH DS    0BL1                                                     76050018
JFCKEYLE DS    0AL1                                                     76140018
JFCMODE  DS    0BL1                                                     76230018
JFCCODE  DS    0BL1                                                     76320018
JFCSTACK DS    0BL1                                                     76410018
JFCPRTSP DS    BL1                      PRINTER SPACING                 76500018
JFCDEN   DS    BL1                      TAPE DENSITY                    76590018
JFCLIMCT DS    AL3                      NO. OF TRKS.TO BE SEARCHED      76680018
JFCDSORG DS    BL2                      DATA SET ORGANIZATION           76770018
JFCRECFM DS    BL1                      RECORD FORMAT                   76860018
JFCOPTCD DS    BL1                      OPTION CODES                    76950018
JFCBLKSI DS    AL2                      BLOCK SIZE                      77040018
JFCLRECL DS    AL2                      LOGICAL RECORD LENGTH           77130018
JFCNCP   DS    AL1                      NO. OF CHANNEL PROGRAM          77220018
JFCNTM   DS    AL1                      NO. OF TRKS. FOR MASTER INDEX   77310018
JFCRKP   DS    AL2                      RELATIVE POSITION OF KEY        77400018
JFCCYLOF DS    AL1                      NO. OF TRKS FOR OVERFLOW        77490018
JFCDBUFN DS    AL1                      RESERVED                        77580018
JFCINTVL DS    AL1                      INTENTIONAL INTERVAL            77670018
JFCCPRI  DS    BL1                      PRIORITY                        77760018
JFCSOWA  DS    AL2                      SIZE OF WORKAREA                77850018
JFCBNTCS DS    CL1                          NUMBER OF OVERFLOW TRACKS   77940018
JFCBNVOL DS    CL1                          NUMBER OF VOLUME SERIAL     78030018
*                                            NUMBERS                    78120018
JFCBVOLS DS    CL30                         VOLUME SERIAL NUMBERS (THE  78210018
*                                            FIRST FIVE)                78300018
JFCBEXTL DS    CL1                          LENGTH OF BLOCK OF EXTRA    78390018
*                                            VOLUME SERIAL NUMBERS      78480018
*                                            (BEYOND FIVE)              78570018
JFCBEXAD DS    CL3                          TRACK ADDRESS OF BLOCK OF   78660018
*                                            EXTRA VOL SERIAL NUMBERS   78750018
JFCBPQTY DS    CL3                          PRIMARY QUANTITY OF D.A.    78840018
*                                            STORAGE REQUIRED           78930018
JFCBCTRI DS    CL1                          INDICATES WHETHER CYLINDERS 79020018
*                                            TRACKS, OR RECORDS ARE     79110018
*                                            SPECIFIED IN JFCBPQTY AND  79200018
*                                            JFCBSQTY                   79290018
JFCBSQTY DS    CL3                          SECONDARY QUANTITY OF D.A.  79380018
*                                            STORAGE REQUIRED           79470018
JFCBIND3 DS    CL1                          INDICATOR BYTE 3            79560018
JFCBCNTG EQU   64                            BITS 0 AND 1 - CONTIGUOUS  79650018
*                                            STORAGE INDICATOR          79740018
JFCBMXIG EQU   16                            BITS 2 AND 3 - MAXIMUM     79830018
*                                            AVAILABLE EXTENT INDICATOR 79920018
JFCBALXI EQU   4                             BITS 4 AND 5 - ALL EXTENTS 80010018
*                                            INDICATOR                  80100018
JFCBRNDC EQU   1                             BITS 6 AND 7 - ROUND       80190018
*                                            CYLINDER INDICATOR         80280018
JFCBDQTY DS    CL3                          QUANTITY OF D.A. STORAGE    80370018
*                                            REQUIRED FOR A DIRECTORY   80460018
JFCBSPNM DS    CL3                          CORE ADDRESS OF THE JFCB    80550018
*                                            WITH WHICH CYLINDERS ARE   80640018
*                                            SPLIT                      80730018
JFCBABST DS    CL2                          RELATIVE ADDRESS OF FIRST   80820018
*                                            TRACK TO BE ALLOCATED      80910018
JFCBSBNM DS    CL3                          CORE ADDRESS OF THE JFCB    81000018
*                                            FROM WHICH SPACE IS TO BE  81090018
*                                            SUBALLOCATED               81180018
JFCBDRLH DS    CL3                          AVERAGE DATA RECORD LENGTH  81270018
JFCBVLCT DS    CL1                          VOLUME COUNT                81360018
JFCBSPTN DS    CL1                          NUMBER OF TRACKS PER        81450018
*                                            CYLINDER TO BE USED BY     81540018
*                                            THIS DATA SET WHEN SPLIT   81630018
*                                            CYLINDER IS INDICATED      81720018
JFCBLGTH EQU   176                          LENGTH OF JFCB              81810018
JFCBEND  EQU   *                                                        81900018
*                                                                       81990018
         ORG   RSBUFSEG+176             ORG BACK TO BUFFER SEGMENT      82080018
RSSTATUS DS    0CL8                                                     82170018
RSSTAT1  DS    CL1                      STATUS BYTE 1                   82260018
RSSTAT2  DS    CL1                      STATUS BYTE 2                   82350018
RSSTAT3  DS    CL1                      STATUS BYTE 3                   82440018
RSSTAT4  DS    CL1                      STATUS BYTE 4                   82530018
         DS    F                        RESERVED FOR FUTURE USE         82620018
         EJECT                                                          82710018
CVT      DSECT                                                          82800018
         CVT                                                            82890018
         EJECT                                                          82900002
         IHAQDB                                                  Y02076 82940002
         EJECT                                                          82980018
*                                                                       83070018
*                                                                       83160018
*   TASK CONTROL BLOCK                                                  83250018
*                                                                       83300002
*                                                                       83350002
         IKJTCB                                                  Y02076 83400002
         EJECT                                                          85410018
         DCBD  DSORG=PS                                                 85500018
         EJECT                                                          85590018
         IEZDEB                                                  Y02076 86090002
         EJECT                                                          86100002
         IHADSAB                                                 Y02076 86140002
         EJECT                                                          86150002
         IEFJSSOB (DA),CONTIG=YES                                Y02076 86190002
         EJECT                                                          86200002
         IEFJSSIB                                                Y02076 86240002
         EJECT                                                          89190018
         IHJDSTAB                                                Y02076 89240002
         EJECT                                                          92880018
TIOT     DSECT                                                          92970018
         IEFTIOT1                                                       93060018
         EJECT                                                          93150018
SRT      DSECT                                                          93240018
         IEFUCBOB                                                       93330018
*                                                                       93420018
*                                                                       93510018
*                                                                       93600018
         END                                                            93690018
./  ADD  SSI=81150446,NAME=IGC0G95B
         TITLE 'IGC0G95B JFCB PROCESSOR - TABLE BUILD MODULE'           00080020
IGC0G95B CSECT                                                          00160020
*                                                                       00240020
*                                                                       00320020
*          RELEASE 23 DELETIONS/CHANGES                                 00400020
*          RELEASE 22 DELETIONS/CHANGES                                 00480020
*          RELEASE 21 DELETIONS/CHANGES                                 00560020
*0000                                                            S21940 00562000
*1066390600-391500                                               M0187  00570021
*1066526500,546300,621100-621200                                 A43757 00580021
*1066581400-584100,591300-592200                                 A41442 00600021
*          RELEASE 20 DELETIONS/CHANGES                                 00640020
*0000                                                            A33701 00680020
*          VS2-RELEASE3 CHANGES/ADDITIONS                               00690000
*559800-559900                                                 @ZA02507 00700000
* APAR OZ31484 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 00710037
*C148460,630000,634700,639600,666160                           @ZSUT222 00712037
*A639630-639660,657500                                         @ZSUT222 00714037
*                                                                M3408  00720020
*                                                                       00800020
* STATUS CHANGE LEVEL 002                                               00880021
*                                                                       00960020
*THIS MODULES IS A SPLIT OF IGC0G05B IN RELEASE 20.1                    01040020
*                                                                       01120020
*                                                                       01260020
*TITLE -       TABLE BUILD MODULE                                       01350020
*                                                                       01440020
*STATUS -      INITIAL CODE                                             01530020
*                                                                       01620020
*FUNCTION -    THIS MODULE IS THE SECOND HALF OF A SPLIT OF MODULE      01720020
*              IGC0G05B MADE FOR RELEASE 20.                            01820020
*                                                                       01920020
*              THE JFCB ASSOCIATED WITH EACH DATA SET IS READ INTO      01970002
*              THE I/O BUFFER PROVIDED FOR EACH 48 BYTE ENTRY. JFCB     02020002
*              INFORMATION ABOUT THE DATA SET IS USED AS A BASIS        02070002
*              FOR FILLING OUT THE TABLE ENTRY. SOME INFO ABOUT THE     02120002
*              DATA SET WHICH IS PLACED IN THE TABLE ENTRY CONSISTS     02170002
*              OF: DCB ADR,DEVICE TYPE,DATA SET ORGN,NUMBER OF          02220002
*              VOLUMES,LABEL INFO,FILE SEQ NUMBER. AN INDICATOR IS SET  02270002
*              IN THE TABLE ENTRY TO FLAG AN ISAM/VSAM CI DATA SET.     02320002
*              AN INDICATOR IS ALSO SET WHEN A VAM DATA SET IS          02370002
*              ENCOUNTERED SO THAT AN ENTRY WILL BE MADE TO MODULE      02470002
*              IGC0M05B TO PROCESS IT.                                  02520002
*                                                                       02880020
*              FOR DATA SETS OTHER THAN IS OR DA THE VOLUME SERIAL NO.  02970020
*              OF THE VOLUME TO BE MOUNTED IS MOVED TO THE FIRST VOLID  03060020
*              POSITION IN THE TABLE ENTRY. FOR IS AND DA, UP TO FIVE   03150020
*              VOLID'S ARE PLACED IN EACH TABLE ENTRY.  IF MORE THAN 5  03240020
*              VOLUMES ARE TO BE MOUNTED, A BIT IS SET IN THE ENTRY     03330020
*              TO INDICATE THAT A JFCB EXTENSION IS TO BE READ IN A     03420020
*              SUBSEQUENT MODULE.                                       03510020
*                                                                       03600020
*ENTRY POINT - IGC0G95B  CSECT                                          03690020
*                                                                       03780020
*INPUT -       REGISTER 1 - POINTER TO THE RESTART WORKAREA (RSTWA)     03870020
*                           SEE DSECT AT END OF MODULE                  03960020
*                                                                       04050020
*              REGISTER 8 - POINTER TO BEGINNING OF DATA SET INFO TAB   04080020
*                                                                       04110020
*OUTPUT -      REGISTER 8 - POINTER TO BEGINNING OF DATA SET INFO TABLE 04140020
*                                                                       04230020
*              REGISTER 1 - POINTER TO BEGINNING OF RSTWA WORKAREA      04320020
*                           (SEE DSECT AT END OF TABLE)                 04410020
*                                                                       04500020
*EXTERNAL RTN- RESIDENT CONVERT (TTR TO MBBCCHAR) ROUTINE VIA A BALR    04590020
*                                                                       04680020
*EXITS -       NORMAL TO IGC0I05B VIA XCTL                              04770020
*                                                                       04860020
*              ON ERROR CONDITION TO IGC0V05B VIA XCTL                  04950020
*                   RET CODE = 24 - ERROR WHILE PROCESSING JFCB         05130037
*                              82 - TCAM NOT ACTIVE AT RESTART          05220037
*TABLES/WORKAREAS                                                       05310020
*                                                                       05400020
*********************************************************************** 05490020
*                                                                     * 05580020
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 05670020
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 05760020
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 05850020
*    IS 48 BYTES LONG.                                                * 05940020
*                                                                     * 06030020
*********************************************************************** 06120020
*                                                                       06210020
*        ------------------- 4 BYTES -----------------                  06300020
*                                                                       06390020
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  06480020
*        +DATA SET  +           DCB                  +                  06570020
*        + ORGN.    +         ADDRESS                +                  06660020
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                06750020
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  06840020
*        + NO. 1    +         ADDRESS                +                  06930020
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  07020020
*        +NUMBER    +         JFCB TTR               +                  07110020
*        + OF VOLS  +         ADDRESS                +                  07200020
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               07290020
*                                                                       07380020
*     12 +++++++++++++++++++++++                                        07470020
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   07560020
*        +INFO BYTE + NUMBER   +                                        07650020
*        +++++++++++++++++++++++                                        07740020
*                                                                       07830020
*     12 +++++++++++++++++++++++                                        07920020
*        +    OLD   TIOT       +        DA AND UNIT RECORD              08010020
*        +      OFFSET         +                                        08100020
*        +++++++++++++++++++++++                                        08190020
*                                                                       08280020
*                              +++++++++++++++++++++++                  08370020
*                              +FLAG BYTE +FLAG BYTE +                  08460020
*                              +  NO. 2   +  NO. 3   +                  08550020
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  08640020
*        +FLAG BYTE +FLAG BYTE +                     +                  08730020
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  08820020
*        +++++++++++++++++++++++                     + 20               08910020
*        +                                           +                  09000020
*        +                                           +                  09090020
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  09180020
*        +                                           +                  09270020
*        +   VOLUME ID NO. 2                         +                  09360020
*        +                     +++++++++++++++++++++++ 28               09450020
*        +                     +                     +                  09540020
*        +                     +   VOLUME ID NO. 3   +                  09630020
*     32 +++++++++++++++++++++++                     +                  09720020
*        +                                           +                  09810020
*        +                                           +                  09900020
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               09990020
*        +                                           +                  10080020
*        +   VOLUME ID NO. 4                         +                  10170020
*     40 +                     +++++++++++++++++++++++                  10260020
*        +                     +                     +                  10350020
*        +                     +                     +                  10440020
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               10530020
*        +                                           +                  10620020
*        +                                           +                  10710020
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               10800020
*                                                                       10890020
*                                                                       10980020
*           A  DCBTABLE,                                                11070020
*                                                                       11160020
*           B  BUFFER AREA,                                             11250020
*                                                                       11340020
*           C  SEE DSECTS AT END OF LISTING.                            11430020
*                                                                       11520020
*ATTRIBUTES                                                             11610020
*                                                                       11700020
*          A RE-ENTRANT                                                 11790020
*          B RE-USABLE                                                  11880020
*          C ENABLED                                                    11970020
*          D PRIVIALEGED                                                12060020
*                                                                       12150020
*********************************************************************   12240020
*                                                                       12330020
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               12420020
*                                                                       12510020
*********************************************************************** 12600020
*                                                                       12690020
WRKR1    EQU   0                        WDRK/PARAMETER REGISTER         12780020
WRKR2    EQU   1                        WDRK/PARAMETER REGISTER         12870020
DCBR     EQU   2                        CURRENT DCB REGISTER            12960020
BASER    EQU   3                        BASE REGISTER                   13050020
DEBR     EQU   4                        CURRENT DEB REGISTER            13140020
UCBR     EQU   5                        CURRENT UCB REGISTER            13230020
TIOTR    EQU   6                        NEW TIOT REGISTER               13320020
TCBR     EQU   7                        TCB REGISTER                    13410020
TABLR    EQU   8                        BEGINNING TO DCB TABLE REG      13500020
CTABLR   EQU   9                        CURRENT ENTRY IN DCB TABLE      13590020
BUFR     EQU   10                       USER BUFFER AREA                13680020
DSCNTR   EQU   11                       WORK REGISTER                   13770020
WRKR3    EQU   12                       WORK REGISTER                   13860020
WRKR4    EQU   13                       WORK REGISTER                   13950020
WRKR5    EQU   14                       WORK/PARAMETER REGISTER         14040020
WRKR6    EQU   15                       WORK/PARAMETER REGISTER         14130020
*                                                                       14220020
*********************************************************************** 14310020
*                                                                       14400020
*    OFFSETS TO BE USED IN REPI/O PHASE                                 14490020
*                                                                       14580020
*********************************************************************** 14670020
*                                                                       14760020
IS       EQU   X'80'                    INDEXED SEQUENCIAL              14762020
PS       EQU   X'40'                    PHYSICAL SEQUENCIAL             14764020
DA       EQU   X'20'                    DIRECT ACCESS                   14766020
PO       EQU   X'02'                    PARTITIONED ORGANIZATION        14768020
DADEV    EQU   X'20'                    DA DEVICE                       14770002
LASTENT  EQU   X'08'                    LAST ENTRY                      14778020
AL       EQU   X'08'                    ASCII LABEL              S20038 14789020
GTR5VOL  EQU   X'80'                    GREATER THAN 5 VOLUMES          14796020
TABENT   EQU   48                       TABLE ENTRY LENGTH              14808020
PERMERR  EQU   X'7F'                    PERMANENT ERROR                 14842020
ERR024   EQU   24                       ERROR IN READING JFCB  @ZSUT222 14846037
TIOTBASE EQU   24                                                       15030020
BUSY     EQU   X'80'                                                    15210020
EXCHPGM  EQU   X'80'                    EXCP                            15230020
ISORDA   EQU   IS+DA                    IS OR DA                        15240020
RDBACK   EQU   X'03'                    READ BACKWARDS (DEBOPATB)       15250020
ZERO     EQU   0                        ZERO VALUE               A33701 15253020
BLANK    EQU   C' '                     BLANK CHAR               A33701 15256020
PSORPO   EQU   PS+PO                    PS OR PO                        15260020
TYTAPE   EQU   X'80'                    TAPE DEVICE (UCBTBYT3)          15270020
SYSINOUT EQU   X'20'                    SYSTEM INPUT OR OUTPUT          15280020
DEBID    EQU   X'0F'                    DEB IDENTIFICATION              15300020
MAXEXT   EQU   X'CA'                    MAXIMUM NO. OF EXTENT           15310020
UNRELCC  EQU   X'42'                    UNRELATED FLAG, COMMAND CHAIN   15320020
ASCII    EQU   X'40'                    ASCII LABEL BIT IN       S20038 15325020
*                                       JFCBLTYP                 S20038 15330020
NOT      EQU   X'FF'                    MASK TO TURN OFF BITS    S20038 15335020
ERREXIT  EQU   C'V'                     RESTART EXIT LOAD ID     A26097 15340020
COMMON   EQU   X'10'                    COMMON INTERFACE         YM5512 15360002
RSTCAM   EQU   X'04'                    MASTER TCAM FLAG                15374020
TCAMMODJ EQU   C'J'                     TCAM MODULE ID                  15381020
D0       EQU   0                        ZERO                     Y02076 15383002
D1       EQU   1                        ONE                      Y02076 15385002
D2       EQU   2                        TWO                      Y02076 15387002
D3       EQU   3                        THREE                    Y02076 15389002
D4       EQU   4                        FOUR                     Y02076 15389402
D5       EQU   5                        FIVE                     Y02076 15389802
D6       EQU   6                        SIX                      Y02076 15389902
D7       EQU   7                        SEVEN                    Y02076 15419902
D8       EQU   8                        EIGHT                    Y02076 15429902
D9       EQU   9                        NINE                     Y02076 15439902
D16      EQU   16                       SIXTEEN                  Y02076 15449902
D24      EQU   24                       TWENTY FOUR              Y02076 15459902
*                                                                       15470002
*********************************************************************** 15480020
*                                                                       15570020
         BALR  BASER,0                  ESTABLISH ADDRESSABILITY        15660020
         USING *,BASER                  ESTABLISH BASE REGISTER         15750020
         B     BEGIN               BRANCH AROUND EYE CATCHER     Y01909 15800000
         CNOP  0,8                 ALIGN TO A DBL WORD BOUNDARY  Y01909 15810000
         DC    CL8'IGC0G95B'       MODULE NAME                 @ZSUT222 15820037
         DC    CL8'&SYSDATE'       DATE LAST SHIPPED           @ZSUT222 15822037
         DC    CL8'@ZSUT222'       LAST CODE SHIPPED           @ZSUT222 15824037
BEGIN    EQU   *                                                 Y01909 15830000
*                                                                       15840020
         USING IHADCB,DCBR                                              15930020
         USING UCBOB,UCBR                                               16020020
         USING RSDSECT,TIOTR                                     Y02076 16110002
         USING DEBBASIC,DEBR                                     Y02076 16380002
         USING TCB,TCBR                                                 16470020
         USING TABL,CTABLR                                              16560020
         USING RSTWA,BUFR                                               16650020
*                                                                       16740020
         LR    BUFR,WRKR2               GET WORK AREA (RESTART) ADDR    16830020
*                                                                       16920020
         L     WRKR2,RSWAOFST           OFFSET TO REPI/O AREA           17010020
         LA    TABLR,0(WRKR2,BUFR)      POINT TO REPI/O AREA            17100020
*                                                                       17190020
         L     TCBR,RSTCBAD             GET USER TCB                    17370020
         LA    WRKR4,RSREGSAV           REG13 PTS TO SAVAREA     Y02076 17420002
*                                                                       17460020
         L     DEBR,RSINT               GET 1ST DEB ADDR         A28676 17550020
         MVC   RSPPM(8),NORMALXT        SET UP XCTL LIST         A26097 17590020
         USING CVTMAP,WRKR6             ADDRESS CVT              Y02076 17600002
         L     WRKR6,ADRCVT(D0,D0)      GET CVT PTR              Y02076 17610002
         L     WRKR6,CVTXAPG            GET ADR APPEND VEC TBL   Y02076 17620002
         DROP  WRKR6                                             Y02076 17630002
         ICM   WRKR6,HIORDER,EXTSCALE   SET EXTENT SCALE         Y02076 17632002
         LR    CTABLR,TABLR             LOAD TBL PTR REG         Y02076 17634002
         LR    WRKR5,WRKR3              GET NO. OF ENTRIES       Y02076 17636002
REPDCB09 EQU   *                        INIT. DEB/DCB/IOB        Y02076 17638002
         BCTR  DSCNTR,0                 REDUCE D/S COUNT BY 1    Y02076 17638402
         L     TIOTR,TABSEGAD-1         GET CURRENT BUFF SEG     Y02076 17638802
         ST    TCBR,RSDEBTCB            STORE TCB ADR            Y02076 17639202
         LA    WRKR1,RSDCBREP           GET DCB ADR              Y02076 17639602
         ST    WRKR1,RSDEBDCB           ST DCB ADR IN DEB        Y02076 17639702
         ST    WRKR1,RSIOBDCB           ST DCB ADR IN IOB        Y02076 17639802
         ST    WRKR6,RSDEBAPP           ST ADR APP VECT TBL      Y02076 17639902
         MVI   RSDEBID,DEBID            SET DEB ID               Y02076 17656602
         MVC   RSDEBNTR(2),MAXTRKNO     MAX NO. OF TRKS          Y02076 17666602
         MVI   RSDEBUSR,NUMEXTS         SET NO. EXTS=1           Y02076 17668602
         LA    WRKR1,RSDEB              GET DEB ADR              Y02076 17670602
         ST    WRKR1,RSDCBDEB           SET DEB ADR IN DCB       Y02076 17672602
         XC    RSIOBFG1(4),RSIOBFG1     CLEAR IOB 1ST WORD       Y02076 17672702
         MVI   RSIOBFG1,UNRELCC         SET UNRELATED FLG IN IOB Y02076 17673002
         LA    WRKR1,RSECBAD            GET ECB FOR IOB          Y02076 17673102
         ST    WRKR1,RSIOBECB           STORE IN IOB             Y02076 17673202
         LA    WRKR1,RSCCWLST           GET ADR OF CCWLIST       Y02076 17678802
         ST    WRKR1,RSIOBCPA           STORE IN IOB             Y02076 17680802
         LA    WRKR1,RSIOBDAD+3         GET ADR OF SRCH ARG      Y02076 17682802
         ST    WRKR1,RSCCW1             STORE IN SRCH CCW        Y02076 17683202
         LA    WRKR1,RSCCW1             GET ADR OF SRCH CCW      Y02076 17683602
         ST    WRKR1,RSCCW2             STORE IN TIC CCW         Y02076 17684002
         LA    WRKR1,RSBUFSEG           GET BUFF SEG ADR         Y02076 17684102
         ST    WRKR1,RSCCW3             STORE IN READ CCW        Y02076 17684202
         OC    RSCCWLST(24),CCWLIST     SET CONSTANTS IN CP      Y02076 17684302
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TO NXT ENTRY   Y02076 17698202
         LTR   DSCNTR,DSCNTR            TEST FOR ZERO            Y02076 17708202
         BZ    REPDCB0A                 YES-BRANCH               Y02076 17710202
         BCT   WRKR5,REPDCB09           RETURN FOR NEXT ENTRY    Y02076 17710602
*********************************************************************** 17712202
*   GET SPACE REQUIRED FOR QMNGRIO PARAMETER LIST AND WORK AREA AND   * 17726102
*   INITIALIZE IT.  QMNGRIO IS USED FOR READING IN THE JFCB FROM      * 17740002
*   THE SCHEDULER WORK AREA (SWA) FOR EACH DATA SET.                  * 17790002
*********************************************************************** 17840002
REPDCB0A EQU   *                        SET UP FOR QMNGRIO       Y02076 17850002
         ICM   WRKR1,ADDRBYTS,QMNGWALN  WA + PRM LST LNGTH IN R0 Y02076 17890002
         ICM   WRKR1,HIORDER,SP253      SUBPOOL 253              Y02076 17940002
         GETMAIN  R,LV=(0)              ISSUE GETMAIN            Y02076 17990002
         USING QMIOP,WRKR2                                       Y02076 18040002
         XC    QMITCBAD(D24),QMITCBAD   CLEAR PARAMETER LIST     Y02076 18090002
         LA    WRKR1,QMWAOFST           GET OFFSET TO WRK AREA   Y02076 18140002
         AR    WRKR1,WRKR2              CALC ADR OF WRK AREA     Y02076 18190002
         ST    WRKR1,QMIWRKAD           STO WRK AREA ADR IN P.L  Y02076 18240002
         ST    TCBR,QMITCBAD            STORE TCB ADR IN P.LIST  Y02076 18340002
         LA    WRKR1,JFCBLNTH           GET JFCB LENGTH          Y02076 18390002
         STH   WRKR1,QMIRECL            STO RECORD LNGTH IN P.L  Y02076 18440002
         MVI   QMIFLAGS,QMIOREAD        SET READ FUNCTION        Y02076 18540002
         ST    WRKR2,QMNPRMWA           SAVE QMNGRIO P LST ADR   Y02076 18590002
*********************************************************************** 42390020
*                                                                       42480020
************        MAIN READ/PROCESS ROUTINE   *********************** 42570020
*                                                                       42660020
*********************************************************************** 42750020
*                                                                       42840020
*    THIS ROUTINE READS INTO THE PREASSIGNED WORKAREAS FOR EACH       * 42930020
*    DATA SET, THE JFCB ASSOCIATED WITH THE DATA SET.  PRIOR TO       * 43020020
*    THIS EACH DATA SET HAS BEEN ASSIGNED A SEGMENT OF BUFFER INTO    * 43110020
*    WHICH THE JFCB IS TO BE READ.                                    * 43200002
*     AFTER THE JFCB                                                  * 43290002
*    HAS BEEN READ THE INFORMATION WHICH IT CONTAINS IS PLACED IN     * 43380020
*    THE TABEL ENTRY WHICH CORRESPONDS TO IT.                         * 43470020
*                                                                       43560020
*********************************************************************** 43650020
*                                                                       43920020
         LR    CTABLR,TABLR             INIT. TO FIRST ENTRY            44010020
REPDCB10 EQU   *                                                        44280020
         TM    TABFLG1,TABSYS           IS THIS A SUB SYSTEM DS? YM7529 44330002
         BO    REPDCB48                 YES, BYPASS PROCESSING   YM7529 44380002
         L     TIOTR,TABSEGAD-D1        GET WORK AREA            Y02076 44460002
         LA    TIOTR,0(TIOTR)           CLEAR HI ORDER BYTE      Y02076 44510002
         L     WRKR2,QMNPRMWA           GET ADR OF QMNGR P.L.    Y02076 44520002
         LA    WRKR1,RSJFCB             GET JFCB READ IN ADDR    Y02076 44530002
         ST    WRKR1,QMIRECAD           STORE IN QMNGR PARM LIST Y02076 44624402
         L     WRKR1,TABJFCB-D1         GET TTR ADR OF JFCB      Y02076 44624602
         SLL   WRKR1,HIORDER            CLEAR LO ORDER BYTE      Y02076 44637602
         ST    WRKR1,QMIDSKAD           SVA ADR INTO P.L.        Y02076 44650802
         QMNGRIO                        ISSUE QMNGRIO-READ JFCB  Y02076 44664002
         LTR   WRKR6,WRKR6              TEST RETURN CODE         Y02076 44677202
         BNZ   REPDCB56                 BR TO SET ERR CODE       Y02076 44690402
*********************************************************************** 44703602
*   JFCB SUCCESSFULLY READ IN - MOVE APPROPRIATE FIELDS TO TABL ENTRY * 44716802
*********************************************************************** 44730002
         CLC   JFCBDSNM(8),NULLFILE     DUMMY DATA SET                  51210020
         BE    REPDCB44                 YES BRANCH                      51300020
*                                                                       51390020
         L     DCBR,TABDCBAD-1          GET ENTRY DCB                   51510020
         L     DEBR,DCBDEBAD       GET DEB ADDRESS               Y02049 51512002
         LR    WRKR3,DEBR          SAVE DEB ADDR FOR CALC        Y02049 51514002
         LA    WRKR2,DEBPRFLN      GET LENGTH OF DEB PREFIX      Y02049 51516002
         SR    WRKR3,WRKR2         POINT TO DEB PREFIX           Y02049 51516402
         USING DEBPREFX,WRKR3                                    Y02049 51516802
         L     WRKR2,DEBXTNP       GET POINTER TO DEB EXTENSION  Y02049 51517202
         USING DEBXTN,WRKR2                                      Y02049 51517602
         DROP  WRKR3                                             Y02049 51517702
         MVC   TABDSORG(1),DEBXDSO1     GET DSORG FROM DEB       Y02049 51518002
         TM    TABFLG1,TABTCAM          Q - TCAM D/S                    51526002
         BZ    REPDCB18                 NO, SKIP TCAM PROCESSING        51534020
         MVC   TABVLID1(8),JFCBDSNM     SAVE TCAM QNAME                 51542020
         B     REPDCB48                 BYPASS NONTCAM PROCESSING       51550020
REPDCB18 EQU   *                                                        51558020
         L     TCBR,RSTCBAD             GET TCB ADDR             YM7042 51608002
         L     TCBR,TCBTIO              GET NEW TIOT ADDR        YM7042 51658002
         AH    TCBR,DCBTIOT             POINT TO DD ENTRY        YM7042 51708002
         L     UCBR,TIOESTTB-TIOENTRY(,TCBR)                     YM7042 51718002
*                                 GET FIRST UCB FROM TIOT        YM7042 51728002
         LA    UCBR,D0(,UCBR)     ZERO OUT HI BYTE               YM7529 51738002
*                                                                       51750020
         TM    DEBXMCF1,DCBMRECP        EXCP USED?               Y02049 51770002
         BZ    REPDCB21                 NO, GO CHECK DSORG       A26097 51780020
         TM    DEBXMCF1,DCBMRCI         COMMON INTERFACE PRESENT Y02049 51790002
         BO    REPDCB21                 YES, GO CHECK DSORG      A26097 51800020
         MVC   TABDSORG(1),JFCDSORG     GET DSORG FROM JFCB      A26097 51810020
         DROP  WRKR2                                             Y02049 51812002
*                                                                       51820020
*********************************************************************** 51840020
*                                                                       51930020
******** NOTE THAT ISAM DATA SETS HAVE NON-STANDARD DEBS SO THEY        52020020
*        REQUIRE ADDING 16 BYTES TO GET THE UCB ADDRESS               * 52110020
*                                                                       52200020
*********************************************************************** 52290020
*                                                                       52380020
REPDCB21 EQU   *                                                 A26097 52420020
*                                                                       52460020
         TM    TABDSORG,IS              IS DSORG ISAM?           A26097 52500020
         BC    12,REPDCB27              NO - BRANCH                     52560020
*                                                                       52564020
* FOR AN ISAM DATA SET CHECK TO SEE IF OTHER THAN THE FIRST             52568020
* DD CARD (THREE POSSIBLE) HAVE BEEN SPECIFIED AS DUMMY.                52572020
*                                                                       52576020
         SR    WRKR2,WRKR2              CLEAR WORK REG           YM7042 52580002
REPDC23A EQU   *                                                 A33701 52596020
         IC    WRKR2,0(TCBR)            GET ENTRY LENGTH         YM7042 52600002
         AR    TCBR,WRKR2               POINT TO NEXT ENTRY      YM7042 52604002
         CLI   0(TCBR),ZERO             Q-END OF TIOT            A33701 52608020
         BE    REPDC25A                 IF YES, BR               A33701 52612020
         CLI   4(TCBR),BLANK            Q-BLANK DD NAME          A33701 52616020
         BNE   REPDC25A                 IF NOT, BR               A33701 52620020
         OC    16(4,TCBR),16(TCBR)      Q-DUMMY ENTRY            A33701 52624020
         BZ    REPDCB44                 IF YES, GO SET NULL IND  A33701 52628020
         B     REPDC23A                 LOOP BACK                A33701 52632020
REPDC25A EQU   *                                                 A33701 52636020
REPDCB27 EQU   *                                                        52920020
*                                                                       53010020
         TM    UCBTBYT3,TYTAPE          MAGNETIC TAPE DEVICE            53100020
         BO    REPDCB26                 YES BRANCH                      53190020
*                                                                       53280020
         TM    UCBTBYT3,DADEV           DIRECT ACCESS DEVICE            53370020
         BZ    REPDCB46                 NO BRANCH                       53460020
**********************************************************************  53510002
*   DETERMINE IF ENTRY IS FOR A VAM DATA SET - IF SO, SET FLAGS         53520002
*   FOR FORCING AN ENTRY TO IGC0M05B AND BYPASS UNNECESSARY             53530002
*   DA PROCESSING                                                Y02076 53540002
**********************************************************************  53544002
         LR    WRKR2,DEBR               CALC ADDR OF DEB PREFIX  Y02076 53546002
         LA    WRKR1,DEBPRFLN           GET LENGTH OF DEB PREFIX Y02076 53548002
         SR    WRKR2,WRKR1              WRKR2 PTS TO DEB PREFIX  Y02076 53548402
         USING DEBPREFX,WRKR2                                    Y02076 53548802
         L     WRKR2,DEBXTNP            GET DEB EXTENTION PTR    Y02076 53549202
         DROP  WRKR2                                             Y02076 53549602
         USING DEBXTN,WRKR2                                      Y02076 53549702
         L     WRKR2,DEBXDSAB           GET DSAB POINTER         Y02076 53549802
         DROP  WRKR2                                             Y02076 53549902
         USING DSAB,WRKR2                                        Y02076 53579902
         TM    DSABFLG3,DSABVAM         TEST FOR VAM             Y02076 53589902
         BZ    REPDC27A                 BRANCH IF NOT VAM        Y02076 53599902
         OI    TABFLG2,TABVIODS         SET VIO IN TABL ENTRY    Y02076 53609902
         DROP  WRKR2                                             Y02076 53623902
REPDC27A EQU   *                        INSTR MUST FOLLOW        Y02076 53629902
         OI    TABFLG1,TABDA            SET DA FLAG                     53820002
REPDC27B EQU   *                        INSTR MUST FOLLOW        Y02076 53870002
         LA    TCBR,1                   LOAD TCBR                       53910020
         TM    TABDSORG,PS              IS DSORG PS?             A26097 54000020
         BZ    REPDCB28                 NO - BRANCH                     54090020
*                                                                       54180020
         SR    WRKR2,WRKR2              CLEAR REG 1                     54270020
         IC    WRKR2,DEBNMEXT           GET NUMBER OF EXTENTS           54360020
         SLL   WRKR2,D4                 NUMBER X SIXTEEN                54540002
         LA    WRKR5,DEBBASND           ADR OF DEBBASIC END      Y02076 54590002
         AR    WRKR2,WRKR5              ADR OF ACCESS METH SECT  Y02076 54600002
         USING DEBACSMD,WRKR2                                    Y02076 54610002
         IC    TCBR,DEBVOLSQ+D1         GET VOLUME SEQ NUMBER    Y02076 54630002
         DROP  WRKR2                                             Y02076 54680002
         B     REPDCB28                 BRANCH TO GET VOL SER NUMBER    54720020
*                                                                       54810020
REPDCB26 EQU   *                                                        54900020
*                                                                       54990020
         OI    TABFLG1,TABTAPE          SET TAPE FLAG ON                55080002
         LA    WRKR5,DEBBASND           ADR OF DEBBASIC END      Y02076 55130002
         LA    WRKR5,D4(WRKR5)          INDEX PAST MAG TPE SECT  YM5980 55140002
         USING DEBACSMD,WRKR5                                    Y02076 55150002
         SR    TCBR,TCBR                CLEAR REGISTER           Y02076 55160002
         IC    TCBR,DEBVOLSQ+D1         TAPE VOLUME SEQ NUMBER   Y02076 55170002
         DROP  WRKR5                                             Y02076 55172002
*                                                                       55258502
         MVC   TABTPLBL(1),JFCBLTYP     SAVE LABEL INFORMATION          55264602
*                                                                       55270702
         NI    TABTPLBL,NOT-AL          TURN OFF BIT 4 OF        S20038 55276802
*                                       TABTPLBL IF              S20038 55282902
*                                            SUL IS SPECIFIED SO NOT TO 55289002
*                                            CONFUSE WITH AL BIT        55295102
         TM    JFCBLTYP,ASCII           IS ASCII LABEL SPECIFIED S20038 55301202
         BZ    REPDCB29                 BRANCH IF NO TO GET FILE S20038 55307302
*                                       SEQ N                    S20038 55313402
*                                                                       55319502
         MVI   TABTPLBL,AL              SET AL BIT ON IN TABLE   S20038 55325602
*                                                                       55331702
REPDCB29 EQU   *                                                 S20038 55337802
*                                                                       55343902
         MVC   TABFLG5(1),JFCBFLSQ+1    LOGICAL FILE SEQNO.     OX01653 55345902
         MVC   TABFSQNO(1),JFCBFSEQ     PHYS SEQ NO. ON REEL    OX01653 55350002
*                                                                       55440020
REPDCB28 EQU   *                                                        55530020
*                                                                       55620020
         MVC   TABVLID1(30),JFCBVOLS    5 POSSIBLE VOL SERIAL NUMBERS   55710020
         MVC   TABNVOLS(1),JFCBNVOL     TOTAL VOLUMES                   55890020
         TM    TABDSORG,ISORDA          TEST DATA SET TYPE       A43757 55930021
         BZ    REPDCB2A                 CONTINUE IF NOT IS OR DA A43757 55970021
         CLI   JFCBNVOL,D5              GREATER THAN 5 VOLS    @ZA02507 55980000
         BNH   REPDCB48                 BRANCH IF NOT          @ZA02507 55990000
         OC    JFCBEXAD,JFCBEXAD        TEST JFCBX ADDRESS       A43757 56010021
         BZ    REPDCB48            SKIP IF NO JFCBX              A43757 56050021
         EX    0,SAVEXTTR               SAVE EXTENSION TTR       A43757 56090021
         OI    TABFLG2,TABG5V           SET MORE-THAN-5-VOLS     A43757 56130002
*                                       FLAG                     A43757 56170021
         B     REPDCB48                 FINISHED THIS DATA SET   A43757 56210021
*                                                                       56250021
REPDCB2A EQU   *                                                 A43757 56290021
*                                                                       56340020
         CH    TCBR,FIVE                VOL SEQ NO. GT 5         A26097 56440020
         BH    REPDCB50                 YES BRANCH                      56610020
*                                                                       56700020
*********************************************************************** 56790020
*                                                                       56880020
*    AT THIS TIME FOR SEQ. DATA SETS CORRECT SERIAL IS IN FIRST FIVE    56970020
*    NUMBERS LISTED... MUST MOVE CORRECT SERIAL TO TOP OF LIST.......   57060020
*                                                                       57150020
*********************************************************************** 57240020
*                                                                       57330020
         LR    WRKR3,DEBR          GET DEB ADDRESS FOR CALC      Y02049 57380002
         LA    WRKR2,DEBPRFLN      GET LENGTH OF DEB PREFIX      Y02049 57430002
         SR    WRKR3,WRKR2         POINT TO DEB PREFIX           Y02049 57480002
         USING DEBPREFX,WRKR3                                    Y02049 57490002
         L     WRKR2,DEBXTNP       GET ADDR OF DEB EXTENSION     Y02049 57500002
         USING DEBXTN,WRKR2                                      Y02049 57502002
         DROP  WRKR3                                             Y02049 57504002
         TM    DEBXMCF1,DCBMRECP   EXCP USED?                    Y02049 57506002
         BO    REPDCB34                 YES BRANCH                      57510020
*                                                                       57600020
         TM    TABDSORG,PSORPO          SEQUENTIAL OR PO ORGN           57690020
         BZ    REPDCB48                 NO, BRANCH                      57780020
*                                                                       57870020
REPDCB34 EQU   *                                                        57960020
*                                                                       58050020
         BCTR  TCBR,0                   REDUCE VOL SEQ NO. FOR   A41442 58150021
*                                       OFFSET COMPUTATION              58250021
         MH    TCBR,SIX                 OFFSET TO SERIAL NUMBERS        58500020
         LA    TCBR,TABVLID1(TCBR)      CORRECT SERIAL PLUS SIX         58590020
*                                                                       59310020
*    AT THIS POINT TCBR SHOULD POINT TO CURRECT SERIAL NUMBER           59400020
*                                                                       59490020
         MVC   TABVLID1(6),0(TCBR)      CORRECT SERIAL TO TOP OF LIST   59580020
SAVVOL1  MVC   TABVLID3(6),JFCBVOLS     SAVE 1ST SER FOR UCB     A41442 59620021
         B     REPDCB48                 BRANCH TO GET NEXT ENTRY        59670020
*                                                                       59760020
REPDCB44 EQU   *                                                        60300020
*                                                                       60390020
         OI    TABFLG1,TABNULL          NULLFILE/NONPROCESS FLAG Y02076 60480002
*********************************************************************** 60530002
*   IF ISAM/VSAM(CI) DATA SET WAS MADE DUMMY AT RESTART - SET           60540002
*    TABFLG3 WITH X'20' BIT                                      Y02076 60550002
*********************************************************************** 60560002
         L     DCBR,TABDCBAD-D1         GET DUMMY DS DCB ADR     Y02076 60562002
         L     DEBR,DCBDEBAD            GET DUMMY DS DEB ADR     Y02076 60564002
         LR    WRKR2,DEBR               CALC ADR OF DEB PREFIX   Y02076 60566002
         LA    WRKR1,DEBPRFLN           GET DEB PREFIX LENGTH    Y02076 60568002
         SR    WRKR2,WRKR1              WRKR2 PTS TO PREFIX      Y02076 60568402
         USING DEBPREFX,WRKR2                                    Y02076 60568802
         CLI   DEBAMTYP,ISAMCODE        IS IT AN ISAM DATA SET   Y02076 60569202
         BNE   REPDCB48                 IF NOT-GET NEXT ENTRY    Y02076 60569602
         CLI   DEBEXSCL,SCALEQZO        IS DEBEXSCL=0            Y02076 60569702
         BNE   REPDCB48                 IF NOT-GET NEXT ENTRY    Y02076 60569802
         TM    DEBFLGS1,DEBCINDI        IS CI BIT ON             Y02076 60569902
         BZ    REPDCB48                 BRANCH IF NOT CI         Y02076 60599902
         OI    TABFLG2,TABCIDS          SET IS/VS CI DUMMY CODE  Y02076 60609902
         DROP  WRKR2                                             Y02076 60619902
         B     REPDCB48                 BRANCH TO GET NEXT ENTRY        60630002
*                                                                       60660020
REPDCB46 EQU   *                                                        60750020
*                                                                       60840020
         OI    TABFLG1,TABUR            UNIT RECORD OR OTHER FLAG BIT   60930002
*                                                                       61020020
REPDCB48 EQU   *                                                        61110020
*                                                                       61200020
         TM    D4(CTABLR),LASTENT       LAST ENTRY IN TBLE       Y02076 61250002
         BO    REPDCBNM                 BRANCH IF YES            Y02076 61260002
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TO NEXT ENTRY         61290020
         B     REPDCB10                 BR TO PROCESS NEXT ENTRY Y02076 61340002
*                                                                       61560020
REPDCB50 EQU   *                                                        61650020
*                                                                       61740020
         OI    TABFLG2,TABG5V           SET ON VOL GREATER THAN 5 FLAG  61800002
         STH   TCBR,TABVLID5            SAVE ADJUSTED VOL SEQ NO        61870020
         EX    0,SAVVOL1                SAVE 1ST SER FOR UCB     A41442 61970021
*                                                                       62100020
         MVC   TABVLID5+3(3),TABJFCB    SAVE JFCB TTR IN TABVLID5       62130020
*                                                                       62140020
REPDCB54 EQU   *                                                        62190020
*                                                                       62280020
SAVEXTTR MVC   TABJFCB(3),JFCBEXAD MOVE IN JFCBX TTR             A33983 62370020
         B     REPDCB48                 BRANCH TO GET NEXT ENTRY        62460020
*                                                                       62550020
*     MUST TERMINATE REPI/O DUE TO UNRECOVERABLE ERRORS IN PROCESSING   62640020
*                                                                       62730020
REPDCB56 EQU   *                                                        62820020
*                                                                       62910020
         MVI   RSRETCOD+1,ERR024        SET JFCB READ ERROR    @ZSUT222 63000037
*                                                                       63270020
         MVI   RSPPM+4,ERREXIT     SET RESTART EXIT LOAD ID      A33983 63370020
         B     REPDCBER                 GO XCTL                @ZSUT222 63470037
REPDCBNM EQU   *                                                        63570020
         TM    RSFLAG2,RSTCAM           Q - ANY TCAM D/S'S              63670020
         BZ    REPDCBEX                 NO, GO XCTL TO IGC0I05B         63770020
         MVI   RSPPM+4,TCAMMODJ         SETUP TO XCTL TO IGC0J05B       63870020
         L    WRKR6,CVTPTR                                              63920000
         L    WRKR6,AVTCVTPT(WRKR6)     GET TAM ADDR            S21940  63930000
         LTR  WRKR6,WRKR6               IS TAM ACTIVE           S21940  63940000
         BNZ  REPDCBEX                  YES, BRANCH             S21940  63950000
         MVI  RSRETCOD+1,ERR082         NO, SET UP FOR ERR     @ZSUT222 63960037
         MVI  RSPPM+4,ERREXIT           TCAM NOT IN SYSTEM      S21940  63962000
REPDCBER EQU   *                                               @ZSUT222 63963037
         MVC   RSREGSAV(8),MODID        SAVE NAME OF MODULE    @ZSUT222 63964037
*                                       DETECTING ERROR        @ZSUT222 63965037
         STM   0,15,RSREGSAV+8          SAVE CURRENT REGISTERS @ZSUT222 63966037
REPDCBEX EQU   *                                                        63970020
         ICM   WRKR1,ADDRBYTS,QMNGWALN  SET UP FREEMAIN          Y02076 64020002
         ICM   WRKR1,HIORDER,SP253      SUBPOOL 253              Y02076 64070002
         L     WRKR2,QMNPRMWA           ADR OF P.L. + WA         Y02076 64120002
         FREEMAIN  R,LV=(0),A=(1)                                Y02076 64170002
         LA    WRKR6,RSPPM+8            SET UP FOR XCTL          A26097 64310020
*********************************************************************   64370020
         LR    WRKR2,BUFR               POINT REG 1 TO THE RESTART W/A  64390020
*********************************************************************   64410020
*                                                                       64440020
*********************************************************************** 64530020
*                                                                       64620020
         XCTL  EPLOC=RSPPM,SF=(E,(15))                           A26097 64820020
*                                                                       65070020
*********************************************************************   65160020
*                                                                       65250020
*     CONSTANTS USED IN REPI/O                                          65340020
*                                                                       65430020
NULLFILE DC    CL8'NULLFILE'            NULLFILE                        65610020
NORMALXT DC    C'IGC0I05B'              TABLE COMPLETION LOAD           65700020
MODID    DC    CL8'IGC0G95B'            MODULE ID              @ZSUT222 65750037
*                                                                       65970020
*     CHANNEL PROGRAM USED BY REPI/O                                    66060020
*                                                                       66150020
         DS    0H                                                A26097 66240020
CCWLIST  DC    X'3100000040000005'      SEARCH                          66330020
         DC    X'08'                    TIC                             66420020
CONSTANT DC    X'00000000067FFF'        SPACE-SAVING CONSTANTS   A26097 66510020
         DC    X'06000000000000B0'      READ                            66600020
QMNGWALN DC    AL3(280)                 256(WA) + 24(P.L.)       Y02076 66600402
SP253    DC    AL1(253)                 SUBPOOL 253              Y02076 66600802
EXTSCALE DC    X'04'                    EXTENT SCALE             Y02076 66600902
HIORDER  EQU   8                        GETMAIN PARAMS           Y02076 66601202
ADDRBYTS EQU   7                        LOW ORDER BYTES          Y02076 66601602
QMWAOFST EQU   24                       WORK AREA OFFSET         Y02076 66601702
JFCBLNTH EQU   176                      JFCB LENGTH              Y02076 66601802
SCALEQZO EQU   0                        FOR IS/VS(CI) DUMMY TST  Y02076 66602002
ISAMCODE EQU   X'80'                    ISAM CODE IN DEBAMTYP    Y02076 66606002
DEBPRFLN EQU   16                       DEB PREFIX LENGTH        Y02076 66608402
DADSFLG  EQU   X'80'                    DA DATA SET FLAG         Y02076 66609202
*                                                                       66610020
AVTCVTPT EQU    240                     OFFSET INTO CVT OF TCAM         66612000
*                                           AVT PTR                     66614000
ADRCVT   EQU   16                       ADDRES OF CVT            Y02076 66614402
NUMEXTS  EQU   X'01'                    NUMBER OF EXTENTS        Y02076 66614802
ERR082   EQU   82                       TCAM NOT IN SYSTEM     @ZSUT222 66616037
FIVE     EQU   CCWLIST+6                CONSTANT OF 5            A26097 66620020
SIX      EQU   CONSTANT+3               CONSTANT OF 6            A26097 66630020
MAXTRKNO EQU   CONSTANT+5               MAXIMUM NO. OF TRACKS    A26097 66640020
*                                                                     * 66650000
*        MAINTENANCE SPACE                                       Y01909 66660000
*                                                                     * 66670000
PATCH    DC    XL((*-IGC0G95B)/20)'00'   FIVE PERCENT SPACE      Y01909 66680000
*                                                                     * 66682000
         EJECT                                                          66690020
         IEEVRSWA VER=3                 USE AOS2 VERSION OF WA          66830000
QMNPRMWA EQU   RSERAS00                 SAVE ADR FOR QMNGRIO P.L Y02076 66840002
         EJECT                                                          66870020
RSDSECT  DSECT                                                          66880002
*                                                                       66890002
*    DATA EXTENT BLOCK                                                  66900002
*                                                                       66910002
RSDEB    DS    0CL48                                                    66912002
RSDEBTCB DC    X'00000000'              TCB ADDRESS                     66914002
RSDEBDEB DC    X'00000000'              DEB ADDRESS                     66916002
*                                                                       66918002
*    DATA CONTROL BLOCK                                                 66918402
*                                                                       66918802
RSDEBOFL DS    0CL1                                                     66919202
RSDEBIRB DC    X'00000000'              IRB ADDRESS                     66919602
RSDEBSYS DC    X'00000000'              1ST IOB ADDR IN SYS.PURGE CHAIN 66919702
RSDEBUSR DC    X'00000000'              1ST IOB ADDR IN USER PRGE CHAIN 66919802
RSDEBECB DC    X'00000000'              PARM.LIST ADDR TO PURGE ECB     66919902
RSDEBID  DS    0CL1                                                     66923202
RSDEBDCB DC    AL4(RSDCBREP)            DCB ADDR                        66925202
RSDEBAPP DS    CL4                      I/O APPENDAGE VECTOR TABLE      66925602
RSDEBMOD DS    0CL1                                                     66926002
RSDEBUCB DS    F                        UCB ADDRESS                     66926402
RSDEBBIN DS    H                        BIN NUMBER                      66926502
RSDEBSCC DS    H                        CYLINDER START ADDRESS          66926602
RSDEBSHH DS    H                        TRACK START ADDRESS             66929902
RSDEBECC DS    H                        CYLINDER END ADDRESS            66931902
RSDEBEHH DS    H                        TRACK END ADDRESS               66932302
RSDEBNTR DS    H                        NO. OF TRACKS IN THIS EXTENT    66932702
*                                                                       66933102
*    EVENT CONTROL BLOCK                                                66933202
*                                                                       66933302
RSECBAD  DS    CL4                      ECB ADDRESS                     66938602
RSDCBDEB DC    AL4(RSDEB)               DEB ADDRESS                     66948602
*                                                                       66949002
RSDCBREP EQU   RSDEB+8                  POINT TO RELATIVE BEGINNING DCB 66949102
*                                                                       66949202
*    INPUT OUTPUT BLOCK                                                 66949302
*                                                                       66969402
RSIOB    DS    0CL40                                                    66979402
RSIOBFG1 DC    X'00'                    I/O FLAGS BYTE 1                66989402
RSIOBFG2 DC    X'00'                    I/O FLAGS BYTE 2                66999402
RSIOBSN1 DS    CL1                      FIRST SENSE BYTE                67009402
RSIOBSN2 DS    CL1                      SECOND SENSE BYTE               67009502
RSIOBECB DC    AL4(RSECBAD)             ECB ADDRESS                     67009602
RSIOBCSW DS    D                        LAST CSW                        67009702
RSIOBCPA DS    AL4(RSCCW1)              CHANNEL PROGRAM ADDRESS         67016402
RSIOBDCB DS    AL4(RSDCBREP)            DCB ADDRESS                     67018402
RSIOBRCP DS    CL4                      RESTART ADDRESS FOR IOS         67020402
RSIOBINC DS    H                        INCREMENT BLOCK COUNT           67022402
RSIOBECT DS    H                        NO. OF ERROR ENTRIES            67022802
RSIOBDAD DS    D                        SEEK ADDRESS FOR DA             67022902
*                                                                       67023002
*    CHANNEL PROGRAM                                                    67023102
*                                                                       67029802
RSCCWLST DS    0CL24                                                    67031802
RSCCW1   DS    D                        CCW1                            67033802
RSCCW2   DS    D                        CCW2                            67035802
RSCCW3   DS    D                        CCW3                            67036202
*                                                                       67036302
*    BUFFER SEGMENT FOR EXTERNAL BLOCKS                                 67036402
*                                                                       67036502
RSBUFSEG DS    0CL176                                                   67057202
RSJFCB   EQU   RSBUFSEG                                                 67067202
         EJECT                                                          67077202
         IEFJFCBN                                                Y02076 67098602
         EJECT                                                          67108602
         IEFQMIOP                                                Y02076 67119302
         EJECT                                                          67129302
         IEFJESCT                                                Y02076 67140002
         EJECT                                                          82710020
CVT      DSECT                                                          82800020
         CVT                                                            82890020
         EJECT                                                          82980020
*                                                                       83070020
*                                                                       83160020
*   TASK CONTROL BLOCK                                                  83250020
*                                                                       83340020
*                                                                       83430020
         CNOP  0,4                                                      83520020
TCB      DSECT                                                          83610020
TCBRBP   DS    F                       POINTER TO EXECUTING RB          83700020
TCBPIE   DS    F                       POINTER TO PROG. INTERRUPT EL.   83790020
TCBDEB   DS    F                       POINTER TO DEB QUEUE             83880020
TCBTIO   DS    F                       POINTER TO TIOT                  83970020
TCBCMP   DS    F                       TASK COMPLETION CODE             84060020
TCBTRN   DS    F                       TESTRAN FIELD                    84150020
TCBMSS   DS    F                       DATA BLOCK QUEUE ELEMENT POINTER 84240020
TCBPRTK  DS    CL1                     PROTECTION TAG                   84330020
TCBFLGS  DS    FL5                     FLAG BYTES                       84420020
TCBLMP   DS    CL1                     LIMIT PRIORITY                   84510020
TCBDSP   DS    CL1                     DISPATCHING PRIORITY             84600020
TCBLLS   DS    F                       POINTER TO LOAD LIST             84690020
TCBJLB   DS    F                       POINTER TO JOBLIB DCB            84780020
TCBJSE   DS    F                       LIST OF INACTIVE PROGRAMS ADDR.  84870020
TCBGRS   DS    CL64                    GENERAL REGISTER SAVE AREA       84960020
TCBIDF   DS    CL1                     TCB IDENTIFIER FIELD             85050020
TCBFSA   DS    CL3                     POINTER TO 1ST PROB.PROG.SAVEAR  85140020
TCBTCB   DS    F                       NEXT TCB ON READY QUEUE POINTER  85230020
TCBTME   DS    F                       POINTER TO TIMER ELEMENT         85320020
         EJECT                                                          85410020
         DCBD  DSORG=PS                                                 85500020
         EJECT                                                          85590020
*                                                                       85680020
*                                                                       85770020
*   DATA EXTENT BLOCK                                                   85860002
         IEZDEB                                                  Y02076 85910002
         EJECT                                                          85960002
         IHADSAB                                                 Y02076 86010002
         EJECT                                                          89190020
         IHJDSTAB                                               Y02076  89240002
         EJECT                                                          92880020
TIOT     DSECT                                                          92970020
         IEFTIOT1                                                       93060020
         EJECT                                                          93150020
SRT      DSECT                                                          93240020
         IEFUCBOB                                                       93330020
*                                                                       93420020
*                                                                       93510020
*                                                                       93600020
         END                                                            93690020
./  ADD  SSI=82070229,NAME=IGC0H05B
         TITLE 'IGC0H05B - DUMMY DATA SET PROCESSOR'                    00007002
IGC0H05B CSECT                                                          00021019
*********************************************************************** 00022019
*                                                                       00023019
*                                                                       00024019
*          RELEASE 22 DELETIONS/CHANGES                                 00025019
*          RELEASE 21 DELETIONS/CHANGES                                 00026019
*          RELEASE 20 DELETIONS/CHANGES                                 00027019
*0930                                                            A38814 00027220
*0930                                                            20201  00027520
*                                                                       00028019
*                                                                A28676 00029019
*          RELEASE 3.7 CHANGES ADDITIONS DELETIONS                      00029337
*C224000,A225100-225200                                        @ZA17960 00029637
* APAR OZ31485 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 00029737
*C188000,188300,308000,308010,308040                           @ZSUT222 00030737
*A308116-308124,440200                                         @ZSUT222 00033037
*                                                                       00034037
*TITLE         IGC0H05B----DUMMY DATA SET PROCESSOR                     00035019
*                                                                       00042019
*STATUS CHANGE LEVEL 002                                                00049020
*                                                                       00056019
*FUNCTION/OPERATION- IGC0H05B RECEIVES CONTROL FROM IGC0I05B WHEN       00063019
*              AN ENTRY IN THE REPIO TABLE CORRESPONDS TO A DUMMY       00070019
*              DATA SET.                                                00077019
*                                                                       00084019
*              IGC0H05B EXAMINES EACH ENTRY IN THE REPIO TABLE.         00091019
*              IF AN ENTRY CORRESPONDS TO A NON-DUMMY DATA SET          00098019
*              OR TO A DATA SET THAT WAS DUMMY AT RESTART IT IS         00105019
*              IGNORED.                                                 00112019
*                                                                       00119019
*              IF AN ENTRY CORRESPONDS TO A DUMMY DATA SET THAT         00126019
*              WAS NOT DUMMY AT RESTART TIME, THE DATA SET              00133019
*              ORGANIZATION AT CHECKPOINT TIME IS CHECKED.  IF          00140019
*              THE DATA SET WAS NOT EITHER A BSAM OR QSAM DATA          00147019
*              SET, THE ACCESS METHODS LOADED BY OPEN ARE DELETED,      00152019
*              THE DEB IS UNCHAINED AND FREED AND AN ERROR CODE OF      00157019
*              79 IS PLACED IN THE RESTART WORK AREA.                   00162019
*              THIS SAME ERROR PROCEDURE IS FOLLOWED IF THE CHECKPOINT  00163019
*              AT WHICH RESTART IS OCCURRING WAS TAKEN IN AN            00164019
*              END OF VOLUME EXIT FOR A DATA SET THAT HAS BEEN          00165019
*              MADE DUMMY                                               00166019
*                                                                       00168019
*              IF A QSAM OR BSAM DATA SET HAS BEEN MADE DUMMY           00175019
*              IGC0H05B DOES THE FOLLOWING:                             00182019
*               1. DELETES ACCESS METHODS LOADED BY OPEN                00189019
*                  (EXCEPT FOR SUBSYSTEM DATA SETS).                    00191002
*                                                                       00196019
*               2. UNCHAINS AND FREES THE DEB                           00203019
*                                                                       00210019
*               3. FREES IOBS CREATED BY OPEN (SEE NOTES)               00217019
*                  (EXCEPT FOR SUBSYSTEM DATA SETS).                    00219002
*               4. GETMAIN FOR A DUMMY DEB, STORES ITS ADDRESS IN       00224019
*                  THE DCB AND ADDS THE DEB TO THE DEB CHAIN            00231019
*                  (SEE NOTES)                                          00238019
*                                                                       00245019
*               5. LOADS DUMMY ACCESS METHOD IGG019AV AND SETS          00252019
*                  APPROPRIATE POINTERS TO IT IN THE DCB (SEE NOTES)    00259019
*                                                                       00266019
*ENTRY POINTS  IGC0H05B VIA XCTL FROM IGC0I05B                          00273019
*                                                                       00280019
*INPUT-        REGISTER 1   ADDRESS OF RESTART WORK AREA (TSTWA DSECT)  00287019
*              REGISTER 8   ADDRESS OF THE FIRST TABLE ENTRY            00294019
*                                                                       00301019
*OUTPUT-       SAME AS REGISTER 1 AND 8 ABOVE                           00308019
*                                                                       00315019
*EXITS-NORMAL- IGC0K05B IF A NON-DA DATA SET IS PRESENT                 00322019
*              IGC0M05B IF ALL DATA SETS ARE DA RESIDENT                00329019
*                                                                       00336019
*      ERROR-  IGC0V05B                                                 00343037
*                 079 - IF A DATA SET THAT WAS NOT A QSAM OR BSAM       00343637
*                       DATA SET HAS BEEN MADE DUMMY OR IF THE          00345019
*                       CHECKPOINT AT WHICH RESTART IS OCCURRING        00347019
*                       WAS TAKEN IN AN END OF VOLUME EXIT FOR A        00349019
*                       DATA SET THAT HAS BEEN MADE DUMMY.              00351019
*                 080 - IF AN ISAM/VSAM CI DATA SET HAS BEEN            00353037
*                       MADE DUMMY AT RESTART TIME.                     00355037
*                                                                       00357019
*SVCS USED: GETMAIN,FREEMAIN,DELETE,LOAD,XCTL                           00364019
*                                                                       00371019
*CONTROL BLOCKS REFERENCED- DCB,DEB,TCB,TIOT,CVT                        00378019
*                                                                       00385019
*TABLES/WORK AREAS                                                      00392019
*********************************************************************** 00400019
*                                                                     * 00500019
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 00600019
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 00700019
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 00800019
*    IS 48 BYTES LONG.                                                * 00900019
*                                                                     * 01000019
*********************************************************************** 01100019
*                                                                       01200019
*        ------------------- 4 BYTES -----------------                  01300019
*                                                                       01400019
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  01500019
*        +DATA SET  +           DCB                  +                  01600019
*        + ORGN.    +         ADDRESS                +                  01700019
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                01800019
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  01900019
*        + NO. 1    +         ADDRESS                +                  02000019
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  02100019
*        +NUMBER    +         JFCB TTR               +                  02200019
*        + OF VOLS  +         ADDRESS                +                  02300019
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               02400019
*                                                                       02500019
*     12 +++++++++++++++++++++++                                        02600019
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   02700019
*        +INFO BYTE + NUMBER   +                                        02800019
*        +++++++++++++++++++++++                                        02900019
*                                                                       03000019
*     12 +++++++++++++++++++++++                                        03100019
*        +    OLD   TIOT       +        DA AND UNIT RECORD              03200019
*        +      OFFSET         +                                        03300019
*        +++++++++++++++++++++++                                        03400019
*                                                                       03500019
*                              +++++++++++++++++++++++                  03600019
*                              +FLAG BYTE +FLAG BYTE +                  03700019
*                              +  NO. 2   +  NO. 3   +                  03800019
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  03900019
*        +FLAG BYTE +FLAG BYTE +                     +                  04000019
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  04100019
*        +++++++++++++++++++++++                     + 20               04200019
*        +                                           +                  04300019
*        +                                           +                  04400019
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  04500019
*        +                                           +                  04600019
*        +   VOLUME ID NO. 2                         +                  04700019
*        +                     +++++++++++++++++++++++ 28               04800019
*        +                     +                     +                  04900019
*        +                     +   VOLUME ID NO. 3   +                  05000019
*     32 +++++++++++++++++++++++                     +                  05100019
*        +                                           +                  05200019
*        +                                           +                  05300019
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               05400019
*        +                                           +                  05500019
*        +   VOLUME ID NO. 4                         +                  05600019
*     40 +                     +++++++++++++++++++++++                  05700019
*        +                     +                     +                  05800019
*        +                     +                     +                  05900019
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               06000019
*        +                                           +                  06100019
*        +                                           +                  06200019
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               06300019
*                                                                       06400019
*                                                                       06500019
*           A  DCBTABLE,                                                06600019
*                                                                       06700019
*           B  BUFFER AREA,                                             06800019
*                                                                       06900019
*           C  SEE DSECTS AT END OF LISTING.                            07000019
*                                                                       07100019
*ATTRIBUTES                                                             07200019
*                                                                       07300019
*          A RE-ENTRANT                                                 07400019
*          B RE-USABLE                                                  07500019
*          C ENABLED                                                    07600019
*          D PRIVILEGED                                                 07700002
*                                                                       07800019
*NOTES         THE CODE THAT FREES THE IOBS IS TAKEN FROM CLOSE         07810019
*              MODULE IGG0201B                                          07820019
*                                                                       07830019
*              THE CODE THAT CREATES THE DUMMY DEB AND SETS POINTERS    07840019
*              TO IGG019AV IS TAKEN FROM OPEN MODULE IGG0191C           07850019
*                                                                       07860019
*********************************************************************   07900019
         EJECT                                                          07930019
*********************************************************************** 07960019
*                                                                       08000019
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               08100019
*                                                                       08200019
*********************************************************************** 08300019
*                                                                       08400019
WRKR1    EQU   0                        WDRK/PARAMETER REGISTER         08500019
WRKR2    EQU   1                        WDRK/PARAMETER REGISTER         08600019
DCBR     EQU   2                        CURRENT DCB REGISTER            08700019
BASER    EQU   3                        BASE REGISTER                   08800019
DEBR     EQU   4                        CURRENT DEB REGISTER            08900019
UCBR     EQU   5                        CURRENT UCB REGISTER            09000019
TIOTR    EQU   6                        NEW TIOT REGISTER               09100019
TCBR     EQU   7                        TCB REGISTER                    09200019
TABLR    EQU   8                        BEGINNING TO DCB TABLE REG      09300019
CTABLR   EQU   9                        CURRENT ENTRY IN DCB TABLE      09400019
BUFR     EQU   10                       USER BUFFER AREA                09500019
DSCNTR   EQU   11                       WORK REGISTER                   09600019
WRKR3    EQU   12                       WORK REGISTER                   09700019
WRKR4    EQU   13                       WORK REGISTER                   09800019
WRKR5    EQU   14                       WORK/PARAMETER REGISTER         09900019
WRKR6    EQU   15                       WORK/PARAMETER REGISTER         10000019
         EJECT                                                          10100019
*********************************************************************** 10200019
*                                                                       10300019
*    OFFSETS TO BE USED IN REPI/O PHASE                                 10400019
*                                                                       10500019
*********************************************************************** 10600019
*                                                                       10700019
IS       EQU   X'80'                    INDEXED SEQUENCIAL              10800019
PS       EQU   X'40'                    PHYSICAL SEQUENCIAL             10900019
DA       EQU   X'20'                    DIRECT ACCESS                   11000019
PO       EQU   X'02'                    PARTITIONED ORGANIZATION        11100019
INOROUT  EQU   X'40'                    SYSIN OR SYSOUT DATA SET        11300019
DADEV    EQU   X'20'                    DA DEVICE                       11400019
TPDEV    EQU   X'10'                    TAPE DEVICE                     11500019
UNITREC  EQU   X'04'                    UNIT RECORD EQUIPMENT           11700019
ERRINNSL EQU   X'80'                    ERROR IN NSL ROUTINE            11800019
NSLMTSW  EQU   X'40'                    NSL MOUNT SWITCH                11900019
NSLCOMU  EQU   X'20'                    NSL COMMUNICATION BIT           12000019
BYPASS   EQU   X'10'                    BYPASS LABEL PROCESSING         12100019
NSL      EQU   X'04'                    NON-STANDARD LABEL              12200019
SL       EQU   X'02'                    STANDARD LABEL                  12300019
NL       EQU   X'01'                    NO LABEL                        12400019
GTR5VOL  EQU   X'80'                    GREATER THAN 5 VOLUMES          12500019
POCONCAT EQU   X'40'                    P.O. CONCATENATED               12600019
DAFLAG   EQU   X'80'                    DA DATA SET FLAG                12700019
NONDAFLG EQU   X'40'                    NON-DA DATA SET FLAG            12800019
NSLFLAG  EQU   X'10'                    NSL ROUTINE FLAG                12900019
TYPERST  EQU   X'80'                    IMMEDIATE RESTART               13000019
TABENT   EQU   48                       TABLE ENTRY LENGTH              13100019
WRITE    EQU   X'01'                    WRITE ON TAPE                   13200019
READ     EQU   X'02'                    READ FOR TAPE                   13300019
NOPOP    EQU   X'03'                    NOP                             13400019
SENSE    EQU   X'04'                    SENSE                           13500019
REWIND   EQU   X'07'                    REWIND                          13600019
READBACK EQU   X'0C'                    READBACK                        13700019
UNLOAD   EQU   X'0F'                    REWIND AND UNLOAD               13800019
WTM      EQU   X'1F'                    WRITE TAPE MARK                 13900019
BSFOP    EQU   X'2F'                    BACKWARD SPACE FILE             14000019
FSFOP    EQU   X'3F'                    FORWARD SPACE FILE              14100019
SEARCH   EQU   X'31'                    SEARCH                          14200019
SRCHCNT  EQU   X'05'                    COUNT FOR SEARCH ID             14300019
TIC      EQU   X'08'                    TIC                             14400019
READDA   EQU   X'06'                    READ FOR DA                     14500019
LENJFCB  EQU   X'B0'                    LENGTH OF JFCB                  14600019
LBLLEN   EQU   X'50'                    LENGTH OF LABEL                 14700019
PERMERR  EQU   X'7F'                    PERMANENT ERROR                 14800019
ERR24    EQU   24                       I/O ERROR IN READING IN JFCB    14900019
BUFSEG   EQU   304                                                      15000019
TIOTBASE EQU   24                                                       15100019
TTROFFST EQU   12                                                       15200019
BUSY     EQU   X'80'                                                    15300019
ISORDA   EQU   IS+DA                    IS OR DA                        15400019
IOERROR  EQU   X'20'                    PERMANENT I/O ERROR             15500019
NODIOERR EQU   X'3F'                                                    15600019
TIMES16  EQU   4                                                        15700019
DADEVICE EQU   4                                                        15800019
BASICLN  EQU   32                                                       15900019
ISAM     EQU   X'80'                                                    16000019
QSAMBSAM EQU   X'40'                                                    16100019
EXCP     EQU   X'80'                                                    16150019
BUFAD    EQU   0                   BCB 1ST BUFFER ADDR OFFSET    A38814 16160020
BUFLG    EQU   4                   BCB FLAG OFFSET               A38814 16170020
SPANFLAG EQU   X'80'               SPAN RECORD FLAG              A38814 16180020
K1       EQU   1                                                        16200019
K2       EQU   2                                                        16300019
K3       EQU   3                                                        16400019
K4       EQU   4                                                        16500019
K5       EQU   5                                                        16600019
K6       EQU   6                                                        16700019
K7       EQU   7                   CONSTANT OF 7                 YM7303 16710002
K8       EQU   8                                                        16750000
K9       EQU   9                   CONSTANT OF 9                 YM7303 16760002
K10      EQU   10                                                       16800019
K12      EQU   12                                                       16900019
K13      EQU   13                  CONSTANT OF 13                YM7303 16950002
K16      EQU   16                                                       17000019
K20      EQU   20                                                       17050000
K21      EQU   21                  CONSTANT OF 21                YM7303 17052002
K24      EQU   24                  CONSTANT OF 24                YM7828 17054002
K25      EQU   25                  CONSTANT OF 25                YM7828 17056002
K28      EQU   28                                                       17060000
K30      EQU   30                                                       17100019
K32      EQU   32                                                       17200019
K36      EQU   36                                                       17300019
K46      EQU   46                                                       17400019
K48      EQU   48                                                       17500019
K60      EQU   60                                                       17600019
K61      EQU   61                                                       17700019
K70      EQU   70                                                       17800019
QSAMB    EQU   1                                                        17900019
FIRSTIOB EQU   1                                                        18000019
PCIB     EQU   X'04'                                                    18100019
DUMYDBLN EQU   56                  CONSTANT FOR DUMMY DEB SIZE   YM7341 18300002
READB    EQU   X'20'                                                    18400019
WRITEB   EQU   X'20'                                                    18500019
QOUT     EQU   X'40'                                                    18600019
LOCATEB  EQU   8                                                        18700019
ERR079   EQU   79                       DUMMY D/S ERROR        @ZSUT222 18800037
ERR080   EQU   80                       ISAM/VSAM CI ERROR     @ZSUT222 18830037
TIMES2   EQU   1                                                        18900019
TIMES4   EQU   2                                                        18950019
TIMES8   EQU   3                                                        19000019
BDAMDS   EQU   X'20'                                                    19050019
EOVEXIT  EQU   X'02'                                                    19070019
*                                                                       19100019
*                                       RECORD READY CONSTANTS          19106020
*                                                                       19112020
CPSTART EQU 48                          OFFSET OF BEGIN OF CP    20201  19118020
ONECCW   EQU   8                        LENGTH OF ONE CCW        20201  19124020
TWOCCWS  EQU   16                       LENGTH OF TWO CCW'S      20201  19130020
SETSECTR EQU   X'23'                    COMMAND CODE FOR SET     20201  19136020
*                                       SECTOR                   20201  19142020
NOTUPDTE EQU   X'0B'                    MASK FOR NON UPDATE      20201  19148020
UPDMASK  EQU X'04'                      MASK FOR UPDATE          20201  19154020
NINE     EQU   9                        CONSTANT OF 9            20201  19160020
THREE    EQU   3                        CONSTANT OF 3            20201  19166020
PCISTART EQU   56                       BEGIN OF PCI CP          20201  19172020
*                                                                       19178020
*                                                                       19184020
*********************************************************************** 19200019
         EJECT                                                          19300019
         BALR  BASER,0             ESTABLISH ADDRESSABILITY             19400002
         USING *,BASER             ESTABLISH BASE REGISTER              19500002
         B     BEGIN               BRANCH AROUND EYE CATCHER     Y01909 19550000
         CNOP  0,8                 ALIGN TO A DBL WORD BOUNDARY  Y01909 19560000
         DC    CL8'IGC0H05B'       MODULE NAME                 @ZSUT222 19570037
         DC    CL8'&SYSDATE'       LAST DATE SHIPPED           @ZSUT222 19572037
         DC    CL8'@ZSUT222'       LAST CODE SHIPPED           @ZSUT222 19574037
BEGIN    EQU   *                                                 Y01909 19580000
*                                                                       19600019
         USING IHADCB,DCBR                                              19700019
         USING UCBOB,UCBR                                               19800019
         USING RSDSECT,WRKR4                                            19900019
         USING TIOENTRY,WRKR5                                           20000019
         USING DEBBASIC,DEBR                                            20200002
         USING TCB,TCBR                                                 20300019
         USING TABL,CTABLR                                              20400019
         USING RSTWA,BUFR                                               20500019
*                                                                       20600019
         LR    CTABLR,TABLR        POINT TO START OF TABLE              20700019
         XC    RSRETCOD,RSRETCOD   CLEAR ERROR INDICATORS               20750019
REPDCB10 EQU   *                                                        20800019
         TM    TABFLG1,TABNULL     IS THIS A DUMMY DATA SET      Y02076 20900002
         BO    REPDCB25            BRANCH IF YES                        21000019
REPDCB20 EQU   *                                                        21100019
         TM    TABFLG1,TABLAST     LAST ENTRY                    Y02076 21200002
         BO    REPDCB80            BRANCH IF YES                        21300019
         LA    CTABLR,TABENT(CTABLR)   NEXT ENTRY                       21400019
         B     REPDCB10            GO PROCESS IT                        21500019
REPDCB25 EQU   *                                                        21600019
         L     DCBR,TABDCBAD-1     LOAD DCB ADDRESS                     21700019
         L     DEBR,DCBDEBAD       LOAD DEB ADDRESS                     21800019
         SPACE 4                                                        21850019
****                                                                    21900019
*        CHECK TO SEE IF THE DATA SET WAS DUMMY AT CHKPT TIME.          22000019
*        IF IT WAS, GET NEXT TABLE ENTRY.                               22100019
****                                                                    22260019
         SPACE 2                                                        22320019
         TM    TABFLG2,TABOSSDS    WAS DS SUBSYS AT CHKPT TIME   YM7399 22370002
         BZ    REPDCB28            IF NOT, BRANCH                YM7399 22380002
         L     WRKR2,DEBECBAD      GET USER'S DCB ADDRESS        YM7399 22390002
         MVC   DCBTIOT-IHADCB(2,WRKR2),DCBTIOT UPDATE USER'S DCB YM7399 22392002
         MVC   DCBDEBAD+1-IHADCB(3,WRKR2),DCBDEBAD+1 TIOT OFFSET YM7399 22392402
*                                  AND DEB ADDR FROM SUBSYS ACB  YM7399 22394002
         LR    DCBR,WRKR2          UPDATE THE WORKING DCB ADDR   YM7399 22398002
         B     REPDCB40            GO PROCESS SUBSYSTEM DUMMY    YM7828 22398402
REPDCB28 EQU   *                   NON-SUBSYSTEM ENTRY           YM7399 22398802
         CLC   DEBDEVED(2),LOADNAME+6  WAS OLD DS DUMMY ?      @ZA17960 22400037
         BE    REPDCB20            BRANCH IF YES                        22500019
         CLI   DEBEXSCL,0          DUMMY DATASET ?             @ZA17960 22550037
         BE    REPDCB20            BRANCH IF YES               @ZA17960 22600037
         TM    TABFLG2,TABCIDS     IS IT ISAM/VSAM(CI)           Y02076 22650002
         BO    REPDCB49            TO ERROR IF YES               Y02076 22700002
         LA    WRKR2,DEBBASIC-DEBPREFX NEG OFFSET TO DEB PREFIX  YM7828 22750002
         LNR   WRKR2,WRKR2         SET IT NEG FOR ADD            YM7828 22760002
         AR    WRKR2,DEBR          GET DEB PREFIX ADDR           YM7828 22770002
         USING DEBPREFX,WRKR2      ADDRESS DEB PREFIX            YM7828 22780002
         L     WRKR2,DEBXTNP       GET DEB EXTENSION ADDR        YM7828 22790002
         USING DEBXTN,WRKR2        ADDRESS DEB EXTENSION         YM7828 22792002
         L     WRKR2,DEBXDSAB      GET DSAB ADDRESS              YM7828 22794002
         USING DSAB,WRKR2          ADDRESS DSAB                  YM7828 22796002
         MVC   RSERAS01(K1),DSABFLG4 SAVE CHKPT DS FLAGS         YM7828 22798002
         NI    DSABFLG4,X'FF'-DSABCKDS-DSABCKSI RESET CHKPT FLGS YM7828 22798802
         DROP  WRKR2               DSAB                          YM7828 22799202
         CLI   DEBNMSUB,0          ANY SUBROUTINES LOADED               22800019
         BE    REPDCB39            BRANCH IF NO                         22900019
         SPACE 4                                                        22950019
****                                                                    23000019
*        THE NEXT SECTION OF CODE LOCATES THE SUBROUTINE NAME           23100019
*        SECTION OF THE DEB.                                            23200019
****                                                                    23300019
         LA    WRKR2,BASICLN       LENGTH OF BASIC SECTION              23400019
         CLI   DEBEXSCL,DADEVICE   DIRECT ACCESS DEVICE                 23500019
         BNE   REPDCB32            BRANCH IF NO                         23600019
         OI    TABFLG1,TABDA       SET TEMPORARY DA SW           YM7550 23650002
         SR    WRKR1,WRKR1         CLEAR WRKR1                          23700019
         IC    WRKR1,DEBNMEXT      GET NUMBER OF EXTENTS                23800019
         SLL   WRKR1,TIMES16       MULTIPLY BY 16 TO GET NUMBER         23900019
*                                  OF BYTES                             24000019
         AR    WRKR2,WRKR1         POINT TO ACCESS METHOD SECTION       24100019
         B     REPDCB34            SKIP TAPE-UNIT RECORD CODE           24200019
REPDCB32 EQU   *                                                        24300019
         LA    WRKR2,K4(WRKR2)     POINT TO ACCESS METHOD SECTION       24400019
*                                  (TAPE-UNIT RECORD DEVICE             24500019
*                                  DEPENDANT SECTION IF FOUR            24600019
*                                  BYTES IN LENGTH)                     24700019
REPDCB34 EQU   *                                                        24800019
         SR    WRKR1,WRKR1         CLEAR WRKR1                          24900019
         IC    WRKR1,DEBAMLNG      GET LENGTH OF ACCESS METHOD          25000019
*                                  SECTION OF DEB                       25100019
         TM    TABDSORG,DCBDSGDA   BDAM DATA SET                 Y02049 25120002
         BZ    REPDCB36            BRANCH IF NO                         25140019
         SLL   WRKR1,TIMES4        MULTIPLY BY 4 TO GET LENGTH IN BYTES 25160019
REPDCB36 EQU   *                                                        25180019
         AR    WRKR2,WRKR1         GET OFFSET TO BEGINNING              25200019
*                                  OF ACCESS METHOD NAMES               25300019
         SPACE 4                                                        25310019
****                                                                    25320019
*        THIS SECTION OF CODE DELETES SUBROUTINES LOADED BY OPEN        25330019
****                                                                    25340019
         SPACE 2                                                        25350019
         LA    DEBR,0(DEBR)        CLEAR HIGH ORDER BYTE OF DEBR        25400019
         LA    WRKR3,0(WRKR2,DEBR) POINT TO BEGINNING OF ACCESS         25500019
*                                  METHOD SECTION                       25600019
         SR    WRKR5,WRKR5         CLEAR WRKR5                          25700019
         IC    WRKR5,DEBNMSUB      GET NUMBER OF SUBROUTINES            25800019
         SLL   WRKR5,TIMES2        MULTIPLY BY TWO                      25900019
         AR    WRKR5,WRKR2         GET OFFSET TO END OF DEB             26000019
         LA    DSCNTR,0(DEBR,WRKR5) POINT TO END OF DEB                 26100002
         LR    UCBR,BUFR           SAVE RSWA ADDR                       26200019
         LA    BUFR,K2             CONSTANT 2                           26300019
         SR    DSCNTR,BUFR         POINT TO LAST SUBROUTINE NAME        26400019
         MVC   TABVLID1(K6),LOADNAME   MOVE IGG019 TO W.A.              26500019
REPDCB38 EQU   *                                                        26600019
         MVC   TABVLID2(K2),0(WRKR3)   SET LAST TWO BYTES OF            26700019
*                                  SUBROUTINE NAME FROM DEB             26800019
         DELETE    EPLOC=TABVLID1  DELETE SUBROUTINE                    26900019
         BXLE  WRKR3,BUFR,REPDCB38 DELETE REST OF MODULES               27000019
         LR    BUFR,UCBR           RESTORE RSWA ADDR                    27100019
REPDCB39 EQU   *                                                        27200019
         TM    RSERAS01,DSABCKDS+DSABCKSI CHKPT S/I EXIST        YM7828 27250002
         BNO   REPDCB40            IF NOT, SKIP S/I DELETION     YM7828 27300002
         MVC   TABVLID1(K6),LOADNAME SETUP TO DELETE S/I ERROR   YM7828 27350002
         MVC   TABVLID2(K2),IGG019SI ROUTINE (IGG019SI)          YM7828 27400002
         DELETE EPLOC=TABVLID1     DELETE IT                     YM7828 27410002
*                                                                YM7828 27420002
*        FREEMAIN THE CHECKPOINT PROTECTED DCB                   YM7828 27430002
*                                                                YM7828 27440002
         LA    DCBR,0(,DCBR)       CLEAR BYTE 0 OF DCB ADDR      YM7828 27442002
         LA    WRKR2,K28           GET NEG OFFSET TO START OF    YM7828 27444002
         LNR   WRKR2,WRKR2         PROTECTED DCB PREFIX          YM7828 27446002
         AR    WRKR2,DCBR          GET ADDR OF DCB PREFIX        YM7828 27448002
         ICM   DCBR,B'0111',K25(WRKR2) GET USER'S DCB ADDR       YM7828 27448102
         STCM  DCBR,B'0111',TABDCBAD UPDATE TABLE ENTRY          YM7828 27448202
         SR    WRKR1,WRKR1         CLEAR FREEMAIN PARM REG       YM7828 27448402
         ICM   WRKR1,B'0001',K24(WRKR2) GET FREEMAIN LENGTH      YM7828 27448802
         ICM   WRKR1,B'1000',SP252 GET SUBPOOL 252 ID            YM7828 27449202
         FREEMAIN R,LV=(0),A=(1)   FREE IT                       YM7828 27449602
         EJECT                                                          27450019
****                                                                    27500019
*        THE FOLLOWING SECTION OF CODE UNCHAINS AND DELETES             27600019
*        THE DEB                                                        27700019
****                                                                    27800019
         SPACE 2                                                        27850019
REPDCB40 EQU   *                                                        27900019
         L     TCBR,RSTCBAD        LOAD TCB ADDRESS                     28000019
         LA    DEBR,0(DEBR)        CLEAR HIGH BYTE OF DEBR              28100019
         L     WRKR2,RSINT         LOAD ADDR OF 1ST DEB                 28200002
         LA    WRKR2,0(WRKR2)      CLEAR HIGH ORDER BYTE                28300019
         CR    WRKR2,DEBR          IS THIS THE FIRST DEB                28400019
         BNE   REPDCB42            BRANCH IF NO                         28500019
         MVC   RSINT+1(K3),DEBDEBAD+1   DELETE DEB FROM CHAIN           28600019
         B     REPDCB46            GO FREE DEB CORE                     28700019
REPDCB42 EQU   *                                                        28800019
         CLC   K5(K3,WRKR2),DCBDEBAD+1 DOES THIS DEB POINT TO DEB       28900019
*                                      THAT IS TO BE FREED              29000019
         BE    REPDCB44            BRANCH IF YES                        29100019
         L     WRKR2,K4(WRKR2)     GET ADDRESS OF NEXT DEB              29200019
         B     REPDCB42            GO CHECK NEXT DEB                    29300019
REPDCB44 EQU   *                                                        29400019
         MVC   K5(K3,WRKR2),DEBDEBAD+1 UNCHAIN DEB BY RESETTING         29500019
*                                  DEB POINTER IN PREVIOUS DEB          29600019
REPDCB46 EQU   *                   INSTR MUST FOLLOW             Y02076 29700002
         LR    WRKR5,DEBR          GET DEB ADDR                  Y02076 29702002
         LA    WRKR6,DEBPRFLN      GET PREFIX LENGTH             Y02076 29704002
         SR    WRKR5,WRKR6         CALC ADDR OF DEB PREFIX       Y02076 29706002
         USING DEBPREFX,WRKR5                                    Y02076 29708002
         MVC   RSERAS00(1),DEBPROTG SAVE KEY AND ID              YM7879 29708102
         MVC   RSERAS00+1(1),DEBOPATB SAVE OPEN ATTRIBUTES       YM7879 29708202
         L     WRKR6,DEBXTNP       GET DEB EXTENTION PTR         Y02076 29708402
         ST    WRKR6,TABVLID5+K2   SAVE FOR LATER RESTORE        Y02076 29708802
         DROP  WRKR5                                             Y02076 29709202
         SR    WRKR6,WRKR6         CLEAR REG                     20201  29710002
         TM    DEBOPATB,UPDMASK    UPDATE BIT ON                 20201  29720002
         BNO   REPDC603            BRANCH IF NO                  20201  29730002
         TM    DEBOPATB,NOTUPDTE   ANY BITS OTHER THAN           20201  29740002
*                                  UPDATE                        20201  29750002
         BNZ   REPDC603            BRANCH IF YES                 20201  29760002
         LA    WRKR6,K1            SET THE INDICATOR REG         YM7341 29770002
REPDC603 EQU   *                   INSTR MUST FOLLOW             20201  29780002
         LA    WRKR2,K36           LENGTH OF DEB PREFIX                 29800019
         SR    DEBR,WRKR2          POINT TO BEGINNING OF DEB            29900019
         SR    WRKR1,WRKR1         CLEAR R0                             30000019
         IC    WRKR1,K32(DEBR)     GET LENGTH OF DEB IN DOUBLE          30100019
*                                  WORDS                                30200019
         SLL   WRKR1,TIMES8        MULTIPLY BY EIGHT TO GET             30300019
*                                  LENGTH IN BYTES                      30400019
         O     WRKR1,SP230         SET SUBPOOL                   YM6586 30500002
         LR    WRKR2,DEBR          SET R1 WITH ADDR OF DEB              30600019
         TM    TABFLG2,TABOSSDS    IS THIS A SUBSYSTEM D/S       YM7399 30650002
         BZ    REPDC613            IF NOT, BRANCH                YM5720 30660002
         LA    WRKR2,K28(,WRKR2)   ADJUST TO SUBSYSTEM DEB       YM5720 30670002
*                                  PREFIX ADDR (PREFIX=8 BYTES)  YM5720 30680002
REPDC613 EQU   *                   FREEMAIN THE DEB              YM5720 30690002
         MODESET EXTKEY=DATAMGT    ASSUME DEB KEY                YM6586 30692002
         FREEMAIN  R,LV=(0),A=(1)  FREE THE DEB                         30700019
         MODESET EXTKEY=ZERO       RESUME SUPERVISOR KEY         YM6586 30702002
         SPACE 4                                                        30710019
****                                                                    30720019
*        SEE IF DATA SET MADE DUMMY WAS A QSAM OR BSAM DATA SET         30730019
*        AT CHECKPOINT TIME.  IF IT WAS NOT  PUT ERROR CODE 79 IN       30740019
*        WORK AREA AND GO GET NEXT TABLE ENTRY.                         30750019
****                                                                    30760019
         SPACE 2                                                        30770019
         TM    TABFLG2,TABOSSDS    IS THIS SUBSYS MADE DUMMY     YM7528 30772002
         BO    REPDCB48            IF YES, DSORG IS GOOD         YM7528 30772402
         L     WRKR5,TABVLID5+K2   GET DEB EXTENSION POINTER     Y02049 30773002
         USING DEBXTN,WRKR5                                      Y02049 30775002
         TM    DEBXMCF1,DCBMRECP   IS THIS AN EXCP DATA SET?     Y02049 30775402
         BO    REPDCB47            BRANCH IF YES                        30776019
         TM    DEBXDSO1,DCBDSGPS   QSAM OR BSAM DATA SET         Y02049 30780002
         DROP  WRKR5                                             Y02049 30782002
         BO    REPDCB48            BRANCH IF YES                        30790019
REPDCB47 EQU   *                                                        30795019
         MVI   RSRETCOD+1,ERR079   SET DUMMY DATA SET ERROR    @ZSUT222 30800037
         B     REPDCBER            SAVE THE CURR. ENVIRONMENT  @ZSUT222 30801037
         SPACE 4                                                        30802037
REPDCB49 EQU   *                   INSTR MUST FOLLOW             Y02076 30803037
         MVI   RSRETCOD+K1,ERR080  SET ISAM/VSAM(CI) ERROR     @ZSUT222 30804037
REPDCBER MVC   RSREGSAV(8),MODID   SAVE NAME OF MODULE THAT    @ZSUT222 30811637
*                                  HAS DETECTED THE ERROR.     @ZSUT222 30812037
         STM   0,15,RSREGSAV+8     SAVE CURRENT REGISTERS      @ZSUT222 30812437
         B     REPDCB20            GO GET NEXT ENTRY             Y02076 30813202
****                                                                    30814019
*        CHECK TO SEE IF THE CHECKPOINT AT WHICH RESTART IS OCCURRING   30816019
*        WAS TAKEN IN AND OF VOLUME EXIT FOR THE DATA SET THAT HAS BEEN 30818019
*        MADE DUMMY.  IF IT WAS, AN ERROR CONDITION EXISTS.             30820019
****                                                                    30822019
         SPACE 2                                                        30824019
REPDCB48 EQU   *                                                        30826019
         TM    DCBOFLGS,EOVEXIT    CHKPT TAKEN IN EOV FOR THIS DATA SET 30828019
         BZ    REPDCB47            BRANCH IF YES---ERROR                30830019
         SPACE 4                                                        30832019
****                                                                    30834019
*        CHECK TO SEE IF AN ERROR HAS BEEN PREVIOUSLY DETECTED.         30836019
*        IF ONE HAS BEEN DETECTED, SKIP FURTHER PROCESSING OF THIS      30838019
*        ENTRY.                                                         30840019
****                                                                    30842019
         SPACE 2                                                        30844019
         OC    RSRETCOD,RSRETCOD   ANY PREVIOUS ERRORS                  30846019
         BNZ   REPDCB20            BRANCH IF YES                        30848019
         EJECT                                                          30850019
****                                                                    30900019
*        THIS SECTION OF CODE FREES IOBS CREATED BY OPEN                31000019
****                                                                    31100019
         SPACE 2                                                        31150019
REPDCB50 EQU   *                                                        31220019
         TM    TABFLG2,TABOSSDS    TEST IF SUBSYSTEM D/S         YM7399 31270002
         BO    REPDCB64            YES-BYPASS FREEING IOBS       Y02076 31280002
         XR    WRKR5,WRKR5         CLEAR WRKR5                          31300019
         XR    WRKR1,WRKR1         CLEAR WRKR1                          31400019
         XR    WRKR2,WRKR2         CLEAR WRKR2                          31500019
         IC    WRKR1,DCBIOBL       GET LENGTH OF IOB IN DOUBLE WORDS    31600019
         SLL   WRKR1,TIMES8        LENGTH IN BYTES                      31700019
         IC    WRKR2,DCBNCP        NUMBER OF BSAM CPS                   31800019
         TM    DCBCIND2,QSAMB      QSAM DATA SET                        31900019
         BZ    REPDCB52            BRANCH IF NO                         32000019
         IC    WRKR2,DCBBUFNO      GET NUMBER OF QSAM CPS               32100019
REPDCB52 EQU   *                                                        32200019
         TM    DCBCIND2,PCIB       CHAINED SCHEDULING                   32300019
         BO    REPDCB58            BRANCH IF YES                        32400019
         L     WRKR3,DCBIOBA       LOAD IOB ADDRESS                     32500019
REPDCB54 EQU   *                                                        32600019
         TM    0(WRKR3),FIRSTIOB   IS THIS THE FIRST IOB                32700019
         BO    REPDCB60            BRANCH IF YES                        32800019
         L     WRKR3,0(WRKR3)      GET NEXT IOB                         32900019
         B     REPDCB54            CONTINUE SEARCH FOR FIRST IOB        33000019
REPDCB58 EQU   *                                                        33100019
         L     WRKR3,DCBIOBAD      GET MAIN IOB ADDR                    33200019
         LA    WRKR3,0(WRKR3)      CLEAR HIGH BYTE                      33300019
         LA    WRKR5,K48           CNST OF 48 FOR MAIN IOB              33400019
         TM    TABFLG1,TABDA       USING DA DEVICE               Y02049 33500002
         BZ    REPDCB60            BRANCH IF NO                         33600019
         LA    WRKR5,K32(WRKR5)    ADD 32 FOR D.A.                      33700019
         CLI   PCISTART(WRKR3),SETSECTR IS IT RPS                20201  33720020
         BNE   REPDCB60            BRANCH IF NO                  20201  33740002
         LA    WRKR5,TWOCCWS(WRKR5) ADD ON LENGTH OF TWO         20201  33760002
*                                  CCWS                          20201  33780002
REPDCB60 EQU   *                                                        33800019
         LTR   WRKR2,WRKR2         WERE NUM OF CP'S SPECIFIED           33900019
         BH    REPDCB62            BRANCH IF YES                        34000019
         LA    WRKR2,K1            NO,PROVIDE ONE                       34100019
         TM    TABFLG1,TABDA       IS DIRECT ACCESS USED         Y02049 34106002
         BNO   REPDCB62            BRANCH IF NO                  20201  34112002
         CLI   CPSTART(WRKR3),SETSECTR  IS IT RPS                20201  34118020
         BNE   REPDCB62            BRANCH IF NO                  20201  34124002
         LTR   WRKR6,WRKR6         UPDATE USED                   20201  34130002
         BZ    REPDC604            BRANCH NO                     20201  34136002
         LA    WRKR6,NINE(WRKR2)   THESE 3 INSTRUCTIONS ARE      20201  34142002
         SRL   WRKR6,THREE         NUM OF CHPS + 2               20201  34148002
         SLL   WRKR6,THREE         ROUNDED UP TO NEAREST DW      20201  34154002
         B     REPDC605            BRANCH                        20201  34160002
REPDC604 EQU   *                                                 20201  34166020
         LA    WRKR6,ONECCW        EIGHT FOR ONE CCW             20201  34172002
REPDC605 EQU   *                                                 20201  34178020
         AR    WRKR5,WRKR6         INCREMENT TO ADD SECTOR       20201  34184002
*                                  BYTES TO FREEMAIN SIZE               34190002
REPDCB62 EQU   *                                                        34200019
         MR    WRKR1,WRKR1         NO. OF CP'S * IOB SIZE               34300019
         LA    WRKR2,0(WRKR2,WRKR5)    ADD PCI CONSTANTS IF ANY         34400019
         LR    WRKR1,WRKR2         LENGTH OF REG 0                      34500019
         O     WRKR1,SP0           SET SUBPOOL EQUAL TO 0        YM6586 34600002
         LR    WRKR2,WRKR3         ADDR TO REG1                         34700019
         MODESET KEYADDR=RSERAS00,WORKREG=15 ASSUME IOB/CP KEY   YM6586 34750002
         FREEMAIN  R,LV=(0),A=(1)                                       34800019
         MODESET EXTKEY=ZERO       RESUME SUPERVISOR KEY         YM6586 34810002
         EJECT                                                          34850019
****                                                                    34900019
*        THIS SECTION OF CODE CREATES A DUMMY DEB,                      35000019
*        LOADS DUMMY MODULE IGG019AV,                                   35100019
*        AND SETS POINTERS TO IT IN THE DCB.                            35200019
****                                                                    35300019
         SPACE 2                                                        35320019
****                  GET CORE FOR DUMMY DEB                            35340019
         SPACE 1                                                        35360019
REPDCB64 EQU   *                                                        35400019
         NI    TABFLG1,X'FF'-TABDA RESET POSSIBLE TEMP DA SW     YM7550 35450002
         LA    WRKR1,DUMYDBLN      GET LENGTH OF DUMMY DEB              35500019
         O     WRKR1,SP230         SET SUBPOOL                   YM6586 35600002
         MODESET EXTKEY=DATAMGT    ASSUME DEB KEY                YM6586 35650002
         GETMAIN   R,LV=(0)        GET CORE FOR DUMMY DEB               35700019
         MODESET EXTKEY=ZERO       RESUME SUPERVISOR KEY         YM6586 35750002
         ST    WRKR2,TABVLID2      STORE ADDR OF GOTTEN CORE            35800019
         SPACE 1                                                        35820019
****                  FORMAT DUMMY DEB AND STORE ADDR IN DCB            35840019
         SPACE 1                                                        35860019
         XC    0(DUMYDBLN,WRKR2),0(WRKR2)  CLEAR DUMMY DEB              35900019
         USING DEBPREFX,WRKR2                                    Y02076 35950002
         MVC   DEBXTNP,TABVLID5+K2 ADR ORIG EXT IN DUMMYDEB      Y02076 35960002
         L     WRKR5,DEBXTNP       DEB EXT ADR IN WRKR5          Y02076 35970002
         DROP  WRKR2                                             Y02076 35980002
         LA    DEBR,K16(WRKR2)     POINT TO ACTUAL DEB                  36000019
         ST    DEBR,TABVLID2       TEMP SAVE                            36100019
         MVC   DCBDEBAD+1(K3),TABVLID2+1   MOVE DEB ADDR TO DCB         36200019
         LA    DCBR,0(DCBR)        CLEAR HIGH ORDER BYTE OF DCBR        36230019
         ST    DCBR,DEBDCBAD       STORE DCB ADDR IN DEB                36260019
         MVI   K12(WRKR2),K7       SET DOUBLE WORD CNT IN DEB    YM7341 36300002
         MVI   DEBNMSUB,X'01'      SET ACC METH CNT TO 1         YM7879 36310002
         MVC   DEBPROTG,RSERAS00   PROT KEY & ID FROM OLD DEB    YM7879 36311202
         MVC   DEBOPATB,RSERAS00+1 OPEN ATTRIBUTES FROM OLD DEB  YM7879 36311602
         MVC   X'24'(2,DEBR),LOADNAME+6 19AV'S ID TO END OF DEB  YM7879 36311702
         USING DEBXTN,WRKR5                                      Y02076 36312002
         ST    DEBR,DEBXDBPR       ST DUMMY DEB ADR IN EXT       Y02076 36314002
         DROP  WRKR5                                             Y02076 36316002
         SPACE 1                                                        36320019
****                  ADD DUMMY DEB TO THE DEB CHAIN                    36340019
         SPACE 1                                                        36360019
         L     TCBR,RSTCBAD        LOAD TCB ADDRESS                     36400019
         MVC   DEBDEBB(3),RSINT+1  CHAIN NEW DEB                 YM7879 36470002
         ST    DEBR,RSINT          TO DEB CHAIN                         36540002
         STCM  TCBR,B'0111',DEBTCBB TCB ADDRESS TO DEB           YM7879 36610002
         SPACE                                                          36610520
****                  INSURE VALID FIRST-BUFFER-PTR FOR QSAM     A38814 36611020
         SPACE                                                          36611520
         TM    DCBCIND2,QSAMB      QSAM DATA SET                 A38814 36612020
         BZ    REPDC647            BRANCH IF NOT                 A38814 36612520
         L     WRKR2,DCBBUFCB      FETCH BUFFER CNTRL BLK PTR    A38814 36613020
         LA    WRKR2,0(,WRKR2)     CLEAR HI BYTE                 A38814 36613520
         LTR   WRKR2,WRKR2         BUFFER CNTRL BLK PRESENT      A38814 36614020
         BZ    REPDC647            BRANCH IF NOT                 A38814 36614520
         LA    WRKR3,8(,WRKR2)     GET PTR TO 1ST BUFFER         A38814 36615020
         TM    BUFLG(WRKR2),SPANFLAG USING SPAN RECORDS          A38814 36615520
         BZ    REPDC643            BRANCH IF NOT                 A38814 36616020
         LA    WRKR3,4(,WRKR3)     BUMP 1ST BUFFER PTR BY 4      A38814 36616520
REPDC643 EQU   *                                                 A38814 36617020
         ST    WRKR3,BUFAD(,WRKR2) 1ST BUFFER PTR TO BCB         A38814 36617520
REPDC647 EQU   *                                                 A38814 36618020
         SPACE 1                                                        36620019
****                  LOAD IGG019AV                                     36640019
         SPACE 1                                                        36660019
         MVC   TABVLID1(8),LOADNAME    MODULE NAME OF DUMMY MODULE      36700019
         USING CVTMAP,WRKR2                                      Y02076 36750002
         L     WRKR2,CVTPTR        LOAD ADDRESS OF CVT                  36800019
         L     WRKR2,CVTSVDCB      LOAD ADDRESS OF SVCLIB DCB           36900019
         DROP  WRKR2                                             Y02076 36950002
         LOAD  EPLOC=TABVLID1,DCB=(1)  LOAD IGG019AV                    37000019
         LR    WRKR3,WRKR1         SAVE ADDR OF MODULE                  37100019
         EJECT                                                          37210019
****                                                                    37220019
*        THE FOLLOWING CODE SETS THE APPROPRIATE POINTERS IN THE        37230019
*        DCB TO DUMMY ACCESS METHOD IGG019AV                            37240019
****                                                                    37250019
         SPACE 2                                                        37260019
REPDCB65 EQU   *                                                        37270019
         MVC   DCBCNTRL+1(K3),K1(WRKR3) SET ADDR OF CNTRL/NOTE/  YM7303 37300002
*                                  POINT                                37400002
         MVC   DCBREAD+1(K3),K1(WRKR3) SET ADDR OF READ/WRITE    YM7303 37500002
*                                  /GET/PUT                             37600002
         MVC   DCBCHECK+1(K3),K13(WRKR3) SET ADDR OF CHECK       YM7303 37900002
         MVC   DCBIOBA(K4),K16(WRKR3) MOVE DUMMY IOB ADDR TO DCB YM7303 37950002
         TM    DCBMACF1,DCBMRRD    IS THIS BSAM INPUT            YM7528 38500002
         BO    REPDCB70            BRANCH IF YES                        38600019
         TM    DCBMACF2,DCBMRWRT   IS THIS BSAM OUTPUT           YM7528 38700002
         BO    REPDCB70            BRANCH IF YES                        38800019
         TM    DCBMACF2,DCBMRPUT   QSAM OUTPUT                   YM7528 38900002
         BZ    REPDCB66            BRANCH IF NO                         39000019
         TM    DCBMACF2,DCBMRLCP   PUT--LOCATE                   YM7528 39100002
         BZ    REPDCB20            BRANCH IF NO--GET NEXT TABLE ENTRY   39200019
         MVC   DCBPUT+1(K3),K5(WRKR3) SET ADDR OF DUMMY PUT      YM7303 39500002
         B     REPDCB20            GO PROCESS NEXT ENTRY                39600019
REPDCB66 EQU   *                                                        39700019
         MVC   DCBGET+1(K3),K9(WRKR3) SET ADDR OF DUMMY GET      YM7303 40000002
         B     REPDCB20            GO PROCESS NEXT ENTRY                40100019
REPDCB70 EQU   *                                                        40200019
         MVC   DCBREAD+1(K3),K21(WRKR3) SET READ ADDR IN DCB     YM7303 40500002
         B     REPDCB20            GO PROCESS NEXT ENTRY                40600019
         EJECT                                                          40650019
****                                                                    40700019
*        THIS SECTION OF CODE XCTLS TO THE NEXT LOAD OF RESTART IF      40720019
*        NO ERROR HAS BEEN DETECTED.  THE NEXT LOAD IS DETERMINED       40740019
*        BY AN INDICATOR SET IN THE RESTART WORK AREA. THIS INDICATOR   40760019
*        IS SET BY IGC0I05B.  IF ALL DATA SETS ARE ON DIRECT ACCESS     40780019
*        DEVICES, XCTL IS TO IGC0M05B.  IF ALL DATA SETS ARE NOT ON     40800019
*        DIRECT ACCESS DEVICES, XCTL IS TO IGC0K05B.                    40820019
*                                                                       40840019
*        IF AN ERROR HAS BEEN ENCOUNTERED IN THIS MODULE, XCTL IS TO    40860019
*        IGC0V05B.                                                      40880019
*****                                                                   40900019
         SPACE 2                                                        40920019
REPDCB80 EQU   *                                                        41000019
         L     WRKR4,K4(TABLR)     INITIALIZE TO FIRST W.A.             41100019
         OC    RSRETCOD,RSRETCOD   ANY ERRORS DETECTED                  41110019
         BZ    REPDCB81            BRANCH IF NO                         41120019
         MVC   RSJFCB(8),ERORLOAD  SET UP TO XCTL TO IGC0V05B           41130019
         B     REPDCB82            GO XCTL                              41140019
REPDCB81 EQU   *                                                        41150019
         MVC   RSJFCB(8),TAPELOAD  MOVE IN TAPE LOAD ID                 41200019
         TM    RSDCBFLG,NONDAFLG   IS NON DA FLAG ON                    41300019
         BO    REPDCB82            BRANCH IF YES                        41400019
         MVC   RSJFCB(8),DALOAD    MOVE IN DA LOAD ID                   41500019
REPDCB82 EQU   *                                                        41600019
         LA    WRKR6,RSJFCB+8      SET UP FOR XCTL                      41700019
         LR    WRKR2,BUFR          POINT REG 1 TO RESTART WORK AREA     41800019
         XCTL  EPLOC=RSJFCB,SF=(E,(15))                                 41900019
         EJECT                                                          41950019
*                                                                       43300019
*     CONSTANTS USED IN REPI/O                                          43400019
*                                                                       43500019
SIX      DC    H'6'                     OFFSET FOR VOL SEQ NO           43600019
ERORLOAD DC    CL8'IGC0V05B'            RESTART EXIT MODULE             43700019
TAPELOAD DC    CL8'IGC0K05B'            NON-DA MOUNT/VERIFICATION LOAD  43800019
DALOAD   DC    CL8'IGC0M05B'            DA MOUNT/VERIFICATION LOAD      43900019
LOADNAME DC    CL8'IGG019AV'                                            44000019
MODID    DC    CL8'IGC0H05B'            MODULE IDENT.          @ZSUT222 44020037
IGG019SI DC    CL2'SI'                  LAST 2 CHAR OF S/I MOD   YM7828 44050002
         DS    0F                                                       44100019
SP0      DC    AL1(0)                                            YM6586 44200002
         DC    AL3(0)                                                   44300019
SP230    DC    AL1(230)                                          YM6586 44400002
         DC    AL3(0)                                                   44500019
SP252    DC    AL1(252)                 SUBPOOL 252 ID           YM7828 44510002
DEBPRFLN EQU   16                       LENGTH OF DEB PREFIX     Y02076 44530002
*                                                                     * 44550000
*        MAINTENANCE SPACE                                       Y01909 44600000
*                                                                     * 44650000
PATCH    EQU   (*-IGC0H05B)/10          LENGTH OF PATCH AREA     Y01909 44660002
         DC    XL(PATCH)'00'            TEN PERCENT PATCH AREA   Y01909 44670002
*                                                                     * 44680000
         EJECT                                                          44700019
         IEEVRSWA VER=3                 USE OS/VS2 VERSION OF WA        44800000
         EJECT                                                          44900019
RSDSECT  DSECT                                                          45000019
*                                                                       45100019
*    DATA EXTENT BLOCK                                                  45200019
*                                                                       45300019
RSDEB    DS    0CL48                                                    45400019
RSDEBTCB DC    X'00000000'              TCB ADDRESS                     45500019
RSDEBDEB DC    X'00000000'              DEB ADDRESS                     45600019
*                                                                       45700019
*    DATA CONTROL BLOCK                                                 45800019
*                                                                       45900019
RSDEBOFL DS    0CL1                                                     46000019
RSDEBIRB DC    X'00000000'              IRB ADDRESS                     46100019
RSDEBSYS DC    X'00000000'              1ST IOB ADDR IN SYS.PURGE CHAIN 46200019
RSDEBUSR DC    X'00000000'              1ST IOB ADDR IN USER PRGE CHAIN 46300019
RSDEBECB DC    X'00000000'              PARM.LIST ADDR TO PURGE ECB     46400019
RSDEBID  DS    0CL1                                                     46500019
RSDEBDCB DC    AL4(RSDCBREP)            DCB ADDR                        46600019
RSDEBAPP DS    CL4                      I/O APPENDAGE VECTOR TABLE      46700019
RSDEBMOD DS    0CL1                                                     46800019
RSDEBUCB DS    F                        UCB ADDRESS                     46900019
RSDEBBIN DS    H                        BIN NUMBER                      47000019
RSDEBSCC DS    H                        CYLINDER START ADDRESS          47100019
RSDEBSHH DS    H                        TRACK START ADDRESS             47200019
RSDEBECC DS    H                        CYLINDER END ADDRESS            47300019
RSDEBEHH DS    H                        TRACK END ADDRESS               47400019
RSDEBNTR DS    H                        NO. OF TRACKS IN THIS EXTENT    47500019
*                                                                       47600019
*    EVENT CONTROL BLOCK                                                47700019
*                                                                       47800019
RSECBAD  DS    CL4                      ECB ADDRESS                     47900019
RSDCBDEB DC    AL4(RSDEB)               DEB ADDRESS                     48000019
*                                                                       48100019
RSDCBREP EQU   RSDEB+8                  POINT TO RELATIVE BEGINNING DCB 48200019
*                                                                       48300019
*    INPUT OUTPUT BLOCK                                                 48400019
*                                                                       48500019
RSIOB    DS    0CL40                                                    48600019
RSIOBFG1 DC    X'00'                    I/O FLAGS BYTE 1                48700019
RSIOBFG2 DC    X'00'                    I/O FLAGS BYTE 2                48800019
RSIOBSN1 DS    CL1                      FIRST SENSE BYTE                48900019
RSIOBSN2 DS    CL1                      SECOND SENSE BYTE               49000019
RSIOBECB DC    AL4(RSECBAD)             ECB ADDRESS                     49100019
RSIOBCSW DS    D                        LAST CSW                        49200019
RSIOBCPA DS    AL4(RSCCW1)              CHANNEL PROGRAM ADDRESS         49300019
RSIOBDCB DS    AL4(RSDCBREP)            DCB ADDRESS                     49400019
RSIOBRCP DS    CL4                      RESTART ADDRESS FOR IOS         49500019
RSIOBINC DS    H                        INCREMENT BLOCK COUNT           49600019
RSIOBECT DS    H                        NO. OF ERROR ENTRIES            49700019
RSIOBDAD DS    D                        SEEK ADDRESS FOR DA             49800019
*                                                                       49900019
*    CHANNEL PROGRAM                                                    50000019
*                                                                       50100019
RSCCWLST DS    0CL24                                                    50200019
RSCCW1   DS    D                        CCW1                            50300019
RSCCW2   DS    D                        CCW2                            50400019
RSCCW3   DS    D                        CCW3                            50500019
*                                                                       50600019
*    BUFFER SEGMENT FOR EXTERNAL BLOCKS                                 50700019
*                                                                       50800019
RSBUFSEG DS    0CL176                                                   50900019
RSJFCB   EQU   RSBUFSEG                                                 51000019
*                                                                       51100019
*********************************************************************** 51200019
*                                                                       51300019
*                  JFCB                                                 51400019
*                                                                       51500019
*********************************************************************** 51600019
*                                                                       51700019
JFCBDSNM DS    CL44                         DATA SET NAME               51800019
JFCBELNM DS    CL8                          ELEMENT NAME OR VERSION     51900019
JFCBTSDM DS    CL1                          TASK SCHEDULER - DATA       52000019
*                                            MANAGEMENT INTERFACE BYTE  52100019
JFCBSYSC DS    CL13                         SYSTEM CODE                 52200019
JFCBLTYP DS    CL1                          LABEL TYPE AND USER'S-LABEL 52300019
*                                            INDICATOR                  52400019
         DS    CL1                          NOT USED                    52500019
JFCBFLSQ DS    CL2                          FILE SEQUENCE NUMBER        52600019
JFCBVLSQ DS    CL2                          VOLUME SEQUENCE NUMBER      52700019
JFCBMASK DS    CL8                          DATA MANAGEMENT MASK        52800019
JFCBCRDT DS    CL3                          DATA SET CREATION DATE      52900019
JFCBXPDT DS    CL3                          DATA SET EXPIRATION DATE    53000019
JFCBIND1 DS    CL1                          INDICATOR BYTE 1            53100019
JFCBRLSE EQU   64                            BITS 0 AND 1 - EXTERNAL    53200019
*                                            STORAGE RELEASE INDICATOR  53300019
JFCBLOCT EQU   16                            BITS 2 AND 3 - DATA SET    53400019
*                                            HAS BEEN LOCATED           53500019
JFCBNEWV EQU   4                             BITS 4 AND 5 - NEW VOLUME  53600019
*                                            ADDED TO DATA SET          53700019
JFCBPMEM EQU   1                             BITS 6 AND 7 - DATA SET IS 53800019
*                                            A MEMBER OF A PODS OR GDG  53900019
JFCBIND2 DS    CL1                          INDICATOR BYTE 2            54000019
JFCBSTAT EQU   64                            BITS 0 AND 1 - DATA SET    54100019
*                                            STATUS (NEW, OLD, OR MOD)  54200019
JFCBSCTY EQU   16                            BITS 2 AND 3 - DATA SET    54300019
*                                            SECURITY INDICATOR         54400019
JFCBUFNO DS    0AL1                                                     54500019
JFCBUFRQ DS    AL1                      BUFFER REQUESTED                54600019
JFCBFTEK DS    0BL1                                                     54700019
JFCBFALN DS    BL1                      BUFFER ALIGNMENT                54800019
JFCBUFL  DS    AL2                      BUFFER LENGTH                   54900019
JFCEROPT DS    BL1                      ERROR ROUTINE                   55000019
JFCTRTCH DS    0BL1                                                     55100019
JFCKEYLE DS    0AL1                                                     55200019
JFCMODE  DS    0BL1                                                     55300019
JFCCODE  DS    0BL1                                                     55400019
JFCSTACK DS    0BL1                                                     55500019
JFCPRTSP DS    BL1                      PRINTER SPACING                 55600019
JFCDEN   DS    BL1                      TAPE DENSITY                    55700019
JFCLIMCT DS    AL3                      NO. OF TRKS.TO BE SEARCHED      55800019
JFCDSORG DS    BL2                      DATA SET ORGANIZATION           55900019
JFCRECFM DS    BL1                      RECORD FORMAT                   56000019
JFCOPTCD DS    BL1                      OPTION CODES                    56100019
JFCBLKSI DS    AL2                      BLOCK SIZE                      56200019
JFCLRECL DS    AL2                      LOGICAL RECORD LENGTH           56300019
JFCNCP   DS    AL1                      NO. OF CHANNEL PROGRAM          56400019
JFCNTM   DS    AL1                      NO. OF TRKS. FOR MASTER INDEX   56500019
JFCRKP   DS    AL2                      RELATIVE POSITION OF KEY        56600019
JFCCYLOF DS    AL1                      NO. OF TRKS FOR OVERFLOW        56700019
JFCDBUFN DS    AL1                      RESERVED                        56800019
JFCINTVL DS    AL1                      INTENTIONAL INTERVAL            56900019
JFCCPRI  DS    BL1                      PRIORITY                        57000019
JFCSOWA  DS    AL2                      SIZE OF WORKAREA                57100019
JFCBNTCS DS    CL1                          NUMBER OF OVERFLOW TRACKS   57200019
JFCBNVOL DS    CL1                          NUMBER OF VOLUME SERIAL     57300019
*                                            NUMBERS                    57400019
*                                            NUMBERS                    57600019
JFCBVOLS DS    CL30                         VOLUME SERIAL NUMBERS (THE  57700019
*                                            FIRST FIVE)                57800019
JFCBEXTL DS    CL1                          LENGTH OF BLOCK OF EXTRA    57900019
*                                            VOLUME SERIAL NUMBERS      58000019
*                                            (BEYOND FIVE)              58100019
JFCBEXAD DS    CL3                          TRACK ADDRESS OF BLOCK OF   58200019
*                                            EXTRA VOL SERIAL NUMBERS   58300019
JFCBPQTY DS    CL3                          PRIMARY QUANTITY OF D.A.    58400019
*                                            STORAGE REQUIRED           58500019
JFCBCTRI DS    CL1                          INDICATES WHETHER CYLINDERS 58600019
*                                            TRACKS, OR RECORDS ARE     58700019
*                                            SPECIFIED IN JFCBPQTY AND  58800019
*                                            JFCBSQTY                   58900019
JFCBSQTY DS    CL3                          SECONDARY QUANTITY OF D.A.  59000019
*                                            STORAGE REQUIRED           59100019
JFCBIND3 DS    CL1                          INDICATOR BYTE 3            59200019
JFCBCNTG EQU   64                            BITS 0 AND 1 - CONTIGUOUS  59300019
*                                            STORAGE INDICATOR          59400019
JFCBMXIG EQU   16                            BITS 2 AND 3 - MAXIMUM     59500019
*                                            AVAILABLE EXTENT INDICATOR 59600019
JFCBALXI EQU   4                             BITS 4 AND 5 - ALL EXTENTS 59700019
*                                            INDICATOR                  59800019
JFCBRNDC EQU   1                             BITS 6 AND 7 - ROUND       59900019
*                                            CYLINDER INDICATOR         60000019
JFCBDQTY DS    CL3                          QUANTITY OF D.A. STORAGE    60100019
*                                            REQUIRED FOR A DIRECTORY   60200019
JFCBSPNM DS    CL3                          CORE ADDRESS OF THE JFCB    60300019
*                                            WITH WHICH CYLINDERS ARE   60400019
*                                            SPLIT                      60500019
JFCBABST DS    CL2                          RELATIVE ADDRESS OF FIRST   60600019
*                                            TRACK TO BE ALLOCATED      60700019
JFCBSBNM DS    CL3                          CORE ADDRESS OF THE JFCB    60800019
*                                            FROM WHICH SPACE IS TO BE  60900019
*                                            SUBALLOCATED               61000019
JFCBDRLH DS    CL3                          AVERAGE DATA RECORD LENGTH  61100019
JFCBVLCT DS    CL1                          VOLUME COUNT                61200019
JFCBSPTN DS    CL1                          NUMBER OF TRACKS PER        61300019
*                                            CYLINDER TO BE USED BY     61400019
*                                            THIS DATA SET WHEN SPLIT   61500019
*                                            CYLINDER IS INDICATED      61600019
JFCBLGTH EQU   176                          LENGTH OF JFCB              61700019
JFCBEND  EQU   *                                                        61800019
*                                                                       61900019
         ORG   RSBUFSEG+176             ORG BACK TO BUFFER SEGMENT      62000019
RSSTATUS DS    0CL8                                                     62100019
RSSTAT1  DS    CL1                      STATUS BYTE 1                   62200019
RSSTAT2  DS    CL1                      STATUS BYTE 2                   62300019
RSSTAT3  DS    CL1                      STATUS BYTE 3                   62400019
RSSTAT4  DS    CL1                      STATUS BYTE 4                   62500019
         DS    F                        RESERVED FOR FUTURE USE         62600019
         EJECT                                                          62700019
         CVT   DSECT=YES,PREFIX=YES,LIST=YES                     Y02076 62750002
         EJECT                                                          63000019
*                                                                       63100019
*                                                                       63200019
*   TASK CONTROL BLOCK                                                  63300019
*                                                                       63400019
*                                                                       63500019
         CNOP  0,4                                                      63600019
TCB      DSECT                                                          63700019
TCBRBP   DS    F                       POINTER TO EXECUTING RB          63800019
TCBPIE   DS    F                       POINTER TO PROG. INTERRUPT EL.   63900019
TCBDEB   DS    F                       POINTER TO DEB QUEUE             64000019
TCBTIO   DS    F                       POINTER TO TIOT                  64100019
TCBCMP   DS    F                       TASK COMPLETION CODE             64200019
TCBTRN   DS    F                       TESTRAN FIELD                    64300019
TCBMSS   DS    F                       DATA BLOCK QUEUE ELEMENT POINTER 64400019
TCBPRTK  DS    CL1                     PROTECTION TAG                   64500019
TCBFLGS  DS    FL5                     FLAG BYTES                       64600019
TCBLMP   DS    CL1                     LIMIT PRIORITY                   64700019
TCBDSP   DS    CL1                     DISPATCHING PRIORITY             64800019
TCBLLS   DS    F                       POINTER TO LOAD LIST             64900019
TCBJLB   DS    F                       POINTER TO JOBLIB DCB            65000019
TCBJSE   DS    F                       LIST OF INACTIVE PROGRAMS ADDR.  65100019
TCBGRS   DS    CL64                    GENERAL REGISTER SAVE AREA       65200019
TCBIDF   DS    CL1                     TCB IDENTIFIER FIELD             65300019
TCBFSA   DS    CL3                     POINTER TO 1ST PROB.PROG.SAVEAR  65400019
TCBTCB   DS    F                       NEXT TCB ON READY QUEUE POINTER  65500019
TCBTME   DS    F                       POINTER TO TIMER ELEMENT         65600019
         EJECT                                                          65700019
         DCBD  DSORG=PS                                                 65800019
         EJECT                                                          65900019
*                                                                       66000019
*                                                                       66100019
*   DATA EXTENT BLOCK                                                   66200002
*                                                                       66300019
         IEZDEB                                                  Y02076 66350002
         EJECT                                                          70300019
         IHJDSTAB                                                Y02076 70350002
         EJECT                                                          74400019
TIOT     DSECT                                                          74500019
         IEFTIOT1                                                       74600019
         EJECT                                                          74700019
SRT      DSECT                                                          74800019
         IEFUCBOB                                                       74900019
         IHADSAB                                                        74950002
*                                                                       75000019
*                                                                       75100019
*                                                                       75200019
         END                                                            75300019
./  ADD  SSI=81150450,NAME=IGC0I05B
         TITLE 'IGC0I05B  JFCB PROCESSOR - TABLE COMPLETION MODULE     *00100018
                      REPOSITION I/O  RESTART-SVC 52  OS/360'           00200018
IGC0I05B CSECT                                                          00300018
*              OS                                                       00350002
*          RELEASE 18 DELETIONS                                         00400018
*          RELEASE 19 DELETIONS                                         00500018
*                                                                  O100 00530019
* 173000                                                         A27816 00560019
*          RELEASE 20 DELETIONS                                         00600018
*          RELEASE 21 DELETIONS                                         00700018
*0790                                                            A44121 00750021
*                                                                       00800002
*              OS/VS2                                                   00850002
*                                                                       00900002
*          RELEASE 2 DELETIONS                                          01050002
*0000203000                                                     YA03686 01100002
* APAR OZ31486 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 01150037
*C150840,269000                                                @ZSUT222 01180037
*A269200-269600,337530                                         @ZSUT222 01210037
* STATUS CHANGE LEVEL 004                                               01300021
*                                                                       01400018
*TITLE -       TABLE COMPLETION MODULE                                  01500018
*                                                                       01600018
*STATUS -      INITIAL CODE                                             01700018
*                                                                       01800018
*FUNCTION -    CONTROL IS PASSED FROM IGC0G05B IN ORDER TO COMPLETE THE 01900018
*              TABLE ENTRIES FOR ALL DATA SETS WITH PHYSICAL SEQUENTIAL 02000018
*              ORGANIZATION WHICH ARE COMPOSED OF MORE THAN 5 VOLS.     02100018
*                                                                       02200018
*              TESTS ARE MADE ON EACH TABLE ENTRY FOR DSORG = PS WITH   02300018
*              VOL SEQ NO GREATER THAN 5.  IF THESE CONDITIONS EXIST    02400018
*              ONE OR MORE JFCB EXTENSIONS ARE READ AND THE CORRECT     02500018
*              VOLID IS MOVED TO THE APPROPRIATE POSITION IN THE TABLE  02600018
*              ENTRY.  TABLE ENTRIES SPECIFYING DSORG OTHER THAN PS,    02700002
*              GREATER THAN 5 VOLS ARE SKIPPED.                         02800018
*                                                                       02900018
*              IF AN ERROR CONDITION IS ENCOUNTERED AN ERROR CODE IS    03000018
*              SET IN THE RESTART WORKAREA AND CONTROL IS PASSED TO     03100018
*              IGC0V05B, OTHERWISE CONTROL IS PASSED TO IGC0K05B OR TO  03200018
*              IGC0H05B, DEPENDING UPON THE DEVICE TYPES OF THE DATA    03300002
*              SETS ENCOUNTERED IN THE TABLE.                           03400018
*                                                                       03500018
*ENTRY POINTS- THIS MODULE IS ENTERED BY IGC0G05B.                      03550002
*                                                                       03560002
*INPUT -       REGISTER  1    ADDR OF RESTART WORKAREA (RSTWA DSECT)    03600018
*              REGISTER  8    ADDR OF FIRST TABLE ENTRY                 03700018
*                                                                       03800018
*OUTPUT -      SAME AS REGISTER 1 AND 8 ABOVE                           03900018
*                                                                       04000018
*EXIT -        TO IGC0K05B IF A NON-DA DATA SET IS ENCOUNTERED          04100018
*              TO IGC0H05B IF ALL DATA SETS ARE DA RESIDENT             04200002
*              TO IGC0V05B IF AN ERROR CONDITION IS ENCOUNTERED:        04300037
*              025 - ERROR DURING READ JFCB                             04330037
*                                                                       04400018
*TABLES/WORKAREAS                                                       04500018
*                                                                       04600018
*********************************************************************** 04700018
*                                                                     * 04800018
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 04900018
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 05000018
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 05100018
*    IS 48 BYTES LONG.                                                * 05200018
*                                                                     * 05300018
*********************************************************************** 05400018
*                                                                       05500018
*        ------------------- 4 BYTES -----------------                  05600018
*                                                                       05700018
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  05800018
*        +DATA SET  +           DCB                  +                  05900018
*        + ORGN.    +         ADDRESS                +                  06000018
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                06100018
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  06200018
*        + NO. 1    +         ADDRESS                +                  06300018
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  06400018
*        +NUMBER    +         JFCB TTR               +                  06500018
*        + OF VOLS  +         ADDRESS                +                  06600018
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               06700018
*                                                                       06800018
*     12 +++++++++++++++++++++++                                        06900018
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   07000018
*        +INFO BYTE + NUMBER   +                                        07100018
*        +++++++++++++++++++++++                                        07200018
*                                                                       07300018
*     12 +++++++++++++++++++++++                                        07400018
*        +    OLD   TIOT       +        DA AND UNIT RECORD              07500018
*        +      OFFSET         +                                        07600018
*        +++++++++++++++++++++++                                        07700018
*                                                                       07800018
*                              +++++++++++++++++++++++                  07900018
*                              +FLAG BYTE +FLAG BYTE +                  08000018
*                              +  NO. 2   +  NO. 3   +                  08100018
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  08200018
*        +FLAG BYTE +FLAG BYTE +                     +                  08300018
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  08400018
*        +++++++++++++++++++++++                     + 20               08500018
*        +                                           +                  08600018
*        +                                           +                  08700018
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  08800018
*        +                                           +                  08900018
*        +   VOLUME ID NO. 2                         +                  09000018
*        +                     +++++++++++++++++++++++ 28               09100018
*        +                     +                     +                  09200018
*        +                     +   VOLUME ID NO. 3   +                  09300018
*     32 +++++++++++++++++++++++                     +                  09400018
*        +                                           +                  09500018
*        +                                           +                  09600018
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               09700018
*        +                                           +                  09800018
*        +   VOLUME ID NO. 4                         +                  09900018
*     40 +                     +++++++++++++++++++++++                  10000018
*        +                     +                     +                  10100018
*        +                     +                     +                  10200018
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               10300018
*        +                                           +                  10400018
*        +                                           +                  10500018
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               10600018
*                                                                       10700018
*                                                                       10800018
*           A  DCBTABLE,                                                10900018
*                                                                       11000018
*           B  BUFFER AREA,                                             11100018
*                                                                       11200018
*           C  SEE DSECTS AT END OF LISTING.                            11300018
*                                                                       11400018
*ATTRIBUTES                                                             11500018
*                                                                       11600018
*          A RE-ENTRANT                                                 11700018
*          B RE-USABLE                                                  11800018
*          C ENABLED                                                    11900018
*          D PRIVILEGED                                                 12000002
*                                                                       12100018
*********************************************************************   12200018
*                                                                       12300018
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               12400018
*                                                                       12500018
*********************************************************************** 12600018
*                                                                       12700018
WRKR1    EQU   0                        WDRK/PARAMETER REGISTER         12800018
WRKR2    EQU   1                        WDRK/PARAMETER REGISTER         12900018
DCBR     EQU   2                        CURRENT DCB REGISTER            13000018
BASER    EQU   3                        BASE REGISTER                   13100018
DEBR     EQU   4                        CURRENT DEB REGISTER            13200018
UCBR     EQU   5                        CURRENT UCB REGISTER            13300018
TIOTR    EQU   6                        NEW TIOT REGISTER               13400018
TCBR     EQU   7                        TCB REGISTER                    13500018
TABLR    EQU   8                        BEGINNING TO DCB TABLE REG      13600018
CTABLR   EQU   9                        CURRENT ENTRY IN DCB TABLE      13700018
BUFR     EQU   10                       USER BUFFER AREA                13800018
DSCNTR   EQU   11                       WORK REGISTER                   13900018
WRKR3    EQU   12                       WORK REGISTER                   14000018
WRKR4    EQU   13                       WORK REGISTER                   14100018
WRKR5    EQU   14                       WORK/PARAMETER REGISTER         14200018
WRKR6    EQU   15                       WORK/PARAMETER REGISTER         14300018
*                                                                       14400018
*********************************************************************** 14500018
*                                                                       14600018
*    OFFSETS TO BE USED IN REPI/O PHASE                                 14700018
*                                                                       14800018
*********************************************************************** 14900018
*                                                                       15000018
IS       EQU   X'80'                    INDEXED SEQUENCIAL              15002018
PS       EQU   X'40'                    PHYSICAL SEQUENCIAL             15004018
DA       EQU   X'20'                    DIRECT ACCESS                   15006018
PO       EQU   X'02'                    PARTITIONED ORGANIZATION        15008018
INOROUT  EQU   X'40'                    SYSIN OR SYSOUT DATA SET        15012018
TPDEV    EQU   X'10'                    TAPE DEVICE                     15016018
UNITREC  EQU   X'04'                    UNIT RECORD EQUIPMENT           15020018
ERRINNSL EQU   X'80'                    ERROR IN NSL ROUTINE            15022018
NSLMTSW  EQU   X'40'                    NSL MOUNT SWITCH                15024018
NSLCOMU  EQU   X'20'                    NSL COMMUNICATION BIT           15026018
BYPASS   EQU   X'10'                    BYPASS LABEL PROCESSING         15028018
NSL      EQU   X'04'                    NON-STANDARD LABEL              15030018
SL       EQU   X'02'                    STANDARD LABEL                  15032018
NL       EQU   X'01'                    NO LABEL                        15034018
POCONCAT EQU   X'40'                    P.O. CONCATENATED               15038018
DAFLAG   EQU   X'80'                    DA DATA SET FLAG                15040018
NONDAFLG EQU   X'40'                    NON-DA DATA SET FLAG            15042018
NSLFLAG  EQU   X'10'                    NSL ROUTINE FLAG                15044018
TYPERST  EQU   X'80'                    IMMEDIATE RESTART               15046018
TABENT   EQU   48                       TABLE ENTRY LENGTH              15048018
WRITE    EQU   X'01'                    WRITE ON TAPE                   15050018
READ     EQU   X'02'                    READ FOR TAPE                   15052018
NOPOP    EQU   X'03'                    NOP                             15054018
SENSE    EQU   X'04'                    SENSE                           15056018
REWIND   EQU   X'07'                    REWIND                          15058018
READBACK EQU   X'0C'                    READBACK                        15060018
UNLOAD   EQU   X'0F'                    REWIND AND UNLOAD               15062018
WTM      EQU   X'1F'                    WRITE TAPE MARK                 15064018
BSFOP    EQU   X'2F'                    BACKWARD SPACE FILE             15066018
FSFOP    EQU   X'3F'                    FORWARD SPACE FILE              15068018
SEARCH   EQU   X'31'                    SEARCH                          15070018
SRCHCNT  EQU   X'05'                    COUNT FOR SEARCH ID             15072018
TIC      EQU   X'08'                    TIC                             15074018
READDA   EQU   X'06'                    READ FOR DA                     15076018
LENJFCB  EQU   X'B0'                    LENGTH OF JFCB                  15078018
LBLLEN   EQU   X'50'                    LENGTH OF LABEL                 15080018
PERMERR  EQU   X'7F'                    PERMANENT ERROR                 15082018
ERR025   EQU   25                       ERROR IN READING JFCB  @ZSUT222 15084037
BUFSEG   EQU   304                                                      15100018
TIOTBASE EQU   24                                                       15300018
TTROFFST EQU   12                                                       15400018
BUSY     EQU   X'80'                                                    15500018
ISORDA   EQU   IS+DA                    IS OR DA                        15560018
IOERROR  EQU   X'20'                    PERMANENT I/O ERROR             15620018
NODIOERR EQU   X'3F'                                                    15660018
PCI      EQU   X'04'                    CHAINED SCHEDULING       A27816 15666019
COMPWOE  EQU   X'7F'                    COMPLETE NO ERROR        A27816 15672019
NULLDFLG EQU   X'20'                                               O100 15680019
D24      EQU   24                       CONSTANT TWENTY FOUR     Y02076 15690002
DEBPAGFX EQU   X'10'                    DEB PAGE FIXED INDR      YM7340 15692002
*                                                                       15700018
*********************************************************************** 15800018
*                                                                       15900018
         BALR  BASER,0                  ESTABLISH ADDRESSABILITY        16000018
         USING *,BASER                  ESTABLISH BASE REGISTER         16100018
         B     BEGIN               BRANCH AROUND EYE CATCHER     Y01909 16150000
         CNOP  0,8                 ALIGN TO A DBL WORD BOUNDARY  Y01909 16160000
         DC    CL8'IGC0I05B'       MODULE NAME                 @ZSUT222 16170037
         DC    CL8'&SYSDATE'       LAST DATE SHIPPED           @ZSUT222 16172037
         DC    CL8'@ZSUT222'       LAST CODE SHIPPED           @ZSUT222 16174037
BEGIN    EQU   *                                                 Y01909 16180000
*                                                                       16200018
         USING IHADCB,DCBR                                              16300018
         USING UCBOB,UCBR                                               16400018
         USING RSDSECT,WRKR4                                            16500018
         USING TIOENTRY,WRKR5                                           16600018
         USING CVT,WRKR2                                                16700018
         USING DEBBASIC,DEBR                                     Y02076 16750002
         USING TCB,TCBR                                                 16900018
         USING TABL,CTABLR                                              17000018
         USING RSTWA,BUFR                                               17100018
*                                                                       17200018
         L     DCBR,RSCKDCB        LOAD ADDR OF CHKPT DCB               17230018
         NI    DCBIFLGS,NODIOERR   TURN OFF POSSIBLE ERROR FLAGS        17260018
         TM    DCBCIND2,PCI             CHAINED SCHEDULING       A27816 17268019
         BNO   REPTAB                   NO, BRANCH               A27816 17276019
         L     WRKR4,DCBIOBAD           GET IOB PREFIX ADDR      A27816 17284019
         MVI   4(WRKR4),COMPWOE         POST MAIN IOB COMPLETE   A27816 17292019
REPTAB   LR    CTABLR,TABLR             INITIALIZE CTABLR        A27816 17342019
*********************************************************************** 17392002
*   GET SPACE FOR QMNGRIO PARAMETER LIST AND WORK AREA THEN INITIALIZE  17394002
*   IT.  QMNGRIO IS USED FOR READING IN THE JFCB EXTENTION FROM THE   * 17396002
*   SCHEDULER WORK AREA (SWA) FOR DATA SETS HAVING GREATER THAN 5 VOL * 17398002
*********************************************************************** 17398402
         ICM   WRKR1,ADDRBYTS,QMNGWALN  LENGTH OF QMNGR P.L.+WA  Y02076 17398802
         ICM   WRKR1,HIORDER,SP253      SUBPOOL 253              Y02076 17399202
         GETMAIN  R,LV=(0)              ISSUE GETMAIN            Y02076 17399602
         USING QMIOP,WRKR2              REG 1 PTS TO QMNGR P.L.  Y02076 17399702
         XC    QMITCBAD(D24),QMITCBAD   CLEAR PARM LIST          Y02076 17399902
         LA    WRKR1,QMWAOFST           GET OFFSET TO WA         Y02076 17433202
         AR    WRKR1,WRKR2              CALC ADR OF WORK AREA    Y02076 17443202
         ST    WRKR1,QMIWRKAD           STORE IN PARM LIST       Y02076 17453202
         L     TCBR,RSTCBAD             GET TCB ADR              Y02076 17463202
         ST    TCBR,QMITCBAD            STORE TCB AD IN P.L.     Y02076 17465202
         LA    WRKR1,JFCBXLNT           GET JFCB XTN LENGTH      Y02076 17465602
         STH   WRKR1,QMIRECL            STORE RECORD LNGTH IN PL.Y02076 17466002
         MVI   QMIFLAGS,QMIOREAD        SET READ FUNCTION        Y02076 17466502
         ST    WRKR2,QMNPRMWA           SAVE QMNGRIO P.L. ADR    Y02076 17466602
         B     REPDCB22                 BRANCH TO INITIALIZE PTRS       17466702
*                                                                       17500018
REPDCB20 EQU   *                                                        17600018
*                                                                       17700018
         LA    CTABLR,TABENT(CTABLR)    TO NEXT ENTRY                   17800018
*                                                                       17900018
REPDCB22 EQU   *                                                        18000018
*                                                                       18100018
         L     DCBR,TABDCBAD-1          GET DCB ADDR                    18200018
         L     DEBR,DCBDEBAD            GET DEB ADDR                    18300018
*****************************************************************YM7003 18350002
*        RESET THE DEBRRQ FIELD FOR ALL DATA SETS EXCEPT         YM7003 18360002
*        VSAM, TCAM, AND SUBSYSTEM.  THIS IS NECESSARY SINCE     YM7003 18370002
*        THE RELATED REQUEST QUEUE ADDRESS WILL BE INVALID       YM7003 18380002
*        AFTER A RESTART.  NOTE- VSAM DATA SETS DO NOT HAVE      YM7003 18390002
*        A TABLE ENTRY AND, THEREFORE, WILL BE AUTOMATICALLY     YM7003 18392002
*        EXCLUDED.                                               YM7003 18394002
*****************************************************************YM7003 18398002
         TM    TABFLG1,TABTCAM+TABSYS   D/S TCAM OR SUBSYSTEM    YM7003 18398402
         BNZ   REPDCB23                 IF YES, SKIP DEBRRQ ZERO YM7003 18398802
         TM    TABFLG2,TABOSSDS         WAS IT AN OLD SUBSYS     YM7399 18399202
         BO    REPDCB23                 IF YES, SKIP DEBRRQ ZERO YM7399 18399302
         XC    DEBRRQ+1(3),DEBRRQ+1     ZERO DEBRRQ              YM7003 18399602
REPDCB23 EQU   *                        SKIP DEBRRQ ZERO ENTRY   YM7003 18399702
         LR    WRKR4,DEBR               GET DEB ADDRESS          YM7340 18399802
         SH    WRKR4,AVTOFSET           PT AVT IF PART OF DEB    YM7340 18399902
         CLM   WRKR4,B'0111',DEBAPPB    IS AVT IN DEB PREFIX     YM7340 18433202
         BNE   NOAVT                    BR IF AVT NOT IN DEB     YM7340 18443202
         NI    DEBSIOAB-DEBAVT(WRKR4),X'FF'-DEBPAGFX RESET DEB   YM7340*18453202
                                        PAGE FIXED - EXCP WILL   YM7340*18463202
                                        RE-FIX ON 1ST EXCP       YM7340 18465202
NOAVT    EQU   *                        AVT NOT PART OF DEB      YM7340 18465602
         L     WRKR4,TABSEGAD-1         GET CURRENT WORK SEG            18466702
         SR    UCBR,UCBR                CLEAR UCBR                      18500018
*                                                                       18600018
         TM    TABFLG2,TABG5V           NO. VOLS. GREATER THAN 5        18700002
         BZ    REPDCB24                 NO - BRANCH                     18800018
*                                                                       18900018
******** THE NUMBER OF VOLS IS GREATER THAN 5                           19000018
*                                                                       19100018
         TM    TABDSORG,ISORDA          DSORG SET FOR IS OR DA          19200018
         BZ    REPDCB30                 NO BRANCH                       19300018
*                                                                       19400018
REPDCB24 EQU   *                                                        19500018
*                                                                       19600018
         TM    TABFLG1,TABLAST          LAST ENTRY IN TABLE             19700002
         BO    ENDUP                    YES BRANCH                      19800018
         B     REPDCB20                 RE LOOP                         19900018
*                                                                     * 20000018
REPDCB30 EQU   *                                                        20100018
*                                                                     * 20200018
         SR    WRKR6,WRKR6              ZERO WORK REG           SA65157 20250002
         IC    WRKR6,DEBNMEXT           GET NO. OF EXTENTS      SA65157 20260002
         SLL   WRKR6,4                  MULTIPLY BY 16          SA65157 20270002
         LA    WRKR6,DEBBASND(WRKR6)    GET ADR ACC METH SECT   SA65157 20280002
         USING DEBACSMD,WRKR6                                   SA65157 20290002
         SR    WRKR5,WRKR5              ZERO OUT REGISTER       YA03686 20292002
         IC    WRKR5,DEBVOLSQ+1         GET CURR VOL. SEQ. NO.  YA03686 20300002
         L     DEBR,DCBDEBAD            GET DEB BASIC ADR        Y02076 20350002
         USING DEBBASIC,DEBR                                     Y02076 20360002
         TM    TABFLG1,TABDA            DA DEVICE                       20400002
         BO    REPDCB32                 YES BRANCH                      20500018
*                                                                       20600018
         LH    WRKR5,TABVLID5           GET CURR VOL. SEQ. NO.          20700018
*                                                                       20800018
REPDCB32 EQU   *                                                        20900018
*                                                                       21000018
         BCTR  WRKR5,0                  SUB 1 FROM VOLUME SEQ NUMBER    21100018
*                                                                       21200018
REPDCB34 EQU   *                                                        21300018
*                                                                     * 21400018
         LA    WRKR1,5                  LOAD WITH FIVE                  21500018
         LA    WRKR2,15                 LOAD WITH FIFTEEN               21600018
*                                                                     * 21700018
         LA    UCBR,1(UCBR)             BUMP XTN COUNTER BY ONE         21800018
         SR    WRKR5,WRKR1              SUB 5 FROM VOLSEQNO(OR DIFF)    21900018
         LTR   WRKR5,WRKR5              TEST WRKR5                      22000018
         BC    12,REPDCB38              BRANCH LOW OR EQUAL  TO ZERO    22100018
*                                                                     * 22200018
REPDCB36 EQU   *                                                        22300018
*                                                                       22400018
         CR    WRKR5,WRKR2              COMPARE RESULT TO 15            22500018
         BL    REPDCB38                 LOW BRANCH SERIAL IN THIS EXT   22600018
*                                                                       22700018
         SR    WRKR5,WRKR2              SUB 15 FROM VOLSEQNO(OR DIFF)   22800018
         LA    UCBR,1(UCBR)             BUMP EXTENSION COUNTER BY ONE   22900018
         B     REPDCB36                 BRANCH TO COUNT NO. OF EXT.     23000018
*                                                                       23100018
REPDCB38 EQU   *                                                        23200018
*                                                                       23300018
         LPR   WRKR5,WRKR5              GET A POSITIVE VALUE IN WRKR5   23400018
         MH    WRKR5,SIX                MULTIPLY RESULT VOLSEQNO BY 6   23500018
*                                                                     * 23600018
*    *** NOW READ THE REQUIRED XTN'S AND MOVE PROPER VOL ID TO TABL   * 23700018
*                                                                     * 23800018
         L     WRKR1,TABNVOLS           LOAD 1ST XTN TTR                23900018
         SLL   WRKR1,8                  SHIFT TTR LEFT 8 BITS           24000018
*                                                                       24100018
REPDCB40 EQU   *                                                        24200018
*                                                                       24300018
         L     WRKR2,QMNPRMWA           GET ADR OF QMNGR P.L.    Y02076 24350002
         ST    WRKR1,QMIDSKAD           STORE TTR IN P.L.        Y02076 24400002
         LA    WRKR1,RSJFCB             GET JFCBX READ IN ADR    Y02076 24450002
         ST    WRKR1,QMIRECAD           ADR TO READ IN JFCBX     Y02076 24500002
         STM   WRKR4,WRKR5,RSERAS01     SAVE REGS ACROSS QMNGRIO YM6508 24510002
         LA    WRKR4,RSREGSAV           POINT TO SAVE AREA       YM6508 24520002
         QMNGRIO                        READ JFCBX               Y02076 24550002
         LM    WRKR4,WRKR5,RSERAS01     RESTORE REGISTERS        YM6508 24560002
         LTR   WRKR6,WRKR6              TEST RETURN CODE         Y02076 24600002
         BZ    REPDCB42                 BRANCH IF NO ERROR       Y02076 24650002
         MVI   RSRETCOD+1,ERR025        SET JFCB READ ERROR    @ZSUT222 26900037
         MVC   RSREGSAV(8),MODID        SAVE NAME OF MODULE    @ZSUT222 26920037
*                                       THAT DETECTED ERROR    @ZSUT222 26940037
         STM   0,15,RSREGSAV+8          SAVE CURRENT REGISTERS @ZSUT222 26960037
         B     ERRORRTN                 BRANCH TO ERROR ROUTINE         27000018
*                                                                       27100018
REPDCB42 EQU   *                                                        27200018
*                                                                     * 27300018
*    *** GET THE CORRECT VOLID FROM JFCB XTN AND PLACE IT IN TABLE    * 27400018
*                                                                     * 27500018
         L     WRKR1,RSJFCB             PICK UP NEXT XTN TTR            27600018
         IC    WRKR1,ZERO     CLEAR LOW BYTE OF TTR              A44121 27650021
         BCT   UCBR,REPDCB40            BR IF MORE XTN'S TO BE READ     27700018
*                                                                       27800018
         LA    WRKR5,RSJFCB+4(WRKR5)    LOAD ADDR OF VOLID              27900018
         MVC   TABVLID1(6),0(WRKR5)     MOVE VOLID TO TABL ENTRY        28000018
*                                                                     * 28100018
         B     REPDCB24                 BRANCH TO TEST FOR LAST ENTRY   28200018
*                                                                       28300018
ENDUP    EQU   *                                                        28400018
*                                                                       28500018
         LR    CTABLR,TABLR             INIT REG                        28600018
*                                                                       28700018
ENDUP0   EQU   *                                                        28800018
*                                                                       28900018
         TM    TABFLG1,TABNULL     DUMMY DATA SET                  O100 28920002
         BZ    ENDUP0A             BRANCH IF NO                    O100 28940019
         OI    RSDCBFLG,NULLDFLG   INDICATE GO TO DUMJY ROUTINE    O100 28960019
ENDUP0A  EQU   *                                                   O100 28980019
         TM    TABFLG1,TABDA            DA DEVICE                       29000002
         BO    ENDUP1                   YES BRANCH                      29100018
*                                                                       29200018
         OI    RSDCBFLG,NONDAFLG        SET NON DA FLAG                 29300018
         B     ENDUP2                   BRANCH TO TEST FOR LAST ENTRY   29400018
*                                                                       29500018
ENDUP1   EQU   *                                                        29600018
*                                                                       29700018
         OI    RSDCBFLG,DAFLAG          SET DA FLAG                     29800018
*                                                                       29900018
ENDUP2   EQU   *                                                        30000018
*                                                                       30100018
         TM    TABFLG1,TABLAST          LAST ENTRY                      30200002
         BO    ENDUP3                   YES BRANCH                      30300018
*                                                                       30400018
         LA    CTABLR,TABENT(CTABLR)    TO NEXT ENTRY                   30500018
*                                                                       30600018
         B     ENDUP0                   BRANCH TO CHECK IF DA EXISTS    30700018
*                                                                       30800018
ERRORRTN EQU   *                                                        30900018
*                                                                       31000018
         L     WRKR4,4(TABLR)           INITIALIZE TO 1ST WORKAREA      31100018
         MVC   RSJFCB(8),ERORLOAD       MOVE IN ERROR MOD ID            31200018
         B     ENDUP4                   BRANCH TO GET FLSQ FOR SYSOUT   31300018
*                                                                     * 31400018
ENDUP3   EQU   *                                                        31500018
*                                                                       31600018
         TM    RSDCBFLG,NULLDFLG   WAS DUMMY DATA SET FOUND        O100 31610019
         BZ    ENDUP3A             BRANCH IF NO                    O100 31620019
         MVC   RSJFCB(8),DUMYLOAD  SET DUMMY MODULE ID             O100 31630019
         B     ENDUP4              DONT SET TAPE ID                O100 31640019
ENDUP3A  EQU   *                                                   O100 31650019
         L     WRKR4,4(TABLR)           INITIALIZE TO 1ST WORK AREA     31700018
         MVC   RSJFCB(8),TAPELOAD       MOVE IN TAPE LOAD ID            31800018
         TM    RSDCBFLG,NONDAFLG        IS NON DA FLAG ON               31900018
         BO    ENDUP4                   YES BRANCH                      32000018
*                                                                       32100018
         MVC   RSJFCB(8),DALOAD         MOVE IN DA LOAD ID              32200018
*                                                                       32300018
ENDUP4   EQU   *                                                        32400018
         ICM   WRKR1,ADDRBYTS,QMNGWALN  FREE THE QMNGRIO         Y02076 32450002
         ICM   WRKR1,HIORDER,SP253         PARM LIST + WORK AREA Y02076 32500002
         L     WRKR2,QMNPRMWA           GET ADR OF PARM LIST     Y02076 32550002
         FREEMAIN  R,LV=(0),A=(1)       ISSUE FREEMAIN           Y02076 32560002
         LA    WRKR6,RSJFCB+8           SETUP FOR XCTL                  32600018
*********************************************************************   32700018
         LR    WRKR2,BUFR               POINT REG 1 TO THE RESTART W/A  32800018
         XC    RSERAS00,RSERAS00        CLEAR SCRATCH AREA       Y02076 32850002
*********************************************************************   32900018
         XCTL  EPLOC=RSJFCB,SF=(E,(15))                                 33000018
*                                                                       33100018
*     CONSTANTS USED IN REPI/O                                          33200018
*                                                                       33300018
AVTOFSET DC    H'36'                    OFFSET FROM DEB TO AVT   YM7340 33350002
SIX      DC    H'6'                     OFFSET FOR VOL SEQ NO           33400018
ERORLOAD DC    CL8'IGC0V05B'            RESTART EXIT MODULE             33500018
TAPELOAD DC    CL8'IGC0K05B'            NON-DA MOUNT/VERIFICATION LOAD  33600018
DALOAD   DC    CL8'IGC0M05B'            DA MOUNT/VERIFICATION LOAD      33700018
DUMYLOAD DC    CL8'IGC0H05B'            DUMMY PROCESSOR            O100 33750037
MODID    DC    CL8'IGC0I05B'            MODULE IDENT.          @ZSUT222 33753037
QMNGWALN DC    AL3(280)                 24(P.L.) + 256(W.A.)     Y02076 33760002
SP253    DC    AL1(253)                 SUBPOOL 253              Y02076 33770002
ADDRBYTS EQU   7                        GETMAIN PARAMETERS       Y02076 33780002
HIORDER  EQU   8                        HIGH ORDER BYTE          Y02076 33790002
QMWAOFST EQU   24                       OFFSET TO QMNGR WA       Y02076 33792002
JFCBXLNT EQU   176                      LENGTH OF JFCB XTN       Y02076 33794002
*                                                                       33800018
*     CHANNEL PROGRAM USED BY REPI/O                                    33900018
*                                                                       34000018
         DS    0D                                                       34100018
CCWLIST  DC    X'3100000040000005'      SEARCH                          34200018
         DC    X'08'                    TIC                             34300018
ZERO     DC    X'00000000000000'        ZEROS                           34400018
         DC    X'06000000000000B0'      READ                            34500018
*                                                                     * 34550000
*        MAINTENANCE SPACE                                       Y01909 34560000
*                                                                     * 34570000
PATCH    DC    XL((*-IGC0I05B)/20)'00'   FIVE PERCENT SPACE      Y01909 34580000
*                                                                     * 34590000
         IEFQMIOP                                                Y02076 34592002
         IEFJESCT                                                Y02076 34594002
         EJECT                                                          34600018
         IEEVRSWA VER=3                 USE AOS2 VERSION OF WA          34750000
QMNPRMWA EQU   RSERAS00                 ADR QMNGRIO PARMS        Y02076 34760002
         EJECT                                                          34800018
RSDSECT  DSECT                                                          34900018
*                                                                       35000018
*    DATA EXTENT BLOCK                                                  35100018
*                                                                       35200018
RSDEB    DS    0CL48                                                    35300018
RSDEBTCB DC    X'00000000'              TCB ADDRESS                     35400018
RSDEBDEB DC    X'00000000'              DEB ADDRESS                     35500018
*                                                                       35600018
*    DATA CONTROL BLOCK                                                 35700018
*                                                                       35800018
RSDEBOFL DS    0CL1                                                     35900018
RSDEBIRB DC    X'00000000'              IRB ADDRESS                     36000018
RSDEBSYS DC    X'00000000'              1ST IOB ADDR IN SYS.PURGE CHAIN 36100018
RSDEBUSR DC    X'00000000'              1ST IOB ADDR IN USER PRGE CHAIN 36200018
RSDEBECB DC    X'00000000'              PARM.LIST ADDR TO PURGE ECB     36300018
RSDEBID  DS    0CL1                                                     36400018
RSDEBDCB DC    AL4(RSDCBREP)            DCB ADDR                        36500018
RSDEBAPP DS    CL4                      I/O APPENDAGE VECTOR TABLE      36600018
RSDEBMOD DS    0CL1                                                     36700018
RSDEBUCB DS    F                        UCB ADDRESS                     36800018
RSDEBBIN DS    H                        BIN NUMBER                      36900018
RSDEBSCC DS    H                        CYLINDER START ADDRESS          37000018
RSDEBSHH DS    H                        TRACK START ADDRESS             37100018
RSDEBECC DS    H                        CYLINDER END ADDRESS            37200018
RSDEBEHH DS    H                        TRACK END ADDRESS               37300018
RSDEBNTR DS    H                        NO. OF TRACKS IN THIS EXTENT    37400018
*                                                                       37500018
*    EVENT CONTROL BLOCK                                                37600018
*                                                                       37700018
RSECBAD  DS    CL4                      ECB ADDRESS                     37800018
RSDCBDEB DC    AL4(RSDEB)               DEB ADDRESS                     37900018
*                                                                       38000018
RSDCBREP EQU   RSDEB+8                  POINT TO RELATIVE BEGINNING DCB 38100018
*                                                                       38200018
*    INPUT OUTPUT BLOCK                                                 38300018
*                                                                       38400018
RSIOB    DS    0CL40                                                    38500018
RSIOBFG1 DC    X'00'                    I/O FLAGS BYTE 1                38600018
RSIOBFG2 DC    X'00'                    I/O FLAGS BYTE 2                38700018
RSIOBSN1 DS    CL1                      FIRST SENSE BYTE                38800018
RSIOBSN2 DS    CL1                      SECOND SENSE BYTE               38900018
RSIOBECB DC    AL4(RSECBAD)             ECB ADDRESS                     39000018
RSIOBCSW DS    D                        LAST CSW                        39100018
RSIOBCPA DS    AL4(RSCCW1)              CHANNEL PROGRAM ADDRESS         39200018
RSIOBDCB DS    AL4(RSDCBREP)            DCB ADDRESS                     39300018
RSIOBRCP DS    CL4                      RESTART ADDRESS FOR IOS         39400018
RSIOBINC DS    H                        INCREMENT BLOCK COUNT           39500018
RSIOBECT DS    H                        NO. OF ERROR ENTRIES            39600018
RSIOBDAD DS    D                        SEEK ADDRESS FOR DA             39700018
*                                                                       39800018
*    CHANNEL PROGRAM                                                    39900018
*                                                                       40000018
RSCCWLST DS    0CL24                                                    40100018
RSCCW1   DS    D                        CCW1                            40200018
RSCCW2   DS    D                        CCW2                            40300018
RSCCW3   DS    D                        CCW3                            40400018
*                                                                       40500018
*    BUFFER SEGMENT FOR EXTERNAL BLOCKS                                 40600018
*                                                                       40700018
RSBUFSEG DS    0CL176                                                   40800018
RSJFCB   EQU   RSBUFSEG                                                 40900018
         IEFJFCBN                                                Y02076 40950002
         EJECT                                                          52400018
CVT      DSECT                                                          52500018
         CVT                                                            52600018
         EJECT                                                          52700018
*                                                                       52800018
*                                                                       52900018
*   TASK CONTROL BLOCK                                                  53000018
*                                                                       53100018
*                                                                       53200018
         CNOP  0,4                                                      53300018
TCB      DSECT                                                          53400018
TCBRBP   DS    F                       POINTER TO EXECUTING RB          53500018
TCBPIE   DS    F                       POINTER TO PROG. INTERRUPT EL.   53600018
TCBDEB   DS    F                       POINTER TO DEB QUEUE             53700018
TCBTIO   DS    F                       POINTER TO TIOT                  53800018
TCBCMP   DS    F                       TASK COMPLETION CODE             53900018
TCBTRN   DS    F                       TESTRAN FIELD                    54000018
TCBMSS   DS    F                       DATA BLOCK QUEUE ELEMENT POINTER 54100018
TCBPRTK  DS    CL1                     PROTECTION TAG                   54200018
TCBFLGS  DS    FL5                     FLAG BYTES                       54300018
TCBLMP   DS    CL1                     LIMIT PRIORITY                   54400018
TCBDSP   DS    CL1                     DISPATCHING PRIORITY             54500018
TCBLLS   DS    F                       POINTER TO LOAD LIST             54600018
TCBJLB   DS    F                       POINTER TO JOBLIB DCB            54700018
TCBJSE   DS    F                       LIST OF INACTIVE PROGRAMS ADDR.  54800018
TCBGRS   DS    CL64                    GENERAL REGISTER SAVE AREA       54900018
TCBIDF   DS    CL1                     TCB IDENTIFIER FIELD             55000018
TCBFSA   DS    CL3                     POINTER TO 1ST PROB.PROG.SAVEAR  55100018
TCBTCB   DS    F                       NEXT TCB ON READY QUEUE POINTER  55200018
TCBTME   DS    F                       POINTER TO TIMER ELEMENT         55300018
         EJECT                                                          55400018
         DCBD  DSORG=PS                                                 55500018
         EJECT                                                          55600018
         IEZDEB                                                  Y02076 55650002
         EJECT                                                          59600018
         IHJDSTAB                                                Y02076 59650002
         EJECT                                                          63700018
TIOT     DSECT                                                          63800018
         IEFTIOT1                                                       63900018
         EJECT                                                          64000018
SRT      DSECT                                                          64100018
         IEFUCBOB                                                       64200018
*                                                                       64300018
*                                                                       64400018
*                                                                       64500018
         END                                                            64600018
./  ADD  SSI=81000069,NAME=IGC0K05B
         TITLE 'IGC0K05B  MOUNT/VERIFICATION PROCESSOR - NON-DIRECT ACC*00090018
               ESS    REPOSITION I/O  RESTART-SVC 52  OS/360'           00180018
IGC0K05B START                                                          00270018
*              OS                                                       00280002
*                                                                A48235 00320000
*                                                                A50338 00330000
*          RELEASE 18 DELETIONS                                         00360018
*          RELEASE 19 DELETIONS                                         00450018
*0522225900,238500,557100                                        A25775 00490019
*0522415800                                                      A25997 00510019
*0522277200,329400-330300                                        A25937 00520019
*0522510300                                                      M3946  00530019
*          RELEASE 20 DELETIONS                                         00540018
*1380279000,313200,371700,385200,459900,490500,529200,617400,    S20038 00570020
*1380650700,652500,656100,666900                                 S20038 00600020
*1380208800                                                      M3408  00610020
*1380438600-438900                                               A35767 00615020
*1380261400,372100,631500                                        A36340 00620020
*          RELEASE 21 DELETIONS                                         00630018
*0987390600,438600                                               A46376 00640021
*0987                                                            A41442 00650021
*0987591300,666000                                               A40520 00670021
*              OS/VS2                                                   00680002
*          RELEASE 2 CHANGES/DELETIONS                                  00720000
*                                                               YA03211 00770002
*          RELEASE 3 DELETIONS                                          00772002
*0000579600                                                     ZA01325 00774002
*336939-337259                                                 @Z30AAHP 00820003
*D56730018,D56750018                                           @ZA02206 00870037
*C263300,372100,391000,631200,631500,645300                    @ZA07612 00970037
*C334800                                                       @ZA09631 01070037
*A23221018,C28730019,A31501018-31509018                        @ZA11144 01120037
*C22230018-22234018                                            @ZA11641 01140037
*C147640                                                       @ZA19100 01145032
*C147640                                                       @ZA19100 01147032
*D870300-890100                                                @ZA18506 01149032
*C440100,507600                                                @ZA18506 01151032
* APAR OZ31487 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 01151532
*C147540-147580,148639,603000,605000,607000,609000,611000      @ZSUT222 01152032
*C621040                                                       @ZSUT222 01152232
*A612500-613500,657500                                         @ZSUT222 01152432
*                                                              @G32DSMI 01153032
*           VS2 SU32 DELETIONS                                 @G32DSFS 01155032
*                                                              @G32DSFS 01157032
*                                                              @ZM45144 01159032
*A120033                                                       @ZA29067 01164032
*C279840                                                       @ZA30100 01166032
*A280040-280240,282100,315906                                  @ZA30100 01168032
* STATUS CHANGE LEVEL 004                                               01170021
*                                                                       01260018
*TITLE                                                                  01350018
*                                                                       01440018
*     NON-DIRECT ACCESS MOUNT/VERIFICATION PROCESSOR                    01530018
*                                                                       01620018
*STATUS                                                                 01710018
*                                                                       01800018
*FUNCTION/OPERATION                                                     01890018
*                                                                       01980018
*        CHECK VOLUME SERIAL IN TABLE AGAINST VOLUME SERIAL IN THE      02070018
*        SRTUCB INDICATED BY THE DATA SET'S TIOT ENTRY.                 02160018
*                                                                       02250018
*        IF THE CORRECT VOLUME IS NOT MOUNTED, CHECK ALL THE SECONDARY  02340018
*        STRUCB'S INDICATED AND IF THE VOLUME IS FOUND TO BE MOUNTED    02430018
*        ON ONE OF THEM, EXCHANGE IT WITH THE PRIMARY SRTUCB.           02520018
*                                                                       02610018
*        IF THE CORRECT VOLUME IS NOT MOUNTED ANYWHERE FIND A USEABLE   02700018
*        UCB & ISSUE A MOUNT MESSAGE - ERROR IF NO AVAILABLE UCB.       02790018
*                                                                       02880018
*        AS SOON AS THE VOLUME IS READY, READ THE VOLUME LABEL AND      02970018
*        VERIFY THAT THE CORRECT VOLUME WAS MOUNTED - IF NOT, REPEAT    03060018
*        THE MOUNTING PROCEDURE.                                        03150018
*                                                                       03240018
*        REPEAT THE ABOVE FOR EACH VOLUME SERIAL IN EACH ENTRY OF THE   03330018
*        TABLE(EXCEPT THE RESTART DATA SET) - TAPE ONLY. FOR SYSIN,     03380002
*        SYSOUT,UNIT RECORD, OR GRAPHIC DATA SETS UPDATE THE DEB.       03430002
*        DIRECT ACCESS IS PROCESSED IN THE NEXT LOAD. NO PROCESSING     03480002
*        IS PERFORMED FOR A NULLFILE.                                   03530002
*        FOR RACF DEFINED DATA SETS THE USERS AUTHORIZATION    @G32DSMI 03534032
*        IF THE DEQ-AT-DISMOUNT FACILITY WERE ACTIVE, IT IS    @ZA18506 03580037
*        IS CHECK USING A RACHECK.                             @G32DSMI 03604032
*        REESTABLISHED AND ALL PRECEEDING VOLUMES ARE DEQED.   @ZA18506 03630037
*                                                                       03690018
*ENTRY POINTS -                                                         03780018
*                                                                       03870018
*              IGC0K05B  INITIAL ENTRY VIA XCTL FROM IGC0I05B           03960018
*                        ALSO ENTRY VIA RETURN FROM NSLRHRDI            04050018
*                        (NONSTANDARD LABEL ROUTINE)                    04140018
*                                                                       04230018
*INPUT                                                                  04320018
*                                                                       04410018
*    REGISTER 8 - START OF DATA SET TABLE                               04500018
*    REGISTER 1 - RESTART WORKAREA                                      04590018
*                                                                       04680018
*OUTPUT                                                                 04770018
*                                                                       04860018
*     NOT APPLICABLE                                                    04950018
*                                                                       05040018
*EXTERNAL ROUTINES                                                      05130018
*                                                                       05220018
*              NONE                                                     05310018
*                                                                       05400018
*EXITS                                                                  05490018
*                                                                       05580018
*        (1) TO NONSTANDARD LABEL PROCESSING ROUTINE - NSLRHDRI         05670018
*        (2) D.A. MOUNT ROUTINE - IGC0M05B                              05760018
*        (3) NON-DA SYSIN/SYSOUT ROUTINE - IGC0L05B                     05850018
*        (4) ERROR EXIT TO IGC0V05B WITH ONE OF THE FOLLOWING ERROR     05860032
*            CODES SET IN THE RESTART WORK AREA:                        05870032
*            26 - ERROR IN READ JFCB                                    05880032
*            30 - I/O ERROR IN NSL ROUTINE                              05890032
*            40 - I/O ERROR READING VOLUME LABEL                        05900032
*            44 - NO UCB AVAILABLE                                      05910032
*            46 - NO SCU FOR 1275 1419                                  05920032
*           255 - RACF ERROR                                            05930032
*                                                                       05940018
*TABLES/WORKAREAS-                                                      06030018
*                                                                       06120018
*********************************************************************** 06210018
*                                                                     * 06300018
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 06390018
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 06480018
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 06570018
*    IS 48 BYTES LONG.                                                * 06660018
*                                                                     * 06750018
*********************************************************************** 06840018
*                                                                       06930018
*        ------------------- 4 BYTES -----------------                  07020018
*                                                                       07110018
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  07200018
*        +DATA SET  +           DCB                  +                  07290018
*        + ORGN.    +         ADDRESS                +                  07380018
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                07470018
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  07560018
*        + NO. 1    +         ADDRESS                +                  07650018
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  07740018
*        +NUMBER    +         JFCB TTR               +                  07830018
*        + OF VOLS  +         ADDRESS                +                  07920018
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               08010018
*                                                                       08100018
*     12 +++++++++++++++++++++++                                        08190018
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   08280018
*        +INFO BYTE + NUMBER   +                                        08370018
*        +++++++++++++++++++++++                                        08460018
*                                                                       08550018
*     12 +++++++++++++++++++++++                                        08640018
*        +    OLD   TIOT       +        DA AND UNIT RECORD              08730018
*        +      OFFSET         +                                        08820018
*        +++++++++++++++++++++++                                        08910018
*                                                                       09000018
*                              +++++++++++++++++++++++                  09090018
*                              +FLAG BYTE +FLAG BYTE +                  09180018
*                              +  NO. 2   +  NO. 3   +                  09270018
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  09360018
*        +FLAG BYTE +FLAG BYTE +                     +                  09450018
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  09540018
*        +++++++++++++++++++++++                     + 20               09630018
*        +                                           +                  09720018
*        +                                           +                  09810018
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  09900018
*        +                                           +                  09990018
*        +   VOLUME ID NO. 2                         +                  10080018
*        +                     +++++++++++++++++++++++ 28               10170018
*        +                     +                     +                  10260018
*        +                     +   VOLUME ID NO. 3   +                  10350018
*     32 +++++++++++++++++++++++                     +                  10440018
*        +                                           +                  10530018
*        +                                           +                  10620018
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               10710018
*        +                                           +                  10800018
*        +   VOLUME ID NO. 4                         +                  10890018
*     40 +                     +++++++++++++++++++++++                  10980018
*        +                     +                     +                  11070018
*        +                     +                     +                  11160018
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               11250018
*        +                                           +                  11340018
*        +                                           +                  11430018
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               11520018
*                                                                       11610018
*                                                                       11700018
*ATTRIBUTES -                                                           11790018
*                                                                       11880018
*       REENTRANT, ENABLED, PRIVILEGED.                                 11970018
*                                                                       12060018
*********************************************************************** 12150018
*                                                                       12240018
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               12330018
*                                                                       12420018
*********************************************************************** 12510018
*                                                                       12600018
WRKR1    EQU   0         WORK/PARM REGISTER                             12690018
WRKR2    EQU   1         WORK/PARM REGISTER                             12780018
DCBR     EQU   2         CURRENT DCB REGISTER                           12870018
BASER    EQU   3         BASE REGISTER                                  12960018
DEBR     EQU   4         CURRENT DEB REGISTER                           13050018
UCBR     EQU   5         CURRENT UCB REGISTER                           13140018
TIOTR    EQU   6         NEW TIOT REGISTER                              13230018
TCBR     EQU   7         TCB REGISTER                                   13320018
TABLR    EQU   8         START OF DCB TABL REG                          13410018
CTABLR   EQU   9         CURRENT DCB IN TABL REG                        13500018
BUFR     EQU   10        USER BUFFER AREA                               13590018
DSCNTR   EQU   11        NUMBER OF DATA SETS                            13680018
WRKR3    EQU   12        WORK REGISTER                                  13770018
WRKR4    EQU   13        WORK REGISTER                                  13860018
WRKR5    EQU   14        WORK/PARM REGISTER                             13950018
WRKR6    EQU   15        WORK/PARM REGISTER                             14040018
*                                                                       14130018
*********************************************************************** 14220018
*                                                                       14310018
*    OFFSETS TO BE USED IN REPI/O PHASE                                 14400018
*                                                                       14490018
*********************************************************************** 14580018
*                                                                       14670018
IS       EQU   X'80'                    INDEXED SEQUENCIAL              14672018
PS       EQU   X'40'                    PHYSICAL SEQUENCIAL             14674018
DA       EQU   X'20'                    DIRECT ACCESS                   14676018
PO       EQU   X'02'                    PARTITIONED ORGANIZATION        14678018
INOROUT  EQU   X'40'                    SYSIN OR SYSOUT DATA SET        14682018
DADEV    EQU   X'20'                    DA DEVICE                       14684018
TPDEV    EQU   X'10'                    TAPE DEVICE                     14686018
DEV1275  EQU   X'1F'                    1275 OPT CHR RDR        YM05550 14688002
DEV1419  EQU   X'1D'                    1419 MAG INK CHR RDR    YM05550 14688402
UNITREC  EQU   X'04'                    UNIT RECORD EQUIPMENT           14690018
ERRINNSL EQU   X'80'                    ERROR IN NSL ROUTINE            14692018
NSLMTSW  EQU   X'40'                    NSL MOUNT SWITCH                14694018
NSLCOMU  EQU   X'20'                    NSL COMMUNICATION BIT           14696018
BYPASS   EQU   X'10'                    BYPASS LABEL PROCESSING         14698018
AL       EQU   X'08'                    ASCII LABEL              S20038 14699020
NSL      EQU   X'04'                    NON-STANDARD LABEL              14700018
SL       EQU   X'02'                    STANDARD LABEL                  14702018
NL       EQU   X'01'                    NO LABEL                        14704018
POCONCAT EQU   X'40'                    P.O. CONCATENATED               14708018
DAFLAG   EQU   X'80'                    DA DATA SET FLAG                14710018
NONDAFLG EQU   X'40'                    NON-DA DATA SET FLAG            14712018
NSLFLAG  EQU   X'10'                    NSL ROUTINE FLAG                14714018
TYPERST  EQU   X'80'                    IMMEDIATE RESTART               14716018
TABENT   EQU   48                       TABLE ENTRY LENGTH              14718018
WRITE    EQU   X'01'                    WRITE ON TAPE                   14720018
READ     EQU   X'02'                    READ FOR TAPE                   14722018
NOPOP    EQU   X'03'                    NOP                             14724018
SENSE    EQU   X'04'                    SENSE                           14726018
REWIND   EQU   X'07'                    REWIND                          14728018
READBACK EQU   X'0C'                    READBACK                        14730018
UNLOAD   EQU   X'0F'                    REWIND AND UNLOAD               14732018
WTM      EQU   X'1F'                    WRITE TAPE MARK                 14734018
BSFOP    EQU   X'2F'                    BACKWARD SPACE FILE             14736018
FSFOP    EQU   X'3F'                    FORWARD SPACE FILE              14738018
CCWFSR   EQU   X'37'                    FORWARD SPACE RECORD CMD  99223 14738402
SEARCH   EQU   X'31'                    SEARCH                          14740018
SRCHCNT  EQU   X'05'                    COUNT FOR SEARCH ID             14742018
TIC      EQU   X'08'                    TIC                             14744018
READDA   EQU   X'06'                    READ FOR DA                     14746018
LENJFCB  EQU   X'B0'                    LENGTH OF JFCB                  14748018
LBLLEN   EQU   X'50'                    LENGTH OF LABEL                 14750018
PERMERR  EQU   X'7F'                    PERMANENT ERROR                 14752018
ERR026   EQU   26                       ERROR READING IN JFCB  @ZSUT222 14754032
ERR030   EQU   30                       I/O ERROR IN NSL RTN   @ZSUT222 14755032
ERR040   EQU   40                       ERROR IN READ VOL LABEL@ZSUT222 14756032
ERR044   EQU   44                       NO UCB AVAILABLE       @ZSUT222 14757032
ERR046   EQU   46                       NO SCU FOR 1275 1419   @ZSUT222 14758032
INTECEPT EQU   X'44'                    INTERCEPT CMND CODE     YM05549 14762402
TCAM     EQU   X'02'                    TABFLG1 TCAM FLAG        M3408  14763020
DMCOUNT0 EQU   X'7F'                    DATA MANAGEMENT COUNT  @ZA19100 14764037
PERMRES  EQU   X'24'                    PERMANENT RESIDENT OR RESERVED  14766018
NOTREADY EQU   X'40'                    NOT READY SWITCH                14768018
OUTP     EQU   X'03'                    OUTPUT (DEBOPATB)               14772018
SLIFLAG  EQU   X'20'                    SLI FLAG                        14774018
FILEPROT EQU   X'02'                    FILE PROTECTED                  14776018
FSROP    EQU   X'37'                    FORWARD SPACE RECORD    99223   14777002
INOUT    EQU   X'0C'                    INOUT (DEBOPATB)                14778018
ONE      EQU   X'01'                    CONSTANT ONE                    14780018
COMPCODE EQU   X'00'                    COMPLETION CODE                 14782018
RINGIN   EQU   C'F'                     INSERT FILE PROTECT RING        14784018
USED     EQU   C'U'                     VOLUME CAN BE USED              14786018
MOUNTON  EQU   X'80'                    MOUNT SWITCH ON                 14788018
MOUNTOFF EQU   X'00'                    MOUNT SWITCH OFF                14790018
UNITCHK  EQU   X'02'                    UNIT CHECK                      14792018
UNITEXP  EQU   X'01'                    TAPE MARK INDCIATOR     ZA01325 14792402
WRONGLEN EQU   X'40'                    WRONG LENGTH RECORD             14794018
MODECLR  EQU   X'C0'                    DENSITY SET                     14796018
SETMODE  EQU   X'2B'                    EVEN PAR. TRANS MODE. CNVT OFF  14798018
SLASH    EQU   C'/'                     SLASH                           14800018
TWO      EQU   2                        CONSTANT OF TWO          S20038 14810020
FOUR     EQU   4                        CONSTANT OF FOUR         S20038 14820020
SIX      EQU   6                        CONSTANT OF SIX          S20038 14830020
NINE     EQU   9                        CONSTANT OF NINE         S20038 14840020
D0       EQU   0                        ZERO                     Y02076 14842002
D1       EQU   1                        ONE                      Y02076 14844002
D2       EQU   2                        TWO                      Y02076 14846002
D3       EQU   3                        THREE                    Y02076 14848002
D4       EQU   4                        FOUR                     Y02076 14848402
D5       EQU   5                        FIVE                     Y02076 14848802
D6       EQU   6                        SIX                      Y02076 14849202
D7       EQU   7                        SEVEN                    Y02076 14849602
D8       EQU   8                        EIGHT                    Y02076 14849702
D9       EQU   9                        NINE                     Y02076 14849802
D15      EQU   15                       NO. OF VOLS IN JFCBX   @ZA18506 14849937
D24      EQU   24                       TWENTY FOUR              Y02076 14853932
ERR255   EQU   255                      RACF RELATED ERROR     @ZSUT222 14863932
*                                                                       14909937
*********************************************************************** 14940018
*                                                                       15030018
         USING TABL,WRKR4          CURRENT TABLE ENTRY                  15120018
         USING MNTTIOT,TIOTR       NEW TIOT                             15210018
         USING MNTUCB,UCBR         UCB                                  15300018
         USING DEBBASIC,DEBR       DEB                           Y02076 15390002
         USING RSDSECT,WRKR3       WORK AREA                            15570018
         USING IHADCB,CTABLR       DCB                                  15660018
         USING RSTWA,BUFR         RESTART WORK AREA                     15750018
*                                                                       15840018
         BALR  BASER,0             SET UP BASE REGISTER                 15930018
         USING *,BASER                                                  16020018
         B     BEGIN               BRANCH AROUND EYE CATCHER     Y01909 16070000
         CNOP  0,8                 ALIGN TO A DBL WORD BOUNDARY  Y01909 16080000
         DC    CL8'IGC0K05B'       MODULE NAME                 @ZSUT222 16090032
         DC    CL8'&SYSDATE'       LAST DATE SHIPPED           @ZSUT222 16092032
         DC    CL8'@ZSUT222'       LAST CODE SHIPPED           @ZSUT222 16094032
         DC    CL8'@SU83200'       SELECTABLE UNIT ID          @ZSUT222 16096032
BEGIN    EQU   *                                                 Y01909 16100000
*                                                                       16110018
         XC    RSMWOFST(4),RSMWOFST     ZERO FOR DOMING         ZA02206 16160037
         TM   RSDCBFLG,NSLFLAG    ARE WE COMING FROM NSL RTN            16200037
         BO    MNTTP085           BRANCH IF YES                         16290018
*                                                                       16380018
************  ********** ***************  ************  *************** 16470018
*                                                                     * 16560018
*               INITIALIZE REGISTERS                                  * 16650018
*                                                                     * 16740018
************  ********** ***************  ************  *************** 16830018
*                                                                       16920018
*        IN ORDER TO PREVENT A NON-CANCELABLE SITUATION IN THE   YM7890 16922002
*        EVENT THE MEMORY IS SWAPPED OUT WITH AN OUTSTANDING     YM7890 16924002
*        MOUNT, ISSUE A SYSEVENT TO INHIBIT SWAP-OUT.            YM7890 16926002
*                                                                YM7890 16928002
         SYSEVENT DONTSWAP         INHIBIT SWAP-OUT              YM7890 16928402
*                                                                YM7890 16928802
         XC    QMNPRMWA,QMNPRMWA   ZERO OUT QMNGR PARM LIST      YM5965 16930002
*                                  POINTER AREA                  YM5965 16940002
         MVC   RSPPM(8),NAMEDA     SET UP XCTL                      MCS 16960018
         L     TCBR,RSTCBAD        PICK UP TCB ADDR                     17010002
         USING TCB,TCBR            TCB                         @ZM45144 17100032
         L     TIOTR,TCBTIO        LOAD TIOT ADDR.                      17500032
         DROP  TCBR                                            @ZM45144 17900032
         LR    WRKR4,TABLR         TABLE ADDRESS TO WRKR4               18540018
*                                                                       18630018
MNTTP005 EQU   *                                                        18720018
         L     CTABLR,TABDCBAD-1   PICK UP DCB ADDRESS                  18810018
         LH    WRKR5,DCBTIOT       PICK UP TIOT OFFSET (TIOTR + WRKR5   18900018
*                                  POINTS TO DDNAME                     18990018
         L     DEBR,DCBDEBAD       PICK UP DEB ADDRESS                  19080018
         LA    WRKR5,16(WRKR5)    DISPLACEMENT TO 1ST UCB               19170018
         L     UCBR,0(TIOTR,WRKR5) PICK UP UCB ADDRESS                  19260018
         LA    WRKR6,0(TIOTR,WRKR5)    ADDR OF 1ST UCB                  19350018
*                                                                       19440018
         L     WRKR3,TABFLG1      PICK UP WORKAREA ADDRESS              19530018
*                                                                       19710018
************       ***********         ***********         ************ 19800018
*                                                                       19890018
*        CHECK FOR- (1) D.A. - TO BE MOUNTED IN NEXT MODULE             19980018
*                       NULLFILE - NO MOUNTING REQUIRED                 20070018
*                                                                       20160018
*                   (2) SYSIN/SYSOUT(TAPE/UNIT RECORD) - UPDATE UCB IN  20250018
*                                                        DEB            20340018
*                                                                       20430018
*                   (3) UNIT RECORD OR GRAPHIC - UPDATE UCB IN DEB      20520018
*                                                                       20610018
************       ***********         ***********         ************ 20700018
*                                                                       20790018
         TM    TABFLG1,TABDA+TABNULL+TABTCAM   DA,NULL,TCAM      Y02076 20840002
         BC    5,MNTTP070          BRANCH IF YES                        20970018
*                                                                       21060018
         ST    WRKR6,TABVLID2      STORE ADDR OF 1ST UCB                21100018
         TM    TABFLG1,TABSYS+TABUR SYSIN,SYSOUT, UR,GRAPHIC     Y02076 21150002
         BC    5,MNTTP055          BRANCH IF YES                        21240018
         TM    TABFLG2,TABRSDS     CHPT DS USED FOR RSTRT        Y02076 21290002
         BNO   MNTTP010            IF NOT, CONT WITH MOUNTING    YM7579 21300002
         L     CTABLR,RSDCB        GET RESTART'S DCB ADDR        YM7579 21310002
         L     CTABLR,DCBDEBAD     GET RESTART'S DEB ADDR        YM7579 21320002
         MVC   DEBSUCBB(D3),DEBSUCBB-DEBBASIC(CTABLR) UPDATE     YM7579 21322002
*                                  USER'S DEB UCB ADDR           YM7579 21324402
         B     MNTTP070            BYPASS MOUNT PROCESSING       YM7579 21326002
*                                                                       21330018
************   ************   ************   ************   *********** 21420018
*                                                                       21510018
*              CHECK TO SEE IF THIS VOLUME IS MOUNTED ON ANY ONE        21600018
*              OF THE ALLOCATED UCB'S IN THE NEW TIOT                   21690018
*                                                                       21780018
************   ************   ************   ************   *********** 21870018
*                                                                       21960018
MNTTP010 EQU   *                                                        22050018
         TM    SRTEDMCT,MOUNTON    IS MOUNT SW ON                       22140018
         BNO   MNTTP998            NO BRANCH                   @ZA11641 22230037
         TM    UCBFL2,NOTREADY     IS UCB NOT READY BIT ON ?   @ZA11641 22250037
         BO    MNTTP150            YES FORM CHANNEL PROGRAM    @ZA11641 22270037
MNTTP998 EQU   *                                               @ZA11641 22290037
         CLC   TABVLID1,SRTEVOLI   IS THE CORRECT VOLUME MOUNTED        22320018
         BE    MNTTP150            BRANCH TO FORM CHANNEL PROGRAM       22410018
*                                                                       22500018
         BAL   DSCNTR,MNTTP105     GO TO 'GET NEXT UCB' ROUTINE  A25775 22590019
*                                                                       22680018
         BNE   MNTTP010            NOT LAST UCB - CONDITION CODE SET    22770018
*                                  IN 'GET NEXT UCB' ROUTINE            22860018
*                                                                       22950018
*  THE VOLUME WAS NOT MOUNTED - FIND AN AVAILABLE UCB AND MOUNT THE     23040018
*  VOLUME.                                                              23130018
*                                                                       23220018
MNTTP999 EQU   *                                               @ZA11144 23260037
         LH    WRKR5,DCBTIOT       PICK UP TIOT OFFSET                  23310018
         LA    WRKR5,16(WRKR5)    DISPLACEMENT TO 1ST UCB               23400018
         L     UCBR,0(TIOTR,WRKR5) PICK UP UCB ADDRESS                  23490018
         B     MNTTP020            BRANCH TO SEE IF VOLUME MOUNTED      23580018
*                                                                       23670018
MNTTP015 EQU   *                                                        23760018
         BAL   DSCNTR,MNTTP105     GO TO 'GET NEXT UCB' ROUTINE  A25775 23850019
         BE    MNTTP135            ERROR IF LAST UCB                    23940018
*                                                                       24030018
MNTTP020 EQU   *                                                        24120018
         TM    SRTEDMCT,DMCOUNT0   DATA MANAGEMENT COUNT=0              24210018
         BC    5,MNTTP015         BRANCH IF NOT ZERO                    24300018
*                                                                       24390018
************   ************   ************   ************   *********** 24480018
*                                                                       24570018
*  DATA MANAGEMENT COUNT EQUAL ZERO REQUEST OPERATOR TO MOUNT VOLUME    24660018
*  ON THIS UCB IF UCB IS AVAILABLE. I.E. NOT PERM. RESIDENT OR RESERVED 24750018
*                                                                       24840018
************   ************   ************   ************   *********** 24930018
*                                                                       25020018
MNTTP025 EQU   *                                                        25110018
         TM    SRTESTAT,PERMRES    IS THIS DEVICE RESERVED OR           25200018
*                                  PERMANENTLY RESIDENT.                25290018
         BC    5,MNTTP015          BRANCH IF ANSWER IS YES              25380018
*                                                                       25470018
************   ************   ************   ************   *********** 25560018
*                                                                       25650018
*    VOLUME CAN BE MOUNTED ON THIS UCB PREPARE TO ISSUE MOUNT MESSAGE   25740018
*    TO OPERATOR                                                        25830018
*                                                                       25920018
************   ************   ************   ************   *********** 26010018
*                                                                       26100018
MNTTP030 EQU   *                                                        26190018
         BAL   DSCNTR,MNTTP145    FORM MOUNT MESSAGE                    26280018
         MVI   MSGID+53,RTCD28     MOVE ROUTE CODE TO MSG      @ZA07612 26330037
*                                                                       26370018
MNTTP035 EQU   *                                                        26460018
         OI    SRTEDMCT,MOUNTON    SET MOUNT SW ON                      26550018
         OI    UCBSTAB,UCBBNUL          SET DOM FLAG            ZA02205 26600037
         LA    WRKR2,MSGAREA      MESSAGE AREA ADDR IN REG. 1           26640018
*                                                                       26730018
         WTO   MF=(E,(1))          WRITE TO OPERATOR                    26820018
         ST    WRKR2,RSMWOFST      SAVE MSGID FOR DOM               MCS 26860018
         OC    UCBFSER(3),UCBFSER       ANY DOM MSGID HERE      ZA02205 26870037
         BNZ   MNTTP036                 YES MSGID HERE          ZA02205 26880037
         MVC   UCBFSER(3),RSMWOFST+1    MOVE MSGID IN           ZA02205 26890037
         XC    RSMWOFST(4),RSMWOFST     ZERO MSGID FIELD        ZA02205 26900037
         B     MNTTP037                 BRANCH AROUND           ZA02205 26902037
MNTTP036 EQU   *                                                ZA02205 26904037
         OC    UCBFSER+3(3),UCBFSER+3   ANY MSGID HERE          ZA02205 26906037
         BNZ   MNTTP037                 YES MSGID HERE          ZA02205 26908037
         MVC   UCBFSER+3(3),RSMWOFST+1  MOVE MSGID IN           ZA02205 26908437
         XC    RSMWOFST(4),RSMWOFST     ZERO MSGID FIELD        ZA02205 26908837
MNTTP037 EQU   *                                                ZA02205 26909237
*                                                                       26910018
************   ************   ************   ************   *********** 27000018
*                                                                       27090018
*        REWIND AND UNLOAD AND PREPARE TO CHECK VOLUME LABEL AFTER      27180018
*        OPERATOR MOUNTS NEW TAPE.                                      27270018
*                                                                       27360018
************   ************   ************   ************   *********** 27450018
*                                                                       27540018
MNTTP040 EQU   *                                                        27630018
         BAL   DSCNTR,MNTTP115    BUILD CCW                             27810018
         TM    UCBFL2,NOTREADY    DEVICE READY                          27930018
         BO    MNTTP045           BRANCH IF NO                          27960018
*        AFTER IPL, THE UCB NOT-READY BIT CAN BE FALSELY OFF.           27964019
*        DO NOT SET NOT-READY BIT IN THIS CASE, BECAUSE THE TAPE WILL   27968019
*        NOT GIVE A READY INTERRUPT UNTIL ENABLED BY A SIO AFTER IPL.   27972019
*        AN UNKNOWN TAPE MAY BE PHYSICALLY MOUNTED AND READY, HOWEVER.  27976019
         CLI   SRTEVOLI,X'00'      IS A VOLUME MOUNTED           A25937 27980019
         BNE   AHEAD               BR IF YES                   @ZA30100 27984032
*                                                                       27994032
         TM    TABFLG2,X'01'       FIRST PASS MOUNT SW ON ?    @ZA30100 28004032
         BNO   MNTTP045            NO BRANCH                   @ZA30100 28014032
         NI    TABFLG2,X'FE'       TURN OFF BIT                @ZA30100 28024032
*        ISSUE EXCP TO REWIND AND UNLOAD TAPE                           28080018
*                                                                       28170018
AHEAD    EQU   *                                               @ZA30100 28210032
         BAL   DSCNTR,MNTTP110     EXCP/WAIT ROUTINE                    28260018
*                                                                       28350018
         OI    UCBFL2,NOTREADY     SET UCB NOT READY BIT ON             28440018
*                                                                       28530018
MNTTP045 EQU   *                                                        28620018
         MVI   RSCCW1,REWIND       MAKE CHN PROG. OP CODE 'REWIND'      28710018
*                                                              @ZA11144 28730037
         OI    RSMWOFST,X'80'      INDICATE THAT DOM MUST BE ISSUED MCS 28750018
         BAL   DSCNTR,MNTTP110    REWIND TAPE                           28800018
*                                                                       28890018
         TM    TABTPLBL,BYPASS     BYPASS LABEL PROCESSING              28980018
         BO    MNTTP055            BRANCH IF YES                        29070018
*                                                                       29160018
************   ************   ************   ************   *********** 29250018
*                                                                       29340018
*      PREPARE TO READ IN VOLUME LABEL                                  29430018
*                                                                       29520018
************   ************   ************   ************   *********** 29610018
*                                                                       29700018
         MVI   RSCCW1,READ         MAKE CHANNEL COMMAND OP CODE READ    29790018
         MVI   RSCCW1+7,LBLLEN     MAKE LENGTH DECIMAL 80               29880018
*                                                                       29970018
************   ************   ************   ************   *********** 30060018
*                                                                       30150018
*    ISSUE EXCP TO READ IN VOLUME ID                                    30240018
*                                                                       30330018
************   ************   ************   ************   *********** 30420018
*                                                                       30510018
         OI    RSDEBOFL,RSDEBRER        SET REDUCED ERR RECOV   YA00628 30560002
         BAL   DSCNTR,MNTTP110     EXCP/WAIT ROUTINE                    30600018
         NI    RSDEBOFL,X'FF'-RSDEBRER  RESET ERR RECOV         YA00628 30650002
*                                                                       30690018
* REWIND TAPE                                                           30780018
*                                                                       30870018
         MVI   RSCCW1,REWIND       MAKE CHN PROG. OP CODE REW           30960018
         BAL   DSCNTR,MNTTP110    REWIND TAPE                           31050018
*                                                                       31140018
         TM    TABTPLBL,SL+AL           IS SL OR AL USED         S20038 31160020
         BZ    MNTTP050                 BRANCH IF NO             S20038 31180020
*                                                                       31200020
         TM    TABTPLBL,SL         STANDARD LABELS SPECIFIED            31230018
         BO    MNTTP052                 BRANCH IF YES TO COMPARE S20038 31240020
*                                       VOLID                    S20038 31250020
*                                                                       31260020
* MUST BE ASCII LABEL, SET UP TO TRANSLATE LABEL BEFORE PROCESSING      31270020
*                                                                       31280020
         LA    WRKR1,SIX                LENGTH OF VOLID          S20038 31290020
         LA    WRKR2,RSJFCB+FOUR        ADDRESS OF VOLID         S20038 31300020
*                                                                       31310020
         XLATE (1),(0),TO=E             TRANSLATE LABEL TO       S20038 31320020
*                                       EBCIDIC                  S20038 31330020
*                                                                       31340020
MNTTP052 EQU   *                                                 S20038 31350020
*                                                                       31360020
*                                                                       31410018
         CLC   TABVLID1,RSJFCB+4   IS CORRECT VOLUME MOUNTED            31500018
         BE    GOODVOL             YES COMPLETE PROCESSING     @ZA11144 31590037
*                                  FOR THE LABEL JUST READ     @ZA11144 31590137
         BAL   DSCNTR,MNTTP105     GET THE NEXT UCB FOR THIS   @ZA11144 31590237
*                                  TIOT ENTRY                  @ZA11144 31590337
         BNE   MNTTP010            BRANCH IF THERE IS ANOTHER  @ZA11144 31590437
*                                  UCB WITHIN THE TIOT         @ZA11144 31590537
         OI    TABFLG2,X'01'       SET FIRST PASS SWITCH       @ZA30100 31590632
         B     MNTTP999            VOLUME WAS NOT MOUNTED      @ZA11144 31590832
*                                  BRANCH TO FIND A UCB IN THE @ZA11144 31591032
*                                  TIOT WE CAN ISSUE MOUNT TO  @ZA11144 31591232
GOODVOL  EQU   *                                               @ZA11144 31591432
         TM    TABTPLBL,SL              STANDARD LABEL           99223  31591632
         BNO   MNTTP055                 NO.  BRANCH              99223  31592002
         CLI   UCBTBYT4,X'03'           3400 TAPE                99223  31593002
         BNE   MNTTP055                 NO.  BRANCH              99223  31594002
         L     DSCNTR,UCBEXTPT          GET UCB COMMON EXT ADDR  YM5965 31594402
         USING UCBCMEXT,DSCNTR          ADDRESS UCB COMMOM EXT   YM5965 31594902
         CLI   UCBSNSCT,24              TAPE HAVE 24 SENSE BYTS  99223  31595002
         DROP  DSCNTR                   UCB COMMON EXT           YM5965 31595402
         BNE   MNTTP055                 NO.  BRANCH              99223  31596002
*                                                                99223  31597002
         BAL   DSCNTR,MNTTP115          YES. BUILD CCW           99223  31598002
*                                                                99223  31599002
         TM    DEBOPATB,OUTP            OUTPUT FILE              99223  31600002
         BNO   MNTTP047                 NO.  PROCESS INPUT       99223  31601002
         MVI   RSCCW1,SENSE             YES. SETCCW TO OBTAIN    99223  31602002
         MVI   RSCCW1+4,SLIFLAG         SENSE BYTES  CONTAINING  99223  31603002
         MVI   RSCCW1+7,24              UNIT SERIAL NUMBER       99223  31604002
*                                                                99223  31605002
         BAL   DSCNTR,MNTTP110          EXCP/WAIT ROUTINE        99223  31606002
*                                                                99223  31607002
         L     DSCNTR,UCBXTN            GET UCB EXTENTION ADDRS  99223  31608002
         USING UCBMT,DSCNTR                                      99223  31609002
         MVC   UCBCTD,RSJFCB+15         UNIT SERIAL              99223  31610002
*                                       TO UCB EXTENTION         99223  31611002
         B     MNTTP055                 RETURN TO MAIN LINE      99223  31612002
         DROP  DSCNTR                                            99223  31613002
*                                                                99223  31614002
MNTTP047 EQU   *                                                 99223  31615002
         MVC   RSCCW3,RSCCW1            INPUT. SET CCWS          99223  31616002
         MVI   RSCCW3,READ              TO READ HDR2 WHICH       99223  31617002
         MVI   RSCCW1+4,X'40'           CONTAINS UNIT SERIAL     99223  31618002
         MVI   RSCCW1,FSROP             NUMBER OF CREATING UNIT  99223  31619002
         MVC   RSCCW2,RSCCW1            *                        99223  31620002
         BAL   DSCNTR,MNTTP110          EXCP/WAIT ROUTINE        99223  31621002
*                                                                99223  31622002
         MVI   RSCCW1,REWIND            REWIND TAPE              99223  31623002
         MVI   RSCCW1+4,X'00'           ONLY ONE CCW             99223  31624002
         BAL   DSCNTR,MNTTP110          EXCP/WAIT ROUTINE        99223  31625002
*                                                                99223  31626002
         CLC   HDR2,RSJFCB              HDR2 RECPRD OBTAINED     99223  31627002
         BNE   MNTTP055                 NO.  CONTINUE            99223  31628002
*        IF A TAPE ON A BIRCH DRIVE WAS CREATED ON A NON BIRCH  YA03211 31628102
*        DRIVE, THE UNIT SERIAL NUMBER WILL NOT BE PRESENT.     YA03211 31628202
         TM    RSJFCB+46,X'F0'          IS A SERIAL NO. PRESENT YA03211 31628402
         BNO   MNTTP055                 NO, CONTINUE            YA03211 31628802
         PACK  RSCCW3,RSJFCB+42(5)      CONVERT EBCDIC TO        99223  31629002
         CVB   WRKR6,RSCCW3             BINARY                   99223  31630002
         L     DSCNTR,UCBXTN            GET UCB EXTENTION ADDR   99223  31631002
         USING UCBMT,DSCNTR                                      99223  31632002
         STH   WRKR6,UCBCTD             STORE SERIAL NUMBER      99223  31633002
         DROP  DSCNTR                                            99223  31634002
         B     MNTTP055                 GO TO MAIN LINE          99223  31635002
MNTTP050 EQU   *                                                        31860018
         CLC   RSJFCB(4),VOL1      IS A VOLUME LABEL PRESENT            31950018
         BE    MNTTP030           BRANCH TO RE-ISSUE MOUNT MESSAGE      32040018
*                                  YES                                  32130018
         CLC   RSJFCB(FOUR),ASCIVOL     ASCII VOLUME LABEL       S20038 32140020
*                                       PRESENT                  S20038 32150020
         BE    MNTTP030                 BRANCH YES TO RE-ISSUE   S20038 32160020
*                                       MOUNT                    S20038 32170020
*                                                                       32180020
************   ************   ************   ************   *********** 32220018
*                                                                       32310018
*   UPDATE UCB - (VOL SER & DATA MANAGEMENT COUNT)                      32400018
*   MAKE THE CURRENT UCB THE 1ST UCB IN THE NEW TIOT                    32490018
*                                                                       32580018
************   ************   ************   ************   *********** 32670018
*                                                                       32760018
MNTTP055 EQU   *                                                        32850018
         LA    WRKR6,0(WRKR5,TIOTR)  ADDR OF CURRENT UCB POINTER A25937 32950019
         L     DSCNTR,TABVLID2     ADDR OF 1ST UCB IN TIOT              33120018
         MVC   0(4,WRKR6),0(DSCNTR)     1ST TO CURRENT                  33210018
         ST    UCBR,0(DSCNTR)           CURRENT TO 1ST                  33300018
         MVC   DEBSUCBB(D3),D1(DSCNTR)  UCB ADR TO DEB           Y02076 33350002
         TM    TABFLG1,TABSYS+TABUR SYSIN,SYSOUT,UR,OR GRAPHIC @ZA09631 33480037
         BZ    MNTTP060                 BR IF NOT               YM05550 33530002
         CLI   UCBTBYT4,DEV1275         IS IT 1275 OPCHRDR      YA03685 33580002
         BE    MNTTP056                 BR IF YES               YM05550 33630002
         CLI   UCBTBYT4,DEV1419         IS IT 1419 MAG CHR RDR  YA03685 33640002
         BNE   MNTTP070                 BR IF NOT               YM05550 33650002
*   1275 OPT CHAR READER AND 1419 MAG INK CHAR RDR PROCESSING   YM05550 33652002
*   UPDATE DEB TO REFLECT NEW SECONDARY CONTROL UNIT (SCU) ADR          33654002
*   DETERMINE ADR FROM UCB LOOK UP TABLE                        YM05550 33656002
MNTTP056 EQU   *                                                YM05550 33658002
         LH    WRKR2,UCBCHA             LD CHAN & DEV ADR       YM05550 33658402
         SLL   WRKR2,21                 CLEAR INDICATORS        YM05550 33658802
         SRL   WRKR2,21                 REPOS CHAN & DEV ADR    YM05550 33659202
         LA    WRKR2,1(,WRKR2)          INCR TO SCR ADR         YM05550 33659602
         L     DSCNTR,CVTPTR            LOAD CVT ADDR           YM05550 33659702
         USING CVT,DSCNTR               CVT ADDRESSABILITY      YM05550 33665702
         L     DSCNTR,CVTILK2           GET ADR UCB LU TBL      YM05550 33671902
         DROP  DSCNTR                                           YM05550 33677902
MNTTP057 EQU   *                                                YM05550 33683902
         SLR   WRKR5,WRKR5              CLEAR REG              @Z30AAHP 33693903
         ICM   WRKR5,3,0(DSCNTR)        INSERT UCB-TEST 0      @Z30AAHP 33703903
         BZ    MNTTP058                 IF FILLER BRANCH       @Z30AAHP 33713903
         CLM   WRKR5,3,=X'FFFF'         END OF TABLE?          @Z30AAHP 33723903
         BE    MNTTP131                 YES - BRANCH           @Z30AAHP 33725903
         LH    WRKR6,4(WRKR5)           LD CHAN & DEV ADR       YM05550 33729902
*                                       FROM UCB POINTED TO     YM05550 33739902
*                                       BY LOOK-UP TBL ENTRY    YM05550 33743202
         SLL   WRKR6,21                 CLEAR INDICATORS        YM05550 33745202
         SRL   WRKR6,21                 REPOS CHAN & DEV ADR    YM05550 33745602
         CR    WRKR6,WRKR2              ARE CHAN&DEV ADRS=      YM05550 33746002
         BE    MNTTP059                 BR IF YES TO UPDATE DEB YM05550 33746402
*                                       WRKR5 CONTAINS SCU ADR  YM05550 33746502
MNTTP058 EQU   *                                                YM05550 33746602
         LA    DSCNTR,2(,DSCNTR)        GET NXT LU TBL NTRY     YA03685 33754902
         B     MNTTP057                 BR TO REPEAT TESTS      YM05550 33756902
MNTTP059 EQU   *                                                YM05550 33758902
         STH   WRKR5,DEBSUCBB+5         ST SCU ADR IN           YM05550 33760902
*                                       SECOND DEB EXTENT       YM05550 33762902
         B     MNTTP070                 BR CONT PROCESSING      YM05550 33763302
*                                                                       33763402
MNTTP060 EQU   *                                                YM05550 33765402
         MVC   SRTEVOLI,TABVLID1        VOL SER TO UCB                  33771702
         MVC   UCBFSER(6),TABVLID3      1ST VOLSER OF D.S. TO    A41442 33780021
*                                       UCB                      A41442 33810021
         MVI   SRTEDMCT,ONE          SET DMCT TO ONE             Y02076 33840002
         MVC   UCBFSCT(D2),CONSTONE     SET FSCT TO 1            Y02076 33890002
         MVC   UCBFSEQ(D2),CONSTONE     SET FSEQ = 1             Y02076 33900002
*                                                                       33930018
************   ************   ************   ************   *********** 34020018
*                                                                       34110018
*         CHECK TO SEE IF AN OUTPUT FILE IS FILE PROTECTED              34200018
*         OR IF RAC PROTECTED TAPES EXIST CHECK FOR A VOLUME   @G32DSMI 34250032
*         AUTHORIZED FOR INPUT THAT WAS MOUNTED WITH THE RING. @G32DSMI 34270032
*                                                                       34290018
************   ************   ************   ************   *********** 34380018
*                                                                       34470018
         BAL   DSCNTR,MNTTP115    BUILD CCW                             34560018
         L     WRKR2,CVTPTR             CVT ADDRESSABILITY     @G32DSMI 34610032
         USING CVT,WRKR2                                       @G32DSMI 34615032
         L     WRKR2,CVTRAC             RACF CVT ADDRESSABILITY@G32DSMI 34620032
         LTR   WRKR2,WRKR2              RACF ACTIVE            @G32DSMI 34621032
         BZ    MNTRAC00                 BYPASS RACF TAPE TEST  @G32DSMI 34622032
         USING RCVT,WRKR2                                      @G32DSMI 34625032
         TM    RCVTSTA1,RCVTTAPE        TAPE PROTECTION ACTIVE @G32DSMI 34630032
         BO    MNTRAC01                 YES - RACHECK NEEDED   @G32DSMI 34635032
         DROP  WRKR2                                           @G32DSMI 34640032
MNTRAC00 EQU   *                                               @G32DSMI 34645032
*                                                                       34650018
         TM    DEBOPATB,OUTP       OUTPUT PROCESSING                    34740018
         BC    12,MNTTP070        BRANCH IF NO                          34830018
*                                                                       34920018
MNTRAC01 EQU   *                        CHECK FILE PROTECTION  @G32DSMI 34970032
         MVI   RSCCW1,SENSE        MAKE CHANNEL PROGRAM A SENSE OP      35010018
         MVI   RSCCW1+7,SRCHCNT    MAKE LENGTH 5                        35100018
         MVI   RSCCW1+4,SLIFLAG    SUPPRESS WRONG LENGTH RECORD         35190018
*                                                                       35280018
************   ************   ************   ************   *********** 35370018
*                                                                       35460018
*                   ISSUE EXCP TO SENSE FOR FILE PROTECT                35550018
*                                                                       35640018
************   ************   ************   ************   *********** 35730018
*                                                                       35820018
         BAL   DSCNTR,MNTTP110     EXCP/WAIT ROUTINE                    35910018
*                                                                       36000018
         TM    RSJFCB+1,FILEPROT   IS VOLUME FILE PROTECTED             36090018
         BZ    MNTRAC10                 NOT FILE PROTECTED     @G32DSMI 36180032
         TM    DEBOPATB,OUTP            OPEN FOR OUTPUT        @G32DSMI 36184032
         BO    MNTRAC20                 YES-PERFORM MOUNT WITH @G32DSMI 36188032
*                                       RING                   @G32DSMI 36192032
         BAL   DSCNTR,RACINPUT          NO-INPUT CHECK RAC     @G32DSMI 36196032
*                                       AUTHORIZATION          @G32DSMI 36200032
         B     MNTTP070                 AUTHORIZED-CONTINUE    @G32DSMI 36204032
MNTRAC10 EQU   *                        NOT FILE PROTECTED     @G32DSMI 36208032
         BAL   DSCNTR,RACOUTPT          CHECK OUTPUT           @G32DSMI 36212032
*                                       AUTHORIZATION          @G32DSMI 36216032
         B     MNTTP070                 AUTHORIZED CONTINUE    @G32DSMI 36220032
MNTRAC20 EQU   *                        MOUNT WITH RING        @G32DSMI 36260032
*                                                                       36270018
************   ************   ************   ************   *********** 36360018
*                                                                       36450018
*   OUTPUT VOLUME IS FILE PROTECT DETERMINE WHAT ACTION TO TAKE         36540018
*                                                                       36630018
************   ************   ************   ************   *********** 36720018
*                                                                       36810018
         BAL   DSCNTR,MNTTP145    FORMAT MOUNT MESSAGE                  36900018
*                                                                       36990018
         TM    DEBOPATB,INOUT      IS DATA SET OPEN FOR 'INOUT'         37080018
         MVC   MSGAREA+NINE(FOUR),FPMSG1 FILE PROTECT MSG TO     S20038 37120020
*                                       WRITE ARE                S20038 37160020
         MVI   MSGID+53,RTCD20     MOVE ROUTE CODE TO MSG      @ZA07612 37210037
         BC    5,MNTTP035         BRANCH NOT INOUT - WRITE MESSAGE TO   37260018
*                                  OPERATOR INFORMING HIM THAT VOLUME   37350018
*                                  IS FILE PROTECTED, AND REISSUE       37440018
*                                  MOUNT MESSAGE.                       37530018
*                                                                       37620018
************   ************   ************   ************   *********** 37710018
*                                                                       37800018
*   A DATA SET OPENED FOR 'INOUT' IS ON A FILE PROTECTED VOLUME, CHECK  37890018
*   TO SEE IF VOLUME SHOULD BE USED - THAT IS - WRITE TO OPERATOR WITH  37980018
*   A REPLY                                                             38070018
*                                                                       38160018
************   ************   ************   ************   *********** 38250018
*                                                                       38340018
         MVC   MSGAREA+NINE(TWO),FPMSG2 FILE PROTECT MSG2 TO     S20038 38490020
*                                       WRITE ARE                S20038 38550020
         LA    WRKR6,REPLY              PICK UP REPLY ADDRESS           38610018
         ST    WRKR6,REPLYLTH           STORE REPLY ADDRESS             38700018
         MVI   REPLYLTH,ONE        REPLY LENGTH                         38790018
         LA    WRKR6,RSECBAD       PICK UP ECB ADDRESS                  38880018
         ST    WRKR6,REPLYECB           STORE ECB ADDRESS               38970018
         MVI   MSGID+53,RTCDA0     MOVE ROUTE CODE TO MESSAGE  @ZA07612 39100037
*                                                                       39150018
MNTTP065 EQU   *                                                        39240018
         MVI   RSECBAD,COMPCODE    RESET COMPLETION FLAG IN ECB         39330018
         LA    WRKR2,REPLYLTH           MESSAGE BUFFER AREA             39420018
*                                                                       39510018
         WTOR  MF=(E,(1))               WRITE TO OPERATOR               39600018
*                                                                       39690018
*                   WAIT FOR OPERATOR'S REPLY                           39780018
*                                                                       39870018
         WAIT  ,ECB=RSECBAD        WAIT                         YM05548 39960002
*                                                                       40050018
         CLI   REPLY,RINGIN        OPERATOR WILL INSERT FILE PROT RING  40140018
         BE    MNTTP040            BRANCH IF YES                        40230018
*                                                                       40320018
         CLI   REPLY,USED          SHOULD VOLUME BE USED                40410018
         BNE   MNTTP065            NO, REISSUE MOUNT MESSAGE            40500018
*                                  USE VOLUME - CONTINUE                40590018
*                                                                       40680018
*   CHECK IF USER AUTHORIZED FOR INPUT                         @G32DSMI 40680832
         L     DSCNTR,CVTPTR            CVT                    @G32DSMI 40690832
         L     DSCNTR,CVTRAC-CVT(DSCNTR) RAC CVT               @G32DSMI 40700832
         TM    RCVTSTA1-RCVT(DSCNTR),RCVTTAPE IS TAPE          @G32DSMI 40710832
*                                       PROTECTION ACTIVE      @G32DSMI 40720832
         BZ    MNTTP070                 NO-CONTINUE            @G32DSMI 40730832
         BAL   DSCNTR,RACINPUT          CHECK AUTHORIZATION    @G32DSMI 40740832
************   ************   ************   ************   *********** 40770018
*                                                                       40860018
*              DETERMINE IF WE ARE COMING FROM THE NONSTANDARD LABEL    40950018
*              ROUTINE.                                                 41040018
*                                                                       41130018
************   ************   ************   ************   *********** 41220018
*                                                                       41310018
MNTTP070 EQU   *                                                        41400018
         TM    RSDCBFLG,NSLFLAG    ARE WE COMING FROM NSL RTN           41490018
         BO    MNTTP077            BRANCH IF YES                 A25997 41580019
*                                                                       41670018
* INCREMENT TO NEXT TABLE ENTRY-IF NOT LAST CONTINUE PROCESSING-IF LAST 41760018
* ENTRY GO TO  -  NSL PROCESSING -                                      41850018
*                                                                       41940018
         TM    TABFLG1,TABLAST     IS THIS THE LAST ENTRY               42030002
         LA    WRKR4,TABENT(WRKR4) INCREMENT TO NEXT ENTRY              42120018
         BZ    MNTTP005            BRANCH IF NOT LAST ENTRY             42210018
*                                                                       42300018
************   ************   ************   ************   *********** 42390018
*                                                                       42480018
*  AT THIS POINT ALL TAPE ENTRIES IN THE TABLE HAVE BEEN PROCESSED.     42570018
*  WE WILL NOW SPIN THRU THE TABLE TO SEE IF THERE ARE ANY NSL TAPE     42660018
*  ENTRIES. IF THERE ARE WE WILL EXIT TO THE USER'S NONSTANDARD         42750018
*  LABEL PROCESSING ROUTINE FOR EACH NONSTANDARD LABEL ENTRY.           42840018
*                                                                       42930018
*  THE USER IS PASSED A POINTER TO THE TABLE. EACH ENTRY IN THE TABLE   43020018
*  CONTAINS A POINTER TO A DCB AND ALSO TO A CONTROL BLOCK AREA.        43110018
*  THE FORMAT OF THE TABLE ENTRIES AND THE CONTROL BLOCK AREA ARE       43200018
*  CONTAINED IN A DSECT AT THE END OF THIS PROGRAM.                     43290018
*                                                                       43380018
************   ************   ************   ************   *********** 43470018
*                                                                       43560018
         LR    WRKR4,TABLR         TABLE ADDRESS TO WRKR4               43650018
MNTTP072 EQU   *                                                        43830018
         TM    TABFLG1,TABTAPE          IS THIS A TAPE DEVICE    A46376 43860002
         BZ    MNTTP090           IF NOT, BRANCH                 A35767 43890020
         TM    TABTPLBL,NSL        NONSTANDARD LABEL SPECIFIED          43920018
         BZ    MNTTP087            BRANCH IF NO                @ZA18506 44010037
         B     MNTTP077            BRANCH TO READ JFCB                  44050018
*                                                                       44100018
************   ************   ************   ************   *********** 44190018
*                                                                       44280018
*  PREPARE TO READ IN THE JFCB FOR THIS NONSTANDARD TAPE LABEL ENTRY    44370018
*                                                                       44460018
* WHEN THIS MODULE RECEIVED CONTROL THE CONTROL BLOCKS IN THE WORKAREA  44550018
* WERE SET UP TO READ IN A JFCB. HOWEVER IN ORDER TO READ IN THE TAPE   44640018
* LABEL AND REWIND THE TAPE IT WAS NECESSARY TO ALTER THE FIELDS IN THE 44730018
*WORKAREA. NOW THAT WE WANT TO READ IN THE JFCB WE MUST RESTORE THE     44820018
*FIELDS.                                                                44910018
*                                                                       45000018
************   ************   ************   ************   *********** 45090018
*                                                                       45180018
MNTTP075 EQU   *                                                        45270018
         L     WRKR3,TABFLG1       LOAD WORK AREA ADDRESS-POINTS TO DEB 45360018
         LA    DEBR,RSBUFSEG        SAVE DATA ADDRESS                   45450018
         ICM   WRKR2,ALLBYTS,QMNPRMWA   GET QMNGR PARM LIST ADDR YM5965 45500002
         BNZ   MNTTP073            BRANCH IF PARM ADDR NON-ZERO  YM5965 45501202
*********************************************************************** 45502002
*   GET SPACE FOR QMNGRIO PARAMETER LIST AND WORK AREA THE INITIALIZE * 45504002
*   IT.  QMNGRIO IS USED TO READ IN THE JFCB FROM SCHEDULER WORK      * 45506002
*   AREA (SWA) FOR EACH NON STANDARD LABEL (NSL) DATA SET ENTRY.      * 45508002
*********************************************************************** 45508402
         ICM   WRKR1,ADDRBYTS,QMNGWALN  SET QMNGR P.L.+W.A.LGTH  YM5965 45508802
         ICM   WRKR1,HIORDER,SP253      SUBPOOL 253              YM5965 45509202
         GETMAIN  R,LV=(0)              ISSUE GETMAIN            YM5965 45509602
         USING QMIOP,WRKR2                                       YM5965 45509702
         XC    QMITCBAD(D24),QMITCBAD   CLEAR PARM LIST          YM5965 45509802
         LA    WRKR1,QMWAOFST           GET WORK AREA OFFSET     YM5965 45509902
         AR    WRKR1,WRKR2              CALC ADDR OF WORK AREA   YM5965 45559902
         ST    WRKR1,QMIWRKAD           STORE IN PARM LIST       YM5965 45569902
         L     WRKR1,RSTCBAD            GET TCB ADDR             YM5965 45579902
         ST    WRKR1,QMITCBAD           STORE TCB ADR IN PRM LST YM5965 45589902
         LA    WRKR1,JFCBLNGH           GET LENGTH OF JFCB       YM5965 45599902
         STH   WRKR1,QMIRECL            STORE REC LNGTH IN P.L.  YM5965 45601902
         MVI   QMIFLAGS,QMIOREAD        SET READ FUNCTION        YM5965 45603902
         ST    WRKR2,QMNPRMWA           SAVE PARM LIST ADDR      YM5965 45605902
*                                                                       45607902
MNTTP073 EQU   *                                                 YM5965 45608302
         ST    DEBR,QMIRECAD            STORE JFCB READ IN ADR   Y02076 45609902
         L     WRKR1,TABVLID5+2   LOAD TTR INTO REG. 0                  46460018
         TM    TABFLG2,TABG5V      MORE THAN 5 VOLUMES                  46480002
         BO    MNTTP076           BRANCH IF YES                         46500018
*                                                                       46520018
         L     WRKR1,TABNVOLS     JFCB TTR-LOAD                         46540018
*                                                                       46560018
MNTTP076 EQU   *                                                        46580018
*                                                                       46600018
         SLL   WRKR1,8             LEFT JUSTIFY TTR                     46620018
         ST    WRKR1,QMIDSKAD           STORE TTR IN PARM LST    Y02076 46670002
         STM   WRKR4,WRKR5,RSERAS01     SAVE REGS ACROSS QMNGRIO YM5965 46672002
         LA    WRKR4,RSREGSAV           POINT TO SAVE AREA       YM5965 46674002
*                                       FOR QMNGRIO              YM5965 46676002
         QMNGRIO                        READ IN JFCB             Y02076 46680002
         LM    WRKR4,WRKR5,RSERAS01     RESTORE REGISTERS        YM5965 46682002
         LTR   WRKR6,WRKR6              TEST QMNGRIO RET. CODE   Y02076 46690002
         BNZ   MNTTP120                 ERR-BR TO SET CODE-EXIT  Y02076 46700002
         L     CTABLR,TABDCBAD-1   LOAD DCB ADDRESS                     47970018
         L     DEBR,DCBDEBAD      LOAD DEB ADDRESS                      48060018
         BR    TCBR                RETURN                               48070018
*                                                                       48080018
*********      **********     **********     **********     *********** 48090018
*                                                                       48100018
MNTTP077 EQU   *                                                        48110018
*                                                                       48120018
         BAL   TCBR,MNTTP075       READ IN JFCB                         48130018
*                                                                       48140018
         L     UCBR,DEBSUCBA            LOAD UCB ADDRESS         Y02076 48190002
         MVC   RSDEBUCB(D4),DEBSUCBA    UCB ADR TO WORKAREA(DEB) Y02076 48240002
*                                                                       48330018
************   ************   ************   ************   *********** 48420018
*                                                                       48510018
*               TRANSFER CONTROL TO USER'S NONSTANDARD LABEL ROUTINE    48600018
*                                                                       48690018
************   ************   ************   ************   *********** 48780018
*                                                                       48870018
MNTTP080 EQU   *                                                        48960018
         OI    RSDCBFLG,NSLFLAG    TURN ON NSL ENTRY INDICATOR          49140018
         LR    CTABLR,WRKR4        TABLE ADDRESS TO REG. 9              49230018
         MVC   TABVLID1+10(8),NAMENSL                                   49320018
         LA    WRKR6,TABVLID1+18                                        49410018
*                                                                       49500018
         XCTL  EPLOC=TABVLID1+10,SF=(E,(15))                            49590018
*                                                                       49680018
************   ************   ************   ************   *********** 49770018
*                                                                       49860018
*                   NONSTANDARD LABEL PROCESSING ROUTINE.               49950018
*                                                                       50040018
************   ************   ************   ************   *********** 50130018
*                                                                       50220018
MNTTP085 EQU   *                                                        50310018
         TM    TABTPLBL,ERRINNSL   DID AN ERROR OCCUR IN NSL ROUTINE    50400018
         BO    MNTTP125       BRANCH IF YES                             50490018
*                                                                       50580018
         TM    SRTEDMCT,MOUNTON    WAS CORRECT VOLUME MOUNTED           50670018
         BZ    MNTTP087           BRANCH IF CORRECT VOL        @ZA18506 50760037
*                                                                       50810037
         NI    SRTEDMCT,MOUNTOFF   MOUNT SW OFF - DATA MANG. COUNT TO 0 50860037
         XC    SRTEVOLI+1(5),SRTEVOLI+1 CLEAR 5 BYTES OF VOL SER M3946  50910037
         B     MNTTP005           BRANCH - INCORRECT VOLUME MOUNTED     50960037
*                                                              @ZA18506 51010037
MNTTP087 EQU   *                  TEST DEQ-AT-DISMOUNT         @ZA18506 51060037
*                                                              @ZA18506 51110037
         BAL   DSCNTR,MNTTP118    TEST DEQ STATUS              @ZA18506 51160037
*                                                              @ZA18506 51210037
************   ************   ************   ************   *********** 51300018
*                                                                       51390018
*              CHECK FOR LAST ENTRY DOING NONSTANDARD LABEL PROCESSING  51480018
*                                                                       51570018
************   ************   ************   ************   *********** 51660018
*                                                                       51750018
MNTTP090 EQU   *                                                        51840018
         TM    TABFLG1,TABLAST     LAST TABLE ENTRY                     51930002
         LA    WRKR4,TABENT(WRKR4) INCREMENT TO NEXT ENTRY              52020018
         BZ    MNTTP072            BRANCH IF NOT LAST ENTRY             52110018
*                                                                       52200018
************   ************   ************   ************   *********** 52290018
*                                                                       52380018
*                   PREPARE TO EXIT TO NEXT MOD                         52470018
*                                                                       52560018
************   ************   ************   ************   *********** 52650018
*                                                                       52740018
MNTTP095 EQU   *                                                        52830018
         ICM   WRKR1,ADDRBYTS,QMNGWALN  SET UP FREEMAIN PARMS    Y02076 52880002
         ICM   WRKR1,HIORDER,SP253      SUBPOOL 253              Y02076 52930002
         ICM   WRKR2,ALLBYTS,QMNPRMWA   GET ADR OF QMNGRIO P.L.  YM5965 52980002
         BZ    MNTTP096                 BRANCH IF ADDR IS ZERO   YM5965 52990002
         FREEMAIN  R,LV=(0),A=(1)       ISSUE FREEMAIN           Y02076 53030002
MNTTP096 EQU   *                                                 YM5965 53080002
         TM    RSDCBFLG,DAFLAG     WAS A DA DATA SET PROCESSED          53100018
         BO    MNTTP100            BRANCH TO GET WORKAREA FOR XCTL      53190018
*                                                                       53280018
         MVI   RSPPM+4,C'L'        XCTL TO IGC0L05B                 MCS 53370018
*                                                                       53460018
MNTTP100 EQU   *                                                        53550018
*                                                                YM7890 53600002
*        AT THIS POINT, WITH ALL MOUNT REQUESTS SATISFIED, THE   YM7890 53610002
*        MEMORY CAN AGAIN BE ENABLED FOR SWAP-OUT.               YM7890 53620002
*                                                                YM7890 53630002
         SYSEVENT OKSWAP           ENABLE SWAP-OUT               YM7890 53632002
*                                                                YM7890 53634002
         LA    WRKR6,RSPPM+8                                        MCS 53640018
*******************   **************   ***********   *********   ****   53730018
         LR    WRKR2,BUFR         POINT REG. 1 TO THE RESTART W/A       53820018
*******************   **************   ***********   *********   ****   53910018
*                                                                       54000018
         NI    RSDCBFLG,X'FF'-NSLFLAG                            A50338 54050000
*                                 TURN OFF NSL RETURN IND.       A50338 54060000
         XCTL  EPLOC=RSPPM,SF=(E,(15))                              MCS 54090018
*                                                                       54180018
************   ************   ************   ************   *********** 54270018
*                                                                       54360018
* INCREMENTS POINTER TO NEXT UCB IN TIOT & CHECKS FOR LAST ENTRY        54450018
*                                                                       54540018
************   ************   ************   ************   *********** 54630018
*                                                                       54720018
MNTTP105 EQU   *                                                        54810018
         LA    WRKR5,4(WRKR5)      INCREMENT TO NEXT DDNAME             54900018
         LH    DCBR,DCBTIOT       LOAD TIOT OFFSET                      54990018
         SR    WRKR6,WRKR6        CLEAR REGISTER                        55080018
         IC    WRKR6,0(TIOTR,DCBR) PICK UP LENGTH OF DD ENTRY           55170018
         AR    DCBR,TIOTR                                               55260018
         AR    DCBR,WRKR6         DCBR POINTS TO END OF DD ENTRY        55350018
         LA    WRKR6,0(TIOTR,WRKR5)  CURRENT UCB ADDRESS PLUS 4         55440018
         CR    DCBR,WRKR6         END OF DD ENTRY                       55530018
         L     UCBR,0(TIOTR,WRKR5) PICK UP UCB ADDRESS                  55620018
         BR    DSCNTR              RETURN                        A25775 55710019
*                                                                       55800018
************   ************   ************   ************   *********** 55890018
*                                                                       55980018
*                EXCP ROUTINE - RETURN ON REGISTER 15                   56070018
*                                                                       56160018
************   ************   ************   ************   *********** 56250018
*                                                                       56340018
MNTTP110 EQU   *                                                        56430018
         EXCP  RSIOB               EXCP CHANNEL PROGRAM                 56520018
*                                                                       56610018
         WAIT  ,ECB=RSECBAD       WAIT                                  56700018
         TM    RSMWOFST,X'80'      MUST A DOM BE ISSUED             MCS 56710018
         BZ    TESTERR                  BRANCH IF NO                MCS 56720037
         LA    WRKR2,RSREGSAV+12        GET ADDRESS OF DOM LIST ZA02206 56730037
         XC    RSREGSAV+12(12),RSREGSAV+12  ZERO 3 WORDS        ZA02206 56734037
         OC    RSREGSAV+13(3),UCBFSER   MOVE MSGID              ZA02206 56736037
         BZ    MNTTP900                 NO MAGID                ZA02206 56738837
         LA    WRKR2,4(WRKR2)           NEXT MSGID FIELD        ZA02206 56739237
MNTTP900 EQU   *                                                ZA02206 56739637
         OC    1(3,WRKR2),UCBFSER+3      MOVE SECOND MSGID      ZA02206 56739737
         BZ    MNTTP901                 NO MSID                 ZA02206 56739837
         LA    WRKR2,4(WRKR2)           NEXT MSGID FIELD        ZA02206 56739937
MNTTP901 EQU   *                                                ZA02206 56743237
         OC    1(3,WRKR2),RSMWOFST+1      MOVE IN ID            ZA02206 56745237
         BZ    MNTTP902                 NO MSGID                ZA02206 56747237
         LA    WRKR2,4(WRKR2)           NEXT MSGID              ZA02206 56747637
MNTTP902 EQU   *                                                ZA02206 56749237
         LA    WRKR1,4                                          ZA0206  56749637
         SR    WRKR2,WRKR1              MOVE BACK 4 BYTES       ZA02206 56749737
         MVI   0(WRKR2),X'80'           END OF DOM LIST FLAG    ZA02206 56749837
         LA    WRKR2,RSREGSAV+12        ADDR OF FIRST MSGID     ZA02206 56749937
         DOM   MSGLIST=(1)                                          MCS 56750037
         XC    RSMWOFST(4),RSMWOFST      ZERO MSGID DOM         ZA02206 56752037
         XC    UCBFSER(6),UCBFSER       ZERO MSGID              ZA02206 56754037
         NI    UCBSTAB,X'FF'-UCBBNUL    ZERO MSGID BIT          ZA02206 56756037
TESTERR  EQU   *                                                    MCS 56760018
*                                                                       56790018
         TM    RSECBAD,PERMERR     I/O ERROR                            56880018
         BCR   1,DSCNTR                 NO BRANCH                       56970018
         CLI   RSCCW1,SEARCH       READING IN JFCB                      57000018
         BE    MNTTP120       BRANCH IF YES                             57030018
         CLI   RSECBAD,INTECEPT         TST FOR INTERCEPT       YM05549 57040002
         BNE   MNTTP112                 BR IF NOT               YM05549 57050002
         CLI   RSCCW1,REWIND            REWIND COMMAND          YM05549 57052002
         BE    MNTTP110                 YES-REISSUE REWIND      YM05549 57054002
         B     MNTTP130                 NO-BR TO ERR RTN        YM05549 57056002
MNTTP112 EQU   *                                                YM05549 57058002
*                                                                       57060018
         TM    TABTPLBL,SL         STANDARD LABELS                      57150018
         BCR   8,DSCNTR                 NO  BRANCH                      57240018
*                                                                       57330018
         TM    RSIOBCSW+4,UNITCHK  UNIT CHECK                           57420018
         BO    MNTTP130            YES BRANCH PERM I/O ERROR            57510018
*                                                                       57600018
         TM    RSIOBCSW+5,WRONGLEN WRONG LENGTH RECORD                  57690018
         BZ    MNTTP130            NO BRANCH PERM I/O ERROR             57780018
*                                                                       57870018
         TM    RSIOBCSW+4,UNITEXP       TAPE MARK FOUND?        ZA01325 57870502
         BNO   MNTTP130                 NO BRANCH               ZA01325 57871002
         CLI   RSCCW1,CCWFSR            FORWARD SPACE CMD?      ZA01325 57871502
         BNE   MNTTP130                 NO BRANCH               ZA01325 57872002
         MVI   RSCCW1,REWIND            REWIND TAPE CMD         ZA01325 57872502
         MVI   RSCCW1+4,X'00'           ONLY ONE CCW            ZA01325 57873002
         LA    DSCNTR,MNTTP055          RETURN ADDR FROM REWIND ZA01325 57873502
         B     MNTTP110                 GO REWIND THE TAPE      ZA01325 57874002
*                                                                       58050018
************   ************   ************   ************   *********** 58140018
*                                                                       58230018
*      FORM CCW & PLACE UNIT ADDRESS IN DEB                             58320018
*                                                                       58410018
************   ************   ************   ************   *********** 58500018
*                                                                       58590018
MNTTP115 EQU   *                                                        58680018
         ST    UCBR,RSDEBUCB  PLACE UCB ADDRESS IN DEB                  58770018
         MVC   RSDEBUCB(D1),DEBSDVM     SET MODE CODE            Y02076 58820002
         TM    RSDEBUCB,MODECLR         IS THIS NINE TRACK       99223  58821002
         BO    MNTTP116                 YES. BRANCH              99223  58822002
         NI    RSDEBUCB,MODECLR    CLEAR ALL BUT DENSITY                58950018
         OI    RSDEBUCB,SETMODE    SET EVEN PAR.,TRANS MODE,CONVERT OFF 59040018
MNTTP116 EQU   *                                                  99223 59041002
         LA    TCBR,X'50'              SET CCW BYTE COUNT        A40520 59070021
         ST    TCBR,RSCCW1+4                                     A40520 59100021
         LA    TCBR,RSJFCB        LOAD DATA AREA ADDRESS                59220018
         ST    TCBR,RSCCW1        DATA AREA ADDRESS TO CHANNEL PROGRAM  59310018
         MVI   RSCCW1,X'0F'            SET REWIND - UNLOAD       A40520 59340021
*                                       COMMAND                  A40520 59370021
         BR    DSCNTR             RETURN                                59400018
         EJECT                                                          59401037
*                                                                       59402037
************   ************   ************   ************   *********** 59403037
*  TEST IF DEQ AT DISMOUNT FACILITY WERE ACTIVE AND CAN BE     @ZA18506 59404037
*  REESTABLISHED. IF SO, DEQ ALL VOLUME SERIALS UP TO BUT NOT  @ZA18506 59405037
*  INCLUDING THE ONE TO WHICH THE DCB IS NOW OPEN.             @ZA18506 59406037
************   ************   ************   ************   *********** 59407037
*                                                              @ZA18506 59408037
MNTTP118 EQU   *                  CHECK FOR DEQ                @ZA18506 59409037
*                                                              @ZA18506 59410037
         TM    TABFLG1,TABTAPE    IS THIS A TAPE               @ZA18506 59411037
         BZR   DSCNTR             RETURN IF NO                 @ZA18506 59412037
         LA    TCBR,TABJFCB       JFCB TTR IF LESS THAN OR     @ZA18506*59413037
                                  EQUAL TO 5 VOLUMES           @ZA18506 59414037
         TM    TABFLG2,TABG5V     ARE THERE 5 VOLUMES          @ZA18506 59415037
         BZ    MNTTP12A           BRANCH IF NOT 5              @ZA18506 59416037
         LA    TCBR,TABVLID5+D3   JFCBTTR IF 5 VOLUMES         @ZA18506 59417037
*                                                              @ZA18506 59418037
MNTTP12A EQU   *                  LOCATE JFCB                  @ZA18506 59419037
*                                                              @ZA18506 59420037
         IECRES LOCJFCB,(TCBR)    GET JFCB ADDR IN TCBR        @ZA18506 59421037
         TM    JFCBFLG3-INFMJFCB(TCBR),JFCDQDSP WAS THE DEQ    @ZA18506*59422037
                                  FACILITY IN USE              @ZA18506 59423037
         BZR   DSCNTR             RETURN IF NOT                @ZA18506 59424037
         L     CTABLR,TABDCBAD-D1 DCB                          @ZA18506 59425037
         L     DEBR,DCBDEBAD      DEB                          @ZA18506 59426037
         TM    DEBOPATB,OUTP      OUTPUT TAPE                  @ZA18506 59427037
         BNOR  DSCNTR             RETURN IF INPUT/RDBACK       @ZA18506 59428037
*                                                              @ZA18506 59429037
         TESTAUTH FCTN=1          APF AUTHORIZED               @ZA18506 59430037
*                                                              @ZA18506 59431037
         LTR   WRKR6,WRKR6        ZERO IF AUTHORIZED           @ZA18506 59432037
         BNZR  DSCNTR             RETURN IF NOT AUTHORIZED     @ZA18506 59433037
*                                                              @ZA18506 59434037
*  RESTORE DEQ AT DISMOUNT FACILITY ENVIRONMENT.               @ZA18506 59435037
*  SET UCBDQDSP IN CURRENT VOLUME AND DEQ ALL VOLUME SERIALS   @ZA18506 59436037
*  IN THE JFCB AND JFCBX'S UP TO DEBVOLSQ'S VOLUME.            @ZA18506 59437037
*                                                              @ZA18506 59438037
         L     UCBR,DEBSUCBA      UCB OF CURRENT VOLUME        @ZA18506 59439037
         OI    UCBTFL1,UCBDQDSP   RESET DEQ STATUS             @ZA18506 59440037
*                                                              @ZA18506 59441037
*  SET UP FOR DOUBLE LOOP                                      @ZA18506 59442037
*    DEBR - NUMBER OF VOLUMES TO BE DEQED                      @ZA18506 59443037
*    WRKR3 - NUMBER OF VOLUMES IN JFCB(5) OR JFCBX(15)         @ZA18506 59444037
*    DCBR - ADDRESS OF NEXT JFCBX'S TTR                        @ZA18506 59445037
*    UCBR - ADDRESS OF VOLUME TO DEQ                           @ZA18506 59446037
*    TCBR - ADDRESS OF INITIATOR TCB                           @ZA18506 59447037
*                                                              @ZA18506 59448037
         LA    UCBR,DEBSUCBA+L'DEBSUCBA ACCESS METHOD SECTION  @ZA18506 59449037
         SR    DEBR,DEBR          ZERO FOR IC                  @ZA18506 59450037
         IC    DEBR,DEBVOLSQ-DEBACSMD+D1(UCBR) VOLUME SEQUENCE @ZA18506 59451037
         CH    DEBR,CONSTONE      RESTART ON FIRST VOLUME      @ZA18506 59452037
         BER   DSCNTR             RETURN IF NONE TO DEQ        @ZA18506 59453037
         BCTR  DEBR,0             NUMBER OF VOLUMES TO DEQ     @ZA18506 59454037
         LA    DCBR,JFCBEXAD-INFMJFCB(TCBR) ADDR OF JFCBX TTR  @ZA18506 59455037
         LA    WRKR3,L'JFCBVOLS/L'UCBVOLI NUMBER OF JFCB VOLS  @ZA18506 59456037
         LA    UCBR,JFCBVOLS-INFMJFCB(TCBR) FIRST VOLUME       @ZA18506 59457037
         L     TCBR,RSTCBAD       TCB                          @ZA18506 59458037
         USING TCB,TCBR                                        @ZA18506 59459032
         L     TCBR,TCBJSCB       JSCB                         @ZA18506 59459232
         DROP  TCBR                                            @ZA18506 59459432
         L     TCBR,JSCBTCBP-IEZJSCB(TCBR) INITIATOR TCB       @ZA18506 59460037
         MVC   DEQPLIST,DEQLIST   MOVE LIST FOR DEQ            @ZA18506 59461037
*                                                              @ZA18506 59462037
MNTTP12C EQU   *                  LOOP FOR JFCB AND EACH JFCBX @ZA18506 59463037
*                                                              @ZA18506 59464037
MNTTP12E EQU   *                  LOOP FOR EACH VOLUME         @ZA18506 59465037
*                                                              @ZA18506 59466037
         DEQ   (,(UCBR)),TCB=(TCBR),RET=HAVE,MF=(E,DEQ) DEQ    @ZA18506 59467037
         BCT   DEBR,MNTTP12G      BRANCH IF MORE VOLUMES LEFT  @ZA18506 59468037
*                                                              @ZA18506 59469037
         BR    DSCNTR             RETURN IF NO MORE VOLUMES    @ZA18506 59470037
*                                                              @ZA18506 59471037
MNTTP12G EQU   *                  MORE VOLUMES LEFT TO DEQ     @ZA18506 59472037
*                                                              @ZA18506 59473037
         LA    UCBR,L'UCBVOLI(,UCBR) INCREMENT TO NEXT VOLSER  @ZA18506 59474037
         BCT   WRKR3,MNTTP12E     BR IF MORE VOLS IN JFCB(X)   @ZA18506 59475037
         IECRES LOCJFCB,(DCBR)    GET NEXT JFCBX               @ZA18506 59476037
         LA    UCBR,JFCBXVOL-JFCBX(,DCBR) ADDR OF FIRST VOLSER @ZA18506 59477037
         LA    DCBR,JFCBXTTR-JFCBX(,DCBR) NEXT JFCBX TTR ADDR  @ZA18506 59478037
         LA    WRKR3,D15          NUMBER OF VOLSERS IN JFCBX   @ZA18506 59479037
         B     MNTTP12C           BR TO DEQ VOLS IN JFCBX      @ZA18506 59480037
         EJECT                                                          59481037
*                                                                       59490018
************   ************   ************   ************   *********** 59580018
*                                                                       59670018
*                   ERROR RETURN CODES                                  59760018
*                                                                       59850018
************   ************   ************   ************   *********** 59940018
*                                                                       60030018
MNTTP120 EQU   *                                                        60120018
*                                                                       60210018
         MVI   RSRETCOD+1,ERR026   26 ERROR READING IN JFCB    @ZSUT222 60300032
         B     MNTTP140            BRANCH TO XCTL                       60350032
*                                                                       60400032
MNTTP125 EQU   *                                                        60450032
         MVI   RSRETCOD+1,ERR030   30 I/O ERROR IN NSL ROUTINE @ZSUT222 60500032
         B     MNTTP140            BRANCH TO XCTL                       60550032
*                                                                       60600032
MNTTP130 EQU   *                                                        60650032
         MVI   RSRETCOD+1,ERR040   40 ERROR IN READ VOL LABEL  @ZSUT222 60700032
         B     MNTTP140            BRANCH TO XCTL                       60750032
*                                                                       60800032
MNTTP131 EQU   *                                                YM05550 60850032
         MVI   RSRETCOD+1,ERR046        NO SCU ERROR           @ZSUT222 60900032
         B     MNTTP140                 BR TO XCTL              YM05550 60950032
*                                                                       61000032
MNTTP135 EQU   *                                                        61050032
         MVI   RSRETCOD+1,ERR044   44 NO UCB AVAILABLE         @ZSUT222 61100032
*                                                                       61150032
MNTTP140 EQU   *                                                        61200032
         MVC   RSREGSAV(8),MODID   SAVE NAME OF MODULE THAT    @ZSUT222 61250032
*                                  HAS DETECTED THE ERROR.     @ZSUT222 61300032
         STM   0,15,RSREGSAV+8     SAVE CURRENT REGISTERS.     @ZSUT222 61350032
         MVI   RSPPM+4,C'V'        XCTL TO IGC0V05B                 MCS 61830018
*                                                                       61920018
         B     MNTTP100            BRANCH TO GET WORKAREA FOR XCTL      62010018
         EJECT                                                 @G32DSMI 62014032
***************************************************************@G32DSMI 62016032
*   RAC INPUT AUTHORIZATION CHECK                             *@G32DSMI 62018032
***************************************************************@G32DSMI 62020032
RACINPUT TM    TABFLG4,TABRCINP         PREVIOUSLY CHECKED OK  @G32DSMI 62022032
         BOR   DSCNTR                   YES-BYPASS CHECK       @G32DSMI 62024032
         L     WRKR2,CVTPTR             ADDRESS OF CVT         @G32DSMI 62024232
         USING CVT,WRKR2                                       @G32DSMI 62024432
         L     WRKR2,CVTRAC             ADDRESS OF RACV CVT    @G32DSMI 62024632
         LTR   WRKR2,WRKR2              RACF ACTIVE            @G32DSMI 62024832
         BZR   DSCNTR                   RACF NOT ACTIVE RETURN @G32DSMI 62025032
         USING RCVT,WRKR2                                      @G32DSMI 62025232
         TM    RCVTSTA1,RCVTTAPE        TAPE OPTION SET        @G32DSMI 62025432
         BZR   DSCNTR                   NOT SET - RETURN       @G32DSMI 62025632
         DROP  WRKR2                                           @G32DSMI 62025832
**  BYPASS RACF CHECKING IF JSCBPASS IS SET                    @G32DSPD 62026032
         USING PSA,0                    ADDRESS THE PSA        @G32DSPD 62026132
         L     WRKR2,PSATOLD            GET CURRENT TCB ADDR   @G32DSPD 62026232
         USING TCB,WRKR2                ADDRESS THE TCB        @G32DSPD 62026332
         L     WRKR2,TCBJSCB            GET THE JSCB           @G32DSPD 62026432
         USING IEZJSCB,WRKR2            ADDRESS THE JSCB       @G32DSPD 62026532
         L     WRKR2,JSCBACT            GET ACTIVE JSCB        @G32DSPD 62026632
         TM    JSCBSWT1,JSCBPASS        BYPASS RACF SET ?      @G32DSPD 62026732
         BOR   DSCNTR                   YES,RETURN             @G32DSPD 62026832
         DROP  WRKR2                                           @G32DSPD 62026932
         MVC   RACHECK(LRACHECK),MRACHECK INITLZE PARM LIST    @G32DSMI 62027032
         RACHECK ENTITY=UCBVOLI,        ISSUE RACHECK          @G32DSMIX62028032
               ATTR=READ,                                      @G32DSMIX62030032
               MF=(E,RACHECK)                                  @G32DSMI 62032032
         B     RACITAB(WRKR6)           CHECK RETURN CODE      @G32DSMI 62034032
RACITAB  EQU   *                        BRANCH TABLE RACHECK   @G32DSMI 62036032
         OI    TABFLG4,TABBYPSW         AUTHORIZED-NO PASSWORD @G32DSMI 62038032
         B     RACINP10                 AUTHORIZED OR NOT DEF  @G32DSMI 62040032
         B     RACERR00                 NOT AUTHORIZED-ERROR   @G32DSMI 62042032
RACINP10 EQU   *                        AUTHORIZED OR NOT DEF  @G32DSMI 62044032
         OI    TABFLG4,TABRCINP         AUTHORIZED INPUT       @G32DSMI 62045032
         BR    DSCNTR                   RETURN                 @G32DSMI 62046032
***************************************************************@G32DSMI 62048032
*   RAC OUTPUT AUTHORIZATION CHECK                            *@G32DSMI 62050032
***************************************************************@G32DSMI 62052032
RACOUTPT EQU   *                                               @G32DSMI 62054032
         L     WRKR2,CVTPTR             CVT ADDRESSABILITY     @G32DSMI 62055032
         USING CVT,WRKR2                                       @G32DSMI 62056032
         L     WRKR2,CVTRAC             RACF CVT ADDRESSABILITY@G32DSMI 62057032
         LTR   WRKR2,WRKR2              RACF ACTIVE            @G32DSMI 62058032
         BZR   DSCNTR                   NO - RETURN            @G32DSMI 62059032
         USING RCVT,WRKR2                                      @G32DSMI 62062032
         TM    RCVTSTA1,RCVTTAPE        TAPE PROTECTION ACTIVE @G32DSMI 62064032
         BZR   DSCNTR                   NO-AUTHORIZED RETURN   @G32DSMI 62066032
         DROP  WRKR2                                           @G32DSMI 62068032
**  BYPASS RACF CHECKING IF JSCBPASS IS SET                    @G32DSPD 62068132
         USING PSA,0                    ADDRESS THE PSA        @G32DSPD 62068232
         L     WRKR2,PSATOLD            GET CURRENT TCB ADDR   @G32DSPD 62068332
         USING TCB,WRKR2                ADDRESS THE TCB        @G32DSPD 62068432
         L     WRKR2,TCBJSCB            GET THE JSCB           @G32DSPD 62068532
         USING IEZJSCB,WRKR2            ADDRESS THE JSCB       @G32DSPD 62068632
         L     WRKR2,JSCBACT            GET ACTIVE JSCB        @G32DSPD 62068732
         TM    JSCBSWT1,JSCBPASS        BYPASS RACF SET ?      @G32DSPD 62068832
         BOR   DSCNTR                   YES,RETURN             @G32DSPD 62068932
         DROP  WRKR2                                           @G32DSPD 62069032
         MVC   RACHECK(LRACHECK),MRACHECK INITLZE PARM LIST    @G32DSMI 62070032
         RACHECK ENTITY=UCBVOLI,        ISSUE RACHECK          @G32DSMIX62072032
               ATTR=UPDATE,                                    @G32DSMIX62074032
               MF=(E,RACHECK)                                  @G32DSMI 62076032
         B     RACOTAB(WRKR6)           CHECK RETURN CODE      @G32DSMI 62078032
RACOTAB  EQU   *                        BRANCH TABLE RACHECK   @G32DSMI 62080032
         OI    TABFLG4,TABBYPSW         AUTHORIZED NO PASSWORD @G32DSMI 62082032
         B     RACOUT10                 AUTHORIZED OR NOT DEF  @G32DSMI 62084032
         TM    DEBOPATB,OUTP            OPEN FOR INPUT         @G32DSMI 62086032
         BO    RACERR00                 NO-OUTPUT ERROR        @G32DSMI 62086232
         BAL   DSCNTR,RACINPUT          INPUT AUTHORIZED       @G32DSMI 62086432
*   FORMAT MESSAGE IEC068A AND ISSUE.                          @G32DSMI 62086632
         BAL   DSCNTR,MNTTP145          FORMAT MOUNT MESSAGE   @G32DSMI 62086832
         MVC   MSGAREA+7(L'FPMSG068),FPMSG068 FORMAT MESSAGE   @G32DSMI 62087032
         WTO   MF=(E,MSGAREA)           WTO PARM LIST          @G32DSMI 62087232
         B     MNTTP040                 UNLOAD TAPE            @G32DSMI 62087432
RACOUT10 EQU   *                        AUTHORIZED FOR OUTPUT  @G32DSMI 62088032
         OI    TABFLG4,TABRCOUT         SET FLAG FOR TRACE     @G32DSMI 62090032
         BR    DSCNTR                   RETURN TO CALLER       @G32DSMI 62092032
         EJECT                                                 @G32DSMI 62096032
***************************************************************@G32DSMI 62098032
*   USER NOT AUTHORIZED TO RAC VOLUME SEND MESSAGE            *@G32DSMI 62100032
***************************************************************@G32DSMI 62102032
RACERR00 MVI   RSRETCOD+1,ERR255        RAC TYPE ERROR         @ZSUT222 62104032
*   SET UP PARAMETER LIST FOR IGCMSG6C.                        @G32DSMI 62106032
         MVC   OPID,K05BID              CALL ER=K05B           @G32DSMI 62108032
         MVC   OPRETCOD,K05BID          RETURN FOR IHJ102I     @G32DSMI 62110032
         LA    WRKR6,UCBVOLI            VOLSER                 @G32DSMI 62112032
         ST    WRKR6,OPADDVOL                                  @G32DSMI 62114032
         LA    WRKR2,OPID                                      @G32DSMI 62116032
         ST    WRKR2,OPPARM                                    @G32DSMI 62118032
         LA    WRKR2,OPPARM                                    @G32DSMI 62120032
         LA    WRKR4,RSREGSAV     SET UP SAME AREA FOR MSG6C   @ZA29067 62121032
         LINK  EP=IGCMSG6C              SEND MESSAGE           @G32DSMI 62122032
         B     MNTTP140                                        @G32DSMI 62124032
*                                                                       62139532
************   ************   ************   ************   *********** 62190018
*                                                                       62280018
*                   FORMAT MOUNT MESSAGE                                62370018
*                                                                       62460018
************   ************   ************   ************   *********** 62550018
*                                                                       62640018
MNTTP145 EQU   *                                                        62730018
*                                                                       62760018
         BAL   TCBR,MNTTP075       READ IN JFCB                         62790018
*                                                                       62820018
         MVC   MSGID+7(44),JFCBDSNM     D.S. NAME TO MOUNT MSG          62850018
         MVI   MSGID+6,SLASH                                            62880018
         MVC   MSGAREA(19),MOUNTMS MOUNT INFO TO MESSAGE AREA           62910018
         MVC   MSGUCB(3),UCBNAME    UNIT NAME                           63000018
         MVC   MSGID(6),TABVLID1   VOL ID TO MESSAGE AREA               63090018
         XC    MSGID+51(4),MSGID+51 CLEAR ROUTE AND DESC CODES @ZA07612 63120037
         MVI   MSGID+51,DESCODE    MOVE DESCRIPTOR CODE TO MSG @ZA07612 63150037
         BR    DSCNTR             RETURN                                63180018
*                                                                       63270018
MNTTP150 EQU   *                                                        63360018
         BAL   DSCNTR,MNTTP115    FORM CHANNEL PROGRAM                  63450018
*                                                                       63540018
         B     MNTTP045            BRANCH TO SET CCW OP CODES           63630018
*                                                                       63720018
*********************************************************************** 63810018
*                                                                       63900018
*     CONSTANTS USED IN REPI/O                                          63990018
*                                                                       64080018
*********************************************************************** 64170018
*                                                                       64260018
CONSTONE DC    X'0001'               DMCT                        Y02076 64350002
*                                                                       64440018
MOUNTMS  DC    X'00458000'         LENGTH OF MESSAGE           @ZA07612 64530037
         DC    C'IEC400A M YYY,'  MOUNT MESSAGE                         64620018
*                                                                       64710018
VOL1     DC    C'VOL1'             COMPARE AGAINST 1ST FOUR CHARACTERS  64800018
*                                  OF TAPE LABEL                        64890018
ASCIVOL  DC    X'564F4C31'              ASCII CODE FOR 'VOL1'    S20038 64930020
*                                                                       64980018
HDR2     DC    C'HDR2'                  CONSTANT FOR HDR2 LABEL   99223 64981002
FPMSG1   DC    C'1A F'                  FILE PROTECT MESSAGE 1   S20038 65070020
*                                                                       65160018
FPMSG2   DC    C'2D'                    FILE PROTECT MESSAGE 2   S20038 65250020
FPMSG068 DC    C'068A U'                                       @G32DSMI 65254032
*                NAMES OF MODULES THAT CONTROL MAY BE PASSED TO       * 65340018
*                FROM THIS MODULE.                                    * 65430018
*                                                                       65520018
NAMENSL  DC    C'NSLRHDR'               NONSTANDARD LABEL        S20038 65580020
*                                       ROUTINE NAME             S20038 65640020
NAMEDA   DC    C'IGC0M05B'          D.A. MOUNT                          65700018
MODID    DC    CL8'IGC0K05B'        MODULE ID                  @ZSUT222 65750032
*                                                                       65970018
DEQLIST  DS    0F                   START OF VOLUME DEQ LIST   @ZA18506 65974032
         DEQ   (SYSZVOLS,,6,SYSTEM),TCB=0,MF=L DEQ PARMLIST    @ZA18506 65979032
DEQLNGTH EQU   *-DEQLIST            LENGTH OF LIST TO MOVE     @ZA18506 65984032
SYSZVOLS DC    C'SYSZVOLS'          MAJOR NAME                 @ZA18506 65989032
HW8      DC    H'8'                     LENGTH DEB PREFIX      @G32DSMI 65994032
K05BID   DC    H'4'                     D05B ID IGCMSG6C       @G32DSMI 65999032
DUMYPFX  DS    0CL6                     DUMMY PREFIX           @G32DSMI 66014032
*********************************************************************** 66060018
*                                                                       66150018
*     CHANNEL PROGRAM USED BY REPI/O                                    66240018
*                                                                       66330018
*********************************************************************** 66420018
*                                                                       66510018
CCWSCR   DC    X'40000005'              SEARCH CCW               S20038 66650020
QMNGWALN DC    AL3(280)                 24(P.L.)+256(W.A.)       Y02076 66660002
SP253    DC    AL1(253)                 SUBPOOL 253              Y02076 66670002
ADDRBYTS EQU   7                        GETMAIN/FREEMAIN PARMS   Y02076 66680002
HIORDER  EQU   8                        HIGH ORDER BYTE          Y02076 66690002
ALLBYTS  EQU   15                       FOUR BYTE ICM MASK       YM5965 66690402
QMWAOFST EQU   24                       QMNGR WA OFSET FRM P.L.  Y02076 66692002
JFCBLNGH EQU   176                      JFCB LENGTH              Y02076 66694002
RTCD20   EQU   X'20'                                                MCS 66700018
RTCD28   EQU   X'28'                                                MCS 66710018
RTCDA0   EQU   X'A0'                                                MCS 66720018
DESCODE  EQU   X'40'                                                MCS 66730018
CPDSURST EQU   X'40'                    CHKPT DS USED FOR RSTRT  Y02076 66732002
*                                                                       66732832
*   RACHECK PARAMETER LIST                                     @G32DSMI 66736032
*                                                                       66736832
MRACHECK RACHECK CLASS='TAPEVOL',       RACHECK PARM LIST      @G32DSMIX66737632
               MF=L                                            @G32DSMI 66738432
LRACHECK EQU   *-MRACHECK               LENGTH PARM LIST       @G32DSMI 66739232
*                                                                     * 66740000
*        MAINTENANCE SPACE                                       Y01909 66750000
*                                                                     * 66760000
PATCH    DC    XL((*-IGC0K05B)/20)'00'   FIVE PERCENT SPACE      Y01909 66770000
*                                                                     * 66772000
         IEFQMIOP                                                Y02076 66774002
*        ICHPRCVT                                              @G32DSMI 66775932
         ICHPRCVT                                                       66776332
         EJECT                                                          66777332
         IEFJESCT                                                Y02076 66778732
         EJECT                                                          66780018
MNTTIOT  DSECT                                                          66870018
         IEFTIOT1                                                       66960018
         EJECT                                                          67050018
MNTUCB   DSECT                                                          67140018
         IEFUCBOB                                                       67230018
         EJECT                                                          67320018
         IHJDSTAB                                                Y02076 67370002
         EJECT                                                          71010018
RSDSECT  DSECT                                                          71100018
*                                                                       71190018
*    DATA EXTENT BLOCK                                                  71280018
*                                                                       71370018
RSDEB    DS    0CL48                                                    71460018
RSDEBTCB DC    X'00000000'              TCB ADDRESS                     71550018
RSDEBDEB DC    X'00000000'              DEB ADDRESS                     71640018
*                                                                       71730018
*    DATA CONTROL BLOCK                                                 71820018
*                                                                       71910018
RSDEBOFL DS    0CL1                                                     72000018
RSDEBRER EQU   X'01'                    REDUCED ERROR RECOVERY  YA00628 72050002
RSDEBIRB DC    X'00000000'              IRB ADDRESS                     72090018
RSDEBSYS DC    X'00000000'              1ST IOB ADDR IN SYS.PURGE CHAIN 72180018
RSDEBUSR DC    X'00000000'              1ST IOB ADDR IN USER PRGE CHAIN 72270018
RSDEBECB DC    X'00000000'              PARM.LIST ADDR TO PURGE ECB     72360018
RSDEBID  DS    0CL1                                                     72450018
RSDEBDCB DC    AL4(RSDCBREP)            DCB ADDR                        72540018
RSDEBAPP DS    CL4                      I/O APPENDAGE VECTOR TABLE      72630018
RSDEBMOD DS    0CL1                                                     72720018
RSDEBUCB DS    F                        UCB ADDRESS                     72810018
RSDEBBIN DS    H                        BIN NUMBER                      72900018
RSDEBSCC DS    H                        CYLINDER START ADDRESS          72990018
RSDEBSHH DS    H                        TRACK START ADDRESS             73080018
RSDEBECC DS    H                        CYLINDER END ADDRESS            73170018
RSDEBEHH DS    H                        TRACK END ADDRESS               73260018
RSDEBNTR DS    H                        NO. OF TRACKS IN THIS EXTENT    73350018
*                                                                       73440018
*    EVENT CONTROL BLOCK                                                73530018
*                                                                       73620018
RSECBAD  DS    CL4                      ECB ADDRESS                     73710018
RSDCBDEB DC    AL4(RSDEB)               DEB ADDRESS                     73800018
*                                                                       73890018
RSDCBREP EQU   RSDEB+8                  POINT TO RELATIVE BEGINNING DCB 73980018
*                                                                       74070018
*    INPUT OUTPUT BLOCK                                                 74160018
*                                                                       74250018
RSIOB    DS    0CL40                                                    74340018
RSIOBFG1 DC    X'00'                    I/O FLAGS BYTE 1                74430018
RSIOBFG2 DC    X'00'                    I/O FLAGS BYTE 2                74520018
RSIOBSN1 DS    CL1                      FIRST SENSE BYTE                74610018
RSIOBSN2 DS    CL1                      SECOND SENSE BYTE               74700018
RSIOBECB DC    AL4(RSECBAD)             ECB ADDRESS                     74790018
RSIOBCSW DS    D                        LAST CSW                        74880018
RSIOBCPA DS    AL4(RSCCW1)              CHANNEL PROGRAM ADDRESS         74970018
RSIOBDCB DS    AL4(RSDCBREP)            DCB ADDRESS                     75060018
RSIOBRCP DS    CL4                      RESTART ADDRESS FOR IOS         75150018
RSIOBINC DS    H                        INCREMENT BLOCK COUNT           75240018
RSIOBECT DS    H                        NO. OF ERROR ENTRIES            75330018
RSIOBDAD DS    D                        SEEK ADDRESS FOR DA             75420018
*                                                                       75510018
*    CHANNEL PROGRAM                                                    75600018
*                                                                       75690018
RSCCWLST DS    0CL24                                                    75780018
RSCCW1   DS    D                        CCW1                            75870018
RSCCW2   DS    D                        CCW2                            75960018
RSCCW3   DS    D                        CCW3                            76050018
*                                                                       76140018
*    BUFFER SEGMENT FOR EXTERNAL BLOCKS                                 76230018
*                                                                       76320018
RSBUFSEG DS    0CL176                                                   76410018
RSJFCB   EQU   RSBUFSEG                                                 76500018
*                                                                       76590018
*********************************************************************** 76620018
*                                                                       76650018
*                  JFCB                                                 76680018
*                                                                       76710018
*********************************************************************** 76740018
         IEFJFCBN                                                Y02076 76750002
         EJECT                                                          86400018
CVT      DSECT                                                          86490018
         CVT                                                            86580018
         EJECT                                                          86670018
         IKJTCB                                                @G32DSPD 86760032
         EJECT                                                 @G32DSPD 86810032
         DCBD  DSORG=PS                                                 86860032
         EJECT                                                 @G32DSPD 86910032
JFCBX    DSECT                                                 @ZA18506 86960032
         IEFJFCBX                                              @ZA18506 87010032
         EJECT                                                 @G32DSPD 87060032
         IHAPSA                                                @G32DSPD 87110032
         EJECT                                                 @G32DSPD 87160032
         IEZJSCB                                               @G32DSPD 88410032
         EJECT                                                 @G32DSPD 88610032
*                                                                       89370018
*                                                                       89460018
         IEZDEB                                                  Y02076 89510002
         EJECT                                                          92880018
         IEEVRSWA VER=3            AOS2 VERSION OF WORK AREA     Y01909 92970000
*                                                                       93060018
*        THE MESSAGE AREA USED TO WRITE-TO-OPERATOR IS IN THE WORKAREA* 93150018
*        THE FOLLOWING EQUATES DEFINE THE MESSAGE AREA                * 93240018
*                                                                     * 93330018
*                   IGGXXXXX M YYY,XXXXXX                             * 93420018
*                                                                       93510018
MSGAREA  EQU   RSJFCB+92           LL00   LENGTH                        93600018
MSGUCB   EQU   RSJFCB+106          UNIT                                 93690018
MSGID    EQU   RSJFCB+110          VOL ID                               93780018
*                                                                       93870018
*              OPERATOR'S REPLY READ IN AND MESSAGE AREA AND ECB.     * 93960018
*                                                                       94050018
REPLY    EQU   RSJFCB+142          READ IN AREA                         94140018
REPLYLTH EQU   RSJFCB+84          MESSAGE TO OPERATOR                   94230018
REPLYECB EQU   RSJFCB+88          ECB                                   94320018
*                                                                       94410018
BLKCT    EQU   DCBBLKCT-IHADCB      DISPL TO BLOCK COUNT IN DCB         94500018
QMNPRMWA EQU   RSERAS00           SAVE QMNGRIO PARM LST ADR      Y02076 94550002
*                                                                       94590018
         ORG   RSREGSAV           VOLUME DEQ PARAMETER LIST    @ZA18506 94680037
DEQPLIST DS    0CL(DEQLNGTH)      START OF PARMLIST-TCB ADDR   @ZA18506 94684032
         DS    F                  TCB ADDRESS                  @ZA18506 94734032
DEQ      EQU   *                  MACRO CALL PARM LIST         @ZA18506 94784032
*                                                                       94834032
         ORG   RSREGSAV                                        @G32DSMI 94884032
*   PARAMETER LIST FOR IGCMSG6C                                @G32DSMI 94934032
OPPARM   DS    A                        PARAMETER LIST         @G32DSMI 94984032
OPID     DS    H                        MODULE IDENTIFIER      @G32DSMI 95034032
OPRETCOD DS    H                        RETURN CODE            @G32DSMI 95084032
OPADDVOL DS    A                        ADDRESS VOLSER         @G32DSMI 95134032
         ORG   RSREGSAV                                        @G32DSMI 95184032
RACHECK  EQU   *                                               @G32DSMI 95234032
         END                                                            98684032
./  ADD  SSI=50790139,NAME=IGC0L05B
         GBLC  &LIB                                                     00030020
&LIB     SETC  'LIB1'                   SET VARIABLE TO LIB1            00060020
         TITLE 'IGC0L05B  SYSIN/SYSOUT NON-DA DATA SET PROCESSOR     RE*00100018
               POSITION I/O  RESTART-SVC 52  OS/360'                    00200018
IGC0L05B CSECT                                                          00300018
*                                                                A46670 00302000
*                                                                       00305019
*          RELEASE 21 DELETIONS/CHANGES                                 00310019
*0794229300                                                      M0187  00312021
*          RELEASE 20 DELETIONS/CHANGES                                 00315019
*0960171000,174200,198000,201500,539000,541200,542200,574000-    A30921 00315620
*0960576000                                                      A30921 00316220
*0960262300,395000,504000,514100-514500                          S20038 00317020
*          RELEASE 19 DELETIONS/CHANGES                                 00320019
*3252099000,174000,201000                                        M4873  00325019
*3252003100-003200,003300-003900,395000,411000,449000,453000,    A28296 00326019
*3252483000,489000,504000                                        A28296 00327019
*          VS2/RELEASE 3 DELETIONS/CHANGES                              00377000
*539682                                                        @ZA03651 00387000
*                                                                       00400018
* STATUS CHANGE LEVEL 004                                               00500021
*                                                                       00600018
*********************************************************************** 00700018
*                                                                       00800018
*TITLE - NON-DA SYSIN/SYSOUT DATA SET POSITIONING                       00900018
*                                                                       01000018
*STATUS - CHANGE LEVEL 0                                                01100018
*                                                                       01200018
*FUNCTION/OPERATION - PRIME BUFFERS FOR CARD READER                     01250002
*                                                                       01500018
*                                                                       01700018
*ENTRY POINTS - IGC0L05B - INITIAL ENTRY TO THIS MODULE BY MEANS OF AN  01800018
*                          XCTL FROM IGC0K05B OR IGC0M05B               01900018
*                                                                       02000018
*INPUT - REGISTER 8   BEGINNING OF DCB TABLE                            02100018
*        REGISTER 1   USER BUFFER AREA                                  02200018
*        ALL OPENED DCB (S) WITH THEIR ASSOCIATED CONTROL BLOCKS        02300018
*        THE 48 BYTE TABLE ENTRY (IES) THAT IS (ARE) USED IN RESTART    02400018
*        RESTART WORKAREA                                               02500018
*                                                                       02600018
*OUTPUT - REGISTER 8   BEGINNING OF DCB TABLE                           02700018
*         REGISTER 1   USER BUFFER AREA                                 02800018
*         BUFFERS ARE PRIMED FOR CARD READER                            03000018
*                                                                       03100018
*EXTERNAL ROUTINE - NONE                                                03200018
*                                                                       03300018
*EXITS - NORMAL - FINAL EXIT IS MADE VIA XCTL TO THE NEXT MODULE OF     03400018
*                 REPI/O. THIS MAY BE IGC0N05B (IF  DATA SETS EXIST     03500002
*                 ON DA) OR IGC0P05B.                                   03600002
*                                                                       03700018
*                                                                       04200018
*                                                                       04300018
*TABLES/WORKAREAS - THE WORKAREA USED IS DESCRIBED BY THE DSECTS AT THE 04400018
*                   END OF THE LISTING.                                 04500018
*                                                                       04600018
*********************************************************************** 04700018
*                                                                     * 04800018
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 04900018
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 05000018
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 05100018
*    IS 48 BYTES LONG.                                                * 05200018
*                                                                     * 05300018
*********************************************************************** 05400018
*                                                                       05500018
*        ------------------- 4 BYTES -----------------                  05600018
*                                                                       05700018
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  05800018
*        +DATA SET  +           DCB                  +                  05900018
*        + ORGN.    +         ADDRESS                +                  06000018
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                06100018
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  06200018
*        + NO. 1    +         ADDRESS                +                  06300018
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  06400018
*        +NUMBER    +         JFCB TTR               +                  06500018
*        + OF VOLS  +         ADDRESS                +                  06600018
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               06700018
*                                                                       06800018
*     12 +++++++++++++++++++++++                                        06900018
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   07000018
*        +INFO BYTE + NUMBER   +                                        07100018
*        +++++++++++++++++++++++                                        07200018
*                                                                       07300018
*     12 +++++++++++++++++++++++                                        07400018
*        +    OLD   TIOT       +        DA AND UNIT RECORD              07500018
*        +      OFFSET         +                                        07600018
*        +++++++++++++++++++++++                                        07700018
*                                                                       07800018
*                              +++++++++++++++++++++++                  07900018
*                              +FLAG BYTE +FLAG BYTE +                  08000018
*                              +  NO. 2   +  NO. 3   +                  08100018
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  08200018
*        +FLAG BYTE +FLAG BYTE +                     +                  08300018
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  08400018
*        +++++++++++++++++++++++                     + 20               08500018
*        +                                           +                  08600018
*        +                                           +                  08700018
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  08800018
*        +                                           +                  08900018
*        +   VOLUME ID NO. 2                         +                  09000018
*        +                     +++++++++++++++++++++++ 28               09100018
*        +                     +                     +                  09200018
*        +                     +   VOLUME ID NO. 3   +                  09300018
*     32 +++++++++++++++++++++++                     +                  09400018
*        +                                           +                  09500018
*        +                                           +                  09600018
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               09700018
*        +                                           +                  09800018
*        +   VOLUME ID NO. 4                         +                  09900019
*     40 +                     +++++++++++++++++++++++                  10000018
*        +                     +                     +                  10100018
*        +                     +                     +                  10200018
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               10300018
*        +                                           +                  10400018
*        +                                           +                  10500018
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               10600018
*                                                                       10700018
*                                                                       10800018
*ATTRIBUTES - REENTRANT                                                 10900018
*             REUSABLE                                                  11000018
*             ENABLED                                                   11100018
*             PRIVILEGED                                                11200018
*                                                                       11300018
*********************************************************************** 11400018
*                                                                       11500018
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               11600018
*                                                                       11700018
*********************************************************************** 11800018
*                                                                       11900018
WRKR1    EQU   0                        WORK/PARAMETER REGISTER         12000018
WRKR2    EQU   1                        WORK/PARAMETER REGISTER         12100018
R1       EQU   1                        REG 1                    YM7873 12150002
DCBR     EQU   2                        CURRENT DCB REGISTER            12200018
BASER    EQU   3                        BASE RIGISTER                   12300018
DEBR     EQU   4                        CURRENT DEB REGISTER            12400018
UCBR     EQU   5                        CURRENT UCB REGISTER            12500018
TIOTR    EQU   6                        NEW TIOT RESISTER               12600018
TCBR     EQU   7                        TCB REGISTER                    12700018
TABLR    EQU   8                        BEGINNING TO DCB TABLE REGISTER 12800018
CTABLR   EQU   9                        CURRENT ENTRY IN DCB TABLE      12900018
R9       EQU   9                        REG 9                    YM7873 12950002
BUFR     EQU   10                       USER BUFFER AREA                13000018
RA       EQU   10                       REG 10                   YM7873 13050002
DSCNTR   EQU   11                       NUMBER OF DATA SETS             13100018
WRKR3    EQU   12                       WORK REGISTER                   13200018
WRKR4    EQU   13                       WORK REGISTER                   13300018
WRKR5    EQU   14                       WORK/PARAMETER REGISTER         13400018
RE       EQU   14                       REG 14                   YM7873 13450002
WRKR6    EQU   15                       WORK/PARAMETER REGISTER         13500018
RF       EQU   15                       REG 15                   YM7873 13550002
*                                                                       13600018
*********************************************************************** 13700018
*                                                                       13800018
*    OFFSETS TO BE USED IN REPI/O PHASE                                 13900018
*                                                                       14000018
*********************************************************************** 14100018
*                                                                       14200018
IS       EQU   X'80'                    INDEXED SEQUENCIAL              14204018
PS       EQU   X'40'                    PHYSICAL SEQUENCIAL             14208018
DA       EQU   X'20'                    DIRECT ACCESS                   14212018
PO       EQU   X'02'                    PARTITIONED ORGANIZATION        14216018
INOROUT  EQU   X'40'                    SYSIN OR SYSOUT DATA SET        14224018
UNITREC  EQU   X'04'                    UNIT RECORD EQUIPMENT           14240018
ERRINNSL EQU   X'80'                    ERROR IN NSL ROUTINE            14244018
NSLMTSW  EQU   X'40'                    NSL MOUNT SWITCH                14248018
NSLCOMU  EQU   X'20'                    NSL COMMUNICATION BIT           14252018
BYPASS   EQU   X'10'                    BYPASS LABEL PROCESSING         14256018
AL       EQU   X'08'                    ASCII LABEL              S20038 14258020
NSL      EQU   X'04'                    NON-STANDARD LABEL              14260018
SL       EQU   X'02'                    STANDARD LABEL                  14264018
NL       EQU   X'01'                    NO LABEL                        14268018
GTR5VOL  EQU   X'80'                    GREATER THAN 5 VOLUMES          14272018
POCONCAT EQU   X'40'                    P.O. CONCATENATED               14276018
DAFLAG   EQU   X'80'                    DA DATA SET FLAG                14280018
NONDAFLG EQU   X'40'                    NON-DA DATA SET FLAG            14284018
NSLFLAG  EQU   X'10'                    NSL ROUTINE FLAG                14288018
TYPERST  EQU   X'80'                    IMMEDIATE RESTART               14292018
TABENT   EQU   48                       TABLE ENTRY LENGTH              14296018
WRITE    EQU   X'01'                    WRITE ON TAPE                   14300018
READ     EQU   X'02'                    READ FOR TAPE                   14304018
NOPOP    EQU   X'03'                    NOP                             14308018
SENSE    EQU   X'04'                    SENSE                           14312018
REWIND   EQU   X'07'                    REWIND                          14316018
READBACK EQU   X'0C'                    READBACK                        14320018
UNLOAD   EQU   X'0F'                    REWIND AND UNLOAD               14324018
WTM      EQU   X'1F'                    WRITE TAPE MARK                 14328018
BSFOP    EQU   X'2F'                    BACKWARD SPACE FILE             14332018
FSFOP    EQU   X'3F'                    FORWARD SPACE FILE              14336018
SEARCH   EQU   X'31'                    SEARCH                          14340018
SRCHCNT  EQU   X'05'                    COUNT FOR SEARCH ID             14344018
TIC      EQU   X'08'                    TIC                             14348018
READDA   EQU   X'06'                    READ FOR DA                     14352018
LENJFCB  EQU   X'B0'                    LENGTH OF JFCB                  14356018
LBLLEN   EQU   X'50'                    LENGTH OF LABEL                 14360018
LBLOFST  EQU   96                       OFFSET FROM RSJFCB TO    S20038 14361020
*                                       AREA FOR                 S20038 14362020
*                                            LABEL CONSTRUCTION         14363020
PERMERR  EQU   X'7F'                    PERMANENT ERROR                 14364018
ERR24    EQU   24                       ERROR IN READING IN JFCB        14368018
ERR50    EQU   50                       ERROR IN WRITING LABELS         14372018
ERR54    EQU   54                       ERROR - ASCII LABEL FOR  S20038 14373020
*                                       SYSIN                    S20038 14374020
*                                            OR SYSOUT TAPE             14375020
ONE      EQU   X'01'                    CONSTANT ONE                    14376018
OUT      EQU   X'40'                    SYSOUT DATA SET (UCBWGT)        14380018
CHAIN    EQU   X'40'                    CHAINING FLAG                   14384018
BLANK    EQU   C' '                     BLANK CHARACTER                 14388018
SIGNOFF  EQU   X'F0'                    REMOVE SIGN BIT                 14392018
ZERO     EQU   C'0'                     ZERO CONSTANT                   14396018
SECIND   EQU   C'1'                     SECURITY INDICATOR              14400018
SLIFLAG  EQU   X'20'                    SLI FLAG                        14404018
HDR2ID   EQU   C'2'                     HDR2 IDENTIFIER                 14408018
MASK     EQU   X'03'                    MASK USED FOR ZEROING BLKA      14412018
TRANS    EQU   C'T'                     TRANSLATE IN TRTCH              14416018
GTR32K   EQU   X'F9'                    GREATER THAN 32K INDICATOR      14420018
SLASH    EQU   C'/'                     SLASH                           14424018
MACHCNTL EQU   C'M'                     MACHINE CODE CONTROL            14428018
ASACNTL  EQU   C'A'                     ASA CNTRL CHAR                  14432018
CHSLI    EQU   CHAIN+SLIFLAG            CHAINING AND SLI FLAG           14436018
IOERROR  EQU   X'20'                    PERMANENT I/O ERROR             14440018
UNITEX   EQU   X'01'                    UNIT EXCEPTION                  14444018
IN       EQU   X'80'                    SYSIN DATA SET (UCBWGT)         14448018
RDR2501  EQU   X'01'                    2501 CARD READER         A46670 14450000
RDR2540  EQU   X'04'                    2540 CARD READER         A46670 14450400
CARDRDR  EQU   X'05'                    CARD READER                     14452018
P3211    EQU   X'09'                    3211 PRINTER             YM7873 14454002
WALNTH   EQU   X'23A'                   LENGTH OF 3211 ERP WA    YM7873 14454402
MOVE     EQU   X'14'                    MOVE OR SUBSTITUTE MODE         14456018
NTPRGD   EQU   X'FF'                    NO PURGED                       14460018
AET      EQU   X'2B'                    EVEN PARITY AND TRANSLATION IN  14500018
*                                            TRTCH                      14600018
AMCODE   EQU   X'02'                    MACHINE CODE                    14670018
ASA      EQU   X'04'                    ASA CONTROL CHARACTER           14740018
QSAMDCB  EQU   X'01'                    QSAM DCB INDICATOR              14810018
DAFLG    EQU   X'80'               DIRECT ACCESS FLAG            M4873  14850019
IOBSTAT0 EQU   20                       BYTE 12 OF AN IOB        A30921 14870020
DEBPRFLN EQU   16                  LENGTH OF DEB PREFIX          Y02049 14880002
K1       EQU   1                        CONST 1                  YM7873 14890002
K4       EQU   4                        CONST 4                  YM7873 14892002
*                                                                       14900018
*********************************************************************** 15000018
*                                                                       15100018
         BALR  BASER,0                  ESTABLISH ADDRESSIBILITY        15200018
         USING *,BASER                  ESTABLISH BASE REG              15300018
         B     BEGIN               BRANCH AROUND EYE CATCHER     Y01909 15350000
         CNOP  0,8                 ALIGN TO A DBL WORD BOUNDARY  Y01909 15360000
         DC    C'IGC0L05B'         CSECT NAME                    Y01909 15370000
BEGIN    EQU   *                                                 Y01909 15380000
*                                                                       15400018
         USING IHADCB,DCBR                                              15500018
         USING DEBBASIC,DEBR                                     Y02049 15600002
         USING UCBOB,UCBR                                               15700018
         USING TABL,CTABLR                                              15800018
         USING RSTWA,BUFR                                               15900018
         USING RSDSECT,WRKR4                                            16000018
         USING CVT,WRKR2                                                16100018
         USING FILELAB,TIOTR                                            16200018
         USING TCB,TCBR                                                 16300018
         USING TIOT1,WRKR5                                              16400018
*                                                                       16500018
         LR    CTABLR,TABLR             INITIALIZE TABL PTR             16600018
*                                                                       16700018
REPIO002 EQU   *                                                        16800018
*                                                                       16900018
         L     WRKR4,TABSEGAD-1         WORKAREA SEGMENT ADDRESS        16910000
         LA    WRKR6,REPIO100           LOAD REG WITH BRANCH     A46670 16950000
*                                       ADDRESS                  A46670 17000000
         TM    TABFLG1,TABDA+TABNULL+TABTCAM SKIP IF DA          Y02076 17050002
         BCR   7,WRKR6                  TCAM DS OR NULL          A46670 17070000
*                                                                       17120000
REPIO003 EQU   *                                                 M4873  17450019
*                                                                       17500018
*    ****************************************************************** 17600018
*                                                                       17700018
*     QSAM CARD READER BUFFERS ARE PROCESSED BY THIS MODULE             17750002
*                                                                       18000018
*    ****************************************************************** 18100018
*                                                                       18200018
*    *** PICK UP NECESSARY ADDRESSES ***                                18300018
*                                                                       18400018
         LA    WRKR4,0(WRKR4)           CLEAR HIGH ORDER BYTE           18600018
         L     DCBR,TABDCBAD-1          DCB ADDR IN THIS ENTRY          18700018
         LA    DCBR,0(DCBR)             CLEAR HIGH ORDER BYTE           18800018
         L     DEBR,DCBDEBAD            DEB ADDR ASSOC WITH THIS DCB    18900018
         L     UCBR,DEBSUCBA            UCB ADDR ASSOC WITH DEB  Y02049 19000002
*                                                                       19100018
         TM    TABFLG1,TABTAPE          IS IT ON TAPE DEVICE            19300002
         BO    REPIO100                 BRANCH TO GET NXT ENTRY  Y02076 19350002
*                                                                       53300018
REPIO050 EQU   *                                                        53400018
*                                                                       53500018
*    *** UNIT RECORD DEVICE PROCESS - CARD READER ONLY ***              53600018
*                                                                       53700018
         CLI   UCBTBYT3,UCB3UREC        TEST UNIT RECORD         A46670 53800000
         BCR   7,WRKR6                  SKIP IF NOT              A46670 53850000
         CLI   UCBTBYT4,P3211           IS IT A 3211 PRINTER     YM7873 53860002
         BNE   REPIO05K                 BRANCH IF NO             YM7873 53870002
         STM   R9,RF,RSREGSAV+R9*K4     SAVE REGS                YM7873 53880002
         LA    R9,RSREGSAV+R9*K4        GET ADDR REG SAVE AREA   YM7873 53890002
         L     RE,UCBXTADR              PRINTER EXTENSION        YM7873 53899202
         USING UCBUCS,RE                                         YM7873 53899602
         SR    RF,RF                    ZERO RF FOR IC, LTR      YM7873 53899702
         IC    RF,UCBERADR              GET USE COUNT            YM7873 53899802
         LTR   RF,RF                    IS IT NOW ZERO           YM7873 53899902
         LA    RF,K1(,RF)               INCREMENT BY ONE         YM7873 53916602
         STC   RF,UCBERADR              STORE UPDATED COUNT      YM7873 53926602
         BNZ   REPIO05D                 BRANCH IF COUNT WASN'T 0 YM7873 53928602
*                                                                YM7873 53930602
*        GET ERP WORKAREA                                        YM7873 53932602
         GETMAIN R,SP=255,LV=WALNTH     GET ERP WORK AREA        YM7873 53932702
         STCM  R1,B'0111',UCBERADR+K1   STORE WORKAREA ADDR      YM7873 53933202
*                                                                YM7873 53938802
REPIO05D EQU   *                        EXIT THIS TAB ENTRY      YM7873 53940802
         LM    R9,RF,0(R9)              RESTORE REGS           @ZA03651 53968200
         BR    WRKR6                    GET OUT                  YM7873 53971002
*                                                                YM7873 53971102
REPIO05K EQU   *                        CHK FOR CARD READER      YM7873 53971402
         CLI   UCBTBYT4,RDR2501         TEST 2501                A46670 53972202
         BE    REPIO051                 PROCESS IF 2501          A46670 53986102
         CLI   UCBTBYT4,RDR2540         TEST 2540R               A46670 54000000
         BCR   7,WRKR6                  SKIP IF NEITHER          A46670 54050000
*                                                                       54100000
REPIO051 EQU   *                        PROCESS 2501 OR 2540R    A46670 54110000
*                                                                       54140018
         TM    DCBCIND2,QSAMDCB         IS IT QSAM DCB                  54160018
         BCR   8,WRKR6                  NO - GO GET NEXT ENTRY   A30921 54230020
*                                                                       54300018
*    *** PICK UP USER IOB ADDRESS ***                                   54400018
*                                                                       54500018
         L     WRKR3,DCBIOBA            GET FIRST IOB ADDRESS           54600018
         LR    DSCNTR,WRKR3             SAVE FOR WORK REGISTER          54700018
*                                                                       54800018
         XC    DCBEOBAD(8),DCBEOBAD     FORCE END OF BUFFER CONDITION   54900018
*                                                                       55000018
         SR    TIOTR,TIOTR              CLEAR WORK REGISTER             55100018
         IC    TIOTR,DCBBUFNO           GET NUMBER OF BUFFERS TO PRIME  55200018
*                                                                       55300018
         LR    WRKR5,DEBR          GET DEB ADDR FOR CALC         Y02049 55350002
         LA    WRKR2,DEBPRFLN      GET LENGTH OF DEB PREFIX      Y02049 55360002
         SR    WRKR5,WRKR2         POINT TO DEB PREFIX           Y02049 55370002
         USING DEBPREFX,WRKR5                                    Y02049 55380002
         L     WRKR5,DEBXTNP       GET POINTER TO DEB EXTENSION  Y02049 55390002
         USING DEBXTN,WRKR5                                      Y02049 55392002
         TM    DEBXMCF1,DCBMRMVG+DCBMRSBG                        Y02049 55442002
*                                  IS IT MOVE OR SUBSTITUTE MODE Y02049 55492002
         DROP  WRKR5                                             Y02049 55494002
         BC    5,REPIO060               BRANCH IF YES TO GET NEXT IOB   55500018
*                                            FOR PRIMING                55600018
         BCTR  TIOTR,0                  REDUCE BY ONE                   55700018
         LTR   TIOTR,TIOTR              MORE THAN ONE IOB               55800018
         BZ    REPIO080                 BRANCH IF NOT TO FINISH THIS    55900018
*                                            ENTRY                      56000018
REPIO060 EQU   *                                                        56100018
*                                                                       56200018
*    *** PRIMING BUFFERS - WILL BRANCH AND LINK TO EOB ROUTINE ***      56300018
*                                                                       56400018
         L     WRKR3,0(WRKR3)           GET NEXT IOB                    56500018
*                                                                       56600018
         LA    WRKR4,RSJFCB             GET REGISTER SAVE AREA          56700018
*                                                                       56800018
REPIO070 EQU   *                                                        56900018
*                                                                       57000018
         STM   WRKR1,WRKR6,0(WRKR4)     SAVE REGISTERS                  57100018
*                                                                       57200018
         L     WRKR6,DCBEOB             GET READ EOB ADDRESS            57300018
         ST    WRKR3,DCBIOBA            MAKE DCB POINT TO IOB    A30921 57380020
         TM    IOBSTAT0(WRKR3),UNITEX   CHECK FOR UNIT EXCEPTION A30921 57460020
         BNZ   REPIO075                 YES, DON'T PRIME BUFFERS A30921 57540020
         LR    BASER,WRKR3              PUT IOB IN PROPER REG    A30921 57620020
         BALR  WRKR5,WRKR6              TO EOB ROUTINE TO PRIME BUFFERS 57700018
*                                                                       57800018
REPIO075 EQU   *                                                 A30921 57830020
*                                                                       57860020
         LM    WRKR1,WRKR6,0(WRKR4)     RESTORE REGISTERS               57900018
*                                                                       58000018
         L     WRKR3,0(WRKR3)           GET NEXT IOB                    58100018
         BCT   TIOTR,REPIO070           BRANCH IF MORE BUFFERS TO PRIME 58200018
*                                                                       58300018
         ST    DSCNTR,DCBIOBA           RESET DCB TO ORIGINAL IOB       58400018
*                                                                       58500018
REPIO080 EQU   *                                                        58600018
*                                                                       58700018
         NI    DCBIOBA,X'FE'            TURN OFF FIRST IOB BIT IN DCB   58800018
         MVI   DEBUSRPG+3,NTPRGD        SET NO PURGED BYTE IN DEB TO    58830018
*                                           SKIP RESTORING              58860018
         B     REPIO100                 BRANCH TO GET NEXT ENTRY        58900018
*                                                                       59000018
REPIO100 EQU   *                                                        59700018
*                                                                       59800018
         TM    TABFLG1,TABLAST          IS THIS LAST ENTRY              59900002
         BO    REPIO160                 BRANCH IF YES TO XCTL NEXT LOAD 60000018
*                                                                       60100018
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TABL PTR              60200018
         B     REPIO002                 BRANCH TO PICK UP NEXT ENTRY    60300018
*                                                                       60400018
REPIO160 EQU   *                                                        60500018
         LA    WRKR6,RSJFCB             SET UP WORKAREA FOR XCTL YM7577 60650002
         MVC   0(8,WRKR6),DALOADNM      GO TO N05B               YM7577 60700002
*                                                                       61700018
         LA    WRKR6,8(0,WRKR6)         SET UP FOR XCTL                 61800002
         LR    WRKR2,BUFR               POINT REG 1 TO THE RESTART W/A  61900018
         LA    WRKR5,RSJFCB             REG14 PTS TO XCTL LIST   YM7582 61950002
         LR    WRKR3,BUFR               POINT REG12 TO RSTRT WA  YM5319 61960002
*                                                                       62000018
         XCTL  EPLOC=(WRKR5),SF=(E,(15))                                62100002
*                                                                       62120018
*********************************************************************** 62140018
*                                                                       62160018
*     CONSTANTS USED IN REPI/O                                          62180018
*                                                                       62200018
*********************************************************************** 62220018
*                                                                       62240018
         DS    0H                                                       62300018
AGRTR32K DC    X'8000'                  VALUE IN LABEL WHEN LRECL GTR   62400018
*                                            32K                        62500018
ARECFM   EQU   *-1                      RECFM TRANSLATE TABEL (NO ZERO  62600018
         DC    C'VFU'                        VALUE VARIABLE, FIXED,     62700018
*                                            UNDEFINED)                 62800018
ATRTCH   DC    C' CET'                  BLANK, CONVERSION, EVEN PARITY, 62900018
*                                            TRANSLATE                  63000018
ABLKA    DC    C' SBR'                  BLOCK ATTRIBUTE TRANSLATE TABLE 63100018
ABFALN   DC    C'0C8C'                  TRANSLATE TABLE FOR BFALN       63200018
AHDR1    DC    C'HDR1'                  HEADER 1                        63300018
DALOADNM DC    CL8'IGC0N05B'            DA LOAD                         63400018
RSTMODNM DC    CL8'IGC0V05B'            RESTART EXIT                    63600018
*                                                                     * 63650000
*        MAINTENANCE SPACE                                       Y01909 63660000
*                                                                     * 63670000
PATCH    DC    XL((*-IGC0L05B)/20)'00'   FIVE PERCENT SPACE      Y01909 63680000
*                                                                     * 63690000
         EJECT                                                          63700018
         IEEVRSWA VER=3                 AOS2 VERSION OF WA              63850000
         EJECT                                                          63900018
RSDSECT  DSECT                                                          64000018
*                                                                       64100018
*    DATA EXTENT BLOCK                                                  64200018
*                                                                       64300018
RSDEB    DS    0CL48                                                    64400018
RSDEBTCB DC    X'00000000'              TCB ADDRESS                     64500018
RSDEBDEB DC    X'00000000'              DEB ADDRESS                     64600018
*                                                                       64700018
*    DATA CONTROL BLOCK                                                 64800018
*                                                                       64900018
RSDEBOFL DS    0CL1                                                     65000018
RSDEBIRB DC    X'00000000'              IRB ADDRESS                     65100018
RSDEBSYS DC    X'00000000'              1ST IOB ADDR IN SYS.PURGE CHAIN 65200018
RSDEBUSR DC    X'00000000'              1ST IOB ADDR IN USER PRGE CHAIN 65300018
RSDEBECB DC    X'00000000'              PARM.LIST ADDR TO PURGE ECB     65400018
RSDEBID  DS    0CL1                                                     65500018
RSDEBDCB DC    AL4(RSDCBREP)            DCB ADDR                        65600018
RSDEBAPP DS    CL4                      I/O APPENDAGE VECTOR TABLE      65700018
RSDEBMOD DS    0CL1                                                     65800018
RSDEBUCB DS    F                        UCB ADDRESS                     65900018
RSDEBBIN DS    H                        BIN NUMBER                      66000018
RSDEBSCC DS    H                        CYLINDER START ADDRESS          66100018
RSDEBSHH DS    H                        TRACK START ADDRESS             66200018
RSDEBECC DS    H                        CYLINDER END ADDRESS            66300018
RSDEBEHH DS    H                        TRACK END ADDRESS               66400018
RSDEBNTR DS    H                        NO. OF TRACKS IN THIS EXTENT    66500018
*                                                                       66600018
*    EVENT CONTROL BLOCK                                                66700018
*                                                                       66800018
RSECBAD  DS    CL4                      ECB ADDRESS                     66900018
RSDCBDEB DC    AL4(RSDEB)               DEB ADDRESS                     67000018
*                                                                       67100018
RSDCBREP EQU   RSDEB+8                  POINT TO RELATIVE BEGINNING DCB 67200018
*                                                                       67300018
*    INPUT OUTPUT BLOCK                                                 67400018
*                                                                       67500018
RSIOB    DS    0CL40                                                    67600018
RSIOBFG1 DC    X'00'                    I/O FLAGS BYTE 1                67700018
RSIOBFG2 DC    X'00'                    I/O FLAGS BYTE 2                67800018
RSIOBSN1 DS    CL1                      FIRST SENSE BYTE                67900018
RSIOBSN2 DS    CL1                      SECOND SENSE BYTE               68000018
RSIOBECB DC    AL4(RSECBAD)             ECB ADDRESS                     68100018
RSIOBCSW DS    D                        LAST CSW                        68200018
RSIOBCPA DS    AL4(RSCCW1)              CHANNEL PROGRAM ADDRESS         68300018
RSIOBDCB DS    AL4(RSDCBREP)            DCB ADDRESS                     68400018
RSIOBRCP DS    CL4                      RESTART ADDRESS FOR IOS         68500018
RSIOBINC DS    H                        INCREMENT BLOCK COUNT           68600018
RSIOBECT DS    H                        NO. OF ERROR ENTRIES            68700018
RSIOBDAD DS    D                        SEEK ADDRESS FOR DA             68800018
*                                                                       68900018
*    CHANNEL PROGRAM                                                    69000018
*                                                                       69100018
RSCCWLST DS    0CL24                                                    69200018
RSCCW1   DS    D                        CCW1                            69300018
RSCCW2   DS    D                        CCW2                            69400018
RSCCW3   DS    D                        CCW3                            69500018
*                                                                       69600018
*    BUFFER SEGMENT FOR EXTERNAL BLOCKS                                 69700018
*                                                                       69800018
RSBUFSEG DS    0CL176                                                   69900018
RSJFCB   EQU   RSBUFSEG                                                 70000018
*                                                                       70100018
*********************************************************************** 70200018
*                                                                       70300018
*                  JFCB                                                 70400018
*                                                                       70500018
*********************************************************************** 70600018
*                                                                       70700018
JFCBDSNM DS    CL44                         DATA SET NAME               70800018
JFCBELNM DS    CL8                          ELEMENT NAME OR VERSION     70900018
JFCBTSDM DS    CL1                          TASK SCHEDULER - DATA       71000018
*                                            MANAGEMENT INTERFACE BYTE  71100018
JFCBSYSC DS    CL13                         SYSTEM CODE                 71200018
JFCBLTYP DS    CL1                          LABEL TYPE AND USER'S-LABEL 71300018
*                                            INDICATOR                  71400018
         DS    CL1                          NOT USED                    71500018
JFCBFLSQ DS    CL2                          FILE SEQUENCE NUMBER        71600018
JFCBVLSQ DS    CL2                          VOLUME SEQUENCE NUMBER      71700018
JFCBMASK DS    CL8                          DATA MANAGEMENT MASK        71800018
JFCBCRDT DS    CL3                          DATA SET CREATION DATE      71900018
JFCBXPDT DS    CL3                          DATA SET EXPIRATION DATE    72000018
JFCBIND1 DS    CL1                          INDICATOR BYTE 1            72100018
JFCBRLSE EQU   64                            BITS 0 AND 1 - EXTERNAL    72200018
*                                            STORAGE RELEASE INDICATOR  72300018
JFCBLOCT EQU   16                            BITS 2 AND 3 - DATA SET    72400018
*                                            HAS BEEN LOCATED           72500018
JFCBNEWV EQU   4                             BITS 4 AND 5 - NEW VOLUME  72600018
*                                            ADDED TO DATA SET          72700018
JFCBPMEM EQU   1                             BITS 6 AND 7 - DATA SET IS 72800018
*                                            A MEMBER OF A PODS OR GDG  72900018
JFCBIND2 DS    CL1                          INDICATOR BYTE 2            73000018
JFCBSTAT EQU   64                            BITS 0 AND 1 - DATA SET    73100018
*                                            STATUS (NEW, OLD, OR MOD)  73200018
JFCBSCTY EQU   16                            BITS 2 AND 3 - DATA SET    73300018
*                                            SECURITY INDICATOR         73400018
JFCBUFNO DS    0AL1                                                     73500018
JFCBUFRQ DS    AL1                      BUFFER REQUESTED                73600018
JFCBFTEK DS    0BL1                                                     73700018
JFCBFALN DS    BL1                      BUFFER ALIGNMENT                73800018
JFCBUFL  DS    AL2                      BUFFER LENGTH                   73900018
JFCEROPT DS    BL1                      ERROR ROUTINE                   74000018
JFCTRTCH DS    0BL1                                                     74100018
JFCKEYLE DS    0AL1                                                     74200018
JFCMODE  DS    0BL1                                                     74300018
JFCCODE  DS    0BL1                                                     74400018
JFCSTACK DS    0BL1                                                     74500018
JFCPRTSP DS    BL1                      PRINTER SPACING                 74600018
JFCDEN   DS    BL1                      TAPE DENSITY                    74700018
JFCLIMCT DS    AL3                      NO. OF TRKS.TO BE SEARCHED      74800018
JFCDSORG DS    BL2                      DATA SET ORGANIZATION           74900018
JFCRECFM DS    BL1                      RECORD FORMAT                   75000018
JFCOPTCD DS    BL1                      OPTION CODES                    75100018
JFCBLKSI DS    AL2                      BLOCK SIZE                      75200018
JFCLRECL DS    AL2                      LOGICAL RECORD LENGTH           75300018
JFCNCP   DS    AL1                      NO. OF CHANNEL PROGRAM          75400018
JFCNTM   DS    AL1                      NO. OF TRKS. FOR MASTER INDEX   75500018
JFCRKP   DS    AL2                      RELATIVE POSITION OF KEY        75600018
JFCCYLOF DS    AL1                      NO. OF TRKS FOR OVERFLOW        75700018
JFCDBUFN DS    AL1                      RESERVED                        75800018
JFCINTVL DS    AL1                      INTENTIONAL INTERVAL            75900018
JFCCPRI  DS    BL1                      PRIORITY                        76000018
JFCSOWA  DS    AL2                      SIZE OF WORKAREA                76100018
JFCBNTCS DS    CL1                          NUMBER OF OVERFLOW TRACKS   76200018
JFCBNVOL DS    CL1                          NUMBER OF VOLUME SERIAL     76300018
*                                            NUMBERS                    76400018
JFCBVOLS DS    CL30                         VOLUME SERIAL NUMBERS (THE  76500018
*                                            FIRST FIVE)                76600018
JFCBEXTL DS    CL1                          LENGTH OF BLOCK OF EXTRA    76700018
*                                            VOLUME SERIAL NUMBERS      76800018
*                                            (BEYOND FIVE)              76900018
JFCBEXAD DS    CL3                          TRACK ADDRESS OF BLOCK OF   77000018
*                                            EXTRA VOL SERIAL NUMBERS   77100018
JFCBPQTY DS    CL3                          PRIMARY QUANTITY OF D.A.    77200018
*                                            STORAGE REQUIRED           77300018
JFCBCTRI DS    CL1                          INDICATES WHETHER CYLINDERS 77400018
*                                            TRACKS, OR RECORDS ARE     77500018
*                                            SPECIFIED IN JFCBPQTY AND  77600018
*                                            JFCBSQTY                   77700018
JFCBSQTY DS    CL3                          SECONDARY QUANTITY OF D.A.  77800018
*                                            STORAGE REQUIRED           77900018
JFCBIND3 DS    CL1                          INDICATOR BYTE 3            78000018
JFCBCNTG EQU   64                            BITS 0 AND 1 - CONTIGUOUS  78100018
*                                            STORAGE INDICATOR          78200018
JFCBMXIG EQU   16                            BITS 2 AND 3 - MAXIMUM     78300018
*                                            AVAILABLE EXTENT INDICATOR 78400018
JFCBALXI EQU   4                             BITS 4 AND 5 - ALL EXTENTS 78500018
*                                            INDICATOR                  78600018
JFCBRNDC EQU   1                             BITS 6 AND 7 - ROUND       78700018
*                                            CYLINDER INDICATOR         78800018
JFCBDQTY DS    CL3                          QUANTITY OF D.A. STORAGE    78900018
*                                            REQUIRED FOR A DIRECTORY   79000018
JFCBSPNM DS    CL3                          CORE ADDRESS OF THE JFCB    79100018
*                                            WITH WHICH CYLINDERS ARE   79200018
*                                            SPLIT                      79300018
JFCBABST DS    CL2                          RELATIVE ADDRESS OF FIRST   79400018
*                                            TRACK TO BE ALLOCATED      79500018
JFCBSBNM DS    CL3                          CORE ADDRESS OF THE JFCB    79600018
*                                            FROM WHICH SPACE IS TO BE  79700018
*                                            SUBALLOCATED               79800018
JFCBDRLH DS    CL3                          AVERAGE DATA RECORD LENGTH  79900018
JFCBVLCT DS    CL1                          VOLUME COUNT                80000018
JFCBSPTN DS    CL1                          NUMBER OF TRACKS PER        80100018
*                                            CYLINDER TO BE USED BY     80200018
*                                            THIS DATA SET WHEN SPLIT   80300018
*                                            CYLINDER IS INDICATED      80400018
JFCBLGTH EQU   176                          LENGTH OF JFCB              80500018
JFCBEND  EQU   *                                                        80600018
         ORG   RSBUFSEG+176             ORG BACK TO BUFFER SEGMENT      80700018
RSSTATUS DS    0CL8                                                     80800018
RSSTAT1  DS    CL1                      STATUS BYTE 1                   80900018
RSSTAT2  DS    CL1                      STATUS BYTE 2                   81000018
RSSTAT3  DS    CL1                      STATUS BYTE 3                   81100018
RSSTAT4  DS    CL1                      STATUS BYTE 4                   81200018
         DS    F                        RESERVED FOR FUTURE USE         81300018
         EJECT                                                          81400018
CVT      DSECT                                                          81500018
         CVT                                                            81600018
         EJECT                                                          81700018
*                                                                       81800018
*                                                                       81900018
*   TASK CONTROL BLOCK                                                  82000018
*                                                                       82100018
*                                                                       82200018
         CNOP  0,4                                                      82300018
TCB      DSECT                                                          82400018
TCBRBP   DS    F                       POINTER TO EXECUTING RB          82500018
TCBPIE   DS    F                       POINTER TO PROG. INTERRUPT EL.   82600018
TCBDEB   DS    F                       POINTER TO DEB QUEUE             82700018
TCBTIO   DS    F                       POINTER TO TIOT                  82800018
TCBCMP   DS    F                       TASK COMPLETION CODE             82900018
TCBTRN   DS    F                       TESTRAN FIELD                    83000018
TCBMSS   DS    F                       DATA BLOCK QUEUE ELEMENT POINTER 83100018
TCBPRTK  DS    CL1                     PROTECTION TAG                   83200018
TCBFLGS  DS    FL5                     FLAG BYTES                       83300018
TCBLMP   DS    CL1                     LIMIT PRIORITY                   83400018
TCBDSP   DS    CL1                     DISPATCHING PRIORITY             83500018
TCBLLS   DS    F                       POINTER TO LOAD LIST             83600018
TCBJLB   DS    F                       POINTER TO JOBLIB DCB            83700018
TCBJSE   DS    F                       LIST OF INACTIVE PROGRAMS ADDR.  83800018
TCBGRS   DS    CL64                    GENERAL REGISTER SAVE AREA       83900018
TCBIDF   DS    CL1                     TCB IDENTIFIER FIELD             84000018
TCBFSA   DS    CL3                     POINTER TO 1ST PROB.PROG.SAVEAR  84100018
TCBTCB   DS    F                       NEXT TCB ON READY QUEUE POINTER  84200018
TCBTME   DS    F                       POINTER TO TIMER ELEMENT         84300018
         EJECT                                                          84400018
         DCBD  DSORG=PS                                                 84500018
         EJECT                                                          84600018
*                                                                       84700018
*                                                                       84800018
*   DATA EXTENT BLOCK                                                   84900002
*                                                                       85000018
*                                                                       85100018
         IEZDEB                                                  Y02049 85150002
         EJECT                                                          88600018
         IHJDSTAB                                                Y02076 88650002
         EJECT                                                          92700018
TIOT     DSECT                                                          92800018
         IEFTIOT1                                                       92900018
         EJECT                                                          93000018
SRT      DSECT                                                          93100018
         IEFUCBOB                                                       93200018
         EJECT                                                          93300018
*********************************************************************** 93400018
*                                                                       93500018
*        FILE LABELS                                                    93600018
*                                                                       93700018
*********************************************************************** 93800018
*                                                                       93900018
*        FILE LABEL 1                                                   94000018
*                                                                       94100018
         CNOP  0,4                                                      94200018
FILELAB  DSECT                                                          94300018
FL1LABI  DS    CL3                      LABEL IDENTIFIER                94400018
FL1NO    DS    CL1                      FILE LABEL NUMBER               94500018
FL1ID    DS    CL17                     FILE IDENTIFIER                 94600018
FL1FILSR DS    CL6                      FILE SERIAL NUMBER              94700018
FL1VOLSQ DS    CL4                      VOLUME SEQUENCE NUMBER          94800018
FL1FILSQ DS    CL4                      FILE SEQUENCE NUMBER            94900018
FL1GNO   DS    CL4                      GENERATION NUMBER               95000018
FL1VNG   DS    CL2                      VERSION NUMBER OF GENERATION    95100018
FL1CREDT DS    CL6                      CREATION DATE                   95200018
FL1EXPDT DS    CL6                      EXPIRATION DATE                 95300018
FL1FSEC  DC    C'0'                     FILE SECURITY INDICATOR         95400018
FL1BLKCT DS    CL6                      BLOCK COUNT                     95500018
FL1SYSCD DS    CL13                     SYSTEM CODE                     95600018
FL1RES   DS    0CL7                     RESERVED FOR FUTURE USE         95700018
         DS    CL1                      RESERVED                        95800018
FL1RES1  DS    CL6                      RESERVED                        95900018
*                                                                       96000018
*        FILE LABEL 2                                                   96100018
*                                                                       96200018
         ORG   FL1ID                    ORG BACK TO FILE LABEL 1        96300018
FL2RECFM DS    CL1                      RECORD FORMAT                   96400018
FL2BLKL  DS    CL5                      BLOCK LENGTH                    96500018
FL2LRECL DS    CL5                      BLOCKING FACTOR/RECORD LENGTH   96600018
FL2DEN   DS    CL1                      DENSITY                         96700018
FL2FILP  DS    CL1                      FILE POSITION                   96800018
FL2JSID  DS    0CL17                    JOB/STEP IDENTIFICATION         96900018
FL2JOBD  DS    CL8                      JOB IDENTIFICATION              97000018
FL2JSSP  DC    C'/'                     SLASH                           97100018
FL2STEPD DS    CL8                      STEP IDENTIFICATION             97200018
FL2TRTCH DS    CL2                      TAPE RECORDING TECHNIQUE        97300018
FL2CNTRL DS    CL1                      CARRIAGE CONTROL CHARACTER      97400018
FL2RES   DS    CL43                     RESERVED FOR FUTURE USE         97500018
FL2BFALN EQU   FL2RES                   BUFFER ALIGNMENT                97530018
FL2BLKA  EQU   FL2RES+1                 BLOCK ATTRIBUTE                 97560018
*                                                                       97600018
*                                                                       97700018
*                                                                       97800018
         END                                                            97900018
./  ADD  SSI=81150190,NAME=IGC0M05B
         TITLE 'IGC0M05B - DIRECT ACCESS MOUNT/VERIFICATION PROCESSOR'  00100002
IGC0M05B START                                                          00300018
*                                                                       00306018
*    VS2   SU24   DELETIONS/CHANGES                            @G24LSFS 00306624
*249240                                                        @G24LSFS 00307224
*                                                              @ZM44640 00307624
*    VS/2  RELEASE  3 DELETIONS                                         00308003
*0000                                                          @Y30LSRA 00310003
* RELEASE 037 CHANGES ADDITIONS DELETIONS                               00311037
*A412160                                                       @ZA18267 00311537
*A157270,A401700,A412001-412008                                @ZA18335 00311724
*C157440                                                       @ZA24910 00311837
*A24918237-24918837,D24914203-24914403                         @ZA27287 00311924
*C15783037,C15789037                                           @ZA27488 00312524
* APAR OZ31488 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 00312824
*C157260-157290,237400,250381,412004,412005,608000             @ZSUT222 00313124
*A237800-238200,652164                                         @ZSUT222 00313324
*A400000-400270,400630-400720,400990-401080,483100-483600      @ZA31668 00313424
*D401700,412001-412008                                         @ZA31668 00313524
*C400810,410100                                                @ZA31668 00313624
*          RELEASE 18 DELETIONS                                         00313937
*          RELEASE 19 DELETIONS                                         00318018
*0521185500                                                      A27516 00321019
*0521158000,292000-293000,349000-351000,598000-599000            A27515 00322019
*0521158250,291700-292400,298000,571000,958500-959000            M4597  00323019
*0521345000-353000,359000                                        M2763  00323519
*          RELEASE 20 DELETIONS                                         00324018
*1560533000                                                      A36914 00325020
*1560158350,228000-241000,315000,422600,427000,429000,453000,    A30003 00326020
*1560455000,610000-619000                                        A30003 00328020
*1560182500,217000,235800,531000,575000,652000                   A33983 00329020
*1560271000                                                      A36176 00329520
*          RELEASE 21 DELETIONS                                         00330018
*0970273000,426000-427600,465000,550000-552000,572000-573000,    M0187  00330321
*0970575000,579000                                               M0187  00330621
*0970229400-230200                                               A42435 00331021
*0970                                                            A42221 00333021
*          RELEASE 22 DELETIONS                                         00336018
*          RELEASE 23 DELETIONS                                         00342018
*          RELEASE 24 DELETIONS                                         00348018
*          RELEASE 25 DELETIONS                                         00354018
*          RELEASE 26 DELETIONS                                         00360018
*                                                                       00366018
* STATUS CHANGE LEVEL 004                                               00372021
*                                                                       00378018
*********************************************************************** 00384018
*                                                                       00400018
*TITLE                                                                  00500018
*                                                                       00600018
*     DIRECT ACCESS MOUNT/VERIFICATION PROCESSOR                        00700018
*                                                                       00800018
*STATUS                                                                 00900018
*                                                                       01000018
*FUNCTION/OPERATION                                                     01100018
*                                                                       01200018
*        SEQ. & P.O. - CHECK VOLUME SERIAL IN TABLE AGAINST VOLUME      01300018
*        SERIAL IN THE SRTUCB INDICATED BY THE DATA SET'S TIOT ENTRY.   01400018
*                                                                       01500018
*        IF THE CORRECT VOLUME IS NOT MOUNTED, CHECK ALL THE SECONDARY  01600018
*        STRUCB'S INDICATED AND IF THE VOLUME IS FOUND TO BE MOUNTED    01700018
*        ON ONE OF THEM, EXCHANGE IT WITH THE PRIMARY SRTUCB.           01800018
*                                                                       01900018
*        IF THE CORRECT VOLUME IS NOT MOUNTED ANYWHERE FIND A USEABLE   02000018
*        UCB & ISSUE A MOUNT MESSAGE - ERROR IF NO AVAILABLE UCB.       02100018
*                                                              @Y30LSRA 02110003
*        IF THE UCB INDICATES A VIRTUAL DASD, THE MOUNT MESSAGE@Y30LSRA 02120003
*        IS INTERCEPTED AND A MESSAGE IS SENT TO  MSS TO MOUNT @Y30LSRA 02130003
*        A VIRTUAL VOLUME ON THE MSS  SYSTEM.  A DEMOUNT       @Y30LSRA 02140003
*        MESSAGE WILL PRECEDE THE MOUNT MESSAGE, BUT ONLY FOR  @Y30LSRA 02150003
*        MSS  DEVICES AND ONLY FOR NON SHARED AND ONLINE       @Y30LSRA 02160003
*        PACKS.                                                @Y30LSRA 02170003
*        FOR AN UNSUCCESSFUL MOUNT/DEMOUNT ACQUIRE/RELINQUISH  @Y30LSRA 02180003
*        A MESSAGE IS ISSUED. AN ERROR CODE OF 49 PLUS A BRANCH@Y30LSRA 02190003
*        TO THE MODULES'S EXIT ROUTINE IS ALSO ISSUED.         @Y30LSRA 02192003
*                                                                       02200018
*        BDAM, ISAM, P.O. CONCAT. & SEQ. CONCAT. - CHECK VOLUME SERIAL  02300018
*        IN TABLE (OR JFCB EXTENSION) AGAINST VOLUME SERIAL IN THE      02400018
*        UCB'S INDICATED BY THE DATA SET'S TIOT ENTRY. IF THE CORRECT   02500018
*        VOLUME IS NOT MOUNTED FIND THE 1ST AVAILABLE UCB AND ISSUE A   02600018
*        MOUNT MESSAGE. PLACE THE UCB ON WHICH IT IS MOUNTED IN THE     02700018
*        SAME RELATIVE ORDER AS THE VOLUME SERIAL NUMBER IN THE JFCB.   02800018
*                                                                       02900018
*        THE RESTART DATA SET IS BYPASSED AS MOUNTING HAS ALREADY       02950002
*        TAKEN PLACE.                                                   02960002
*                                                                       02970002
*        VAM DATA SETS - MOVE UCB ADDRESS FROM TIOT TO DEB AND          02980002
*        BYPASS THE REST OF DA MOUNTING PROCESSING.                     02990002
*                                                                       02992002
*        EACH TIME A VOLUME IS MOUNTED IT'S VOLUME SERIAL NUMBER IS     03000018
*        CHECKED. IF THE CORRECT VOLUME IS NOT MOUNTED,  MOUNT MESSAGE  03100018
*        IS RE-ISSUED.                                                  03200018
*                                                                       03300018
*        IF THE VOLUME SERIAL NUMBER FOR A VIRTUAL VOLUME IS   @Y30LSRA 03310003
*        INCORRECT, THE MESSAGE IS NOT RE-ISSUED.              @Y30LSRA 03320003
*                                                              @Y30LSRA 03330003
*        WHENEVER A VIRTUAL VOLUME IS MOUNTED, SPACE MUST BE   @Y30LSRA 03340003
*        GOTTEN ON A REAL DEVICE FOR STAGING IN THE VIRTUAL    @Y30LSRA 03350003
*        VOLUME.  THIS IS NOT DONE FOR VSAM OR ISAM DATA SETS. @Y30LSRA 03360003
*        VSAM WILL GET THEIR OWN SPACE, AND ISAM IS UNSUPPORTED@Y30LSRA 03370003
*                                                              @Y30LSRA 03380003
*ENTRY POINTS                                                           03400018
*                                                                       03500018
*                  IGC0M05B VIA XCTL FROM IGC0K05B                      03600018
*                                 OR FROM IGC0I05B                      03700018
*                                                                       03800018
*INPUT                                                                  03900018
*                                                                       04000018
*        REGISTER 8 - START OF DATA SET TABLE                           04100018
*        REGISTER 1 - RESTART WORKAREA                                  04200018
*        REGISTER 10 - RESTART WORKAREA                                 04250002
*                                                                       04300018
*OUTPUT                                                                 04400018
*                                                                       04500018
*        NOT APPLICABLE                                                 04600018
*                                                                       04700018
*EXTERNAL ROUTINES                                                      04800018
*                                                                       04900018
*                  NONE                                                 05000018
*                                                                       05100018
*EXITS                                                                  05200018
*                                                                       05300018
*      (1) TO IGC0L05B                                                  05400018
*               OR                                                      05500018
*      (2) TO IGC0N05B                                                  05600018
*               OR                                                      05700018
*      (3) TO IGC0V05B WITH ONE OF THE FOLLOWING ERROR CODES SET IN     05800024
*          THE RESTART WORK AREA:                                       05810024
*          45 - NO UCB AVAILABLE                                        05820024
*          48 - ERROR IN READ JFCB                                      05830024
*          49 - MSS ERROR                                               05840024
*          50 - VOLSER CHANGED BETWEEN CHECKPOINT AND RESTART           05850024
*                                                                       05900018
*TABLES/WORKAREAS -                                                     06000018
*                                                                       06100018
*********************************************************************** 06200018
*                                                                     * 06300018
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 06400018
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 06500018
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 06600018
*    IS 48 BYTES LONG.                                                * 06700018
*                                                                     * 06800018
*********************************************************************** 06900018
*                                                                       07000018
*        ------------------- 4 BYTES -----------------                  07100018
*                                                                       07200018
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  07300018
*        +DATA SET  +           DCB                  +                  07400018
*        + O-GN.    +         ADDRESS                +                  07500018
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                07600018
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  07700018
*        + NO. 1    +         ADDRESS                +                  07800018
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  07900018
*        +NUMBER    +         JFCB TTR               +                  08000018
*        + OF VOLS  +         ADDRESS                +                  08100018
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               08200018
*                                                                       08300018
*     12 +++++++++++++++++++++++                                        08400018
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   08500018
*        +INFO BYTE + NUMBER   +                                        08600018
*        +++++++++++++++++++++++                                        08700018
*                                                                       08800018
*     12 +++++++++++++++++++++++                                        08900018
*        +    OLD   TIOT       +        DA AND UNIT RECORD              09000018
*        +      OFFSET         +                                        09100018
*        +++++++++++++++++++++++                                        09200018
*                                                                       09300018
*                              +++++++++++++++++++++++                  09400018
*                              +FLAG BYTE +FLAG BYTE +                  09500018
*                              +  NO. 2   +  NO. 3   +                  09600018
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  09700018
*        +FLAG BYTE +FLAG BYTE +                     +                  09800018
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  09900018
*        +++++++++++++++++++++++                     + 20               10000018
*        +                                           +                  10100018
*        +                                           +                  10200018
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  10300018
*        +                                           +                  10400018
*        +   VOLUME ID NO. 2                         +                  10500018
*        +                     +++++++++++++++++++++++ 28               10600018
*        +                     +                     +                  10700018
*        +                     +   VOLUME ID NO. 3   +                  10800018
*     32 +++++++++++++++++++++++                     +                  10900018
*        +                                           +                  11000018
*        +                                           +                  11100018
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               11200018
*        +                                           +                  11300018
*        +   VOLUME ID NO. 4                         +                  11400018
*     40 +                     +++++++++++++++++++++++                  11500018
*        +                     +                     +                  11600018
*        +                     +                     +                  11700018
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               11800018
*        +                                           +                  11900018
*        +                                           +                  12000018
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               12100018
*                                                                       12200018
*                                                                       12300018
*ATTRIBUTES -                                                           12400018
*                                                                       12500018
*              RE-ENTRANT, ENABLED, PRIVILEGED                          12600018
*                                                                       12700018
*********************************************************************** 12800018
*                                                                       12900018
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               13000018
*                                                                       13100018
*********************************************************************** 13200018
*                                                                       13300018
WRKR1    EQU   0                   WORK/PARM REGISTER                   13400002
WRKR2    EQU   1                   WORK/PARM REGISTER                   13500002
DCBR     EQU   2                   CURRENT DCB REGISTER                 13600002
BASER    EQU   3                   BASE REGISTER                        13700002
DEBR     EQU   4                   CURRENT DEB REGISTER                 13800002
UCBR     EQU   5                   CURRENT UCB REGISTER                 13900002
TIOTR    EQU   6                   NEW TIOT REGISTER                    14000002
TCBR     EQU   7                   TCB REGISTER                         14100002
TABLR    EQU   8                   START OF DCB TABL REG                14200002
CTABLR   EQU   9                   CURRENT DCB IN TABL REG              14300002
BUFR     EQU   10                  USER BUFFER AREA                     14400002
DSCNTR   EQU   11                  NUMBER OF DATA SETS                  14500002
WRKR3    EQU   12                  WORK REGISTER                        14600002
WRKR4    EQU   13                  WORK REGISTER                        14700002
WRKR5    EQU   14                  WORK/PARM REGISTER                   14800002
WRKR6    EQU   15                  WORK/PARM REGISTER                   14900002
*                                                                       15000018
*********************************************************************** 15100018
*                                                                       15200018
*    OFFSETS TO BE USED IN REPI/O PHASE                                 15300018
*                                                                       15400018
*********************************************************************** 15500018
*                                                                       15600018
IS       EQU   X'80'               INDEXED SEQUENCIAL                   15603002
PS       EQU   X'40'               PHYSICAL SEQUENCIAL                  15606002
DA       EQU   X'20'               DIRECT ACCESS                        15609002
PO       EQU   X'02'               PARTITIONED ORGANIZATION             15612002
NULL     EQU   X'80'               NULLFILE OR SYSCHECK                 15615002
INOROUT  EQU   X'40'               SYSIN OR SYSOUT DATA SET             15618002
DADEV    EQU   X'20'               DA DEVICE                            15621002
UNITREC  EQU   X'04'               UNIT RECORD EQUIPMENT                15630002
ERRINNSL EQU   X'80'               ERROR IN NSL ROUTINE                 15633002
NSLMTSW  EQU   X'40'               NSL MOUNT SWITCH                     15636002
NSLCOMU  EQU   X'20'               NSL COMMUNICATION BIT                15639002
BYPASS   EQU   X'10'               BYPASS LABEL PROCESSING              15642002
NSL      EQU   X'04'               NON-STANDARD LABEL                   15645002
SL       EQU   X'02'               STANDARD LABEL                       15648002
NL       EQU   X'01'               NO LABEL                             15651002
FIVE     EQU   5                   CONSTANT 5                    YM5513 15655402
POCONCAT EQU   X'40'               P.O. CONCATENATED                    15657002
DAFLAG   EQU   X'80'               DA DATA SET FLAG                     15660002
NONDAFLG EQU   X'40'               NON-DA DATA SET FLAG                 15663002
NSLFLAG  EQU   X'10'               NSL ROUTINE FLAG                     15666002
TYPERST  EQU   X'80'               IMMEDIATE RESTART                    15669002
TABENT   EQU   48                  TABLE ENTRY LENGTH                   15672002
WRITE    EQU   X'01'               WRITE ON TAPE                        15675002
READ     EQU   X'02'               READ FOR TAPE                        15678002
NOPOP    EQU   X'03'               NOP                                  15681002
SENSE    EQU   X'04'               SENSE                                15684002
REWIND   EQU   X'07'               REWIND                               15687002
READBACK EQU   X'0C'               READBACK                             15690002
UNLOAD   EQU   X'0F'               REWIND AND UNLOAD                    15693002
WTM      EQU   X'1F'               WRITE TAPE MARK                      15696002
BSFOP    EQU   X'2F'               BACKWARD SPACE FILE                  15699002
FSFOP    EQU   X'3F'               FORWARD SPACE FILE                   15702002
SEARCH   EQU   X'31'               SEARCH                               15705002
SRCHCNT  EQU   X'05'               COUNT FOR SEARCH ID                  15708002
TIC      EQU   X'08'               TIC                                  15711002
READDA   EQU   X'06'               READ FOR DA                          15714002
LENJFCB  EQU   X'B0'               LENGTH OF JFCB                       15717002
LBLLEN   EQU   X'50'               LENGTH OF LABEL                      15720002
PERMERR  EQU   X'7F'               PERMANENT ERROR                      15723002
ERR045   EQU   45                  NO UCB AVAILABLE            @ZSUT222 15726024
ERR050   EQU   50                  VOLSER NOT EQUAL            @ZSUT222 15727024
ERR048   EQU   48                  ERROR IN READ JFCB          @ZSUT222 15728024
ERR049   EQU   49                  MSS ERROR CODE              @ZSUT222 15729024
EOVOLSER EQU   X'40'               END OF VOL SER LIST                  15732002
MOUNTON  EQU   X'80'               MOUNT SWITCH ON                      15735002
ONE      EQU   X'01'               CONSTANT ONE                         15738002
PERMRES  EQU   X'26'               PERMANENT RESIDENT OR SYSTEM         15741002
DMCOUNT0 EQU   X'7F'               DATA MANAGEMENT COUNT 0     @ZA24910 15744037
MSGLEN   EQU   X'1A'               MSG LENGTH                           15750002
SLASH    EQU   C'/'                SLASH                                15753002
COMMA    EQU   C','                COMMA                                15756002
SIGNOFF  EQU   X'F0'               REMOVE SIGN BIT                      15759002
NOTREADY EQU   X'40'               NOT READY SWITCH                     15762002
REC3     EQU   X'03'               CYL 0 - TRK 0 - REC 3                15765002
FILEMASK EQU   X'18'               FILE MASK                            15768002
CHAIN    EQU   X'40'               CHAINING FLAG                        15771002
MOUNTOFF EQU   X'7F'               MOUNT SWITCH OFF                     15774002
DSONDEV  EQU   X'80'               DATA SET ON DEVICE                   15777002
SWON     EQU   X'20'               PROCESSING SWITCH ON        @ZA27488 15783037
BLANK    EQU   C' '                BLANK CHARACTER                      15785037
POORIS   EQU   PO+IS               P.O. OR I.S.                         15787037
SWOFF    EQU   X'DF'               PROCESSING SWITCH OFF       @ZA27488 15789037
ZERO     EQU   X'00'               ZERO CONSTANT                        15795002
SCRATCHV EQU   X'10'               SCRTCH PACK INDICATOR       @Y30LSRA 15796003
VIRTDASD EQU   X'08'               VIRT DASD MASK              @Y30LSRA 15797003
SHARED   EQU   X'80'               SHARED DEVICE               @Y30LSRA 15797603
ONLINE   EQU   X'80'               ONLINE DEVICE               @Y30LSRA 15797803
ACQ      EQU   X'02'               ACQUIRE OP CODE             @Y30LSRA 15798203
AROP     EQU   4                   DISP. OPCODE IN PARM LIST   @ZM44640 15798424
REL      EQU   X'04'               RELINQUISH OP CODE          @Y30LSRA 15798603
MNT      EQU   X'08'               MOUNT OP CODE               @Y30LSRA 15798703
DMNT     EQU   X'06'               DEMOUNT OP CODE             @Y30LSRA 15798803
R15      EQU   15                  REGISTER 15                 @Y30LSRA 15798903
DECZRO   EQU   X'F0'               DECIMAL ZERO                @Y30LSRA 15802903
ACQPLN   EQU   96                  ACQ PARM LST LENGTH         @Y30LSRA 15807003
K3       EQU   3                   CONSTANT OF 3                 A27515 15811003
K4       EQU   4                   CONSTANT OF 4                 A27515 15815002
NOMIX    EQU   11                  MASK FOR NOT MIXED            A27515 15845002
D0       EQU   0                   ZERO                          Y02076 15847002
D1       EQU   1                   ONE                           Y02076 15849002
D2       EQU   2                   TWO                           Y02076 15851002
D3       EQU   3                   THREE                         Y02076 15853002
D4       EQU   4                   FOUR                          Y02076 15853402
D5       EQU   5                   FIVE                          Y02076 15853802
D6       EQU   6                   SIX                           Y02076 15854202
D7       EQU   7                   SEVEN                         Y02076 15854602
D8       EQU   8                   EIGHT                         Y02076 15854702
D9       EQU   9                   NINE                          Y02076 15854802
D10      EQU   10                  TEN                         @Y30LSRA 15855803
D12      EQU   12                  TWELVE                      @Y30LSRA 15856203
D21      EQU   21                  TWENTY-ONE                  @Y30LSRA 15856803
D23      EQU   23                  TWENTY-THREE                @Y30LSRA 15866803
D24      EQU   24                  TWENTY FOUR                   Y02076 15869902
D27      EQU   27                  TWENTY-SEVEN                @Y30LSRA 15870003
D26      EQU   26                  TWENTY SIX                  @Y30LSRA 15870303
D28      EQU   28                  TWENTY EIGHT                @Y30LSRA 15870903
D33      EQU   33                  THIRTY THREE                @Y30LSRA 15871903
D40      EQU   40                  FORTY                         Y02076 15879902
D51      EQU   51                  FIFTY-ONE                   @Y30LSRA 15880003
D67      EQU   67                  SIXTY-SEVEN                 @Y30LSRA 15881503
D69      EQU   69                  SIXTY-NINE                  @Y30LSRA 15882303
D92      EQU   92                  NINETY-TWO                  @Y30LSRA 15882703
L2       EQU   2                   LENGTH OF TWO               @Y30LSRA 15883503
L3       EQU   3                   3                           @Y30LSRA 15885003
L4       EQU   4                   LENGTH OF FOUR              @Y30LSRA 15886503
L6       EQU   6                   LENGTH OF SIX               @Y30LSRA 15888003
L8       EQU   8                   LENGTH OF EIGHT             @Y30SLRS 15889503
L11      EQU   11                  LENGTH OF ELEVEN            @Y30LSRA 15891003
L28      EQU   28                  LENGTH OF TWENTY-EIGHT      @ZM33364 15892503
L80      EQU   80                  LENGTH OF EIGHTY            @Y30LSRA 15894003
L100     EQU   100                 LENGTH OF ONE HUNDRED       @Y30LSRA 15895503
EXCHPGM  EQU   X'80'               EXCP INDICATOR IN MACRF       YM5512 15897003
*                                                                       15898503
*********************************************************************** 15900018
*                                                                       16000018
         USING TABL,WRKR4          CURRENT TABLE ENTRY                  16100018
         USING MNTTIOT,TIOTR       NEW TIOT                             16200018
         USING UCBOB,UCBR          UCB                           YM7868 16300002
         USING MNTTCB,TCBR         TCB                                  16400018
         USING RSDSECT,DEBR        WORK AREA                            16500018
         USING IHADCB,CTABLR       DCB                                  16600018
         USING RSTWA,BUFR          RESTART WORK AREA                    16700002
*                                                                       16800018
*********************************************************************** 16900018
*                                                                       17000018
*                                  INITIALIZE REGISTERS                 17100018
*                                                                       17200018
*********************************************************************** 17300018
*                                                                       17400018
         BALR  BASER,0             SET UP BASE REGISTER                 17500018
         USING *,BASER                                                  17600018
         B     BEGIN               BRANCH AROUND EYE CATCHER     Y01909 17650000
         CNOP  0,8                 ALIGN TO A DBL WORD BOUNDARY  Y01909 17660000
         DC    CL8'IGC0M05B'       MODULE NAME                 @ZSUT222 17670024
         DC    CL8'&SYSDATE'       LAST DATE SHIPPED           @ZSUT222 17672024
         DC    CL8'@ZA31668'       LAST CODE SHIPPED           @ZSUT222 17674024
         DC    CL8'@SU82400'       SELECTABLE UNIT IDENT.      @ZSUT222 17676024
BEGIN    EQU   *                                                 Y01909 17680000
*                                                                       17700018
*        INITIALIZE PERTINENT REGISTERS                                 17800018
*                                                                       17900018
         L     TCBR,RSTCBAD        PICK UP TCB ADDRESS                  18000002
         L     TIOTR,TCBTIO        PICK UP TIOT ADDRESS                 18100002
         LA    TIOTR,D0(TIOTR)     ADR ONLY                      Y02076 18150002
         LR    WRKR4,TABLR         TABLE ADDRESS TO WRKR4               18200018
         L     DEBR,TABSEGAD-1     PICK UP WORKAREA ADDRESS      A27516 18220019
         MVI   RSPPM+4,C'L'        SET UP XCTL LIST              A33983 18260020
*********************************************************************** 18270002
*   GET SPACE FOR QMNGRIO PARAMETER LIST AND WORKAREA THEN INITIALIZE * 18280002
*   IT.  QMNGRIO IS USED FOR READING IN THE JFCB FROM THE SCHEDULER   * 18290002
*   WORK AREA (SWA).                                                  * 18292002
*********************************************************************** 18294002
         ICM   WRKR1,ADDRBYTS,QMNPRMLN  LENGTH OF PARM LIST+WA   Y02076 18296002
         ICM   WRKR1,HIORDER,SP253 SUBPOOL 253                   Y02076 18298002
         GETMAIN  R,LV=(D0)        ISSUE GETMAIN FOR SPACE       Y02076 18298402
         USING QMIOP,WRKR2                                       Y02076 18298802
         XC    QMITCBAD(D24),QMITCBAD CLEAR PARM LIST            Y02076 18299202
         ST    TCBR,QMITCBAD       STORE TCB ADR IN PRM L.       Y02076 18299602
         LA    WRKR1,QMWRKOFT      GET WORK AREA OFFSET          Y02076 18299802
         AR    WRKR1,WRKR2         CALC ADR OF WORK AREA         Y02076 18299902
         ST    WRKR1,QMIWRKAD      STORE IN PARM LIST            Y02076 18300002
         LA    WRKR1,JFCBLNGH      GET LENGTH OF JFCB            Y02076 18333202
         STH   WRKR1,QMIRECL       STORE RECORD LENGTH           Y02076 18343202
         MVI   QMIFLAGS,QMIOREAD   SET READ FUNCTION             Y02076 18353202
         ST    WRKR2,QMNPRMWA      SAVE ADR OF PARM LIST         Y02076 18363202
         DROP  WRKR2                                             Y02076 18365202
*                                                                       18365302
*        IN ORDER TO PREVENT A NON-CANCELABLE SITUATION IN THE   YM7890 18365602
*        EVENT THE MEMORY IS SWAPPED OUT WITH AN OUTSTANDING     YM7890 18366002
*        MOUNT, ISSUE A SYSEVENT TO INHIBIT SWAP-OUT.            YM7890 18366402
*                                                                YM7890 18366502
         SYSEVENT DONTSWAP         INHIBIT SWAP-OUT              YM7890 18366602
*                                                                YM7890 18377702
MNTDA005 EQU   *                                                        18400018
         L     CTABLR,TABDCBAD-1   PICK UP DCB ADDRESS                  18470018
         MVC   RSJFCB+164(3),TABJFCB SAVE TTR OF JFCB.                  18580002
         TM    TABFLG1,TABDA       D.A.                                 18620002
         BZ    MNTDA105            BRANCH IF NOT D.A.                   18700018
*                                                                       18800018
         TM    TABFLG1,TABSYS      IS IT SUBSYS DATA SET         Y02076 18870002
         BO    MNTDA105            YES-BR OVER MOUNT             Y02076 18880002
         MVC   RSJFCB1+4(30),TABVLID1 MOVE VOL SER NO TO WORK AREA      18900018
         MVI   RSJFCB1+34,EOVOLSER FLAG END OF VOL SER LIST             19000018
         LA    DSCNTR,RSJFCB1+4    SET VOL SER NO POINTER               19100018
         LH    WRKR5,DCBTIOT       PICK UP TIOT OFFSET                  19300018
         SR    WRKR6,WRKR6         CLEAR                                19400002
         IC    WRKR6,0(TIOTR,WRKR5) LENGTH OF DD ENTRY                  19500018
         AR    WRKR6,TIOTR         TIOTR ADDRESS                        19600002
         AR    WRKR6,WRKR5         ADD OFFSET                           19700002
         ST    WRKR6,RSJFCB+160    SAVE 'END OF DD ENTRY' POINTER       19800002
*                                                                       19900018
*                                  POINTS TO DDNAME                     20000018
*                                                                       20100018
         LA    WRKR5,16(WRKR5)     DISPLACEMENT TO 1ST UCB              20200018
         LR    TCBR,WRKR5          POINT TO BEGINNING OF UCB'S TO BE    20300018
*                                  CHECKED                              20400018
         BAL   WRKR2,MNTDA116      GET 1ST AVAIL UCB ADDR        YM7868 20500002
*                                                                       20600018
MNTDA010 EQU   *                                                        20700018
*                                                                YM7550 20750002
*        VIO DATA SETS ARE ALLOCATED WITH ONLY ONE PSEUDO        YM7550 20760002
*        DEVICE WHICH DOES NOT REQUIRE VOLUME MOUNTING.          YM7550 20770002
*                                                                YM7550 20780002
         TM    UCBJBNR,UCBVRDEV    VIO PSEUDO DEVICE             YM7550 20790002
         BNO   MNTDA013            IF NOT, CONTINUE              YM7550 20792002
         TM    TABFLG2,TABRSDS     IS THIS THE RESTART D/S       YM7579 20792402
         BO    MNTDA070            IF SO, LEAVE D/M COUNT ALONE  YM7579 20792802
         IC    DCBR,UCBDMCT        UPDATE THE DATA               YM7550 20794002
         LA    DCBR,D1(,DCBR)        MANAGEMENT COUNT            YM7550 20796002
         STC   DCBR,UCBDMCT            BY ONE                    YM7550 20798002
         B     MNTDA070            SKIP VOLUME MOUNTING          YM7550 20798402
*                                                                       20800018
MNTDA013 EQU   *                   NON-VIO ENTRY                 YM7550 20850002
         TM    UCBDMCT,MOUNTON     IS MOUNT SWITCH ON            YM7868 20900002
         BO    MNTDA040            BRANCH IF YES                        21000018
         CLC   0(6,DSCNTR),UCBVOLI CORRECT VOLUME MOUNTED        YM7868 21100002
         BE    MNTDA040            BRANCH IF YES                        21200018
*                                                                       21300018
MNTDA015 EQU   *                                                        21400018
         BAL   WRKR2,MNTDA115      GO TO 'GET NEXT UCB' ROUTINE         21500018
*                                                                       21600018
         BC    3,MNTDA010          BR IF NOT LAST UCB - COND     A33983 21700020
*                                  CODE SET IN 'GET NEXT UCB' ROUTINE   21800018
*                                                                       21900018
*********************************************************************** 22000018
*                                                                       22100018
* THE VOLUME WAS NOT MOUNTED - FIND AN AVAILABLE UCB AND MOUNT THE      22200018
* VOLUME.                                                               22300018
*                                                                       22400018
*********************************************************************** 22500018
*                                                                       22600018
         LR    WRKR5,TCBR          1ST AVAILABLE UCB POINTER     YM7868 22700002
         BAL   WRKR2,MNTDA116      GET 1ST AVAIL UCB ADDR        YM7868 22780002
MNTDA020 EQU   *                                                 A30003 22860020
         TM    UCBSTAT,PERMRES     IS DEVICE PERM RES OR SYS     YM7868 23100002
         BNE   MNTDA025            BR IF YES                     A30003 23180020
         TM    UCBDMCT,DMCOUNT0    DATA MANAGEMENT COUNT=0       YM7868 23260002
         BZ    MNTDA028            BR IF 0                       A30003 23340020
MNTDA025 EQU   *                                                 A30003 23420020
         BAL   WRKR2,MNTDA115      GO TO 'GET NEXT UCB' ROUTINE  A30003 23500020
         BC    3,MNTDA020          BR IF NOT LAST UCB            A33983 23580020
MNTDA026 EQU   *                                                 A30003 23660020
         MVI   RSRETCOD+1,ERR045   NO UCB AVAIL,RETURN CODE 45 @ZSUT222 23740024
MNTDA027 EQU   *                                                 A30003 23760024
         MVC   RSREGSAV(8),MODID   SAVE NAME OF MODULE THAT    @ZSUT222 23780024
*                                  HAS DETECTED THE ERROR.     @ZSUT222 23800024
         STM   0,15,RSREGSAV+8     SAVE CURRENT REGISTERS      @ZSUT222 23820024
         MVI   RSPPM+4,C'V'        XCTL TO IGC0V05B              A30003 23900020
         B     MNTDA160                                          A30003 23980020
*                                                                       24200018
*********************************************************************** 24300018
*                                                                       24400018
* VOLUME CAN BE MOUNTED- PREPARE TO ISSUE MOUNT MESSAGE                 24500018
*                                                                       24600018
*********************************************************************** 24700018
*                                                                       24800018
MNTDA028 EQU   *                                                        24900018
*                                                              @Y30LSRA 24901003
         USING UCBOB,UCBR          ADDRESSING MAIN UCB         @Y30LSRA 24902003
         L     UCBR,RSDEBUCB       PICK UP MAIN UCB ADDRESS    @Y30LSRA 24903003
         OI    UCBFL2,NOTREADY     SET NOT READY SWITCH ON     @Y30LSRA 24904003
***************************************************************@Y30LSRA 24906003
*        IF THE DASD TO BE MOUNTED IS VIRTUAL, THE WTO MUST BE @Y30LSRA 24907003
*        INTERCEPTED AND A MESSAGE SENT TO MSS  INSTEAD.       @Y30LSRA 24908003
*        FOR MSS ONLY,IF A  VOLUME EXISTS ON THE VIRTUAL DRIV  @Y30LSRA 24909003
*        AND IS DEMOUNTABLE, A DEMOUNT MESSAGE IS SENT TO MSS  @Y30LSRA 24910003
*        BEFORE THE MOUNT MESSAGE IS SENT.                     @Y30LSRA 24911003
***************************************************************@Y30LSRA 24912003
         TM    UCBTBYT2,VIRTDASD   IS VIRTUAL DEVICE INDICATED @Y30LSRA 24913003
         BNO   MNTDA02D            NO, FORGET MSS  PROCESSING  @Y30LSRA 24914003
         TM    UCBSTAT,ONLINE      IS DRIVE ONLINE             @Y30LSRA 24914603
         BZ    MNTDA026            NO, CANNOT DEMOUNT          @ZM30037 24914803
         CLC   UCBVOLI(L6),ZEROS   ANY PACK MOUNTED            @Y30LSRA 24915003
         BE    MNTDA029            NO, FORGET DEMOUNT          @Y30LSRA 24916003
         CLC   UCBVOLI(L6),BLANKS  IS ANYTHING MOUNTED         @ZM30037 24917003
         BE    MNTDA029            NO, NOTHING MOUNTED         @ZM30037 24918003
* CHECK IF THE CURRENT VOLUME MOUNTED HAS UNIT=AFF,            @ZA27287 24918237
* MORE VOL SERIALS THAN UNITS OR DEFER MOUNTING.               @ZA27287 24918437
         TM    UCBSTAB,SHARED      IS DRIVE SHAREABLE ?        @ZA27287 24918637
         BO    MNTDA026            YES, CANT MOUNT ON UCB      @ZA27287 24918837
         LA    WRKR2,RSJFCB        DEMOUNT, GET WORK AREA      @ZM30037 24919003
         XC    D0(L28,WRKR2),D0(WRKR2) ZERO OUT THE WORK AREA  @ZM33364 24920003
         MVC   RSJFCB+D8(L6),UCBVOLI  MOVE IN VOLID - DEMOUNT  @Y30LSRA 24921003
         ICBMNTDE TYPE=DMNT,VUA=UCBCHA,                        @G24LSFS*24924024
               MF=(E,(1))                                               24924524
         LTR   WRKR6,WRKR6         ANY ERRORS                  @Y30LSRA 24925003
         BNZ   MNTDA02C            YES, DO NOTHING             @ZM30037 24926003
MNTDA029 EQU   *                                               @Y30LSRA 24927003
         OI    SRTEDMCT,MOUNTON    SET MOUNT SW ON             @Y30LSRA 24928003
         LA    WRKR2,RSJFCB        GET READ IN AREA            @Y30LSRA 24931003
         XC    D0(L28,WRKR2),D0(WRKR2) CLEAR IT OUT FOR LIST   @ZM33364 24932003
         CLC   SCRTCH,D0(DSCNTR)   MOUNTING SCRATCH            @Y30LSRA 24933003
         BNE   MNTDA02A            NO, DON'T SET SCRTCH BIT    @Y30LSRA 24934003
         OI    D6(WRKR2),SCRATCHV  YES, MOUNT SCRATCH          @Y30LSRA 24935003
         B     MNTDA02B            FORGET VOLID FOR SCRTCH     @Y30LSRA 24935203
MNTDA02A EQU   *                                               @Y30LSRA 24935403
         MVC   RSJFCB+D8(L6),D0(DSCNTR) MOVE IN VOLID          @Y30LSRA 24935603
MNTDA02B EQU   *                                               @Y30LSRA 24935803
         ICBMNTDE TYPE=MNT,VUA=UCBCHA,MF=(E,(1))               @Y30LSRA 24939003
         LTR   WRKR6,WRKR6         ANY ERRORS OCCUR            @Y30LSRA 24940003
         BZ    MNTDA040            NO, ALL OK - CONTINUE       @Y30LSRA 24941003
MNTDA02C EQU   *                                               @Y30LSRA 24942003
         STH   WRKR1,D0(WRKR2)     SAVE  DATA IN REGISTER 0    @Y30LSRA 24942403
         MVC   MSGAREA(MSGLENTH-MSSMSG),MSSMSG  SET UP MSG     @Y30LSRA 24942803
         L     R15,CVTPTR          GET CVT ADDR                @Y30LSRA 24942903
         L     R15,D0(,R15)         GET ADDR OF TCB  WORDS     @Y30LSRA 24954303
         L     R15,D4(,R15)         GET CURRENT TCB PTR        @Y30LSRA 24964303
         L     R15,D12(,R15)       GET TIOT PTR                @Y30LSRA 24964703
         MVC   MSGAREA+D12(L8),D0(R15) GET JOBNME              @Y30LSRA 24965103
         MVC   MSGAREA+D21(L6),D8(WRKR2) GET VOLSER IN MSG     @Y30LSRA 24965503
         CLI   D4(WRKR2),ACQ       TEST FOR ACQUIRE            @Y30LSRA 24965603
         BE    MNTDA03D            YES--NO DDD                 @Y30LSRA 24965703
         CLI   D4(WRKR2),REL       TEST FOR RELINQUISH         @Y30LSRA 24969503
         BE    MNTDA03D            YES--NO DDD                 @Y30LSRA 24971503
         MVC   MSGAREA+D28(L3),UCBNAME  INSERT UNIT ID         @Y30LSRA 24971903
         B     MNTDA03E            CONTINUE PROCESSING MSG     @Y30LSRA 24972303
MNTDA03D MVI   MSGAREA+D27,BLANK   INSERT BLANK IN MSG         @Y30LSRA 24972703
         MVC   MSGAREA+D28(L3),MSGAREA+D27  BLANK DDD          @Y30LSRA 24973103
MNTDA03E CLI   D4(WRKR2),MNT       TEST FOR MOUNT              @Y30LSRA 24973203
         BNE   MNTDA03F            NO                          @Y30LSRA 24973303
         MVC   MSGAREA+D51(L11),KMNT   INSERT MOUNT IN MSG     @Y30LSRA 24977103
         B     MNTDA03K            CONTINUE PROCESSING MSG     @Y30LSRA 24979103
MNTDA03F CLI   D4(WRKR2),DMNT      TEST DEMOUNT                @Y30LSRA 24979503
         BNE   MNTDA03G            NO                          @Y30LSRA 24979903
         MVC   MSGAREA+D51(L11),KDMNT INSERT DEMOUNT IN MSG    @Y30LSRA 24980303
         B     MNTDA03K            CONTINUE PROCESSING MSG     @Y30LSRA 24980703
MNTDA03G CLI   D4(WRKR2),ACQ       TEST FOR ACQUIRE            @Y30LSRA 24980803
         BNE   MNTDA03H            NO--RELINQUIST              @Y30LSRA 24980903
         MVC   MSGAREA+D51(L11),KACQ INSERT ACQUIRE            @Y30LSRA 24984703
MNTDA03H LH    WRKR6,D26(,WRKR2)   GET REASON CODE             @ZM30037 24987103
         LTR   WRKR6,WRKR6         TEST FOR NON-ZERO           @Y30LSRA 24987503
         BNZ   MNTDA03J            YES,USE CODE IN MSG         @Y30LSRA 24987903
         L     WRKR3,D92(,WRKR2)   GET NEST LIST PTR           @Y30LSRA 24988303
         LTR   WRKR3,WRKR3         TEST FOR ZERO               @Y30LSRA 24988403
         BZ    MNTDA03J            YES,USE CODE ONLIST         @Y30LSRA 24988503
         LR    WRKR2,WRKR3         SET NEW LIST PTR            @Y30LSRA 25007003
         B     MNTDA03H            EXAMINE RESSON CODE         @Y30LSRA 25017003
MNTDA03K LH    WRKR6,D0(WRKR2)     GET REASON CODE             @Y30LSRA 25021003
MNTDA03J SLL   WRKR6,D4            SHIFT FOUR BITS             @ZM30037 25023003
         STH   WRKR6,D0(WRKR2)     RESET REASON CODE           @Y30LSRA 25025003
         UNPK  MSGAREA+D67(L3),D0(L2,WRKR2)  UNPACK CODE       @Y30LSRA 25025403
         OI    MSGAREA+D69,DECZRO  INSURE VALID DIGIT          @Y30LSRA 25025803
         TR    MSGAREA+D67(L3),ABTABLE  MAKE PRINTABLE         @Y30LSRA 25025903
         LR    WRKR3,WRKR2         SAVE PTR TO WORKAREA        @Y30LSRA 25032103
         LA    WRKR2,MSGAREA       GET ADDR OF MSGAREA         @Y30LSRA 25032503
         WTO   MF=(E,(1))          ISSUE WTO,WTP               @Y30LSRA 25034103
         LR    WRKR2,WRKR3         RESTORE PTR TO WORKAREA     @Y30LSRA 25036103
         MVI   RSRETCOD+D1,ERR049  SET MSS ERROR CODE          @ZSUT222 25038124
         B     MNTDA027            BRANCH TO EXIT ROUTINE      @Y30LSRA 25055024
MNTDA02D EQU   *                                               @Y30LSRA 25063003
         MVC   MSGAREA(19),MOUNTMS MOUNT INFO TO MESSAGE AREA.          25081503
         MVC   MSGID(6),0(DSCNTR)  VOL ID TO MESSAGE AREA.              25100018
         MVC   MSGID+6(4),RTDESC   MOVE ROUTE AND DESCRIPTOR        MCS 25130018
*                                  CODES TO MESSAGE                 MCS 25160018
*                                                                       25500018
         MVI   MSGAREA+1,MSGLEN    INSERT MSG LENGTH FOR 2321           25600018
         MVI   MSGID-1,SLASH       MOVE SLASH TO MESSAGE                25700018
         MVI   MSGID+1,COMMA       MOVE COMMA TO MESSAGE                25800018
         MVC   MSGID(1),RSIOBDAD+2 MOVE IN BINARY NUMBER                25900018
         OI    MSGID,SIGNOFF       CONVERT TO DECIMAL NUMBER            25970018
         MVC   MSGID+2(6),0(DSCNTR) VOL ID TO MESSAGE AREA              26050002
         MVC   MSGID+8(4),RTDESC   MOVE ROUTE AND DESCRIPTOR        MCS 26060018
*                                  CODES TO MESSAGE                 MCS 26070018
*                                                                       26300018
MNTDA030 EQU   *                                                        26400018
*                                                                       26500018
         OI    SRTEDMCT,MOUNTON         SET MOUNT SW ON          A42221 26501003
         MVC   MSGUCB(3),UCBNAME   UNIT NAME                            26800018
*                                                                       27000018
*                                                                       27200018
         LA    WRKR2,MSGAREA       MESSAGE AREA ADDRESS IN REG. 1       27400018
*                                                                       27500018
         WTO   MF=(E,(1))          WRITE TO OPERATOR                    27600018
         ST    WRKR2,RSMWOFST      SAVE MSGID FOR DOM               MCS 27630018
         OI    RSMWOFST,X'80'      INDICATE DOM MUST BE ISSUED      MCS 27660018
*                                                                       27700018
*********************************************************************** 27800018
*                                                                       27900018
* PREPARE TO READ IN VOLUME SERIAL NUMBER                               28000018
*                                                                       28100018
*********************************************************************** 28200018
*                                                                       28300018
MNTDA040 EQU   *                                                        28400018
*                                                                       28500018
         MVI   RSIOBDAD+7,REC3     CYL 0 - TRK 0 - REC 3                28600018
         MVI   RSDEBUCB,FILEMASK   SET FILE MASK                        28700018
*                                                                       28705021
* TO READ VOLUME LABEL AND CONVERT VTOC ADDRESS TO TTR, DEB EXTENTS     28710021
* MUST BE SET TO COVER ENTIRE VOLUME.  LOW CCHH IS ZERO, AND HIGH       28715021
* CC + 1 IS OBTAINED FROM SYSTEM DEVICE CHARACTERISTICS TABLE.          28720021
*                                                                       28725021
         L     WRKR2,CVTPTR        LOAD CVT POINTER              M0187  28730021
         USING CVT,WRKR2                                         M0187  28735021
         L     WRKR2,CVTZDTAB      LOAD DEVTAB POINTER           M0187  28740021
         DROP  WRKR2                                             M0187  28745021
         IC    WRKR6,UCBTBYT4      GET DEVICE TYPE BYTE          M0187  28750021
         LA    WRKR1,X'0F'         GENERATE MASK                 M0187  28755021
         NR    WRKR6,WRKR1         USE LO-ORDER BITS FOR INDEX   M0187  28760021
         AR    WRKR2,WRKR6         POINT TO DEVTAB ENTRY         M0187  28765021
         IC    WRKR6,0(WRKR6,WRKR2) PICK UP NEXT INDEX           M0187  28770021
         XC    RSDEBSCC(8),RSDEBSCC CLEAR DEB EXTENTS            M0187  28775021
         MVC   RSDEBECC,0(WRKR2)   SET HIGH CYLINDER ADDR.       M0187  28780021
*                                                                       28800018
*        SEARCH ID                                                      28820019
*        TIC                                                            28840019
*        READ                                                           28860019
*                                                                       28880019
         LA    WRKR2,RSIOBDAD+3    DISK ADDR OF VOL LAB                 28900002
         ST    WRKR2,RSCCW1        PLACE IN CHANNEL PROGRAM             29000002
         MVI   RSCCW1,SEARCH       COMMAND CODE TO CCW1 (SEARCH ID EQ)  29100018
         MVC   RSCCW1+4(4),CHAIN5  RESTORE FLAG AND COUNT FIELDS M4597  29150019
*                                                                       29200019
         MVI   RSCCW2,TIC          RESTORE TIC COMMAND           M4597  29250019
         MVC   RSCCW2+1(K3),RSIOBCPA+1 NEXT CCW ADDR TO TIC CCW  A27515 29310019
*                                                                       29400018
         LA    WRKR1,RSJFCB        JFCB AREA ADDRESS                    29500002
         ST    WRKR1,RSCCW3        ADDRESS TO CCW                       29600002
         MVI   RSCCW3,READDA       RESTORE OP CODE (READ)               29700018
         LA    WRKR1,LBLLEN        FLAGS AND DATA LENGTH         M4597  29760019
         ST    WRKR1,RSCCW3+4      RESTORE FLAG AND DATA LENGTH  M4597  29820019
*                                                                       29900018
*        READ IN VOLUME LABEL                                           30000018
*                                                                       30100018
         BAL   DCBR,MNTDA135       EXCP/WAIT ROUTINE                    30200018
*                                                                       30300018
         CLC   0(6,DSCNTR),RSJFCB+4 WAS CORRECT VOLUME MOUNTED          30400018
         BE    MNTDA045            YES, CONTINUE AS USUAL      @Y30LSRA 30500003
         TM    UCBTBYT2,VIRTDASD   VIRT VOL MOUNT              @Y30LSRA 30510003
         BZ    MNTDA028            NO, GO REQUEST REMOUNT      @Y30LSRA 30520003
         B     MNTDA026            YES, ERROR -ABEND JOB       @ZM30037 30530003
MNTDA045 EQU   *                                               @Y30LSRA 30540003
*                                                                       30600018
         MVC   UCBVOLI(6),RSJFCB+4 MOVE VOL SER NO. TO UCB       YM7868 30700002
         NI    UCBDMCT,MOUNTOFF    RESET MOUNT SW                YM7868 30770002
         LA    CTABLR,0(CTABLR)    CLEAR HIGH ORDER BYTE                30850018
         CL    CTABLR,RSCKDCB      IS THIS THE CHECKPOINT DCB           30900002
         BE    MNTDA042            BRANCH IF YES                        31000002
         L     WRKR1,UCBDMCT-3     GET WORD WITH D/M COUNT       YM7868 31050002
MNTDA041 EQU   *                   RETRY ENTRY                   YM7868 31100002
         LR    WRKR2,WRKR1         GET CURRENT VALUE FOR UPDATE  YM7868 31150002
         A     WRKR2,F1            BUMP D/M COUNT BY 1           YM7868 31200002
         CS    WRKR1,WRKR2,UCBDMCT-3 ATTEMPT TO UPDATE UCB       YM7868 31250002
         BNE   MNTDA041            TRY AGAIN IF UPDATE FAILED    YM7868 31300002
MNTDA042 EQU    *                                                       31400018
*                                                                       31600018
* CONVERT VTOC ADDR TO TTR FORM AND PLACE IN UCB                        31700018
*                                                                       31800018
         MVC   RSIOBDAD+3(5),RSJFCB+11 GET CCHHR VTOC ADDR FROM LABEL   31900018
         ST    TCBR,RSSTAT1        SAVE REGISTER                        32000002
         LA    TCBR,RSJFCB+88      REG. SAVE AREA                       32100002
         STM   BASER,WRKR5,0(TCBR) STORE REGISTERS                      32200002
         LA    WRKR2,RSDEB         DEB ADDRESS TO WRKR2                 32300018
         L     WRKR6,CVTPTR        GET CVT ADDRESS                      32400018
         L     WRKR6,CVTPRLTV-CVT(WRKR6) PICK UP CONVERT RTN ADDRESS    32500018
         LA    DCBR,RSIOBDAD       MBBCCHHR ADDRESS                     32600002
         BALR  WRKR5,WRKR6         GO TO CONVERT (MBBCCHHR TO TTR)      32700018
*                                                                       32800018
         LM    BASER,WRKR5,0(TCBR) RESTORE REGS.                        32900002
         L     TCBR,RSSTAT1        RESTORE TABLE POINTER                33000002
*                                                                       33100018
* PLACE VTOC TTR ADDRESS INTO UCB                                       33200018
*                                                                       33300018
         ST    WRKR1,RSJFCB+80     TTR IN REG. 0 ON RETURN              33400002
         MVC   UCBVTOC(3),RSJFCB+80 PLACE VTOC TTR IN UCB        YM7868 33500002
*                                                                       33600018
*********************************************************************** 33700018
*                                                                       33800018
* SWAP UCB'S I.E. THE POSITION OF VOL SER IN THE JFCB SHOULD            33900018
* CORRESPOND TO THE POSITION OF UCB (IN THE TIOT) ON WHICH THAT         34000018
* VOLUME IS MOUNTED.                                                    34100018
*                                                                       34200018
*********************************************************************** 34300018
*                                                                       34400018
         L     DCBR,0(TIOTR,WRKR5) UCB ON WHICH VOL IS MOUNTED   M2763  34600019
         L     WRKR2,0(TIOTR,TCBR) UCB IN 1ST AVAIL SLOT         M2763  34800019
         ST    WRKR2,0(TIOTR,WRKR5) SAVE UCB IN 1ST AVAIL SLOT   M2763  35000019
         ST    DCBR,0(TIOTR,TCBR)  MOUNTED UCB TO 1ST AVAIL SLOT M2763  35200019
*                                                                       35250020
         LA    WRKR2,0(TIOTR,TCBR) ADDR OF 1ST UCB ADDR POSITION A30003 35300020
         OI    0(WRKR2),DSONDEV    SET 'DATA SET IS ON DEVICE'   A30003 35350020
*                                                                YM7807 37200002
*****************************************************************YM7807 37300002
*                                                                YM7807 37400002
*        THE VOLUME SERIAL NUMBER IN EACH EXTENT (PLACED THERE   YM7807 37450002
*        BY IHJQCP32) WILL BE COMPARED WITH THE VOLUME SERIAL    YM7807 37500002
*        NUMBER IN THE UCB.  IF EQUAL, THE UCB ADDRESS WILL      YM7807 37550002
*        BE PLACED IN THE EXTENT.  THE EXTENT SECTION IN EACH    YM7807 37600002
*        DA DEB (EXCLUDING DUMMY, SUBSYSTEM, AND VSAM) HAS THE   YM7807 37650002
*        FOLLOWING FORMAT:                                       YM7807 37660002
*                                                                YM7807 37670002
*      0 +++++++++++                                             YM7807 37680002
*        + VOL SER +      VOL SER NO.= VOLUME SERIAL NUMBER      YM7807 37690002
*      4 +++++++++++                                             YM7807 37692002
*        + NO.+ CC +      CCHH = EXTENT INFORMATION IN DEB       YM7807 37694002
*      8 +++++++++++                                             YM7807 37696002
*        + *H + CC +      * = SAVE AREA FOR OVERLAYED FILE MASK  YM7807 37698002
*     12 +++++++++++                                             YM7807 37698402
*        + HH + TT +      TT = NUMBER OF TRACKS IN EXTENT        YM7807 37698802
*     16 +++++++++++                                             YM7807 37699202
*                                                                YM7807 37700002
*****************************************************************YM7807 37800002
*                                                                YM7807 37900002
MNTDA070 EQU   *                                                        38000018
         BAL   WRKR3,MNTDA110      SET UP TO SPIN THRU DEB              39600002
         LTR   WRKR6,WRKR6         ANY DEB EXTENTS               YM7550 39650002
         BZ    MNTDAZIP            IF NOT, SKIP DEB UPDATE       YM7550 39660002
*                                                                       39700018
         USING DEBDASD,DCBR        DEB EXTENT ADDRESSABILITY     YM7807 39750002
***************************************************************@Y30LSRA 39751003
*        FOR VIRTUAL DASD, SPACE MUST BE ACQUIRED ON A REAL    @Y30LSRA 39751203
*        PACK FOR STAGING THE VIRTUAL PACK.  THE QUEUE MGR     @Y30LSRA 39751403
*        WORK AREA IS USED FOR A PARM LIST TO PASS TO MSS.     @ZM30037 39751603
***************************************************************@Y30LSRA 39751803
         L     WRKR5,QMNPRMWA      GET JES Q-MGR WK AREA       @Y30LSRA 39751903
         LA    WRKR5,QMWRKOFT(,WRKR5) POINT TO ACTUAL WRK AREA @Y30LSRA 39752903
         SR    WRKR1,WRKR1         ASSUME ZERO ENTRYS          @Y30LSRA 39753103
         XC    D0(L100,WRKR5),D0(WRKR5) ZERO OUT SOME SPACE    @Y30LSRA 39753303
         TM    UCBTBYT2,VIRTDASD   IS UCB FOR VIRT DEVICE      @Y30LSRA 39753903
         BNO   MNTDA075            NO, EX - OR WAS WASTED      @Y30LSRA 39755003
         TM    TABDSORG,DA+PO+PS   NON VSAM OR NON ISAM        @Y30LSRA 39760003
         BZ    MNTDA075            NO, FORGET PARM LIST        @Y30LSRA 39765003
         MVI   D3(WRKR5),ACQPLN    MOVE HEADER LENGTH          @Y30LSRA 39770003
         MVC   D8(L6,WRKR5),UCBVOLI MOVE IN THE VOLID          @Y30LSRA 39771003
         LA    WRKR3,D28(,WRKR5)   SKIP NUM OF ENTRYS BYTE     @Y30LSRA 39785003
*                                                              @Y30LSRA 39790003
MNTDA075 EQU   *                                                 YM7807 39800002
*                                                                YM7807 39950002
         NI    TABFLG3,X'FE'       RESET VOLSER MISMATCH FLAG  @ZA31668 40000024
*                                                              @ZA31668 40009024
MNTDA076 EQU   *                                               @ZA31668 40018024
*                                                              @ZA31668 40027024
         TM    DEBENDHH,SWON       HAS EXTENT BEEN PROCESSED?    YM7807 40036024
         BO    MNTDA080            YES, CHECK NEXT EXTENT        YM7807 40045024
         CLC   DEBUCBAD(D6),UCBVOLI  ARE THE VOL SERS EQUAL?     YM7807 40054024
         BE    MNTDA077            YES, CONTINUE               @ZA31668 40063024
         OI    TABFLG3,X'01'       SET VOLSER MISMATCH FLAG    @ZA31668 40072024
         B     MNTDA080            CHECK NEXT EXTENT           @ZA31668 40081024
*                                                                YM7807 40090024
MNTDA077 EQU   *                                               @ZA31668 40099024
*                                                              @ZA31668 40108024
         ST    UCBR,DEBUCBAD       PUT UCB POINTER IN EXTENT     YM7807 40130024
         MVC   DEBDVMOD(D1),DEBSTRHH  RESTORE FILE MASK          YM7807 40200002
         XC    DEBBINUM(D2),DEBBINUM  ZERO OUT BIN NUMBER        YM7807 40250002
         MVI   DEBSTRHH,D0         ZERO OUT FILE MASK TEMP HOLD  YM7807 40300002
*                                  AREA.                         YM7807 40350002
         OI    DEBENDHH,SWON       TURN ON 'PROCESSED' SWITCH    YM7807 40400002
*                                                                YM7807 40410002
*****************************************************************YM7807 40412002
*                                                                YM7807 40420002
*        SINCE ALL VIO DATA SETS HAVE THE SAME VOLUME ID         YM7807 40450002
*        (BLANKS), ONLY ONE EXTENT (EXCLUDING USER LABELS),      YM7807 40500002
*        AND THE DEB EXTENTS ARE IN DD CARD SEQUENCE FOR PO      YM7807 40550002
*        CONCATENATION, UPDATE ONLY ONE DEB EXTENT PER VIO       YM7807 40600002
*        DD ENTRY.  NOTE - PO CONCATENATION IS THE ONLY MULTI-   YM7807 40650002
*        DD, PARALLEL MOUNT SITUATION THAT CAN EXIST FOR VIO.    YM7807 40700002
*        ISAM IS NOT AN ALLOWABLE ACCESS METHOD TYPE FOR VIO.    YM7807 40750002
*                                                                YM7807 40760002
*****************************************************************YM7807 40770002
*                                                                YM7807 40780002
         TM    UCBJBNR,UCBVRDEV    IS THIS A VIO UCB             YM7807 40790002
         BO    MNTDAZIP            IF YES, SKIP RECURSION        YM7807 40792002
         TM    D3(WRKR5),ACQPLN    WAS A HEADER BUILT          @Y30LSRA 40793003
         BZ    MNTDA080            NO, THEN NO VIRT VOL        @Y30LSRA 40794003
         CLC   D6(L4,DCBR),BUNCHFFS VALID EXTENT               @Y30LSRA 40795003
         BE    MNTDA080            NO, DONT ACQ THIS EXT       @Y30LSRA 40796003
         MVC   D0(L2,WRKR3),D6(DCBR) MOVE LO CC TO ENTRY       @Y30LSRA 40797003
         MVC   D2(L2,WRKR3),D10(DCBR) MOVE HI CC TO ENTRY      @Y30LSRA 40798003
         AH    WRKR1,ONEMOR        INCR NUM OF ENTRYS          @Y30LSRA 40799003
         LA    WRKR3,D4(,WRKR3)    POINT TO NEXT ENTRY         @Y30LSRA 40799203
*                                                                       40800018
MNTDA080 EQU   *                                                        40900018
         LA    DCBR,16(DCBR)       INCREMENT TO NEXT XTENT              41000018
         BCT   WRKR6,MNTDA076      PROCESS NEXT EXTENT IF ANY  @ZA31668 41010024
         DROP  DCBR                                              YM7807 41050024
*                                                                       41090024
************************************************************** @Y30LSRA 41201003
*        IF ANY EXTENTS WERE FOUND, GO GET SPACE FOR THEM.     @Y30LSRA 41202003
************************************************************** @Y30LSRA 41203003
         LTR   WRKR1,WRKR1         NO VIR DASD OR NO ENTRY     @Y30LSRA 41205003
         BZ    MNTDA08A            NONE, SO SKIP ACQUIRE       @Y30LSRA 41210003
         STC   WRKR1,D7(,WRKR5)    STORE NUM OF ENTRYS         @Y30LSRA 41215003
         MVI   4(WRKR5),X'02'      SET COMMAND CODE FOR MACRO  @ZA18267 41216037
         LR    WRKR3,WRKR2         SAVE CONTENTS OF REG 1      @Y30LSRA 41217003
         MVI   AROP(WRKR5),ACQ     ACQUIRE OPCODE              @ZM44640 41218024
         ICBACREL TYPE=ACQ,MF=(E,(14))                         @Y30LSRA 41220003
         LTR   WRKR6,WRKR6         ANY ERRORS                  @Y30LSRA 41225003
         BNZ   MNTDA02C            YES, GO ABEND THE JOB       @Y30LSRA 41230003
         LR    WRKR2,WRKR3         RESTORE REG 1               @Y30LSRA 41231003
         SR    WRKR1,WRKR1         ZERO OUT NUM OF EXTENTS     @Y30LSRA 41232003
MNTDA08A EQU   *                                               @Y30LSRA 41235003
*                                                              @Y30LSRA 41240003
*********************************************************************** 41300018
*                                                                       41400018
*        CHECK TO SEE IF THERE IS ANOTHER VOLUME SERIAL NUMBER          41500002
*        FOR THIS TABLE ENTRY.                                          41600002
*                                                                       41700018
*********************************************************************** 41800018
*                                                                       41900018
MNTDAZIP EQU   *                   ENTRY IF NO DEB EXTENTS       YM7550 41950002
         LR    WRKR5,TCBR          AVAILABLE UCB'S ADDRESS-4            42000002
         LA    TCBR,4(TCBR)        INCREMENT PTR TO 1ST AVAILABLE UCB   42100002
         LA    DSCNTR,6(DSCNTR)    INCREMENT VOL SER POINTER            42200018
         LA    WRKR6,MNTDA085      ESTABLISH BR ADDRESS          A30003 42210020
         TM    TABDSORG,PS         IS DATA SET P.S.                     42230018
         BCR   1,WRKR6             BR IF YES TO 'MNTDA085'       A30003 42260020
*                                                                       42300018
*   IF THE USER IS PROCESSSING ISAM OR BDAM DATA SETS            YM5512 42350002
*   USING EXCP, TREAT IT THE SAME AS A PS DATA SET               YM5512 42360002
         TM    TABDSORG,DA+IS      IS IT ISAM OR BDAM            YM5512 42370002
         BZ    MNTDA081            NO,CHECK FOR MORE VOLS        YM5512 42380002
         TM    DCBMACRF,EXCHPGM    IS THIS EXCP -IS OR DA        YM5512 42390002
         BCR   1,WRKR6             YES,TREAT AS PS FOR           YM5512 42392002
MNTDA081 EQU   *                   VOL MOUNTING PURPOSES         YM5512 42394002
         CLI   0(DSCNTR),EOVOLSER  IS THERE ANOTHER VOL SER IN TABLE    42400018
         BNE   MNTDA015            BRANCH TO GET NEXT UCB               42500018
         TM    TABFLG2,TABG5V      JFCB EXTENSION TO BE READ IN         42800002
         BCR   8,WRKR6             BR IF NO TO 'MNTDA085'        A30003 42900020
         OC    TABJFCB(3),TABJFCB  TEST IF JFCBX EXISTS                 42910000
         BCR   8,WRKR6             BR IF NO TO 'MNTDA085'               42920000
MNTDA083 EQU   *                                                 A33983 42950020
*                                                                       43000018
         BAL   DCBR,MNTDA130       READ IN JFCB EXTENTSION              43100002
*                                                                       43200018
         MVC   TABJFCB(3),RSJFCB1  TTR OF NEXT JFCB EXTENSION           43300018
         MVI   RSJFCB1+94,EOVOLSER FLAG END OF VOL SER LIST             43400018
*                                                                       43500018
         B     MNTDA015            GO TO MOUNT THIS VOL SER             43600018
*                                                                       43700018
MNTDA085 EQU   *                                                        43800018
*                                                                       43900018
         L     DCBR,RSJFCB+160     SET UP TO CHECK END OF DD ENTRY      44000002
*                                                                       44100018
*********************************************************************** 44200018
*                                                                     * 44300018
*        IF P. O. DATA SET IS CONCATENATED READ IN JFCB, IF NOT       * 44400018
*        GO TO NEXT TABLE ENTRY.                                      * 44500018
*                                                                     * 44600018
*********************************************************************** 44700018
*                                                                       44800018
* IS NEXT DD ENTRY BLANK                                                44900018
*                                                                       45000018
MNTDA090 EQU   *                                                        45100018
         LA    WRKR6,MNTDA095      ESTABLISH BR ADDRESS          A30003 45120020
         CLI   0(DCBR),ZERO        IS THIS END OF TIOT           A30003 45140020
         BCR   8,WRKR6             BR IF YES TO 'MNTDA095'       A30003 45160020
*                                                                       45180020
         CLI   4(DCBR),BLANK       IS DDNAME BLANK                      45200018
         BCR   7,WRKR6             BR IF NEXT ENTRY IS NOT       A30003 45260020
*                                  BLANK TO 'MNTDA095'                  45320020
*                                                                       45600018
*   IF THE USER IS PROCESSING AN ISAM DATA SET                   YM5512 45650002
*   USING EXCP, ONLY ONE VOLUME SHOULD BE MOUNTED                YM5512 45660002
         TM    TABDSORG,PO         IS THIS A PART D.S.           YM5512 45670002
         BO    MNTDA092            YES, GO ON                    YM5512 45680002
         TM    TABDSORG,IS         IS THIS AN ISAM D/S           YM5512 45690002
         BCR   8,WRKR6             BR IF NO TO MNTDA095          YM5512 45692002
         TM    DCBMACRF,EXCHPGM    IS THIS AN EXCP DCB           YM5512 45694002
         BCR   1,WRKR6             BR IF YES TO MNTDA095         YM5512 45696002
*********************************************************************** 45700018
*                                                                       45800018
*                RESET END OF DD ENTRY POINTER                          45900018
*                                                                       46000018
*********************************************************************** 46100018
*                                                                       46200018
MNTDA092 EQU   *                                                 YM5512 46250002
         SR    WRKR6,WRKR6         CLEAR REG                            46300002
         IC    WRKR6,0(DCBR)       LOAD LENGTH OF DD ENTRY              46400002
         AR    WRKR6,DCBR          TRUE CORE POSITION            M0187  46500021
         ST    WRKR6,RSJFCB+160    SAVE END OF DD ENTRY POINTER         46600002
*                                                                       46700018
* READ IN JFCB FOR THIS DD ENTRY                                        46800018
*                                                                       46900018
         LA    WRKR5,12(TCBR)      ADDR-4 OF 1ST UCB OF BLANK DDNAME    47000002
         MVC   TABJFCB(3),12(DCBR) TTR OF JFCB TO TABLE                 47100002
         LA    TCBR,4(WRKR5)       PNT TO BEGIN'G OF UCB'S TO BE CHECK  47200002
         BAL   DCBR,MNTDA130       READ IN JFCB                         47300002
*                                                                       47400018
         MVC   TABJFCB(3),RSJFCB1+JFCBEXAD-JFCBDSNM TTR OF XT TO TABLE  47500002
         MVC   RSJFCB1+4(30),RSJFCB1+JFCBVOLS-JFCBDSNM VOL SER NO       47600002
         MVI   RSJFCB1+34,EOVOLSER FLAG END OF VOL SER LIST             47700018
*                                                                       47800018
*   DETERMINE IF JFCB EXTENSION IS REQUIRED BEFORE               YM5513 47850002
*   ATTEMPTING TO READ IT                                        YM5513 47860002
         NI    TABFLG2,X'FF'-TABG5V TURN OFF JFCB EXT SW         YM7550 47870002
         CLI   RSJFCB1+JFCBNVOL-JFCBDSNM,FIVE                    YM5513 47880002
*                                  IS JFCBNVOL GR THAN 5         YM5513 47890002
         BNH   MNTDA093            NO,JFCB EXT NOT REQRD         YM5513 47892002
         OI    TABFLG2,TABG5V      YES, TURN ON JFCB EXT SW      YM7550 47894002
MNTDA093 EQU   *                                                 YM5513 47898002
         TM    TABDSORG,PO         P.O. CONCAT.                         47900018
         BZ    MNTDA015            BRANCH IF NO                         48000002
         OI    TABFLG2,TABPOCAT    SET P.O. CONCAT. SW                  48100002
         B     MNTDA015            BRANCH TO GET NEXT UCB               48200018
*                                                                       48210020
*********************************************************************** 48220020
*                                                                       48230020
* CLEAR UCB ADDRESS MODIFIED BIT FROM ALL EXTENTS IN DEB                48240020
*                                                                       48250020
*********************************************************************** 48260020
*                                                                       48270020
MNTDA095 EQU   *                                                        48300018
         TM    TABFLG3,X'01'   ANY VOLSER MISMATCHES ??        @ZA31668 48310024
         BZ    MNTDA097        NO, BRANCH                      @ZA31668 48320024
* ABEND JOB VOLSER NOT SAME AT RESTART AS WAS AT CHECKPOINT    @ZA31668 48330024
         MVI   RSRETCOD+1,ERR050   SET ERROR CODE 50           @ZA31668 48340024
         B     MNTDA027            GO TO XCTL                  @ZA31668 48350024
MNTDA097 EQU   *                                               @ZA31668 48360024
         BAL   WRKR3,MNTDA110      SET UP TO SPIN THRU DEB              48400002
         LTR   WRKR6,WRKR6         ANY DEB EXTENTS               YM7550 48450002
         BZ    MNTDA105            IF NOT, SKIP DEB UPDATE       YM7550 48460002
*                                                                       48500018
MNTDA100 EQU   *                                                        48600018
         USING DEBDASD,DCBR        DEB EXTENT ADDRESSABILITY     YM7807 48650002
         NI    DEBENDHH,SWOFF      TURN OFF 'PROCESSED' SWITCH   YM7807 48700002
         LA    DCBR,16(DCBR)       GO TO NEXT XTENT                     48800002
         BCT   WRKR6,MNTDA100      BRANCH IF NOT LAST XTENT             48900002
         DROP  DCBR                                              YM7807 48950002
*                                                                       49000018
MNTDA105 EQU   *                                                        49100018
*                                                                       49200018
         MVC   TABJFCB(3),RSJFCB+164 RESTORE JFCB TTR.                  49250002
MNTDA106 EQU   *                   INSTR MUST FOLLOW             Y02076 49260002
         TM    TABFLG1,TABLAST     HAS THE LAST ENTRY BEEN PROCESSED    49300002
         BO    MNTDA155            YES,BRANCH TO ENDMOD                 49400018
*                                                                       49500018
         LA    WRKR4,TABENT(WRKR4) INCREMENT TO NEXT ENTRY              49600018
         B     MNTDA005            BRANCH TO INITIALIZE PTRS            49700018
*                                                                     * 49800018
*********************************************************************** 49900018
*                                                                     * 50000018
*      SET UP REGISTERS NECESSARY TO SPIN THRU DEB                      50100018
*                                                                     * 50200018
*********************************************************************** 50300018
*                                                                     * 50400018
         USING DEBBASIC,DCBR       DEB                           YM7837 50500002
*                                                                       50600018
MNTDA110 EQU   *                                                        50700018
         SR    WRKR6,WRKR6         CLEAR REG.                           50800002
         LR    WRKR1,TABLR         SAVE REG                      Y02076 50850002
         L     DCBR,DCBDEBAD       PICK UP DEB ADDRESS           YM7837 50900002
         ICM   WRKR6,D1,DEBNMEXT   FETCH/TEST EXTENT COUNT       YM7550 51000002
         BZR   WRKR3               RETURN IF NO EXTENTS          YM7550 51010002
         LA    TABLR,DEBBASND      GET ADR-END BASIC SECT.       Y02076 51050002
         USING DEBDASD,TABLR                                     Y02076 51060002
         LA    DCBR,DEBDVMOD       LOAD ADDRESS OF 1ST XTENT            51100002
         DROP  DCBR,TABLR          DEB AND DEB EXTENT            YM7837 51150002
         LR    TABLR,WRKR1         RESTORE REG                   Y02076 51160002
         TM    TABDSORG,IS         ISAM DATA SET                        51200002
         BCR   8,WRKR3             BRANCH IF NO                         51300002
         LA    DCBR,16(DCBR)       ISAM DATA SET INCREMENT POINTER      51400018
         BCTR  WRKR6,0             ADJUST EXTENT COUNT BY -1     YM7550 51450002
         BR    WRKR3               RETURN                               51500002
*                                                                       51800018
*********************************************************************** 51900018
*                                                                       52000018
*    INCREMENT TO THE NEXT UCB ADDRESS IN THE NEW TIOT AND CHECK TO     52100018
*    SEE IF IT IS THE LAST UCB.                                         52200018
*                                                                       52300018
*********************************************************************** 52400018
*                                                                       52500018
MNTDA115 EQU   *                                                        52600018
         LA    WRKR5,4(WRKR5)      INCREMENT TO NEXT UCB                52700002
         LA    WRKR6,0(TIOTR,WRKR5) CURRENT UCB ADDRESS PLUS 4.         52800002
         L     DCBR,RSJFCB+160     LOAD 'END OF DD ENTRY' POINTER       52900002
         CR    DCBR,WRKR6          END OF DD ENTRY                      53000018
         BCR   13,WRKR2            BR IF YES (EQU OR LOW)        A33983 53100020
MNTDA116 EQU   *                                                        53200018
         L     UCBR,0(TIOTR,WRKR5) GET UCB ADDRESS               YM7359 53250002
         LA    UCBR,0(,UCBR)       CLEAR HI-BYTE                 YM7359 53300002
         XC    RSIOBDAD(8),RSIOBDAD CLEAR MBBCCHHR                      53400002
         ST    UCBR,RSDEBUCB       UNIT ADDRESS TO DEB                  54200018
         MVI   RSDEBBIN+1,ZERO     CLEAR BIN NUMBER FROM DEB IN WK AREA 54300018
         CR    DCBR,WRKR6          RESTORE CONDITION CODE        YM7331 54350002
         BR    WRKR2               RETURN                               55700018
*                                                                       55800018
*********************************************************************** 55900018
*                                                                       56000018
*  COMPLETE QMNGRIO PARM LIST THEN ISSUE QMNGRIO TO READ JFCB         * 56050002
*                                                                       56300018
*********************************************************************** 56400018
*                                                                       56500018
MNTDA130 EQU   *                                                        56600018
*                                                                       56700018
         LA    WRKR1,RSJFCB1       GET JFCB BUFFER ADDRESS       YM7868 56800002
         L     WRKR2,QMNPRMWA      GET ADR OF QMNGR P.L.         Y02076 56850002
         USING QMIOP,WRKR2         ADDRESS QMNGR PARAMETERS      Y02076 56852002
         ST    WRKR1,QMIRECAD      STORE JFCB READ IN ADR        YM7868 56860002
         L     WRKR1,TABNVOLS      LOAD TTR INTO REG. 0                 57600018
         SLL   WRKR1,8             LEFT JUSTIFY TTR                     57700018
         ST    WRKR1,QMIDSKAD      STORE TTR IN PARM LIST        Y02076 57750002
         DROP  WRKR2                                             Y02076 57800002
*                                                                       58500018
         LA    DSCNTR,RSJFCB1+4    SET VOL SER NO POINTER               58600018
         STM   WRKR4,WRKR5,RSERAS02 SAVE REG 13 & 14             YM7359 58650002
         LA    WRKR4,RSREGSAV      GET REG SAVEAREA ADDR         YM7359 58660002
*                                                                       58700018
*  READ IN JFCB                                                         58800018
*                                                                       58900018
         QMNGRIO                   READ IN JFCB                  Y02076 58950002
         LM    WRKR4,WRKR5,RSERAS02 RESTORE REG 13 & 14          YM7359 58960002
         LTR   WRKR6,WRKR6         TEST QMNGRIO RET. CODE        Y02076 59000002
         BNZ   MNTDA140            BR IF JFCB READ ERROR         Y02076 59050002
         BR    DCBR                RETURN IF NO ERROR            Y02076 59060002
*                                                                       59100018
*             EXCP ROUTINE                                            * 59150002
*                                                                     * 59160002
MNTDA135 EQU   *                                                        59200018
         EXCP  RSIOB               EXCP CHANNEL PROGRAM . CHANNEL       59300018
*                                                                       59400018
         WAIT  ,ECB=RSECBAD        WAIT                                 59500002
         TM    RSMWOFST,X'80'      MUST A DOM BE ISSUED             MCS 59510018
         BZ    TESTERR             BRANCH IF NO                     MCS 59520018
         LA    WRKR2,RSMWOFST      LOAD ADDR OF MSGID               MCS 59530018
         DOM   MSGLIST=(1)         ISSUE DOM                        MCS 59540018
         NI    RSMWOFST,X'7F'      TURN OFF DOM INDICATOR           MCS 59550018
TESTERR  EQU   *                                                    MCS 59560018
*                                                                       59600018
         TM    RSECBAD,PERMERR     I/O ERROR                            59700018
         BCR   NOMIX,DCBR          RETURN IF NO ERROR            A27515 59800019
*                                                                     * 60000018
*********************************************************************** 60100018
*                                                                     * 60200018
*                     ERROR RETURN CODES                              * 60300018
*                                                                     * 60400018
*********************************************************************** 60500018
*                                                                     * 60600018
MNTDA140 EQU   *                                                        60700018
         MVI   RSRETCOD+1,ERR048   UNRECOVERABLE I/O ERROR     @ZSUT222 60800024
*                                  RETURN CODE 48                       60900018
         B     MNTDA027            BR TO SET UP FOR XCTL         A30003 61400020
*                                                                       62000018
*********************************************************************** 62100018
*                                                                       62200018
*              TRANSFER TO NEXT MODULE                                  62300018
*                                                                       62400018
*********************************************************************** 62500018
*                                                                       62600018
MNTDA155 EQU   *                                                        62700018
*                                                                       62800018
         TM    RSDCBFLG,NONDAFLG   ANY TAPE DATA SETS                   63000018
         BO    MNTDA160            BRANCH IF YES                        63100002
*                                                                       63200018
         MVI   RSPPM+4,C'N'        XCTL TO IGC0N05B                 MCS 63300018
MNTDA160 EQU   *                                                        63350002
*                                                                YM7890 63450002
*        AT THIS POINT, WITH ALL MOUNT REQUESTS SATISFIED, THE   YM7890 63460002
*        MEMORY CAN AGAIN BE ENABLED FOR SWAP-OUT.               YM7890 63470002
*                                                                YM7890 63480002
         SYSEVENT OKSWAP           ENABLE SWAP-OUT               YM7890 63490002
*                                                                YM7890 63492002
         ICM   WRKR1,ADDRBYTS,QMNPRMLN LENGTH OF PRM LIST + WA   Y02076 63550002
         ICM   WRKR1,HIORDER,SP253 SUBPOOL 253                   Y02076 63560002
         L     WRKR2,QMNPRMWA      GET ADR OF PARM LIST          Y02076 63570002
         FREEMAIN  R,LV=(0),A=(1)  ISSUE FREEMAIN                Y02076 63580002
         LA    WRKR6,RSPPM+8                                        MCS 63600018
         XC    RSERAS00(D40),RSERAS00 CLEAR SCRATCH SPACE        Y02076 63650002
*******************   **************   ***********   *********   ****   63700018
         LR    WRKR2,BUFR          POINT REG. 1 TO THE RESTART W/A      63800002
         LR    CTABLR,TABLR        PASS TBL ADR TO NXT LOAD      Y02049 63810002
         LR    WRKR3,BUFR          POINT REG 12 TO RS W/A        Y02049 63850002
*******************   **************   ***********   *********   ****   63900018
*                                                                       64000018
         XCTL  EPLOC=RSPPM,SF=(E,(15))                              MCS 64100018
*                                                                       64200018
         EJECT                                                          64250002
*********************************************************************** 64300018
*                                                                       64400018
*     CONSTANTS USED IN REPI/O                                          64500018
*                                                                       64600018
*********************************************************************** 64700018
*                                                                       64800018
MOUNTMS  DC    X'00188000'         LENGTH OF MESSAGE                MCS 64900018
         DC    C'IEC403A M YYY,'   MOUNT MESSAGE                        65000018
RTDESC   DC    X'14004000'         ROUTE AND DESCRIPTOR CODES       MCS 65050018
CHAIN5   DC    X'40000005'         1ST CCW FLAG AND COUNT FIELDS M4597  65070019
QMNPRMLN DC    AL3(280)                 QMNGRIO PARM LST + WA    Y02076 65080002
SP253    DC    AL1(253)                 SUBPOOL 253              Y02076 65090002
F1       DC    F'1'                     FULLWORD CONSTANT OF 1   YM7868 65090402
         DS    0F                  FULL WORD ALIGNMENT         @Y30LSRA 65091003
SCRTCH   DC    CL6'SCRTCH'         SCRATCH PACK COMPARATOR     @Y30LSRA 65091403
KMNT     DC    CL11'  MOUNT '      MOUNT                       @Y30SLRS 65091503
KDMNT    DC    CL11' DEMOUNT '     DEMOUNT                     @Y30LSRA 65091603
KACQ     DC    CL11' ACQUIRE '          ACQUIRE                @Y30LSRA 65100703
ZEROS    DC    XL6'000000000000'   NOT MOUNTED COMPARATOR      @Y30LSRA 65110003
BLANKS   DC    XL6'404040404040'   NOT MOUNTED COMPARATOR      @Y30LSRA 65119003
BUNCHFFS DC    X'FFFFFFFF'         INVALID EXT COMPARATOR      @Y30LSRA 65121003
ONEMOR   DC    H'1'                ONE                         @Y30LSRA 65128003
SIXTEEN  DC    H'16'               MAX NUMB OF EXTENTS         @Y30LSRA 65137003
ABTABLE  EQU   *-240                    BEGIN TR TABLE         @Y30LSRA 65143703
         DC    C'0123456789ABCDEF'      TRANSLATE TABLE        @Y30LSRA 65145703
MSSMSG   WTO   'IEC466I JOBNAMED,VOLSER,DDD MSS FAILURE DURING RELINQUIX65145803
               SH CODE=NNN',DESC=4,ROUTCDE=(2,11),MF=L                  65165403
MSGLENTH EQU   *                                               @Y30LSRA 65174803
ADDRBYTS EQU   7                        GETMAIN/FREEMAIN PARMS   Y02076 65184203
HIORDER  EQU   8                        HIGH ORDER BYTE          Y02076 65193603
QMWRKOFT EQU   24                       WORK AREA OFFSET         Y02076 65203003
JFCBLNGH EQU   176                      JFCB LENGTH              Y02076 65212403
MODID    DC    CL8'IGC0M05B'            MODULE IDENT.          @ZSUT222 65216424
*                                                                       65221803
*                                                                     * 65231203
*        MAINTENANCE SPACE                                       Y01909 65240603
*                                                                     * 65250000
PATCH    DC    XL((*-IGC0M05B)/20)'00'   FIVE PERCENT SPACE      Y01909 65300000
*                                                                     * 65350000
         EJECT                                                          65360002
         IEFQMIOP                                                Y02076 65400002
         EJECT                                                          65410002
         IEFJESCT                                                Y02076 65450002
         EJECT                                                          65500018
MNTTIOT  DSECT                                                          65600018
         IEFTIOT1                                                       65700018
         EJECT                                                          65800018
         IEFUCBOB                                                       66000018
         EJECT                                                          66100018
         IHJDSTAB                                                Y02076 66150002
         EJECT                                                          70200018
RSDSECT  DSECT                                                          70300018
*                                                                       70400018
*    DATA EXTENT BLOCK                                                  70500018
*                                                                       70600018
RSDEB    DS    0CL48                                                    70700018
RSDEBTCB DC    X'00000000'              TCB ADDRESS                     70800018
RSDEBDEB DC    X'00000000'              DEB ADDRESS                     70900018
*                                                                       71000018
*    DATA CONTROL BLOCK                                                 71100018
*                                                                       71200018
RSDEBOFL DS    0CL1                                                     71300018
RSDEBIRB DC    X'00000000'              IRB ADDRESS                     71400018
RSDEBSYS DC    X'00000000'              1ST IOB ADDR IN SYS.PURGE CHAIN 71500018
RSDEBUSR DC    X'00000000'              1ST IOB ADDR IN USER PRGE CHAIN 71600018
RSDEBECB DC    X'00000000'              PARM.LIST ADDR TO PURGE ECB     71700018
RSDEBID  DS    0CL1                                                     71800018
RSDEBDCB DC    AL4(RSDCBREP)            DCB ADDR                        71900018
RSDEBAPP DS    CL4                      I/O APPENDAGE VECTOR TABLE      72000018
RSDEBMOD DS    0CL1                                                     72100018
RSDEBUCB DS    F                        UCB ADDRESS                     72200018
RSDEBBIN DS    H                        BIN NUMBER                      72300018
RSDEBSCC DS    H                        CYLINDER START ADDRESS          72400018
RSDEBSHH DS    H                        TRACK START ADDRESS             72500018
RSDEBECC DS    H                        CYLINDER END ADDRESS            72600018
RSDEBEHH DS    H                        TRACK END ADDRESS               72700018
RSDEBNTR DS    H                        NO. OF TRACKS IN THIS EXTENT    72800018
*                                                                       72900018
*    EVENT CONTROL BLOCK                                                73000018
*                                                                       73100018
RSECBAD  DS    CL4                      ECB ADDRESS                     73200018
RSDCBDEB DC    AL4(RSDEB)               DEB ADDRESS                     73300018
*                                                                       73400018
RSDCBREP EQU   RSDEB+8                  POINT TO RELATIVE BEGINNING DCB 73500018
*                                                                       73600018
*    INPUT OUTPUT BLOCK                                                 73700018
*                                                                       73800018
RSIOB    DS    0CL40                                                    73900018
RSIOBFG1 DC    X'00'                    I/O FLAGS BYTE 1                74000018
RSIOBFG2 DC    X'00'                    I/O FLAGS BYTE 2                74100018
RSIOBSN1 DS    CL1                      FIRST SENSE BYTE                74200018
RSIOBSN2 DS    CL1                      SECOND SENSE BYTE               74300018
RSIOBECB DC    AL4(RSECBAD)             ECB ADDRESS                     74400018
RSIOBCSW DS    D                        LAST CSW                        74500018
RSIOBCPA DS    AL4(RSCCW1)              CHANNEL PROGRAM ADDRESS         74600018
RSIOBDCB DS    AL4(RSDCBREP)            DCB ADDRESS                     74700018
RSIOBRCP DS    CL4                      RESTART ADDRESS FOR IOS         74800018
RSIOBINC DS    H                        INCREMENT BLOCK COUNT           74900018
RSIOBECT DS    H                        NO. OF ERROR ENTRIES            75000018
RSIOBDAD DS    D                        SEEK ADDRESS FOR DA             75100018
*                                                                       75200018
*    CHANNEL PROGRAM                                                    75300018
*                                                                       75400018
RSCCWLST DS    0CL24                                                    75500018
RSCCW1   DS    D                        CCW1                            75600018
RSCCW2   DS    D                        CCW2                            75700018
RSCCW3   DS    D                        CCW3                            75800018
*                                                                       75900018
*    BUFFER SEGMENT FOR EXTERNAL BLOCKS                                 76000018
*                                                                       76100018
RSBUFSEG DS    0CL176                                                   76200018
RSJFCB   EQU   RSBUFSEG                                                 76300018
*                                                                       76400018
*********************************************************************** 76430018
*                                                                       76460018
*                  JFCB                                                 76500018
*                                                                       76530018
*********************************************************************** 76560018
*                                                                       76600018
         IEFJFCBN                                                Y02076 76650002
         EJECT                                                          87300018
CVT      DSECT                                                          87400018
         CVT                                                            87500018
         EJECT                                                          87600018
*                                                                       87700018
*                                                                       87800018
*   TASK CONTROL BLOCK                                                  87900018
*                                                                       88000018
*                                                                       88100018
         CNOP  0,4                                                      88200018
MNTTCB   DSECT                                                          88300018
TCBRBP   DS    F                       POINTER TO EXECUTING RB          88400018
TCBPIE   DS    F                       POINTER TO PROG. INTERRUPT EL.   88500018
TCBDEB   DS    F                       POINTER TO DEB QUEUE             88600018
TCBTIO   DS    F                       POINTER TO TIOT                  88700018
TCBCMP   DS    F                       TASK COMPLETION CODE             88800018
TCBTRN   DS    F                       TESTRAN FIELD                    88900018
TCBMSS   DS    F                       DATA BLOCK QUEUE ELEMENT POINTER 89000018
TCBPRTK  DS    CL1                     PROTECTION TAG                   89100018
TCBFLGS  DS    FL5                     FLAG BYTES                       89200018
TCBLMP   DS    CL1                     LIMIT PRIORITY                   89300018
TCBDSP   DS    CL1                     DISPATCHING PRIORITY             89400018
TCBLLS   DS    F                       POINTER TO LOAD LIST             89500018
TCBJLB   DS    F                       POINTER TO JOBLIB DCB            89600018
TCBJSE   DS    F                       LIST OF INACTIVE PROGRAMS ADDR.  89700018
TCBGRS   DS    CL64                    GENERAL REGISTER SAVE AREA       89800018
TCBIDF   DS    CL1                     TCB IDENTIFIER FIELD             89900018
TCBFSA   DS    CL3                     POINTER TO 1ST PROB.PROG.SAVEAR  90000018
TCBTCB   DS    F                       NEXT TCB ON READY QUEUE POINTER  90100018
TCBTME   DS    F                       POINTER TO TIMER ELEMENT         90200018
         EJECT                                                          90300018
         DCBD  DSORG=PS                                                 90400018
         EJECT                                                          90500018
*                                                                       90600018
*                                                                       90700018
*   DATA EXTENT BLOCK                                                   90800002
*                                                                       90900018
         IEZDEB                                                  Y02076 90950002
*                                                                       91000018
         EJECT                                                          94500018
         IEEVRSWA   VER=3     AOS2 VERSION OF WA                        94600000
*                                                                       94700018
*    THE MESSAGE AREA USED TO WRITE-TO-OPERATOR IS IN THE WORKAREA      94800018
*    THE FOLLOWING EQUATES DEFINE THE MESSAGE AREA.                     94900018
*                                                                       95000018
*                   IGGXXXXX M YYY,XXXXXX                             * 95100018
*                                                                       95200018
MSGLN    EQU   RSJFCB+90      MESSAGE LENGTH                            95300018
MSGAREA  EQU   RSJFCB+94      MESSAGE NUMBER                            95400018
MSGUCB   EQU   RSJFCB+108     UNIT                                      95500018
MSGID    EQU   RSJFCB+112     VOLUME SERIAL                             95600018
*                                                                       95700018
RSJFCB1  EQU   RSJFCB+304                                               95800018
QMNPRMWA EQU   RSERAS00                 LOC FOR SAVE OF QMNG PL  Y02076 97550002
RSSTAT1  EQU   RSERAS01                 SAVE LOCATION            Y02076 97560002
*                                                                       97600018
*                                                                       97700018
*                                                                       97800018
         END                                                            97900018
./  ADD  SSI=82070509,NAME=IGC0N05B
         TITLE 'IGC0N05B SYSIN/SYSOUT AND D.A. POSITIONING MODULE 1'    00080008
IGC0N05B CSECT                                                          00180008
*                                                                       00280008
*                                                                       00380008
*********************************************************************** 00480008
*                                                                       00580008
*TITLE-  SYSIN/SYSOUT AND DIRECT ACCESS DATA SET POSITIONING MODULE 1   00680008
*                                                                       00780008
*FUNCTION    1.READS VSAM SSCRS FROM THE RESTART DATA SET IF THERE      00880008
*              ARE ANY, CHAINS THEM TOGETHER, LOADS THE VSAM            00980008
*              PROCESSING MODULE(IDA0C05B), TRANSFERS CONTROL T0        01080008
*              THE MODULE, AND THEN DELETES IT.                         01180008
*            2.READS SUBSYSTEM SSCR RECORDS FROM THE RESTART DATA SET   01280008
*              IF THERE ARE ANY, CALLING THE SUBSYSTEM ROUTINE FOR EACH 01380008
*              ONE VIA THE IEFSSREQ MACRO. COUNTS AND BUILDS A TABLE OF 01480008
*            3.COUNTS AND BUILDS A TABLE OF UCB ADDRESSES FOR DIRECT    01580008
*              ACCESS DATA SETS.                                        01680008
*            4.FOR EACH DIRECT ACCESS ENTRY IN THE FORTY EIGHT BYTE     01780008
*              TABLE,THE JFCB IS READ,THE UCB TABLE INDICATES WHETHER   01880008
*              PASSWORD CHECKING HAS BEEN DONE,IF NOT,THE DATA SET      03298802
*              DSCB IS READ TO DETERMINE IF A PASSWORD CHECK IS         03299202
*              TO BE MADE. WHEN A PASSWORD CHECK IS MADE, SECLOADA      03299608
*              IS CALLED TO REQUEST THE PASSWORD FROM THE OPERATOR      03299702
*              BEFORE PROCESSING IS ALLOWED TO CONTINUE.                03299802
*              RAC DEFINED DATA SETS ARE AUTHORIZATION         @Z40RSGD 03300008
*              CHECKED AND IF THE USER IS AUTHORIZED           @Z40RSGD 03400008
*              PASSWORD CHECKING IS BYPASSED, OTHERWISE        @Z40RSGD 03404008
*              IGCMSG6C IS CALLED TO PROVIDE A MESSAGE.        @Z40RSGD 03408008
*              RACHECKS ARE BYPASSED IF JSCBPASS IS SET.       @G32DSPD 03448032
*ENTRY POINTS-                                                          03500018
*               IGC0N05B - CAN BE ENTERED VIA XCTL FROM IGC0M05B OR     03600018
*                          IGC0L05B.                                    03700018
*                                                                       03800018
*                                                                       03900018
*INPUT.        REGISTER 8 - BEGINNING OF DATA SET TABLE                 04000018
*              REGISTER 1 - RESTART WORKAREA                            04100018
*              REGISTER 10 - RESTART WORKAREA                           04150002
*                                                                       04200018
*                                                                       04300018
*                                                                       04400018
*OUTPUT-                                                                04500018
*           NOT APPLICABLE                                              04600018
*                                                                       04700018
*EXTERNAL ROUTINES                                                      04800018
*              SECLOADA - FOR PASSWORD CHECK                     YM7337 04850002
*              IGC0Q05B - FOR CHKPT D.S. SECURITY CHECK          YM7337 04860002
*              IDA0C05B - FOR VSAM SSCR PROCESSING             @Z30SSDT 04910008
*                                                                       05000018
*EXITS                                                                  05100018
*              (1) IGC0R05B - DA PROCESSING                             05300002
*              (2) IGC0V05B WITH ONE OF THE FOLLOWING ERROR CODES       05450032
*                  SET IN THE RESTART WORK AREA:                        05454032
*                  39 - I/O ERROR READING CHECKPOINT DATA SET           05458032
*                  73 - I/O ERROR READING JFCB OR DSCB                  05462032
*                 207 - TABLE ENTRY FOR SUBSYS. DATASET NOT FOUND       05466032
*                 208 - NONZERO R/C FROM JES PROCESSING ROUTINE         05470032
*                 220 - DSCB ADDRESS CHANGED SINCE CHECKPOINT           05474032
*                 221 - PASSWORD ERROR                                  05478032
*                 236 - UNEXPECTED RECORD TYPE FROM CHECKPOINT D/S      05482032
*                 254 - RAC ERROR                                       05486032
*                                                                       05500008
* OS/VSA RELEASE 030 ADDS/DELETIONS/CHANGES                             05560008
*A191666-191696                                                @ZA08277 05620008
*                                                                       05680008
* OS/VS2 RELEASE 037 ADDS/DELETIONS/CHANGES                             05740008
*D191666-191696                                                @ZA12948 05800008
* APAR OZ31489 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 05804032
*C131840,136659,137748,137910,181166,575000,599061             @ZSUT222 05808032
*C599375,599385,599453,604901                                  @ZSUT222 05810032
*A136879,596105-596115,616200                                  @ZSUT222 05814032
* CHANGES ADDITIONS DELETIONS FOR SU 8                                  05820008
*A489509                                                       @ZA29067 05840008
*                                                                       05860008
* OS/VS2 SU 32 ADDS/DELETIONS/CHANGES                          @G32DSPD 05880032
*D604564,A604206-604230,A604793,A885000-910000                 @G32DSPD 05900032
*                                                                       05920008
*TABLES/WORKAREAS - SEE BELOW AND DSECT AT END                          05980008
*********************************************************************** 06040008
         EJECT                                                          06100008
*                                                                       06200018
*********************************************************************** 06300018
*                                                                     * 06400018
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 06500018
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 06600018
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 06700018
*    IS 48 BYTES LONG.                                                * 06800018
*                                                                     * 06900018
*********************************************************************** 07000018
*                                                                       07100018
*        ------------------- 4 BYTES -----------------                  07200018
*                                                                       07300018
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  07400018
*        +DATA SET  +           DCB                  +                  07500018
*        + ORGN.    +         ADDRESS                +                  07600018
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                07700018
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  07800018
*        + NO. 1    +         ADDRESS                +                  07900018
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  08000018
*        +NUMBER    +         JFCB TTR               +                  08100018
*        + OF VOLS  +         ADDRESS                +                  08200018
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               08300018
*                                                                       08400018
*     12 +++++++++++++++++++++++                                        08500018
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   08600018
*        +INFO BYTE + NUMBER   +                                        08700018
*        +++++++++++++++++++++++                                        08800018
*                                                                       08900018
*     12 +++++++++++++++++++++++                                        09000018
*        +    OLD   TIOT       +        DA AND UNIT RECORD              09100018
*        +      OFFSET         +                                        09200018
*        +++++++++++++++++++++++                                        09300018
*                                                                       09400018
*                              +++++++++++++++++++++++                  09500018
*                              +FLAG BYTE +FLAG BYTE +                  09600018
*                              +  NO. 2   +  NO. 3   +                  09700018
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  09800018
*        +FLAG BYTE +FLAG BYTE +                     +                  09900018
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  10000018
*        +++++++++++++++++++++++                     + 20               10100018
*        +                                           +                  10200018
*        +                                           +                  10300018
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  10400018
*        +                                           +                  10500018
*        +   VOLUME ID NO. 2                         +                  10600018
*        +                     +++++++++++++++++++++++ 28               10700018
*        +                     +                     +                  10800018
*        +                     +   VOLUME ID NO. 3   +                  10900018
*     32 +++++++++++++++++++++++                     +                  11000018
*        +                                           +                  11100018
*        +                                           +                  11200018
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               11300018
*        +                                           +                  11400018
*        +   VOLUME ID NO. 4                         +                  11500018
*     40 +                     +++++++++++++++++++++++                  11600018
*        +                     +                     +                  11700018
*        +                     +                     +                  11800018
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               11900018
*        +                                           +                  12000018
*        +                                           +                  12100018
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               12200018
*                                                                       12300018
*                                                                       12400018
         EJECT                                                          12450008
*                                                                       12500018
*********      ***************     **********     **********     ****** 12600018
*                                                                     * 12700018
*              OFFSETS TO BE USED IN REP I/O PHASE                    * 12800018
*                                                                     * 12900018
*********      ***************     **********     **********     ****** 13000018
*                                                                     * 13100018
IS       EQU   X'80'                    INDEXED SEQUENCIAL              13102018
SAVWK4R  EQU   48                                                       13103018
PS       EQU   X'40'                    PHYSICAL SEQUENCIAL             13104018
DA       EQU   X'20'                    DIRECT ACCESS                   13106018
PO       EQU   X'02'                    PARTITIONED ORGANIZATION        13108018
NULL     EQU   X'80'                    NULLFILE OR SYSCHECK            13110018
INOROUT  EQU   X'40'                    SYSIN OR SYSOUT DATA SET        13112018
DADEV    EQU   X'20'                    DA DEVICE                       13114018
TPDEV    EQU   X'10'                    TAPE DEVICE                     13116018
LASTENT  EQU   X'08'                    LAST ENTRY                      13118018
UNITREC  EQU   X'04'                    UNIT RECORD EQUIPMENT           13120018
ERRINNSL EQU   X'80'                    ERROR IN NSL ROUTINE            13122018
NSLMTSW  EQU   X'40'                    NSL MOUNT SWITCH                13124018
NSLCOMU  EQU   X'20'                    NSL COMMUNICATION BIT           13126018
BYPASS   EQU   X'10'                    BYPASS LABEL PROCESSING         13128018
NSL      EQU   X'04'                    NON-STANDARD LABEL              13130018
SL       EQU   X'02'                    STANDARD LABEL                  13132018
NL       EQU   X'01'                    NO LABEL                        13134018
GTR5VOL  EQU   X'80'                    GREATER THAN 5 VOLUMES          13136018
POCONCAT EQU   X'40'                    P.O. CONCATENATED               13138018
DAFLAG   EQU   X'80'                    DA DATA SET FLAG                13140018
NONDAFLG EQU   X'40'                    NON-DA DATA SET FLAG            13142018
NSLFLAG  EQU   X'10'                    NSL ROUTINE FLAG                13144018
TYPERST  EQU   X'80'                    IMMEDIATE RESTART               13146018
TABENT   EQU   48                       TABLE ENTRY LENGTH              13148018
WRITE    EQU   X'01'                    WRITE ON TAPE                   13150018
READ     EQU   X'02'                    READ FOR TAPE                   13152018
NOPOP    EQU   X'03'                    NOP                             13154018
SENSE    EQU   X'04'                    SENSE                           13156018
REWIND   EQU   X'07'                    REWIND                          13158018
READBACK EQU   X'0C'                    READBACK                        13160018
UNLOAD   EQU   X'0F'                    REWIND AND UNLOAD               13162018
WTM      EQU   X'1F'                    WRITE TAPE MARK                 13164018
BSFOP    EQU   X'2F'                    BACKWARD SPACE FILE             13166018
FSFOP    EQU   X'3F'                    FORWARD SPACE FILE              13168018
SEARCH   EQU   X'31'                    SEARCH                          13170018
SRCHCNT  EQU   X'05'                    COUNT FOR SEARCH ID             13172018
TIC      EQU   X'08'                    TIC                             13174018
READDA   EQU   X'06'                    READ FOR DA                     13176018
LENJFCB  EQU   X'B0'                    LENGTH OF JFCB                  13178018
LBLLEN   EQU   X'50'                    LENGTH OF LABEL                 13180018
PERMERR  EQU   X'7F'                    PERMANENT ERROR                 13182018
ERR073   EQU   73                       ERROR READING DSCB     @ZSUT222 13184032
CHAIN    EQU   X'40'                    CHAINING FLAG                   13330018
EXCHPGM  EQU   X'80'                    EXCP                            13360018
OUTP     EQU   X'04'                    OUT OR OUTIN (DEBOPATB)  A27241 13390002
PCI      EQU   X'20'                    CHAIN SCHEDULING                13420018
ZEROM    EQU   X'00'                    CONSTANT ZERO FOR M OF DA ADDR. 13450018
WRITEDA  EQU   X'05'                    WRITE FOR DA                    13480018
READKND  EQU   X'0E'                    READ KEY AND DATA               13510018
LENGTH   EQU   X'8C'                    LENGTH OF KEY AND DATA          13540018
SUBIDLN  EQU   19                       LN-1 OF SUB RTN ID IN DEB       13550018
LNGBFID  EQU   87                       LN-1 OF DEB PREFIX+BASIC+SUBRTN 13560018
*                                            ID SECTIONS                13570018
TAPEPOS  EQU   C'P'                     TAPE POS                 Y02076 13580002
NAMERS   EQU   C'V'                     RESTART MOD                     13590018
SP253    EQU   253                      SUB POOL NUMBER          Y02076 13592002
UCBSIZE  EQU   4                        SIZE OF A UCB ENTRY      Y02049 13594002
ZEROBYTE EQU   0                        HIGH ORDER BYTE MASK     Y02076 13596002
PASSCHK  EQU   X'FF'                    PASSWORD CHK DONE IND    Y02049 13598002
PASSWCHK EQU   X'10'                    PASSWORD CHK MASK        Y02049 13598402
WRITECHK EQU   X'04'                    WRITE ONLY MASK          Y02049 13598802
INONLY   EQU   X'0F'                    INPUT ONLY (REVERSE TEST)Y02049 13599202
ISAMDEB  EQU   X'80'                    ISAM ACCESS METHOD FLG   Y02049 13599602
BDAMDEB  EQU   X'40'                    BDAM ACCESSMETHOD ID     YM7523 13612102
ISAMSEC  EQU   16                       ISAM DEP SECT OFFSET     Y02049 13624802
EXTLNGTH EQU   16                       EXTENT LENGTH            Y02049 13637302
ECBBGADR EQU   32                       ECB ADR OFFSET           Y02049 13649802
DCBBGADR EQU   4                        DCB ADR OFFSET           Y02049 13659802
CCW      EQU   96                       CCW OFFSET               Y02049 13661802
ERR220   EQU   220                      LABEL ADR CHANGED        Y02049 13664202
ERR221   EQU   221                      WRONG PASSWORD GIVEN     Y02049 13665802
ERR236   EQU   236                      ERROR CODE FOR UN-     @ZSUT222 13665932
*                                       EXPECTED RECORD READ FROMYM6509 13666032
*                                       CHECKPOINT DATA SET      YM6509 13666432
PASSCKID EQU   X'01'                    ENTRY FROM PASSWORD CHK  Y02049 13666532
ENDTAB   EQU   X'08'                    END OF DATA SET TABLE    Y02049 13666602
TABENTL  EQU   48                       DATA SET TAB ENTRY LENGTHY02049 13677702
ERR207   EQU   207                      SUBSYSTEM FAILURE ERR CD Y02076 13687702
ERR208   EQU   208                      SUBSYSTEM FAILURE ERR. @ZSUT222 13687932
DUMMYDS  EQU   X'80'                    DUMMY DATA SET FLAG MASK Y02076 13688102
DEBBGOFF EQU   48                       OFFSET FROM PREFIX TO UCBY02049 13688502
ECRMASK  EQU   X'FF'                    END CHK PT DATA SET ID   Y02076 13694502
SUBSYSIF EQU   X'00'                    SUBSYSTEM SSCR IDENT     Y02076 13694602
HIORDER  EQU   8                        HIGH ORDER BYTE MASK     Y02076 13736202
ADRBYTES EQU   7                        LOW ORDER 3 BYTES MASK   Y02076 13736602
DE       EQU   14                       HI THREE BYTES           Y02049 13738702
D0       EQU   0                        CONSTANT ZERO            Y02076 13741202
D1       EQU   1                        CONSTANT ONE             Y02076 13743302
D2       EQU   2                        CONSTANT TWO             Y02049 13745402
D3       EQU   3                        CONSTANT THREE           Y02076 13747502
D4       EQU   4                        CONSTANT FOUR            Y02076 13749602
D5       EQU   5                        CONSTANT FIVE            Y02076 13751702
D6       EQU   6                        CONSTANT SIX             Y02076 13753802
D7       EQU   7                        CONSTANT SEVEN           Y02076 13755902
D8       EQU   8                        CONSTANT EIGHT           Y02076 13758002
D9       EQU   9                        CONSTANT NINE            Y02076 13760102
D12      EQU   12                       CONSTANT 12              Y02049 13762102
D24      EQU   24                       CONSTANT TWENTY FOUR     Y02049 13762202
D40      EQU   40                       CONSTANT FORTY           Y02076 13764302
D44      EQU   44                       CONSTANT FORTY FOUR      Y02049 13766402
D68      EQU   68                       CONSTANT SIXTY EIGHT     Y02049 13768502
D164     EQU   164                      CONSTANT 164             Y02049 13770602
D128     EQU   128                      CONSTANT ONE TWENTY EIGHTY02049 13772702
ERR039   EQU   39                       ERROR READING SSCRS    @ZSUT222 13774832
JFCBDSN  EQU   16                       OFST JFCB DSN FR SWA RCD YM7523 13776802
DSCBCKDS EQU   X'01'                    FMT1 CHKPT D/S INDR      YM7337 13782602
LNRIDEN  EQU   2                        SHIFT CONSTANT FOR     @Z40RSGD 13786608
*                                       LENGTH RID ENTRY       @Z40RSGD 13787408
DS1RACDF EQU   X'40'                    DS1DSIND-RAC DEFINED   @Z40RSGD 13788208
SP230    EQU   230                      SUBPOOL RID TABLE      @Z40RSGD 13788308
KEY5     EQU   X'50'                    KEY RIDTABLE           @Z40RSGD 13790208
ERR254   EQU   254                      RAC ERROR              @ZSUT222 13791032
*                                                                     * 13792308
*********      ***************     **********     **********     ****** 13794202
*                                                                       13800018
*                                                                       13900018
         EJECT                                                          14000008
*                                                                       14100018
         USING DEBBASIC,DEBR            DEB                      Y02076 14450002
         USING IHADCB,DCBR              DCB                             14800002
*                                                                       15100018
*********************************************************************** 15200018
*                                                                       15300018
*   REGISTER CONVENTION TO BE USED                                      15400018
*                                                                       15500018
*********************************************************************** 15600018
*                                                                       15700018
WRKR1    EQU   0                        WORK/PARM                       15800002
R0       EQU   0                        REG 0                    YM7543 15850002
WRKR2    EQU   1                        WORK/PARM                       15900002
R1       EQU   1                        REG 1                    YM7543 15950002
DCBR     EQU   2                        CURRENT DCB REGISTER            16000002
R2       EQU   2                        REG 2                    YM7543 16050002
BASER    EQU   3                        BASE REGISTER                   16100002
DEBR     EQU   4                        CURRENT DEB REGISTER            16200002
R4       EQU   4                        REG 4                    YM7543 16250002
UCBR     EQU   5                        CURRENT UCB REGISTER            16300002
R5       EQU   5                        REG 5                    YM7543 16350002
TIOTR    EQU   6                        NEW TIOT REGISTER               16400002
R6       EQU   6                        WORK REG                 YM7523 16450002
TCBR     EQU   7                        TCB REGISTER                    16500002
RETNREG  EQU   7                        VSAM READ RETURN REG     Y02076 16550002
R7       EQU   7                        WORK REG                 YM7523 16560002
TABLR    EQU   8                        START OF DCB TABL REG.          16600002
R8       EQU   8                        WORK REG                 YM7523 16650002
CTABLR   EQU   9                        CURRENT DCB IN TABL REG.        16700002
BUFR     EQU   10                       USER BUFFER AREA                16800002
RA       EQU   10                       REG 10                   YM7543 16850002
DSCNTR   EQU   11                       NUMBER OF DATA SETS             16900002
BUFADR   EQU   11                       VSAM BUFFER ADR REG      Y02076 16950002
RB       EQU   11                       WORK REG                 YM7523 16960002
WRKR3    EQU   12                       WORK REGISTER                   17000002
WRKR4    EQU   13                       WORK REGISTER                   17100002
RD       EQU   13                       REG 13                   YM7543 17150002
WRKR5    EQU   14                       WORK/PARM REGISTER              17200002
RE       EQU   14                       REG 14                   YM7543 17250002
WRKR6    EQU   15                       WORK/PARM REGISTER              17300002
RF       EQU   15                       REG 15                   YM7543 17350002
*                                                                       17400018
*********************************************************************** 17500018
*                                                                       17600018
*                                                                       17700018
*                                                                       17800018
         EJECT                                                          17850008
         BALR  BASER,0                  SET UP BASE REGISTER            17900002
         USING *,BASER                                                  18000018
         B     BEGIN                    BR AROUND EYE CATCHER    Y01909 18050002
         CNOP  0,8                      ALIGN TO DBL WORD BNDRY  Y01909 18060002
         DC    CL8'IGC0N05B'            MODULE NAME            @ZSUT222 18070032
         DC    CL8'&SYSDATE'            LAST DATE SHIPPED      @ZSUT222 18070432
         DC    CL8'@ZSUT222'            LAST CODE SHIPPED      @ZSUT222 18070832
         DC    CL8'@SU83200'            SELECTABLE UNIT ID     @ZSUT222 18071232
*********************************************************************** 18072002
*              TEST FOR ENTRY FROM PASSWORD PROCESSING                * 18074002
*********************************************************************** 18076002
BEGIN    EQU   *                                                 Y01909 18080000
         MODESET EXTKEY=ZERO                                     Y02049 18080402
         USING TABL,CTABLR                                       Y02049 18082402
         TM    TABFLG2,TABSW            SECLOADA RETURN          Y02049 18084002
         BNZ   PASSWORD                 YES  PROCESS RESULTS     YM7523 18086002
         USING RSTWA,BUFR               RESTART WORK AREA        Y02049 18086302
         ST    TABLR,REG8SAVE           SAVE REG 8               Y02049 18087802
*********************************************************************** 18088402
*               ROUTINE TO HANDLE THE PROCESSING OF VSAM SSCR         * 18088702
*               RECORDS.                                              * 18089002
*********************************************************************** 18089302
VSAMCR00 EQU   *                        INSTR MUST FOLLOW        Y02076 18089602
         L     WRKR3,SSCRSIZE                                    Y02076 18089902
         STH   WRKR3,RSLNGTH1           SET BUFFER LENGTH TO 4K  Y02076 18090202
         LR    WRKR3,BUFR               BASE ADR                 Y02076 18090502
         A     WRKR3,RSBFOFST           1ST BUFFER ADR           Y02076 18090802
         ST    WRKR3,RSBUFADC           STORE ADR OF BUFFER      Y02076 18092602
         ST    WRKR3,SSCRCMPA           SAV WRK BUF ADR FOR CMP ZA00600 18093502
         XC    RSSSCR(D4),RSSSCR        ZERO ANCHOR FIELD        Y02076 18095902
*********************************************************************** 18096802
*               SET SYNAD ADDRESS IN RESTART DCB                      * 18097702
*********************************************************************** 18098602
         LA    WRKR3,RSBDCB             RS DCB ADR               Y02076 18099502
         USING IHADCB,WRKR3                                      Y02076 18100402
         LA    WRKR6,RPM127             SYSNAD ROUTINE ADDRESS   Y02076 18101302
         STCM  WRKR6,ADRBYTES,DCBSYNAD+D1   STORE IN RS DCB      Y02076 18102202
         DROP  WRKR3                                             Y02076 18103102
*********************************************************************** 18104002
*               READ IN VSAM SSCR RECORD (0R SUB SYS SSCR)            * 18104902
*********************************************************************** 18105802
         L     BUFADR,RSBUFADC          BUFFER ADDRESS           Y02076 18106702
         CLC   0(2,BUFADR),SPIEREC      TEST FOR SPIE REC        Y02049 18107602
         BE    VSAMCRX                  BR IF YES                Y02049 18108502
VSAMCR01 EQU   *                        INSTR MUST FOLLOW        Y02076 18109402
         CLC   0(2,BUFADR),SSREC        TEST FOR SS REC          Y02049 18110302
         BE    VSAMCR04                 BR IF YES                Y02049 18111202
         CLC   0(2,BUFADR),VSAMREC      TEST FOR VSAM            Y02049 18112102
         BE    VSAMCRY                  BR IF YES                Y02049 18113002
         CLC   0(2,BUFADR),ENDREC       TEST FOR END REC         Y02049 18113902
         BE    VSAMCR04                 BR IF YES               ZA00600 18114800
SSCRERR  EQU   *                                                        18115702
         MVI   RSRETCOD+D1,ERR236       ERROR-UNEXPECTED RECORD@ZSUT222 18116632
         B     INOUT750                 GO TO ERROR EXIT RTN   @Z30SSDT 18117008
         USING SSCR,BUFADR                                       Y02076 18118402
*********************************************************************** 18119302
*               UPDATE CHAIN OF VSAM SSCR'S                           * 18120202
*********************************************************************** 18121102
VSAMCRY  CLC   RSSSCR(D4),ZEROWORD      1ST SSCR                 Y02076 18122002
         BNZ   VSAMCR02                 NO                       Y02076 18122902
         MVC   RSSSCR(D4),RSBUFADC      SAV ADR 1ST SSCR IN CHAINY02076 18123802
         B     VSAMCR03                 SET UP PREVIOUS ADR      Y02076 18124702
VSAMCR02 EQU   *                        INSTR MUST FOLLOW        Y02076 18125602
         L     BUFADR,RSBUFADP          PREV SSCR ADR            Y02076 18126502
         MVC   SSCRFCHN(D4),RSBUFADC    STR CUR SSCR ADR IN PREV Y02076 18127402
         DROP  BUFADR                                            Y02076 18128302
VSAMCR03 EQU   *                        INSTR MUST FOLLOW        Y02076 18129202
         MVC   RSBUFADP(D4),RSBUFADC    CURRENT BECOMES PREVIOUS Y02076 18130102
*********************************************************************** 18131002
*               GET STORAGE FOR NEXT SSCR                             * 18131902
*********************************************************************** 18132608
         L     WRKR1,SSCRSIZE           GET 4K BYTES             Y02076 18133008
         ICM   WRKR1,HIORDER,SBP253                              Y02076 18134602
         GETMAIN R,LV=(WRKR1)           GET STORAGE              Y02076 18145608
         ST    WRKR2,RSBUFADC           SAVE ADR OF NEW BLOCK    Y02076 18148308
         LR    BUFADR,WRKR2             OBTAIN BUFFER ADDRESS    YM6509 18149208
VSAMCRX  BAL   RETNREG,VSAMREAD         READ RECORD              Y02076 18150108
         B     VSAMCR01                 VALIDITY CHECK NEXT RCD  Y02076 18151008
*********************************************************************** 18152608
*               PROCESS VSAM SSCR'S IF THERE ARE ANY                  * 18152808
*********************************************************************** 18153708
VSAMCR04 EQU   *                        INSTR MUST FOLLOW        Y02076 18154608
         CLC   RSSSCR(D4),ZEROWORD      TEST ANCHOR WORD         Y02076 18155508
         BZ    VSAMCR07                 NO VSAM SSCR'S           Y02076 18156408
*********************************************************************** 18158208
*               LOAD VSAM SSCR PROCESSING MODULE IDA0C05B             * 18159108
*********************************************************************** 18160008
         MVC   VSAMLOAD(D8),VSAMODUL    SET UP EPLOC             Y02076 18163708
         LOAD  EPLOC=VSAMLOAD           GET MODULE               Y02076 18163908
         ST    WRKR1,VSAMODAD           SAVE ADR OF MODULE       Y02076 18164108
         MVI   VSAMODAD,ZEROBYTE                                 Y02076 18164308
         LA    WRKR4,RSREGSAV           REGISTER 13 = SAVEAREA @Z30SSDT 18164708
         L     WRKR6,VSAMODAD                                    Y02076 18166308
         LR    WRKR2,BUFR               REG 1 = ADR RSTWA        Y02076 18167208
*********************************************************************** 18168108
*               BRANCH TO VSAM MODULE TO PROCESS VSAM SSCR'S          * 18169008
*********************************************************************** 18169908
         BALR  WRKR5,WRKR6              IDA0C05B               @Z30SSDT 18172608
*                                                                       18173508
         ST    WRKR6,VSAMRTCD           SAVE RETURN CODE         Y02076 18174408
*********************************************************************** 18176108
*               TEST VSAM PROCESSING ROUTINE RETURN CODE              * 18176508
*********************************************************************** 18176608
         LTR   WRKR6,WRKR6              WERE THERE ANY ERRORS  @Z30SSDT 18176808
         BNZ   INOUT750                 YES, XCTL TO IGC0V05B  @Z30SSDT 18177208
*********************************************************************** 18178108
*               FREEMAIN ANY STORAGE GOTTEN FOR VSAM SSCR'S           * 18178308
*********************************************************************** 18178508
         L     WRKR2,RSSSCR             GET 1ST OF SSCR CHAIN    Y02076 18179408
         XC    RSSSCR(D4),RSSSCR        CLEAR ANCHOR FIELD       Y02076 18179608
         USING SSCR,WRKR2                                        Y02076 18179808
         L     WRKR2,SSCRFCHN           DON'T FREE RWA BUFFER  @Z30SSDT 18180908
VSAMCR05 EQU   *                        INSTR MUST FOLLOW        Y02076 18181608
         L     WRKR3,SSCRFCHN           SAVE NEXT SSCR ADR       Y02076 18182508
         LTR   WRKR2,WRKR2              IS THERE A BLOCK TO REL  Y02076 18183408
         BZ    VSAMCR06                 NO                       Y02076 18184308
         L     WRKR1,SSCRSIZE           AMOUNT TO RELEASE        Y02076 18185908
         ICM   WRKR1,HIORDER,SBP253     SUBPOOL 253              Y02076 18186108
         FREEMAIN R,LV=(WRKR1),A=(WRKR2)  RELEASE STORAGE        Y02076 18187008
         LR    WRKR2,WRKR3              NEXT SSCR BLK ADR        Y02076 18187908
         B     VSAMCR05                 RELEASE AGAIN IF REQUIREDY02076 18188808
*********************************************************************** 18189708
*               DELETE VSAM SSCR PROCESSING MODULE                    * 18190608
*********************************************************************** 18191508
VSAMCR06 EQU   *                        INSTR MUST FOLLOW        Y02076 18192408
         DELETE EPLOC=VSAMLOAD                                   Y02076 18193308
         L     WRKR3,TABFLG1            RELOAD WORK AREA ADDR  @Z30SSDT 18194108
*********************************************************************** 18201408
*               DETERMINE IF SUBSYSTEM SSCR IS TO BE PROCESSED        * 18202308
*********************************************************************** 18203208
VSAMCR07 EQU   *                        INSTR MUST FOLLOW        Y02076 18204108
         L     WRKR2,RSBUFADC           GET SSCR ADDRESS         Y02076 18205008
         CLI   SSCRID,ECRMASK           TEST FOR END CKT DATA SETY02076 18205908
         BE    INOUTX00                 NO SSCRS REL LAST BUFFERZA00600 18206808
         CLI   SSCRSSID,SUBSYSIF                                 Y02076 18207708
         BE    INOUT900                 PROCESS SUBSYSTEM SSCR   Y02076 18208608
         B     SSCRERR                  ERROR-UNEXPECTED RCD     YM6509 18209508
INOUTX00 EQU   *                        INSTR MUST FOLLOW       ZA00600 18210408
         CLC   SSCRCMPA(D4),RSBUFADC    SPACE  OUTSIDE WRK AREA ZA00600 18211308
         BE    INOUT000                 NO   CONTINUE           ZA00600 18212208
         L     WRKR1,SSCRSIZE           YES GET SIZE            ZA00600 18213108
         ICM   WRKR1,HIORDER,SBP253     SUBPOOL NO.             ZA00600 18214008
         FREEMAIN R,LV=(WRKR1),A=(WRKR2) RELEASE STORAGE        ZA00600 18214908
         EJECT                                                   YM7523 18215808
INOUT000 EQU   *                                                 Y02049 18216708
*                                                                       18217608
*        AT RESTART TIME, IF THE CHECKPOINT DATA SET IS ON TAPE,        18218508
*        THE CHECKPOINT DCB IN THE PROBLEM PROGRAM MUST BE UPDATED      18219408
*        FROM THE CHECKPOINT DCB IN THE RESTART WORK AREA               18220308
*                                                                       18221208
         TM    RSFLAG1,RSTAPE           IS CHKPT DS ON TAPE?     YM6589 18222108
         BNO   INOUT001                 NO, CONTINUE             YM6589 18223008
         L     WRKR4,RSCKDCB            POINT TO OLD CHKPT DCB   YM6589 18223908
         MVC   BLKCT(D4,WRKR4),RSBDCB+BLKCT  CORRECT BLKCT IN    YM6589 18224808
*                                       USER'S CHKPT DCB         YM6589 18225708
         EJECT                                                          18226108
*********************************************************************** 18226608
*                                                                     * 18227508
*        NOW READ IN THE FORMAT1 DSCB FOR EVERY DATA SET OPEN         * 18228408
*        AND DETERMINE ITS PROTECTION STATUS AS WELL AS WHETHER       * 18229308
*        THE DSCB REPRESENTED BY THE DEB HAS BEEN MOVED               * 18230208
*                                                                     * 18231108
*********************************************************************** 18232008
INOUT001 EQU   *                                                 YM6589 18232908
         L     CTABLR,REG8SAVE          GET FIRST TAB ADR        YM7523 18233808
***                                                              YM7543 18234708
*        GET DADSM-LIKE WORK AREA FOR BOTH SECLOADA CALL         YM7543 18235602
*        AND CALL TO Q05B                                        YM7543 18245602
***                                                              YM7543 18255602
         LA    RF,RSREGSAV              GET ADDR SAVE AREA       YM7543 18257602
         STM   R2,RF,D0(RF)             SAVE REGS                YM7543 18259602
         XR    R1,R1                    PHONY PREV WORK AREA     YM7543 18264002
         IECRES GET,LV=256,A=(R1),ID=N05B,PREFIX=YES             YM7543*18264402
                                        GET SECLOADA WORK AREA   YM7543 18264802
         USING IECEXTPR,R1              W/A ADDR                 YM7543 18265202
         MODESET EXTKEY=ZERO            RET FROM GET IS KEY=5    YM7543 18265302
         LM    R2,RF,D0(RF)             RESTORE REGS             YM7543 18265402
         MVC   WTGWTOPR(D4),WTGCODE     SET WTO FLAGS            YM7543 18265502
         ST    R1,SECSWICH              SAVE CORE ADDR           YM7543 18265602
         DROP  R1                       R1 = BLAH                YM7543 18282202
INOUT040 EQU   *                        CHECK TABS               YM7523 18298902
         L     WRKR3,TABFLG1            PTR WEG W/A              YM7523 18315602
         USING RSDSECT,WRKR3            SEG W/A ADDRESSABILITY   YM7523 18325602
         L     DCBR,TABDSORG            PTR DCB                  YM7523 18365602
         L     DEBR,DCBDEBAD            PTR DEB                  YM7523 18415602
         TM    TABFLG1,TABSYS           CHK - SUBSYS DATA SET    YM7523 18465602
         BO    INOUT060                 Y - NO DSCB              YM7523 18515602
         TM    TABFLG2,TABRSDS          CHK RESTART DCB          YM7523 18565602
         BO    INOUT060                 Y - NO DSCB CHK          YM7523 18615602
         TM    TABFLG1,TABDA            CHK DA                   YM7523 18665602
         BO    INOUT080                 Y - CHK DSCB             YM7523 18715602
INOUT060 EQU   *                        CHK NEXT ENTRY           YM7523 18765602
         TM    TABFLG1,TABLAST          CHK LAST ENTRY           YM7523 18815602
         BO    INOUT720                 Y - EXIT                 YM7523 18865602
         LA    CTABLR,TABENT(,CTABLR)   GET NEXT TAB ENTRY       YM7523 18915602
         B     INOUT040                 TRY IT                   YM7523 18965602
         EJECT                                                          19015608
*********************************************************************** 19065602
*        FOR DA THERE ARE 4 VARIATIONS:                               * 19075602
*        1. PS - THE DEB REPRESENTS 1 DATA SET ON 1 VOLUME            * 19085602
*        2. BDAM - THE DEB REPRESENTS 1 DATA SET ON N VOLUMES         * 19095602
*        3. ISAM - THE DEB REPRESENTS 1 DATA SET ON N VOLUMES AND     * 19105602
*              THE DSCB ADDR IN THE DEB IS FOR THE INDEX/PRIME FMT1   * 19107602
*              WHICHEVER COMES FIRST                                  * 19108002
*        4. PO CONCAT - THE DEB REPRESENTS N DATA SETS, EACH ON 1     * 19109602
*              VOLUME AND THE DSCB ADDR IN THE DEB IS FOR THE FIRST   * 19111602
*              DATA SET                                               * 19113602
*********************************************************************** 19115602
INOUT080 EQU   *                        INIT ENTRY               YM7523 19165602
         MVI   TABFLG5,D0               DEFAULT - 1ST EXTENT FOR YM7523 19172608
*                                       DSCB ADDR CHK            YM7523 19202608
         SH    DEBR,DEBPROFF            PT DEB PREFIX            YM7523 19232608
         USING DEBPREFX,DEBR            DEB PREFIX               YM7523 19262608
         L     WRKR2,DEBXTNP            PTR DEBX                 YM7523 19315602
         L     RB,DEBXDSAB-DEBXTN(,WRKR2) PTR DSAB               YM7523 19365602
         L     WRKR2,DSABTIOT-DSAB(,RB) PTR TIOT                 YM7523 19415602
         MVC   TABJFCB,TIOEJFCB-TIOENTRY(WRKR2) DEFALT JFCB ADR  YM7523 19465602
         CLI   DEBAMTYP,ISAMDEB         CHK IF ISAM DEB          YM7523 19515602
         BE    INOUT100                 BR IF ISAM               YM7523 19565602
         CLI   DEBAMTYP,BDAMDEB         CHK IF BDAM DEB          YM7523 19615602
         BE    INOUT160                 BR IF BDAM DEB           YM7523 19665602
         TM    TABFLG2,TABPOCAT         CHK IF PO CONCAT         YM7523 19715602
         BO    INOUT200                 BR IF PO CONCAT          YM7523 19765602
*********************************************************************** 19815602
*        ASSUME PS LIKE DATA SET                                      * 19825602
*              1 DATA SET ON 1 VOL                                    * 19835602
*********************************************************************** 19865602
         LA    R6,D1                    1 SET OF EXTENTS         YM7523 19915602
         LA    R7,D1                    1 EXTENT TO CHK          YM7523 19965602
         LA    R8,DEBBASND              PTR TO 1ST EXTENT        YM7523 20015602
         B     INOUT300                 CONTIN                   YM7523 20065602
*********************************************************************** 20115602
*        ISAM - CHK OVERFLOW,PRIME,AND INDEX FOR MULTI VOL            * 20125602
*********************************************************************** 20165602
INOUT100 EQU   *                        ISAM                     YM7523 20215602
         LA    R6,D3                    3 SETS OF EXTENTS        YM7523 20265602
INOUT120 EQU   *                        ISAM NTH EXTENT          YM7523 20365602
         LA    WRKR2,D3                 GET EXTENT GROUP         YM7523 20415602
         SR    WRKR2,R6                 INDEX FOR CURRENT EXTENT YM7523 20465602
         SLL   WRKR2,2                  1 WORD PER EXTENT PTR    YM7523 20515602
         L     R8,DEBISAM-DEBPREFX(DEBR,WRKR2) ADDR OF EXTENT    YM7523 20565602
         SR    R7,R7                    CLEAR REG                YM7523 20615602
         IC    R7,DEBISAM-DEBPREFX(DEBR,WRKR2) GET NO. OF EXTNTS YM7523 20665602
         LTR   R8,R8                    CHK NO EXTENT            YM7523 20715602
         BZ    INOUT610                 CHK NEXT EXTENT          YM7523 20765602
         B     INOUT300                 CONTIN                   YM7523 20965602
*********************************************************************** 21015602
*        BDAM - ALLOW FOR MULTI-VOL DATA SET                          * 21025602
*********************************************************************** 21065602
INOUT160 EQU   *                        BDAM                     YM7523 21115602
         LA    R6,D1                    1 SET OF EXTENTS         YM7523 21165602
         SR    R7,R7                    CLEAR REG                YM7523 21175602
         IC    R7,DEBNMEXT              GET NO. DEXTENTS         YM7523 21215602
         LA    R8,DEBBASND              PT FIRST EXTENT          YM7523 21265602
         B     INOUT300                 CONTIN                   YM7523 21315602
*********************************************************************** 21365602
*        PO CONCANTENATION - ALLOW FOR MULTIPLE DATA SETS - EACH ON A * 21375602
*              SINGLE VOLUME                                          * 21385602
*********************************************************************** 21415602
INOUT200 EQU   *                        PO CONCAT                YM7523 21465602
         SR    R6,R6                    CLEAR REG                YM7523 21515602
         IC    R6,DEBAMLNG              NO. OF DDS -1            YM7523 21565602
         LA    R6,D1(,R6)               NO. OF DDS               YM7523 21615602
         LA    R7,D1                    CHK 1 EXTENT             YM7523 21665602
         LA    R8,DEBBASND              PTR 1ST EXTENT           YM7523 21715602
         B     INOUT300                 CONTIN                   YM7523 21765602
***                                                              YM7523 21815602
*        PO CONCAT - NTH EXTENT                                  YM7523 21865602
***                                                              YM7523 21915602
INOUT220 EQU   *                        PO CONCAT                YM7523 21965602
         LA    R7,D1                    1 EXTENT                 YM7523 22015602
         SR    WRKR2,WRKR2              CLEAR REG                YM7523 22065602
         IC    WRKR2,DEBAMLNG           NO. OF DDS -1            YM7848 22115602
         SR    WRKR2,R6                 CURRENT DD NO. (=-1)     YM7523 22165602
         LA    WRKR6,D2(,WRKR2)         CURRENT DD NO. (=1)      YM7523 22215602
         L     WRKR4,DEBXTNP            PTR DEB EXTENSION        YM7523 22265602
         L     RB,DEBXDSAB-DEBXTN(,WRKR4) PTR DSAB               YM7523 22315602
         B     INOUT260                 SCAN FOR CURRENT DSAB    YM7523 22365602
INOUT240 EQU   *                        SCAN DSAB                YM7523 22415602
         L     RB,DSABFCHN-DSAB(,RB)    GET NEXT DSAB            YM7523 22465602
INOUT260 EQU   *                        SCAN DSAB                YM7523 22515602
         BCT   WRKR6,INOUT240           FIND THE DSAB            YM7523 22565602
         L     WRKR4,DSABTIOT-DSAB(,RB) PTR CURRENT TIOT         YM7523 22615602
         MVC   TABJFCB,TIOEJFCB-TIOENTRY(WRKR4) SET JFCB ADDR    YM7523 22665602
*                                                                YM7523 22715602
*        NOW LOCATE THE CURRENT DEB EXTENT                       YM7523 22765602
*                                                                YM7523 22815602
         SR    R8,R8                    CLEAR REG                YM7523 22865602
         IC    R8,DEBNMEXT              NO. OF EXTENTS           YM7523 22915602
         SLL   R8,D4                    NO. EXTS * 16 = A/M SECT YM7523 22965602
         AR    R8,WRKR2                 OFFSET TO A/M BYTE       YM7523 23015602
         SR    WRKR4,WRKR4              CLEAR REG                YM7523 23065602
         IC    WRKR4,DEBBASND-DEBPREFX(DEBR,R8) NO. EXTS TO DD   YM7523 23115602
         SLL   WRKR4,D4                 NO. EXTS * 16 = EXT      YM7523 23165602
         LA    R8,DEBBASND-DEBPREFX(DEBR,WRKR4) PT TO EXTENT     YM7523 23215602
         B     INOUT300                 CONTIN                   YM7523 23265602
         EJECT                                                          23315608
*********************************************************************** 23365602
*                                                                     * 23375602
*        READ DSCB AND CHK FOR PASSWORD                               * 23385602
*              R2 = PTR DCB(USER)                                     * 23387602
*              R4 = PTR DEBPREFX                                      * 23389602
*              R6 = NO. OF EXTENT GROUPS                              * 23395602
*              R7 = NO. OF EXTENTS                                    * 23405602
*              R8 = EXTENT DESCRIPTION                                * 23407602
*              R9 = PTR TAB                                           * 23408002
*              RA = PTR RESTART WORK AREA                             * 23408402
*              RB = DSAB PTR                                          * 23409602
*              RC = PTR SEG WORK AREA                                 * 23411602
*********************************************************************** 23415602
INOUT300 EQU   *                        GET DSCB                 YM7523 23465602
         L     UCBR,DEBDVMOD-DEBDVMOD(,R8) GET UCB ADDR          YM7523 23515602
         LA    UCBR,D0(,UCBR)           CLEAR HI-ORDER BYTE      YM7523 23565602
         USING MNTUCB,UCBR              UCB ADDRESSABILITY       YM7523 23615602
         TM    UCBJBNR,UCBVRDEV         CHK FOR VIO UCB          YM7523 23665602
         BO    INOUT490                 BR IF VIO                YM7523 23715602
*********************************************************************** 31156602
*              DSCB IS NOW READ IN FOR CHECKING                       * 31163302
*********************************************************************** 31167802
         MVC   RSDEBMOD(6),DEBDVMOD-DEBDVMOD(R8) UCB ADR TO SYS  YM7523 31170102
* DEB IN THE WORK AREA                                           YM7523 31172102
* TO CONVERT VTOC ADDR FROM TTR TO ABSOLUTE AND THEN READ FROM IT,      31173402
* DEB EXTENTS MUST COVER THE ENTIRE VOLUME.  STARTING CCHH IS           31176702
* ZERO, AND ENDING CCHH IS OBTAINED FROM THE SYSTEM DEVICE              31180021
* CHARACTERISTICS TABLE.                                                31190021
*                                                                       31200021
         L     WRKR6,CVTPTR             FOLLOW POINTER CHAIN     M0187  31210021
         L     WRKR6,CVTZDTAB-CVTMAP(WRKR6) ADDR CHARACTERISTICS Y02049 31220002
*                                       TABLE                    M0187  31230021
         IC    WRKR5,UCBTBYT4           PICK UP DEVITYPE BYTE    M0187  31240021
         N     WRKR5,MASK1              USE LO-ORDER 4 BITS      M0187  31250021
         IC    WRKR5,0(WRKR6,WRKR5)     GET INDEX TO TYPE ENTRY  M0187  31260021
         AR    WRKR6,WRKR5              POINT TO ENTRY           M0187  31270021
         XC    RSDEBSCC(8),RSDEBSCC     CLEAR EXTENT AREA        M0187  31280021
         MVC   RSDEBECC,0(WRKR6)        GET HI CC FROM DEVTAB    M0187  31290021
         SPACE 3                                                        31300018
**************      ***************     ***************     *********** 31400018
*                                                                       31500018
*        GET VTOC ADDR. FROM UCB FOR READING DSCB- CONVERT TTR TO       31600018
*        MBBCCHHR.                                                      31700018
*                                                                       31800018
**************      ***************     ***************     *********** 31900018
*                                                                       32000018
*                                                                       32100018
         L     WRKR1,SRTEFSCT      GET VTOC TTR FROM UCB.               32300018
*                                                                       32354018
*                                                                       32390018
         SRL   WRKR1,8                  RIGHT JUSTIFY.                  32400002
         BCTR  WRKR1,0                  DECR R BY ONE FOR SEEK.         32500002
         SLL   WRKR1,8                  LEFT JUSTIFY.                   32600002
         LA    WRKR2,RSDSCB             SAVE AREA ADDR TO REG.   YM7523 32700002
         STM   WRKR1,WRKR6,0(WRKR2)     SAVE REGISTERS 0-15.     YM7523 32800002
         LR    R6,WRKR2                 SAVE REG ACCROSS CALL    YM7523 32850002
         L     WRKR6,CVTPTR             CVT ADDRESS                     32900002
         LA    WRKR2,RSDEB              LOAD DEB ADDR-WK AREA           33000002
         LA    DCBR,RSIOBDAD            LOCATION OF RESULTS.            33100002
         L     WRKR6,CVTPCNVT-CVTMAP(WRKR6) GET ADR OF CNVRT RTN Y02049 33200002
         BALR  WRKR5,WRKR6              GO TO CONVERT.                  33300002
         LM    WRKR1,WRKR6,0(R6)        RESTORE REGISTERS 0-15.  YM7523 33400002
         SPACE 3                                                        33600018
**************      ***************     ***************     *********** 33700018
*                                                                       33800018
*  BUILD CHANNEL PROGRAM TO BE USED TO READ IN DSCB.                    33900018
*                                                                       34000018
*  CHN PROG- SEARCH ID-TIC-READ COUNT-SEARCH KEY EQ-TIC-READ DATA       34100018
*                                                                       34200018
**************      ***************     ***************     *********** 34300018
*                                                                       34400018
         L     WRKR2,TABJFCB-D1         GET JFCB PREFIX ADDR     YM7523 34500002
         MVC   RSDSN(44),JFCBDSN(WRKR2) SET DSN FOR SEARCH ID    YM7523 34550002
*                                       NOTE THE DSN NOT IN JFCB AREA   34650002
*                                       BECAUSE 6 CCW'S ARE NEEDED TO   34670002
*                                       READ IN THE DSCB AND ITS ADDR.  34680002
*                                       NOTE THAT THERE IS ONLY SPACE   34690002
*                                       FOR 3 CCW'S IN THE RSDSECT.     34692002
*                                       THUS THIS CHNL PROG WILL EXTEND 34900002
*                                       INTO THE JFCB AREA.             34950002
*                                                                       35400018
         XC    RSCCW1(48),RSCCW1        CLEAR CCW AREA.          YM5512 35600002
         LA    WRKR5,RSIOBDAD+3         GET ADR OF SEARCH ARG    YM5515 35650002
         ST    WRKR5,RSCCW1             ST IN SRCH CCW           YM5515 35660002
         LA    WRKR5,RSCCW1             GET TIC TO ADR           YM5515 35670002
         ST    WRKR5,RSCCW2             STORE IN TIC CCW         YM5515 35680002
         LA    WRKR5,RSCCW3             LOAD READ COUNT CCW ADDRESS.    35700018
         ST    WRKR5,RSCCW3+16          STORE ADDRESS AT TIC AFTER      35800002
*                                       SEARCH KEY EQ.                  35900018
         LA    WRKR5,RSDSN              LOAD ADDR OF KEY(DSN)    YM7523 36000002
         ST    WRKR5,RSCCW3+8           STORE ADDRESS AT SEARCH KEY EQ. 36100018
         LA    WRKR5,RSDSCB             AREA DSCB TO BE READ-IN  YM7523 36200002
         ST    WRKR5,RSCCW3+24          STORE ADDRESS AT READ DATA.     36300018
         LA    WRKR5,RSRDCNT            BUFFER AREA FOR READ CNT YM7523 36400002
         ST    WRKR5,RSCCW3             BUF ADDRESS TO RD COUNT CCW     36500018
         OC    RSCCW1(48),DSCBCP        READ DSCB CHANNEL PROG   YM5515 36600002
*                                                                       36700018
*                              READ IN DSCB                             36800018
*                                                                       36900018
         BAL   WRKR5,INOUT700           BAL TO EXCP RTN          YM7523 37000002
*                                                                       37100018
*                                                                       54100018
*********************************************************************** 54150002
*              DSCB IS NOW BEING CHECKED                              * 54160002
*********************************************************************** 54170002
         SPACE 1                                                 YM7523 54172002
*********************************************************************** 54195202
*              TEST FOR CHANGE OF ADDRESS OF THE DATA SET LABEL       * 54195602
*********************************************************************** 54195702
         TM    TABFLG5,D1               CHK IF DSCB TTR CHK      YM7523 54195802
         BO    INOUT420                 BR IF NO CHK             YM7523 54196202
         CLC   DEBDSCBA+D2(D5),RSRDCNT  CCHHR FIELDS MATCH       YM7523 54196602
         BE    INOUT420                 YES  RESTORE DEB ADDRESS YM7523 54197002
         MVI   RSRETCOD+D1,ERR220       LABEL MOVED SINCE CKT PT Y02049 54197402
         B     INOUT750                 SEND ERROR MSG           YM7523 54197502
INOUT420 EQU   *                        INSTR MUST FOLLOW        Y02049 54197702
         OI    TABFLG5,D1               SET DSCB NOT CHK         YM7523 54197802
*********************************************************************** 54214802
*              DETERMINE IF PASSWORD CHECK IS TO BE MADE              * 54218702
*********************************************************************** 54222602
         LA    WRKR2,RSDSCB             DSCB START ADDRESS       YM7523 54228502
         USING DS1FMTID,WRKR2           DSCB ADDRESSABILITY      YM7523 54228902
*   BYPASS PASSWORD CHECKING IF DATA SET IS RAC DEFINED.       @Z40RSGD 54229308
         TM    DS1DSIND,DS1RACDF        RAC DEFINED            @Z40RSGD 54229708
         BO    RACDS000                 YES-SKIP PASSWORD      @Z40RSGD 54230108
         TM    DS1DSIND,PASSWCHK        PASSWORD FLAG SET        Y02049 54230402
         BNO   INOUT500                 NO  GO TO NEXT EXTENT    YM7523 54234302
         TM    DS1DSIND,WRITECHK        WRITE ONLY FLAG SET      Y02049 54238202
         BNO   INOUT440                 NO  PASSWD CHK IS REQ    YM7523 54242102
         TM    DEBOPATB,INONLY          INPUT ONLY DATA SET      Y02049 54246002
         BZ    INOUT500                 YES  GO TO NEXT EXTENT   YM7523 54249902
         DROP  WRKR2                                             YM7337 54251902
         EJECT                                                          54255908
*********************************************************************** 54259902
*              SET UP TO DO PASSWORD VERIFICATION                     * 54269902
*                                                                     * 54271902
*        INTERFACE TO SECLOADA AS FOLLOWS:                            * 54273902
*              R1 = PTR DSAB                                          * 54275902
*              R4 = PTR FMT1 IF DA                                    * 54277902
*              R5 = PTR DEB                                           * 54278302
*              RA = 4(D/A) - HI-ORDER BYTE                            * 54278702
*              RB = PTR DATA SET NAME                                 * 54279102
*              RD = PTR DADSM TYPE W/A                                * 54279502
*              RE = 0                                                 * 54279602
*                                                                     * 54279702
*        RETURN AS FOLLOWS:                                           * 54279802
*              R1-RD RESTORED                                         * 54320002
*              RA = HI-ORDER BYTE (0) = O.K.                          * 54330002
*                   HI-ORDER BYTE (NOT = 0) = BAD                     * 54340002
*********************************************************************** 54360402
INOUT440 EQU   *                        INSTR MUST FOLLOW        YM7523 54400602
         STM   R0,RF,RSREGSAV           SAVE REGS BEFORE SETUP   YM7543 54458802
         LA    R6,RSREGSAV              GET REG SAVE AREA        YM7543 54460802
         OI    TABFLG2,TABSW            IND SECLOADA CALL        YM7543 54463102
         LR    R1,RB                    R1 PTR DSAB              YM7543 54465102
         LA    R4,RSDSCB                R4 PTR DSCB              YM7543 54466602
         LA    R5,DEBBASIC              R5 PTR DEB               YM7543 54476602
         ICM   RA,HIORDER,DAIND         INDR - CALL FROM N05B    YM7543 54476702
         LA    RB,RSDSN                 RB PTR DSN               YM7543 54476802
         L     RD,SECSWICH              RD PTR DADSM-LIKE W/A    YM7543 54478302
         USING IECEXTPR,RD              SECLOADA W/A ADDR        YM7543 54480302
         IECRES LOAD,MODNM=SECMODNM,EXTPR=(RD),BRCODE=0,         YM7543*54480702
               BRANCH=DIRECT            EXIT TO SECLOADA         YM7543 54481102
*********************************************************************** 54481302
*              TEST SECLOADA RESPONSE; RIGHT PASSWORD GIVEN.          * 54486602
*********************************************************************** 54496302
PASSWORD EQU   *                        INSTR MUST FOLLOW        YM7523 54506002
         MODESET EXTKEY=ZERO            ENSURE KEY 0             YM7543 54506102
         STCM  RA,HIORDER,4*RA(R6)      SAVE RET CODE            YM7543 54506402
         LM    R0,RF,D0(R6)             RESTORE REGS             YM7543 54512002
         NI    TABFLG2,X'FF'-TABSW      RESET SECLOADA CALL      YM7543 54512402
         CLI   RSREGSAV+4*RA,D0         CHK FOR PASSWORD ERROR   YM7543 54512802
         BE    INOUT500                 BR IF NO PASSWORD ERROR  YM7543 54513202
         ST    RA,TABVLID1+D2           SAV RET COD FOR PROB DET YM7543 54513602
         MVI   RSRETCOD+D1,ERR221       SET PASSWORD ERROR       YM7543 54514402
         B     INOUT750                 GO TO ERROR EXIT         YM7543 54514802
*********************************************************************** 54514902
INOUT490 EQU   *                        VIO UCB                  YM7523 54515202
         OI    TABFLG5,D1               INDIC NO DSCB-DEB CHK    YM7523 54515602
         MVC   RSDSCB(LVDSCB),VDSDSCB-VDSUCB+L'JFCBDSNM(R5)      YM7337*54525602
                                        GET VIO DSCB             YM7337 54526002
         EJECT                                                          54527408
*********************************************************************** 54535402
*        CHECK IF FORMAT1 INDICATES THAT THIS IS A CHECKPOINT         * 54535802
*        DATA SET.  IF IT DOES THEN SET UP TO CALL Q05B.              * 54536202
*                                                                     * 54536602
*        INPUT TO Q05B AS FOLLOWS:                                    * 54537002
*              R1 = 0(CHKPT D.S. CHECK)                               * 54537102
*                   4(OLD CHKPT D.S. AND THE D.S. IS NOT CHKPT)       * 54537202
*              R5 = PTR UCB                                           * 54537302
*              R9 = PTR TAB ENTRY                                     * 54537402
*              RA = PTR RESTART WORK AREA                             * 54540302
*              RE = RETURN ADDRESS                                    * 54542302
*                                                                     * 54542702
*        OUTPUT FROM Q05B AS FOLLOWS:                                 * 54543102
*              ALL REGS SAVED AND RESTORED                            * 54543202
*              DSABCKVL SET IF VOL SECURE.  Q05B XCTL TO V05B IF ERR. * 54543302
*********************************************************************** 54543402
INOUT500 EQU   *                        CHK IF CHECKPOINT D.S.   YM7543 54546402
         XR    R1,R1                    Q05B CHKPT D.S. CHECK    YM7337 54548402
         LA    RF,RSDSCB                GET PTR DSCB             YM7337 54550402
         USING DS1FMTID,RF              DSCB ADDRESSABILITY      YM7337 54552402
         TM    DS1DSIND,DSCBCKDS        CHK IF IS CHKPT D.S.     YM7337 54553802
         BO    INOUT520                 GO DO CHKPT CHECK        YM7337 54554202
         LA    R1,D4                    SET INVALID CHKPT D.S.   YM7337 54554302
         TM    DSABFLG4-DSAB(RB),DSABCKDS CHK IF WAS CHKPT D/S   YM7337 54554502
         BNO   INOUT600                 BR IF NOT CHKPT D.S.     YM7337 54554602
INOUT520 EQU   *                        CHECK CURRENT STATUS     YM7337 54554702
         LA    RE,INOUT600              GET RETURN ADDR          YM7337 54554802
         L     RD,SECSWICH              ADDR O/C/E WORK AREA     YM7337 54554902
         IECRES LOAD,MODNM=COMMODNM,EXTPR=(RD),BRCODE=(14),      YM7337*54555202
               BRANCH=DIRECT            GO CHECK SECURITY        YM7337 54557402
         DROP  RF                                                YM7337 54559402
         SPACE 3                                                 YM7543 54560302
*********************************************************************** 54563002
*              PROCESS NEXT EXTENT,IF THERE IS ONE. OTHERWISE         * 54565702
*              GO BACK TO PROCESS NEXT DATA SET.                      * 54568402
*********************************************************************** 54581602
INOUT600 EQU   *                        INSTR MUST FOLLOW        YM7523 54594802
         BCT   R7,INOUT620              CHK ANY MORE EXTENTS     YM7523 54644802
INOUT610 EQU   *                        NO EXTENTS LEFT          YM7523 54654802
         BCT   R6,INOUT640              CHK ANY MORE EXT GRPS    YM7523 54694802
         XC    TABFLG5,TABFLG5          CLEAR DSCB CHK FLAG      YM7523 54704802
         B     INOUT060                 END OF THIS DEB          YM7523 54744802
*                                                                YM7523 54794802
*        MORE EXTENTS TO CHK                                     YM7523 54844802
*                                                                YM7523 54854802
INOUT620 EQU   *                        MORE EXTENTS             YM7523 54864802
         LA    R8,EXTLNGTH(,R8)         PT NEXT EXTENT           YM7523 54874802
         L     WRKR2,DEBDVMOD-DEBDVMOD(,R8) GET UCB NEXT         YM7523 54884802
         LA    WRKR2,D0(,WRKR2)         CLEAR HI-ORDER BYTE      YM7523 54886802
         CR    WRKR2,UCBR               CHK SAME UCB             YM7523 54888802
         BE    INOUT600                 IF SAME - IGNORE         YM7523 54890802
         B     INOUT300                 NOT SAME THEN CHK        YM7523 54892802
*                                                                YM7523 54893202
*        MORE EXTENT GROUPS                                      YM7523 54893602
*                                                                YM7523 54894002
INOUT640 EQU   *                        MORE EXTENT GRPS         YM7523 54894402
         CLI   DEBAMTYP,ISAMDEB         CHK IF ISAM              YM7523 54894502
         BE    INOUT120                 BR IF ISAM               YM7523 54894602
         B     INOUT220                 BR PO CONCAT             YM7523 54894702
         SPACE 3                                                        54894802
         SPACE 3                                                        55000018
**************      ***************     ***************     *********** 55100018
*                                                                       55200018
*                    EXCP -WAIT AND CHECK FOR ERROR                     55300018
*                                                                       55400018
**************      ***************     ***************     *********** 55500018
*                                                                       55600018
INOUT700 EQU   *                                                 YM7523 55700002
*                                                                       55800018
         EXCP  RSIOB                    EXCP CHANNEL PROGRAM            55900002
*                                                                       56000018
         WAIT  ,ECB=RSECBAD             WAIT FOR I/O COMP        YM7523 56100002
*                                                                       56200018
         TM    RSECBAD,PERMERR          I/O ERROR                       56300002
         BCR   1,WRKR5                  RETURN IF NOT                   56400002
*                                                                       56500018
**************      ***************     ***************     *********** 56600018
*                                                                       56700018
*  PERMANENT I/O ERROR WHILE READING IN JFCB OR DSCB FOR REALLOCATED    56800018
*  DATA SET.                                                            56900018
*                                                                       57000018
**************      ***************     ***************     *********** 57100018
         MVI   RSRETCOD+1,ERR073        DSCB I/O ERROR  73     @ZSUT222 57500032
         B     INOUT750                 GO TO ERROR EXIT         YM7523 57550002
         EJECT                                                          57750008
**************      ***************     ***************     *********** 58100018
*                                                                       58200018
*                   TRANSFER TO NEXT MODULE                             58300018
*                                                                       58400018
**************      ***************     ***************     *********** 58500018
INOUT720 MVC   RSJFCB(8),NEXTMOD        NO SYSIN/SYSOUT PROC     YM7523 58740002
         TM    RSDCBFLG,NONDAFLG        ANY TAPE DS              Y02049 58790002
         BNO   INOUT730                 NO                       YM7523 58840002
         MVI   RSJFCB+D4,TAPEPOS        IGC0P05B                 Y02049 58890002
INOUT730 EQU   *                        NO TAPE                  YM7523 58892002
         NC    SECSWICH,SECSWICH        TEST FOR SECLOADA CORE   YM7523 59080002
         BZ    INOUT740                 NONE  NO RELEASE REQ     YM7523 59090002
         LA    RF,RSREGSAV              GET REG SAVE AREA        YM7543 59092002
         STM   R0,RF,D0(RF)             SAVE REGS                YM7543 59094002
         L     R1,SECSWICH              GET DADSM-LIKE W/A       YM7543 59096002
         IECRES FREE,A=(R1),PREFIX=YES  FREE DADSM-LIKE W/A      YM7543 59096102
         MODESET EXTKEY=ZERO            KEY 0                    Y02049 59096402
         LM    R0,RF,D0(RF)             RESTORE REGS             YM7543 59146402
***************     ***************     **********     **********       59200018
INOUT740 EQU   *                        INSTR MUST FOLLOW        YM7523 59250002
         LA    WRKR6,RSJFCB+8                                           59260002
         LR    WRKR2,BUFR               PT REG. 1 TO REST W/A           59300002
         L     TABLR,REG8SAVE           RESTORE TABL ADR         Y02049 59310002
         XC    RSERAS00(D40),RSERAS00   CLEAR SCRTCH AREA        Y02076 59350002
***************     ***************     **********     **********       59400018
*                                                                       59500018
         XCTL  EPLOC=RSJFCB,SF=(E,(15)) TRANSFER CONTROL TO NEXT MOD    59600018
***************     ***************     **********     **********       59602002
*        ERROR EXIT - TRY NOT TO DESTROY USEFUL INFO             YM7523 59602402
***************     ***************     **********     **********       59604002
INOUT750 EQU   *                        INSTR MUST FOLLOW        YM7523 59610002
         MVC   RSREGSAV(8),MODID        SAVE NAME OF MODULE    @ZSUT222 59610532
*                                       DETECTING THE ERROR.   @ZSUT222 59611032
         STM   0,15,RSREGSAV+8          SAVE CURRENT REGISTERS @ZSUT222 59611532
         MVC   TABVLID2(D8),ERRMOD      SET XCTL TO V05B         YM7523 59612002
         LA    WRKR6,TABVLID2+D8        ERROR MOD ID + 8         YM7523 59620002
         LR    WRKR2,BUFR               PT REG. 1 TO REST W/A    YM7523 59630002
         L     TABLR,REG8SAVE           RESTORE TABL ADR         YM7523 59640002
         XC    RSERAS00(D40),RSERAS00   CLEAR SCRTCH AREA        YM7523 59642002
***************     ***************     **********     **********       59644002
*                                                                       59646002
         XCTL  EPLOC=TABVLID2,SF=(E,(15)) XFER CTL TO NEXT MOD   YM7523 59648002
         EJECT                                                   YM7523 59648402
*********************************************************************** 59650002
*                                                                     * 59660002
*                                                                     * 59670002
*              REPOSITIONING LOGIC FOR SYSIN/SYSOUT SUBSYSTEM         * 59680002
*              DATA SETS.                                             * 59690002
*                                                                     * 59692002
*                                                                     * 59694002
*********************************************************************** 59696002
INOUT900 EQU   *                        INSTR MUST FOLLOW        Y02076 59696402
         L     DSCNTR,RSBUFADC          SSCR ADDRESS             Y02076 59698002
         USING SSCR,DSCNTR              SSCR ADDRESSABILITY      Y02076 59698402
         L     CTABLR,REG8SAVE          DATA SET TABLE ADDRESS   Y02076 59698802
         USING TABL,CTABLR              ADDRESSABILITY           Y02076 59699202
*********************************************************************** 59699602
*              SEARCH RESTART WORK AREA FOR CORRECT SUBSYSTEM         * 59699702
*              DATA SET DCB.                                          * 59699802
*********************************************************************** 59699902
INOUT910 EQU   *                        INSTR MUST FOLLOW        Y02076 59733202
         CLC   TABDCBAD(D3),SSCRDCBA+1  CORRECT DCB ADDRESS      YM5300 59743202
         BE    INOUT930                 YES  TEST FOR DUMMY      Y02076 59753202
         TM    TABFLG1,TABLAST          END OF TABLE             YM5300 59763202
         BO    INOUT920                 YES  DCB ADR NOT FOUND   YM5300 59765202
         LA    CTABLR,TABENTL(CTABLR)   INCR TO NEXT TAB ENT     YM5300 59765602
         B     INOUT910                 TEST NEXT TABLE ENTRY    Y02076 59766002
INOUT920 EQU   *                        INSTR MUST FOLLOW        Y02076 59766402
         MVI   RSRETCOD+D1,ERR207       SET ERR0R CODE           Y02076 59766502
         B     INOUT750                 SEND ERR0R MESSAGE     @Z30SSDT 59766608
INOUT930 EQU   *                        INSTR MUST FOLLOW        Y02076 59777702
         TM    TABFLG1,TABNULL          TEST FOR DUMMY DATA SET  YM5300 59787702
         BO    VSAMCRX                  READ NEXT SSCR           YM5300 59792502
         ST    WRKR2,REG1SAVE           SAVE REGISTER ONE        Y02076 59794502
         SR    WRKR5,WRKR5                                       Y02076 59794902
         ICM   WRKR5,D7,TABDCBAD        DCB ADDRESS              Y02076 59795302
         USING IHADCB,WRKR5             DCB ADDRESSABILITY       Y02076 59795702
         ICM   WRKR5,D7,DCBDEBA         DEB ADDRESS              Y02076 59796102
         USING DEBBASIC,WRKR5           DEB ADDRESSABILITY       Y02076 59796202
         LA    WRKR5,DEBBASND           END OF DEBBASIC SECT     Y02076 59806202
         LA    WRKR5,D4(WRKR5)          ADDR OF SSIB             Y02076 59816202
         USING SSIB,WRKR5                                        Y02076 59826202
         AH    WRKR5,SSIBLEN            ADDR OF SSOB             Y02076 59828202
         USING SSOB,WRKR5               SSOB ADDRESSABILITY      Y02076 59832102
         LR    WRKR2,WRKR5                                       Y02076 59842102
         MVI   SSOBFUNC+D1,SSOBREST     SET RESTART ID IN SSOB   YM5300 59846102
         TM    RSFLAG1,HIGHOBIT         AUTOMATIC RESTART        Y02076 59848102
         BO    INOUT940                 YES                      Y02076 59856702
         MVI   SSDARESF,SSDADEFR        SET DEFERRED RS BIT SSOB Y02076 59858702
         B     INOUT945                 SET UP REGISTER 13       Y02076 59860702
INOUT940 EQU   *                        INSTR MUST FOLLOW        Y02076 59862702
         MVI   SSDARESF,SSDAAUTO        SET AUTO RS BIT IN SSOB  Y02076 59864702
INOUT945 EQU   *                        INSTR MUST FOLLOW        Y02076 59865102
         LA    WRKR4,RSREGSAV           REGISTER SAVE AREA       YM5300 59865202
         ST    WRKR2,RSERAS04           SS0B ADDR IN PARM WD     YM5300 59865302
         LA    WRKR2,RSERAS04           ADDR PARM WD IN REG1     YM5300 59869802
         MVI   RSERAS04,HIGHOBIT        SET HI ORDER BIT-PARM WD YM5300 59871802
         LA    WRKR1,SSCRDATA           GET ADR OF DATA AREA     YM5300 59874402
         ST    WRKR1,SSDABUFR           STORE IN SSOB            YM5300 59874502
*********************************************************************** 59874602
*              CALL SUBSYSTEM PROCESSING ROUTINE                      * 59879102
*********************************************************************** 59883602
         IEFSSREQ                                                Y02076 59888102
         L     WRKR5,RSERAS04           RESTORE REG 14           YM5300 59890102
         L     WRKR2,REG1SAVE           RESTORE REGISTER ONE     Y02076 59892602
         A     WRKR6,SSOBRETN           SUM RETURN CODES         Y02076 59897102
         BZ    VSAMCRX                  ZERO  READ NEXT SSCR     YM5300 59901602
         MVI   RSRETCOD+D1,ERR208       NONZERO SET ERROR CODE @ZSUT222 59906132
         B     INOUT750                 SEND ERROR MESSAGE     @Z30SSDT 59916108
         EJECT                                                          59921108
*********************************************************************** 59926102
*              ROUTINE TO READ VSAM AND SUBSYSTEM SSCRS               * 59928102
*********************************************************************** 59928502
VSAMREAD EQU   *                        INSTR MUST FOLLOW        Y02076 59928902
         LA    RD,RSREGSAV              GET REG SAVE             YM7805 59929002
         READ  RSDECB1,SF,,(BUFADR),,MF=E                        Y02076 59929302
         CHECK RSDECB1                                           Y02076 59929702
         CLI   RSRETCOD+D1,ERR039       I/O ERRORS             @ZSUT222 59937532
         BE    INOUT750                 YES                    @ZSUT222 59938532
         BR    RETNREG                  RETURN TO CALLER         Y02076 59939532
*********************************************************************** 59944302
*              VSAM READ SYNAD ROUTINE                                * 59944702
*********************************************************************** 59945102
RPM127   EQU   *                        INSTR MUST FOLLOW        Y02076 59945202
         MVI   RSRETCOD+D1,ERR039       ERROR CODE             @ZSUT222 59945332
         RETURN                                                         59953102
         EJECT                                                 @Z40RSGD 60003108
***************************************************************@Z40RSGD 60100008
*   DATA SET IS RAC DEFINED CHECK USERS AUTHORIZATION TO IT   *@Z40RSGD 60200008
*   VIA RACHECK.                                              *@Z40RSGD 60300008
*      AUTHORIZED - INDICATE IN DEBXTN AND BYPASS             *@Z40RSGD 60400008
*                   PASSWORD CHECKING                         *@Z40RSGD 60404008
*      NOT AUTHORIZED OR NOT DEFINED - LINK IGCMSG6C TO PUT   *@Z40RSGD 60408008
*                   OUT ERROR MESSAGE, TAKE ERROR EXIT.       *@Z40RSGD 60412008
*  BYPASS RACF CHECKING IF JSCBPASS IS SET.                   *@G32DSPD 60416032
***************************************************************@Z40RSGD 60417032
RACDS000 STM   RD,R2,RSREGSAV           SAVE REGISTERS         @Z40RSGD 60418032
         USING PSA,0                    PSA HARD ADDRESSING    @G32DSPD 60420632
         L     R2,PSATOLD               GET CURRENT TCB ADDR   @G32DSPD 60420932
         USING TCB,R2                   ADDRESS THE TCB        @G32DSPD 60421232
         L     R2,TCBJSCB               GET THE JSCB           @G32DSPD 60421532
         USING IEZJSCB,R2               ADDRESS THE JSCB       @G32DSPD 60421832
         L     R2,JSCBACT               GET THE ACTIVE JSCB    @G32DSPD 60422132
         TM    JSCBSWT1,JSCBPASS        RACF BYPASS SET ?      @G32DSPD 60422432
         BO    SKIPRAC                  YES SKIP RACF CHECKS   @G32DSPD 60422732
         DROP  R2                                              @G32DSPD 60423032
         MVC   RACHECK(LRACHECK),MRACHECK                      @Z40RSGD 60424008
*   ISSUE RACHECK FOR INPUT OR OUTPUT                          @Z40RSGD 60428008
         LA    R2,ACHKTUPD              ATTRIBUTE=OUTPUT       @Z40RSGD 60428808
         TM    DEBOPATB,INONLY          INPUT                  @Z40RSGD 60432008
         BNZ   RACDSOUT                 NO - OUTPUT            @Z40RSGD 60436008
         LA    R2,ACHKTRD               ATTRIBUTE=INPUT        @Z40RSGD 60440008
RACDSOUT RACHECK ENTITY=RSDSN,          RACHECK OUTPUT         @Z40RSGDX60449708
               VOLSER=UCBVOLI,                                 @Z40RSGDX60449808
               ATTR=(R2),                                      @Z40RSGDX60449908
               MF=(E,RACHECK)                                  @Z40RSGD 60453208
RACDSCHK EQU   *                        CHECK RACHECK COMP     @Z40RSGD 60454008
         LTR   RF,RF                    SUCCESSFUL             @Z40RSGD 60454808
         BNZ   RACDSERR                 NO-ERROR PROCESSING    @Z40RSGD 60455608
         LR    R2,R0                    SAVE RDSID             @Z40RSGD 60456408
*   MARK DEB THAT DATASET IS RAC DEFINED.                      @Z40RSGD 60456508
         L     RF,DEBXTNP               DEB EXTENSION          @Z40RSGD 60456908
         OI    DEBXFLG1-DEBXTN(RF),DEBXDSSI SET RACF INDICATOR @Z40RSGDX60457308
                                        FOR DATASET            @Z40RSGD 60477308
SKIPRAC  EQU   *                        JSCBPASS SAYS SKIP RACF@G32DSPD 60479332
         LM    RD,R2,RSREGSAV           RESTORE REGISTERS      @Z40RSGD 60481908
         B     INOUT500                 BYPASS PASSWORD        @Z40RSGD 60482008
         EJECT                                                 @Z40RSGD 60482108
***************************************************************@Z40RSGD 60482208
*   USER WAS NOT AUTHORIZED TO DATA SET CALL IGCMSG6C AND     *@Z40RSGD 60482608
*   TERMINATE RESTART.                                        *@Z40RSGD 60482708
***************************************************************@Z40RSGD 60482808
RACDSERR MVC   OPID,N05BID              CALLER=IGC0N05B        @Z40RSGD 60482908
         STH   RF,OPRETCOD              RETURN CODE            @Z40RSGD 60483308
         LA    RF,RSDSN                 DATA SET NAME          @Z40RSGD 60483408
         ST    RF,OPADDDSN                                     @Z40RSGD 60483508
         LA    RF,UCBVOLI               VOLSER                 @Z40RSGD 60486808
         ST    RF,OPADDVOL                                     @Z40RSGD 60487608
         LM    RD,R2,RSREGSAV           RESTORE REGS           @Z40RSGD 60489208
         LA    RF,OPID                                         @Z40RSGD 60489308
         ST    RF,OPPARM                                       @Z40RSGD 60489408
         LA    R1,OPPARM                                       @Z40RSGD 60489508
         LA    RD,RSREGSAV       LOAD SAVE AREA POINTER        @ZA29067 60489708
         LINK  EP=IGCMSG6C,             SEND MESSAGE           @Z40RSGD 60490008
         MVI   RSRETCOD+1,ERR254        RAC ERROR CODE         @ZSUT222 60490132
         B     INOUT750                 ERROR EXIT             @Z40RSGD 60490832
         EJECT                                                 @Z40RSGD 60491132
***************************************************************@Z40RSGD 60491408
*                                                             *@Z40RSGD 60492208
*                             CONSTANTS                       *@Z40RSGD 60492308
*                                                             *@Z40RSGD 60492408
***************************************************************@Z40RSGD 60492808
DSCBCP   EQU   *                                                 YM5515 60493208
         DC    X'3100000040000005'      SEARCH ID =              YM5515 60493608
         DC    X'0800000020000001'      TIC                      YM5515 60496808
         DC    X'9200000060000008' READ COUNT                           60500002
         DC    X'A90000004000002C' SEARCH EQ KEY                        60600018
         DC    X'0800000020000001' TIC                                  60700018
         DC    X'8600000000000060' READ DSCB                            60800018
H36      DC    H'0036'             USED TO DECR TO DEB PREFIX.          60900018
MASK1    DC    F'15'                    MASK OF LOW-ORDER 4 BITS M0187  60950021
*                                                                     * 61000018
*                                                                     * 61200018
MVSUBID  MVC   0(0,WRKR6),0(WRKR5)      SUBRTN ID'S FROM OLD TO NEW     61300002
*                                       DEB.                            61400002
*                                                                     * 61500018
NEXTMOD  DC    C'IGC0R05B'              DA POSITIONING           Y02076 61550002
ERRMOD   DC    C'IGC0V05B'              ERROR MOD                YM7523 61600002
MODID    DC    CL8'IGC0N05B'            MODULE ID              @ZSUT222 61620032
         DS    0F                       FULLWORD BASE            YM7337 61650002
SECMODNM DC    C'SECLOADA'              PASSWORD                 Y02049 61700402
         DC    VL4(SECLOADA)            VCON FOR SECLOADA        YM7337 61700502
COMMODNM DC    C'IGC0Q05B'              COMMON MOD               YM7337 61703102
         DC    VL4(IGC0Q05B)            VCON FOR Q05B            YM7337 61705102
SSCRSIZE DC    F'4096'                  SSCR RECORD SIZE         Y02049 61706802
ZEROWORD DC    F'0'                     ZEROWORD MASK            Y02076 61709202
DEBPROFF DC    H'16'                    DEB PREFIX OFFSET        Y02049 61711602
TIOTOFFS DC    H'16'                    TIOT OFFSET TO DEVICE ENTY02049 61714002
HIGHOBIT EQU   X'80'                    HIGH ORDER BIT CONSTANT  Y02049 61716402
QMNGWALN DC    AL3(280)                 PARM LIST + WA LNGTH     Y02049 61718802
SBP253   DC    AL1(253)                 SUBPOOL 253              Y02049 61721202
SBP230   DC    AL1(230)                 SUBPOOL 230              Y02049 61723602
WTGCODE  DC    X'000C0000'              WTG CODE                 Y02049 61726002
DAIND    DC    X'04'                    SECLOADA DA IND          Y02049 61728402
SSREC    DC    X'0100'                  SUBSYSTEM RECORD         Y02076 61730802
VSAMREC  DC    X'0101'                  VSAM RECORD              Y02076 61733202
SPIEREC  DC    X'0102'                  SPIE RECORD              Y02076 61735602
ENDREC   DC    X'FFFF'                  END RECORD               Y02076 61738002
ADDRBYTS EQU   7                        GETMAIN/FREEMAIN PARSM   Y02049 61740402
N05BID   DC    H'0'                     CALLER=N05B            @Z40RSGD 61740508
QMNWAOFT EQU   24                       QMNGR WA OFFSET          Y02049 61746208
JFCBLNGH EQU   176                      JFCB LENGTH              Y02049 61746908
VSAMODUL DC    C'IDA0C05B'              VSAM MODULE NAME         Y02076 61747608
MRACHECK RACHECK CLASS=CDATASET,        RACHECK PARM LIST      @Z40RSGDX61748408
               DSTYPE=N,                                       @Z40RSGDX61749208
               MF=L                                            @Z40RSGD 61749308
LRACHECK EQU   *-MRACHECK                                      @Z40RSGD 61749408
CDATASET DC    AL1(7),C'DATASET'        CLASS = DATASET        @Z40RSGD 61749808
*                                                                     * 61750000
*        MAINTENANCE SPACE                                       Y01909 61800000
*                                                                     * 61850000
PATCH    DC    XL((*-IGC0N05B)/20)'00'   FIVE PERCENT SPACE      Y01909 61860000
*                                                                     * 61870000
         EJECT                                                          61872002
         IECDSECS MAIN,PREFX,DSAB,EXPAND=YES                     YM7523 61882002
         EJECT                                                          61884008
         ICHACHKL                                              @Z40RSGD 61886008
         EJECT                                                   YM7523 61889102
         IEZDEB LIST=YES                                         YM7523 61891102
         EJECT                                                          61891402
         IDDVDSCB                                                YM7337 61891802
LVDSCB   EQU   L'VDSDSCB-L'JFCBDSNM     LENGTH OF VDSCB W/O DSN  YM7337 61892202
         EJECT                                                          61893402
         IEFQMIOP                                                Y02076 61895702
         EJECT                                                          61900018
FORMAT1  DSECT                                                   Y02076 61950002
         IECSDSL1 (1)                                            Y02076 62000002
         EJECT                                                          62566502
         IEFJSSIB                                                Y02076 62570202
         IEFJSSOB (DA),CONTIG=YES                                Y02076 62574002
         EJECT                                                          62577702
         IEFJESCT                                                Y02076 62587702
         EJECT                                                          62588102
SSCR     DSECT                                                   Y02076 62588502
SSCRID   DS    XL1                      CHECK POINT ID           Y02076 62588602
SSCRSSID DS    XL1                      SUBSYSTEM IDENT                 62588702
SSCRHDRL DS    XL2                      SSCR HEADER LENGTH              62588802
SSCRFCHN DS    F                        SSCR CHAIN POINTER              62592502
SSCRFLG1 DS    XL1                      FLAG BITS                       62594502
         DS    XL1                      RESERVED                        62594902
SSCRDATL DS    XL2                      DATA LENGTH                     62595302
SSCRDCBA DS    F                        ADDRESS OF ASSOCIATED DCB       62595702
SSCRDATA DS    0F                       SUBSYSTEM DATA                  62596102
         EJECT                                                          62596302
MNTTIOT  DSECT                                                          62600018
         IEFTIOT1                                                       62700018
         EJECT                                                          62800018
MNTUCB   DSECT                                                          62900018
         IEFUCBOB                                                       63000018
         EJECT                                                          63100018
         IHJDSTAB                                                Y02076 63150002
         EJECT                                                          67200018
RSDSECT  DSECT                                                          67300018
*                                                                       67400018
*    DATA EXTENT BLOCK                                                  67500018
*                                                                       67600018
RSDEB    DS    0CL48                                                    67700018
RSDEBTCB DC    X'00000000'              TCB ADDRESS                     67800018
RSDEBDEB DC    X'00000000'              DEB ADDRESS                     67900018
*                                                                       68000018
*    DATA CONTROL BLOCK                                                 68100018
*                                                                       68200018
RSDEBOFL DS    0CL1                                                     68300018
RSDEBIRB DC    X'00000000'              IRB ADDRESS                     68400018
RSDEBSYS DC    X'00000000'              1ST IOB ADDR IN SYS.PURGE CHAIN 68500018
RSDEBUSR DC    X'00000000'              1ST IOB ADDR IN USER PRGE CHAIN 68600018
RSDEBECB DC    X'00000000'              PARM.LIST ADDR TO PURGE ECB     68700018
RSDEBID  DS    0CL1                                                     68800018
RSDEBDCB DC    AL4(RSDCBREP)            DCB ADDR                        68900018
RSDEBAPP DS    CL4                      I/O APPENDAGE VECTOR TABLE      69000018
RSDEBMOD DS    0CL1                                                     69100018
RSDEBUCB DS    F                        UCB ADDRESS                     69200018
RSDEBBIN DS    H                        BIN NUMBER                      69300018
RSDEBSCC DS    H                        CYLINDER START ADDRESS          69400018
RSDEBSHH DS    H                        TRACK START ADDRESS             69500018
RSDEBECC DS    H                        CYLINDER END ADDRESS            69600018
RSDEBEHH DS    H                        TRACK END ADDRESS               69700018
RSDEBNTR DS    H                        NO. OF TRACKS IN THIS EXTENT    69800018
*                                                                       69900018
*    EVENT CONTROL BLOCK                                                70000018
*                                                                       70100018
RSECBAD  DS    CL4                      ECB ADDRESS                     70200018
RSDCBDEB DC    AL4(RSDEB)               DEB ADDRESS                     70300018
*                                                                       70400018
RSDCBREP EQU   RSDEB+8                  POINT TO RELATIVE BEGINNING DCB 70500018
*                                                                       70600018
*    INPUT OUTPUT BLOCK                                                 70700018
*                                                                       70800018
RSIOB    DS    0CL40                                                    70900018
RSIOBFG1 DC    X'00'                    I/O FLAGS BYTE 1                71000018
RSIOBFG2 DC    X'00'                    I/O FLAGS BYTE 2                71100018
RSIOBSN1 DS    CL1                      FIRST SENSE BYTE                71200018
RSIOBSN2 DS    CL1                      SECOND SENSE BYTE               71300018
RSIOBECB DC    AL4(RSECBAD)             ECB ADDRESS                     71400018
RSIOBCSW DS    D                        LAST CSW                        71500018
RSIOBCPA DS    AL4(RSCCW1)              CHANNEL PROGRAM ADDRESS         71600018
RSIOBDCB DS    AL4(RSDCBREP)            DCB ADDRESS                     71700018
RSIOBRCP DS    CL4                      RESTART ADDRESS FOR IOS         71800018
RSIOBINC DS    H                        INCREMENT BLOCK COUNT           71900018
RSIOBECT DS    H                        NO. OF ERROR ENTRIES            72000018
RSIOBDAD DS    D                        SEEK ADDRESS FOR DA             72100018
*                                                                       72200018
*    CHANNEL PROGRAM                                                    72300018
*                                                                       72400018
RSCCWLST DS    0CL24                                                    72500018
RSCCW1   DS    D                        CCW1                            72600018
RSCCW2   DS    D                        CCW2                            72700018
RSCCW3   DS    D                        CCW3                            72800018
*                                                                       72900018
*    BUFFER SEGMENT FOR EXTERNAL BLOCKS                                 73000018
*                                                                       73100018
RSBUFSEG DS    0CL176                                                   73200018
RSJFCB   EQU   RSBUFSEG                                                 73300018
RSDSN    EQU   RSBUFSEG+24              DSN FOR SEARCH           YM7523 73310002
RSDSCB   EQU   RSDSN+44                 DSCB READ-IN AREA        YM7523 73320002
RSRDCNT  EQU   RSDSCB+96                READ COUNT AREA          YM7523 73330002
         ORG   RSCCW1                                          @Z40RSGD 73334008
*   PARAMETER LIST FOR IGCMSG6C                                @Z40RSGD 73338008
OPPARM   DS    A                        ADDRESS PARM LIST      @Z40RSGD 73338808
RACHECK  EQU   RSCCW1                   RACHECK PARM LIST      @Z40RSGD 73339608
OPID     DS    H                        MODULE IDENTIFIER      @Z40RSGD 73342008
OPRETCOD DS    H                        RETURN CODE            @Z40RSGD 73346008
OPADDDSN DS    A                        ADDRESS DATA SET NAME  @Z40RSGD 73347608
OPADDVOL DS    A                        ADDRESS VOLSER         @Z40RSGD 73349208
         EJECT                                                          73350002
         CVT   DSECT=YES,PREFIX=YES,LIST=YES                     Y02076 84450002
CVTFIX   DSECT                                                   Y02049 84460002
CVT      EQU   CVTMAP                                            Y02049 84500002
         EJECT                                                          84600018
*                                                                       84700018
*                                                                       84800018
*   TASK CONTROL BLOCK                                                  84900018
*                                                                       85000018
*                                                                       85050002
         IKJTCB                                               Y02076    85100002
         EJECT                                                          87300018
         DCBD  DSORG=PS                                                 87400018
BLKCT    EQU   DCBBLKCT-IHADCB          DISPLACEMENT TO BLKCT IN DCB    87450002
*                                                                       87700018
*                                                                       87900018
*                                                                       88000018
         EJECT                                                 @G32DSPD 88500032
***      PSA        ***                                        @G32DSPD 89000032
         IHAPSA                                                @G32DSPD 89500032
         EJECT                                                 @G32DSPD 90000032
***      JSCB       ***                                        @G32DSPD 90500032
         IEZJSCB                                               @G32DSPD 91000032
         EJECT                                                          91500018
         IEEVRSWA  VER=3                AOS2 VERSION OF WA              91600000
SECSWICH EQU   RSERAS02                 WORK SPACE GOTTEN IND    Y02049 91650002
REG1SAVE EQU   RSERAS00                 REGISTER 1 SAVE AREA     Y02049 91660002
RST      EQU   RSERAS01                 TIOT ADR                 Y02049 91662002
RSJF     EQU   RSERAS03                 JFCB TTR                 Y02049 91664002
SSCRCMPA EQU   RSERAS09                 1ST SSCR BUFFER ADR     ZA00600 91670002
UCBWKTAB EQU   RSERAS05                 UCB WORK TABLE ADDRESS   Y02049 91680002
UCBINFO  EQU   RSERAS08                 UCB GETMAIN INFORMATION  Y02049 91682002
*                                       AND UCB ADDRESS COMPARE  Y02049 91690002
QMNPRMWA EQU   RSPPEL                   SAVE ADR OF QMNGR P.L.   Y02049 91692002
VSAMLOAD EQU   RSERAS01                 ADR EP LOC               Y02076 91694002
VSAMODAD EQU   RSERAS03                 ADR VSAM MODULE          Y02076 91696002
VSAMRTCD EQU   RSERAS04                 VSAM MODULE RETURN CODE  Y02076 91698002
REG8SAVE EQU   RSERAS06                 CONTENTS REG 8           Y02049 91698102
RSBUFADC EQU   RSERAS08                 BUFFER ADR PTR           Y02076 91698402
RTNCDPWC EQU   RSERAS07                 CONTENTS REG 10          Y02049 91698802
SECIOBAD EQU   RSERAS02                 ADR OF IOB SECLOADA      Y02049 91699602
SECCCWAD EQU   RSERAS03                 ADR OF CCW'S SECLOADA    Y02076 91699702
RSBUFADP EQU   RSERAS05                 PREV VSAM BUF ADR        Y02076 91699802
*                                                                       91700018
         END                                                            91800018
./  ADD  SSI=63230513,NAME=IGC0N06C
         GBLC  &LIB                                                     00100020
&LIB     SETC  'LIB1'                   SET VARIABLE TO LIB1            00200020
         TITLE 'IGC0N06C  RESCHEDULE I/O PHASE                         *00500018
                       RESUME I/O  CHECKPOINT-SVC 63  OS/360'           01000018
IGC0N06C CSECT                                                          01500018
*STATUS CHANGE LEVEL 000                                                06200002
*********************************************************************** 06500018
*                                                                     * 07000018
*                                                                     * 07500018
*FUNCTION/OPERATION- IGC0N06C PERFORMS THE FOLLOWING FUNCTIONS:       * 08000002
*     1.  LOADS THE VSAM MODULE (IDA0I96C) FOR CHECKPOINTING VSAM     * 08050037
*         DATA SETS, THEN WRITES THE RESULTANT VSAM SSCR RECORDS      * 08100002
*         TO THE CHECKPOINT DATA SET.                                 * 08150002
*                                                                     * 08200002
*     2.  CALLS IEFSSREQ MACRO FOR EACH SUBSYSTEM DATA SET THEN       * 08250002
*         WRITES EACH SUBSYSTEM SSCR TO THE CHECKPOINT DATA SET.      * 08300002
*                                                                     * 08350002
*     3.  FORMATS AND WRITES THE END RECORD TO THE CHECKPOINT DATA    * 08400002
*         SET FOR THE CURRENT CHECKPOINT ENTRY BEING GENERATED.       * 08450002
*                                                                     * 08650002
*     4.  RESTORES ANY I/O REQUESTS THAT WERE PURGED IN IGC0506C.     * 08700002
*                                                                     * 09500018
*ENTRY POINTS-IGC0N06C                                                * 10000002
*                                                                     * 10050002
*INPUT- WORK AREA ADDRESS IN REGISTER 1                               * 11000018
*     TASK CONTROL BLOCK ADDRESS IN WORKAREA FIELD 'CKTCBAD'          * 11500018
*                                                                     * 12000018
*OUTPUT- WORK AREA ADDRESS IN REGISTER 1                              * 12500002
*     VSAM AND SUBSYSTEM SSCRS, AND END RECORD WRITTEN TO CHKPT D/S   * 12550002
*     TASK CONTROL BLOCK ADDRESS IN WORKAREA FIELD 'CKTCBAD'          * 13000018
*                                                                     * 13500018
*EXTERNAL ROUTINES- VSAM MODULE (IDA0I96C)                            * 14000037
*                                                                     * 14500018
*EXITS-NORMAL- TO THE EXIT ROUTINE OF CHECKPOINT                      * 14800018
*                                                                     * 15100018
*     -ERRORS- TO THE EXIT ROUTINE OF CHECKPOINT                      * 15400002
*          ERRORS DETECTED:                                           * 15450002
*            RET.CODE  MSG.CODE  MSG.TYPE                             * 15500002
*              0C        023      I/O ERROR WRITING CHKPT DATA SET    * 15550002
*              08        027      EOV ERROR WRITING CHKPT DATA SET    * 15600002
*              0C        207      UNSUCCESSFUL IEFSSREQ (SUBSYS D/S)  * 15750002
*              18        215      UNSUCCESSFUL RESTORE                * 15800002
*                                                                     * 16000018
*CHANGE ACTIVITY                                                      * 16100037
*     OS/VS2 RELEASE 037 ADDS/DELETES/CHANGES                         * 16200037
*A566978                                                      @ZA13552* 16300037
*                                                                     * 16400037
*TABLES/WORKAREAS- CHECKPOINT WORK AREA (CHKWA), TCB, DEB, TIOT,      * 16500002
*     DSAB, CVT, DCB, JESCT, SSOB, SSIB, SSCR, CHECKPOINT PARM LIST   * 16600002
*                                                                     * 17000018
*ATTRIBUTES- READ ONLY, REENTERABLE AND PRIVILEGED                    * 17500018
*                                                                     * 18000018
*********************************************************************** 18050002
         EJECT                                                          18100002
*  REGISTERS USED                                                     * 18500018
*                                                                     * 19000018
RPM0     EQU   0                        PARAMETER REGISTER            * 19500018
RTCB     EQU   4                        ADDRESS OF TCB           Y02076 20000002
RBASE    EQU   2                        BASE REGISTER                 * 20500018
RDEB     EQU   3                        ADDRESS OF DEB                * 21000018
RIOB     EQU   5                        ADDRESS OF IOB                * 22000018
RWRK     EQU   6                        ADDRESS OF WORKAREA           * 22500018
RSVI     EQU   7                                                      * 23000018
RTPG     EQU   8                                                      * 23500018
RWK9     EQU   9                                                      * 24000018
RWKA     EQU   10                                                     * 24500018
RWKB     EQU   11                       WORK REGISTER                 * 25000018
RWKC     EQU   12                                                     * 25500018
REG13    EQU   13                       SAVE AREA POINTER             * 26000018
RET14    EQU   14                       RETURN REGISTER               * 26500018
RPM15    EQU   15                       PARAMETER REGISTER            * 27000018
*                                                                     * 27500018
*        MASKS                                                        * 28000018
*                                                                     * 28500018
NTPRGD   EQU   X'FF'                    TEST DEBUSRPG FOR NOT PURGED  * 29000018
TCAMID1  EQU   X'C0'                    UNIQUE TCAM DEB CODE     M3408  29100020
TCAMID2  EQU   X'CF'                    UNIQUE TCAM DEB CODE     M3408  29200020
*                                                                     * 29500018
*********************************************************************** 30000018
         EJECT                                                          30500018
         BALR  RBASE,0                  ESTABLISH BASE                  31000018
         USING *,RBASE                                           Y01909 31500000
         B     BEGIN               BRANCH AROUND EYE CATCHER     Y01909 31550000
         CNOP  0,8                 ALIGN TO A DBL WORD BOUNDARY  Y01909 31600000
         DC    C'IGC0N06C'         CSECT NAME                    Y01909 31650000
BEGIN    EQU   *                                                 Y01909 31700000
         USING TCB,RTCB                                                 32000018
         USING DEBBASIC,RDEB                                     Y02076 32500002
         USING CHKWA,RWRK                                               33000018
         USING CHKIOWA,RWKB                                             33500018
         USING IHADCB,RWKC                                       Y02076 33510002
         LR    RWRK,R1                  SET CHKPT WA BASE REG    Y02076 33520002
         LR    RWKB,RWRK                CALC ADDR OF XCTL WA     Y02076 33530002
         A     RWKB,CKWAOFST            ADD OFFSET               Y02076 33540002
         MVC   LIST(E8),XADDR           NEXT MODULE FOR XCTL     Y02076 33542002
         ST    RWKB,CKERAS04            SAVE XCTL WA ADDRESS     Y02076 33544002
         L     RWKC,CKDCBAD             GET CHKPT DCB ADDR       Y02076 33546002
         LA    R1,RESYNAD               GET ADR OF SYNAD RTN     Y02076 33548002
         STCM  R1,ADDRBYTS,DCBSYNAD+E1  ST IN CHKPT DS DCB       Y02076 33548402
         LA    REG13,CKREGSAV           INIT REG SAVEAREA ADDR   YM6584 33548502
         DROP  RWKC                                              Y02076 33548802
         NI    CKFLAG2,VSAMOFF          TURN OFF VSAM LOAD FLAG  Y02076 33548902
         L     RTCB,CKTCBAD             GET ADR OF TCB           Y02076 33549002
*********************************************************************** 33549902
*     PREPARE TO WRITE OUT VSAM SSCR RECORDS ON CHECKPOINT DATA SET   * 33566602
*********************************************************************** 33576602
         MVC   CKLNGTH1(E2),BLOCKLNG+E1 SET WRITE RECORD TO 4K @Z30SSDT 33583337
         XC    CKSSCR(E4),CKSSCR        CLEAR SSCR ANCHOR FIELD  Y02076 33600002
         MVC   VSAMLOAD(E8),VSAMODUL    MOVE VSAM MODULE NAME IN Y02076 33650002
         LOAD  EPLOC=VSAMLOAD           LOAD VSAM MODULE         Y02076 33700002
         ST    R0,VSAMLOAD+E8           SETUP FOR VSAM MODULE    Y02076 33750002
         MVI   VSAMLOAD+E8,E0           CLEAR HIGH ORDER BYTE  @OZ03934 33800037
         OI    CKFLAG2,VSAMON           TURN ON VSAM LOAD FLAG   Y02076 33810002
         L     RPM15,VSAMLOAD+E8        GET ADDR OF VSAM ROUTINE Y02076 33900002
         LR    R1,RWRK                  SET REG 1=W. A. ADDR     Y02076 33910002
         BALR  RET14,RPM15              GO TO VSAM ROUTINE       Y02076 33950002
         LTR   RPM15,RPM15              TEST FOR ERROR RETURN  @Z30SSDT 33970037
         BNZ   RESIOB                   BR IF ERROR FROM VSAM  @Z30SSDT 33990037
         OC    CKSSCR(E4),CKSSCR        ANY VSAM SSCRS         @Z30SSDT 33994037
         BZ    RESIO500                 NO-PROCESS SS & VAM DATA Y02076 33996002
         L     RWKC,CKSSCR              GET ADR OF 1ST SSCR      Y02076 33998402
         USING SSCR,RWKC                                         Y02076 33998802
RESIOA   ST    RWKC,CMBUF               STORE ADR OF SSCR      @Z30SSDT 33999237
         BAL   R7,C13B2A                GO WRITE OUT SSCR        Y02076 33999602
         L     RWKC,SSCRFCHN            GET ADR OF NEXT SSCR     Y02076 33999702
         LTR   RWKC,RWKC                ANY MORE SSCRS           Y02076 33999802
         BNZ   RESIOA                   BRANCH IF YES          @Z30SSDT 33999937
*********************************************************************** 34049937
*   FREEMAIN SSCRS AND DELETE VSAM MODULE                        Y02076 34059902
*********************************************************************** 34069937
RESIOB   ICM   RPM0,ADDRBYTS,BLOCKLNG   SET UP 0 FOR FREEMAIN  @Z30SSDT 34079937
         ICM   RPM0,HIORDER,SP253                                Y02076 34091902
         L     RWKC,CKSSCR              GET FIRST SSCR BLOCK     Y02076 34093902
RESIOC   LTR   RWKC,RWKC                TEST IF THERE IS ONE     Y02076 34097902
         BZ    RESIOD                   BRANCH IF ALL DONE     @Z30SSDT 34098337
         L     R1,SSCRFCHN              GET ADDR OF NEXT SSCR    Y02076 34098402
         ST    R1,CKSSCR                STORE AT TOP OF CHAIN    Y02076 34098502
         FREEMAIN  R,LV=(RPM0),A=(RWKC) FREE UP THE BLOCK        Y02076 34098702
         L     RWKC,CKSSCR              GET NEXT SSCR BLOCK      Y02076 34099102
         B     RESIOC                   GO TO FREE UP NEXT BLOCK Y02076 34099502
RESIOD   CLI   CKRETCOD+E1,CKPSBERR     PROB ERROR BEEN SET    @Z30SSDT 34099637
         BE    RESIO500                 CONTINUE IF YES        @Z30SSDT 34099737
         CLI   CKRETCOD+E1,E0           ANY OTHER ERRORS       @Z30SSDT 34116437
         BE    RESIO500                 CONTINUE IF NOT        @Z30SSDT 34126437
         B     RESUMEIO                 BR TO RESTORE IF ERROR @Z30SSDT 34128437
*********************************************************************** 38970802
*    OBTAIN CHAIN OF DEBS FROM TCB FOR RESTORING I/O THAT WAS PURGED  * 38980802
*********************************************************************** 38990802
RESUMEIO EQU   *                        PREPARE TO RESTORE I/O   Y02076 38992802
         L     RWKB,CKERAS04            GET PTR TO XCTL WA       Y02076 38994802
         L     RDEB,TCBDEB              GET ADDR OF FIRST DEB FROM TCB  39000018
RESIO010 LTR   RDEB,RDEB                TEST FOR END OF DEB CHAIN       39500018
         BZ    RESIO030                 IF DONE GO TO EXIT       Y02076 40000002
         LR    RWKC,RDEB                GET ADDR OF DEB BASIC    Y02076 40050002
         LA    RWKA,DEBPRFLN            GET DEB PREFIX LENGTH    Y02076 40060002
         SR    RWKC,RWKA                CALC. DEB PREFIX ADR     Y02076 40070002
         USING DEBPREFX,RWKC                                     Y02076 40080002
         CLI   DEBAMTYP,VSAMIDCD        IS IT VSAM               Y02076 40090002
         BE    RESIO020                 Y-BYPASS RESTORE         Y02076 40092002
         L     RWKA,DEBXTNP             GET DEB EXT. ADR         Y02076 40094002
         DROP  RWKC                                              Y02076 40096002
         USING DEBXTN,RWKA                                       Y02076 40098002
         L     RWKA,DEBXDSAB-DEBXTN(,RWKA)  GET ADR OF DSAB      Y02076 40098402
         USING DSAB,RWKA                                         Y02076 40098802
         L     RWKA,DSABTIOT-DSAB(,RWKA)  GET ADR OF DD ENTRY    Y02076 40099202
         USING TIOENTRY,RWKA                                     Y02076 40099602
         TM    TIOELINK,TIOESSDS        IS IT A SS DATA SET      Y02076 40099702
         BO    RESIO020                 IF YES - BYPASS RESTORE  Y02076 40099802
         DROP  RWKA                                              Y02076 40099902
         CLI   DEBEXSCL,DUMMYDEB        IS IT A DUMMY DEB        Y02076 40133202
         BNE   RESIO015                 BRANCH IF NO             Y02076 40143202
         TM    DEBFLGS1,DEBCINDI        TEST FOR CI BIT SET      Y02076 40153202
         BO    RESIO020                 IF ON - BYPASS RESTORE   Y02076 40163202
RESIO015 EQU   *                        ANY TCAM DATA SETS OPEN  Y02076 40165202
         CLI   DEBNMSUB,TCAMID1         Q - TCAM DEB (TYPE 1)    M3408  40166702
         BE    RESIO020                 IF YES, SKIP THIS DEB    M3408  40200020
         CLI   DEBNMSUB,TCAMID2         Q - TCAM DEB (TYPE 2)    M3408  40300020
         BE    RESIO020                 IF YES, SKIP THIS DEB    M3408  40400020
*                                                                     * 42000018
         L     RIOB,DEBUSRPG            ADDR OF 1ST IOB IN PURGE CHAIN  42500018
         LA    RIOB,0(0,RIOB)           CLEAR HIGH ORDER BITS           43000018
         LTR   RIOB,RIOB                TEST IF PURGE ISSUED AT ALL     43500018
         BZ    RESIO020                 IF NO PURGE GO GET NEXT DEB     44000018
*                                                                     * 44500018
*                                                                     * 45000018
*  SET UP FOR RESTORE                                                 * 45500018
*                                                                     * 46000018
*                                                                     * 47000018
RESIO017 EQU *                          PREPARE FOR RESTORE      Y02076 47050002
         CLC   DEBUSRPG+E1(E3),NOIOPRGD WERE I/O REQUESTS PURGED Y02076 47100002
         BE    RESIO020                 GET NEXT DEB IF NO PURGE Y02076 47150002
         LA    R1,DEBUSRPG              R1 PTS TO PIRL POINTER   Y02076 47200002
         L     RWKC,E0(R1)              GET ADDR OF PIRL OPT BYT Y02076 47250002
         MVI   E0(RWKC),RESPOPTB        SET PIRL OPT BYT FOR RES Y02076 47300002
         RESTORE DEBUSRPG               RESTORE PURGED I/O       Y02076 47350002
         LA    RWKA,RESRETCD            GET BAD RESTORE CODE     Y02076 47400002
         CR    RWKA,RPM15               WAS RESTORE UNSUCCESFUL  Y02076 47450002
         BNE   RESIO020                 BR IF SUCESS FOR NXT DEB Y02076 47460002
         CLI   CKRETCOD+E1,E0           ERRORS DETECTED BEFORE   Y02076 47462002
         BNE   RESIO019                 BRANCH IF YES            Y02076 47464002
         MVI   CKMSGCOD+E1,ERR215       SET RESTORE ERROR CODE   Y02076 47470002
         MVI   CKMSGCOD,E2              SET ERROR MSG SHELL CODE Y02076 47472002
         MVI   CKRETCOD+E1,RESTERCD     SET RESTORE ERR(18) CODE Y02076 47474002
         B     RESIO030                 BRANCH TO EXIT           Y02076 47480002
RESIO019 MVI   CKRETCOD,RESTERCD        REST ERR CODE TO 1ST BYT Y02076 47490002
         B     RESIO030                 BRANCH TO EXIT           Y02076 47494002
***                                                                 *** 47500018
*                                                                     * 48000018
*  GET NEXT DEB FROM CHAIN                                            * 48500018
*                                                                     * 49000018
RESIO020 L     RDEB,DEBDEBAD            GET ADDRESS OF PREVIOUS DEB     49500018
         LA    RDEB,0(0,RDEB)           CLEAR HIGH ORDER BITS           50000018
         B     RESIO010                 GO GET NEXT DEB                 50500018
*                                                                     * 51000018
***                                                                 *** 51500018
*                                                                     * 52000018
RESIO030 EQU   *                                                        52500018
         TM    CKFLAG2,VSAMON           WAS VSAM MODULE LOADED   Y02076 52550002
         BZ    RESIO035                 BRANCH IF NO             Y02076 52600002
         DELETE  EPLOC=VSAMLOAD         DELETE VSAM MODULE       Y02076 52650002
         NI    CKFLAG2,VSAMOFF          TURN OFF VSAM LOAD FLAG  Y02076 52700002
RESIO035 EQU   *                        SET UP FOR EXIT          Y02076 52750002
         LR    R1,RWRK                  RELOAD ADDR OF PASSED WA Y02076 53000002
         L     RWKB,CKERAS04      GET PTR TO XCTL PARM LIST      YM7306 53010002
         LA    RPM15,LIST               GET ADR OF XCTL P.L.     Y02076 53050002
         ST    RPM15,LIST+8             STORE IN XCTL LIST       Y02076 53100002
         LA    RPM15,LIST+8             TELL XCTL WHERE TO GO           54500018
*                                                                     * 55000018
         XCTL  EPLOC=(RWKB),SF=(E,(15)) TO CHECKPOINT ROUTINE           55500018
*                                                                     * 56000018
*********************************************************************** 56010002
*  PREPARE TO WRITE SUBSYSTEM DATA SET SSCRS TO CHECKPOINT DATA SET   * 56020002
*********************************************************************** 56030002
RESIO500 EQU   *                        ACCESS DEB CHAIN         Y02076 56050002
         L     RDEB,TCBDEB              GET ADDR OF 1ST DEB      Y02076 56100002
RESIO502 EQU   *                        PROCESS DEB              Y02076 56110002
         LTR   RDEB,RDEB                END OF DEB CHAIN         Y02076 56120002
         BZ    ENDRECA                  BRANCH IF YES            Y02076 56130002
         LR    RWKC,RDEB                GET ADDR OF DEB BASIC    Y02076 56150002
         LA    RWKA,DEBPRFLN            GET LENGTH OF DEB PREFIX Y02076 56200002
         SR    RWKC,RWKA                CALC. ADDR OF DEB PREFIX Y02076 56250002
         USING DEBPREFX,RWKC                                     Y02076 56300002
         L     RWKA,DEBXTNP             GET DEB EXT POINTER      Y02076 56350002
         USING DEBXTN,RWKA                                       Y02076 56400002
         L     RWKA,DEBXDSAB-DEBXTN(,RWKA)  GET ADR OF DSAB      Y02076 56450002
         USING DSAB,RWKA                                         Y02076 56460002
         L     RWKA,DSABTIOT-DSAB(,RWKA)   GET ADR OF DD ENTRY   Y02076 56470002
         USING TIOENTRY,RWKA                                     Y02076 56480002
         TM    TIOELINK,TIOESSDS        IS IT A SS DATA SET      Y02076 56490002
         BO    RESIO510                 BRANCH IF A SS DATA SET  Y02076 56492002
RESIO505 EQU   *                        BEGIN DEB PROCESSING     Y02076 56492402
         L     RDEB,DEBDEBAD            GET NEXT DEB ADR         Y02076 56492802
         LA    RDEB,0(RDEB)             CLEAR HI ORDER BYTE      Y02076 56493202
         B     RESIO502                 BRANCH IF MORE DEBS      Y02076 56493602
RESIO510 EQU   *                        CHKPT SUBSYS DATA SETS   Y02076 56503902
**********************************************************************  56508502
*   INITIALIZE FOR THE IEFSSREQ MACRO TO CHECKPOINT SUBSYSTEM DATA   *  56513102
*         SETS                                                   Y02076 56517702
*********************************************************************** 56522302
         LR    RWK9,RDEB                GET ADR DEBBASIC         Y02076 56532302
         LA    RWK9,DEBBASND            END OF DEBBASIC SECT     Y02076 56542302
         LA    RWK9,E4(RWK9)            ADDR OF SSIB             Y02076 56544302
         USING SSIB,RWK9                SSIB ADDRESSABILITY      Y02076 56544702
         AH    RWK9,SSIBLEN             ADDR OF SSOB             Y02076 56545102
         ST    RWK9,SSREQPRM            SAVE IN PARM WORD        Y02076 56545202
         MVI   SSREQPRM,HIORDER2        SET HIORDER BIT-PARM WD  Y02076 56548802
         USING SSOB,RWK9                                         Y02076 56552702
         MVI   SSOBFUNC+E1,SSOBCKPT     SET CHKPT FUNCTION       Y02076 56556302
         ICM   RPM0,ADDRBYTS,BLOCKLNG   SET UP REG 0 FOR GETMAIN Y02076 56559902
         ICM   RPM0,HIORDER,SP253       SET SUBPOOL NO.          Y02076 56569902
         GETMAIN  R,LV=(RPM0)           GET 4K BUFR FOR IEFSSREQ Y02076 56579902
         ST    R1,CMBUF                 BLOCK ADR TO WRITE SSCR  Y02076 56593902
         LR    RWKB,R1                  ADR OF SSCR IN RWKB      Y02076 56595902
         USING SSCR,RWKB                                         Y02076 56597902
         LA    R0,SSCRDATA              GET DATA ADR SUB SYS SSCRVS4685 56598002
         ST    R0,SSDABUFR              STORE IT IN SS0B         VS4685 56598102
         MVI   SSCRID,SSCRIDCK          SET CHKPT ID IN SSCR     Y02076 56598302
         MVI   SSCRSSID,SSCRSS          SET SUBSYS ID IN SSCR    Y02076 56598702
         OI    SSCRFLG1,SSCRCKRS        SET CHECKPOINT BIT       Y02076 56599102
         XC    SSCRFCHN,SSCRFCHN        CLEAR CHAIN FIELD        Y02076 56599502
         XC    SSCRDATL,SSCRDATL        CLEAR DATA LENGTH FIELD  Y02076 56599602
         XC    SSCRDCBA,SSCRDCBA        CLEAR DCB ADDR FIELD     Y02076 56599702
         LA    R1,SSREQPRM              IEFSSREQ PRM WRD ADR-R1  Y02076 56599802
         IEFSSREQ                       GET SUBSYSTEM CHKPT DATA Y02076 56679802
         LTR   RPM15,RPM15              TEST RETURN CODE         Y02076 56689802
         BNZ   RESIO520                 BR TO SET ERR CODE       Y02076 56691802
         OC    SSOBRETN,SSOBRETN        TEST SSOB RETURN CODE    Y02076 56693802
         BZ    RESIO525                 BRANCH IF SUCCESSFUL     Y02076 56695802
RESIO520 MVI   CKMSGCOD+E1,ERRMSGC3     SET ERR CODE =207        Y02076 56697802
         MVI   CKRETCOD+E1,CKIOERR      SET SUBSYSTEM FAILURE  @ZA13552 56697937
         MVI   CKMSGCOD,E3              SET INVLD MSG SHELL CODE Y02076 56698037
         B     RESUMEIO                 BRANCH TO ERROR EXIT     Y02076 56698202
RESIO525 EQU   *                        CALL WRITE ROUTINE       YM5721 56698602
         MVC   SSCRDCBA,DEBDCBAD        MOVE DCBADDR IN SSCR     Y02076 56709702
         BAL   R7,C13B2A                BR TO WRITE OUT SSCR     Y02076 56749702
         L     R1,CMBUF                 GET ADR OF 4K BUFFER     VS4685 56751702
         ICM   R0,ADDRBYTS,BLOCKLNG     SET UP R0 FOR FREEMAIN   Y02076 56753702
         ICM   R0,HIORDER,SP253         SET SUBPOOL 253          Y02076 56755702
         FREEMAIN  R,LV=(R0),A=(R1)     FREEUP THE 4K BLOCK      Y02076 56757702
         B     RESIO505                 GO GET NEXT DEB          Y02076 56759702
*********************************************************************** 56769702
*       WRITE ROUTINE FOR THE CHECKPOINT DATA SET                     * 56771702
*********************************************************************** 56773702
C13B2A   EQU   *                        WRITE ROUTINE            Y02076 56779702
         L     RA,CMBUF                 INIT START OF BUFFER     Y02076 56789702
         TM    CKFLAG1,CKVEQR           IS THIS TASK V=R?        Y02076 56791702
CKVEQR   EQU   X'08'                    V=R FLAG IN W.A.         YM7393 56793702
         BNO   CKNOVEQR                 NO, GO ON                Y02076 56795702
         LRA   RA,E0(,RA)               GET REAL ADDR OF BUFFER  Y02076 56797702
CKNOVEQR EQU   *                        ISSUE WRITE              Y02076 56798102
         WRITE CKDECB1,SF,,(E10),MF=E                            Y02076 56798502
         CHECK CKDECB1                  ISSUE CHECK              Y02076 56798902
         TM    CKFLAG1,CKTAPE           CHKPT DATA SET ON TAPE   Y02076 56799302
         BZ    CMEOVDA                  BRANCH IF NO             Y02076 56799402
         L     RF,CKTSTEOV                                       Y02076 56799502
         CLC   E0(E4,RF),CKEOVCMR       DID EOV OCCUR            Y02076 56799602
         BNE   CMEOV                    BRANCH IF YES            Y02076 56849602
CMTIOTST EQU   *                        DID I/O ERROR OCCUR      Y02076 56859602
         CLI   CKRETCOD+E1,CKIOERR      I/O ERROR                Y02076 56869602
         BE    CMTIOTSA                 BRANCH TO SET CODE       Y02076 56879602
         BR    R7                       RETURN                   Y02076 56889602
CMTIOTSA LA    RF,CKERIO3               I/O ERROR MSG CODE       Y02076 56891602
         STH   RF,CKMSGCOD              STORE IN WORK AREA       Y02076 56892002
         B     RESUMEIO                 BRANCH TO EXIT           Y02076 56892402
         EJECT                                                   Y02076 56893602
*                                                                Y02076 56895602
*        END OF VOLUME TESTING                                   Y02076 56897602
*                                                                Y02076 56898002
CMEOV    EQU   *                        END OF VOLUME TESTS      Y02076 56898402
         TM    CKFLAG2,CKEOV            2ND EOV FOR THIS REQUEST Y02076 56898802
         BO    CMEOVER                  YES- GO TO EXIT RTN      Y02076 56899202
         OI    CKFLAG2,CKEOV            TURN ON EOV INDICATOR    Y02076 56899302
         L     RWKB,CKERAS04            GET PTR TO XCTL WA       Y02076 56899402
         USING CHKIOWA,RWKB                                      Y02076 56909502
         MVI   LIST+E4,F2               SET TO XCTL TO 206C      Y02076 56910602
         B     RESIO030                 XCTL INTERFACE           Y02076 56921802
CMEOVDA  EQU   *                        TEST EOV ON DA DEVICE    Y02076 56933002
         USING IHADCB,RF                DCB                      Y02076 56943002
         L     RF,CKDCBAD               GET ADR. OF CHKPT DCB    Y02076 56953002
         L     RF,DCBDEBAD              GET ADR. OF CHKPT DEB    Y02076 56963002
         DROP  RF                       DCB                      Y02076 56965002
         USING DEBBASIC,RF              DEB                      Y02076 56965402
         CLC   DEBNMEXT(E1),CKTSTEOV                             Y02076 56965802
*                                       DID EOV OCCUR ON DA DEV. Y02076 56966202
         BE    CMTIOTST                 NO- CONTINUE PROCESSING  Y02076 56966302
         DROP  RF                       DEB                      Y02076 56966402
CMEOVER  EQU   *                        SET EOV ERROR            Y02076 56977602
         LA    RF,CKERIO7               INDICATE EOV ERROR       Y02076 56987602
         STH   RF,CKMSGCOD              PUT IN W.A.              Y02076 56988002
         MVI   CKRETCOD+E1,E8           PUT IN RETURN CODE ERR   Y02076 56988402
         B     RESIO030                 XCTL INTERFACE           Y02076 56988502
RESYNAD  MVI   CKRETCOD+E1,CKIOERR      RTN TO SET I/O ERROR     Y02076 56988602
         BR    RE                       RETURN                   Y02076 56989502
*********************************************************************** 56991902
*     THIS ROUTINE WRITES OUT THE CHECKPOINT END RECORD          Y02076 56992802
*********************************************************************** 56993702
ENDRECA  EQU   *                        WRITE END RECORD         Y02076 56994602
         L     RWKB,CKBFOFST            GET ADR  END RECORD BUFF Y02076 56995502
         AR    RWKB,RWRK                GET ABS ADR OF BUFFER    Y02076 56995902
         XC    E0(E20,RWKB),E0(RWKB)    CLEAR END RECORD BUFFER  Y02076 56996402
         MVC   E0(E2,RWKB),ENDRECID     MOVE FFFF INTO ID BYTE   Y02076 56997302
         MVI   E4(RWKB),SPACE           BLANK OUT CHECKID        Y02076 56998202
         MVC   E5(E15,RWKB),E4(RWKB)       FIELD OF END RECORD   Y02076 56999102
         TM    CKFLAG2,CKUSPCHD         DID USER SUPPLY CHECKID  Y02076 57000002
         BZ    ENDRECB                  BR IF NO TO MOVE GEN ID  Y02076 57046202
         L     RWKC,CKPARMAD            GET ADR OF CHKPT PARMLST Y02076 57056202
         USING PARMSECT,RWKC                                     Y02076 57066202
         L     RWK9,IDADDR              GET LNGTH & ADR OF ID    Y02076 57076202
         LR    RTPG,RWK9                LNGTH & ID ADR IN REG8   Y02076 57086202
         SRL   RTPG,E24                 SHIFT OUT ADDR           Y02076 57088202
         BCTR  RTPG,E0                  REDUCE LNGTH BY 1 FOR EX Y02076 57090202
         LA    RWK9,E0(RWK9)            CLEAR HI ORDER BYTE ADR  Y02076 57092202
         EX    RTPG,IDMOVE              EXECUTE MOVE INSTRUCTION Y02076 57094202
         B     ENDRECC                  BR TO WRITE              Y02076 57094602
ENDRECB  EQU   *                        MOVE IN GEN. CHECKID     Y02076 57095002
         LA    RWK9,CKCHEKID            GET ADR - GEN. CHECKID   Y02076 57095402
         MVC   E4(E8,RWKB),E0(RWK9)     MOVE CHECKID TO RECORD   Y02076 57095802
ENDRECC  EQU   *                        PREPARE FOR WRITE        Y02076 57095902
         ST    RWKB,CMBUF               STORE END REC BUFF ADR   Y02076 57096002
         BAL   R7,C13B2A                WRITE END OF CKPT RECORD Y02076 57122802
         B     RESUMEIO                 GO TO RESTORE PURG'D IO ZA00617 57124802
***                                                                 *** 57129502
*                                                                     * 57146202
XADDR    DC    CL8'IGC0Q06C'            CHECKPOINT EXIT ROUTINE         57500018
IDMOVE   MVC   E4(E1,RWKB),E0(RWK9)     MVC INSTR FOR EXECUTE    Y02076 57550002
NOIOPRGD DC    XL3'FFFFFF'              'NO I/O REQSTS PRGD' IND Y02076 57600002
ENDRECID DC    XL2'FFFF'                ID FOR END OF CHKPT REC  Y02076 57650002
*                                                                     * 58000018
*                                                                     * 59000018
*********************************************************************** 59500018
*                                                                     * 59550000
*        MAINTENANCE SPACE                                       Y01909 59600000
*                                                                     * 59650000
PATCH    DC    XL((*-IGC0N06C)/20)'00'   FIVE PERCENT SPACE      Y01909 59700000
*                                                                     * 59750000
*********************************************************************** 60000018
DEBPRFLN EQU   16                       LNGTH OF DEB PREFIX      Y02076 60050002
VSAMIDCD EQU   X'01'                    VSAM ID CODE             Y02076 60100002
DUMMYDEB EQU   X'00'                    DUMMY DEB CODE(DEBEXSCL) Y02076 60150002
ERRMSGC3 EQU   207                      SS INTERFACE ERR CODE    Y02076 60310002
HIORDER2 EQU   X'80'                    HI ORDER BYTE BIT        Y02076 60320002
HIORDER  EQU   8                        HI ORDER BYTE MASK       Y02076 60322002
ADDRBYTS EQU   7                        ADDRESS BYTES MASK       Y02076 60330002
E0       EQU   0                        CONSTANT 0               Y02076 60330402
E1       EQU   1                        CONSTANT 1               Y02076 60330802
E2       EQU   2                        CONSTANT 2               Y02076 60330902
E3       EQU   3                        CONSTANT 3               Y02076 60331502
E4       EQU   4                        CONSTANT 4               Y02076 60331602
E5       EQU   5                        CONSTANT 5               Y02076 60331702
E6       EQU   6                        CONSTANT 6               Y02076 60331802
E7       EQU   7                        CONSTANT 7               Y02076 60332302
E8       EQU   8                        CONSTANT 8               Y02076 60333802
E9       EQU   9                        CONSTANT 9               Y02076 60334202
E10      EQU   10                       CONSTANT 10              Y02076 60334302
E15      EQU   15                       CONSTANT 15              Y02076 60334702
E20      EQU   20                       CONSTANT 20              Y02076 60334902
E24      EQU   24                       CONSTANT 24              Y02076 60335402
SPACE    EQU   X'40'                    SPACE                    Y02076 60335502
ENDRECLN EQU   20                       LNGTH OF CHKPT END REC.  Y02076 60335702
RESPOPTB EQU   X'C0'                    PIRL OPT BYT FOR RESTORE Y02076 60335802
VSAMOFF  EQU   X'BF'                    TURN OFF VSAM LOAD MASK  Y02076 60336302
VSAMON   EQU   X'40'                    TURN ON VSAM LOAD MASK   Y02076 60336702
RESTERCD EQU   X'18'                    RESTORE ERR RETURN CODE  Y02076 60337102
RESRETCD EQU   4                        BAD RESTORE RETURN CODE  Y02076 60337802
ERR215   EQU   215                      ERR CODE FOR BAD RESTORE Y02076 60338402
C2       EQU   C'2'                     CHAR 2                   Y02076 60339002
F2       EQU   X'F2'                    FOR XCTL TO IGC0206C     Y02076 60339602
CKERIO3  EQU   X'0317'                  CHKPT D/S WRITE ERR      Y02076 60340202
CKERIO7  EQU   X'031B'                  EOV ERR MSG CODE         Y02076 60340802
VSAMODUL DC    C'IDA0I96C'              VSAM MODULE NAME       @Z30SSDT 60341437
BLOCKLNG DC    AL3(4096)                SSCR BLOCK LENGTH        Y02076 60342002
SP253    DC    AL1(253)                 SUBPOOL NO.              Y02076 60342302
SSCR     DSECT                                                   Y02076 60343902
SSCRID   DS    C                        SSCR RECORD ID           Y02076 60345502
SSCRIDCK EQU   X'01'                    CHECKPOINT ID            Y02076 60347102
SSCRSSID DS    C                        SUBSYSTEM ID             Y02076 60348702
SSCRSS   EQU   X'00'                    SUBSYSTEM                Y02076 60350302
SSCRVSAM EQU   X'01'                    VSAM                     Y02076 60351902
SSCRSPIE EQU   X'02'                    SPIE                     Y02076 60353502
SSCRHDRL DS    H                        HDR LNGTH(OFSET TO DATA) Y02076 60355102
SSCRFCHN DS    F                        CHAIN PTR TO XTRA SSCRS  Y02076 60365502
SSCRFLG1 DS    C                        FLAG BYTE                Y02076 60365902
SSCRCKRS EQU   X'80'                    CHECKPOINT TIME          Y02076 60366302
SSCRDATL DS    H                        DATA LENGTH              Y02076 60370002
SSCRDCBA DS    F                        ADDR OF ASSOC. DCB       Y02076 60372002
SSCRDATA DS    F                        1ST WORD DATA AREA       Y02076 60372402
PARMSECT DSECT                                                   Y02076 60372802
PARMFLG  DS    1C                       FLAG                     Y02076 60373202
PARMDCB  DS    3C                       DCB ADDR                 Y02076 60373602
IDADDR   DS    0F                       CHECKID ADDRESS          Y02076 60373702
LNCHKID  DS    1C                       CHECKID LENGTH           Y02076 60373802
         DS    3C                       ADDR OF CHECKID          Y02076 60377502
         IEFJSSOB   (DA),CONTIG=YES                              Y02076 60381402
         IEFJSSIB                                                Y02076 60385102
         IEZDEB                                                  Y02076 60388802
         IEFTIOT1                                                Y02076 60398802
         CVT   DSECT=YES,PREFIX=YES,LIST=YES                     Y02076 60398902
         IEFJESCT                                                Y02076 60408902
         DCBD  DSORG=(BS,PO),DEVD=(DA,TA)                        Y02076 60410902
         IHADSAB                                                 Y02076 60629502
         EJECT                                                          60646202
TCB      DSECT      TASK CONTROL BLOCK                                  81000018
*                                                                       81500018
TCBRBP   DS    A                       POINTER TO EXECUTING RB          82000018
TCBPIE   DS    A                       POINTER TO PROG. INTERRUPT EL.   82500018
TCBDEB   DS    A                       POINTER TO DEB QUEUE             83000018
TCBTIO   DS    A                       POINTER TO TIOT                  83500018
TCBCMP   DS    F                       TASK COMPLETION CODE             84000018
TCBTRN   DS    A                       TESTRAN FIELD                    84500018
TCBMSS   DS    A                       DATA BLOCK QUEUE ELEMENT POINTER 85000018
TCBPRTK  DS    BL1                     PROTECTION TAG                   85500018
TCBFLGS  DS    BL5                     FLAG BYTES                       86000018
TCBLMP   DS    BL1                     LIMIT PRIORITY                   86500018
TCBDSP   DS    BL1                     DISPATCHING PRIORITY             87000018
TCBLLS   DS    A                       POINTER TO LOAD LIST             87500018
TCBJLB   DS    A                       POINTER TO JOBLIB DCB            88000018
TCBJSE   DS    A                       LIST OF INACTIVE PROGRAMS ADDR.  88500018
TCBGRS   DS    16F                     GENERAL REGISTER SAVE AREA       89000018
TCBIDF   DS    0BL1                    TCB IDENTIFIER FIELD             89500018
TCBFSA   DS    A                       POINTER TO 1ST PROB.PROG.SAVEAR  90000018
TCBTCB   DS    A                       NEXT TCB ON READY QUEUE POINTER  90500018
TCBTME   DS    A                       POINTER TO TIMER ELEMENT         91000018
*                                                                       91500018
*                                                                       92000018
*                                                                       92500018
*                                                                       93000018
CHKIOWA  DSECT      CHECKIO'S WORK AREA                                 93500018
*                                                                       94000018
LIST     DS    3F   AREA WHERE ENTRY POINT NAME IS STORED               94500018
         EJECT                                                          95000018
         IEEVCHWA VER=3                 USE AOS2 VERSION OF WA          95550000
*                                                                       96000018
**********************************************************************  96500018
SSREQPRM EQU   CKERAS05                 CONTAINS SSOB ADDR       Y02076 96550002
CMBUF    EQU   CKERAS06                 OUTPUT BUFFER ADDR       Y02076 96600002
VSAMLOAD EQU   CKERAS00                 VSAM MODULE NAME         Y02076 96650002
CKTSTEOV EQU   CKUNIT                   END OF VOLUME TEST       Y02076 96750002
CKEOVCMR EQU   CKUNIT+4                 END OF VOLUME TEST       Y02076 96800002
         END   IGC0N06C                                                 97500018
./  ADD  SSI=41641232,NAME=IGC0P05B
         GBLC  &LIB                                                     00030020
&LIB     SETC  'LIB1'                   SET VARIABLE TO LIB1            00060020
         TITLE 'IGC0P05B DATA SET PROCESSOR - NON-DA TABLE REFORMATTINGX00100019
                   REPOSITION I/O  RESTART - SVC 52  OS/360'            00200019
IGC0P05B CSECT                                                          00300019
*                                                                       00400019
*                                                                       00500019
*          RELEASE 21 DELETIONS/CHANGES                                 00600019
*0794334000-335000                                               S21040 00650021
*          RELEASE 20 DELETIONS/CHANGES                                 00700019
*          RELEASE 19 - COMPLETE REVISION                               00800019
* 365000,369000,372000                                           M4887  00900019
* 215000,415000                                                  M3525  01000019
*                                                                       01100019
*                                                                       01200019
*STATUS CHANGE LEVEL 004                                                01300021
*                                                                       01400019
*********************************************************************** 01500019
*                                                                       01600019
*TITLE - NON DA TABLE REFORMATTING                                      01700019
*                                                                       01800019
*FUNCTION/OPERATION - A.  REFORMAT BUFFER SEGMENTS (RSDSECT) INTO 200   01900002
*                         BYTE WORK AREAS.  DO A CONDITIONAL GETMAIN    02000019
*                         IF NECESSARY TO TRY TO ALLOT ONE 200 BYTE     02100002
*                         AREA TO EACH TAPE DATA SET OPEN AT CHKPT TIME 02200019
*                                                                       02300019
*                     B.  FORM A LOGICAL LINK BETWEEN TABL ELEMENTS     02400019
*                         AND THE NEW WORK AREAS, IE. A POINTER TO A    02500019
*                         WORK AREA IN EACH TABL ELEMENT THAT REPRESENT 02600019
*                         A TAPE DATA SET.                              02700019
*                                                                       02800019
*                     C.  TEST EACH TAPE ENTRY FOR DOS TAPE OPTIONS     02810021
*                         (BYPASS OPTIONAL LEADING TAPE MARK AND/OR     02820021
*                         BYPASS EMBEDDED CHKPT RCDS).  TABFLG1 BIT     02830021
*                         7 WILL BE SET FOR THESE ENTRIES TO INDICATE   02840021
*                         THAT THEY ARE TO BE POSITIONED BY IGC0U05B.   02850021
*                         ONLY THE FIRST 3 WORK AREA SEGMENTS WILL BE   02860021
*                         USED FOR THESE ENTRIES, WITH THE FOURTH       02870021
*                         USED AS A BUFFER IN IGC0U05B.                 02880021
*                                                                       02890021
*ENTRY POINTS - IGC0P05B - INITIAL ENTRY TO THIS MODULE BY MEANS OF AN  02900019
*                          XCTL FROM IGC0L05B OR IGC0Q05B.              03000019
*                                                                       03100019
*INPUT - REGISTER 8   BEGINNING OF DCB TABLE                            03200019
*        REGISTER 1   USER BUFFER AREA                                  03300019
*        REGISTER 10  USER BUFFER AREA                                  03350002
*        ALL OPENED DCB (S) WITH THEIR ASSOCIATED CONTROL BLOCKS        03400019
*        THE 48 BYTE TABLE ENTRY (IES) THAT IS (ARE) USED IN RESTART    03500019
*        RESTART WORKAREA                                               03600019
*                                                                       03700019
*OUTPUT - REGISTER 8   BEGINNING OF DCB TABLE                           03800019
*         REGISTER 1   USER BUFFER AREA                                 03900019
*         REGISTER 6   SECONDARY WORK AREA GOTTEN IN THIS MODULE        04000019
*         REGISTER 12  USER BUFFER AREA                                 04050002
*                                                                       04100019
*EXTERNAL ROUTINE - NONE                                                04200019
*                                                                       04300019
*EXITS - NORMAL - XCTL TO IGC0S05B, IGC0R05B, OR IGC0T05B               04400002
*                                                                       04500019
*      - ERROR - NONE                                                   04600019
*                                                                       04700019
*TABLES/WORKAREAS - THE WORKAREA USED IS DESCRIBED BY THE DSECTS AT THE 04800019
*                   END OF THE LISTING.                                 04900019
*                                                                       05000019
*********************************************************************** 05100019
*                                                                     * 05200019
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 05300019
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 05400019
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 05500019
*    IS 48 BYTES LONG.                                                * 05600019
*                                                                     * 05700019
*********************************************************************** 05800019
*                                                                       05900019
*        ------------------- 4 BYTES -----------------                  06000019
*                                                                       06100019
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  06200019
*        +DATA SET  +           DCB                  +                  06300019
*        + ORGN.    +         ADDRESS                +                  06400019
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                06500019
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  06600019
*        + NO. 1    +         ADDRESS                +                  06700019
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  06800019
*        +NUMBER    +         JFCB TTR               +                  06900019
*        + OF VOLS  +         ADDRESS                +                  07000019
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               07100019
*                                                                       07200019
*     12 +++++++++++++++++++++++                                        07300019
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   07400019
*        +INFO BYTE + NUMBER   +                                        07500019
*        +++++++++++++++++++++++                                        07600019
*                                                                       07700019
*     12 +++++++++++++++++++++++                                        07800019
*        +    OLD   TIOT       +        DA AND UNIT RECORD              07900019
*        +      OFFSET         +                                        08000019
*        +++++++++++++++++++++++                                        08100019
*                                                                       08200019
*                              +++++++++++++++++++++++                  08300019
*                              +FLAG BYTE +FLAG BYTE +                  08400019
*                              +  NO. 2   +  NO. 3   +                  08500019
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  08600019
*        +FLAG BYTE +FLAG BYTE +                     +                  08700019
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  08800019
*        +++++++++++++++++++++++                     + 20               08900019
*        +                                           +                  09000019
*        +                                           +                  09100019
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  09200019
*        +                                           +                  09300019
*        +   VOLUME ID NO. 2                         +                  09400019
*        +                     +++++++++++++++++++++++ 28               09500019
*        +                     +                     +                  09600019
*        +                     +   VOLUME ID NO. 3   +                  09700019
*     32 +++++++++++++++++++++++                     +                  09800019
*        +                                           +                  09900019
*        +                                           +                  10000019
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               10100019
*        +                                           +                  10200019
*        +   VOLUME &D NO. 4                         +                  10300019
*     40 +                     +++++++++++++++++++++++                  10400019
*        +                     +                     +                  10500019
*        +                     +                     +                  10600019
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               10700019
*        +                                           +                  10800019
*        +                                           +                  10900019
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               11000019
*                                                                       11100019
*                                                                       11200019
*ATTRIBUTES - REENTRANT                                                 11300019
*             REUSABLE                                                  11400019
*             ENABLED                                                   11500019
*             PRIVILEGED                                                11600019
*                                                                       11700019
*********************************************************************** 11800019
*                                                                       11900019
*                                                                       12000019
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               12100019
*                                                                       12200019
*********************************************************************** 12300019
*                                                                       12400019
WRKR1    EQU   0                        WORK/PARAMETER REGISTER         12500019
WRKR2    EQU   1                        WORK/PARAMETER REGISTER         12600019
DCBR     EQU   2                        CURRENT DCB REGISTER            12700019
WRKR3    EQU   12                       WORK REGISTER                   12800019
WRKR4    EQU   13                       WORK REGISTER                   12900019
WRKR5    EQU   14                       WORK/PARAMETER REGISTER         13000019
WRKR6    EQU   15                       WORK/PARAMETER REGISTER         13100019
*********************************************************************** 13200019
*                                                                       13300019
*    REGISTERS FOR IGC0P05B                                             13400019
*                                                                       13500019
*********************************************************************** 13600019
R1       EQU   1                                                        13700019
PRIMENO  EQU   2                       NUMBER OF PRIME WORK AREAS       13800019
BASER    EQU   3                       BASE REGISTER                    13900019
SECONDNO EQU   4                       NUMBER OF SECONDARY WORK AREAS   14000019
PPTABR1  EQU   5                       POINTER TO PRIME AREA            14100019
PPTABR2  EQU   6                       POINTER TO SECONDARY WORK AREA   14200019
WACNTR   EQU   7                       NUMBER OF WORK AREAS FORMATTED   14300019
TABLR    EQU   8                       POINTER TO FIRST TABL ELEMENT    14400019
CTABLR   EQU   9                       POINTER TO CURRENT TABL ELEMENT  14500019
BUFR     EQU   10                      POINTER TO RSTWA                 14600019
DSCNTR   EQU   11                      NUMBER OF DATA SETS              14700019
R13      EQU   13                                                       14800019
R15      EQU   15                                                       14900019
*                                                                       15000019
*********************************************************************** 15100019
*                                                                       15200019
*    OFFSETS TO BE USED IN REPI/O PHASE                                 15300019
*                                                                       15400019
*********************************************************************** 15500019
*                                                                       15600019
DAFLG    EQU   X'80'                    INDICATES DA DATA SET    M3525  15630019
*                                       PRESENT                  M3525  15660019
TABENT   EQU   48                       TABLE ENTRY LENGTH              15900019
UNRELCC  EQU   X'42'                                                    16100019
DEBID    EQU   X'0F'                                                    16200019
D0       EQU   0                                                        16300019
D1       EQU   1                                                        16400019
D4       EQU   4                                                        16500019
D8       EQU   8                                                        16600019
D40      EQU   40                      CONSTANT 40               Y02049 16650002
L2       EQU   2                                                        16700019
X02      EQU   X'02'                   CONSTANT OF 2             Y02049 16750002
L3       EQU   3                                                        16800019
L8       EQU   8                                                        16900019
L48      EQU   48                                                       17000019
L128     EQU   128                                                      17100019
ZERO     EQU   0                                                        17300019
*                                                                       17420021
LTM      EQU   X'21'                   BYPASS DOS LEADING TM     S21040 17440021
CHKPT    EQU   X'10'                   BYPASS EMBEDDED CHKPT RCD S21040 17460021
DOSTAPE  EQU   X'01'                   INDICATE DOS TAPE         S21040 17480021
*                                                                       17500019
*********************************************************************** 17600019
*                                                                       17700019
         BALR  BASER,ZERO               ESTABLISH ADDRESSABILITY        17800019
         USING *,BASER                 BASE REGISTER                    17900019
         B     BEGIN               BRANCH AROUND EYE CATCHER     Y01909 17950000
         CNOP  0,8                 ALIGN TO A DBL WORD BOUNDARY  Y01909 17960000
         DC    C'IGC0P05B'         CSECT NAME                    Y01909 17970000
BEGIN    EQU   *                                                 Y01909 17980000
         USING TABL,CTABLR             TABL BASE REGISTER               18000019
         USING RSTWA,BUFR              RESTART WORK AREA                18100019
         USING RSDSECT,PPTABR1         UNTIL REPDCB05                   18200019
*        USING RSDSECT,WRKR3           AFTER REPDCB05                   18300019
*                                                                       18400019
         LA    WRKR2,D0(WRKR2)         ZERO HIGH ORDER BYTE             18500019
         LR    CTABLR,TABLR            INITIALIZE TABL POINTER          18600019
         LR    BUFR,WRKR2              SAVE POINTER TO RSTWA            18700019
         L     PPTABR1,TABSEGAD-D1     ADDRESS OF PRIME WORK AREA       18800019
         LA    PPTABR1,D0(PPTABR1)     ZERO HIGH ORDER BYTE             18900019
         SR    PPTABR2,PPTABR2         INIT SECONDARY WORK AREA PTR     19000019
*                                                                       19100019
REPDCB00 EQU   *                                                        19200019
*                                                                       19300019
*        COUNT THE TABL ELEMENTS WHICH REPRESENT TAPE DEVICES AND       19400019
*        KEEP TOTAL IN REG DSCNTR                                       19500019
         SR    DSCNTR,DSCNTR                                            19600019
*                                                                       19700019
REPDCB01 TM    TABFLG1,TABTAPE         IS IT TAPE DEVICE                19800002
         BNO   REPDCB02                BRANCH NO TO GET NEXT ENTRY      19900019
         TM    TABFLG2,TABRSDS          IS THIS RESTART D/S      YM5359 19950002
         BO    REPDCB02                 IF YES,SKIP THIS NTRY    YM5359 19960002
         LA    DSCNTR,D1(DSCNTR)       ADD ONE TO COUNTER               20000019
*                                                                       20100019
*                                                                       20200019
REPDCB02 EQU   *                                                        20300019
*                                                                       20400019
         TM    TABFLG1,TABLAST         IS THIS THE LAST ENTRY           20500002
         BO    REPDCB03                BR YES TO CHECK SIZE OF W.A.     20600019
         LA    CTABLR,TABENT(CTABLR)   INCREMENT TABLR POINTER          20700019
         B     REPDCB01                GO TO COUNT THIS ENTRY           20800019
*                                                                       20900019
*        DSCNTR NOW CONTAINS NUMBER OF TAPES TO BE REPOSITIONED         21000019
*        NEXT, COMPUTE SIZE OF WORK AREA NEEDED TO PROCESS ALL          21100019
*        TAPES IN PARALLEL                                              21200019
*                                                                       21300019
REPDCB03 EQU   *                                                        21400019
         LTR   PRIMENO,DSCNTR           TEST/SET CNTR FOR NUMBER M3525  21440019
*                                       OF WORKAREAS             M3525  21480019
         BZ    REPDCB25                 IF COUNT IS 0, NO TAPE   M3525  21520019
*                                       PROCESSING NECESSARY     M3525  21560019
         SR    SECONDNO,SECONDNO       NO SECONDARY WORKAREA            21600019
*                                                                       21700019
         LR    WRKR1,BUFR              ADDRESS OF BEGINNING OF RSTWA    21800019
         A     WRKR1,RSWACL            LENGTH OF RSTWA                  21900019
         SH    WRKR1,QMWKALNG          SET ASIDE QMNGR WA SPACE  Y02049 21950002
         ST    WRKR1,RSSSCR            SAVE ADDR FOR IGC0S05B    Y02049 21970002
         SR    WRKR1,PPTABR1           LENGTH OF WORK AREA AVAILABLE    22000019
*                                                                       22100019
         LA    WRKR4,PPTABENT          SIZE OF WORK AREA FOR EACH ENTRY 22200019
         MR    WRKR3,DSCNTR            SIZE OF AREA NEEDED IN WRKR4     22300019
         SR    DSCNTR,DSCNTR           ZERO REGISTER TO INDICATE        22400019
*                                      LENGTH OF SECONDARY WORK AREA    22500002
         CR    WRKR1,WRKR4             WORK AREA LARGE ENOUGH           22600019
         BNL   REPDCB15                BRANCH YES TO FORMAT WORK AREA   22700019
*                                                                       24900019
*                                                                       25000019
*        TO ALLOW FOR SEGMENTED WORKAREAS THE SIZE MUST BE ROUNDED UP   25100019
*        TO A 200 BYTE MULTIPLE AND THE NUMBER OF AREAS IN EACH SECTION 25200002
*        MUST BE COMPUTED                                               25300019
*                                                                       25400019
REPDCB14 EQU   *                                                        25500019
         SR    WRKR4,WRKR1             CALC EXTRA SPACE NEEDED  ZA00608 25550002
         SR    WRKR3,WRKR3             ZERO EVEN REGISTER FOR DIVIDE    25600019
         LA    WRKR5,PPTABENT          SIZE OF EACH ENTRY               25700019
         DR    WRKR3,WRKR5             NUMBER OF ENTRIES IN WRKR4       25800019
*                                      REMAINDER IN WRKR3               25900019
*                                                                       26000019
         LTR   WRKR3,WRKR3             IS REMAINDER ZERO                26100019
         BZ    REPDCB04                BRANCH YES TO MULTIPLY BACK      26200019
         LA    WRKR4,D1(WRKR4)         ADD ONE TO ROUND UP              26300019
REPDCB04 EQU   *                                                        26400019
         SR    PRIMENO,WRKR4           NO OF AREAS IN PRIME WORK AREA   26500019
         LR    SECONDNO,WRKR4          AREAS NEEDED FOR SECOND W. A.    26600019
         MR    WRKR3,WRKR5             WRKR4 IS SIZE FOR GETMAIN AS 200 26700002
*                                         BYTE MULTIPLE                 26800019
*                                                                       26900019
*                                                                       27000019
*                                                                       27100019
*                                                                       27200019
         XC    GOTLOC(L8),GOTLOC       CLEAR GETMAIN RETURN AREA        27300019
         LA    WRKR1,PPTABENT          MINIMUM FOR GETMAIN              27400019
         ST    WRKR1,SIZELOC                IS ENOUGH FOR ONE WORK AREA 27500019
         ST    WRKR4,SIZELOC+D4        MAXIMUM SIZE FOR GETMAIN         27600019
         LA    R1,GETLIST              ADDR OF PARAM LIST FOR GETMAIN   27700019
         LA    R13,GETSAVE             SAVE AREA FOR GETMAIN            27800019
*                                                                       27900019
         GETMAIN VC,LA=SIZELOC,A=GOTLOC,SP=250,MF=(E,(1))               28000019
*                                                                       28100019
*                                                                       28200019
*        NOW DETERMINE HOW MUCH CORE, IF ANY, WAS GOTTEN                28300019
*        THEN GO TO REPDCB05 TO FORMAT THE AREAS                        28400019
*        GOTLOC CONTAINS THE ADDRESS OF THE GOTTEN CORE                 28500019
*        GOTLOC + 4 CONTAINS THE SIZE OF THE GOTTEN CORE                28600019
*                                                                       28700019
         LTR   R15,R15                 TEST RETURN CODE FROM GETMAIN    28800019
         BNZ   REPDCB13                NO GOTTEN CORE                   28900019
*                                                                       29000019
         LA    WRKR5,PPTABENT          SIZE OF EACH WORK AREA           29100019
         L     WRKR4,GOTLOC+D4         SIZE OF GOTTEN AREA              29200019
         LR    DSCNTR,WRKR4            SAVE LENGTH OF 2ND WORK AREA     29300019
         SR    WRKR3,WRKR3             ZERO EVEN REGISTER FOR DIVIDE    29400019
*                                                                       29500019
         DR    WRKR3,WRKR5             NUMBER OF ENTRIES IN WRKR4       29600019
*                                                                       29700019
         LR    SECONDNO,WRKR4          SAVE NUMBER OF ENTRIES           29800019
         L     PPTABR2,GOTLOC          ADDRESS OF SECOND WORK AREA      29900019
         B     REPDCB15                GO FORMAT WORK AREA              30000002
REPDCB13 EQU   *                                                        30100019
         SR    SECONDNO,SECONDNO       NO SECONDARY WORK AREAS          30200019
REPDCB15 EQU   *                                                        31300019
*                                                                       31400019
         USING RSDSECT,WRKR3                                            31500019
*                                                                       31600019
         SR    WRKR6,WRKR6             ZERO FORMATTING SWITCH           31700019
         SR    WRKR4,WRKR4             ZERO INDICATES PRIME WORK AREA   31800019
         LR    CTABLR,TABLR            REINITIALIZE BASE FOR TABL ELTS  31900019
*                                                                       32000019
REPDCB17 EQU   *                                                        32100019
*                                                                       32200019
         TM    TABFLG1,TABTAPE         IS IT TAPE                       32300002
         BNO   REPDCB18                BRNCH NO TO GET NEXT NTRY YM5359 32400002
         TM    TABFLG2,TABRSDS          IS IT RESTART TAPE       YM5359 32450002
         BNO   REPDCB06                 IF NOT CONTINUE          YM5359 32460002
*                                                                       32500019
REPDCB18 LA    CTABLR,TABENT(CTABLR)   INCREMENT TABL POINTER           32600002
         B     REPDCB17                GO TO CHECK FOR TAPE             32700019
*                                                                       32800019
REPDCB06 LR    WRKR3,PPTABR1           POINT TO PRIME AREA              32900019
         LR    WRKR5,PRIMENO           NO OF ELTS AVAILABLE             33000019
*                                                                       33100019
REPDCB07 SR    WACNTR,WACNTR                                            33200019
*                                                                       33300019
REPDCB08 EQU   *                                                 S21040 33400021
         C     WRKR6,MASK3             ARE ALL AREAS FORMATTED          33600019
         BE    REPDCB09                BRANCH YES TO SKIP FORMATTING    33700019
*                                                                       33800019
         XC    D0(PPTABENT,WRKR3),D0(WRKR3) ZERO WORK AREA       Y02049 33900002
*                                                                       34000019
         USING IHADCB,WRKR2                                             34500019
         L     WRKR2,DCBDEBAD          POINTER TO SYSTEM JOBQ DEB       34600019
         L     WRKR2,RSTCBAD           POINTER TO RESTART TCB           34800019
         ST    WRKR2,RSDEBTCB          STORE TCB IN DEB                 34900019
         LA    WRKR2,RSDCBREP          POINTER TO RESTART DEB           35000019
         ST    WRKR2,RSDEBDCB          STORE IN RESTART DEB             35100019
         ST    WRKR2,RSIOBDCB          STORE IN RESTART IOB             35200019
         MVI   RSDEBID,DEBID           STORE IDENTIFICATION FOR DEB     35300019
         L     WRKR2,CVTPTR            GET CVT ADDR              Y02049 35350002
         USING CVT,WRKR2               ADDR CVT                  Y02049 35400002
         L     WRKR2,CVTXAPG           GET ADDR OF IOS APP'S     Y02049 35450002
         ST    WRKR2,RSDEBAPP          STORE IN DEB              Y02049 35500002
         USING IHADCB,WRKR2            RESTORE DCB ADDRESSING    Y02049 35550002
         MVI   RSDEBAPP,X02            SET DEB EXT SCALE         Y02049 35570002
         LA    WRKR2,RSDEB             POINTER TO DEB                   35600019
         ST    WRKR2,RSDCBDEB          STORE IN RESTART DCB             35700019
         MVI   RSIOBFG1,UNRELCC        SET UNRELATED FLAG IN IOB        35800019
         LA    WRKR2,RSECBAD           POINTER TO ECB                   35900019
         ST    WRKR2,RSIOBECB          STORE IN RESTART IOB             36000019
         LA    WRKR2,RSCCWLST          CHANNEL PROGRAM ADDRESS          36100019
         ST    WRKR2,RSIOBCPA          STORE IN RESTART IOB             36200019
*                                                                       36300019
*                                                                       36400019
REPDCB09 EQU   *                                                 M4887  36420019
         LA    WACNTR,D1(WACNTR)        NUMBER OF WORK AREAS     M4887  36440019
*                                       USED                     M4887  36460019
*                                                                       36480019
REPDCB20 EQU   *                                                 M4887  36500019
         TM    TABFLG1,TABLAST          IS THIS THE LAST ENTRY   M4887  36520002
         BO    REPDCB11                BRANCH YES FORMATTING FINISHED   36600019
*                                                                       36700019
         LA    CTABLR,TABENT(CTABLR)                                    36800019
*                                                                       37000019
         TM    TABFLG1,TABTAPE          IS IT TAPE                      37100002
         BNO   REPDCB20                 BRACH NO TO SKIP ELEMENT M4887  37200019
         TM    TABFLG2,TABRSDS          IS IT RESTART TAPE       YM5359 37250002
         BO    REPDCB20                 YES-SKIP THIS NTRY       YM5359 37260002
*                                                                       37300019
         CR    WRKR5,WACNTR            IS THAT THE LAST WORK AREA       37400019
         BNH   REPDCB10                BRANCH YES TO ADJUST POINTERS    37500019
*                                                                       37600019
         LA    WRKR3,PPTABENT(WRKR3)   POINT TO NEXT WORK AREA SEGMENT  37700019
         B     REPDCB08                GO TO FORMAT NEXT ELT            37800019
*                                                                       37900019
*                                                                       38000019
REPDCB10 EQU   *                                                        38100019
         O     WRKR6,MASK1             SET FORMAT SW - 1ST AREA DONE    38200019
         X     WRKR4,MASK1             SWITCH WORK AREAS                38300019
         BZ    REPDCB12                SECONDARY AREA USED              38400019
*                                                                       38500019
*        WE HAVE JUST USED THE PRIME WORK AREA                          38600019
         LTR   SECONDNO,SECONDNO       IS THERE SECONDARY SPACE         38700019
         BZ    REPDCB12                BRANCH NO SECONDARY SPACE        38800019
*                                                                       38900019
         LR    WRKR3,PPTABR2           PTR TO SECONDARY SPACE           39000019
         LR    WRKR5,SECONDNO          NO OF ELTS IN SECOND W.A.        39100019
         B     REPDCB07                GO SET UP TABL                   39200019
*                                                                       39300019
*                                                                       39400019
REPDCB11 EQU   *                                                        39500019
         LR    WRKR3,PPTABR1           POINTER TO FIRST WORK AREA       39600019
         STH   DSCNTR,RSSTAT3          PASS LENGTH OF 2ND WORK AREA     39700019
*                                                                       39701021
*        PLACE WORKAREA SEGMENT ADDRESSES IN DCB TABLE ENTRIES.         39702021
*        USE ONLY FIRST THREE SEGMENTS FOR TAPES WITH DOS OPTIONS       39703021
*        SPECIFIED                                                      39704021
*                                                                       39705021
         USING IHADCB,WRKR2            DCB BASE REGISTER         S21040 39706021
         LR    CTABLR,TABLR            INIT BASE FOR TABLE ENTRY S21040 39707021
         LR    WRKR6,WRKR3             POINTER TO WORK AREA      S21040 39708021
         LR    WRKR5,PRIMENO           NO ELEMENTS IN PRIME W.A. S21040 39709021
*                                                                       39710021
         SR    WACNTR,WACNTR           DOS TAPE COUNTER          S21040 39711021
         SR    WRKR4,WRKR4             NON-DOS TAPE COUNTER      S21040 39712021
         SR    DSCNTR,DSCNTR            INDICATE PRIME W.A.      S21040 39713021
*                                                                       39714021
REPDCB30 EQU   *                                                 S21040 39715021
         TM    TABFLG1,TABTAPE         TAPE DEVICE               S21040 39716002
         BZ    REPDCB55                BRANCH NO                 S21040 39717021
         TM    TABFLG2,TABRSDS          IS IT RESTART TAPE       YM5359 39717402
         BO    REPDCB55                 BR IF YES                YM5359 39717802
*                                                                       39718021
         TM    TABTPLBL,LTM            BYPASS LEADING TAPE MARK  S21040 39719021
         BO    REPDCB45                BRANCH YES TO FLAG ENTRY  S21040 39720021
*                                                                       39721021
         L     WRKR2,TABDCBAD-D1       DCB ADDR FOR THIS ENTRY   S21040 39722021
         TM    DCBMACRF,X'80'           IS THIS EXCP            SA64062 39722402
         BO    REPDCB32                 YES-BYPASS CHKPT TST    SA64062 39722902
         TM    DCBOPTCD,CHKPT          BYPASS CHKPT RCDS         S21040 39724602
         BO    REPDCB45                BRANCH YES TO FLAG ENTRY  S21040 39725002
*                                                                       39725402
REPDCB32 EQU   *                                                SA64062 39725802
         LA    WRKR4,D1(WRKR4)         ADD ONE TO OS TAPE COUNT  S21040 39726021
         ST    WRKR6,TABVLID2          POINTER TO WORK AREA      S21040 39727021
         MVC   TABSEGAD(L3),TABVLID2+D1 MOVE POINTER INTO TABLE  S21040 39728021
*                                                                       39729021
         CR    WRKR4,WRKR5             LAST WORK AREA            S21040 39730021
         BE    REPDCB35                BR YES TO ADJUST POINTERS S21040 39731021
*                                                                       39732021
         LA    WRKR6,PPTABENT(WRKR6)   NEXT W.A. SEGMENT ADDRESS S21040 39733021
         B     REPDCB55                TEST FOR LAST TABLE ENTRY S21040 39734021
*                                                                       39735021
REPDCB35 EQU   *                                                 S21040 39736021
         LTR   DSCNTR,DSCNTR            DETERMINE WORK AREA USED S21040 39737021
         BZ    REPDCB38                 BR ZERO - USED PRIME W.A S21040 39738021
*                                                                       39739021
         SR    DSCNTR,DSCNTR            INDICATE PRIMARY W.A.    S21040 39740021
         B     REPDCB40                                          S21040 39741021
*                                                                       39742021
REPDCB38 EQU   *                                                 S21040 39743021
         LTR   WRKR5,SECONDNO          SECONDAY WORK AREA        S21040 39744021
         BZ    REPDCB40                BRANCH NO SECONDARY SPACE S21040 39745021
*                                                                       39746021
         LA    DSCNTR,D1(DSCNTR)        INDICATE SECONDARY W.A.  S21040 39747021
         LR    WRKR6,PPTABR2           PTR TO SECONDARY SPACE    S21040 39748021
         B     REPDCB55                TEST FOR LAST TABLE ENTRY S21040 39749021
*                                                                       39750021
REPDCB40 EQU   *                                                 S21040 39751021
         SR    WRKR4,WRKR4             INITIALIZE TAPE COUNTER   S21040 39752021
         LR    WRKR6,PPTABR1           PTR TO PRIMARY SPACE      S21040 39753021
         B     REPDCB55                TEST FOR LAST TABLE ENTRY S21040 39754021
*                                                                       39755021
REPDCB45 EQU   *                                                 S21040 39756021
*                                                                       39757021
*        THIS SECTION OF CODE PLACES ADDRESS OF FIRST THREE WORK        39758021
*        AREA SEGMENTS IN THE TAPE TABLE ENTRIES HAVING SPECIFIED       39759021
*        EITHER BYPASS LEADING TAPE MARK AND/OR BYPASS EMBEDDED         39760021
*        CHKPT RCDS (DOS TAPES).                                        39761021
*                                                                       39762021
         OI    TABFLG1,TABDOSTP        INDICATE DOS TAPE         S21040 39763002
         LA    WACNTR,D1(WACNTR)       ADD ONE TO DOS TAPE COUNT S21040 39764021
         ST    WRKR3,TABVLID2          POINTER TO WORK AREA      S21040 39765021
         MVC   TABSEGAD(L3),TABVLID2+D1 MOVE POINTER INTO TABLE  S21040 39766021
*                                                                       39767021
         C     WACNTR,MASK3            THREE AREAS USED          S21040 39768021
         BE    REPDCB50                BR YES TO REINITIALIZE    S21040 39769021
*                                                                       39770021
         LA    WRKR3,PPTABENT(WRKR3)   INCREMENT WORK AREA PTR   S21040 39771021
         B     REPDCB55                TEST FOR LAST TABLE ENTRY S21040 39772021
*                                                                       39773021
REPDCB50 EQU   *                                                 S21040 39774021
         SR    WACNTR,WACNTR           ZERO DOS TAPE COUNTER     S21040 39775021
         LR    WRKR3,PPTABR1           POINT TO PRIME AREA       S21040 39776021
*                                                                       39777021
REPDCB55 EQU   *                                                 S21040 39778021
         TM    TABFLG1,TABLAST         IS THIS THE LAST ENTRY    S21040 39779002
         BO    REPDCB60                BR YES FORMATTING DONE    S21040 39780021
*                                                                       39781021
         LA    CTABLR,TABENT(CTABLR)   INCREMENT DCB TABLE PTR   S21040 39782021
         B     REPDCB30                                          S21040 39783021
*                                                                       39784021
REPDCB60 EQU   *                                                 S21040 39785021
         LR    WRKR3,PPTABR1           PTR TO FIRST WORK AREA    S21040 39786021
         LA    WRKR3,RSCCW2                                             39800019
         MVC   D0(L8,WRKR3),MODNM0S     SET MODULE NAME FOR XCTL        39900019
REPDCB27 EQU   *                                                 M3525  39950019
         LA    WRKR6,D8(WRKR3)                                          40000019
         XC    RSERAS00(D40),RSERAS00  CLEAR SCRATCH AREA        Y02049 40050002
         LR    WRKR2,BUFR              PASS POINTER TO RSTWA            40100002
         LR    WRKR5,WRKR3              SET REG14 TO XCTL P.L.   YM5359 40110002
         LR    WRKR3,BUFR              IN REG 12 TOO             Y02049 40150002
*                                                                       40200019
         XCTL  EPLOC=(WRKR5),SF=(E,(15))                         YM5359 40300002
*                                                                       40400019
*                                                                       40500019
REPDCB12 O     WRKR6,MASK2             SET FORMAT SW - ALL AREA DONE    40600019
         B     REPDCB06                GO TO FORMAT NEXT ENTRY          40700019
REPDCB25 EQU   *                                                 M3525  40710019
         LA    WRKR3,RSCCW2             POINT TO PARM LIST       M3525  40720019
         MVC   D0(L8,WRKR3),MODNM0R     ANTICIPATE IGC0R05B AS   M3525  40730019
*                                       THE NEXT LOAD            M3525  40740019
         TM    RSDCBFLG,DAFLG           IS DA INDICATOR 'ON'     M3525  40750019
         BO    REPDCB27                 IF YES, BR               M3525  40760019
         MVI   D4(WRKR3),C'T'           SET NEXT LOAD TO         M3525  40770019
*                                       IGC0T05B                 M3525  40780019
         B     REPDCB27                 GO XCTL                  M3525  40790019
         EJECT                                                          40800019
*     CONSTANTS USED IN REPI/O                                          40900019
*                                                                       41000019
MASK1    DC    F'1'                     FORMATTING MASK - 1ST AREA      41100019
MASK2    DC    F'2'                     FORMATTING MASK - 2ND AREA      41200019
MASK3    DC    F'3'                     FORMATTING MASK - COMPLETE      41300019
QMWKALNG DC    H'456'                  LENGTH OF QMNGR WORKAREA  Y02049 41350002
*                                      (256) + QMNGR PARM LIST   Y02049 41360002
*                                      (24) + JFCB BUFFER (176)  Y02049 41370002
MAXTRKNO DC    X'7FFF'                  MAX NO OF TRKS - PUT IN DEB     41400019
MODNM0R  DC    C'IGC0R05B'                                       M3525  41460019
MODNM0S  DC    C'IGC0S05B'                                       M3525  41520019
*                                                                       41600019
*                                                                     * 41650000
*        MAINTENANCE SPACE                                       Y01909 41660000
*                                                                     * 41670000
PATCH    DC    XL((*-IGC0P05B)/20)'00'   FIVE PERCENT SPACE      Y01909 41680000
*                                                                     * 41690000
         EJECT                                                          41700019
*********************************************************************** 41800019
*                                                                       41900019
         IEEVRSWA  VER=3                AOS2 VERSION OF WA              42000000
         EJECT                                                          42100019
RSDSECT  DSECT                                                          42200019
*                                                                       42300019
*    DATA EXTENT BLOCK                                                  42400019
*                                                                       42500019
RSDEB    DS    0CL48                                                    42600019
GETSAVE  EQU   RSDEB                                                    42700019
SIZELOC  EQU   GETSAVE+72                                               42800019
GOTLOC   EQU   SIZELOC+8                                                42900019
GETLIST  EQU   GOTLOC+8                                                 43000019
         ORG   GETLIST                  ORG TO DEFINE GETLIST           43100019
         GETMAIN VC,LA=SIZELOC,A=GOTLOC,MF=L                            43200019
         ORG   RSDEB                    RESET I.C.                      43300019
RSDEBTCB DC    X'00000000'              TCB ADDRESS                     43400019
RSDEBDEB DC    X'00000000'              DEB ADDRESS                     43500019
*                                                                       43600019
*    DATA CONTROL BLOCK                                                 43700019
*                                                                       43800019
RSDEBOFL DS    0CL1                                                     43900019
RSDEBIRB DC    X'00000000'              IRB ADDRESS                     44000019
RSDEBSYS DC    X'00000000'              1ST IOB ADDR IN SYS.PURGE CHAIN 44100019
RSDEBUSR DC    X'00000000'              1ST IOB ADDR IN USER PRGE CHAIN 44200019
RSDEBECB DC    X'00000000'              PARM.LIST ADDR TO PURGE ECB     44300019
RSDEBID  DS    0CL1                                                     44400019
RSDEBDCB DC    AL4(RSDCBREP)            DCB ADDR                        44500019
RSDEBAPP DS    CL4                      I/O APPENDAGE VECTOR TABLE      44600019
RSDEBMOD DS    0CL1                                                     44700019
RSDEBUCB DS    F                        UCB ADDRESS                     44800019
RSDEBBIN DS    H                        BIN NUMBER                      44850002
RSDEBSCC DS    H                        CYLINDER START ADDRESS          44900002
RSDEBSHH DS    H                        TRACK START ADDRESS             44950002
RSDEBECC DS    H                        CYLINDER END ADDRESS            45000002
RSDEBEHH DS    H                        TRACK END ADDRESS               45050002
RSDEBNTR DS    H                        NO. OF TRACKS IN THIS EXTENT    45100002
*                                                                       45500019
*    EVENT CONTROL BLOCK                                                45600019
*                                                                       45700019
RSECBAD  DS    CL4                      ECB ADDRESS                     45800019
RSDCBDEB DC    AL4(RSDEB)               DEB ADDRESS                     45900019
*                                                                       46000019
RSDCBREP EQU   RSDEB+8                  POINT TO RELATIVE BEGINNING DCB 46100019
*                                                                       46200019
*    INPUT OUTPUT BLOCK                                                 46300019
*                                                                       46400019
RSIOB    DS    0CL40                                                    46500019
RSIOBFG1 DC    X'00'                    I/O FLAGS BYTE 1                46600019
RSIOBFG2 DC    X'00'                    I/O FLAGS BYTE 2                46700019
RSIOBSN1 DS    CL1                      FIRST SENSE BYTE                46800019
RSIOBSN2 DS    CL1                      SECOND SENSE BYTE               46900019
RSIOBECB DC    AL4(RSECBAD)             ECB ADDRESS                     47000019
RSIOBCSW DS    D                        LAST CSW                        47100019
RSIOBCPA DS    AL4(RSCCW1)              CHANNEL PROGRAM ADDRESS         47200019
RSIOBDCB DS    AL4(RSDCBREP)            DCB ADDRESS                     47300019
RSIOBRCP DS    CL4                      RESTART ADDRESS FOR IOS         47400019
RSIOBINC DS    H                        INCREMENT BLOCK COUNT           47500019
RSIOBECT DS    H                        NO. OF ERROR ENTRIES            47600019
RSIOBDAD DS    D                        SEEK ADDRESS FOR DA             47700019
*                                                                       47800019
*    CHANNEL PROGRAM                                                    47900019
*                                                                       48000019
RSCCWLST DS    0CL24                                                    48100019
RSCCW1   DS    D                        CCW1                            48200019
RSCCW2   DS    D                        CCW2                            48300019
RSCCW3   DS    D                        CCW3                            48400019
*                                                                       48500019
RSSTATUS DS    0CL8                                                     48600019
RSSTAT1  DS    CL1                      STATUS BYTE 1                   48700019
RSSTAT2  DS    CL1                      STATUS BYTE 2                   48800019
RSSTAT3  DS    CL1                      STATUS BYTE 3                   48900019
RSSTAT4  DS    CL1                      STATUS BYTE 4                   49000019
         DS    0F                                                YM7875 49150002
RSPASSFL DS    AL1                      PASSWORD CHK IND         YM7875 49160002
RSTABAD  DS    AL3                      ADR OF CURR USING ENT    YM7875 49170002
RSTLABEL DS    0CL80                    TAPE HDR RECORD          YM7875 49180002
RSHDR    DS    CL3                      LABEL IDENT              YM7875 49190002
RSHDRNUM DS    CL1                      LABEL NO.                YM7875 49192002
RSDATAID DS    CL17                     DATA SET IDENT           YM7875 49194002
         DS    CL32                                              YM7875 49196002
RSDSSECR DS    CL1                      SECURITY IND(DATA SET)   YM7875 49198002
         DS    CL26                     REST OF HDR1             YM7875 49198402
         ORG   RSTLABEL                 DECLARE HDR2             YM7875 49198802
         DS    CL47                     FRONT OF HDR2            YM7875 49199202
RSDSIND  DS    CL1                      CHKPT D.S. INDR          YM7875 49199602
         DS    CL32                     REST OF HDR2             YM7875 49199702
RSSEGEND EQU   *                        LN OF SEG W/A FOR TAPE   YM7875 49199902
PPTABENT EQU   RSSEGEND-RSDSECT         LENGTH OF TAPE WORK SEG  YM7875 49233202
         EJECT                                                          49266702
CVT      DSECT                                                          49300019
         CVT                                                            49400019
         EJECT                                                          49500019
         DCBD  DSORG=PS                                                 49600019
         EJECT                                                          49700019
         IHJDSTAB                                                Y02076 49750002
         END                                                            53900019
./  ADD  SSI=81150452,NAME=IGC0Q05B
         TITLE 'IGC0Q05B - CHECKPOINT DATA SET SECURITY MESSAGE MODULE' 00060002
IGC0Q05B CSECT                                                          00120018
*                                                                       00400018
*CHANGE ACTIVITY                                               @ZSUT222 00406037
* APAR OZ31490 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 00412037
*A139900-140100,166000                                         @ZSUT222 00414037
*STATUS CHANGE LEVEL 000                                                00420002
*                                                                       00440018
*********************************************************************** 00460018
*                                                                       00600018
*TITLE - CHECKPOINT DATA SET SECURITY MESSAGE MODULE                    00700002
*                                                                       00900018
*STATUS -  INITIAL CODE                                                 01000002
*                                                                       01100018
*FUNCTION - THIS MODULE GETS CONTROL (R1=0) WHEN EITHER IGC0N05B        01200002
*           OR IGC0S05B FIND A DATA SET WITH IT'S LABEL (TAPE) OR       01250002
*           DSCB (DA) FLAGGED AS A CHECKPOINT DATA SET, OR (R1=4)       01300002
*           IF THE ABOVE FLAGS ARE NOT SET BUT THE DSAB ASSOCIATED      01300402
*           WITH THE DATA SET HAS THE DSABCKDS BIT SET INDICATING       01302002
*           THE DATA SET WAS SECURE AT CHECKPOINT TIME BUT NOT          01310002
*           AT RESTART TIME - ERROR CODE 218 IS GENERATED.              01320002
*                                                                       01330002
*           WITH R1=0 AT ENTRY THE PROCESSING CONTINUES AS FOLLOWS:     01340002
*           IF NON-VIO, THIS MODULE WILL ASK THE OPERATOR IF THE        01350002
*           HOST VOLUME IS A KNOWN SECURE CHECKPOINT VOLUME.            02200002
*           IF VIO, THE VOLUME WILL BE ASSUMED CHECKPOINT SECURE.       02250002
*           THE SECURITY STATUS OF THE DATA SET AT RESTART TIME         02270002
*           IS THEN MATCHED AGAINST THE DATA SET'S STATUS AT            02280002
*           CHECKPOINT TIME (VIA THE DATA SET'S DSAB) AND IF THE        02290002
*           TWO DO NOT MATCH, ONE OF THE FOLLOWING ERROR CODES IS       02292002
*           PASSED TO THE LAST LOAD OF RESTART (IGC0V05B):              02294002
*                                                                       02296002
*                218 - A CHECKPOINT TIME SECURE DATA SET WAS FOUND      02298002
*                      NOT TO BE SECURE AT RESTART TIME.                02298402
*                251 - A CHECKPOINT TIME NON-SECURE DATA SET WAS        02298802
*                      FOUND TO BE SECURE AT RESTART TIME.              02299202
*                                                                       02299602
*           OTHERWISE, A NORMAL RETURN TO THE CALLING MODULE IS         02299702
*           MADE VIA BR 14.                                             02299802
*                                                                       02299902
*ENTRY POINTS - IGC0Q05B - ENTERED FROM IGC0N05B OR IGC0S05B            02300002
*                                                                       02500018
*INPUT - REGISTER  1 - BRANCH TABLE OFFSET                              02600002
*                      0 - QUERY STATUS OF DATA SET AND PROCESS         02650002
*                          ACCORDING TO ITS STATUS                      02652002
*                      4 - SET ERROR CODE 218 AND XCTL TO IGC0V05B      02660002
*        REGISTER  5 - UCB ADDRESS OF VOLUME IN QUESTION                02700002
*        REGISTER  9 - ADDRESS OF DATA SET'S TABLE ENTRY                02750002
*        REGISTER 10 - RESTART WORK AREA ADDRESS                        02760002
*        REGISTER 15 - ENTRY POINT ADDRESS OF THIS MODULE               02770002
*                                                                       02800018
*OUTPUT - BY BRANCH TABLE ENTRY OFFSET                                  02850002
*         0 - NON-ERROR RETURN TO CALLER:                               02960002
*             *ALL REGISTERS ARE SAVED AT ENTRY AND RESTORED AT EXIT    02960402
*             *VALID DSABCKDS AND DSABCKVL BIT SETTINGS FOR THE DSAB    02962002
*              ASSOCIATED WITH THE SUBJECT DATA SET AT ENTRY            02964002
*           - ERROR EXIT TO IGC0V05B:                                   02970002
*             *APPROPRIATE ERROR CODE IN RSRETCOD                       02980002
*             *REGISTER 1 - RESTART WORKAREA ADDRESS                    03050002
*             *REGISTER 5 - UCB ADDRESS OF VOLUME IN QUESTION           03100002
*         4 - *APPROPRIATE ERROR CODE IN RSRETCOD                       03150002
*             *REGISTER 1 - RESTART WORKAREA ADDRESS                    03160002
*             *REGISTER 5 - UCB ADDRESS OF VOLUME IN QUESTION           03170002
*                                                                       03200018
*EXTERNAL ROUTINES - GETMAIN                                            03300002
*                    FREEMAIN                                           03350002
*                    WTOR                                               03400002
*                    WAIT                                               03450002
*                    XCTL                                               03500002
*                                                                       03600018
*EXITS - IGC0N05B - GENERAL DATA MANAGEMENT MODULE                      03700002
*        IGC0S05B - TAPE REPOSITIONING MODULE                           03800002
*        IGC0V05B - RESTART EXIT MODULE                                 03900002
*                                                                       04200018
*TABLES/WORKAREAS  - RESTART WORKAREA                                   04300002
*                    RESTART TABLE ENTRIES                              04400002
*                    RESTART WTOR WORKAREA                              04450002
*                    DEB                                                04500002
*                    DCB                                                04600002
*                    TIOT                                               04700002
*                    DSAB                                               04750002
*                    UCB                                                04760002
*                                                                       04780002
*********************************************************************** 04830002
         EJECT                                                          04880002
*********************************************************************** 04930002
*                                                                       04980002
*        REGISTER EQUATES                                               05030002
*                                                                       05080002
*********************************************************************** 05130002
R0       EQU   0                   WORK REGISTER                        05180002
R1       EQU   1                   BRANCH TABLE OFFSET/WORK REGISTER    05230002
R2       EQU   2                   DCB BASE REGISER                     05280002
R3       EQU   3                   DEB PREFIX BASE REGISTER             05330002
R4       EQU   4                   DEB EXTENSION BASE REGISTER          05380002
R5       EQU   5                   UCB BASE REGISTER                    05430002
R6       EQU   6                   TIOT BASE REGISTER                   05480002
R7       EQU   7                   TIOT DD ENTRY BASE REGISTER          05530002
R8       EQU   8                   DSAB BASE REGISTER                   05580002
R9       EQU   9                   TABLE ENTRY BASE REGISTER            05630002
RA       EQU   10                  RESTART WA BASE REGISTER             05680002
RB       EQU   11                  CODE BASE REGISTER                   05730002
RC       EQU   12                  WTOR BUFFER BASE REGISTER            05780002
RD       EQU   13                  WORK REGISTER                        05830002
RE       EQU   14                  SUBROUTINE LINKAGE REGISTER          05880002
RF       EQU   15                  TEMPORARY CODE BASE/WORK REGISTER    05930002
         EJECT                                                          05980002
*********************************************************************** 06030002
*                                                                       06080002
*        ESTABLISH ADDRESSABILITY                                       06130002
*                                                                       06180002
*********************************************************************** 06230002
         USING TCB,R1              TCB (TEMPORARY)                      06240002
         USING IHADCB,R2           DCB                                  06280002
         USING DEBPREFX,R3         DEB PREFIX                           06330002
         USING DEBXTN,R4           DEB EXTENSION                        06380002
         USING UCBOB,R5            UCB                                  06430002
         USING TIOT1,R6            TIOT                                 06480002
         USING TIOENTRY,R7         TIOT DD ENTRY                        06530002
         USING DSAB,R8             DSAB                                 06580002
         USING TABL,R9             TABLE ENTRY                          06630002
         USING RSTWA,RA            RESTART WORKAREA                     06680002
         USING IGC0Q05B,RB         CODE BASE                            06730002
         USING WTORWA,RC           WTOR WORKAREA                        06740002
         EJECT                                                          06780002
*********************************************************************** 06830002
*                                                                       06880002
*        BEGIN LOGIC                                                    06930002
*                                                                       06980002
*********************************************************************** 07030002
         SPACE 1                                                        07080002
         STM   R0,RF,RSREGSAV+K8   SAVE CALLER'S REGS                   07130002
         LR    RB,RF               ESTABLISH BASE REG                   07180002
         B     QBRTB000(R1)        ENTER VIA BR TABLE                   07230002
         CNOP  0,8                 ALIGN TO DOUBLE WORD                 07280002
         DC    CL8'IGC0Q05B'       MODULE NAME                 @ZSUT222 07330037
         DC    CL8'&SYSDATE'       LAST DATE SHIPPED           @ZSUT222 07340037
         DC    CL8'@ZSUT222'       LAST CODE SHIPPED           @ZSUT222 07350037
QBRTB000 EQU   *                   BRANCH TABLE                         07380002
         B     QQCSE000            QUERY CHKPT STATUS ENTRY             07430002
         B     QE218000            218 ERROR ENTRY                      07440002
         EJECT                                                          07480002
*********************************************************************** 07530002
*                                                                       07580002
*        ENTER HERE TO ESTABLISH THE STATUS OF A CHKPT DATA SET         07630002
*                                                                       07680002
*********************************************************************** 07730002
QQCSE000 EQU   *                   QUERY CHKPT STATUS ENTRY             07780002
         NI    TABFLG3,X'FF'-TABCKCK-TABCKRS INIT PROCESS SW'S          07830002
         L     R2,TABDCBAD-K1      GET DCB ADDRESS                      07880002
         L     R3,DCBDEBAD         GET DEB ADDRESS                      07930002
         LA    R1,DEBBASIC-DEBPREFX GET NEG PREFIX OFFSET               07980002
         SR    R3,R1               GET DEB PREFIX ADDRESS               08030002
         L     R4,DEBXTNP          GET DEB EXTENSION ADDRESS            08080002
         L     R8,DEBXDSAB         GET DSAB ADDRESS                     08130002
         L     R7,DSABTIOT         GET DD ENTRY ADDRESS                 08180002
         L     R1,RSTCBAD          GET TCB ADDRESS                      08230002
         L     R6,TCBTIO           GET TIOT ADDRESS                     08330002
         TM    DSABFLG4,DSABCKDS   WAS DS SECURE AT CHKPT TIME          08430002
         BZ    QNCKS000            IF NOT, BRANCH                       08480002
         OI    TABFLG3,TABCKCK     SET CHKPT SECURE SW                  08530002
QNCKS000 EQU   *                   NOT CHKPT SECURE ENTRY               08580002
         TM    UCBJBNR,UCBVRDEV    IS THIS A VIO UCB                    08630002
         BNO   QNVIO000            IF NOT, BRANCH                       08680002
         OI    TABFLG3,TABCKRS     ASSUME VOLUME IS SECURE              08730002
         B     QVIOE000            SKIP ASKING THE OPERATOR             08780002
         EJECT                                                          08830002
*********************************************************************** 08880002
*                                                                       08930002
*        THE FOLLOWING CODE WILL QUERY THE OPERATOR FOR STATUS          08980002
*                                                                       09030002
*********************************************************************** 09080002
QNVIO000 EQU   *                   NON-VIO ENTRY                        09130002
         LA    R0,WALNGTH          GET WTOR WORKAREA LENGTH             09180002
         ICM   R0,M8,SP253         GET SUBPOOL ID (253)                 09230002
         GETMAIN R,LV=(0)          CALL GETMAIN                         09280002
         LR    RC,R1               INIT WTOR WORKAREA BASE REG          09330002
*                                                                       09430002
*        INITIALIZE THE WTOR BUFFER                                     09480002
*                                                                       09530002
         MVI   WTORRL,K3           SET REPLY LNGTH (3)                  09580002
         LA    R1,WTOREPLY         GET REPLY AREA ADDR                  09630002
         STCM  R1,M7,WTORRAA       PUT IT INTO WTOR'S PARM              09680002
         LA    R1,WTORECB          GET THE WTOR ECB ADDR                09730002
         ST    R1,WTOREA           PUT IT INTO WTOR'S PARM              09780002
         MVC   WTORMF,IEC255DM     MOVE IN MCS FLAGS                    09830002
         MVI   WTORTXT,BLANK       BLANK OUT THE MESSAGE                09880002
         MVC   WTORTXT+K1(L'WTORTXT-K1),WTORTXT TEXT AREA               09930002
         MVC   WTORTXT(L'IEC255D1),IEC255D1 MOVE 1ST MSG SEG            09980002
         LA    R1,WTORTXT+L'IEC255D1 GET ADDR OF JOBNAME SLOT           10030002
         MVC   K0(L'TIOCNJOB,R1),TIOCNJOB JOBNAME TO MSG                10080002
         BAL   RE,QBLNK000         GO FIND A BLANK                      10130002
         MVC   K0(L'IEC255D2,R1),IEC255D2 MOVE 2ND MSG SEG              10180002
         LA    R1,L'IEC255D2(,R1)  BUMP TO NEXT SLOT                    10230002
         MVC   K0(L'TIOEDDNM,R1),TIOEDDNM MOVE IN DD NAME               10280002
         BAL   RE,QBLNK000         GO FIND A BLANK                      10330002
         MVI   K0(R1),COMMA        DROP IN COMMA                        10380002
         LA    R1,K1(,R1)          BUMP PAST COMMA                      10430002
         MVC   K0(L'UCBNAME,R1),UCBNAME MOVE IN UCB ADDR                10480002
         LA    R1,L'UCBNAME(,R1)   BUMP PAST UCB ADDR                   10530002
         MVI   K0(R1),COMMA        DROP IN COMMA                        10580002
         LA    R1,K1(,R1)          BUMP PAST COMMA                      10630002
         MVC   K0(L'UCBVOLI,R1),UCBVOLI MOVE IN VOL SER                 10680002
         BAL   RE,QBLNK000         GO FIND A BLANK                      10730002
         MVC   K0(L'IEC255D3,R1),IEC255D3 MOVE IN 3RD MSG SEG           10780002
         LA    R1,L'IEC255D3(,R1)  POINT 1 PAST MSG TEXT                10830002
         MVC   K0(L'IEC255D4+L'IEC255DT,R1),IEC255D4 MOVE IN            10880002
*                                  DESCRIPTOR CODES AND ROUTING         10930002
*                                  CODES FOR TAPE                       10980002
         CLI   UCBTBYT3,UCB3TAPE   TAPE DEVICE                          11030002
         BE    QTAPE000            IF YES, BRANCH                       11080002
         MVC   K2(L'IEC255DD,R1),IEC255DD MOVE IN DA ROUTING CDS        11130002
QTAPE000 EQU   *                   TAPE BYPASS ENTRY                    11180002
         LA    R1,L'IEC255D4+L'IEC255DT(,R1) BUMP TO END OF MSG+1       11230002
         LA    RF,WTORTXT          GET MSG START ADDRESS                11240002
         SR    R1,RF               GET MSG LENGTH                       11280002
         STH   R1,WTORTL           STORE IN WTOR PARM                   11330002
QWTOR000 EQU   *                   RETRY ENTRY                          11380002
         XC    WTOREPLY,WTOREPLY   CLEAR REPLY AREA                     11430002
         XC    WTORECB,WTORECB     CLEAR ECB                            11480002
         WTOR  MF=(E,(RC))         ISSUE WTOR                           11530002
         WAIT  ECB=WTORECB         WAIT FOR REPLY                       11580002
         OC    WTOREPLY,BLANKS     FOLD REPLY TO UPPER CASE             11630002
         CLC   KNO,WTOREPLY        REPLY = 'NO'                         11680002
         BE    QNOTS000            BRANCH IF 'NO'                       11730002
         CLC   KYES,WTOREPLY       REPLY = 'YES'                        11780002
         BNE   QWTOR000            IF NOT, TRY AGAIN                    11830002
*                                                                       11880002
*        FALL THROUGH ON REPLY OF 'YES'                                 11930002
*                                                                       11980002
         OI    TABFLG3,TABCKRS     SET D/S SECURE FLAG                  12030002
QNOTS000 EQU   *                   NOT SECURE ENTRY                     12080002
*                                                                       12130002
*        FREE GOTTEN CORE FOR WTOR WORKAREA                             12180002
*                                                                       12230002
         LA    R0,WALNGTH          GET WTOR WORKAREA LENGTH             12280002
         ICM   R0,M8,SP253         INSERT SUBPOOL ID (253)              12330002
         LA    R1,WTORBUF          GET ADDRESS OF GOTTEN CORE           12380002
         FREEMAIN R,LV=(0),A=(1)   FREE IT                              12430002
*                                                                       12530002
*        DETERMINE IF THE CHECKPOINT AND RESTART TIME                   12580002
*        DATA SET SECURITY STATUS ARE THE SAME                          12630002
*                                                                       12680002
QVIOE000 EQU   *                   VIO MSG BYPASS ENTRY                 12690002
         TM    TABFLG3,TABCKCK+TABCKRS TEST CHKPT & RST STATUS          12730002
         BM    QERRO000            BR IF MIXED - IT'S AN ERROR          12780002
         BZ    QBNSE000            BR IF BOTH NOT SECURE                12830002
         OI    DSABFLG4,DSABCKVL   BOTH ARE SECURE, INDIC IN DSAB       12880002
QBNSE000 EQU   *                   BOTH NOT SECURE ENTRY                12930002
*                                                                       12980002
*        RETURN TO CALLER WITH VALID DSAB                               13030002
*                                                                       13080002
         LM    R0,RF,RSREGSAV+K8   RESTORE CALLER'S REGS                13130002
         BR    RE                  RETURN TO CALLER                     13180002
         EJECT                                                          13230002
*********************************************************************** 13280002
*                                                                       13330002
*        A MISMATCH WAS FOUND TO EXIST BETWEEN THE CHECKPOINT           13380002
*        AND RESTART TIME SECURITY STATUS - DETERMINE WHICH             13430002
*        TYPE OF ERROR (218 OR 251) AND THE XCTL TO THE LAST            13480002
*        LOAD OF RESTART (IGC0V05B)                                     13530002
*                                                                       13580002
*********************************************************************** 13630002
QERRO000 EQU   *                   ERROR ENTRY                          13680002
         MVI   RSRETCOD+K1,ERR251  ANTICIPATE ERROR CODE 251            13730002
         TM    TABFLG3,TABCKRS     WAS IT SECURE AT RESTART             13780002
         BO    QE251000            IF YES, IT'S A 251                   13830002
QE218000 EQU   *                   218 ERROR ENTRY (R1=4)               13880002
         MVI   RSRETCOD+K1,ERR218  SET ERROR CODE 218                   13930002
QE251000 EQU   *                   251 ERROR ENTRY                      13980002
         MVC   RSREGSAV(8),MODID   SAVE NAME OF MODULE THAT    @ZSUT222 13990037
*                                  HAS DETECTED THE ERROR.     @ZSUT222 14000037
         STM   0,15,RSREGSAV+8     SAVE CURRENT REGISTERS.     @ZSUT222 14010037
         LR    R1,RA               R1=WA ADDR FOR V05B                  14030002
         MVC   RSERAS00(L'IGC0V05B),IGC0V05B SETUP XCTL PARM            14080002
         LA    RF,RSERAS02         XCTL PARM REG                        14130002
         XCTL  EPLOC=RSERAS00,SF=(E,(15)) GO                            14180002
         EJECT                                                          14230002
*********************************************************************** 14280002
*                                                                       14330002
*        SUBROUTINE TO INCREMENT THE WTOR MESSAGE BUFFER POINTER        14380002
*        TO THE FIRST BLANK AFTER A SEGMENT OF MESSAGE TEXT             14430002
*                                                                       14480002
*********************************************************************** 14530002
QBLNK000 EQU   *                   SUBROUTINE ENTRY                     14580002
         CLI   K0(R1),BLANK        IS THIS CHARACTER A BLANK            14630002
         BER   RE                  IF BLANK, RETURN TO MAINLINE         14680002
         LA    R1,K1(,R1)          BUMP TO NEXT CHARACTER               14730002
         B     QBLNK000            TRY AGAIN                            14780002
         EJECT                                                          14830002
*********************************************************************** 14880002
*                                                                       14930002
*        GENERAL EQUATES                                                14980002
*                                                                       15030002
*********************************************************************** 15080002
K0       EQU   0                   0 CONSTANT                           15130002
K1       EQU   1                   1 CONSTANT                           15180002
K2       EQU   2                   2 CONSTANT                           15190002
K3       EQU   3                   3 CONSTANT                           15230002
K4       EQU   4                   4 CONSTANT                           15280002
K8       EQU   8                   8 CONSTANT                           15330002
M7       EQU   7                   ICM MASK FOR BYTES 1-3               15380002
M8       EQU   8                   ICM MASK FOR BYTE 0                  15430002
ERR218   EQU   218                 ERROR CODE 218                       15480002
ERR251   EQU   251                 ERROR CODE 251                       15530002
WALNGTH  EQU   92                  WTOR WORKAREA LENGTH                 15580002
BLANK    EQU   C' '                BLANK CONSTANT                       15630002
COMMA    EQU   C','                COMMA CONSTANT                       15680002
         EJECT                                                          15730002
*********************************************************************** 15780002
*                                                                       15830002
*        STORAGE CONSTANTS                                              15880002
*                                                                       15930002
*********************************************************************** 15980002
IEC255D1 DC    C'IEC255D '         MESSAGE SEGMENT 1                    16030002
IEC255D2 DC    C' IS ('            MESSAGE SEGMENT 2                    16080002
IEC255D3 DC    C') A SECURE CHECKPOINT VOLUME' MESSAGE SEGMENT 3        16130002
IEC255D4 DC    0AL2(0),B'0100000000000000' COMMON DESCRIPTOR CODES      16180002
IEC255DT DC    0AL2(0),B'1010100010000000' TAPE ROUTING CODES           16230002
IEC255DD DC    0AL2(0),B'1001010010000000' DA ROUTING CODES             16280002
IEC255DM DC    0AL2(0),B'1000000000000000' MCS FLAGS                    16330002
KYES     DC    C'YES'              'YES' COMPARAND FOR WTOR REPLY       16380002
KNO      DC    C'NO '              'NO ' COMPARAND FOR WTOR REPLY       16430002
BLANKS   DC    C'    '             USED TO FOLD REPLY TO UPPER CASE     16480002
SP253    DC    AL1(253)            SUBPOOL 253 ID                       16530002
IGC0V05B DC    C'IGC0V05B'         XCTL NAME FOR ERROR EXIT             16580002
MODID    DC    CL8'IGC0Q05B'       MODULE ID                   @ZSUT222 16600037
*                                                                       16630002
*        MAINTENANCE SPACE                                              16680002
*                                                                       16730002
PATCH    EQU   ((*-IGC0Q05B)/10)   TEN PERCENT MAINTENANCE SPACE        16780002
         DC    XL(PATCH)'00'       DEFINE ZEROED PATCH AREA             16830002
         EJECT                                                          16880002
*********************************************************************** 16930002
*                                                                       16980002
*        WTOR WORKAREA DSECT                                            17030002
*                                                                       17080002
*********************************************************************** 17130002
WTORWA   DSECT                     WTOR WORKAREA                        17180002
WTORBUF  DS    0CL84               WTOR MESSAGE BUFFER                  17230002
WTORRL   DS    CL1                 REPLY LENGTH                         17280002
WTORRAA  DS    CL3                 REPLY ADDRESS                        17330002
WTOREA   DS    CL4                 ECB ADDRESS                          17380002
WTORTL   DS    CL2                 MESSAGE TEXT LENGTH                  17430002
WTORMF   DS    CL2                 MCS FLAGS                            17480002
WTORTXT  DS    CL68                MESSAGE TEXT                         17530002
WTORDRCS DS    CL4                 DESCRIPTOR & ROUTING CODES           17580002
WTOREPLY DS    CL4                 WTOR REPLY AREA                      17630002
WTORECB  DS    CL4                 WTOR ECB                             17680002
         EJECT                                                          17730002
*********************************************************************** 17780002
*                                                                       17830002
*        OTHER SYSTEM DSECT'S                                           17880002
*                                                                       17930002
*********************************************************************** 17980002
         IEEVRSWA VER=3                                                 18030002
         EJECT                                                          18080002
         IHJDSTAB                                                       18090002
         EJECT                                                          18100002
         IEZDEB                                                         18130002
         EJECT                                                          18180002
         DCBD  DSORG=PS                                                 18230002
         EJECT                                                          18280002
         IHADSAB                                                        18330002
         EJECT                                                          18380002
         IEFTIOT1                                                       18430002
         EJECT                                                          18480002
         IEFUCBOB                                                       18530002
         EJECT                                                          18580002
         IKJTCB                                                         18630002
         END                                                            18680002
./  ADD  SSI=81150454,NAME=IGC0R05B
         TITLE 'IGC0R05B  DATA SET PROCESSOR - DA DATA SET POSITIONING *00100018
                      REPOSITION I/O  RESTART-SVC 52  OS/360'           00200018
IGC0R05B CSECT                                                          00300018
*          RELEASE 18 DELETIONS                                         00400018
*0000239000-241000,263000-264000,340000,345000,348000,406000-     M3251 00430018
*0000407000,521000,544000-546000,565000                           M3251 00460018
*          RELEASE 19 DELETIONS                                         00500018
*2555050000,188000-189000,606000-607000,609000-612000,682000,    A25984 00530019
*2555686000-687000,746000                                        A25984 00560019
*          RELEASE 20 DELETIONS                                         00600018
*3523050000,187600                                               A30552 00620020
*3523218000,243000,250700-252000,877200-877400                   A29797 00650020
*          RELEASE 21 DELETIONS                                         00700018
*0790165000,187300-187900,447000,468000,487000-490000,508000-    M0187  00720021
*0790509000,515000,516000,520000,521000-521500,526000,557000-    M0187  00740021
*0790558000,568000-569000,680000-682000,686000,712000-713000,    M0187  00760021
*0790736000-737000,747000-749000,750000                          M0187  00780021
*          RELEASE 22 DELETIONS                                         00800018
*          RELEASE 23 DELETIONS                                         00900018
*          RELEASE 24 DELETIONS                                         01000018
*          RELEASE 25 DELETIONS                                         01100018
*          RELEASE 26 DELETIONS                                         01200018
*       VS2 030 ADDS/DELETES/CHANGES                                    01250037
*213100-213200,256500-256600,276600,287600-288944,679500-682500 ZA02895 01260037
*308425-308438,688500,711500-712999,738500-738988,833500-833800 ZA02895 01270037
*28843610                                                      @ZA08861 01280037
* APAR OZ31491 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 01290037
*C151260,151280,507000,513000                                  @ZSUT222 01291037
*A515100-515300,747200                                         @ZSUT222 01294037
* STATUS CHANGE LEVEL 004                                               01300021
*                                                                       01400018
*TITLE-        DA DATA SET POSITIONING                                  01500018
*                                                                       01600018
*STATUS-       INITIAL CODE                                             01700018
*                                                                       01800018
*FUNCTION-     CONTROL IS PASSED FROM IGC0S05B,IGC0U05B,IGC0P05B        01900002
*              OR FROM THE PARTIAL RELEASE FUNCTION OF CLOSE.           01960002
*              THIS MODULE EXAMINES THE DEB'S AND DSCB'S OF DA          01970002
*              SEQUENTIAL OR PARTITIONED DATA SETS TO DETERMINE IF      01980002
*              THE DATA SET HAS BEEN ALTERED SINCE THE CHECKPOINT       01990002
*              OCCURRED.                                                01992002
*                                                                       02400018
*              IF AN ENTRY IN THE TABLE INDICATES THAT A PS OR PO DATA  02500018
*              SET IS RESIDENT ON A DA DEVICE A 464 BYTE WORKAREA JUST  02600018
*              LIKE CLOSE'S IS FORMATTED IN THE RESTART WORKAREA.  THIS 02700018
*              CONTAINS THE CONTROL BLOCKS REQUIRED TO READ THE FORMAT  02800018
*              1 AND, IF NECESSARY, THE FORMAT 3 DSCB'S.                02900018
*                                                                       03000018
*              AFTER THIS THE FORMAT 1 DSCB, AND IF MORE THAN 3 EXTENTS 03100018
*              THE FORMAT 3 DSCB, IS READ.  NEXT THE DEB AND DSCB SPACE 03200018
*              ALLOCATION PARAMETERS ARE COMPARED.  IF THE DEB IS       03300018
*              GREATER THAN THE DSCB  (INDICATING A CLOSE WITH PARTIAL  03400018
*              RLSE) THE DEB IS COMPRESSED.  IF THE DSCB IS GREATER     03500018
*              THAN THE DEB A PARTIAL RELEASE IS EFFECTED VIA THE       03600018
*              PARTIAL RELEASE MODULES OF CLOSE.  BOTH OF THE FOREGOING 03700018
*              APPLY ONLY TO OUTPUT DATA SETS, FOR INPUT DATA SETS AN   03800018
*              ERROR CODE IS SET IF A DISCREPANCY IS ENCOUNTERED AND    03900018
*              CONTROL IS PASSED TO IGC0V05B. AT END-OF-TABLE, IF NO    04000018
*              ERROR IS ENCOUNTERED CONTROL IS PASSED TO IGC0T05B OR    04100002
*              IGC0W05B.                                                04150002
*                                                                       04200018
*ENTRY POINTS - THIS MODULE IS ENTERED FROM:IGC0S05B,IGC0U05B,IGC0P05B  04250002
*                                           AND OPEN PARTIAL RELEASE    04260002
*                                                                       04270002
*INPUT-        REGISTER  1    ADDR OF REPI/O'S WORKAREA                 04300018
*              REGISTER  8    ADDR OF FIRST TABLE ENTRY                 04400018
*              REGISTER  1    PARTIAL RELEASE ERROR RETURN CODE         04500018
*                                                                       04600018
*OUTPUT-       SAME AS REGISTER 1 AND 8 ABOVE                           04700018
*                                                                       04800018
*EXTERNAL REFERENCES -                                                * 04810020
*   SVC 25  -  IGC0002E  -  BSAM TRACK BALANCE ROUTINE.               * 04820020
*      USED FOR D.A. CHECKPOINT DATA SET TO RESTORE DCBTRBAL,         * 04830020
*      AND TO ERASE THE REMAINDER OF THE TRACK.                       * 04840020
*                                                                     * 04850020
*EXITS-        TO PARTIAL RELEASE (IGG020P1)                            04900018
*              NORMAL TO IGC0T05B OR, IF ISAM OR BDAM, TO IGC0W05B      05000020
*              ERROR  TO IGC0V05B WITH ONE OF THE FOLLOWING ERROR       05100037
*              SET IN THE RESTART WORKAREA:                             05120037
*              72 - I/O ERROR READING DSCB                              05140037
*              76 - XTENTS OR LAST TTR'S UNEQUAL: DEB VS DSCB           05160037
*                                                                       05200018
*TABLES/WORKAREAS-                                                      05300018
*                                                                       05400018
*********************************************************************** 05500018
*                                                                     * 05600018
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 05700018
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 05800018
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 05900018
*    IS 48 BYTES LONG.                                                * 06000018
*                                                                     * 06100018
*********************************************************************** 06200018
*                                                                       06300018
*        ------------------- 4 BYTES -----------------                  06400018
*                                                                       06500018
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  06600018
*        +DATA SET  +           DCB                  +                  06700018
*        + O-GN.    +         ADDRESS                +                  06800018
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                06900018
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  07000018
*        + NO. 1    +         ADDRESS                +                  07100018
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  07200018
*        +NUMBER    +         JFCB TTR               +                  07300018
*        + OF VOLS  +         ADDRESS                +                  07400018
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               07500018
*                                                                       07600018
*     12 +++++++++++++++++++++++                                        07700018
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   07800018
*        +INFO BYTE + NUMBER   +                                        07900018
*        +++++++++++++++++++++++                                        08000018
*                                                                       08100018
*     12 +++++++++++++++++++++++                                        08200018
*        +    OLD   TIOT       +        DA AND UNIT RECORD              08300018
*        +      OFFSET         +                                        08400018
*        +++++++++++++++++++++++                                        08500018
*                                                                       08600018
*                              +++++++++++++++++++++++                  08700018
*                              +FLAG BYTE +FLAG BYTE +                  08800018
*                              +  NO. 2   +  NO. 3   +                  08900018
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  09000018
*        +FLAG BYTE +FLAG BYTE +                     +                  09100018
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  09200018
*        +++++++++++++++++++++++                     + 20               09300018
*        +                                           +                  09400018
*        +                                           +                  09500018
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  09600018
*        +                                           +                  09700018
*        +   VOLUME ID NO. 2                         +                  09800018
*        +                     +++++++++++++++++++++++ 28               09900018
*        +                     +                     +                  10000018
*        +                     +   VOLUME ID NO. 3   +                  10100018
*     32 +++++++++++++++++++++++                     +                  10200018
*        +                                           +                  10300018
*        +                                           +                  10400018
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               10500018
*        +                                           +                  10600018
*        +   VOLUME ID NO. 4                         +                  10700018
*     40 +                     +++++++++++++++++++++++                  10800018
*        +                     +                     +                  10900018
*        +                     +                     +                  11000018
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               11100018
*        +                                           +                  11200018
*        +                                           +                  11300018
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               11400018
*                                                                       11500018
*                                                                       11600018
*ATTRIBUTES-   RE-ENTRANT                                               11700018
*              RE-USABLE                                                11800018
*              ENABLED                                                  11900018
*              PRIVILEGED                                               12000018
*                                                                       12100018
*********************************************************************** 12200018
*                                                                       12300018
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               12400018
*                                                                       12500018
*********************************************************************** 12600018
*                                                                       12700018
WRKR1    EQU   0                        WDRK/PARAMETER REGISTER         12800018
WRKR2    EQU   1                        WDRK/PARAMETER REGISTER         12900018
DCBR     EQU   2                        CURRENT DCB REGISTER            13000018
BASER    EQU   3                        BASE REGISTER                   13100018
DEBR     EQU   4                        CURRENT DEB REGISTER            13200018
UCBR     EQU   5                        CURRENT UCB REGISTER            13300018
TIOTR    EQU   6                        NEW TIOT REGISTER               13400018
TCBR     EQU   7                        TCB REGISTER                    13500018
TABLR    EQU   8                        BEGINNING TO DCB TABLE REG      13600018
CTABLR   EQU   9                        CURRENT ENTRY IN DCB TABLE      13700018
BUFR     EQU   10                       USER BUFFER AREA                13800018
DSCNTR   EQU   11                       WORK REGISTER                   13900018
WRKR3    EQU   12                       WORK REGISTER                   14000018
WRKR4    EQU   13                       WORK REGISTER                   14100018
WRKR5    EQU   14                       WORK/PARAMETER REGISTER         14200018
WRKR6    EQU   15                       WORK/PARAMETER REGISTER         14300018
*                                                                       14400018
*********************************************************************** 14500018
*                                                                       14600018
*    OFFSETS TO BE USED IN REPI/O PHASE                                 14700018
*                                                                       14800018
*********************************************************************** 14900018
*                                                                       15000018
IS       EQU   X'80'                    INDEXED SEQUENCIAL              15003018
PS       EQU   X'40'                    PHYSICAL SEQUENCIAL             15006018
DA       EQU   X'20'                    DIRECT ACCESS                   15009018
PO       EQU   X'02'                    PARTITIONED ORGANIZATION        15012018
NULL     EQU   X'80'                    NULLFILE OR SYSCHECK            15015018
INOROUT  EQU   X'40'                    SYSIN OR SYSOUT DATA SET        15018018
TPDEV    EQU   X'10'                    TAPE DEVICE                     15024018
UNITREC  EQU   X'04'                    UNIT RECORD EQUIPMENT           15030018
ERRINNSL EQU   X'80'                    ERROR IN NSL ROUTINE            15033018
NSLMTSW  EQU   X'40'                    NSL MOUNT SWITCH                15036018
BYPASS   EQU   X'10'                    BYPASS LABEL PROCESSING         15042018
NSL      EQU   X'04'                    NON-STANDARD LABEL              15045018
SL       EQU   X'02'                    STANDARD LABEL                  15048018
NL       EQU   X'01'                    NO LABEL                        15051018
GTR5VOL  EQU   X'80'                    GREATER THAN 5 VOLUMES          15054018
DAFLAG   EQU   X'80'                    DA DATA SET FLAG                15060018
NONDAFLG EQU   X'40'                    NON-DA DATA SET FLAG            15063018
NSLFLAG  EQU   X'10'                    NSL ROUTINE FLAG                15066018
TYPERST  EQU   X'80'                    IMMEDIATE RESTART               15069018
TABENT   EQU   48                       TABLE ENTRY LENGTH              15072018
WRITE    EQU   X'01'                    WRITE ON TAPE                   15075018
READ     EQU   X'02'                    READ FOR TAPE                   15078018
NOPOP    EQU   X'03'                    NOP                             15081018
SENSE    EQU   X'04'                    SENSE                           15084018
REWIND   EQU   X'07'                    REWIND                          15087018
READBACK EQU   X'0C'                    READBACK                        15090018
UNLOAD   EQU   X'0F'                    REWIND AND UNLOAD               15093018
WTM      EQU   X'1F'                    WRITE TAPE MARK                 15096018
BSFOP    EQU   X'2F'                    BACKWARD SPACE FILE             15099018
FSFOP    EQU   X'3F'                    FORWARD SPACE FILE              15102018
SEARCH   EQU   X'31'                    SEARCH                          15105018
SRCHCNT  EQU   X'05'                    COUNT FOR SEARCH ID             15108018
TIC      EQU   X'08'                    TIC                             15111018
READDA   EQU   X'06'                    READ FOR DA                     15114018
LENJFCB  EQU   X'B0'                    LENGTH OF JFCB                  15117018
LBLLEN   EQU   X'50'                    LENGTH OF LABEL                 15120018
PERMERR  EQU   X'7F'                    PERMANENT ERROR                 15123018
ERR072   EQU   72                       ERROR READING IN DSCB  @ZSUT222 15126037
ERR076   EQU   76                       XTENTS OR LAST TTR'S   @ZSUT222 15128037
*                                       UNEQUAL DEB VS DSCB             15130037
ISORDA   EQU   IS+DA                    IS OR DA                        15135018
IOERROR  EQU   X'20'                    PERMANENT I/O ERROR             15138018
FILETYPE EQU   X'00'                    FILE TYPE BYTE                  15141018
THREE    EQU   X'03'                    TEST IF DSCB EXTN IS TO BE READ 15144018
READKND  EQU   X'0E'                    READ KEY AND DATA               15147018
LENGTH   EQU   X'8C'                    LENGTH OF KEY AND DATA          15150018
OUTP     EQU   X'0F'                    OUTPUT (DEBOPATB)               15153018
EXCHPGM  EQU   X'80'                    EXCP                            15156018
DADEVDPT EQU   X'0C'                    DA DEVICE DEPENDENT SECTION     15159018
WRITEDA  EQU   X'05'                    WRITE FOR DA                    15162018
SEVEN    EQU   X'07'                    TEST FOR GETTING UPPER LIMIT    15165018
LENDSCB  EQU   X'60'                    LENGTH OF DSCB                  15168018
DEBID    EQU   X'0F'                    DEB IDENTIFICATION              15171018
MAXEXT   EQU   X'CA'                    MAXIMUM NO. OF EXTENT           15174018
UNREL    EQU   X'02'                    UNRELATED FLAG                  15177018
TKBAL    EQU   25                       TRACK BALANCE SVC ROUTINE       15180018
CIND2PCI EQU   X'04'                    DCBCIND2 PCI CHAIN SCHED A29797 15190020
DEBPRFLN EQU   16                       LENGTH OF DEB PREFIX     Y02049 15192002
FLG2VAM  EQU   X'20'               VAM INDICATOR IN TABFLG2      Y02049 15192102
DEBEXTLN EQU   16                  LENGTH OF DEB EXTENT          Y02049 15196402
ULEXTNT  EQU   X'40'               INDICATES USER LABEL EXTENT   Y02049 15198002
NOEXTNT  EQU   X'00'               INDICATES NO EXTENT INFO      Y02049 15198402
ONE      EQU   1                   CONSTANT OF ONE               Y02049 15208402
EXTNTYP  EQU   0                   OFFSET TO EXTENT TYPE IN DSCB Y02049 15218402
D0       EQU   0                        CONSTANT ZERO            Y02076 15228402
D1       EQU   1                        CONSTANT ONE             Y02076 15238402
D3       EQU   3                        CONSTANT THREE           Y02076 15238802
D4       EQU   4                        CONSTANT FOUR            Y02076 15239202
D5       EQU   5                        CONSTANT FIVE            Y02049 15239602
D7       EQU   7                        CONSTANT SEVEN           YM7312 15241602
D8       EQU   8                        CONSTANT EIGHT           Y02076 15243002
D16      EQU   16                       CONSTANT SIXTEEN         Y02076 15246402
D20      EQU   20                       CONSTANT TWENTY          Y02076 15249802
D64      EQU   64                       CONSTANT SIXTY FOUR      Y02076 15251802
DF       EQU   X'FF'                    CONSTANT FOX FOX         Y02076 15253202
*                                                                       15256602
*                                                                       15260018
*********************************************************************** 15320018
*                                                                       15400018
         BALR  BASER,0                  ESTABLISH ADDRESSIBILITY        15500018
         USING *,BASER                                           YM7874 15600002
         B     BEGIN                    BR AROUND EYECATCHER     YM7874 15650002
         CNOP  0,8                      ALIGN TO A DBLWD BNDRY   YM7874 15660002
         DC    CL8'IGC0R05B'            MODULE NAME            @ZSUT222 15670037
         DC    CL8'&SYSDATE'            LAST DATE SHIPPED      @ZSUT222 15672037
         DC    CL8'@ZSUT222'            LAST CODE SHIPPED      @ZSUT222 15674037
BEGIN    EQU   *                                                 YM7874 15680002
*                                                                       15700018
         USING RSTWA,BUFR                                               15800018
         USING IHADCB,DCBR                                              15900018
         USING TABL,CTABLR                                              16000018
         USING FORECORE,UCBR                                            16100018
         USING TCB,TCBR                                                 16200018
         USING DEBBASIC,DEBR                                     Y02049 16300002
         USING CVT,WRKR2                                                16400018
*                                                                       16600018
*                                                                       16800018
         TM    TABFLG2-TABL(TABLR),TABSW   TEST FOR RETURN FROM PAR REL 16900002
         BO    REPDCB54                 YES - BRANCH                    17000018
*********************************************************************** 17050002
*   ESTABLISH ADDRESS OF FIRST BYTE BEYOND LAST 48 BYTE OPEN DATA     * 17060002
*   SET ENTRY.  THIS WILL BE THE BEGINNING OF THE FORECORE WORK AREA  * 17070002
*   FOR 'PARTIAL RELEASE'.                                            * 17080002
*********************************************************************** 17090002
         LR    CTABLR,TABLR             INITIALIZE TO BEGINNING  Y02076 17092002
REPDCB0A EQU   *                        INSTR MUST FOLLOW        Y02076 17094002
         TM    TABFLG1,TABLAST          IS THIS LAST ENTRY       Y02076 17096002
         BO    REPDCB0B                 BRANCH IF END            Y02076 17098002
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TO NEXT ENTRY  Y02076 17098402
         B     REPDCB0A                 BRANCH TO CONT COUNTING  Y02076 17098802
REPDCB0B EQU   *                        INSTR MUST FOLLOW        Y02076 17099602
         LA    CTABLR,TABENT(CTABLR)    1ST BYTE AFTER LAST      Y02076 17099702
*                                                                       17099802
*        LOAD ADDRESS OF FORECORE WORK AREA FOR PARTIAL RELEASE  YM7312 17108102
*        AND INSURE THAT IT IS ON A DOUBLE WORD BOUNDARY.        YM7312 17110102
*                                                                       17112102
         LA    UCBR,D7            LOAD 7 INTO REG                YM7312 17116602
         AR    UCBR,CTABLR        ADD PRELIM. FORECORE PTR       YM7312 17124902
         SRL   UCBR,D3            DROP EXTRA BITS IN ADDR.       YM7312 17133202
         SLL   UCBR,D3            FORECORE ADDR. NOW ON DOUBLE   YM7312 17143202
*                                 WORD BOUNDARY                  YM7312 17166702
         LR    CTABLR,TABLR             INITIALIZE CTABLR               17200018
         B     REPDCB02                 BRANCH TO TEST FOR TYPE OF D.S. 17400018
*                                                                       17500018
*********************************************************************   17600018
*                                                                       17700018
******** TEST FOR PS, PO, OR EXCP DATA SET                              17800018
*                                                                       17900018
*********************************************************************   18000018
*                                                                       18100018
REPDCB01 EQU   *                                                        18200018
*                                                                       18300018
         LA    CTABLR,TABENT(CTABLR)    POINT TO NEXT TABL ENTRY        18400018
*                                                                       18500018
REPDCB02 EQU   *                                                        18600018
*                                                                       18700018
         TM    TABDSORG,DA+IS           BDAM OR ISAM DATA SET    M0187  18760021
         BZ    REPDCB03                 BRANCH IF NOT            A25984 18820019
REPDCB05 EQU   *                                                 A30552 18830020
*                                                                       18840002
*        NOTE THAT THE ISAM/BDAM PROCESSING MODULE MUST BE       Y02049 18842002
*        CALLED, AND ALLOW CHECKING ON BDAM DATA SETS TO BE DONE Y02049 18844002
*                                                                       18846002
         MVI   RSRETCOD+1,X'FF'         SET ISAM FLAG            A25984 18850019
         TM    TABDSORG,IS              IS THIS AN ISAM D.S.     Y02049 18860002
         BO    REPDCB04                 GET NEXT DCB             Y02049 18880002
REPDCB03 EQU   *                                                 A25984 18910019
         TM    TABFLG2,TABPOCAT         TEST FOR PO CONCATENATION       19000002
         BO    REPDCB04                 YES - BRANCH                    19100018
         TM    TABFLG1,TABDA            TEST FOR A DA DEVICE            19200002
         BNO   REPDCB04                 BRANCH IF NOT            Y02049 19300002
         TM    TABFLG2,TABVIODS         IS THIS A VAM DATA SET?  YM7550 19350002
         BO    REPDCBA4                 BRANCH IF YES           ZA00128 19360002
         TM    TABFLG1,TABSYS           IS THIS SAM-SI           YM7550 19370002
         BNO   REPDCB10                 BRANCH IF NOT            Y02049 19380002
*                                                                       19400018
REPDCB04 EQU   *                                                        19500018
*                                                                       19600018
         TM    TABFLG1,TABLAST          TEST FOR LAST ENTRY             19700002
         BO    ENDUP                    YES - BRANCH                    19800018
*                                                                       19900018
         B     REPDCB01                 GO TEST TABL ENTRY              20000018
REPDCBA4 CLC   1(3,CTABLR),RSCKDCB+1    IS IT RESTART DATA SET  ZA00128 20050002
         BNE   REPDCB04                 BRANCH IF NOT           ZA00128 20060002
         L     DCBR,TABDCBAD-1          GET DCB ADDR            ZA00128 20070002
         MVC   DCBFDAD,RSBDCB+DCBFDAD-IHADCB  UPDATE DCBFDAD    ZA00128 20080002
         B     REPDCB04                 BR TO GET NEXT ENTRY    ZA00128 20090002
*                                                                       20100018
REPDCB10 EQU   *                                                        20200018
*                                                                       20300018
*********************************************************************   20400018
*                                                                     * 20500018
******** DEVICE = DA, ORGN = PS, PO, OR EXCP                          * 20600018
*                                                                     * 20700018
******** THIS SECTION OF CODE BUILDS THE WORKAREA FOR READING         * 20800002
*        IN THE DSCB FOR DATA SETS WHICH MIGHT REQUIRE A PARTIAL      * 20900018
*        RELEASE                                                      * 21000018
*                                                                     * 21100018
*********************************************************************   21200018
*                                                                       21300018
         XC    UCBAD,UCBAD              ZERO-UCB FILE-MULT VOL  ZA02895 21310037
         NI    TABFLG5,X'FD'            CLEAR MULTI-VOL BIT     ZA02895 21320037
         SR    WRKR2,WRKR2              CLEAR WRKR2              Y02076 21350002
         LA    WRKR1,DSECTSIZ           GET SIZE OF FORECORE     Y02076 21400002
         SRL   WRKR1,2                  DIVIDE BY 4              Y02076 21450002
         LR    WRKR3,UCBR               BEGIN ADR OF FORECORE    Y02076 21500002
REPDCB12 EQU   *                        INSTR MUST FOLLOW        Y02076 21550002
         ST    WRKR2,D0(WRKR3)          CLEAR 4 BYTES            Y02076 21560002
         LA    WRKR3,D4(WRKR3)          INCR TO NEXT 4 BYTES     Y02076 21570002
         BCT   WRKR1,REPDCB12           BR BACK UNTIL ALL CLEAR  Y02076 21580002
         BAL   WRKR5,BLDCCWS            BRANCH TO BUILD CCW LIST SBRTN  21600018
*                                                                       21700018
         LA    WRKR5,REPDCB22           SET UP FOR BYPASS        A29797 21800020
*                                                                       21900018
REPDCB20 EQU   *                                                        22000018
*                                                                       22100018
*********************************************************************   22200018
*                                                                       22300018
******** READ THE DSCB                                                  22400018
*                                                                       22500018
*********************************************************************   22600018
*                                                                       22700018
         EXCP  DXIOB                                                    22800018
*                                                                       22900018
*********************************************************************   23000018
*                                                                       23100018
******** WAIT FOR COMPLETION OF READ                                    23200018
*                                                                       23300018
*********************************************************************   23400018
*                                                                       23500018
         WAIT  ,ECB=DXECB                                               23600018
*                                                                       23700018
         TM    DXECB,IOERROR            TEST FOR PERM I/O ERROR         23800018
         BZ    REPDCB68                 BRANCH IF ERROR           M3251 24000018
*                                                                       24200018
         BR    WRKR5                    BRANCH BACK TO CALLER    A29797 24300020
*                                                                       24400018
*********************************************************************   24500018
*                                                                       24600018
******** THE DSCB HAS BEEN SUCCESSFULLY READ                            24700018
*                                                                       24800018
*********************************************************************   24900018
*                                                                       25000018
******** ******     ***** *****  ********  ************     *********** 25007018
*                   -UPDATE PP CHECKPOINT DCB-                        * 25014018
*                                                                     * 25021018
* AT RESTART THE FULL DISK ADDR AND TRK BALANCE IN THE PP DCB MUST BE * 25028018
* UPDATED.THE FULL DISK ADDR FROM THE CHKPT DCB IN THE RESTART WKAREA * 25035018
* AND THE TRK BALANCE FROM THE DSCB.                                  * 25042018
******** ******     ***** *****  ********  ************     *********** 25049018
*                                                                       25056018
REPDCB22 EQU   *                                                 A29797 25059020
         MVC   DXCCW4(44),DXDSCB        SAVE KEY OF F1          YA00279 25061802
         MVC   DXDSCB,DXDSCB+44         REPOS DATA PORTION      YA00279 25062202
         CLI   DSCFMTID,X'F1'           IS IT FORMAT1 DSCB       Y02049 25062602
         BNE   REPDCB68                 BR IF NOT,ERR072         Y02049 25062737
         CLC   1(3,CTABLR),RSCKDCB+1    IS THIS THE CHKPT DCB           25063018
         BNE   REPDCB24                 BRANCH IF NO             A29797 25072020
*                                                                       25081020
         MVC   DCBFDAD,RSBDCB+DCBFDAD-IHADCB UPDATE PP DISK ADDR A29797 25090020
*                                                                       25099020
*              SET UP ECB TO BE POSTED BY SVC 25'S EXCP.                25108020
*              THE IOB, LAST USED DURING CHECKPOINT, POINTS TO THE OLD  25117020
*              CHECKPOINT DECB, WHICH IS NOT THE DECB FOR RESTART.      25126020
*                                                                       25135020
         L     WRKR6,DCBIOBA            ADDR NORMAL IOB PREFIX   A29797 25144020
*                                                                       25153020
         TM    DCBCIND2,CIND2PCI        TEST IF CHAINED SCHEDULE A29797 25162020
         BZ    REPDCB23                 BRANCH IF NO             A29797 25171020
*                                                                       25180020
         L     WRKR6,DCBIOBAD           ADDR CH SCHD IOB PREFIX  A29797 25189020
         LA    WRKR6,8(WRKR6)           ADJUST TO NORMAL IOB PFX A29797 25198020
*                                                                       25207020
REPDCB23 EQU   *                                                 A29797 25216020
         LA    WRKR1,RSECB1             ADDR OF ECB TO BE POSTED A29797 25225020
         ST    WRKR1,IOBECBPT-IOBFLAG1+8(WRKR6)  PUT ADDR IN IOB A29797 25234020
*                                                                       25243020
         LA    WRKR2,0(DCBR)            LOAD PP DCB ADDR FOR SVC A29797 25252020
         SVC   TKBAL                    ISSUE TRACK BALANCE SVC  A29797 25261020
*                                                                       25270020
REPDCB24 EQU   *                                                        25300018
*                                                                       25400018
         CLI   DSCFILTY,FILETYPE        IS FILE TYPE BYTE EQ ZEROS      25500018
         BE    REPDCB2A                 YES - BRANCH                    25600018
         TM    TABDSORG,DA              IS IT BDAM              ZA02895 25650037
         BO    REPDCB2A                 YES-DON'T UPDATE DSORG  ZA02895 25660037
*                                                                       25700018
         MVC   TABDSORG(1),DSCFILTY     OVERLAY TABL DS ORGN BYTE       25800018
*                                                                       25900018
REPDCB2A EQU   *                                                        26000018
*                                                                       26100018
         L     DEBR,DCBDEBAD            POINT TO DEB                    26200018
         IC    DSCNTR,DSCNOEXT          GET NUMBER OF DSCB EXTS   M3251 26240018
         CLI   DSCEXTYP,X'40'           USER LABELS PRESENT       M3251 26280018
         BNE   REPDCB2B                 NO, BRANCH                M3251 26320018
         LA    DSCNTR,1(0,DSCNTR)       ALLOW FOR USER LABEL EXT  M3251 26360018
REPDCB2B CLI   DSCNEXT+4,X'00'          IS A DSCB EXTN PRESENT    M3251 26400018
         BE    REPDCB25                 NO, BRANCH                M3251 26440018
*                                                                       26500018
         LA    WRKR6,DXJBF              POINT TO THE JFCB READ AREA     26600018
         ST    WRKR6,DXCCW3             STORE IN CCW 3                  26700018
         MVI   DXCCW3,READKND           SET CCW TO READ KEY AND DATA    26800018
         MVI   DXCCW3+7,LENGTH          SET AMOUNT TO BE READ = 140     26900018
         MVC   DXDAADDR+3(5),DSCNEXT    MOVE CCHHR OF F3 DSCB TO IOB    27000018
*                                                                       27100018
         BAL   WRKR5,REPDCB20           BRANCH (WITH LINK) TO READ F3   27200018
*                                                                       27300018
         CLI   DS3FMTID,X'F3'      IS THIS A FORMAT 3 DSCB?      Y02049 27350002
         BNE   REPDCB68            BRANCH IF NOT, ERROR 72       Y02049 27360002
         EJECT                                                          27370002
REPDCB25 EQU   *                                                        27400018
*                                                                       27450002
*        THIS ROUTINE WILL COMPARE THE EXTENTS IN THE DEB TO     Y02049 27460002
*        THOSE IN THE DSCB(S) FOR THIS DATA SET.  IF THE         Y02049 27470002
*        EXTENTS ARE ALL EQUAL, THE NEXT DATA SET IS CHECKED.    Y02049 27480002
*                                                                       27482002
*        IF THE DEB EXTENTS ENCOMPASS A GREATER NUMBER OF        Y02049 27490002
*        TRACKS IN THE SAME DISK SPACE, THE DEB IS COMPRESSED.   Y02049 27492002
*                                                                       27494002
*        IF THE DSCB HAS A GREATER NUMBER OF TRACKS IN THE       Y02049 27496002
*        SAME DISK SPACE, PARTIAL RELEASE IS CALLED TO RELEASE   Y02049 27498002
*        THE SPACE ACQUIRED AFTER CHECKPOINT.                    Y02049 27498402
*                                                                       27498802
*        IF THE EXTENTS ARE NOT IN THE SAME DISK SPACE, AN       Y02049 27499202
*        ERROR CONDITION IS RAISED.                              Y02049 27499602
*                                                                       27500018
*****************                                                       27510002
*                                                                       27520002
*        ADJUST POINTERS FOR FIRST EXTENT COMPARISON             Y02049 27530002
*                                                                       27540002
         STC   DSCNTR,EXTNO             SAVE NO. OF DSCB EXTENTS  M3251 27550018
         LA    WRKR2,DEBBASND      GET FIRST DEB EXTENT          Y02049 27600002
         USING DEBDASD,WRKR2                                     Y02049 27650002
         MVC   UCBAD+1(3),DEBUCBAD+1  SAVE UCB ADDR             ZA02895 27660037
         LA    WRKR3,DSCEXTYP      GET FIRST DSCB EXTENT         Y02049 27700002
         USING DSCEXTYP,WRKR3                                    Y02049 27750002
         LA    WRKR6,DSCEXTLN(,WRKR3) GET NEXT DSCB EXTNT PTR    Y02049 27800002
         CLI   DSCEXTYP,ULEXTNT    IS THIS A USER LABEL EXTNT?   Y02049 27850002
         BNE   REPDCB30            NO, BYPASS INCRIMENTING       Y02049 27900002
         LR    WRKR3,WRKR6         INCREMENT TO FIRST USER EXTNT Y02049 27950002
         LA    WRKR6,DSCEXTLN(,WRKR6) GET NEXT DSCB EXTNT PTR    Y02049 28000002
*                                                                       28050002
REPDCB30 EQU   *                   INSTR MUST FOLLOW             Y02049 28100002
*                                                                       28110002
*        CHECK THE CASE WHERE THE DEB, DSCB, OR BOTH MIGHT       Y02049 28120002
*        HAVE ZERO EXTENTS.                                      Y02049 28130002
*                                                                       28150002
         SR    DSCNTR,DSCNTR       ZERO OUT REGISTER             Y02049 28200002
         IC    DSCNTR,DEBNMEXT     GET NO. OF EXTENTS IN DEB     Y02049 28250002
         CLI   DSCNOEXT,X'00'      ARE THERE ANY DSCB EXTNTS?    Y02049 28300002
         BNE   REPDCB31            YES, CHECK DEB                Y02049 28350002
         LTR   DSCNTR,DSCNTR       ARE THERE ANY DEB EXTENTS?    Y02049 28400002
         BZ    REPDCB04            NO, GET NEXT TABL ENTRY       Y02049 28450002
         B     REPDCB40            NO, COMPRESS DEB              Y02049 28500002
*                                                                       28550002
REPDCB31 EQU   *                   INSTR MUST FOLLOW             Y02049 28600002
*                                                                       28650002
         LTR   DSCNTR,DSCNTR       ARE THERE ANY DEB EXTENTS?    Y02049 28700002
         BZ    REPDCB50            NO, DO PARTIAL RELEASE        Y02049 28750002
         B     REPDCB32                 GO COMPARE EXTNTS       ZA02895 28760037
*                                                                       28770037
*                                                                       28780037
*  PREPARE TO READ IN THE F1 DSCB OF THE NEXT VOLUME            ZA02895 28790037
*  VIA THE VTOC TTR CONTAINED IN THE UCB                        ZA02895 28792037
*                                                                       28794037
         DROP  WRKR3                                            ZA02895 28796037
REPDC32A OI    TABFLG5,X'02'            SET MULTI VOL FLAG      ZA02895 28798037
         L     WRKR3,UCBAD              GET UCB ADDR            ZA02895 28798437
         USING UCBOB,WRKR3                                      ZA02895 28798837
         L     WRKR1,UCBVTOC            GET TTR OF VTOC         ZA02895 28799237
         SRL   WRKR1,8                  RIGHT JUSTIFY TTR0      ZA02895 28799637
         BCTR  WRKR1,0                  DECR BY 1 FOR SEEK      ZA02895 28799737
         SLL   WRKR1,8                  LEFT JUSTIFY TTR0       ZA02895 28799837
         XC    VTOCCHHR(8),VTOCCHHR     CLEAR FIELD FOR CCHHR   ZA02895 28799937
         STM   WRKR2,WRKR6,DXDSCB+DSECTSIZ    SAVE REGS         ZA02895 28816637
         LA    TIOTR,DXDSCB+DSECTSIZ    SAV REG ACROSS CALL     ZA02895 28826637
         ST    TIOTR,REG6SAV            SAVE REG 6              ZA02895 28828637
         LA    WRKR2,DXDEB              PT TO WORK AREA DEB     ZA02895 28830637
         L     WRKR6,CVTPTR             GET CVT ADDR            ZA02895 28832637
         LA    DCBR,VTOCCHHR            LOCATION OF RESULTS     ZA02895 28833037
         L     WRKR6,CVTPCNVT-CVTMAP(WRKR6) CNVRT RTN ADR       ZA02895 28833137
         BALR  WRKR5,WRKR6              CONVERT TO CCHHR        ZA02895 28833237
         LM    WRKR2,WRKR6,0(TIOTR)     RESTORE REGS            ZA02895 28838837
         BAL   WRKR5,BLDCCWS            SET CCWS FOR READ       ZA02895 28840837
         L     TIOTR,REG6SAV            RESTORE REG 6           ZA02895 28842837
         LM    WRKR2,WRKR6,0(TIOTR)     RESTORE REGS            ZA02895 28843237
         LR    TIOTR,WRKR2              SAVE R1 ACROSS CALL     ZA02895 28843637
         MVC   DXDAADDR+3(5),VTOCCHHR+3 SET VTOC CCHHR         @ZA08861 28843837
         BAL   WRKR5,REPDCB20           GO READ F1 DSCB         ZA02895 28844037
         LR    WRKR2,TIOTR              RESTORE R1              ZA02895 28844137
*                                                                       28844237
*   CHECK FOR F3 DSCB - IF ONE EXISTS, READ IT IN               ZA02895 28844337
*   THEN SET UP PTRS TO PT TO FIRST EXTENT IN F1 DSCB           ZA02895 28848237
*                                                                       28850237
         CLI   DSCFMTID,X'F1'           IS IT FORMAT 1          ZA02895 28850637
         BNE   REPDCB68                 BR IF NOT,ERR072        ZA02895 28851037
         SR    WRKR1,WRKR1              CLEAR REG0              ZA02895 28851437
         IC    WRKR1,DSCNOEXT           GET NO. DSCB EXTS       ZA02895 28851837
         CLI   DSCNEXT+4,X'00'          IS THER A DSCB EXTNTION ZA02895 28851937
         BE    REPDC32C                 NO-BRANCH               ZA02895 28852037
         XC    DXCCW1(24),DXCCW1        CLEAR CCWS              ZA02895 28852137
         LA    WRKR6,DXDAADDR+3         PT TO CCHHR             ZA02895 28855637
         ST    WRKR6,DXCCW1             STORE IN SRCH CCW       ZA02895 28857637
         LA    WRKR6,DXCCW1             PT TO SEARCH CCW        ZA02895 28858037
         ST    WRKR6,DXCCW2             STORE IN TIC CCW        ZA02895 28858437
         LA    WRKR6,DXJBF              PT TO JFCB READ IN AREA ZA02895 28858837
         ST    WRKR6,DXCCW3             ST IN READ DATA CCW     ZA02895 28859237
         OC    DXCCW1(24),CCWLIST       OR IN CCWS              ZA02895 28859337
         MVI   DXCCW3,READKND           SET CCW-(READ-KEY-DATA) ZA02895 28859437
         MVI   DXCCW3+7,LENGTH          SET LENGTH = 140        ZA02895 28859637
         MVC   DXDAADDR+3(5),DSCNEXT    MOVE IN CCHHR           ZA02895 28859737
         LR    TIOTR,WRKR2              SAVE REG 1              ZA02895 28859837
         BAL   WRKR5,REPDCB20           READ IN F3 DSCB         ZA02895 28859937
         LR    WRKR2,TIOTR              RESTORE REG 1           ZA02895 28866537
         CLI   DS3FMTID,X'F3'           IS IT FORMAT 3          ZA02895 28868537
         BNE   REPDCB68                 BR IF NOT,ERR072        ZA02895 28870537
REPDC32C LA    WRKR3,DSCEXTYP           POINT TO 1ST DSCB EXT   ZA02895 28872537
         LA    WRKR6,DSCEXTLN(,WRKR3)   GET NEXT DSCB EXT PTR   ZA02895 28872937
*                                                                       28873337
*     COMPARE THE LOW AND HIGH CCHH IN THE DSCB AND DEB         ZA02895 28873437
*                                                                       28873537
REPDCB32 EQU   *                        COMPARE DEB-DSCB EXTS   ZA02895 28884437
         USING DSCEXTYP,WRKR3                                   ZA02895 28894437
*        COMPARE THE LOW AND HIGH CCHH IN THE DSCB AND DEB       Y02049 28928237
*                                                                       28939137
         CLI   DSCEXTYP,NOEXTNT    IS THIS A VALID DSCB EXTENT?  Y02049 28950002
         BE    REPDCB40            NO, COMPRESS DEB              Y02049 29000002
         CLC   DEBSTRCC(D4),DSCLOWLM COMPARE LOW CCHH IN DEB     Y02049 29050002
*                                  TO DSCB                       Y02049 29100002
         BNE   REPDCB70            ERROR IF NOT EQUAL            Y02049 29150002
         CLC   DEBENDCC(D4),DSCUPPLM COMPARE HI CCHH IN DEB      Y02049 29200002
*                                  TO DSCB                       Y02049 29250002
         BE    REPDCB34            EQUAL, GO CHECK MORE EXTNTS   Y02049 29300002
         BH    REPDCB33            DEB IS HI, CHECK IF LAST      Y02049 29350002
*                                  DSCB EXTENT                   Y02049 29400002
*                                                                       29410002
*        THE DEB VALUE IS LOWER THAN THE DSCB                    Y02049 29420002
*                                                                       29430002
         LA    WRKR4,ONE           LOAD VALUE OF 1 IN WRK REG    Y02049 29450002
         CR    DSCNTR,WRKR4        IS THIS THE LAST DEB EXTNT?   Y02049 29500002
         BE    REPDCB50            YES, DO PARTIAL RELEASE       Y02049 29550002
         B     REPDCB70            NO, ERROR                     Y02049 29600002
*                                                                       29650002
REPDCB33 EQU   *                   INSTR MUST FOLLOW             Y02049 29700002
*                                                                       29710002
*        THE DEB VALUE IS HIGHER THAN THE DSCB                   Y02049 29720002
*                                                                       29750002
         LTR   WRKR6,WRKR6         NEXT DSCB EXTNT VALID?        Y02049 29800002
         BZ    REPDCB60            NO, COMPRESS DEB              Y02049 29850002
         CLI   EXTNTYP(WRKR6),NOEXTNT   IS THERE ANOTHER VALID   Y02049 29900002
*                                  DSCB EXTENT?                  Y02049 29950002
         BE    REPDCB60            NO, COMPRESS DEB              Y02049 30000002
         B     REPDCB70            YES, ERROR                    Y02049 30050002
*                                                                       30100002
REPDCB34 EQU   *                   INSTR MUST FOLLOW             Y02049 30150002
*                                                                       30160002
*        THE DEB AND DSCB VALUES ARE EQUAL                       Y02049 30170002
*                                                                       30200002
         BCT   DSCNTR,REPDCB35     BRANCH IF NOT LAST DEB EXTENT Y02049 30250002
         LTR   WRKR6,WRKR6         NEXT DSCB EXTNT PTR VALID?    Y02049 30300002
         BZ    REPDCB04            NO, GET NEXT TABL ENTRY       Y02049 30350002
         CLI   EXTNTYP(WRKR6),NOEXTNT   IS THERE ANOTHER VALID   Y02049 30400002
*                                  DSCB EXTENT?                  Y02049 30450002
         BNE   REPDCB50            YES, DO PARTIAL RELEASE       Y02049 30500002
         B     REPDCB04            NO, GET NEXT TABL ENTRY       Y02049 30550002
*                                                                       30600002
REPDCB35 EQU   *                   INSTR MUST FOLLOW             Y02049 30650002
*                                                                       30652002
*        THERE ARE MORE DEB EXTENTS, PREPARE TO COMPARE          Y02049 30654002
*        THE NEXT EXTENT                                         Y02049 30656002
*                                                                       30660002
         LA    WRKR2,DEBEXTLN(,WRKR2) POINT TO NEXT DEB EXTNT    Y02049 30670002
         LTR   WRKR6,WRKR6         MORE DSCB EXTENTS ?           Y02049 30680002
         BZ    REPDCB40            NO MORE DSCB EXTNTS, COMPRESS Y02049 30692002
         LR    WRKR3,WRKR6         GET NEXT DSCB EXTNT PTR       Y02049 30692402
         LA    WRKR6,DSCEXTLN(,WRKR6) INCREMENT 'NEXT EXTENT'    Y02049 30694002
*                                  POINTER                       Y02049 30696002
*                                                                       30696102
*        SEE IF THE 'NEXT EXTENT' IS IN THE FORMAT 1 DSCB        Y02049 30696402
*                                                                       30696802
         LA    WRKR4,DSCEXT2-DXDSCB(,UCBR)                       Y02049 30698002
*                                  GET ADDR OF LAST FMT 1 EXT.   Y02049 30698102
         CR    WRKR3,WRKR4         COMPARE FOR END OF FMT 1      Y02049 30698402
         BL    REPDCB32            LOW, CHECK NEXT EXTENT        Y02049 30698802
         OC    DSCEXTLN(D5,WRKR4),DSCEXTLN(WRKR4)                Y02049 30699202
*                                  IS THERE A FORMAT 3 DSCB?     Y02049 30699602
         BNZ   REPDCB36            YES, GO GET ADDRESS           Y02049 30699702
         SR    WRKR6,WRKR6         ZERO 'NEXT EXTENT' POINTER    Y02049 30699802
         B     REPDCB32            GO CHECK NEXT EXTENT          Y02049 30699902
*                                                                       30733202
REPDCB36 EQU   *                   INSTR MUST FOLLOW             Y02049 30743202
*                                                                       30745202
*        SEE IF THE 'NEXT EXTENT' IS IN THE FORMAT 3 DSCB        Y02049 30747202
*        KEY PORTION                                             Y02049 30749202
*                                                                       30753202
         CR    WRKR3,WRKR4         IS THIS LAST FMT 1 EXTENT?    Y02049 30763202
         BNE   REPDCB37            NO, CHECK IF LAST F3 KEY EXT  Y02049 30765202
         LA    WRKR6,F3KFIRST(,UCBR)  GET FIRST EXT IN F3 KEY    Y02049 30765602
         B     REPDCB32            GO CHECK NEXT EXTENT          Y02049 30766002
*                                                                       30766402
REPDCB37 EQU   *                  INSTR MUST FOLLOW              Y02049 30766502
*                                                                       30770202
*        SEE IF THE 'NEXT EXTENT' IS IN THE FORMAT 3 DSCB        Y02049 30772202
*        DATA PORTION                                            Y02049 30772602
*                                                                       30773002
*                                                                       30774002
         LA    WRKR4,F3KLAST(,UCBR)  GET LAST EXT IN F3 KEY      Y02049 30777702
         CR    WRKR3,WRKR4         COMPARE FOR END OF F3 KEY     Y02049 30787702
         BL    REPDCB32            LOW, CHECK NEXT EXTENT        Y02049 30788102
         BH    REPDCB38            HIGH, CHECK IF LAST F3 DATA   Y02049 30788502
*                                  EXTENT                        Y02049 30788602
         LA    WRKR6,F3DFIRST(,UCBR)  GET FIRST EXT IN F3 DATA   Y02049 30788702
         B     REPDCB32            GO CHECK NEXT EXTENT          Y02049 30788802
*                                                                       30792502
REPDCB38 EQU   *                   INSTR MUST FOLLOW             Y02049 30794502
*                                                                       30794902
         LA    WRKR4,F3DLAST(,UCBR)  GET LAST EXT IN F3 DATA     Y02049 30795302
         CR    WRKR3,WRKR4         COMPARE FOR END OF F3 DATA    Y02049 30795702
         BL    REPDCB32            LOW, CHECK NEXT EXTENT        Y02049 30796102
         SR    WRKR6,WRKR6         ZERO 'NEXT EXTENT' POINTER    Y02049 30796202
         B     REPDCB32            GO CHECK NEXT EXTENT          Y02049 30822102
REPDCB40 EQU   *                   INSTR MUST FOLLOW             Y02049 30842102
         CLC   UCBAD+1(3),DEBUCBAD+1  HAS UCB CHANGED           ZA02895 30842537
         BE    REPDCB41                 BR IF NO CHANGE         ZA02895 30842937
         MVC   UCBAD+1(3),DEBUCBAD+1    SAVE NEW UCB ADDR       ZA02895 30843337
         B     REPDC32A                 GO READ F1/F3 DSCB      ZA02895 30843737
         DROP  WRKR2,WRKR3                                      ZA02895 30843837
REPDCB41 TM    TABDSORG,DA         IS THIS A BDAM DATA SET ?     Y02049 30844137
         BO    REPDCB04            YES, DO NOT COMPRESS BDAM     Y02049 30846102
*                                  DEBS.                         Y02049 30848102
         BAL   WRKR5,REPDCB76      BRANCH TO UPDATE DEB SUBRTN   Y02049 30856702
*                                                                       30865502
*********************************************************************   30874102
*                                                                       30900018
******** NOW COMPRESS AND UPDATE THE DEB                                31000018
*                                                                       31100018
*********************************************************************   31200018
*                                                                       31300018
         SR    WRKR4,WRKR4              CLEAR WRKR4                     31400018
         SR    WRKR6,WRKR6              CLEAR WRKR6                     31500018
         IC    WRKR4,DSCNOEXT           INSERT DSCB NO. OF EXTENTS      31600018
         IC    WRKR6,DEBNMEXT           INSERT DEB NO. OF EXTENTS       31700018
         STC   WRKR4,DEBNMEXT           UPDATE NO. EXTS. IN DEB         34300018
*                                                                       34400018
         SLL   WRKR4,4                  GET DSCNOEXT IN BYTES           34600018
         SLL   WRKR6,4                  GET DEBNMEXT IN BYTES           34700018
*                                                                       34900018
*********************************************************************   35000018
*                                                                     * 35100018
******** GET LENGTH OF THE ACCESS METHOD PORTION OF THE DEB SO THAT IT* 35200018
*        CAN OVERLAY THE EXTENTS TO BE DELETED, THUS COMPRESSING THE  * 35300018
*        DEB                                                          * 35400018
*                                                                     * 35500018
******** WRKR3 NOW CONTAINS LENGTH TO BE MOVED                        * 35600018
*                                                                     * 35700018
*********************************************************************   35800018
*                                                                       35900018
         LA    WRKR2,DEBSUCBA           GET ADDR OF START OF     Y02049 36000002
*                                       DEVICE DEPENDANT SECTION Y02049 36050002
         LA    WRKR6,0(WRKR2,WRKR6)     POINT WRKR6 TO START OF AM SEC  36100018
         LA    WRKR2,0(WRKR4,WRKR2)     POINT TO NEW AM START ADDR      36200018
         SR    WRKR3,WRKR3              CLEAR WRKR3                     36300018
         IC    WRKR3,DEBAMLNG           INSERT ACC METHOD SEC LENGTH    36400018
         SR    WRKR4,WRKR4              CLEAR REGISTER          ZA00609 36450002
         IC    WRKR4,DEBNMSUB           GET NO. OF SUBR.        ZA00609 36470002
         SLL   WRKR4,1                  MULT. BY 2 FOR BYTES    ZA00609 36480002
         AR    WRKR3,WRKR4              SPACE FOR SUBR IDS      ZA00609 36492002
         EX    WRKR3,CLOSEUP            EXECUTE THE MOVE                36600018
*                                                                       36700018
*********************************************************************   36800018
*                                                                       36900018
******** END OF DEB COMPEESSION AND RE-FORMATTING                       37000018
*                                                                       37100018
*********************************************************************   37200018
*                                                                       37300018
         B     REPDCB04                 BRANCH TO PROCESS NEXT ENTRY    37400018
*                                                                       37500018
*********************************************************************   37600018
*                                                                     * 37700018
******** THE FOLLOWING ROUTINE IS ENTERED IF THE NO. OF EXTENTS IN    * 37800018
*        THE DSCB IS GREATER THAN THE NO. OF EXTENTS IN THE DEB.      * 37900018
*        THIS MEANS THAT ADDITIONAL DA SPACE WAS DYNAMICALLY ALLOCATED* 38000018
*        AFTER THE CHECKPOINT OCCURRED AND HENCE A PARTIAL RELEASE    * 38100018
*        OF THIS ADDITIONAL SPACE IS NECESSARY.                       * 38200018
*                                                                     * 38300018
*********************************************************************   38400018
*                                                                       38500018
REPDCB50 EQU   *                   INSTR MUST FOLLOW             Y02049 38600002
*                                                                       38650002
         TM    TABDSORG,DA         IS THIS A BDAM DATA SET ?     Y02049 38660002
         BO    REPDCB04            YES, DO NOT CALL PARTIAL      Y02049 38670002
*                                  RELEASE FOR BDAM DATA SETS    Y02049 38680002
*                                                                       38700018
         TM    DEBOPATB,OUTP       IS DATA SET OPEN FOR INPUT           38800002
         BZ    REPDCB70            YES - BR OUT                         38900002
*                                                                       39000018
         LR    WRKR3,DEBR          GET DEB ADDR FOR CALC         Y02049 39050002
         LA    WRKR6,DEBPRFLN      GET LENGTH OF DEB PREFIX      Y02049 39060002
         SR    WRKR3,WRKR6         POINT TO DEB PREFIX           Y02049 39070002
         USING DEBPREFX,WRKR3                                    Y02049 39080002
         L     WRKR3,DEBXTNP       POINT TO DEB EXTENSION        Y02049 39090002
         USING DEBXTN,WRKR3                                      Y02049 39092002
         TM    DEBXMCF1,DCBMRECP   IS THIS EXCP?                 Y02049 39100002
         BZ    REPDCB52                 NO - BRANCH                     39200018
*                                                                       39300018
         TM    DEBXMCF2,DCBMR5WD+DCBMR4WD                        Y02049 39400002
*                                  TEST FOR DA DEV DEPENDANT SEC Y02049 39450002
         BZ    REPDCB70                 BRANCH IF NOT PRESENT           39500018
         DROP  WRKR3                                             Y02049 39550002
*                                                                       39600018
REPDCB52 EQU   *                                                        39700018
*                                                                       39800018
*********************************************************************   39900018
*                                                                     * 40000018
******** CONVERT RTN INTERFACE (CCHHR TO TTR) FOLLOWS                 * 40100018
*                                                                     * 40200018
*********************************************************************   40300018
*                                                                       40400018
         STM   WRKR2,WRKR6,DXDSCB+DSECTSIZ     SAVE REGS         Y02076 40500002
         L     WRKR2,CVTPTR             INITIALIZE CVT REGISTER   M3251 40600018
         USING CVT,WRKR2                                         Y02049 40650002
         L     WRKR6,CVTPRLTV           POINT TO CONVERT RTN            40800018
         L     WRKR2,DCBDEBAD           POINT TO DEB                    40900018
         LA    DCBR,DCBFDAD             POINT TO FULL DISK ADDR         41000018
         BALR  WRKR5,WRKR6              BR AND LINK TO CONVERT RTN      41100018
*                                                                       41200018
         LM    WRKR2,WRKR6,DXDSCB+DSECTSIZ      RESTORE REGS     Y02076 41300002
         ST    WRKR1,DXDAADDR           STORE TTR IN WORKAREA           41400018
*                                                                       41500018
*********************************************************************   41600018
*                                                                     * 41700018
******** MODIFY LAST TRACK USED FIELD IN DSCB                         * 41800018
*                                                                     * 41900018
*********************************************************************   42000018
*                                                                       42100018
         MVC   DSCLSTAR(3),DXDAADDR     MOVE IN TTR                     42200018
         MVC   DSCLSTAR+3(2),DCBTRBAL   MOVE IN REMAINING BYTES-LASTTRK 42300018
         MVC   DXDSCB+DSECTSIZ(8),DCBFDAD    SAVE FULL DISK ADDR Y02076 42400002
*                                                                       42500018
         SR    WRKR3,WRKR3              CLEAR WRKR3                     42600018
         IC    WRKR3,DEBNMEXT           INSERT NO. OF EXTENTS           42700018
         BCTR  WRKR3,0                  DECREMENT COUNT BY 1            42800018
         STC   WRKR3,DCBFDAD            STORE NO. XTNTS-1 IN 'M'        42900018
         SLL   WRKR3,4                  MULT BY 16                      43000018
         LA    TCBR,DEBBASND            ADR DASD SEC             Y02049 43050002
         LA    TCBR,DEBBASND            GET ADDR OF DASD SECTION Y02049 43050102
         USING DEBDASD,TCBR                                      Y02049 43060002
         USING DEBDASD,TCBR                                      Y02049 43060102
         LA    WRKR6,DEBENDCC(WRKR3)    POINT TO ENDING CCHH IN LST EXT 43100018
         MVC   DCBFDAD+3(4),0(WRKR6)    MOVE IN CORRECT CCHH            43200018
         DROP  TCBR                                              Y02049 43250002
*                                                                       43300018
*********************************************************************   43400018
*                                                                     * 43500018
******** THE NEXT 2 INSTRUCTIONS SET ON THE HIGH ORDER BIT IN DEBR SO * 43600018
*        THAT THE PARTIAL RELEASE MODULES WILL RETURN CONTROL         * 43700018
*        BACK TO THIS MODULE AND NOT RETURN TO CLOSE.  DEBR IS THEN   * 43800018
*        POINTED AT THE CLOSE-TYPE WORKAREA EXPECTED BY PARTIAL REL.  * 43900018
*                                                                     * 44000018
*********************************************************************   44100018
*                                                                       44200018
         LA    DEBR,1                   TURN ON LOW ORDER BIT           44300018
         SLL   DEBR,31                  SHIFT TO HIGH ORDER POSITION    44400018
         OR    DEBR,UCBR                POINT DEBR AT CLOSE WORKAREA    44500018
         MVC   JFCBDSNM,DXCCW4          PART. REL. EXPECTS KEY  YA00279 44550002
*                                       PORTION OF F1 AT THIS   YA00279 44560002
*                                       POSIT. IN W.A.          YA00279 44570002
         OI    TABFLG2-TABL(TABLR),TABSW   SET ON PAR RLSE SWITCH       44600002
         L     TCBR,RSTCBAD             LOAD TCB ADDRESS                44710018
         USING TCB,TCBR                                          Y02049 44712002
         L     WRKR2,TCBTIO             LOAD TIOT ADDRESS               44720018
         LH    TIOTR,DCBTIOT            LOAD TIOT OFFSET                44730018
         LR    TCBR,BUFR                SAVE CONTENTS OF BUFR           44740018
         L     BUFR,16(WRKR2,TIOTR)     LOAD SUB UCB ADDRESS            44750018
         B     XCTL                     BRANCH TO XCTL RTN              44800018
*                                                                       44900018
REPDCB54 EQU   *                                                        45000018
*                                                                       45100018
*********************************************************************   45200018
*                                                                     * 45300018
******** UPON RE-ENTRY OF THIS MOD FROM THE PARTIAL RELEASE ROUTINE   * 45400018
*        CONTROL IS PASSED TO THIS ROUTINE FOR POST-PARTIAL RELEASE   * 45500018
*        PROCESSING.                                                  * 45600018
*                                                                     * 45700018
*********************************************************************   45800018
*                                                                       45900018
         LR    BUFR,TCBR                RESTORE BUFR                    45960018
         NI    TABFLG2-TABL(TABLR),X'FF'-TABSW RESET PAR REL SW         46010002
         MVC   DCBFDAD(D8),DXDSCB+DSECTSIZ  RESTORE FULL DSK ADR Y02076 46100002
         LTR   WRKR2,WRKR2              IS THERE AN ERROR RETURN CODE   46200018
         BNZ   REPDCB68                 BR IF ERR PRESENT       YA00279 46250002
         B     REPDCB04                 GO GET NEXT ENTRY       YA00279 46300002
REPDCB60 EQU   *                                                        49200018
*                                                                       49250002
         TM    TABDSORG,DA         IS THIS A BDAM DATA SET ?     Y02049 49260002
         BO    REPDCB04            YES, DO NOT UPDATE BDAM DEBS  Y02049 49270002
*                                                                       49300018
         BAL   WRKR5,REPDCB76           BRANCH TO DEB UPDATE SUBRTN     49400018
*                                                                       49500018
         B     REPDCB04                 GET NEXT TABL ENTRY             49600018
*                                                                       49700018
REPDCB68 EQU   *                                                        49800018
*                                                                       49900018
*********************************************************************** 50000018
*                                                                     * 50100018
******** THIS ROUTINE IS ENTERED FOR ANY I/O ERROR FOR DSCB (FORMAT   * 50200018
*        1 OR FORMAT 3 ).                                             * 50300018
*                                                                     * 50400018
*********************************************************************** 50500018
*                                                                       50600018
         MVI   RSRETCOD+1,ERR072        SET ERROR RETURN CODE  @ZSUT222 50700037
         B     SETV05B                  SET UP TO XCTL TO V05B   M0187  50800021
*                                                                       51000018
REPDCB70 EQU   *                                                        51100018
*                                                                       51200018
         MVI   RSRETCOD+1,ERR076        SET ERR CODE - XTENTS  @ZSUT222 51300037
*                                       OR LAST TTR'S UNEQUAL           51350037
*                                       DEB VS DSCB                     51400037
SETV05B  EQU   *                                                 M0187  51500021
         MVC   RSREGSAV(8),MODID        SAVE NAME OF MODULE    @ZSUT222 51510037
*                                       THAT DETECTED ERROR    @ZSUT222 51520037
         STM   0,15,RSREGSAV+8          SAVE CURRENT REGISTERS @ZSUT222 51530037
         LA    WRKR3,C'V'               SET XCTL TO V05B         M0187  51550021
         B     PREXCTL                  GO SET FOR XCTL          M0187  51620021
*                                                                       51700018
ENDUP    EQU   *                                                        51800018
*                                                                       51900018
         LA    WRKR3,C'T'               SET UP TO XCTL TO T05B   M0187  51970021
         CLI   RSRETCOD+1,X'FF'         SHOULD ISAM BE ENTERED   A25984 52050019
         BNE   PREXCTL                  GO SET IGC XCTL          M0187  52060021
         LA    WRKR3,C'W'               SET XCTL TO W05B         M0187  52070021
*                                                                       52080021
PREXCTL  EQU   *                                                 M0187  52090021
         LA    TIOTR,DXDSCB+464         SET WORK AREA FOR XCTL   M0187  52100021
         MVC   0(8,TIOTR),IGC           MOVE IGC MODULE FOR XCTL M0187  52110021
FOUR     EQU   *+2                                               M0187  52120021
         STC   WRKR3,4(TIOTR)           ADJUST TO T, W, OR V05B  M0187  52130021
         B     NOWXCTL                  GO XCTL                  M0187  52140021
*                                                                       52200018
XCTL     EQU   *                                                        52300018
*                                                                       52400018
         LA    TIOTR,DXDSCB+DSECTSIZ+8  SETUP WORKAREA FOR XCTL  YM6533 52500002
         MVC   0(8,TIOTR),IGG           SET XCTL TO IGG MODULE   M0187  52540021
*                                                                       52580021
NOWXCTL  EQU   *                                                 M0187  52620021
EIGHT    EQU   *+2                                               M0187  52660021
         LA    WRKR6,8(TIOTR)           INITIALIZE WRKR6 (REG 15)       52700018
*                                                                       52800018
*********************************************************************   52900018
         LR    WRKR2,BUFR               POINT REG 1 TO THE RESTART W/A  53000018
*********************************************************************   53100018
*                                                                       53150018
         XCTL  EPLOC=(TIOTR),SF=(E,(15))                                53200018
*                                                                       53300018
*********************************************************************   53400018
*                                                                       53500018
******** THIS IS THE START OF THE DEB COMPRESSION AND MODIFICATION      53600018
*        SUBROUTINE                                                     53700018
*                                                                       53800018
*********************************************************************   53900018
*                                                                       54000018
REPDCB76 EQU   *                                                        54100018
*                                                                       54200018
*********************************************************************   57700018
*                                                                     * 57800018
*        AT ENTRY TO THIS ROUTINE, REGISTER CONTENTS ARE:        Y02049 57850002
*          WRKR2 = POINTER TO THE LAST DEB EXTENT (DEBDASD)      Y02049 57900002
*          WRKR3 = POINTER TO THE LAST DSCB EXTENT (DSCEXTYP)    Y02049 57950002
*                                                                     * 58200018
*********************************************************************   58300018
*                                                                       58400018
         SR    WRKR4,WRKR4              CLEAR WRKR4                     58500018
         IC    WRKR4,DEBNMEXT           INSERT NO OF EXTENTS INTO WRKR4 58600018
         BCTR  WRKR4,0                  DECREMENT COUNT BY 1            58700018
         STC   WRKR4,DXDSCB+DSECTSIZ    STORE M IN WORKAREA      Y02076 58750002
         LA    WRKR4,DEBENDCC-DEBDASD(,WRKR2)                    Y02049 58800002
*                                  GET PTR TO DEB ENDING CCHH    Y02049 58850002
         LA    WRKR3,DSCUPPLM-DSCEXTYP(,WRKR3)                   Y02049 58900002
*                                  GET PTR TO DSCB ENDING CCHH   Y02049 58950002
*                                                                       59000018
*********************************************************************** 59100018
*                                                                     * 59200018
******** THE NEXT ROUTINE CONVERTS BOTH MBBCCHHR'S TO TTR'S AND       * 59300018
*        COMPARES TO SEE IF DEBENDCC IS GREATER THAN DSCB ENDING CCHH * 59400018
*        IF IT IS AND DS IS OPEN FOR INPUT AN ERROR CONDITION EXISTS  * 59500018
*                                                                     * 59600018
*********************************************************************** 59700018
*                                                                       59800018
         STM   WRKR1,WRKR6,DXDSCB+DSECTSIZ+D16 SAVE ALL REGS     Y02076 59900002
*                                                                       60000018
         L     WRKR2,CVTPTR             GET CVT ADDRESS                 60100018
         L     WRKR6,CVTPRLTV           GET CONVERT (MBB TO TTR) RTN AD 60200018
         LR    WRKR2,DEBR               POINT WRKR2 TO DEB              60300018
         LA    DCBR,DXDSCB+DSECTSIZ     POINT TO DEB MBBCCHHR    Y02076 60400002
*                                                                       60500018
         MVC   DXDSCB+DSECTSIZ+D3(D4),D0(WRKR4) MOVE CCHH TO WA  Y02076 60800002
         LR    DEBR,WRKR6               SAVE CONVERT RTN ADDR           61300018
         BALR  WRKR5,WRKR6              GO TO CONVERT RTN               61400018
*                                                                       61500018
         LR    TCBR,WRKR1               SAVE DEB XTN TTR                61600018
         L     WRKR3,DXDSCB+DSECTSIZ+D64     REINITIALIZE WRKR3  Y02076 61700002
         MVC   DXDSCB+DSECTSIZ+D3(D4),D0(WRKR3) DSCB 'CCHH' TO WAY02076 61800002
*                                                                       61900018
         LR    WRKR6,DEBR               RESTORE CONVERT RTN ADDR        62000018
         BALR  WRKR5,WRKR6              GO TO CONVERT RTN               62100018
*                                                                       62200018
         SRL   TCBR,16                  GET  NUMBER OF TRKS  DSCB       62300018
         SRL   WRKR1,16                 GET  NUMBER OF TRKS  DEB        62400018
         SR    TCBR,WRKR1               SUB DSCB TTR FROM DEB TTR       62500018
*                                                                       62600018
         LR    WRKR1,TCBR               PUT DIFF IN WRKR1 (REG 0)       62700018
         LM    WRKR2,WRKR6,DXDSCB+DSECTSIZ+D20   ALL BUT REG 0   Y02076 62800002
*                                                                       62900018
         BZ    CONTINUE                 BR IF EQ TO CONTINUE            63000018
*                                                                       63100018
         TM    DEBOPATB,OUTP            TEST FOR OPEN FOR INPUT         63200018
         BZ    REPDCB70                 YES - BR TO ERROR RTN           63300018
*                                                                       63400018
CONTINUE EQU   *                                                        63500018
*                                                                       63600018
*********************************************************************   63700018
*                                                                       63800018
******** DIFFERENCE IN TTRS BETWEEN DSCB AND DCB IN WRKR1 (R0)          63900018
******** DEB  ENDCCHH IS POINTED TO BY WRKR4 (RD)                       64000018
******** DSCB ENDCCHH IS POINTED TO BY WRKR3 (RC)                       64100018
*                                                                       64200018
*********************************************************************   64300018
*                                                                       64400018
         MVC   0(4,WRKR4),0(WRKR3)      UPDATE ENDING CCHH IN LAST DEB  64500018
*                                       EXTENT FIELD                    64600018
         LH    WRKR6,4(WRKR4)           OLD NO. TRKS IN EXT             64700018
         SR    WRKR6,WRKR1              COMPUTE NEW AMT OF TRKS IN EXT  64800018
         STH   WRKR6,4(WRKR4)           SAVE BACK IN DEB EXT FLD        64900018
*                                                                       65000018
         BR    WRKR5                    EXIT FROM SBRTN TO REPDCB60 OR  65100002
*                                       REPDCB40 BAL+4           Y02049 65200002
*                                                                       65300018
*********************************************************************   65400018
*                                                                       65500018
******** END OF UPDATE DEB SUBROUTINE                                   65600018
*                                                                       65700018
*********************************************************************** 65800018
*                                                                       65900018
BLDCCWS  EQU   *                                                        66000018
*                                                                       66100018
*********************************************************************** 66200018
*                                                                     * 66300018
***** THIS SUBRTN GETS THE DISK ADDR OF THE DSCB AND PUTS IT INTO THE * 66400018
*     WORKAREA AND THEN FINISHES CONSTRUCTING THE CCW LIST            * 66500018
*                                                                     * 66600018
******** WORKAREA IS CLEAR, SO BUILD CONTROL BLOCKS FOR READING DSCB'S* 66700018
*                                                                     * 66800018
*********************************************************************** 66900018
*                                                                       67000018
         MVI   DXDEBNTR,X'7F'           SET MAX NO. TRKS         M0187  67550002
         MVI   DXDEBNTR+D1,DF                                   Y02076  67560002
*                                                                       67600018
         LA    WRKR1,DXDCB              GET ADDR OF RESTART DCB         67700018
         ST    WRKR1,DXDEBDCB           STORE IT IN DEB                 67800018
         MVI   DXDEBID,DEBID            STORE ID FOR DEB                67900018
         TM    TABFLG5,X'02'            IS IT A MULTIVOL NTRY   ZA02895 67950037
         BZ    BLDCCWS1                 BRANCH IF NO            ZA02895 68000037
         ST    WRKR3,DXDEBUCB           UCB INTO WA DEB         ZA02895 68050037
         MVC   DXDEBBIN(2),DEBBINUM-DEBUCBAD(WRKR2) BIN# TO DEB ZA02895 68100037
         B     BLDCCWS2                 BRANCH TO CONTINUE      ZA02895 68150037
BLDCCWS1 L     DCBR,TABDCBAD-1          GET USER'S DCB ADDR     ZA02895 68250037
         L     DEBR,DCBDEBAD            POINT TO USER'S DEB             68500018
         USING DEBBASIC,DEBR                                     Y02049 68550002
         L     WRKR3,DEBSUCBA      LOAD USER'S UCB ADDRESS       Y02049 68580002
         ST    WRKR3,DXDEBUCB      STORE USER'S UCB ADDRESS      M0187  68660021
         LA    TCBR,DEBBASND       GET ADR OF DASD SECTION       Y02049 68710002
         USING DEBDASD,TCBR                                      Y02049 68720002
         MVC   DXDEBBIN(2),DEBBINUM     BIN NUMBER TO DEB               68750018
         DROP  TCBR                                              Y02049 68760002
*                                                                       68800018
BLDCCWS2 EQU   *                        CONTINUE                ZA02895 68850037
         LA    WRKR2,DXDEB              GET DEB ADDR                    68900018
         ST    WRKR2,DXDCBDEB           STORE IN DCB                    69000018
*                                                                       69005021
* TO READ VOLUME LABEL AND CONVERT VTOC ADDRESS TO TTR, DEB EXTENTS     69010021
* MUST BE SET TO COVER ENTIRE VOLUME.  LOW CCHH IS ZERO, AND HIGH       69015021
* CC+1 IS OBTAINED FROM SYSTEM DEVICE CHARACTERISTICS TABLE.            69020021
*                                                                       69025021
         USING SRT,WRKR3                                         M0187  69030021
         L     WRKR2,CVTPTR        LOAD CVT POINTER              M0187  69035021
         L     WRKR1,CVTXAPG            ADR- APP VECT TBLE       Y02076 69037002
         ST    WRKR1,DXDEBAPP           STORE IN DEB             Y02076 69039002
         L     WRKR2,CVTZDTAB      LOAD DEVTAB POINTER           M0187  69040021
         DROP  WRKR2                                             M0187  69045021
         IC    WRKR6,UCBTBYT4      GET DEVICE TYPE BYTE          M0187  69050021
         LA    WRKR1,X'0F'         GENERATE MASK                 M0187  69055021
         NR    WRKR6,WRKR1         USE LOW ORDER BITS FOR INDEX  M0187  69060021
         IC    WRKR6,0(WRKR6,WRKR2) PICK UP NEXT INDEX           M0187  69065021
         AR    WRKR2,WRKR6         POINT TO DEVTAB ENTRY         M0187  69070021
         XC    DXDEBSCC(8),DXDEBSCC CLEAR DEB EXTENTS            M0187  69075021
         MVC   DXDEBECC,0(WRKR2)   SET HIGH CYL ADDRESS          M0187  69080021
         MVI   DXDEBUSR,NMEXTS1         SET NO. OF EXTENTS       Y02076 69082002
         MVI   DXDEBAPP,EXSCLS1         SET DEB EXTENT SCALE     Y02076 69084002
         MVI   DXDEBMOD,DVMODS1         SET FILE MASK            Y02076 69084402
*                                                                       69085021
*                                                                       69100018
*********************************************************************   69200018
*                                                                     * 69300018
******** COMPLETE IOB                                                 * 69400018
*                                                                     * 69500018
*********************************************************************   69600018
*                                                                       69700018
         MVI   IOBFLAG1,UNREL           MAKE I/O UNRELATED              69800018
         LA    WRKR2,DXDCB              GET DCB ADDR                    69900018
         ST    WRKR2,IOBWGHT            STORE IN IOB                    70000018
         LA    WRKR2,DXECB              GET ECB ADDR                    70100018
         ST    WRKR2,IOBECBPT           STORE IN IOB                    70200018
         LA    WRKR2,DXCCW              GET CCW STRING ADDR             70300018
         ST    WRKR2,IOBSIOCC           STORE IN IOB                    70400018
*                                                                       70500018
*********************************************************************   70600018
*                                                                     * 70700018
******** GET THE DSCB ADDR AND PUT IT INTO THE CCW STRING             * 70800018
*                                                                     * 70900018
*********************************************************************   71000018
*                                                                       71100018
         TM    TABFLG5,X'02'            IS IT MULTI-VOL D/S     ZA02895 71150037
         BZ    BLDCCWS5                 BRANCH IF YES           ZA02895 71160037
         XC    DXCCW1(48),DXCCW1        CLEAR CCWS              ZA02895 71170037
         LA    WRKR6,VTOCCHHR+3         SEARCH ADDR             ZA02895 71180037
         ST    WRKR6,DXCCW1             SET IN SEARCH CCW       ZA02895 71190037
         LA    WRKR6,DXCCW1             GET TIC TO ADR          ZA02895 71192037
         ST    WRKR6,DXCCW2             STORE IN TIC CCW        ZA02895 71194037
         LA    WRKR6,DXCCW3             LOAD READ CNT CCW ADR   ZA02895 71196037
         ST    WRKR6,DXCCW5             ST IN TIC-AFTER SRCHKEY ZA02895 71198037
         L     WRKR6,TABJFCB-1          GET JFCB PTR            ZA02895 71198437
         LA    WRKR6,0(WRKR6)           CLEAR HI ORDER BYTE     ZA02895 71198837
         LA    WRKR6,16(WRKR6)          LOAD @ OF KEY(DSN)      ZA02895 71199237
         ST    WRKR6,DXCCW4             STO IN SRCHKEY CCW      ZA02895 71199637
         LA    WRKR6,DXDSCB             GET DSCB BUFFER ADR     ZA02895 71199737
         ST    WRKR6,DXCCW6             ST IN READ CNT CCW      ZA02895 71199837
         LA    WRKR6,RSRDCNT            BUF @ FOR READ COUNT    ZA02895 71199937
         ST    WRKR6,DXCCW3             ST IN CCW3              ZA02895 71249937
         OC    DXCCW1(48),DSCBCP        OR IN CHAN PROG         ZA02895 71259937
         BR    WRKR5                    BR BACK TO CALLER       ZA02895 71269937
BLDCCWS5 SH    DEBR,SIXTEEN   POINT TO BBCCHHR, FRONT OF DEB    ZA02895 71279937
         MVC   DXDAADDR+1(7),1(DEBR)    MOVE DA ADDR TO WORKAREA        71400018
*                                                                       71500018
         XC    DXCCW(24),DXCCW          CLEAR THE CHAN PROG AREA        71600018
         LA    WRKR6,DXDAADDR+3         POINT TO CCHHR                  71700018
         ST    WRKR6,DXCCW1             STORE IN SEARCH INSTRUCTION     71800018
         LA    WRKR6,DXCCW1             POINT TO SEARCH INSTRUCTION     71900018
         ST    WRKR6,DXCCW2             STORE IT IN TIC INSTRUCTION     72000018
         LA    WRKR6,DXDSCB             POINT TO TO-ADDR OF DSCB        72100018
         ST    WRKR6,DXCCW3             STORE IT IN READ DATA INSTR.    72200018
         OC    DXCCW(24),CCWLIST        OR IN CHANNEL PROGRAM           72300018
         BR    WRKR5                    BRANCH OUT OF SBRTN VIA WRKR5   72400018
*                                                                       72500018
CLOSEUP  MVC   0(0,WRKR2),0(WRKR6)      MOVE UP THE ACC METH SEC        72600018
*                                                                     * 72700018
*********************************************************************   72800018
*                                                                     * 72900018
*     CHANNEL PROGRAM USED BY REPI/O                                    73000018
*                                                                     * 73100018
*********************************************************************   73200018
*                                                                     * 73300018
         DS    0H                                                M0187  73350021
CCWLIST  DS    0CL24                                                    73400018
         DC    X'3100000040000005'      SEARCH.                         73500018
         DC    X'08000000'                                       M0187  73570021
SIXTEEN  DC    H'16'                                             M0187  73640021
TEN      DC    H'10'                                             M0187  73710021
         DC    X'0E0000000000008C'      READ                   YA00279  73800002
*   THE FOLLOWING CHANNEL PROGRAM IS USED TO SEARCH FOR         ZA02895 73850037
*   THE VOLUME VTOC, THEN SEARCH THE VTOC TO READ IN A F1 DSCB  ZA02895 73860037
*   GIVEN THE DATA SET NAME OF THE DATA SET AS A KEY            ZA02895 73870037
*                                                                     * 73880037
DSCBCP   DS    0CL48                    DSCB READ CHAN PROG     ZA02895 73890037
         DC    X'3100000040000005'      SEARCH ID =             ZA02895 73892037
         DC    X'0800000020000001'      TIC                     ZA02895 73894037
         DC    X'9200000060000008'      READ COUNT              ZA02895 73896037
         DC    X'A90000004000002C'      SEARCH = KEY            ZA02895 73898037
         DC    X'0800000020000001'      TIC                     ZA02895 73898437
         DC    X'8600000000000060'      READ DSCB               ZA02895 73898837
*                                                                     * 73900018
*********************************************************************   74000018
*                                                                     * 74100018
*     CONSTANTS USED IN REPI/O                                          74200018
*                                                                     * 74300018
*********************************************************************   74400018
*                                                                     * 74500018
IGC      DC    CL8'IGC0V05B'            RESTART XCTL MODULE      M0187  74600021
IGG      DC    CL8'IGG020P1'            PARTIAL RELEASE MODULE   M0187  74700021
MODID    DC    CL8'IGC0R05B'            MODULE ID              @ZSUT222 74720037
NMEXTS1  EQU   X'01'                    NO. OF EXTENTS           Y02076 74750002
EXSCLS1  EQU   X'04'                    DEB EXTENT SCALE         Y02076 74800002
DVMODS1  EQU   X'C0'                    FILE MASK                Y02076 74850002
PATCH    DC    XL((*-IGC0R05B)/20)'00'  20 PERCENT PATCH AREA   ZA00128 74900002
         EJECT                                                          75100018
FORECORE DSECT                                                          75200018
         IECDSECT                                                       75300018
         EJECT                                                          75400018
CVT      DSECT                                                          75500018
         CVT                                                            75600018
         EJECT                                                          75700018
*                                                                       75800018
*                                                                       75900018
*   TASK CONTROL BLOCK                                                  76000018
*                                                                       76100018
*                                                                       76200018
         CNOP  0,4                                                      76300018
TCB      DSECT                                                          76400018
TCBRBP   DS    F                       POINTER TO EXECUTING RB          76500018
TCBPIE   DS    F                       POINTER TO PROG. INTERRUPT EL.   76600018
TCBDEB   DS    F                       POINTER TO DEB QUEUE             76700018
TCBTIO   DS    F                       POINTER TO TIOT                  76800018
TCBCMP   DS    F                       TASK COMPLETION CODE             76900018
TCBTRN   DS    F                       TESTRAN FIELD                    77000018
TCBMSS   DS    F                       DATA BLOCK QUEUE ELEMENT POINTER 77100018
TCBPRTK  DS    CL1                     PROTECTION TAG                   77200018
TCBFLGS  DS    FL5                     FLAG BYTES                       77300018
TCBLMP   DS    CL1                     LIMIT PRIORITY                   77400018
TCBDSP   DS    CL1                     DISPATCHING PRIORITY             77500018
TCBLLS   DS    F                       POINTER TO LOAD LIST             77600018
TCBJLB   DS    F                       POINTER TO JOBLIB DCB            77700018
TCBJSE   DS    F                       LIST OF INACTIVE PROGRAMS ADDR.  77800018
TCBGRS   DS    CL64                    GENERAL REGISTER SAVE AREA       77900018
TCBIDF   DS    CL1                     TCB IDENTIFIER FIELD             78000018
TCBFSA   DS    CL3                     POINTER TO 1ST PROB.PROG.SAVEAR  78100018
TCBTCB   DS    F                       NEXT TCB ON READY QUEUE POINTER  78200018
TCBTME   DS    F                       POINTER TO TIMER ELEMENT         78300018
         EJECT                                                          78400018
         DCBD  DSORG=PS                                                 78500018
         EJECT                                                          78600018
*   DATA EXTENT BLOCK                                                   78900002
         IEZDEB                                                  Y02049 79150002
         EJECT                                                          82600018
TIOT     DSECT                                                          82700018
         IEFTIOT1                                                       82800018
         EJECT                                                          82900018
SRT      DSECT                                                          83000018
         IEFUCBOB                                                       83100018
         EJECT                                                          83200018
         IEEVRSWA  VER=3                OAS2 VERSION OF WA              83300000
UCBAD    EQU   RSERAS00                UCB FIELD FOR MULTI-VOLS ZA02895 83350037
VTOCCHHR EQU   RSERAS01                 01,02 -2 WDS FOR CCHHR  ZA02895 83360037
RSRDCNT  EQU   RSERAS03                 03,04 -2 WDS FOR COUNT  ZA02895 83370037
REG6SAV  EQU   RSERAS05                 SAVE AREA FOR REG6      ZA02895 83380037
         EJECT                                                          83400018
         IHJDSTAB                                               Y02076  83450002
EXTNO    EQU   TABFLG5                                            M3251 87770018
DS3FMTID EQU   DXJBF+44            FORMAT 3 ID BYTE              Y02049 87780002
DSCEXTLN EQU   DSCEXT2-DSCEXT1     LENGTH OF EXTENT IN DSCB      Y02049 87790002
F3KLAST  EQU   DXJBF-FORECORE+DSCBEX4-DXDSCB3K                   Y02049 87792002
*                                  FORMAT 3 KEY LAST EXTNT       Y02049 87794002
F3KFIRST EQU   DXJBF-FORECORE+DSCBEXTY-DXDSCB3K                  Y02049 87796002
*                                  FORMAT 3 KEY FIRST EXTNT      Y02049 87798002
F3DFIRST EQU   F3KLAST+DSCEXTLN+DSCBEX5-DSCBFMID                 Y02049 87798402
*                                  FORMAT 3 DATA FIRST EXTNT     Y02049 87798802
F3DLAST  EQU   F3KLAST+DSCEXTLN+DSCBEXD-DSCBFMID                 Y02049 87799202
*                                  FORMAT 3 DATA LAST EXTNT      Y02049 87799602
         END                                                            87800018
./  ADD  SSI=81150484,NAME=IGC0S05B
         TITLE 'IGC0S05B  DATA SET PROCESSOR - NON-DA DATA SET POSITIONX00100019
               ING    REPOSITION I/O  RESTART-SVC 52  OS/360'           00200019
IGC0S05B CSECT                                                          00300019
*                                                                A50330 00350000
*                                                                A47745 00360000
*          RELEASE 20 DELETIONS                                         00400019
*0483                                                            A37817 00401020
*0483374000                                                      A33655 00402020
*0483                                                            A32901 00405020
*0483351000-353000,419000-420000,450000-451000                   A31340 00410020
*0483326000                                                      S20038 00420020
*0483337000,343000,345000                                        A33101 00450020
*0483324500                                                      A38125 00470020
*          RELEASE 21 DELETIONS                                         00500019
*0970                                                            A46650 00505021
*0970649000-651000                                               A41420 00510021
*0970046000,268000,273000-273200,429000,433000,473000,489000-    S21040 00520021
*0970490000,618000-619000,656000-660000,676000-677000,743000-    S21040 00540021
*0970774000,817000-818000                                        S21040 00560021
*                                                                       00600037
* VS2 RELEASE 3 CHANGES ADDITIONS DELETIONS                             01300037
*                                                                       01310037
*                                                              @ZA02527 01320037
*                                                              @ZA02883 01330037
*744500,797500,806500                                          @ZA02208 01350037
*A354010-354030                                                @ZA14566 01370032
* APAR OZ31492 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 01371032
*C172500-173500,532808,745000,796500,806500                    @ZSUT222 01372032
*A745100-745500,816002                                         @ZSUT222 01373032
*          VS2 RELEASE 3 SU32                                           01375032
*                                                              @G32DSMI 01380132
*D733500-733940                                                @ZA19615 01385037
*A742100-742700                                                @ZA19615 01390037
*A796510                                                       @ZA19617 01395037
*C405360                                                       @ZA20448 01397037
*A39750003-39750007                                            @ZA26571 01398037
*STATUS CHANGE LEVEL 003                                                01400021
*                                                                       01500019
*********************************************************************** 01600019
*                                                                       01700019
*TITLE - NON-DA DATA SET REPOSITIONING                                  01800019
*                                                                       01900019
*FUNCTION/OPERATION - A. FOR ALL IBM STANDARD LABELED TAPES BEING USED  01910002
*                        VERIFY THE DATA SET LABEL BY COMPARING THE     01950002
*                        LABEL IN THE JFCB AGAINST THE DATA SET LABEL   01960002
*                        IN THE TAPE LABEL. IF THE TAPE LABEL INDICATES 01970002
*                        PASSWORD PROTECTION A PASSWORD IS REQUIRED OF  01980002
*                        THE OPERATOR BEFORE PROCESSING CAN CONTINUE.   01990002
*                        IF THE TAPE LABEL INDICATES A CHECKPT   YM7337 01990402
*                        DATA SET, OR IF THE DSAB INDICATES THAT YM7337 01990802
*                        AT CHECKPOINT THE DATA SET WAS A CHECK- YM7337 01991202
*                        POINT DATA SET, THEN IGC0Q05B WILL BE   YM7337 01991602
*                        CALLED TO VERIFY THE SECURITY OF SAID   YM7337 01991702
*                        DATA SETS.                              YM7337 01991802
*                                                                       01992002
*                     B. POSITION TAPE TO CORRECT DATA SET USING FILE   02000002
*                        SEQUENCE NUMBER IN JFCB WHICH CAN BE OBTAINED  02100019
*                        FROM THE 48 BYTE TABLE ENTRY WHICH IS USED IN  02200019
*                        THE RESTART PORTION OF CHECKPOINT/RESTART.     02300019
*                                                                       02400019
*                     C. POSITION TAPE TO CORRECT RECORD WITHIN DATA    02500002
*                        SET USING DCB POSITIONING INFORMATION.         02600019
*                                                                       02700019
*                     D. INITIALIZES, BUT DOES POSITION, TABLE          02710002
*                        ENTRIES FOR TAPES WHICH HAVE THE BYPASS        02720021
*                        OPTIONAL LEADING TAPE MARK AND/OR BYPASS       02730021
*                        EMBEDDED CHKPT RECORDS OPTION(S)               02740021
*                        SPECIFIED (DOS TAPES).  THESE TAPES ARE        02750021
*                        POSITIONED BY IGC0U05B.                        02760021
*                                                                       02770021
*ENTRY POINTS - IGC0S05B - INITIAL ENTRY TO THIS MODULE BY MEANS OF AN  02800019
*                          XCTL FROM IGC0L05B OR IGC0P05B.              02900002
*                                                                       03000019
*INPUT - REGISTER 8   BEGINNING OF DCB TABLE                            03100019
*        REGISTER 1   USER BUFFER AREA                                  03200019
*        REGISTER 10  USER BUFFER AREA                                  03250002
*        REGISTER 12  USER BUFFER AREA                                  03260002
*        REGISTER 6   POINTER TO SECONDARY WORK AREA                    03300019
*                                                                       03400019
*        ALL OPENED DCB (S) WITH THEIR ASSOCIATED CONTROL BLOCKS        03500019
*        THE 48 BYTE TABLE ENTRY (IES) THAT IS (ARE) USED IN RESTART    03600019
*        RESTART WORKAREA                                               03700019
*                                                                       03800019
*OUTPUT - REGISTER 8   BEGINNING OF DCB TABLE                           03900019
*         REGISTER 1   USER BUFFER AREA                                 04000019
*         REGISTER 10  USER BUFFER AREA                                 04050002
*         TAPE POSITIONED AT CORRECT RECORD WITHIN DATA SET             04100019
*                                                                       04200019
*EXTERNAL ROUTINE - SECLOADA                                            04300002
*                   IGC0Q05B - FOR RE-VERIFYING CHKPT DATA SETS  YM7337 04350002
*                                                                       04400019
*EXITS - NORMAL - FINAL EXIT IS MADE VIA XCTL TO THE NEXT MODULE OF     04500019
*                 REPI/O. WILL XCTL TO IGC0U05B IF ANY TAPE ENTRIES     04550021
*                 HAVE BEEN FLAGGED AS DOS TAPES.  OTHERWISE WILL       04600021
*                 XCTL TO IGC0R05B OR IGC0T05B                          04650021
*                                                                       04700019
*      - ERROR - ERROR EXITS ARE MADE VIA XCTL TO RESTART EXIT IGC0V05B 04800019
*                WITH RETURN CODES IN 'RSRETCOD' FIELD -                04900019
*                                                                       05000019
*                60 - ERRORS IN TRYING TO POSITION TO CORRECT DATA SET  05050032
*                                                                       05100032
*                63 - ERRORS IN TRYING TO POSITION TO CORRECT RECORD    05150032
*                     WITHIN DATA SET                                   05200032
*                                                                       05250032
*                219 - ERROR IN THAT CORRECT PASSWORD WAS NOT GIVEN     05300032
*                                                                       05560002
*                222 - DATA SET LABEL IN JFCB NOT SAME AS THAT IN TAPE  05570002
*                      LABEL                                            05580002
*                                                                       05590002
*TABLES/WORKAREAS - THE WORKAREA USED IS DESCRIBED BY THE DSECTS AT THE 05600019
*                   END OF THE LISTING.                                 05700019
*                                                                       05800019
*********************************************************************** 05900019
*                                                                     * 06000019
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 06100019
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 06200019
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 06300019
*    IS 48 BYTES LONG.                                                * 06400019
*                                                                     * 06500019
*********************************************************************** 06600019
*                                                                       06700019
*        ------------------- 4 BYTES -----------------                  06800019
*                                                                       06900019
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  07000019
*        +DATA SET  +           DCB                  +                  07100019
*        + ORGN.    +         ADDRESS                +                  07200019
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                07300019
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  07400019
*        + NO. 1    +         ADDRESS                +                  07500019
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  07600019
*        +NUMBER    +         JFCB TTR               +                  07700019
*        + OF VOLS  +         ADDRESS                +                  07800019
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               07900019
*                                                                       08000019
*     12 +++++++++++++++++++++++                                        08100019
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   08200019
*        +INFO BYTE + NUMBER   +                                        08300019
*        +++++++++++++++++++++++                                        08400019
*                                                                       08500019
*     12 +++++++++++++++++++++++                                        08600019
*        +    OLD   TIOT       +        DA AND UNIT RECORD              08700019
*        +      OFFSET         +                                        08800019
*        +++++++++++++++++++++++                                        08900019
*                                                                       09000019
*                              +++++++++++++++++++++++                  09100019
*                              +FLAG BYTE +FLAG BYTE +                  09200019
*                              +  NO. 2   +  NO. 3   +                  09300019
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  09400019
*        +FLAG BYTE +FLAG BYTE +                     +                  09500019
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  09600019
*        +++++++++++++++++++++++                     + 20               09700019
*        +                                           +                  09800019
*        +                                           +                  09900019
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  10000019
*        +                                           +                  10100019
*        +   VOLUME ID NO. 2                         +                  10200019
*        +                     +++++++++++++++++++++++ 28               10300019
*        +                     +                     +                  10400019
*        +                     +   VOLUME ID NO. 3   +                  10500019
*     32 +++++++++++++++++++++++                     +                  10600019
*        +                                           +                  10700019
*        +                                           +                  10800019
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               10900019
*        +                                           +                  11000019
*        +   VOLUME ID NO. 4                         +                  11100019
*     40 +                     +++++++++++++++++++++++                  11200019
*        +                     +                     +                  11300019
*        +                     +                     +                  11400019
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               11500019
*        +                                           +                  11600019
*        +                                           +                  11700019
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               11800019
*                                                                       11900019
*                                                                       12000019
*ATTRIBUTES - REENTRANT                                                 12100019
*             REUSABLE                                                  12200019
*             ENABLED                                                   12300019
*             PRIVILEGED                                                12400019
*                                                                       12500019
*********************************************************************** 12600019
         EJECT ,                                                 A27694 12620019
*                                                                       12640019
*********************************************************************** 12660019
*                                                                       12700019
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               12800019
*                                                                       12900019
*********************************************************************** 13000019
*                                                                       13100019
WRKR1    EQU   0                        WORK/PARAMETER REGISTER         13200019
R0       EQU   0                        REG 0                    YM7337 13250002
WRKR2    EQU   1                        WORK/PARAMETER REGISTER         13300019
R1       EQU   1                        REG 1                    YM7337 13400002
DCBR     EQU   2                        CURRENT DCB REGISTER            13500019
R2       EQU   2                        REG 2                    YM7337 13550002
BASER    EQU   3                        BASE RIGISTER                   13600019
R3       EQU   3                        REG 3                    YM7337 13650002
DEBR     EQU   4                        CURRENT DEB REGISTER            13700019
R4       EQU   4                        REG 4                    YM7337 13750002
UCBR     EQU   5                        CURRENT UCB REGISTER            13800019
R5       EQU   5                        REG 5                    YM7337 13850002
TIOTR    EQU   6                        NEW TIOT RESISTER               13900019
R6       EQU   6                        REG 6                    YM7337 13950002
TCBR     EQU   7                        TCB REGISTER                    14000019
R7       EQU   7                        REG 7                    YM7337 14050002
TABLR    EQU   8                        BEGINNING TO DCB TABLE REGISTER 14100019
R8       EQU   8                        REG 8                    YM7337 14150002
CTABLR   EQU   9                        CURRENT ENTRY IN DCB TABLE      14200019
R9       EQU   9                        REG 9                    YM7337 14250002
BUFR     EQU   10                       USER BUFFER AREA                14300019
RA       EQU   10                       REG 10                   YM7337 14350002
DSCNTR   EQU   11                       NUMBER OF DATA SETS             14400019
RB       EQU   11                       REG 11                   YM7337 14450002
WRKR3    EQU   12                       WORK REGISTER                   14500019
RC       EQU   12                       REG 12                   YM7337 14550002
WRKR4    EQU   13                       WORK REGISTER                   14600019
R13      EQU   13                                                       14700019
RD       EQU   13                       REG 13                   YM7337 14750002
WRKR5    EQU   14                       WORK/PARAMETER REGISTER         14800019
RE       EQU   14                       REG 14                   YM7337 14850002
WRKR6    EQU   15                       WORK/PARAMETER REGISTER         14900019
RF       EQU   15                       REG 15                   YM7337 14950002
*                                                                       15000019
*********************************************************************** 15100019
*                                                                       15200019
*    OFFSETS TO BE USED IN REPI/O PHASE                                 15300019
*                                                                       15400019
*********************************************************************** 15500019
*                                                                       15600019
INOROUT  EQU   X'40'                    SYSIN OR SYSOUT DATA SET        15700019
TPDEV    EQU   X'10'                    TAPE DEVICE                     15800019
LASTENT  EQU   X'08'                    LAST ENTRY                      15900019
BLP      EQU   X'10'                    BYPASS LABEL PROCESSING  A31340 15920020
AL       EQU   X'08'                    ASCII LABEL              S20038 15950020
SL       EQU   X'02'                    STANDARD LABEL                  16000019
NL       EQU   X'01'                    NO LABEL                        16100019
DAFLAG   EQU   X'80'                    DA DATA SET FLAG                16200019
TYPERST  EQU   X'80'                    IMMEDIATE RESTART               16300019
TABENT   EQU   48                       TABLE ENTRY LENGTH              16400019
READ     EQU   X'02'                    READ FOR TAPE                   16500019
NOPOP    EQU   X'03'                    NOP                             16600019
REWIND   EQU   X'07'                    REWIND                          16700019
READBACK EQU   X'0C'                    READBACK                        16800019
BSFOP    EQU   X'2F'                    BACKWARD SPACE FILE             16900019
FSFOP    EQU   X'3F'                    FORWARD SPACE FILE              17000019
TIC      EQU   X'08'                    TIC                             17100019
PERMERR  EQU   X'7F'                    PERMANENT ERROR                 17200019
ERR060   EQU   60                       ERROR IN DATA SET POSIT@ZSUT222 17250032
ERR063   EQU   63                       ERROR IN RECORD POSIT. @ZSUT222 17300032
ERR219   EQU   219                      ERR ID WRONG PASSWORD  @ZSUT222 17350032
ERR222   EQU   222                      ERR ID NO DS LABEL VERIFYY02049 17460002
FLAGS    EQU   X'30'                                                    17500019
COUNT    EQU   X'0D'                                             A27280 17600019
ONE      EQU   X'01'                    CONSTANT ONE                    17700019
SLFLAG   EQU   X'01'                    FLAG FOR SL IN UCB              17800019
ALFLAG   EQU   X'04'                    FLAG FOR AL IN UCB       S20038 17850020
IN       EQU   X'80'                    SYSIN DATA SET (UCBWGT)         17900019
EXCHPGM  EQU   X'80'                    EXCP                            18000019
DADEVDPT EQU   X'0C'                    DA DEVICE DEPENDENT SECTION     18100019
RDBACK   EQU   X'03'                    READ BACKWARDS (DEBOPATB)       18200019
ERRORS   EQU   X'FF'                    ERROR CODE MASK          Y02049 18250002
ERRCHKPT EQU   X'C0'                    PERMANENT ERROR AT CHECKPOINT   18400019
NOOPS    EQU   X'FF'                                                    18500019
RESET    EQU   X'FE'                    RESET SL FLAG            A32901 18550020
REW      EQU   X'80'                    REWIND MASK FOR TABOPS          18600019
FSF      EQU   X'40'                    FORWARD SPACE FILE MASK         18700019
BSF      EQU   X'20'                    BACK SPACE FILE MASK            18800019
RDOP     EQU   X'10'                    READ FORWARD MASK               18900019
RDBK     EQU   X'08'                    READ BACKWARD MASK              19000019
BUSY     EQU   X'80'                                                    19100019
NOTBUSY  EQU   X'00'                                                    19200019
BLANK    EQU   X'40'                                                    19300019
IBITS    EQU   X'0C'                    UNIQUE DEB INPUT BITS    A33655 19330020
EOFRST   EQU   X'DF'                    DEB EOF RESET MASK       A33655 19360020
ZERO     EQU   0                                                        19400019
WAIT     EQU   7                                                        19500019
EQUAL    EQU   8                                                        19600019
NOTMIX   EQU   9                                                        19700019
D0       EQU   0                                                        19800019
D1       EQU   1                                                        19900019
D2       EQU   2                        TWO                      Y02049 19910002
D3       EQU   3                        OFFSET 3                 Y02049 19950002
D4       EQU   4                                                        20000019
D7       EQU   7                                                        20100019
D8       EQU   8                                                        20200019
D16      EQU   16                       DEB OFFSET BSAM-QSAM SEC Y02049 20202002
C17      EQU   17                       TAPE LABEL LENGTH        YM7509 20204002
D24      EQU   24                       24 BYTES                 Y02049 20210002
D40      EQU   40                       10 WORDS                 Y02049 20220002
D80      EQU   80                       HDR LENGTH               Y02049 20250002
D83      EQU   83                       OFFSET 83                Y02049 20260002
D160     EQU   160                      STORAGE CONSTANT         Y02049 20270002
D280     EQU   280                      OFFSET TO JFCB IN WRAREA Y02049 20280002
D323     EQU   323                      OFFSET TO LAST NAME CHAR Y02049 20290002
DX2      EQU   X'02'                    PASSWORD TEST ID         Y02049 20294002
L1       EQU   1                                                        20300019
L4       EQU   4                                                        20400019
L8       EQU   8                                                        20500019
L18      EQU   18                                                       20600019
L23      EQU   23                                                       20700019
L24      EQU   24                                                       20800019
L26      EQU   26                                                S21040 20810021
AMMOD    EQU   X'E3'      CHARACTER T - ACCESS METHOD DISP. MOD. S21040 20820021
DAMOD    EQU   X'D9'      CHARACTER R - DIRECT ACCESS MODULE     S21040 20830021
DOSMOD   EQU   X'E4'      CHARACTER U - DOS TAPE POSITION MODULE S21040 20840021
NOTMIXED EQU   11                       BRANCH ON NOT MIXED      S21040 20850021
DOSTAPE  EQU   X'01'                    DOS TAPE MASK            S21040 20860021
READOP   EQU   X'F1'                    OP CODE IS READ OR READ  S21040 20870021
*                                       BACK IF THESE BITS ARE 0        20870402
D44      EQU   44                       MAX NO. DATA SET NM CHARSY02049 20872002
D43      EQU   43                       DATA SET NAME OFFSET     Y02049 20874002
PASSIND  EQU   X'F7'                    RESET MASK PASSWORD CHK  Y02049 20878002
DF1      EQU   X'F1'                    CHAR ONE                 Y02049 20878402
DF2      EQU   X'F2'                    CHAR TWO                 Y02049 20878802
D128     EQU   128                      SECLOADA SPACE CONSTANT  Y02049 20879202
ECBBGADR EQU   32                       ECB ADR OFFSET           Y02049 20879602
IOBCCWOF EQU   96                       OFFSET FOR SECLOADA CCWS Y02049 20879702
GOTSTOR  EQU   X'FF'                    SECLOADA STOR GOTTEN IND Y02049 20879802
RTNSW    EQU   X'02'                    RTN FROM SECLOADA SW     Y02049 20879902
READTAPE EQU   X'02'                    READ TAPE OP CODE        Y02049 20886602
BYTECNT  EQU   80                       HDR1&HDR2 RECORD SIZE    Y02049 20888602
HIORDER  EQU   8                        ICM&STCM MASK            Y02049 20892602
ADRBYTES EQU   7                        ICM&STCM MASK            Y02049 20893002
JFCBLNTH EQU   176                      JFCB LENGTH              Y02049 20893102
INPUTMSK EQU   X'04'                    OPEN FOR INPUT MASK      Y02049 20893202
PASSWDID EQU   X'04'                    PASSWORD POS REQ IND     Y02049 20919902
RLOCKSW  EQU   X'00'                    RESET MASK WRK AREA LK SWY02049 20929902
WRITEFLG EQU   X'30'                    PASSWORD WRITE CHK IND   Y02049 20939902
RDWTRFLG EQU   X'10'                    PASSWORD RD/WTR CHK IND  Y02049 20941902
RESETFLG EQU   X'00'                    FLAGS RESET MASK         Y02049 20943902
LOCKSW   EQU   X'01'                    WORKAREA LOCK SW         Y02049 20953902
DEBPRFLN EQU   16                       LENGTH OF DEB PREFIX     Y02049 20963902
QMWAOFST EQU   24                       WA OFFSET                YM7077 20965902
MODECLR  EQU   X'C0'                    DENSITY SET              YM7551 20967902
SETMODE  EQU   X'2B'                    EVEN PAR TRANS MD CVT OFFYM7551 20969902
CHKPTFLG EQU   C'C'                     HDR2 CHKPT D.S. FLAG     YM7337 20971902
*                                                                       20973302
*********************************************************************** 21000019
*                                                                       21100019
         EJECT ,                                                 A27694 21150019
         BALR  BASER,ZERO               ESTABLISH ADDRESSIBILITY        21200019
         USING *,BASER                  ESTABLISH BASE REG              21300019
         B     BEGIN                    BR AROUND EYE CATCHER    Y01909 21350002
         CNOP  0,8                      ALIGN TO A DBL WRD BNDRY Y01909 21360002
         DC    CL8'IGC0S05B'            MODULE NAME            @ZSUT222 21370032
         DC    CL8'&SYSDATE'            LAST DATE SHIPPED      @ZSUT222 21372032
         DC    CL8'@ZSUT222'            LAST CODE SHIPPED      @ZSUT222 21374032
         DC    CL8'@SU83200'            SELECTABLE UNIT ID     @ZSUT222 21376032
BEGIN    EQU   *                                                 Y01909 21380000
*                                                                       21400019
         USING IHADCB,DCBR                                              21500019
         USING DEBBASIC,DEBR                                     Y02049 21550002
         USING UCBOB,UCBR                                               21700019
         USING TABL,CTABLR                                              21800019
         USING RSTWA,BUFR                                               21900019
         USING RSDSECT,WRKR4                                            22000019
*********************************************************************** 22050002
*              TEST FOR RETURN FROM SECLOADA                          * 22060002
*********************************************************************** 22070002
         MODESET EXTKEY=ZERO            KEY 0                    Y02049 22072002
         TM    TABFLG2,TABSW            TEST SW IN CURRENT TAB   Y02049 22080002
         BO    PASSWORD                 PROCESS SECLOADA RTN COD YM7337 22090002
***                                                              YM7337 22092002
*        GET DADSM-LIKE WORK AREA FOR BOTH SECLOADA CALL         YM7337 22094002
*        AND CALL TO Q05B                                        YM7337 22096002
***                                                              YM7337 22098002
         LA    RF,RSREGSAV              GET ADDR SAVE AREA       YM7337 22098402
         STM   R0,RF,D0(RF)             SAVE REGS                YM7337 22098802
         XR    R1,R1                    PHONY PREV WORK AREA     YM7337 22099202
         IECRES GET,LV=256,A=(R1),ID=S05B,PREFIX=YES             YM7337*22099602
                                        GET SECLOADA WORK AREA   YM7337 22099702
         USING IECEXTPR,R1              W/A ADDR                 YM7337 22099802
         MODESET EXTKEY=ZERO            RET FROM GET IS KEY=5    YM7337 22099902
         LM    R2,RF,D2*4(RF)           RESTORE REGS             YM7337 22133202
         MVC   WTGWTOPR(D4),WTGCODE     SET WTO FLAGS            YM7337 22143202
         ST    R1,SECSWICH              SAVE CORE ADDR           YM7337 22153202
         DROP  R1                       R1 = BLAH                YM7337 22163202
         LM    R0,R1,RSREGSAV           RESTORE REGS 0 AND 1     YM7337 22165202
*                                                                       22166702
*                                                                       22200019
         LR    BUFR,WRKR2               SAVE POINTER TO RSWA            22300019
         LR    CTABLR,TABLR             INITIALIZE TABL PTR             22400019
         L     WRKR4,TABSEGAD-D1        WORKAREA SEGMENT ADDR           22500019
*                                                                       22600019
*                                                                       22700019
REPDCB00 EQU   *                                                        22800019
*                                                                       22900019
         TM    TABFLG1,TABTAPE          IS IT TAPE DEVICE               23000002
         BNO   REPDCB26                 BRANCH IF NOT TO GET NEXT ENTRY 23100019
*                                                                       23150002
         TM    TABFLG2,TABRSDS          IS THIS THE WORKING      YM7358 23160002
*                                       RESTART DATA SET?        YM7358 23170002
         BNO   REPDCB01                 NO, CONTINUE PROCESSING  YM7358 23180002
         MVI   TABOPS,ZERO              INDICATE REPOSITIONING   YM7358 23190002
*                                       NOT TO TAKE PLACE ON THE YM7358 23194002
*                                       WORKING RESTART DATA SET YM7358 23196002
         B     REPDCB26                 GO GET NEXT ENTRY        YM7358 23198002
*                                                                       23200019
*    ****************************************************************** 23300019
*                                                                       23400019
*    *** ALL TAPES OTHER THAN THOSE FOR SYSIN DATA SETS AND             23500019
*        THOSE THAT HAVE NON-STANDARD LABELS ARE ASSUMED TO BE          23600019
*        POSITIONED AT LOAD POINT UPON ENTRY TO THIS MODULE ***         23700019
*                                                                       23800019
*    ****************************************************************** 23900019
*                                                                       24000019
*    *** SYSIN DATA SETS ***                                            24100019
*                                                                       24200019
*        THE SCHEDULER WOULD HAVE POSITIONED THE TAPE AT THE INTER-     24300019
*        RECORD GAP IMMEDIATELY PRECEDING THE FIRST DATA RECORD IN THE  24400019
*        USER'S INPUT STREAM                                            24500019
*                                                                       24600019
*    *** NON-STANDARD LABELS ***                                        24700019
*                                                                       24800019
*        THE USER PROVIDED LABEL PROCESSING ROUTINE WOULD HAVE ALREADY  24900019
*        REPOSITIONED UP TO THE CORRECT DATA SET, LEAVING THE TAPE AT   25000019
*        THE INTERRECORD GAP THAT PRECEDES THE INITIAL RECORD OF THE    25100019
*        DATA SET ON THE CURRENT VOLUME                                 25200019
*                                                                       25300019
*    ****************************************************************** 25400019
*                                                                       25500019
*    *** PICK UP NECESSARY ADDRESSES ***                                25600019
*                                                                       25700019
REPDCB01 EQU   *                                                 YM7358 25750002
         TM    TABFLG2,TABG5V          GREATER THEN 5 VOLS ?   @ZA02883 25800037
         BZ    REPDCB02                BRANCH IF NOT           @ZA02883 25820037
         MVC   TABJFCB(D3),TABVLID5+D3 RESTORE JFCB TTR        @ZA02527 25840032
REPDCB02 XC    TABVLID2(L24),TABVLID2   ZERO WORK SPACE IN TAB @ZA02883 25860037
         L     WRKR4,TABSEGAD-D1        WORKAREA SEGMENT ADDR           25900019
         L     DCBR,TABDCBAD-D1         DCB ADDR IN THIS ENTRY          26000019
         L     DEBR,DCBDEBAD            DEB ADDR ASSOC WITH THIS DCB    26100019
         L     UCBR,DEBSUCBA            UCB ADDR ASSOC WITH THIS DEB    26200002
*                                                                       26300019
         ST    UCBR,TABUCB              POINTER TO UCB IN TABL          26400019
*                                                                       26500019
*    *** INITIALIZE CHANNEL PROGRAM ***                                 26600019
*                                                                       26700019
         XC    RSCCW1(L26),RSCCW1       CLEAR CCW THROUGH END    S21040 26760021
*                                       OF WORK SPACE                   26820021
*                                                                       26900019
         MVI   RSCCW1+D4,FLAGS          SET SLI, SKIP BITS ON           27000019
         MVI   RSCCW1+D7,COUNT          SET BYTE COUNT TO ONE           27100019
*                                                                       27200019
         CLI   TABFSQNO,ZERO            IS FILE SEQ NO. ZERO     A27694 27340019
         BNE   REPDCB90                 BR IF NOT               OX01653 27360002
         MVI   TABFSQNO,ONE             SET FILE SEQ NO. = 1    OX01653 27370002
REPDCB90 EQU   *                                                OX01653 27372002
*                                                                       28000019
         SR    DSCNTR,DSCNTR            CLEAR REG                       28100019
         IC    DSCNTR,TABFSQNO          GET FILE SEQ NO. IN JFCB        28200019
*                                                                       28300019
*********************************************************************** 31750002
*        SET UP TO DO POSSIBILE PASSWORD CHECKS FOR SL LABELED TAPES  * 31752002
*********************************************************************** 31754002
REPDCB06 EQU   *                                                        31760002
         TM    TABTPLBL,SL              STANDARD LABELED TAPE    Y02049 31770002
         BNO   REPDCX06                 NO  CONTINUE             Y02049 31780002
         LA    WRKR2,RSTLABEL           TAPE LABEL BUFFER ADR    Y02049 31790002
         STCM  WRKR2,ADRBYTES,RSCCW2+D1 PUT BUFFER ADR IN CCW    Y02049 31792002
         MVI   RSCCW2,READTAPE          OP CODE FOR TAPE READ    Y02049 31798402
         MVI   RSCCW2+D7,BYTECNT        READ 80 BYTES OF DATA    Y02049 31798802
         XC    RSCCW2+D4(D1),RSCCW2+D4  DATA TRANS/NO WRONG LNG  Y02049 31799202
         MVI   RSPASSFL,D0              CLEAR PASSWORD FLAG BYTE Y02049 31799602
*                                                                       31800019
*    ****************************************************************** 31900019
*                                                                       32000019
*    *** CHECK LABEL TO DETERMINE PROCESSING METHOD ***                 32100019
*                                                                       32200019
*    ****************************************************************** 32300019
*                                                                       32400019
REPDCX06 EQU   *                        INSTR MUST FOLLOW        Y02049 32400402
         LR    WRKR3,DSCNTR             SAVE FILE SEQ NUMBER     A38125 32402020
         NI    SRTESTAT,RESET           RESET SL FLAG IN UCB     A32901 32405020
         TM    TABTPLBL,SL+AL           IS IT SL OR AL           S20038 32410020
         BZ    REPDCB10                 BRANCH IF NOT TO CHECK   S20038 32420020
*                                       FOR NL                   S20038 32430020
*                                                                       32440020
         TM    TABTPLBL,SL              IS IT STANDARD LABEL            32500019
         BZ    REPDCB09                 BRANCH IF NOT - MUST BE  S20038 32560020
*                                       AL                       S20038 32620020
*                                                                       32700019
*    *** POSITION TO CORRECT DATA SET FOR STANDARD LABEL ***            32800019
*                                                                       32900019
         OI    SRTESTAT,SLFLAG          SET FLAG IN UCB FOR SL          33000019
*                                                                       33100019
REPDCB07 EQU   *                                                 S20038 33130020
*                                                                       33160020
         OI    TABOPS,FSF               SET TABOPS CODE FOR FSF         33200019
*                                                                       33300019
         CLI   TABFSQNO,ONE             IS FILE SEQ NO. ONE             33400019
         BNE   REPDCB08                 BRANCH NO TO SET NO. FOR FSF    33500019
         MVI   TABFSFN1,ONE             SET NUMBER OF FSF TO ONE        33600019
         B     REPDCB12                 GO TO UPDATE UCB FILE SEQ NO    33800019
*                                                                       33900019
REPDCB08 EQU   *                                                        34000019
*                                                                       34100019
         BCTR  DSCNTR,ZERO              SUBTRACT ONE FOR FIRST FILE     34200019
         LR    TCBR,DSCNTR              MULTIPLY FILE SEQ NUMBER A33101 34300020
         AR    DSCNTR,DSCNTR            BY THREE AND ADD ONE     YM7567 34400002
         LA    DSCNTR,D1(DSCNTR,TCBR)   FOR FIRST FILE LABEL     YM7567 34500002
         STC   DSCNTR,TABFSFN1          SET FSQNO FOR FSF               34600019
         B     REPDCB12                 BRANCH TO POSITION RECORD       34700019
*                                                                       34710020
REPDCB09 EQU   *                                                 S20038 34720020
*                                                                       34730020
         OI    SRTESTAB,ALFLAG          SET FLAG IN UCB FOR AL   S20038 34740020
         B     REPDCB07                 BRANCH TO POSITION AS    S20038 34750020
*                                       FOR SL                   S20038 34760020
*                                                                       34770020
*                                                                       34800019
REPDCB10 EQU   *                                                        34900019
*                                                                       35000019
         TM    TABTPLBL,BLP+NL          IS IT BLP OR UNLABELED   A31340 35100020
         BZ    REPDCB14                 BR IF NOT, MUST BE NSL   A31340 35200020
*                                                                       35400019
         TM    TABTPLBL,NL              IS IT NL ONLY ?        @ZA14566 35420037
         BNO   *+8                      NO BRANCH AHEAD        @ZA14566 35440037
         OI    UCBTFL1,UCBNLTP          SET NL IN UCB          @ZA14566 35460037
*    *** POSITION TO CORRECT DATA SET FOR UNLABELED TAPE ***            35500019
*                                                                       35600019
*                                                                       35700019
         CLI   TABFSQNO,ONE             IS FILE SEQ NO. ONE             35800019
         BE    REPDCB12                 BRANCH YES TO POSITION RECORD   35900019
*                                                                       36000019
*                                                                       36100019
         OI    TABOPS,FSF               SET TABOPS CODE FOR FSF         36200019
*                                                                       36300019
         BCTR  DSCNTR,ZERO              SUBTRACT ONE FOR FIRST FILE     36400019
         STC   DSCNTR,TABFSFN1          SAVE NUMBER OF FSF'S            36500019
*                                                                       36600019
*                                                                       36700019
REPDCB12 EQU   *                                                        36800019
*                                                                       36900019
         MVC   SRTEFSEQ+1(1),TABFLG5    LOG SEQ NO. TO UCB      OX01653 36950002
         MVI   SRTEFSEQ,0               CLEAR HI ORDER BYTE     OX01653 36960002
         STH   WRKR3,SRTEFSCT           PUT UPDATED FILE SEQ CNT IN UCB 37100019
*                                                                       37200019
REPDCB14 EQU   *                                                        37300019
*                                                                A33655 37310020
* THE DEBOFLGS-EOF-BIT IS RESET FOR ALL INPUT TAPE DATA SETS TO  A33655 37320020
* PREVENT A TAPE POSITIONING ERROR AT CLOSE TIME.  THIS PROBLEM  A33655 37330020
* OCCURS IF A TAPE DATA SET ENCOUNTERS EOF AND A CHECKPOINT IS   A33655 37340020
* TAKEN BEFORE IT IS CLOSED.                                     A33655 37350020
*                                                                A33655 37360020
         TM    DEBOPATB,IBITS           Q - INPUT D/S            A33655 37370020
         BNZ   REPDCB15                 IF NOT, BR               A33655 37380020
         NI    DEBOFLGS,EOFRST          RESET DEB-EOF-FLAG IF ON A33655 37390020
REPDCB15 EQU   *                                                 A33655 37400020
*    ****************************************************************** 37500019
*                                                                       37600019
*    *** RECORD POSITIONING IS PERFORMED ONLY IF THE PHYSICAL BLOCK     37700019
*        COUNT IS PRESENT IN THE DCB***                                 37800019
*                                                                       37900019
*    *** DATA SETS ARE POSITIONED IN A FORWARD DIRECTION TO THE CORRECT 38000019
*        RECORD ACCORDING TO THE POSITIVE PHYSICAL BLOCK COUNT ONLY,    38100019
*        WITH THE ONE EXCEPTION, WHERE THE TAPE IS NOT LABELED AND IS   38200019
*        BEING PROCESSED BACKWARDS ***                                  38300019
*                                                                       38400019
*    *** ALL OTHER TAPES ARE POSITIONED TO EITHER THE BEGINNING OR THE  38500019
*        END OF THE DATA SET, DEPENDING ON WHETHER THEY WERE OPENED FOR 38600019
*        FORWARD OR BACKWARD PROCESSING ***                             38700019
*                                                                       38800019
*    ****************************************************************** 38900019
*                                                                       39000019
         SR    TCBR,TCBR                CLEAR REGISTER                  39100019
*                                                                       39200019
         LR    DSCNTR,DEBR              GET ADDR OF DEB FOR CALC Y02049 39250002
         LA    UCBR,DEBPRFLN            GET LENGTH OF DEB PREFIX Y02049 39300002
         SR    DSCNTR,UCBR              POINT TO DEB PREFIX      Y02049 39350002
         USING DEBPREFX,DSCNTR                                   Y02049 39360002
         L     DSCNTR,DEBXTNP           POINT TO DEB EXTENSION   Y02049 39370002
         USING DEBXTN,DSCNTR                                     Y02049 39380002
         TM    DEBXMCF1,DCBMRECP        IS IT EXCP               Y02049 39390002
         BNO   REPDCB16                 BRANCH IF NOT TO CHECK BLKCT    39400019
*                                                                       39500019
         TM    DEBXMCF2,DCBMR5WD+DCBMR4WD                        Y02049 39550002
*                                       IS DEV DEPENDANT SEC PRESENT    39650002
         BZ    REPDCB24                 BRANCH IF NOT TO CHECK RDBACK   39700019
         DROP  DSCNTR                                            Y02049 39750002
         L     DSCNTR,DCBBLKCT          SET UP BLOCK COUNT     @ZA26571 39758037
         LTR   DSCNTR,DSCNTR            SET UP CONDITION CODE  @ZA26571 39766037
         BZ    REPDCB22                 BRANCH IF BLKCOUNT 0   @ZA26571 39774037
         BM    REPDCB18                 BRANCH IF NEGATIVE     @ZA26571 39782037
         B     TESTBLK                  BRANCH IF POSITIVE     @ZA26571 39790037
*                                                                       39800019
REPDCB16 EQU   *                                                        39900019
*                                                                       40000019
         L     DSCNTR,DCBBLKCT          SET CTR TO POSITION RECORD      40100019
         LTR   DSCNTR,DSCNTR            GET CONDITION CODE              40200019
         BZ    REPDCB22                 BRANCH IF BLKCT IS ZERO         40300019
         BM    REPDCB18                 BRANCH IF NEGATIVE TO CHECK NL  40400019
* IF THERE WAS A CHECKPOINT TAKEN AFTER THE EOF WAS DETECTED   @ZA10259 40500037
* BY THE SAM APPENDAGE BUT NOT CHECKED BY THE SYNCHRONIZING    @ZA10259 40510037
* OR CHECK MODULE THUS RESULTING IN AN SVC 55 (END OF VOLUME)  @ZA10259 40520037
* THEN WE ADD ONE TO THE BLOCKCOUNT FOR CHAIN SCHEDULING.      @ZA10259 40530037
         TM    DCBCIND2,DCBCNCHS USING CHAIN SCHEDULING ??     @ZA20448 40536037
         BNO   TESTBLK           NO BRANCH                     @ZA10259 40542037
         L     WRKR3,DCBIOBA     GET THE CURRENT IOB ADDRESS   @ZA10259 40550037
         LA    WRKR3,0(WRKR3)    CLEAR HIGH ORDER BYTE         @ZA10259 40560037
         TM    20(WRKR3),ONE     ARE WE POSTED UNIT EXCEPTION  @ZA10259 40570037
         BO    SETBLK            YES ADD ONE TO FSF COUNT      @ZA10259 40580037
         L     WRKR4,0(WRKR3)    GET NEXT IOB/ICB              @ZA10259 40590037
BACK     EQU   *                                               @ZA10259 40600037
         LA    WRKR4,0(WRKR4)    CLEAR HIGH ORDER BYTE         @ZA10259 40610037
         CR    WRKR3,WRKR4       ARE THEY EQUAL                @ZA10259 40620037
         BE    TESTBLK           YES ONLY 1 IOB OR LAST        @ZA10259 40630037
TESTUE   EQU   *                                               @ZA10259 40640037
         TM    20(WRKR4),ONE     IS UNIT EXCEPTION ON ?        @ZA10259 40650037
         BNO   GETNEXT           NO GET NEXT IOB/ICB           @ZA10259 40660037
SETBLK   EQU   *                                               @ZA10259 40670037
         OI    TABDSORG,X'08'    SET FLAG                      @ZA10259 40680037
         LA    WRKR4,1           SET REG TO 1                  @ZA10259 40690037
         AR    DSCNTR,WRKR4      INCREMENT REG                 @ZA10259 40695037
         B     TESTBLK           BRANCH                        @ZA10259 40700037
GETNEXT  EQU   *                                               @ZA12059 40720037
         L     WRKR4,0(WRKR4)    GET NEXT IOB/ICB              @ZA10259 40730037
         B     BACK              BRANCH BACK                   @ZA10259 40740037
*                                                                       40750037
TESTBLK  EQU   *                                               @ZA10259 40760037
*    *** POSITION TO CORRECT RECORD FOR ALL TAPES ***                   40770037
         OI    TABOPS,RDOP              SET TABOPS CODE FOR RD FWD      40900019
         ST    DSCNTR,TABBLK1           SAVE BLOCK COUNT FOR READ       41000019
*                                                                       41100019
*                                                                       41200019
         B     REPDCB26                 BRANCH TO GET NEXT ENTRY        41300019
*                                                                       41400019
REPDCB18 EQU   *                                                        41500019
*                                                                       41600019
*    *** POSITION TO CORRECT RECORD ONLY IF UNLABELED AND READ BACK *** 41700019
*                                                                       41800019
          STM   WRKR5,WRKR3,RSREGSAV+12    SAVE REG  FOR ERROR  ZA02208 41850037
         TM    TABTPLBL,BLP+NL          IS IT BLP OR UNLABELED   A31340 41900020
         BZ    REPDCB64                 BR IF NO TO SET ERR CODE A31340 42000020
*                                                                       42100019
         TM    DEBOPATB,RDBACK          IS IT RDBACK                    42200019
         BC    NOTMIX,REPDCB64          BRANCH IF NOT TO SET ERROR CODE 42300019
*                                                                       42400019
REPDCB20 EQU   *                                                        42500019
*                                                                       42600019
*    *** POSITION TO END OF DATA SET ***                                42700019
*                                                                       42800019
         OI    TABOPS,FSF+BSF           INDICATE BOTH FSF-BSF TO S21040 43260021
*                                       POSITION TO END OF DATA SET     43320021
         SR    WRKR5,WRKR5              ZERO OUT REGISTER        YM7567 43370002
         IC    WRKR5,TABFSFN1           GET REQUIRED NO OF FSF'S YM7567 43380002
         LA    WRKR5,D1(,WRKR5)         INCREMENT BY 1 FOR END   YM7567 43392002
*                                       OF DATA SET              YM7567 43396002
         STC   WRKR5,TABFSFN1           STORE FSF COUNT          YM7567 43398002
*                                                                       43400019
         LTR   TCBR,TCBR                IS BYPASS SWITCH ON             43500019
         BNZ   REPDCB26                 BRANCH IF YES TO GET NEXT ENTRY 43600019
*                                                                       43700019
*                                                                       43800019
*    *** POSITION TO CORRECT RECORD FOR READ BACKWARD ***               43900019
*                                                                       44000019
         OI    TABOPS,RDBK              SET TABOPS CODE FOR RD BACKWARD 44100019
         LPR   DSCNTR,DSCNTR            GET BLOCK COUNT POSITIVE        44200019
         ST    DSCNTR,TABBLK1           SAVE BLKCT IN TABL              44300019
         B     REPDCB26                 BRANCH TO GET NEXT ENTRY        44400019
*                                                                       44500019
REPDCB22 EQU   *                                                        44600019
*                                                                       44700019
*    *** RECORD POSITIONING IS NOT NECESSARY ***                        44800019
*                                                                       44900019
         TM    TABTPLBL,BLP+NL          IS IT BLP OR UNLABELED   A31340 45000020
         BZ    REPDCB26                 BR IF NOT                A31340 45100020
*                                                                       45200019
REPDCB24 EQU   *                                                        45300019
*                                                                       45400019
         TM    DEBOPATB,RDBACK          IS IT RDBACK                    45500019
         BC    NOTMIX,REPDCB26          BRANCH IF NOT TO GET NEXT ENTRY 45600019
*                                                                       45700019
         LA    TCBR,ONE                 SET SWITCH TO BYPASS RECORD     45800019
*                                            POSITIONING                45900019
         B     REPDCB20                 BRANCH TO POSITION TO END OF    46000019
*                                            DATA SET                   46100019
REPDCB26 EQU   *                                                        46200019
*                                                                       46300019
*    ****************************************************************** 46400019
*                                                                       46500019
*    *** DETERMINE IF MORE ENTRIES ARE TO BE PROCESSED ***              46600019
*                                                                       46700019
*    ****************************************************************** 46800019
*                                                                       46900019
         SR    TCBR,TCBR                TURN BYPASS SWITCH OFF          47000019
*                                                                       47100019
         TM    TABFLG1,TABLAST          IS THIS LAST ENTRY       Y02049 47150002
         BO    REPDCB27                 BR YES TO INIT I/O       S21040 47300021
*                                                                       47400019
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TABL PTR              47500019
         B     REPDCB00                 BRANCH TO PICK UP NEXT ENTRY    47600019
         EJECT                                                   YM7337 47650002
*    ****************************************************************** 47660002
*                                                                       47700019
*        THIS ROUTINE WILL PERFORM ALL THE NECESSARY I/O OPERATIONS     47800019
*        ACCORDING TO THE TABLE BUILT IN THE END OF EACH TABL ELEMENT.  47900019
*                                                                       48000019
*                                                                       48100019
*    ****************************************************************** 48200019
REPDCB27 EQU   *                                                 S21040 48230021
         SR    DSCNTR,DSCNTR            DOS TAPE INDICATOR              48260000
REPDCB28 EQU   *                                                        48300019
         LR    CTABLR,TABLR             INITIALIZE TABL POINTER         48400019
         SR    WRKR3,WRKR3              TURN OFF SPIN SWITCH            48500019
         SR    WAIT,WAIT                TURN ON DO NOT WAIT SWITCH      48600019
REPDCB30 EQU   *                                                        48700019
         L     WRKR4,TABSEGAD-D1        WORK AREA SEGMENT ADDRESS       48800019
         TM    TABFLG1,TABTAPE+TABDOSTP  NON DOS TAPE            Y02049 48850002
         BC    NOTMIXED,REPDCB52        BR NO TO GET NEXT ENTRY  S21040 49000021
*                                                                       49100019
         TM    TABOPS,NOOPS             ANY I/O NEEDED FOR THIS ELT     49200019
         BZ    REPDCB52                 BRANCH NO TO GET NEXT ELT       49300019
         LA    WRKR3,ONE                TURN ON SPIN SWITCH             49400019
         TM    RSSTAT2,LOCKSW           WORK AREA LOCK SW ON     Y02049 49450002
         BO    REPDCBC0                 YES  SEE WHO IS REQ USE  Y02049 49460002
REPDCX30 EQU   *                        INSTR MUST FOLLOW        Y02049 49470002
         TM    RSSTAT1,BUSY             IS WORK AREA BUSY               49500019
         BZ    REPDCB32                 BRANCH NO TO CONTINUE           49600019
         BAL   WRKR5,REPDCB56           GO TO WAIT ROUTINE              49700019
*                                                                       49800019
REPDCB32 EQU   *                                                        49900019
*                                                                       50000019
         TM    TABOPS,REW               IS REWIND NECESSARY             50100019
         BZ    REPDCB34                 BRANCH NO REWIND                50200019
*                                                                       50300019
*        REWIND ROUTINE                                                 50400019
*                                                                       50500019
         XI    TABOPS,REW               PEEL OFF REWIND MASK            50600019
*                                                                       50700019
         MVI   RSCCW1,REWIND            SET CCW OP CODE TO REWIND       50800019
         B     REPDCB48                 GO TO EXCP                      50900019
*                                                                       51000019
REPDCB34 EQU   *                                                        51100019
*                                                                       51200019
*        FORWARD SPACE FILE ROUTINE                                     51300019
*                                                                       51400019
         TM    TABOPS,PASSWDID          PASSWORD CHECK REQUIRED  Y02049 51450002
         BO    REPDCBA0                 YES READ HEADER LABELS   Y02049 51460002
         TM    TABOPS,FSF               IS FSF NECESSARY                51500019
         BZ    REPDCB38                 BRANCH NO TO CHECK BSF          51600019
*                                                                       51700019
*        FSF                                                            51800019
*                                                                       51900019
*        FOR STANDARD LABEL TAPES, THE FSF ROUTINE WILL DO N-1   YM7567 51950002
*        FSF'S, BASED ON THE NUMBER IN TABFSFN1.  IF GOING TO    YM7567 51960002
*        THE SECOND FILE HDR RECORDS, TABFSFN1 WILL BE SET TO    YM7567 51980002
*        FOUR, AND THREE FSF'S WILL BE DONE.                     YM7567 51990002
*        FOR NON-LABELED TABES, THE FSF ROUTINE WILL DO N        YM7567 51992002
*        FSF'S BASED ON THE NUMBER IN TABFSFN1.                  YM7567 51994002
*                                                                       51996002
         SR    WRKR6,WRKR6                                              52000019
         IC    WRKR6,TABFSFN2           GET NUMBER OF FSF ALREADY DONE  52100019
         LA    WRKR6,D1(WRKR6)          ADD ONE                         52200019
         STC   WRKR6,TABFSFN2           SAVE NUMBER OF FSF'S            52300019
         CLC   TABFSFN1(L1),TABFSFN2    WILL THIS BE ENOUGH             52400019
         BNE   REPDCB36                 BRANCH NO NOT ENOUGH            52500019
*                                                                       52600019
         XI    TABOPS,FSF               PEEL OFF FSF MASK               52700019
         TM    TABTPLBL,SL              TEST FOR STANDARD LABEL  Y02049 52750002
         BNO   REPDCB36                 NO STANDARD LABEL        Y02049 52760002
         OI    TABOPS,PASSWDID          IND POSSIBLE PASSWORD CK YM7055 52770002
*********************************************************************** 52780002
*              ROUTINE TO VERIFY DATA SET LABELS AND TO DO            * 52790002
*              PASSWORD PROTECTION IF REQUIRED.                       * 52792002
*********************************************************************** 52794002
REPDCBA0 EQU   *                        INSTR MUST FOLLOW        Y02049 52796002
         TM    RSPASSFL,DX2             PASSWORD TEST PASS ID ON Y02049 52798002
         BO    REPDCBA6                 YES SEE IF PASSWORD CK RQY02049 52798402
         TM    RSPASSFL,D1              DATA SET LBL TEST FL ON  Y02049 52798802
         BO    REPDCBA1                 YES VERIFY DS LABEL      Y02049 52799202
REPDCBAA EQU   *                                                 YM7055 52799302
         MVC   RSCCW1(D8),RSCCW2        GET TAPE READ CCW        Y02049 52799602
         MVI   RSPASSFL,D1              SET DS LABEL TEST FLAG   Y02049 52799702
         MVC   RSTABAD(D3),TABSEGAD     ST ADR OF USING ELEMENT  Y02049 52799802
         MVI   RSSTAT2,LOCKSW           SET WORK AREA LOCK SW    Y02049 52808102
         B     REPDCB48                 READ HDR1 FROM TAPE      Y02049 52816602
*********************************************************************** 52824902
*              VERIFY HDR1 RECORD READ  (1ST REC OF IBM TAPE LABEL)   * 52833202
*********************************************************************** 52843202
REPDCBA1 EQU   *                        INSTR MUST FOLLOW        Y02049 52853202
         CLI   RSHDRNUM,DF1             REC NUM MATCH            Y02049 52865202
         BNE   REPDCBB5                 NOT HDR1 ABORT           Y02049 52865602
         CLC   RSHDR,HDRMASK1           'HDR'                    Y02049 52866002
         BE    REPDCBA2                 GO CHECK HDR1 LABEL      YM7055 52876002
         CLC   RSHDR,VOLMASK            IS THIS THE VOL1 LABEL?  YM7055 52886002
         BNE   REPDCBB5                 NOT HDR1 OR VOL1, ERROR  YM7055 52888002
         B     REPDCBAA                 GO READ HDR1 LABEL       YM7055 52890402
*********************************************************************** 52940402
*             PERFORM LABEL VERIFICATION FOR DATA SET                 * 52950402
*********************************************************************** 52952402
REPDCBA2 EQU   *                        INSTR MUST FOLLOW        Y02049 52959102
         L     R1,TABJFCB-D1            GET TTR ADR OF JFCB      YM7337 52960702
         LA    RE,D16(R1)               GET ADDR OF DSN IN JFCB  YM7337 52988102
         USING INFMJFCB,RE                                       YM7337 52988202
         LA    RF,L'JFCBDSNM-D1         GET INDEX LAST CHAR DSN  YM7337 52988502
REPDCBA3 EQU   *                        CHECK LENGTH             YM7337 52991202
         LA    R1,JFCBDSNM-INFMJFCB(RE,RF) GET CHAR TO CHK       YM7337 52993202
         CLI   D0(R1),BLANK             CHK IF BLANK             YM7337 52993302
         BNE   REPDCBA4                 CONT TIL FIRST NON-BLNK  YM7337 52993602
         BCT   RF,REPDCBA3              DECR OFFSET TO NON-BLANK YM7337 52994002
REPDCBA4 EQU   *                        COMPARE DSN              YM7337 52994402
         LA    RF,D1(,RF)               GET NUMBER OF CHARS      YM7337 52994802
         SH    RF,MAXNAME               CHK IF GRTR 17 CHAR LBL  YM7337 52995302
         BP    REPDCBX4                 BR - GRTR 17 CHAR        YM7337 52995702
         XR    RF,RF                    COMPARE FROM START       YM7337 52995802
REPDCBX4 EQU   *                        CHK DSN                  YM7337 52999602
         AR    RE,RF                    GET FIRST CHAR TO CMPR   YM7337 52999702
         CLC   JFCBDSNM-INFMJFCB(C17,RE),RSDATAID SAME DSN?      YM7337 52999802
         BNE   REPDCBB5                 ERROR NOT SAME DSN       YM7337 53000202
         DROP  RE                                                YM7337 53033702
*********************************************************************** 53037502
*              SET UP TO READ HDR2 RECORD OF TAPE LABEL               * 53039502
*********************************************************************** 53041502
REPDCBA5 EQU   *                        INSTR MUST FOLLOW        Y02049 53043502
         SR    WRKR2,WRKR2                                       Y02049 53043902
         ICM   WRKR2,HIORDER,RSDSSECR   GET HDR1 SECURITY BYTE   Y02049 53044302
         SLL   WRKR2,D4                 STRIP OFF HIGH ORDER BITSY02049 53044702
         STCM  WRKR2,HIORDER,RSPASSFL   SAV SEC RESET OTHER FLGS Y02049 53044802
         OI    RSPASSFL,DX2             SET PASSWORD TEST ID     Y02049 53045102
         B     REPDCB48                 READ HDR2 REC FROM TAPE  Y02049 53045202
*********************************************************************** 53045302
*              VERIFY HDR2 RECORD READ (2ND REC OF IBM TAPE LABEL)    * 53053102
*********************************************************************** 53055102
REPDCBA6 EQU   *                        INSTR MUST FOLLOW        Y02049 53057102
         XI    TABOPS,PASSWDID          RESET PASSWORD CHK IND   YM7055 53059102
         CLI   RSHDRNUM,DF2             REC NUM MATCH            Y02049 53060302
         BNE   REPDCBB5                 ABORT NOT HDR2           Y02049 53060702
         CLC   RSHDR,HDRMASK1           'HDR'                    Y02049 53060802
         BNE   REPDCBB5                 ABORT NOT HDR2           Y02049 53074702
*********************************************************************** 53075102
*              DETERMINE IF PASSWORD CHECK IS TO BE MADE              * 53075502
*********************************************************************** 53075902
REPDCBA7 EQU   *                        INSTR MUST FOLLOW        Y02049 53076302
         MVI   RSSTAT2,RLOCKSW          RESET WRK AREA LOCK SW   Y02049 53086302
         TM    TABFLG4,TABBYPSW         IS THE USER RACF       @G32DSMI 53088332
*                                       AUTHORIZED TO THE VOL  @G32DSMI 53090332
         BO    REPDCBA9                 YES - BYPASS PASSWORD  @G32DSMI 53092332
*                                       CHECKING               @G32DSMI 53094332
         TM    RSPASSFL,WRITEFLG        TEST SECURITY FLAGS      Y02049 53096302
         BO    REPDCBA8                 WRITE PROTECTED          Y02049 53107002
         TM    RSPASSFL,RDWTRFLG        TEST SECURITY FLAGS      Y02049 53117002
         BO    REPDCBB0                 READ/WRITE PROTECTED     Y02049 53117402
         B     REPDCBA9                 NO PASSWORD CHK REQ      Y02049 53117802
*********************************************************************** 53122902
*              IF DATA SET IS OPEN FOR INPUT NO PASSWORD CHK REQ      * 53124902
*********************************************************************** 53126902
REPDCBA8 EQU   *                        INSTR MUST FOLLOW        Y02049 53128302
         L     WRKR2,TABDCBAD-D1        DCB ADR                  Y02049 53130302
         USING IHADCB,WRKR2                                      Y02049 53132302
         L     DEBR,DCBDEBA-D1          DEB ADR THIS DCB         Y02049 53132702
         TM    DEBACCS,INPUTMSK         TEST FOR OUTPUT          Y02049 53133102
         BNO   REPDCBA9                 NO PASSWORD CHK          YM7337 53133202
         EJECT                                                   YM7337 53143202
*********************************************************************** 53154702
*              SET UP FOR PASSWORD CHECK                              * 53156702
*                                                                     * 53157102
*        INTERFACE TO SECLOADA AS FOLLOWS:                            * 53157502
*              R1 = PTR DSAB                                          * 53157902
*              R5 = PTR DEB                                           * 53158402
*              RA = 5(TAPE) - HI-ORDER BYTE                           * 53158502
*              RB = PTR DATA SET NAME                                 * 53158602
*              RD = PTR DADSM TYPE W/A                                * 53158802
*              RE = 0                                                 * 53159202
*                                                                     * 53159302
*        RETURN AS FOLLOWS:                                           * 53159402
*              R1-RD RESTORED                                         * 53161102
*              RA = HI-ORDER BYTE (0) = O.K.                          * 53163102
*                   HI-ORDER BYTE (NOT = 0) = BAD                     * 53163502
*********************************************************************** 53163902
REPDCBB0 EQU   *                        INSTR MUST FOLLOW        Y02049 53164402
         STM   R0,RF,RSREGSAV           SAVE REGS BEFORE SETUP   YM7337 53164602
         LA    R6,RSREGSAV              GET REG SAVE AREA        YM7337 53165002
         OI    TABFLG2,TABSW            IND SECLOADA CALL        YM7337 53165402
         L     R1,TABDCBAD-D1           PTR DCB                  YM7337 53165802
         L     R5,DCBDEBAD-IHADCB(,R1)  R5 PTS TO DEB            YM7337 53165902
         LR    R1,R5                    GET DEB PTR              YM7337 53166002
         SH    R1,PFXCON                BACKUP TO PREFIX         YM7337 53166102
         L     R1,DEBXTNP-DEBPREFX(,R1) PTR DEB EXTENSION        YM7337 53166202
         L     R1,DEBXDSAB-DEBXTN(,R1)  R1 PTS TO DSAB           YM7337 53166302
         ICM   BUFR,HIORDER,RTNRETID    SET RETURN FOR S05B      YM7337 53167002
         L     RB,TABJFCB-D1            GET SVA OF JFCB          YM7337 53167102
         LA    RB,D16(RB)               ADDR DSN - SKIP SWA CTL  YM7337 53167202
         L     RD,SECSWICH              RD PTR DADSM-LIKE W/A    YM7337 53167302
         USING IECEXTPR,RD              SECLOADA W/A ADDR        YM7337 53167402
         IECRES LOAD,MODNM=SECMODNM,EXTPR=(RD),BRCODE=0,         YM7337*53167602
               BRANCH=DIRECT            EXIT TO SECLOADA         YM7337 53168002
         DROP  RD                                                YM7337 53176602
         USING RSDSECT,WRKR4            PT RESTART W/A           YM7337 53178602
*********************************************************************** 53186202
*              TEST SECLOADA RESPONSE; RIGHT PASSWORD GIVEN.          * 53194802
*********************************************************************** 53203402
PASSWORD EQU   *                        INSTR MUST FOLLOW        YM7337 53212002
         MODESET EXTKEY=ZERO            ENSURE KEY 0             YM7337 53220602
         STCM  RA,HIORDER,4*RA(R6)      SAVE RET CODE            YM7337 53229202
         LM    R0,RF,D0(R6)             RESTORE REGS             YM7337 53237802
         NI    TABFLG2,X'FF'-TABSW      RESET SECLOADA CALL      YM7337 53246402
         CLI   RSREGSAV+4*RA,D0         CHK FOR PASSWORD ERROR   YM7337 53255002
         BE    REPDCBA9                 BR IF NO PASSWORD ERROR  YM7337 53263602
         ST    RA,TABVLID2              SAV RET COD FOR PROB DET YM7337 53272202
         MVI   RSRETCOD+D1,ERR219       SET PASSWORD ERROR     @ZSUT222 53280832
         B     REPDCB58                 GO TO ERROR EXIT         YM7337 53289402
         SPACE 3                                                 YM7337 53289802
*********************************************************************** 53290202
*        CHECK IF HEADER2 INDICATES THAT THIS IS A CHECKPOINT         * 53290302
*        DATA SET.  IF IT DOES THEN SET UP TO CALL Q05B.              * 53290402
*                                                                     * 53290502
*        INPUT TO Q05B AS FOLLOWS:                                    * 53291302
*              R1 = 0(CHKPT D.S. CHECK)                               * 53291702
*                   4(OLD CHKPT D.S. AND THE D.S. IS NOT CHKPT)       * 53292102
*              R5 = PTR UCB                                           * 53292502
*              R9 = PTR TAB ENTRY                                     * 53292902
*              RA = PTR RESTART WORK AREA                             * 53293002
*              RE = RETURN ADDRESS                                    * 53293102
*                                                                     * 53293202
*        OUTPUT FROM Q05B AS FOLLOWS:                                 * 53293302
*              ALL REGS SAVED AND RESTORED                            * 53293702
*              DSABCKVL SET IF VOL SECURE.  Q05B XCTL TO V05B IF ERR. * 53294102
*********************************************************************** 53294602
REPDCBA9 EQU   *                        INSTR MUST FOLLOW        YM7337 53294902
         L     RF,SECSWICH              GET ADDR O/C/E/D W/A     YM7337 53296902
         STM   R0,RF,MYREGSAV-IECEXTPR(RF) SAVE REGS             YM7337 53300902
         LR    R6,RF                    TUCK REGSAV IN TIDY PLAC YM7337 53303002
         USING IECEXTPR,R6              ADDRESSABILITY FOR W/A   YM7337 53303302
         L     RE,TABDCBAD-D1           PTR DCB                  YM7337 53304902
         L     RE,DCBDEBAD-IHADCB(,RE)  PTR TO DEB               YM7337 53305302
         SH    RE,PFXCON                BACKUP TO PREFIX         YM7337 53305802
         L     R5,DEBSUCBA-DEBPREFX(,RE) GET UCB REG 5           YM7337 53306302
         L     RE,DEBXTNP-DEBPREFX(,RE) PTR DEB EXTENSION        YM7337 53307802
         L     RE,DEBXDSAB-DEBXTN(,RE)  PTR DSAB                 YM7337 53311002
         XR    R1,R1                    INDR OLD CHKPT D.S.      YM7337 53311402
         CLI   RSDSIND,CHKPTFLG         CHK IF OLD CHKPT D.S.    YM7337 53311502
         BE    REPDCA10                 BR IF OLD CHKPT D.S.     YM7337 53311702
         LA    R1,D4                    OLD CHKPT D.S. - NEW NOT YM7337 53311902
         TM    DSABFLG4-DSAB(RE),DSABCKDS CHK OLD CHKPT D.S.     YM7337 53312302
         BNO   REPDQ05B                 BR NOT OLD CHKPT D.S.    YM7337 53312902
REPDCA10 EQU   *                        GO TO Q05B               YM7337 53313202
         LA    RE,REPDQ05B              SET RETURN ADDRESS       YM7337 53313602
         IECRES LOAD,MODNM=COMMODNM,EXTPR=(R6),BRCODE=(14),      YM7337*53313702
               BRANCH=DIRECT            EXIT TO Q05B             YM7337 53313802
*********************************************************************** 53313902
*              RESUME NORMAL POSITIONING MODE                         * 53314202
*********************************************************************** 53314802
REPDQ05B EQU   *                        RETURN FROM Q05B         YM7337 53316302
         LM    R0,RF,MYREGSAV           RESTORE REGS             YM7337 53316702
         DROP  R6                                                YM7337 53317202
         MVI   RSCCW1+D4,FLAGS          RESTORE CCW1 FLAGS       Y02049 53318402
         XC    RSCCW1+D1(D3),RSCCW1+D1  CLEAR STORAGE ADR        Y02049 53318802
         MVI   RSCCW1+D7,COUNT          RESTORE CCW1 COUNT TO 1  Y02049 53320802
         MVI   RSPASSFL,RESETFLG        RESET FLAGS              Y02049 53322802
         B     REPDCB36                 SPACE OVER FILE MARK     YM7345 53324802
**********************************************************************  53326802
*              SET ERR CODE DATA SET LABEL DOESN'T VERIFY            *  53328802
**********************************************************************  53330802
REPDCBB5 EQU   *                        INSTR MUST FOLLOW        Y02049 53332802
         MVI   RSRETCOD+D1,ERR222       SET CODE 222             Y02049 53334802
         B     REPDCB58                 CLOSE DOWN PROCESSING    Y02049 53336802
*********************************************************************** 53338802
*               TEST IF WORK AREA LOCKED FOR CURRENT REQUESTOR        * 53342202
*********************************************************************** 53345602
REPDCBC0 EQU   *                        INSTR MUST FOLLOW        Y02049 53349002
         CLC   TABSEGAD(D3),RSTABAD     48 BYTE ENTRY ADRS MATCH Y02049 53352402
         BE    REPDCX30                 YES CONTINUE PROCESSING  Y02049 53355802
         B     REPDCB52                 NO FIND OWNER OR DIF WA  Y02049 53359202
**********************************************************************  53362602
*                                                                    *  53366002
*        END OF THE ROUTINE TO VERIFY DATA SET LABELS AND PASSWORDS  *  53369402
*                                                                    *  53372802
**********************************************************************  53376202
*                                                                       53379602
REPDCB36 EQU   *                                                        53383002
*                                                                       53386402
*                                                                       53389802
         MVI   RSCCW1,FSFOP             SET FSF OP CODE IN CCW          53393202
         B     REPDCB48                 GO TO EXCP                      53396602
*                                                                       53400019
*                                                                       53500019
*                                                                       53600019
REPDCB38 EQU   *                                                        53700019
*                                                                       53800019
*        BACK SPACE FILE ROUTINE                                        53900019
*                                                                       54000019
         TM    TABOPS,BSF               IS BACK SPACE FILE NECESSARY    54100019
         BZ    REPDCB40                 BRANCH NO TO CHECK READ FWD     54200019
*                                                                       54300019
*BSF                                                                    54400019
*                                                                       54500019
         XI    TABOPS,BSF               PEEL OFF BSF MASK               54600019
*                                                                       54700019
*                                                                       54800019
         MVI   RSCCW1,BSFOP             SET BSF OP CODE IN CCW          54900019
         B     REPDCB48                 GO TO EXCP                      55000019
*                                                                       55100019
*                                                                       55200019
*                                                                       55300019
REPDCB40 EQU   *                                                        55400019
*                                                                       55500019
*        READ FORWARD ROUTINE                                           55600019
*                                                                       55700019
         TM    TABOPS,RDOP              IS READ FWD NECESSARY           55800019
         BZ    REPDCB44                 BRANCH NO TO CHECK READ BACK    55900019
*                                                                       56000019
*                                                                       56100019
         L     WRKR6,TABBLK2            GET BLK CT                      56200019
         LA    WRKR6,D1(WRKR6)          INCREMENT BY ONE                56300019
         ST    WRKR6,TABBLK2            SAVE BLK CT                     56400019
         CLC   TABBLK1(L4),TABBLK2      COMPARE BLOCK COUNTS            56500019
         BNE   REPDCB42                 BRANCH NOT EQUAL TO CONTINUE    56600019
*                                                                       56700019
         XI    TABOPS,RDOP              PEEL OFF READ FWD MASK          56800019
*                                                                       56900019
REPDCB42 EQU   *                                                        57000019
*                                                                       57100019
         MVI   RSCCW1,READ              SET OP CODE TO READ FWD         57200019
         B     REPDCB48                 GO TO EXCP                      57300019
*                                                                       57400019
*                                                                       57500019
*                                                                       57600019
REPDCB44 EQU   *                                                        57700019
*                                                                       57800019
*        READ BACKWARD ROUTINE                                          57900019
*                                                                       58000019
         TM    TABOPS,RDBK              IS READ BACKWARD NECESSARY      58100019
         BZ    REPDCB52                 BRANCH NO MORE OPS FOR THIS ELT 58200019
*                                                                       58300019
*        RDBK                                                           58400019
*                                                                       58500019
         L     WRKR6,TABBLK2            GET BLOCK COUNT                 58600019
         LA    WRKR6,D1(WRKR6)          ADD ONE                         58700019
         ST    WRKR6,TABBLK2            SAVE NLOCK COUNT                58800019
         CLC   TABBLK1(L4),TABBLK2      COMPARE BLOCK COUNTS            58900019
         BNE   REPDCB46                 BRANCH NOT EQUAL TO CONTINUE    59000019
*                                                                       59100019
         XI    TABOPS,RDBK              PEEL OFF READ BACKWARD MASK     59200019
*                                                                       59300019
REPDCB46 EQU   *                                                        59400019
*                                                                       59500019
         MVI   RSCCW1,READBACK          SET OP CODE TO READ BACKWARD    59600019
*                                                                       59700019
*                                                                       59800019
REPDCB48 EQU   *                                                        59900019
*                                                                       60000019
         MVC   RSDEBUCB(L4),TABUCB      ADJUST UCB POINTER IN WORK AREA 60100019
         TM    TABOPS,PASSWDID          READING TAPE LABELS?     YM7551 60150002
         BNO   REPDCB49                 NO                       YM7551 60160002
         NI    RSDEBUCB,MODECLR         CLEAR ALL BUT DENSITY    YM7551 60170002
         OI    RSDEBUCB,SETMODE         EVEN PAR TRANS MD CVT MD YM7551 60180002
REPDCB49 EQU   *                                                        60200019
         MVI   RSSTAT1,BUSY             TURN ON WORK AREA BUSY SWITCH   60300019
*                                                                       60400019
REPDCB50 EQU   *                                                        60500019
*                                                                       60600019
*        EXCP  ROUTINE                                                  60700019
*                                                                       60800019
*                                                                       60900019
*                                                                       61000019
         XC    RSECBAD(L4),RSECBAD      INITIALIZE ECB                  61100019
*                                                                       61200019
*                                                                       61300019
         EXCP  RSIOB                                                    61400019
*                                                                       61500019
*                                                                       61600019
         LTR   WAIT,WAIT                SHOULD WE WAIT                  61700019
         BNZ   REPDCB56                 BR YES TO WAIT ROUTINE   S21040 61800021
*                                                                       62000019
REPDCB52 EQU   *                                                        62100019
*                                                                       62200019
         TM    TABFLG1,TABTAPE+TABDOSTP  DOS TAPE ENTRY          Y02049 62210002
         BNO   REPDCB53                 BRANCH ON NO             S21040 62220021
         LA    DSCNTR,D1(DSCNTR)        INCREMENT DOS TAPE COUNT        62230000
*                                                                       62240021
REPDCB53 EQU   *                                                 S21040 62250021
         TM    TABFLG1,TABLAST          IS THIS THE LAST ENTRY          62300002
         BO    REPDCB54                 BRANCH YES TO CHECK IF DONE     62400019
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TABL POINTER          62500019
         B     REPDCB30                 CONTINUE PROCESSING             62600019
*                                                                       62700019
REPDCB54 EQU   *                                                        62800019
*                                                                       62900019
*        LAST ENTRY HAS BEEN PROCESSED, ARE ALL ELTS COMPLETE           63000019
*                                                                       63100019
         LTR   WRKR3,WRKR3              TEST SPIN SWITCH                63200019
         BZ    REPDCB58                 SWITCH OFF - STOP SPINNING      63300019
         B     REPDCB28                 SPIN THRU TABL ELEMENTS AGAIN   63400019
*                                                                       63500019
*                                                                       63600019
*        WAIT ROUTINE                                                   63700019
*                                                                       63800019
REPDCB56 EQU   *                                                        63900019
*        WAIT FOR CE FOR CONTROL OPERATIONS, WAIT FOR CE AND DE FOR ALL 64000019
*        OTHERS,  NOP BRINGS IN CE AND DE SO CHECKING CAN BE DONE       64100019
*        FOR ERRORS BEFORE THE NEXT OPERATION IS STARTED.               64200019
*                                                                       64300019
*                                                                       64400019
         WAIT  ECB=RSECBAD                                              64500019
*                                                                       64600019
*                                                                       64700019
         TM    RSECBAD,PERMERR          CHECK FOR PERMANENT I/O ERRORS  64800019
         MVI   RSSTAT1,NOTBUSY         TURN OFF WORK AREA BUSY   A41420 64880021
*                                       SW                       A41420 64960021
         BM    REPDCB76                 BRANCH YES TO CHECK      A41420 65040002
*                                       ERRORS                   A41420 65120021
*                                                                       65200019
         CLI   RSCCW1,NOPOP             HAS NOP BEEN ISSUED             65300019
         BCR   EQUAL,WRKR5              BR YES TO CONTINUE PROCESSING   65400019
*                                                                       65500019
         TM    RSCCW1,READOP            OP CODE READ/READ BACK   S21040 65700021
         BZ    ZERO(WRKR5)              BR YES NOP NOT NEEDED    S21040 65900021
*                                                                       66100019
         MVI   RSCCW1,NOPOP             CHANGE OP CODE TO NOP           66200019
         B     REPDCB49                 GO TO EXCP                      66300019
*                                                                       66400019
*                                                                       66500019
*                                                                       66600019
*                                                                       66700019
REPDCB58 EQU   *                                                        66800019
*        WAIT ON ALL WORK AREAS TO BE SURE ALL HAVE BEEN CHECKED        66900019
*        FOR I/O ERRORS                                                 67000019
*                                                                       67100019
         LR    CTABLR,TABLR             INIT TABL POINTER               67200019
*                                                                       67300019
REPDCB60 EQU   *                                                        67400019
*                                                                       67500019
         TM    TABFLG1,TABTAPE+TABDOSTP  IS  IT  NON-DOS TAPE    Y02049 67550002
         BC    NOTMIXED,REPDCB62        BRANCH NO TO CONTINUE    S21040 67700021
*                                                                       67800019
         TM    TABFLG2,TABRSDS          IS THIS WORKING CHKPT DS YM7358 67850002
         BO    REPDCB62                 YES - DON'T PROCESS      YM7358 67860002
*                                                                YM7358 67870002
         L     WRKR4,TABSEGAD-D1        WORK AREA SEGMENT ADDRESS       67900019
         TM    RSSTAT1,BUSY             IS WORK AREA BUSY               68000019
         BZ    REPDCB62                 BRANCH NO TO CONTINUE           68100019
*                                                                       68200019
         LA    WAIT,ONE                 TURN ON WAIT SWITCH             68300019
         BAL WRKR5,REPDCB56             GO TO WAIT ROUTINE              68400019
*                                                                       68500019
         MVI   TABVLID2,BLANK           RESTORE BLANKS                  68600019
         MVC   TABVLID2+D1(L23),TABVLID2     TO TABL AREA               68700019
*                                                                       68800019
REPDCB62 EQU   *                                                        68900019
*                                                                       69000019
         TM    TABFLG1,TABLAST          IS THIS THE LAST ENTRY          69100002
         BO    REPDCB68                 BRANCH YES TO EXIT              69200019
*                                                                       69300019
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TABL POINTER          69400019
         B     REPDCB60                 CONTINUE WAIT PROCESSING        69500019
*                                                                       69600019
*    ****************************************************************** 69700019
*                                                                       69800019
**********************************************************************  69850002
*              RELEASE STORAGE GOTTEN FOR TAPE OPS WORK AREAS        *  69900002
**********************************************************************  69950002
REPDCB68 EQU   *                                                        71500019
*                                                                       71676702
         LR    CTABLR,TABLR             REINITIALIZE TABL POINTER       71700019
         L     WRKR4,TABSEGAD-D1        POINTER TO FIRST WORK AREA      71800019
*                                                                       71900019
         LA    WRKR3,RSCCW2             SET UP WORK AREA FOR XCTL       72000019
*                                                                       72100019
         LH    WRKR2,RSSTAT3            GET SIZE OF SECONDARY W.A.      72200019
         LTR   WRKR2,WRKR2              IS THERE SECONDARY SPACE        72300019
         BZ    REPDCB69                 BRANCH NO TO XCTL               72400019
*                                                                       72500019
         ST    TIOTR,GOTLOC             LOCATION OF SECONDARY SPACE     72600019
         ST    WRKR2,GOTLOC+D4          SIZE OF SECONDARY SPACE         72700019
*                                                                       72800019
         LA    R1,FREELIST              POINTER TO LIST FOR FREEMAIN    72900019
         LA    R13,GETSAVE              POINTER TO SAVE AREA            73000019
*                                                                       73100019
         FREEMAIN V,A=GOTLOC,SP=250,MF=(E,(1))                          73200019
*                                                                       73300019
*                                                                       73400019
REPDCB69 EQU   *                                                        73500019
*                                                                       73600019
*    ****************************************************************** 73700019
*                                                                       73800019
*    *** DETERMINE WHICH EXIT MODULE TO TAKE ***                        73900019
*                                                                       74000019
*    ****************************************************************** 74100019
*                                                                       74200019
         NC    SECSWICH,SECSWICH        TEST FOR SECLOADA CORE @ZA19615 74210037
         BZ    PASSFREE                 NONE  NO RELEASE REQ   @ZA19615 74217037
         LA    RF,RSREGSAV              GET REG SAVE AREA      @ZA19615 74224037
         STM   R0,RF,D0(RF)             SAVE REGS              @ZA19615 74231037
         L     R1,SECSWICH              GET DADSM-LIKE W/A     @ZA19615 74238037
         IECRES FREE,A=(R1),PREFIX=YES  FREE DADSM-LIKE W/A    @ZA19615 74245037
         MODESET EXTKEY=ZERO            KEY 0                  @ZA19615 74252037
         LM    R0,RF,D0(RF)             RESTORE REGS           @ZA19615 74259037
PASSFREE EQU   *                                               @ZA19615 74270037
         MVC   D0(L8,WRKR3),RSTMODNM    ASSUME RESTART EXIT MOD. S21040 74300021
         TM    RSRETCOD+D1,ERRORS       IS ERROR CODE SET        S21040 74400021
         BZ    AROUND                   NO BRANCH AROUND       @ZSUT222 74500032
         MVC   RSREGSAV(8),MODID        SAVE NAME OF MODULE    @ZSUT222 74510032
*                                       THAT DETECTED ERROR.   @ZSUT222 74520032
         STM   0,15,RSREGSAV+8          SAVE CURRENT REGISTERS @ZSUT222 74530032
         B     REPDCB75                 BRANCH TO ERROR XCTL   @ZSUT222 74540032
AROUND   EQU   *                                               @ZSUT222 74550032
*                                                                       74600021
*    *** TEST FOR DOS TAPES ***                                         74700021
*                                                                       74800021
         LTR   DSCNTR,DSCNTR            ANY DOS TAPES            S21040 74900000
         BZ    REPDCB70                 BRANCH NO                S21040 75000021
*                                                                       75100021
         MVI   D4(WRKR3),DOSMOD         DOS TAPE POSITIONING     S21040 75200021
         B     REPDCB74                  MODULE IGC0U05B         S21040 75300021
*                                                                       75400021
REPDCB70 EQU   *                                                 S21040 75500021
         TM    RSDCBFLG,DAFLAG          DA DEVICE INDICATED      S21040 75600021
         BNO   REPDCB72                 BRANCH NO                S21040 75700021
*                                                                       75800021
         MVI   D4(WRKR3),DAMOD          DA MODULE IGC0R05B       S21040 75900021
         B     REPDCB74                 BRANCH TO XCTL           S21040 76000021
*                                                                       76100021
REPDCB72 EQU   *                                                 S21040 76200021
         MVI   D4(WRKR3),AMMOD          SET NEXT MODULE ID TO    S21040 76300021
*                                       ACCESS METHOD DISP. MOD.        76400021
         B     REPDCB74            BRANCH TO XCTL               ZA02208 76450037
REPDCB75 EQU   *                                                ZA02208 76460037
         L     UCBR,RSMWOFST       GET UCB ADDR IN ERROR        ZA02208 76470037
REPDCB74 EQU   *                          IGC0T05B               S21040 76500021
*                                                                       76600021
         LA    WRKR6,D8(WRKR3)          SET UP FOR XCTL          S21040 76700021
         XC    RSERAS00(D40),RSERAS00   CLEAR SCRATCH AREA       Y02049 76750002
         LR    WRKR2,BUFR               POINT REG 1 TO RESTART   S21040 76800021
*                                        WORK AREA                      76900021
         NI    TABFLG2,X'FF'-TABSW      RESET  RETURN  SW        Y02049 76950002
         XCTL  EPLOC=(WRKR3),SF=(E,(15))                         S21040 77000021
*                                                                       77500019
REPDCB76 EQU   *                                                        77600019
*                                                                       77700019
*    ****************************************************************** 77800019
*                                                                       77900019
*    *** ERROR FOUND ***                                                78000019
*                                                                       78100019
*        THIS PORTION OF CODE MAY BE TAKEN OUT WHEN I/O SUPERVISOR HAS  78200019
*        PUT THE FIXES IN                                               78300019
*                                                                       78400019
*        THIS IS THE CURRENT THOUGHT PERSISTING TO THE HANDLING OF I/O  78500019
*        ERRORS                                                         78600019
*                                                                       78700019
*        ERRORS THAT HAVE OCCURRED AT CHECKPOINT TIME IS ACCEPTED       78800019
*                                                                       78900019
*    ****************************************************************** 79000019
*                                                                       79150000
         STM   WRKR5,WRKR3,RSREGSAV+12   SAVE REG               ZA02208 79152037
         LR    CTABLR,TABLR        GET FIRST TABLE ENTRY        ZA02208 79154037
REPDCB61 EQU   *                                                ZA02208 79156037
         CLC   TABUCB+1(3),RSDEBUCB+1   UCB EQUAL RIGHT ENTRY   ZA02208 79158037
         BE    REPDCB63            BRANCH IF EQUAL              ZA02208 79158437
         TM    TABFLG1,LASTENT     LAST ENTRY                   ZA02208 79158837
         BO    REPDCB66            ERROR                        ZA02208 79159237
         LA    CTABLR,TABENT(CTABLR)    NEXT ENTRY              ZA02208 79159637
         B     REPDCB61            PROCESS NEXT ENTRY           ZA02208 79164037
REPDCB63 EQU   *                                                ZA02208 79166037
         L     UCBR,TABUCB              POINT TO UCB FOR V05B    A47745 79168037
*                                       IN CASE ERROR IS REAL    A47745 79170000
         ST    UCBR,RSMWOFST       SAVE UCB IN ERROR            ZA02208 79180037
         CLI   RSCCW1,READ              IS ERROR IN READ FORWARD        79200019
         BE    REPDCB78                 BRANCH YES                      79300019
*                                                                       79400019
         CLI   RSCCW1,READBACK          IS ERROR IN READ BACKWARD       79500019
         BE    REPDCB78                 BR YES TO CHECK FURTHER  A47745 79600000
REPDCB64 MVI   RSRETCOD+D1,ERR060       SET ERR CODE FOR D.S.  @ZSUT222 79650032
         ST    UCBR,RSMWOFST            SET UCB IN ERROR       @ZA19617 79670037
*                                       POSITIONING IN RSTWA     A47745 79700000
         B     REPDCB81            CLEAN UP OUTSTANDING         ZA02208 79750037
*                                       I/O                      A47745 79760000
*                                                                       79900019
REPDCB78 EQU   *                                                        80000019
*                                                                       80100019
         CLC   TABBLK1(L4),TABBLK2      HAS POSITIONING BEEN COMPLETED  80200019
         BNE   REPDCB66                 BRANCH NO TO SET ERROR CODE     80300019
*                                                                       80400019
         L     DCBR,ZERO(,CTABLR)       GET CURRENT DCB          A46650 80450021
         TM    DCBIFLGS,ERRCHKPT        IS THERE PERMANENT ERR AT CHKPT 80500019
         BO    REPDCB80                BR IF SO TO CONTINUE     ZA02208 80600037
         TM    TABDSORG,X'08'           IS FLAG ON ?           @ZA10259 80610037
         BNO   REPDCB66                 NO BRANCH              @ZA10259 80620037
         NI    TABDSORG,X'F7'           YES TURN IT OFF        @ZA10259 80630037
         B     REPDCB80                 BRANCH                 @ZA10259 80640037
REPDCB66 MVI   RSRETCOD+D1,ERR063       SET ERR CODE FOR RECORD@ZSUT222 80650032
*                                       POSITIONING IN RSTWA     A47745 80700000
REPDCB81 LM    WRKR5,WRKR3,RSREGSAV+12  RESTORE REG             ZA02208 80750037
         B     REPDCB58                 GO CLEAN UP OUTSTANDING  A47745 80800000
*                                       I/O                      A47745 80850000
REPDCB80 LM    WRKR5,WRKR3,RSREGSAV+12  RESTORE REG             ZA02208 80860037
         B     REPDCB52            GO CLEAN UP OUTSTANDING IO   ZA02208 80870037
*                                                                       80900019
*********************************************************************** 81000019
*                                                                       81100019
*     CONSTANTS USED IN REPI/O                                          81200019
*                                                                       81300019
*********************************************************************** 81400019
*                                                                       81500019
RSTMODNM DC    CL8'IGC0V05B'            RESTART EXIT MOD                81600019
MODID    DC    CL8'IGC0S05B'            MODULE ID              @ZSUT222 81600232
         DS    0F                       FULLWORD BOUNDARY        YM7337 81600402
SECMODNM DC    C'SECLOADA'              EP FOR XCTL              Y02049 81600802
         DC    VL4(SECLOADA)            VCON FOR SECLOADA        YM7337 81601202
COMMODNM DC    C'IGC0Q05B'              COMMON FCTN MOD          YM7337 81601602
         DC    VL4(IGC0Q05B)            VCON FOR IGC0Q05B        YM7337 81601702
VOLMASK  DC    C'VOL'                   VOLUME LABEL ID          YM7055 81602002
HDRMASK1 DC    C'HDR'                   LABEL ID                 Y02049 81610002
SP253    DC    AL1(253)                 SUBPOOL 253              Y02049 81640002
SPACERQ1 DC    AL3(160)                 160 BYTES OF STORAGE     Y02049 81642002
SPACERQ2 DC    AL3(280)                 256(WA)+24(P.L.)         Y02049 81644002
RTNRETID DC    X'05'                    SECLOADA RTN TO ROUT SW  Y02049 81646002
CHKMODNM DC    C'IGC0Q05B'              MOD FOR CHKPT D/S CHK    YM7337 81668402
         DC    F'0'                     UNRESOLVED VCON          YM7337 81678402
C44      DC    H'44'                    DATA SET NAME LNGTH CONSTY02049 81679202
MAXNAME  DC    H'17'                    TAPE LABEL LENGTH        YM7509 81681202
SP230    DC    AL1(230)                 SUBPOOL 230              Y02049 81689202
PFXCON   DC    H'16'                    DEB PREFIX OFFSET        Y02049 81689302
WTGCODE  DC    X'00C0'                  Y02049                   Y02049 81689402
*                                                                     * 81689602
*        MAINTENANCE SPACE                                       Y01909 81700000
*                                                                     * 81750000
PATCH    DC    XL((*-IGC0S05B)/20)'00'   FIVE PERCENT SPACE      Y01909 81800000
*                                                                     * 81850000
         EJECT                                                          81900019
         IECDSECS PREFX,EXPAND=YES                               YM7337 81950002
MYREGSAV DS    18F                      REGISTER SAVE AREA       YM7337 81950102
         IECDSECS MAIN,DSAB,EXPAND=YES                           YM7337 81950402
         EJECT                                                          81952002
         CVT   DSECT=YES,PREFIX=YES,LIST=NO                      Y02049 81954002
CVTFIX   DSECT                                                   Y02049 81954402
CVT      EQU   CVTMAP                                            Y02049 81956002
         EJECT                                                          81960002
         IEEVRSWA  VER=3                AOS2 VERSION OF WA              82000000
SECSWICH EQU   RSERAS02                 SPACE IND FOR SECLOADA   Y02049 82090002
SECIOBAD EQU   RSERAS02                 ADR OF IOB FOR SECLOADA  Y02049 82092002
SECCCWAD EQU   RSERAS03                 ADR OF CCW'S FOR SECLOADAY02049 82094002
         EJECT                                                          82100019
         IEZDEB                                                  Y02049 82150002
         EJECT                                                          82170002
         IEFQMIOP                                                Y02049 82180002
         EJECT                                                          82190002
         IEFJESCT                                                Y02049 82192002
         EJECT                                                          82194002
RSDSECT  DSECT                                                          82200019
*                                                                       82300019
*    DATA EXTENT BLOCK                                                  82400019
*                                                                       82500019
RSDEB    DS    0CL48                                                    82600019
GETSAVE  EQU   RSDEB                                                    82700019
GOTLOC   EQU   GETSAVE+96                                       SA65000 82800002
FREELIST EQU   GOTLOC+8                                                 82900019
         ORG   FREELIST                 ORG TO DEFINE FREEMAIN LIST     83000019
         FREEMAIN  V,A=GOTLOC,MF=L                                      83100019
         ORG   RSDEB                    RESET I.C.                      83200019
RSDEBTCB DC    X'00000000'              TCB ADDRESS                     83300019
RSDEBDEB DC    X'00000000'              DEB ADDRESS                     83400019
*                                                                       83500019
*    DATA CONTROL BLOCK                                                 83600019
*                                                                       83700019
RSDEBOFL DS    0CL1                                                     83800019
RSDEBIRB DC    X'00000000'              IRB ADDRESS                     83900019
RSDEBSYS DC    X'00000000'              1ST IOB ADDR IN SYS.PURGE CHAIN 84000019
RSDEBUSR DC    X'00000000'              1ST IOB ADDR IN USER PRGE CHAIN 84100019
RSDEBECB DC    X'00000000'              PARM.LIST ADDR TO PURGE ECB     84200019
RSDEBID  DS    0CL1                                                     84300019
RSDEBDCB DC    AL4(RSDCBREP)            DCB ADDR                        84400019
RSDEBAPP DS    CL4                      I/O APPENDAGE VECTOR TABLE      84500019
RSDEBMOD DS    0CL1                                                     84600019
RSDEBUCB DS    F                        UCB ADDRESS                     84700019
RSDEBBIN DS    H                        BIN NUMBER                      84750002
RSDEBSCC DS    H                        CYLINDER START ADDRESS          84800002
RSDEBSHH DS    H                        TRACK START ADDRESS             84850002
RSDEBECC DS    H                        CYLINDER END ADDRESS            84900002
RSDEBEHH DS    H                        TRACK END ADDRESS               84950002
RSDEBNTR DS    H                        NO. OF TRACKS IN THIS EXTENT    85000002
*                                                                       85400019
*    EVENT CONTROL BLOCK                                                85500019
*                                                                       85600019
RSECBAD  DS    CL4                      ECB ADDRESS                     85700019
RSDCBDEB DC    AL4(RSDEB)               DEB ADDRESS                     85800019
*                                                                       85900019
RSDCBREP EQU   RSDEB+8                  POINT TO RELATIVE BEGINNING DCB 86000019
*                                                                       86100019
*    INPUT OUTPUT BLOCK                                                 86200019
*                                                                       86300019
RSIOB    DS    0CL40                                                    86400019
RSIOBFG1 DC    X'00'                    I/O FLAGS BYTE 1                86500019
RSIOBFG2 DC    X'00'                    I/O FLAGS BYTE 2                86600019
RSIOBSN1 DS    CL1                      FIRST SENSE BYTE                86700019
RSIOBSN2 DS    CL1                      SECOND SENSE BYTE               86800019
RSIOBECB DC    AL4(RSECBAD)             ECB ADDRESS                     86900019
RSIOBCSW DS    D                        LAST CSW                        87000019
RSIOBCPA DS    AL4(RSCCW1)              CHANNEL PROGRAM ADDRESS         87100019
RSIOBDCB DS    AL4(RSDCBREP)            DCB ADDRESS                     87200019
RSIOBRCP DS    CL4                      RESTART ADDRESS FOR IOS         87300019
RSIOBINC DS    H                        INCREMENT BLOCK COUNT           87400019
RSIOBECT DS    H                        NO. OF ERROR ENTRIES            87500019
RSIOBDAD DS    D                        SEEK ADDRESS FOR DA             87600019
*                                                                       87700019
*    CHANNEL PROGRAM                                                    87800019
*                                                                       87900019
RSCCWLST DS    0CL24                                                    88000019
RSCCW1   DS    D                        CCW1                            88100019
RSCCW2   DS    D                        CCW2                            88200019
RSCCW3   DS    D                        CCW3                            88300019
*                                                                       88400019
*    BUFFER SEGMENT FOR EXTERNAL BLOCKS                                 88500019
*                                                                       88600019
RSSTATUS DS    0CL8                                                     88700019
RSSTAT1  DS    CL1                      STATUS BYTE 1                   88800019
RSSTAT2  DS    CL1                      STATUS BYTE 2                   88900019
RSSTAT3  DS    CL1                      STATUS BYTE 3                   89000019
RSSTAT4  DS    CL1                      STATUS BYTE 4                   89100019
         DS    0F                                                Y02049 89200002
RSPASSFL DS    AL1                      PASSWORD CHK IND         Y02049 89250002
RSTABAD  DS    AL3                      ADR OF CURR USING ENT    Y02049 89260002
RSTLABEL DS    0CL80                    TAPE HDR RECORD          Y02049 89270002
RSHDR    DS    CL3                      LABEL IDENT              Y02049 89280002
RSHDRNUM DS    CL1                      LABEL NO.                Y02049 89290002
RSDATAID DS    CL17                     DATA SET IDENT           Y02049 89292002
         DS    CL32                                              Y02049 89294002
RSDSSECR DS    CL1                      SECURITY IND(DATA SET)   Y02049 89296002
         DS    CL26                     REST OF HDR1             YM7337 89298002
         ORG   RSTLABEL                 DECLARE HDR2             YM7337 89298402
         DS    CL47                     FRONT OF HDR2            YM7337 89298802
RSDSIND  DS    CL1                      CHKPT D.S. INDR          YM7337 89299202
         DS    CL32                     REST OF HDR2             YM7337 89299602
RSSEGEND EQU   *                        LN OF SEG W/A FOR TAPE   YM7337 89299702
         EJECT                                                          89300019
         DCBD  DSORG=PS                                                 89400019
         EJECT                                                          93900019
         IHJDSTAB                                                Y02076 93950002
TABPOS   EQU   TABVLID2                                                 94000002
TABOPS   EQU   TABPOS                                                   94050002
TABFSFN1 EQU   TABPOS+1                                                 94100002
TABFSFN2 EQU   TABPOS+2                                                 94150002
TABBLK1  EQU   TABPOS+4                                                 94200002
TABBLK2  EQU   TABPOS+8                                                 94250002
TABUCB   EQU   TABPOS+12                                                94300002
         EJECT                                                          98800019
SRT      DSECT                                                          98900019
         IEFUCBOB                                                       99000019
         END                                                            99100019
./  ADD  SSI=81150458,NAME=IGC0T05B
         TITLE 'IGC0T05B - ACCESS METHOD PROCESSOR'                     00090002
IGC0T05B CSECT                                                          00300018
* STATUS CHANGE LEVEL 000                                               01300002
*                                                                       01400018
* APAR OZ31493 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 01456037
*C154840,154870,460000,462000,468000                           @ZSUT222 01456637
*A468200-468800,496510                                         @ZSUT222 01458037
*********************************************************************   01500018
*                                                                       01600018
*TITLE - ACCESS METHOD DISPOSITION                                      01700018
*                                                                       01800018
*STATUS - LEVEL 0                                                       01900018
*                                                                       02000018
*FUNCTION / OPERATION -  A.  FOR PARTITIONED DATA SETS, OPENED FOR      02100018
*                            OUTPUT, READ DIRECTORY TO DETERMINE IF     02200018
*                            ANY MEMBERS WERE ADDED AFTER THE CHECK-    02300018
*                            POINT WAS TAKEN.                           02400018
*                                                                       02500018
*                              IF MEMBERS WERE ADDED DELETE THEM WITH   02600018
*                              THE STOW FUNCTION  (EXCEPT SUBSYSTEM).   02700002
*                                                                       02800018
*                        B.  FOR ALL OPENED DATA SETS, IF I/O MUST BE   02900018
*                            REINITIATED, AS A RESULT OF CHKI/O PURGING 03000018
*                            ISSUE THE RESTORE MACRO TO RESCHEDULE THE  03100018
*                            REQUESTS.                                  03200018
*                                                                       03300018
*ENTRY POINT - IGC0T05B   CSECT                                         03400018
*                                                                       03500018
*INPUT -  REGISTER 1 -- WORKAREA                                        03600018
*         REGISTER 8 -- TABLE ENTRY                                     03700018
*                                                                       03800018
*         A TABLE CONSISTING OF 48 BYTE ENTRIES CONTAINING OPENED DATA  03900018
*         SET INFORMATION, ONE ENTRY PER DATA SET.                      04000018
*         REFERENCE DSECT AT END OF LISTING.                            04100018
*                                                                       04200018
*         AT LEAST TWO 304 BYTE BUFFER SEGMENTS CONTAINING THE CONTROL  04300018
*         BLOCKS AND THE WORKAREA TO PROCESS DIRECTORY BLOCKS.          04400018
*         REFERENCE DSECT AT END OF LISTING.                            04500018
*                                                                       04600018
*OUTPUT -  REGISTER 1  WORKAREA ADDRESS                                 04700018
*                                                                       04800018
*          ALL DATA SETS RE-INITIALIZED PROPERLY (AS THEY EXISTED AT    04900018
*          CHECKPOINT TIME)                                             05000018
*                                                                       05100018
*EXTERNAL ROUTINES - RESIDENT CONVERT ROUTINES VIA BALR                 05200018
*                    IDA0A05B VIA BALR IF THERE ARE ANY VSAM DATA SETS  05250037
*                                                                       05300018
*EXITS -  NORMAL  TO IGC0V05B VIA XCTL  RETURN CODE FIELD =0            05400018
*                                                                       05500018
*         ERROR   TO IGC0V05B VIA XCTL                                  05600018
*                    RETURN CODE FIELD = 92 - ERROR IN P. O. PROCESSING 05700018
*                    RETURN CODE FIELD = 96 - ERROR IN DELETION         05800018
*                                                                       05900018
*TABLES / WORKAREAS - REFERENCE DSECTS AT END OF LISTING                06000018
*                                                                       06100018
*********************************************************************** 06200018
*                                                                     * 06300018
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 06400018
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 06500018
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 06600018
*    IS 48 BYTES LONG.                                                * 06700018
*                                                                     * 06800018
*********************************************************************** 06900018
*                                                                       07000018
*        ------------------- 4 BYTES -----------------                  07100018
*                                                                       07200018
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  07300018
*        +DATA SET  +           DCB                  +                  07400018
*        + ORGN.    +         ADDRESS                +                  07500018
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                07600018
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  07700018
*        + NO. 1    +         ADDRESS                +                  07800018
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  07900018
*        +NUMBER    +         JFCB TTR               +                  08000018
*        + OF VOLS  +         ADDRESS                +                  08100018
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               08200018
*                                                                       08300018
*     12 +++++++++++++++++++++++                                        08400018
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   08500018
*        +INFO BYTE + NUMBER   +                                        08600018
*        +++++++++++++++++++++++                                        08700018
*                                                                       08800018
*     12 +++++++++++++++++++++++                                        08900018
*        +    OLD   TIOT       +        DA AND UNIT RECORD              09000018
*        +      OFFSET         +                                        09100018
*        +++++++++++++++++++++++                                        09200018
*                                                                       09300018
*                              +++++++++++++++++++++++                  09400018
*                              +FLAG BYTE +FLAG BYTE +                  09500018
*                              +  NO. 2   +  NO. 3   +                  09600018
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  09700018
*        +FLAG BYTE +FLAG BYTE +                     +                  09800018
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  09900018
*        +++++++++++++++++++++++                     + 20               10000018
*        +                                           +                  10100018
*        +                                           +                  10200018
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  10300018
*        +                                           +                  10400018
*        +   VOLUME &D NO. 2                         +                  10500018
*        +                     +++++++++++++++++++++++ 28               10600018
*        +                     +                     +                  10700018
*        +                     +   VOLUME ID NO. 3   +                  10800018
*     32 +++++++++++++++++++++++                     +                  10900018
*        +                                           +                  11000018
*        +                                           +                  11100018
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               11200018
*        +                                           +                  11300018
*        +   VOLUME ID NO. 4                         +                  11400018
*     40 +                     +++++++++++++++++++++++                  11500018
*        +                     +                     +                  11600018
*        +                     +                     +                  11700018
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               11800018
*        +                                           +                  11900018
*        +                                           +                  12000018
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               12100018
*                                                                       12200018
*                                                                       12300018
*ATTRIBUTES - RE-ENTRANT,REUSABLE,PRIVILEGED,ENABLED                    12400018
*                                                                       12500018
*********************************************************************   12600018
*                                                                       12700018
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               12800018
*                                                                       12900018
*********************************************************************** 13000018
*                                                                       13100018
WRKR1    EQU   0                                                        13200018
WRKR2    EQU   1                                                        13300018
DCBR     EQU   2                                                        13400018
BASER    EQU   3                                                        13500018
DEBR     EQU   4                                                        13600018
UCBR     EQU   5                                                        13700018
TIOTR    EQU   6                                                        13800018
TCBR     EQU   7                                                        13900018
TABLR    EQU   8                                                        14000018
CTABLR   EQU   9                                                        14100018
BUFR     EQU   10                                                       14200018
DSCNTR   EQU   11                                                       14300018
WRKR3    EQU   12                                                       14400018
WRKR4    EQU   13                                                       14500018
WRKR5    EQU   14                                                       14600018
WRKR6    EQU   15                                                       14700018
*                                                                       14800018
*********************************************************************** 14900018
*                                                                       15000018
*    OFFSETS TO BE USED IN REPI/O PHASE                                 15100018
*                                                                       15200018
*********************************************************************** 15300018
*                                                                       15400018
IS       EQU   X'80'                    INDEXED SEQUENCIAL              15402018
PS       EQU   X'40'                    PHYSICAL SEQUENCIAL             15404018
DA       EQU   X'20'                    DIRECT ACCESS                   15406018
PO       EQU   X'02'                    PARTITIONED ORGANIZATION        15408018
NULL     EQU   X'80'                    NULLFILE OR SYSCHECK            15410018
INOROUT  EQU   X'40'                    SYSIN OR SYSOUT DATA SET        15412018
DADEV    EQU   X'20'                    DA DEVICE                       15414018
TPDEV    EQU   X'10'                    TAPE DEVICE                     15416018
UNITREC  EQU   X'04'                    UNIT RECORD EQUIPMENT           15420018
ERRINNSL EQU   X'80'                    ERROR IN NSL ROUTINE            15422018
NSLMTSW  EQU   X'40'                    NSL MOUNT SWITCH                15424018
NSLCOMU  EQU   X'20'                    NSL COMMUNICATION BIT           15426018
BYPASS   EQU   X'10'                    BYPASS LABEL PROCESSING         15428018
NSL      EQU   X'04'                    NON-STANDARD LABEL              15430018
SL       EQU   X'02'                    STANDARD LABEL                  15432018
NL       EQU   X'01'                    NO LABEL                        15434018
GTR5VOL  EQU   X'80'                    GREATER THAN 5 VOLUMES          15436018
POCONCAT EQU   X'40'                    P.O. CONCATENATED               15438018
DAFLAG   EQU   X'80'                    DA DATA SET FLAG                15440018
NONDAFLG EQU   X'40'                    NON-DA DATA SET FLAG            15442018
NSLFLAG  EQU   X'10'                    NSL ROUTINE FLAG                15444018
TYPERST  EQU   X'80'                    IMMEDIATE RESTART               15446018
TABENT   EQU   48                       TABLE ENTRY LENGTH              15448018
WRITE    EQU   X'01'                    WRITE ON TAPE                   15450018
READ     EQU   X'02'                    READ FOR TAPE                   15452018
NOPOP    EQU   X'03'                    NOP                             15454018
SENSE    EQU   X'04'                    SENSE                           15456018
REWIND   EQU   X'07'                    REWIND                          15458018
READBACK EQU   X'0C'                    READBACK                        15460018
UNLOAD   EQU   X'0F'                    REWIND AND UNLOAD               15462018
WTM      EQU   X'1F'                    WRITE TAPE MARK                 15464018
BSFOP    EQU   X'2F'                    BACKWARD SPACE FILE             15466018
FSFOP    EQU   X'3F'                    FORWARD SPACE FILE              15468018
SEARCH   EQU   X'31'                    SEARCH                          15470018
SRCHCNT  EQU   X'05'                    COUNT FOR SEARCH ID             15472018
TIC      EQU   X'08'                    TIC                             15474018
READDA   EQU   X'06'                    READ FOR DA                     15476018
LENJFCB  EQU   X'B0'                    LENGTH OF JFCB                  15478018
LBLLEN   EQU   X'50'                    LENGTH OF LABEL                 15480018
PERMERR  EQU   X'7F'                    PERMANENT ERROR                 15482018
ERR092   EQU   92                       ERROR IN PO PROCESSING@ZSUT222  15484037
ERR096   EQU   96                       ERROR IN DELETING     @ZSUT222  15487037
*                                       MEMBER FROM DIRECTORY           15490037
D1       EQU   1                        CONSTANT ONE            Y02076  15498002
D2       EQU   2                        CONSTANT TWO            Y02076  15498402
D3       EQU   3                        CONSTANT THREE          Y02076  15498802
D4       EQU   4                        CONSTANT FOUR           Y02076  15499602
D8       EQU   8                        CONSTANT EIGHT          Y02076  15499702
D24      EQU   24                       CONSTANT TWENTY FOUR    Y02076  15499902
D32      EQU   32                       CONSTANT THIRTY TWO     Y02076  15533202
*                                                                       15566702
*      MASKS USED TO MAKE TESTS                                         15600018
*                                                                       15700018
OUT      EQU   X'0F'                                                    15800018
DEBID    EQU   X'0F'                    DEB IDENTIFICATION              15830018
TCAMID1  EQU   X'C0'                    UNIQUE TCAM DEB CODE     M3408  15840020
TCAMID2  EQU   X'CF'                    UNIQUE TCAM DEB CODE     M3408  15850020
MAXEXT   EQU   X'CA'                    MAXIMUM NO. OF EXTENT           15860018
UNRELCC  EQU   X'42'                    UNRELATED FLAG, COMMAND CHAIN   15890018
UNITEX   EQU   X'01'                    UNIT EXCEPTION                  15920018
NORECORD EQU   X'08'                    NO RECORD FOUND                 15950018
NEXTTRK  EQU   X'00'                    NEXT TRACK, R=0                 15980018
NTPRGD   EQU   X'FF'                    NO PURGED                       16010018
X80      EQU   X'80'                    EPCB KEY TEST MASK       YM7075 16060002
*                                                                       16100018
*********************************************************************   16200018
*                                                                       16300018
         BALR  BASER,0                  ESTABLISH ADDRESSIBILITY        16400018
         USING *,BASER                                                  16500018
         B     BEGIN                    BRANCH AROUND EYECATCHER        16550000
         CNOP  0,8                      ALIGN TO A DOUBLEWORD BOUNDARY  16560000
         DC    CL8'IGC0T05B'            MODULE NAME            @ZSUT222 16570037
         DC    CL8'&SYSDATE'            LAST DATE SHIPPED      @ZSUT222 16572037
         DC    CL8'@ZSUT222'            LAST CODE SHIPPED      @ZSUT222 16574037
BEGIN    EQU   *                                                        16580000
*                                                                       16600018
         USING IHADCB,DCBR                                              16700018
         USING DEBBASIC,DEBR                                     Y02076 16800002
         USING UCBOB,UCBR                                               16900018
         USING TCB,TCBR                                                 17000018
         USING TABL,CTABLR                                              17100018
         USING CVTMAP,WRKR2                                      Y02076 17200002
         USING RSDSECT,WRKR4                                            17300018
         USING RSTWA,BUFR                                               17400018
*                                                                       17500018
REPDCB00 EQU   *                                                        17600018
         L     TCBR,RSTCBAD             GET TCB ADDRESS          YM3441 17650002
         L     DEBR,RSINT               GET 1ST DEB ADDR         YM3441 17660002
         ST    DEBR,TCBDEB              SETUP TCB DEB CHAIN      YM3441 17670002
REPDEBCK EQU   *                        DEB CHECK LOOP           YM5318 17680002
         L     DCBR,DEBDCBAD            GET DCB ADDR             YM5318 17690002
         SH    DEBR,THREE               POINT TO AM TYPE         YM5318 17692002
         IC    WRKR3,0(DEBR)            LOAD AM TYPE             YM5318 17694002
         XC    0(3,DEBR),0(DEBR)        CLEAR OLD DEBCHK DATA    YM5722 17694402
         DEBCHK (DCBR),TYPE=ADD,AM=((WRKR3))                     YM5318 17696002
         L     DEBR,4(WRKR2)            GET NEXT DEB ADR         YM5318 17698402
         LA    DEBR,0(DEBR)             CLEAR HI ORDER BYTE      YM5318 17698802
         LTR   DEBR,DEBR                END OF DEB CHAIN         YM5318 17699202
         BNZ   REPDEBCK                 BRANCH IF MORE DEBS      YM5318 17699602
*                                                                       17700018
         LR    CTABLR,TABLR             INITIALIZE D.S. ENTRY LIST      17800018
         L     WRKR4,TABSEGAD-1         GET FIRST SEGMENT ADDRESS       17850018
*                                                                       17900018
REPDCB02 EQU   *                                                        18000018
         L     DCBR,TABDCBAD-1          GET DCB ADDRESS                 18200018
         L     DEBR,DCBDEBAD            GET DEB ADDRESS                 18300018
         LA    DEBR,0(DEBR)             HI BYTE CLEARED                 18400018
         XC    RSERAS00,RSERAS00        ZERO SCRATCH WORD        Y02076 18490402
         LR    TIOTR,DEBR               ESTABLISH ADDRESSABILITY Y02076 18492002
         LA    TIOTR,D32(TIOTR)             TO DEB DEV DEP SECT  Y02076 18494002
         USING DEBDASD,TIOTR                                     Y02076 18496002
         L     UCBR,DEBUCBAD            GET USER UCB ADDRESS            18500018
*                                                                       18600018
         TM    TABDSORG,PO              DATA SET PARTITIONED            18700018
         BZ    REPDCB20                 NO BRANCH - NEXT ENTRY          18800018
*                                                                       18900018
*                                                                       19000018
         TM    DEBOPATB,OUT             D.S. PROCESSED IN OUTPUT MODE   19100018
         BZ    REPDCB20                 NO BRANCH - NEXT ENTRY          19200018
*                                                                       19300018
*********************************************************************   19400018
*                                                                       19500018
*      AT THIS POINT THE DATA SET DIRECTORY MUST BE READ TO DETERMINE   19600018
*      IF MEMBERS WERE ADDED AFTER THE CHECKPOINT WAS TAKEN ....        19700018
*                                                                       19800018
*      THIS WILL BE DONE BY READING A DIRECTORY BLOCK, EXAMINING THE    19900018
*      ENTRIES FOR A TTR (INDICATING THE BEGINNING OF WHERE THE MEMBER  20000018
*      PHYSICALLY RESIDES IN THE DATA SET), GREATER THAN THE TTR OF THE 20100018
*      MEMBER CURRENTLY BEING WRITTEN. IF ONE IS FOUND, THE MEMBER NAME 20200018
*      ASSOCIATED WITH THE TTR WILL BE USED TO DELETE THE MEMBER FROM   20300018
*      THE DIRECTORY VIA THE STOW MACRO.                                20400018
*                                                                       20500018
*      THIS PROCEDURE WILL BE CARRIED OUT FOR THE ENTIRE DATA SET       20600018
*      DIRECTORY ....                                                   20700018
*                                                                       20800018
*********************************************************************   20900018
*                                                                       21000018
REPDCB04 EQU   *                                                        21100018
*                                                                       21200018
REPDCB06 EQU   *                                                        21300018
*                                                                       21400018
*********************************************************************** 21500018
*                                                                       21600018
*     CONSTRUCT THE CONTROL BLOCKS NECESSARY TO READ DIRECTORY BLOCKS   21700018
*                                                                       21800018
*    FIRST 48 BYTES CONSIST OF SYSTEM DEB - WILL BE USED TO REFERENCE   21900018
*    ALL ALLOCATED DEVICES USED BY RESTARTED TASK ..                    22000018
*                                                                       22100018
*********************************************************************** 22200018
*                                                                       22300018
REPDCB08 EQU   *                                                        22400018
*                                                                       22500018
         L     WRKR2,CVTPTR             GET COMMUNICATION VECTOR TABLE  22600018
         LA    WRKR1,RSDCBREP           GET ADDRESS OF RESTART DCB      23000018
         ST    WRKR1,RSDEBDCB           STORE IN RESTART DEB            23100018
         ST    WRKR1,RSIOBDCB           STORE IN RESTART IOB            23200018
         MVI   RSDEBID,DEBID            STORE IDENTIFICATION FOR DEB    23300018
         ST    UCBR,RSDEBUCB            SAVE USER UCB ADDRESS IN DEB    23400018
*                                                                       23410021
* SET DEB EXTENTS TO COVER ENTIRE VOLUME--FROM CCHH=0 TO                23420021
* CCHH= HIGHEST POSSIBLE FOR THE DEVICE TYPE.                           23430021
*                                                                       23440021
         L     WRKR1,CVTXAPG            GET ADR OF APP VECT TBL  Y02076 23452002
         ST    WRKR1,RSDEBAPP           STORE IN DEB             Y02076 23454002
         L     WRKR2,CVTZDTAB           ADR OF DEVICE            Y02076 23456002
*                                       CHARACTERISTICS TABLE           23460021
         DROP   WRKR2                                            M0187  23470021
         IC    WRKR3,UCBTBYT4           GET CLASS INDEX FROM UCB M0187  23480021
         N     WRKR3,MASK1              LO-ORDER 4 BITS          M0187  23490021
         IC    WRKR3,0(WRKR2,WRKR3)     DEVTAB INDEX, THIS       M0187  23500021
*                                       DEVTYPE                  M0187  23510021
         AR    WRKR2,WRKR3              POINT TO DEVTYPE ENTRY   M0187  23520021
         XC    RSDEBSCC(8),RSDEBSCC     CLEAR DEB EXTENTS        M0187  23530021
         MVC   RSDEBECC,0(WRKR2)        SET HI CC AS HIGHEST ON  M0187  23540021
*                                       VOLUME                   M0187  23550021
         MVC   RSDEBNTR(2),MAXTRKNO     STORE MAXIMUM NUMBER OF TRACKS  23700018
         MVI   RSDEBUSR,NMEXTS1         SET NO. OF EXTS = 1      Y02076 23750002
         MVI   RSDEBAPP,EXSCLS1         SET EXTENT SCALE = 4     Y02076 23760002
         MVI   RSDEBMOD,DVMODS1         SET FILE MASK = C0       Y02076 23770002
         MVC   RSDEBBIN(D2),BINUMS1     SET BIN NO. = 0000       Y02076 23780002
*                                                                       23800018
*********************************************************************** 23900018
*                                                                       24000018
*    THE NEXT FOUR BYTES WILL BE USED FOR THE DCB (S) DEB ADDRESS       24100018
*                                                                       24200018
         LA    WRKR1,RSDEB              GET DEB ADDRESS                 24300018
         ST    WRKR1,RSDCBDEB           STORE IN RESTART DCB            24400018
*                                                                       24500018
*    THE NEXT FOUR BYTES WILL BE USED FOR AN ECB                        24600018
*                                                                       24700018
         MVI   RSIOBFG1,UNRELCC         SET UNRELATED FLAG IN IOB       24800018
         LA    WRKR1,RSECBAD            GET ECB FOR IOB                 24900018
         ST    WRKR1,RSIOBECB           STORE ECBAD IN IOB              25000018
*                                                                       25100018
*    THE 40 BYTE SYSTEM IOB WILL BE NEXT IN BUFFER SEGMENT              25200018
*                                                                       25300018
         LA    WRKR1,RSCCWLST           GET CHANNEL PROGRAM ADDR.       25400018
         ST    WRKR1,RSIOBCPA           STORE ADDRESS IN IOB            25500018
         XC    RSIOBDAD(8),RSIOBDAD     CLEAR D A ADDRESS FIELD         25600018
         MVC   RSIOBDAD+1(6),DEBBINUM   STARTING SEARCH ARGUMENT        25700018
*                                                                       25800018
*    THE 24 BYTE CHANNEL PROGRAM WILL FOLLOW. SRCH - TIC - READ.        25900018
*                                                                       26000018
         XC    RSCCW1(24),RSCCW1        CLEAR  READ CCW                 26100018
         LA    WRKR1,RSIOBDAD+3         GET ADDRESS OF SRCH ARGUMENT    26200018
         ST    WRKR1,RSCCW1             STORE IN SRCH CCW               26300018
         LA    WRKR1,RSCCW1             GET ADDRESS OF SRCH CCW         26400018
         ST    WRKR1,RSCCW2             STORE IN TIC CCW                26500018
         LA    WRKR1,RSBUFSEG           GET BUFFER SEGMENT TO READ INTO 26600018
         ST    WRKR1,RSCCW3             STORE IN READ CCW               26700018
         OC    RSCCWLST,CCWLIST         CONSTANTS IN THE CHANNEL PROGRM 26800018
*                                                                       26900018
REPDCB10 EQU   *                                                        27000018
*                                                                       27100018
*********************************************************************** 27200018
*                                                                       27300018
*      AT THIS POINT ALL CONTROL BLOCKS HAVE BEEN ESTABLISHED           27400018
*                                                                       27500018
*********************************************************************** 27600018
*                                                                       27700018
         L     DCBR,TABDCBAD-1          REFRESH USER DCB ADDRESS        27800018
         MVC   RSERAS01(8),RSIOBDAD     SAVE 1ST DIR BLK ADDR    YM7360 27850002
REPDCB11 EQU   *                        RETRY LOOP ENTRY         YM7360 27860002
         NI    RSERAS00,X'FF'-STOWSW    RESET STOW-DELETE SW     YM7360 27870002
*                                                                       27900018
REPDCB12 EQU   *                                                        28000018
*                                                                       28100018
*********************************************************************** 28200018
*                                                                       28300018
*      SETUP READ-WAIT SUBROUTINE TO BRING DIRECTORY BLOCK INTO BUFFER  28400018
*                                                                       28500018
*********************************************************************** 28600018
*                                                                       28700018
         SR    TIOTR,TIOTR              INITIALIZE TO ZERO              28800018
         IC    TIOTR,RSIOBDAD+7         GET CURRENT R VALUE             28900018
         LA    TIOTR,1(TIOTR)           INCREMENT R BY ONE              29000018
         STC   TIOTR,RSIOBDAD+7         SAVE R IN SEARCH ARGUMENT       29100018
         LA    WRKR3,RSBUFSEG           POINT TO BEGINNING OF BUFFER    29200018
*                                                                       29300018
*********************************************************************** 29400018
*                                                                       29500018
         EXCP  RSIOB                    READ DIRECTORY BLOCK            29600018
*                                                                       29700018
*********************************************************************   29800018
*                                                                       29900018
         WAIT  ECB=RSECBAD              WAIT FOR RECORD TO COME IN      30000018
*                                                                       30100018
*********************************************************************** 30200018
*                                                                       30300018
         TM    RSECBAD,PERMERR          ERRORS ASSOCIATED WITH REQUEST  30400018
         BO    REPDCB13                 NO BRANCH                       30500018
*                                                                       30600018
         TM    RSIOBCSW+4,UNITEX        UNIT EXCEPTION ON IN CSW =FM    30700018
         BO    REPDCB20                 YES BRANCH NEXT ENTRY           30800018
*                                                                       30900018
         TM    RSIOBSN2,NORECORD        NO RECORD FOUND                 31000018
         BO    REPDCB18                 YES BRANCH TO NEXT TRACK        31100018
*                                                                       31200018
         B     REPDCB90                 SET UP ERROR RETURN CODE        31300018
*                                                                       31400018
REPDCB13 EQU   *                                                        31500018
*                                                                       31600018
         LH    WRKR2,0(WRKR3)           GET LEN OF USED DIR. BLOCK      31700018
         LA    TCBR,0(WRKR2,WRKR3)      POINT TO END OF BLOCK           31800018
         LA    WRKR3,2(WRKR3)           SLIP PAST LEN FIELD             31900018
*                                                                       32000018
*********************************************************************** 32100018
*                                                                       32200018
REPDCB14 EQU   *                                                        32300018
*                                                                       32400018
*      PROCESS DIRECTORY BLOCK - DETERMINE IF MEMBERS WERE ADDED        32500018
*                                                                       32600018
*                                                                       32607018
* DO NOT DELETE CHECKPOINT MEMBER THAT IS BEING USED FOR RESTART        32614018
*                                                                       32621018
*                                                                       32628018
         LA    DCBR,0(,DCBR)            CLEAR HI-ORDER BYTE      A27809 32631019
         CLC   DIREND,0(WRKR3)          Q-END OF DIRECTORY NAMES YM7822 32633002
         BE    REPDCB20                 IF END, GO GET NEXT D/S  YM7822 32633802
         C     DCBR,RSCKDCB             IS CURRENT DCB CHECKPOINT DCB   32635018
         BNE   REPDCB15                 BRANCH IF NO                    32642018
         CLC   DCBRELAD(3),8(WRKR3)     CURRENT TTR IN DCB = TTR IN     32649018
*                                           DIRECTORY                   32656018
         BE    REPDCB16                 BRANCH IF YES                   32663018
*                                                                       32670018
REPDCB15 EQU   *                                                        32677018
*                                                                       32684018
         CLC   DCBRELAD(3),8(WRKR3)     CURR TTR IN DCB GREATER THAN    32700018
*                                       EXISTING MEMBERS TTR IN DIR.    32800018
         BH    REPDCB16                 YES BRANCH                      32900018
*                                                                       33000018
*      MEMBER WAS ADDED AFTER CHECKPOINT ENTRY TAKEN - MUST DELETE      33100018
*                                                                       33200018
         MVC   TABNVOLS(12),0(WRKR3)    SETUP FOR DELETE FUNCTION       33300018
*                                                                       33400018
*********************************************************************   33500018
*                                                                YM7360 33550002
         OI    RSERAS00,STOWSW          SET STOW-DELETE SW       YM7360 33560002
*                                                                       33600018
         STOW  (DCBR),TABNVOLS,D        DELETE MEMBER NAME FROM DIR.    33700018
*********************************************************************** 33710002
*        DCBCNSTO WILL BE RESET AFTER THE STOW DELETE.  IF THE DCB IS * 33712002
*        OPEN FOR PS FOR OUTPUT WITH A MEMBER NAME SPECIFIED, STOW    * 33714002
*        WILL NOT BE ISSUED AT CLOSE TIME IF THE USER HAS ISSUED A    * 33716002
*        STOW; HENCE DCBCNSTO IS RESET SO THAT CLOSE WILL NOT THINK   * 33718002
*        THAT A STOW WAS ISSUED.                                      * 33718402
*********************************************************************** 33720002
         NI    DCBCIND2,X'FF'-DCBCNSTO  RESET STOW ISSUED        YM7553 33770002
*********************************************************************** 33900018
*                                                                       34000018
         LTR   WRKR6,WRKR6              ERRORS OCCUR DURING STOW        34100018
         BNZ   REPDCB80                 YES BRANCH TO SET ERR CODE      34200018
*                                                                       34300018
*********************************************************************** 34400018
*                                                                       34500018
REPDCB16 EQU   *                                                        34600018
*                                                                       34700018
         IC    TIOTR,11(WRKR3)          GET ENTRY LENGTH                34800018
         SLL   TIOTR,28                 MULTIPLY LAST FOUR BITS         34900018
         SRL   TIOTR,27                 BY TWO TO GIVE BYTE LENGTH      35000018
         LA    WRKR3,12(TIOTR,WRKR3)    POINT TO NEXT POSSIBLE ENTRY    35100018
*                                                                       35200018
         CR    WRKR3,TCBR               AT END OF DIRECTORY BLOCK       35300018
         BL    REPDCB14                 NO BRANCH - NEXT ENTRY          35400018
*                                                                       35500018
         TM    RSERAS00,STOWSW          DID STOW-DELETE OCCUR    YM7360 35550002
         BZ    REPDCB12                 IF NOT, GO READ NEXT BLK YM7360 35560002
         MVC   RSIOBDAD(8),RSERAS01     RESET TO 1ST DIR BLK     YM7360 35570002
         B     REPDCB11                 GO START AGAIN,DIRECTORY YM7360 35580002
*                                       COMPRESSION MAY HAVE     YM7360 35590002
*                                       MOVED THE NEXT ENTRIES   YM7360 35594002
*                                       INTO BLOCKS PREVIOUSLY   YM7360 35596002
*                                       READ.                    YM7360 35598002
*                                                                       35700018
*********************************************************************** 35800018
*                                                                       35900018
*      SET UP TO ADJUST DIRECT ACCESS ADDRESS FOR NEXT TRACK. TO KEEP   36000018
*      DEVICE INDEPENDANT, ROUTINE WILL USE RESIDENT CONVERT ROUTINES.  36100018
*                                                                       36200018
*********************************************************************** 36300018
*                                                                       36400018
REPDCB18 EQU   *                                                        36500018
*                                                                       36600018
         MVI   RSIOBDAD+7,NEXTTRK       SET R=0, NEXT TRACK             36700018
*                                                                       36800018
         L     UCBR,CVTPTR              ADDRESS OF CVT                  36900018
         LA    DSCNTR,RSBUFSEG          ADDRESS OF TEMP SAVE AREA       37000018
         STM   WRKR1,WRKR6,0(DSCNTR)    SAVE ALL REGISTERS              37100018
         LR    TIOTR,DSCNTR             SAVE CONTENTS                   37200018
*                                                                       37300018
*      PREPARE TO CONVERT MBBCCHHR TO TTR VIA RESIDENT CONVERT RT.      37400018
*                                                                       37500018
         LR    WRKR2,DEBR               ADDRESS OF DEB - REG.1          37600018
         LA    DCBR,RSIOBDAD            ADDRESS OF MBB - REG.2          37700018
*                                                                       37800018
         L     WRKR6,CVTPRLTV-CVTMAP(UCBR) RT. TO CNVRT TO TTRN  Y02076 37900002
         BALR  WRKR5,WRKR6              TO ROUTINE                      38000018
*                                                                       38100018
         SRL   WRKR1,16                 RIGHT JUSTIFY TT                38200018
         LA    DSCNTR,1                 CONSTANT OF ONE                 38300018
         AR    WRKR1,DSCNTR             ADD TO TT                       38400018
         SLL   WRKR1,16                 LEFT JUSTIFY TT, R=0, N=0       38500018
*                                                                       38600018
         L     WRKR6,CVTPCNVT-CVTMAP(UCBR) RT- CNVRT TO MBBCCHHR Y02076 38700002
         BALR  WRKR5,WRKR6              TO ROUTINE                      38800018
*                                                                       38900018
         LTR   WRKR6,WRKR6              ERRORS IN CONVERTING            39000018
*                                                                       39100018
         LR    DSCNTR,TIOTR             RESTORE CONTENTS                39200018
         LM    WRKR1,WRKR6,0(DSCNTR)    RESTORE ALL REGISTERS           39300018
*                                                                       39400018
         BZ    REPDCB12                 NO BRANCH                       39500018
*                                                                       39600018
         B     REPDCB90                 TO ERROR RETURN                 39700018
*                                                                       39800018
*********************************************************************** 39900018
*                                                                       40000018
REPDCB20 EQU   *                                                        40100018
*                                                                       40200018
         TM    TABFLG1,TABLAST          WAS THIS LAST ENTRY IN TABLE    40300002
         BO    REPDCB22                 YES BRANCH                      40400018
*                                                                       40500018
         LA    CTABLR,TABENT(CTABLR)    TO NEXT ENTRY                   40600018
         B     REPDCB02                 RELOOP                          40700018
*                                                                       40800018
REPDCB22 EQU   *                                                        40900018
*                                                                       41000018
*********************************************************************** 41100018
*                                                                       41200018
*      RESTORE ALL I/O REQUESTS TO CHANNEL QUEUES VIA RESTORE MACRO     41300018
*                                                                       41400018
*********************************************************************** 41500018
*                                                                       41600018
         L     DEBR,RSINT               GET 1ST DEB ADDR         A28676 41760019
*                                                                       41900018
REPDCB24 EQU   *                                                        42000018
*                                                                       42100018
         LTR   DEBR,DEBR                END OF DEB CHAIN                42200018
         BZ    REPDCB94                 YES BRANCH                      42300018
         CLI   DEBNMSUB,TCAMID1         Q - TCAM DEB (TYPE 1)    M3408  42320020
         BE    REPDCB28                 IF YES, SKIP THIS DEB    M3408  42340020
         CLI   DEBNMSUB,TCAMID2         Q - TCAM DEB (TYPE 2)    M3408  42360020
         BE    REPDCB28                 IF YES, SKIP THIS DEB    M3408  42380020
*                                                                       42400018
         LR    WRKR2,DEBR               GET ADR OF DEB           Y02076 42450002
         LA    WRKR5,DEBPRFLN           GET LNGTH OF DEB PREFIX  Y02076 42500002
         SR    WRKR2,WRKR5              CALC ADR OF PREFIX       Y02076 42550002
         USING DEBPREFX,WRKR2           ADDRESS DEB PREFIX       Y02076 42600002
         CLI   DEBAMTYP,SUBSYSDS        TEST FOR SS DATASET'X81' Y02076 42650002
         BNE   REPDCB25                 BR IF NOT SUBSYS         Y02076 42660002
         TM    DEBFLGS1,DEBCINDI        TEST IF CI BIT IS ON     Y02076 42670002
         BO    REPDCB28                 BR OVER RESTORE IF YES   Y02076 42680002
*                                                                       42700018
REPDCB25 EQU   *                        INSTR MUST FOLLOW        Y02076 42750002
         L     WRKR2,DEBUSRPG           GET ADDRESS OF POSSIBLE IOB     42800018
         LA    WRKR2,0(WRKR2)           HI BYTE CLEARED                 42900018
         LTR   WRKR2,WRKR2              VALID ADDRESS PRESENT           43000018
         BZ    REPDCB28                 NO BRANCH                       43100018
*                                                                       43200018
REPDCB26 EQU   *                                                        43300018
         CLC   DEBUSRPG+D1(D3),NOPRGIND WERE I/O REQUESTS PRGD   Y02076 43350002
         BE    REPDCB28                 BR OVER RESTORE IF 'FFF  Y02076 43360002
         MVI   0(WRKR2),OPTBYTE         SET OPTION BYT FOR REST  Y02076 43370002
         L     WRKR3,D24(,WRKR2)        GET PTR - TOP REST LST @ZA03659 43380037
         USING EPCB,WRKR3               MOVE USERS TCB TO LIST   Y02076 43392002
REPDC26A EQU   *                        INSTR MUST FOLLOW        Y02076 43394002
         L     WRKR5,EPCBCHN            GET CHAIN PTR NEXT SET   Y02076 43396002
         MVC   EPCBRTCB,RSTCBAD         UPDATE HDR TCB ADDR      YM7880 43398002
         LA    WRKR3,EPCBIOB-EPCB(,WRKR3) INDEX TO 1ST ENTRY     YM7880 43398402
REPDCB27 EQU   *                        INSTR MUST FOLLOW        Y02076 43398802
         OC    0(D4,WRKR3),0(WRKR3)     TEST IF END OF SET       Y02076 43399202
         BZ    REPDC27A                 BRANCH IF END OF SET     Y02076 43399602
         USING EPCBIOB,WRKR3            ADDRESS. TO ENTRY        Y02076 43399702
         L     TCBR,RSTCBAD             GET ADR OF TCB           Y02076 43399802
         TM    EPCBPKEY,X80             IS KEY 8 OR GREATER      YM7075 43403502
         BNO   REPKYLT8                 IF NOT, SKIP KEY UPDATE  YM7075 43405502
         MVC   EPCBPKEY,TCBPKF          PROTECT KEY INTO ENTRY   Y02076 43407302
REPKYLT8 EQU   *                        BYPASS KEY UPDATE ENTRY  YM7075 43407702
         OC    EPCBTCB,EPCBTCB          IS A TCB ADDR PRESENT    YM7075 43409302
         BZ    REPNOTCB                 IF NOT,SKIP TCB UPDATE   YM7075 43409702
         MVC   EPCBTCB,RSTCBAD          MVE USER TCB ADR TO NTRY Y02076 43411002
REPNOTCB EQU   *                        BYPASS TCB UPDATE ENTRY  YM7075 43413002
         LA    WRKR3,EPCBENTL(WRKR3)    INDEX TO NXT ENTRY     @ZA03659 43421037
         B     REPDCB27                 GO PROCESS NEXT ENTRY    Y02076 43422102
REPDC27A EQU   *                        INSTR MUST FOLLOW        Y02076 43433202
         LTR   WRKR5,WRKR5              Q-END OF ENTIRE REST LST Y02076 43443202
         BZ    REPDC27B                 BRANCH IF END            Y02076 43453202
         LR    WRKR3,WRKR5              SET WRKR3 TO ADR NEXT ST Y02076 43463202
         B     REPDC26A                 GO PROCESS NEXT SET      Y02076 43465202
REPDC27B EQU   *                        INSTR MUST FOLLOW        Y02076 43465602
*                                                                       43466702
*********************************************************************   43500018
*                                                                       43600018
         RESTORE DEBUSRPG               RESTORE DEBS I/O REQUESTS       43700018
*                                                                       43800018
*********************************************************************** 43900018
*                                                                       44000018
REPDCB28 EQU   *                                                        44100018
*                                                                       44200018
         L     DEBR,DEBDEBAD            GET NEXT POSSIBLE DEB           44300018
         LA    DEBR,0(DEBR)             HI BYTE CLEARED                 44400018
         B     REPDCB24                 REPEAT TESTS                    44500018
*                                                                       44600018
REPDCB30 EQU   *                                                        44700018
*                                                                       44800018
*                                                                       44900018
REPDCB40 EQU   *                                                        45000018
*                                                                       45100018
REPDCB50 EQU   *                                                        45200018
*                                                                       45300018
REPDCB60 EQU   *                                                        45400018
*                                                                       45500018
REPDCB70 EQU   *                                                        45600018
*                                                                       45700018
REPDCB80 EQU   *                                                        45800018
*                                                                       45900018
         MVI   RSRETCOD+1,ERR096        ERROR IN DELETING      @ZSUT222 46000037
*                                       MEMBER FROM DIRECTORY           46050037
         B     REPDCBER                 SET UP FOR XCTL        @ZSUT222 46200037
*                                                                       46300018
REPDCB90 EQU   *                                                        46400018
*                                                                       46500018
*     MUST TERMINATE REPI/O DUE TO UNRECOVERABLE ERRORS IN PROCESSING   46600018
*                                                                       46700018
         MVI   RSRETCOD+1,ERR092        ERROR IN PO PROCESSING @ZSUT222 46800037
REPDCBER EQU   *                                               @ZSUT222 46820037
         MVC   RSREGSAV(8),MODID        SAVE NAME OF MODULE    @ZSUT222 46840037
*                                       DETECTING ERROR.       @ZSUT222 46860037
         STM   0,15,RSREGSAV+8          SAVE CURRENT REGISTERS @ZSUT222 46880037
*                                                                       46900018
REPDCB94 EQU   *                                                        47000018
*                                                                       47100018
*********************************************************************** 47150037
*                                                                     * 47160037
*      IF A VSAM VAT EXISTS, BALR TO VSAM RESTART ROUTINE - IDA0A05B. * 47250037
*                                                                     * 47300037
*********************************************************************** 47400018
*                                                                       47500018
         L     TCBR,RSTCBAD             GET TCB ADDRESS        @OZ03934 47550037
         L     WRKR6,TCBJSCB            GET JSCB ADDRESS       @OZ03934 47560037
         USING IEZJSCB,WRKR6            ADDRESSIBILITY TO JSCB @OZ03934 47562037
         L     WRKR5,JSCBSHR            LOAD POINTER TO VAT    @OZ03934 47564037
         LTR   WRKR5,WRKR5              IS THE POINTER NULL    @OZ03934 47566037
         BZ    REPDCBX0                 YES, BR TO VS RESTART  @OZ03934 47570037
         CLC   JSCBSHR(D1),JSCBSTEP     CORRECT STEP NUMBER    @OZ03934 47620037
         BNE   REPDCBX0                 NO, BR TO VS RESTART   @OZ03934 47630037
REPDCBX4 MVC   RSJFCB(D8),RSMODAM0      VSAM PHASE OF RESTART    Y02076 47633202
         LOAD  EPLOC=RSJFCB             LOAD VSAM RESTART MOD  @Z30SSDT 47643237
         LR    WRKR6,WRKR1              ENTRY POINT IN REG 15  @Z30SSDT 47653237
         LR    WRKR3,WRKR4              SAVE BASE FOR RSDSECT  @Z30SSDT 47655237
         LA    WRKR4,RSREGSAV           PT REG 13 TO SAVEAREA  @Z30SSDT 47663237
         LR    WRKR2,BUFR               POINT REG 1 TO RST W/A @Z30SSDT 47663637
         BALR  WRKR5,WRKR6              CALL VSAM RESTART RTN  @Z30SSDT 47665237
         LR    WRKR4,WRKR3              LOAD BASE FOR RSDSECT  @Z30SSDT 47665337
         DELETE EPLOC=RSJFCB            DELETE VSAM RESTART    @Z30SSDT 47665637
*                                                                       47669437
*********************************************************************   47673437
*                                                                       47677237
*      SET UP FOR XCTL TO LAST PHASE OF RESTART FUNCTION                47681037
*                                                                       47684837
*********************************************************************   47688637
*                                                                       47692437
REPDCBX0 MVC   RSJFCB(8),RSTMODNM       NEXT PHASE OF RESTART           47696237
REPDCBX8 LA    WRKR6,RSJFCB+8           SETUP FOR XCTL MACRO            47700002
         LR    WRKR2,BUFR               POINT REG 1 TO THE RESTART W/A  47740018
         XCTL  EPLOC=RSJFCB,SF=(E,(15))                                 48400018
*                                                                       48500018
*********************************************************************   48600018
*                                                                       48700018
*********************************************************************** 48800018
*                                                                       48900018
*     CONSTANTS USED IN REPI/O                                          49000018
*                                                                       49100018
*********************************************************************** 49200018
*                                                                       49300018
THREE    DC    H'3'                     OFFSET TO AMTYP          Y02076 49350002
MAXTRKNO DC    X'7FFF'                  MAX. NO. OF TRACKS              49400018
MASK1    DC    F'15'                    MASK OF LO-ORDER 4 BITS  M0187  49450021
*                                                                       49500018
RSTMODNM DC    C'IGC0V05B'              RESTART EXIT MOD                49600018
RSMODAM0 DC    C'IDA0A05B'              VSAM RESTART MODULE    @Z30SSDT 49650037
MODID    DC    CL8'IGC0T05B'            MODULE ID              @ZSUT222 49651037
DIREND   DS    0XL8                     PDS DIRECTORY END NAME   YM7822 49652002
         DC    X'FFFFFFFFFF'            1ST 5 BYTES OF 'DIREND'  YM7822 49654002
NOPRGIND DC    X'FFFFFF'                NO PURGE IND (3 BYTES)   YM7822 49660002
BINUMS1  DC    XL2'0000'                BIN NUMBER = 0000        Y02076 49662002
NMEXTS1  EQU   X'01'                    NO. OF EXTENTS           Y02076 49664002
EXSCLS1  EQU   X'04'                    DEB EXT SCALE            Y02076 49666002
DVMODS1  EQU   X'C0'                    FILE MASK                Y02076 49668002
OPTBYTE  EQU   X'C0'                    RESTORE LIST OPTION BYTE Y02076 49670002
STOWSW   EQU   X'80'                    STOW-DELETE PROCESS SW   YM7360 49672002
DEBPRFLN EQU   16                       LENGTH OF DEB PREFIX     Y02076 49680002
SUBSYSDS EQU   X'81'                    SUBSYSTEM INDICATOR      Y02076 49690002
*                                                                       49700018
*********************************************************************** 49800018
*                                                                       49900018
*     CHANNEL PROGRAM USED BY REPI/O                                    50000018
*                                                                       50100018
*********************************************************************** 50200018
*                                                                       50300018
CCWLIST  DC    X'3100000040000005'      SRCH ID EQUAL , 5 BYTES CCHHR   50400018
         DC    X'080000'                TIC                             50500018
ZERO     DC    X'0000000000'            ZERO                            50600018
         DC    X'0600000000000100'      READ DATA,256 BYTES DIRECTORY   50700018
*                                                                     * 50750000
*        MAINTENANCE SPACE                                            * 50760000
*                                                                     * 50770000
PATCH    DC    XL((*-IGC0T05B)/20)'00'   FIVE PERCENT MAINTENANCE SPACE 50780000
*                                                                     * 50790000
         IECDEPCB                                                Y02076 50792002
         EJECT                                                          50800018
         IEEVRSWA VER=3                AOS2 VERSION OF WA               50950000
         EJECT                                                          51000018
RSDSECT  DSECT                                                          51100018
*                                                                       51200018
*    DATA EXTENT BLOCK                                                  51300018
*                                                                       51400018
RSDEB    DS    0CL48                                                    51500018
RSDEBTCB DC    X'00000000'              TCB ADDRESS                     51600018
RSDEBDEB DC    X'00000000'              DEB ADDRESS                     51700018
*                                                                       51800018
*    DATA CONTROL BLOCK                                                 51900018
*                                                                       52000018
RSDEBOFL DS    0CL1                                                     52100018
RSDEBIRB DC    X'00000000'              IRB ADDRESS                     52200018
RSDEBSYS DC    X'00000000'              1ST IOB ADDR IN SYS.PURGE CHAIN 52300018
RSDEBUSR DC    X'00000000'              1ST IOB ADDR IN USER PRGE CHAIN 52400018
RSDEBECB DC    X'00000000'              PARM.LIST ADDR TO PURGE ECB     52500018
RSDEBID  DS    0CL1                                                     52600018
RSDEBDCB DC    AL4(RSDCBREP)            DCB ADDR                        52700018
RSDEBAPP DS    CL4                      I/O APPENDAGE VECTOR TABLE      52800018
RSDEBMOD DS    0CL1                                                     52900018
RSDEBUCB DS    F                        UCB ADDRESS                     53000018
RSDEBBIN DS    H                        BIN NUMBER                      53100018
RSDEBSCC DS    H                        CYLINDER START ADDRESS          53200018
RSDEBSHH DS    H                        TRACK START ADDRESS             53300018
RSDEBECC DS    H                        CYLINDER END ADDRESS            53400018
RSDEBEHH DS    H                        TRACK END ADDRESS               53500018
RSDEBNTR DS    H                        NO. OF TRACKS IN THIS EXTENT    53600018
*                                                                       53700018
*    EVENT CONTROL BLOCK                                                53800018
*                                                                       53900018
RSECBAD  DS    CL4                      ECB ADDRESS                     54000018
RSDCBDEB DC    AL4(RSDEB)               DEB ADDRESS                     54100018
*                                                                       54200018
RSDCBREP EQU   RSDEB+8                  POINT TO RELATIVE BEGINNING DCB 54300018
*                                                                       54400018
*    INPUT OUTPUT BLOCK                                                 54500018
*                                                                       54600018
RSIOB    DS    0CL40                                                    54700018
RSIOBFG1 DC    X'00'                    I/O FLAGS BYTE 1                54800018
RSIOBFG2 DC    X'00'                    I/O FLAGS BYTE 2                54900018
RSIOBSN1 DS    CL1                      FIRST SENSE BYTE                55000018
RSIOBSN2 DS    CL1                      SECOND SENSE BYTE               55100018
RSIOBECB DC    AL4(RSECBAD)             ECB ADDRESS                     55200018
RSIOBCSW DS    D                        LAST CSW                        55300018
RSIOBCPA DS    AL4(RSCCW1)              CHANNEL PROGRAM ADDRESS         55400018
RSIOBDCB DS    AL4(RSDCBREP)            DCB ADDRESS                     55500018
RSIOBRCP DS    CL4                      RESTART ADDRESS FOR IOS         55600018
RSIOBINC DS    H                        INCREMENT BLOCK COUNT           55700018
RSIOBECT DS    H                        NO. OF ERROR ENTRIES            55800018
RSIOBDAD DS    D                        SEEK ADDRESS FOR DA             55900018
*                                                                       56000018
*    CHANNEL PROGRAM                                                    56100018
*                                                                       56200018
RSCCWLST DS    0CL24                                                    56300018
RSCCW1   DS    D                        CCW1                            56400018
RSCCW2   DS    D                        CCW2                            56500018
RSCCW3   DS    D                        CCW3                            56600018
*                                                                       56700018
*    BUFFER SEGMENT FOR EXTERNAL BLOCKS                                 56800018
*                                                                       56900018
RSBUFSEG DS    0CL176                                                   57000018
RSJFCB   EQU   RSBUFSEG                                                 57100018
*                                                                       57200018
*********************************************************************** 57300018
*                                                                       57400018
*                  JFCB                                                 57500018
*                                                                       57600018
*********************************************************************** 57700018
*                                                                       57800018
JFCBDSNM DS    CL44                         DATA SET NAME               57900018
JFCBELNM DS    CL8                          ELEMENT NAME OR VERSION     58000018
JFCBTSDM DS    CL1                          TASK SCHEDULER - DATA       58100018
*                                            MANAGEMENT INTERFACE BYTE  58200018
JFCBSYSC DS    CL13                         SYSTEM CODE                 58300018
JFCBLTYP DS    CL1                          LABEL TYPE AND USER'S-LABEL 58400018
*                                            INDICATOR                  58500018
         DS    CL1                          NOT USED                    58600018
JFCBFLSQ DS    CL2                          FILE SEQUENCE NUMBER        58700018
JFCBVLSQ DS    CL2                          VOLUME SEQUENCE NUMBER      58800018
JFCBMASK DS    CL8                          DATA MANAGEMENT MASK        58900018
JFCBCRDT DS    CL3                          DATA SET CREATION DATE      59000018
JFCBXPDT DS    CL3                          DATA SET EXPIRATION DATE    59100018
JFCBIND1 DS    CL1                          INDICATOR BYTE 1            59200018
JFCBRLSE EQU   64                            BITS 0 AND 1 - EXTERNAL    59300018
*                                            STORAGE RELEASE INDICATOR  59400018
JFCBLOCT EQU   16                            BITS 2 AND 3 - DATA SET    59500018
*                                            HAS BEEN LOCATED           59600018
JFCBNEWV EQU   4                             BITS 4 AND 5 - NEW VOLUME  59700018
*                                            ADDED TO DATA SET          59800018
JFCBPMEM EQU   1                             BITS 6 AND 7 - DATA SET IS 59900018
*                                            A MEMBER OF A PODS OR GDG  60000018
JFCBIND2 DS    CL1                          INDICATOR BYTE 2            60100018
JFCBSTAT EQU   64                            BITS 0 AND 1 - DATA SET    60200018
*                                            STATUS (NEW, OLD, OR MOD)  60300018
JFCBSCTY EQU   16                            BITS 2 AND 3 - DATA SET    60400018
*                                            SECURITY INDICATOR         60500018
JFCBUFNO DS    0AL1                                                     60600018
JFCBUFRQ DS    AL1                      BUFFER REQUESTED                60700018
JFCBFTEK DS    0BL1                                                     60800018
JFCBFALN DS    BL1                      BUFFER ALIGNMENT                60900018
JFCBUFL  DS    AL2                      BUFFER LENGTH                   61000018
JFCEROPT DS    BL1                      ERROR ROUTINE                   61100018
JFCTRTCH DS    0BL1                                                     61200018
JFCKEYLE DS    0AL1                                                     61300018
JFCMODE  DS    0BL1                                                     61400018
JFCCODE  DS    0BL1                                                     61500018
JFCSTACK DS    0BL1                                                     61600018
JFCPRTSP DS    BL1                      PRINTER SPACING                 61700018
JFCDEN   DS    BL1                      TAPE DENSITY                    61800018
JFCLIMCT DS    AL3                      NO. OF TRKS.TO BE SEARCHED      61900018
JFCDSORG DS    BL2                      DATA SET ORGANIZATION           62000018
JFCRECFM DS    BL1                      RECORD FORMAT                   62100018
JFCOPTCD DS    BL1                      OPTION CODES                    62200018
JFCBLKSI DS    AL2                      BLOCK SIZE                      62300018
JFCLRECL DS    AL2                      LOGICAL RECORD LENGTH           62400018
JFCNCP   DS    AL1                      NO. OF CHANNEL PROGRAM          62500018
JFCNTM   DS    AL1                      NO. OF TRKS. FOR MASTER INDEX   62600018
JFCRKP   DS    AL2                      RELATIVE POSITION OF KEY        62700018
JFCCYLOF DS    AL1                      NO. OF TRKS FOR OVERFLOW        62800018
JFCDBUFN DS    AL1                      RESERVED                        62900018
JFCINTVL DS    AL1                      INTENTIONAL INTERVAL            63000018
JFCCPRI  DS    BL1                      PRIORITY                        63100018
JFCSOWA  DS    AL2                      SIZE OF WORKAREA                63200018
JFCBNTCS DS    CL1                          NUMBER OF OVERFLOW TRACKS   63300018
JFCBNVOL DS    CL1                          NUMBER OF VOLUME SERIAL     63400018
*                                            NUMBERS                    63500018
JFCBVOLS DS    CL30                         VOLUME SERIAL NUMBERS (THE  63600018
*                                            FIRST FIVE)                63700018
JFCBEXTL DS    CL1                          LENGTH OF BLOCK OF EXTRA    63800018
*                                            VOLUME SERIAL NUMBERS      63900018
*                                            (BEYOND FIVE)              64000018
JFCBEXAD DS    CL3                          TRACK ADDRESS OF BLOCK OF   64100018
*                                            EXTRA VOL SERIAL NUMBERS   64200018
JFCBPQTY DS    CL3                          PRIMARY QUANTITY OF D.A.    64300018
*                                            STORAGE REQUIRED           64400018
JFCBCTRI DS    CL1                          INDICATES WHETHER CYLINDERS 64500018
*                                            TRACKS, OR RECORDS ARE     64600018
*                                            SPECIFIED IN JFCBPQTY AND  64700018
*                                            JFCBSQTY                   64800018
JFCBSQTY DS    CL3                          SECONDARY QUANTITY OF D.A.  64900018
*                                            STORAGE REQUIRED           65000018
JFCBIND3 DS    CL1                          INDICATOR BYTE 3            65100018
JFCBCNTG EQU   64                            BITS 0 AND 1 - CONTIGUOUS  65200018
*                                            STORAGE INDICATOR          65300018
JFCBMXIG EQU   16                            BITS 2 AND 3 - MAXIMUM     65400018
*                                            AVAILABLE EXTENT INDICATOR 65500018
JFCBALXI EQU   4                             BITS 4 AND 5 - ALL EXTENTS 65600018
*                                            INDICATOR                  65700018
JFCBRNDC EQU   1                             BITS 6 AND 7 - ROUND       65800018
*                                            CYLINDER INDICATOR         65900018
JFCBDQTY DS    CL3                          QUANTITY OF D.A. STORAGE    66000018
*                                            REQUIRED FOR A DIRECTORY   66100018
JFCBSPNM DS    CL3                          CORE ADDRESS OF THE JFCB    66200018
*                                            WITH WHICH CYLINDERS ARE   66300018
*                                            SPLIT                      66400018
JFCBABST DS    CL2                          RELATIVE ADDRESS OF FIRST   66500018
*                                            TRACK TO BE ALLOCATED      66600018
JFCBSBNM DS    CL3                          CORE ADDRESS OF THE JFCB    66700018
*                                            FROM WHICH SPACE IS TO BE  66800018
*                                            SUBALLOCATED               66900018
JFCBDRLH DS    CL3                          AVERAGE DATA RECORD LENGTH  67000018
JFCBVLCT DS    CL1                          VOLUME COUNT                67100018
JFCBSPTN DS    CL1                          NUMBER OF TRACKS PER        67200018
*                                            CYLINDER TO BE USED BY     67300018
*                                            THIS DATA SET WHEN SPLIT   67400018
*                                            CYLINDER IS INDICATED      67500018
JFCBLGTH EQU   176                          LENGTH OF JFCB              67600018
JFCBEND  EQU   *                                                        67700018
*                                                                       67800018
         ORG   RSBUFSEG+176             ORG BACK TO BUFFER SEGMENT      68800018
RSSTATUS DS    0CL8                                                     69800018
RSSTAT1  DS    CL1                      STATUS BYTE 1                   70800018
RSSTAT2  DS    CL1                      STATUS BYTE 2                   71800018
RSSTAT3  DS    CL1                      STATUS BYTE 3                   72800018
RSSTAT4  DS    CL1                      STATUS BYTE 4                   73800018
         DS    F                        RESERVED FOR FUTURE USE         74800018
         EJECT                                                          79500018
         CVT   DSECT=YES,PREFIX=YES,LIST=YES                     Y02076 79550002
         EJECT                                                          79800018
*                                                                       79900018
*                                                                       80000018
*   TASK CONTROL BLOCK                                                  80100018
*                                                                       80200018
*                                                                       80300018
         IKJTCB                                                  Y02076 80350002
         EJECT                                                          82500018
         IEZJSCB                                               @OZ03934 82550037
         EJECT                                                 @OZ03934 82560037
         DCBD  DSORG=PS                                                 82600018
         EJECT                                                          82700018
         IEZDEB                                                  Y02076 82750002
         EJECT                                                          86700018
         IHJDSTAB                                                Y02076 86750002
         EJECT                                                          90800018
TIOT     DSECT                                                          90900018
         IEFTIOT1                                                       91000018
         EJECT                                                          91100018
SRT      DSECT                                                          91200018
         IEFUCBOB                                                       91300018
*                                                                       91400018
*                                                                       91500018
*        THE FOLLOWING EQUATES ARE FOR VSAM                      Y02076 91550002
*                                                                       91600018
EXCPTEST EQU   42                    OFFSET TO DCB MACRF FIELS   Y02076 91650002
DSORGFLD EQU   27                    OFFSET TO ACB/AMB DSORG FLD Y02076 91670002
ACBAMBID EQU   X'08'                 MASK FOR DCB DATA SET TEST  Y02076 91690002
EXCPID   EQU   X'80'                 MASK FOR EXCP TEST ON DSORG Y02076 91694002
OFFSET0  EQU   0                     OFFSET TO AMB AMBID FIELS   Y02076 91698002
AMBDSID  EQU   X'40'                 MASK FOR AMBID VSAM DS TEST Y02076 91698802
VSAMACB  EQU   X'11'                 MASK FOR ACB VSAM DS TEST   Y02076 91699602
ACBFLAG  EQU   43                    OFFSET TO ACB FLAG IND. FLD Y02076 91699802
         END                                                            91700018
./  ADD  SSI=81150460,NAME=IGC0U05B
         TITLE 'IGC0U05B DATA SET PROCESSOR, DOS TAPE DATA SET POSITION*00110021
               ING   REPOSITION I/O  RESTART-SVC 52  OS/360'            00160021
IGC0U05B CSECT                                                          00210021
*                                                                       00260021
*     VS2 RELEASE 037 DELETIONS/CHANGES                                 00310037
* APAR OZ31494 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 00320037
*C173000-174200,183000,707000,709000,713000                    @ZSUT222 00326037
*A714200-714800,816500                                         @ZSUT222 00340037
*         RELEASE 23 DELETIONS/CHANGES                                  00360021
*         RELEASE 22 DELETIONS/CHANGES                                  00410021
*         RELEASE 21 NEW MODULE                                         00460021
*                                                                       00510021
*                                                                       00560021
* STATUS CHANGE LEVEL 000                                               00610021
*                                                                       00660021
*********************************************************************** 00710021
*                                                                       00760021
*                                                                       00810021
* FUNCTION - POSITIONS TAPES WHICH HAD BYPASS EMBEDDED DOS CHKPT RCDS   00860021
*    AND/OR BYPASS OPTIONAL LEADING TAPE MARK OPTION(S) SPECIFIED. TO   00910021
*    POSITION A TAPE WHICH MAY HAVE A LEADING TAPE MARK IT IS NECESSARY 00960021
*    TO ISSUE A READ AND TEST THE STATUS INFORMATION.  IF THE STATUS    01010021
*    INDICATES THAT A TAPE MARK WAS SENSED, THE LEADING TAPE MARK HAS   01060021
*    BEEN BYPASSED.  OTHERWISE THE TAPE MUST BE BACKSPACED ONE BLOCK    01110021
*    SUCH THAT CORRECT POSITIONING MAY BE PERFORMED.                    01160021
*                                                                       01210021
*    TO CORRECTLY POSITION A TAPE TO THE CORRECT RECORD WITHIN A DATA   01260021
*    SET CONTAINING EMBEDDED DOS CHKPT RCDS, IT IS NECESSARY TO READ    01310021
*    AND TEST EACH BLOCK FOR THE CHKPT HDR AND TRLR RCDS.  WHEN A CHKPT 01360021
*    HDR RCD IS ENCOUNTERED, TABFLG2 BIT 2 WILL BE SET AND THE BLOCK    01410021
*    COUNT FIELD (TABBLK2) WILL NOT BE INCREMENTED.  IT WILL THEN       01460021
*    CONTINUE READING AND NOT UPDATING TABBLK2 UNTIL THE CHKPT TRLR     01510021
*    RCD IS ENCOUNTERED, AT WHICH TIME TABFLG2 BIT 2 IS TURNED OFF TO   01560021
*    INDICATE EMBEDDED CHKPT RCDS ARE NOT BEING PASSED.  IF NEXT RCD    01610021
*    READ IS NOT A CHKPT HDR RCD, TABBLK2 WILL BE INCREMENTED TO IND.   01660021
*    THAT IT WAS A USER'S RCD AND WAS SPACED OVER.                      01710021
*                                                                       01760021
*    POSITIONING - A. POSITIONS TAPE TO CORRECT DATA SET USING FILE     01810021
*                     SEQUENCE NUMBER IN JFCB WHICH CAN BE OBTAINED     01860021
*                     FROM THE 48 BYTES TABLE ENTRY WHICH IS USED IN    01910021
*                     THE RESTART PORTION OF CHECKPOINT/RESTART.        01960021
*                                                                       02010021
*                  B. POSITIONS TAPE TO CORRECT RECORD WITHIN A DATA    02060021
*                     SET USING DCB POSITIONING INFORMATION             02110021
*                                                                       02160021
*********************************************************************** 02210021
*                                                                       02260021
* ENTRY POINTS -                                                        02310021
*                                                                       02360021
*         IGC0U05B FROM IGC0S05B                                        02410021
*                                                                       02460021
*********************************************************************** 02510021
*                                                                       02560021
* INPUT -                                                               02610021
*                                                                       02660021
*    REGISTER 8   BEGINNING OF DCB TABLE                                02710021
*    REGISTER 1   USER BUFFER AREA                                      02760021
*                                                                       02810021
*    ALL OPENED DCB(S) WITH THEIR ASSOCIATED CONTROL BLOCKS             02860021
*    THE 48 BYTE TABLE ENTRY (IES) THAT IS (ARE) USED IN RESTART        02910021
*    RESTART WORKAREA                                                   02960021
*                                                                       03010021
*********************************************************************** 03060021
*                                                                       03110021
* OUTPUT -                                                              03160021
*                                                                       03210021
*    REGISTER 8   BEGINNING OF DCB TABLE                                03260021
*    REGISTER 1   USERS BUFFER AREA                                     03310021
*    DOS TAPE POSITIONED AT CORRECT RECORD WITHIN DATA SET              03360021
*                                                                       03410021
*********************************************************************** 03460021
*                                                                       03510021
* EXTERNAL REFERENCES -                                                 03560021
*                                                                       03610021
*         USERS PROGRAM DCB                                             03660021
*                                                                       03710021
*********************************************************************** 03760021
*                                                                       03810021
* EXITS,NORMAL -                                                        03860021
*                                                                       03910021
*         FINAL EXIT IS MADE VIA XCTL TO THE NEXT MODULE OF REPI/O.     03960021
*         THIS MAY BE IGC0R05B OR IGC0T05B.                             04010021
*                                                                       04060021
*********************************************************************** 04110021
*                                                                       04160021
* EXITS,ERROR -                                                         04210021
*                                                                       04260021
*         ERROR EXITS ARE MADE VIA XCTL TO RESTART EXIT IGC0V05B        04310021
*         WITH RETURN CODES IN 'RSRETCOD' FIELD -                       04360021
*                                                                       04410021
*         65 - ERRORS IN TRYING TO POSITION TO CORRECT DAT SET          04460037
*                                                                       04510021
*         64 - ERRORS IN TRYING TO POSITION TO CORRECT RECORD           04560021
*              WITHIN THE DATA SET                                      04610021
*                                                                       04660021
*********************************************************************** 04710021
*                                                                       04760021
* TABLES/WORKAREAS - THE WORKAREA USED IS DESCRIBED BY THE DSECTS AT    04810021
*                    THE END OF THE LISTING.                            04860021
*                                                                       04910021
*    THE WORKAREAS AND TABLE ENTRIES HAVE BEEN COMPLETED IN             04960021
*    IGC0P05B AND IGC0S05B WITH THE EXCEPTION OF THE CHANNEL            05010021
*    PROGRAM REQUIRED TO BYPASS THE EMBEDDED CHKPT RCDS.  THE           05060021
*    FOURTH WORKAREA SEGMENT WILL BE USED AS BUFFER SEGMENTS.           05110021
*                                                                       05160021
*                                                                       05800021
*********************************************************************** 05900021
*                                                                     * 06000021
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 06100021
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 06200021
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 06300021
*    IS 48 BYTES LONG.                                                * 06400021
*                                                                     * 06500021
*********************************************************************** 06600021
*                                                                       06700021
*        ------------------- 4 BYTES -----------------                  06800021
*                                                                       06900021
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  07000021
*        +DATA SET  +           DCB                  +                  07100021
*        + ORGN.    +         ADDRESS                +                  07200021
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                07300021
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  07400021
*        + NO. 1    +         ADDRESS                +                  07500021
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  07600021
*        +NUMBER    +         JFCB TTR               +                  07700021
*        + OF VOLS  +         ADDRESS                +                  07800021
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               07900021
*                                                                       08000021
*     12 +++++++++++++++++++++++                                        08100021
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   08200021
*        +INFO BYTE + NUMBER   +                                        08300021
*        +++++++++++++++++++++++                                        08400021
*                                                                       08500021
*     12 +++++++++++++++++++++++                                        08600021
*        +    OLD   TIOT       +        DA AND UNIT RECORD              08700021
*        +      OFFSET         +                                        08800021
*        +++++++++++++++++++++++                                        08900021
*                                                                       09000021
*                              +++++++++++++++++++++++                  09100021
*                              +FLAG BYTE +FLAG BYTE +                  09200021
*                              +  NO. 2   +  NO. 3   +                  09300021
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  09400021
*        +FLAG BYTE +FLAG BYTE +                     +                  09500021
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  09600021
*        +++++++++++++++++++++++                     + 20               09700021
*        +                                           +                  09800021
*        +                                           +                  09900021
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  10000021
*        +                                           +                  10100021
*        +   VOLUME ID NO. 2                         +                  10200021
*        +                     +++++++++++++++++++++++ 28               10300021
*        +                     +                     +                  10400021
*        +                     +   VOLUME ID NO. 3   +                  10500021
*     32 +++++++++++++++++++++++                     +                  10600021
*        +                                           +                  10700021
*        +                                           +                  10800021
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               10900021
*        +                                           +                  11000021
*        +   VOLUME ID NO. 4                         +                  11100021
*     40 +                     +++++++++++++++++++++++                  11200021
*        +                     +                     +                  11300021
*        +                     +                     +                  11400021
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               11500021
*        +                                           +                  11600021
*        +                                           +                  11700021
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               11800021
*                                                                       11900021
*                                                                       12000021
*                                                                       12020021
*********************************************************************** 12040021
* ATTRIBUTES -                                                          12060021
*                                                                       12080021
*    REENTRANT                                                          12100021
*    REUSABLE                                                           12120021
*    ENABLED                                                            12140021
*    PRIVILEGED                                                         12160021
*                                                                       12180021
*********************************************************************** 12200021
*                                                                       12220021
* CHARACTER CODE DEPENDENCY -                                           12240021
*                                                                       12260021
*     OPERATION OF THIS MODULE IS NOT DEPENDENT UPON A PARTICULAR       12280021
*     INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER SET.            12300021
*                                                                       12320021
*********************************************************************** 12340021
*                                                                       12360021
* NOTES -                                                               12380021
*                                                                       12500021
*********************************************************************** 12600021
         EJECT ,                                                 A27694 12620021
*                                                                       12640021
*********************************************************************** 12660021
*                                                                       12700021
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               12800021
*                                                                       12900021
*********************************************************************** 13000021
*                                                                       13100021
WRKR1    EQU   0                        WORK/PARAMETER REGISTER         13200021
WRKR2    EQU   1                        WORK/PARAMETER REGISTER         13300021
DCBR     EQU   2                        CURRENT DCB REGISTER            13500021
BASER    EQU   3                        BASE RIGISTER                   13600021
DEBR     EQU   4                        CURRENT DEB REGISTER            13700021
UCBR     EQU   5                        CURRENT UCB REGISTER            13800021
TIOTR    EQU   6                        NEW TIOT RESISTER               13900021
TCBR     EQU   7                        TCB REGISTER                    14000021
TABLR    EQU   8                        BEGINNING TO DCB TABLE REGISTER 14100021
CTABLR   EQU   9                        CURRENT ENTRY IN DCB TABLE      14200021
BUFR     EQU   10                       USER BUFFER AREA                14300021
DSCNTR   EQU   11                       NUMBER OF DATA SETS             14400021
WRKR3    EQU   12                       WORK REGISTER                   14500021
WRKR4    EQU   13                       WORK REGISTER                   14600021
WRKR5    EQU   14                       WORK/PARAMETER REGISTER         14800021
WRKR6    EQU   15                       WORK/PARAMETER REGISTER         14900021
*                                                                       15000021
*********************************************************************** 15100021
*                                                                       15200021
*    OFFSETS TO BE USED IN REPI/O PHASE                                 15300021
*                                                                       15400021
*********************************************************************** 15500021
*                                                                       15600021
TPDEV    EQU   X'10'                    TAPE DEVICE                     15800021
LASTENT  EQU   X'08'                    LAST ENTRY                      15900021
TABENT   EQU   48                       TABLE ENTRY LENGTH              16400021
READ     EQU   X'02'                    READ FOR TAPE                   16500021
NOPOP    EQU   X'03'                    NOP                             16600021
REWIND   EQU   X'07'                    REWIND                          16700021
READBACK EQU   X'0C'                    READBACK                        16800021
BSFOP    EQU   X'2F'                    BACKWARD SPACE FILE             16900021
FSFOP    EQU   X'3F'                    FORWARD SPACE FILE              17000021
TIC      EQU   X'08'                    TIC                             17100021
PERMERR  EQU   X'7F'                    PERMANENT ERROR                 17200021
ERR065   EQU   65                       ERROR IN DATA SET      @ZSUT222 17300037
*                                       POSITIONING.           @ZSUT222 17340037
ERR064   EQU   64                       ERROR IN RECORD        @ZSUT222 17380037
*                                       POSITIONING.           @ZSUT222 17420037
FLAGS    EQU   X'30'                                                    17500021
DAFLAG   EQU   X'80'                    DA DATA SET FLAG                17560021
COUNT    EQU   X'14'                    CCW BYTE COUNT                  17620021
ONE      EQU   X'01'                    CONSTANT ONE                    17700021
DOSTAPE  EQU   X'11'                    DOS TAPE TABLE ENTRY            17730021
CKPTRCDS EQU   X'10'                    TEST FOR CHKPT RCDS IND.        17760021
CHKPT    EQU   X'02'                    PERFORM CHKPT RCD BYPASS        17790021
CHKOFF   EQU   X'FD'                    TURN OFF DOS CHKPT MASK         17820021
RCDPOS   EQU   X'18'                    TEST FOR RCD POSITIONING        17850021
TAPEMARK EQU   X'21'                    TEST FOR LEADING TM IND.        17880021
LTM      EQU   X'01'                    PERFORM BYPASS OF TM            17910021
SLI      EQU   X'20'                    SET SLI FLAG ON IN CCW          17940021
BYPASS   EQU   X'20'                    BYPASS CHKPT RCDS FLAG          17970021
READOP   EQU   X'F1'                    READ OR READ BACK CCW           18000021
DAMOD    EQU   X'D9'                    DA MODULE - IGC0R05B            18030021
AMMOD    EQU   X'E3'                    ACCESS METHOD - IGC0T05B        18060021
UE       EQU   X'01'                                                    18090021
RDBACK   EQU   X'03'                    READ BACKWARDS (DEBOPATB)       18200021
ERRORS   EQU   ERR065+ERR064            ERROR CODES            @ZSUT222 18300037
ERRCHKPT EQU   X'C0'                    PERMANENT ERROR AT CHECKPOINT   18400021
NOOPS    EQU   X'FF'                                                    18500021
RESET    EQU   X'FE'                    RESET SL FLAG            A32901 18550021
REW      EQU   X'80'                    REWIND MASK FOR TABOPS          18600021
FSF      EQU   X'40'                    FORWARD SPACE FILE MASK         18700021
BSF      EQU   X'20'                    BACK SPACE FILE MASK            18800021
RDOP     EQU   X'10'                    READ FORWARD MASK               18900021
RDBK     EQU   X'08'                    READ BACKWARD MASK              19000021
BUSY     EQU   X'80'                                                    19100021
NOTBUSY  EQU   X'00'                                                    19200021
BLANK    EQU   X'40'                                                    19300021
IBITS    EQU   X'0C'                    UNIQUE DEB INPUT BITS    A33655 19330021
EOFRST   EQU   X'DF'                    DEB EOF RESET MASK       A33655 19360021
BYPSSOFF EQU   X'7F'                    TURN OFF BYPASS FLAG            19370021
ZERO     EQU   0                                                        19400021
WAIT     EQU   7                                                        19500021
EQUAL    EQU   8                                                        19600021
NOTMIX   EQU   9                                                        19700021
ENDBUFF  EQU   19                       POINT TO END OF BUFFER          19750021
D0       EQU   0                                                        19800021
D1       EQU   1                                                        19900021
D3       EQU   3                                                        19950021
D4       EQU   4                                                        20000021
D7       EQU   7                                                        20100021
D8       EQU   8                                                        20200021
L1       EQU   1                                                        20300021
L4       EQU   4                                                        20400021
L8       EQU   8                                                        20500021
L18      EQU   18                                                       20600021
L23      EQU   23                                                       20700021
L24      EQU   24                                                       20800021
L26      EQU   26                                                       20830021
L384     EQU   384                                                      20860021
*                                                                       20900021
*********************************************************************** 21000021
*                                                                       21100021
         EJECT ,                                                 A27694 21150021
         BALR  BASER,ZERO               ESTABLISH ADDRESSABILITY        21450021
         USING *,BASER                  ESTABLISH BASE REG              21750021
         B     BEGIN               BRANCH AROUND EYE CATCHER     Y01909 21800000
         CNOP  0,8                 ALIGN TO A DBL WORD BOUNDARY  Y01909 21850000
         DC    CL8'IGC0U05B'       MODULE NAME                 @ZSUT222 21900037
         DC    CL8'&SYSDATE'       LAST DATE SHIPPED           @ZSUT222 21910037
         DC    CL8'@ZSUT222'       LAST CODE SHIPPED           @ZSUT222 21920037
BEGIN    EQU   *                                                 Y01909 21950000
*                                                                       22050021
         USING IHADCB,DCBR                                              22350021
         USING TABL,CTABLR                                              22650021
         USING RSTWA,BUFR                                               22950021
         USING RSDSECT,WRKR4                                            23250021
         USING DEBBASIC,DEBR                                            23300002
*                                                                       23550021
*                                                                       23850021
         LR    CTABLR,TABLR             INITIALIZE TABL POINTER         24150021
         LR    BUFR,WRKR2               SAVE POINTER TO RSWA            24450021
         L     WRKR4,TABSEGAD-D1        WORKAREA SEGMENT ADDRESS        24750021
         LA    WRKR5,D3                                                 25050021
         LA    WRKR3,L384(WRKR4)        POINT TO FOURTH                 25350021
*                                       WORKAREA SEGMENT                25650021
         SR    WRKR6,WRKR6              DOS TAPE COUNTER - NEED TO      25950021
*                                       BUILD ONLY THREE CCWS           26250021
REPDCB00 EQU   *                                                        26550021
*                                                                       26850021
         TM    TABFLG1,TABDOSTP         DOS TAPE ENTRY                  27150002
         BNO   REPDCB15                 BRANCH IF NO TO GET NEXT ENTRY  27450021
*                                                                       27750021
*   *** LOAD NECESSARY ADDRESSES ***                                    28050021
*                                                                       28350021
         L     WRKR4,TABSEGAD-D1        WORKAREA SEGMENT ADDRESS        28650021
         L     DCBR,TABDCBAD-D1         DCB ADDRESS FOR THIS ENTRY      28950021
*                                                                       29250021
*   *** DETERMINE WHICH BYPASS OPTION WAS SPECIFIED ***                 29550021
*                                                                       29850021
         TM    DCBMACRF,X'80'           IS THIS EXCP            SA64062 29900002
         BO    REPDCB05                 YES-BYPASS CHKPT TEST   SA64062 29950002
         TM    DCBOPTCD,CKPTRCDS        BYPASS EMBEDDED CHKPT RCDS      30150021
         BZ    REPDCB05                 BRANCH NO - BYPASS LEADING TM   30450021
*                                                                       30750021
         OI    TABOPS,CHKPT             SET CODE FOR BYPASS CHKPT RCDS  31050021
***                                                                     31100021
*        IF A CHECKPOINT WAS TAKEN WHILE THE ACCESS METHOD ROUTINES     31150021
*        WERE SKIPPING OVER AN EMBEDDED CHECKPOINT, THE DEB BYPASS      31200021
*        FLAG WILL STILL BE ON, CAUSING INCORRECT POSITIONING           31250021
***                                                                     31300021
         L     DEBR,DCBDEBAD            LOAD ADDRESS OF DEB             31310021
         LA    DEBR,DEBBASND            DEPEND SEC ADR           Y02076 31312002
         USING DEBDASD,DEBR                                      Y02076 31314002
         NI    DEBBYPAS,BYPSSOFF        TURN OFF BYPASS BIT             31320021
         L     DEBR,DCBDEBAD            LOAD ADR OF DEB          Y02076 31330002
         USING DEBBASIC,DEBR                                     Y02076 31340002
*                                                                       31350021
         TM    TABTPLBL,TAPEMARK        BYPASS LEADING TAPE MARK        31650021
         BNO   REPDCB10                 BRANCH ON NO                    31950021
*                                                                       32250021
REPDCB05 EQU   *                                                        32550021
*                                                                       32850021
         OI    TABOPS,LTM               SET CODE FOR BYPASS LEADING TM  33150021
*                                                                       33450021
REPDCB10 EQU   *                                                        33750021
*                                                                       34050021
         LA    WRKR6,D1(WRKR6)          INCR DOS TAPE ENTRY COUNTER     34350021
         CR    WRKR6,WRKR5              HAVE THREE CCWS BEEN BUILT      34650021
         BH    REPDCB15                 BRANCH YES                      34950021
*                                                                       35250021
*   *** INITIALIZE CHANNEL PROGRAM ***                                  35550021
*                                                                       35850021
         XC    RSCCW1(L26),RSCCW1       CLEAR CCW AND END OF            36150021
*                                       WORK SPACE                      36450021
*                                                                       36750021
         MVI   RSCCW1+D4,SLI            SET SLI BIT ON                  37050021
         MVI   RSCCW1+D7,COUNT          SET BYTE COUNT TO TWENTY        37350021
         ST    WRKR3,RSCCW1             SET DATA ADDRESS TO SEGMENT     37650021
*                                         OF FOURTH WORKAREA            37950021
         LA    WRKR3,COUNT(WRKR3)       INCREMENT BUFFER POINTER        38250021
*                                                                       38550021
REPDCB15 EQU   *                                                        38850021
*                                                                       39150021
         TM    TABFLG1,TABLAST          IS THIS THE LAST ENTRY          39450002
         BO    REPDCB20                 BRANCH YES TO INIT I/O          39750021
*                                                                       40050021
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TABLE POINTER         40350021
         B     REPDCB00                 BRANCH TO TEST NEXT ENTRY       40650021
*                                                                       40950021
REPDCB20 EQU   *                                                        41250021
*                                                                       41550021
*********************************************************************** 41850021
*                                                                       42150021
*        THIS ROUTINE WILL PERFORM ALL THE NECESSARY I/O OPERATIONS     42450021
*        ACCORDING TO THE TABLE BUILT IN THE END OF EACH TABLE ELEMENT. 42750021
*                                                                       43050021
*********************************************************************** 43350021
*                                                                       43650021
         LR    CTABLR,TABLR             INITIALIZE TABL POINTER         48400021
         SR    WRKR3,WRKR3              TURN OFF SPIN SWITCH            48500021
         SR    WAIT,WAIT                TURN ON DO NOT WAIT SWITCH      48600021
*                                                                       48650021
REPDCB22 EQU   *                                                        48700021
*                                                                       48750021
         L     WRKR4,TABSEGAD-D1        WORK AREA SEGMENT ADDRESS       48800021
         TM    TABFLG1,TABDOSTP         IS IT DOS TAPE                  48900002
         BNO   REPDCB52                 BRANCH NO TO GET NEXT ELT       49000021
*                                                                       49100021
         TM    TABOPS,NOOPS             ANY I/O NEEDED FOR THIS ELT     49200021
         BZ    REPDCB52                 BRANCH NO TO GET NEXT ELT       49300021
         LA    WRKR3,ONE                TURN ON SPIN SWITCH             49400021
         TM    RSSTAT1,BUSY             IS WORK AREA BUSY               49500021
         BZ    REPDCB24                 BRANCH NO TO CONTINUE           49600021
         BAL   WRKR5,REPDCB56           GO TO WAIT ROUTINE              49700021
*                                                                       49709021
REPDCB24 EQU   *                                                        49718021
*                                                                       49727021
         TM    TABOPS,LTM               IS OPTIONAL TM INDICATED        49736021
         BZ    REPDCB32                 BRANCH NO TO CONTINUE           49745021
*                                                                       49754021
*        SET READ FORWARD TO TEST FOR TAPE MARK (UNIT EXCEPTION)        49763021
*                                                                       49772021
         MVI   RSCCW1,READ              SET OP CODE TO READ FWD         49781021
         B     REPDCB48                 GO TO EXCP                      49790021
*                                                                       49800021
REPDCB32 EQU   *                                                        49900021
*                                                                       50000021
         TM    TABOPS,REW               IS REWIND NECESSARY             50100021
         BZ    REPDCB34                 BRANCH NO REWIND                50200021
*                                                                       50300021
*        REWIND ROUTINE                                                 50400021
*                                                                       50500021
         XI    TABOPS,REW               PEEL OFF REWIND MASK            50600021
*                                                                       50700021
         MVI   RSCCW1,REWIND            SET CCW OP CODE TO REWIND       50800021
         B     REPDCB48                 GO TO EXCP                      50900021
*                                                                       51000021
REPDCB34 EQU   *                                                        51100021
*                                                                       51200021
*        FORWARD SPACE FILE ROUTINE                                     51300021
*                                                                       51400021
         TM    TABOPS,FSF               IS FSF NECESSARY                51500021
         BZ    REPDCB38                 BRANCH NO TO CHECK BSF          51600021
*                                                                       51700021
*        FSF                                                            51800021
*                                                                       51900021
         SR    WRKR6,WRKR6                                              52000021
         IC    WRKR6,TABFSFN2           GET NUMBER OF FSF ALREADY DONE  52100021
         LA    WRKR6,D1(WRKR6)          ADD ONE                         52200021
         STC   WRKR6,TABFSFN2           SAVE NUMBER OF FSF'S            52300021
         CLC   TABFSFN1(L1),TABFSFN2    WILL THIS BE ENOUGH             52400021
         BNE   REPDCB36                 BRANCH NO NOT ENOUGH            52500021
*                                                                       52600021
         XI    TABOPS,FSF               PEEL OFF FSF MASK               52700021
*                                                                       52710021
*        TURN OFF BYPASS DOS CHKPT RCD MASK IF NO RECORD                52720021
*        POSITIONING IS INDICATED                                       52730021
*                                                                       52740021
         TM    TABOPS,RCDPOS            RCD POSIT. INDICATED            52750021
         BNZ   REPDCB36                 BR IF YES                       52760021
*                                                                       52770021
         NI    TABOPS,CHKOFF            TURN OFF DOS CHKPT MASK         52780021
*                                                                       52790021
*                                                                       52800021
REPDCB36 EQU   *                                                        52900021
*                                                                       53000021
*                                                                       53100021
         MVI   RSCCW1,FSFOP             SET FSF OP CODE IN CCW          53200021
         B     REPDCB48                 GO TO EXCP                      53300021
*                                                                       53400021
*                                                                       53500021
*                                                                       53600021
REPDCB38 EQU   *                                                        53700021
*                                                                       53800021
*        BACK SPACE FILE ROUTINE                                        53900021
*                                                                       54000021
         TM    TABOPS,BSF               IS BACK SPACE FILE NECESSARY    54100021
         BZ    REPDCB40                 BRANCH NO TO CHECK READ FWD     54200021
*                                                                       54300021
*BSF                                                                    54400021
*                                                                       54500021
         XI    TABOPS,BSF               PEEL OFF BSF MASK               54600021
*                                                                       54700021
*                                                                       54800021
         MVI   RSCCW1,BSFOP             SET BSF OP CODE IN CCW          54900021
         B     REPDCB48                 GO TO EXCP                      55000021
*                                                                       55100021
*                                                                       55200021
*                                                                       55300021
REPDCB40 EQU   *                                                        55400021
*                                                                       55500021
*        READ FORWARD ROUTINE                                           55600021
*                                                                       55700021
         TM    TABOPS,RDOP              IS READ FWD NECESSARY           55800021
         BZ    REPDCB44                 BRANCH NO TO CHECK READ BACK    55900021
*                                                                       56000021
*        TEST FOR BYPASS FLAG ON - NO BLOCK COUNT INCR IF SET           56010021
*                                                                       56020021
         TM    TABFLG2,TABSW            BYPASSING CHKPT RCDS            56030002
         BO    REPDCB42                 BRANCH YES - SET OP CODE        56040021
*                                                                       56050021
*                                                                       56100021
         L     WRKR6,TABBLK2            GET BLK CT                      56200021
         LA    WRKR6,D1(WRKR6)          INCREMENT BY ONE                56300021
         ST    WRKR6,TABBLK2            SAVE BLK CT                     56400021
         CLC   TABBLK1(L4),TABBLK2      COMPARE BLOCK COUNTS            56500021
         BNL   REPDCB42                 BR NOT LOW TO CONTINUE          56560021
*                                                                       56620021
         NI    TABOPS,X'FF'-RDOP-CHKPT  PEEL OFF READ FWD AND    YM5600 56670002
*                                       DOS CHKPT MASKS                 56740021
         B     REPDCB52                 GET NEXT ELEMENT                56800021
*                                                                       56900021
REPDCB42 EQU   *                                                        57000021
*                                                                       57100021
         MVI   RSCCW1,READ              SET OP CODE TO READ FWD         57200021
         B     REPDCB48                 GO TO EXCP                      57300021
*                                                                       57400021
*                                                                       57500021
*                                                                       57600021
REPDCB44 EQU   *                                                        57700021
*                                                                       57800021
*        READ BACKWARD ROUTINE                                          57900021
*                                                                       58000021
         TM    TABOPS,RDBK              IS READ BACKWARD NECESSARY      58100021
         BZ    REPDCB52                 BRANCH NO MORE OPS FOR THIS ELT 58200021
*                                                                       58300021
*        TEST FOR BYPASS FLAG ON - NO BLOCK COUNT INCREMENT IF SET      58310021
*                                                                       58320021
         TM    TABFLG2,TABSW            BYPASS CHKPT RCDS IND.          58330002
         BO    REPDCB46                 BRANCH YES - SET OP CODE        58340021
*                                                                       58350021
*        RDBK                                                           58400021
*                                                                       58500021
         L     WRKR6,TABBLK2            GET BLOCK COUNT                 58600021
         LA    WRKR6,D1(WRKR6)          ADD ONE                         58700021
         ST    WRKR6,TABBLK2            SAVE NLOCK COUNT                58800021
         CLC   TABBLK1(L4),TABBLK2      COMPARE BLOCK COUNTS            58900021
         BNL   REPDCB46                 BR NOT LOW TO CONTINUE          58960021
*                                                                       59020021
         NI    TABOPS,X'FF'-RDBK-CHKPT  PEEL OFF READ BACKWRD    YM5600 59070002
*                                       AND DOS CHKPT RCD MASKS         59140021
         B     REPDCB52                 GET NEXT ELEMENT                59200021
*                                                                       59300021
REPDCB46 EQU   *                                                        59400021
*                                                                       59500021
         LA    WRKR6,ENDBUFF            ADD NINETEEN TO CCW DATA        59520021
         A     WRKR6,RSCCW1              ADDRESS TO POINT TO END        59540021
         ST    WRKR6,RSCCW1              OF BUFFER FOR READBACK         59560021
*                                                                       59580021
         MVI   RSCCW1,READBACK          SET OP CODE TO READ BACKWARD    59600021
*                                                                       59700021
*                                                                       59800021
REPDCB48 EQU   *                                                        59900021
*                                                                       60000021
         MVC   RSDEBUCB(L4),TABUCB      ADJUST UCB POINTER IN WORK AREA 60100021
REPDCB49 EQU   *                                                        60200021
         MVI   RSSTAT1,BUSY             TURN ON WORK AREA BUSY SWITCH   60300021
*                                                                       60400021
REPDCB50 EQU   *                                                        60500021
*                                                                       60600021
*        EXCP  ROUTINE                                                  60700021
*                                                                       60800021
*                                                                       60900021
*                                                                       61000021
         XC    RSECBAD(L4),RSECBAD      INITIALIZE ECB                  61100021
*                                                                       61200021
*                                                                       61300021
         EXCP  RSIOB                                                    61400021
*                                                                       61500021
*                                                                       61600021
         LTR   WAIT,WAIT                SHOULD WE WAIT                  61700021
         BNZ   REPDCB56                 BRANCH YES TO WAIT              61800021
*                                                                       62000021
REPDCB52 EQU   *                                                        62100021
*                                                                       62200021
         TM    TABFLG1,TABLAST          IS THIS THE LAST ENTRY          62300002
         BO    REPDCB54                 BRANCH YES TO CHECK IF DONE     62400021
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TABL POINTER          62500021
         B     REPDCB22                 CONTINUE PROCESSING             62600021
*                                                                       62700021
REPDCB54 EQU   *                                                        62800021
*                                                                       62900021
*        LAST ENTRY HAS BEEN PROCESSED, ARE ALL ELTS COMPLETE           63000021
*                                                                       63100021
         LTR   WRKR3,WRKR3              TEST SPIN SWITCH                63200021
         BZ    REPDCB58                 SWITCH OFF - STOP SPINNING      63300021
         B     REPDCB20                 SPIN THRU TABLE ELEMENTS        63400021
*                                                                       63500021
*                                                                       63600021
*        WAIT ROUTINE                                                   63700021
*                                                                       63800021
REPDCB56 EQU   *                                                        63900021
*        WAIT FOR CE FOR CONTROL OPERATIONS, WAIT FOR CE AND DE FOR ALL 64000021
*        OTHERS,  NOP BRINGS IN CE AND DE SO CHECKING CAN BE DONE       64100021
*        FOR ERRORS BEFORE THE NEXT OPERATION IS STARTED.               64200021
*                                                                       64300021
*                                                                       64400021
         WAIT  ECB=RSECBAD                                              64500021
*                                                                       64600021
         MVI   RSSTAT1,NOTBUSY          TURN OFF WORK AREA              64609021
*                                       BUSY SWITCH                     64618021
*                                                                       64627021
         TM    TABOPS,LTM               LEADING TAPEMARK IND.           64636021
         BZ    REPDCB57                 BRANCH NO                       64645021
*                                                                       64654021
         TM    RSIOBCSW+4,UE            UNIT EXCEPTION INDICATED        64663021
         BO    REPDCB80                 BRANCH YES                      64672021
*                                                                       64681021
REPDCB57 EQU   *                                                        64690021
*                                                                       64700021
         TM    RSECBAD,PERMERR          CHECK FOR PERMANENT I/O ERRORS  64800021
         BM    REPDCB76                 BRANCH YES TO CHECK ERRORS      64900021
*                                                                       65000021
*                                                                       65200021
         CLI   RSCCW1,NOPOP             HAS NOP BEEN ISSUED             65300021
         BCR   EQUAL,WRKR5              BR YES TO CONTINUE PROCESSING   65400021
*                                                                       65500021
*        IF READ OR READ BACK GO TEST FOR CHKPT RCDS/LEADING TM         65600021
*                                                                       65700021
         TM    RSCCW1,READOP            OP CODE READ OR READBACK        65800021
         BZ    REPDCB80                 BRANCH YES TO TEST RCD          65900021
*                                                                       66100021
         MVI   RSCCW1,NOPOP             CHANGE OP CODE TO NOP           66200021
         B     REPDCB49                 GO TO EXCP                      66300021
*                                                                       66400021
*                                                                       66500021
*                                                                       66600021
*                                                                       66700021
REPDCB58 EQU   *                                                        66800021
*        WAIT ON ALL WORK AREAS TO BE SURE ALL HAVE BEEN CHECKED        66900021
*        FOR I/O ERRORS                                                 67000021
*                                                                       67100021
         LR    CTABLR,TABLR             INIT TABL POINTER               67200021
*                                                                       67300021
REPDCB60 EQU   *                                                        67400021
*                                                                       67500021
         TM    TABFLG1,TABDOSTP         IS IT DOS TAPE                  67600002
         BNO   REPDCB62                 BRANCH NO TO CONTINUE           67700021
*                                                                       67800021
         L     WRKR4,TABSEGAD-D1        WORK AREA SEGMENT ADDRESS       67900021
         TM    RSSTAT1,BUSY             IS WORK AREA BUSY               68000021
         BZ    REPDCB62                 BRANCH NO TO CONTINUE           68100021
*                                                                       68200021
         LA    WAIT,ONE                 TURN ON WAIT SWITCH             68300021
         BAL WRKR5,REPDCB56             GO TO WAIT ROUTINE              68400021
*                                                                       68500021
         MVI   TABVLID2,BLANK           RESTORE BLANKS                  68600021
         MVC   TABVLID2+D1(L23),TABVLID2     TO TABL AREA               68700021
*                                                                       68800021
REPDCB62 EQU   *                                                        68900021
*                                                                       69000021
         TM    TABFLG1,TABLAST          IS THIS THE LAST ENTRY          69100002
         BO    REPDCB68                 BRANCH YES TO EXIT              69200021
*                                                                       69300021
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TABL POINTER          69400021
         B     REPDCB60                 CONTINUE WAIT PROCESSING        69500021
*                                                                       69600021
*    ****************************************************************** 69700021
*                                                                       69800021
REPDCB64 EQU   *                                                        69900021
*                                                                       70000021
*    ****************************************************************** 70100021
*                                                                       70200021
*    *** SET ERROR CODES ***                                            70300021
*                                                                       70400021
*    ****************************************************************** 70500021
*                                                                       70600021
         MVI   RSRETCOD+D1,ERR065       SET ERR CODE FOR D.S.  @ZSUT222 70700037
*                                            POSITIONING IN RSTWA       70800021
         B     REPDCBER                 BRANCH TO XCTL RESTART @ZSUT222 70900037
*                                                                       71000021
REPDCB66 EQU   *                                                        71100021
*                                                                       71200021
         MVI   RSRETCOD+D1,ERR064       SET ERR CODE FOR RECORD@ZSUT222 71300037
*                                            POSITIONING IN RSTWA       71400021
REPDCBER EQU   *                                               @ZSUT222 71420037
         MVC   RSREGSAV(8),MODID        SAVE NAME OF MODULE    @ZSUT222 71440037
*                                       DETECTING THE ERROR    @ZSUT222 71460037
         STM   0,15,RSREGSAV+8          SAVE CURRENT REGISTERS @ZSUT222 71480037
REPDCB68 EQU   *                                                        71500021
*                                                                       71600021
         L     UCBR,TABUCB              POINT TO UCB             A37817 71650021
         LR    CTABLR,TABLR             REINITIALIZE TABL POINTER       71700021
         L     WRKR4,TABSEGAD-D1        POINTER TO FIRST WORK AREA      71800021
*                                                                       71900021
         LA    WRKR3,RSCCW2             SET UP WORK AREA FOR XCTL       72000021
*                                                                       72100021
*                                                                       73600021
*    ****************************************************************** 73700021
*                                                                       73800021
*    *** DETERMINE WHICH EXIT MODULE TO TAKE ***                        73900021
*                                                                       74000021
*    ****************************************************************** 74100021
*                                                                       74200021
         MVC   D0(L8,WRKR3),RSTMODNM    NAME OF RESTART MODULE          74300021
*                                                                       74400021
         TM    RSRETCOD+D1,ERRORS       IS ERROR CODE SET               74500021
         BNE   REPDCB72                 BRANCH YES TO XCTL TO           74600021
*                                        IGC0V05B                       74700021
         TM    RSDCBFLG,DAFLAG          DA DEVICE INDICATED             74800021
         BNO   REPDCB70                 BRANCH NO                       74900021
*                                                                       75000021
         MVI   D4(WRKR3),DAMOD          SET MODULE NAME TO DA           75100021
         B     REPDCB72                  MODULE IGC0R05B - XCTL         75200021
*                                                                       75300021
REPDCB70 EQU   *                                                        75400021
*                                                                       75500021
         MVI   D4(WRKR3),AMMOD          SET NEW MODULE ID TO            75600021
*                                       ACCESS METHOD DISP.             75700021
REPDCB72 EQU   *                        MODULE IGC0T05B                 75800021
*                                                                       75900021
         LA    WRKR6,D8(WRKR3)          SET UP FOR XCTL                 76000021
         LR    WRKR2,BUFR               POINT REG 1 TO RESTART          76100021
*                                        WORK AREA                      76200021
         XCTL  EPLOC=(WRKR3),SF=(E,(15))                                76300021
*                                                                       77500021
REPDCB76 EQU   *                                                        77600021
*                                                                       77700021
*    ****************************************************************** 77800021
*                                                                       77900021
*    *** ERROR FOUND ***                                                78000021
*                                                                       78100021
*        THIS PORTION OF CODE MAY BE TAKEN OUT WHEN I/O SUPERVISOR HAS  78200021
*        PUT THE FIXES IN                                               78300021
*                                                                       78400021
*        THIS IS THE CURRENT THOUGHT PERSISTING TO THE HANDLING OF I/O  78500021
*        ERRORS                                                         78600021
*                                                                       78700021
*        ERRORS THAT HAVE OCCURRED AT CHECKPOINT TIME IS ACCEPTED       78800021
*                                                                       78900021
*    ****************************************************************** 79000021
*                                                                       79100021
         CLI   RSCCW1,READ              IS ERROR IN READ FORWARD        79200021
         BE    REPDCB78                 BRANCH YES                      79300021
*                                                                       79400021
         CLI   RSCCW1,READBACK          IS ERROR IN READ BACKWARD       79500021
         BNE   REPDCB64                 BR NO TO SET D.S. POSITIONING   79600021
*                                            ERROR CODE                 79700021
*                                                                       79800021
*                                                                       79900021
REPDCB78 EQU   *                                                        80000021
*                                                                       80100021
         CLC   TABBLK1(L4),TABBLK2      HAS POSITIONING BEEN COMPLETED  80200021
         BNE   REPDCB66                 BRANCH NO TO SET ERROR CODE     80300021
*                                                                       80400021
         TM    DCBIFLGS,ERRCHKPT        IS THERE PERMANENT ERR AT CHKPT 80500021
         BNO   REPDCB66                 BRANCH IF NOT TO SET ERROR CODE 80600021
*                                                                       80700021
         B     REPDCB52                 GO TO CONTINUE PROCESSING       80800021
*                                                                       80900021
REPDCB80 EQU   *                                                        80901021
*                                                                       80902021
*********************************************************************** 80903021
*                                                                       80904021
*    THIS SECTION OF CODE TESTS FOR THE LEADING TAPE MARK AND EMBEDDED  80905021
*    CHKPT RCDS.  FOR THE OPTIONAL LEADING TM IT SETS TABOPS FOR REWIND 80906021
*    IF THE TM IS NOT PRESENT AND PEELS THE TM TABOPS MASK OFF.  SETS   80907021
*    THE BYPASS FLAG WHEN ENCOUNTERING THE CHKPT HDR RCD - TURNS IT OFF 80908021
*    WHEN ENCOUNTERING THE CHKPT TRLR RCD.                              80909021
*                                                                       80910021
*********************************************************************** 80911021
*                                                                       80912021
         TM    TABOPS,LTM               LEADING TAPE MARK IND.          80913021
         BZ    REPDCB82                 BRANCH NO                       80914021
*                                                                       80915021
         XI    TABOPS,LTM               PEEL OFF LEADING TM MASK        80916021
*                                                                       80917021
         TM    RSIOBCSW+4,UE            UNIT EXCEPTION INDICATED        80918021
         BO    ZERO(WRKR5)              BRANCH YES TO CONTINUE          80919021
*                                                                       80920021
         OI    TABOPS,REW               SET CODE FOR REWIND             80921021
         BR    WRKR5                    CONTINUE PROCESSING             80922021
*                                                                       80923021
REPDCB82 EQU   *                                                        80924021
*                                                                       80925021
         TM    TABOPS,CHKPT             BYPASS CHKPT RCDS IND.          80926021
         BZ    ZERO(WRKR5)              BRANCH NO                       80927021
*                                                                       80928021
         CLI   RSCCW1,READBACK          IS OP CODE READBACK             80929021
         BNE   REPDCB84                 BRANCH NO                       80930021
*                                                                       80931021
         LA    WRKR6,ENDBUFF            NINETEEN                        80932021
         L     WRKR2,RSCCW1             CCW DATA ADDRESS LESS           80933021
         SR    WRKR2,WRKR6               NINETEEN TO POINT TO           80934021
         ST    WRKR2,RSCCW1              START OF 20 BYTE BUFFER        80935021
*                                                                       80936021
REPDCB84 EQU   *                                                        80937021
*                                                                       80938021
         L     WRKR6,RSCCW1             CCW DATA ADDRESS                80939021
*                                                                       80940021
         TM    TABFLG2,TABSW            BYPASS CHKPT RCD FLAG ON        80941002
         BO    REPDCB86                 BRANCH YES                      80942021
*                                                                       80943021
         CLC   CHKPTID,ZERO(WRKR6)      CHKPT HDR RCD                   80944021
         BNE   ZERO(WRKR5)              BRANCH NO TO CONTINUE           80945021
*                                                                       80946021
         OI    TABFLG2,TABSW            TURN ON BYPASS FLAG             80947002
*                                                                       80948021
         L     WRKR6,TABBLK2            GET BLOCK COUNT                 80949021
         BCTR  WRKR6,ZERO               SUBTRACT ONE                    80950021
         ST    WRKR6,TABBLK2            STORE UPDATED BLOCK CNT         80951021
         BR    WRKR5                    CONTINUE PROCESSING             80952021
*                                                                       80953021
REPDCB86 EQU   *                                                        80954021
*                                                                       80955021
         CLC   CHKPTID,ZERO(WRKR6)      CHKPT TRLR RCD                  80956021
         BNE   ZERO(WRKR5)              BRANCH NO                       80957021
*                                                                       80958021
         NI    TABFLG2,X'FF'-TABSW      TURN OFF BYPASS FLAG     Y02076 80958402
         BR    WRKR5                    CONTINUE PROCESSING             80960021
*********************************************************************** 81000021
*                                                                       81100021
*     CONSTANTS USED IN REPI/O                                          81200021
*                                                                       81300021
*********************************************************************** 81400021
*                                                                       81500021
RSTMODNM DC    CL8'IGC0V05B'            RESTART EXIT MOD                81600021
MODID    DC    CL8'IGC0U05B'            MODULE ID              @ZSUT222 81650037
CHKPTID  DC    CL12'/// CHKPT //'       CHKPT HDR/TRLR ID               81700021
*                                                                     * 81750000
*        MAINTENANCE SPACE                                       Y01909 81800000
*                                                                     * 81850000
PATCH    DC    XL((*-IGC0U05B)/20)'00'   FIVE PERCENT SPACE      Y01909 81860000
*                                                                     * 81870000
         EJECT                                                          81900021
         IEEVRSWA  VER=3                AOS2 VERSION OF WA              82000000
         EJECT                                                          82100021
RSDSECT  DSECT                                                          82200021
*                                                                       82300021
*    DATA EXTENT BLOCK                                                  82400021
*                                                                       82500021
RSDEB    DS    0CL48                                                    82600021
GETSAVE  EQU   RSDEB                                                    82700021
GOTLOC   EQU   GETSAVE+72                                               82800021
FREELIST EQU   GOTLOC+8                                                 82900021
         ORG   FREELIST                 ORG TO DEFINE FREEMAIN LIST     83000021
         FREEMAIN  V,A=GOTLOC,MF=L                                      83100021
         ORG   RSDEB                    RESET I.C.                      83200021
RSDEBTCB DC    X'00000000'              TCB ADDRESS                     83300021
RSDEBDEB DC    X'00000000'              DEB ADDRESS                     83400021
*                                                                       83500021
*    DATA CONTROL BLOCK                                                 83600021
*                                                                       83700021
RSDEBOFL DS    0CL1                                                     83800021
RSDEBIRB DC    X'00000000'              IRB ADDRESS                     83900021
RSDEBSYS DC    X'00000000'              1ST IOB ADDR IN SYS.PURGE CHAIN 84000021
RSDEBUSR DC    X'00000000'              1ST IOB ADDR IN USER PRGE CHAIN 84100021
RSDEBECB DC    X'00000000'              PARM.LIST ADDR TO PURGE ECB     84200021
RSDEBID  DS    0CL1                                                     84300021
RSDEBDCB DC    AL4(RSDCBREP)            DCB ADDR                        84400021
RSDEBAPP DS    CL4                      I/O APPENDAGE VECTOR TABLE      84500021
RSDEBMOD DS    0CL1                                                     84600021
RSDEBUCB DS    F                        UCB ADDRESS                     84700021
RSDEBBIN DS    H                        BIN NUMBER                      84800021
RSDEBSCC DS    H                        CYLINDER START ADDRESS          84900021
RSDEBSHH DS    H                        TRACK START ADDRESS             85000021
RSDEBECC DS    H                        CYLINDER END ADDRESS            85100021
RSDEBEHH DS    H                        TRACK END ADDRESS               85200021
RSDEBNTR DS    H                        NO. OF TRACKS IN THIS EXTENT    85300021
*                                                                       85400021
*    EVENT CONTROL BLOCK                                                85500021
*                                                                       85600021
RSECBAD  DS    CL4                      ECB ADDRESS                     85700021
RSDCBDEB DC    AL4(RSDEB)               DEB ADDRESS                     85800021
*                                                                       85900021
RSDCBREP EQU   RSDEB+8                  POINT TO RELATIVE BEGINNING DCB 86000021
*                                                                       86100021
*    INPUT OUTPUT BLOCK                                                 86200021
*                                                                       86300021
RSIOB    DS    0CL40                                                    86400021
RSIOBFG1 DC    X'00'                    I/O FLAGS BYTE 1                86500021
RSIOBFG2 DC    X'00'                    I/O FLAGS BYTE 2                86600021
RSIOBSN1 DS    CL1                      FIRST SENSE BYTE                86700021
RSIOBSN2 DS    CL1                      SECOND SENSE BYTE               86800021
RSIOBECB DC    AL4(RSECBAD)             ECB ADDRESS                     86900021
RSIOBCSW DS    D                        LAST CSW                        87000021
RSIOBCPA DS    AL4(RSCCW1)              CHANNEL PROGRAM ADDRESS         87100021
RSIOBDCB DS    AL4(RSDCBREP)            DCB ADDRESS                     87200021
RSIOBRCP DS    CL4                      RESTART ADDRESS FOR IOS         87300021
RSIOBINC DS    H                        INCREMENT BLOCK COUNT           87400021
RSIOBECT DS    H                        NO. OF ERROR ENTRIES            87500021
RSIOBDAD DS    D                        SEEK ADDRESS FOR DA             87600021
*                                                                       87700021
*    CHANNEL PROGRAM                                                    87800021
*                                                                       87900021
RSCCWLST DS    0CL24                                                    88000021
RSCCW1   DS    D                        CCW1                            88100021
RSCCW2   DS    D                        CCW2                            88200021
RSCCW3   DS    D                        CCW3                            88300021
*                                                                       88400021
*    BUFFER SEGMENT FOR EXTERNAL BLOCKS                                 88500021
*                                                                       88600021
RSSTATUS DS    0CL8                                                     88700021
RSSTAT1  DS    CL1                      STATUS BYTE 1                   88800021
RSSTAT2  DS    CL1                      STATUS BYTE 2                   88900021
RSSTAT3  DS    CL1                      STATUS BYTE 3                   89000021
RSSTAT4  DS    CL1                      STATUS BYTE 4                   89100021
         DS    F                        RESERVED FOR FUTURE USE         89200021
         EJECT                                                          89300021
         DCBD  DSORG=PS                                                 89400021
         EJECT                                                          89500021
         IEZDEB                                                  Y02076 89550002
DEBBYPAS EQU   DEBSTRHH                 EQUATE FOR BYPASS FLG           89600002
         EJECT                                                          93900021
         IHJDSTAB                                                Y02076 93950002
TABPOS   EQU   TABVLID2                                                 94000002
TABOPS   EQU   TABPOS                                                   94050002
TABFSFN1 EQU   TABPOS+1                                                 94100002
TABFSFN2 EQU   TABPOS+2                                                 94150002
TABBLK1  EQU   TABPOS+4                                                 94160002
TABBLK2  EQU   TABPOS+8                                                 94170002
TABUCB   EQU   TABPOS+12                                                94180002
         EJECT                                                          94200002
SRT      DSECT                                                          98900021
         IEFUCBOB                                                       99000021
         END                                                            99100021
./  ADD  SSI=82070170,NAME=IGC0W05B
         TITLE 'IGC0W05B  ISAM && BDAM DATA SET PROCESSOR'       A30552 00100020
IGC0W05B CSECT                                                          00200019
*                                                                       00250037
*STATUS CHANGE LEVEL 003                                                01300021
*                                                                       01400019
*TITLE-        ISAM & BDAM DATA SET PROCESSING                          01500020
*                                                                       01600019
*STATUS-       INITIAL CODE                                             01700019
*                                                                       01800019
*FUNCTION-     FOR ISAM, IF THE DCBMACRF DOES NOT SPECIFY 'PUT',        01900019
*              THE FORMAT 2 DSCB IS READ AND AN XCTL IS MADE TO         02000019
*              ISAM OPEN TO VALIDATE ITS POINTERS.  IF AN I/O           02100019
*              ERROR OCCURS ISAM WILL SET A RETURN CODE.                02200019
*              FOR BDAM, LOAD THE ADDRESSES OF SOME OF THE BDAM         02220020
*              ACCESS METHOD MODULES INTO SOME OF THE OTHER BDAM        02240020
*              ACCESS METHOD MODULES.                                   02260020
*                                                                       02300019
*ENTRY POINTS- THIS MODULE IS ENTERED FROM IGC0R05B                     02350002
*                                                                       02360002
*INPUT-        REGISTER  1    ADDR OF REPI/O'S WORKAREA                 02400019
*              REGISTER  8    ADDR OF FIRST TABLE ENTRY                 02500019
*              REGISTER  1    ISAM RETURN CODE                          02600019
*              REGISTER  10   REP I/O WORKAREA                          02700019
*                                                                       02800019
*OUTPUT-       SAME AS REGISTER 1 AND 8 ABOVE                           02900019
*                                                                       03000019
*EXTERNAL REFERENCES-  THE FOLLOWING BDAM MODULES MAY BE LOADED,        03010020
*              ALTERED, AND DELETED, DEPENDING ON THE BDAM DEB SUB IDS  03020020
*              IGG019KA, IGG019KC, IGG019KE, IGG019KF,                  03030020
*              IGG019KI, IGG019KJ, IGG019KK, IGG019KL,                  03040020
*              IGG019KN, IGG019KO, IGG019KQ, IGG019KR,                  03050020
*              IGG019KW, IGG019KY, IGG019LA                             03060020
*                                                                       03070020
*EXITS-        TO ISAM OPEN EXECUTOR(IGG01920 OR IGG01950)              03100019
*              NORMAL TO IGC0T05B                                       03200019
*              ERROR  TO IGC0V05B                                       03300019
*                                                                       03400019
*              ERROR 74 - ERROR READING DSCB                            03430037
*              ERROR 77 - ERROR OPENING ISAM DATASET                    03450037
*CHANGE ACTIVITY                                                        03500037
*                                                                       03504037
*0000                                                            Y01021 03508037
*          RELEASE 20 DELETIONS                                         03512037
*3579001000,015000,410000-411000                                 A30552 03516037
*          RELEASE 21 DELETIONS                                         03520037
*0791346000-347000                                               M0187  03524037
*0791                                                            A43758 03528037
*0791409130-409140,468000                                        A35821 03532037
*0791409031-409036,409121-409138                                 A35339 03536037
*          RELEASE 22 DELETIONS                                         03540037
*          RELEASE 23 DELETIONS                                         03544037
*          RELEASE 24 DELETIONS                                         03548037
*          RELEASE 25 DELETIONS                                         03552037
*          RELEASE 26 DELETIONS                                         03556037
*          RELEASE 27 DELETIONS                                         03560037
*          RELEASE 28 DELETIONS                                         03564037
*                                                                       03568037
*     OS/VS2 RELEASE 030 ADDS/DELETIONS/CHANGES                         03572037
*242104-242265                                                  ZA00104 03576037
*241920                                                         ZA02542 03580037
*A241810-241840                                                @ZA08277 03584037
*                                                                       03588037
*     OS/VS2 RELEASE 037 ADDS/DELETIONS/CHANGES                         03592037
*D241810-241840                                                @ZA12948 03596037
* APAR OZ31495 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 03600037
*C174000,174500,293500,293600,305000                           @ZSUT222 03600637
*A293700,293800,305100-305400,433100                           @ZSUT222 03602037
*ATTRIBUTES-   RE-ENTRANT                                               03604037
*              RE-USABLE                                                03608037
*              ENABLED                                                  03612037
*              PRIVILEGED                                               03616037
*                                                                       03620037
*NOTES-                                                                 03624037
*  THE SPECIAL BDAM STORES ARE ONLY REQUIRED IN CASE THE MODULES        03628037
*  RESIDE IN THE RESIDENT ACCESS METHOD AREA, AND SO ARE NOT            03632037
*  RESTORED WHEN THE USER'S MAIN STORAGE IS RESTORED.                   03636037
*  BDAM IS NON-STANDARD IN THAT OPEN EXECUTOR MODULE IGG0193C DOES      03640037
*  THESE STORES INTO RE-ENTRANT MODULES.                                03644037
*                                                                       03648037
*TABLES/WORKAREAS-                                                      03652037
*                                                                       03656037
   EJECT                                                                03660037
*********************************************************************** 03700019
*                                                                     * 03800019
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 03900019
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 04000019
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 04100019
*    IS 48 BYTES LONG.                                                * 04200019
*                                                                     * 04300019
*********************************************************************** 04400019
*                                                                       04500019
*        ------------------- 4 BYTES -----------------                  04600019
*                                                                       04700019
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  04800019
*        +DATA SET  +           DCB                  +                  04900019
*        + O-GN.    +         ADDRESS                +                  05000019
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                05100019
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  05200019
*        + NO. 1    +         ADDRESS                +                  05300019
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  05400019
*        +NUMBER    +         JFCB TTR               +                  05500019
*        + OF VOLS  +         ADDRESS                +                  05600019
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               05700019
*                                                                       05800019
*     12 +++++++++++++++++++++++                                        05900019
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   06000019
*        +INFO BYTE + NUMBER   +                                        06100019
*        +++++++++++++++++++++++                                        06200019
*                                                                       06300019
*     12 +++++++++++++++++++++++                                        06400019
*        +    OLD   TIOT       +        DA AND UNIT RECORD              06500019
*        +      OFFSET         +                                        06600019
*        +++++++++++++++++++++++                                        06700019
*                                                                       06800019
*                              +++++++++++++++++++++++                  06900019
*                              +FLAG BYTE +FLAG BYTE +                  07000019
*                              +  NO. 2   +  NO. 3   +                  07100019
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  07200019
*        +FLAG BYTE +FLAG BYTE +                     +                  07300019
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  07400019
*        +++++++++++++++++++++++                     + 20               07500019
*        +                                           +                  07600019
*        +                                           +                  07700019
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  07800019
*        +                                           +                  07900019
*        +   VOLUME ID NO. 2                         +                  08000019
*        +                     +++++++++++++++++++++++ 28               08100019
*        +                     +                     +                  08200019
*        +                     +   VOLUME ID NO. 3   +                  08300019
*     32 +++++++++++++++++++++++                     +                  08400019
*        +                                           +                  08500019
*        +                                           +                  08600019
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               08700019
*        +                                           +                  08800019
*        +   VOLUME ID NO. 4                         +                  08900019
*     40 +                     +++++++++++++++++++++++                  09000019
*        +                     +                     +                  09100019
*        +                     +                     +                  09200019
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               09300019
*        +                                           +                  09400019
*        +                                           +                  09500019
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               09600019
*                                                                       09700019
    EJECT                                                               09800037
*********************************************************************** 10400019
*                                                                       10500019
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               10600019
*                                                                       10700019
*********************************************************************** 10800019
*                                                                       10900019
WRKR1    EQU   0                        WDRK/PARAMETER REGISTER         11000019
WRKR2    EQU   1                        WDRK/PARAMETER REGISTER         11100019
DCBR     EQU   2                        CURRENT DCB REGISTER            11200019
BASER    EQU   3                        BASE REGISTER                   11300019
DEBR     EQU   4                        CURRENT DEB REGISTER            11400019
UCBR     EQU   5                        CURRENT UCB REGISTER            11500019
TIOTR    EQU   6                        NEW TIOT REGISTER               11600019
TCBR     EQU   7                        TCB REGISTER                    11700019
TABLR    EQU   8                        BEGINNING TO DCB TABLE REG      11800019
CTABLR   EQU   9                        CURRENT ENTRY IN DCB TABLE      11900019
BUFR     EQU   10                       USER BUFFER AREA                12000019
DSCNTR   EQU   11                       WORK REGISTER                   12100019
WRKR3    EQU   12                       WORK REGISTER                   12200019
WRKR4    EQU   13                       WORK REGISTER                   12300019
WRKR5    EQU   14                       WORK/PARAMETER REGISTER         12400019
WRKR6    EQU   15                       WORK/PARAMETER REGISTER         12500019
*                                                                       12600019
*********************************************************************** 12700019
*                                                                       12800019
*    OFFSETS TO BE USED IN REPI/O PHASE                                 12900019
*                                                                       13000019
*********************************************************************** 13100019
*                                                                       13200019
READEX   EQU   X'02'                    BDAM READ EXCLUSIVE      A35821 13250021
IS       EQU   X'80'                    INDEXED SEQUENCIAL              13300019
PS       EQU   X'40'                    PHYSICAL SEQUENCIAL             13400019
DA       EQU   X'20'                    DIRECT ACCESS                   13500019
PO       EQU   X'02'                    PARTITIONED ORGANIZATION        13600019
NULL     EQU   X'80'                    NULLFILE OR SYSCHECK            13700019
INOROUT  EQU   X'40'                    SYSIN OR SYSOUT DATA SET        13800019
DADEV    EQU   X'20'                    DA DEVICE                       13900019
TPDEV    EQU   X'10'                    TAPE DEVICE                     14000019
LASTENT  EQU   X'08'                    LAST ENTRY                      14100019
UNITREC  EQU   X'04'                    UNIT RECORD EQUIPMENT           14200019
ERRINNSL EQU   X'80'                    ERROR IN NSL ROUTINE            14300019
NSLMTSW  EQU   X'40'                    NSL MOUNT SWITCH                14400019
NSLCOMU  EQU   X'20'                    NSL COMMUNICATION BIT           14500019
BYPASS   EQU   X'10'                    BYPASS LABEL PROCESSING         14600019
NSL      EQU   X'04'                    NON-STANDARD LABEL              14700019
SL       EQU   X'02'                    STANDARD LABEL                  14800019
NL       EQU   X'01'                    NO LABEL                        14900019
GTR5VOL  EQU   X'80'                    GREATER THAN 5 VOLUMES          15000019
POCONCAT EQU   X'40'                    P.O. CONCATENATED               15100019
DAFLAG   EQU   X'80'                    DA DATA SET FLAG                15200019
NONDAFLG EQU   X'40'                    NON-DA DATA SET FLAG            15300019
NSLFLAG  EQU   X'10'                    NSL ROUTINE FLAG                15400019
TYPERST  EQU   X'80'                    IMMEDIATE RESTART               15500019
TABENT   EQU   48                       TABLE ENTRY LENGTH              15600019
WRITE    EQU   X'01'                    WRITE ON TAPE                   15700019
READ     EQU   X'02'                    READ FOR TAPE                   15800019
NOPOP    EQU   X'03'                    NOP                             15900019
SENSE    EQU   X'04'                    SENSE                           16000019
REWIND   EQU   X'07'                    REWIND                          16100019
READBACK EQU   X'0C'                    READBACK                        16200019
UNLOAD   EQU   X'0F'                    REWIND AND UNLOAD               16300019
WTM      EQU   X'1F'                    WRITE TAPE MARK                 16400019
BSFOP    EQU   X'2F'                    BACKWARD SPACE FILE             16500019
FSFOP    EQU   X'3F'                    FORWARD SPACE FILE              16600019
SEARCH   EQU   X'31'                    SEARCH                          16700019
SRCHCNT  EQU   X'05'                    COUNT FOR SEARCH ID             16800019
TIC      EQU   X'08'                    TIC                             16900019
READDA   EQU   X'06'                    READ FOR DA                     17000019
LENJFCB  EQU   X'B0'                    LENGTH OF JFCB                  17100019
LBLLEN   EQU   X'50'                    LENGTH OF LABEL                 17200019
PERMERR  EQU   X'7F'                    PERMANENT ERROR                 17300019
ERR074   EQU   74                       I/O ERROR READING DSCB @ZSUT222 17400037
ERR077   EQU   77                       ISAM OPEN ERROR        @ZSUT222 17450037
ISORDA   EQU   IS+DA                    IS OR DA                        17700019
IOERROR  EQU   X'20'                    PERMANENT I/O ERROR             17800019
FILETYPE EQU   X'00'                    FILE TYPE BYTE                  17900019
THREE    EQU   X'03'                    TEST IF DSCB EXTN IS TO BE READ 18000019
READKND  EQU   X'0E'                    READ KEY AND DATA               18100019
LENGTH   EQU   X'8C'                    LENGTH OF KEY AND DATA          18200019
OUTP     EQU   X'0F'                    OUTPUT (DEBOPATB)               18300019
EXCHPGM  EQU   X'80'                    EXCP                            18400019
DADEVDPT EQU   X'0C'                    DA DEVICE DEPENDENT SECTION     18500019
WRITEDA  EQU   X'05'                    WRITE FOR DA                    18600019
SEVEN    EQU   X'07'                    TEST FOR GETTING UPPER LIMIT    18700019
LENDSCB  EQU   X'60'                    LENGTH OF DSCB                  18800019
DEBID    EQU   X'0F'                    DEB IDENTIFICATION              18900019
MAXEXT   EQU   X'CA'                    MAXIMUM NO. OF EXTENT           19000019
UNREL    EQU   X'02'                    UNRELATED FLAG                  19100019
TKBAL    EQU   25                       TRACK BALANCE SVC ROUTINE       19200019
D0       EQU   0                        CONSTANT ZERO            Y02076 19250002
D1       EQU   1                        CONSTANT ONE             Y02076 19260002
D2       EQU   2                        CONSTANT TWO             Y02076 19270002
D4       EQU   4                        CONSTANT FOUR            Y02076 19290002
D152     EQU   152                      CONSTANT ONE FIFTY TWO   Y02076 19294002
DFF      EQU   X'FF'                    CONSTANT FOX FOX         Y02076 19296002
*                                                                       19300019
*                                                                       19400019
*********************************************************************** 19500019
*                                                                       19600019
   EJECT                                                                19650037
         BALR  BASER,0                  ESTABLISH ADDRESSIBILITY        19700019
         USING *,BASER                                           Y01909 19800000
*                                                                       19900019
         USING RSTWA,BUFR                                               20000019
         USING IHADCB,DCBR                                              20100019
         USING TABL,CTABLR                                              20200019
         USING FORECORE,UCBR                                            20300019
         USING TCB,TCBR                                                 20400019
         USING DEBBASIC,DEBR                                     Y02076 20500002
         USING CVT,WRKR2                                                20600019
         USING TIOENTRY,WRKR5                                           20700019
*                                                                       20800019
REPDCB00 EQU   *                                                        20900019
         B     BEGIN                    BRANCH TO EYE CATCHER    Y01909 20950000
         CNOP  0,8                      ALIGN TO DOUBLE WD BOUND Y01909 20960000
         DC    CL8'IGC0W05B'            MODULE NAME            @ZSUT222 20970037
         DC    CL8'&SYSDATE'            LAST DATE SHIPPED      @ZSUT222 20972037
         DC    CL8'@ZSUT222'            LAST CODE SHIPPED      @ZSUT222 20974037
BEGIN    EQU   *                                                 Y01909 20980000
*                                                                       21000019
         MODESET EXTKEY=ZERO                                     Y02076 21050002
         TM    TABFLG2-TABL(TABLR),TABSW  RETURN  FROM  ISAM     Y02076 21100002
         BO    REPDCB54                 YES - BRANCH                    21200019
*                                                                       21300019
         MVI   RSRETCOD+1,X'00'         RESET RETURN CODE               21400019
         LR    CTABLR,TABLR             INITIALIZE CTABLR               21500019
         B     REPDCB02                 BRANCH TO TEST FOR TYPE OF D.S. 21700019
*                                                                       21800019
*********************************************************************   21900019
*                                                                       22000019
******** TEST FOR ISAM DATA SET                                         22100019
*                                                                       22200019
*********************************************************************   22300019
*                                                                       22400019
REPDCB01 EQU   *                                                        22500019
*                                                                       22600019
         LA    CTABLR,TABENT(CTABLR)    POINT TO NEXT TABL ENTRY        22700019
*                                                                       22800019
REPDCB02 EQU   *                                                        22900019
*                                                                       23000019
         L     DCBR,TABDCBAD-1          LOAD DCB ADDR            YM5512 23050002
         TM    DCBMACRF,EXCHPGM         TEST ACCESS METH.        YM5512 23060002
         BO    REPDCB04                 BR IF NO ACC. METH.      YM5512 23070002
         TM    TABDSORG,IS              IS IT ISAM                      23100019
         BO    REPDCB10                 IF SO, PROCESS IT               23200019
*                                                                       23300019
         TM    TABDSORG,DA              IS IT BDAM               A30552 23320020
         BO    BDAMSTRT                 IF SO, PROCESS IT        A30552 23340020
*                                                                       23360020
REPDCB04 EQU   *                                                        23400019
*                                                                       23500019
         TM    TABFLG1,TABLAST          TEST FOR LAST ENTRY             23600002
         BO    ENDUP                    YES - BRANCH                    23700019
*                                                                       23800019
         B     REPDCB01                 GO TEST TABL ENTRY              23900019
*                                                                       24000019
REPDCB10 EQU   *                                                        24100019
*********************************************************************** 24150002
*   GET SPACE FOR ISAM OPEN EXECUTORS WORK AREA IN SUBPOOL 230(KEY 5) * 24160002
*   THEN CLEAR IT AND PREPARE FOR READING IN THE DSCB                 * 24170002
*********************************************************************** 24180002
         LA    WRKR1,DSECTSIZ+ISDCBLNG  GET LNGTH-FORECORE WA   ZA02542 24192002
         S     WRKR1,DCBFRS16           SUBTRCT 1ST 16 BYTES     Y02076 24196002
         ST    WRKR1,SAVSPLNG           SAVE LENGTH OF SPACE     Y02076 24198002
         LR    WRKR3,WRKR1              SAVE IN WRKR3 FOR CLEAR  Y02076 24198402
         ICM   WRKR1,HIORDER,SP230      INSERT SUBPOOL 230       Y02076 24198802
         MODESET EXTKEY=DATAMGT         GET INTO KEY 5           Y02076 24198902
         GETMAIN  R,LV=(WRKR1)          GET SPACE FOR ISAM       Y02076 24199202
         MODESET EXTKEY=ZERO            BACK TO KEY 0            Y02076 24199302
         LR    UCBR,WRKR2               ADR OF SPACE TO UCBR     Y02076 24199602
         SR    WRKR2,WRKR2              CLEAR WRKR2 FOR CLEAR    Y02076 24199702
         LA    WRKR3,0(WRKR3)           GET LNGTH OF ISAM SPACE  Y02076 24206402
         SRL   WRKR3,2                  DIVIDE BY 4 FOR COUNT    Y02076 24208402
         LR    WRKR5,UCBR               GET BEGIN ADDR OF SPACE ZA00104 24210402
REPDCB12 EQU   *                        INSTR MUST FOLLOW        Y02076 24213102
         ST    WRKR2,D0(WRKR5)          GET LNGTH OF ISAM SPACE ZA00104 24219802
         LA    WRKR5,D4(WRKR5)          INDEX TO NXT 4 BYTES    ZA00104 24226502
         BCT   WRKR3,REPDCB12           BR BACK UNTIL ALL CLEAR  Y02076 24233202
         MVC   DXUDCBAD(D4),TABDCBAD-D1 MOVE USER'S DCB ADR      Y02076 24243202
         L     TCBR,RSTCBAD             GET ADR OF TCB           Y02076 24253202
         MVC   DXUKEY(D1),TCBPKF        SAVE PROTECT KEY IN WA   Y02076 24263202
*                                                                       24266702
*********************************************************************   24300019
*                                                                     * 24400019
******** READ FORMAT TWO DSCB                                           24500019
*                                                                     * 24600019
*********************************************************************   24700019
*                                                                       24800019
         BAL   WRKR5,BLDCCWS            BRANCH TO BUILD CCW LIST SBRTN  25100019
*                                                                       25200019
*                                                                       25300019
         EXCP  DXIOB                                                    25400019
*                                                                       25500019
*********************************************************************   25600019
*                                                                       25700019
******** WAIT FOR COMPLETION OF READ                                    25800019
*                                                                       25900019
*********************************************************************   26000019
*                                                                       26100019
         WAIT  ,ECB=DXECB                                               26200019
*                                                                       26300019
         TM    DXECB,IOERROR            TEST FOR PERM I/O ERROR         26400019
         BZ    REPDCB68                 BRANCH IF ERROR           M3251 26500019
*                                                                       26600019
REPDCB22 EQU   *                                                        26700019
*                                                                       26800019
*********************************************************************   26900019
*                                                                       27000019
******** THE DSCB HAS BEEN SUCCESSFULLY READ                            27100019
*        COPY DCB INTO ISAM WORK AREA THEN XCTL TO OPEN EXECUTORS       27150002
*                                                                       27200019
*********************************************************************   27300019
*                                                                       27400019
         L     WRKR3,TABDCBAD-D1        GET ADR OF USER'S TCB    Y02076 27450002
         LA    WRKR3,0(WRKR3)           CLEAR HI ORDER BYTE      Y02076 27460002
         A     WRKR3,DCBFRS16           ADD 16                   Y02076 27470002
         LA    WRKR2,ISDCBLNG           GET LNGTH OF ISAM DCB    Y02076 27480002
         S     WRKR2,DCBFRS16           SUBT 16 FOR MOVE COUNT   Y02076 27490002
         BCTR  WRKR2,0                  DECREASE MOVE CNT BY 1   Y02076 27492002
         EX    WRKR2,ISDCBMOV           MOVE DCB TO SP230 SPACE  Y02076 27494002
         LA    WRKR1,X254(,UCBR)        GET ADR WHERE DCB COPIED YM7370 27496002
         STCM  WRKR1,ADDRBYTS,TABDCBAD  ADR OF COPIED DCB TO TAB Y02076 27498402
         LR    DEBR,UCBR                POINT REG4 AT OPEN WKAREA       27500019
         OI    TABFLG2-TABL(TABLR),TABSW SET ON RESTART SW              27600002
         SR    TCBR,TCBR                ZERO REG7 FOR OPEN SW           27700019
         LA    WRKR3,IGG01920           ISAM OPEN EXECUTOR              27800019
         TM    DCBRECFM,X'80'           FIXED FORMAT RECORDS            27900019
         BO    REPDCB25                 YES, BRANCH                     28000002
         LA    WRKR3,IGG01950           GO TO VLR OPEN EXECUTOR         28100019
REPDCB25 EQU   *                                                 YM7370 28110002
         LA    TIOTR,DXCCW1             SETUP WORKAREA FOR XCTL  Y01021 28120002
         MODESET EXTKEY=DATAMGT         GET INTO KEY 5           YM7370 28150002
         B     XCTL                     IF NOT                          28200019
*                                                                       28300019
REPDCB54 EQU   *                                                        28400019
*                                                                       28500019
*********************************************************************   28600019
*                                                                     * 28700019
******** CONTROL RETURNS HERE FROM ISAM OPEN.                           28800019
*                                                                     * 28900019
*********************************************************************   29000019
*                                                                       29100019
         NI    TABFLG2-TABL(TABLR),X'FF'-TABSW RESET RS SW       Y02076 29150002
         LTR   WRKR2,WRKR2              IS THERE AN ERROR RETURN CODE   29300019
         BZ    AROUND                   BRANCH IF NO ERROR     @ZSUT222 29350037
         MVI   RSRETCOD+1,ERR077        SET ISAM OPEN ERROR    @ZSUT222 29360037
         B     REPDCB69                 BRANCH TO XCTL         @ZSUT222 29370037
AROUND   EQU   *                                               @ZSUT222 29380037
         MVC   TABDCBAD-D1(D4),DXUDCBAD RESTORE USER'S DCB ADR   Y02076 29400002
         ICM   WRKR1,ADDRBYTS,SAVSPLNG+D1                        Y02076 29450002
         ICM   WRKR1,HIORDER,SP230      SUBPOOL NUMBER           Y02076 29460002
         LR    WRKR2,UCBR               ADR OF SP230 SPACE       Y02076 29470002
         MODESET EXTKEY=DATAMGT         GET INTO KEY 5           Y02076 29472002
         FREEMAIN  R,LV=(WRKR1),A=(WRKR2)  FREE THE SPACE        Y02076 29480002
         MODESET  EXTKEY=ZERO           BACK TO KEY 0            Y02076 29490002
         XC    RSERAS00,RSERAS00        CLEAR SCRATCH WORD       Y02076 29490402
         B     REPDCB04                 BR TO GET NEXT ENTRY     Y02076 29492002
*                                                                       29500019
REPDCB68 EQU   *                                                        29600019
*                                                                       29700019
*********************************************************************** 29800019
*                                                                     * 29900019
******** THIS ROUTINE IS ENTERED IF AN I/O ERROR OCCURRED READING A   * 30000019
* FILE MARK.                                                          * 30100019
*                                                                     * 30200019
*********************************************************************** 30300019
*                                                                       30400019
         MVI   RSRETCOD+1,ERR074        SET DSCB ERROR CODE    @ZSUT222 30500037
REPDCB69 EQU   *                                               @ZSUT222 30510037
         MVC   RSREGSAV(8),MODID        SAVE NAME OF MODULE    @ZSUT222 30520037
*                                       DETECTING ERROR        @ZSUT222 30530037
         STM   0,15,RSREGSAV+8          SAVE CURRENT REGISTERS @ZSUT222 30540037
         LA    WRKR3,RSTMODNM           POINT WRKR3 TO 'IGC0V05B'       30600019
         LA    TIOTR,RSERAS06           SETUP WORKAREA FOR XCTL  YM7370 30650002
         B     XCTL                     BRANCH TO XCTL RTN              30700002
*                                                                       30800019
ENDUP    EQU   *                                                        30900019
*                                                                       31000019
         LA    WRKR3,IGC0T05B           POINT TO NEXT REPI/O MODULE     31100019
         LA    TIOTR,RSERAS06           SETUP WORKAREA FOR XCTL  YM7370 31150002
*                                                                       31200019
XCTL     EQU   *                                                        31300019
*                                                                       31400019
         MVC   0(8,TIOTR),0(WRKR3)      MOVE NEXT MODULE NAME TO WKAREA 31600019
         LA    WRKR6,8(TIOTR)           INITIALIZE WRKR6 (REG 15)       31700019
*                                                                       31800019
*********************************************************************   31900019
         LR    WRKR2,BUFR               POINT REG 1 TO THE RESTART W/A  32000019
*********************************************************************   32100019
*                                                                       32200019
         XCTL  EPLOC=(TIOTR),SF=(E,(15))                                32300019
*                                                                       32400019
*                                                                       32500019
BLDCCWS  EQU   *                                                        32600019
*                                                                       32700019
*********************************************************************** 32800019
*                                                                     * 32900019
******** THIS ROUTINE GETS THE UCB AND DISK ADDRESS OF THE F2 DSCB    * 33000019
* AND PUTS IT IN THE WORKAREA.  IT ALSO CONSTRUCTS THE CCWS AND       * 33100019
* CONTROL BLOCKS NECESSARY FOR READING THE DSCB.                      * 33200019
*                                                                     * 33300019
*********************************************************************** 33400019
*                                                                       33500019
         L     WRKR2,CVTPTR             GET COMM VECTOR TABLE           33600019
         L     WRKR1,CVTXAPG            ADR OF APP. VECT. TBL.   Y02076 33650002
         ST    WRKR1,DXDEBAPP           STORE IN DEB FOR EXCP    Y02076 33700002
         MVI   DXDEBNTR,X'7F'           SET MAX NO. TRACKS       M0187  34050002
         MVI   DXDEBNTR+D1,DFF                                   Y02076 34060002
*                                                                       34100019
         LA    WRKR1,DXDCB              GET ADDR OF RESTART DCB         34200019
         ST    WRKR1,DXDEBDCB           STORE IT IN DEB                 34300019
         MVI   DXDEBID,DEBID            STORE ID FOR DEB                34400019
         XC    DXDEBSCC(8),DXDEBSCC     CLEAR DEB END AND START CCHH'S  34500019
*                                                                       34800019
         L     DCBR,TABDCBAD-1          GET USER'S DCB ADDR             34900019
         L     DEBR,DCBDEBAD            POINT TO USER'S DEB             35000019
         L     WRKR2,32(DEBR)           GET DEBFIEAD                    35100019
         LA    WRKR2,0(WRKR2)           CLEAR HIGH BYTE                 35200019
         LTR   WRKR2,WRKR2              TEST FOR INDEX EXTENT           35300019
         BNZ   TSTMODE                  IF PRESENT, BR--F2 DSCB IS HERE 35400019
         L     WRKR2,36(DEBR)           GET FIRST PRIME VOL INSTEAD     35500019
TSTMODE  EQU   *                                                        35600019
         MVC   DXDEBUCB+1(3),1(WRKR2)   UPDATE UCB ADDRESS              35700019
         LR    WRKR2,DEBR               GET DEB ADDR FOR CALC    Y02049 35750002
         LA    WRKR6,DEBPRFLN           GET LENGTH OF DEB PREFIX Y02049 35800002
         SR    WRKR2,WRKR6              POINT TO DEB PREFIX      Y02049 35850002
         USING DEBPREFX,WRKR2                                    Y02049 35860002
         L     WRKR2,DEBXTNP            POINT TO DEB EXTENSION   Y02049 35870002
         USING DEBXTN,WRKR2                                      Y02049 35880002
         TM    DEBXMCF2,DCBMRMVP+DCBMRLCP IS IT LOAD MODE        Y02049 35890002
         BZ    TSTSCAN                  NO, BRANCH                      35900019
         MVC   DCBWKPT4+1(3),DXDEBUCB+1 UPDATE F2 UCB ADDR IN DCB       36000019
         B     REPDCB04                 GET NEXT DCB                    36100019
TSTSCAN  EQU   *                        INSTR MUST FOLLOW        Y02049 36150002
         TM    DEBXMCF1,DCBMRGET        IS IT SCAN MODE ?        Y02049 36200002
         BZ    BISAM                    NO, BRANCH--IT MUST BE BISAM    36300019
         DROP  WRKR2                                             Y02049 36350002
         MVC   DXDAADDR+3(5),DCBWKPT3   CCHHR OF F2 DSCB                36400019
         MVC   DCBWKPT4+1(3),DXDEBUCB+1 GET UCB OF F2 DSCB INTO DCB     36500019
         B     BOTH                                                     36600019
BISAM    L     WRKR2,DCBWKPT2           GET BISAM WORKAREA BASE         36700019
         USING IHADCW,WRKR2                                             36800019
         MVC   DXDAADDR+3(5),DCWOPCLS   CCHHR OF F2 DSCB                36900019
         MVC   DCWOPCLS+5(3),DXDEBUCB+1 GET UCB ADDR INTO BISAM WKAREA  37000019
BOTH     EQU   *                                                        37100019
*                                                                       37200019
         LA    WRKR2,DXDEB              GET DEB ADDR                    37300019
         ST    WRKR2,DXDCBDEB           STORE IN DCB                    37400019
* SET DEB EXTENTS TO COVER ENTIRE VOLUME.  START CCHH IS ZERO, END      37405021
* CC IS OBTAINED FROM DEVICE CHARACTERISTICS TABLE.                     37410021
*                                                                       37415021
         L     WRKR2,CVTPTR             FOLLOW POINTERS          M0187  37420021
         USING CVT,WRKR2                                         M0187  37425021
         L     WRKR2,CVTZDTAB           POINT AT DEVTAB          M0187  37430021
         DROP  WRKR2                                             M0187  37435021
         L     WRKR6,DXDEBUCB           POINT AT UCB FOR DEVICE  M0187  37440021
         USING SRT,WRKR6                                         M0187  37445021
         IC    WRKR6,UCBTBYT4           PICK UP INDEX TO DEVTAB  M0187S 37450021
*                                       INDICE                   M0187  37455021
         DROP  WRKR6                                             M0187  37460021
         N     WRKR6,MASK1              USE ONLY LO-ORDER 4 BITS M0187  37465021
         IC    WRKR6,0(WRKR2,WRKR6)     DEVTAB INDEX, THIS       M0187  37470021
*                                       DEVTYPE                  M0187  37475021
         AR    WRKR2,WRKR6              POINT TO DEVTAB ENTRY    M0187  37480021
         MVC   DXDEBECC,0(WRKR2)        EXTRACT HIGHEST CC FOR   M0187  37485021
*                                       VOLUME                   M0187  37490021
         MVC   DXDEBBIN(D2),BINUMSI     SET BIN NO.=0000         Y02076 37492002
         MVI   DXDEBUSR,NMEXTS1         SET NO. OF EXTS.=1       Y02076 37494002
         MVI   DXDEBAPP,EXSCLS1         SET EXT SCALE=4          Y02076 37496002
         MVI   DXDEBMOD,DVMODS1         SET FILE MASK=C0         Y02076 37498002
*                                                                       37500019
*********************************************************************   37600019
*                                                                     * 37700019
******** COMPLETE IOB                                                 * 37800019
*                                                                     * 37900019
*********************************************************************   38000019
*                                                                       38100019
         MVI   IOBFLAG1,UNREL           MAKE I/O UNRELATED              38200019
         LA    WRKR2,DXDCB              GET DCB ADDR                    38300019
         ST    WRKR2,IOBWGHT            STORE IN IOB                    38400019
         LA    WRKR2,DXECB              GET ECB ADDR                    38500019
         ST    WRKR2,IOBECBPT           STORE IN IOB                    38600019
         LA    WRKR2,DXCCW              GET CCW STRING ADDR             38700019
         ST    WRKR2,IOBSIOCC           STORE IN IOB                    38800019
*                                                                       38900019
*********************************************************************   39000019
*                                                                     * 39100019
******** GET THE BIN NUMBER AND PUT IT INTO THE DEB.                  * 39200019
*                                                                     * 39300019
*********************************************************************   39400019
*                                                                       39500019
         LA    WRKR6,16                 LOAD 16 INTO WRKR6              39600019
         SR    DEBR,WRKR6               POINT TO BBCCHHR, FRONT OF DEB  39700019
         MVC   DXDAADDR+1(2),1(DEBR)    MOVE BB TO WORKAREA             39800019
         MVC   DXDEBBIN(2),1(DEBR)      MOVE BB TO DEB                  39900019
*                                                                       40000019
         XC    DXCCW(24),DXCCW          CLEAR THE CHAN PROG AREA        40100019
         LA    WRKR6,DXDAADDR+3         POINT TO CCHHR                  40200019
         ST    WRKR6,DXCCW1             STORE IN SEARCH INSTRUCTION     40300019
         LA    WRKR6,DXCCW1             POINT TO SEARCH INSTRUCTION     40400019
         ST    WRKR6,DXCCW2             STORE IT IN TIC INSTRUCTION     40500019
         LA    WRKR6,DXJBF              POINT TO JFCB                   40600019
         ST    WRKR6,DXCCW3             STORE IT IN READ DATA INSTR.    40700019
         OC    DXCCW(24),CCWLIST        OR IN CHANNEL PROGRAM           40800019
         BR    WRKR5                    BRANCH OUT OF SBRTN VIA WRKR5   40900019
*                                                                       40901020
*********************************************************************** 40902020
*                                                                     * 40903020
*  DETERMINE IF A READ EXCLUSIVE LIST EXISTS FOR BDAM DATA SETS       * 40905002
*  IF SO, PROVIDE SPACE IN SUBPOOL 230(KEY 5) FOR THE LIST TO BE      * 40907002
*  MOVED INTO.  CLEAR THE SPACE AND STORE ITS ADDR IN DEB EXTENTION   * 40909002
*                                                                     * 40910020
*********************************************************************** 40911020
*                                                                       40912020
BDAMSTRT EQU   *                                                 A35339 40912121
         L     DCBR,TABDCBAD-1          LOAD DCB ADDRESS         A35339 40913121
         L     DEBR,DCBDEBAD            LOAD DEB ADDR FROM DCB   A30552 40915020
         TM    DCBOPTCD,RDEXLST         DOES READ EXCL LIST XST  Y02076 40915102
         BZ    REPDCB04                 BRANCH IF NO             Y02076 40916802
         MODESET  EXTKEY=DATAMGT        GET INTO KEY 5           Y02076 40918802
         ICM   WRKR1,ADDRBYTS,RDEXLNGH  GET 152 BYTES FOR BDAM   Y02076 40920802
         ICM   WRKR1,HIORDER,SP230      SUBPOOL 230              Y02076 40920902
         GETMAIN  R,LV=(WRKR1)          ISSUE GETMAIN            Y02076 40921002
         XC    D0(D152,WRKR2),D0(WRKR2) CLEAR BDAM SP230 SPACE   Y02076 40921102
         LR    WRKR3,DEBR               GET DEB ADDR             YM7342 40921402
         LA    WRKR1,DEBPRFLN           GET PREFIX LENGTH        Y02076 40921802
         SR    WRKR3,WRKR1              BEGIN ADDR OF PREFIX     Y02076 40921902
         USING DEBPREFX,WRKR3                                    Y02076 40922102
         L     WRKR3,DEBXTNP            GET ADR OF DEB EXTENTION Y02076 40922502
         DROP  WRKR3                                             Y02076 40922602
         USING DEBXTN,WRKR3                                      Y02076 40922702
         ST    WRKR2,DEBXXARG           SAVE AREA ADR IN DEB XT  Y02076 40922802
         DROP  WRKR3                                             Y02076 40923102
         MODESET  EXTKEY=ZERO           GET BACK INTO KEY 0      Y02076 40923502
         B     REPDCB04                 GO GET NEXT ENTRY        Y02076 40923602
*                                                                       41198302
*********************************************************************   41200019
*                                                                     * 41300019
*     CHANNEL PROGRAM USED BY REPI/O                                    41400019
*                                                                     * 41500019
*********************************************************************   41600019
*                                                                     * 41700019
CCWLIST  DS    0CL24                                                    41800019
         DC    X'3100000040000005'      SEARCH.                         41900019
         DC    X'08'                    TIC                             42000019
ZERO     DC    X'00000000000000'        ZERO                            42100019
         DC    X'0E0000000000008C'      READ KEY-DATA                   42200019
*                                                                     * 42300019
*********************************************************************   42400019
*                                                                     * 42500019
*     CONSTANTS USED IN REPI/O                                          42600019
*                                                                     * 42700019
*********************************************************************   42800019
*                                                                     * 42900019
IGG01920 DC    CL8'IGG01920'            ISAM OPEN EXECUTOR              43000019
IGG01950 DC    CL8'IGG01950'            ISAM VLR EXECUTOR               43100019
IGC0T05B DC    CL8'IGC0T05B'            NEXT MOD OF REPI/O              43200019
RSTMODNM DC    CL8'IGC0V05B'            RESTART EXIT MOD                43300019
MODID    DC    CL8'IGC0W05B'            MODULE ID              @ZSUT222 43310037
MASK1    DC    F'15'                    MASK OF LO-ORDER 4 BITS  M0187  43320021
DCBFRS16 DC    F'16'                    LNGTH OF DCB ISAM IGNORE Y02076 43330002
RXLSTSIZ DC    0F'0',X'FE000050'        80 BYTES, SUBPOOL 254    A35821 43350021
ISDCBMOV MVC   X264(1,UCBR),D0(WRKR3)   DCB MOVE INSTR FOR EX    YM7370 43352002
RDEXLNGH DC    AL3(152)                 152 BYTES FOR BDAM       Y02076 43356002
SP230    DC    AL1(230)                 SUBPOOL 230              Y02076 43358002
ADDRBYTS EQU   7                        GETMAIN/FREMAIN PARAMS   Y02076 43358402
HIORDER  EQU   8                        HIORDER BYTE             Y02076 43358802
RDEXLST  EQU   X'02'                    CODE FOR BDAM READ EXCL  Y02076 43359202
DEBPRFLN EQU   16                       DEB PREFIX LENGTH        Y02076 43359602
BINUMSI  DC    XL2'0000'                BIN NUMBER = 0000        Y02076 43359702
NMEXTS1  EQU   X'01'                    NO. OF EXTENTS           Y02076 43359802
EXSCLS1  EQU   X'04'                    DEB EXT SCALE            Y02076 43359902
DVMODS1  EQU   X'C0'                    FILE MASK                Y02076 43366602
X264     EQU   X'264'             CONSTANT                       YM7370 43368602
X254     EQU   X'254'             CONSTANT                       YM7370 43370602
PATCH    EQU   (*-IGC0W05B)/20          MAINTENANCE SPACE        Y01909 43373302
         DC    XL(PATCH)'00'                                     Y01909 43380000
         EJECT                                                          43400019
FORECORE DSECT                                                          43500019
         IECDSECT                                                       43600019
*                                                                       43630020
RSBUFSEG EQU FORECORE                   START OF WORK AREA       A30552 43660020
         EJECT                                                          43700019
CVT      DSECT                                                          43800019
         CVT                                                            43900019
         EJECT                                                          44000019
*                                                                       44100019
*                                                                       44200019
*   TASK CONTROL BLOCK                                                  44300019
*                                                                       44400019
*                                                                       44500019
         IKJTCB                                                  Y02076 44550002
         EJECT                                                          46700019
         DCBD  DSORG=(IS,DA)                                     A35821 46800021
ISDCBLNG EQU   DCBWKPT6+4-IHADCB        LENGTH OF ISAM DCB       Y02076 46850002
ISDCBCPY EQU   DCBWKPT6+4               ADR FOR DCB COPY         Y02076 46860002
IHADCW   DSECT                          BISAM DCB WORKAREA              46900019
         DS    0D                                                       47000019
DCWFCP4  DS    A                                                        47100019
DCWFCP7  DS    A                                                        47200019
DCWNUCPS DS    CL1                                                      47300019
DCWNUCP4 DS    CL1                                                      47400019
DCWNUCP7 DS    CL1                                                      47500019
DCWNLSD  DS    CL1                                                      47600019
DCWFIOBU DS    A                                                        47700019
DCWLIOBU DS    A                                                        47800019
DCWFUPDI DS    A                                                        47900019
DCWLUPDI DS    A                                                        48000019
DCWHIAV  DS    CL1                                                      48100019
DCWWKNI  DS    BL1                                                      48200019
DCWNLEVC DS    CL1                                                      48300019
DCWNUWKN DS    CL1                                                      48400019
DCWMSHIL DS    A                                                        48500019
DCWHIRPS DS    CL1                                                      48600019
DCWNACT  DS    CL1                                                      48700019
DCWSIZE  DS    H                                                        48800019
DCWOPCLS DS    D                        CCHHR AND UCB ADDR OF F2 DSCB   48900019
DCWFIOBE DS    A                                                        49000019
DCWLIOBE DS    A                                                        49100019
         EJECT                                                          49200019
*                                                                       49300019
*                                                                       49400019
*   DATA EXTENT BLOCK                                                   49500002
*                                                                       49600019
         IEZDEB                                                  Y02076 49650002
         EJECT                                                          53600019
TIOT     DSECT                                                          53700019
         IEFTIOT1                                                       53800019
         EJECT                                                          53900019
SRT      DSECT                                                          54000019
         IEFUCBOB                                                       54100019
         EJECT                                                          54200019
         IEEVRSWA  VER=3                                                54300000
SAVSPLNG EQU   RSERAS00                 SAVE ADR OF SP230 LNGTH  Y02076 54350002
         EJECT                                                          54400019
         IHJDSTAB                                                Y02076 54450002
         END                                                            58900019
./  ADD  SSI=42190043,NAME=IGC0506C
         GBLC  &LIB                                                     00060020
&LIB     SETC  'LIB1'                   SET VARIABLE TO LIB1            00120020
         TITLE 'IGC0506C  QUIESCE I/O PHASE                            *00200018
                        CHECK I/O  CHECKPOINT-SVC 63  OS/360'           00400018
IGC0506C CSECT                                                          00600018
*STATUS CHANGE LEVEL 000                                                02500002
*********************************************************************** 02600018
*                                                                     * 03200018
*FUNCTION/OPERATION- THE CHECK I/O ROUTINE WILL ACCESS ALL OPEN DATA  * 03400002
*     SETS ASSOCIATED WITH THE TASK AND QUIESE I/O ACTIVITY BY        * 03600002
*     ISSUING AN SVC PURGE WITH THE QUIESE OPTION.  PURGING OF I/O IS * 03800002
*     BYPASSED FOR THE FOLLOWING TYPES OF DATA SETS:                  * 03850002
*                             TCAM                                    * 03900002
*                             DUMMY                                   * 03950002
*                             VSAM                                    * 03960002
*                             SUBSYSTEM                               * 03970002
*                             ISAM/VSAM(CI)                           * 03980002
*                                                                     * 04000018
*     IT WILL DETERMINE IF ANY PERMANENT I/O ERRORS OCCURRED DURING   * 04200018
*     THE QUIESING OF I/O ON DATA SETS BEING PROCESSED WITH THE       * 04400018
*     'QUEUED ACCESS METHODS'.                                        * 04600018
*                                                                     * 04850002
*         IF THERE WERE PERMANENT ERRORS THE CHECKPOINT FUNCTION WILL * 05000018
*         NOT WRITE AN ENTRY.  THEREFORE, THE CHECK I/O ROUTINE WILL  * 05200018
*         RETURN AN ERROR CODE IN CHECKPOINT WORKAREA AND PASS CONTROL* 05400018
*         TO THE RESUME I/O PHASE.                                    * 05600018
*         THE ONE EXCEPTION TO THE ABOVE IS A QSAM DATA SET WITH AN   * 05800018
*         ERROR OPTION OF ACCEPT IN WHICH CASE THE CHECK I/O ROUTINE  * 06000018
*         WILL CONTINUE PROCESSING AS THOUGH NO ERROR HAD OCCURRED.   * 06200018
*                                                                     * 06250002
*        THE CHECK I/O ROUTINE ALSO QUIESCES THE USER'S ADDRESS SPACE * 06300002
*        BY DISPATCHING ALL SERVICE REQUEST BLOCKS, FOR THE USER'S    * 06350002
*        ADDRESS SPACE, THAT ARE ATTACHED TO THE SERVICE PRIORITY     * 06360002
*        LISTS.                                                       * 06370002
*                                                                     * 06400018
*        PRIOR TO EXITING, THIS MODULE VALIDITY CHECKS THE USER'S     * 06410002
*        CHECKPOINT DATA SET'S DCB AND CHECKID ADDRESSES.             * 06420002
*                                                                     * 06450002
*ENTRY POINTS- IGC0506C                                               * 06600002
*                                                                     * 06800018
*INPUT- WORK AREA ADDRESS IN REGISTER 1                               * 07000018
*     TASK CONTROL BLOCK ADDRESS IN WORKAREA FIELD 'CKTCBAD'          * 07200018
*                                                                     * 07400018
*OUTPUT- WORK AREA ADDRESS IN REGISTER 1                              * 07600018
*     TASK CONTROL BLOCK ADDRESS IN WORKAREA FIELD 'CKTCBAD'          * 07800018
*     RETURN CODE IN WORKAREA FIELD 'CKRETCOD'  AND MESSAGE CODE IN   * 08000002
*     'CKMSGCOD'.                                                     * 08050002
*         RETURN CODE IS X'0C', MESSAGE CODE IS 30 - IF A DATA SET    * 08200002
*         THAT IS BEING PROCESSED WITH  THE 'QUEUED  ACCESS           * 08250002
*         METHOD' HAD A PERMANENT I/O ERROR AND WAS                   * 08400002
*         NOT A QSAM DATA SET WITH ERROR OPTION OF ACCEPT             * 08600018
*                                                                     * 08650002
*         RETURN CODE IS X'0C', MESSAGE CODE IS 200 - IF PURGE        * 08700002
*         DETECTED AN I/O ERROR.                                      * 08750002
*                                                                     * 08760002
*         RETURN CODE IS X'08', MESSAGE CODE IS 01 - IF VALIDITY      * 08770002
*         TESTS FAILED                                                * 08780002
*                                                                     * 08790002
*         RETURN CODE IS X'00' IN ALL OTHER CASES                     * 08800018
*                                                                     * 09000018
*EXTERNAL ROUTINES- NONE                                              * 09200018
*                                                                     * 09400018
*EXITS-NORMAL- TO THE PRESERVE ROUTINE OF CHECKPOINT                  * 09600018
*                                                                     * 09800018
*     -ERRORS- TO THE RESUME I/O ROUTINE OF CHECKPOINT                * 10000018
*                                                                     * 10200018
*TABLES/WORKAREAS-                                                    * 10400018
*      CVT,PSA,ASCB,SPL,SRB,DSAB,DEB,DCB,CHECKPOINT WORK AREA,        * 10450002
*      TIOT,TCB,PURGE PARAMETER LIST(PPL),CHKPT PARAMETER LIST        * 10500002
*                                                                     * 11200018
*ATTRIBUTES- READ ONLY, REENTERABLE AND PRIVILEGED                    * 11400018
*                                                                     * 11600018
*                                                                     * 11800018
*                                                                     * 12000018
*********************************************************************** 12200018
         EJECT                                                          12400018
*********************************************************************** 12600018
*                                                                     * 12800018
*  REGISTERS USED                                                     * 13000018
*                                                                     * 13200018
RPM0     EQU   0                        PARAMETER REGISTER            * 13400018
RTCB     EQU   1                        ADDRESS OF TCB/WORK REGISTER  * 13600018
RBASE    EQU   2                        BASE REGISTER                 * 13800018
RDEB     EQU   3                        ADDRESS OF DEB                * 14000018
RDCB     EQU   4                        ADDRESS OF USERS DCB          * 14200018
RIOB     EQU   5                        ADDRESS OF IOB                * 14400018
RWRK     EQU   6                        ADDRESS OF WORKAREA           * 14600018
RWKW     EQU   7                        ADDRESS OF CHECKIO'S WORKAREA * 14800018
RSVI     EQU   8                        SAVE FIRST IOB ADDRESS        * 15000018
RWK9     EQU   9                        WORK REGISTER                 * 15200018
RWKA     EQU   10                       WORK REGISTER                 * 15400018
RWKB     EQU   11                       WORK REGISTER                 * 15600018
RWKC     EQU   12                       WORK REGISTER                 * 15800018
REG13    EQU   13                       SAVE AREA POINTER             * 16000018
RET14    EQU   14                       RETURN REGISTER               * 16200018
RPM15    EQU   15                       PARAMETER REGISTER            * 16400018
*                                                                     * 16600018
*  MASKS TO TEST MACRF FOR ACCESS METHOD USED                         * 16800018
*                                                                     * 17000018
GET      EQU   X'40'                                                  * 17200018
PUT      EQU   X'40'                                                  * 17400018
READ     EQU   X'20'                                                  * 17600018
EXCP     EQU   X'80'                                             A27230 17660019
*                                        2723                    A27230 17720019
*                                                                     * 17800018
*  OTHER MASKS AND CONSTANTS                                          * 18000018
*                                                                     * 18200018
TCAMID1  EQU   X'C0'                    UNIQUE TCAM DEB CODE     M3408  18260020
TCAMID2  EQU   X'CF'                    UNIQUE TCAM DEB CODE     M3408  18320020
ACC      EQU   X'80'                    TEST DCBEROPT FOR ACCEPT ERROR* 18400018
INDSEQ   EQU   X'80'                    TEST DCBDSORG FOR ACCESS METH * 18650002
NTPRGD   EQU   X'FF'                    TEST DEBUSRPG FOR NOT PURGED  * 19000018
OUTP     EQU   X'0F'                    TEST DEBOPATB FOR OUTPUT      * 19200018
PERMERR  EQU   X'C0'                    TEST DCBIFLGS FOR ERROR       * 19400018
QISAMERR EQU   X'0C'                    TEST DCBEXCD1 FOR QISAM ERROR * 19600018
UNITEX   EQU   X'01'                    TEST IOBSTAT0 FOR UNIT EXCEPT * 19800018
INP      EQU   X'01'                    CODE TO SIGNIFY INPUT         * 20000018
IOERR    EQU   X'10'                    I/O ERROR RETURN CODE         * 20200018
CKERIOA  EQU   X'1E'                    I/O ERROR RETURN CODE         * 20300018
OFF      EQU   X'FE'                    SWITCH OFF                    * 20400018
ON       EQU   X'01'                    SWITCH ON                     * 20600018
OPTION   EQU   B'11000000'              OPTION BYTE FOR PURGE         * 20800018
*     BIT        0      1      2      3      4      5      6      7   * 21000018
*     SETTING    1      1      0      0      0      0      0      0   * 21200018
*     MEANING  SPEC-   POST QUIESCE  ALL   SPARE SPECIAL PURGE   ALL  * 21400018
*              IFIED        OUT-     I/O         ROLLOUT BY DEB  DEB  * 21600018
*              DEB          STANDNG              OPTION               * 21800018
*              ONLY         I/O                  OFF                  * 22000018
*                                                                     * 22200018
*********************************************************************** 22400018
         EJECT                                                          22600018
         BALR  RBASE,0                  ESTABLISH BASE                  22800018
         USING CHECKIO,RBASE                                            23000018
         USING DEBBASIC,RDEB                                            23400002
         USING IHADCB,RDCB                                              23600018
         USING DXECB-4,RIOB                                             23800018
         USING CHKWA,RWRK                                               24000018
         USING CHKIOWA,RWKW                                             24200018
*                                                                       24400018
CHECKIO  EQU   *                                                        24600018
         B     BEGIN               BRANCH AROUND EYE CATCHER     Y01909 24650000
         CNOP  0,8                 ALIGN TO A DBL WORD BOUNDARY  Y01909 24700000
         DC    C'IGC0506C'         CSECT NAME                    Y01909 24750000
BEGIN    EQU   *                                                 Y01909 24760000
         LR    RWRK,RTCB                SAVE ADDRESS OF WORK AREA       24762002
         LR    RWKW,RTCB                GET MY WORK AREA                24764002
         A     RWKW,CKWAOFST            ADD OFFSET TO CHECKIO WORKAREA  24766002
         NI    CKFLAG2,OFF              TURN OFF RESUME I/O SWITCH      24768002
*********************************************************************** 24770002
*     GET SPACE FOR PURGE PARAMETER LIST                         Y02076 24780002
*********************************************************************** 24790002
         ICM   R0,ADDRBYTS,PURGPLN      PURG PARM LST LNGTH IN R0Y02076 24794002
         ICM   R0,HIORDER,SP253         SUBPOOL NO. IN R0        Y02076 24796002
         GETMAIN R,LV=(R0)              GET 16 BYTES FOR PURGEPL Y02076 24798002
         ST    R1,PARMLSTA              SAVE ADDR OF PARM LIST   Y02076 24798402
         L     RPM15,CVTADDR(K0,K0)     GET PTR TO CVT           Y02076 24848402
         USING CVTMAP,RPM15                                      Y02076 24858402
         MVC   VL00AD,CVT0VL00          SAVE ADDR OF VAL.RTN00   Y02076 24868402
         MVC   VL01AD,CVT0VL01          SAVE ADDR OF VAL.RTN01   Y02076 24878402
         DROP  RPM15                                             Y02076 24888402
         USING TCB,RTCB                                          Y02076 24898402
*                                                                     * 25600018
*                                                                     * 25800018
*  OBTAIN CHAIN OF DEB'S FROM TCB                                     * 26000018
*                                                                     * 26200018
         L     RTCB,CKTCBAD             GET ADDR OF TCB FROM WORK AREA  26400018
         L     RDEB,TCBDEB              GET ADDR OF FIRST DEB FROM TCB  26600018
CHKDC010 LTR   RDEB,RDEB                TEST FOR END OF DEB CHAIN       26800018
         BZ    CHKDC135                 IF AT END QUIESCE AD SP  Y02076 27000002
         CLI   DEBNMSUB,TCAMID1         Q - TCAM DEB (TYPE 1)    M3408  27040020
         BE    CHKDC070                 IF YES, SKIP THIS DEB    M3408  27080020
         CLI   DEBNMSUB,TCAMID2         Q - TCAM DEB (TYPE 2)    M3408  27120020
         BE    CHKDC070                 IF YES, SKIP THIS DEB    M3408  27160020
*                                                                     * 27200018
         L     RDCB,DEBDCBAD            GET ADDRESS OF DCB FROM DEB     27400018
         LA    RDCB,0(0,RDCB)           CLEAR HIGH ORDER BITS           27600018
*                                                                       27610018
*  IGNORE DEB'S FOR DD DUMMY DATA SETS WHEN PURGING                     27620018
*                                                                       27630018
         L     RTCB,CKTCBAD             GET ADDR OF TCB AGAIN,    25118 27640018
*                                       IT WAS LOST IN LOOP             27650018
         L     RWKA,TCBTIO              GET ADDR OF TIOT          25118 27660018
         AH    RWKA,DCBTIOT             ADD OFFSET TO DD DEVICE   25118 27670018
         L     RWKA,TIOEFSRT-1-TIOELNGH(0,RWKA)  GET UCB ADDR     25118 27680018
         LA    RWKA,0(0,RWKA)           CLEAR HIGH ORDER BYTE     25118 27690018
         LTR   RWKA,RWKA                TEST IF DD DUMMY DATA SET 25118 27700018
         BZ    CHKDC070                 BR IF DUMMY               25118 27710018
**********************************************************************  27710102
*   BYPASS PURGING I/O FOR VSAM, SUBSYSTEM, AND ISAM/VSAM(CI) DS Y02076 27710202
**********************************************************************  27710302
         LR    RWKB,RDEB                GET ADDR OF DEB          Y02076 27710402
         LA    RWKA,DEBPRFLN            GET LENGTH OF PREFIX     Y02076 27710802
         SR    RWKB,RWKA                CALC ADDR OF DEB PREFIX  Y02076 27711202
         USING DEBPREFX,RWKB                                     Y02076 27711602
         CLI   DEBAMTYP,VSAMIDCD        TEST FOR VSAM DATA SET   Y02076 27712002
         BE    CHKDC070                 IF YES - BYPASS PURGE    Y02076 27714002
         L     RWKC,DEBXTNP             GET DEB EXT ADDR         Y02049 27716002
         DROP  RWKB                                              Y02076 27718002
         USING DEBXTN,RWKC                                       Y02049 27718402
         L     RWKA,DEBXDSAB            GET ADDR OF DSAB         Y02076 27718802
         USING DSAB,RWKA                                         Y02076 27719602
         L     RWKA,DSABTIOT            GET ADDR OF DDNTRY       Y02076 27719702
         USING TIOENTRY,RWKA                                     Y02076 27719802
         TM    TIOELINK,TIOESSDS        TEST IF SS DATA SET      Y02076 27719902
         BO    CHKDC070                 IF YES-BYPASS PURGE      Y02076 27746602
         DROP  RWKA                                              Y02076 27756602
         CLI   DEBEXSCL,DUMMYDEB        IS IT A DUMMY DEB        Y02076 27766602
         BNE   CHKDC015                 BRANCH IF NO             Y02076 27768602
         TM    DEBFLGS1,DEBCINDI        TEST FOR CI BIT          Y02076 27770602
         BO    CHKDC070                 IF ON-BYPASS PURGE       Y02076 27772602
CHKDC015 EQU   *                        TEST DATA SET TYPES      Y02076 27773002
*                                                                       27773302
         SR    RWKB,RWKB                CLEAR REGISTER FOR NOTING INPUT 27800018
*                                                                     * 28000018
*                                                                     * 28200018
*  IF CHKDCB IS NOT IMPLEMENTED FOR THIS ACCESS METHOD DO NOTHING BUT * 28400018
*    ISSUE PURGE                                                      * 28600018
*                                                                     * 28800018
         TM    DEBXDSO1,IMPL            IF CHECKIO NOT IMPLEMENTED FOR  29000002
*                                         THIS ACCESS METHOD            29200018
         BZ    CHKDC030                 GO TO PURGE ONLY                29400018
*                                                                27230* 29420019
*                                                                27230* 29440019
*  DETERMINE IF HAVE AN EXCP DCB                                 27230* 29460019
*                                                                27230* 29480019
         TM    DEBXMCF1,DCBMRECP           TEST DCB FOR EXCP     Y02049 29500002
         BO    CHKDC030                 IF SO, GO TO PURGE ONLY  A27230 29540019
*                                                                     * 29600018
*                                                                     * 29800018
*  DETERMINE IF INPUT OR OUTPUT BEFORE TESTING MACRF                  * 30000018
*                                                                     * 30200018
         TM    DEBOPATB,OUTP            TEST HOW DCB WAS OPENED       * 30400018
         BO    CHKDC020                 BRANCH IF OPENED FOR OUTPUT   * 30600018
*                                                                     * 30800018
         TM    DEBXMCF1,DCBMRGET        TEST DEB FOR 'GET' MACRO Y02049 31000002
         BO    CHKDC050                 IF SO GO TO POST AS INPUT       31200018
*                                                                     * 31400018
         TM    DEBXMCF1,DCBMRRD        TEST DEB FOR 'READ' MACRO Y02049 31600002
         BO    CHKDC030                 IF SO ACCESS METHOD IS BASIC    31800018
*                                                                     * 32000018
CHKDC020 EQU   *                                                 Y02049 32200002
         TM    DEBXMCF2,DCBMRPUT   TEST DEB FOR 'PUT' MACRO      Y02049 32250002
         BO    CHKDC060                 IF SO ACCESS METHOD IS QUEUED   32400018
*                                                                     * 32600018
*                                                                     * 32800018
*  ASSUME BASIC ACCESS AT THIS POINT                                  * 33000018
*                                                                     * 33200018
CHKDC030 BAL   RET14,CHKDC040           ISSUE PURGE                     33400018
*                                                                     * 33600018
*                                                                     * 33800018
         B     CHKDC070                 GO TO GET NEXT DEB              34000018
*                                                                     * 34200018
***                                                                 *** 34400018
*                                                                     * 34600018
*********************************************************************** 34800018
*                                                                       35000018
*  SET UP FOR PURGE ON THE CURRENT DEB                                  35200018
*                                                                       35400018
CHKDC040 EQU   *                        PURGE ROUTINE                   35600002
         USING PPL,R1                                            Y02076 35610002
         L     R1,PARMLSTA              GET ADDR OF PURGE P.L.   Y02076 35650002
         XC    K0(PLLENGTH,R1),K0(R1)   CLEAR PARM LIST          Y02076 35700002
         ST    RDEB,PPLOPT1             ST ADDR OF DEB IN P.L.   Y02076 35750002
         MVI   PPLOPT1,POPTION1         SET OPTION BYTE 1        Y02076 35800002
         LA    R0,DEBUSRPG              GET DEBUSRPG ADR         Y02076 35850002
         ST    R0,PPLPIRL-K1            STORE IN PURGE P.L.      Y02076 35860002
         MVI   PPLOPT2,PPLOTCB          MVE OPTION BYTE 2        Y02076 35900002
         L     RWK9,DEBUCBRG            SAVE UCB ADDR FOR ISAM   Y02076 35910002
         TM    DEBXDSO1,DCBDSGIS        IS IT ISAM DATA SET      Y02049 35920002
         BZ    CHKDCB4A                 BRANCH IF NO             Y02076 35930002
         MVC   DEBUCBRG(K4),DEBUCBIS    CORRECT ISAM DEB FOR PRG Y02076 35940002
*********************************************************************** 35942002
*    UCB ADDRESS IN AN ISAM DEB IS IN WRONG LOCATION FOR PURGE   Y02076 35944002
*        THEREFORE IT IS SAVED AND RESTORED BEFORE/AFTER PURGE   Y02076 35946002
*********************************************************************** 35948002
CHKDCB4A PURGE (R1)                     PURGE I/O FOR CURR DEB   Y02076 35950002
         L     R1,PARMLSTA              RESTORE PURGE LST PTR    Y02076 35950402
         LTR   RF,RF                    WAS PURGE SUCCESSFUL     Y02076 35952002
         BNZ   CHKDC041                 BRANCH TO ERROR IF NOT   Y02076 35954002
         ST    RWK9,DEBUCBRG            RESTORE ISAM DEB UCB ADR Y02076 35960002
         CLI   PPLCC,PRGSUCS            SUCCESSFUL PURGE         Y02076 36000002
         BE    CHKDC042                 BRANCH IF YES            Y02076 36050002
CHKDC041 MVC   CKMSGCOD,PURGERR         SET ERR CODE 200         Y02076 36100002
         MVI   CKRETCOD+K1,CKIOERR      SET ERR RETURN CODE      Y02076 36150002
         MVC   LIST(K8),ERRADDR         ADR OF RESUME I/O MOD.   Y02076 36200002
         B     CHKDC130                 BRANCH TO EXIT           Y02076 36250002
CHKDC042 CLC   DEBUSRPB,PURGTOOK        DID PURGE TAKE PLACE     Y02076 36300002
         BE    CHKDC048                 BRANCH IF NO             Y02076 36350002
         OI    CKFLAG2,ON               IF PURGED, ALERT RESUME I/O     40400018
CHKDC048 EQU   *                                                        40600018
         BR    RET14                    RETURN TO MAIN LINE             40800018
*                                                                     * 41000018
***                                                                 *** 41200018
*                                                                     * 41400018
*********************************************************************** 41600018
*                                                                     * 41800018
*                                                                     * 42000018
*  THE FOLLOWING CODE WILL PROCESS ALL QUEUED ACCESS METHOD ENTRIES     42200018
*                                                                     * 42400018
CHKDC050 EQU   *                                                        42450002
         LA    RWKB,INP            NOTE THAT THIS IS INPUT              42500002
CHKDC060 EQU   *                                                 Y02049 42650002
         TM    DEBXDSO1,DCBDSGIS   TEST ORGANIZAITION            Y02049 42700002
         BO    CHKDC080                 BRANCH IF INDEXED SEQ ORG       43000018
         DROP  RWKC                                              Y02049 43050002
*                                                                     * 43200018
         TM    DCBIFLGS,PERMERR         TEST SUPERVISOR MESSAGE         43400018
         BO    CHKDC090                 BRANCH IF ERROR POSTED IN DCB   43600018
*                                                                     * 43800018
         BAL   RET14,CHKDC040           ISSUE PURGE                     44000018
*                                                                     * 44200018
*                                                                     * 44400018
         TM    DCBIFLGS,PERMERR         TEST SUPERVISOR MESSAGE         44600018
         BO    CHKDC090                 BRANCH IF ERROR POSTED IN DCB   44800018
*                                                                     * 45000018
*                                                                     * 45200018
*  GET NEXT DEB FROM CHAIN                                            * 45400018
*                                                                     * 45600018
CHKDC070 L     RDEB,DEBDEBAD            GET ADDRESS OF PREVIOUS DEB     45800018
         LA    RDEB,0(0,RDEB)           CLEAR HIGH ORDER BITS           46000018
         B     CHKDC010                 GO BACK TO BEGINNING OF DEB     46200018
*                                         CHAIN LOOP                    46400018
***                                                                 *** 46600018
*                                                                     * 46800018
*                                                                     * 47000018
* PROCESS QUEUED INDEXED SEQUENTIAL ENTRIES                           * 47200018
*                                                                     * 47400018
CHKDC080 BAL   RET14,CHKDC040           ISSUE PURGE                     47600018
*                                                                     * 47800018
*                                                                     * 48000018
         TM    DCBEXCD1,QISAMERR        TEST EXCEPTIONAL CONDITIONS     48200018
         BZ    CHKDC070                 BRANCH IF NO INPUT OR OUTPUT    48400018
*                                         ERRORS                        48600018
*                                                                     * 48800018
         B     CHKDC110                 OTHERWISE GO TO ERROR ROUTINE   49000018
*                                                                     * 49200018
***                                                                 *** 49400018
*                                                                     * 49600018
CHKDC090 TM    DCBEROPT,ACC             TEST ERROR OPTION               49800018
         BO    CHKDC070                 BRANCH IF ACCEPTABLE            50000018
*                                                                     * 50200018
         LTR   RWKB,RWKB                TEST FOR INPUT OR OUTPUT        50400018
         BZ    CHKDC110                 IF OUTPUT GO TO ERROR ROUTINE   50600018
*                                                                     * 50800018
         L     RIOB,DCBIOBA             GET ADDRESS OF IOB FROM DCB     51000018
         LA    RIOB,0(0,RIOB)           CLEAR HIGH ORDER BITS           51200018
         LR    RSVI,RIOB                SAVE FIRST IOB ADDR FOR EXIT    51400018
CHKDC100 L     RIOB,DXECB-4             LINK TO NEXT IOB                51600018
         LA    RIOB,0(0,RIOB)           CLEAR HIGH ORDER BITS           51800018
         TM    IOBSTAT0,UNITEX          TEST FOR UNIT EXCEPTION         52000018
         BNZ   CHKDC070                 IF SO, GO GET NEXT ENTRY        52200018
*                                                                       52400018
*                                                                     * 52600018
*  IF THERE IS A UNIT EXCEPTION THIS IS AN END OF FILE AND NOT A TRUE * 52800018
*    ERROR - THEREFORE CONTINUE PROCESSING                            * 53000018
*                                                                     * 53200018
*                                                                     * 53400018
         CLR   RIOB,RSVI                TEST FOR LAST IOB FOR THIS ENT  53600018
         BNE   CHKDC100                 BRANCH IF MORE IOB'S            53800018
*                                                                     * 54000018
*                                                                     * 54200018
*  THE FOLLOWING ERROR ROUTINE WILL PLACE AN ERROR CODE IN THE CKRETCOD 54400018
*  FIELD OF THE WORK AREA AND SET THE FLAG TO ACTIVATE RESUME I/O     * 54600018
*                                                                     * 54800018
CHKDC110 OI    CKFLAG2,ON               RESUME I/O WILL RESTORE I/O REQ 55000018
         MVC   LIST(8),ERRADDR          PUT ADDRESS OF RESUME I/O IN  * 55200018
*                                         WORK AREA                   * 55400018
         MVI   CKRETCOD+1,CKIOERR       PUT ERROR RETURN CODE X'0C' IN  55500018
         MVI   CKMSGCOD+1,CKERIOA           CHKWA                       55600018
         B     CHKDC130                 GO TO RETURN                    55800018
*                                                                     * 56000018
***                                                                 *** 56200018
*                                                                     * 56400018
*  SET UP FOR RETURN                                                    56600018
*                                                                     * 56800018
CHKDC120 MVC   LIST(K8),XADDR           PUT ADDRESS OF NEXT MODULE IN   57000002
*********************************************************************** 57050002
*  PERFORM VALIDITY CHECK ON BEGINNING AND ENDING ADDRESS OF          * 57100002
*      USER'S CHECKPOINT DATA SET'S DCB AND USER'S AREA FOR      Y02076 57150002
*      STORING SYSTEM GENERATED CHECKID                          Y02076 57160002
*********************************************************************** 57170002
*                                                                     * 57180002
*                                                                     * 57192002
         LA    R0,DCBLNGTH              GET DCB LENGTH           Y02076 57192102
         STH   R0,LNGTHDCB              STORE IN WORK AREA       Y02076 57192202
         STM   RWKB,RET14,CKREGSAV      SAVE REGS 11-14          Y02076 57192402
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02076X57194002
               RELATED=(LOCREL,(IGC0506C,CHKDC130))                     57194402
         LTR   RD,RD                    TEST RETURN CODE         Y02076 57194802
         BZ    CHKDC125                 BR IF NO ERROR           Y02076 57195202
         MVI   CKMSGCOD+K1,SETLKERR     SET SETLOCK ERROR        Y02076 57195602
         MVI   CKRETCOD+K1,CKIOERR      SET RET CODE 0C          Y02076 57196002
         MVC   LIST(K8),ERRADDR         SET UP EXIT LIST         Y02076 57197002
         B     CHKDC131                 GO TO EXIT PROCESSING    Y02076 57198902
CHKDC125 LM    RWKB,RET14,CKREGSAV      RESTORE REGS 11-14       Y02076 57199902
         USING PARMSECT,RWKA                                     Y02076 57200902
         L     RWKA,CKPARMAD            GET PARM LIST ADDR       Y02076 57201902
         L     R1,PARMFLG               GET PARMDCB FOR DCB ADDR Y02076 57202902
         LA    R1,K0(R1)                CLEAR HI ORDER BYTE      Y02076 57203902
         LR    RDEB,RBASE               SAVE BASE REG            Y02076 57204902
         LR    R2,R1                    GET BEGIN ADDR OF DCB    Y02076 57205902
         AH    R2,LNGTHDCB              END ADDR OF DCB IN R2    Y02076 57206902
         L     RPM15,VL01AD             GET ADDR OF VALID.RTN01  Y02076 57207902
         BALR  RET14,RF                 PERFORM VALIDITY CHECK   Y02076 57208902
         LR    RBASE,RDEB               RESTORE BASE REG         Y02076 57209902
         BNZ   CHKDC180                 CC NON ZERO INDICATE ERR Y02076 57249902
         CLI   LNCHKID,X'FF'            DOES USER WANT CHECKID   Y02076 57259902
         BNE   CHKDC130                 BRANCH IF NO             Y02076 57269902
         L     R1,IDADDR                GET CHECKID ADDR         Y02076 57279902
         LA    R1,K0(R1)                CLEAR HI ORDER BYTE      Y02076 57289902
         LR    RDEB,RBASE               SAVE BASE REG            Y02076 57290302
         LR    R2,R1                    BEGIN ADDR OF CHECKID    Y02076 57291902
         LA    R2,IDLONG(R2)            END ADDR OF CHECKID      Y02076 57293902
         L     RPM15,VL00AD             GET ADDR OF VALID.RTN00  Y02076 57295902
         BALR  RET14,RF                 PERFORM VALIDITY CHECK   Y02076 57297902
         LR    RBASE,RDEB               RESTORE BASE REG         Y02076 57298002
         BNZ   CHKDC180                 CC NON 0 INDICATES ERROR Y02076 57298302
*                                         WORK AREA                     57299902
CHKDC130 EQU   *                                                        57500018
         STM   RWKB,RET14,CKREGSAV      SAVE REGS 11-14          Y02076 57510002
         SETLOCK RELEASE,TYPE=LOCAL,                             Y02076X57550002
               RELATED=(LOCSET,(IGC0506C,CHKDC120))                     57600002
         LM    RWKB,RET14,CKREGSAV      RESTORE REGS 11-14       Y02076 57650002
CHKDC131 LR    RTCB,RWRK                RELOAD ADDR OF PASSED WORK AREA 57800002
         LA    R0,LIST                  GET ADR OF NEXT MODULE   Y02076 57850002
         ST    R0,LIST+8                STORE IN XCTL PARM LST   Y02076 57900002
         LA    RPM15,LIST+8             TELL XCTL WHERE TO GO           58000018
*                                                                     * 58200018
         XCTL  EPLOC=(RWKW),SF=(E,(15)) TO CHECKPOINT ROUTINE           58400018
*********************************************************************** 58450002
*        QUIESCE THE USER'S ADDRESS SPACE                        Y02076 58500002
*********************************************************************** 58550002
CHKDC135 EQU   *                        INITIALIZE FOR QUIESCING Y02076 58552002
         L     RPM15,CVTADDR(K0,K0)     GET CVT ADDR FROM LOC 16 Y02076 58558002
         USING  CVTMAP,RPM15                                     Y02076 58558402
         L     RWKB,CVTTCBP             GET PTR TO NEXT TCB      Y02076 58558802
         LA    RWKB,CURASOFS(RWKB)      GET ADR OF CURR ASCB ADR Y02076 58559202
         L     RWKB,K0(RWKB)            GET ADR OF CURR ASCB     Y02076 58559302
         ST    RWKB,USERASCB            SAVE ADDR OF USER'S ASCB Y02076 58559602
         LA    RWKC,GSPLSIZE            GET GLOBAL SPL SIZE      Y02076 58561602
         SRL   RWKC,DIV8                DIVIDE BY 8              Y02076 58563602
         STC   RWKC,SPLOOPCG            STORE GLOBAL SPL NTRY CT Y02076 58563702
         LA    RSVI,LSPLSIZE            GET LOCAL SPL SIZE       Y02076 58563802
         SRL   RSVI,DIV8                DIVIDE BY 8              Y02076 58563902
         STC   RSVI,SPLOOPCL            ST LOCAL SPL ENTRY CNT   Y02076 58566502
*********************************************************************** 58568502
*     ESTABLISH ESTAE ENVIRONMENT IN THE EVENT AN ABEND OCCURS   YM5785 58568902
*     WHEN STATUS STOP,SRB IS IN EFFECT AND GLOBAL LOCK HAS      YM5785 58569302
*     NOT BEEN RELEASED.                                         YM5785 58569402
*********************************************************************** 58569502
         LA    RWK9,CHKESTAE            GET ESTAE ENTRY POINT    YM5785 58572402
         LR    R1,RWRK                  GET WORK AREA ADDR       YM5785 58574402
         A     R1,CKBFOFST              POINT TO PARM BUFFER     YM5785 58576402
         LA    R1,CHRL(,R1)             POSITION PAST CHR BUFFER YM7049 58576502
         MVC   K0(CKESTALN,R1),CKESTAE  MOVE PARM LIST TO BUFF   YM5785 58576802
         MVI   CKERAS06,X'00'           CLEAR ESTAE SW'S         YM7008 58577202
         ESTAE (RWK9),PARAM=(RWRK),MF=(E,(R1))    SET ENVIRON.   YM5785 58577302
CHKDC140 EQU   *                        LOOP THRU SPLS           Y02076 58577402
         SR    RWK9,RWK9                CLR LOCAL SPL NTRY PTR   Y02076 58580302
         SR    RSVI,RSVI                CLEAR LOCAL LOOP CNT REG Y02076 58583202
         IC    RSVI,SPLOOPCL            GET LOCAL SPL ENTRY CNT  Y02076 58586102
         STATUS STOP,SRB                STOP SRB DISPATCHING     Y02076 58589002
         OI    CKERAS06,STOPSW          SET STATUS-STOP SW       YM7008 58590802
         STM   RWKB,RET14,CKREGSAV      SAVE REGISTER 11 THRU 14 Y02076 58591902
CHKDC142 SETLOCK OBTAIN,TYPE=DISP,MODE=UNCOND, GLOBAL DISP LOCK  Y02076X58594802
               RELATED=(GLDSPREL,(IGC0506C,CHKDC162))                   58597702
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02076 58600602
         BZ    CHKDC143                 BR IF NO ERROR           Y02076 58603502
         MVI   CKMSGCOD+K1,SETLKERR     SET SETLOCK ERROR        Y02076 58606402
         MVI   CKRETCOD+K1,CKIOERR      SET RET CODE 0C          Y02076 58609302
         MVC   LIST(K8),ERRADDR         SET UP XCTL LIST         Y02076 58612202
         B     CHKDC194                 GO TO EXIT PROCESSING    YM7008 58615102
CHKDC143 LM    RWKB,RET14,CKREGSAV      RESTORE REGS 11 THRU 14  Y02076 58618002
         SR    RWKC,RWKC                CLEAR GLOBL LOOP CNT REG Y02076 58620902
         IC    RWKC,SPLOOPCG            GET SPL ENTRY COUNTR     Y02076 58623802
         L     RPM15,CVTADDR(K0,K0)     RESTORE PTR TO CVT       Y02076 58626702
         L     RWKA,CVTGSPL             GET ADDR OF GLOBAL SPL   Y02076 58629602
CHKDC145 L     RWKB,K0(,RWKA)           GET PTR TO 1ST SRB       Y02076 58632502
         LTR   RWKB,RWKB                ANY SRBS ON 1ST SPL NTRY Y02076 58635402
         BZ    CHKDC155                 BRANCH IF NO             Y02076 58638302
*********************************************************************** 58641202
*   CHECK GLOBAL SRBS TO DETERMINE IF ANY ARE FOR USER'S MEMORY  Y02076 58644102
*********************************************************************** 58647002
CHKDC150 EQU   *                        SEARCH GLOBAL SPL        Y02076 58649902
         USING SRBSECT,RWKB                                      Y02076 58659902
CHKDC152 CLC   SRBASCB,USERASCB         IS THIS SRB OF USER SPAC Y02076 58669902
         BE    CHKDC160                 Y-BRANCH TO DISPATCH SRB Y02076 58679902
         CL    RWKB,LASTSRB(,RWKA)      LAST SRB ON QUEUE        Y02076 58689902
         BE    CHKDC155                 Y-GO GET NEXT SPL ENTRY  Y02076 58691902
         L     RWKB,SRBFLNK             GET NEXT SRB             Y02076 58693902
         B     CHKDC152                 LOOK FOR MORE USER SRBS  Y02076 58695902
CHKDC155 EQU   *                        ANY MORE SPL ENTRIES     Y02076 58697902
         BCTR  RWKC,K0                  DECREASE LOOP COUNT      Y02076 58698302
         LTR   RWKC,RWKC                SET CONDITION CODE       Y02076 58698402
         BZ    CHKDC170                 BR - DONE W LAST SPLNTRY Y02076 58698702
         LA    RWKA,NXTSPLET(,RWKA)     GET ADDR NXT SPL ENTRY   Y02076 58699102
         B     CHKDC145                 BR TO CHECK NXT SPL NTRY Y02076 58699502
CHKDC160 EQU   *                        DISPATCH SRBS            Y02076 58699602
         STM   RWKB,RET14,CKREGSAV      SAV REGS 11 THRU 14      Y02076 58699702
CHKDC162 SETLOCK RELEASE,TYPE=DISP,     RELEASE GLOBAL DISP LOCK Y02076X58699802
               RELATED=(GLDSPSET,(IGC0506C,CHKDC142))            Y02076 58709902
         LM    RWKB,RET14,CKREGSAV      RESTORE REGS 11 THRU 14  Y02076 58733202
CHKDC163 EQU   *                        ISSUE STATUS START       Y02076 58735202
         STATUS START,SRB               DISPATCH SRBS            Y02076 58743202
         LA    RPM15,K8                 SET PARM REG TO 8        Y02076 58745202
         SVC   116                      IMED SRB START           VS4684 58747202
         NI    CKERAS06,X'FF'-STOPSW    CLEAR STATUS-STOP SW     YM7008 58749202
         B     CHKDC140                 CONTINUE QUIESING ADR SP Y02076 58753202
CHKDC170 EQU   *                        CHECK LOCAL SPL          Y02076 58763202
         USING ASCB,RWKC                                         Y02076 58766402
         L     RWKC,USERASCB            GET ADDR OF USERS ASCB   Y02076 58766502
         L     RWKC,ASCBSPL-ASCB(,RWKC) GET ADDR OF LOCAL SPL    Y02076 58777602
CHKDC175 L     RWKC,K0(RWK9,RWKC)       GET PTR TO 1ST SRB       Y02076 58787602
         LTR   RWKC,RWKC                ANY SRBS TO DISPATCH     Y02076 58788002
         BNZ   CHKDC160                 Y-CONTINUE QUIESING      YM2851 58788402
         BCTR  RSVI,K0                  DONE WITH LOCAL SPL      Y02076 58788802
         LTR   RSVI,RSVI                SET CONDITION CODE       Y02076 58790802
         BZ    CHKDC190                 Y-BRANCH TO RETURN       Y02076 58792502
         LA    RWK9,NXTSPLET(,RWK9)     PT RWK9 TO NXT SPL ENTRY Y02076 58794502
         B     CHKDC170                 LOOK AT NEXT SPL ENTRY   YM5732 58794902
CHKDC180 OI    CKFLAG2,ON               SET FLG IN WA TO RESUME  Y02076 58795302
         MVC   LIST(K8),ERRADDR         SET XCTL PARM FOR NO6C   Y02076 58795702
         MVI   CKRETCOD+K1,CKPGMERR     SET RETURN CODE = X'08'  Y02076 58796102
         MVI   CKMSGCOD+K1,VALIDERR     SET VALIDITY ERROR CODE  Y02076 58796202
         B     CHKDC130                 BRANCH TO ERROR EXIT     Y02076 58846202
CHKDC190 EQU   *                        START SRBS AGAIN         Y02076 58848202
         STM   RWKB,RET14,CKREGSAV      SAVE REGS11-14           YM2851 58850202
CHKDC192 SETLOCK RELEASE,TYPE=DISP,     RELEASE GLOBAL LOCK      YM2851X58852202
               RELATED=(GLDSPSET,(IGC0506C,CHKDC142))            YM2851 58854202
         LM    RWKB,RET14,CKREGSAV      RESTORE REGS11-14        YM2851 58854602
CHKDC194 EQU   *                        ERROR EXIT ENTRY         YM7008 58855402
         STATUS START,SRB               BEGIN DISPATCHING SRBS   Y02076 58856202
         NI    CKERAS06,X'FF'-STOPSW    CLEAR STATUS-STOP SW     YM7008 58858202
         ESTAE 0                        CANCEL ESTAE ENVIRONMET  YM7008 58860202
         CLI   CKRETCOD+K1,X'00'        WAS THIS A ERROR ENTRY   YM7008 58862202
         BE    CHKDC120                 TO EXIT PROCESSING       Y02076 58866202
         CLI   CKRETCOD+K1,X'10'        IS IT ENQS OUTSTANDING   YM7332 58868202
         BE    CHKDC120                 TO EXIT PROCESSING       YM7332 58870202
         B     CHKDC131                 ERROR-TERMINATE          YM7332 58872202
**********************************************************************  58876202
*                          ESTAE ROUTINE                         YM5785 58886202
*********************************************************************** 58888202
CHKESTAE CH    RPM0,RETCOD12-CHKESTAE(RF) DID RTM GET A WA       YM7082 58890202
         BNE   CHKESTA2-CHKESTAE(RF)    IF YES, BRANCH           YM7082 58892202
         LR    RWRK,R2                  GET CHKPT WA ADDR        YM7082 58894202
         LR    R2,RF                    ESTABLISH CODE BASE AS   YM7082 58894302
         S     R2,BASEDIFF-CHKESTAE(RF)   ORIGINALLY ASSEMBLED   YM7082 58894402
         ST    RET14,CKREGSAV           SAVE RTM RET. ADR        YM5785 58894602
         BAL   RET14,CHKESTA4           GO TEST STATUS/STOP SW. ZA00627 58895002
         SR    RPM0,RPM0                ZERO RETRY ADR.          YM5785 58895402
         SR    RPM15,RPM15              TELL RTM TO TERMINATE    YM5785 58895802
         L     RET14,CKREGSAV           RESTORE RTM RET. ADR.    YM5785 58895902
         BR    RET14                    GETURN TO RTM            YM5785 58896002
CHKESTA2 STM   RE,RC,12(RD)             SAVE RTM'S REGS          YM7082 58899402
         LR    R2,RF                    ESTABLISH CODE BASE AS   YM7082 58901402
         S     R2,BASEDIFF-CHKESTAE(RF)   ORIGINALLY ASSEMBLED   YM7082 58901802
         L     RWRK,K0(,R1)             GET PARM (CKWA) FR RTCA  YM5785 58902802
         ST    RET14,CKREGSAV           SAVE RTM RET REG         YM5785 58906202
         BAL   RET14,CHKESTA4           GO TEST STATUS/STOP SW. ZA00627 58912802
         L     RET14,CKREGSAV           RESTORE RTM RET. REG.    YM5785 58914802
         SETRP RC=0,REGS=(14,12)        CONTINUE W/ TERMINATION  YM5785 58922802
CHKESTA4 TM    CKERAS06,STOPSW          IS STATUS-STOP IN EFFECT YM7008 58937002
         BZR   RET14                    BR BACK IF NO            YM5785 58939402
         STATUS START,SRB               START DISPATCHING SRBS   YM5785 58939802
         BR    RET14                    RETURN                   YM5785 58940202
*                                                                     * 58940602
***                                                                 *** 58946202
*                                                                     * 59000018
XADDR    DC    CL8'IGC0A06C'            PRESERVE ROUTINE                59200018
ERRADDR  DC    CL8'IGC0N06C'            RESUME I/O ROUTINE              59400018
RETCOD12 DC    H'12'                    RTM NO-RTCA-ENTRY CODE   YM5785 59450002
BASEDIFF DC    A(CHKESTAE-CHECKIO)      ESTAE BASE REG CONSTANT  YM7082 59452002
PURGPLN  DC    AL3(16)                  PURGE P.L. LENGTH        Y02076 59460002
SP253    DC    AL1(253)                 SUBPOOL 253                     59470002
PURGERR  DC    AL2(200)                 PURGE ERROR CODE         Y02076 59480002
PURGTOOK DC    XL3'FFFFFF'              PURGE DID NOT TAKE PLACE Y02076 59490002
CKESTAE  ESTAE CKESTAE,CT,PARAM=CKESTAE,TERM=YES,                YM5785X59500002
               RECORD=YES,MF=L                                   YM5785 59550002
CKESTALN EQU   *-CKESTAE                                         YM5785 59560002
*                                                                     * 59600018
*                                                                     * 60000018
*********************************************************************** 60200018
*                                                                     * 60250000
*        MAINTENANCE SPACE                                       Y01909 60300000
*                                                                     * 60350000
PATCH    DC    XL((*-IGC0506C)/20)'00'   FIVE PERCENT SPACE      Y01909 60360000
*                                                                     * 60370000
*********************************************************************** 60400018
CVTADDR  EQU   16                       CVT ADDR AT LOC 16       Y02076 60450002
K0       EQU   0                        CONSTANT 0               Y02076 60460002
K1       EQU   1                        CONSTANT 1               Y02076 60470002
K3       EQU   3                        CONSTANT 3               YM7332 60472002
K4       EQU   4                        CONSTANT 4               Y02076 60480002
K8       EQU   8                        CONSTANT 8               Y02076 60490002
CURASOFS EQU   12                       OFFSET TO CURRENT ASCB   Y02076 60500002
VSAMIDCD EQU   X'01'                    ID OF VSAM DATA SET      Y02076 60560002
DUMMYDEB EQU   X'00'                    ID OF DUMMY DEB          Y02076 60570002
DEBPRFLN EQU   16                       DEB PREFIX LENGTH        Y02076 60580002
LASTSRB  EQU   4                        LAST SRB OFSET IN SPL    Y02076 60590002
NXTSPLET EQU   8                        INDEX TO NST SPL ENTRY   Y02076 60592002
VALIDERR EQU   1                        ERR CODE FOR P.L.ERRS    Y02076 60592402
IDLONG   EQU   7                        LENGTH OF CHECKID -1     YM5785 60595102
DIV8     EQU   3                        SHFT CNT TO DIVIDE BY 8  Y02076 60596402
ADDRBYTS EQU   7                        ADDR MASK                Y02076 60596802
HIORDER  EQU   8                        HI ORDER BIT MASK        Y02076 60598002
PLLENGTH EQU   16                       PARM LIST LENGTH         Y02076 60599202
POPTION1 EQU   X'81'                    OPTION 1                 Y02076 60599602
PPLOTCB  EQU   X'08'                    OPTION 2                 Y02076 60599702
PRGSUCS  EQU   X'7F'                    SUCCESSFUL PURGE         Y02076 60599802
STOPSW   EQU   X'80'                    STATUS-STOP SW FOR ESTAE YM7008 60599902
LOCKSW   EQU   X'40'                    DISP-LOCK SW FOR ESTAE   YM7008 60605402
CHRL     EQU   400                      CHR LENGTH               YM7049 60607402
PPL      DSECT                          DSECT OF PURGE PARM LIST Y02076 60626602
PPLOPT1  DS    CL1                      OPTION BYTE 1            Y02076 60628602
PPLDSID  DS    AL3                      ADDR OF DEB              Y02076 60630602
PPLCC    DS    CL1                      COMPLETION CODE          Y02076 60632602
PPLTCB   DS    AL3                      TCB ADDR                 Y02076 60633002
         DS    CL1                      RESERVED                 Y02076 60633102
PPLPIRL  DS    AL3                      SP FOR DEBUSRPB FIELD    Y02076 60633202
PPLOPT2  DS    CL1                      OPTION BYTE 2            Y02076 60638802
         DS    CL1                      RESERVED                 Y02076 60639202
PPLASID  DS    H                        MEMORY PURGE BYTES       Y02076 60640802
PARMSECT DSECT                          PARM LIST DSECT          Y02076 60642802
PARMFLG  DS    1C                       FLAG BYTE                Y02076 60643202
PARMDCB  DS    3C                       ADDR OF CHKPT DCB        Y02076 60643602
IDADDR   DS    0F                       ID ADDRESS WORD          Y02076 60644002
LNCHKID  DS    CL1                      FF IF USER WANTS CHEKID  Y02076 60644102
         DS    CL3                      CHECKID ADDR             Y02076 60644202
         EJECT                                                          60644402
         CVT                                                     Y02076 60650002
         IHASDWA                                                 YM5785 60652002
         IHAPSA                                                  Y02076 60660002
         IHAASCB                                                 Y02076 60700002
         IHASPL                                                  Y02076 60750002
         IHASRB                                                  Y02076 60760002
         IHADSAB                                                 Y02076 60780002
         IEZDEB                                                  Y02076 60790002
         DCBD  DSORG=(PS,IS)                                            60800018
         EJECT                                                          61000018
         EJECT                                                          69000018
         IEEVCHWA VER=3                 USE AOS2 VERSION OF WA          69210000
         EJECT                                                  , 25118 69250018
TIOTSECT DSECT                          DEFINE TIOT LABELS        25118 69300018
         IEFTIOT1                                               , 25118 69350018
         EJECT                                                          69400018
TCB      DSECT      TASK CONTROL BLOCK                                  69600018
*                                                                       69800018
TCBRBP   DS    A                       POINTER TO EXECUTING RB          70000018
TCBPIE   DS    A                       POINTER TO PROG. INTERRUPT EL.   70200018
TCBDEB   DS    A                       POINTER TO DEB QUEUE             70400018
TCBTIO   DS    A                       POINTER TO TIOT                  70600018
TCBCMP   DS    F                       TASK COMPLETION CODE             70800018
TCBTRN   DS    A                       TESTRAN FIELD                    71000018
TCBMSS   DS    A                       DATA BLOCK QUEUE ELEMENT POINTER 71200018
TCBPRTK  DS    BL1                     PROTECTION TAG                   71400018
TCBFLGS  DS    BL5                     FLAG BYTES                       71600018
TCBLMP   DS    BL1                     LIMIT PRIORITY                   71800018
TCBDSP   DS    BL1                     DISPATCHING PRIORITY             72000018
TCBLLS   DS    A                       POINTER TO LOAD LIST             72200018
TCBJLB   DS    A                       POINTER TO JOBLIB DCB            72400018
TCBJSE   DS    A                       LIST OF INACTIVE PROGRAMS ADDR.  72600018
TCBGRS   DS    16F                     GENERAL REGISTER SAVE AREA       72800018
TCBIDF   DS    0BL1                    TCB IDENTIFIER FIELD             73000018
TCBFSA   DS    A                       POINTER TO 1ST PROB.PROG.SAVEAR  73200018
TCBTCB   DS    A                       NEXT TCB ON READY QUEUE POINTER  73400018
TCBTME   DS    A                       POINTER TO TIMER ELEMENT         73600018
*                                                                       73800018
*             ********************************************************* 74000018
*             *                                                       * 74200018
CHKIOWA  DSECT      CHECKIO'S WORK AREA                                 74400018
*                                                                       74600018
LIST     DS    3F   AREA WHERE PURGE LIST IS BUILT AND ENTRY PT STORED  74800018
*                                                                       75000018
*********************************************************************** 75200018
USERASCB EQU   CKERAS00                 STORAGE FOR USRS ASCBAD  Y02076 75250002
PARMLSTA EQU   CKERAS01                 SPACE FOR PURGE PL ADDR  Y02076 75300002
DEBUCBIS EQU   DEBFIEAD+16              LOC OF ISAM UCB ADDR     Y02076 75350002
DEBUCBRG EQU   DEBFIEAD                 LOC OF NORM UCB ADDR     Y02076 75400002
SPLOOPCG EQU   CKERAS02                 LOOP CNT-GLOBAL SRBS     Y02076 75450002
SPLOOPCL EQU   CKERAS02+K1              LOOP CNT-LOCAL SRBS      Y02076 75500002
VL00AD   EQU   CKERAS03                 VALID. CHECK RTN 00      Y02076 75550002
VL01AD   EQU   CKERAS04                 VALID. CHECK RTN 01      Y02076 75600002
LNGTHDCB EQU   CKERAS05                 AREA FOR DCB LENGTH      Y02076 75650002
SETLKERR EQU   202                      UNSUCCESSFUL SETLOCK ERR Y02076 75660002
DCBLNGTH EQU   DCBPOINT+K3-IHADCB       LNGTH OF DCB             YM7332 75700002
IMPL     EQU   DCBDSGIS+DCBDSGPS+DCBDSGDA+DCBDSGPO               Y02049 75710002
*                                  IMPLEMENTED ACCESS METHODS    Y02049 75750002
         END   IGC0506C                                                 85200018
./  ADD  SSI=40350893,NAME=IGG019SI
         TITLE 'IGG019SI - CHECKPOINT DATA SET SECURITY INTERFACE    '  00001000
IGG019SI CSECT ,                                                   0001 00002000
@PROLOG  BALR  @12,0                                               0001 00003000
@PSTART  DS    0H                                                  0001 00004000
         USING @PSTART,@12                                         0001 00005000
*     /***************************************************************/ 00006000
*     /*                                                             */ 00007000
*     /* LOGIC                                                       */ 00008000
*     /*                                                             */ 00009000
*     /***************************************************************/ 00010000
*     R2 = R1;                          /*SAVE PTR TO DECB           */ 00011000
         LR    R2,R1                                               0015 00012000
*     R0 = LENGTH(MSGLIST);             /*GETMAIN LENGTH       YM5746*/ 00013000
         LA    R0,78                                               0016 00014000
*     GEN (GETMAIN R,LV=(0));           /*ISSUE GETMAIN              */ 00015000
         GETMAIN R,LV=(0)                                               00016000
*     R3 = R1;                          /*SAVE PTR GOTTEN CORE YM5746*/ 00017000
         LR    R3,R1                                               0018 00018000
*     MESSAGE = MSGLIST;                /*MOVE IN WTO MSG SKELETON   */ 00019000
         MVC   MESSAGE(78,R1),MSGLIST                              0019 00020000
*     MSGDDNM = TIOEDDNM;               /*DDNAME TO MESSAGE          */ 00021000
         L     @15,CVTPTR                                          0020 00022000
         L     @15,CVTTCBP(,@15)                                   0020 00023000
         L     @15,TCBPTR(,@15)                                    0020 00024000
         L     @14,DECDCBAD(,R2)                                   0020 00025000
         LH    @14,DCBTIOT(,@14)                                   0020 00026000
         A     @14,TCBTIO(,@15)                                    0020 00027000
         MVC   MSGDDNM(8,R1),TIOEDDNM(@14)                         0020 00028000
*     GEN(WTO MF=(E,(1)));              /*ISSUE IEC954I MSG    YM5746*/ 00029000
         WTO MF=(E,(1))                                                 00030000
*     R0 = LENGTH(MSGLIST);             /*GET LENGTH TO FREE   YM5746*/ 00031000
         LA    R0,78                                               0022 00032000
*     GEN(FREEMAIN R,LV=(0),A=(3));     /*FREE MESSAGE CORE    YM5746*/ 00033000
         FREEMAIN R,LV=(0),A=(3)                                        00034000
*     GEN(ABEND 575,DUMP,,SYSTEM);      /*ISSUE S23F ABEND     YM5746*/ 00035000
         ABEND 575,DUMP,,SYSTEM                                         00036000
*     END IGG019SI;                                                0025 00037000
@EL00001 L     @13,4(,@13)                                         0025 00038000
@EF00001 DS    0H                                                  0025 00039000
@ER00001 BR    @14                                                 0025 00040000
@DATA    DS    0H                                                       00041000
@DATD    DSECT                                                          00042000
         DS    0F                                                       00043000
@SA00001 DS    18F                                                      00044000
IGG019SI CSECT                                                          00045000
         DS    0F                                                       00046000
@DATD    DSECT                                                          00047000
         DS    0D                                                       00048000
@ENDDATD EQU   *                                                        00049000
IGG019SI CSECT                                                          00050000
         DS    0F                                                       00051000
@SIZDATD DC    AL1(0)                                                   00052000
         DC    AL3(@ENDDATD-@DATD)                                      00053000
         DS    0D                                                       00054000
MSGLIST  DS    CL78                                                     00055000
         ORG   MSGLIST                                                  00056000
@NM00008 DC    AL2(74)                                                  00057000
@NM00009 DC    X'8000'                                                  00058000
@NM00010 DC    CL70'IEC954I 23F INVALID ATTEMPT TO ACCESS A CHECKPOINT C00059000
               DATA SET (        )'                                     00060000
@NM00011 DC    X'0400'                                                  00061000
@NM00012 DC    X'0020'                                                  00062000
         ORG   MSGLIST+78                                               00063000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00064000
@01      EQU   01                                                       00065000
@02      EQU   02                                                       00066000
@03      EQU   03                                                       00067000
@04      EQU   04                                                       00068000
@05      EQU   05                                                       00069000
@06      EQU   06                                                       00070000
@07      EQU   07                                                       00071000
@08      EQU   08                                                       00072000
@09      EQU   09                                                       00073000
@10      EQU   10                                                       00074000
@11      EQU   11                                                       00075000
@12      EQU   12                                                       00076000
@13      EQU   13                                                       00077000
@14      EQU   14                                                       00078000
@15      EQU   15                                                       00079000
R0       EQU   @00                                                      00080000
R1       EQU   @01                                                      00081000
R2       EQU   @02                                                      00082000
R3       EQU   @03                                                      00083000
CVTPTR   EQU   16                                                       00084000
CVT      EQU   0                                                        00085000
CVTTCBP  EQU   CVT                                                      00086000
TCBWORDS EQU   0                                                        00087000
TCBPTR   EQU   TCBWORDS+4                                               00088000
TCB      EQU   0                                                        00089000
TCBTIO   EQU   TCB+12                                                   00090000
DECB     EQU   0                                                        00091000
DECDCBAD EQU   DECB+8                                                   00092000
DCB      EQU   0                                                        00093000
DCBTIOT  EQU   DCB+40                                                   00094000
TIOENTRY EQU   0                                                        00095000
TIOEDDNM EQU   TIOENTRY+4                                               00096000
MESSAGE  EQU   0                                                        00097000
MSGDDNM  EQU   MESSAGE+65                                               00098000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    00099000
@NM00007 EQU   MESSAGE+73                                               00100000
@NM00006 EQU   MESSAGE                                                  00101000
@NM00005 EQU   TIOENTRY                                                 00102000
@NM00004 EQU   DCB                                                      00103000
@NM00003 EQU   DECB                                                     00104000
@NM00002 EQU   TCB                                                      00105000
@NM00001 EQU   TCBWORDS                                                 00106000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      00107000
@ENDDATA EQU   *                                                        00108000
         END   IGG019SI,(C'PL/S-II',0402,74035)                         00109000
./  ADD  SSI=81000072,NAME=IHJACP00
*                                                                       00000320
         COPY  LCGASMSW                                                 00001600
*                                                                       00018800
 TITLE 'IGC0006C (IHJACP00) CHECKPOINT HOUSEKEEPING ROUTINE- 1ST LOAD'  00020400
*********************************************************************** 00022402
*STATUS CHANGE LEVEL 000                                                00025202
*                                                                       00025602
*FUNCTION/OPERATION:                                                    00026800
*   1.) IF CHKPT IS TO BE SUPPRESSED(I.E.,IF RD=NC OR RD=RNC WAS SPEC-  00028400
*       IFIED ON JOB OR EXEC CARD), THIS ROUTINE WILL PLACE A RETURN    00030000
*       CODE OF X'00' IN REGISTER 15 AND RETURN CONTROL TO USER.        00031600
*   2.) IF 'CANCEL' REQUEST WAS SPECIFIED BY CHKPT MACRO                00033200
*       A.) A GETMAIN IS ISSUED FOR A WORK AREA IN SUBPOOL 253 OF       00034800
*           LSQA. THE WORK AREA IS INITIALIZED, THE ADDRESS OF THE      00036400
*           WORK AREA IS PLACED IN REGISTER 1 AND XCTL TO IGC0206C.     00038000
*       B.) IF GETMAIN WAS UNSUCCESSFUL A RETURN CODE OF X'08' IS       00041200
*           PLACED IN THE SVRB EXTENDED SAVE AREA AND CONTROL IS TRANS- 00042800
*           FERED TO CHKPT EXIT ROUTINE, IGC0Q06C.                      00044400
*   3.) FOR NORMAL PROCESSING OF CHKPT THIS ROUTINE PERFORMS THE        00046000
*       FOLLOWING:                                                      00047600
*        *  DETERMINES WHETHER THE CHKPT PARAMETER LIST IS VALID. IF    00049200
*           IT IS INVALID, THIS ROUTINE PUTS A RETURN CODE OF X'08'     00050800
*           IN THE SVRB EXTENDED SAVE AREA AND XCTLS TO IGC0Q06C.       00052400
*                                                                       00054000
*        *  DETERMINES WHETHER THE CHKPT DATA SET IS OPEN. IF IT IS     00055600
*           NOT OPEN, THIS ROUTINE WILL OPEN THE DATA SET. IF OPEN WAS  00057200
*           UNSUCCESSFUL, EITHER AN I/O OR CHKPT DD ERROR OCCURRED AND  00058800
*           A RETURN CODE OF X'0C' IS PLACED IN THE SVRB EXTENDED SAVE  00060400
*           AREA AND THIS ROUTINE XCTLS TO IGC0Q06C.                    00062000
*                                                                       00062403
*        *  TESTS IF CHKPT=EOV SPECIFIED ON CHKPT DD AND, IF ON,        00062803
*           TURNS IT OFF VIA QMNGRIO FUNCTION.                          00063203
*                                                                       00063600
*        *  COMPUTES THE SIZE OF THE CHKPT WORK AREA.                   00065200
*                                                                       00066800
*        *  GETS CORE FOR THE WORK AREA FROM SUBPOOL 253 IF POSSIBLE.   00068400
*           IF THERE IS NOT ENOUGH SPACE, A RETURN CODE OF X'08' IS     00070000
*           PLACED IN THE SVRB EXTENDED SAVE AREA AND THIS ROUTINE      00071600
*           XCTLS TO IGC0Q06C.                                          00073200
*                                                                       00074800
*        *  FILLS IN THE FIRST PART OF THE WORK AREA WITH               00082800
*           INFORMATION NEEDED BY OTHER CHKPT MODULES.                  00084400
*   4.) FOR CHECKPOINT DATA SET SECURITY THIS ROUTINE PERFORMS THE      00084802
*       FOLLOWING OPERATIONS:                                           00085202
*        *  IF THE DATA SET IS KNOWN TO BE SECURE, THE MODULE TESTS     00085602
*           IF DATA SET IS ON A SHARED DEVICE.  IF SO, ERROR CODE       00085702
*           214 IS SET.  IF ANOTHER DCB OF NON CHECKPOINT STATUS IS     00085802
*           CONCURRENTLY OPEN TO THE CHECKPOINT DATA SET, ERROR CODE    00085902
*           209 IS SET.  IF THE DATA SET IS NOT ENQUEUED EXCLUSIVE,     00088902
*           ERROR CODE 210 IS SET.                                      00090902
*        *  IF THE DATA SET IS NOT KNOWN TO BE SECURE, THE MODULE SETS  00092902
*           ERROR CODE 016 IF IT IS NOT TAPE OR DA.  IF IT IS TAPE      00097602
*           AND BLOCK COUNT IS NOT 0, ERROR CODE 208 IS SET.  THE       00097702
*           MODULE THEN CLOSES AND REOPENS THE CHECKPOINT DATA SET      00097802
*           TO ALLOW OPEN TO GET A SECURE VOLUME.  IF A SECURE          00097902
*           VOLUME IS NOT OPENED, ERROR CODE 211 IS SET.                00098202
*        *  IF A SECURITY INTERFACE WAS SET UP FOR AN UNAUTHORIZED      00098602
*           USER, THIS MODULE UPDATES THE DCB ADDRESS IN THE CHECK-     00098702
*           POINT WORK AREA.                                            00099202
*                                                                       00100402
*ENTRY POINTS: IGC0006C                                                 00101002
*                                                                       00103702
*INPUT:  ADDRESS OF PARAMETER LIST(SHOWN BELOW) IN REGISTER 1.          00104002
*   AL2(FLAG)    FLAG EQUALS X'80' IF NO CHECKID WAS SPECIFIED BY THE   00107002
*                USER AND THE GENERATED CHECKID ADDRESS IS NOT TO BE    00110002
*                RETURNED TO THE USER. FLAG EQUALS X'00' IF CHECKID WAS 00113002
*                SPECIFIED.                                             00116002
*   AL3(DCBORCN) ADDRESS OF CHKPT DCB.                                  00119002
*   AL1(LENGTH)  LENGTH OF USER SPECIFIED CHECKID. IF THIS BYTE EQUALS  00122002
*                X'FF', THIS INDICATES THAT THE USER WANTS THE SYSTEM   00125002
*                TO GENERATE A CHECKID AND RETURN IT AT THE LOCATION    00128002
*                SPECIFIED BY IDADDR.                                   00131002
*   AL3(IDADDR)   IF USER SUPPLIES THE CHECKID, THIS FIELD WILL POINT   00134002
*                TO THAT CHECKID. IF THE SYSTEM IS TO SUPPLY THE        00137002
*                CHECKID, THIS FIELD POINTS TO AN 8 BYTE AREA WHERE     00140002
*                THE GENERATED CHECKID WILL BE RETURNED.                00143002
*   IF 'CANCEL' WAS SPECIFIED IN THE CHKPT MACRO, REGISTER 1 WILL CON-  00146002
*   TAIN ALL ZEROS.                                                     00149002
*                                                                       00151702
*OUTPUT:  A RETURN CODE AND MESSAGE CODE WILL BE PLACED IN THE SVRB     00152002
*   EXTENDED SAVE AREA IF AN ERROR EXISTS.                              00155002
*   1.) IF THE USER REQUESTS THAT CHKPTS BE SUPPRESSED, A RETURN CODE   00158002
*       OF X'00' IS GIVEN.                                              00161002
*   2.) IF THIS ROUTINE WAS UNSUCCESSFUL IN OPENING CHKPT DATA SET      00164002
*       THEN A RETURN CODE OF X'0C' WILL BE GIVEN.                      00167002
*   3.) IF A WORK AREA OF THE PROPER SIZE COULD NOT BE GETMAIN'D,       00170002
*       OR IF THE PARAMETER LIST CONTAINS AN INVALID ADDRESS,           00173002
*       OR IF SECURITY/INTEGRITY ERRORS WERE DETECTED,                  00175702
*       THEN A RETURN CODE OF X'08' IS GIVEN.                           00176002
*   4.) IF NORMAL CHKPT PROCESSING IS TO CONTINUE, THE ADDRESS OF THE   00179002
*       CHKPT WORK AREA WILL BE PLACED IN REGISTER 1.                   00182002
*   ONE OF THE FOLLOWING MESSAGE CODES IS PLACED IN THE SVRB EXTENDED   00185002
*   SAVE AREA TO BE PRINTED IN THE CONSOLE MESSAGE BY THE CHKPT EXIT    00188002
*   ROUTINE IF AN ERROR OCCURS:                                         00191002
*        DEC VALUE  MNEMONIC                 MEANING                    00194002
*            1      CKERPG1        PARAMETER LIST ERROR                 00197002
*            2      CKERPG2        OPEN UNSUCCESSFUL                    00200002
*            3      CKERPG3        GETMAIN UNSUCCESSFUL                 00203002
*           11      CKERPG11       MULTITASKING (MOTHER TASK)           00205002
*           12      CKERPG12       MULTITASKING (DAUGHTER TASK)         00205402
*           16      CKERPG16       CHKPT DATA SET NOT ON TAPE OR DA     00205802
*           19      CKERPG19       USER OPENED CHKPT D/S FOR INPUT      00206802
*          202      CKERP202       LOCAL LOCK NOT OBTAINED              00209002
*          208      CKERP208       TAPE BLOCK COUNT NOT 0               00210002
*          209      CKERP209       CONCURRENT OPEN TO CHKPT D/S         00212402
*          210      CKERP210       CHKPT D/S NOT EXCLUSIVE ENQ'D        00212802
*          211      CKERP211       OPEN DID NOT FIND SECURE CHKPT D/S   00213002
*          214      CKERP214       CHKPT DATA SET ON SHARED DEVICE      00214002
*   IF ANY ERROR OCCURS, THIS ROUTINE XCTL'S TO IGC0Q06C WITH THE       00215002
*   FOLLOWING INPUT:                                                    00216002
*   REGISTER 1 - CONTAINS ALL ZEROS.                                    00219002
*   REGISTER 5 - ADDRESS SVRB                                           00222002
*   ONE BYTE OF FLAGS IN SVRB EXTENDED SAVE AREA TO DETERMINE WHAT      00225002
*   ACTION IS TO BE TAKEN BY CER AND WHAT MESSAGE IS TO BE WRITTEN.     00228002
*  ACTION IS TO BE TAKEN BY CER, RETURN CODE AND MESSAGE CODE IN        00231002
*  BYTES 0-3, TIOT ADDRESS IN BYTES 33-35 AND DCB ADDRESS IN BYTES      00234002
*  37-39 (IF A BAD PARAMETER LIST IS PASSED BYTES 37-39 WILL BE ZERO).  00237002
*                                                                       00239402
*EXTERNAL ROUTINES:  IEAOVLOO,01 - ADDRESSES OF VALIDITY CHECK ROUTINES 00240002
*                    QMNGRIO - FOR READING CONTROL BLOCKS FROM SWA      00242402
*                    SETLOCK - TO GET LOCAL LOCK                        00242802
*                                                                       00242902
*SVCS USED  GETMAIN, FREEMAIN, OPEN, XCTL, SVC3, CLOSE, ENQ, EXCP, WAIT 00243002
*                                                                       00245402
*EXITS-NORMAL:                                                          00246002
*   1.) XCTL TO IGC0106C IF NORMAL PROCESSING OF CHKPT CAN CONTINUE.    00249002
*   2.) XCTL TO IGC0206C IF 'CANCEL' WAS SPECIFIED.                     00252002
*   3.) RETURN TO USER IF CHKPT'S ARE TO BE SUPPRESSED.                 00255002
*                                                                       00257402
*EXITS-ERROR:                                                           00258002
*   1.) XCTL TO IGC0Q06C IF THIS ROUTINE WAS UNABLE TO:                 00261002
*       A.) GETMAIN FOR THE WORK AREA                                   00264002
*       B.) OPEN THE CHKPT DATA SET.                                    00267002
*       C.) VALIDATE THE ADDRESSES OF THE PARAMETER LIST.               00270002
*       D.) VERIFY THAT THE CHECKPOINT DATA SET WAS SECURE.             00272402
*                                                                       00272802
*TABLES/WORKAREAS CREATED:  CHKWA IS THE FIRST PART OF THE CHKPT WORK   00273002
*   AREA. THIS ROUTINE FILLS IN THE WORK AREA WITH INFORMATION THAT IS  00276002
*   NEEDED BY OTHER CHKPT ROUTINES.                                     00279002
*                                                                       00281402
*TABLES/WORKAREAS REFERENCED  CVT, TCB, TIOT, SVRB, DCB, DEB, PQE,      00282002
*                ASCB, DSAB, UCB, SIOT, JFCB, JESCT, VDSCB, DSL1        00286002
*                                                                       00287402
*ATTRIBUTES:  REENTRANT, SUPERVISOR STATE, TYPE 4 SVC ROUTINE.          00288002
*                                                                       00290402
*RESTRICTIONS ON THE USE OF THIS MODULE:  VS/2-2 ONLY                   00291002
*                                                                       00293002
*NOTES:  NONE                                                           00294002
* CHANGES FOR VS2 3.0                                                   00294637
*A27284900-27289800                                           @ZA11608  00295237
*A201503-201530,C250002                                       @ZA25063  00295637
*A348943-349183,349303                                        @ZA27494  00295837
*C264427,A393143                                              @ZA30032  00295937
*ZZZ                                                          @ZA99999  00296037
*ZZZ                                                          @ZA99999  00296137
*C267829-267929,C275410-275417                                @ZA31342  00296237
*********************************************************************** 00296637
         EJECT                                                          00296837
IGC0006C CSECT                                                          00297002
         USING CVTMAP,R3           ADDRESS CVT.                  Y02083 00400002
         USING TCB,R4              ADDRESS TCB.                         00600000
         USING TIOTSECT,R2         ADDRESS TIOT.                        00800017
         USING HKPSECT,R5          ADDRESS CHKPT SVRB                   01000017
         BALR  RB,0                BASE ADDR                            01200002
         USING *,RB                ADDRESS MODULE.                      01400017
BASE1    B     BEGIN               BRANCH AROUND EYE CATCHER     YM7008 01410002
         CNOP  0,8                 ALIGN TO A DOUBLE WORD BOUNDARY      01420000
         DC    CL8'IGC0006C'       MODULE NAME                 @ZA30032 01430037
         DC    CL8'@ZA31342'       LAST CODE SHIPPED           @ZA30032 01480037
         DC    CL8'&SYSDATE'       LAST DATE SHIPPED           @ZA30032 01530037
BEGIN    L     R2,TCBTIO           GET ADDR OF TIOT.                    02200002
         L     R3,ADRCVT(R0,R0)    GET ADDR OF CVT               Y02083 02210002
*                                                                     * 02220018
*********************************************************************** 02230000
*                                                                     * 02240017
*        IF CHECKPOINTS ARE TO BE SUPPRESSED, RETURN TO USER.         * 02280017
*                                                                     * 02320017
*********************************************************************** 02340018
*                                                                     * 02360017
         TM    TCBTRN,TCBNOCHK     ARE CHKPTS TO BE SUPPRESSED          02460000
         BO    CHKSUP              YES-GO RETURN TO USER.               02600002
         XC    HKPGML2(LNXSA),HKPGML2 CLEAR SVRB EXTENDED SAVEAREA      02700002
         ST    R2,HKPTIO           SAVE TIOT ADDRESS                    02800002
*                                                                     * 03410018
*********************************************************************** 03420018
*                                                                     * 03440017
*        IF CANCEL WAS REQUESTED, BRANCH TO CANCEL ROUTINE TO GETMAIN * 03480017
*        A WORK AREA.                                                 * 03520017
*                                                                     * 03560017
*********************************************************************** 03570018
*                                                                     * 03580018
CHKSM    LTR   R1,R1               WAS CANCEL REQUESTED                 03800002
         BZ    CHKCANC1            YES-GO TO CANCEL ROUTINE.            04000017
*                                                                     * 04000318
*********************************************************************** 04000618
*                                                                     * 04001017
*        CHECK PARAMETER LIST ADDRESSES FOR BEING WITHIN P/P CORE AND * 04002017
*        DCB ADDRESS FOR BEING ON FULL WORD BOUNDARY.                 * 04003017
*                                                                     * 04004017
*********************************************************************** 04004518
*                                                                     * 04005017
CHKPARM  LR    R7,RB               SAVE BASE REG                 Y02076 04007002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND, GET LOCAL LOCK   Y02076X04012402
               RELATED=(LOCAL,IGC0006C(CHKPARM4))                Y02076 04014002
         LR    RB,R7               RESTORE BASE REG              Y02076 04014802
         LTR   RD,RD               SETLOCK ERROR                 Y02076 04016002
         LA    RA,CKERP202         ANTICIPATE SETLOCK ERROR      Y02076 04018002
         BNZ   CHKERX              IF SETLOCK ERROR, BR          Y02076 04028002
         LR    RC,R1               RELOCATE PARM ADDR            YM5767 04030002
         USING PARMLST,RC          ADDR PARAMETER LIST           YM5767 04036002
         LA    R1,K0(RC)           CLEAR HI ORDER BYTE           YM5767 04036402
         LA    R2,K7(RC)           END ADR=BEG ADR + 7           YM5767 04038002
         L     RF,CVT0VL01         GET ADR OF VALID.RTN01        Y02076 04040002
         SR    RA,RA               CLEAR ERROR REG               Y02076 04040102
         BALR  RE,RF               PERFORM VALIDITY CHECK        Y02076 04040402
         BNZ   CHKPARM2            TO ERROR-IF INVALID ADR       Y02076 04041202
         ICM   R1,M7,DCBADDR+K1    GET USER DCB ADDR             YM5767 04091202
         LA    R2,K3(R1)           CHECK 1ST DCB WORD            YM5767 04101202
         L     RF,CVT0VL01         GET EPA OF CHECK RTN          YM5767 04111202
         BALR  RE,RF               GO CHECK DCB ADDR             YM5767 04121202
         BNZ   CHKPARM2            TO ERROR EXIT IF INVALID      YM5767 04123202
         CLI   FLAG,NOCHKID        CHECKID SPECIFIED-                   04130002
         BE    CHKPARM3            NO, SKIP NEXT TEST            Y02083 04140002
         L     R1,IDADDR           GET ADR OF CHECKID            Y02076 04144002
         LA    R1,K0(R1)           CLEAR HI ORDER BYTE           Y02076 04146002
         LA    R2,SYSGENID(R1)     ANTICIPATE SYSGENED ID        YM5793 04146502
         CLI   IDADDR,X'FF'        DOES USER WANT THE SYSTEM     YM5793 04147002
*                                  GENERATED CKID RETURNED       YM5793 04147502
         BE    CHKPARM1            BR IF YES (LENGTH=8)          YM5793 04148002
         SR    R2,R2               CLEAR WORK REG                YM5793 04148102
         ICM   R2,M1,IDADDR        GET USER CKID LENGTH          YM5793 04148202
         BZ    CHKPARM3            LET IGC0106C FIND A           YM5793 04148302
*                                  ZERO LENGTH ERROR             YM5793 04148402
         LA    R2,0(R1,R2)         END ADDRESS = R1 + USER       YM5793 04149102
         BCTR  R2,0                CKID LNGTH - 1                YM5793 04149202
CHKPARM1 EQU   *                   CALL VL00 CHECK RTN           YM5793 04149302
         L     RF,CVT0VL00         ADR OF VALID.RTN 00           Y02076 04149402
         BALR  RE,RF               PERFORM VALIDITY CHECK        Y02076 04149502
         BZ    CHKPARM3            BR IF NO ERROR                Y02076 04149602
CHKPARM2 LA    RA,CKERPG1          SET ERROR REG                 Y02076 04152902
CHKPARM3 LR    R1,RC               RESTORE REG 1                 Y02076 04156402
         DROP  RC                  PARM LIST ADDRESSABILITY      YM5767 04156802
         USING PARMLST,R1          ADDR PARM LIST OFF R1         YM5767 04157202
         LR    R7,RB               SAVE BASE REG                 Y02076 04158402
CHKPARM4 SETLOCK RELEASE,TYPE=LOCAL,                             Y02076X04158802
               RELATED=(LOCAL,IGC0006C(CHKPARM1))                Y02076 04159202
         LR    RB,R7               RESTORE BASE REG              Y02076 04159302
         LTR   RA,RA               VALCHK ERROR                  Y02076 04159802
         BNZ   CHKERX              IF ERROR, BR ERROR EXIT       Y02076 04160202
         LR    RD,R1               SAVE PARM REG                 Y02083 04160402
         L     RC,DCBADDR          GET CHKPT DCB ADDRESS         Y02083 04160502
         USING IHADCB,RC           ADDRESS CHKPT DCB             Y02083 04160602
         DROP  R1                  PARM LIST ADDRESSABILITY      Y02083 04160702
         EJECT                                                          04160802
*********************************************************************** 06640018
*                                                                     * 06660017
*        COMPUTE SIZE OF WORK AREA NEEDED BY RESTART                  * 06690017
*                                                                     * 06720017
*********************************************************************** 06730018
*                                                                     * 06750017
         LA    R7,TIOLEN           INIT TIOT-LENGTH-ACCUMULATOR  Y02083 07000002
         XR    R6,R6               CLEAR WORK REG                Y02083 07000502
         L     R2,HKPTIO           GET TIOT ADDRESS              Y02083 07001002
         LA    R9,TIOENTRY         PNT TO 1ST TIOT ENTRY         Y02083 07001502
         USING TIOENTRY,R9         ADDRESS DD ENTRY IN TIOT             07200017
CHKETI   NC    TIOELNGH(TIOEDDNM-TIOENTRY),TIOELNGH IS THIS THE         07500002
*                                  END OF THE TIOT                      07600018
         BNZ   CHKTIL              NO-GO TO GET ADDR OF NEXT DD ENTRY.  07800017
         STH   R7,HKPTIOTL         SAVE LENGTH OF TIOT.                 08000017
*                                                                     * 08006018
*********************************************************************** 08012018
*                                                                     * 08020017
*        LENGTH OF TIOT + LENGTH OF FIXED PART OF RESTART WORK AREA + * 08040017
*        LENGTH OF BASIC PART OF REPDCB'S WORK AREA                   * 08060017
*                                                                     * 08080017
*********************************************************************** 08180018
*                                                                     * 08280018
         AH    R7,WAK              ADD LENGTH OF FIXED WA        Y02076 08380002
*                                                                     * 08480018
*********************************************************************** 08580018
*                                                                     * 08840017
*        INCREASE WORK AREA SIZE FOR REPDCB ACCORDING TO THE NUMBER   * 08880017
*        OF OPEN DATA SETS.                                           * 08920017
*                                                                     * 08960017
*********************************************************************** 08970018
*                                                                     * 08980018
         USING DEBBASIC,R8                                              09200000
CHKDEBN  XR    R6,R6                                                    09400002
         OC    TCBDEB,TCBDEB       CHECK FOR NO DEB CHAIN        Y02083 09520002
         BZ    CHKCOMP             IF NOT, GO DO GETMAIN         Y02083 09560002
         L     R8,TCBDEB           GET ADDR OF FIRST DEB.               09600017
CHKLSDB  NC    DEBDEBB,DEBDEBB     IS THIS THE LAST DEB                 10000002
         BNZ   CHKNXDB             NO-GET ADDR OF NEXT DEB.             10200017
         TM    DCBOFLGS,DCBOFOPN   IS CHKPT D/S OPEN             Y02083 10200502
         BO    CHKDCBOP            IF YES, BRANCH                Y02083 10201002
         LA    R6,K1(,R6)          BUMP DEB COUNT FOR CHKPT D/S  Y02083 10201502
         B     AROUND              BYPASS DEB CHECKING         @ZA25063 10250037
CHKDCBOP EQU   *                                               @ZA25063 10254037
         ICM   R8,M7,45(RC)        GET THE CHECKPOINT DEB      @ZA25063 10258037
         ICM   R8,M7,25(R8)        GET THE PROTECTED DCB       @ZA25063 10262037
         DEBCHK (R8),TYPE=VERIFY   VERIFY THE DEB IS IN TABLE  @ZA25063 10266037
         LTR   RF,RF               ANY ERRORS FROM DEBCHECK    @ZA25063 10270037
         BZ    AROUND              NO SO PRESS ON              @ZA25063 10274037
         LA    RA,CKERPG1          SET ERROR CODE , NICE TRY   @ZA25063 10278037
         B     CHKERX              ABEND CHECKPOINT            @ZA25063 10282037
AROUND   EQU   *                                               @ZA25063 10286037
         LTR   R6,R6               Q. WAS THERE ONLY ONE DEB   @ZA25063 10290037
         BZ    CHKCOMP             YES-SKIP CODE TO INCREASE W. A. SIZE 10300017
         BCTR  R6,0                GET NUMBER OF DEBS MINUS TWO         10350017
         MH    R6,REPDCB1          COMPUTE W.A THAT IS                  10400017
         AR    R7,R6               NEEDED BY REPDCB.                    10600017
         DROP  R8                                                       10800017
*                                                                     * 11180017
*********************************************************************** 11280018
*                                                                     * 11380017
*        PUT ADDRESS OF WORK AREA ON DOUBLE-WORD BOUNDARY AND ISSUE   * 11580017
*        CONDITIONAL GETMAIN FOR WORK AREA OF SIZE COMPUTED.          * 11780017
*                                                                     * 11980017
*********************************************************************** 12080018
*                                                                     * 12180017
CHKCOMP  STC   R7,HKPSP            SAVE LOW ORDER BYTE OF ADDR.         13798002
         TM    HKPSP,DBLWDBND      IS ADDR ALREADY ON DBL WD BOUNDARY   13798400
         BC    ZERO,CHKGOON        YES-GO ON, NO FURTHER WORK NEEDED    13798800
         LA    R7,8(0,R7)          INCREASE ADDR BY EIGHT.              13799200
         SRA   R7,TRUNC3           TRUNCATE 3 LOW                       13799600
         SLA   R7,TRUNC3           ORDER BINARY DIGITS                  13799700
CHKGOON  BAL   R9,CHKCOMG          GO TO ISSUE CONDITIONAL GETMAIN      14000002
         B     *+4(RF)             IF RETURN CODE IS 0,                 14200017
         B     CHKCONT             CONTINUE NORMAL PROCESSING           14400017
         B     CHKERC              OTHERWISE-GO TO ERROR EXIT ROUTINE   14600002
*                                                                     * 17624017
*********************************************************************** 17625018
*                                                                     * 17627017
*        INITIALIZE WORK AREA WITH INFORMATION THAT WILL BE USED BY   * 17630017
*        CHECKPOINT MODULES                                           * 17633017
*                                                                     * 17636017
*********************************************************************** 17637018
*                                                                     * 17639017
         USING CHKWA,R6            ADDRESS W.A.                         17650002
CHKCONT  XC    CHKWA(ZLN),CHKWA    ZERO OUT W.A.                        17700002
         MVC   CKSYNAD(WDLNG),DCBSYNAD SAVE DCBSYNAD FIELD IN WA        17900002
         MVC   CKTIOTLN(LNG),HKPTIOTL MOVE INFO FROM SVRB SA TO WA      18100002
         USING PARMLST,RD          ADDR PARAMETER LIST                  18300018
         MVC   CKDCB(ADDRLNG),DCBORCN PUT ADDR OF CHKPT DCB INTO        18500002
         MVC   CKDCB2(ADDRLNG),DCBORCN DECBS INWA                       18700002
         LR    R8,R7               SAVE W.A. LENGTH.                    19300017
         SH    R7,SSCRBUFL         GET SUR/SSCR BUFFER OFFSET    Y02076 19400002
         ST    R7,CKBFOFST         SAVE IT                       Y02076 20300002
CHKCOCNC ST    R4,CKTCBAD          INITIALIZE CHKWA                     21400002
         ST    R8,CKWACL           SAVE LENGTH                          21600002
         ST    R5,CKERAS07         SAVE SVRB PTR                 Y02083 21650002
         LA    RF,CHKWAL           GET OFFSET TO CHKDCB W.A.            21800017
         ST    RF,CKWAOFST         SAVE IT                              22000002
         MVC   CKFLAG1(ONE),HKPFLAG MOVE IN FLAGS                       22200002
         TM    TCBFLGS6,TCBRV      IS THIS TASK V=R?             YM2776 22250001
         BNO   CKNOVEQR            NO, DO NOT SET BIT            YM2776 22300001
         OI    CKFLAG1,CKVEQR      SET V=R FLAG IN W.A.          YM2776 22350001
         DROP  R9                                                  I283 22700019
CKNOVEQR L     RF,TCBPQE           GET ADDR OF DUMMY PQE           I283 22800002
         LA    RF,L8(RF)           GET TO 1ST PQE PTR            Y02076 22850002
         L     RF,K0(RF)           GET ADR OF PQE                Y02076 22860002
         USING PQESECT,RF                                               22900000
CHKPQELP L     R9,PQEREGN          GET REGION STRT ADDR          Y02076 23050002
         ST    R9,CKPPM            STORE IN CHKPT W.A.           Y02076 23100002
         ST    RD,CKPARMAD                                              26200017
         TM    HKPFLAG,CKCANCEL    CANCEL REQUEST                Y02083 26210002
         BO    CHKDSS2D            IF YES, SKIP D/S              Y02083 26220002
*                                  SECURITY TESTING              Y02083 26230002
         EJECT                                                          26230502
*****************************************************************Y02083 26260002
*                                                                Y02083 26270002
*         TEST FOR MULTI-TASKING. IF FOUND, TERMINATE IN ERROR.  Y02083 26280002
*                                                                Y02083 26290002
*****************************************************************Y02083 26292002
*                                                                Y02083 26294002
CHKMULTT L     R2,HKPTIO           RESTORE TIOT ADDRESS          Y02083 26296002
         LA    RA,CKERPG12         LOAD MSG CODE IF ERROR OCCURS Y02083 26298002
         NC    TCBLTC,TCBLTC       ANY DAUGHTER TASKS            Y02083 26298402
         BNZ   CHKERX5B            YES, GO TO ERROR ROUTINE      Y02083 26298802
         LA    RA,CKERPG11         LOAD MSG CODE IF ERROR OCCURS Y02083 26299202
         CLM   R4,ADDRBYTS,TCBJSTCA IS THIS A JOB STEP TCB       Y02083 26299602
         BNE   CHKERX5B            IF NOT, GO TO ERROR ROUTINE   Y02083 26299702
*****************************************************************Y02083 26299802
*                                                                Y02083 26299902
*        OPEN CHECKPOINT DATA SET IF USER DID NOT OPEN DATA SET  Y02083 26316602
*                                                                Y02083 26326602
*****************************************************************Y02083 26328602
*                                                                Y02083 26330602
CHKOPEN  TM    DCBOFLGS,DCBOFOPN   CHKPT D/S ALREADY OPEN        Y02083 26331602
         BO    CHKOPEN2            IF YES, BRANCH                Y02083 26332102
         L     R7,TCBJSCB          FETCH JSCB ADDRESS            Y02083 26332602
         USING IEZJSCB,R7          ADDRESS JSCB                  Y02083 26333102
         L     R7,JSCDSABQ         FETCH DSAB-QDB ADDRESS        Y02083 26333602
         USING QDB,R7              ADDRESS DSAB-QDB              Y02083 26334102
         L     R7,QDBFELMP         FETCH 1ST DSAB ADDRESS        Y02083 26334602
         USING DSAB,R7             ADDRESS DSAB                  Y02083 26335102
         LA    RA,CKERPG2          ANTICIPATE MISSING DDNAME     Y02083 26339302
CHKOPEN1 LTR   R7,R7               DSAB ADDRESS OR ZERO          Y02083 26339802
         BZ    CHKERX5A            IF NO DSAB ADDR, GO EXIT      Y02083 26340302
         L     R9,DSABTIOT         FETCH TIOT ENTRY ADDRESS      Y02083 26340402
         USING TIOENTRY,R9         ADDRESS TIOT ENTRY            Y02083 26340702
         CLC   TIOEDDNM,DCBDDNAM   IS THIS THE CHKPT DD ENTRY    Y02083 26340802
         BE    CHKOPEN3            IF YES, BRANCH                Y02083 26341302
         L     R7,DSABFCHN         FETCH NEXT DSAB ADDRESS       Y02083 26341802
         B     CHKOPEN1            LOOP BACK FOR THIS DSAB       Y02083 26342402
CHKOPEN2 L     R7,DCBDEBAD         FETCH CHKPT D/S DEB ADDRESS   YM1237 26342802
         LA    RA,DEBBASIC-DEBPREFX ESTABLISH ADDRESSABILITY TO  YM1237 26343202
         SR    R7,RA               DEB PREFIX                    YM1237 26343602
         USING DEBPREFX,R7         ADDRESS DEB + PREFIX          YM1237 26344002
         LA    RA,CKERPG19         ANTICIPATE OPEN FOR INPUT ERR YM7008 26344102
         TM    DEBOPATB,OUTPUT     D/S OPEN FOR OUTPUT           YM7008 26348602
         BZ    CHKERX5B            IF NOT, TERMINATE IN ERROR    YM7040 26349002
         L     R7,DEBXTNP          FETCH DEB EXTENSION ADDRESS   YM1237 26350002
         USING DEBXTN,R7           ADDRESS DEB EXTENSION         YM1237 26350802
         L     R7,DEBXDSAB         FETCH DSAB ADDRESS            YM1237 26351602
         USING DSAB,R7             ADDRESS DSAB                  YM1237 26352402
         L     R9,DSABTIOT         FETCH TIOT ENTRY ADDRESS      Y02083 26353202
CHKOPEN3 LA    RA,CKERP213         ANTICIPATE SUBSYSTEM D/S ERR  Y02083 26354002
         TM    TIOELINK,TIOESSDS   CHKPT D/S A SUBSYSTEM D/S     Y02083 26354802
         BO    CHKERX5B            IF YES, TERMINATE IN ERROR    Y02083 26355602
         STM   R2,R7,CKJCT+TEMPSAVE-QMIOP SAVE REGS              YM4683 26356402
         ICM   R2,M14,TIOEJFCB     FETCH JFCB SWA ADDRESS        Y02083 26357202
         DROP  R9                  TIOT ENTRY ADDRESSABILITY     Y02083 26358002
         BAL   R5,CHKQMNGR         GO READ JFCB                  Y02083 26358802
         USING JFCBDSNM,R7         ESTABLISH JFCB ADDRESSABILITYZ30JSFC 26359203
         TM    JFCFLGS1,JFCBCEOV   CHKPT=EOV FOR THIS DATA SET? Z30JSFC 26359303
         BZ    CHKOPN3A            NO - CONTINUE                Z30JSFC 26359403
         NI    JFCFLGS1,XFF-JFCBCEOV    TURN OFF - INVAL REQUESTZ30JSFC 26359503
         BAL   R5,CHKQMNGW         REWRITE JFCB W/O CHKPT=EOV   Z30JSFC 26360803
         USING DSAB,R7             RESET DSAB ADDRESSABILITY    Z30JSFC 26370803
CHKOPN3A EQU   *                   CONTINUE                     Z30JSFC 26372803
         LR    R1,R7               JFCB ADDRESS TO REG 1         Y02083 26379003
         LM    R2,R7,CKJCT+TEMPSAVE-QMIOP RESTORE SAVED REGS     YM4683 26380303
         USING JFCBDSNM,R1         ADDRESS JFCB                  Y02083 26381603
         LA    RA,CKERP212         ANTICIPATE LABEL ERROR        Y02083 26382903
         TM    JFCBLTYP,JFCSUL     IS ONLY SL SPECIFIED          Y02083 26384203
         BNM   CHKERX5B            IF NOT, TERMINATE IN ERROR    Y02083 26385503
         DROP  R1                  JFCB ADDRESSABILITY           Y02083 26386803
         TM    DCBOFLGS,DCBOFOPN   IS CHKPT DATA SET OPEN        YM1237 26388103
         BNO   CHKOPEN4            IF NOT, GO OPEN CHKPT D/S     YM1237 26389403
         TM    DSABFLG4,DSABCKSI   SECURITY INTERFACE EXIST      YM1237 26390703
         BO    CHKAFOP             IF YES, BRANCH                YM1237 26392003
         OI    CKFLAG1,USERAUTH    SET AUTHORIZED-USER FLAG      YM1237 26393303
         B     CHKAFOP             CONTINUE                      YM1237 26394603
CHKOPEN4 TESTAUTH FCTN=1,KEY=YES   TEST FOR AUTHORIZED USER      YM1237 26395903
         LTR   RF,RF               TEST RETURN CODE              YM1237 26397203
         BNZ   CHKOPEN5            IF NOT AUTHORIZED, BRANCH     YM1237 26398503
         OI    CKFLAG1,USERAUTH    SET AUTHORIZED-USER FLAG      YM1237 26399803
         B     CHKOPEN6            CONTINUE                      YM1237 26401103
CHKOPEN5 OI    DSABFLG4,DSABCKSI   TELL OPEN USER NOT AUTHORIZED YM1237 26402403
         DROP  R7                  DSAB ADDRESSABILITY           YM1237 26403703
CHKOPEN6 ST    RC,CKERAS04         DCB ADDR TO OPEN'S PARM LIST  YM1237 26405003
         MVI   CKERAS04,OPENOPT    MOVE OPTION BYTE TO PARM LIST YM1237 26406303
         BAL   RE,CHKESTES         ESTABLISH ESTAE ENVIRON       YM5913 26407603
         MODESET KEYADDR=TCBPKF,WORKREG=10 ASSUME CALLER KEY     YM5921 26408903
         OPEN  MF=(E,CKERAS04)     OPEN CHKPT DATA SET           Y02083 26410203
         MODESET EXTKEY=ZERO       RESUME KEY ZERO               YM5921 26411503
         BAL   RE,CHKESTCN         CANCEL ESTAE ENVIRON          YM5913 26412803
         LA    RA,CKERPG2          ANTICIPATE OPEN ERROR         Y02083 26414103
         TM    DCBOFLGS,DCBOFOPN   WAS OPEN SUCCESSFUL           Y02083 26415403
         BZ    CHKERX5A            IF NOT, GO ERROR RTN          Y02083 26416703
         OI    CKFLAG1,CKOPEN      SET CHKPT OPEN FLAG           Y02083 26418003
CHKAFOP  EQU   *                   END OF OPEN PROCESSING        Y02083 26419303
         EJECT                                                          26420603
**************************************************************** Y02083 26421903
*                                                                Y02083 26423203
*        CHECKPOINT DATA SET SECURITY TESTING                    Y02083 26424503
*                                                                Y02083 26425803
**************************************************************** Y02083 26427103
*                                                                Y02083 26428403
*                                                                Y02083 26429703
*        TEST FOR DUMMY DATA SET. IF FOUND, TERMINATE THE        YM7008 26431003
*        CHECKPOINT WITH ERROR CODE (016) - INVALID DEVICE       YM7008 26432303
*                                                                Y02083 26433603
CHKDSSEC L     R7,DCBDEBAD         FETCH CHKPT DS DEB ADDRESS    Y02083 26434903
         LA    R8,DEBBASIC-DEBPREFX ESTABLISH ADDRESSABILITY TO  Y02083 26436203
         SR    R7,R8                 DEB PREFIX (DEBBASIC-DEB)   Y02083 26437503
         USING DEBPREFX,R7         ADDRESS DEB AND PREFIX        Y02083 26438803
         ST    R7,CKERAS00         SAVE CHKPT DEB PREFIX ADDRESS Y02083 26440103
         LA    RA,CKERPG16         ANTICIPATE DEVICE ERROR       YM7008 26441403
         CLC   DEBDEVED(2),ABLEV   DUMMY DATA SET              @ZA30032 26442737
         BE    CHKERX5B            IF DUMMY, GET OUT ON ERROR    Y02083 26443537
         LA    R9,DEBBASND         GET END ADR OF BASIC SECT     Y02083 26445303
         USING DEBDASD,R9          DASD SECT FOLLOWS BASIC       Y02083 26446603
         ICM   R8,M7,DEBUCBA       GET CHKPT UCB ADDR            Y02083 26447903
         DROP  R9                                                Y02083 26449203
         ST    R8,CKERAS03         SAVE CHKPT UCB ADDR           Y02083 26450503
*                                                                Y02083 26451803
*        CHECK TO SEE IF DATA SET IS ALREADY SECURE.             Y02083 26453103
*                                                                Y02083 26454403
         L     R8,DEBXTNP          FETCH DEB EXTENSION ADDRESS   Y02083 26455703
         ST    R8,CKERAS01         SAVE CHKPT DEB EXTENSION ADDR Y02083 26457003
         USING DEBXTN,R8           ADDRESS DEB EXTENSION         Y02083 26458303
         L     R8,DEBXDSAB         FETCH DSAB ADDRESS            Y02083 26459603
         ST    R8,CKERAS02         SAVE CHKPT DSAB ADDR          Y02083 26460903
         USING DSAB,R8             DSAB ADDRESSING               Y02083 26462203
         TM    DSABFLG4,DSABCKDS+DSABCKVL KNOWN SECURE CHKPT DS  Y02083 26463503
         BNO   CHKDSS01            IF NOT, CONTINUE TEST         YM5921 26464803
*                                                                Y02083 26466103
*        DETERMINE IF ALREADY-SECURE CHECKPOINT DATA SET HAS TO  Y02083 26467403
*        BE TESTED FOR CONCURRENT OPENS. THIS IS NECCESSARY FOR  Y02083 26468703
*        DIRECT ACCESS PHYSICAL SEQUENTIAL DATA SETS BECAUSE EOV Y02083 26470003
*        PROCESSING MAY HAVE EXTENDED THE DATA SET TO A NEW      Y02083 26471303
*        VOLUME WHICH MAY HAVE BEEN PREVIOUSLY OPENED TO BY      Y02083 26472603
*        ANOTHER USER DCB.                                       Y02083 26473903
*                                                                Y02083 26475203
         LA    RE,CHKDSS2D         SET RETURN ADDRESS            YM2860 26476503
         L     R7,CKERAS03         FETCH CHKPT UCB ADDRESS       Y02083 26477803
         USING UCBOB,R7            ADDRESS UCB                   Y02083 26479103
         TM    UCBJBNR,UCBVRDEV    VIO PSEUDO DEVICE             Y02083 26480403
         BO    CHKDSS2C            IF YES, CAN ONLY BE 1 VOL     Y02083 26481703
         CLI   UCBTBYT3,UCB3TAPE   TAPE DEVICE                   YM7811 26483003
         BE    CHKDSS2C            IF YES, CAN ONLY BE 1 OPEN    YM7811 26484303
         CLI   DSABORG1,DSABPO     D/S ORG PARTITIONED           Y02083 26485603
         BE    CHKDSS2C            IF YES, CAN ONLY BE 1 VOL     Y02083 26486903
         BAL   RE,CHKDSNRD         GO READ AND SAVE CHKPT DSN    YM7537 26488203
         LA    RE,CHKDSS2B         SET RETURN ADDRESS            YM5767 26489503
         B     CHKDSS2C            GO GET PROTECTED DCB ADDR, IF YM5767 26490803
*                                  NECESSARY, THEN GO CHECK FOR  YM5767 26492103
*                                  CONCURRENT OPEN'S             YM5767 26493403
*                                                                Y02083 26494703
*        TEST THE DEVICE TYPE ALLOCATED TO THE DATA SET.         Y02083 26496003
*                                                                Y02083 26497303
CHKDSS01 L     R7,CKERAS03         FETCH UCB ADDRESS             Y02083 26498603
         CLI   UCBTBYT3,UCB3DACC   DA DEVICE                     YM7811 26499903
         BNE   CHKNOTDA            IF NOT DA, BRANCH             YM7811 26501203
*                                                                YM7811 26502503
*        PRE-CONCURRENT OPEN TEST - SEE IF ANY DCB (OTHER THAN   YM7811 26503803
*        THE CHECKPOINT DCB) IS USING THE CHECKPOINT DSAB.       YM7811 26505103
*        THIS MUST BE PERFORMED BEFORE ANY POSSIBLE SECURITY     YM7811 26506403
*        INTERFACE IS INVOKED BY THE COMING OPEN SINCE A NON-S/I YM7811 26507703
*        DCB AND AN S/I DCB CAN NOT BE CORRECTLY DESCRIBED BY    YM7811 26509003
*        ONE DSAB.                                               YM7811 26510303
*                                                                YM7811 26511603
         LA    R1,DEBBASIC-DEBPREFX GET NEG DEB PREFIX OFFSET    YM7811 26512903
         ICM   R5,MF,TCBDEB        GET/TEST 1ST DEB ADDRESS      YM7811 26514203
CHKPRECT EQU   *                   TEST LOOP ENTRY               YM7811 26515503
         BZ    CHKDSS1A            GET OUT ON ZERO ADDRESS       YM7811 26516803
         SR    R5,R1               GET DEB PREFIX ADDRESS        YM7811 26518103
         USING DEBPREFX,R5         ADDRESS DEB PREFIX            YM7811 26519403
         C     R5,CKERAS00         IS THIS THE CHKPT DEB         YM7811 26520703
         BE    CHKGETNT            IF YES, GET NEXT DEB          YM7811 26522003
         L     R7,DEBXTNP          GET DEB EXTENSION ADDRESS     YM7811 26523303
         USING DEBXTN,R7           ADDRESS DEB EXTENSION         YM7811 26524603
         LA    RA,CKERP209         ANTICIPATE CONCURRENT OPEN    YM7811 26525903
         CLC   CKERAS02,DEBXDSAB   COMPARE FOR SAME DSAB         YM7811 26527203
         BE    CHKERX5B            BRANCH IF THEY ARE THE SAME   YM7811 26528503
CHKGETNT EQU   *                   GET NEXT DEB ENTRY            YM7811 26529803
         ICM   R5,M7,DEBDEBB       GET/TEST NEXT DEB ADDRESS     YM7811 26531103
         B     CHKPRECT            LOOP BACK                     YM7811 26532403
         DROP  R5,R7               DEB, AND DEB EXTENSION        YM7811 26533703
*                                                                YM7811 26535003
*        CONTINUE DEVICE CHECK                                   YM7811 26536303
*                                                                YM7811 26537603
         USING UCBOB,R7            RE-ESTABLISH UCB ADDRESSING   YM7811 26538903
CHKNOTDA EQU   *                   NON-DA ENTRY                  YM7811 26540203
         LA    RA,CKERPG16         ANTICIPATE ERRONEOUS DEVICE   Y02083 26541503
         CLI   UCBTBYT3,UCB3TAPE   TAPE DEVICE                   YM7811 26542803
         BNE   CHKERX5B            IF NOT, GO TO ERROR ROUTINE   YM7811 26544103
*                                                                Y02083 26545403
*        TEST FOR A VALID TAPE BLOCK COUNT.                      Y02083 26546703
*                                                                Y02083 26548003
         LA    RA,CKERP208         ANTICIPATE BLOCK COUNT ERROR  Y02083 26549303
         OC    DCBBLKCT,DCBBLKCT   TEST TAPE BLOCK COUNT         Y02083 26550603
         BNZ   CHKERX5B            IF NOT ZERO, ERRONEOUS DATA   Y02083 26551903
*                                  EXISTS ON TAPE; GO TERMINATE  Y02083 26553203
*                                  IN ERROR                      Y02083 26554503
         EJECT                                                          26555803
*        IN ORDER TO CREATE TAPE AND DA LABELS WITH THE          Y02083 26557103
*        CHECKPOINT DATA SET INDICATORS, THE FOLLOWING           Y02083 26558403
*        CODE WILL:                                              Y02083 26559703
*                                                                Y02083 26561003
*        1. TURN OFF THE DSABUNAL BIT FOR THE CHECKPOINT D S     YM7324 26562303
*        2. SET DEBDSNM TO ZERO TO PREVENT A STOW                YM7324 26563603
*        3. CLOSE THE CHECKPOINT DATA SET                        Y02083 26564903
*        4. SET THE JFCB STATUS TO "NEW"                         Y02083 26566203
*        5. RESTORE THE DSABUNAL BIT                             YM7324 26567503
*        6. OPEN THE CHECKPOINT DATA SET                         Y02083 26568803
*        7. RESTORE THE JFCB STATUS FIELD                        Y02083 26570103
*                                                                Y02083 26571403
CHKDSS1A EQU  *                                                  YM7324 26572703
         MVC   SIOTSAVE(ONE),DSABFLG2  SAVE DSAB FLAG            YM7324 26574003
         NI    DSABFLG2,X'FF'-DSABUNAL TURN OFF UNALLOC FLAG     YM7324 26575303
         L     R7,CKERAS00         GET DEB ADDRESS               YM7324 26576603
         USING DEBPREFX,R7                                       YM7324 26577903
         SR    R5,R5               ZERO REGISTER                 YM7324 26579203
         SR    R1,R1               ZERO REGISTER                 YM7324 26580503
         IC    R5,DEBNMEXT         GET NUMBER OF EXTENTS         YM7324 26581803
         IC    R1,DEBEXSCL         GET EXTENT SCALING FACTOR     YM7324 26583103
         SLL   R5,0(R1)            EXT SIZE X EXT NUMBER         YM7324 26584403
         LA    R5,DEBBASND(R5)     EXTENTS + DEB + BASE          YM7324 26585703
         USING DEBACSMD,R5                                       YM7324 26587003
         TM    DCBDSORG,DCBDSGPO   DCB FOR PO DATA SET?          YM7324 26588303
         BO    CHKDSS1B            BRANCH IF YES                 YM7324 26589603
         LA    R5,DEBDSNM          ADD SAM LENGTH TO DEB SIZE    YM7324 26590903
CHKDSS1B EQU   *                                                 YM7324 26592203
         CLI   DEBAMLNG,L'DEBDSNM  IS THE ACCESS METHOD DEP      YM7324 26593503
*                                  SECTION PRESENT?              YM7324 26594803
         BL    CHKDSS1C            BRANCH IF NO                  YM7324 26596103
         USING DEBDSNM,R5                                        YM7324 26597403
         MVI   DEBDSNM,X00         ZERO OUT MEMBER NAME IN DEB   YM7324 26598703
*                                  TO PREVENT STOW BY CLOSE      YM7324 26600003
         DROP  R5                                                YM7324 26601303
CHKDSS1C EQU   *                                                 YM7324 26602603
         ST    RC,CKERAS04         SETUP PARM LIST FOR           Y02083 26603903
         MVI   CKERAS04,CLOSEOPT   CLOSE WITH LEAVE              Y02083 26605203
         MODESET KEYADDR=DEBPROTG,WORKREG=5 ASSUME D/S KEY       YM5744 26606503
         DROP  R7                  DEB ADDRESSABILITY            YM5744 26607803
         CLOSE MF=(E,CKERAS04)     CLOSE D/S                     Y02083 26609103
         MODESET EXTKEY=ZERO       RETURN TO SUPERVISOR KEY      YM5744 26610403
         L     R7,DSABTIOT         FETCH TIOT DD ENTRY ADDR      Y02083 26611703
         USING TIOELNGH,R7         ADDRESS TIOT DD ENTRY         Y02083 26613003
         ICM   R2,M14,TIOEJFCB     FETCH JFCB SVA                Y02083 26614303
         DROP  R7                  TIOT DD ENTRY ADDRESSING      Y02083 26615603
         BAL   R5,CHKQMNGR         GO READ JFCB                  Y02083 26616903
         USING JFCBDSNM,R7         ADDRESS JFCB                  Y02083 26618203
         MVC   JFCBSAVE(ONE),JFCBIND2 SAVE JFCB STATUS           Y02083 26619503
         MVI   JFCBIND2,JFCNEW     SET STATUS=NEW                Y02083 26620803
         DROP  R7                  JFCB ADDRESSING               Y02083 26622103
         BAL   R5,CHKQMNGW         GO WRITE BACK JFCB            Y02083 26623403
         MVC   DSABFLG2(ONE),SIOTSAVE RESTORE DSAB FLAG FIELD    YM7324 26624703
         OI    DSABFLG4,DSABCKDS   SET DSAB CHKPT D/S FLAG       Y02083 26626003
         TM    CKFLAG1,USERAUTH    AUTHORIZED USER               YM1237 26627303
         BO    CHKDSS1F            IF YES, BRANCH                YM1237 26628603
         OI    DSABFLG4,DSABCKSI   TELL OPEN USER NOT AUTHORIZED YM1237 26629903
CHKDSS1F MVI   CKERAS04,OPENOPT    SET OPEN FOR OUTPUT           Y02083 26631203
         BAL   RE,CHKESTES         ESTABLISH ESTAE ENVIRON       YM5913 26632503
         MODESET KEYADDR=TCBPKF,WORKREG=10 ASSUME CALLER KEY     YM5921 26633803
         OPEN  MF=(E,CKERAS04)     OPEN FOR OUTPUT               Y02083 26635103
         MODESET EXTKEY=ZERO       RESUME KEY ZERO               YM5921 26636403
         BAL   RE,CHKESTCN         CANCEL ESTAE ENVIRON          YM5913 26637703
         L     R7,DSABTIOT         FETCH TIOT DD ENTRY ADDRESS   Y02083 26639003
         USING TIOELNGH,R7         ADDRESS TIOT DD ENTRY         Y02083 26640303
         ICM   R2,M14,TIOEJFCB     FETCH JFCB SVA                Y02083 26641603
         DROP  R7                  TIOT DD ENTRY ADDRESSING      Y02083 26642903
         BAL   R5,CHKQMNGR         GO READ JFCB                  Y02083 26644203
         USING JFCBDSNM,R7         ADDRESS JFCB                  Y02083 26645503
         MVC   JFCBIND2(ONE),JFCBSAVE RESTORE JFCB STATUS        Y02083 26646803
         DROP  R7                  JFCB ADDRESSING               Y02083 26648103
         BAL   R5,CHKQMNGW         GO WRITE BACK JFCB            Y02083 26649403
*                                                                Y02083 26650703
*        TEST TO SEE IF OPEN FOUND A SECURE DATA SET.            Y02083 26652003
*                                                                Y02083 26653303
         LA    RA,CKERP211         ANTICIPATE NON-SECURE D/S     Y02083 26654603
         TM    DSABFLG4,DSABCKVL   DID OPEN FIND A SECURE D/S    Y02083 26655903
         BZ    CHKERX5B            IF NOT, GO TO ERR EXIT        Y02083 26657203
         BAL   RE,CHKDSS2C         GO GET PROPER DCB ADDR        YM2860 26658503
*                                                                Y02083 26659803
*        TEST FOR TAPE DATA SET AND IF TAPE, BYPASS REMAINING    Y02083 26661103
*        SECURITY TESTS.                                         Y02083 26662403
*                                                                Y02083 26663703
         L     R7,CKERAS03         FETCH CHKPT UCB ADDR          Y02083 26665003
         USING UCBOB,R7            ADDRESS UCB                   Y02083 26666303
         CLI   UCBTBYT3,UCB3TAPE   TAPE DEVICE                   YM7811 26667603
         BE    CHKDSS2D            IF YES, SKIP REMAINING TESTS  YM7811 26668903
*                                                                       26670203
*        READ THE CHECKPOINT DATA SET FORMAT 1 DSCB FOR          YM7324 26671503
*        DATA SET ORGANIZATION CHECK, AND SUBSEQUENT             YM7324 26672803
*        CONCURRENT OPEN TESTING.                                YM7324 26674103
*                                                                       26675403
         TM    UCBJBNR,UCBVRDEV    PSEUDO DEVICE FOR VIO         YM7324 26676703
         BO    CHKDSS1G            IF YES, BYPASS READING DSCB   YM7324 26678003
         BAL   RE,CHKDSNRD         GO READ AND SAVE CHKPT DSN    YM7537 26679303
*                                                                Y02083 26680603
*        TEST DATA SET ORGANIZATION                              Y02083 26681903
*                                                                Y02083 26683203
         LA    RE,XBUF             GET POINTER TO FORMAT 1 DSCB  YM7324 26684503
         USING IECSDSF1,RE                                       YM7324 26685803
         CLI   DS1DSORG,DCBDSGPO   IS THIS A PO DATA SET?        YM7324 26687103
         BE    CHKDSS2A            IF YES, BR                    YM7324 26688403
         B     CHKDSS1H            GO CHECK FOR PS               YM7324 26689703
*                                                                       26691003
*        FOR A VIO UCB, THE FORMAT 1 DSCB FOLLOWS THE UCB        YM7324 26692303
*        IN CORE.                                                YM7324 26693603
*                                                                       26694903
CHKDSS1G EQU   *                                                 YM7324 26696203
         L     R7,CKERAS03         GET UCB POINTER               YM7324 26697503
         USING VDSUCB,R7                                         YM7324 26698803
         LA    RE,VDSDSCB          GET POINTER TO VIO DSCB       YM7324 26700103
         CLI   DS1DSORG,DCBDSGPO   IS THIS A PO DATA SET?        YM7324 26701403
         BE    CHKDSS2A            IF YES, BR                    Y02083 26702703
         DROP  RE                                                YM7324 26704003
CHKDSS1H EQU   *                                                 YM7324 26705303
         LA    RA,CKERPG07         ANTICIPATE ERRONEOUS DSORG    Y02083 26706603
         CLI   DCBDSORG,DCBDSGPS   D/S ORG PHYSICAL SEQUENTIAL   YM5717 26707903
         BNE   CHKDS60             IF NOT, GO RESET CHKPT FLAG   Y02083 26709203
*                                                                Y02083 26710503
*        ENSURE THAT THE NEW BSAM DATA SET IS EMPTY.             Y02083 26711803
*                                                                Y02083 26713103
         L     R7,CKERAS00         FETCH CHKPT DEB ADDRESS       Y02083 26714403
         USING DEBPREFX,R7         ADDRESS DEB                   Y02083 26715703
         CLC   DCBFDAD+K1(K6),DEBBASND+DEBBINUM-DEBDASD COMPARE  Y02083 26717003
*                                  FIRST DEB EXTENT ADDRESS TO   Y02083 26718303
*                                  THE FIRST DCB WRITE ADDRESS   Y02083 26719603
*                                  IF NOT EQUAL, THE SUBJECT     Y02083 26720903
*                                  BSAM D/S IS NOT EMPTY         Y02083 26722203
         LA    RA,CKERP208         ANTICIPATE D/S ERROR          Y02083 26723503
         BNE   CHKDS60             IF NOT EQUAL, GO RESET CP D/S Y02083 26724803
         CLI   DCBFDAD+K7,K0       ENSURE RECORD # IS 1          YM5717 26726103
         BNE   CHKDS60             IF NOT 1, GO RESET CP D/S     Y02083 26727403
         B     CHKDSS2B            BYPASS PO D/S TESTING         Y02083 26728703
*                                                                Y02083 26730003
*        ENSURE THAT THE NEW PO DATA SET DIRECTORY IS EMPTY.     Y02083 26731303
*                                                                Y02083 26732603
CHKDSS2A BAL   RE,CHKDEBLD         GO BUILD SKELETON DEB/IOB/CP  Y02083 26733903
         L     R7,CKERAS00         FETCH CHKPT DEB ADDRESS       Y02083 26735203
         USING DEBPREFX,R7         ADDRESS DEB                   Y02083 26736503
         MVC   XDCBFDAD+K1(K6),DEBBASND+DEBBINUM-DEBDASD MOVE IN Y02083 26737803
*                                  BB, CC, AND HH OF DCBFDAD     Y02083 26739103
         MVI   XDCBFDAD+K7,K1      SET RECORD # TO 1             Y02083 26740403
         MVI   XCCW3,RDDATACM      SET CCW READ DATA COMMAND     Y02083 26741703
         MVI   XCCW3+K7,K14        SET DATA LENGTH TO 14         Y02083 26743003
         MVC   XDEBBINU(L12),DEBBASND+DEBBINUM-DEBDASD MOVE IN   Y02083 26744303
*                                  UCB ADDRESS AND 1ST EXTENT    Y02083 26745603
         MVC   XIOBFDAD(L8),XDCBFDAD SET IOB SEEK ADDRESS        Y02083 26746903
         BAL   RE,CHKEXCP2         GO READ PDS DIRECTORY ENTRY   Y02083 26748203
         LA    RA,CKERP208         ANTICIPATE PDS ERRORS         Y02083 26749503
         CLC   XBUF(K10),KPDS      IS DIRECTORY EMPTY            YM5717 26750803
         BNE   CHKDS60             IF NOT EMPTY, GO RESET CP D/S Y02083 26752103
*                                                                Y02083 26753403
*        TEST FOR A SHARED DA DEVICE.                            Y02083 26754703
*                                                                Y02083 26756003
CHKDSS2B L     R7,CKERAS03         FETCH CHKPT UCB ADDRESS       Y02083 26757303
         USING UCBOB,R7            ADDRESS UCB                   Y02083 26758603
         LA    RA,CKERP214         ANTICIPATE SHARED DA ERROR    Y02083 26759903
         TM    UCBTBYT2,UCBRR      TEST DA SHARABLE BIT          Y02083 26761203
         BO    CHKDS60             IF ON, GO RESET CP D/S        Y02083 26762503
*                                                                Y02083 26763803
*        TEST FOR ANOTHER DCB OF NON-CHECKPOINT STATUS BEING     Y02083 26765103
*        CONCURRENTLY OPEN TO OUR CHECKPOINT DATA SET.           Y02083 26766403
*                                                                Y02083 26767703
         BAL   RE,CHKDEBLD         CONSTRUCT DEB/IOB/CP          YM7537 26769003
         ICM   R7,MF,TCBDEB        FETCH/TEST 1ST DEB ADDR       Y02083 26770303
         USING DEBBASIC,R7                                       YM7324 26771603
CHKDS02B BZ    CHKDS42B            TERM TEST IF NO MORE DEB'S    Y02083 26772902
         TM    DEBFLGS1,DEBCINDI   IS IT ISAM/VSAM CI          @ZA31342 26782937
         BO    CHKDS22B            BYPASS DSCB READ IF YES     @ZA31342 26792937
         LA    R9,DEBBASIC-DEBPREFX GET DEB                      Y02083 26822902
         SR    R7,R9               PREFIX ADDRESS                Y02083 26872902
         USING DEBPREFX,R7                                       YM7324 26874902
         CLI   DEBAMTYP,X'01'      IS IT VSAM                    YM5913 26882902
         BE    CHKDS22B            BYPASS DSCB READ IF YES       YM5913 26892902
         L     R9,DEBXTNP          FETCH DEB EXTENSION ADDR      Y02083 26922902
         USING DEBXTN,R9           ADDRESS DEB EXTENSION         Y02083 26932902
         L     RA,DEBXDSAB         FETCH DSAB ADDR               Y02083 26942902
         USING DSAB,RA             ADDRESS DSAB                  Y02083 26952902
         TM    DSABFLG4,DSABCKDS   D/S ALREADY FLAGED AS CHKPT   Y02083 26962902
         BO    CHKDS22B            IF YES, BYPASS REMAINING TSTS Y02083 26964902
         L     RA,DSABTIOT         FETCH TIOT ENTRY ADDRESS      Y02083 26974902
         USING TIOENTRY,RA         ADDRESS TIOT ENTRY            Y02083 26984902
         TM    TIOELINK,TIOESSDS   SUBSYSTEM D/S                 Y02083 26994902
         BO    CHKDS22B            IF YES, CAN'T BE CHKPT D/S    Y02083 27004902
         SR    R8,R8               CLEAR REG FOR TEST            Y02083 27014902
         ICM   R8,M7,TIOEFSRT      FETCH/TEST 1ST UCB ADDR       Y02083 27024902
         BZ    CHKDS22B            IF ZERO - DUMMY -, BR         Y02083 27034902
         USING UCBOB,R8            ADDRESS UCB                   Y02083 27044902
         CLI   UCBTBYT3,UCB3DACC   DA DEVICE                     Y02083 27054902
         BNE   CHKDS22B            IF NOT DA, SKIP THIS D/S      Y02083 27064902
         TM    UCBJBNR,UCBVRDEV    PSEUDO DEVICE FOR VIO         Y02083 27084902
         BO    CHKDS12B            IF YES, GO COMPARE UCB ADDR'S Y02083 27134902
         L     R8,CKERAS03         GET CHKPT UCB ADDR            YM6545 27135302
         TM    UCBJBNR,UCBVRDEV    IS CHKPT DEVICE VIO           YM6545 27135702
         BO    CHKDS22B            IF YES, BYPASS REMAINING TEST YM6545 27136102
         BAL   RE,CHKEXCP          GO READ FORMAT 1 DSCB         Y02083 27136902
         CLC   XDSN(K44),XBUF      MATCHING DSN'S                Y02083 27138902
         LA    RA,CKERP209         ANTICIPATE CONCURRENT OPEN    Y02083 27148902
         BE    CHKDS60             IF MATCH, IT'S AN ERROR       Y02083 27188902
         B     CHKDS22B            GO FOR NEXT D/S               Y02083 27190902
CHKDS12B C     R8,CKERAS03         MATCHING UCB ADDRESS'S        Y02083 27192902
         LA    RA,CKERP209         ANTICIPATE CONCURRENT OPEN    Y02083 27193002
         BE    CHKDS60             IF MATCH, IT'S AN ERROR       Y02083 27193302
CHKDS22B ICM   R7,M7,DEBDEBB       FETCH/TEST NEXT DEB ADDR      Y02083 27243302
         B     CHKDS02B            LOOP BACK                     Y02083 27243702
         DROP  R7,R9,RA            DEB, DEBX, AND DSAB           YM6564 27244102
*                                                                Y02083 27244502
*        ENSURE CHECKPOINT DATA SET IS ENQUED EXCLUSIVE.         Y02083 27244602
*                                                                Y02083 27244702
CHKDS42B EQU   *                                                        27244802
*        NOTE: SCHEDULER DOES NOT ENQUE ON VIO DATA SETS.        YM6564 27246902
         L     R8,CKERAS03         GET CHKPT UCB ADDR            YM6564 27248102
         TM    UCBJBNR,UCBVRDEV    IS CHKPT DEVICE VIO           YM6564 27250102
         BO    CHKDSS2D            IF YES, BYPASS REMAINING TEST YM6564 27250502
         DROP  R8                  UCB                           YM6564 27250902
         XC    CKERAS05,CKERAS05   CLEAR ENQ PARM FLAGS          Y02083 27251602
         MVI   CKERAS05,X81        SET LAST ENTRY AND TCB FLAGS  Y02083 27254902
         MVC   CKERAS08(L8),CHKQNAME RELOCATE ENQ QNAME          Y02083 27264902
         LA    R7,XDSN             GET ADDR OF CHKPT DSN         Y02083 27274902
*        LR    R8,R7               INIT DSN PNTR TO 1ST CHAR   @ZA11608 27284937
         LA    R8,X'2B'(R7)        ADD MAX LENGTH OF DSN       @ZA11608 27285637
BACK     EQU   *                                               @ZA11608 27286337
         CLI   0(R8),X'40'         IS LAST CHAR A BLANK ?      @ZA11608 27287037
         BNE   ADJUST              NO END HAS BEEN FOUND       @ZA11608 27287737
         BCT   R8,BACK             NO BRANCH BACK TO TEST      @ZA11608 27288437
ADJUST   EQU   *                                               @ZA11608 27289137
         LA    R8,1(R8)            ADD ONE TO LENGTH           @ZA11608 27289837
*HKDS50  CLI   K0(R8),BLANK        IS CHAR BLANK                 Y02083 27290537
*        BE    CHKDS52             IF BLANK, COMPUTE DSN LENGTH  Y02083 27291237
*        LA    R8,K1(,R8)          BUMP DSN POINTER TO NEXT CHA  Y02083 27291937
*        B     CHKDS50             LOOP BACK                     Y02083 27292637
CHKDS52  SR    R8,R7               GET LENGTH OF CHKPT DSN       Y02083 27293302
         L     R9,TCBOTC           GET INIT TCB ADDR FOR         Y02083 27293702
*                                  DIRECTED ENQ                  Y02083 27294102
         L     R5,CKERAS07         SAVE SVRB ADDR ACROSS ENQ     Y02083 27294202
         ENQ   (CKERAS08,XDSN,S,(R8),SYSTEM),RET=TEST,TCB=(R9),  YM7305*27294502
               MF=(E,CKERAS05)                                   Y02083 27294602
         ST    R5,CKERAS07         RESTORE SAVED SVRB ADDR       Y02083 27304602
         LA    RA,CKERP210         ANTICIPATE DISP=SHR ERROR     Y02083 27344602
         LTR   RF,RF               SUCCESS SHARED ENQ            YM7305 27344702
         BZ    CHKDS60             IF YES, BR - IT'S AN ERROR    YM7305 27344802
         CLI   K3(RF),RETCD08      WAS THERE A PREVIOUS ENQ      YM7305 27346802
         BNE   CHKDS60             IF NOT, IT'S AN ERROR         YM7305 27348802
         TM    K0(RF),SHRFLAG      IS DSN ENQ'ED FOR SHR         YM7305 27350802
         BO    CHKDS60             IF YES, IT'S AN ERROR         YM7305 27352802
         B     CHKDSS2D            CONTINUE WITH CHECKPOINT      YM2860 27354802
*                                                                Y02083 27394802
*        TEST FOR A SECURITY INTERFACE. IF ONE EXITS, ESTABLISH  Y02083 27444802
*        THE ADDRESS OF THE PROTECTED DCB.                       Y02083 27454802
*                                                                Y02083 27464802
CHKDSS2C L     R8,CKERAS02         FETCH ADDRESS OF CHKPT DSAB   Y02083 27474802
         USING DSAB,R8             ADDRESS DSAB                  Y02083 27484802
         NI    CKFLAG1,X'FF'-USERAUTH 0 POSSIBLE AUTH-USER FLAG  YM1237 27485802
         SR    R7,R7               CLEAR WORK REG                YM2860 27486202
         ICM   R7,M7,DCBDEBA       FETCH NEW DEB ADDRESS         YM2860 27486602
         LA    RF,DEBBASIC-DEBPREFX GET LENGTH OF PREFIX         YM2860 27486702
         SR    R7,RF               BACK UP TO DEB PREFIX         YM2860 27489202
         ST    R7,CKERAS00         STORE DEB PREFIX ADDR         YM2860 27489602
         TM    DSABFLG4,DSABCKSI   IS USER AUTHORIZED            Y02083 27490502
         BZR   RE                  IF YES, RETURN - NO SI        YM2860 27492402
         USING DEBPREFX,R7         ADDRESS DEB                   Y02083 27496202
         ICM   RC,M7,DEBDCBB       SHIFT DCB POINTER TO          Y02083 27498102
*                                  PROTECTED DCB                 Y02083 27500002
         STCM  RC,M7,CKDCB         UPDATE DCB PNTR IN DECB1      YM5767 27502302
         STCM  RC,M7,CKDCB2        AND DECB2                     YM5767 27502702
         BR    RE                  RETURN WITH PROPER DCB ADDR   YM2860 27503802
         EJECT                                                          27505702
*        EXCP SUBROUTINE FOR READING THE PDS DIRECTORY ENTRY OF  Y02083 27507602
*        THE CHECKPOINT DATA SET AND FOR READING AND WRITING     Y02083 27509502
*        THE FORMAT 1 DSCB OF CHECKPOINT AND NON-CHECKPOINT      Y02083 27511402
*        DATA SETS DURING THE CONCURRENT OPEN TEST.              Y02083 27521402
*                                                                Y02083 27523402
*        INPUT:                                                  Y02083 27525402
*                                                                Y02083 27527402
*              R7 - ADDRESS OF DATA SET'S DEB (PREFIX)           Y02083 27527802
*                                                                Y02083 27527902
         USING DEBPREFX,R7         ADDRESS DEB PREFIX            Y02083 27537902
CHKEXCP  MVC   XIOBFDAD+K1(K7),DEBDSCBA MOVE IN DSCB DISK ADDR   Y02083 27540302
         MVI   XIOBFDAD,X00        SET M TO ZERO                 Y02083 27540702
CHKEXCP2 LA    R9,DEBBASND         GET END ADR OF BASIC SECT     Y02083 27540802
         USING DEBDASD,R9          DASD SECT FOLLOWS BASIC       Y02083 27540902
         CLI   DEBAMTYP,AMTYPIS    IS THIS AN ISAM DEB?        @ZA31342 27541037
         BNE   CHKEXCP3            NO, GET UCB POINTER         @ZA31342 27541737
         LA    R9,ISEXTLEN(,R9)    SKIP OVER ISAM SECT           YM7076 27543102
CHKEXCP3 EQU   *                                                 YM7076 27543502
         MVC   XDEBUCBA(K3),DEBUCBA UCB ADDR TO WORKING DEB      Y02083 27544502
         DROP  R9                                                Y02083 27546202
         MVI   XECB,X00            CLEAR ECB                     Y02083 27547902
         EXCP  XIOB                                              Y02083 27549602
         WAIT  ECB=XECB                                          Y02083 27551302
         CLI   XECB,X7F            TEST FOR SUCCESSFUL I/O       Y02083 27553002
         BNE   CHKEXCPR            BR IF ERR TO SET CODE         YM5717 27554702
         BR    RE                  RETURN TO CALLER              Y02083 27571402
CHKEXCPR LA    RA,CKERPG2          SET I/O ERR CODE              YM5717 27571802
         B     CHKERX5A            BR TO ERR EXIT                YM5717 27572202
*                                                                Y02083 27573402
*        SUBROUTINE TO BUILD A SKELETON DEB, IOB, AND CP FOR     Y02083 27575402
*        VARIOUS I/O FUNCTIONS.                                  Y02083 27577402
*                                                                Y02083 27577802
CHKDEBLD XC    XDCB(XBUF-XDCB),XDCB CLEAR WORK SPACE             Y02083 27577902
         LA    R5,XIOB             SETUP DCB                     Y02083 27578002
         ST    R5,XDCBIOBA           IOB ADDRESS                 Y02083 27588002
         LA    R5,XDEB             SETUP DCB                     Y02083 27590002
         ST    R5,XDCBDEBA           DEB ADDRESS                 Y02083 27592002
         MVI   XDEBNMEX,K1         SET DEB EXTENT COUNT=1        Y02083 27594002
         L     R5,CVTXAPG          GET ADDR OF IOS APPENDAGES    Y02083 27594402
         ST    R5,XDEBAPPA         STORE IN DEB                  Y02083 27594502
         LA    R5,XDCB             SETUP DEB                     Y02083 27594602
         ST    R5,XDEBDCBA           DCB ADDRESS AND IOB         Y02083 27594702
         ST    R5,XIOBDCBA           DCB ADDRESS                 Y02083 27644702
         MVI   XDEBDEBI,X0F        SET DEB ID AND STORAGE KEY    Y02083 27661402
         MVI   XDEBEXSC,X04        SET DEB EXTENT SCALE          Y02083 27671402
         MVI   XDEBDVMO,XC0        SET DEVICE MODIFIER           Y02083 27673402
         LH    R5,MAXTRK           SET MAX TRACK                 Y02083 27675402
         STH   R5,XDEBENDC           CAPACITY FOR                Y02083 27677402
         STH   R5,XDEBENDH           HANDLING ANY                Y02083 27677802
         STH   R5,XDEBNMTR           SIZE DA DEVICE              Y02083 27677902
         LA    R5,XECB             SETUP IOB                     Y02083 27678002
         ST    R5,XIOBECBA           ECB ADDRESS                 Y02083 27688002
         MVI   XIOBFLG1,X02        SET IOB UNRELATED FLAG        Y02083 27690002
         LA    R5,XCCW1            SETUP IOB                     Y02083 27692002
         ST    R5,XIOBCPA            CHANNEL PROGRAM ADDRESS     Y02083 27694002
         MVC   XCCW1(L24),KCCW123  MOVE IN CCW CONSTANTS         Y02083 27694402
         LA    R5,XIOBFDAD+K3      SET CCW1'S                    Y02083 27694502
         STCM  R5,M7,XCCW1+K1        SEARCH ARG ADDRESS          Y02083 27694602
         MVI   XCCW1+K4,CC              SET COMMAND CHAINING     YM5717 27711302
         LA    R5,XCCW1            SET CCW2'S                    Y02083 27728002
         STCM  R5,M7,XCCW2+K1        TIC ADDRESS                 Y02083 27744702
         LA    R5,XBUF             SET CCW3'S                    Y02083 27761402
         STCM  R5,M7,XCCW3+K1        READ/WRITE AREA ADDRESS     Y02083 27771402
         BR    RE                  RETURN TO CALLER              Y02083 27773402
*                                                                YM7537 27773502
*        SUBROUTINE TO READ THE CHECKPOINT DATA SET F1 DSCB      YM7537 27773602
*        AND SAVE THE DATA SET NAME FOR SUBSEQUENT USE.          YM7537 27773702
*                                                                YM7537 27774902
CHKDSNRD ST    RE,CKERAS09         SAVE RETURN ADDRESS           YM7537 27776902
         BAL   RE,CHKDEBLD         CONSTRUCT DEB/IOB/CP          YM7324 27777102
         L     R7,CKERAS00         FETCH CHKPT DEB ADDRESS       YM7324 27778302
         USING DEBPREFX,R7         ADDRESS DEB PREFIX            YM7324 27779502
         BAL   RE,CHKEXCP          GO READ CHKPT FORMAT 1 DSCB   YM7324 27780702
         MVC   XDSN(K44),XBUF      SAVE CHKPT DSN FOR COMPARE    YM7324 27781902
         L     RE,CKERAS09         RESTORE RETURN ADDRESS        YM7537 27782302
         BR    RE                  RETURN TO MAINLINE            YM7537 27782702
         EJECT                                                          27783102
*        RESET THE CHECKPOINT DATA SET INDICATOR IN THE FORMAT   Y02083 27784302
*        1 DSCB IF A SECURITY ERROR IS ENCOUNTERED AFTER A NEW   Y02083 27785502
*        CHECKPOINT DATA SET IS CREATED BY OPEN.                 Y02083 27786702
*                                                                Y02083 27787902
CHKDS60  LM    R7,R8,CKERAS02      GET DSAB & UCB ADDRESSES      YM7811 27792302
         USING DSAB,R7             ADDRESS DSAB                  YM7811 27792702
         NI    DSABFLG4,X'FF'-DSABCKVL RESET CHKPT SECURE FLAG   YM7811 27793102
         DROP  R7                  DSAB                          UM7811 27793502
         USING UCBOB,R8            ADDRESS UCB                   Y02083 27793902
         TM    UCBJBNR,UCBVRDEV    VIO PSEUDO DEVICE             Y02083 27794302
         BZ    CHKDS62             IF NOT, BR                    Y02083 27794702
         NI    VDSDSCB-VDSCB+DS1DSIND-DS1DSNAM(R8),XFF-DS1CHKPT  Y02083 27804702
*                                  RESET CHECKPOINT D/S          Y02083 27814702
*                                  INDICATOR IN VIO DSCB         Y02083 27824702
         B     CHKERX5B            GO TO ERROR EXIT              Y02083 27834702
CHKDS62  BAL   RE,CHKDEBLD         GO CONSTRUCT DEB/IOB/CP       Y02083 27836702
         L     R7,CKERAS00         FETCH CHKPT DEB ADDR FOR EXCP Y02083 27838702
         BAL   RE,CHKEXCP          GO READ CHKPT DSCB            Y02083 27840702
         NI    XBUF+DS1DSIND-DS1DSNAM,XFF-DS1CHKPT RESET CHKPT   Y02083 27842702
*                                  INDICATOR IN DSCB             Y02083 27843102
         MVI   XCCW3,WRTKDATA      SET CCW TO WRITE BACK DSCB    Y02083 27843502
         BAL   RE,CHKEXCP          GO REWRITE DSCB               Y02083 27843902
         B     CHKERX5B            GO TO ERROR EXIT              Y02083 27844302
         EJECT                                                          27894302
**************************************************************** Y02083 27944302
*                                                                Y02083 27994302
*        Q MANAGER I/O ROUTINE                                   Y02083 28044302
*                                                                Y02083 28094302
*        INPUT:                                                  Y02083 28144302
*          R2=SVA (SWA CONTROL BLK ADDRESS)                      Y02083 28194302
*          R4=TCB ADDRESS                                        Y02083 28244302
*          R5=RETURN ADDRESS                                     Y02083 28294302
*                                                                Y02083 28344302
*        OUTPUT:                                                 Y02083 28394302
*          R7=ADDRESS OF CONTROL BLK READIN AREA                 Y02083 28444302
*                                                                Y02083 28494302
**************************************************************** Y02083 28544302
*                                                                Y02083 28594302
CHKQMNGR EQU   *                   READ ENTRY POINT              Y02083 28644302
         LA    R7,QMIOREAD         LOAD QMNGR READ CODE          Y02083 28694302
         B     CHKQMNG             BR TO COMMON ROUTINE          Y02083 28744302
CHKQMNGW EQU   *                   WRITE ENTRY POINT             Y02083 28794302
         LA    R7,QMIOWRTE         LOAD QMNGR WRITE CODE         Y02083 28844302
CHKQMNG  EQU   *                   START OF COMMON ROUTINE       Y02083 28894302
         LA    R1,CKJCT            GET ADDR OF QMNGRIO PARM LIST Y02083 28944302
         USING QMIOP,R1            ADDRESS QMNGRIO PARM LIST     Y02083 28994302
         ST    R4,QMITCBAD         STORE TCB ADDR IN PL          Y02083 29044302
         STCM  R7,M1,QMIFLAGS      SET RD/WR FLAG IN PARM LIST   Y02083 29094302
         LA    R9,K176             LOAD RECORD LENGTH OF 176     Y02083 29144302
         STH   R9,QMIRECL          STORE RECORD LENGTH IN PL     Y02083 29194302
         ST    R2,QMIDSKAD         STORE CONTROL BLK SVA IN PL   Y02083 29244302
         LA    R9,QMNGRWA          GET AND STORE QMNGR WA        Y02083 29294302
         ST    R9,QMIWRKAD           ADDRESS IN PL               Y02083 29344302
         LA    R7,QMNGRBUF         GET AND STORE BUFFER          Y02083 29394302
         ST    R7,QMIRECAD           ADDRESS IN PL               Y02083 29444302
         ST    RD,CKERAS09         SAVE REG 13                   YM3982 29494302
         LA    RD,CKREGSAV         PASS SAVEAREA ADDR TO QMNGRIO YM3982 29504302
         QMNGRIO                   READ/WRITE TO SWA             Y02083 29544302
         DROP  R1                  PARM LIST ADDRESSING          Y02083 29594302
         L     RD,CKERAS09         RESTORE REG 13                YM3982 29604302
         BR    R5                  RETURN TO CALLER              Y02083 29644302
         EJECT                                                          29954302
CHKDSS2D LR    R1,R6                                             Y02083 29994302
         L     R5,CKERAS07         RESTORE SVRB ADDR             Y02083 30004302
         USING HKPSECT,R5          ADDRESS CHKPT SVRB            YM7324 30014302
         MVC   HKPGLIST(LNXCTLST),CHKXLIST                              30044302
*                                                                     * 30094302
*********************************************************************** 30144302
*                                                                     * 30194302
*        IF CANCEL IS REQUESTED, XCTL TO IGC0206C; OTHERWISE, TRANSFER* 30244302
*        CONTROL TO NEXT LOAD, IGC0106C.                              * 30294302
*                                                                     * 30344302
*********************************************************************** 30394302
         TM    CKFLAG1,CKCANCEL    IS THIS A CANCEL REQUEST             30444302
         BO    CHKCANC2            YES, BRANCH                          30494302
CHKRET   EQU   *                                                        30544302
         LA    RF,HKPGLIST                                              30594302
         ST    RF,HKPNTLST                                              30644302
         LA    RF,HKPNTLST                                              30694302
         XCTL  SF=(E,(15))                                              30744302
*                                                                     * 30794302
*********************************************************************** 30844302
*                                                                     * 30894302
*        RETURN TO USER WHEN CHECKPOINTS ARE TO BE SUPPRESSED         * 30944302
*                                                                     * 30994302
*********************************************************************** 31044302
*                                                                     * 31094302
CHKSUP   EQU   *                                                        31144302
         LA    RF,CKNORM           LOAD RETURN CODE.                    31194302
         SVC   3                   ISSUE EXIT SVC.                      31244302
         EJECT                                                          31244802
*********************************************************************** 31344302
*                                                                     * 31394302
*        ERROR EXIT ROUTINES - SETS MESSAGE AND RETURN CODE IN SVRB   * 31444302
*        EXTENDED WORK AREA, FREEMAINS INVALID CHKPT W.A. IF NECESSARY* 31494302
*        AND XCTL'S TO EXIT ROUTINE, IGC0Q06C.                        * 31544302
*                                                                     * 31594302
*********************************************************************** 31644302
*                                                                     * 31694302
CHKERX5A MVI   CKRETCOD+K1,CKIOERR SET I/O ERR IN RET CODE       Y02076 31696302
         B     CHKERX5             BR TO CONTINUE EXIT           Y02076 31698302
CHKERX5B MVI   CKRETCOD+K1,CKPGMERR SET PGM ERR RET CODE         Y02076 31700302
CHKERX5  L     R5,CKERAS07         RESTORE SVRB ADDR             Y02083 31704302
         STH   RA,CKMSGCOD         SET ERR MSG CODE              Y02076 31714302
         LR    R1,R6               RESTORE PTR TO W.A.           Y02076 31716302
         B     CHKERX6             GO SET UP XCTL                Y02076 31724302
CHKERX   EQU   *                                                        31744302
         OI    HKPFLAG,HKPEXIT     INDICATES ACTION TO BE TAKEN IN CER  31794302
CHKERCOD EQU   *                                                        31844302
         MVI   HKPRETCD,CKPGMERR   PUT RETURN CODE IN PARM. AREA        31894302
CHKERMSG EQU   *                                                        31944302
         STH   RA,HKPMSGCD         PUT MESSAGE CODE IN PARM AREA        31994302
         XR    R1,R1               SET UP PARM REG - NO CHKPT WA        32044302
CHKCER   EQU   *                                                        32094302
         OI    HKPFLAG,CKMSG1      INDICATES MSG-ENVIRONMENT ERROR      32144302
CHKERX6  MVC   HKPGLIST(8),CHKXLIST SET XCTL PARLIST TO GO TO CER.      32194302
         MVI   HKPWD2,Q06C                                              32244302
         B     CHKRET              GO TO XCTL TO IGC0Q06C.              32294302
CHKERG   EQU   *                                                        32344302
CHKERC   EQU   *                                                        32394302
         TM HKPFLAG,CKOPEN         DID CHKPT OPEN DS                    32444302
         BZ    CHKERX              NO-GO TO INDICATE ACTION IN CER      32494302
         OI    HKPFLAG,HKPCLOSE    INDICATES ACTION TO BE TAKEN IN CER  32544302
         LR    R2,RC               LOAD PARM REG WITH ADDR DCB          32594302
         B     CHKERCOD            GO TO STORE ERROR CODES IN CHKWA     32644302
         EJECT                                                          32644802
*********************************************************************** 32944302
*                                                                     * 32994302
*        TALLY LENGTH OF TIOT AND POINT TO NEXT DD ENTRY IN TIOT      * 33044302
*                                                                     * 33094302
*********************************************************************** 33144302
*                                                                     * 33194302
CHKTIL   EQU   *                                                        33244302
         USING TIOENTRY,R9         ADDRESS DD ENTRY IN TIOT             33294302
         IC    R6,TIOELNGH                                              33344302
         AR    R7,R6               UPDATE TIOT-LENGTH ACCUMULATOR       33394302
         AR    R9,R6               UPDATE DD ENTRY POINTER.             33444302
         B     CHKETI              RETURN TO TIOT-LENGTH-LOOP           33494302
         USING DEBBASIC,R8         ADDRESS DEBS.                        33544302
*                                                                     * 33594302
*********************************************************************** 33644302
*                                                                     * 33694302
*        INCREMENT NUMBER OF DEB'S AND POINT TO NEXT DEB              * 33744302
*                                                                     * 33794302
*********************************************************************** 33844302
*                                                                     * 33894302
CHKNXDB  EQU   *                                                        33944302
         LA    R6,1(0,R6)          INCREMENT DEB COUNTER.               33994302
         L     R8,DEBDEBAD         GET ADDR OF NEXT DEB.                34044302
         B     CHKLSDB             GO TO CHECK FOR END OF DEB CHAIN.    34094302
         DROP  R8                                                       34144302
*                                                                     * 34194302
*********************************************************************** 34244302
*                                                                     * 34294302
*        SET UP PARAMETER LIST AND ISSUE CONDITIONAL GETMAIN FOR      * 34344302
*        WORK AREA                                                    * 34394302
*                                                                     * 34444302
*********************************************************************** 34494302
*                                                                     * 34544302
CHKCOMG  EQU   *                                                        34594302
         LA    RE,HKPGLIST         SET UP GETMAIN PARM LIST             34644302
         ST    R7,HKPGLIST                                              34694302
         LA    R0,HKPGML                                                34744302
         LA    RA,CKERPG3          LOAD MESSAGE CODE IF ERROR OCCURS.   34794302
         LA    R8,HKPGMLAD                                              34844302
         TM    TCBFLGS6,TCBRV      IS THIS TASK V=R            @ZA27494 34894337
         BNO   GET253              NO,USE SUBPOOL 253          @ZA27494 34900337
         GETMAIN EC,A=(R8),SP=252,MF=(E,(RE)) YES,USE SP252    @ZA27494 34906337
         B     CONTIN                                          @ZA27494 34912337
GET253   EQU   *                                               @ZA27494 34918337
         GETMAIN EC,A=(R8),SP=253,MF=(E,(RE))                           34924337
CONTIN   EQU   *                                               @ZA27494 34930337
         L     R6,HKPGMLAD         GET ADDR OF W.A.                     34944302
         LA    R6,0(R6)            CLEAR HIGH ORDER BYTE.               34994302
         XC    HKPGML2(HKPGML-HKPGML2),HKPGML2                          35044302
*                                  CLEAR AREA TO STORE ERROR CODES      35094302
         LR    R8,R7               SAVE LENGTH OF W.A. FOR CANCEL RTN   35144302
         BR    R9                  RETURN TO CALLER                     35194302
         EJECT                                                          35194802
*********************************************************************** 35294302
*                                                                     * 35344302
*        FOR CANCEL REQUEST, ISSUE CONDITIONAL GETMAIN FOR WORK AREA  * 35394302
*        NEEDED AND BRANCH TO INITIALIZE WORK AREA                    * 35444302
*                                                                     * 35494302
*********************************************************************** 35544302
*                                                                     * 35594302
CHKCANC1 EQU   *                                                        35644302
         OI    HKPFLAG,CKCANCEL    SET CANCEL INDICATOR                 35694302
         LA    R7,LENCANCL         GET LENGTH OF W.A.                   35744302
         BAL   R9,CHKCOMG          GO TO GETMAIN FOR W.A.               35794302
         B     *+4(RF)             WAS GETMAIN SUCCESSFUL               35844302
         B     CHKCCN              YES-CONTINUE PROCESSING CANCEL REQ.  35894302
         B     CHKERC              NO-GO TO ERROR EXIT ROUTINE          35944302
         USING CHKWA,R6            ADDRESS W.A.                         35994302
CHKCCN   EQU   *                                                        36044302
         XC    CHKWA(ZLN),CHKWA    ZERO OUT W.A.                        36094302
         B     CHKCOCNC            GO TO INITIALIZE CANCEL WA           36144302
*                                                                     * 36194302
*********************************************************************** 36244302
*                                                                     * 36294302
*        ALTER XCTL PARAMETER LIST FOR CANCEL REQUEST TO TRANSFER     * 36344302
*        CONTROL TO IGC0206C.                                         * 36394302
*                                                                     * 36444302
*********************************************************************** 36494302
*                                                                     * 36544302
CHKCANC2 EQU   *                                                        36594302
         MVI   HKPWD2,C206C        ALTER XCTL PARM LIST SO THAT         36644302
*                                  IGG0206C WILL GET CONTROL NEXT.      36694302
         B     CHKRET              GO TO XCTL                           36744302
         EJECT                                                          36794302
**********************************************************************  36844302
*       ESTABLISH ESTAE ENVIRONMENT                              YM5913 36894302
**********************************************************************  36944302
CHKESTES LA    R5,CHKESRTN         GET ESTAE ENTRY PT            YM5913 36994302
         LR    R1,R6               GET WORK AREA PTR             YM5913 37044302
         A     R1,CKBFOFST         POINT TO PARM BUFFER          YM5913 37094302
         MVC   K0(CHKESTLN,R1),CHKESTAE MOVE PARM LIST TO BUFF   YM5913 37144302
         STM   R0,RF,CKREGSAV      SAVE RETRY REGS               YM7082 37154302
         ESTAE (R5),PARAM=(R6),MF=(E,(R1)) ISSUE ESTAE           YM5913 37194302
         BR    RE                  RETURN TO MAINLINE            YM5913 37294302
**********************************************************************  37344302
*     CANCEL ESTAE ENVIRONMENT                                   YM5913 37394302
**********************************************************************  37444302
CHKESTCN ESTAE 0                   CANCEL ESTAE                  YM5913 37494302
         BR    RE                  RETURN TO MAINLINE            YM5913 37544302
**********************************************************************  37594302
*     ESTAE ROUTINE TESTS IF AN ABEND 913 - 28 OCCURRED          YM5913 37644302
**********************************************************************  37694302
CHKESRTN CH    R0,RTNCOD12-CHKESRTN(RF) DID RTM GET AN RTCA      YM7082 37744302
         BNE   CHKESTB2-CHKESRTN(RF) BR IF YES                   YM7082 37794302
*        IF NOT, DON'T BOTHER TRYING TO AVOID AN ABEND           YM7008 37844302
         SR    R0,R0               ZERO RETRY                    YM5913 37994302
         SR    RF,RF               TELL RTM TO TERM              YM5913 38044302
         BR    RE                  RETURN TO RTM                 YM5913 38144302
CHKESTB2 STM   RE,RC,12(RD)        SAVE RTM'S REGS               YM7082 38164302
         LR    RB,RF               ESTABLISH CODE BASE           YM7082 38174302
         LA    RA,CHKESRTN-BASE1     AS ORIGINALLY               YM7082 38184302
         SR    RB,RA                   ASSEMBLED                 YM7082 38186302
         USING SDWA,R1             ADDRESS SDWA                  YM7008 38188302
         L     R6,SDWAPARM         GET CHKPT WA ADDR             YM7008 38194302
         CLI   SDWAERRA,SDWASVCD   WAS ABEND ISSUED              YM7008 38244302
         BNE   CHKESTB3            BR IF NOT                     YM7008 38294302
         L     R0,SDWAABCC         GET ABEND CODE                YM7008 38344302
         SLL   R0,L8               SHIFT OFF HIORDER BYTE        YM7008 38354302
         SRL   R0,L8+L12           SHIFT ABEND CODE RIGHT        YM7008 38364302
         CH    R0,AB913            IS IT ABEND 913               YM7008 38374302
         BNE   CHKESTB3            BR IF NOT                     YM7008 38384302
         L     RF,SDWAGR15         GET 913 DASH NO.              YM7008 38386302
         CH    RF,DASH28           IS IT 913-28                  YM7008 38388302
         BNE   CHKESTB3            BR IF NOT                     YM7008 38390302
         MVC   SDWASR00(64),CKREGSAV MOVE IN RETRY REGS          YM7082 38400302
         SETRP RC=4,RETADDR=CHKESTB4,FRESDWA=YES,REGS=(14,12),   YM7008C38440302
               RETREGS=YES,DUMP=NO,RECORD=NO GO RETRY            YM7008 38442302
CHKESTB3 SETRP RC=0,REGS=(14,12)   CONTINUE WITH TERM            YM7008 38494302
*****************************************************************YM7008 38504302
*      ESTAE RETRY ENTRY FOR CONVERSION OF 913-28 ABEND          YM7008 38514302
*      TO A (007) ERROR CODE FAILURE - USER SPECIFIED            YM7008 38524302
*      OTHER THAN BSAM OR BPAM AS THE ACCESS METHOD TYPE         YM7008 38534302
*      FOR THE CHECKPOINT DATA SET.                              YM7008 38536302
*****************************************************************YM7008 38538302
CHKESTB4 EQU   *                   (007) RETRY ENTRY             YM7008 38544302
         BAL   RE,CHKESTCN         CANCEL ESTAE ENVIRONMENT      YM7008 38594302
         LA    RA,CKERPG07         LOAD ERROR CODE (07)          YM5913 39044302
         B     CHKERX5B            BR TO ERR EXIT                YM5913 39094302
         EJECT                                                          39144302
*                                                                     * 39154302
*********************************************************************** 39164302
*                                                                     * 39174302
*        CONSTANTS AND GENERAL EQUATES                                * 39184302
*                                                                     * 39186302
*********************************************************************** 39186702
*                                                                     * 39188302
RTNCOD12 DC    H'12'               RTCA CODE                     YM5913 39194302
AB913    DC    H'2323'             ABEND 913                     YM5913 39244302
DASH28   DC    H'40'               DASH 28 CODE                  YM5913 39294302
ABLEV    DC    CL2'AV'             DUMMY DEB MODULE            @ZA30032 39314337
CHKESTAE ESTAE CHKESTAE,CT,PARAM=CHKESTAE,TERM=YES,              YM5913X39344302
               RECORD=YES,MF=L     ESTAE PARM LIST               YM5913 39394302
CHKESTLN EQU   *-CHKESTAE          PARM LIST LNGTH               YM5913 39444302
         DS    0F                                                       57400017
CHKXLIST DC    C'IGC0106C'         MODULE NAME FOR XCTL PARMLST         57680018
CHKQNAME DC    C'SYSDSN  '         QNAME FOR ENQ TEST            Y02083 57690002
WAK      DC    H'5316'             FIXED LENGTH OF WA(1220+4096) Y02076 57730002
SSCRBUFL DC    H'4096'             SSCR BUFFER LENGTH            Y02076 57780002
CHK8     DC    H'8'                CONSTANT USED TO GET NEXT DBLWD ADDR 58020018
KCCW123  DC    X'31',XL7'05'       CONSTANT FOR CCW1             Y02083 58070002
         DC    X'08',XL7'00'       CONSTANT FOR CCW2             Y02083 58120002
         DC    X'0E',XL3'00',X'2000008C' CONSTANT FOR CCW3       Y02083 58170002
KPDS     DC    X'000E',8X'FF',4X'00' VALUE FOR AN EMPTY PDS DIR. Y02083 58180002
REPDCB1  DC    H'48'               AMOUNT OF EXTRA CORE NEEDED BY       58200002
MAXTRK   DC    X'7FFF'             MAX DA TRACK CAPACITY         Y02083 58210002
VALIDERR EQU   98                  VALIDITY CHECK ERR CODE       Y02076 58250002
SYSGENID EQU   7                   SYSTEM GENERATED CHECKPOINT   YM5793 58250502
*                                  ID LENGTH - 1                 YM5793 58251002
CURASOFS EQU   12                  OFFSET TO CURRENT ASCB        Y02076 58350002
ADRCVT   EQU   16                  ADDR OF CVT PTR               Y02083 58360002
*                                                                     * 58450000
*        MAINTENANCE SPACE                                            * 58500000
*                                                                     * 58550000
PATCH    DC    XL((*-IGC0006C)/20)'00' FIVE PERCENT MAINTENANCE SPACE   58600002
*                                                                     * 58650000
         EJECT                                                          58660002
         IHASDWA                                                 YM5913 58670002
         IHAPSA                                                  Y02076 58700002
         EJECT                                                          58710002
         IHAASCB                                                 Y02076 58750002
         EJECT                                                          58760002
         IHALDA                                                  Y02076 58800002
         EJECT                                                          58850002
HKPSECT  DSECT                                                          58900017
HKPSVRB  DS    24F                 INITIAL SECTION OF SVRB              58940002
HKPGML2  DS    0F                  SAVE AREA FOR ERR AND MSG CODES      58980002
         DS    C                   RETURN CODE                          59020002
HKPRETCD DS    C                                                        59060018
HKPMSGCD DS    H                   MESSAGE CODE                         59100002
HKPGML   DS    F                   GETMAIN PARAMETER LIST:              59140002
HKPGMLAD DS    2F                  LNG AND ADDR OF GETMAIN'D AREA       59180002
HKPGLIST DS    1F                  PARAMETER LIST AREA                  59220002
HKPWD2   DS    F                                                        59260018
HKPNTLST DS    F                                                        59300018
HKPTIOTL DS    H                   LENGTH OF TIOT                       59340002
HKPBUFL  DS    H                   UNUSED                               59380002
HKPTIO   DS    0F                                                       59420018
HKPFLAG  DS    1C                  FLAG BYTE                            59460002
HKPCLOSE EQU   16                  INDICATES CER MUST CLOSE CHKPT D.S.  59500002
HKPEXIT  EQU   1                                                        59540018
HKPTIOAD DS    3C                  ADDRESS OF TIOT                      59580002
HKPWD1   DS    0F                                                       59620018
HKPSP    DS    1C                  USED TO CHECK BOUNDARY ALIGNMENT     59660002
HKPDCBAD DS    3C                  ADDRESS CHKPT DCB                    59700002
HKPSAVRN DS    F                   UNUSED                               59740002
         EJECT                                                          59790002
*        CHKPT PARAMETER LIST                                           60340018
PARMLST  DSECT                                                          60380018
DCBADDR  DS    0CL4                                                     60420018
FLAG     DS    CL1                 FLAG BYTE                            60460002
NOCHKID  EQU   X'80'               SYSTEM-GENERATED CHECKID NOT         60500002
*                                  RETURNED TO USER                     60510002
UCHKID   EQU   X'00'               USER-SPECIFIED CHECKID               60560002
DCBORCN  DS    CL3                 ADDRESS OF CHKPT DCB                 60580002
IDADDR   DS    0CL4                                                     60620018
LNGID    DS    CL1                 LENGTH OF USER SPECIFIED CHKID       60660002
RTNCKID  EQU   X'FF'               SYSTEM-GENERATED CHECKID RETURNED    60700002
*                                  TO USER                              60710002
         DS    CL3                 ADDR OF CHECKID                      60740002
ADDRLNG  EQU   3                   LENGTH OF ADDRESS                    60780002
         EJECT                                                          60830002
         IEEVCHWA   VER=3          USE AOS2 VERSION OF MACRO            61200002
JFCBSAVE EQU   CKJCTMB             SAVEAREA FOR JFCB STATUS      Y02083 61210002
SIOTSAVE EQU   CKJCTMB+1           SAVEAREA FOR SIOT DISP        Y02083 61220002
         ORG   CKJCT                                             Y02083 61250002
XDCB     DS    F                   DATA CONTROL BLOCK            Y02083 61300002
         DS    X                   FILLER                        Y02083 61350002
XDCBFDAD DS    8X                  FULL DISK ADDRESS             Y02083 61400002
         DS    15X                 FILLER                        Y02083 61450002
XDCBIOBA DS    F                   IOB ADDRESS                   Y02083 61500002
         DS    3F                  FILLER                        Y02083 61550002
XDCBDEBA DS    F                   DEB ADDRESS                   Y02083 61600002
XDEB     DS    0F                  DATA EXTENT BLOCK             Y02083 61650002
         DS    4F                  FILLER                        Y02083 61700002
XDEBNMEX DS    F                   NUMBER OF EXTENTS             Y02083 61750002
         DS    F                   FILLER                        Y02083 61800002
XDEBDEBI DS    0F                  DEB ID AND KEY                Y02083 61810002
XDEBDCBA DS    F                   DCB ADDRESS                   Y02083 61820002
XDEBEXSC DS    0F                  EXTENT SCALE                  Y02083 61830002
XDEBAPPA DS    F                   APPENDAGE ADDRESS             Y02083 61832002
XDEBDVMO DS    X                   DEVICE MODIFIER               Y02083 61834002
XDEBUCBA DS    3X                  UCB ADDRESS                   Y02083 61836002
XDEBBINU DS    H                   BIN NUMBER                    Y02083 61838002
XDEBSTRC DS    H                   CYLINDER START ADDRESS        Y02083 61838402
XDEBSTRH DS    H                   HEAD START ADDRESS            Y02083 61838802
XDEBENDC DS    H                   CYLINDER END ADDRESS          Y02083 61839202
XDEBENDH DS    H                   HEAD END ADDRESS              Y02083 61839602
XDEBNMTR DS    H                   NUMBER OF TRACKS              Y02083 61839702
XIOB     DS    0F                  IO REQUEST BLOCK              Y02083 61839802
XIOBFLG1 DS    X                   FLAG 1 FIELD                  Y02083 61839902
         DS    3X                  FILLER                        Y02083 61853202
XIOBECBA DS    F                   ECB ADDRESS                   Y02083 61863202
         DS    2F                  FILLER                        Y02083 61865202
XIOBCPA  DS    F                   CHANNEL PROGRAM ADDRESS       Y02083 61865602
XIOBDCBA DS    F                   DCB ADDRESS                   Y02083 61866002
         DS    2F                  FILLER                        Y02083 61866402
XIOBFDAD DS    2F                  FULL DISK ADDRESS             Y02083 61866502
XECB     DS    F                   EVENT CONTROL BLOCK           Y02083 61866602
XCCW1    DS    D                   CCW 1                         Y02083 61871002
XCCW2    DS    D                   CCW 2                         Y02083 61873002
XCCW3    DS    D                   CCW 3                         Y02083 61875002
XBUF     DS    140C                READ/WRITE BUFFER             Y02083 61875402
XDSN     DS    44C                 HOLD AREA FOR CHKPT DSN       Y02083 61876902
XEND     EQU   *                   END OF WORK SPACE             Y02083 61880002
CHRDEC   DS    D                                                        61897802
CHRCON   DS    5H                                                       61908902
CHRAD    DS    F                                                        61920017
CHRXL    DS    CL8                 NAME OF MODULE TO TRANSFER           61960002
*                                  CONTROL TO                           61962002
         EJECT                                                          61970002
         IEFQMIOP                                                Y02083 62010002
QMNGRWA  DS    88C                 QUEUE MANAGER WORKAREA        Y02083 62060002
QMNGRBUF DS    176C                QUEUE MANAGER BUFFER          Y02083 62110002
TEMPSAVE DS    6F                  TEMP REG SAVEAREA             YM4683 62120002
         EJECT                                                          62160002
TIOTSECT DSECT                                                          62200017
         IEFTIOT1                                                       62400017
         EJECT                                                          62450002
         DCBD  DSORG=(BS,PO),DEVD=(DA,TA)                               62600017
         EJECT                                                          62650002
CVTSECT  DSECT                                                          62800000
         CVT                                                            62850000
         EJECT                                                          62860002
         IKJTCB                                                         62900000
         EJECT                                                          62910002
         IEZDEB                                                         62950000
         EJECT                                                          62960002
*        MAPPING OF PQE                                                 63000000
         IHAPQE                                                         63050000
         EJECT                                                          63100002
         IEFUCBOB PREFIX=YES,LIST=YES                            Y02083 63150002
         EJECT                                                          63160002
         IHADSAB                                                 Y02083 63200002
         EJECT                                                          63200502
         IHAQDB                                                  Y02083 63201002
         EJECT                                                          63201502
         IEZJSCB                                                 Y02083 63202002
         EJECT                                                          63210002
         IEFASIOT                                                Y02083 63250002
         EJECT                                                          63260002
         IEFJFCBN                                                Y02083 63300002
         EJECT                                                          63310002
         IEFJESCT                                                Y02083 63350002
         EJECT                                                          63360002
         IDDVDSCB                                                       63370002
         EJECT                                                          63380002
         IECSDSL1 (1)                                                   63390002
         EJECT                                                          63392002
OPENOPT  EQU   143                 OPTION BYTE FOR OPEN'S PARM LIST     63400002
CLOSEOPT EQU   X'B0'               CLOSE OPTION FLAGS            Y02083 63410002
CKVEQR   EQU   8                   V=R FLAG IN W.A.              YM3092 63450001
USERAUTH EQU   X'10'               AUTHORIZED-USER FLAG IN W.A.  YM1237 63451002
LENCANCL EQU   CHRXL+8-CHKWA       LENGTH OF W.A. NEED                  63800002
CHKWAL   EQU   DXCCW3+8-CHKWA      LENGTH OF CHKWA.                     65000002
TAPEDML  EQU   48                  LENGTH OF IOB/CP FOR TAPE TO         65400002
*                                  BE USED AT RESTART                   65450002
DADML    EQU   88                  LENGTH OF IOB/CP FOR D.A.            65600002
*                                  TO BE USED AT RESTART                65650002
DADEB    EQU   344                 MAXIMUM LENGTH FOR D.A. DEB.         65800002
TAPEDEB  EQU   92                  MAXIMUM LENGTH FOR TAPE DEB.         66000002
TIOLEN   EQU   28                  LENGTH OF TIOT THAT IS NOT           66800002
*                                  PART OF A DD ENTRY                   66850002
ZLN      EQU   256                 LENGTH OF W.A. TO BE ZEROED OUT.     67400002
DADCK    EQU   32                  DCBDEVT FIELD- INDICATES DIRECT      67600002
*                                  ACCESS DEVICE                        67650002
CKSUPRS  EQU   64                  TIOESTTA FIELD-INDICATES CHKPT       68000002
*                                  SUPPRESS REQUEST                     68050002
DD2L     EQU   44                  NO. OF BYTES TIOT IS ALLOWED         68400002
*                                  TO INCREASE AT RESTART               68450002
LOWBYTE  EQU   3                   ADDRESSING LOW-ORDER BYTE OF A WORD  68801002
LNXSA    EQU   48                  LENGTH OF SVRB EXTENDED SAVE AREA    68801502
Q06C     EQU   C'Q'                CHARACTER TO ALTER XCTL NAME         68802002
DBLWDBND EQU   X'07'               TEST FOR DOUBLE WORD BDRY ADDR       68802502
C206C    EQU   C'2'                CHARACTER TO ALTER XCTL NAME         68803002
LNXCTLST EQU   8                   LENGTH OF XCTL PARM LIST             68803502
ZERO     EQU   8                   CONDITION CODE SETTING FOR TM INSTR  68804002
WDBNDTST EQU   X'03'               TEST FOR ADDRESS ON WORD BOUNDARY    68804502
LNG      EQU   2                   LENGTH OF HALFWORD                   68805002
WDLNG    EQU   4                   LENGTH OF WORD                       68805502
ONE      EQU   1                   LENGTH OF FLAG BYTE                  68806002
TRUNC3   EQU   3                   USED TO MAKE ADDR MULTIPLE OF 8      68806502
CKTIOTLN EQU   CKTIOLN+2                                                68807018
CKDCB    EQU   CKDCBAD+1                                                68807518
CKDCB2   EQU   CKDCBAD2+1                                               68808018
CKMSG1   EQU   32                  WTO MESSAGE = NOT TAKEN              68810002
CKERPG1  EQU   X'01'               PARAMETER LIST ERROR                 68820002
CKERPG2  EQU   X'02'               OPEN UNSUCCESSFUL                    68830002
CKERPG3  EQU   X'03'               GETMAIN UNSUCCSSSFUL                 68840002
CKERPG12 EQU   12                  ERROR CODE FOR DAUGHTER TASKS Y02083 68890002
CKERPG11 EQU   11                  ERROR CODE FOR SUBTASKING     Y02083 68940002
CKERPG16 EQU   16                  ERROR CODE FOR INVALID DEVICE Y02083 68990002
CKERPG19 EQU   19                  ERROR CODE FOR OPEN FOR INPUT YM7008 68990102
CKERP202 EQU   202                 ERROR CODE FOR SETLOCK ERROR  Y02076 68990402
CKERP208 EQU   208                 ERROR CODE FOR BLK CNT ERR    Y02083 68992002
CKERP214 EQU   214                 ERROR CODE FOR SHARED DA      Y02083 68994002
CKERPG07 EQU   7                   ERROR CODE FOR INVALID DSORG  Y02083 68996002
CKERP209 EQU   209                 ERROR CODE FOR MULTIPLE OPENS Y02083 68998002
CKERP210 EQU   210                 ERROR CODE FOR DISP=SHR ERR   Y02083 68998402
CKERP211 EQU   211                 ERROR CODE FOR NON-SECURE D/S Y02083 68998802
CKERP212 EQU   212                 ERROR CODE FOR SUBSYSTEM D/S  Y02083 68998902
CKERP213 EQU   213                 ERROR CODE FOR NON SL TAPE    Y02083 68999002
ADDRBYTS EQU   X'07'               REG MASK FOR LO-ORDER 3 BYTES Y02083 68999202
K0       EQU   0                   CONSTANT OF 0                 Y02083 68999602
SIX      EQU   6                   CONSTANT OF 6                 Y02083 68999702
K7       EQU   7                   CONSTANT OF 7                 Y02083 68999802
TWO      EQU   2                   CONSTANT OF 2                 Y02083 68999902
FOUR     EQU   4                   CONSTANT OF 4                 Y02083 69049902
L15      EQU   15                  CONSTANT OF 15                Y02083 69059902
L8       EQU   8                   CONSTANT OF 8                 Y02083 69069902
THREE    EQU   3                   CONSTANT OF 3                 Y02083 69079902
L24      EQU   24                  CONSTANT OF 24                Y02083 69089902
L6       EQU   6                   CONSTANT OF 6                 Y02083 69091902
K16      EQU   16                  CONSTANT OF 16                Y02083 69093902
M7       EQU   7                   REG MASK FOR LOW 3 BYTES      Y02083 69095902
M14      EQU   14                  REG MASK FOR HI 3 BYTES       Y02083 69097902
K176     EQU   176                 LENGTH OF JFCB AND SIOT       Y02083 69098302
M1       EQU   1                   REG MASK FOR LOW BYTE         Y02083 69098702
KEEP     EQU   8                   SCT/SCTSDISP DISP=KEEP FLAG   Y02083 69099102
RDDATACM EQU   X'06'               READ DATA CCW COMMAND         Y02083 69099602
CC       EQU   X'40'               COMMAND CHAINING              YM5717 69103802
K4       EQU   4                   CONSTANT OF 4                 YM5717 69105802
K10      EQU   10                  CONSTANT OF 10                YM5717 69107802
K14      EQU   14                  CONSTANT OF 14                Y02083 69108102
L12      EQU   12                  CONSTANT OF 12                Y02083 69112302
K1       EQU   1                   CONSTANT OF 1                 Y02083 69116502
BLANK    EQU   C' '                BLANK CONSTANT                Y02083 69126502
X7F      EQU   X'7F'               ECB TEST MASK                 Y02083 69136502
XFF      EQU   X'FF'               BIT RESET MASK                Y02083 69146502
DS1CHKPT EQU   X'01'               DSCB CHKPT D/S FLAG           Y02083 69148502
WRTKDATA EQU   X'0D'               WRITE KEY/DATA CCW COMMAND    Y02083 69148902
X0F      EQU   X'0F'               DEB ID AND STORAGE KEY        Y02083 69149302
XC0      EQU   X'C0'               DEB DEVICE MODIFIER           Y02083 69149702
X02      EQU   X'02'               IOB UNRELATED FLAG            Y02083 69149802
K3       EQU   3                   CONSTANT OF 3                 Y02083 69166502
K44      EQU   44                  CONSTANT OF 44                Y02083 69168502
X00      EQU   X'00'               CONSTANT OF 0                 Y02083 69176502
X04      EQU   X'04'               DEB EXTENT SCALE              Y02083 69186502
K6       EQU   6                   CONSTANT OF 6                 Y02083 69196502
MF       EQU   15                  MASK FOR CHARACTER INSERTION  Y02083 69198502
X81      EQU   X'81'               FLAGS FOR ENQ PARM LIST       Y02083 69199302
OUTPUT   EQU   X'04'               COMMON DEB OUTPUT FLAG        YM7008 69199702
AMTYPIS  EQU   X'80'               ISAM FLAG IN DEBAMTYP         YM7076 69199802
ISEXTLEN EQU   16                  LENGTH OF ISAM DEPENDANT      YM7076 69249802
*                                  SECTION IN DEB                YM7076 69259802
RETCD08  EQU   8                   PREVIOUS ENQ RETURN CODE      YM7305 69269802
SHRFLAG  EQU   X'10'               ENQ'ED SHR FLAG               YM7305 69279802
         END                                                            69299802
./  ADD  SSI=71180744,NAME=IHJACP01
*                                                                       00000620
         COPY  LCGASMSW                                                 00001200
*                                                                       00003020
         TITLE 'IGC0106C (IHJACP01) CHKPT HOUSEKEEPING RTN - 2ND LOAD'  00004018
*********************************************************************** 00006002
*TITLE:  CHKPT HOUSEKEEPING - SECOND LOAD                               00008017
*                                                                       00010002
*STATUS:  CHANGE LEVEL 000                                              00016002
*                                                                       00018002
*FUNCTION/OPERATION:  IGC0106C WILL DO THE FOLLOWING:                   00024017
*   1.)  CHECK FOR ENVIRONMENT ERROR CONDITIONS. THESE ERROR CONDITIONS 00034017
*   AND THEIR ASSOCIATED ERROR CODES ARE LISTED BELOW IN THE OUTPUT     00044017
*   SECTION.                                                            00054017
*                                                                       00064017
*   THE BLKSIZE SPECIFIED IN THE DCB WILL BE SAVED IN THE CKDCBSI       00081600
*   FIELD OF THE CHECKPOINT WORK AREA, AND A STANDARD BLOCKSIZE OF      00083600
*   TWO K (2048) WILL BE SUBSTITUTED DURING CHECKPOINT AND RESTART      00085600
*   PROCESSING.  THE BLOCKSIZE WILL BE RESTORED TO ITS ORIGINAL VALUE   00087600
*   BEFORE CHECKPOINT PROCESSING IS COMPLETED.  ADDITIONALLY, THE       00087700
*   BLOCKSIZE SPECIFIED IN THE DCB WILL BE INSERTED INTO A SUR RECORD   00087802
*   FOR THE PURPOSE OF RESTORING THE ORIGINAL BLKSIZE AT RESTART TIME.  00087900
*                                                                       00095000
*   IF OUTSTANDING ENQUEUE REQUESTS ARE FOUND, A RETURN CODE OF X'10'   00103400
*   IS PUT IN CHKWA TO INDICATE A POSSIBLE ERROR AND THEN CONTINUE      00110500
*   NORMAL PROCESSING. IF ANY OF THE ABOVE ERRORS ARE FOUND, A RETURN   00117600
*   CODE OF X'08' IS PLACED IN CHKWA AND XCTL TO  IGC0Q06C.             00124700
*                                                                       00126702
*   2.) IF THE USER SUPPLIED A CHECKID THIS ROUTINE WILL CHECK FOR      00131800
*   VALID LENGTH AND CHARACTERS. IF EITHER ARE INVALID A RETURN CODE    00138900
*   OF X'08' IS PLACED IN CHKWA AND XCTL TO IGC0Q06C.                   00146000
*                                                                       00148002
*ENTRY POINTS   IGC0106C                                                00153102
*                                                                       00155102
*INPUT:  ADDRESS OF CHKPT WORK AREA IN REGISTER 1.                      00160200
*                                                                       00162202
*OUTPUT:                                                                00167300
*    1.) FOR NORMAL PROCESSING THE ADDRESS OF CHKPT WORK AREA IS IN     00174400
*        REGISTER 1.                                                    00181500
*    2.) A RETURN CODE OF X'10' IS GIVEN WHEN THERE ARE OUTSTANDING     00188600
*        ENQUEUES AND A MESSAGE CODE OF X'0100' IS PLACED IN THE        00195700
*        CHECKPOINT WORK AREA.  A RETURN CODE OF X'08' IS GIVEN FOR     00202800
*        ANY OTHER ERROR CONDITIONS THAT OCCUR                          00209900
*   WHEN AN ERROR OCCURS ONE OF THE FOLLOWING MESSAGE CODES IS PLACED   00217000
*   INTO CHKWA TO BE PRINTED IN THE CONSOLE MESSAGE BY CHKPT EXIT ROU-  00224100
*   TINE:                                                               00231200
*        DEC VALUE  MNEMONIC               MEANING                      00238300
*           5       CKERPG5         FOR D.A., KEYLENGTH SPECIFIED NOT   00245400
*                                   EQUAL TO ZERO                       00252500
*           6       CKERPG6        ERROR IN DCBRECFM                    00259600
*           7       CKERPG7        ERROR IN DCBDSORG                    00266700
*           8       CKERPG8        ACTIVE TQE                           00273800
*           9       CKERPG9        ERROR IN RBSTAB                      00280900
*          10       CKPERG10      GRAPHICS DS ORG ERR CODE       Y02076 00282902
*         206       CKPER206     VTAM DATA SET ORG ERR CODE      Y02076 00306002
*          14       CKERPG14       OUTSTANDING WTOR                     00312017
*          15       CKERPG15       INCORRECT CHECKID LENGTH/FORMAT      00320017
*          16       CKERPG16       CHKPT D.S. DEVICE TYPE ERROR         00328017
*         224       CKPER224      SAM-SI(NON-CI) DS ORG          Y02076 00338002
*          19       CKERPG19       CHKPT D.S. NOT OPENED TO WRITE       00344017
*          21       CKERPG21       USASI LABEL TYPE NOT ALLOWED   19200 00351019
*          29       CKERPG21       ANSI TRANSLATION ON TAPE NOT ALLOWED 00351402
*          32       CKPERG32       ISAM DATA SET OPEN DISP =SHR XA01816 00351802
*         250       CKPER250       IMAGE LIB DCB                 YM7813 00352202
*                                                                       00353002
*EXTERNAL ROUTINES:  NONE                                               00354017
*                                                                       00356002
*SVC'S USED:  XCTL                                                      00361002
*                                                                       00363002
*EXITS-NORMAL:  XCTL TO IGC0206C                                        00368017
*                                                                       00370002
*EXITS-ERROR:  CONTROL WILL TRANSFER TO IGC0Q06C IF ANY OF THE ERROR    00376017
*   CONDITIONS THAT ARE LISTED UNDER OUTPUT ARE FOUND.                  00384017
*                                                                       00386002
*TABLES/WORKAREAS CREATED:  CHKTABLE-CONTAINS ALL VALID CHARACTERS FOR  00392017
*   CHECKID.                                                            00400017
*                                                                       00402002
*TABLES/WORKAREAS REFERENCED  CHKWA, DCB, TCB, TIOT, TQE, RBS, CHKTABLE 00408017
*   CVT, UCM, ORE, DEB                                                  00416002
*                                                                       00418002
*ATTRIBUTES:  REENTRANT, SUPERVISOR STATE, TYPE 4 SVC ROUTINE.          00424017
*                                                                       00426002
*RESTRICTIONS:  OS/VS2/2 ONLY                                           00432002
*                                                                       00442002
*NOTES:  NONE                                                           00462017
*                                                                       00512002
*VS2/3 CHANGES/DELETIONS                                                00522003
*226694,226844                                                 @ZA00622 00532003
*222000,222400,222700                                          @ZA03906 00542003
*3350000-33570000                                              @ZA07036 00547003
*A22688102,22688202                                            @ZA08009 00552003
*                                                                       00557003
*********************************************************************** 00562002
         EJECT                                                          00612002
IGC0106C CSECT                                                          00662017
*                                                                       00952002
         USING CHKWA,RC            ADDRESS CHKPT W.A.                   01000017
         USING IHADCB,R2           ADDRESS CHKPT DCB.                   01500017
         USING TCB,R4              ADDRESS TCB.                         02000000
         USING RBSECT,R5           ADDRESS RBS.                         02500017
         BALR  RB,0                BASE ADDR                            02700018
*                                                                     * 02900018
*********************************************************************** 03100018
         USING *,RB                ADDRESS MODULE.                      03500017
         B     BEGIN               BRANCH AROUND EYE CATCHER            03550000
         CNOP  0,8                 ALIGN TO A DOUBLE WORD BOUNDARY      03600000
         DC    C'IGC0106C'         CSECT NAME                           03650000
BEGIN    EQU   *                                                        03700000
         LR    RC,R1               SAVE ADDRESS OF CHKPT W.A.           04000017
         L     R2,CKDCBAD          GET ADDR OF CHKPT DCB.               04500017
         L     R4,CKTCBAD          GET TCB ADDR                         05000017
         L     R5,TCBRBP           GET ADDR OF CHKPT SVRB               05500017
*********************************************************************** 05560018
*                                                                     * 05600017
*        CHECK DCBDEVT FIELD IN DCB FOR DEVICE TYPE                   * 05700017
*         AND DCBDSORG FOR DS ORGANIZATION                       M0968  05750021
*                                                                     * 05800017
*********************************************************************** 05860018
*                                                                     * 05920018
         L     R6,DCBDEBAD         GET DEB ADDRESS              Y02049  05930002
         USING DEBBASIC,R6                                      Y02049  05940002
         LR    R7,R6               SAVE DEB ADDR FOR CALC       Y02049  05950002
         LA    RD,DEBPRFLN         GET LENGTH OF DEB PREFIX     Y02049  05960002
         SR    R7,RD               CALCULATE ADDR OF DEB PREFIX Y02049  05962002
         USING DEBPREFX,R7                                      Y02049  05964002
         L     RD,DEBXTNP          GET POINTER TO DEB EXTENSION Y02049  05966002
         USING DEBXTN,RD                                        Y02049  05968002
         LA    RA,CKERPG7               LOAD RETURN CODE FOR ERR M0968  05970021
         TM    DEBXDSO1,DCBDSGPS        WAS DS OPENED FOR PS    Y02049  05980002
         BO    CHKDEVT                  YES-SKIP TEST FOR PO     M0968  05992021
         TM    DEBXDSO1,DCBDSGPO        WAS DS OPENED FOR BPAM  Y02049  05996002
         BZ    CHRERX                   NO-IS ERROR              M0968  05998021
         OI    CKFLAG1,CKBPAM           SET BPAM INDICATOR       M0968  05998421
CHKDEVT  EQU   *                                                 M0968  05998821
         L     R7,DEBSUCBA         GET UCB ADDRESS              Y02049  06050002
         USING UCBOB,R7                                         Y02049  06100002
         TM    UCBTBYT3,UCB3DACC   IS DATA SET ON DIRECT ACCESS Y02049  06150002
         BO    CHRDACL             YES-GO TO CHECK KEY LENGTH SPECIFIED 06500017
         LA    RA,CKERPG16          LOAD RETURN CODE IF ERROR OCCURS.   06700017
         TM    UCBTBYT3,UCB3TAPE   IS DATA SET ON MAGNETIC TAPE Y02049  07000002
         BZ    CHRERX              NO-GO TO ERROR EXIT ROUTINE. Y02049  07500002
         OI    CKFLAG1,CKTAPE      INDICATE DATA SET ON TPAE.           08000017
         DROP  R7                                               Y02049  08050002
*                                                                     * 08060017
*********************************************************************** 08090018
*        CHECK DCBRECFM FIELD IN DCB FOR UNDEFINED FORMAT AND TRACK   * 08120017
*        OVERFLOW OPTION                                              * 08180017
*                                                                     * 08260018
*********************************************************************** 08340018
*                                                                     * 08420018
CHRTRFM  EQU   *                                                        08500017
         LA    RA,CKERPG6          LOAD RETURN CODE IF ERROR OCCURS.    08700000
         TM    DCBRECFM,DCBRECU    IS RECFM UNDEFINED                   09300000
         BM    CHRERX              NO-GO TO ERROR EXIT RTN              09900000
         TM    DCBRECFM,DCBRECTO   IS TRACK OVERFLOW SPECIFIED          10600000
         BZ    CHRDSORG            NO-SKIP CODE TO SET CKFLAG1          10700000
         OI    CKFLAG1,CKTRKOV     SET TRACK OVERFLOW INDICATOR.        10800000
*                                                                     * 10806018
*********************************************************************** 10812018
*                                                                     * 10820017
*        SAVE USER BLKSIZE AND SET CKPT BLKSIZE TO TWO K,             * 10840000
*        DCBMACRF IN DCB FOR OPENED TO WRITE,                         * 10850000
*        AND DCBDSORG IN DCB FOR DATA SET ORGANIZATION                * 10860017
*                                                                     * 10880017
*********************************************************************** 10886018
*                                                                     * 10892018
CHRDSORG EQU   *                                                        10950000
         MVC   CKDCBSI(BLKLENF),DCBBLKSI                                11000000
*                                  SAVE USER BLKSIZE IN CKPT WORK AREA  11050000
         MVC   DCBBLKSI(BLKLENF),H4096 SET BLOCKSIZE TO 4K       YM5921 11100002
         MVC   CKBUFLN(CKBUFLN-CKBUFL),DCBBLKSI MOVE BLKSIZE FROM DCB   11350002
         LA    RA,CKERPG19         LOAD MESSAGE CODE IF ERROR OCCURS    11700017
         TM    DEBXMCF2,DCBMRWRT   WAS DATA OPENED TO 'WRITE'   Y02049  12100002
         BZ    CHRERX              NO-GO TO ERROR EXIT ROUTINE.         12500017
         TM    DEBOPATB,DEBACCS         OUTPUT PROCESSING        M0969  12650000
         BNO   CHRERX                   NO-IS ERROR              M0969  12660021
         EJECT                                                          15001019
*                                                                 19200 15002019
****************************************************************  19200 15003019
*                                                                 19200 15004019
*        THIS CODE CHECKS LABEL TYPE FIELD ON CHK. PT. DD CARD    19200 15005019
*        IF   LABEL=AL OR LABEL=AUL THEN THE USER IS IN ERROR     19200 15006019
*        USASI  CODE CAN NOT BE USED IN A CHECKPOINT  DATA SET.   19200 15007019
*                                                                 19200 15008019
****************************************************************  19200 15009019
*                                                                 19200 15010019
CHRLABEL EQU   *                       CHECK LABEL TYPE           19200 15011019
         L     RF,TCBTIO               GET ADDRESS OF TIOT        19200 15012019
         AH    RF,DCBTIOT              COMPUTE CK.PT. DD ADDRESS  19200 15013019
         LA    RA,CKERPG21             INDICATE JCL LABEL ERROR   19200 15014019
*                                      IN CASE OF ERROR           19200 15015019
         USING TIOENTRY,RF             TIOT ENTRY ADDRESSABILITY  19200 15016019
         TM    TIOESTTA,TIOSLTYP+TIOSLABL                               15017000
*                                      TEST FOR USASI LABEL TYPE        15017400
         DROP  RF                      DROP ADDRESSABILITY        19200 15018019
         BO    CHRERX                  USASI LABEL NOT ALLOWED    19200 15019019
*                                                                S20038 15019520
**************************************************************** S20038 15020020
*                                                                S20038 15020520
*        THIS CODE CHECKS THE DCB OPTCD FIELD TO SEE THAT THERE  S20038 15021020
*        IS NO ATTEMPT TO TAKE A CHECK POINT ON TAPE AFTER       S20038 15021520
*        SPECIFYING OPTCD=Q. OPTCD=Q MEANS ANSI TRANSLATION.     S20038 15022020
*                                                                S20038 15022520
**************************************************************** S20038 15023020
*                                                                S20038 15023520
CHROPTCD EQU   *                                                 S20038 15024020
         TM    CKFLAG1,CKTAPE          IS THIS TAPE ?            S20038 15024500
         BNO   CHRTME                  NO. SKIP OPTION CODE TEST S20038 15025020
*                                                                       15025400
*        TEST FOR TAPE IS NECESSARY DO TO FACT THAT THE SAME BIT S20038 15025520
*        IS USED TO MEAN TRACK OVERFLOW FOR DIRECT ACCESS.       S20038 15026020
*        TRACK OVERFLOW IS ACCEPTABLE FOR CHECKPOINTS.           S20038 15026520
*        ANSI DOES NOT APPLY TO DIRECT ACCESS.                   S20038 15027020
*                                                                       15027400
         LA    RA,CKERPG29             IN CASE OF ERROR          S20038 15028020
*                                      INDICATE DCB OPTCD ERROR  S20038 15028520
         TM    DCBOPTCD,DCBOPTQ        ANSI ENCODING SPECIFIED ? S20038 15029020
         BO    CHRERX                  OPTCD=Q NOT ALLOWED       S20038 15029520
*                                                                     * 15030018
*********************************************************************** 15060018
*                                                                     * 15100017
*        TEST FOR ACTIVE TQE                                          * 15200017
*                                                                     * 15300017
*********************************************************************** 15360018
*                                                                       15420018
CHRTME   EQU   *                                                        15500017
         L     RF,CVTPTR           GET ADDRESS OF CVT                   15570017
         USING CVTSECT,RF                                               15640017
         L     RF,CVTTPC           GET ADDRESS OF PSEUDO CLOCK          15710017
         LTR   RF,RF               IS THERE A TIMER                     15780017
         BZ    CHRBT               BRANCH IF NO--SKIP ACTIVE TQE TEST   15850017
         DROP  RF                                                       15920017
         NC    TCBTME1(LNADDR),TCBTME1  IS THERE A TQE                  16120018
         BZ    CHRBT               NO-SKIP CODE TO PROCESS TQE.         16500017
         L     RF,TCBTME           GET ADDR OF TQE.                     17000017
         LA    RA,CKERPG8           LOAD RETURN CODE IF ERROR OCCURS.   17200017
         USING TQE,RF               MAPPING OF TQE                      17400000
         TM    TQEFLGS,TQEOFF       IS TQE ACTIVE                       17600000
         DROP  RF                                                       17800018
         BZ    CHRERX              YES-GO TO ERROR ROUTINE.             18000017
*                                                                       18030018
*********************************************************************** 18060018
*                                                                     * 18100017
*        TEST FOR INVALID RB ON RB CHAIN                              * 18200017
*                                                                     * 18300017
*********************************************************************** 18360018
*                                                                       18420018
CHRBT    EQU   *                                                        18500017
         L     R5,RBLINK           GET ADDR NEXT RB                     18800000
         LA    RA,CKERPG9                                               19200017
         TM    RBSTAB1,RBFTSVRB    IS THIS AN IRB OR AN SIRB            20500000
         BM    CHRERX              YES-GO TO ERROR EXIT ROUTINE.        21000017
         BZ    CHRLSRB             BRANCH IF ITS A PRB                  21100017
         TM    RBSTAB,RBFTCKPT     IS THIS EOV SVRB                     21200000
         BZ    CHRERX              BRANCH IF NO--ERROR                  21300017
CHRLSRB  EQU   *                                                        21500017
         TM    RBSTAB2,RBTCBNXT    IS THIS THE LAST RB                  22000000
         BZ    CHRBT          NO - GO TO GET ADDR OF NEXT RB.    A43190 22020021
*                                                                       22040021
**********************************************************************  22060021
*                                                                       22080021
*        TEST FOR ACTIVE SPIE                                           22100021
*                                                                       22120021
**********************************************************************  22140021
*                                                                       22160021
         L     R3,TCBPIE      GET ADDR OF SPIE CONTR AREA(SCA) @ZA03906 22200003
         LA    R3,0(R3)       ZERO HIGH BYTE                     A43190 22220021
         LTR   R3,R3          IS THERE A SCA                   @ZA03906 22240003
         BZ    CHKENV         NO -- GO CHECK   ENVIRONMENT       A43190 22260021
         L     R3,0(R3)                 GET ADDR OF PIE        @ZA03906 22270003
         TM    0(R3),PIEFLAG  HAS PIE BEEN ENTERED               A43190 22280021
         BO    CHRERX         YES -- GO TO ERROR EXIT            A43190 22300021
*                                                                       22320021
CHKENV   EQU   *                                                 A43190 22340021
*                                                             *  A39163 22509021
***************************************************************  A39163 22518021
*                                                             *  A39163 22527021
*    TEST FOR GRAPHICS DCB'S, VTAM DCB'S, SAM-SI(NON CI) DCB'S  XA01816 22536002
*     AND ISAM DCB'S OPEN FOR SHR                               XA01816 22538002
*                                                             *  A39163 22545021
***************************************************************  A39163 22554021
*                                                             *  A39163 22563021
         L     R6,TCBDEB      GET DEB ADDRESS                    A39163 22581021
         USING DEBBASIC,R6    ADDRESS DEB                        A39163 22590000
CHKGRAPH EQU   *                                                 A39163 22599021
         LA    RA,CKPERG10    SET MSG CODE FOR ERR               A39163 22601002
         LA    R6,0(R6)       CLEAR HIGH BYTE                    A39163 22608021
         LTR   R6,R6          ANY MORE DEBS                      A39163 22617021
         BZ    LSTDEB         NO -- EXIT                         A39163 22626021
         LR    R7,R6                    LD R7 WITH DEB ADDR      Y02076 22628002
         LA    RD,DEBPRFLN              GET DEB PREFIX LENGTH    Y02076 22630002
         SR    R7,RD                    CALC ADDR OF DEB PREFIX  Y02076 22632002
         USING DEBPREFX,R7                                       Y02076 22634002
         L     RD,DEBXTNP             GET ADDR OF DEB EXTENSION  Y02049 22635002
         TM    DEBXDSO2,DCBDSGGS      IS THIS A GRAPHICS D S     Y02049 22644002
         BO    CHRERX         YES -- IS ERROR                    A39163 22653021
         LA    RA,CKPER206              LOAD VTAM DS ERR CODE    Y02076 22655002
         CLI   DEBAMTYP,VTAMDSCD        TEST FOR VTAM            Y02076 22657002
         BE    CHRERX                   IF VTAM - BR TO ERROR    Y02076 22659002
         L     R2,DEBDCBAD              GET ADDR OF DCB          Y02076 22661802
*********************************************************************** 22663802
*        CHECK FOR IMAGE LIB DCB                                 YM7338 22665802
*********************************************************************** 22665902
*                                                                       22666602
         CLC   DCBDDNAM(K4),IMGDDNAM  IMAGE LIB DCB              YM7338 22667002
         BNE   CHKDEV                 NO                         YM7338 22667402
         LA    RA,CKPER250            LOAD ERROR RTN CD          YM7813 22667802
         B     CHRERX                 GO TO ERROR  EXIT          YM7338 22668202
*                                                                     * 22668302
CHKDEV   EQU   *                        INSTR MUST FOLLOW        YM7338 22668502
         LA    RA,CKPER224              SAM-SI(NON CI) ERR CODE  Y02076 22669002
         CLI   DCBRELAD,ACBIDENT        DOES DEB PT TO AN ACB    Y02076 22669202
         BNE   CHKISHR                  IF NO - CHK ISAM SHR    ZA00622 22669402
         CLI   DEBAMTYP,VSAMDSCD        IS IT VSAM               Y02076 22670002
         BE    CHKNXDEB                 BR IF YES                Y02076 22672002
         DROP  R7                                                Y02076 22674002
         TM    DEBFLGS1,DEBCIBIT        IS CI BIT ON             Y02076 22676002
         BZ    CHRERX                   TO ERR IF CI BIT NOT ON  Y02076 22678002
*                                                                       22680002
*     TEST FOR ISAM DATA SETS OPEN FOR DISP=SHR                 XA01816 22682002
*                                                                       22684002
CHKISHR  EQU   *                        ISAM SHR TESTS FOLLOW   ZA00622 22684402
         TM    DCBDSRG1,DCBDSGIS        IS THIS AN ISAM DATA ST XA01816 22686002
         BZ    CHKNXDEB                 NO, GET THE NEXT DEB    XA01816 22688002
         CLI   DEBNMSUB,X'00'           ANY SUBROUTINES LOADED @ZA08009 22688603
         BE    CHKNXDEB                 NO GO ON               @ZA08009 22689203
         TM    DCBMACF2,DCBMRPUT        IS THIS QISAM LOAD MODE XA01816 22690002
         BO    CHKNXDEB                 YES, DISP=SHR NOT POSS  XA01816 22692002
         TM    DCBMACF1,DCBMRGET        IS IT QISAM SCAN MODE   XA01816 22694002
         BO    CHKISCAN                 YES,CHECK SCAN MODE W/A XA01816 22696002
         TM    DCBMACF1,DCBMRRD         IS THIS BISAM READ      XA01816 22698002
         BO    CHKBISAM                 YES,CHECK BISAM W/A     XA01816 22700002
         TM    DCBMACF2,DCBMRWRT        IS THIS BISAM WRITE     XA01816 22702002
         BZ    CHKNXDEB                 NO, GO GET NEXT DEB     XA01816 22704002
CHKBISAM EQU   *                                                XA01816 22706002
         L     RD,DCBWKPT2              BET BISAM W/A PTR       XA01816 22708002
         USING BISAMWA,RD                                       XA01816 22708402
         TM    DCWDCBFA,ISAMSHR         IS IT OPEN DISP=SHR     XA01816 22708802
         BZ    CHKNXDEB                 NO, GET NEXT DEB        XA01816 22709202
         DROP  RD                                               XA01816 22709302
CHKISERR EQU   *                                                XA01816 22709402
         LA    RA,CKPERG32              ISAM DISP=SHR ERROR     XA01816 22709502
         B     CHRERX                   TO TO ERROR EXIT        XA01816 22712902
CHKISCAN EQU   *                                                XA01816 22714902
         L     RD,DCBWKPT1              GET SCAN MODE W/A PTR   XA01816 22715302
         USING SCANWA,RD                                        XA01816 22715702
         TM    W1DCBFA,ISAMSHR          IS IT OPEN FOR SHR      XA01816 22716102
         BO    CHKISERR                 YES,IT IS SHARED        XA01816 22716202
         DROP  RD                                               XA01816 22719602
CHKNXDEB EQU   *                                                XA01816 22721602
         L     R6,DEBDEBAD    GET NEXT DEB                       A39163 22723002
         B     CHKGRAPH       GO CHK NXT DEB                     A39163 22726402
LSTDEB   EQU   *                                                 A39163 22729802
         EJECT 1                                                   I250 22739902
*                                                                       22750000
*******************************************************************I250 22900019
*                                                                  I250 23100019
*        AOS/2 ENVIRONMENT TESTING -                               I250 23300000
*              OUTSTANDING ENQUEUES                                I250 23500019
*              OUTSTANDING WTOR                                    I250 23700019
*                                                                  I250 24500019
*******************************************************************I250 24700019
*                                                                  I250 24900019
         LA    RA,CKERENQS         LOAD MESSAGE CODE FOR POSSIBLE ERROR 26600017
         NC    TCBFSA(1),TCBFSA    ARE THERE ANY OUTSTANDING ENQUEUES.  27000017
         BNZ   CHRPRE              YES, CHK END OF QCB CHAIN     YM0520 27500002
CHRNXT   EQU   *                                                        28000017
         L     RF,CVTPTR(R0)       GET ADDR OF CVT.                     28500017
         USING CVTSECT,RF          ADDRESS CVT.                         29000017
         L     R1,CVTCUCB          GET ADDR OF UCM TABLE                29500017
         USING UCMSECT,R1          ADDRESS UCM.                         30000000
         L     R1,UCMRPYQ          GET ADDR OF FIRST ORE.               30500000
         USING OREF,R1             ADDRESS OPERATOR REPLY ELEMENT.      31000000
CHRWTORQ EQU   *                                                        31500017
         LTR   R1,R1               ARE THERE ANY MORE ORE'S             32000000
         BZ    CHRCKT              NO-GO CHECK CHECK ID          Y02083 32300002
         LA    RA,CKERPG14         LOAD RETURN CODE IF ERROR OCCURS.    32700000
         C     R4,ORETCB           IS THERE AN OUTSTANDING WTOR         33100000
         BNE   NEXT                NO TEST NEXT ELEMENT        @ZA07036 33500003
         L     RF,CVTPTR           GET THE CVT POINTER         @ZA07036 33550003
         L     RF,CVTTCBP-CVT(,RF)  GET TCB POINTER            @ZA07036 33600003
         L     RF,K12(RF)           GET ASCB                   @ZA07036 33650003
         L     R3,OREWQE            GET THE WQE ADDRESS        @ZA07036 33700003
         LA    R3,0(R3)             CLEAR HIGH ORDER BYTE      @ZA07036 33750003
         CLC   ASCBASID-ASCB(,RF),161(R3)  COMPARE ASIDS       @ZA07036 33800003
         BE    CHRERX               GO TO ERROR ROUTINE        @ZA07036 33850003
NEXT     EQU   *                                                        33900003
         L     R1,ORELKP           GET ADDR OF NEXT REPLY Q. ELEMENT.   34000000
         B     CHRWTORQ            CONTINUE CHECKING ORE CHAIN          34100000
         EJECT 1                                                   I250 34192019
*                                                                     * 34200018
*********************************************************************** 34300018
*                                                                     * 34600017
*        CHECK LENGTH OF CHECKID                                      * 34700017
*                                                                     * 34800017
*********************************************************************** 34860018
*                                                                     * 34920018
CHRCKT   EQU   *                                                        35000017
         L     R3,CKPARMAD          GET ADDR OF PARAMETER LIST.         35200017
         USING PARMSECT,R3         MAPPING CHKPT PARAMETER LIST         35400018
         TM    PARMFLG,NOID        DID USER SUPPLY CHECKID              35600018
         BO    CHRBKPRB            NO-SKIP CODE TO EXAMINE CHECKID.     36000017
         TM    LNCHKID,USERID      Q. DID USER SUPPLY CHECKID           36500018
         BO    CHRBKPRB            NO-SKIP CODE TO EXAMINE CHECKID.     37000017
         OI    CKFLAG2,CKUSPCHD    INDICATE USER SUPPLIED CHECKID.      37500017
         LA    RA,CKERPG15          LOAD RETURN CODE IF ERROR OCCURS.   37550017
         CLI   LNCHKID,LNGZERO     DOES CHECKID LENGTH = 0              37620018
         BE    CHRERX              YES-GO TO ERROR EXIT RTN             37700017
         CLI   LNCHKID,CHR16       IS CHECKID TOO LONG                  38100018
         BH    CHRERX              YES-GO TO ERROR EXIT ROUTINE.        38500017
         TM    CKFLAG1,CKBPAM      WAS CHKPT DATA SET OPENED FOR BPAM.  39000017
         BZ    CHKCHARS       NO-SKIP CODE TO CHECK BPAM LENGTH  A44785 39500021
         CLI   LNCHKID,BPAMLNG     IS CHECKID TOO LONG                  40000018
         BH    CHRERX              YES-GO TO ERROR EXIT ROUTINE.        40500017
*                                                                     * 40530018
*********************************************************************** 40560018
*                                                                     * 40600017
*        TEST USER'S CHECKID FOR VALID CHARACTERS                     * 40670021
*                                                                     * 40740021
*********************************************************************** 40830018
*                                                                       40860018
*                                                                     * 40900017
CHKCHARS EQU   *                                                 A44785 40950021
         XR    R6,R6               SET SWITCH TO INDICATE FIRST CHAR.   41000017
         XR    R7,R7               CLEAR REGISTER                       41300017
         IC    R7,LNCHKID          GET LENGTH OF CHECKID                41600018
         L     R9,IDADDR           GET ADDR OF CHECKID                  41900018
         DROP  R3                                                       42200018
CHRTAB   EQU   *                                                        42500017
         LA    R8,CHKTABLE         GET ADDR OF TABLE OF VALID CHAR.     43000017
         XR    RE,RE                                                    43500017
CHRBGN   EQU   *                                                        44000017
         CLC   0(1,R8),0(R9)       DOES CHECKID CHAR. MATCH A VALID ONE 44500017
         BE    CHROUT              YES-EXAMINE NEXT CHAR.               45000017
         LTR   R6,R6               IS THIS THE FIRST CHAR               45500017
         BNZ   CHRTST2             NO-GO TO SEE IF END OF TABLE.        46000017
         CH    RE,=H'28'           END OF ALPHABETIC PART OF TABLE      46500017
         BL    CHRCOMUP       NO-EXAMINE NEXT CHAR IN TABLE      A44785 46600021
         TM    CKFLAG1,CKBPAM IS BPAM ORGANIZATION               A44785 46700021
         BO    CHRERX         YES-GO TO ERROR EXIT ROUTINE       A44785 46800021
         CH    RE,=H'50'                END NATL CHAR TBL        M1355  46850021
         BE    CHRERX              YES-GO TO ERROR EXIT ROUTINE.        47000017
         B     CHRCOMUP            NO-EXAMINE NEXT CHAR IN TABLE.       47500017
CHROUT   EQU   *                                                        48000017
         LR    R6,R9               SET SWITCH TO INDICATE NOT-1ST-CHAR. 48500017
         LA    R9,ADDONE(R9)       UPDATE POINTER TO NEXT CHAR IN CKID  49000018
         BCT   R7,CHRTAB           END OF TESTING-NO-TEST NEXT CHAR     49500018
CHRBKPRB EQU   *                                                        50000017
*                                                                     * 50030018
*********************************************************************** 50060018
*                                                                     * 50100017
*        SET PARAMETER REGISTER AND XCTL TO IGC0206C                  * 50200017
*                                                                     * 50300017
*********************************************************************** 50360018
*                                                                     * 50420018
         LR    R1,RC               LOAD PARM REG WITH W.A. ADDR.        50500017
         MVC   CKJCT(LXCTLNAM),CHRXLIST      SET UP XCTL PARM LIST      50800018
CHREXT   EQU   *                                                        51100017
CHKCER   EQU   *                                                        51200017
         LA    RF,CKJCT                                                 51500017
         USING XCTLSECT,RF         MAPPING OF XCTL PARM LIST            51700018
         ST    RF,XCPARMPT                                              51900018
         LA    RF,XCPARMPT                                              52100018
         DROP  RF                                                       52300018
         XCTL  SF=(E,(15))                                              53000017
*                                                                     * 53100017
*********************************************************************** 53150018
*        ERROR ROUTINE - SETS RETURN CODE AND SAVES MESSAGE CODE IN   * 53200017
*        CHKWA; ALTERS XCTL PARM LIST TO TRANSFER CONTROL TO IGC0Q06C * 53300017
*                                                                     * 53400017
*********************************************************************** 53430018
*                                                                     * 53460018
CHRERX   EQU   *                                                        53500017
         LR    R1,RC                                                    53520017
         OI    CKFLAG2,CKMSG1      INDICATES MSG-ENVIRONMENT ERROR      53560017
         OI    CKFLAG2,CKFREEM     INDICATES ONLY FREEMAIN WA IN CER    53580017
         MVI   CKRETCD1,CKPGMERR   SAVE RETURN CODE IN CHKWA            53610018
         STH   RA,CKMSGCOD         SAVE MESSAGE CODE IN WA              53650017
         LA    RF,CKJCT                                                 54050018
         USING XCTLSECT,RF         MAPPING OF XCTL PARM LIST            54450018
         MVC   XCTLNAME(LXCTLNAM),CHRXLIST   SET UP XCTL PARMLST TO     54850018
         MVI   XCTLNM2,CHARQ                 TRANSFER CONTROL TO CER    55250018
         B     CHKCER              GO TO TRANSFER CONTROL               55710017
CHRBLANK EQU   *                                                        59500017
         BCTR  R7,0                DECREMENT COUNT FOR MOVES.           60000017
         EX    R7,CHRCLC1          ARE REST OF CHARS. BLANKS.           60500017
         BNE   CHRERX              NO-GO TO ERROR EXIT ROUTINE.         61000017
         B     CHRBKPRB            YES-VALID CHECKID,GO ON PROCESSING.  61500017
CHRTST2  EQU   *                                                        62000017
         CH    RE,=H'38'           END OF TABLE                         62500017
         BL    CHRCOMUP       NO-EXAMINE NEXT CHAR IN TABLE      A44785 62600021
         TM    CKFLAG1,CKBPAM IS BPAM ORGANIZATION               A44785 62700021
         BO    CHRBLANK       YES-SEE IF REST OF CHARS ARE BLANK A44785 62800021
         CH    RE,=H'50'      END OF NATIONAL CHAR PART OF TABLE M1355  62900021
         BE    CHRBLANK            GO TO SEE IF REST OF CHAR.ARE BLANKS 63000017
CHRCOMUP EQU   *                                                        63500017
         LA    RE,ADDONE(RE)       UPDATE COUNT OF CHAR TRIED           64000018
         LA    R8,ADDONE(R8)       UPDATE POINTER TO NEXT CHAR IN TABLE 64500018
         B     CHRBGN              GO TO TRY NEXT CHAR IN TABLE.        65000017
*                                                                       68320018
CHRPRE   EQU   *                                                 YM0520 68370002
*                                                                       68372002
*  FOLLOWING IS A TEST FOR DATA SET INTEGRITY (DSI) ONLY ENQS    YM0520 68374002
*                                                                       68376002
         L     R3,CVTPTR                GET CVT ADDR             YM2878 68426002
         L     R3,CVTFQCB-CVT(,R3)      GET FIRST QCB            YM2878 68476002
         B     CHRQCB01                 BR TO PROC. QCBS         YM2878 68486002
         USING MAJ,R3                                            YM2878 68488002
CHRQCBMJ L     R3,MAJNMAJ               GET NEXT MAJOR QCB       YM2878 68488402
CHRQCB01 LTR   R3,R3                    CHECK IF MAJ EXISTS      YM2878 68488502
         BZ    CHRNXT                   NO MORE-CHECK ENVIRON.   YM2878 68488602
         CLC   MAJNAME(K8),SYSDSN       SCHED HANLES SYSDSN      YM2878 68488702
         BE    CHRQCBMJ                 IGNORE                   YM2878 68502902
         CLC   MAJNAME(K8),SYSVSAM      VSAM HANDLES SYSVSAM     YM2878 68512902
         BE    CHRQCBMJ                 IGNORE                   YM2878 68514902
         LA    R6,MAJFMIN               PRETEND MAJOR IS MINOR   YM2878 68516902
         USING MIN,R6                                            YM2878 68517302
CHRQCBMN EQU   *                        CHECK MINORS             YM2878 68522002
         L     R6,MINNMIN               GET NEXT MINOR QCB       YM2878 68524002
         LTR   R6,R6                    ANY MORE MINORS          YM2878 68526002
         BZ    CHRQCBMJ                 NO-GET NEXT MAJOR        YM2878 68526402
         LA    R7,MINFQEL               PRETEND MIN IS QEL       YM2878 68526802
         USING QEL,R7                                            YM2878 68531502
CHRQEL   EQU   *                        CHECK QELS               YM2878 68533502
         L     R7,QELNQEL               GET NEXT QEL             YM2878 68535502
         LTR   R7,R7                    ANY MORE QELS?           YM2878 68535902
         BZ    CHRQCBMN                 NO-TRY NXT MINOR QCB     YM2878 68536302
         LR    R8,R7                    SAVE QEL-MAY BE LIST     YM2878 68541002
         DROP  R7                                                YM2878 68543002
         USING QEL,R8                                            YM2878 68545002
         B     CHRQEL08                 BR TO CHECK IF LIST      YM2878 68545402
CHRQELLS EQU   *                                                        68545802
         L     R8,QELLQEL               GET LIST QEL             YM2878 68558102
CHRQEL08 EQU   *                        LIST QEL TEST            YM2878 68568102
         TM    QELLQEL,QELXLIST         LIST QEL?                YM2878 68570102
         BO    CHRQELLS                 GET REAL QEL             YM2878 68570502
         L     RF,CVTPTR                GET CVT POINTER          YM2878 68570602
         L     RF,CVTTCBP-CVT(,RF)      GET TCB PTR              YM2878 68570702
         L     RF,K12(RF)               CURRENT ASCB             YM2878 68574802
         CLC   ASCBASID-ASCB(,RF),QELASID   THIS MEMORY?         YM2878 68576802
         BNE   CHRQEL                   BR FOR NEXT QEL          YM2878 68578902
         CLC   QELTCB+K1(K3),CKTCBAD+K1 THIS TCB?                YM2878 68583002
         BNE   CHRQEL                   IF NO-GET NEXT QEL       YM2878 68585002
         DROP  R3,R6,R8                                          YM2878 68587002
*********************************************************************** 68587202
*                                                                       68591302
*        SET RETURN CODE = PROBABLE ERROR                               68595402
*                                                                       68607702
*********************************************************************** 68620018
*                                                                       68680018
CHRPROBR EQU   *                                                        69000017
         MVI   CKRETCD1,CKPSBERR   INDICATE PROBABLE ERROR              69200018
         STH   RA,CKMSGCOD         STORE MESSAGE CODE                   69700017
         B     CHRNXT             GO TO CONTINUE ENVIRONMENT CHECKING   70000017
*                                                                     * 70030018
*********************************************************************** 70060018
*                                                                     * 70100017
*        FOR CHKPT DATA SET ON DIRECT ACCESS, CHECK KEYLENGTH IN DCB  * 70200017
*        EQUAL TO ZERO.                                               * 70300017
*                                                                     * 70400017
*********************************************************************** 70430018
*                                                                     * 70460018
CHRDACL  EQU   *                                                        70500017
         LA    RA,CKERPG5           LOADED RETURN CODE IF ERROR OCCURS. 70700017
         CLI   DCBKEYLE,LNGZERO    IS KEYLENGTH ZERO                    71100018
         BNE   CHRERX              NO-GO TO ERROR EXIT ROUTINE.         71500017
         B     CHRTRFM             YES-CONTINUE ENVIRONMENT CHECKING.   72000017
CHRCLC1  CLC   0(1,R9),BLANKS      EXECUTED COMPARE FOR PADDED BLANKS.  72500017
*                                                                       73100018
*        TABLE CONTAINING VALID CHARACTERS FOR CHECKID                  73200018
*                                                                       73300018
CHKTABLE EQU   *                                                        73500017
         DC    CL26'ABCDEFGHIJKLMNOPQRSTUVWXYZ'                         74000017
         DC    CL3'$#@'                                                 74500017
         DC    CL10'0123456789'                                         75000017
         DC    CL12',./''()*&&+-= '     NATIONAL CHARACTERS      M1355  75200021
BLANKS   DC    C'       '                                               75500017
*                                                                       75800018
H4096    DC    H'4096'             4K BLKSIZE FOR CHKPT DATA SET YM5921 76150002
CHRXLIST DC    C'IGC0206C'         TRANSFER CONTROL(NORMAL FLOW)        76200018
SYSDSN   DC    C'SYSDSN  '              SYSTEM D/S ENQ MAJ NAME  YM0520 76250002
SYSVSAM  DC    C'SYSVSAM '              VSAM DS MAJOR NAME       YM0520 76300002
ZERO     DC    F'0'                     FULL WORD OF ZERO'S      YM0520 76320002
IMGDDNAM DC    C'IMGLIB  '              IMG LIB DCB MASK         YM7338 76330002
BLKLENF  EQU   2                   LENGTH OF DCB BLKSIZE FIELD          76350000
K1       EQU   1                        CONSTANT 1               YM2878 76360002
K3       EQU   3                        CONSTANT 3               YM2878 76370002
K4       EQU   4                        CONSTANT 4               YM7338 76372002
K8       EQU   8                        CONSTANT 8               YM2878 76380002
K12      EQU   12                       CONSTANT 12              YM2878 76390002
*                                                                     * 76400000
*        MAINTENANCE SPACE                                            * 76450000
*                                                                     * 76500000
PATCH    DC    XL((*-IGC0106C)/20)'00'   FIVE PERCENT MAINTENANCE SPACE 76550000
*                                                                     * 76600000
         IHAASCB                                                 YM2878 76650002
         IHAQCB                                                  YM2878 77143902
         IHAQEL                                                  YM2878 77145902
         IEEVCHWA VER=3                 USE AOS2 VERION OF MACRO        77149902
         DCBD  DSORG=(BS,PO,IS),DEVD=(DA,TA)                    XA01816 77500002
SCANWA   IGGSCAN                                                XA01816 77550002
BISAMWA  IGGBISAM                                               XA01816 77600002
*                                                                     * 77904018
*        MAPPING OF CHECKPOINT PARAMETER LIST                         * 77908018
*                                                                     * 77912018
PARMSECT DSECT                                                          77916018
PARMFLG  DS    1C   FLAG BYTE                                           77920018
NOID     EQU   X'80'     INDICATES NO CHECKID SPECIFIED BY USER AND     77924018
*                        GENERATED CHECKID ADDR NOT TO BE RETURNED      77928018
CHKID    EQU   X'00'     USER-SPECIFIED CHECKID                         77932018
PARMDCB  DS    3C        ADDR OF CHKPT DCB                              77936018
IDADDR   DS    0F                                                       77940018
LNCHKID  DS    1C        LENGTH OF USER-SPECIFIED CHECKID               77944018
USERID   EQU   X'FF'     INDICATES USER WANTS SYSTEM-GENERATED CHECKID  77948018
*                        AND RETURNED AT LOCATION SPECIFIED BY IDADDR   77952018
         DS    3C        ADDR OF USER-SUPPLIED CHECKID,OR, CONTAINS     77956018
*                        RETURN ADDRESS OF SYSTEM-GENERATED CHKID       77960018
*                                                                     * 77964018
*        MAPPING OF XCTL PARAMETER LIST                               * 77968018
*                                                                     * 77972018
XCTLSECT DSECT                                                          77976018
XCTLNAME DS    1F        MODULE NAME TO TRANSFER CONTROL                77980018
XCTLNM2  DS    1F                                                       77984018
XCPARMPT DS    1F        POINTER TO XCTL PARM LIST                      77988018
UCMSECT  DSECT                                                          78500017
         IEECUCM                                                        79000017
         IHAORE  DSECT=YES                                              79500000
CVTSECT  DSECT                                                          79550000
CVT      CVT                                                     YM2878 79600002
         IKJTCB                                                         79650000
         IKJRB                                                          79700000
         IHATQE                                                         79710000
         IEZDEB                                                         79750000
CKTIOTD  DSECT                                                          81000017
         IEFTIOT1                                                       81500017
         EJECT                                                          81550002
SRT      DSECT                                                   Y02049 81600002
         IEFUCBOB  LIST=YES                                      Y02049 81650002
         EJECT                                                          81700002
SVRB34   EQU   X'D0'     INDICATES TYPE 3 OR 4 SVRB.                    83700017
CHR16    EQU   16     MAXIMUM LENGTH FOR A CHECKID                      84500017
TQENTQ   EQU   X'80'     INDICATES TQE IS NOT ON TIMER QUEUE.           85000017
FIXD     EQU   128     DCBRECFM FIELD- INDCIATES FIXED                  85500017
TRKOVF   EQU   32            DCBRECFM FIELD-INDICATES TRACK OVERFLOW    87700017
UNDF     EQU   X'C0'   DCBRECFM FIELD- INDICATES UNDEFINED              88000017
FIXUND   EQU   128     DCBRECFM FIELD- INDCIATES FIXED OR UNDEFINED     88500017
CLOSEOPT EQU   128       OPTION BYTE FOR CLOSE'S PARM LIST.             90000000
USERCKID EQU   X'FF'     INDICATES USER SUPPLIED CHECKID                90001618
LNGZERO  EQU   X'00'     LENGTH = ZERO                                  90002018
BPAMLNG  EQU   X'08'     CHECKID LENGTH = 8                             90002418
CHARQ    EQU   C'Q'      USED TO ALTER PARMLST TO XCTL TO CER           90002818
LNADDR   EQU   3         LENGTH OF ADDRESS                              90003218
ADDONE   EQU   1         INCREMENT QUANTITY                             90003618
ONECHAR  EQU   1         INDICATES ONE CHARACTER COMPARE                90004018
LXCTLNAM EQU   8         LENGTH OF XCTL PARAMETER LIST NAME             90004418
CKSPBKSZ EQU   8         INDICATES CHKPT PROVIDED BLKSIZE FOR CHKPT DS  90004818
HALFWD   EQU   2         LENGTH OF HALF-WORD                            90005218
ADDRBYTS EQU   7         MASK OF ADDRESS BITS IN FULLWORD               90005600
TAPE     EQU   X'80'      TAPE BIT OF DEVTYPE FIELD              S20038 90005720
ALLBITS   EQU  X'FF'     MASK WITH ALL BITS ON                          90006000
*                                                                       90006421
*        ADDRESSING BYTES WITHIN DSECTS                                 90006521
CKBUFLN  EQU   CKBUFL+2                                                 90006818
TCBTME1  EQU   TCBTME+1                                                 90007618
TCBLTC1  EQU   TCBLTC+1                                                 90008818
CKRETCD1 EQU   CKRETCOD+1                                               90009218
PIEFLAG  EQU   X'80'                                             A43190 90009721
CKMSG1   EQU   32    WTO MESSAGE-NOT TAKEN-ENVIRONMENT ERROR            90010017
CKERPG5  EQU   X'05'    FOR D.A.,KEYLENGTH SPECIFIED=0                  90020017
CKERPG6  EQU   X'06'    ERROR IN DCBRECFM                               90030017
CKERPG7  EQU   X'07'    ERROR IN DCBDSORG                               90040017
CKERPG8  EQU   X'08'    ACTIVE TQE                                      90050017
CKERPG9  EQU   X'09'    ERROR IN RBSTAB                                 90060017
CKPERG10 EQU   X'0A'          GRAPHICS DSORG ERR CODE            A39163 90070021
CKERPG11 EQU   X'0B'    CURRENT TCB IS NOT JOB STEP TCB                 90080017
CKERPG12 EQU   X'0C'    TCB HAS DAUGHTER TASKS                          90090017
CKPER206 EQU   206                      VTAM DSORG ERR CODE      Y02076 90092002
CKERENQS EQU   X'0100'             OUTSTANDING ENQS                     90100017
CKERPG14 EQU   X'0E'    OUTSTANDING WTOR                                90110017
CKERPG15 EQU   X'0F'    INCORRECT CKID LN/FORMAT                        90120017
CKERPG16 EQU   X'10'    CHKPT D.S. NOT ON D.A. OR TAPE                  90130017
CKPER224 EQU   224                      SAM-SI(NON CI) ERR CODE  Y02076 90140002
CKPER250 EQU   250                      IMAGE LIB DCB            YM7813 90142002
CKERPG19 EQU   X'13'    CHKPT DS NOT OPENED TO WRITE                    90150000
CKERPG21 EQU   X'15'    MSG CODE FOR JCL LABEL ERROR              19200 90350019
CKERPG29 EQU   X'1D'    MSG CODE FOR OPTCD FIELD OF DCB ERROR    S20038 90420020
CKPERG32 EQU   X'20'            MSG CODE FOR ISAM (DISP=SHR)    XA01816 90430002
ISAMSHR  EQU   X'80'                    ISAM WA BIT FOR SHR     XA01816 90450002
VTAMDSCD EQU   X'82'                    VTAM DATA SET DEB CODE   Y02076 90470002
VSAMDSCD EQU   X'01'                    VSAM DATA SET DEB CODE   Y02076 90472002
ACBIDENT EQU   X'A0'                    ACB ID BYTE              Y02076 90480002
DEBCIBIT EQU   X'08'    DEB CI BIT POSITION                      Y02076 90490002
DEBPRFLN EQU   16                       LNGTH OF DEB PREFIX      Y02076 90494002
         END                                                            90500017
./  ADD  SSI=50140021,NAME=IHJACP02
*                                                                       00000820
         COPY  LCGASMSW                                                 00001601
*                                                                       00004020
         TITLE 'IGC0206C (IHJACP02) CHKPT HOUSEKEEPING RTN - 3RD LOAD'  00005018
*********************************************************************** 00007002
*                                                                       00009002
*TITLE:  CHKPT HOUSEKEEPING - 3RD LOAD                                  00010017
*                                                                       00017002
*STATUS CHANGE LEVEL 000                                                00022002
*                                                                       00024002
*FUNCTION/OPERATION:  THIS ROUTINE WILL DO THE FOLLOWING:               00030017
*        1.) GET SPACE FOR QMNGRIO PARAMETER LIST AND WORK AREA.  SET   00040002
*            UP PARAMETER LIST FOR READING CONTROL BLOCKS FROM THE      00042002
*            SCHEDULER WORK AREA (SWA).                                 00044002
*        2.) READ IN THE JCT VIA QMNGRIO.                               00080002
*        3.) GIVE CONTROL TO THE CHKPT EXIT ROUTINE IF 'CANCEL' WAS     00090017
*            REQUESTED.                                                 00100017
*        4.) CONSTRUCT CHECKPOINT HEADER RECORD (CHR).                  00110017
*        5.) UPDATE THE JCTNRCKP AND JCTCKIDL FIELDS IN THE JCT.        00120017
*        6.) GENERATE A CHECKID IF USER DID NOT SUPPLY A CHECKID.       00130017
*        7.) CALL THE VSAM CHECKPOINT ROUTINE IF ANY VSAM DATA @Z30SSDT 00130403
*            SETS ARE OPEN.                                    @Z30SSDT 00130803
*                                                                       00132002
*ENTRY POINTS:  IGC0206C                                                00140002
*                                                                       00142002
*INPUT:  ADDRESS OF CHKPT WORK AREA IN REGISTER 1.                      00150017
*                                                                       00152002
*OUTPUT:  IF AN ERROR WAS FOUND WHEN READING THE JCT VIA QMNGRIO,       00160002
*        A RETURN CODE OF X'0C' IS PLACED IN CHKWA TO INDICATE A        00170017
*        CHKPT I/O ERROR AND A MESSAGE CODE OF X'19' IS PLACED @Z30SSDT 00180003
*        IN CHKWA.  CONTROL IS PASSED TO THE ERROR EXIT        @Z30SSDT 00190003
*        ROUTINE FOR A CANCELLED CHECKPOINT, AN I/O ERROR,     @Z30SSDT 00190403
*        OR A VSAM CHECKPOINT ERROR.                           @Z30SSDT 00190803
*                                                                       00192002
*EXTERNAL ROUTINES:  SWA MANAGER ROUTINE                                00200002
*                    VSAM CHECKPOINT ROUTINE                            00200403
*                                                                       00202002
*SVCS USED:  XCTL, GETMAIN, FREEMAIN                                    00210002
*                                                                       00212002
*EXITS-NORMAL:  XCTL TO CHKDCB, IGC0506C, UNLESS CANCEL WAS REQUESTED   00220017
*        THEN XCTL TO CHKPT EXIT ROUTINE IGC0Q06C                       00230017
*                                                                       00232002
*EXITS-ERROR:  IF AN ERROR WAS FOUND WHEN READING THE JCT, CONTROL IS   00240002
*        PASSED TO IGC0Q06C                                             00250017
*                                                                       00252002
*TABLES/WORKAREAS CREATED:  NONE                                        00260017
*                                                                       00262002
*TABLES/WORKAREAS REFERENCED:  TCB,CHKWA,CVT,DCB,JCT,TIOT,QMIOP,        00270002
*      JESCT,PARMSECT,JSCB,CHR                                          00280002
*                                                                       00282002
*ATTRIBUTES:  REENTRANT, SUPERVISOR STATE, TYPE 4 SVC ROUTINE           00290017
*                                                                       00292002
*RESTRICTIONS ON USE OF ROUTINE:  USE ONLY ON OS/VS2/2                  00300002
*                                                                       00310002
*NOTES:  NONE                                                           00350017
*                                                                       00400002
*********************************************************************** 00450002
         EJECT                                                          00500002
IGC0206C CSECT                                                          00550017
         BALR  RB,0                BASE ADDR                            00850018
         USING *,RB                ADDRESS MODULE.                      01200017
         B     BEGIN               BRANCH AROUND EYE CATCHER            01250000
         CNOP  0,8                 ALIGN TO A DOUBLE WORD BOUNDARY      01300000
         DC    C'IGC0206C'         CSECT NAME                           01350000
BEGIN    EQU   *                                                        01400000
         USING TCB,R4              ADDRESS TCB.                         01600000
         USING CHKWA,RC            ADDRESS WORK AREA.                   02000017
         LR    RC,R1               SAVE W.A. ADDRESS.                   02800017
         LA    RD,CKREGSAV         INITIALIZE SAVE AREA REG.            03200017
         L     R4,CKTCBAD          GET ADDR OF TCB.                     03600017
**********************************************************************  10850001
* GET PARM LIST AND WORK AREA SPACE FOR QMNGRIO (24+256 BYTES)   Y02076 10852002
*                      AND                                       Y02076 10852402
* GET THE SVA OF THE JCT FROM THE JSCB                           M0367  10854002
*                                                                     * 10856001
**********************************************************************  10858001
CHRMVT2  EQU   *                                                        10858401
         ICM   R0,ADDRBYTS,QMNGWALN     WA + PARM LST LNGH IN R0 Y02076 10858502
         ICM   R0,HIORDER,SP253         INSERT SUBPOOL NO. IN R0 Y02076 10858702
         GETMAIN R,LV=(R0)              GET QMNGRIO WRK AREA     Y02076 10858802
         ST    R1,QMGRPRMA              SAVE P.L. ADR - FREEMAIN Y02076 10860802
         LR    R9,R1                    SAVE PARM LIST ADDR      Y02076 10867202
         L     R1,TCBJSCB         ADDRESS OF P/P JSCB            M0367  10875702
         USING IEZJSCB,R1                                        M0367  10884202
         L     R0,JSCBJCT         SVA OF JCT                     M0367  10892702
         SLL   R0,HIORDER         CLEAR LOW ORDER BYTE           M0367  10901202
         TM    JSCBOPTS,JSCBAUTH        Q-USER AUTH FOR MODESET  Y02076 10903202
         BZ    CHRNAUTH                 BR IF NOT AUTH           Y02076 10905202
         OI    CKFLAG1,USERAUTH         SET 'USER AUTH' BIT      Y02076 10907202
CHRNAUTH EQU   *                        SET UP QMNGRIO PARM LIST Y02076 10909202
         USING QMIOP,R1                 BASE REG FOR PARM LIST   Y02076 10909702
         LR    R1,R9                    RESTORE ADR OF PARM LIST Y02076 10959702
         XC    QMITCBAD(LPL),QMITCBAD   CLEAR QMNGRIO PARM LST   Y02076 10969702
         ST    R0,QMIDSKAD              ST JCT SVA ADDR IN PARM  Y02076 11009702
         LA    R0,LPL                   GET OFFSET TO WORK AREA  Y02076 11059702
         AR    R0,R1                    CALC WORK AREA ADDRESS   Y02076 11069702
         ST    R0,QMIWRKAD              ST WA ADDR IN P.L.       Y02076 11071702
         ST    R4,QMITCBAD              STORE TCB ADDR IN P.LIST Y02076 11079702
         LA    R0,LNJCT                 GET LENGTH OF JCT        Y02076 11089702
         STH   R0,QMIRECL               STORE JCT LENGTH IN P.L  Y02076 11099702
         LA    R0,INJMJCT               GET ADDR FOR JCT READ IN Y02076 11159702
         ST    R0,QMIRECAD              STORE IN PARM LIST       Y02076 11209702
         MVI   QMIFLAGS,QMIOREAD        SET READ FUNC IN PRM LST Y02076 11259702
         QMNGRIO                        READ IN JCT              Y02076 11309702
         LTR   RF,RF                    SUCCESSFUL READ          Y02076 11359702
         BNZ   CHRQERRW                 NO-BRANCH TO ERR ROUTINE Y02076 11409702
*********************************************************************** 21250002
*                                                                     * 21300002
*        FOR CANCEL REQUEST, BRANCH TO XCTL TO EXIT ROUTINE           * 21350002
*                                                                     * 21400002
*********************************************************************** 21450002
         TM    CKFLAG1,CKCANCEL         WAS CANCEL REQUESTED            21500002
         BO    CHRQCOM                  YES-GO TO EXIT ROUTINE          21550002
         L     R8,CKPARMAD              GET ADDR OF PARM LIST           21600002
         LR    RA,RC                    GET ADDR OF W.A.                21650002
         A     RA,CKBFOFST         GET ADDR OF BUFFER.                  26000017
         L     R5,CKDCBAD          GET ADDR OF CHKPT DCB.               26400017
         USING IHADCB,R5           ADDRESS CHKPT DCB.                   26800017
         USING CHRSECT,RA                                               27200017
**********************************************************************  27260017
*                                                                     * 27320017
*        INCREMENT JCTNRCKP FIELD IN JCT BY ONE                       * 27380017
*                                                                     * 27440017
**********************************************************************  27500017
         LH    RF,JCTNRCKP         GET NO. CHKPT'S TAKEN.               27600017
         LA    RF,ADDONE(RF)       UPDATE NO. CHKPT'S TAKEN             28000018
         STH    RF,JCTNRCKP        STORE UPDATED COUNT IN JCT           28400017
**********************************************************************  28460017
*                                                                     * 28520017
*        BRANCH TO GENERATE CHECKID IF USER DID NOT SUPPLY CHECKID    * 28580017
*                                                                     * 28640017
**********************************************************************  28700017
         TM    CKFLAG2,CKUSPCHD    DID USER SUPPLY CHECKID              28800017
         BZ    CHRGNID             NO-GO TO GENERATE ID.                29200017
         XR    R1,R1                                                    29600017
         USING PARMSECT,R8         MAPPING OF CHKPT PARMLST             29700018
         IC    R1,LNCHKID          GET LENGTH OF CHECKID                29800018
         L     RF,IDADDR           GET ADDR OF CHECKID                  29900018
**********************************************************************  30440017
*                                                                     * 30480017
*        UPDATE JCTCKIDL FIELD IN JCT                                 * 30520017
*        CONSTRUCT CHECKPOINT HEADER RECORD                           * 30560018
*                  CHRCOUNT - NUMBER CHECKPOINTS TAKEN                * 30600017
*                  CHRCKIDL - LENGTH OF CHECKID                       * 30640017
*                                                                     * 30680017
**********************************************************************  30720017
CHRSKP4  EQU   *                                                        30800017
         STH   R1,CHRCKIDL         MOVE CHECKID LENGTH TO BUFFER.       31200017
         MVC   CHRCOUNT(CHRCKIDL-CHRCOUNT),JCTNRCKP                     31400018
*                                  PUT NO. OF CHKPT IN CHR.             31600018
         STC   R1,JCTCKIDL         MOVE CHECKID LENGTH TO JCT.          32000017
**********************************************************************  32060017
*                                                                     * 32120017
*        SET VIRTUAL = REAL FLAG, AND                                 * 32170002
*        INITIALIZE CHRCHKID FIELD IN JCT WITH CHECKID                * 32180017
*                                                                     * 32240017
**********************************************************************  32300017
CHRAG1   EQU   *                                                        32400017
         TM    TCBFLGS6,TCBRV      TEST FOR VIRTUAL = REAL       Y02076 32450002
         BZ    CHRAG1A             BRANCH IF NO                  Y02076 32500002
         OI    CKFLAG1,CKVEQR      SET V=R FOR MOVE TO CHR       Y02076 32550002
CHRAG1A  EQU   *                   PREPARE TO MOVE CHECKID       Y02076 32600002
         MVI   CHRCHKID,BLANK      INITIALIZE CHECKID FIELD WITH BLANKS 32800018
         MVC   CHRCKID2(LNG15),CHRCHKID                                 33200018
         BCTR  R1,0                DECREMENT COUNT FOR MOVES.           33600017
         EX    R1,CHRMVC1          MOVE CHECKID TO BUFFER.              34000017
**********************************************************************  34070017
*                                                                     * 34140017
*        RETURN SYSTEM-GENERATED CHECKID TO USER IF REQUESTED.        * 34210017
*                                                                     * 34280017
**********************************************************************  34350017
         L     RF,CKPARMAD         GET ADDR OF PARM LIST                34440017
         USING PARMSECT,RF         UPDATE NO. CHKPT'S TAKEN             34460018
         CLI   PARMFLG,NOID        REQUEST FOR RETURN OF GEN. CHECKID   34480018
         BE    CHRMVR              NO-SKIP CODE TO RETURN CHECKID       34520017
         CLI   LNCHKID,RETCKID     REQUEST FOR RETURN OF GEN. CHECKID   34560018
         BNE   CHRMVR              NO-SKIP CODE TO RETURN CHECKID.      34600017
         L     RF,IDADDR           GET ADDR OF CHECKID-RETURN-AREA      34620018
         DROP  RF                                                       34640018
         MVC   0(LNGENID,RF),CHRCHKID                                   34680018
*                                  MOVE CHECKID TO USER SPECIFIED       34690018
*                                  RETURN AREA                          34700018
**********************************************************************  34726017
*                                                                     * 34732017
*        BUILD REMAINDER OF CHR                                       * 34738017
*                                                                     * 34744017
**********************************************************************  34750017
CHRMVR   EQU   *                                                        34760017
         L     RF,16(0,0)          LOAD CVT POINTER            @Z30JSSR 34770003
         USING CVTMAP,RF           MOVE SYSTEM ID              @Z30JSSR 34780003
         MVC   CHRSYSID(CHRIDENT-CHRSYSID),CVTDCB              @Z30JSSR 34790003
         DROP  RF                                              @Z30JSSR 34792003
         LH    RF,DCBTIOT          GET OFFSET TO CHKPT ENTRY IN TIOT.   34800017
         L     RE,TCBTIO           GET ADDR OF TIOT.                    35200017
         AR    RE,RF               GET ADDR OF CHKPT ENTRY IN TIOT.     35600017
         USING TIOELNGH,RE         ADDRESS CHKPT DD ENTRY IN TIOT.      36000017
*                                  FILL IN CHR WITH INFORMATION THAT    36200018
*                                  WILL BE NEEDED AT RESTART TIME       36400018
         MVC   CHRDDNM(CHRPPM-CHRDDNM),TIOEDDNM                         36600018
         MVC   CHRPPM(CHRBLKSI-CHRPPM),CKPPM                            36800018
         MVC   CHRPPML(CHRSYSID-CHRPPML),CKPPML                @Z30JSSR 37000003
         MVC   CHRIDENT(CHRPADH-CHRIDENT),CHRID                @Z30JSSR 37050003
         MVC   CHRBLKSI(CHRTIOTL-CHRBLKSI),DCBBLKSI                     37200018
         MVC   CHRTIOTL(CHRFLAGS-CHRTIOTL),CKTIOTLN                     37400018
         MVC   CHRFLAGS(CHRWACL-CHRFLAGS),CKFLAG1                       37600018
         ST    RC,CHRCKWAD                                              38100018
         MVC   CHRFLAG2(CHRWACL-CHRFLAGS),CKFLAG2                       38300018
         MVC   CHRWACL(CHRFLAG2-CHRWACL),CKWACL1                        38500018
         MVC   CHRSVRB(CHRPPML-CHRSVRB),TCBRBP    ADDR OF CHKPT SVRB    38700018
         NI    CKFLAG1,AUTHOFF          TURN OFF AUTH BIT AFTER  Y02076 38750002
*                                         MOVE TO CHR BUFFER     Y02076 38800002
         TM    CKFLAG1,CKTAPE           CHKPT D/S ON TAPE       YA00142 38850002
         BZ    CHRMVR2                  SKIP IF NOT             YA00142 38900002
         L     R3,DCBDEBAD              GET DEB ADR             YA00142 38950002
         MVC   CHRSVRB(LNG1),DEBVLSQ(R3) SAV VOL SEQ IN CHR     YA00142 39000002
CHRMVR2  EQU   *                        COMPLETE CHR            YA00142 39100002
**********************************************************************  39260017
*                                                                     * 39320017
*        PAD REMAINDER OF BUFFER WITH ONES.                           * 39380017
*                                                                     * 39440017
**********************************************************************  39500017
         LR    R9,RC               CALCULATE NUMBER                     39600017
         A     R9,CKWACL           OF BYTES IN BUFFER                   40000017
         LA    RF,CHRPADH          THAT NEED TO BE PADDED WITH ONES.    40400017
         SR    R9,RF                                                    40800017
CHRAG2   EQU   *                                                        41200017
         MVI   CHRPADH,CHRPAD      MOVE A BYTE OF ONES TO BUFFER        41500018
         BCTR  R9,0                DECREMENT COUNT.                     41800017
CHRBPAD  EQU   *                                                        42000017
         CH    R9,=H'256'          ARE THERE MORE THAN 256 BYTES LEFT   42400017
         BH    CHRPADNG            YES-GO TO PAD 256 BYTES.             42800017
         BCTR  R9,0                DECREMENT                            43200017
         EX    R9,CERMVC3          PAD REST OF BUFFER WITH ONES.        43600017
**********************************************************************  43900017
*                                                                     * 44200017
*        SET PARAMETER REGISTER AND XCTL TO IGC0506C.                 * 44500017
*      IF THERE ARE ANY VSAM DATA SETS OPEN, LOAD THE VSAM     @Z30SSDT 44550003
*      CHECKPOINT MODULE, IDA0C06C, AND BALR.                  @Z30SSDT 44600003
*                                                                     * 44800017
**********************************************************************  45100017
CHREXL   EQU   *                                                        45900017
         USING DEBBASIC,R7              DEB ADDRESSABILITY       Y02076 45950002
         L     R7,TCBDEB                GET POINTER TO FIRST DEB Y02076 46000002
CHRDEBCK L     R6,DEBDCBAD              GET PT TO THIS DCB/AMB   Y02076 46050002
         TM    EXCPTEST(R6),EXCPID      IS THIS AN EXCP DCB      Y02076 46060002
         BO    CHRNXTDB                 YES, GO GET PT NEXT DEB  Y02076 46070002
         TM    DSORGFLD(R6),ACBAMBID    IS THIS A DCB DATA SET   Y02076 46080002
         BZ    CHRNXTDB                 YES, GO GET PT NEXT DEB  Y02076 46090002
         CLI   OFFSET0(R6),AMBDSID      IS THIS AMB VSAM DATA ST Y02076 46092002
         BE    CHRVSAM                  YES, GO GET PT VSAM CHKPTY02076 46096002
         TM    ACBFLAG(R6),VSAMACB      IS THIS A VSAM ACB       Y02076 46098402
         BO    CHRVSAM                  YES, GO GET PT VSAMCKPT  Y02076 46098802
CHRNXTDB L     R7,DEBDEBAD              NO, GET PT TO NEXT DEB   Y02076 46099202
         LA    R7,0(R7)                 ZERO OUT HI ORDER BYTE   Y02076 46099602
         LTR   R7,R7                    ANY MORE DEBS ON CHAIN   Y02076 46099702
         BZ    CHRNEXT                  NO, XCTL TO IGC0506C     Y02076 46099802
         B     CHRDEBCK                 YES, GR TO CHK NEXT DEB  Y02076 46099902
         DROP  R7                                              @Z30SSDT 46149903
CHRVSAM  MVC   CHRXL(LXCTLNAM),CHRXAM0  GET PT TO VSAM CKPT      Y02076 46200002
         LOAD  EPLOC=CHRXL              LOAD VSAM CHECKPOINT   @Z30SSDT 46250003
         LR    RF,R0                    GET ENTRY POINT ADDRESS@Z30SSDT 46260003
         LA    R1,CHKWA                 LOAD PARAMETER REG 1   @Z30SSDT 46270003
         BALR  RE,RF                    CALL VSAM CHECKPOINT   @Z30SSDT 46280003
         DELETE EPLOC=CHRXL             DELETE VSAM CHECKPOINT @Z30SSDT 46282003
         LH    RF,CKRETCOD              GET THE RETURN CODE    @Z30SSDT 46284003
         LTR   RF,RF                    TEST FOR ANY ERRORS    @Z30SSDT 46290003
         BZ    CHRNEXT                  NONE, GO TO NEXT LOAD  @Z30SSDT 46292003
         MVC   CHRXL(LXCTLNAM),CHRXLST  ERROR, GO TO IGC0Q06C  @Z30SSDT 46294003
         B     CHRXIT                   GO TO XCTL ROUTINE     @Z30SSDT 46296003
CHRNEXT  MVC   CHRXL(LXCTLNAM),CHRXLIST GO TO NEXT LOAD        @Z30SSDT 46300003
CHRXIT   EQU   *                                                        46400017
         ICM   R0,ADDRBYTS,QMNGWALN     QMNGR PL/WA LNGTH        Y02076 46450002
         ICM   R0,HIORDER,SP253         SUBPOOL 253              Y02076 46500002
         L     R1,QMGRPRMA              GET ADR OF PL/WA         Y02076 46550002
         FREEMAIN  R,LV=(R0),A=(R1)     FREE QMNGR PL/WA         Y02076 46600002
         LR    R1,RC               PLACE ADDR OF W.A. IN PARM REG.      46800017
         LA    RF,CHRXL            SET PARAMETERS FOR XCTL.             47200017
         ST    RF,CHRAD                                                 47600018
         LA    RF,CHRAD                                                 48000018
         XCTL  SF=(E,(15))         TRANSFER CONTROL TO CHKDCB.          48400017
CHRMVC1  MVC   CHRCHKID(1),0(RF)   EXECUTED MOVE OF CHECKID TO BUFFER.  48800017
**********************************************************************  48880017
*                                                                     * 48960017
*        ERROR ROUTINE WHEN I/O ERROR OCCURS READING JCT - SET CODE   * 49040017
*        AND XCTL TO EXIT ROUTINE, IGC0Q06C                           * 49120017
*                                                                     * 49200017
**********************************************************************  49280017
CHRQERRW EQU   *                                                        49400017
         MVI   CKRETCD2,CKIOERR    PUT RETURN CODE IN WA                49450018
         MVI   CKMSGCD2,CKERIO7    PUT MESSAGE CODE IN WA               49500018
         OI    CKFLAG2,CKMSG1      INDICATES WTO MESSAGE=NOT TAKEN      49550017
CHRQCOM  EQU   *                                                        52800017
         MVC   CHRXL(LXCTLNAM),CHRXLST MOVE IGCOQ06C TO XCTL PARMLST    53200018
         B     CHRXIT              GO TO TRANSFER CONTROL TO CER        53600017
**********************************************************************  53660017
*                                                                     * 53720017
*        GENERATE SYSTEM CHECKID AND STORE IN CHKWA                   * 53780017
*                                                                     * 53840017
**********************************************************************  53900017
CHRGNID  EQU   *                                                        54000017
         CVD   RF,CHRDEC           CONVERT BINARY COUNT TO PACKED DEC.  54400017
         UNPK  CHRCON(LNCNVID),CHRCHAR4(LNG5)   CONVERT TO UNPACKED DEC 54800018
         MVZ   CHRCON10(1),CHRCONC9                                     55200018
         MVI   CHRCONC2,CHARC      INSERT C INTO 1ST BYTE OF CHECKID    55500018
         LA    RF,CHRCONC2                                              55800018
         MVC   CKCHEKID(LNGENID),CHRCONC2                               56000018
*                                  MOVE GENERATED CHECKID TO CHKWA      56200018
         LA    R1,LNGENID          SUPPLY LENGTH OF GENERATED CHECKID   56500018
         B     CHRSKP4             GO TO UPDATE FIELDS IN JCT           56700018
**********************************************************************  64060017
*                                                                     * 64120017
*        ROUTINE TO PAD BUFFER WITH 256 BYTES OF ONES.                * 64180017
*                                                                     * 64240017
**********************************************************************  64300017
CHRPADNG EQU   *                                                        64400017
         MVC   1(256,RF),0(RF)     PAD 256 BYTES OF BUFFER WITH ONES.   64800017
         AH    RF,=H'256'          UPDATE POINTER TO NEXT BYTE IN BUF.  65200017
         SH    R9,=H'256'          UPDATE NUMBER-OF-BYTES-LEFT-COUNTER. 65600017
         B     CHRBPAD             GO TO CHECK IF BUFFER ALL PADDED     66000018
CERMVC3  MVC   1(1,RF),0(RF)       EXECUTE MOVE.PROPAGATES ONES THROUGH 66400017
*                                  REST OF BUFFER.                      66800017
CHRXLST  DC    C'IGC0Q06C'         CHKPT EXIT RTN(ERROR OR CANCEL)      67100018
CHRXLIST DC    C'IGC0506C'         CHECK I/O(NORMAL FLOW)               67400018
CHRXAM0  DC    C'IDA0C06C'              VSAM CHKPT NORMAL FLOW @Z30SSDT 67450003
*        MASK  USED FOR CONVERTING CHECKID TO UNPACKED DEC            * 67700018
CHREDIT  DC    X'2120202020202020'                                      68000017
         DC    X'2020'                                                  68400017
USERAUTH EQU   X'10'                    USER AUTH FOR MODESET    Y02076 68450002
AUTHOFF  EQU   X'EF'                    MSK - TURN OFF AUTH BIT  Y02076 68460002
HIORDER  EQU   8         USED TO SHIFT TTR TO HIGH ORDER BYTES    MFTCR 68500018
SP253    DC    AL1(253)                 SUBPOOL NO. FOR GETMAIN  Y02076 68510002
ADDRBYTS EQU   7                        ADDR BITS FOR ICM INSTR  Y02076 68520002
CKVEQR   EQU   8                        V = R FLAG               Y02076 68550002
QMNGWALN DC    AL3(280)       256 BYTE QMNGRIO WA + 24(PARM LST) Y02076 68580002
LPL      EQU   24                       LNGTH OF QMNGRIO PRM LST Y02076 68590002
LNJCT    EQU   176                      LNGTH OF JCT IN SWA      Y02076 68594002
CHRID    DC    C'$$/%@/$ CHR %@/$//%'                                   68596003
*                                                                       68600018
*                                                                     * 73610000
*        MAINTENANCE SPACE                                            * 73612000
*                                                                     * 73614000
PATCH    DC    XL((*-IGC0206C)/20)'00'   FIVE PERCENT MAINTENANCE SPACE 73616000
         IEZDEB                                                  Y02076 73616102
         IEFQMIOP                                                Y02076 73616402
         IEFJESCT                                                Y02076 73616802
*                                                                     * 73618000
*                                                                     * 73620018
*        MAPPING OF ECB                                               * 73640018
*                                                                     * 73660018
ECBSECT  DSECT                                                          73680018
IOCMPFLG DS    1C        COMPLETION FLAG FOR I/O EVENT                  73700018
IORBPNT  DS    3C        RB ADDR WHILE WAITING FOR EVENT              * 73720018
*                                                                     * 73740018
*        MAPPING OF CHKPT PARAMETER LIST                              * 73760018
*                                                                     * 73780018
PARMSECT DSECT                                                          73800018
PARMFLG  DS    1C        BYTE INDICATING USER/SYSTEM/SYSTEM-RETURN CKID 73820018
PARMDCB  DS    3C        ADDR OF CHKPT DCB                              73840018
IDADDR   DS    0F                                                       73860018
LNCHKID  DS    CL1       LENGTH OF CHECKID OR INDICATES RETURN OF       73880018
*                        SYSTEM-GENERATED CHECKID                       73900018
         DS    CL3       CHECKID ADDR                                   73920018
*                                                                       73940018
*        MAPPING OF CHECKPOINT HEADER RECORD(CHR)                     * 73960018
*                                                                       73980018
CHRSECT  DSECT                                                          74000017
         DS    0D                                                       74400017
CHRCOUNT DS    H    NUMBER OF CHKPTS TAKEN                              74800017
CHRCKIDL DS    H    LENGTH OF CHECKID                                   75200017
CHRCHKID DS    4F   CHECKID                                             75600017
CHRDDNM  DS    2F   DDNAME OF CHECKPOINT DATA SET.                      76000017
CHRPPM   DS    CL4       LOW ORDER ADDR P/P CORE                        76200018
CHRPPE   DS    CL4       HIGH ORDER ADDRESS P/P CORE                    76400018
CHRBLKSI DS    CL2       CHKPT D.S.  BLKSIZE                            76600018
CHRTIOTL DS    CL2       LENGTH OF TIOT                                 76800018
CHRFLAGS DS    CL1       CHKPT FLAG 1                                   77000018
CHRWACL  DS    CL3       CHKPT W.A. LENGTH                              77200018
CHRCKWAD DS    0F                                                       77400018
CHRFLAG2 DS    CL1       CHKPT FLAG 2                                   77600018
CHRWAAD  DS    CL3       CHKPT W.A. ADDR                                77800018
CHRSVRB  DS    CL4       ADDR OF CHKPT SVRB                             78000018
CHRPPML  DS    CL4       LOW ORDER ADDR CHKPT SVRB                      78200018
CHRPPEL  DS    CL4       HIGH ORDER ADDR CHKPT SVRB                     78400018
CHRSYSID DS    CL1                 SYSTEM ID (CVTDCB)          @Z30JSSR 78500003
CHRIDENT DS    CL19                CHR RECORD IDENT            @Z30JSSR 78550003
CHRCKID2 EQU   CHRCHKID+1                                               78600018
CHRPADH  EQU   *    PADDING BEGINS HERE.                                80000017
         IEEVCHWA   CHRWA,VER=3                                         80400000
*                                                                     * 80410018
*        WORK AREA USED FOR CONVERTING CHECKID TO PRINTABLE CHARACTERS* 80420018
*                                                                     * 80430018
CHRDEC   DS    0D                                                       80440018
CHRCHAR1 DS    3C        AREA FOR CHECKID TO BE CONVERTED               80450018
CHRCHAR4 DS    1C                                                       80460018
CHRCHAR5 DS    4C                                                       80470018
CHRCON   DS    0H        AREA  FOR CONVERTED CHECKID                    80480018
CHRCONC1 DS    1C        EXTRA BYTE USED FOR CONVERSION                 80490018
         DS    1C                                                       80500018
CHRCONC2 DS    3H        GENERATED NUMBER                               80510018
CHRCONC9 DS    CL1                                                      80520018
CHRCON10 DS    CL2       ZONE BYTE MUST BE UPDATED IN CONVERTED ID      80530018
CHRXL    DS    2F      NAME OF MODULE TO TRANSFER CONTROL TO            80640017
CHRAD    DS    0F        POINTER TO XCTL PARMLST(ALSO,WORK SPACE)       80660018
         DS    1C                                                       80680018
CHRAD1   DS    3C                                                       80700018
QMGRPRMA EQU   CKERAS00                 STORE ADR OF PARM LIST   Y02076 80710002
*                                                                       80720018
*        JOB QUEUE WORK AREA                                          * 80740018
*                                                                       80760018
QJOB     DSECT                                                          80800017
SCALADCB DS    13F                                                      81200017
SCADEB   DS    12F                                                      81600017
SCATALLY DS    F                                                        82000017
SCASTRKS DS    H    TT OF FIRST TRACT IN Q.                             82400017
SCALTRKS DS    H    TT OF LAST TRACK IN Q.                              82800017
SCARECPT DS    CL1  NUMBER OF RECORDS PER PHYSICAL TRACK.               83200017
         IEFSD005                                                       83600017
         IEEBASEA                                                       84000017
         IEZJSCB                                                        84600020
TIOTSECT DSECT                                                          85200017
         IEFTIOT1                                                       85600017
CVTSECT  DSECT                                                          86000000
         CVT                                                            86050000
         IKJTCB                                                         86100000
         DCBD  DSORG=(BS,PO),DEVD=(DA,TA)                               86400017
NOTREL   EQU   X'42' INDICATES COMMAND CHAINING AND  NON-RELATED CP.    86800017
NOID     EQU   X'80'               SIGNIFIES LAST WORD IN PARM LIST.    87000017
DDL      EQU   8         LENGTH OF TIOEDDNM FIELD                       87600017
CHRPAD   EQU   X'FF'     PADDING FOR CHR                                88000017
PREL     EQU   4              LENGTH OF CHECKID LENGTH FIELD IN CHR.    88400017
CCWL     EQU   24   LENGTH OF CHANNEL PROGRAM TO READ OR WRITE TO JOB Q 88800017
EICL     EQU   68   LENGTH OF  ECB/IOB/CCW WORK AREA                    89200017
CHRL     EQU   24   LENGTH OF PARM LIST IN CHR.                         89600017
SUREAD   EQU   X'7F'     RETURN CODE FOR SUCCESSFUL I/O COMPLETION.     90000017
CKMSG1   EQU   32                  WTO MSG-NOT TAKEN-ENVIRONMENT ERROR  90030017
CKERIO7  EQU   X'19'    I/O ERROR WHILE READING IN JCT                  90060017
*                                                                       90070018
*        ADDRESSING BYTES WITHIN DSECTS                                 90080018
*                                                                       90090018
DXDASEEK EQU   DXDAADR+3           ADDR OF IOBSEEK FIELD         Y02076 90110002
CKTIOTLN EQU   CKTIOLN+2           ADDRESSING TIOT LNG IN CHKWA         90120018
DXCCW11  EQU   DXCCW1+1            1ST CCW                              90130018
DXCCW21  EQU   DXCCW2+1            2ND CCW                              90140018
CKTIOTL2 EQU   CKTIOLN+2           LENGTH OF TIOT IN CHKWA              90150018
CKWACL1  EQU   CKWACL+1            LENGTH OF CHKWA                      90160018
CKRETCD2 EQU   CKRETCOD+1          CHKPT RETURN CODE                    90170018
CKMSGCD2 EQU   CKMSGCOD+1     CHKPT MESSAGE CODE                        90180018
LXCTLNAM EQU   8         LENGTH OF MODULE NAME FOR XCTL PARMLST         90190018
LNADDR   EQU   3         LENGTH OF ADDRESS                              90200018
ADDONE   EQU   1         INCREMENT QUANTITY                             90210018
ADJR     EQU   8         USED TO ADJUST R OF TTR                        90220018
ADJTT    EQU   16        USED TO ADJUST TT OF TTR                       90230018
BLANK    EQU   C' '      BLANKS USED TO INITIALIZE CHECKID FIELD IN CHR 90240018
LNG15    EQU   15        MAXIMUM LENGTH OF CHECKID MINUS ONE            90250018
RETCKID  EQU   X'FF'     INDICATES USER REQ. RETURN OF GEN.CHECKID      90260018
LNCNVID  EQU   10             LENGTH OF CHECKID TO BE CONVERTED         90270018
LNGENID  EQU   8              LENGTH OF GENERATED CHECKID               90280018
LNJOBNAM EQU   8              JOB NAME LENGTH IN CSCB                   90290018
CHARC    EQU   C'C'      USED TO ALTER MODULE NAME TO IGC0206C          90300018
LNG5     EQU   5         LNG USED IN UNPACK INSTRUC FOR CHECKID         90310018
DEBVLSQ  EQU   X'25'                    TAPE DEB DISP           YA00142 90360002
*                                       TO VOL SEQ NO.          YA00142 90370002
LNG1     EQU   1                        LNGTH OF 1              YA00142 90380002
*                                                                       90390002
*        THE FOLLOWING EQUATES ARE FOR VSAM DATA SETS            Y02076 90392002
*                                                                       90394002
EXCPTEST EQU   42                  OFFSET TO DCB MACRF FIELD     Y02076 90396002
DSORGFLD EQU   27                  OFFSET TO ACB/AMB DSORG FLD   Y02076 90398002
ACBAMBID EQU   X'08'               MASK ACB/AMB DATA SET TEST    Y02076 90398402
EXCPID   EQU   X'80'               MASK FOR EXCP TEST ON MACRF   Y02076 90398802
OFFSET0  EQU   0                   OFFSET TO AMB AMBID FIELD     Y02076 90399202
AMBDSID  EQU   X'40'               MASK FOR AMB ID TEST          Y02076 90399602
VSAMACB  EQU   X'11'               MASK FOR ACB VSAM DS TEST     Y02076 90399702
ACBFLAG  EQU   43                  OFFSET TO ACB IND. FLAG FLD   Y02076 90399802
 END                                                                    90400017
./  ADD  SSI=80300256,NAME=IHJACP20
*                                                                       00050020
         COPY  LCGASMSW                                                 00159902
*                                                                       00250020
         TITLE 'IGC0A06C (IHJACP20) -PRESERVE 1 (CHR)'                  00300018
IGC0A06C CSECT                                                          00700017
*                                                                YM2776 00750001
*FUNCTION/OPERATION  THIS ROUTINE WRITES OUT THE CHECKPOINT HEADER      01400017
*                    RECORD (CHR)                                       02100017
*                                                                       02800017
*ENTRY POINTS  IGC0A06C                                                 03500017
*                                                                       04200017
*INPUT  ADDRESS OF THE CHECKPOINT WORK AREA IN REGISTER 1               04900017
*                                                                       05600017
*OUTPUT  ADDRESS OF THE CHECKPOINT WORK AREA IN REGISTER 1              06300017
*                                                                       07000017
*EXITS-NORMAL                                                           07700017
*         1.) XCTL TO IGC0D06C TO WRITE OUT DSDRS                       08400017
*         2.) XCTL TO IGC0206C IF EOV OCCURS FOR THE FIRST TIME WITH    09100017
*                       CHKPT DATA SET ON TAPE                          09800017
*                                                                       10500017
*     -ERROR XCTL TO I/O RESUME AFTER INITIALIZING CKMSGCOD AND         11200017
*             CKRETCOD AS FOLLOWS                                       11900017
*                 CKRETCOD    CKMSGCOD     ERROR CONDITION              12600017
*                 X'000C'      X'0317'       I/O ERROR CREATING CHKPT   13300017
*                                                        DATA SET       14000017
*                  X'0008'     X'031B'       EOV ON DA OR FOR A SECOND  14700017
*                                              TIME ON TAPE             15400017
*                                                                       16100017
*TABLES/WORK AREAS  CHKWA,TCB,DCB,DEB                                   16800017
*                                                                       17500017
*ATTRIBUTES  REENTRANT, SUPERVISOR STATE, TYPE 4 SVC ROUTINE            18200017
*                                                                       18900017
*RESTRICTIONS  MAY NOT BE USED IN OS/MFT                                19600017
*                                                                       20300017
* CHANGE ADDITIONS DELETIONS FOR VS2 037                                20350037
*A26660018-26794000                                            @ZA27702 20400037
*                                                                       20450037
*NOTES NONE                                                             21000017
         EJECT                                                          21700017
         USING CHKWA,RC                                                 22400017
         BALR  RB,0                BASE ADDR.                           23100018
         USING *,RB                                                     23800017
         B     BEGIN               BRANCH AROUND EYE CATCHER            23850000
         CNOP  0,8                 ALIGN TO A DOUBLE WORD BOUNDARY      23900000
         DC    C'IGC0A06C'         CSECT NAME                           23950000
BEGIN    EQU   *                                                        24000000
         LR    RC,R1               GET ADDRESS OF CHKPT WORK AREA       24500017
         LA    RD,CKREGSAV                                              25200017
         L     R2,CKDCBAD          GET DCB ADDRESS                      25900017
         USING IHADCB,R2                                                26600017
*                                                                     * 26650000
*********************************************************************** 26650400
*        TO PROVIDE SYSTEM INTEGRITY, THE CHECKPOINT DEB MUST BE      * 26652000
*        VERIFIED TO BE ON THE TCB DEB CHAIN, AND IN THE JOBSTEP      * 26654000
*        DEB TABLE.                                                   * 26656000
*********************************************************************** 26656400
*                                                                     * 26658000
         DEBCHK  (R2),TYPE=VERIFY,AM=SAM                                26658400
*                                                                     * 26660018
*                                                            @ZA27702   26720037
         TM    CKFLAG1,CKOPEN      CHECKPOINT OPEN DS ?      @ZA27702   26722037
         BO    BYPASS              YES BYPASS                @ZA27702   26724037
         TM    DCBCIND2,DCBCNCHS   CHAIN SCHEDULING IN USE ? @ZA27702   26726037
         BNO   BYPASS              NO BYPASS                 @ZA27702   26728037
         L     RF,DCBIOBAD         GET THE C. S. IOB         @ZA27702   26730037
         L     R1,8(RF)            GET OLDEST ICB            @ZA27702   26732037
         SR    R9,R9               ZERO REG 9                @ZA27702   26734037
         ICM   R9,1,3(RF)          GET NOP OFFSET            @ZA27702   26736037
         AR    R1,R9               SET UP ADDRESS OF NOP     @ZA27702   26738037
         ST    R1,12(RF)           SET UP NOP OFFSET IN IOB  @ZA27702   26740037
         OI    12(RF),X'80'        TURN ON HIGH ORDER BIT    @ZA27702   26742037
OTHER    EQU   *                                             @ZA27702   26744037
         CLI   0(R1),X'88'         TICNOP OPCODE ?           @ZA27702   26746037
         BE    NEXT                YES BRANCH TO TEST NEXT   @ZA27702   26748037
         CLI   0(R1),X'03'         NOP ( FOR TAPE )          @ZA27702   26750037
         BE    NEXT                YES BRANCH TO TEST NEXT   @ZA27702   26752037
         TM    CKFLAG1,CKTAPE      DATASET ON TAPE ???       @ZA27702   26754037
         BNO   DISK                NO MUST BE DA BRANCH      @ZA27702   26756037
         MVI   0(R1),X'03'         SET UP FOR NOP            @ZA27702   26758037
         B     NEXT                PROCESS NEXT ICB          @ZA27702   26760037
DISK     EQU   *                                             @ZA27702   26762037
         LA    R9,8(R1)            SET REG 9 TO NEXT CCW     @ZA27702   26764037
         ST    R9,0(R1)            SET UP NEXT CCW           @ZA27702   26766037
         MVI   0(R1),X'88'         SET UP TICNOP             @ZA27702   26768037
NEXT     EQU   *                                             @ZA27702   26770037
         TM    CKFLAG1,X'80'       SECOND PASS ?             @ZA27702   26772037
         BO    BYPASS              YES YOU ARE FINISHED      @ZA27702   26774037
         OI    CKFLAG1,X'80'       SET FLAG UP               @ZA27702   26776037
         L     R1,8(RF)            GET FIRST ICB AGAIN       @ZA27702   26778037
         L     R1,0(R1)            GET THE OTHER ICB         @ZA27702   26780037
         SR    R9,R9               ZERO REG 9 AGAIN          @ZA27702   26782037
         ICM   R9,1,3(RF)          GET NOP OFFSET            @ZA27702   26784037
         AR    R1,R9               SET UP TO POINT TO NOP    @ZA27702   26786037
         B     OTHER               PROCESS OTHER ICB         @ZA27702   26788037
BYPASS   EQU   *                                             @ZA27702   26790037
         NI    CKFLAG1,X'7F'       TURN OFF BIT              @ZA27702   26792037
*                                                            @ZA27702   26794037
*********************************************************************** 26822037
*        FOR DA - DEB ADDR IS SAVED AND USED FOR COMPARISON TO TEST   * 26840018
*          FOR EOV CONDITION BECAUSE EOV GETS A NEW DEB               * 26900018
*        FOR TAPE - VOLUME SEQUENCE NUMBER IN DEB IS SAVED AND USED   * 26960018
*          FOR TESTING AN EOV CONDITION BECAUSE EOV INCREMENTS VOL    * 27020018
*          SEQ NO                                                     * 27080018
*********************************************************************** 27140018
*                                                                     * 27200018
         L     RF,DCBDEBAD         GET DEB ADDRESS                      27300017
         TM    CKFLAG1,CKTAPE      IS CHKPT DATA SET ON TAPE            28000017
         BO    PRETAPE             BRANCH IF YES                        28700017
         MVC   CKTSTEOV(BYTE),DEBNMEXT(RF)   SAVE NUMBER OF EXTENTS FOR 29400018
*                                          END OF VOLUME TESTS          30100017
         B     PREBUFF             SKIP SAVING EOV INFO FOR TAPE        30800018
PRETAPE  EQU   *                                                        31500017
         USING DEBSECT,RF          MAPPING OF DEB                       31900018
         LA    RF,VOLSEQNO         GET ADDR OF VOLUME SEQ. NO. IN DEB   32300018
         ST    RF,CKTSTEOV         SAVE INFO FOR EOV TEST               32900017
         MVC   CKEOVCMR(LNWORD),ZERO(RF)                                33000018
*                                                                       33100018
*********************************************************************** 33200018
*                                                                     * 33300018
*        INITIALIZE CONTROL BLOCKS AND THEN WRITE CHR TO CHKPT D.S.   * 33400018
*                                                                     * 33500018
*********************************************************************** 33600018
*                                                                     * 33700018
PREBUFF  EQU   *                                                        34300017
         LR    R9,RC                                                    35000017
         A     R9,CKBFOFST         GET ADDRESS OF BUFFER                35700017
         ST    R9,PRENXB           INITIALIZE OUTPUT BUFFER HANDLER'S   37100017
         MVC   PRENOB(LNWORD),DSDRLN         PARAMETERS                 37800018
*                                                                YM6541 37805002
*        BEFORE WRITING THE CHR GET THE REGION END ADDRESS       YM6541 37810002
*        AND CALCULATE THE CURRENT SIZE OF REGION TO BE SAVED    YM6541 37815002
*                                                                YM6541 37820002
         USING CHRSECT,R9          ADDRESS CHR                   YM6541 37825002
         L     RF,CVTPTR           GET CVT ADDRESS               YM6541 37830002
         USING CVTMAP,RF           ADDRESS CVT                   YM6541 37835002
         L     RF,CVTTCBP          GET ADDR OF TCB/ASCB ADDR'S   YM6541 37840002
         L     RF,CURASOFS(,RF)    GET CURRENT ASCB ADDR         YM6541 37845002
         USING ASCB,RF             ADDRESS ASCB                  YM6541 37846002
         L     RF,ASCBLDA          GET LDA ADDR                  YM6541 37847002
         USING LDA,RF              ADDRESS LDA                   YM6541 37848002
         L     RF,CURRGNTP         GET CURRENT REGION END ADDR   YM6541 37849002
         DROP  RF                  LDA                           YM6541 37849202
         ST    RF,CKPPE            SAVE REGION END ADDR          YM6541 37849402
         S     RF,CKPPM            GET REGION SIZE               YM6541 37849602
         ST    RF,CHRPPE           PUT REGION SIZE IN CHR        YM6541 37849802
         DROP  R9                  CHR                           YM6541 37849902
         TM    CKFLAG1,CKVEQR      IS THIS V=R?                  YM2776 37850001
CKVEQR   EQU   8                        V=R BIT IN CKFLAG1      YA00258 37860002
         BNO   CKNOVEQR            NO, GO AROUND REAL PROCESSING YM2776 37900001
         LRA   R9,0(,R9)           GET REAL ADDRESS OF CHR       YM2776 37950001
CKNOVEQR EQU   *                                                 YM2776 38000001
         ST    R9,CKAREA1                                               38500017
         LA    RF,CHRLN                                                 39200017
         STH   RF,CKLNGTH1         INITIALIZE DECB1                     39900017
         LA    R9,PRESYNAD         MODIFY DCBSYNAD SO THAT PRESERVE     40600017
         ST    R9,PREAD            SYNAD WILL GET CONTROL IF I/O ERROR  41300017
         MVC   DCBSYN1(LNADDR),PREAD2            OCCURS                 42000018
         LA    R9,CKDECB1          GET DECB ADDRESS                     42700017
         WRITE (R9),SF,,,,,,MF=E   WRITE OUT CHR                        43400017
         CHECK (R9)                                                     44100017
         OI    CKFLAG2,CKCHR       SET FLAG - CHR WRITTEN               44800017
*                                                                     * 44808018
*********************************************************************** 44816018
*                                                                     * 44824018
*        TEST FOR SUCCESSFUL WRITE - I/O ERROR OR EOV CONDITION       * 44832018
*        IF ERROR OCCURS STORE ERROR CODES IN CHKWA AND XCTL TO       * 44840018
*        IGC0N06C - CHKPT D.S. NOT COMPLETED                          * 44848018
*                                                                     * 44856018
*********************************************************************** 44864018
*                                                                     * 44872018
         TM    CKFLAG1,CKTAPE      CHKPT DATA SET ON TAPE               44880017
         BO    PRETAEOV            BRANCH IF YES                        44960017
         L     RF,DCBDEBAD         GET DEB ADDRESS                      45040017
         CLC   CKTSTEOV(BYTE),DEBNMEXT(RF)   NUMBER OF EXTENTS CHANGED  45120018
         BNE   PREOVER             BRANCH IF YES--EOV ON D.A. ERROR     45200017
         B     PREIOCHK            BRANCH TO CHECK FOR I/O ERROR        45280017
PRETAEOV EQU   *                                                        45360017
         L     RF,CKTSTEOV                                              45500017
         CLC   ZERO(LNWORD,RF),CKEOVCMR      DID EOV OCCUR              46200018
         BNE   PREEOV              BRANCH IF YES                        46900017
PREIOCHK EQU   *                                                        47200017
         CLI   CKRETCD1,CKIOERR    DID I/O ERROR OCCUR                  47700018
         BE    PREERXIT            BRANCH IF YES                        48300017
         TM    CKFLAG1,CKBPAM      IS CHKPT DATA SET OPENED FOR BPAM    49000017
*                                                                     * 49070018
*********************************************************************** 49140018
*                                                                     * 49210018
*        IF CHKPT D.S BPAM - NOTE CHR SO THAT D.S CAN BE STOWED UNDER * 49280018
*        CHECKID IN CHKPT EXIT RTN                                    * 49350018
*                                                                     * 49420018
*********************************************************************** 49490018
*                                                                     * 49560018
         BZ    PREXIT              BRANCH IF NO--SKIP NOTE              49700017
         NOTE  (R2)                                                     50400017
         ST    R1,CKTTR            SAVE NOTED TTRZ                      51100017
*                                                                     * 51180018
*********************************************************************** 51260018
*                                                                     * 51340018
*        TRANSFER CONTROL TO NEXT MODULE                              * 51420018
*                                                                     * 51500018
*********************************************************************** 51580018
*                                                                     * 51660018
PREXIT   EQU   *                                                        51800017
         MVC   PRESV(LXCTLST),PREDSDR   TRANSFER CONTROL TO IGC0D06C    52500018
PREOUT   EQU   *                                                        53200017
         LR    R1,RC               PUT W. A. ADDRESS IN PARM REG        53900017
         LA    RF,PRESV            SET UP PARAMETER LIST FOR XCTL       54600017
         ST    RF,PRESV8                                                55300018
         LA    RF,PRESV8                                                56000018
         XCTL  SF=(E,(15))         TRANSFER CONTROL TO NEXT MODULE      56700017
*                                                                     * 56750018
*********************************************************************** 56800018
*        EOV ERROR RTN - IF CHKPT D.S. ON DISC, CHKPT NOT CONTINUED   * 56850018
*        AND CONTROL IS TRANSFERED TO IGC0N06C TO RESTORE I/O AND EXIT* 56900018
*        IF CHKPT D.S. ON TAPE, CONTROL IS TRANSFERED TO IGC0206C TO  * 56950018
*        ATTEMPT TO WRITE A COMPLETE ENTRY ON ONE VOLUME. IF EOV      * 57000018
*        OCCURS FOR A 2ND TIME ON TAPE(INDICATING ONE ENTRY CANNOT FIT* 57050018
*        ON ONE VOLUME) CHKPT IS NOT CONTINUED AND THE SAME PATH IS   * 57100018
*        FOLLOWED AS EOV ON DISC.                                     * 57150018
*                                                                     * 57200018
*********************************************************************** 57250018
*                                                                     * 57300018
PREEOV   EQU   *                                                        57400017
         TM    CKFLAG2,CKEOV       HAS EOV OCCURRED BEFORE              58100017
         BO    PREOVER             BRANCH YES - ERROR                   58800017
         OI    CKFLAG2,CKEOV       SET EOV FLAG                         60900017
         MVC   PRESV(LXCTLST),PREDSDR   SET UP XCTL PARM LIST           61600018
         MVI   PRESV4,CHAR2                                             62300018
         B     PREOUT              GO TO ISSUE XCTL                     63000018
PREOVER  EQU   *                                                        63700017
         MVI   CKRETCD1,CKPGMERR   INDICATE PROGRAMMER ERROR            64400018
         LA    RA,CKERIO7                                               65100017
         STH   RA,CKMSGCOD         PUT ERROR CODE IN WORK AREA          65800017
PREMVER  EQU   *                                                        66500017
         MVC   PRESV(LXCTLST),PREIORE   MOVE IORESUME'S NAME TO XCTLIST 66600018
*                                                                     * 66700018
*********************************************************************** 66800018
*                                                                     * 66900018
*        I/O ERROR AND SYNAD RTN. WHEN AN I/O ERROR OCCURS PRESERVE'S * 67000018
*        SYNAD RTN GETS CONTROL FROM DCB SYNAD EXIT AND CKRETCOD FIELD* 67100018
*        IN CHKWA IS SET TO INDICATE I/O ERROR CCCURED. CONTROL IS RE-* 67200018
*        TURNED FROM SYNAD RTN. AFTER WRITE IS CHECK'D CKRETCOD IS    * 67300018
*        TESTED FOR I/O ERROR,IN WHICH CASE CONTROL IS TRANSFERED TO  * 67400018
*        IGC0N06C TO RESTORE I/O AND EXIT                             * 67500018
*                                                                     * 67600018
*********************************************************************** 67700018
*                                                                     * 67800018
         B     PREOUT              GO TO XCTL                           67900017
PREERXIT EQU   *                                                        68600017
         LA    RA,CKERIO3          I/O ERROR WRITING CHKPT DATA SET     69300017
         STH   RA,CKMSGCOD         PUT IN WORK AREA                     70000017
         B     PREMVER             BRANCH TO SET UP FOR EXIT            70700017
PRESYNAD EQU   *                                                        71400017
         MVI   CKRETCD1,CKIOERR    MOVE RETURN CODE TO WORK AREA        72100018
         BR    RE        RETURN                                         72800018
CKERIO3  EQU   X'0317'             WRITE UNSUCCESSFUL                   73500017
CKERIO7  EQU   X'031B'             INVALID EOV                          74200017
DEBNMEXT EQU   16                                                       74500017
CHRLN    EQU   400       LENGTH OF CHR                                  74600018
LNWORD   EQU   4         WORD LENGTH                                    74700018
LNADDR   EQU   3         ADDRESS LENGTH                                 74800018
LXCTLST  EQU   8         LENGTH OF XCTL PARM LST                        74900018
BYTE     EQU   1         LENGTH OF BYTE (NO. EXTENTS IN DEB)            75000018
ZERO     EQU   0         USED FOR ADDRESSING                            75100018
CHAR2    EQU   C'2'      CHARACTER NEEDED TO ALTER MODULE NAME TO 206C  75200018
CURASOFS EQU   12                  OFFSET TO CURRENT ASCB        YM6541 75250002
DSDRLN   DC    F'400'              LENGTH OF DSDRS AND CHR              75600017
*        MODULE NAMES USED IN XCTL PARMLST                            * 75900018
PREDSDR  DC    C'IGC0D06C'         PRESERVE 2(NORMAL FLOW)              76400018
PREIORE  DC    C'IGC0N06C'         RESUME I/O (I/O ERROR)               77000018
CKCHR    EQU   128                                                      77700017
*                                                                     * 77750000
*        MAINTENANCE SPACE                                            * 77760000
*                                                                     * 77770000
PATCH    DC    XL((*-IGC0A06C)/20)'00'   FIVE PERCENT MAINTENANCE SPACE 77780000
         EJECT                                                          77780402
*                                                                       77782002
*        MAPPING OF CHECKPOINT HEADER RECORD(CHR)                     * 77784002
*                                                                       77786002
CHRSECT  DSECT                                                          77788002
         DS    0D                                                       77788402
CHRCOUNT DS    H    NUMBER OF CHKPTS TAKEN                              77788802
CHRCKIDL DS    H    LENGTH OF CHECKID                                   77789202
CHRCHKID DS    4F   CHECKID                                             77789602
CHRDDNM  DS    2F   DDNAME OF CHECKPOINT DATA SET.                      77789702
CHRPPM   DS    CL4       LOW ORDER ADDR P/P CORE                        77789802
CHRPPE   DS    CL4       HIGH ORDER ADDRESS P/P CORE                    77789902
CHRBLKSI DS    CL2       CHKPT D.S.  BLKSIZE                            77793202
CHRTIOTL DS    CL2       LENGTH OF TIOT                                 77795202
CHRFLAGS DS    CL1       CHKPT FLAG 1                                   77795602
CHRWACL  DS    CL3       CHKPT W.A. LENGTH                              77796002
CHRCKWAD DS    0F                                                       77796402
CHRFLAG2 DS    CL1       CHKPT FLAG 2                                   77796502
CHRWAAD  DS    CL3       CHKPT W.A. ADDR                                77796602
CHRSVRB  DS    CL4       ADDR OF CHKPT SVRB                             77822402
CHRPPML  DS    CL4       LOW ORDER ADDR CHKPT SVRB                      77832402
CHRPPEL  DS    CL4       HIGH ORDER ADDR CHKPT SVRB                     77842402
CHRCKID2 EQU   CHRCHKID+1                                               77844402
CHRPADH  EQU   *    PADDING BEGINS HERE.                                77846402
*                                                                     * 77848402
*        MAPPING OF DEB TO GET VOLUME SEQUENCE NO                       77874202
DEBSECT  DSECT                                                          77900018
INITIAL  DS    9F        INITIAL SECTION OF DEB                         78000018
VOLSEQNO DS    1F        VOLUME SEQUENCE NO  FOR TAPE                   78100018
         IEEVCHWA   VER=3                                               78400000
CKTSTEOV EQU   CKUNIT                                                   79100017
CKEOVCMR EQU   CKUNIT+4                                                 79800017
PRESV    DS    1F        XCTL PARM LIST - MODULE NAME                   82200018
PRESV4   DS    1C                                                       82500018
PRESV5   DS    CL3                                                      82800018
PRESV8   DS    1F        POINTER TO PARMLST                             83100018
PRENXB   DS    1F        ADDR OF BUFFER                                 83400018
PRENOB   DS    1F        LENGTH OF BUFFER                               83700018
*        OUTPUT BUFFER HANDLER'S PARAMETERS                             84000018
PREAD    DS    0F        WORK AREA FOR ADDRESSES                        84300018
         DS    1C                                                       84600018
PREAD2   DS    3C                                                       84900018
*        INFO FOR TEST OF EOV CONDITION                               * 85200018
PREADEOV DS    1F        ADDRESS OF TEST FOR EOV CONDITION              85500018
PRNEOV   DS    1F        VALUE USED IN TEST FOR EOV CONDITION           85800018
PRESAVE  DS    12F       SAVE AREA                                      86100018
PRELNGTH EQU   *                                                        87500017
         DCBD  DSORG=(BS,PO),DEVD=(DA,TA)                               88900017
*        ADDRESSING BYTES WITHIN WORD                                   89000018
DCBSYN1  EQU   DCBSYNAD+1     DCB SYNAD ADDRESS                         89100018
CKRETCD1 EQU   CKRETCOD+1     RETURN CODE FIELD IN CHKWA                89200018
         EJECT                                                          89250002
         CVT                                                            89300002
         EJECT                                                          89350002
         IHAASCB                                                        89400002
         EJECT                                                          89450002
         IHALDA                                                         89500002
         END                                                            89600017
./  ADD  SSI=80790143,NAME=IHJACP25
*                                                                       00010020
         COPY  LCGASMSW                                                 00020000
*                                                                       00050020
         TITLE 'IGC0D06C (IHJACP25) PRESERVE2 (DSDR)'                   00100018
*                                                                       00150037
*                                                                       00160037
*   VS2 030 ADDS/DELETES/CHANGES                                        00170037
* C241000                                                      @ZA04367 00180037
* A315800,315818-315890                                        @ZA09126 00185037
*                                                                       00190037
* A115594-115958,290080-290400,496200-497600,602100-603400     @ZA07204 00200037
* A119912                                                      @ZA07204 00210037
* C118560,119075,119083,119655-119695,241000,395000-395600     @ZA07204 00220037
* C463992,464799,                                              @ZA07204 00230037
* D119467,119471,119475,119476,119486,119487,119490,119498     @ZA07204 00240037
* D119698,119718,119865-119866,509000,509500                   @ZA07204 00250037
*                                                                       00260037
* A464900-464909                                               @ZA09977 00270037
* C464919                                                      @ZA09977 00280037
* C240500,A725740                                              @ZA20785 00310037
* C689000                                                      @ZA30810 00330037
*                                                                       00350037
IGC0D06C CSECT                                                          00400017
*********************************************************************** 00450002
*                                                                       00560002
*FUNCTION/OPERATION   THE MAIN PURPOSE OF THIS ROUTINE IS TO WRITE OUT  00600017
*                   DDNT AND DSDR RECORDS TO THE CHECKPOINT DATA SET.   00650002
*                   IF DDNT RECORDS EXIST IN THE SCHEDULER WORK AREA    00700002
*                   (SWA) THESE ARE READ IN AND WRITTEN OUT TO THE      00750002
*                   CHECKPOINT DATA SET.  NEW CANDIDATES (UNALLOCATED   00760002
*                   DATA SETS THAT WERE JCL SPECIFIED AT START OF STEP) 00770002
*                   ARE ADDED TO THE LAST NON-FULL DDNT RECORD READ IN  00780002
*                   OR TO NEWLY CONSTUCTED DDNTS.  FOR EACH DATA SET    00790002
*                   REPRESENTED BY A DATA SET ASSOCIATION BLOCK (DSAB)  00792002
*                   ON THE USER'S DSAB CHAIN, IGC0D06C WILL CONSTRUCT   00794002
*                   DATA SET DESCRIPTION RECORDS (DSDRS).FOR EACH DSAB, 00800002
*                   PRESERVE WILL CONSTRUCT AND WRITE OUT A TYPE 1      01000002
*                   DSDR. A TYPE 1 DSDR CONTAINS THE DATA SET'S JFCB,   01200002
*                   ITS DDNAME, THE UCBTYP FIELD FROM ITS UCB, PLUS     01400002
*                   SELECTED FIELDS FROM THE ASSOCIATED SIOT.  IF       01450002
*                   THERE IS A JFCB EXTENSION BLOCK (JFCBX) ASSOCIATED  01600017
*                   WITH THE DATA SET, PRESERVE WILL WRITE OUT A TYPE 2 01800017
*                   DSDR. A TYPE 2 DSDR CONTAINS JUST THE JFCBX. WHEN   02000017
*                   ALL THE JFCBS AND JFCBXS HAVE BEEN PROCESSED,       02200017
*                   PRESERVE WILL READ IN THE GDG NAME TABLE (IF        02400002
*                   THERE IS ONE) AND WILL CONSTRUCT AND WRITE OUT A    02600017
*                   TYPE 3 DSDR.A TYPE 3 DSDR CONTAINS JUST THE GDG     02800017
*                   NAME TABLE. WHEN ALL THE DDNTS AND DSDRS HAVE BEEN  03000002
*                   WRITTEN OUT, PRESERVE WILL XCTL TO CHKMAIN.         03200002
*                     TO READ RECORDS FROM SWA PRESERVE USES THE        03400002
*                   QMNGRIO MACRO.                                      03450002
*                     THE JFCBVLSQ FIELD OF THE JFCB IN DSDR WILL BE    04000017
*                   ADJUSTED AS FOLLOWS FOR DATA SETS OPENED FOR        04200017
*                   BSAM OR QSAM PROCESSING                             04400017
*                            READ BACKWARD - JFCBVLSQ=DEBVLSQ           04600017
*                            READ FORWARD - JFCBVLSQ=DEBVLSQ-1+JFCBVLSQ 04800017
*                                                                       04850002
*                   FOR DYNAMICALLY ALLOCATED DATA SETS THE SIOTS WILL  04880037
*                   BE WRITTEN OUT AFTER THE JFCBX IF THERE IS ONE      04910037
*                   WITH A CODE OF 000C FOR DSDR PROCESSING             04940037
*ENTRY POINTS: IGC0D06C                                                 05000002
*                                                                       05050002
*INPUT:  ADDRESS OF CHKPT WORK AREA IN REGISTER 1.                      05200017
*                                                                       05250002
*OUTPUT:  ADDRESS OF CHKPT WORK AREA IS IN REGISTER 1.                  05400017
*         DDNT AND DSDR RECORDS WRITTEN TO THE CHECKPOINT DATA SET.     05450002
*                                                                       05500002
*EXITS-NORMAL: THIS ROUTINE WILL XCTL TO CHKMAIN (IGC0F06C)             05600002
*                                                                       05650002
*EXITS-ERRORS:  IF A PERMANENT I/O ERROR OCCURED, THIS ROUTINE WILL PUT 05800017
*              THE ADDRESS OF THE CHKPT WORK AREA IN REGISTER 1 AND     06000017
*              XCTL TO IORESUME (IGC0N06C).                             06200002
*              THE RETURN CODE IN CHKWA IS SET TO X'OC' AND ONE OF THE  06400002
*              FOLLOWING MESSAGE CODES WILL BE PLACED IN CHKWA:         06600017
*              1.) X'0317'  I/O ERROR WHILE CREATING CHKPT DATA SET     06800017
*              2.) X'031B'  INVALID E0V                                 07000002
*              3.) X'0316'  ERROR READING CONTROL BLOCKS FROM SWA       07010002
*                                                                       07050002
*TABLES/WORK AREAS:  CHKWA DSECT,JCT,JFCB,JFCBX,TCB,UCB,SIOT,DSENQ      07200017
*                  TABLE, GDG NAME TABLE, DSAB, JSCB, QDB, SCT, TIOT,   07400002
*                  CVT, DEB, DCB                                        07450002
*                                                                       07500002
*ATTRIBUTES:  REENTRANT,SUPERVISOR STATE,TYPE 4 SVC ROUTINE.            07600017
*                                                                       07650002
*RESTRICTIONS ON USE OF ROUTINE:  MAY ONLY BE USED IN OS/VS2/2          07800002
*                                                                       07850002
*NOTES:  NONE                                                           08000017
*********************************************************************** 08050002
         EJECT                                                          08100002
         USING CHKWA,RC            ADDRSSS W.A.                         08200017
         BALR  RB,0                SET UP MODULE ADDRESSABILITY.        08400017
         USING *,RB                                                     08600017
         B     BEGIN               BRANCH AROUND EYE CATCHER            08650000
         CNOP  0,8                 ALIGN TO A DOUBLE WORD BOUNDARY      08700000
         DC    C'IGC0D06C'         CSECT NAME                           08750000
         DC    C'@ZA30810'         LAST CHANGE                 @ZA20785 08753037
         DC    C'&SYSDATE'         DATE OF LAST CHANGE         @ZA20785 08756037
BEGIN    EQU   *                                                        08760000
         LR    RC,R1               SET UP CHKPT W.A. ADDRESSABILITY.    08800017
*********************************************************************** 08820018
*                                                                     * 08840018
*        INITIALIZE CONTROL BLOCKS FOR WRITING DSDR'S                 * 08860018
*                                                                     * 08880018
*********************************************************************** 08900018
*                                                                     * 08920018
         USING IHADCB,R2      ADDRESS CHKPT DCB                         09400017
         LA    RD,CKREGSAV         INITIALIZE SAVE AREA REG.            09600017
         L     R2,CKDCBAD          GET DCB ADDR                         09800017
         LA    R9,PRESYNAD         MODIFY DCBSYNAD SO THAT              10800017
         ST    R9,PREAD            PRESERVE SYNAD ROUTINE WILL          11000017
         MVC   DCBSYND(LNADDR),PREAD3   GET CONTROL IF I/O ERROR OCCURS 11200018
         XC    CKERAS01(TYPL),CKERAS01  CLEAR SIOT READ IN ADR   Y02076 11250002
**********************************************************************  11450002
*                                                                    *  11500002
*  GET SPACE FOR QMNGRIO PARAMETER LIST AND WORK AREA (24+256) BYTES  * 11550002
*                                                                Y02076 11560002
**********************************************************************  11570002
         ICM   R0,ADDRBYTS,QMNGWALN     WA+PARM LST LNGH INR0    Y02076 11580002
         ICM   R0,HIORDER,SP253         SUBPOOL NO. IN R0        Y02076 11590002
         ST    R0,CKERAS00              SAVE FOR FREEMAIN        Y02076 11590402
         GETMAIN  R,LV=(0)              GET SPACE FOR PARM LST   Y02076 11592002
         ST    R1,CKQMPARM              SAVE PARM LIST ADDR INWA Y02076 11594002
         SR    R4,R4                    SWITCH- DDNTS IN SWA     Y02076 11594402
**************GET SPACE FOR READING IN SIOTS ******************@OZ07204 11594637
         SR    R0,R0                    ZERO REG 0             @OZ07204 11594837
         LA    R0,JFCL                  SET LENGTH TO 176      @OZ07204 11595037
         ICM   R0,HIORDER,SP253         SET SUBPOOL            @OZ07204 11595237
         ST    R0,CKERAS01              SAVE FOR FREEMAIN      @OZ07204 11595437
         GETMAIN R,LV=(0)              ISSUE GETMAIN           @OZ07204 11595637
         ST    R1,SIOTRDIN             SAVE ADDRESS OF AREA    @OZ07204 11595837
*********************************************************************** 11596002
*                                                                Y02076 11598002
*     INITIALIZE FOR WRITING THE DDNT RECORDS                    Y02076 11598402
*                                                                Y02076 11598802
*********************************************************************** 11599202
         USING TCB,R6                   ADDRESS TCB.                    11600002
         L     R6,CKTCBAD               GET ADDR OF TCB.                11800002
         L     R6,TCBJSCB               GET ADDR OF JSCB         Y02076 11802002
         DROP  R6                                                Y02076 11810002
         USING IEZJSCB,R6                                        Y02076 11850002
         SR    R0,R0                    CLEAR SCT READ           YM5777 11850402
         ST    R0,CKERAS04              SWITCH                   YM5777 11850802
         ICM   R0,M14,JSCSCTP           GET SVA OF SCT           YM5777 11852002
         B     SCTREAD                  GO READ SCT              YM5777 11852102
         USING INSMSCT,R5               ADDRESS SCT              Y02076 11854002
SCTTEST  MVC   CKERAS05,SCTFSIOT        SAVE SIOT CHAIN ANCHOR   YM7093 11854402
         ICM   R0,M14,SCTDDNT+K1        GET SVA ADDR OF DDNTS  @OZ06714 11856037
         DROP  R5                       SCT ADDRESSABILITY       Y02076 11856402
         LTR   R0,R0                    TEST IF ANY DDNTS IN SWA Y02076 11858002
         BNZ   DDNTREAD                 BR IF DDNTS ARE IN SWA   Y02076 11858402
DDNTNEWT EQU   *                        DO DDNT CANDIDATES EXIST Y02076 11858502
         TM    JSCBOPTS,JSCSIOTS        ARE NEW DDNTS TO BE ADDEDYM7093 11858802
         BO    DDNTNEW                  BRANCH IF YES            Y02076 11859202
         B     DSDRPROC                 IF NO - GO TO DSDR PROC  Y02076 11859602
*********************************************************************** 11859702
*   PREPARE TO READ DDNTS FROM SWA VIA QMNGRIO                   Y02076 11859802
*********************************************************************** 11859902
DDNTREAD EQU   *                        SET UP FOR READING DDNTS Y02076 11873202
         LA    R4,DDNTSWAS              SET SWITCH- DDNTS IN SWA Y02076 11875202
SCTREAD  IC    R0,PREZERO               0 INTO LO BYTE SVA ADDR  YM5777 11883202
         USING QMIOP,R1                                          Y02076 11885202
         L     R1,CKQMPARM              GET ADDR OF QMNGRIO PL   Y02076 11885602
         XC    QMITCBAD(LPL),QMITCBAD   CLEAR QMNGRIO PARM LIST  Y02076 11885702
         ST    R0,QMIDSKAD              ST SVA ADDR IN PARM LIST Y02076 11886002
         LA    R0,LPL                   GET OFFSET TO WORK AREA  Y02076 11886402
         AR    R0,R1                    CALC ADDR OF WORK AREA   Y02076 11886502
         ST    R0,QMIWRKAD              ST WRK AREA ADDR IN PL   Y02076 11886602
         LA    R0,INFMJFCB              READ IN AREA FOR DDNTS   Y02076 11891002
         ST    R0,QMIRECAD              READ IN ADDR TO PARM LST Y02076 11893002
         L     R0,CKTCBAD               GET ADDR OF TCB          Y02076 11893402
         ST    R0,QMITCBAD              STORE IN QMNGRIO P.LIST  Y02076 11893802
         LA    R0,LNDDNT                GET LENGTH OF DDNTS      Y02076 11894202
         STH   R0,QMIRECL               STORE IN PARM LIST       Y02076 11894602
         MVI   QMIFLAGS,QMIOREAD        SET READ FLAG            Y02076 11895002
         QMNGRIO                        READ IN DDNT FROM SWA    Y02076 11895402
         LTR   RF,RF                    TEST FOR ERRORS          Y02076 11897402
         BNZ   PREQERRX                 IF ERRORS BR TO SET CODE Y02076 11899402
         L     R0,CKERAS04              GET SCT READ SWITCH      YM5777 11899802
         LTR   R0,R0                    IS IT ZERO               YM5777 11900202
         BNZ   DDNTS                    NO-MUST BE DDNT          YM5777 11900602
         ST    RC,CKERAS04              SET SCT READ SWITCH      YM5777 11901002
         LA    R5,INFMJFCB              GET ADDR OF SCT          YM5777 11902602
         B     SCTTEST                  GO SEE IF DDNTS IN SWA   YM5777 11903002
         USING DDNTREC,R9                                        Y02076 11904302
DDNTS    LA    R9,INFMJFCB              PT TO DDNT JUST READ IN  YM5777 11905902
         SR    R0,R0                    ZERO REG 0             @ZA07204 11907537
         ICM   R0,M14,DDNTLINK+K1       GET ADDR OF NEXT DDNT  @ZA07204 11908337
         DROP  R9                                                Y02076 11909102
         LR    R3,R0                    SAVE SVA ADDR            Y02076 11910702
         LTR   R0,R0                    ANY MORE DDNTS IN SWA    Y02076 11912302
         BZ    DDNTNEWT                 NO MORE DDNTS IN SWA     Y02076 11913902
         LH    R9,CODDNT                SET DDNT CODE IN R9      Y02076 11915502
         BAL   RA,PREOBH                TO OUTPUT BUFFER HANDLER Y02076 11917102
         LR    R0,R3                    RESTORE SVA ADDR         Y02076 11918702
         B     DDNTREAD                 BR IF YES FOR NXT DDNT   Y02076 11920302
DDNTNEW  EQU   *                        PREP FOR NEW DDNT ENTRY  Y02076 11921902
*********************************************************************** 11923502
*        SEARCH THRU SIOT CHAIN TO GET DDNT ENTRIES              Y02076 11925102
*********************************************************************** 11926702
         DROP  R6                                                Y02076 11927102
         L     R6,CKERAS05              GET SIOT CHAIN ANCHOR    YM7093 11928702
*********************************************************************** 11944702
*        INITIALIZE FOR QMNGRIO PARAMETER LIST (PL)              Y02076 11949902
*********************************************************************** 11953602
         USING QMIOP,R1                                          Y02076 11955602
         L     R1,CKQMPARM              GET PARM LIST ADDR       Y02076 11956002
         XC    QMITCBAD(LPL),QMITCBAD   CLEAR QMNGRIO PARM LIST  Y02076 11956402
         LA    R0,LPL                   GET OFFSET TO WORK AREA  Y02076 11956802
         AR    R0,R1                    CALC ADDR OF WORK AREA   Y02076 11956902
         ST    R0,QMIWRKAD              STORE WRK AREA ADR IN PL Y02076 11957202
         L     R0,SIOTRDIN              GET READ IN ADDR         Y02076 11961402
         ST    R0,QMIRECAD              ST READ IN ADDR IN PL    Y02076 11961802
         L     R0,CKTCBAD               GET ADDR OF TCB          Y02076 11962202
         ST    R0,QMITCBAD              STORE IN QMNGRIO P.LIST  Y02076 11962602
         LA    R0,LNDDNT                GET LENGTH OF DDNTS      Y02076 11963002
         STH   R0,QMIRECL               STORE LENGTH IN P.LIST   Y02076 11963102
         MVI   QMIFLAGS,QMIOREAD        SET 'READ' FLAG          Y02076 11963402
         USING DDNTREC,R5                                        Y02076 11965402
         LA    R5,INFMJFCB              POINT TO LAST DDNT     @ZA07204 11965537
         LTR   R4,R4                    TEST-DDNTS READ FR SWA   Y02076 11967537
         BZ    DDNTNWA                  BRANCH IF NO             Y02076 11969537
DDNTNWAA EQU   *                        CHECK IF DDNT IS FULL    Y02076 11973802
         CLI   DDNTUSCT+K1,DDNTFULL     IS DDNT FULL             Y02076 11973902
         BL    DDNTNWD                  BRANCH IF NOT FULL       Y02076 11974002
         LH    R9,CODDNT                CODE FOR DDNT RECORDS    Y02076 11978302
         BAL   RA,PREOBH                GO TO BUFFER HANDLER     Y02076 11980302
*********************************************************************** 11982302
*        CLEAR DDNT SPACE AND INITIALIZE HEADER                  Y02076 11982702
*********************************************************************** 11984102
DDNTNWA  XC    INFMJFCB(JFCL),INFMJFCB  ZERO 176 BYTES FOR DDNT  Y02076 11986102
         LA    R3,K1                    GET 1 FOR ENTRY OFFSET   Y02076 11986902
         STH   R3,DDNTUSCT              1ST OFSET-DDNT ENTRIES   Y02076 11990202
         STH   R3,DDNTIDNT              SET DDNT CODE          @ZA07204 11991237
DDNTNWD  LR    R0,R6                    GET SVA ADDR OF SIOT     Y02076 11992202
DDNTNWB  EQU   *                        PROCESS SIOTS            Y02076 11992602
         IC    R0,PREZERO               SET LO ORDER BYTE 0      Y02076 11993002
         ST    R0,QMIDSKAD              ST SVA ADDR IN PL        Y02076 11993402
         QMNGRIO                        READ IN SIOT             Y02076 11994102
         LTR   RF,RF                    TEST FOR ERRORS          Y02076 11994202
         BNZ   PREQERRX                 IF ERROR BR TO SET CODE  Y02076 11994302
         USING INDMSIOT,R6                                       Y02076 11994502
         L     R6,SIOTRDIN              PT TO BEGIN OF SIOT      Y02076 11994902
         TM    SIOTBYT1,SIOTDDNT        IS IT A DDNT CANDIDATE   Y02076 11995302
         BZ    DDNTNWC                  BRANCH IF NOT            Y02076 11995402
         LH    R3,DDNTUSCT              GET DDNT 'NXT AVAIL SLOT Y02076 11995502
         SLL   R3,3                     MULTIPLY BY 8            Y02076 11995602
         LA    R9,DDNTREC               GET BEGIN ADDR OF DDNT   Y02076 11996702
         AR    R3,R9                    ADDR OF DDNAME IN DDNT   Y02076 11998702
         MVC   K0(K8,R3),SCTDDNAM       MOVE DDNAME INTO DDNT    Y02076 11998802
         LH    R3,DDNTUSCT              GET DDNT'NXT AVAIL SLOT' Y02076 12005202
         LA    R3,K1(R3)                INCREASE SLOT COUNT      Y02076 12007202
         STH   R3,DDNTUSCT              ST NEW 'NXT AVAIL SLOT'  Y02076 12009202
DDNTNWC  EQU   *                        TEST - END OF SIOT CHAIN Y02076 12011202
         L     R6,SCTPSIOT              GET ADDR OF NEXT SIOT    Y02076 12011302
         LTR   R6,R6                    IS THIS LAST SIOT        Y02076 12011402
         BZ    DDNTNWE                  BRANCH IF YES            Y02076 12011502
         B     DDNTNWAA                 GO TEST FOR FULL DDNT    Y02076 12021302
*********************************************************************** 12035202
*        END OF SIOT CHAIN                                       Y02076 12035602
*********************************************************************** 12036002
DDNTNWE  LH    R3,DDNTUSCT              TEST IF ANY DDNT ENTRIES Y02076 12036402
         LA    R4,DDNTSWAS              SET R4 FOR DDNTS ENTERED Y02076 12036802
         BCTR  R3,K0                    REDUCE ENTRY SLOT BY 1   Y02076 12036902
         LTR   R3,R3                    IS IT 0                  Y02076 12037002
         BZ    DSDRPRCA                 BRANCH IF NO ENTRIES     Y02076 12037102
DSDRPROC EQU   *                        BEGIN DSDR PROCESSING    Y02076 12037202
         LTR   R4,R4                    WERE ANY DDNTS IN SWA    Y02076 12039202
         BZ    DSDRPRCA                 BRANCH IF NO             Y02076 12039602
         LH    R9,CODDNT                LOAD DDNT CODE           Y02076 12040002
         BAL   RA,PREOBH                FLUSH OUT LAST DDNT      Y02076 12040402
*********************************************************************** 12040502
*        BEGIN PROCESSING OF DSDR RECORDS                        Y02076 12040602
*********************************************************************** 12040702
DSDRPRCA EQU   *                        INITIALIZE FOR SEQUENCE  Y02076 12040802
         DROP  R6                       THRU DSAB CHAIN          Y02076 12040902
         USING TCB,R6                                            Y02076 12041002
         L     R6,CKTCBAD               GET PTR TO TCB           Y02076 12041102
         L     R6,TCBJSCB               GET PTR TO JSCB          Y02076 12041902
         USING IEZJSCB,R6                                        Y02076 12042302
         L     R6,JSCDSABQ              GET POINTER TO QDB       Y02076 12043602
         DROP  R6                                                Y02076 12051002
         USING QDB,R6                                            Y02076 12060802
         L     R6,QDBFELMP              GET POINTER TO 1ST DSAB  Y02076 12070602
         DROP  R6                                                Y02076 12080402
         USING DSAB,R6                                           Y02076 12090202
PREAG2   L     R5,DSABTIOT              GET CORRESP DD ENTRY     Y02076 12100002
         USING TIOELNGH,R5                                       Y02076 12150002
*                                                                     * 12820018
*********************************************************************** 12840018
*        GET JFCB TTR FROM TIOT ENTRY - READ IN JFCB                  * 12860002
*        FOR SUBALLOCATE REQUEST A SIOT IS READ FROM JOB QUEUE, JFCB  * 12880018
*        TTR EXTRACTED FROM SIOT AND THEN JFCB READ INTO CORE         * 12900018
*                                                                     * 12920018
*********************************************************************** 12940018
*                                                                     * 12960018
PREAG3   L     R0,TIOEJFCB              GET JFCB TTR.                   13200002
         IC    R0,PREZERO               FILL IN CONCATENATION NO.       13400002
*********************************************************************** 13450002
*  INITIALIZE QMNGRIO PARAM LIST FOR READING JFCB FROM SWA       Y02076 13500002
*            THEN READ IN JFCB                                   Y02076 13550002
*********************************************************************** 13600002
         USING QMIOP,R1                                          Y02076 13650002
         L     R1,CKQMPARM              GET ADDR OF QMNGRIO PL   Y02076 13700002
         XC    QMITCBAD(LPL),QMITCBAD   CLEAR QMNGRIO PARM LIST  Y02076 13710002
         ST    R0,QMIDSKAD              ST JFCB SVA IN PARM LST  Y02076 13750002
         LA    R0,LPL                   GET OFFSET TO WORK AREA  Y02076 13800002
         AR    R0,R1                    CALC ADDR OF WORK AREA   Y02076 13850002
         ST    R0,QMIWRKAD              ST WA ADDR IN PARM LST   Y02076 13900002
         LA    R0,INFMJFCB              'READ IN' ADDR OF JFCB   Y02076 13950002
         ST    R0,QMIRECAD              STORE ADDR IN PARM LST   Y02076 14000002
         L     R0,CKTCBAD               GET ADDR OF TCB          Y02076 14010002
         ST    R0,QMITCBAD              STORE IN QMNGRIO P.LIST  Y02076 14020002
         LA    R0,LNJFCB                GET LENGTH OF JFCB       Y02076 14030002
         STH   R0,QMIRECL               STORE IN QMNGRIO P.LIST  Y02076 14040002
         MVI   QMIFLAGS,QMIOREAD        SET READ FLAG            Y02076 14050002
         QMNGRIO                        READ JFCB FROM SWA       Y02076 14100002
         LTR   RF,RF                    TEST FOR ERRORS          Y02076 14150002
         BNZ   PREQERRX                 IF ERROR BR TO SET CODE  Y02076 14200002
         DROP  R2                                                       14800017
         L     R9,CKTCBAD               GET TCB ADDRESS                 15000002
         USING TCB,R9                                                   15200000
         L     RF,TCBTIO                GET TIOT ADDRESS                15400002
         L     R9,TCBDEB                GET DEB QUEUE ADDRESS           15600002
         USING DEBBASIC,R9                                              15800000
*                                                                     * 15820018
*********************************************************************** 15840018
*                                                                     * 15860018
*        SEARCH THROUGH DEB CHAIN TO FIND ASSOCIATEDDCB WITH JFCB JUST* 15880018
*        READ         IN ORDER TO GET UCB ADDR FOR THE D.S.           * 15900018
*                                                                     * 15920018
*********************************************************************** 15940018
*                                                                     * 15960018
PRENXTDB EQU   *                                                        16000017
         LTR   R9,R9               IS THERE ANOTHER DEB                 16200017
         BZ    PREBK               BRANCH IF NO                         16400017
         L     RA,DEBDCBAD         GET ADDRESS OF DCB ASSOCIATED WITH   16600000
*                                  THIS DEB                             16800017
         USING IHADCB,RA                                                17000017
         LH    R0,DCBTIOT          GET INCREMENT TO TIOT DD ENTRY       17200017
         AR    R0,RF               GET ADDRESS OF TIOT DD ENTRY BY      17400017
*                                  ADDING DCB INCREMENT TO TIOT         17600017
*                                  ADDRESS                              17800017
         CR    R0,R5               IS THIS DEB ASSOCIATED WITH   Y02076 18000002
*                                  TIOT ENTRY CURRENTLY BEING PROCESSED 18200017
         BE    PREDCB              BRANCH IF YES                        18400017
         L     R9,DEBDEBAD         GET POINTER TO NEXT DEB              18600000
         LA    R9,K0(R9)           CLEAR HIGH ORDER BYTE-DEB PTR Y02076 18800002
         B     PRENXTDB            BRANCH TO TEST NEXT DEB              19000017
*                                                                     * 19020018
*********************************************************************** 19040018
*                                                                     * 19060018
*        IF DATA SET OPENED FOR QSAM OR BSAM SPECIAL PROCESSING ON    * 19080018
*        VOLUME SEQUENCE NO. FOLLOWS                                  * 19100018
*                                                                     * 19120018
*********************************************************************** 19140018
PREDCB   EQU   *                                                        19200017
         LR    RF,R9               GET DEB ADDRESS               YM7371 19400002
         LA    R7,DEBPRFLN         GET LENGTH OF PREFIX          YM7371 19450002
         SR    RF,R7               POINT TO DEB PREFIX           YM7371 19500002
         L     R7,DEBXTNP-DEBPREFX(,RF) PTR TO DEB EXTENSION     YM7371 19600002
         TM    DEBXDSO1-DEBXTN(R7),DCBDSGPS CHK IF SAM           YM7371 19650002
         BZ    PREBK               BRANCH IF NO                         19800017
         LA    R7,INFMJFCB              ADR JFCB READ-IN AREA    YM7022 19900002
         USING INFMJFCB,R7                                       YM7022 19950002
         CLI   DEBAMTYP-DEBPREFX(RF),ISAMDEB CHK IF ISAM         YM7371 20000002
         BNE   PREDCB03                 BR NOT ISAM             ZA00138 20050002
         LA    RF,K16(,RF)              BUMP PAST FUNKY ISAM EXT YM7371 20100002
PREDCB02 EQU   *                        GET UCB                  YM7371 20160002
         XC    PREVLHLD,PREVLHLD   CLEAR VOLSEQ HOLD AREA       Z30JSSR 20162003
         L     RF,DEBBASND-DEBPREFX(,RF) GET TO FIRST EXT UCB    YM7371 20170002
         LA    RF,K0(,RF)               CLEAR HI-ORDER BYTE      YM7371 20190002
         LTR   RF,RF                    CHK IF DUMMY             YM7371 20192002
         BZ    PREBK                    BR IF DUMMY              YM7371 20194002
         USING UCBSECT,RF                                               20200017
         TM    UCBTBYT3,NOTTAPDA        IS THIS TAPE OR DA       YM7371 21200002
         BNZ   PREBK                    BR IF NOT TAPE OR DA     YM7371 21600002
         CLI   UCBTBYT3,PRETAPE         CH IF TAPE               YM7371 21800002
         BNE   PREDA                    BR IF D.A.               YM7371 22000002
         MVC   JFCBFSEQ(1),SRTEFSCT+1  SAV PHYS FILE SEQ NO.    OX01653 22002002
         DROP  RF                                                YM7371 22004002
         CLC   DEBDCBB(LNADDR),CKDCB1    IS THIS CHKPT D.S. DEB         22010000
         BNE   PRETAVOL            BRANCH IF NOT                        22020017
*    DETERMINE THE SEQUENCE NO. OF THE VOLUME WITH THE          YA00142 22080002
*    REQUIRED CHECKPOINT RECORDS AND SAVE IT IN FIELD           YA00142 22090002
*    'JCTVOLSQ' FOR IEFDSDRP                                    YA00142 22100002
         MVC   JCTVOLSQ,VLSQ(R9)        SET REAL VOL SEQ         YM7371 22110002
         MVC   PREVLHLD,VLSQ+1(R9) MOVE VOLSEQ TO HOLD AREA     Z30JSSR 22160003
         B     PREBK                    GO PREPARE TO WRITE BFR  YM7371 22188402
PREDCB03 TM    DEBEXSCL-DEBPREFX(RF),X'FF'  USEABLE UCB         ZA00138 22198402
         BZ    PREBK                    BRANCH IF NO            ZA00138 22208402
         B     PREDCB02                 GO PROCESS UCB          ZA00138 22210402
PRETAVOL EQU   *                                                        22214202
         LA    RA,DEBDEBAD              INCR FOR VOLUME SEQ NO.  YM7371 22240002
         B     PREVOLSQ                                                 22400017
PREDA    EQU   *                                                        22600017
         SR    RA,RA                    CLEAR REGISTER A                22800002
         IC    RA,DEBNMEXT              GET NUMBER OF EXTENTS           23000002
         SLL   RA,EQUX16                MULTIPLY BY 16                  23200002
         AR    RA,R9                    INCR FOR VOLUME SEQ NUMBER      23400002
PREVOLSQ EQU   *                                                        23600017
         LH    RF,JFCBVLSQ              GET VOL SEQ SPEC ON JCL  YM7371 23800002
         LTR   RF,RF                    CHK IF SPECIFIED         YM7371 23850002
         BNZ   PRE00020                 BR IF VOLSQ SPECIFIED    YM7371 23900002
         LA    RF,K1                    SET VOLSQ TO FIRST VOL   YM7371 23950002
PRE00020 EQU   *                        CHK FOR DEFERED MOUNT    YM7371 24000002
         MVC   PREVLHLD,INCVLSQN+DEBVSQ(RA) SAVE VOLSEQ NUM     Z30JSSR 24010003
         CLM   RF,M1,INCVLSQN+1(RA)     CHK IF NOT FIRST VOL   @ZA20785 24050037
         BE    PREBK                    BR IF FIRST VOL         ZA04637 24100037
         OI    JFCBMASK+K6,DEFMOUNT     SET BIT TO CAUSE DSDR TO  M2192 26200002
*                                       MARK SIOT FOR DATA SET FOR      26400002
*                                       DEFERRED MOUNT AT RESTART       26600002
         USING IHADCB,R2                                                27000017
         DROP  R9,RA,R7                                          YM7371 27200002
PREBK    EQU   *                                                        27400017
         XR    R9,R9               LOAD RECORD CODE.                    27600017
         MVC   PREAD(LNADDR),JFCBEXAD   GET JFCBX SVA ADDR       Y02076 27650002
         BAL   RA,PREOBH           GO TO OUTPUT BUFFER HANDLER.         27800017
         L     R0,PREAD                                                 28200017
         IC    R0,PREZERO          SET CONCATENATION NUMBER TO ZERO.    28400017
         LTR   R0,R0               IS THERE A JFCBX                     28600017
         BNZ   PREJFCBX            GO TO READ IN JFCBX.                 28800017
PRENXTI  EQU   *                                                        29000017
         TM    DSABFLG1,DSABDALC   IS IT DYNAMICALLY ALLOCATED @OZ07204 29008037
         BZ    PRESSON             NO SO GO ON                 @OZ07204 29016037
         LH    R9,COSIOT           LOAD SIOT CODE              @OZ07204 29024037
         BAL   RA,PREOBH           LINK TO OUTPUT BUFFER       @OZ07204 29032037
PRESSON  EQU   *                                               @OZ07204 29040037
         L     R6,DSABFCHN              GET NEXT DSAB ON CHAIN   Y02076 29050002
         LTR   R6,R6                    IS THIS LAST DSAB        Y02076 29100002
         BNZ   PREAG2                   BRANCH TO PROCESS NEXT   Y02076 29150002
         L     R0,JCTGDGNT         GET SVA OF GDG NAME TABLE     Y02076 30200002
PRENXGDG EQU   *                                                        30400017
         IC    R0,PREZERO               CLEAR LO BYTE SVA ADDR   Y02076 30450002
         LTR   R0,R0               IS THERE A GDG.                      30600017
         BZ    PRESKP3             NO-SKIP GDG PROCESSING               30800017
*********************************************************************** 31450002
*    SET UP FOR READING GDG NAME TABLE VIA QMNGRIO               Y02076 31500002
*********************************************************************** 31550002
         USING QMIOP,R1                                          Y02076 31560002
         L     R1,CKQMPARM              GET ADDR QMNGRIO PRM LST Y02076 31570002
         XC    QMITCBAD(LPL),QMITCBAD   CLEAR QMNGRIO PARMLIST @ZA09126 31580037
         ST    R0,QMIDSKAD              ST SVA ADDR OF GDG NAMTB Y02076 31580937
         LA    R0,LPL                   GET OFFSET TO WORKAREA @ZA09126 31581837
         AR    R0,R1                    CALC ADDR OF WORK AREA @ZA09126 31582737
         ST    R0,QMIWRKAD              ST WA ADDR IN PARMLIST @ZA09126 31583637
         LA    R0,INFMJFCB              GET READIN AREA ADDR   @ZA09126 31584537
         ST    R0,QMIRECAD              ST READIN ADR IN PLIST @ZA09126 31585437
         L     R0,CKTCBAD               GET ADDR OF TCB        @ZA09126 31586337
         ST    R0,QMITCBAD              ST TCB ADDR IN PLIST   @ZA09126 31587237
         LA    R0,LNJFCB                GET A LENGTH VALUE     @ZA09126 31588137
         STH   R0,QMIRECL               ST LENGTH IN PLIST     @ZA09126 31589037
         MVI   QMIFLAGS,QMIOREAD        SET 'READ' FLAG          Y02076 31590002
         QMNGRIO                        READ IN GDG NAME TABLE   Y02076 31592002
         LTR   RF,RF                    TEST FOR ERRORS          Y02076 31592402
         BNZ   PREQERRX                 IF ERROR BR TO SET CODE  Y02076 31592802
         LA    R9,COGDG                 LOAD GDG NAME TBL CODE          31594002
         BAL   RA,PREOBH           GO TO OUTPUT BUFFER HANDLER.         31600017
         USING GDGNT,R1                                          Y02076 31650002
         LA    R1,INFMJFCB              ADDR OF LAST GDGNT READ  Y02076 31700002
         L     R0,GNTNEXTP         GET SVA OF NEXT GDG TABLE            31800002
         IC    R0,PREZERO          FILL IN CONCATENATION NUMBER.        32000017
         B     PRENXGDG            GO TO PROCESS NEXT GDG TABLE.        32200017
PRESKP3  EQU   *                                                        32400017
PREXIT   EQU   *                                                        32600017
         LA    R9,DSDREND          LOAD END-OF-DSDRS CODE.              32800017
         BAL   RA,PREOBH           GO TO WRITE OUT LAST DSDR.           33000017
         MVC   PRESV(LNMODNAM),PREXMN   MOVE CHKMAIN MOD NAME TO XCTLST 33200018
PREOUT   EQU   *                                                        33400017
         L     R0,CKERAS00              LOAD GETMAIN PARM REG    Y02076 33450002
         L     R1,CKQMPARM              GET ADDR QMNGR PARM LIST Y02076 33500002
         FREEMAIN  R,LV=(R0),A=(R1)     FREE UP THE PARM LST     Y02076 33550002
         L     R0,CKERAS01              LOAD GETMAIN PARM REG    Y02076 33560002
         LTR   R0,R0                    WERE SIOTS READ IN       Y02076 33562002
         BZ    PREOUTB                  BR OVER FREEMAIN IF NO   Y02076 33564002
         L     R1,SIOTRDIN              ADR OF SIOT READ-IN AREA Y02076 33570002
         FREEMAIN  R,LV=(R0),A=(R1)     FREE UP SIOT AREA        Y02076 33580002
PREOUTB  LR    R1,RC               PUT ADDR OF W.A. IN PARM REG.        33600002
         LR    R6,RC                    STORE WA ADDR IN R6      Y02076 33650002
         LA    RF,PRESV            SET UP PARAMETER LIST FOR XCTL.      33800017
         ST    RF,PRELSTAD                                              33900018
         LA    RF,PRELSTAD                                              34000018
         XCTL  SF=(E,(15))         TRANSFER CONTROL TO NEXT MODULE.     34400017
PREOBH   EQU   *                                                        38600017
         STM   R2,RC,PRESAVE                                            38800017
         L     R2,PRENXB           LOAD ADDR OF NEXT BYTE IN BUFFER     39000017
         L     R8,PRENOB           LOAD NUMBER OF BYTES LEFT IN BUFFER. 39200017
         STH   R9,0(R2)            MOVE CODE TO BUFFER.                 39400017
         CH    R9,CODDNT                TEST FOR A DDNT RECORD   Y02076 39450002
         BE    DDNT                     GO MOVE DDNT TO BUFFER @OZ07204 39500037
         CH    R9,COSIOT           SIOT PROCESSING ?           @OZ07204 39530037
         BE    SIOTWR              YUP GO WRITE SIOT           @OZ07204 39560037
         B     *+4(R9)             BRANCH TABLE ON RECORD CODE          39600018
         B     PREOJF              GO TO MOVE JFCB AND UCB INFO TO BUF. 39800017
         B     PREJFX              GO TO WRITE OUT JFCBX.               40000017
         B     PREJFX              GO TO WRITE OUT GDG BIAS COUNT TABLE 40200017
         B     PREJFX              GO TO WRITE OUT DSENQ TABLE.         40400017
PRECOM3  EQU   *                                                        40600017
         LA    R1,CKDECB1          GET DECB ADDR.                       40800017
         WRITE (R1),SF,,,,,,MF=E   WRITE OUT A DSDR.                    41000017
         LA    R1,CKDECB1                                               41200017
         CHECK (R1)                                                     41400017
         TM    CKFLAG1,CKTAPE      CHKPT DATA SET ON TAPE               41410017
         BO    PRETAEOV            BRANCH IF YES                        41420017
         L     RF,CKDCBAD          GET DCB ADDRESS FOR CHKPT DATA SET   41430017
         DROP  R2                                                       41440017
         USING IHADCB,RF                                                41450017
         L     RF,DCBDEBAD         GET DEB ADDRESS                      41460017
         USING DEBBASIC,RF                                              41470000
         USING IHADCB,R2                                                41480017
         CLC   CKTSTEOV(ONE),DEBNMEXT    HAS THE NUMBER OF EXTENTS      41490000
*                                        CHANGED                        41500000
         BNE   PREOVER             BRANCH IF YES-EOV ON D.A. ERROR      41510017
         B     PREIOCHK            CHECK FOR I/O ERROR                  41520017
PRETAEOV EQU   *                                                        41530017
         L     RF,CKTSTEOV         GET POINTER TO EOV INFO              41600017
         CLC   ZERO(LNWORD,RF),CKEOVCMR      DID END OF VOLUME OCCUR    41800018
         BNE   PREOV               YES                                  42000017
PREIOCHK EQU   *                                                        42100017
         TM    CKRETCD1,CKIOERR    WAS THERE AN I/O ERROR               42200018
         BO    PREQERRW             YES-GO TO I/O ERROR EXIT ROUTINE.   42400017
         STH   R9,CODE(R2)         MOVE RECORD CODE TO BUFFER           42600018
         BR    RA                  RETURN                               42800018
PREOJF   EQU   *                                                        43000017
         CH    R8,PREUPR           IS THERE ROOM FOR ANOTHER RECORD     43200017
         BH    PREMVJ              YES-DO NOT WRITE BUFFER YET          43400017
         BAL   RA,PREWR            NO-GO TO WRITE OUT BUFFER            43600017
PREMVJ   EQU   *                                                        43800017
         MVC   CDL(JFCL,R2),INFMJFCB  MOVE JFCB TO BUFFER               44000017
         MVC   VLSQP(VLSQL,R2),PREVLHLD MOVE VOLSEQ TO BUF      Z30JSSR 44050003
         L     RF,TIOTUCB          GET ADDR OF UCB                      44300018
         LA    RF,ZERO(RF)         CLEAR HIGH ORDER BYTE                44370018
         LTR   RF,RF               IS THIS A DUMMY DATA SET             44440017
         BNZ   PRENODMY            BRANCH IF NOT                        44460018
         XC    UCBP(TYPL,R2),UCBP(R2)      ZERO DEVTYP BYTES IN DSDR    44480017
         B     PREUPDAT            GO TO UPDATE BUFFER POINTERS         44500018
PRENODMY EQU   *                                                        44520017
         USING UCBSECT,RF                                               44610018
         MVC   UCBP(TYPL,R2),UCBTYP MOVE UCB INFO INTO DSDR.            46200017
PREUPDAT EQU   *                                                        46300017
*********************************************************************** 46350002
*  INITIALIZE FOR READING IN SIOT FROM SWA THEN READ IT IN       Y02076 46360002
*********************************************************************** 46370002
         L     R0,DSABRS01              GET SVA PTR FROM DSAB    Y02076 46380002
         SLL   R0,HIORDER               SHFT SWA ADDR LEFT 8BITS Y02076 46390002
         USING QMIOP,R1                                          Y02076 46392002
         L     R1,CKQMPARM              GET ADDR OF QMNGRIO PL   Y02076 46394002
         XC    QMITCBAD(LPL),QMITCBAD   CLEAR QMNGRIO PARM LIST  Y02076 46394402
         ST    R0,QMIDSKAD              ST SVA SIOT ADDR IN PL   Y02076 46396002
         LA    R0,LPL                   GET OFFSET TO WORK AREA  Y02076 46398002
         AR    R0,R1                    CALC ADDR OF WORK AREA   Y02076 46398402
         ST    R0,QMIWRKAD              ST WA ADDR IN P.L.       Y02076 46398802
         L     R0,SIOTRDIN              ADDR OF SIOT 'READ IN' @OZ07204 46399237
         ST    R0,QMIRECAD              ST READ IN ADDR IN P.L.  Y02076 46399602
         L     R0,CKTCBAD               GET ADDR OF TCB          Y02076 46399702
         ST    R0,QMITCBAD              STORE TCB ADR IN P.LIST  Y02076 46409702
         LA    R0,LNJFCB                GET LENGTH OF SIOTS      Y02076 46419702
         STH   R0,QMIRECL               STORE IN QMNGRIO P.LIST  Y02076 46419802
         MVI   QMIFLAGS,QMIOREAD        SET FLAGS FOR READ       Y02076 46419902
         QMNGRIO                        READ SIOT FROM SWA       Y02076 46429902
         LTR   RF,RF                    TEST FOR ERRORS          Y02076 46431902
         BNZ   PREQERRX                 IF ERROR BR TO SET CODE  Y02076 46433902
*********************************************************************** 46439902
*  PROCESS SIOT FIELDS FOR DSDR ENTRIES                          Y02076 46449902
*********************************************************************** 46459902
         USING INDMSIOT,R5                                       Y02076 46469902
         L     R5,SIOTRDIN              LOAD BASE REG FOR SIOT @OZ07204 46479937
         NI    CKFLAG2,TURNOFS          TURN OFF SIOT 'WRITE'    Y02076 46489902
         TM    SIOTBYT1,SIODUNAL        D/S DYNAMIC UNALLOC    @ZA09977 46491937
         BO    PREUPA                   BR IF YES              @ZA09977 46492037
         TM    SCTSBYT3,SCTALCHK        SIOT ALLOCATED         @ZA09977 46492137
         BO    PREUPC                   BR IF YES              @ZA09977 46492237
         OI    SCTSBYT3,SCTALCHK        SET SIOT ALLOC'D BIT   @ZA09977 46492337
         B     PREUPB                                          @ZA09977 46492437
PREUPA   TM    SCTSBYT3,SCTALCHK        WAS SIOT ALLOCATED     @ZA09977 46492537
         BZ    PREUPC                   BR IF NO               @ZA09977 46492637
         NI    SCTSBYT3,255-SCTALCHK    TURN OFF SIOT ALLOC'D  @ZA09977 46492737
PREUPB   OI    CKFLAG2,UPDSIOT          TURN ON SIOT 'WRITE'   @ZA09977 46492837
PREUPC   LH    R3,DSABOPCT              GET D/S OPEN AT CHKPT  @ZA09977 46492937
         LTR   R3,R3                    WAS IT OPEN AT CHKPT     Y02076 46493902
         BNZ   PREUP1                   BRANCH IF OPEN           Y02076 46495902
         TM    SIOTBYT1,SIOTOCKP        IS OPEN IND=0 IN SIOT    Y02076 46497902
         BZ    PREUP2                   BRANCH IS YES            Y02076 46498302
         NI    SIOTBYT1,TURNOFO         TURN OFF OPEN BIT        Y02076 46498702
         OI    CKFLAG2,UPDSIOT          SET FLAG TO WRITE SIOT   Y02076 46499102
         B     PREUP2                                            Y02076 46499502
PREUP1   OI    SIOTBYT1,SIOTOCKP        SET D/S OPEN AT CHKPT    Y02076 46499602
         OI    CKFLAG2,UPDSIOT          SET FLAG TO WRITE SIOT   Y02076 46499702
PREUP2   MVC   DDNMP(DDL,R2),SCTDDNAM   MVE DDNAME FROM SIOT     Y02076 46499802
         MVC   SIOTFP(K1,R2),SCTSDISP   MVE SCTSDISP TO DSDR     Y02076 46533202
         LA    R2,K1(R2)                INCREASE PTR BY 1        Y02076 46543202
         MVC   SIOTFP(K1,R2),SCTSBYT3   MVR SCTSBYT3 TO DSDR     Y02076 46553202
         LA    R2,K1(R2)                INCREASE BUFR PTR BY 1   Y02076 46563202
         MVC   SIOTFP(K1,R2),SIOTALTD   MVE SIOTALTD FIELD       Y02076 46565202
         LA    R2,K1(R2)                INCREASE BUFR PTR BY 1   Y02076 46565602
         XC    SIOTFP(K1,R2),SIOTFP(R2) CLEAR FLAG BYTE          Y02076 46565702
         TM    SIOTBYT1,SIOTOCKP        DATA SET OPEN AT CHKPT   Y02076 46566002
         BZ    PREUP3                   BRANCH IF NOT            Y02076 46566402
         OI    SIOTFP(R2),DSDROCKP      SET DSDRFLAG W DSOPEN    Y02076 46566502
PREUP3   TM    DSABFLG1,DSABDALC        TEST DYNAMIC ALLO        Y02076 46577602
         BZ    PREUP4                   BRANCH IF NOT            Y02076 46587602
         OI    SIOTFP(R2),DSDRDALC      SET DSDRFLAG             Y02076 46588002
PREUP4   TM    DSABFLG1,DSABCATM        TEST DYNAMIC CONCAT.     Y02076 46588402
         BZ    PREUP5                   BRANCH IF NOT            Y02076 46588802
         L     RF,DSABTIOT              POINT TO TIOT ENTRY      YM7323 46590802
         USING TIOENTRY,RF              ADDRESS DD ENTRY IN TIOT YM7323 46591202
         CLI   TIOEDDNM,BLANK           IS THIS DDNAME BLANK?    YM7323 46591602
         BNE   PREUP5                   BRANCH IF NOT BLANK      YM7323 46592002
         DROP  RF                                                YM7323 46592402
         OI    SIOTFP(R2),DSDRCCAT      SET DYN CONCAT FLG       Y02076 46592502
PREUP5   LA    R2,K1(R2)                INCREASE BUFR PTR BY 1   Y02076 46594502
         TM    CKFLAG2,UPDSIOT          WAS SIOT UPDATED         Y02076 46594902
         BZ    PREUP6                   BRANCH IF NO             Y02076 46595302
         MVI   QMIFLAGS,QMIOWRTE        SET FUNCTION TO WRITE    Y02076 46595702
         QMNGRIO                        WRITE SIOT TO SWA        Y02076 46596102
         LTR   RF,RF                    TEST FOR ERRORS          Y02076 46636802
         BNZ   PREQERRX                 IF ERROR BR TO SET CODE  Y02076 46646802
PREUP6   EQU   *                        INIT. FOR NEXT WRITE     Y02076 46677902
         LA    R2,PREUPJ(R2)       UPDATE BUFFER POINTER.               46718602
         SH    R8,=H'195'          UPD.NO. OF BYTES LEFT IN BUF.Z30JSSR 46759303
PRECOM2  ST    R2,PRENXB           SAVE BUFFER POINTER.                 46800017
         ST    R8,PRENOB           SAVE NUMBER OF BYTES LEFT IN BUF.    47000017
PRERET   EQU   *                                                        47200017
         LM    R2,RC,PRESAVE                                            47400017
         BR    RA                  RETURN TO CALLER.                    47600017
PREWR    EQU   *                                                        47800017
         LA    RF,BLKEND           MOVE END OF BLOCK CODE TO BUFFER.    48000017
         STH   RF,CODE(R2)         PUT END OF BLOCK CODE IN BUFFER      48200018
         LR    R2,RC               COMPUTE                              48400017
         A     R2,CKBFOFST         BUFFER ADDRESS                       48600017
         ST    R2,PRENXB           UPDATE POINTER TO NEXT AVAIL. BYTE.  49000017
         MVC   PRENOB(LNWORD),DSDRLN    UPDATE NO. OF BYTES LEFT IN BUF 49200018
         L     R8,PRENOB           GET NO. OF BYTES LEFT IN BUFFER.     49400017
         B     PRECOM3             GO TO WRITE OUT DSDR                 49600018
DDNT     EQU   *                                               @OZ07204 49620037
         CH    R8,PREUPX           IS THERE ROOM FOR A RECORD  @OZ07204 49640037
         BH    DDNT1               YES DONT WRITE BUFFER YET   @OZ07204 49660037
         BAL   RA,PREWR             NO OUTPUT BUFFER FIRST     @OZ07204 49680037
DDNT1    EQU   *                                               @OZ07204 49700037
         MVC   K0(JFCL,R2),INFMJFCB  MOVE INTO BUFFER          @OZ07204 49720037
         LA    RA,JFCL             SET UP DDNT LENGTH          @OZ07204 49740037
         B     PREDDNT                                         @OZ07204 49760037
PREJFX   EQU   *                                                        49800017
         CH    R8,PREUPX           IS THERE ROOM FOR ANOTHER RECORD     50000017
         BH    PREMVJX             YES-DO NOT WRITE OUT BUFFER YET.     50200017
         BAL   RA,PREWR            NO-GO TO WRITE OUT BUFFER.           50400017
PREMVJX  EQU   *                                                        50600017
         MVC   CDL(JFCL,R2),INFMJFCB  MOVE JFCBX TO BUFFER              50800017
         LA    RA,JFCL             ANTICIPATE DDNT LENGTH        YM7578 50850002
         LA    RA,K2(,RA)          BUMP BY 2 FOR JFCBX           YM7578 51000002
PREDDNT  EQU   *                   DDNT ENTRY                    YM7578 51050002
         AR    R2,RA               UPDATE BUFFER POINTER         YM7578 51100002
         SR    R8,RA               UPDATE AVAIL BYTE COUNT       YM7578 51150002
         B     PRECOM2             GO TO SAVE BUFFER POINTERS AND RET   51400018
PREOV    EQU   *                                                        51600017
         TM    CKFLAG2,CKEOV  Q. HAS EOV OCCURRED BEFORE                51800017
         BO    PREOVER        YES                                       52000017
         OI    CKFLAG2,CKEOV  TURN ON EOV INDICATOR                     52600017
         MVC   PRESV(LNMODNAM),PREXMN   SET UP XCTL PARM LIST           52800018
         MVI   PREWD2,CHAR2        IGC0206C                             53000018
         B     PREOUT              GO TO EXECUTE XCTL                   53200018
PREOVER  EQU   *                                                        53400017
         MVI   CKRETCD1,CKPGMERR   INDICATE PROGRAMMER ERROR            53600018
         LA    RA,CKERIO7          GET EOV ERROR CODE                   53800017
         STH   RA,CKMSGCOD         STORE IN WORK AREA                   54000017
         B     PREQMFG             GO TO TRANSFER CONTROL TO IGC0N06C   54200018
PRESYNAD EQU   *                                                        54300018
         MVI   CKRETCD1,CKIOERR    MOVE ERROR CODE INTO W.A.            54400018
         BR    RE                                                       54600017
PREQERRW EQU   *                                                        56200017
         LA    RA,CKERIO3          I/O ERROR WRITING CHKPT DATA SET     56400017
         STH   RA,CKMSGCOD         STORE ERROR CODE IN WORK AREA        56600017
         B     PREQERR             GO TO GET RETURN CODE                56800018
PREQERRX EQU   *                                                        57000017
         LA    RA,CKERIO4          I/O ERROR READING/WRITING SWA        57200002
         STH   RA,CKMSGCOD         STORE IN WORK AREA                   57400017
PREQERR  EQU   *                                                        57600017
         MVI   CKRETCD1,CKIOERR    MOVE RETURN CODE TO WA               57800018
PREQMFG  EQU   *                                                        58000017
         MVC   PRESV(LNMODNAM),PREIORE  MOVE IORESUME'S NAME TO XCTLST  58200018
         B     PREOUT             GO TO TRANSFER CONTROL                58400017
PREJFCBX EQU   *                                                        58500018
*********************************************************************** 58550002
*  SET UP FOR READING JFCB EXTENTION VIA QMNGRIO                 Y02076 58600002
*********************************************************************** 58650002
         USING QMIOP,R1                                          Y02076 58700002
         L     R1,CKQMPARM              GET ADDR QMNGRIO PARM LSTY02076 58750002
         XC    QMITCBAD(LPL),QMITCBAD   CLEAR GMNGRIO PARM LIST  Y02076 58760002
         ST    R0,QMIDSKAD              SVA ADDR OF JFCBX IN PÂ¬  Y02076 58800002
         LA    R0,LPL                   GET OFFSET TO WORK AREA  Y02076 58850002
         AR    R0,R1                    CALC ADDR OF WORK AREA   Y02076 58900002
         ST    R0,QMIWRKAD              ST WRK AREA ADDR IN P.L. Y02076 58950002
         LA    R0,INFMJFCB              ADDR OF JFCBX READ IN    Y02076 58960002
         ST    R0,QMIRECAD              ST READ IN ADDR IN P.L.  Y02076 58970002
         L     R0,CKTCBAD               GET ADDR OF TCB          Y02076 58972002
         ST    R0,QMITCBAD              STORE TCB ADDR IN P.LIST Y02076 58974002
         LA    R0,LNJFCB                GET LENGTH OF JFCBX      Y02076 58976002
         STH   R0,QMIRECL               STORE IN PARM LIST       Y02076 58978002
         MVI   QMIFLAGS,QMIOREAD        SET FLAG FOR 'READ'      Y02076 58980002
         QMNGRIO                        READ IN JFCB EXTENTION   Y02076 58990002
         LTR   RF,RF                    TEST FOR ERRORS          Y02076 58992002
         BNZ   PREQERRX                 IF ERROR BR TO SET CODE  Y02076 58994002
         LA    R9,COJFCBX          LOAD RECORD CODE.                    59000017
         BAL   RA,PREOBH           WRITE RCD TO CHKPT D.S.              59200018
         L     R0,INFMJFCB         GET TTR OF NEXT JFCBX                59400017
         IC    R0,PREZERO          FILL IN CONCATENATION NUMBER.        59600017
         LTR   R0,R0               IS THERE ANOTHER JFCBX.              59800017
         BNZ   PREJFCBX            YES-GO TO READ IN NEXT JFCBX.        60000017
         B     PRENXTI             NO-GO TO EXAMINE NEXT JFCB.          60200017
SIOTWR   EQU   *                                               @OZ07204 60210037
         CH    R8,PRESIOT          IS THERE ROOM FOR SIOT      @OZ07204 60220037
         BH    SIOTMOVE            YES GO MOVE IT IN           @OZ07204 60230037
         BAL   RA,PREWR            NO PUT OUT BUFFER FIRST     @OZ07204 60240037
SIOTMOVE EQU   *                                               @OZ07204 60250037
         L     RA,SIOTRDIN         LOAD ADDRESS OF SIOT        @OZ07204 60260037
         MVC   CDL(JFCL,R2),0(RA)      MOVE IT INTO BUFFER     @OZ07204 60270037
         LA    RA,SIOTLG           SIOT LENGHT PLUS CODE BYTES @OZ07204 60280037
         AR    R2,RA               SET UP BUFFER POINTER       @OZ07204 60290037
         SR    R8,RA               UPDATE BYTE COUNT           @OZ07204 60300037
         B     PRECOM2             SAVE POINTERS AND RETURN    @OZ07204 60310037
COSIOT   DC    X'000C'             SIOT CODE DSDR              @OZ07204 60320037
PRESIOT  DC    H'180'                                          @OZ07204 60330037
SIOTLG   EQU   178                                             @OZ07204 60340037
CKERIO3  EQU   X'0317'             WRITE UNSUCCESSFUL                   60400017
CKERIO4  EQU   X'0316'             SWA READ/WRITE UNSUCCESSFUL          60600002
CKERIO7  EQU   X'031B'             INVALID EOV                          60800017
DSDRL    EQU   400  LENGTH OF CHR AND DSDRS                             61000017
SP253    DC    AL1(253)                 SUBPOOL 253                     61050002
PREUPZ   EQU   178                                                      61400017
DSDRLN   DC    F'400'    LENGTH OF A DSDR                               61600017
*                                                                     * 61650018
*        LENGTHS OF RECORDS USED TO UPDATE BUFFER POINTER             * 61700003
*                                                                     * 61750018
PREUPX   DC    H'180'                                                   61800017
PREUPJ   EQU   191                                              Z30JSSR 62000003
PREUPR   DC    H'197'                                           Z30JSSR 62200003
PREZERO  DC    X'00'                                                    62400017
*                                                                       62450018
*        MODULE NAMES USED IN XCTL PARM LIST                            62500018
*                                                                       62550018
PREXMN   DC    C'IGC0F06C'                                              62600017
PREIORE  DC    C'IGC0N06C'                                              62800017
QMNGWALN DC    AL3(280)                256 BYTE QMNGRIO WA+24(PL)Y02076 62850002
DDNTFULL EQU   22                       FULL COUNT OF DD ENTRIES Y02076 62900002
DDNTSWAS EQU   99                       SWITCH FOR DDNTS IN SWA  Y02076 62950002
COJFCBX  EQU   4    CODE FOR JFCBX                                      63000017
COGDG    EQU   8    CODE FOR GDG BIAS COUNT TABLE                       63200017
CODSENQ  EQU   12   CODE FOR DSENQ TABLE                                63400017
CODDNT   DC    H'1'                     CODE FOR DDNT TABLE      Y02076 63450002
DSDREND  EQU   X'10'     CODE TO LAST DSDR.                             63600017
BLKEND   EQU   X'14'     CODE TO INDICATE END OF A DSDR.                63800017
BLKL     EQU   2    LENGTH OF DCBBLKSI FIELD                            64000017
SUBALOC  EQU   130       TIOESTTC FIELD-INDICATES SUBALLOCATE REQUESTED 64200017
INPUT    EQU   X'0F'                                                    64300017
SUREAD   EQU   X'7F'     RETURN CODE FOR SUCCESSFUL I/O COMPLETION.     64400017
JFCL     EQU   176       LENGTH OF JFCB TO BE WRITTEN OUT.              64600017
CDL      EQU   2    LENGTH OF CODE FIELD IN DSDR.                       64800017
DDL      EQU   8         LENGTH OF TIOEDDNM FIELD                       65000017
UCBTL    EQU   4                        DSDR UCBTYP FIELD LENGTH Y02076 65050002
SIOTL    EQU   4                   LENGTH OF SIOT               Z30JSSR 65100003
VLSQL    EQU   1                   LENGTH OF VOLUME SEQUENCE    Z30JSSR 65150003
UCBP     EQU   CDL+JFCL+DDL   OFFSET TO UCB INFO IN A DSDR.             65200017
SIOTFP   EQU   CDL+JFCL+DDL+UCBTL       OFFSET TO SIOT INFO-DSDR Y02076 65250002
VLSQP    EQU   CDL+JFCL+DDL+UCBTL+SIOTL OFFSET TO VOLSEQ        Z30JSSR 65300003
QSAMBSAM EQU   X'40'                                                    65400017
NOTTAPDA EQU   X'5F'                                                    65600017
PRETAPE  EQU   X'80'                                                    65800017
RDBACK   EQU   X'0E'                                                    66000017
DDNMP    EQU   CDL+JFCL  OFFSET TO DDNAME FIELD IN A DSDR.              66200017
TYPL     EQU   4         LENGTH OF UCBTYP FIELD                         66400017
CKMSG2   EQU   64    INDICATES WTO MSG-INVALID-ERROR WHILE CREATING     66600017
*                   CHKPT D.S.                                          66800017
CKCHR    EQU   128  INDICATES CHR WRITTEN                               67000017
DEBVLSQ  EQU   0         USED TO REFERENCE VOLUME SEQUENCE NO. IN DEB   67104018
VLSQ     EQU   36        OFFSET OF VOLSEQ NO IN DEB                     67108018
DEBVSQ   EQU   1                                                        67112018
CODE     EQU   0         OFFSET INTO BUFFER FOR RECORD CODE             67116018
NOTPRGD  EQU   X'FF'                                                    67120017
IOBECBAD EQU   4                                                        67140017
INDSEQ   EQU   X'80'                                                    67160017
PURGEOPT EQU   X'C0'                                                    67180017
LNJFCB   EQU   176                      LNGTH OF JFCB/X          Y02076 67190402
LNDDNT   EQU   176                      LNGTH OF DDNT            Y02076 67190802
LPL      EQU   24                       LNGTH OF PARM LIST       Y02076 67191202
UPDSIOT  EQU   X'10'                    SIOT UPDATED CODE        Y02076 67191602
TURNOFO  EQU   X'7F'                    TURN OFF OPEN BIT        Y02076 67191802
TURNOFS  EQU   X'EF'                    TURN OFF SIOT WRTE BIT   Y02076 67191902
K0       EQU   0                        CONSTANT 0               Y02076 67196802
K1       EQU   1                        CONSTANT 1               Y02076 67198802
K2       EQU   2                        CONSTANT 2               Y02076 67201102
K6       EQU   6                                                  M2192 67206602
K8       EQU   8                        CONSTANT 8               Y02076 67212502
K16      EQU   16                       VALUE 16                 YM7371 67218002
DEBPRFLN EQU   16                       LN OF DEB PREFIX         Y02049 67223502
ISAMDEB  EQU   X'80'                    DEB AMTYP FOR ISAM       YM7371 67229002
*                                                                     * 67234502
*        MAINTENANCE SPACE                                            * 67240002
*                                                                     * 67245502
PATCH    DC    XL((*-IGC0D06C)/20)'00'   FIVE PERCENT MAINTENANCE SPACE 67251002
*                                                                     * 67256502
DDNTREC  DSECT                          DDNT RECORD FORMAT       Y02076 67262002
DDNTIDNT DS    H                        DDNT ID = 0001           Y02076 67267502
DDNTUSCT DS    H                        NEXT AVAIL SLOT IN TBL   Y02076 67273002
DDNTLINK DS    F                        SVA OF NEXT DDNT         Y02076 67278502
DDNTDDNM DS    2F                       FIRST DDNAME             Y02076 67284002
         IEFQMIOP                                                       67289502
         IEFJESCT                                                       67295002
         IEFASIOT                                                       67300502
         IEZJSCB                                                 Y02076 67306002
         IHAQDB                                                  Y02076 67311502
         IHADSAB                                                 Y02076 67317002
         IEFZB429                                                Y02076 67322502
         IEFASCTB                                                Y02076 67328002
         IEEVCHWA   VER=3                                               67333502
PURGDEB  EQU   CKREGSAV                                                 67339002
PURGWD2  EQU   PURGDEB+4                                                67344502
PURGLST  EQU   PURGWD2+4                                                67350017
CKTSTEOV EQU   CKUNIT                                                   67400017
CKEOVCMR EQU   CKUNIT+4                                                 67600017
*                                                                     * 68250018
*        PRESERVE'S WORK AREA                                         * 68300018
*                                                                     * 68350018
PRESV    DS    F         XCTL PARAMETER LIST -                          68400018
PREWD2   DS    F              FIRST 2 WORDS CONTAIN MODULE NAME         68450018
PRELSTAD DS    F              POINTER TO MODULE NAME                    68500018
PRENXB   DS    F                   NEXT BYTE IN BUFFER.                 68600017
PRENOB   DS    F                   NUMBER OF BYTES LEFT IN BUFFER.      68800017
PREAD    DS    CL1       SAVE AREA USED FOR ADDRESSES          @ZA30810 68900037
PREAD3   DS    CL3                                                      69100018
PREADEOV DS    0F   SAVE AREA FOR INFO FOR EOV TEST             Z30JSSR 69200003
PREVLHLD DS    CL1                 VOLUME SEQUENCE HOLD AREA    Z30JSSR 69250003
         DS    CL3                                              Z30JSSR 69300003
PRNEOV   DS    F                                                        69400017
PRESAVE  DS    12F  REGISTER SAVE AREA.                                 69600017
PRELNGTH EQU   *    END OF PRESERVE'S W.A.                              69800017
         IEFJFCBN                                                       69810000
*                                                                     * 69850018
*        WORK AREA USED BY QUEUE MANAGER                              * 69900018
*                                                                     * 69950018
QJOB     DSECT                                                          70000017
SCALADCB DS    13F                                                      70200017
SCADEB   DS    12F                                                      70400017
SCATALLY DS    F                                                        70600017
SCASTRKS DS    H    TT OF FIRST TRACT IN Q.                             70800017
SCALTRKS DS    H    TT OF LAST TRACK IN Q.                              71000017
SCARECPT DS    CL1  NUMBER OF RECORDS PER PHYSICAL TRACK.               71200017
*                                                                     * 71220018
*        MAPPING OF ECB                                               * 71240018
*                                                                     * 71260018
ECBSECT  DSECT                                                          71280018
CMPCODE  DS    CL1            I/O COMPLETION CODE                       71300018
RBADDR   DS    CL3            ADDR OF RB WAITING ON I/O                 71320018
UCBSECT  DSECT                                                          71400017
         IEFUCBOB                                                       71600017
TIOTSECT DSECT                                                          71800017
         IEFTIOT1                                                       72000017
CVTSECT  DSECT                                                          72200000
         CVT                                                            72250000
         IKJTCB                                                         72252000
         IEZDEB                                                         72254000
         DCBD  DSORG=(BS,PO),DEVD=(DA,TA)                               72400017
UCBINNO  EQU   SRTEJBNR       BIN NO IN SUB-UCB                         72408018
CKRETCD1 EQU   CKRETCOD+1     RETURN CODE FIELD IN CHKWA                72416018
GDGTAB   EQU   INFMJFCB+4     TTR OF NEXT GDG TABLE                     72424018
DCBSYND  EQU   DCBSYNAD+1          ADDRESSING SYNAD ADDRESS IN DCB      72432018
TIOTUCB  EQU   TIOEFSRT-1     UCB ADDRESS IN TIOT ENTRY                 72440018
CKDCB1   EQU   CKDCBAD+1      CHKPT DCB ADDR IN CHKWA                   72456018
JFCBVSQ1 EQU   JFCBVLSQ+1     VOLSEQ NO. IN JFCB                        72464018
MAINUCB  EQU   X'FF'          FLAG FOR MAIN UCB                         72472018
LNADDR   EQU   3              LENGTH OF ADDRESS                         72480018
ZERO     EQU   X'00'                                                    72488018
LNVLSQNO EQU   2              LENGTH OF VOLUME SEQUENCE NO IN DEB       72496018
EQUX16   EQU   4              SHIFT NUMBER IN REG LEFT 4=MULTIPLY BY 16 72504018
INCVLSQN EQU   32             INCREMENT TO DEB VOLSQ NO FROM DEBLINK    72512018
ONE      EQU   1                                                        72520018
FIRSTVOL EQU   X'01'          FOR 1ST VOL, DEBVLSQ NO. = 1              72528018
DEFMOUNT EQU   X'20'          DEFERRED MOUNT BIT IN JFCB CAUSES DSDR TO 72536018
*                             MARK SIOT FOR REPIO TO MOUNT CORRECT VOL  72544018
LNWORD   EQU   4              LENGTH OF WORD                            72552018
LNMODNAM EQU   8              LENGTH OF MODULE NAME IN XCTL PARMLST     72560018
LMAINUCB EQU   56             LENGTH OF MAIN UCB                        72568018
ADDRBYTS EQU   7              ICM MASK FOR LOW ORDER THREE BYTES        72570000
M14      EQU   14             ICM MASK FOR HI-ORDER THREE BYTES  YM5777 72572002
M1       EQU   1              ICM MASK FOR LOW-ORDER BYTE      @ZA20785 72574037
CHAR2    EQU   C'2'           CHAR TO ALTER MOD NAME TO IGC0206C        72576018
JFCBMSK6 EQU   JFCBMASK+6                                               72584018
CKQMPARM EQU   CKERAS02                 ADR OF SPACE FOR QMNGRIO Y02076 72594002
SIOTAREA EQU   INFMJFCB                 SIOT READ IN OVER JFCB   Y02076 72596002
HIORDER  EQU   8                        HI ORDER BYTE ADDRESS    Y02076 72598002
DSDROCKP EQU   X'20'                    OPEN AT CHECKPOINT       Y02076 72598402
DSDRDALC EQU   X'80'                    DYNAMIC ALLOCATION       Y02076 72598802
DSDRCCAT EQU   X'40'                    DYNAMIC CONCATENATION    Y02076 72599202
SIOTRDIN EQU   CKERAS03                 ADDR OF SIOT READ INAREA Y02076 72599602
BLANK    EQU   X'40'                    BLANK CHARACTER          YM7323 72599702
 END                                                                    72600017
./  ADD  SSI=73360218,NAME=IHJACP50
*                                                                       00030020
         COPY  LCGASMSW                                                 00040000
*                                                                       00150020
         TITLE 'IGC0Q06C - CHKPT EXIT ROUTINE (IHJACP50)'               00300018
IGC0Q06C CSECT                                                          00400018
*********************************************************************** 00450002
*                                                                     * 00500002
*STATUS CHANGE LEVEL 000                                              * 00520002
*                                                                     * 00570002
*FUNCTION/OPERATION - FOR NORMAL PROCESSING THIS ROUTINE WILL DO      * 00600002
*                   THE FOLLOWING                                     * 00700002
*                                                                     * 01200002
*                     1.)  ISSUE A STOW MACRO ON THE CHECKID IF THE   * 01400002
*                          CHKPT DATA SET IS A PARTIONED DATA SET.    * 01600002
*                     2.)  CALLS WIJOURN MACRO TO CHECKPOINT          * 01650002
*                          THE VIO DATA SETS (FOR AUTOMATIC           * 01700002
*                          RESTART) TO THE JOB JOURNAL.               * 01750002
*                     3.)  UPDATE THE JCT AND WRITE IT OUT TO THE     * 02100002
*                          SCHEDULER WORK AREA (SWA)                  * 02150002
*                     4.)  FREEMAIN FOR THE CHKPT WORK AREA           * 02400002
*                     5.)  XCTL TO MESSAGE MODULE                     * 02700002
*                                                                     * 03100002
*                     FOR ERROR PROCESSING THIS ROUTINE WILL DO THE   * 03200002
*                     FOLLOWING                                       * 03300002
*                                                                     * 03400002
*                     1.)  FREEMAIN FOR CHKPT WORK AREA IF CHKPT      * 03600002
*                          HOUSEKEEPING GOT CORE FOR IT               * 03800002
*                     2.)  IF THE CHR WAS WRITTEN, WRITE THE JCT WITH * 04000002
*                          NO UPDATING                                * 04100002
*                     3.)  XCTL TO MESSAGE MODULE IGC0S06C            * 04800002
*                                                                     * 04850002
*                     FOR PROCESSING A CANCEL REQUEST OR A VIO ERROR  * 05400002
*                     (CODE 205), DO THE FOLLOWING                    * 05600002
*                                                                     * 05650002
*                     1.)  ZERO OUT THOSE FIELDS IN THE JCT THAT ARE  * 05800002
*                          MAINTAINED BY CHKPT (I.E. JCTDEVT,JCTCKTTR,* 06000002
*                          JCTCKIDL, JCTCKIDT).                       * 06200002
*                     2.)  WRITE OUT THE JCT TO THE SWA.              * 06400002
*                     3.)  FREEMAIN FOR THE WORK AREA.                * 06600002
*                     4.)  PUT X'00' RETURN CODE IN REGISTER 15.      * 06800002
*                     5.)  RETURN CONTROL TO THE USER.                * 06900002
*                                                                     * 07000002
*ENTRY POINT  IGC0Q06C                                                * 07050002
*                                                                     * 07060002
*INPUT   ADDRESS OF THE CHKPT WORK AREA IN REGISTER 1.                  07100017
*        IF REGISTER 1 IS ZERO UPON ENTRY, CORE WAS NOT OBTAINED FOR    07150017
*        THE WORK AREA.  IN THIS CASE REGISTER 5 WILL CONTAIN THE       07200017
*        ADDRESS OF CHKPT'S SVRB.  BYTES 0-3 OF THE EXTENDED SAVE AREA  07250017
*        WILL CONTAIN THE RETURN CODE AND MESSAGE CODE, BYTES 33-35 THE 07300017
*        TIOT ADDRESS AND BYTES 37-39 THE DCB ADDRESS OR ZERO (IF A BAD 07350017
*        PARAMETER LIST WAS PASSED).  BIT 3 (HKPCLOSE) OF BYTE 32       07400017
*        (HKPFLAG) WILL BE 1 IF CHKPT HOUSEKEEPING OPENED THE CHKPT     07450017
*        DATA SET.                                                    * 07500002
*                                                                     * 07550002
*OUTPUT  CANCEL REQUEST                                               * 07560002
*              RETURN CODE IN REGISTER 15                             * 07620002
*        NON CANCEL REQUEST                                           * 07680002
*              1.) ADDRESS OF SVRB IN REGISTER 1                      * 07750002
*              2.) RETURN CODE AND MESSAGE CODE IN FIRST 4 BYTES OF   * 07800002
*                  SVRB EXTENDED SAVE AREA                            * 07850002
*              3.) IF ERROR OCCURRED BEFORE CHR WAS WRITTEN           * 07900002
*                    BYTES IN SVRB        CONTENTS                    * 07950002
*                        16-23               JOBNAME                  * 08000002
*                        24-31               DDNAME (OR 0 IF ERROR CODE 08050017
*                                                       IS 01)        * 08100002
*                        36-39               DCB ADDRESS              * 08120002
*              4.) IF ERROR OCCURRED AFTER CHR WAS WRITTEN, OR NO ERROR 08150017
*                  OCCURRED                                           * 08200002
*                    BYTES IN SVRB        CONTENTS                    * 08300002
*                        16-31               CHECKID                  * 08400002
*                        32-35               TIOT ADDRESS             * 08440002
*                        36-39               DCB ADDRESS (HIGH ORDER  * 08480002
*                                                BYTE=X'80' IF CHKPT  * 08520002
*                                                OPENED THE DATA SET  * 08560002
*                                                                     * 08570002
*EXTERNAL ROUTINES  NONE                                              * 08600002
*                                                                     * 08610002
*SVC USED  FREEMAIN,XCTL,EXIT,STOW,GETMAIN                            * 08650002
*                                                                     * 08660002
*EXITS-NORMAL 1.) FOR CANCEL-RETURN CONTROL TO USER WITH RETURN CODE  * 08700002
*                                 IN REGISTER 15                      * 08750002
*             2.) IF NOT CANCEL-XCTL TO CHKPT MESSAGE MODULE IGC0S06C * 08800002
*     -ERROR NONE                                                     * 08850002
*                                                                     * 08860002
*TABLES/WORK AREAS-CREATED-CERSECT (CONTAIN INFO FOR MESSAGE MODULE)  * 08900002
*                  -REFERENCED- TCB,TIOT,JCT,UCB,CHKWA,DC,QMIOP,RPL,  * 08950002
*                               JESCT,JSCB,CVT                        * 09000002
*                                                                     * 09010002
*ATTRIBUTES - REENTRANT, SUPERVISOR STATE, TYPE 4 SVC ROUTINE.        * 09050002
*                                                                     * 09100002
*RESTRICTIONS ON USE OF ROUTINE - VS/2-REL 2  ONLY.                   * 09150002
*                                                                     * 09200002
*NOTES - NONE.                                                        * 09250002
*                                                                     * 09300002
* VS2-REL 3 CHANGES:                                                    09310002
*186500-187000,187900-187920                                     ZM0467 09320002
* VS2 RELEASE 037 CHANGES ADDITIONS DELETIONS                           09330037
*C150000,A151000                                               @ZA16894 09340037
*D293700,C294200,A295200-297700,568800                         @ZA27494 09345037
*********************************************************************** 09350002
         EJECT                                                          09400002
         USING CHKWA,RC                                                 09600017
         BALR  RB,ZERO             SET UP MODULE ADDRESSABILITY         09800018
         USING *,RB                                                     10000017
         B     BEGIN               BRANCH AROUND EYE CATCHER            10050000
         CNOP  0,8                 ALIGN TO A DOUBLE WORD BOUNDARY      10100000
         DC    C'IGC0Q06C'         CSECT NAME                           10150000
         DC    C'@ZA27494'         LAST CODE SHIPPED           @ZA27494 10153037
         DC    C'&SYSDATE'         LAST DATE SHIPPED           @ZA27494 10156037
BEGIN    EQU   *                                                        10160000
         LTR   R1,R1              IS THERE A CHKPT WA                   10200017
         BZ    CERERCHK            NO-CHECK TO DETERMINE ACTION         10400017
         LR    RC,R1              SET UP CHKPT WA ADDRESSABILITY        10600017
         LA    RD,CKREGSAV         INITIALIZE SAVE AREA REG.            11200017
         LA    R7,INJMJCT          GET ADDR OF JCT WRITE-OUT AREA.      11600017
         L     R4,CKTCBAD          GET THE TCB ADDRESS                  12410017
         USING TCB,R4                                                   12420000
         L     R9,TCBRBP           GET ADDRESS OF CHECKPOINTS SVRB      12430017
         USING CERSECT,R9                                               12440017
         MVC   CERRETCD(CERMSGMD-CERRETCD),CKRETCOD                     12450018
*                                       CODES FOR MESSAGE MODULE        12460018
         MVC   CERFLAG(LFLAG),CKFLAG1   MOVE FLAG FOR COMMON ADDRESSING 12470018
         TM    CKFLAG1,CKCANCEL    WAS CANCEL REQUESTED                 12480017
         BO    CERCANC             BRANCH TO PROCESS IF YES             12490017
         L     R8,CKDCBAD          GET ADDRESS OF CHEKPT DCB            12500017
         LA    R8,0(R8)            CLEAR HIGH ORDER BYTE                12503017
         ST    R8,CERDCBAD         SAVE ADDRESS FOR MSG. MODULE         12506017
         USING IHADCB,R8                                                12510017
         L     R2,TCBTIO           GET TIOT ADDRESS                     12520017
         USING TIOTSECT,R2                                              12530017
         TM    CKFLAG2,CKCHR       WAS THE CHR WRITTEN                  12540017
         BO    CERGETID            BRANCH IF YES                        12550017
*                                                                     * 12552018
*********************************************************************** 12554018
*                                                                     * 12556018
*   SET UP PARAMETER LIST FOR THE MESSAGE MODULE.  SINCE THE CHR WAS    12560017
*   NOT WRITTEN, ONLY THE JOBNAME AND DDNAME ARE REQUIRED FOR THE MSG.  12570017
*                                                                     * 12572018
*********************************************************************** 12574018
*                                                                     * 12576018
         MVC   CERJOBNM(LJOBNM),TIOCNJOB     MOVE IN JOBNAME FROM TIOT. 12583018
         MVC   CERDDNM(L'DCBDDNAM),DCBDDNAM INIT DDNAME FROM DCB YM3983 12585002
         TM    DCBOFLGS,CKDCBOP    IS CHKPT DCB OPEN             YM3983 12589002
         BZ    CERSYNR             IF NOT, USE DDNAME FROM DCB   YM3983 12589402
*                                  OTHERWISE, FALL THRU AND GET  YM3983 12589802
*                                  DDNAME FROM TIOT ENTRY        YM3983 12593202
         AH    R2,DCBTIOT          POINT AT DD ENTRY IN TIOT            12596702
         USING TIOELNGH,R2                                              12600017
         MVC   CERDDNM(CERTIOAD-CERDDNM),TIOEDDNM                       12606018
*                                  MOVE DDNAME TO MSG MOD PARMLST       12612018
         B     CERSYNR             BRANCH TO FREEMAIN AND CLOSE         12620017
*                                                                     * 12621018
*********************************************************************** 12622018
*                                                                     * 12623018
*  THE CHR WAS WRITTEN.  THEREFORE THE CHECKID, TIOT ADDRESS AND THE    12623400
*  DCB ADDRESS WILL BE PASSED TO THE MSG. MODULE                        12623800
*                                                                     * 12624018
*********************************************************************** 12625018
*                                                                     * 12626018
CERGETID EQU   *                                                        12630017
         OI    CERDCBAD,CHRWRTTN   TELL SO6C CHR WRITTEN         YM6511 12640002
         MVI   CERCHKID,SPACE                BLANK OUT THE CHECKID      12660018
         MVC   CERCKID1(LCHKID),CERCHKID     FIELD IN THE PARAM AREA.   12670018
         ST    R2,CERTIOAD         SAVE TIOT ADDRESS FOR MSG. MOD.      12700017
         TM    CKFLAG2,CKUSPCHD    DID USER SUPPLY THE CHECKID          12720017
         BZ    CERGETGN            BRANCH IF NO TO GET GENERATED ONE    12730017
         L     R6,CKPARMAD         GET ADDRESS OF PARAMETER LIST        12740017
         USING CHKPTPML,R6         MAPPING CHKPT PARM                   12746018
         L     R4,IDADDR           GET ADDR OF THE CHECKID              12752018
         XR    R2,R2               CLEAR REGISTER 2 FOR INSERT          12760017
         IC    R2,LUSERID          GET LENGTH OF CHECKID                12770018
         BCTR  R2,ZERO             SUBTRACT ONE FOR EXECUTE             12780018
         B     CERMOVE             GO TO MOVE CHECKID TO PARMLST        12790018
CERGETGN EQU   *                                                        12800017
         LA    R4,CKCHEKID         GET ADDRESS OF GENERATED CHKID       12810017
         LA    R2,LENGTH1          LENGTH-1 FOR EXECUTE                 12820018
CERMOVE  EX    R2,CERMOVID         MOVE CHECKID TO PARAM AREA           12830017
         DROP  R4,R2,R6                                                 12840018
*                                                                     * 12850018
*********************************************************************** 12860018
*                                                                     * 12870018
*        FOR BPAM CHECKPOINT DATA SET, WHEN NO ERRORS HAVE BEEN       * 12880018
*        ENCOUNTERED(EXCEPT OUTSTANDING ENQUEUES) STOW CHKPT ENTRY    * 12890018
*        UNDER CHECKID AS MEMBER                                      * 12900018
*                                                                     * 12910018
*********************************************************************** 12920018
*                                                                     * 12930018
CERCKCD  EQU   *                                                        12940017
         CLI   CKRETCD1,CKPSBERR   DOES RETURN CODE INDICATE ONLY       13040018
*                                  A POSSIBLE ERROR.                    13200017
         BE    CERSKP1             YES-SKIP ERROR CHECK.                13400017
         CLI   CKRETCD1,HEXZERO    HAVE ANY ERRORS BEEN ENCOUNTERED     13600018
         BNZ   CERSKP2             YES-SKIP CODE TO STOW CHKPT ENTRY    13800018
CERSKP1  TM    CKFLAG1,CKBPAM      WAS CHKPT DATA SET OPENED FOR BPAM   14000017
         BZ    CERSKP2             NO-DO NOT STOW ENTRY                 14200017
         L     R1,CKDCBAD               SET UP                          14400017
         LA    R0,CERSTOW               PARAMETERS                      14600017
         MVC   CERSTOW(IDL),CERCHKID    FOR STOW MACRO                  14800017
         XC    CERSTOW8(LTTR),CERSTOW8  ZERO STOW TTR FIELD    @ZA16894 15000037
         MVC   0(LTTR,R1),CKTTR         SAVE TTR FOR STOW      @ZA16894 15100037
         STOW  (1),(0),R                                                15200017
         B     *+4(RF)             BRANCH TABLE DETERMINES PROCESSING   15300018
*                                  TO BE DONE DEPENDING UPON THE RETURN 15400018
*                                  CODE FROM STOW                       15500018
         B     CERSKP2             OK-CONTINUE                          15600018
         B     CER10               I/O ERROR-GO TO MOVE ERRCODE TO WA   15800018
         B     CERSKP2             OK-CONTINUE                          16000018
         B     CER0C               NOT ENOUGH ROOM IN DIRECTORY-GO TO   16100018
*                                  INDICATE PROGRAMMER ERROR            16200018
         B     CER10               I/O ERROR-GO TO MOVE ERRCODE TO WA   16240018
*                                                                     * 16280018
*********************************************************************** 16320018
*                                                                     * 16360018
*        GET UCB ADDR IN ORDER TO PUT DEVICE TYPE INTO JCT FIELD      * 16400000
*        'JCTDEVT'                                                    * 16440000
*                                                                     * 16480018
*********************************************************************** 16520018
*                                                                     * 16560018
CERSKP2  EQU   *                                                        16600017
         L     R6,CKTCBAD          GET THE TCB ADDRESS                  16630017
         USING TCB,R6                                                   16660000
         L     R3,TCBTIO                                        ZA00617 16690002
         AH    R3,DCBTIOT                                       ZA00617 16720002
         USING TIOELNGH,R3                                      ZA00617 16750002
         L     R6,TIOTUCB          GET THE UCB ADDRESS FROM TIOT        16760018
*                                                                     * 17100018
*********************************************************************** 17120018
*                                                                     * 17140018
*        IF CHR WAS NOT WRITTEN DO NOT UPDATE JCT OR WRITE JCT TO JOB * 17160018
*        QUEUE, OTHERWISE, MOVE CHECKID TO JCT                        * 17180018
*        IF AN ERROR OCCURRED OTHER THAN OUTSTANDING ENQUEUES OR      * 17200018
*        IMMEDIATE RESTARTS SUPPRESSED BRANCH TO WRITE JCT TO JOB Q   * 17220018
*                                                                     * 17240018
*********************************************************************** 17260018
*                                                                     * 17280018
CERFD    EQU   *                                                        17320017
         USING UCBSECT,R6          ADDRESS UCB                          17370017
         TM    CKFLAG2,CKCHR       WAS CHR WRITTEN                      18000017
         BZ    CERSYNR             IF NOT, BR TO FREEMAIN AND CLOSE     18100002
CERFDCAN L     R4,CKTCBAD          GET TCB ADDR                  YM5773 18150002
         USING TCB,R4              ADDRESS TCB                   YM3988 18200002
         L     R4,TCBJSCB-TCB(,R4) GET JSCB ADDR                 YM3988 18250002
         USING IEZJSCB,R4          ADDRESS JSCB                  YM3988 18300002
         MVC   SVAJCTA(E4),JSCBJCTA SAVE JCT SVA ADDR            YM3988 18350002
         TM    CKFLAG1,CKCANCEL         WAS CANCEL REQUESTED     YM5773 18352002
         BO    CERJCTW                  YES-BR TO WRITE JCT      YM5773 18354002
         CLI   CERRETC1,CKPSBERR   RETURN CODE INDICATE POSSIBLE ERROR  18360018
*                                  A POSSIBLE ERROR                     18400017
         BE    CERAFER             YES-UPDATE JCT                       18440018
         CLI   CERRETC1,HEXZERO    HAS AN ERROR OCCURED                 18490018
         BNE   CERJCT1             BRANCH IF YES--SKIP UPDATING THE JCT 18540017
CERAFER  EQU   *                                                        18600017
         L     R7,CKTCBAD               GET TCB ADDR             ZM0467 18650002
         WIJOURN TCB=(R7),CALLER=CKPT   VIO JOURNLING            ZM0467 18700002
         LTR   RF,RF                    ANY VIO ERRORS          ZA00617 18750002
         BZ    CERAFER2                 BRANCH IF NO            ZA00617 18760002
         MVI   CERMSGCD,VAMSGTYP        MSG SHELL ID            ZA00617 18770002
         MVI   CERRETC1,CKIOERR         SET RETURN CODE         ZA00617 18780002
         LA    R7,VAMERR1               IS IT RET. CODE 4        ZM0467 18790002
         CR    RF,R7                    COMPARE                  ZM0467 18792002
         BE    CERAFER1                 BR IF IT IS 4           ZA00617 18794002
         MVI   CERMSGCD+E1,ERRMSGC2     SET ERR CODE 205        ZA00617 18796002
         B     CERCANC                  BR TO CANCEL AUTO RSTRT ZA00617 18798002
CERAFER1 MVI   CERMSGCD+E1,ERRMSGC1     SET ERR CODE 204        ZA00617 18798402
CERAFER2 EQU   *                        UPDATE JCT AS REQUIRED  ZA00617 18798802
         TM    JCTRSW2,JCTNORST    ARE IMMEDIATE RESTARTS SUPPRESSED    18800017
         BO    CERJCT1             BRANCH IF YES                        18860017
*                                                                     * 18865018
*********************************************************************** 18870018
*                                                                     * 18875018
*        UPDATE THE FOLLOWING FIELDS IN JCT:                          * 18880018
*            JCTCKID - CHKPT ID                                  YM3988 18882002
*            JCTCKTTR - CHKPT D/S JFCB SVA ADDRESS               YM3988 18884002
*            JCTRSW1 - SWITCH - CHKPT TAKEN                           * 18885018
*            JCTDEVT - DEVICE TYPE CHKPT D.S.                         * 18890018
*            JCTRSW2 - SWITCH - SYSCHK                                * 18895018
*            JCTVOLSQ - VOLUME SEQUENCE NO CHKPT D.S.                 * 18900018
*            JCTSMRBA - RBA OF SYS MSG DATA SET                  Y02076 18905002
*********************************************************************** 18910018
*                                                                     * 18915018
         L     R4,JSCBSMLR-IEZJSCB(,R4) GET SYS MSG D/S RPL ADDR YM3988 18965002
         USING IFGRPL,R4           ADDRESS RPL                   YM3988 18967002
         MVC   JCTSMRBA(E8),RPLRBAR RBA OF MSG D/S TO JCT        YM3988 18969002
         DROP  R4                  RPL ADDRESSABILITY            YM3988 18969802
         ICM   R4,E7,JCTSMRBA+E5   BUMP THE LOGICAL RECORD NR BY YM5984 18969902
         LA    R4,E1(,R4)          1 TO ACCOUNT FOR THE CHKPT    YM5984 18970402
         STCM  R4,E7,JCTSMRBA+E5   MESSAGE ISSUED OUT OF S06C    YM5984 18970502
         NI    JCTRSW2,AUTOREST    RESET AUTO RS INELIG BIT      Y02076 18970902
         MVI   JCTCKIDT,SPACE      BLANK OUT CHK ID IN JCT       A32184 19020002
         MVC   JCTCKID1(CKL),JCTCKIDT                            A32184 19070002
         EX    R2,CERMVID          EX MOVE OF CHK ID TO JCT      A32184 19120002
         MVC   JCTCKTTR(CKTTRL),TIOEJFCB                                20800017
         OI    JCTRSW1,JCTCKFT     TURN ON CHKPT TAKEN BIT.             21600017
         MVC   JCTDEVT(DEVTL),UCBTYP MOVE DEVICE TYPE INFO TO JCT.      22400017
         NI    JCTRSW2,SYSCHKOF    TURN OFF POSSIBLE SYSCHK BIT         22500002
         L     R8,DCBDEBAD         GET ADDR OF CHKPT DATA SET'S DEB.    22600017
         DROP  R8                                                       22800017
*                                                                     * 22806018
*********************************************************************** 22812018
*                                                                     * 22818018
*        FOR BPAM CHKPT DS VOLSEQ NO IN JCT SET TO ONE.               * 22824018
*        OTHERWISE VOL SEQ NO IS MOVED FROM DEB TO JCT                * 22830018
*                                                                     * 22836018
*********************************************************************** 22842018
*                                                                     * 22848018
         TM    CKFLAG1,CKBPAM      Q. CHKPT DATA SET OPENED FOR BPAM    22860017
         BO    CERPVOL             YES-FILL IN JCTVOLSQ FIELD           22930017
         TM    UCBTBYT3,UCB3TAPE   IS DATA SET ON MAGNETIC TAPE         23030018
         BO    CERJCT1              IF SO, ACP25 HAS SET VLSEQ  YA00142 23200002
         LA    RF,DAEXT            GET NO. OF BYTES PER DEVICE ENTRY.   23400002
         XR    RE,RE               CLEAR REGISTER.                      23600017
         XR    R1,R1               CLEAR REGISTER.                      23800017
         IC    R1,DEBNMEXT(R8)     GET NUMBER OF EXTENTS.               24000017
         MR    RE,R1               COMPUTE SIZE OF DEB DEVICE           24200017
*                                  DEPENDENT SECTION.                   24400017
CERCOMV  EQU   *                                                        24600017
         AR    RF,R8               COMPUTE OFFSET TO VOL SEQ FIELD.     24800017
         MVC   JCTVOLSQ(ONE),DEBBAS1(RF)     MOVE SEQ NO. TO JCT.       25000018
CERJCT1  EQU   *                                                        25200017
         LA    R7,INJMJCT          LOAD ADDR OF WRITE OUT AREA.         25400017
*                                                                     * 25520018
*********************************************************************** 25560018
*                                                                     * 25600018
*        WRITE JCT TO JOB QUEUE                                       * 25640018
*                                                                     * 25680018
*********************************************************************** 25720018
*                                                                     * 25760018
CERJCTW  EQU   *                                                        25800017
         BAL   RA,CERQW            GO TO WRITE OUT JCT.                 26000017
*                                                                     * 26200018
*********************************************************************** 26400018
*                                                                     * 26600018
*        RESTORE CHKPT DCB SYNAD ADDR EXCECT FOR CHKPT CANCEL REQUEST * 26800018
*                                                                     * 27000018
*********************************************************************** 27200018
*                                                                     * 27400018
CERSYNR  EQU   *                                                        27600017
         TM    CKFLAG1,CKCANCEL    WAS CANCEL REQUESTED.                27800017
         BO    CERTURN             YES-SKIP CODE TO RESTORE SYNAD ADDR. 28000017
         L     R8,CKDCBAD          GET ADDR OF CHKPT DCB.               28200017
         USING IHADCB,R8           ADDRESS CHKPT DCB.                   28400017
         MVC   SYNAD1(CKPARMAD-CKSYNAD1),CKSYNAD1                       28440018
*                                  RESTORE SYNAD ADDR IN CHKPT DCB      28480018
*                                                                     * 28520018
*********************************************************************** 28560018
*                                                                     * 28600018
*        RESTORE CHKPT DCBBLKSIZE IF CHKPT SUPPLIED BLKSIZE           * 28640018
*                                                                     * 28680018
*********************************************************************** 28720018
*                                                                     * 28760018
CERTURN  EQU   *                                                        28800017
CERCON2  EQU   *                                                        29340017
         L     R8,CKDCBAD          ADDRESS CHKPT DCB                    29343017
         MVC   DCBBLKSI(LBLKSIZ),CKDCBSI                                29345000
*                                  RESTORE USER BLOCKSIZE               29347000
         L     R2,CKTCBAD          ADDR TCB                             29350017
*                                                                     * 29350218
*********************************************************************** 29350418
*                                                                     * 29350618
*        FREEMAIN CHKPT WORK AREA (SUBPOOL 252 V=R SUBPOOL 253 V=V)   * 29350837
*                                                                     * 29351018
*********************************************************************** 29351218
*                                                                     * 29351418
CERFREWA EQU   *                                                        29358017
         USING TCB,R2                                                   29360000
         L     R0,CKWACL           SET UP FREEMAIN                      29370037
         ICM   R0,HIORDER,SP253    INDICATE SP 253.            @ZA27494 29420037
         LA    R1,CHKWA            PARAMETER REGISTERS                  29470037
         TM    TCBFLGS6,TCBRV      IS THIS TASK V=R            @ZA27494 29520037
         BNO   CONT                NO,LEAVE SP 253             @ZA27494 29570037
         ICM   R0,HIORDER,SP252    YES,INDICATE SP 252         @ZA27494 29620037
CONT     EQU   *                                               @ZA27494 29670037
         L     R2,TCBRBP           ADDR CHKPT SVRB             @ZA27494 29720037
         DROP  R2                                              @ZA27494 29770037
         FREEMAIN R,LV=(0),A=(1)   FREE WORK AREA                       30000017
*                                                                     * 30040018
*********************************************************************** 30080018
*                                                                     * 30120018
*        SET FLAG IN PARMLST FOR MSG.MOD. TO CLOSE CHKPT D.S. IF      * 30160018
*        CHKPT OPENED D.S.                                            * 30200018
*********************************************************************** 30240018
*                                                                     * 30280018
*                                                                     * 30320018
         TM    CERFLAG,CKOPEN      DID CHKPT OPEN DATA SET              30400017
         BZ    CERRET              NO-RETURN TO USER                    30800017
CERSTCLS EQU   *                                                        31100017
         OI    CERDCBAD,CERMCLS    SET BIT TO HAVE MSG. MOD. CLOSE      31400017
*                                  CHKPT DATA SET                       31700017
*                                                                     * 31750018
*********************************************************************** 31800018
*                                                                     * 31850018
*        IF CANCEL WAS REQUESTED RETURN TO CALLER VIA SVC 3, ELSE     * 31900018
*        GO TO XCTL TO MSG.MOD.(IHJACP70)                             * 31950018
*                                                                     * 32000018
*********************************************************************** 32050018
*                                                                     * 32100018
CERRET   EQU   *                                                        32200017
         TM    CERFLAG,CKCANCEL    WAS CANCEL REQUESTED                 32300017
         BZ    CERMSGX             BRANCH IF NO TO MSG. MOD EXIT        32400017
         LH    RF,CERRETCD         LOAD RETURN CODE                     32500017
         SVC   3                   RETURN TO CALLING PROGRAM            32600017
CERMSGX  EQU   *                                                        32700017
         MVC   CERMSGMD(LMODNAME),CERMSGID   MOVE MOD.NAME TO XCTL PARM 32800018
         LA    R7,CERMSGMD         ADDRESS OF MODULE NAME               33000017
         ST    R7,CERXCTL          PUT IN PARM LIST FOR XCTL            33100017
         LA    RF,CERXCTL                                               33200017
         LR    R1,R9               PUT ADDRESS OF SVRB IN R1            33300017
         XCTL  SF=(E,(15))         GO TO MESSAGE MODULE                 33400017
*                                                                     * 34610018
*********************************************************************** 34620018
*                                                                     * 34630018
*        SET MSG AND RET CODE IN PARMLST WHEN I/O ERROR OCCURS DURING * 34640018
*        STOW AND THEN CONTINUE PROCESSING                            * 34650018
**                          RETURN CODE  = 0C(HEX)                    * 34660018
*                           MESSAGE CODE = 26(DEC)                    * 34670018
*                                                                     * 34680018
*********************************************************************** 34690018
*                                                                     * 34700018
CER10    EQU   *                                                        34800017
         MVI   CERRETC1,CKIOERR    MOVE IN RETURN CODE                  35000018
         LA    RA,CKERIO5          LOAD MESSAGE CODE                    35200017
         STH   RA,CERMSGCD         PUT IN PAR AREA FOR MSG. MODULE      35400017
         B     CERSKP2             CONTINUE PROCESSING                  35500018
CERPVOL  EQU   *                                                        35660017
         MVI   JCTVOLSQ,HEXONE     VOL.SEQ.NO IN JCT=1 FOR BPAM D.S.    35690018
         B     CERJCT1             GO TO WRITE OUT JCT                  35700018
*                                                                     * 35710018
*********************************************************************** 35720018
*                                                                     * 35730018
*        INITIALIZES PARMLST TO MSG.MOD. WHEN ERROR OCCURRED BEFORE   * 35740018
*        CHKPT GETMAIN'D FOR WORKAREA                                 * 35750018
*                                                                     * 35760018
*********************************************************************** 35770018
*                                                                     * 35780018
CERERCHK EQU   *                                                        35800017
         USING HKPSECT,R5                                               35870017
         LR    R9,R5               PUT ADDRESS OF SVRB IN R9            35940017
         MVC   CERFLAG(LFLAG),HKPFLAG   MOVE FLAG TO COMMON AREA        36010018
         L     R4,HKPTIOT          GET TIOT ADDRESS                     36080018
         DROP  R3                                               ZA00617 36150002
         USING TIOTSECT,R4                                              36220017
         L     R8,HKPDCB           GET DCB ADDRESS                      36270018
         LA    R8,ZERO(R8)         CLEAR HIGH ORDER BYTE                36320018
         ST    R8,CERDCBAD         SAVE DCB ADDRESS FOR MSG. MOD.       36390017
         MVC   CERJOBNM(LJOBNM),TIOCNJOB     MOVE JOBNAME TO MSG. PARMS 36440018
         LTR   R8,R8               Q. IS THERE A DCB ADDRESS            36500017
         BZ    CERMSGX             BRANCH IF NO TO MESSAGE MODULE       36570017
         TM    DCBOFLGS,CKDCBOP    IS THE DCB OPENED                    36640017
         BZ    CERMVDD             BRANCH IF NOT--GET DDNAME FROM DCB   36710017
*                                  IF YES, GET DDNAME FROM TIOT         36780017
         AH    R4,DCBTIOT          POINT TO TIOT ENTRY                  36850017
         USING TIOELNGH,R4                                              36920017
         MVC   CERDDNM(LDDNM),TIOEDDNM  MOVE DDNAME TO MESG. MOD. PARMS 36990018
         TM    CERFLAG,HKPCLOSE    DID CHECKPOINT OPEN THE DATA SET     37060017
         BO    CERSTCLS            BRANCH TO SET CLOSE BIT FOR MSG. MOD 37130017
         B     CERMSGX             BRANCH TO GO TO MESSAGE MODULE       37200017
CERMVDD  MVC   CERDDNM(LDDNM),DCBDDNAM  MOVE DDNAME TO MESSAGE PARMS.   37270018
         B     CERMSGX             BRANCH TO GO TO MESSAGE MODULE       37340017
         DROP  R4,R5                                                    37410017
*                                                                     * 37420018
*********************************************************************** 37430018
*                                                                     * 37440018
*        CHKPT CANCEL PROCESSING - IF A CHKPT HAS BEEN TAKEN DURING   * 37450018
*        THIS STEP,CHKPT FIELDS IN JCT ARE ZERO'D OUT SO THAT IT WILL * 37460018
*        APPEAR THAT A CHKPT HAS NOT BEEN TAKEN AND AN IMMEDIATE      * 37470018
*        RESTART IS NOT POSSIBLE                                      * 37480018
*                                                                     * 37490018
*********************************************************************** 37500018
*                                                                     * 37510018
CERCANC  EQU   *                                                        37600017
         TM    JCTRSW1,JCTCKFT     HAS A CHKPT BEEN TAKEN IN THIS STEP  37800017
         BZ    CERCON2             NO-GO TO FREE WORK AREA              38000018
CERZERO  EQU   *                                                        38200017
         XC    JCTDEVT(LJCT),JCTDEVT    ZERO OUT JCT FIELDS.            38400018
         XC    JCTCKTTR(CKTTRL),JCTCKTTR                                38600017
         XC    JCTCKIDL(TWO),JCTCKIDL                                   38800018
         MVI   JCTCKIDT,SPACE      BLANK OUT CHECKID FIELD IN JCT.      39000018
         MVC   JCTCKID1(CKL),JCTCKIDT                                   39200018
         XI    JCTRSW1,JCTCKFT     TURN OFF CHKPT TAKEN BIT.            39400017
         B     CERFDCAN            GO TO WRITE OUT JCT.          YM5773 39600002
*                                                                     * 39610018
*********************************************************************** 39620018
*                                                                     * 39630018
*        SET MESSAGE AND RETURN CODE IN PARMLST FOR MSG.MOD WHEN      * 39640018
*        STOW MACRO FAILED BECAUSE DIRECTORY OF CHKPT BPAM D.S.       * 39650018
*        RAN OUT OF SPACE                                             * 39660018
*                             RETURN CODE  = 08                       * 39670018
*                             MESSAGE CODE = 17(DEC)                  * 39680018
*                                                                     * 39690018
*********************************************************************** 39700018
*                                                                     * 39710018
CER0C    EQU   *                                                        39800017
         MVI   CERRETC1,CKPGMERR   MOVE RETURN CODE TO MSG. PARMS       40000018
         LA    RA,CKERPG17         GET MSG. CODE                        40200017
         STH   RA,CERMSGCD         PUT IN MSG. PARMS                    40400017
         B     CERSKP2             RETURN TO MAIN-LINE CODE AFTER STOW  40440018
*                                                                     * 40480018
*********************************************************************** 40520018
*                                                                     * 40560018
*        SUBROUTINE TO GET SPACE FOR QMNGRIO PARM LIST & WORK AREA    * 40600002
*        THEN WRITE JCT TO SWA VIA QMNGRIO                       Y02076 40640002
*                                                                     * 40680018
*********************************************************************** 40720018
*                                                                     * 40760018
CERQW    EQU   *                        WRITE JCT TO SWA         Y02076 40800002
         ICM   R0,ADDRBYTS,QMNGWALN     INSERT LNGTH OF WA IN R0 Y02076 40810002
         ICM   R0,HIORDER,SP253         PUT SUBPOOL NO. IN R0    Y02076 40820002
         ST    R0,CKERAS02              SAVE GETMAIN PARM REG    Y02076 40822002
         GETMAIN R,LV=(R0)              R1 WILL HAVE ADDR OF WA  Y02076 40830002
         ST    R1,CKERAS01              SAVE PARM LIST ADDR      Y02076 40832002
         USING QMIOP,R1                                          Y02076 40840002
         XC    QMITCBAD(E24),QMITCBAD   CLEAR QMNGRIO PARM LIST  Y02076 40840402
         L     R0,SVAJCTA               GET SVA ADDR OF JCT      Y02076 40842002
         IC    R0,ZEROBYTE              CLEAR SVA LO ORDER BYTE  Y02076 40844002
         ST    R0,QMIDSKAD              ST JCT SVA ADR IN P.L.   Y02076 40846002
         LA    R0,E24                   GET OFFSET TO WORK AREA  Y02076 40848002
         AR    R0,R1                    CALC ADDR OF WORK AREA   Y02076 40848402
         ST    R0,QMIWRKAD              ST ADDR OF WA IN P.L.    Y02076 40848802
         LA    R0,INJMJCT               GET CORE ADDR OF JCT     Y02076 40849202
         ST    R0,QMIRECAD              ST ADDR IN P.L.          Y02076 40849602
         L     R0,CKTCBAD               GET ADDR OF TCB          Y02076 40879602
         ST    R0,QMITCBAD              STORE IN QMNGRIO P.LIST  Y02076 40929602
         LA    R0,E176                  GET LENGTH OF JCT        Y02076 40939602
         STH   R0,QMIRECL               STORE IN QMNGRIO P.LIST  Y02076 40939702
         MVI   QMIFLAGS,QMIOWRTE        SET FLAGS TO 'WRITE'     Y02076 40940002
         QMNGRIO                        WRITE JCT TO SWA         Y02076 40970002
         LTR   RF,RF                    TEST IF WRITE WAS GOOD   Y02076 40980002
         BNZ   CERIO                    BR TO SET CODES IF BAD   Y02076 40990002
         L     R1,CKERAS01              GET ADR OF QMNGR P.L.    Y02076 40994002
         L     R0,CKERAS02              GETMAIN PARM REG         Y02076 40996002
         FREEMAIN  R,LV=(R0),A=(R1)     FREE UP P.L. & WORK A.   Y02076 40998002
         BR    RA                       RETURN TO CALLER.               41000002
CERIO    EQU   *                        JCT WRITE ERROR          Y02076 41050002
         L     R1,CKERAS01              GET ADR OF QMNGR P.L.    Y02076 41100002
         L     R0,CKERAS02              GETMAIN PARM REG         Y02076 41150002
         FREEMAIN  R,LV=(R0),A=(R1)     FREE UP P.L. & WORK A.   Y02076 41200002
         CLI   CERMSGCD,E0              PREVIOUS ERR OCCUR       Y02076 41300002
         BE    CERJCTER                 BRANCH IF NO             Y02076 41350002
         CLI   CERRETC1,CKPSBERR        POSSIBLE ERROR           Y02076 41400002
         BNE   CERSYNR                  BRANCH IF NO             Y02076 41450002
CERJCTER MVI   CERMSGCD+E1,ERR25        SET JCT ERR CODE 25      Y02076 41500002
         MVI   CERMSGCD,SHELL2          SET MSG SHELL CODE 2     Y02076 41550002
         MVI   CERRETC1,CKIOERR         SET RET CODE 0C          Y02076 41600002
         B     CERSYNR                  BR TO FREE WORK AREA     Y02076 41650002
*                                                                     * 45650018
*        EXECUTED INSTRUCTION                                         * 47650018
*                                                                     * 49650018
CERMVID  MVC   JCTCKIDT(ONE),CERCHKID   MOVE CHECKID TO JCT.     VS4686 51650002
CERMOVID MVC   CERCHKID(ONE),ZERO(R4)   EXECUTED INSTRUCTION            53650018
*                                                                     * 54250018
*        CONSTANTS                                                    * 54850018
*                                                                     * 55450018
CERMSGID DC    CL8'IGC0S06C'       MODULE NAME FOR XCTL PARMLST         56050018
         DS    0F                                                       56800017
SP252    DC    X'FC000000'         SPECIFY SUBPOOL 252 FOR V=R @ZA27494 56880037
SP253    DC    X'FD000000'         SPECIFY SUBPOOL 253 FOR V=V          56883037
QMNGWALN DC    AL3(280)                256 BYT QMNGRIO WA+24(PL) Y02076 56890002
VAMSG204 DC    H'204'                   NO AUTO RSTRT-CURRÂ¬CHKPT Y02076 56892002
VAMSG205 DC    H'205'                   NO AUTO RSTRT-ANY CHKPT  Y02076 56894002
ZEROBYTE DC    X'00'                    CLEAR LO BYTE SVA ADR    Y02076 56896002
ADDRBYTS EQU   7                        ADDRESS BYTES MASK       Y02076 56900002
HIORDER  EQU   8                        HI ORDER BYTE MASK       Y02076 56910002
AUTOREST EQU   X'BF'                    RESET AUTO RST INELIG    Y02076 56920002
SYSCHKOF EQU   X'7F'                    TURN OFF SYSCHK BIT      Y02076 56924002
ERR25    EQU   25                       JCT WRITE ERROR CODE     Y02076 56926002
SHELL2   EQU   2                        MSG SHELL 2              Y02076 56928002
E0       EQU   0                        CONSTANT 0               Y02076 56928402
E1       EQU   1                        CONSTANT 1               Y02076 56928802
E2       EQU   2                        CONSTANT 2               Y02076 56929202
E3       EQU   3                        CONSTANT 3               Y02076 56929602
E4       EQU   4                        CONSTANT 4               Y02076 56929702
E5       EQU   5                        CONSTANT 5               Y02076 56929802
E6       EQU   6                        CONSTANT 6               Y02076 56929902
E7       EQU   7                        CONSTANT 7               Y02076 56933202
E8       EQU   8                        CONSTANT 8               Y02076 56935202
E9       EQU   9                        CONSTANT 9               Y02076 56935602
E10      EQU   10                       CONSTANT 10              Y02076 56936002
E24      EQU   24                       CONSTANT 24              Y02076 56936402
E176     EQU   176                      CONSTANT 176             Y02076 56936502
VAMERR1  EQU   4                        WIJOURN ERR RET 4       ZA00617 56936602
ERRMSGC2 EQU   205                      VIO JOURNAL ERR 205     ZA00617 56939902
VAMSGTYP EQU   2                        MSG SHELL TYPE CODE     ZA00617 56941902
ERRMSGC1 EQU   204                      VIO JOURNAL ERR 204     ZA00617 56942302
*                                                                     * 56943402
*        MAINTENANCE SPACE                                            * 56946702
*                                                                     * 56950000
PATCH    DC    XL((*-IGC0Q06C)/20)'00'   FIVE PERCENT MAINTENANCE SPACE 56952000
         IEFQMIOP                                                Y02076 56952402
         IFGRPL                                                  Y02076 56952802
         IEFJESCT                                                Y02076 56953602
         IEZJSCB                                                 Y02076 56953702
*                                                                     * 56954000
*                                                                     * 56960018
*        MAPPING OF PARAMETER LIST FOR CHKPT                            57040018
*                                                                     * 57120018
CHKPTPML DSECT                                                          57200018
DCBADDR  DS    0F                                                       57280018
FLAGBYTE DS    CL1       INDICATES USER/SYS-GEN/SSS-GEN AND RETURN ID   57360018
DCBAD    DS    CL3       CHKPT D.S. DCB                                 57440018
IDADDR   DS    0F                                                       57520018
LUSERID  DS    CL1       LENGTH USER CHKID/RETURN SYSTEM-GEN CHKID      57600018
CHKIDADR DS    CL3       ADDR OF CHECKID                                57680018
CKCHR    EQU   128  INDICATES CHKPT WROTE OUT CHR                       57800017
*                                                                       57820018
*        MAPPING OF CHKPT SVRB AND EXTENDED SAVEAREA USED TO PASS       57840018
*        INFORMATION TO EXIT MODULE ON ERROR CONDITIONS.                57860018
*                                                                       57880018
HKPSECT  DSECT                                                          57900017
HKPSVRB  DS    24F       BASIC SECTION OF SVRB                          57980018
HKPGML2  DS    F         SAVE AREA FOR ERROR RETURN AND MESSAGE CODES   58060018
HKPGML   DS    F         N/A                                            58140018
HKPGMLAD DS    2F        N/A                                            58220018
HKPGLIST DS    2F        N/A                                            58300018
         DS    F         N/A                                            58380018
HKPTIOTL DS    H         LENGTH OF TIOT                                 58460018
HKPBUFL  DS    H         N/A                                            58540018
HKPTIOT  DS    0F                                                       58620018
HKPFLAG  DS    1C        FLAG BYTE                                      58700018
HKPCLOSE EQU   X'10'     INDICATES EXIT RTN MUST CLOSE CHKPT D.S.       58780018
HKPTIOAD DS    3C        ADDRESS OF TIOT                                58860018
HKPDCB   DS    0F                                                       58940018
HKPSP    DS    CL1       N/A                                            59020018
HKPDCBAD DS    3C        ADDRESS CHKPT DCB                              59100018
HKPSAVRN DS    F         N/A                                            59180018
*                                                                       59260018
*        ALTERNATE MAPPING OF CHKPT SVRB AND EXTENDED SAVE AREA USED    59340018
*        TO PASS INFORMATION TO MESSAGE MODULE TO BUILD WTO MESSAGE     59420018
*                                                                       59500018
CERSECT  DSECT                                                          59580018
CERSVRB  DS    24F       BASIC SECTION OF SVRB                          59660018
CERRETCD DS    H         RETURN CODE                                    59740018
CERMSGCD DS    H         MESSAGE CODE                                   59820018
CERMSGMD DS    2F        MODULE NAME FOR XCTL PARAMETER LIST            59900018
CERXCTL  DS    F         POINTER TO MODULE NAME FOR XCLL PARMLST        59980018
CERFLAG  EQU   CERXCTL   FLAG BYTE FROM CHKWA 'CKFLAG1' FOR COMMON      60060018
*                        ADDRESSING ON BOTH ERROR AND NORMAL ENTRY      60140018
CERJOBNM DS    2F        JOB NAME            FILLED WHEN ERROR BEFORE   60220018
CERCHKID EQU   CERJOBNM  OTHERWISE CONTAINS CHECKID                     60300018
CERDDNM  DS    2F        CHKPT D.S. DDNAME   CHR WAS WRITTEN            60380018
CERTIOAD DS    F         ADDR OF TIOT                                   60460018
CERDCBAD DS    F         ADDR OF CHKPT DCB                              60540018
CERMCLS  EQU   X'80'                                                    60700017
         IEEVCHWA VER=3                USE AOS2 VERSION OF WA           60850000
         CNOP  2,4                                                      61000017
CERSTOW  DS    6H    STOW PARAMETER LIST                                61200017
CERCLOSE DS    F    CLOSE'S PARAMETER LIST                              61400017
CERAD    DS    F                                                        61600017
         DCBD  DSORG=(BS,PO),DEVD=(DA,TA)                               65400017
TIOTSECT DSECT                                                          65600017
         IEFTIOT1                                                       65800017
UCBSECT  DSECT                                                          66000017
         IEFUCBOB                                                       66200017
CVTSECT  DSECT                                                          66400000
         CVT                                                            66450000
         IKJTCB                                                         66500000
NOID     EQU   X'80'     SIGNIFIES LAST WORD IN PARM LIST.              66600017
CHRWRTTN EQU   X'40'               CHR-WRITTEN FLAG              YM6511 66650002
CLOSEOPT EQU   128  OPTION BYTE FOR CLOSE'S PARM LIST.                  66800017
TAPE     EQU   X'80'     UCBTYP FIELD-INDICATES TAPE                    67000017
DEBBASIC EQU   32   LENGTH OF DEB'S BASIC SECTION.                      67200017
DEBNMEXT EQU   16   OFFSET IN DEB TO NUMBER-OF-EXTENTS FIELD.           67400017
TAEXT    EQU   4    LENGTH DEB DEVICE DEPENDENT SECTION FOR TAPE.       67600017
DAEXT    EQU   16   LENGTH DEB DEVICE DEPENDENT SECTION FOR DIR. ACC.   67800017
DEVTL    EQU   4    LENGTH OF UCBTYP FIELD IN UCB.                      68000017
CKTTRL   EQU   3    LENGTH OF JCTCKTTR FIELD IN JCT.                    68200017
PCPSP    EQU   254                                                      68400017
GR       EQU   60   OFFSET TO REG 15 IN SVRB REG SAVE AREA.             68600017
GR15     EQU   62   RBEXSAVE FIELD-OFFSET LOW ORDER 1/2 WORD IN REG 15. 68800017
IOCC     EQU   X'7F' SUCCESSFUL I/O COMPLETION CODE                     69000017
DDL      EQU   8     LENGTH OF TIOEDDNM FIELD                           69200017
IDL      EQU   8    LENGTH OF CHECKID FOR BPAM                          69400017
CKL      EQU   15   LENGTH OF CHKID FIELD IN JCT MINUS ONE              69600017
CKMSG1   EQU   32    INDICATES WTO MSG-NOT TAKEN                        69800017
CKMSG2   EQU   64                                                       70000017
CKERPG17 EQU   X'0311'                                                  70200017
CKERIO5  EQU   X'031A'             I/O ERROR ON STOW,MSG CODE = 26      70400017
CKERIO6  EQU   X'02'                                                    70600017
CKDCBOP  EQU   X'10'                                                    70800017
CKSPBKSZ EQU   8                                                        71000017
*                                                                       71004018
*        DECIMAL CONSTANTS, POSITIONS, LENGTH-CODES                     71008018
*                                                                       71012018
ZERO     EQU   0              DECIMAL - 0                               71016018
ONE      EQU   1                      - 1                               71020018
TWO      EQU   2                      - 2                               71024018
FOUR     EQU   4                      - 4                               71028018
DEC56    EQU   56                     - 56                              71032018
SPACE    EQU   C' '           BLANK                                     71036018
*                                                                       71040018
LENGTH1  EQU   7                                                        71044018
*                                                                       71048018
CERCKID1 EQU   CERCHKID+1                                               71052018
CKRETCD1 EQU   CKRETCOD+1                                               71056018
CERSTOW8 EQU   CERSTOW+8                                                71060018
TIOTUCB  EQU   TIOESTTB            UCB POINTER IN TIOT                  71064018
JCTCKID1 EQU   JCTCKIDT+1                                               71068018
CERRETC1 EQU   CERRETCD+1                                               71072018
DEBBAS1  EQU   DEBBASIC+1                                               71076018
SYNAD1   EQU   DCBSYNAD+1                                               71080018
CKSYNAD1 EQU   CKSYNAD+1                                                71084018
TIOTADD  EQU   HKPTIOAD-1                                               71088018
DCBADD   EQU   HKPDCBAD-1                                               71092018
SVAJCTA  EQU   CKERAS00                 AREA FOR SAVING JCT SVA  Y02076 71094002
*                                                                       71096018
LCODES   EQU   4         LENGTH OF RETURN AND MESSAGE CODE              71100018
LFLAG    EQU   1                   FLAGS                                71104018
LJOBNM   EQU   8                   JOBNAME                              71108018
LDDNM    EQU   8                   DDNAME                               71112018
LCHKID   EQU   15                  CHECKID                              71116018
LJCTMB   EQU   8                   JCT MBBCCHHR ADDRESS                 71120018
LSYNAD   EQU   3                   SYNAD                                71124018
LBLKSIZ  EQU   2                   BLOCKSIZE                            71128018
LMODNAME EQU   8                   MODULE NAME                          71132018
LJCT     EQU   4                   JCT                                  71136018
PERSUB   EQU   4         CONSTANT USED INSHIFT INSTR(= MULTIPLY BY 16)  71140018
LTTR     EQU   4                   TTR                                  71144018
*                                                                       71148018
*        HEXADECIMAL CONSTANTS (MASKS)                                  71152018
*                                                                       71156018
HEXZERO  EQU   X'00'               HEXADECIMAL - 0                      71160018
HEXONE   EQU   X'01'                           - 1                      71164018
MAINUCB  EQU   X'FF'               UCB ID FOR MAIN UCB                  71168018
 END                                                                    71200017
./  ADD  SSI=40190289,NAME=IHJACP70
*                                                                       00030020
         COPY  LCGASMSW                                                 00040000
*                                                                       00150020
IGC0S06C CSECT                                                          00200018
         TITLE 'IGC0S06C (IHJACP70) CHKPT MESSAGE MODULE'               00400018
*********************************************************************** 00450002
*                                                                     * 00700002
*TITLE   CHKPT MESSAGE MODULE                                         * 00900002
*                                                                     * 01200002
*STATUS  CHANGE LEVEL 000                                             * 01500002
*                                                                     * 01800002
*FUNCTION/OPERATION - IGC0S06C WILL DO THE FOLLOWING                  * 02100002
*                                                                     * 02150002
*   1.) ISSUE A GETMAIN FOR 160 BYTES (SUBPOOL 250) TO BE USED AS A   * 02400002
*       REGISTER SAVE AREA AND A MESSAGE AREA                         * 02700002
*                                                                     * 03000002
*   2.)  WRITE ONE OF THE FOLLOWING MESSAGES TO THE CONSOLE -         * 03300002
*        A.) IHJ000I CHKPT JJJJJJJJ (DDDDDDDD) NOT TAKEN (XXX)        * 03600002
*            WHERE                                                    * 03900002
*              JJJJJJJJ = JOBNAME                                     * 04200002
*              DDDDDDDD = DDNAME OF THE DD STATEMENT FOR THE CHKPT    * 04500002
*                         DATA SET                                    * 04800002
*              XXX      = ERROR MESSAGE CODE                          * 05100002
*            THIS MESSAGE IS ISSUED WHEN AN ENVIRONMENT ERROR IS      * 05400002
*            DISCOVERED BY ONE OF THE CHECKPOINT MODULES              * 05700002
*                                                                     * 06000002
*            IF THE ERROR CODE IS 001, INDICATING THAT AN INVALID     * 06300002
*            PARAMETER LIST HAD BEEN PASSED TO CHECKPOINT, THE DDNAME * 06600002
*            FIELD OF THE MESSAGE WILL BE BLANK.                      * 06900002
*                                                                     * 07200002
*        B.) IHJ001I JJJJJJJJ (DDDDDDDD,UUUUU,SSSSSS) INVLD CCCCCCCCCCC 07500017
*                                              CCCCC (XXX)            * 07800002
*            WHERE                                                    * 08100002
*              JJJJJJJJ = JOB NAME                                    * 08400002
*              DDDDDDDD = DDNAME                                      * 08700002
*              UUUUU    = UNIT NAME                                   * 09000002
*              SSSSSS   = VOLUME SERIAL NUMBER                        * 09300002
*              CCCCCCCC = CHECKID                                     * 09600002
*              XXX      = ERROR MESSAGE CODE                          * 09900002
*            THIS MESSAGE IS ISSUED WHEN AN ERROR OCCURS AFTER THE    * 10200002
*            CHECKPOINT HEADER RECORD HAS BEEN WRITTEN                * 10500002
*                                                                     * 10800002
*        C.) IHJ002I JJJJJJJJ (DDDDDDDD,UUUUU,SSSSSS) ERROR CCCCCCCCCCC 11100017
*                                              CCCCC  (XXX)           * 11400002
*            (SYMBOLS SAME AS IN MESSAGE B)                           * 11700002
*                                                                     * 12000002
*            THIS MESSAGE IS ISSUED WHEN A VALID CHECKPOINT ENTRY HAS * 12300002
*            BEEN WRITTEN BUT, EITHER AN I/O ERROR OCCURRED WHEN      * 12600002
*            IGC0Q06C TRIED TO WRITE THE UPDATED JCT BACK TO THE      * 12900002
*            SCHEDULER WORK AREA, OR ERRORS OCCURRED WHEN WIJOURN     * 12950002
*            MACRO WAS ISSUED TO CHECKPOINT VIO DATA SETS TO THE JOB  * 13000002
*            JOURNAL, OR AN ERROR OCCURRED WHEN RESTORING I/O REQUESTS* 13050002
*            THAT WERE PURGED IN IGC0506C.                            * 13100002
*                                                                     * 13200002
*        D.) IHJ005I JJJJJJJJ (DDDDDDDD,UUUUU,SSSSSS) ENQS  CCCCCCCCCCC 13500017
*                                              CCCCC                  * 13800002
*            (SYMBOLS SAME AS IN MESSAGE B)                           * 14100002
*                                                                     * 14400002
*            THIS MESSAGE INDICATES THAT A VALID CHECKPOINT ENTRY HAS * 14700002
*            BEEN WRITTEN AND NO ERRORS HAVE OCCURRED.  HOWEVER, THE  * 15000002
*            USER WAS ENQUEUED ON RESOURCES WHEN THE CHKPT WAS TAKEN  * 15300002
*            AND IS WARNED BY THIS MESSAGE THAT THE ENQUEUES WILL NOT * 15600002
*            BE RE-ESTABLISHED IF RESTART OCCURS.                     * 15900002
*                                                                     * 16200002
*            E.) IHJ004I JJJJJJJJ (DDDDDDDD,UUUUU,SSSSSS) CHKPT CCCCCCC 16500017
*                                              CCCCC                  * 16800002
*            (SYMBOLS SAME AS IN MESSAGE B)                           * 17100002
*                                                                     * 17400002
*            THIS MESSAGE INDICATES THAT A VALID CHECKPOINT ENTRY HAS * 17700002
*            BEEN WRITTEN AND NO ERRORS HAVE OCCURRED.                * 18000002
*                                                                     * 18300002
*   3.) IF A RESTORE ERROR WAS ENCOUNTERED, AFTER ANOTHER ERROR WAS   * 18350002
*       PREVIOUSLY SET, THE MODULE SETS UP THE MSG CODE (215) AND THE * 18400002
*       RETURN CODE (X'18), THEN PRINTS A SECOND MESSAGE.             * 18450002
*                                                                     * 18460002
*   4.) CLOSE THE CHKPT DATA SET IF CHKPT OPENED IT                   * 18500002
*                                                                     * 18700002
*   5.) FREE THE WORK AREA                                            * 18900002
*                                                                     * 19100002
*   6.) PLACE THE RETURN CODE IN REGISTER 15 AND RETURN (SVC 3) TO THE  19300002
*        USER                                                         * 19500002
*                                                                     * 19800002
*ENTRY POINTS  IGC0S06C VIA XCTL FROM IGC0Q06C                        * 20100002
*                                                                     * 20400002
*INPUT   1.) ADDRESS OF CHKPT'S SVRB IN REGISTER 1                    * 20700002
*                                                                     * 21000002
*        2.) RETURN CODE IN THE FIRST TWO BYTES OF THE SVRB EXTENDED  * 21300002
*            SAVE AREA, THAT IS: CERRETCD=(00XX) WHERE XX = RETURN    * 21600002
*            CODE 00,08,0C OR 18. IF CERRETCD=(18XX), THIS INDICATES  * 21650002
*            THAT A SECOND MESSAGE (RESTORE ERROR) MUST BE PRINTED.   * 21750002
*                                                                     * 21900002
*        3.) A MESSAGE CODE IN THE SECOND TWO BYTES OF THE SVRB       * 22200002
*            EXTENDED SAVE AREA                                       * 22500002
*                  MESSAGE       MESSAGE CODE BYTES (CERMSGCD)        * 22800002
*                     A              X'00XX' (XX=ERROR CODE IN HEX)   * 23100002
*                     B              X'03XX' (XX = ERROR CODE IN HEX) * 23400002
*                     C              X'02XX' (XX = ERROR CODE IN HEX) * 23700002
*                     D              X'0100'                          * 24000002
*                     E              X'0000'                          * 24300002
*                                                                     * 24350002
*        4.) FOR MESSAGE A, THE JOBNAME AND DDNAME WILL BE IN BYTES   * 24600002
*            16-31 OF THE EXTENDED SAVE AREA.  IF THE ERROR CODE IS 01, 24900017
*            THE DDNAME WILL NOT BE PRESENT                           * 25200002
*                                                                     * 25500002
*        5.) IF MESSAGE B,C,D, OR E IS TO BE ISSUED, BYTES 16 - 31    * 25800002
*            OF THE SVRB EXTENDED SAVE AREA WILL CONTAIN THE CHECKID, * 26100002
*            BYTES 32-35 THE TIOT ADDRESS.                            * 26500002
*        6.) ADDRESS OF THE DCB FOR THE CHKPT DATA SET WITH HIGH ORDER  26900017
*            BYTE SET TO X'80' IF CHKPT OPENED THE DCB.               * 27300002
*                                                                     * 27900002
*OUTPUT  RETURN CODE IN REGISTER 15 AND CONSOLE MESSAGE AS DESCRIBED  * 28200002
*        ABOVE                                                        * 28500002
*                                                                     * 28800002
*EXTERNAL ROUTINES  NONE                                              * 29100002
*                                                                     * 29400002
*SVCS USED  GETMAIN/FREEMAIN (SVC 10), WTO (SVC 35), CLOSE (SVC 20),  * 29600002
*           EXIT (SVC 3)                                              * 29800002
*                                                                     * 30000002
*EXITS-NORMAL RETURN TO CALLER OF CHKPT VIA SVC 3                     * 30300002
*     -ERROR  NONE                                                    * 30600002
*                                                                     * 30900002
*TABLES/WORKAREAS-CREATED  MSG1SECT AND MSG2SECT TO DESCRIBE THE MSGS.* 31200002
*                 -REFERENCED CERSECT,TCB,TIOT,UCB,DCB                * 31500002
*                                                                     * 31800002
*ATTRIBUTES  REENTRANT,SUPERVISOR STATE, TYPE 4 SVC ROUTINE           * 32100002
*                                                                     * 32400002
*RESTRICTIONS  NONE                                                   * 32700002
*                                                                     * 33000002
*NOTES  NONE                                                          * 33300002
*                                                                     * 33350002
*********************************************************************** 33400002
         EJECT                                                          33600017
R0       EQU   0                                                        33900017
R1       EQU   1                                                        34200017
R2       EQU   2                                                        34500017
R3       EQU   3                                                        34800017
R4       EQU   4                                                        35100017
R5       EQU   5                                                        35400017
R6       EQU   6                                                        35700017
R7       EQU   7                                                        36000017
R8       EQU   8                                                        36300017
R9       EQU   9                                                        36600017
RA       EQU   10                                                       36900017
RB       EQU   11                                                       37200017
RC       EQU   12                                                       37500017
RD       EQU   13                                                       37800017
RE       EQU   14                                                       38100017
RF       EQU   15                                                       38400017
         BALR  RB,ZERO             ESTABLISH MODULE BASE                38700018
         USING *,RB                                                     39000017
         B     BEGIN               BRANCH AROUND EYE CATCHER            39050000
         CNOP  0,8                 ALIGN TO A DOUBLE WORD BOUNDARY      39100000
         DC    C'IGC0S06C'         CSECT NAME                           39150000
BEGIN    EQU   *                                                        39200000
         LR    R9,R1               GET SVRB ADDRESS FROM R1             39300017
         USING CERSECT,R9          ESTABLISH ADDRESSABILITY             39600017
         L     R0,CMGETLN          LOAD LENGTH OF MESSAGE AREA          39900017
         GETMAIN   R,LV=(0)                                             40200017
         LR    RD,R1               GET ADDRESS OF AREA TO FREE          40400017
BEGIN2   EQU   *                   'BRANCH TO' PT. FOR 2ND MSG   Y02076 40450002
         LA    R8,CON72(ZERO,RD)   SAVE AREA+72 = MSG. AREA             40600002
         MVI   ZERO(R8),SPACE      BLANK OUT                            40800018
         MVC   ONE(CON87,R8),ZERO(R8)   MESSAGE AREA                    41000018
         CLI   CERRETC1,HEXZERO    IS THE RETURN CODE 0                 41200018
         BE    CMMSG2              BRANCH IF YES TO ISSUE TYPE 2 MSG.   41700017
         CLI   CERMSGCD,HEXZERO    IS TYPE 2 MSG. INDICATED             42000018
         BNE   CMMSG2              BRANCH IF YES                        42300017
         SPACE                                                          42600017
*  MESSAGE A IS TO BE ISSUED, JOBNAME AND DDNAME ARE IN BYTES 16-31     42900017
*  OF THE SVRB EXTENDED SAVE AREA                                       43200017
         SPACE                                                          43500017
         USING MSG1SECT,R8                                              43800017
         MVC   MSG1LN(PLIST1LN),CMNOTMSG     MOVE IN MSG. 1 SHELL       44100018
         MVC   MSG1JOBN(8),CERJOBNM    MOVE JOB NAME TO MESSAGE         44400017
         CLI   CERMSGC1,HEXONE     BAD PARAMETER LIST ERROR             44700018
         BE    CMGOCNV             BRANCH IF YES--DDNAME NOT AVAILABLE  45000017
         MVC   MSG1DDNM(8),CERDDNM     MOVE DDNAME TO MESSAGE           45300017
CMGOCNV  BAL   R3,CMCVD            GO TO CONVERT CODE TO EBCDIC         45600017
         MVC   MSG1CODE(THREE),MSG1WK1N    MOVE CODE TO MESSAGE  Y02076 45900002
CMWTO    LR    R1,R8               SET UP R1 FOR WTO                    46200017
         WTO   ,MF=(E,(1))         ISSUE WTO                            46500017
*********************************************************************** 46510002
*  IF RESTORE ERROR, SET IN N06C, WAS DETECTED AFTER A PREVIOUS ERROR * 46520002
*  WAS ENCOUNTERED, SET UP FOR PRINTING A SECOND MSG (215).           * 46530002
*********************************************************************** 46540002
CMTWOMSG CLI   CERRETCD,RESTERR    TEST IF RESTORE ERROR         Y02076 46542002
         BNE   CEROPTST            BRANCH IF NOT                 Y02076 46544002
         MVI   CERMSGCD,CMERRID    SET 'ERROR' MSG CODE(2)       Y02076 46546002
         MVI   CERMSGC1,RESTMSGC   SET RESTORE ERROR(215)        Y02076 46548002
         MVI   CERRETCD,HEXZERO    ZERO FIRST BYTE-RET CODE      Y02076 46548402
         MVI   CERRETC1,RESTERR    SET RET CODE (X'18')          Y02076 46548802
         B     BEGIN2              GO ISSUE RESTORE ERR MSG      Y02076 46549202
CEROPTST EQU   *                   PREPARE FOR EXIT              Y02076 46549602
         L     R4,CERDCBAD         LOAD DCB ADDRESS              Y02076 46549702
         USING IHADCB,R4           ADDRESS DCB                   YM3983 46559702
         TM    DCBOFLGS,CKDCBOP    IS CHKPT D/S OPEN             YM3983 46570002
         BZ    CERFREEM            IF NOT, GO FREEMAIN & EXIT    YM3983 46580002
         L     R5,DCBDEBAD         FETCH DEB ADDRESS             YM5921 46580502
         LA    R6,DEBBASIC-DEB     GET PREFIX LENGTH             YM5921 46581002
         SR    R5,R6               POINT TO DEB PREFIX           YM5921 46581502
         USING DEB,R5              ADDRESS DEB PREFIX            YM5921 46582002
         L     R7,DEBTCBAD         FETCH TCB ADDRESS             YM5932 46582102
         USING TCB,R7              ADDRESS TCB                   YM5932 46582202
         L     R6,DEBXTNP          FETCH DEB EXT ADDRESS         YM5921 46582502
         USING DEBXTN,R6           ADDRESS DEB EXTENSION         YM5921 46583002
         L     R6,DEBXDSAB         FETCH DSAB ADDRESS            YM5921 46583502
         USING DSAB,R6             ADDRESS DSAB                  YM5921 46584002
         LR    R1,R4               INIT CLOSE DCB ADDR           YM5921 46584502
*                                                                     * 46584602
*********************************************************************** 46584702
*                                                                     * 46584802
*        TEST FOR SECURITY INTERFACE. IF ONE EXISTS, UPDATE THE       * 46584902
*        USER'S DCB BEFORE RETURNING TO HIM.                          * 46585102
*                                                                     * 46585202
*********************************************************************** 46585302
*                                                                     * 46585402
         TM    DSABFLG4,DSABCKSI   DOES S/I EXIST                YM5921 46585802
         BZ    CERNOTSI            IF NOT, BRANCH                YM5921 46585902
         CLM   R1,M7,DEBDCBB       IF ADDRESSES MATCH, R1 IS     YM6560 46587902
         BNE   CERUSER             POINTING TO THE PROTECTED     YM6560 46588302
*                                  DCB - OTHERWISE, IT ALREADY   YM6560 46588702
*                                  POINTS TO THE USER DCB        YM6560 46589102
         LA    RF,FOUR             GET ADDR OF USER DCB ADDR VIA YM5921 46589202
         SR    R1,RF               PROTECTED DCB ADDR -4         YM5921 46590402
         L     R1,0(,R1)           FETCH USER'S DCB ADDR         YM5921 46591602
CERUSER  EQU   *                   R1 = USER DCB ADDR            YM6560 46591702
         TM    CERDCBAD,CHRWRTTN   HAS A CHR BEEN WRITTEN        YM6560 46592002
         BZ    CERNOTSI            IF NOT, SKIP USER DCB UPDATE  YM6560 46592402
         MODESET KEYADDR=TCBPKF,WORKREG=10 ASSUME CALLER KEY     YM5932 46592802
         MVC   DCBRELAD-IHADCB(LUPDATE1,R1),DCBRELAD UPDATE USER YM5921 46594002
         MVC   DCBDEBAD-IHADCB(L'DCBDEBAD,R1),DCBDEBAD DCB       YM5921 46595202
         MODESET EXTKEY=ZERO       RESUME KEY ZERO               YM5932 46596402
CERNOTSI EQU   *                   NON-S/I ENTRY                 YM5921 46597602
         TM    CERDCBAD,CERMCLS    DID CHKPT OPEN DATA SET              46598802
         BZ    CERFREEM            IF NOT, GO FREEMAIN & EXIT    Y02083 46600002
         ST    R1,CERDCBAD         UPDATE CLOSE DCB ADDR         YM5921 46600502
         TM    DEBOFLGS,DBMOD      IS THIS A MOD DATA SET        YM5744 46632002
         BO    CERNOTMD            BRANCH IF NOT MOD                    46640018
         MVI   CERDCBAD,CERLEAVE   FOR A MOD DATA SET, CLOSE OPTION     46648018
*                                  IS LEAVE                             46656018
         B     CERCLOSE            GO CLOSE DATA SET                    46664018
CERNOTMD EQU   *                                                        46672018
         MVI   CERDCBAD,CERRWIND   CLOSE OPTION IS REWIND               46680018
CERCLOSE EQU   *                                                        46688018
         MODESET KEYADDR=TCBPKF,WORKREG=10 ASSUME CALLER KEY     YM5932 46698002
         CLOSE MF=(E,CERDCBAD)                                          46700017
         MODESET EXTKEY=ZERO       RESUME KEY ZERO               YM5744 46710002
CERFREEM EQU   *                                                        46750017
         L     R0,CMGETLN          GET LENGTH TO FREE                   46800017
         LR    R1,RD               ADDRESS OF AREA TO BE FREED          47100017
         FREEMAIN  R,LV=(0),A=(1)                                       47400017
         LH    RF,CERRETCD         LOAD RETURN CODE                     47700017
         SVC   3                   RETURN TO CALLER                     48000017
*                                                                     * 48050002
         DROP  R4,R5,R6,R7         DCB, DEB, DSAB, & TCB         YM5932 48396402
         EJECT                                                          48399902
*  THIS ROUTINE CONVERTS THE TWO BYTE ERROR CODE TO A PRINTABLE         48600017
*  FORMAT.  IT IS ENTERED WHEN MESSAGE A OR B IS TO BE ISSUED.  THE     48900017
*  DOUBLE WORD BEGINNING AT MSG1WORK+80 IS USED IN THE CVD INSTRUCTION. 49200017
*  SINCE THE DISPLACEMENTS OF MSG1WORK+80 AND MSG2WORK+80 FROM THE      49500017
*  BEGINNING OF THE MESSAGE AREA ARE EQUAL, THE ROUTINE MAY BE USED IN  49800017
*  BOTH CASES                                                           50100017
CMCVD    EQU   *                                                        50400017
         SR    R4,R4               CLEAR REGISTER 4                     50600017
         IC    R4,CERMSGCD+1       GET ERROR CODE                       50800017
         CVD   R4,MSG1WORK                                              51000017
         UNPK  MSG1WK1N(THREE),MSG1WK6(TWO)       UNPACK TWO BYTE CODE  51300018
         OI    MSG1WK1,EBCDICMK    CONVERT SECOND BYTE TO EBCDIC        51600018
         BR    R3                                                       51900017
         EJECT                                                          52200017
*  MESSAGE B, C, D, OR E IS TO BE ISSUED.  THE JOBNAME AND DDNAME ARE   52500017
*  TAKEN FROM THE TIOT, THE UNIT NAME AND VOLUME SERIAL NUMBER FROM     52800017
*  THE UCB AND THE CHECKID FROM BYTES 16-31 OF THE SVRB EXTENDED SAVE   53100017
*  AREA.                                                                53400017
         SPACE                                                          54000017
         DROP  R8                                                       54300017
CMMSG2   EQU   *                                                        54600017
         USING MSG2SECT,R8                                              54900017
         CLI   CERMSGCD,CMNVLDID   Q. INVALID CHECKPT                   55100018
         BE    CMMVIMSG            YES--BRANCH TO USE INVLID MSG SHELL  55300018
         CLI   CERMSGCD,CMERRID    IS IT 'ERROR' MSG             Y02076 55350002
         BE    CMMVIMSG            USE INVLD SHELL IF YES        Y02076 55400002
         MVC   MSG2LN(PLIST2LN),CMMESG2 NO--MOVE IN MSG2 SHELL          55500018
CMTIOTAD EQU   *                                                        55700018
         L     R6,CERTIOAD         GET ADDRESS OF TIOT                  56100017
         USING TIOTSECT,R6                                              56700017
         MVC   MSG2JOBN(LJOBNM),TIOCNJOB     MOVE JOBNAME TO MESSAGE    56900018
         L     R4,CERDCBAD         GET ADDRESS OF DCB                   57100017
         USING IHADCB,R4           ADDRESS DCB                   YM5921 57100502
         AH    R6,DCBTIOT          GET POINTER TO DD ENTRY              57300017
         USING TIOELNGH,R6                                              57600017
         MVC   MSG2DDNM(8),TIOEDDNM                                     57900017
         L     R6,TIOEFSIN         GET THE UCB ADDRESS                  58200018
CMGOTMN  EQU   *                                                        61800017
         USING UCBSECT,R6                                               62100017
         MVC   MSG2VOL(LVOLSER),SRTEVOLI     MOVE VOL. SER. NR. TO MSG  62200018
CMMVNAME EQU   *                                                        62300017
         MVC   MSG2UNIT(LUNITNM),UCBNAME     MOVE UNIT NAME TO MESSAGE  62700018
         MVC   MSG2CHID(LCHKID),CERCHKID     MOVE CHECK ID TO MESSAGE   63100018
         CLI   CERRETC1,HEXZERO    IS RETURN CODE = 0                   63500018
         BE    CMWTO               BRANCH TO WTO AND RETURN      A45624 63800000
CMCHKENQ EQU   *                                                        65700017
         CLI   CERMSGCD,CMENQID    Q. POSSIBLE ERROR INDICATED          66000017
         BNE   CMWTO               BRANCH IF NOT TO WTO--INVLD MSG      66200018
*                                  SHELL COMPLETE                       66400018
         MVC   MSG2DISP(LDISP),CMENQS        DISPOSITION = ENQS         66600018
         MVI   MSG2MCOD,MSGCD5     MOVE IN MESSAGE CODE                 66900018
         B     CMWTO               BRANCH TO WTO AND RETURN             67200018
CMMVIMSG EQU   *                                                        67800018
         MVC   MSG2LN(PLIST3LN),CMNVMSG MOVE IN INVLD MSG SHELL         68400018
         CLI   CERMSGCD,CMERRID    IS IT 'ERROR' MSG             Y02076 68450002
         BNE   CMMVIM2             BRANCH IF NO                  Y02076 68500002
         MVC   MSG2LN+MSGDESOF(LDISP),CMERROR  MOVE CHARS 'ERROR'Y02076 68550002
         MVI   MSG2LN+MSGNUMOF,MSGCD2     MOVE IN MSG. NO.       Y02076 68650002
CMMVIM2  EQU   *                   BRANCH TO CONVERT             Y02076 68750002
         BAL   R3,CMCVD            GET ERROR CODE CONVERTED TO EBCDIC   69000018
         MVC   MSG2CODE(THREE),MSG2WORK  MOVE ERROR CODE TO MSG  Y02076 69600002
         B     CMTIOTAD            BRANCH TO FILL IN SHELL              70200018
         DS    0F                                                       71100017
CMGETLN  DC    X'FD0000A0'         GETMAIN PARAMETER FOR MESSAGE WA     71200000
*                                  SUBPOOL 253, LENGTH=160 BYTES        71300000
*                                                                       71400018
*        PARAMETER LIST FOR WTO FOR UNSUCCESSFUL CHKPT                  71500018
*                                                                       71600018
         SPACE                                                          71700018
* SET UP PARAMETER LISTS FOR WTO *                                      71800018
         SPACE                                                          71900018
* MSG1 FORMAT = IHJ000I CHKPT JOBNAME  (DDNAME  ) NOT TAKEN (XXX)       72000002
CMNOTMSG WTO   'IHJ000I CHKPT          (        ) NOT TAKEN (   )',    *72100002
               MF=L,DESC=(6),ROUTCDE=(2,11)                             72200018
*                                                                       72300018
*        SUCCESSFUL CHKPT CONSOLE MESSAGE                               72400018
*                                                                       72500018
         SPACE                                                          73200017
         SPACE                                                          73500017
* MSG2 FORMAT = IHJ004I JOBNAME  (DDNAME  ,UNIT=,VOLSER) CHKPT CHKID    73600018
CMMESG2  WTO   'IHJ004I          (        ,     ,      ) CHKPT         *73700018
                       ',MF=L,DESC=(6),ROUTCDE=(2,11)                   73800018
         SPACE                                                          73900018
         SPACE                                                          74000018
* MSG3 FORMAT=IHJ001I JOBNAME  (DDNAME  ,UNIT=,VOLSER) INVLD CHKID(XXX) 74100002
CMNVMSG  WTO   'IHJ001I          (        ,     ,      ) INVLD         *74200018
                        (   )',MF=L,DESC=(6),ROUTCDE=(2,11)      Y02076 74300002
         SPACE                                                          74400018
CMERROR  DC    C'ERROR'                                                 75000017
CMENQS   DC    C'ENQS '                                                 75300017
PLIST1LN EQU   57                  NO. OF BYTES - MSG1           Y02076 75400002
PLIST2LN EQU   71                  NO. OF BYTES - MSG2                  75500002
PLIST3LN EQU   77                  NO. OF BYTES - MSG3           Y02076 75600002
MSGDESOF EQU   45                  OFFSET TO DESCRIPTOR          Y02076 75650002
MSGNUMOF EQU   9                   OFFSET TO MSG NO.             Y02076 75660002
RESTERR  EQU   X'18'               RESTORE ERROR RET. CODE       Y02076 75670002
RESTMSGC EQU   215                 RESTORE ERROR MSG. CODE       Y02076 75680002
CMNVLDID EQU   3                                                        75700018
CMERRID  EQU   2                   MESSAGE ID IHJ002I(I/O ERROR JCT)    76100018
CMENQID  EQU   1                   MESSAGE ID IHJ001I(OUTSTANDING ENQ)  76200018
*                                                                     * 76250000
*        MAINTENANCE SPACE                                            * 76260000
*                                                                     * 76270000
PATCH    DC    XL((*-IGC0S06C)/20)'00'   FIVE PERCENT MAINTENANCE SPACE 76280000
*                                                                     * 76290000
*                                                                       76300018
*        MAPPING OF CHKPT SVRB AND EXTENDED SAVE AREA USED TO PASS      76400018
*        INFORMATION TO BUILD WTO MESSAGE                               76500018
*                                                                       76600018
CERSECT  DSECT                                                          76800017
CERSVRB  DS    24F                 BASIC SECTION                        76900018
CERRETCD DS    0H                  RETURN CODE                          77000018
         DS    CL1                                                      77100018
CERRETC1 DS    CL1                                                      77200018
CERMSGCD DS    0H                  MESSAGE ERROR CODE                   77300018
         DS    CL1                                                      77400018
CERMSGC1 DS    CL1                                                      77500018
CERMSGMD DS    2F                  N/A                                  77600018
CERXCTL  DS    F                   N/A                                  77700018
CERFLAG  EQU   CERXCTL                                                  78600017
CERJOBNM DS    2F                  MESSAGE A-JOBNAME                    78900017
CERDDNM  DS    2F                  MESSAGE A-DDNAME                     79200017
CERCHKID EQU   CERJOBNM            MESSAGE B-E CHECKID                  79500017
CERTIOAD DS    F                   MESSAGE B-E TIOT ADDRESS             79600017
CERDCBAD DS    F                   DCB ADDRESS                          79700017
CERMCLS  EQU   X'80'               CHKPT OPENED DATA SET                79800017
CERLEAVE EQU   X'B0'                                                    79900018
CERRWIND EQU   X'90'                                                    80000018
DBOFLAGS EQU   8                                                        80100018
DBMOD    EQU   X'40'                                                    80200018
         SPACE                                                          80400017
*  THE FOLLOWING DSECT DESCRIBES MESSAGE A                              80700017
         SPACE                                                          81000017
MSG1SECT DSECT                                                          81300017
MSG1LN   DS    F                   WTO PARMLST (LENGTH AND 2 BYTES 0)   81500018
MSG1BGIN DS    14C                 BASIC SECTION MSG                    81700018
MSG1JOBN DS    8C                  JOB NAME                             81900018
         DS    2C                  SEPARATORS (, )                      82100018
MSG1DDNM DS    8C                  CHKPT DS DDNAME                      82300018
         DS    2C                  SEPARATORS (, )                      82500018
MSG1NTTK DS    11C                 MESSAGE 'NOT TAKEN'                  82700018
MSG1CODE DS    2C                  ERROR MESSAGE IDENTIFIER CODE Y02076 82900002
MSG1CDE2 DS    1C                                                       83100018
MSG1WORK EQU   MSG1LN+80                                                84000017
MSG1WK1  EQU   MSG1LN+81                                                84070018
MSG1WK6  EQU   MSG1LN+86                                                84140018
MSG1WK1N EQU   MSG1LN+79                                                84210018
         SPACE                                                          84300017
*THE FOLLOWING DSECT DESCRIBES MESSAGES B-E                             84600017
         SPACE                                                          84900017
MSG2SECT DSECT                                                          85200017
MSG2LN   DS    F                   WTO PARMLST (LENGTH AND 2 BYTES 0)   85400018
MSG2BGIN DS    5C                  BASIC SECTION WTO MESSAGE IDENTIFIER 85600018
MSG2MCOD DS    1C                                                       85800018
         DS    2C                  CONSTANTS 'I '                       86000018
MSG2JOBN DS    8C                  JOB NAME                             86200018
         DS    2C                  SEPARATORS (, )                      86400018
MSG2DDNM DS    8C                  CHKPT DS DDNAME                      86600018
         DS    1C                  COMMA                                86800018
MSG2UNIT DS    CL3                 CHKPT ENTRY UNIT NO.                 87000018
MSG2UT3  DS    CL1                 SLASH WHEN CHKPT DS ON 2321          87200018
MSG2UT4  DS    CL2                 BIN NO FOR 2321 DATA CELL            87400018
MSG2VOL  DS    6C                  VOLUME SERIAL NO OF CHKPT ENTRY      87600018
         DS    2C                  SEPARATORS ') '                      87800018
MSG2DISP DS    5C                  CONSTANT 'CHKPT'                     88000018
         DS    1C                  BLANK                                88200018
MSG2CHID DS    16C                 CHECKID                              88400018
         DS    1C                  BLANK                                88600018
MSG2PRNS DS    1C                  LEFT PAREN                           88800018
MSG2CODE DS    3C                  ERROR MESSAGE CODE            Y02076 89000002
         DS    1C                  RIGHT PAREN                          89200018
MSG2WORK EQU   MSG2LN+79           MESSAGE 2 WORK AREA           Y02076 91200002
TIOTSECT DSECT                                                          91500017
         IEFTIOT1                                                       91800017
UCBSECT  DSECT                                                          92100017
         IEFUCBOB                                                       92400017
         DCBD  DSORG=(PS,PO),DEVD=(TA,DA)                               92800017
LUPDATE1 EQU   DCBTRBAL-IHADCB+L'DCBTRBAL LENGTH OF 1ST DCB UPDT Y02083 92802002
         IEZDEB                                                  Y02083 92804002
         IHADSAB                                                 Y02083 92804402
         IKJTCB                                                  YM5932 92804902
*                                                                       92805018
*        DECIMAL CONSTANTS, CODES, POSITIONS, LENGTHCODES.              92810018
*                                                                       92815018
ZERO     EQU   0                   DECIMAL   0                          92820018
ONE      EQU   1                             1                          92825018
TWO      EQU   2                             2                          92830018
THREE    EQU   3                             3                          92835018
FOUR     EQU   4                             4                          92840018
FIVE     EQU   5                             5                          92845018
CON16    EQU   16                            16                         92850018
CON56    EQU   56                            56                         92855018
CON72    EQU   72                            72                         92860018
CON87    EQU   87                            87                         92865018
*                                                                       92870018
SPACE    EQU   C' '                SPACE                                92875018
SLASH    EQU   C'/'                SLASH                                92880018
MSGCD1   EQU   C'1'                CODE 1                               92885018
MSGCD2   EQU   C'2'                CODE 2                               92890018
MSGCD5   EQU   C'5'                CODE 5                               92895018
*        POSITIONS IN RELATION TO PREVIOUSLY DEFINED AREAS              92900018
TIOEFSIN EQU   TIOEFSRT-1          *                                    92905018
*                                                                       92915018
LMSG2SHL EQU   46        LENGTH OF MESSAGE2 SHELL                       92920018
LJOBNM   EQU   8                   JOB NAME                             92925018
LVOLSER  EQU   6                   VOLUME SERIAL NUMBER                 92930018
LUNITNM  EQU   3                   UNIT NAME                            92935018
LCHKID   EQU   16                  CHECK ID                             92940018
LDISP    EQU   5                   DISPOSITION                          92945018
LPRNS    EQU   4                   PARENTHESIS FIELD                    92950018
LERRCD   EQU   2                   ERROR CODE                           92955018
*                                                                       92960018
*        HEXADECIMAL CONSTANTS, MASKS                                   92965018
*                                                                       92970018
HEXZERO  EQU   X'00'               HEXADECIMAL  0                       92975018
HEXONE   EQU   X'01'               HEXADECIMAL  1                       92980018
EBCDICMK EQU   X'F0'               EBCDIC MASK                          92985018
MUCBMK   EQU   X'FF'               MAIN UCB MASK                        92990018
CKDCBOP  EQU   X'10'               DCB OPEN TEST MASK            YM3983 92992002
CHRWRTTN EQU   X'40'               CHR-WRITTEN FLAG              YM6511 92994002
M7       EQU   7                   REG MASK FOR LO-ORDER 3 BYTES YM6560 92994402
*                                                                       92995018
         END                                                            93000017
./  ADD  SSI=81150472,NAME=IHJARS00
*                                                                       00150000
  TITLE 'IGC0005B (IHJARS00) SVC 52 -- RESTART HOUSEKEEPING ROUTINE 1'  00500002
IGC0005B CSECT                                                          00700002
*********************************************************************** 00700402
*                                                                     * 00750002
*ROUTINE NAME    IGC0005B     RESTART HOUSEKEEPING ROUTINE 1          * 00900002
*                                                                     * 00950002
*STATUS - CHANGE LEVEL 000                                            * 01200002
*                                                                     * 01220002
*FUNCTION/OPERATION - 1.)  GET A WORK AREA OF THE SAME SIZE AS THE    * 01500002
*                          CHKPT WORK AREA.                           * 01800002
*                                                                     * 02100002
*                     2.)  INITIALIZE THE RESTART WORK AREA WITH      * 02400002
*                          INFORMATION PASSED FROM DSDR PROCESSING.   * 02700002
*                                                                     * 02750002
*                     3.)  IF ANY OF THE FOLLOWING ERRORS ARE         * 02760002
*                          ENCOUNTERED, THE INDICATED ERROR MESSAGE   * 02770002
*                          CODE IS SET AND CONTROL IS TRANSFERRED     * 02790002
*                          TO IGC0V05B.                               * 02792002
*                             CODE   ERROR TYPE                       * 02842002
*                              216   REGION START ADDR NOT=CURRENT    * 02892002
*                                    TOP OF REGION                    * 02942002
*                              023   I/O ERROR READING STEP CONTROL   * 02992037
*                                    TABLE(SCT) FROM SCHEDULER WORK   * 02994002
*                                    AREA(SWA)                        * 02998002
*                              203   ILLEGAL CALL TO RESTART          * 02998402
*                                    (SCTSYSCK BIT IN STEP CONTROL    * 02998802
*                                    TABLE NOT SET)                   * 02999202
*                              002   INCORRECT V=R STATUS BETWEEN     * 02999602
*                                    CHECKPOINT AND RESTART           * 02999702
*                                                                     * 03000002
*                     4.)  CONSTRUCT A DCB FOR THE CHKPT DATA SET.    * 04200002
*                                                                     * 04500002
*                     5.)  OPEN THE CHKPT DATA SET.                   * 04800002
*                                                                     * 05100002
*ENTRY POINT - IGC0005B                                               * 05400002
*                                                                     * 05450002
*INPUT - ADDRESS OF THE FOLLOWING PARAMETER LIST WILL BE PASSED IN    * 05700002
*        REGISTER 1.                                                  * 06000002
*    NAME     LNGTH   DESCRIPTION                                     * 06050002
*    REPCIRAD   4     TTR OF 1ST CIR                                  * 06100002
*    REPCOUNT   2     NO. OF CHKPTS TAKEN                             * 06150002
*    REPCKIDL   2     LENGTH OF CHECKID                               * 06200002
*    REPCHKID  16     CHECKID                                         * 06250002
*    REPDDNM    8     DDNAME OF CHKPT D/S USED FOR RESTART            * 06260002
*    REPPPM     4     LO ORDER ADDR OF P/P AREA                       * 06270002
*    REPPPE     4     SIZE OF P/P AREA                                * 06280002
*    REPBLKSI   2     CHKPT D/S BLOCK SIZE                            * 06290002
*    REPTIOTL   2     LENGTH OF TIOT                                  * 06292002
*    REPFLAGS   1     CHECKPOINT FLAGS 1                              * 06294002
*                     X'80' - AUTO RESTART                            * 06296002
*                     X'40' - TRACK OVERFLOW SPECIFIED                * 06298002
*                     X'20' - CHKPT D/S ON TAPE                       * 06298402
*                     X'10' - USER AUTH FOR MODESET                   * 06298802
*                     X'08' - V=R REQUEST                             * 06299202
*                     X'02' - CHECKPOINT ISSUED OPEN                  * 06299602
*                     X'01' - CHECKPOINT D/S OPEN FOR BPAM            * 06299702
*    REPWACL    3     CHECKPOINT WORK AREA LENGTH                     * 06299802
*    REPFLAG2   1     CHECKPOINT FLAGS 2                              * 06299902
*                     X'04' - USER SUPPLIED CHECKID                   * 06349902
*                                                                     * 06399902
*OUTPUT - ADDRESS OF RESTART WORK AREA WILL BE IN REGISTER 1.         * 10800002
*                                                                     * 10850002
*EXTERNAL ROUTINES - QMNGRIO                                          * 11100002
*SVCS USED - GETMAIN                                                  * 11400002
*            FREEMAIN                                                 * 11700002
*            XCTL                                                     * 12000002
*            OPEN                                                     * 12300002
*            TESTAUTH                                                 * 12350002
*                                                                     * 12400002
*EXITS-NORMAL  XCTL TO IGC0205B WITH ADDR OF RSTRT W.A. IN            * 12600002
*             REGISTER 1.                                             * 12900002
*                                                                     * 12910002
*EXITS-ERROR  XCTL TO IGC0V05B WITH ADDR OF RSTRT W.A. IN REG 1,      * 12950002
*             AND ERROR CODE IN RSRETCOD                              * 13000002
*                                                                     * 13050002
*TABLES/WORK AREAS-  RSTWA IS THE FIRST PART OF THE RESTART WORK AREA.* 13200002
*                  THIS ROUTINE FILLS IN RSTWA WITH INFORMATION THAT  * 13500002
*                  IS USED BY OTHER RESTART ROUTINES.                 * 13800002
*                  TABLES - DCB,TIOT,TCB,PSA,ASCB,LDA,PQE,CVT,SCT,    * 13850002
*                           DSAB,QDB,JSCB,QMIOP,JESCT,RESTART         * 13900002
*                           SVRB+EXTENDED SAVE AREA,RESTART PARM LIST * 14000002
*                                                                     * 14060002
*ATTRIBUTES - REENTRANT, SUPERVISOR STATE, TYPE 4 SVC ROUTINE.        * 14100002
*                                                                     * 14150002
*RESTRICTIONS ON USE OF ROUTINE - VS/2-2 ONLY                         * 14400002
*                                                                     * 14450002
*   CHANGES FOR RELEASE 3.7                                             14530037
*A762100,C447000,C615000                                       @ZA18280 14610037
* APAR OZ31477 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 14650037
*A176500,176700-177000,196507-196513,387665-387685,562000      @ZSUT222 14660037
*C029920,178690,387695,796500,797100                           @ZSUT222 14670037
*D387705                                                       @ZSUT222 14680037
*NOTES - NONE.                                                        * 14700002
*********************************************************************** 14750002
         EJECT                                                          14800002
         BALR  RB,ZERO             SET UP MODULE ADDRESSABILITY         15000018
         USING *,RB                                                     15300018
         B     BEGIN               BRANCH AROUND EYE CATCHER            15350000
         CNOP  0,8                 ALIGN TO A DOUBLE WORD BOUNDARY      15400000
         DC    CL8'IGC0005B'       MODULE NAME                 @ZSUT222 15450037
         DC    CL8'&SYSDATE'       LAST DATE SHIPPED           @ZSUT222 15460037
         DC    CL8'@ZSUT222'       LAST CODE SHIPPED           @ZSUT222 15470037
BEGIN    EQU   *                                                        15500000
         USING RSTSECT,R5          ADDRESS RESTART WORK AREA.           16200017
*                                                                     * 16205002
*********************************************************************** 16210002
*                                                                     * 16215002
*        THIS SECTION WILL GET CORE FOR THE RESTART WORK AREA.        * 16220002
*                                                                     * 16225002
*********************************************************************** 16230002
*                                                                     * 16235002
         LH    R0,MINWALN          PRELOAD MINIMUM WA SIZE       YM7063 16240002
         LTR   R1,R1               PARM ANCHOR VALID             YM7063 16245002
         BZ    RSGETWA             IF NOT, USE MINIMUM SIZE      YM7063 16250002
         ICM   R3,ICMMSK,0(R1)     GET/TEST PARM ADDR            YM7063 16255002
         BZ    RSGETWA             IF ZERO, USE MINIMUM SIZE     YM7063 16260002
         USING PARMSECT,R3         ADDRESS PARM FIELD            YM6541 17450002
         CLM   R0,ADDRBYTS,REPWACL WAS MORE THAN MINIMUM PASSED  YM7063 17510002
         BNL   RSGETWA             IF NOT, USE MINIMUM SIZE      YM7063 17520002
         ICM   R0,ADDRBYTS,REPWACL USE LENGTH PASSED BY CALLER   YM7063 17550002
RSGETWA  ICM   R0,HIBYTE,SP253     INSERT SUBPOOL NUMBER         YM7063 17600002
         LR    RD,R0               SAVE THE LENGTH REQUESTED   @ZSUT222 17650037
         GETMAIN  R,LV=(R0)        OBTAIN WORK AREA              YM6541 17660037
         SR    R8,R8               CLEAR REG 8                 @ZSUT222 17670037
         SR    R9,R9               CLEAR REG 9                 @ZSUT222 17680037
         LR    RC,R1               BEGIN ADDRESS TO CLEAR      @ZSUT222 17690037
         MVCL  RC,R8               CLEAR THE GOTTEN STORAGE    @ZSUT222 17700037
         LR    RC,R1               RELOAD ADDR OF THE WORKAREA   YM6541 17710037
         USING RSTWA,RC            ADDRESS RESTART WORKAREA      YM6541 17720037
         ST    R4,RSTCBAD          SAVE TCB ADDRESS              YM7063 17805002
         USING TCB,R4              ADDRESS TCB                   YM7063 17810002
         LA    R2,RSTIOT-RSTWA     SETUP TEMPORARY               YM7063 17815002
         ST    R2,RSBFOFST           SUB-WORKAREA FOR            YM7063 17820002
         AR    R2,RC                   POSSIBLE ERROR PROCESSING YM7063 17825002
*                                                                YM7063 17830002
*****************************************************************YM7063 17835002
*                                                                YM7063 17840002
*        CHECK THE SCT (STEP CONTROL BLK) TO ENSURE THAT         YM7063 17845002
*        IEFRSTRT WAS INVOKED BY IEFDSDRP.                       YM7063 17846002
*                                                                YM7063 17847002
*****************************************************************YM7063 17848002
*                                                                YM7063 17849002
         LA    RD,RSREGSAV         INIT REG SAVEAREA ADDR        YM7063 17849202
         L     R1,TCBJSCB          GET JSCB PTR                  YM7063 17849402
         USING IEZJSCB,R1          ADDRESS JSCB                  YM7063 17849602
         L     R9,JSCSCT           GET SVA ADR OF SCT            YM7063 17849802
         DROP  R1                  JSCB                          YM7063 17849902
         LA    R1,RSTIOT           GET @ OF QMNGR PARM LIST      YM7063 17854902
         USING QMIOP,R1            ADDRESS PARM LIST             YM7063 17855902
         ST    R4,QMITCBAD         STORE TCB @ IN PARM LIST      YM7063 17856902
         MVI   QMIFLAGS,QMIOREAD   SET READ FLAG IN PARM LIST    YM7063 17857902
         LA    R0,K176             SET RECORD LENGTH IN PARM     YM7063 17858902
         STH   R0,QMIRECL            LIST TO 176                 YM7063 17859102
         SLL   R9,8                     SHIFT TTR LEFT 8         YM7063 17859302
         ST    R9,QMIDSKAD         SET SVA FOR SCT IN PARM LIST  YM7063 17859502
         LA    R0,QMNGRWA          SET QMNGR WORK AREA ADDRESS   YM7063 17859702
         ST    R0,QMIWRKAD           IN PARM LIST                YM7063 17859802
         LA    R9,QMNGRBUF         SET RECORD BUFFER ADDRESS     YM7063 17864802
         ST    R9,QMIRECAD           IN PARM LIST                YM7063 17865802
         QMNGRIO                   READ SCT                      YM7063 17866802
         LTR   RF,RF               TEST RETURN CODE              YM7063 17867802
         BZ    RSSYSCK             BR IF READ OK                 YM7063 17868802
         MVI   RSRETCOD+K1,ERR023  SET SWA READ ERR            @ZSUT222 17869037
         B     RSPREXIT            BR TO ERROR EXIT              YM7063 17869202
         DROP  R1                  PARM LIST ADDRESSING          YM7063 17869402
         USING INSMSCT,R9          ADDRESS SCT                   YM7063 17869602
RSSYSCK  TM    SCTSTEND,SCTSYSCK   IS RESTART CALL LEGITIMATE    YM7063 17869702
         DROP  R9                  SCT ADDRESSING                YM7063 17874702
         BO    RSOKCALL            IF LEGITIMATE CALL, BR        YM7063 17875702
         MVI   RSRETCOD+K1,ERR203  SET ERROR CODE                YM7063 17876702
         B     RSPREXIT            GO XCTL TO IGC0V05B           YM7063 17877702
RSOKCALL EQU   *                   CALL WAS LEGITIMATE           YM7063 17878702
*                                                                YM7063 17878902
*****************************************************************YM7063 17879102
*                                                                YM7063 17879302
*        RESTART CALL IS LEGITIMATE; BEGIN PROCESSING -          YM7063 17879502
*                                                                YM7063 17879602
*****************************************************************YM7063 17884602
*                                                                YM7063 17885602
         SR    R7,R7               CLEAR WORK REG                YM6541 17889602
         ICM   R7,ADDRBYTS,REPWACL GET LENGTH OF RST WA          YM6541 17900002
         LH    R8,REPLNGTH         GET LENGTH OF RST PARMS       YM6541 17950002
         AR    R7,RC               GET END OF RST WA +1          YM6541 18000002
         SR    R7,R8               BACK UP TO GET PARM SAVE ADDR YM6541 18050002
         SH    R7,C0008            LEAVE ROOM FOR REPFLAG2       YM6541 18052002
*                                  AND RSCKPPML                  YM6541 18054002
         SRL   R7,3                ENSURE PARM SAVEAREA IS ON    YM6541 18060002
         SLL   R7,3                  A DOUBLE WORD BOUNDARY      YM6541 18070002
         LA    R8,1(,R8)           GET PARM MOVE LENGTH          YM6541 18100002
         EX    R8,PARMSAV          SAVE RESTART PARMS            YM6541 18150002
*PARMSAV MVC   0(1,R7),0(R3)       MOVE PARMS TO END OF RST WA   YM6541 18200002
         LR    R3,R7               UPDATE RST PARMS BASE REG     YM6541 18250002
         ST    R3,RSTPARM          SAVE ADDR OF RST PARMS        YM6541 18300002
*                                                                     * 19550000
*********************************************************************** 19560000
*                                                                     * 19570000
*        ISSUE FREEPOOL FOR SUBPOOL 250, 251, AND 252 TO FREE CORE OF * 19580002
*        IEFRSTRT (STEP THAT ISSUED SVC 52), AND THE JOB PACK AREA.   * 19590000
*                                                                     * 19592000
*********************************************************************** 19594000
*                                                                     * 19596000
         FREEMAIN R,SP=252                                              19598400
         FREEMAIN R,SP=251         FREE JOB PACK AREA            A36350 19598802
         FREEMAIN R,SP=250                                       YM6541 19600802
*                                                                YM6541 19602802
*****************************************************************YM6541 19604802
*                                                                YM6541 19605202
*        BEGIN WORKAREA INITIALIZATION                           YM6541 19605302
*                                                                YM6541 19605402
*****************************************************************YM6541 19605502
*                                                                YM6541 19606702
         L     RF,TCBPQE           GET ADDR OF DUMMY PQE         Y02076 19612002
         USING PQESECT,RF                                        Y02076 19613202
         L     RF,PQEFPQE               GET PQE PTR              Y02076 19614402
         L     R9,PQEREGN          GET REGION START ADDR         Y02076 19615602
         DROP  RF                                                Y02076 19616802
         L     R7,CVTPTR           GET ADR OF CVT                Y02076 19618002
         USING CVTMAP,R7                                         Y02076 19619202
         L     R8,CVTTCBP          GET ADR OF NEXT TCB           Y02076 19620402
         L     R8,CURASOFS(R8)     GET CURRENT ASCB              Y02076 19621602
         USING ASCB,R8                                           Y02076 19622802
         L     R8,ASCBLDA-ASCB(R8) GET PTR TO LDA                Y02076 19624002
         USING LDA,R8                                            Y02076 19625202
*********************************************************************** 19626402
*                                                                     * 19627602
*        COMPUTE OFFSETS WITHIN W.A. BY INCREMENTING BY               * 19628802
*        LENGTH OF TIOT DURING CHKPT(CHKPT TIOT WILL BE MOVED TO W.A. * 19630002
*        DURING REPMAIN WHEN IT READS IN THE SURS).                   * 19631202
*                                                                     * 19632402
*********************************************************************** 19633602
*                                                                     * 19634802
         LA    R2,RSTIOT           GET ADDR NEXT AVAILABLE BYTE  Y02076 19636002
         AH    R2,REPTIOTL         IN THE W.A. (FOR MVT)         Y02076 19637202
         SR    R2,RC               COMPUTE OFSET TO REPDCB'S AND Y02076 19638402
         ST    R2,RSWAOFST         REPMAIN'S W.A.                Y02076 19639602
         ST    R2,RSMWOFST         SAVE OFFSET IN W.A.           Y02076 19640802
         AR    R2,RC               GET ADDRESS OF W.A.           Y02076 19642002
         USING RSECT,R2            ADDR IGC0005B WORK AREA       Y02076 19643202
         L     R8,CURRGNTP         GET CURRENT TOP OF REG        Y02076 19644402
         CR    R9,R8               COMPARE REGION ADDRS          Y02076 19646802
         BE    BEGINB              BRANCH IF ADDRS OK            Y02076 19648002
         MVI   RSRETCOD+K1,ERR216  SET ERROR CODE                Y02076 19649202
RSPREXIT EQU   *                   SET UP FOR ERROR EXIT         Y02076 19650402
         MVC   RSREGSAV(8),MODID   SAVE NAME OF MODULE THAT    @ZSUT222 19650737
*                                  HAS DETECTED THE ERROR.     @ZSUT222 19650937
         STM   0,15,RSREGSAV+8     SAVE CURRENT REGISTERS      @ZSUT222 19651337
         MVC   RHRXLST(LMODNAME),ERREXIT  MVE NAME OF EXIT MOD   Y02076 19651602
         B     RSLDR1              BR TO EXIT                    YM4671 19652802
BEGINB   EQU   *                   TEST CALLER'S AUTH            Y02076 19654002
         L     R1,TCBJSCB          GET @ OF JSCB                 YM5774 19868202
         USING IEZJSCB,R1          ADDRESS JSCB                  YM5774 19870202
         L     R6,JSCDSABQ         GET @ OF DSAB QDB             YM5774 19874202
         TM    REPFLAGS,USERAUTH   TEST USER'S AUTH-AT CKPT      YM5774 19874602
         BO    RSAUTHA             BR IF AUTH FOR MODESET        YM5774 19875002
         NI    JSCBOPTS,X'FF'-JSCBAUTH RESET JSCB AUTH BIT       YM7800 19875402
         B     RSAUTHB             BRANCH TO CHECK DSABS         YM5958 19875802
RSAUTHA  OI    JSCBOPTS,JSCBAUTH   OR IN USER'S AUTH BIT         YM7800 19875902
RSAUTHB  EQU   *                   SET UP TO LOOK FOR CHKPT D.S. YM5958 19881302
         DROP  R1                  JSCB ADDRESSING               YM5774 19883402
         USING QDB,R6              ADDRESS QDB                   Y02083 19885502
         L     R6,QDBFELMP         GET @ OF 1ST DSAB             Y02083 19887602
         DROP  R6                  QDB ADDRESSING                Y02083 19889702
         USING DSAB,R6             ADDRESS DSAB                  Y02083 19891802
RSDSABCK EQU   *                   LOOK FOR CHKPT DATA SET       Y02083 19893902
         L     R1,DSABTIOT         GET @ OF TIOT DD ENTRY        Y02083 19896002
         USING TIOENTRY,R1         ADDRESS TIOT DD ENTRY         Y02083 19898102
         CLC   TIOEDDNM,REPDDNM    IS THIS CHKPT D/S DD NAME     Y02083 19900202
         BE    RSDSABOK            IF YES, GO SET CHKPT FLAGS    Y02083 19902302
         L     R6,DSABFCHN         GET @ OF NEXT DSAB            Y02083 19904402
         B     RSDSABCK            GO CHECK THIS DSAB            Y02083 19906502
RSDSABOK EQU   *                   CHKPT D/S DDNAME FOUND        Y02083 19908602
         OI    DSABFLG4,DSABCKDS+DSABCKVL SET CHKPT STATUS FLAGS Y02083 19910702
*                                  SO OPEN WILL BYPASS SECURITY  Y02083 19912802
*                                  TESTS WHICH HAVE ALREADY BEEN Y02083 19922802
*                                  DONE BY DSDRP PROCESSING      Y02083 19924802
         DROP  R1                  TIOT DD ENTRY ADDRESSING      Y02083 19926802
         DROP  R6                  DSAB ADDRESSING               Y02083 19928802
         ICM   R0,ADDRBYTS,REPPPE+K1    GET LNGTH OF P/P CORE    Y02083 19978802
         ICM   R0,HIBYTE,SP250          SET SUBPOOL NO.          Y02083 20028802
         GETMAIN R,LV=(R0)              GET P/P CORE             Y02083 20078802
*                                                                     * 23020018
RSTCONT  EQU   *                                                        23100017
*                                                                     * 23170018
*********************************************************************** 23240018
*                                                                     * 23310018
*        THIS SECTION WILL INITIALIZE THE RESTART WORK AREA WITH      * 23400017
*     INFORMATION THAT WILL BE USED BY SUBSEQUENT LOADS OF RESTART.   * 23700017
*                                                                     * 23770018
*********************************************************************** 23840018
*                                                                     * 23910018
         LA    RD,RSREGSAV         INITIALIZE SAVE AREA REGISTER.       25500017
*        INITIALIZE W.A. WITH INFORMATION PASSED IN PARM FIELD          26000018
         MVC   RSPPM(RSPPML-RSPPM),REPPPM    LO ADR P/P CORE     Y02076 26200002
         MVC   RSBUFL2(LBLKSZE),REPBLKSI     CHKPT D/S BLK SIZE  Y02076 26600002
         MVC   RSTIOTO2(RSTIOTAD-RSTIOTO2),REPTIOTL  TIOT LNGTH  Y02076 26800002
         MVC   RSWACL1(RSBUFL-RSWACL1),REPWACL  WORK AREA LNGTH  Y02076 27000002
         MVC   RSFLAG1(LFLAGS),REPFLAGS   MOVE FLAGS TO W.A.     Y02076 27400002
         MVC   RSTIOTL2(LTIOT),REPTIOTL   FOR MVT-MOVE IN LENGTH Y02076 27600002
*                                         OF TIOT SA.                   27800002
         MVC   RSCIRTTR(RSSVRBN-RSCIRTTR),REPCIRAD               Y02076 38500002
*                                  SAVE TTR OF CIR                      38600018
*                                                                     * 38650001
*********************************************************************** 38660001
*                                                                     * 38670001
*        TEST THE RESTARTING JOB FOR V=R (TCBFLGS6)              YM2776 38680001
*        IN CONJUNCTION WITH THE CHECKPOINT HEADER               YM2776 38690001
*        INFORMATION ON THE CHKPT JOB (RSFLAGS) TO               YM2776 38692001
*        DETERMINE IF THE V=R BIT IS EITHER ON OR                YM2776 38694001
*        OFF IN BOTH JOBS.  IF MIXED, ERROR MESSAGE CODE 8       YM2776 38696001
*        IS GIVEN.                                               YM2776 38698001
*                                                                     * 38698401
*********************************************************************** 38698801
*                                                                     * 38699201
*                                                                       38706301
         MVI   RSCKPPML,ZERO       MOVE ZERO BYTE FOR TEST       YM3092 38708301
         TM    REPFLAGS,CKVEQR      WAS THE CHECKPOINT JOB V=R?  YM3092 38710302
CKVEQR   EQU   8                   V=R BIT IN PARAMETER LIST     YM3092 38712301
         BNO   VEQRTEST            NO, DO TEST NOW               YM3092 38712701
         OI    RSCKPPML,VEQR       INDICATE V=R IN CHKPT JOB     YM3092 38712801
VEQRTEST EQU   *                                                 YM3092 38713001
         XC    RSCKPPML(LFLAGS),TCBFLGS6                         YM3092 38713101
*                                  HALF ADD TWO BYTES TOGETHER   YM2776 38719801
*                                                                       38726501
*        WHEN THESE TWO BYTES ARE EXCLUSIVE OR'ED TOGETHER       YM2776 38733201
*        THE HIGH ORDER BIT WILL BE OFF (0) IF BOTH THE          YM2776 38743201
*        CHECKPOINT AND RESTART STEPS ARE EITHER V=R, OR         YM2776 38753201
*        V=V.  IF THE STEPS WERE DIFFERENT, THE BIT              YM2776 38763201
*        WILL BE ON (1).                                         YM2776 38765201
*                                                                       38765601
         TM    RSCKPPML,VEQR       TEST V=R BIT (BOTH)           YM3540 38766000
         BNO   RSVEROK             STATUS IS GOOD, GO ON         YM2776 38766401
         MVC   RSREGSAV(8),MODID   SAVE NAME OF MODULE THAT    @ZSUT222 38766537
*                                  HAS DETECTED THE ERROR      @ZSUT222 38767137
         STM   0,15,RSREGSAV+8     SAVE CURRENT REGISTERS      @ZSUT222 38768537
         MVI   RSRETCOD+K1,ERR002  INDICATE V=R TYPE ERROR     @ZSUT222 38769537
         MVC   RHRXLST(LMODNAME),ERREXIT  SET V05B XCTL          YM4671 38776602
*                                                                       38787101
*        FREE ONE PAGE IN THE REGION SO THAT THE WTO ROUTINE     YM3092 38787501
*        WILL HAVE SPACE TO OPERATE IN.                          YM3092 38787901
*                                                                       38788301
FREEPAGE EQU   *                   FREE 1 PAGE FOR ERROR MSG     Y02083 38789702
         ICM   R1,ICMMSK,REPPPM         GET LOW BOUND-PP CORE    Y02076 38791702
         FREEMAIN R,LV=4096,SP=250,A=(1)                         YM3092 38793002
*                                                                       38794402
RSLDR1   EQU   *                        INSTR MUST FOLLOW        YM4671 38794802
         LR    R1,RC               LOAD PARM REG WITH W A ADDR   YM2776 38795802
         B     RSEREXIT            GO XCTL TO V05B               YM2776 38797202
*                                                                     * 38798602
*********************************************************************** 38800018
*                                                                     * 38900018
*        CONSTRUCT A BSAM DCB. THIS DCB WILL BE USED BY REPMAIN TO    * 39000017
*     READ THE CHKPT DATA SET.                                        * 39300017
*                                                                     * 39320018
*********************************************************************** 39340018
RSVEROK  EQU   *                                                 YM2776 39390001
         MVC   RHRCHKID(RHRXLST-RHRCHKID),REPCHKID               Y02076 39440002
*                                  SAVE CHECKID FOR NEXT MODULE         39520018
         LA    R6,RSBDCB           GET ADDR OF DCB MOVE-IN AREA.        39600017
         USING IHADCB,R6           ADDRESS AREA WHERE DCB WILL BE BUILT 39900017
         MVC   IHADCB21(LDCB),RSTDCBD        MOVE PRE-BUILT DCB TO W.A. 40200018
         MVC   DCBDDNAM(DDL),REPDDNM  INSERT DDNAME IN DCB.      Y02076 40500002
         MVC   DCBBLKSI(LBLKSZE),RSBUFL2     MOVE BLOCKSIZE INTO DCB.   40700018
         TM    RSFLAG1,RSTRKOV      CHKPT D.S. SPECIFY TRACK OVERFLOW   40900017
         BZ    RSTRESM              NO-SKIP CODE TO SET DCBRECFM FIELD  41000017
         OI    DCBRECFM,DCBRECTO    SET TRACK OVERFLOW BIT IN CHKPT DCB 41100000
RSTRESM  EQU   *                                                        41400017
         ST    R6,RSDCBAD1    INITIALIZE DECBS WITH ADDR OF DCB.        41700017
RSTSKP   EQU   *                                                  MFTCR 42600018
RSTADD4K EQU   *                                                        42716018
*                                                                     * 42720018
         ST    R6,RSTOPEN          SET UP OPEN'S PARAMETER LIST.        44400017
         MVI   RSTOPEN,INOUT       MOVE OPTION BYTE TO W.A.    @ZA18280 44700037
*  SET UP RDJFCB PARAMETERS                                     YA00142 44750002
         LA    R1,RSTRDJ                ADDR OF EXIT LIST       YA00142 44800002
         ST    R1,DCBEXLST              PLACE IN DCB            YA00142 44850002
         LA    R1,INFMJFCB              ADDR OF JFCB AREA       YA00142 44900002
         ST    R1,RSTRDJ                PLACE IN EXIT LST ENTRY YA00142 44950002
         MVI   RSTRDJ,OPENJOPT          SET RDJFCB AND LIST END YA00142 45000002
         RDJFCB MF=(E,RSTOPEN)          READ THE JFCB           YA00142 45000402
         TM    RSFLAG1,RSTAPE           IS THE CHKPT ON TAPE    YA00142 45000802
         BZ    RSTOPN1                  BR IF NOT TO OPEN       YA00142 45001202
*                                                               YA00142 45001602
*   DETERMINE THE SEQUENCE NO. OF THE VOLUME WITH THE           YA00142 45001702
*   REQUIRED CHKPT RECORDS.                                     YA00142 45001802
*                                                                     * 45002000
         LH    RF,JFCBVLSQ              LOAD ORIG VOL SEQ NO.   YA00142 45052002
         LTR   RF,RF                    WAS A VOL SEQ SPECIFIED YA00142 45102002
         BNZ   RSTVLSQ1                 BR IF YES               YA00142 45152002
*                                                               YA00142 45202002
*   WHEN A DATA SET WAS OPENED WITH A DISP OF 'MOD' AND NO JFCB YA00142 45252002
*   VOL SEQ NO., THEN THE REQUIRED VOL SEQ IS THAT OF THE LAST  YA00142 45262002
*   VOLUME OF THE CHKPT DATA SET                                YA00142 45272002
*                                                               YA00142 45282002
         TM    JFCBIND2,JFCOLD          IS DISP = MOD           YA00142 45292002
         BO    RSTVLSQ3                 BR IF NOT               YA00142 45294002
         MVC   JFCBVLSQ+1(1),JFCBNVOL   SET VOL SEQ TO NO. OF   YA00142 45296002
*                                       VOLS IN DATA SET        YA00142 45298002
         B     RSTOPN1                  BR TO OPEN CHKPT D.S.   YA00142 45298402
*                                                               YA00142 45298802
*   WHEN A VOL SEQ NO. WAS ORIGINALLY SPECIFIED OR IF NONE WAS  YA00142 45299202
*   SPECIFIED BUT THE DISPOISITION IS 'OLD' OR 'NEW', THEN THE SEQ      45299602
*   NO. IS THE SUM OF (JFCBVLSQ-1) AND DEBTVLSQ, WHERE          YA00142 45299802
*   (JFCBVLSQ-1) GR OR = 0.                                     YA00142 45299902
*                                                               YA00142 45349902
RSTVLSQ1 EQU   *                                                YA00142 45359902
         BCTR  RF,0                     DECR NON=ZERO VLSQ      YA00142 45369902
RSTVLSQ3 EQU   *                                                YA00142 45379902
         SR    R1,R1                    ZERO WORK REG           YA00142 45389902
         IC    R1,RSSVRB                LOAD DEBTVLSQ SAVED AT  YA00142 45391902
*                                       CHKPT TIME IN SVRB PTR  YA00142 45393902
         AR    RF,R1                    CALC REQ'D VOL SEQ NO.  YA00142 45395902
         STH   RF,JFCBVLSQ              STORE IT IN JFCB        YA00142 45397902
*                                                               YA00142 45398302
*   OPEN THE CHKPT D.S. USING THE JUST-MODIFIED JFCB.  NOTE THAT        45398702
*   THE MODIFIED JFCB IS NOT WRITTEN BACK TO THE JOBQ BY OPEN   YA00142 45399502
*                                                               YA00142 45399602
RSTOPN1  EQU   *                                                YA00142 45399702
**********************************************************************  45416402
*        FREE 2K  OF CORE SO OPEN WILL HAVE ENOUGH SPACE         YM7325 45426402
*********************************************************************** 45428402
         L     R1,RSPPM                 ADR P/P CORE             YM7325 45430402
         LH    R0,TWOKBLK               2K                       YM7325 45432402
         ICM   R0,HIBYTE,SP250          SP250                    YM7325 45432802
         FREEMAIN R,LV=(R0),A=(R1)                               YM7325 45432902
         MVI   RSSVRB,X'00'             ZERO VOL SEQ NO.        SA62489 45433102
         OI    JFCBTSDM,JFCNWRIT        IND DON'T REWRITE JFCB  YA00142 45449802
         OPEN  TYPE=J,MF=(E,RSTOPEN)    OPEN CHKPT D.S.         YA00142 45459802
         LR    R1,RC               LOAD PARM REG WITH ADDR OF CHKPT WA. 45499802
         MVC   RHRXLST(LMODNAME),RHRXLIST    MOVE NAME OF NEXT MODULE   45600018
RSEREXIT EQU   *                                                 YM2776 45650001
         LA    RF,RHRXLST                    TO XCTL'S PARM LIST IN WA. 45900018
         ST    RF,RHRXPTR                                               46200017
         LA    RF,RHRXPTR                                               46500017
**********************************************************************  46750002
         XCTL  SF=(E,(15))         TRANSFER CONTROL TO 2ND LOAD OF      46800017
PARMSAV  MVC   0(1,R7),0(R3)       SUBJECT OF AN EXEC INS        YM6541 46850002
ICMMSK   EQU   X'F'                     INSERT CHAR MASK         Y02076 47150002
CURASOFS EQU   12                  OFSET TO CURRENST ASCB        Y02076 55850002
K1       EQU   1                   CONSTANT 1                    Y02076 55860002
ERR216   EQU   216                 WRONG REGION BEGIN ADR        Y02076 55900002
USERAUTH EQU   X'10'               USER AUTH'D FOR MODESET       Y02076 55950002
AUTHOFF  EQU   X'EF'               MASK - TURN OFF AUTH BIT      Y02076 56000002
RHRXLIST DC    C'IGC0205B'         NEXT LOAD OF HSEKEEPING        MFTCR 56100018
ERREXIT  DC    C'IGC0V05B'         ERROR EXIT LOAD OF RESTART    YM2776 56150001
MODID    DC    CL8'IGC0005B'       MODULE ID                   @ZSUT222 56200037
MODESUB  DC    X'E0FA'             U MODE, SP=250 TO GETMAIN     Y02076 56400002
SP253    DC    X'FD'               SUBPOOL 253                          56450000
SP250    DC    AL1(250)                 SUBPOOL 250              Y02076 56460002
TWOKBLK  DC    H'2048'             TWO K BLOCKSIZE                      56500000
RSTMASK  DC    X'FF'                                                    57300017
C0008    DC    H'8'                SUBTRACT CONSTANT             YM6541 57350002
MINWALN  DC    H'4096'             MINIMUM RESTART WA SIZE       YM7063 57355002
PAGEMASK DC    X'00FFF000'         'AND' MASK FOR PAGE ADDRESS   M2658  57450000
         DS    0F                  PUTS DCB ON FULL WORD BOUNDARY       57460017
         DS    C                   ALIGNS ADDRESS TO FULL WORD BOUNDARY 57520017
RSTDCBD  EQU   *                                                        57600017
         DC    AL3(0)    BUFCB                                          57900017
         DC    AL2(0)  BUFL                                             58200017
         DC    BL2'0100000000000000'  DSORG  (BSAM)                     58500017
         DC    A(1)    IOBAD                                            58800017
         DC    AL1(0)  BFTEK,BFALN                                      59100017
         DC    AL3(1)  EODAD                                            59400017
         DC    BL1'11000000'                                            59700017
         DC    AL3(0)  EXLST                                            60000017
*                       FOUNDATION BLOCK                                60300017
         DC    CL8'        '   DDNAME                                   60600017
         DC    BL1'00000010'  OFLGS                                     60900017
         DC    BL1'00000000'  IFLG                                      61200017
         DC    BL2'0010010000100100'  MACR                     @ZA18280 61500037
*                       BSAM-BPAM-QSAM INTERFACE                        61800017
         DC    BL1'00000000'                                            62100017
         DC    AL3(1)  CHECK, GERR, PERR                                62400017
         DC    A(1)    SYNAD                                            62700017
         DC    H'0'    CIND1, CIND2                                     63000017
         DC    AL2(0) BLKSIZE                                           63300017
         DC    F'0'   WCPO, WCPL, OFFSR, OFFSW                          63600017
         DC    A(1)   IOBA                                              63900017
         DC    AL1(1)    NCP                                            64200017
         DC    AL3(1) EOBR, EOBAD                                       64500017
*                       BSAM-BPAM INTERFACE                             64800017
         DC    A(1)   EOBW                                              65100017
         DC    H'0'   DIRCT                                             65400017
         DC    AL2(0) LRECL                                             65700017
         DC    A(1)   CNTRL, NOTE, POINT                                66000017
*                                                                     * 66050000
*        MAINTENANCE SPACE                                            * 66100000
*                                                                     * 66150000
PATCH    EQU   ((*-IGC0005B)/10)   TEN PERCENT MAINTENANCE SPACE        66200002
         DC    XL(PATCH)'00'                                            66210000
*                                                                     * 66250000
RSECT    DSECT                     IGC0005B'S WORK AREA.                66300017
RHRCHKID DS    4F   CHECKID                                             66400017
RHRXLST  DS    2F   NAME OF MODULE TO RECEIVE CONTROL.                  66600017
RHRXPTR  DS    F    POINTER XCTL PARM LIST.                             66900017
RSTOPEN  DS    F    OPEN PARAMETER LIST.                                67200017
RSTRDJ   DS    A(INFMJFCB)              OPENJ & RDJFCB EXLST    YA00142 67250002
         IEFJFCBN                       MAP JFCB                YA00142 67300002
PARMSECT DSECT                                                          67500017
REPLNGTH DS    CL2                      LNGTH OF PARM LIST       Y02076 67510002
REPCIRAD DS    CL4                      TTR OF CIR RECORDS       Y02076 67550002
REPCOUNT DS    CL2                      NUMBER OF CHKPTS TAKEN   Y02076 67600002
REPCKIDL DS    CL2                      LENGTH OF CHECKID        Y02076 67650002
REPCHKID DS    CL16                     CHECKID                  Y02076 67700002
REPDDNM  DS    CL8                      DDNAME OF CHKPT D/S      Y02076 67750002
REPPPM   DS    CL4                      LO ORDER ADR OF P/P AREA Y02076 67800002
REPPPE   DS    CL4                      SIZE OF P/P AREA         Y02076 67850002
REPBLKSI DS    CL2                      CHKPT D/S BLOCK SIZE     Y02076 67900002
REPTIOTL DS    CL2                      LENGTH OF TIOT           Y02076 67950002
REPFLAGS DS    CL1                      CHECKPOINT FLAGS 1       Y02076 68000002
*              X'80'                    AUTOMATIC RESTART        Y02076 68050002
*              X'40'                    TRACK OVERFLOW SPECIFIED Y02076 68100002
*              X'20'                    CHKPT   D/S ON TAPE      Y02076 68150002
*              X'10'                    USER AUTH'D FOR MODESET  Y02076 68200002
*              X'08'                    V=R REQUEST              Y02076 68250002
*              X'02'                    CHKPT ISSUED OPEN        Y02076 68300002
*              X'01'                    CHKPT D/S OPEN FOR BPAM  Y02076 68350002
REPWACL  DS    CL3                      CHKPT W/A LENGTH         Y02076 68400002
REPFLAG2 DS    CL1                      CHKPT FLAGS 2            Y02076 68450002
*              X'04'                    USER SUPPLIED CHECKID    Y02076 68500002
RSCKPPML DS    CL4                      FOR V=R TESTS            Y02076 68550002
*                                                                     * 71030018
*        MAPPING OF RESTART SVRB AND EXTENDED SAVE AREA USED BY MODULE* 71050018
*                                                                     * 71070018
RSTSECT  DSECT                                                          71100017
RSTSVRB  DS    24F                                                      71400017
RSPSD    DS    2F   GETMAIN RETURNS ADDR AND LNGTH HERE, BUT            71700017
*                   FIELD IS NEVER REFERENCED                           72000017
RSTPARM  DS    F    ADDR OF PARM FIELD.                                 72300017
RSTFLAG1 DS    F    FLAGS FIELD.                                        72600017
RSTAD    DS    F    WORK AREA USED TO STORE ADDRESSES                   72900018
RCOUNT   DS    F                                                        73200017
RSTSAVE  DS    F    SAVE AREA FOR CIR TTR AND CHKPT DATA SET DDNAME.    73500017
*                                                                     * 73600018
*        GETMAIN PARAMETER LIST                                       * 73700018
*                                                                     * 73800018
RSTGMLIS DS    1F   POINTER TO GETMAIN LIST                             73900018
RSTGMLS4 DS    1F   POINTER TO GETMAIN RETURN ADDRESS                   74000018
RSTGMLS8 DS    H    MODE BYTE AND SUBPOOL NUMBER                        74200018
RSTGMLLW DS    2F    GETMAIN LIST                                       74400018
         DCBD  DSORG=(BS,PO),DEVD=(DA,TA)                               75000017
         IEFTIOT1                                                       75300017
         IKJTCB                                                  YM2776 75350001
         IHAPSA                                                  Y02076 75360002
         IHAASCB                                                 Y02076 75400002
         IHALDA                                                  Y02076 75450002
         IHAPQE                                                  Y02076 75460002
         CVT   DSECT=YES,PREFIX=YES,LIST=YES                     Y02076 75500002
         IEFASCTB                                                Y02083 75550002
SCTSTEND EQU   INSMSCT+172         INTRIM SYMBOL DEFINITION      Y02083 75560002
         IHADSAB                                                 Y02083 75600002
         IHAQDB                                                  Y02083 75610002
         IEZJSCB                                                 Y02083 75620002
         IEEVRSWA VER=3                 USE AOS2 VERSION OF WA          75650000
         IEFQMIOP                                                Y02083 75700002
QMNGRWA  DS    88C                                               Y02083 75750002
QMNGRBUF DS    176C                                              Y02083 75800002
         IEFJESCT                                                Y02083 75850002
PRBL     EQU   32        LENGTH OF IEFRSTRT'S PRB                       75900018
INPUTOPN EQU   128  OPTION BYTE FOR OPEN PARM LIST.                     76200017
INOUT    EQU   131  OPTION BYTO FOR IN OUT PROCESSING          @ZA18280 76300037
RST256   EQU   256                                                      76500017
DDL      EQU   8    LENGTH OF DDNAME FIELD IN DCB.                      76800017
LENL     EQU   32             OFFSET DEBLNGTH FROM BEG OF APPEND. TABLE 77100017
DCBDECBL EQU   128  LENGTH OF RESTART'S DCB AND TWO DECB.               77400017
DIOBL    EQU   80   LENGTH OF DA IOB.                                   77700017
DICBL    EQU   112  LENGTH OF DA ICB.                                   78000017
TICBL    EQU   48   LENGTH OF TAPE ICB                                  78300017
TIOBL    EQU   48   LENGTH OF TAPE IOB                                  78600017
RSDIRACC EQU   2    INDICATES DIRECT ACCESS DEVICE                      78900017
KCVTMVT  EQU   X'10'                                                    79200017
TIOLEN   EQU   28                                                       79500017
VEQR     EQU   128              V=R BIT IN TCBFLGS6 AND RSFLAG   YM2776 79550001
ERR002   EQU   2                ERROR CODE FOR V=R             @ZSUT222 79650037
ERR203   EQU   203              ILLEGITIMATE SVC RESTART CALL    Y02083 79700002
ERR023   EQU   23               SWA READ IN ERROR              @ZSUT222 79710037
K176     EQU   176              LENGTH OF SCT                    Y02083 79750002
RSL      EQU   256  LENGTH OF RSTWA TO BE ZEROED OUT.                   79800017
SVRBL    EQU   144  LENGTH OF RESTART SVRB                              80100017
DSORGBPM EQU   B'01000010'    MASK TO CHANGE BSAM DSORG FIELD TO BPAM.  80400017
DCBL     EQU   88   LENGTH OF BSAM/BPAM DCB.                            80700017
RSTWAL   EQU   RSTIOT-RSTWA   LENGTH OF RESTART W.A.                    81000017
RSTRKOV  EQU   64   INDICATES CHKPT DCB SPECIFIED TRACK OVERFLOW        81100017
TRKOV    EQU   32   TRACK OVERFLOW IN DCBRECFM                          81200017
RSSPBKSZ EQU   X'08'                                                    81250017
R0       EQU   0                                                        81300017
R1       EQU   1                                                        81600017
R2       EQU   2                                                        81900017
R3       EQU   3                                                        82200017
R4       EQU   4                                                        82500017
R5       EQU   5                                                        82800017
R6       EQU   6                                                        83100017
R7       EQU   7                                                        83400017
R8       EQU   8                                                        83700017
R9       EQU   9                                                        84000017
RA       EQU   10                                                       84300017
RB       EQU   11                                                       84600017
RC       EQU   12                                                       84900017
RD       EQU   13                                                       85200017
RE       EQU   14                                                       85500017
RF       EQU   15                                                       85800017
*                                                                       85810018
*       DEFINITION OF CONSTANTS, POSITIONS WITHIN OTHER AREAS,          85820018
*                     AND LENGTHATTRIBUTES                              85830018
ZERO     EQU   0         DECIMAL - 0                                    85840018
ONE      EQU   1         DECIMAL - 1                                    85850018
EIGHT    EQU   8                   DECIMAL - 8                   A35696 85855020
DEC256   EQU   256       DECIMAL - 256                                  85860018
HIBYTE   EQU   8                   ICM MASK FOR HIGH ORDER BYTE         85862000
ADDRBYTS EQU   7                   ICM MASK FOR ADDRESS                 85864000
*                                                                       85870018
RSBUFL2  EQU   RSBUFL+2            BUFFER+2                             85880018
RSTIOTO2 EQU   RSTIOTO+2           TIOTO                                85890018
RSWACL1  EQU   RSWACL+1            WORKAREA+1                           85900018
RSTIOTL2 EQU   RSTIOTL+2           TIOTL                                85910018
IHADCB21 EQU   IHADCB+21           WORKAREA                             85920018
*                                                                       85930018
LMODESUB EQU   2                   MODE BYTE AND SUBPOOL                85940018
LBLKSZE  EQU   2                   BLOCK SIZE                           85950018
LTIOT    EQU   2                   TIOT                                 85960018
LFLAGS   EQU   1                   FLAGS                                85970018
LDCB     EQU   67                  DCB                                  85980018
LMODNAME EQU   8                   MODULE NAME                          85990018
OPENJOPT EQU   X'87'                    END LIST & OPENJ OPT    YA00142 86040002
     END                                                                86100017
./  ADD  SSI=72970734,NAME=IHJARS01
*                                                                       00050000
         COPY  LCGASMSW                                                 00100000
  TITLE 'IGC0205B (IHJARS01) RESTART HOUSEKEEPING ROUTINE-2ND LOAD'     00102002
*                                                                       00110002
**********************************************************************  00112002
*STATUS - CHANGE LEVEL 000                                              00120002
*                                                                       00150000
*TITLE 'IGC0205B (IHJARS01) RESTART HOUSEKEEPING ROUTINE-2ND LOAD'      00400002
*                                                                       00450002
*FUNCTION/OPERATION  IGC0205B WILL DO THE FOLLOWING               MFTCR 01200018
*                   1.)  MOVE THE IOB, ICBS, AND CHANNEL PROGRAMS       01600017
*                      ASSOCIATED WITH THE CHKPT DATA SET TO THE        02000017
*                      RESTART WORK AREA AND UPDATE ALL POINTERS TO     02400017
*                      THE IOB, ICBS, AND CHANNEL PROGRAMS.             02800017
*                   2.)  FOR PCP, MOVE THE DEB ASSOCIATED WITH THE      03200017
*                      CHKPT DATA SET TO THE RESTART WORK AREA.         03600017
*                   3.)  ISSUE A POINT MACRO SO THAT THE NEXT           04200017
*                      READ MACRO WILL READ IN THE FIRST CIR.           04800017
*                   4.)  CALCULAGE OFFSET TO BUFFER AND LENGTH OF       05200017
*                      REPDCB'S WORK AREA AND SAVE THESE VALUES IN      05600017
*                      THE RESTART WORK AREA.                           06000017
*ENTRY POINTS - FROM IGC0005B(IHJARS00)                                 06400002
*                                                                       06450002
*INPUT - ADDRESS OF THE RESTART WORK AREA IN REGISTER 1.                06800018
*                                                                       06850002
*OUTPUT- ADDRESS OF THE RESTART WORK AREA IN REGISTER 1.                07200018
*                                                                       07250002
*EXTERNAL ROUTINES AND SVC ROUTINES - BSAM POINT                        07600018
*                                     XCTL                              08000017
*                                                                       08050002
*EXITS-NORMAL  XCTL TO REPMAIN, IGC0505B                                08400017
*                                                                       08450002
*EXITS-ERROR- NONE.                                                     08800018
*                                                                       08850002
*WORK AREAS - RSTWA IS THE MAPPING OF THE RESTART WORK AREA.            09200018
*             TAPESECT IS THE MAPPING OF AN IOB, TWO ICBS AND THEIR     09600017
*           RESPECIVE CHANNEL PROGRAMS USED FOR READING IN THE CHKPT    10000017
*           DATA SET FROM TAPE USING CHAINED SCHEDULING                 10400017
*             DASECT IS THE MAPPING OF AN IOB, TWO ICBS AND THEIR       10800017
*           RESPECTIVE CHANNEL PROGRAMS USED FOR READING IN THE CHKPT   11200017
*           DATA SET FROM D.A. USING CHAINED SCHEDULING.                11600017
*                                                                       11650002
*TABLES REFERENCED - TCB, DCB, DEB, IOB, ICB.                           12000018
*ATTRIBUTES - REENTRANT, SUPERVISOR STATE, TYPE 4 SVC ROUTINE.          12400018
*                                                                       12450002
*NOTES - NONE.                                                          13200018
*                                                                       13250002
* RELEASE 037 CHANGES ADDS DELETIONS                                    13260037
*A585340-585390                                                @ZA17064 13270037
**********************************************************************  13300002
*                                                                       13350002
IGC0205B CSECT                                                          13600018
         BALR  RB,ZERO             SET UP MODULE ADDRESSABILITY         14000018
         USING *,RB                                                     14400018
         B     BEGIN               BRANCH AROUND EYE CATCHER            14450000
         CNOP  0,8                 ALIGN TO A DOUBLE WORD BOUNDARY      14500000
         DC    C'IGC0205B'         CSECT NAME                           14550000
         DC    C'JAN 1977'         LAST UPDATE DATE                     14560037
         DC    C'@ZA17064'         LAST APAR                            14570037
BEGIN    EQU   *                                                        14600000
         USING IHADCB,R6           ADDRESS CHKPT DCB.                   15200017
         USING R2SECT,RA           ADDR IGC0205BS W.A.            MFTCR 15600018
         USING RSTWA,RC            ADDRESS RESTART WORK AREA.           16000017
         LR    RC,R1               GET ADDR OF RESTART WORK AREA.       16400017
         L     R4,RSTCBAD          GET TCB ADDR.                        16800017
         LA    R6,RSBDCB           GET ADDRESS OF RESTART DCB.          17200017
*                                                                       17250002
*        TO PREVENT CLOSE FROM ABENDING IF ERRORS OCCUR DURING   YM7073 17300002
*        RESTART, THE CHECKPOINT DATA SET DEB WILL BE REMOVED    YM7073 17350002
*        FROM THE DEB TABLE AND THE TCB.                         YM7073 17400002
*                                                                       17450002
*        LA    R1,0(R6)           LOAD ADDRESS INTO PARM REG     YM7073 17500037
*        DEBCHK (R1),TYPE=DELETE  REMOVE DEB FROM DEB TABLE      YM7073 17520037
*        SR    R1,R1              ZERO OUT REGISTER              YM7073 17540037
*        ST    R1,TCBDEB(R4)      ZERO OUT TCBDEB FIELD          YM7073 17560037
         LR    RA,RC                                                    17600017
         A     RA,RSMWOFST         GET ADDRESS OF IGC0205BS W.A.  MFTCR 18000018
         LA    R1,RSIOBCP          GET ADDR OF RELOCATE AREA     Y02076 18400002
         L     R2,DCBIOBA          GET ADDR OF IOB.                     18800017
         TM    RSFLAG1,RSTAPE      IS DATA SET ON A D.A. DEVICE         19200017
         BZ    RSTDA               YES-GO TO MOVE D.A. IOB, ICBS        19600017
*                                  AND CPS TO W.A.                      20000017
*                                                                     * 20500018
*********************************************************************** 20600018
*                                                                     * 20700018
*        THIS SECTION WILL MOVE THE TAPE IOB,ICBS, AND CHANNEL        * 20800017
*     PROGRAMS CONSTRUCTED BY OPEN FOR THE RESTART DATA SET TO THE    * 21200017
*     RESTART WORK AREA.                                              * 21600017
*                                                                     * 21700018
*********************************************************************** 21800018
*                                                                     * 21900018
         USING TAPESECT,R1         ADDR AREA WHERE IOB, ICBS AND CPS    22000017
*                                  WILL BE MOVED TO.                    22400017
         MVC   TIOB(TIOBL),ZERO(R2)  MOVE IOB TO W.A.                   22800018
         LA    R2,TIOB             GET ADDRESS OF IOB.                  23200017
         ST    R2,DCBIOBA          UPDATE IOB ADDR FIELD IN DCB.        23600017
         ST    R2,RSTAD            UPDATE POINTER TO NEXT IOB.          24000017
         MVC   TNIOB1(LIOB),RSTAD1                                      24400018
         LA    R2,TIOBECB          GET ECB ADDR.                        24800017
         ST    R2,TECBPT           UPDATE POINTER TO ECB.               25200017
         LA    R2,TREAD            GET ADDR OF CHANNEL PROGRAM.         25600017
         ST    R2,TCPSTART         UPDATE POINTER TO CHANNEL PROGRAM.   26000017
RSTDRT   EQU   *                                                        26400017
*                                                                     * 36640018
*********************************************************************** 36660018
*                                                                     * 36680018
*        CALCULATE OFFSETS WITHIN RESTART WORKAREA FOR BUFFER AND     * 36700018
*        REPDCB'S WORKAREA                                            * 36720018
*                                                                     * 36740018
*********************************************************************** 36760018
*                                                                     * 36780018
RSTSKP2  EQU   *                                                        36800017
         L     R1,RSWACL           GET LENGTH OF WA              Y02076 36850002
         SH    R1,SSCRBUFL         LENGTH OF SSCR/SUR BUFFER     Y02076 37800002
         ST    R1,RSBFOFST         SAVE OFFSET IN W.A.                  38400017
RSTREPL  EQU   *                                                        38700017
         L     R2,RSWACL           COMPUTE LENGTH OF REPDCB'S W.A.      38800017
         S     R2,RSWAOFST                                              39200017
         ST    R2,RSDCBL           SAVE LENGTH IN W.A.                  39600017
*                                                                     * 39630018
*********************************************************************** 39660018
*                                                                     * 39690018
*        FOR CHKPT D.S. ON D/A, ISSUE POINT MACRO TO POSITION D.S. TO * 39720018
*        FIRST CIR IN CHKPT ENTRY SO THAT REPMAIN CAN RESTORE P/P     * 39750018
*        CORE (TTR OF CIR PASSED TO RESTART FROM IEFDSDRP WHO ISSUED  * 39780018
*        A CORRESPONDING NOTE MACRO)                                  * 39810018
*                                                                     * 39840018
*********************************************************************** 39870018
*                                                                     * 39900018
         TM    RSFLAG1,RSTAPE      IS DATA SET ON TAPE                  40000017
         BO    RSTTAPE             YES-GO TO POSITION TAPE TO 1ST CIR   40400017
         LA    R0,RSCIRTTR         LOAD PARM REG WITH POINTER TO TTRN.  40800017
         LA    R1,RSBDCB           LOAD PARM REG. WITH DCB ADDR.        41200017
         POINT (R1),(R0)           INSURE THAT THE NEXT RECORD TO       41600017
*                                  BE READ WILL BE THE FIRST CIR.       42000017
*                                                                     * 42050018
*   THE FOLLOWING CODE HAS BEEN ADDED TO ENHANCE SYSTEM INTEGRITY       42060002
*   BY PERFORMING LENGTH-CHECKING ON CIR*S AND SUR'S AS THEY ARE        42070002
*   READ IN BY REPMAIN.                                                 42080002
*                                                                       42090002
*   IF THE CHECKPOINT BEING READ IS INTACT AND VALID, ALL RECORDS WILL  42092002
*   BE OF THE EXACT LENGTH COMPUTED BY REPMAIN AND PLACED IN THE        42094002
*   DECB BEFORE EACH READ.  THUS DETECTION OF A WRONG LENGTH RECORD     42096002
*   ALLOWS US TO PREVENT RESTORING OF SYSTEM CONTROL BLOCKS FROM        42098002
*   INVALID RECORDS.                                                    42098402
*                                                                       42098802
*   WRONG LENGTH RECORD DETECTION IS ACCOMPLISHED BY:                   42099202
*                                                                       42099602
*          (1)   TURNING OFF THE SILI BIT IN THE READ DATA CCW BUILT    42099702
*                BY BSAM.  BSAM BUILT THE CCW WITH THE SILI ON          42099802
*                BECAUSE IT USES THIS METHOD TO AVOIID LENGTH           42099902
*                CHECKING ON FORMAT U RECORDS.                          42116602
*                                                                       42126602
*          (2)   TESTING, IN ALL REPMAIN SYNAD ROUTINES, TO SEE IF      42128602
*                THE I/0 ERROR THAT GAVE SYNAD CONTROL WAS A WRONG      42130602
*                LENGTH RECORD.  IF SO, A UNIQUE ERROR CODE IS SET.     42132602
*                                                                       42133002
*   THE FOLLOWING CODE LOCATES THE SILI BIT AND TURNS IT OFF.  THIS     42133102
*   CODE IS DEPENDANT UPON THE FORMAT OF BSAM CHANNEL PROGRAMS.         42133202
*                                                                       42138802
RSTSKP3  EQU   *                                                YA00153 42140802
         LA    R6,RSBDCB                GENERATE DCB POINTER    YA00153 42142802
         USING IHADCB,R6                ADDRESS CHKPT DCB       YA00153 42143202
         L     R1,DCBIOBA               POINT TO IOB            YA00153 42143602
         USING DASECT,R1                ADDRESS IT              YA00153 42144002
         L     R1,DCPAD                 GET CP START ADDRESS    YA00153 42144102
         DROP  R1                                               YA00153 42144202
         CLI   0(R1),TAPECC             TEST FOR TAPE CHAN PROG YA00153 42144302
         BNE   RSTSILI2                 NO-TRY NEXT TYPE        YA00153 42158202
         NI    TAPESILI(R1),X'FF'-SILIBIT  TURN OFF SILI BIT    YA00153 42168202
         B     RSTSKP4                                          YA00153 42170202
RSTSILI2 EQU   *                                                YA00153 42170602
         CLI   0(R1),RPSCC              TEST FOR DISK -- RPS    YA00153 42171002
         BNE   RSTSILI3                 NO- ASSUME DISP CP      YA00153 42171402
         NI    RPSSILI(R1),X'FF'-SILIBIT  TURN OFF SILI BIT     YA00153 42171802
         B     RSTSKP4                                          YA00153 42171902
RSTSILI3 EQU   *                                                YA00153 42172002
         NI    DISKSILI(R1),X'FF'-SILIBIT  TURN OFF DISK SILI   YA00153 42172102
*********************************************************************** 42172202
*                                                                     * 42186102
*        XCTL TO REPMAIN TO RESTORE P/P CORE                          * 42200018
*                                                                     * 42250018
*********************************************************************** 42300018
*                                                                     * 42350018
RSTSKP4  EQU   *                                                YA00153 42400002
         LR    R1,RC               GET ADDR OF RSTWA                    42800002
         MVC   RHRXL(LMODNAME),RHRXRPM                                  43000018
*                                  MOVE NAME OF NEXT MODULE TO RECEIVE  43200018
         LA    RF,RHRXL            CONTROL TO XCTL PARM LIST IN W.A.    43600017
         ST    RF,RHRXL8                                                44000018
         LA    RF,RHRXL8                                                44400018
         XCTL  SF=(E,(RF))         TRANSFER CONTROL TO REPMAIN.         44800017
         USING DASECT,R1           ADDRESS AREA WHERE IOB, ICBS AND     45200017
*                                  CPS WILL BE MOVED TO.                45600017
*                                                                     * 45700018
*********************************************************************** 45800018
*                                                                     * 45900018
*        THIS SECTION WILL MOVE THE DIRECT ACCESS IOB, ICBS, AND      * 46000017
*     CHANNEL PROGRAMS CONSTRUCTED BY OPEN FOR THE RESTART DATA SET   * 46400017
*     TO THE RESTART WORK AREA.                                       * 46800017
*                                                                     * 46900018
*********************************************************************** 47000018
*                                                                     * 47100018
RSTDA    EQU   *                                                        47200017
         LA    RE,IOBL             GET NON-RPS IOB LENGTH        M5907  47300020
         CLI   DCPS-DIOB(R2),RPSOPCD Q - RPS CHANNEL PROGRAM     M5907  47400020
         BNE   RSTDA0              IF NOT, BR                    M5907  47500020
         LA    RE,RPSIOBL          GET RPS IOB LENGTH            M5907  47600020
RSTDA0   EQU   *                                                 M5907  47700020
         BCTR  RE,0                ADJUST LNGTH FOR MOVE INS     M5907  47900020
         EX    RE,RSTMVIOB         MOVE IOB/CP TO WORKAREA       M5907  48000020
         LA    R2,DIOB             GET ADDR OF IOB.                     48400017
         ST    R2,DCBIOBA          UPDATE JOB ADDR FIELD IN DCB.        48800017
         ST    R2,RSTAD            UPDATE POINTER TO NEXT IOB.          49200017
         MVC   DNIOB1(LIOB),RSTAD1                                      49600018
         LA    R2,DECB             GET ECB ADDR.                        50000017
         ST    R2,DECBAD           UPDATE POINTER TO ECB.               50400017
         LA    R2,DCPS             GET ADDR OF CHANNEL PROGRAM.         50800017
         ST    R2,RSTAD                                                 51200017
         MVC   DCPAD1(LCPPOINT),RSTAD1  UPDATE POINTER TO CP.           51600018
         CLI   DCPS,RPSOPCD        Q - RPS CHANNEL PROGRAM       M5907  51700020
         BE    RSTDA2              IF YES, BR                    M5907  51800020
         MVC   DCPT1(LCPPOINT),RSTAD1   UPDATE POINTER TO CP IN TIC CCW 52000018
         LA    R2,DSEEK3                GET ADDR OF SEEK ADDR           52400018
         ST    R2,RSTAD            UPDATE POINTER TO SEEK ADDR          52800017
         MVC   DCPS1(LCCW),RSTAD1       IN SEARCH CCW.                  53000018
         LA    R2,DCPRCNT          GET ADDR OF READ COUNT CCW.          53600017
         ST    R2,RSTAD            UPDATE POINTER TO READ COUNT         54000017
         MVC   DCPTI1(LCCW),RSTAD1      CCW IN TIC CCW.                 54300018
RSTDA1   EQU   *                                                        54600017
         LA    R2,DCBFDAD3         GET ADDR OF FDAD ADDR IN DCB.        54900018
         ST    R2,RSTAD            UPDATE POINTER TO FDAD IN READ       55200017
         MVC   DCPRCNT1(LCCW),RSTAD1    COUNT CCW.                      55300018
         B     RSTDRT                   GO BACK.                        55400018
*                                                                M5907  55407020
* RPS CHANNEL PROGRAMS HAVE TWO ADDITIONAL CCW'S, A COUNT FIELD  M5907  55414020
* READ-IN AREA, AND AN EXTENSION TO HANDLE SECTOR THETA'S        M5907  55421020
*                                                                M5907  55428020
RSTDA2   EQU   *                                                 M5907  55435020
         LA    R2,RPSCPS           GET ADDR OF SEARCH ID         M5907  55442020
         ST    R2,RSTAD              EQ CCW AND UPDATE           M5907  55449020
         MVC   RPST+1(LCCW),RSTAD1     TIC CCW                   M5907  55456020
         LA    R2,DSEEK3           GET ADDR OF SEARCH ARG        M5907  55463020
         ST    R2,RSTAD              AND UPDATE SEARCH           M5907  55470020
         MVC   RPSCPS+1(LCCW),RSTAD1   ID EQ CCW                 M5907  55477020
         LA    R2,RSECTOR1         GET ADDR OF THETA-1           M5907  55484020
         ST    R2,RSTAD              AND UPDATE                  M5907  55491020
         MVC   RPSCPSS+1(LCCW),RSTAD1  SET SECTOR CCW            M5907  55498020
         LA    R2,RPSRCNT          GET ADDR OF CCW5              M5907  55505020
         ST    R2,RSTAD              AND UPDATE                  M5907  55512020
         MVC   RPSTI+1(LCCW),RSTAD1    TIC CCW                   M5907  55519020
         LA    R2,RPSCOUNT         GET ADDR OF COUNT FIELD       M5907  55526020
         ST    R2,RSTAD              READ-IN AREA AND UPDATE     M5907  55533020
         MVC   RPSRCNT+1(LCCW),RSTAD1  READ COUNT CCW            M5907  55540020
         LA    R2,RSECTOR2         GET ADDR OF THETA-2           M5907  55547020
         ST    R2,RSTAD              AND UPDATE                  M5907  55554020
         MVC   RPSRS+1(LCCW),RSTAD1    READ SECTOR CCW           M5907  55561020
         B     RSTDRT              GO HANDLE DEB NEXT            M5907  55568020
*                                                                     * 55575020
*********************************************************************** 55600018
*                                                                     * 55700018
*        SUBROUTINE USED TO MOVE REMAINDER  OF DEB TO RESTART WORKAREA* 55800018
*                                                                     * 55900018
*********************************************************************** 56000018
*                                                                     * 56100018
RSTMOV2  EQU   *                                                        56400017
         MVC   ZERO(DEC256,R8),ZERO(R9)                                 56800018
         AH    R8,=H'256'                                               57200017
         SH    R7,=H'256'                                               57600017
         AH    R9,=H'256'                                               58000017
         BR    RE                  RETURN TO CALLER                     58400017
*                                                                     * 58400518
*********************************************************************** 58401018
*                                                                     * 58401518
*        SUBROUTINE TO POSITION TAPE CHKPT D.S. TO FIRST CIR BY       * 58402018
*        READING EACH RCD ON D.S. CHECKING FIRST FOR CORRECT CHKPT    * 58402518
*        ENTRY(COMPARING ON CHECKIDS,PASSED BY IEFDSDRP) AND, WITHIN  * 58403018
*        CORRECT ENTRY SEARCH FOR LAST DSDS(SEARCHING ON CODE INDICA- * 58403518
*        TING END OF DSDRS)                                           * 58404018
*                                                                     * 58404518
*********************************************************************** 58405018
*                                                                     * 58405518
RSTTAPE  EQU   *                                                        58407017
         LA    RD,RSREGSAV         ADDR REG SAVEAREA FOR READ MACRO     58414018
         LA    R7,RSBDCB                                                58421017
         ST    R7,RSDCBAD1                                              58428017
         LR    R7,RC               GET ADDR OF IOB IN W.A.              58435017
         A     R7,RSWACL                                                58442017
         SH    R7,=H'48'                                                58449017
         ST    R7,RSTAD                                                 58456017
         MVC   RSIOBP11(LIOBADDR),RSTAD1  MOVE IOB ADDR TO DECB IN W.A. 58461018
         LA    R5,LREC                    LENGTH OF RECORD              58466018
         STH   R5,RSLNGTH1         SAVE LENGTH OF RECORD IN DECB        58472017
         LA    R5,RSDECB1          GET ADDR OF DECB FOR READ            58474017
         L     R7,RSBFOFST         BUFFER ADDR                          58477017
         SH    R7,=H'200'                                               58484017
         AR    R7,RC                                                    58491017
         ST    R7,RSTAD                                                 58498017
         MVC   RSAREA11(LRIAADDR),RSTAD1  MOVE READ-IN AREA ADR TO DECB 58502018
*        POSITION TAPE TO CORRECT CHKPT ENTRY                           58506018
RSTRGN   EQU   *                                                        58512017
         BAL   R2,RSTREAD          GO TO READ RECORD FROM CHKPT D.S.    58519017
         CLC   CHRPOS(LCHR,R7),RSTCHKID   IS THIS THE CORRECT CHR       58526018
         BNE   RSTRGN              NO-GO TO READ NEXT RECORD            58533017
         LA    R6,RSBDCB           GET RESTART DCB ADDRESS     @ZA17064 58534037
         LA    R1,0(R6)            LOAD ADDRESS IN REG 1       @ZA17064 58535037
         DEBCHK (R1),TYPE=DELETE   DELETE THE DEB              @ZA17064 58536037
         SR    R1,R1               ZERO REG 1                  @ZA17064 58537037
         ST    R1,TCBDEB(4)        ZERO TCB DEB FIELD          @ZA17064 58538037
*                                                              @ZA17064 58539037
*        TAPE POSITIONED TO FIRST DSDR                                  58540018
RSTCOMP  EQU   *                                                        58547017
         XR    R9,R9               INITIALIZE SWITCH FOR NO.RCD.IN BUFR 58557018
RSTTPK   EQU   *                                                        58568017
         LR    R8,R7               INITIALIZE REG WITH BUFFER ADDR      58575017
RSTTPK1  EQU   *                                                        58582017
         BAL   R2,RSTREAD          READ ANOTHER RECORD                  58589017
RSTTP1   EQU   *                                                        58596017
         CLI   DSDRPOS(R8),LASTDSDR     END OF DSDR'S                   58603018
         BE    RSTSKP3             YES                                  58610017
         LA    R4,L23DSDR               LENGTH OF TYPE 2,3 DSDR'S       58617018
         CLI   DSDRPOS(R8),HEXZERO      TYPE 1 DSDR                     58624018
         BNE   RSTTP2              NO                                   58631017
         LA    R4,L1DSDR(R4)       GET LENGTH OF TYPE 1 DSDR            58638018
RSTTP2   EQU   *                                                        58645017
         AR    R8,R4               INCREMENT BUFFER POINTER TO NEXT RCD 58652018
RSTTP3   EQU   *                                                        58659017
         LTR   R9,R9               SWITCH=0(MUST CHECK 2ND RCD IN BUFFR 58666018
         BNE   RSTSW3              NO-CHECKED SECOND                    58673017
         LA    R9,ONE              CHECK FOR SECOND RCD                 58680018
         B     RSTTP1              GO TO CHECK IF END OF DSDR'S         58687018
RSTSW3   EQU   *                                                        58694017
         CLI   ONE(R8),LASTDSDR    END-OF-DSDR'S                        58701018
         BE    RSTSKP3             YES-RETURN TO XCTL TO REPMAIN        58708018
         B     RSTCOMP             READ NEXT RECORD                     58715018
RSTREAD  EQU   *                                                        58722017
         READ  (R5),SF,,,,,,MF=E                                        58729017
         CHECK (R5)                                                     58736017
         BR    R2                  RETURN TO CALLER                     58743017
RSTMVC1  MVC   ZERO(ONE,R8),ZERO(R9)                                    59143018
RSTMVIOB MVC   DIOB(ONE),ZERO(R2)  MOVE IOB/CP TO WORKAREA       M5907  59343020
RHRXRPM  DC    C'IGC0505B'         MODULE NAME FOR REPMAIN              59600017
SSCRBUFL DC    H'4096'             MAX LENGTH OF SSCR RECORD     Y02076 59650002
*                                                                     * 60250000
*        MAINTENANCE SPACE                                            * 60300000
*                                                                     * 60350000
PATCH    DC    XL((*-IGC0205B)/20)'00'   FIVE PERCENT MAINTENANCE SPACE 60360000
*                                                                     * 60370000
TAPESECT DSECT                                                          60400017
*        IOB                                                            60800017
TIOB     DS    0D                                                       61200017
TNIOB    DS    F         POINTER TO NEXT IOB.                           61600017
TIOBECB  DS    F    ECB                                                 62000017
TFLAGS   DS    F    FLAGS                                               62400017
TECBPT   DS    F    ADDR OF ECB                                         62800017
TIOBCSW  DS    2F   LOW ORDER BYTES OF LAST CSW                         63200017
TCPSTART DS    F    ADDR OF CHANNEL PROGRAM                             63600017
TDCBPT   DS    F    ADDR OF DCB                                         64000017
TEND     DS    2F                                                       64400017
TREAD    DS    2F        READ CCW                                       64800017
DASECT   DSECT                                                          65200017
*        IOB                                                            65600017
DIOB     DS    0D                                                       66000017
DNIOB    DS    F         POINTER TO NEXT IOB.                           66400017
DECB     DS    F    ECB                                                 66800017
DSENSE   DS    F    FLAGS                                               67200017
DECBAD   DS    F    ADDR OF ECB                                         67600017
DIOBCSW  DS    2F   LOW ORDER BYTES OF CSW                              68000017
DCPAD    DS    F         ADDR OF CHANNEL PROGRAM.                       68400017
DDCB     DS    F    ADDR OF DCB                                         68800017
DEND     DS    2F                                                       69200017
DSEEK    DS    2F                                                       69600017
*                                                                M5907  69690020
* NON-RPS CHANNEL PROGRAM                                        M5907  69780020
*                                                                M5907  69870020
DCPS     DS    2F   SEARCH CCW                                   M5907  69960020
DCPT     DS    2F   TIC CCW                                      M5907  70050020
DCPTI    DS    2F   TIC CCW                                      M5907  70140020
DCPRCNT  DS    2F   READ COUNT CCW                               M5907  70230020
DCPRDAT  DS    2F   READ DATA CCW                                M5907  70320020
*                                                                M5907  70410020
* RPS CHANNEL PROGRAM AND THETA EXTENSION                        M5907  70500020
*                                                                M5907  70590020
         ORG   DCPS                                              M5907  70680020
RPSCPSS  DS    2F   SET SECTOR CCW                               M5907  70770020
RPSCPS   DS    2F   SEARCH CCW                                   M5907  70860020
RPST     DS    2F   TIC CCW                                      M5907  70950020
RPSTI    DS    2F   TIC CCW                                      M5907  71040020
RPSRCNT  DS    2F   READ COUNT CCW                               M5907  71130020
RPSRDAT  DS    2F   READ DATA CCW                                M5907  71220020
RPSRS    DS    2F   READ SECTOR CCW                              M5907  71310020
RPSCOUNT DS    2F   COUNT READ-IN AREA                           M5907  71400020
RSECTOR1 DS    XL1  SECTOR THETA-1                               M5907  71490020
RSECTOR2 DS    XL1  SECTOR THETA-2                               M5907  71580020
         DS    XL6  RESERVED                                     M5907  71670020
R2SECT   DSECT                     IGC0205BS W.A.                 MFTCR 71900018
RSTCHKID DS    CL16      CHECKID                                        72200017
RSTAD    DS    F                                                        72400017
RHRXL    DS    3F   XCTL PARM LIST                                      72800017
         DCBD  DSORG=(BS,PO),DEVD=(DA,TA)                               73600017
         IEEVRSWA   VER=3                                               74400000
RST256   EQU   256                                                      74800017
DEBAPPEN EQU   29   OFFSET TO APP.VEC.TBL. POINTER IN DEB.              75000017
DDL      EQU   8    LENGTH OF DDNAME FIELD IN DCB.                      75200017
LENL     EQU   32             OFFSET DEBLNGTH FROM BEG OF APPEND. TABLE 75600017
IOBL     EQU   88                  NON-RPS IOB/CP LENGTH         M5907  75700020
RPSIOBL  EQU   120                 RPS IOB/CP LENGTH             M5907  75800020
RPSOPCD  EQU   X'23'               RPS OP CODE (SET SECTOR)      M5907  75900020
DCBDECBL EQU   128  LENGTH OF RESTART'S DCB AND TWO DECB.               76000017
DIOBL    EQU   88        LENGTH OF D.A  IOB AND CP                      76400017
TIOBL    EQU   48        LENGTH OF TAPE IOB/CP.                         76800017
RSDIRACC EQU   2    INDICATES DIRECT ACCESS DEVICE                      77200017
KCVTMVT  EQU   X'10'                                                    77600017
TIOLEN   EQU   28                                                       78000017
RSL      EQU   256  LENGTH OF RSTWA TO BE ZEROED OUT.                   78400017
SVRBL    EQU   144  LENGTH OF RESTART SVRB                              78800017
DCBL     EQU   88   LENGTH OF BSAM/BPAM DCB.                            79200017
RSTWAL   EQU   RSTIOT-RSTWA   LENGTH OF RESTART W.A.                    79600017
RSTRKOV  EQU   64                 INDICATES TRACK OVERFLOW              79800017
R0       EQU   0                                                        80000017
R1       EQU   1                                                        80400017
R2       EQU   2                                                        80800017
R3       EQU   3                                                        81200017
R4       EQU   4                                                        81600017
R5       EQU   5                                                        82000017
R6       EQU   6                                                        82400017
R7       EQU   7                                                        82800017
R8       EQU   8                                                        83200017
R9       EQU   9                                                        83600017
RA       EQU   10                                                       84000017
RB       EQU   11                                                       84400017
RC       EQU   12                                                       84800017
RD       EQU   13                                                       85200017
RE       EQU   14                                                       85600017
RF       EQU   15                                                       86000017
*                                                                       86009018
*        DECIMAL CONSTANTS, POSITIONS, LENGTHATTRIBUTES                 86018018
*                                                                       86027018
ZERO     EQU   0              DECIMAL - 0                               86036018
ONE      EQU   1              DECIMAL - 1                               86045018
DEC256   EQU   256            DECIMAL - 256                             86054018
TCBDEB   EQU   8                  OFFSET IN TCB TO TCBDEB        YM7073 86056002
*                                                                       86063018
TNIOB1   EQU   TNIOB+1        POSITIONS IN RELATION TO PREVIOUSLY       86072018
RSTAD1   EQU   RSTAD+1        DEFINED AREAS                             86081018
DCBDEBA1 EQU   DCBDEBAD+1     *                                         86090018
RHRXL8   EQU   RHRXL+8        *                                         86099018
DNIOB1   EQU   DNIOB+1        *                                         86108018
DCPAD1   EQU   DCPAD+1        *                                         86117018
DCPT1    EQU   DCPT+1         *                                         86126018
DCPS1    EQU   DCPS+1         *                                         86135018
DCPTI1   EQU   DCPTI+1        *                                         86144018
DCBFDAD3 EQU   DCBFDAD+3      *                                         86153018
DCPRCNT1 EQU   DCPRCNT+1      *                                         86162018
RSIOBP11 EQU   RSIOBPT1+1     *                                         86171018
RSAREA11 EQU   RSAREA1+1      READ-IN AREA ADDRESS                      86180018
DSEEK3   EQU   DSEEK+3        SEEK ADDRESS                              86189018
*                                                                       86198018
LIOB     EQU   3    LENGTH OF IOB                                       86207018
LDCB     EQU   3              DCB                                       86216018
LPTRAVT  EQU   3              POINTER TO APP. VEC. TBL.                 86225018
LMODNAME EQU   8              MODULE NAME                               86234018
LREC     EQU   400            RECORD                                    86243018
LRIAADDR EQU   3              READ-IN AREA ADDRESS                      86252018
LIOBADDR EQU   3              IOB ADDRESS                               86261018
LCHR     EQU   16             CHR                                       86270018
L23DSDR  EQU   178            TYPE 2,3 DSDR                             86279018
LCPPOINT EQU   3              POINTER TO CP                             86288018
LCCW     EQU   3              CCW                                       86297018
L1DSDR   EQU   17   PLUS 178  TYPE 1 DSDR                        YM5302 86306003
*                                                                       86315018
CHRPOS   EQU   4              CHR                                       86324018
DSDRPOS  EQU   1              DSDR                                      86333018
*                                                                       86342018
*      - MASKS -                                                        86351018
*                                                                       86360018
HEXZERO  EQU   X'00'          HEXADECIMAL ZERO                          86369018
LASTDSDR EQU   X'10'          END OF DSDRS                              86378018
TAPECC   EQU   X'02'                    1ST CC IN TAPE CH PGM   YA00153 86388002
TAPESILI EQU   X'04'                    TAPE READ CCW+4         YA00153 86398002
SILIBIT  EQU   X'20'                    SILI BIT IN CCW FLAGS   YA00153 86398402
RPSCC    EQU   X'23'                    1ST CC IN RPS CH PGM    YA00153 86398802
RPSSILI  EQU   X'2C'                    RPS READ CCW+4          YA00153 86399202
DISKSILI EQU   X'24'                    DISK READ CCW+4         YA00153 86399602
 END                                                                    86400017
./  ADD  SSI=73210168,NAME=IHJARS60
         TITLE  'IGC0V05B (IHJARS60)  RESTART EXIT ROUTINE'             00200000
IGC0V05B CSECT                                                          00250000
*                                                                       02560002
**********************************************************************  02570002
*ROUTINE NAME - IGC0V05B           RESTART EXIT ROUTINE                 02600018
*STATUS CHANGE LEVEL 003                                                03200020
*                                                                       11200017
*FUNCTION/OPERATION - 1.)  ISSUE FREEMAIN FOR RESTART WORK AREA         12000000
*                                                                       13600017
*                     2.)  PUT RETURN CODE IN REGISTER 15 AND RETURN    14400000
*                        CONTROL TO THE CALLER.                         15200017
*                                                                       16000017
*                     3.)  IF AN ERROR HAS OCCURRED, THIS ROUTINE WILL  16800000
*                        ISSUE AN ABEND MACRO.                          17600017
*                                                                       17650002
*                     4.) IF SECURITY INTERFACE EXISTS UPDATE USERS DCB 17700002
*ENTRY POINT - IGC0V05B                                                 18000000
*                                                                       18050002
*INPUT  - ADDRESS OF THE RESTART WORK AREA WILL BE IN REGISTER 1.       18400018
*                                                                       18450002
*OUTPUT - RETURN CODE IN REGISTER 15.                                   18800018
*         A MESSAGE TO CONSOLE                                          19200018
*          1.) IF RESTART WAS SUCCESSFUL -                              19600018
*              IHJ008I SSSSSSSS RESTARTED                               20300017
*              WHERE SSSSSSSS=JOBNAME                                   20400017
*          2.) IF RESTART WAS UNSUCCESSFUL -                            20500018
*              IHJ007I RESTART NOT SUCCESSFUL FOR SSSSSSSS (XXX,YYY)    20700002
*              WHERE XXX = RETURN CODE, YYY = UNIT ADDRESS, AND         20900002
*              SSSSSSSS = JOBNAME.                                      21100020
*                                                                       21150002
*EXTERNAL ROUTINES - WTO, FREEMAIN, CLOSE.                              21400000
*                                                                       21450002
*EXITS-NORMAL - RETURN TO CALLER WITH RETURN CODE (X'04') IN REG. 15.   22100018
*                                                                       22150002
*EXITS-ERRORS - ABEND IF AN ERROR OCCURED.                              22800000
*                                                                       22850002
*TABLES/WORK AREAS - RSTWA, TIOT.                                       23500018
*                                                                       23550002
*ATTRIBUTES - REENTRANT, SUPERVISOR STATE, TYPE 4 SVC ROUTINE.          24200018
*                                                                       24250002
*RESTRICTIONS OF THE USE OF ROUTINE - AOS/2 ONLY.                       24900000
*                                                                       24950002
*CHANGE ACTIVITY                                                        24980037
*                                                                       25010037
*1387380200-381100,544000                                        A43260 25040037
*1053206000-207000,296000,758300,758500,759000,774000,777400,    A37817 25070037
*1053                                                            M6115  25100037
*1053778000                                                      A37817 25130037
*1053752400                                                      A29744 25160037
*1053                                                            A30491 25190037
*1053768000                                                      A33991 25220037
*1053378000-384000,752300                                        A32683 25250037
*  APAR 25627 IS TEMPORARILY FIXED IN REL'S 17 & 18 IN MODULE    A25627 25280037
* IHJARS60.  IT IS PERMANENTLY FIXED IN REL 19 BY SAN JOSE       A25627 25310037
* (UNDER APAR 28676) AND KINGSTON(UNDER APAR 26118).  CHECK THE  A25627 25340037
* FOLLOWING DATA MANAGEMENT AND SUPERVISOR MODULES RESPECTIVELY. A25627 25370037
* IGC0G05B,IGC0H05B,IGC0T05B, AND IGC0605B,IGC0805B.             A25627 25400037
*1053779800-780000                                               M6254  25430037
*                                                                       25460037
*      VS2 RELEASE 037 ADDS/DELETETIONS/CHANGES                         25490037
*A409200                                                       @ZA13512 25520037
*C409200,A759800                                               @ZA15683 25560037
*A409200-409280,409440                                         @ZA27549 25580037
*D409200-409440,759800                                         @ZA27748 25590037
*NOTES - NONE                                                           25600018
*                                                                       25650002
**********************************************************************  25700002
         BALR  RB,ZERO             SET UP                               26300018
         USING *,RB                MODULE ADDRESSABILITY                27200017
         B     BEGIN               BRANCH AROUND EYE CATCHER            27250000
         CNOP  0,8                 ALIGN TO A DOUBLE WORD BOUNDARY      27300000
         DC    C'IGC0V05B'         CSECT NAME                           27350000
         DC    C'@ZA27748'         LAST CODE SHIPPED           @ZA27748 27360037
         DC    C'&SYSDATE'         DATE LAST CODE SHIPPED      @ZA27748 27370037
BEGIN    EQU   *                                                        27400000
         USING RSTWA,RC            WORK AREA ADDRESSABILITY             28000017
         USING TCB,R4              ADDRESS TCB.                         28800000
         LR    RD,R5                    SAVE UCB ADDRESS         A37817 29600020
         LR    RC,R1                   SET UP                    M6115  30000020
         USING RBSECT,R5           ADDRESS RESTART SVRB.                30400017
         L     R4,RSTCBAD          GET ADDR OF TCB.                     31200017
         L     R5,TCBRBP           GET ADDRESS OF RESTART SVRB.         32000017
         L     RA,RSCKDCB          GET ADDRESS OF RESTART DCB.          32200002
         MVC   RBEXSAVE(LFLAG),RSFLAG1       SAVE RESTART FLAGS.        32300018
*                                                                       32350002
         LH    R8,RSRETCOD              GET ERROR RETURN CODE   YA00343 32360002
*                                       FOR USE IN MSG ROUTINE  YA00343 32370002
*                                                                       32380002
*                                                                     * 32400018
*********************************************************************** 32500018
*                                                                     * 32600018
*        IF ANY ERRORS HAVE OCCURRED RESTARTING JOB, GO TO ABEND JOB  * 32700018
*                                                                     * 32800018
*********************************************************************** 32900018
*                                                                     * 33000018
         LR    R3,RC               FETCH ADDR OF RESTART WA      A32683 33030020
         A     R3,RSBFOFST         CALC ADDR OF MESSAGE BUFFER   A32683 33060020
         LTR   R8,R8               HAVE ANY ERRORS OCCURED?     YA00343 33110002
         BNZ   RERABEND            YES-ABEND JOB.                       33600017
         L     R6,RSWACL           SAVE LENGTH OF W.A. TO BE FREED      36800017
*                                                                     * 36880018
*********************************************************************** 36960018
*                                                                     * 37040018
*        CHKPT SUPPLIED BLOCKSIZE FOR CHKPT DCB, RESTORE USER         * 37120000
*        BLKSIZE                                                      * 37200000
*                                                                     * 37280018
*********************************************************************** 37360018
*                                                                     * 37440018
RERCOM2  EQU   *                                                        37600017
         USING IHADCB,RA                                                37690017
         MVC   DCBBLKSI(LBLKSZE),RSDCBSI    RESTORE USER BLKSIZE        37696000
*                                                                     * 37702018
*********************************************************************** 37708018
*                                                                     * 37714018
*        BRANCH TO SUBROUTINE TO ISSUE CONSOLE MESSAGE AND            * 37720018
*        FREEMAIN (SUBPOOL 253) RESTART WORKAREA                      * 37726000
*                                                                     * 37732018
*********************************************************************** 37738018
*                                                                     * 37744018
RERCOM3  EQU   *                                                        37750017
         MVC   RBEXSAV8(N8),RSNSTAE SAVE USER SCB & PIE CHAINS   Y02076 37800002
         LR    R0,R3               FETCH ADDR OF MSG BFR         A32683 37840020
         SR    R0,RC               SUBTRACT ADDR OF RS WA        A32683 37930020
         N     R0,RERMASK          MAKE A DOUBLEWORD MULTIPLE    A43260 38020021
         LR    R9,R0               SAVE LENGTH FOR LATER         A43260 38110021
         SR    R6,R0               SUBTRACT FROM TOTAL WA LEN    A32683 38200020
         O     R0,SP253            SET SUBPOOL 253 IN LENGTH     A32683 38290000
         LR    R1,RC               FETCH ADDR OF CORE TO FREE    A32683 38380020
         FREEMAIN R,LV=(0),A=(1)   FREE FIRST PART OF RS WA      A32683 38470020
*                                                                       38560020
         BAL   R2,RERWTO           BR TO WRITE CONSOLE MESSAGE   A32683 38650020
*                                                                       38740020
         LR    R1,R9               GET LENGTH FREED              A32683 38830020
         AR    R1,RC               ADD START ADDRESS OF RS WA    A32683 38920020
         LR    R0,R6               FETCH LEN OF RS WA TO FREE    A32683 39010020
         O     R0,SP253            SET SUBPOOL 253 IN LENGTH     A32683 39100000
         FREEMAIN R,LV=(0),A=(1)   FREE WORK AREA CORE.                 39200017
*                                                                     * 39210018
*********************************************************************** 39780018
*                                                                     * 39840018
*        IF CHKPT OPEN'D CHKPT D.S. RESTART WILL CLOSE IT             * 39900018
*                                                                     * 39960018
*********************************************************************** 40020018
*                                                                     * 40080018
RERCOM5  EQU   *                                                        40200017
         L     RF,DCBDEBAD         FETCH DEB ADDRESS             YM5921 40200502
         LA    RE,DEBBASIC-DEB     GET PREFIX LENGTH             YM5921 40201002
         SR    RF,RE               POINT TO DEB PREFIX           YM5921 40201502
         USING DEB,RF              ADDRESS DEB PREFIX            YM5921 40202002
         L     RE,DEBXTNP          FETCH DEB EXT ADDRESS         YM5921 40202502
         USING DEBXTN,RE           ADDRESS DEB EXTENSION         YM5921 40203002
         L     RE,DEBXDSAB         FETCH DSAB ADDRESS            YM5921 40203102
         USING DSAB,RE             ADDRESS DSAB                  YM5921 40203202
         LR    RD,RA               INIT CLOSE DCB ADDR           YM5921 40203502
*                                                                     * 40203602
*********************************************************************** 40203702
*                                                                     * 40203802
*        TEST FOR SECURITY INTERFACE. IF ONE EXISTS, UPDATE THE       * 40203902
*        USER'S DCB BEFORE RETURNING TO HIM.                          * 40204102
*                                                                     * 40204202
*********************************************************************** 40204302
*                                                                     * 40204402
         TM    DSABFLG4,DSABCKSI   DOES S/I EXIST                YM5921 40204802
         BZ    RERCOM6             IF NOT, BRANCH                YM5921 40204902
         LA    RC,FOUR             GET ADDR OF USER DCB ADDR VIA YM5921 40205002
         SR    RD,RC               PROTECTED DCB ADDR -4         YM5921 40205502
         L     RD,0(,RD)           FETCH USER'S DCB ADDR         YM5921 40206002
         MODESET KEYADDR=TCBPKF,WORKREG=7 ASSUME CALLER KEY      YM5932 40206102
         MVC   DCBRELAD-IHADCB(LUPDATE1,RD),DCBRELAD UPDATE USER YM5921 40206302
         MVC   DCBDEBAD-IHADCB(L'DCBDEBAD,RD),DCBDEBAD DCB       YM5921 40206402
         MODESET EXTKEY=ZERO       RESUME KEY ZERO               YM5932 40206902
RERCOM6  EQU   *                   NON-S/I ENTRY                 YM5921 40207402
         TM    RBEXSAVE,RSOPEN     DID CHKPT OPEN DATA SET              40400017
         BZ    RERSKOP             IF NOT, GO EXIT               YM5921 40450002
         ST    RD,RBEXSAV4         SET UP CLOSE'S PARM LIST      YM5921 40880002
         TM    DEBOFLGS,DBMOD      IS THIS A MOD DATA SET        YM5744 40960002
         BO    RERNOTMD            BRANCH IF NOT MOD                    41040018
         MVI   RBEXSAV4,RERLEAVE   FOR A MOD D/S, CLOSE OPTION   YM5921 41120002
*                                  IS LEAVE                             41200018
         B     RERCLOSE            GO CLOSE DATA SET                    41280018
RERNOTMD EQU   *                                                        41360018
         MVI   RBEXSAV4,RERRWIND   CLOSE OPTION IS REWIND        YM5921 41440002
RERCLOSE EQU   *                                                        41520018
         MODESET KEYADDR=TCBPKF,WORKREG=7 ASSUME CALLER KEY      YM5932 41570002
         CLOSE MF=(E,RBEXSAV4)     CLOSE CHKPT DATA SET.                41600018
         MODESET EXTKEY=ZERO       RESUME KEY ZERO               YM5744 41650002
*                                                                     * 41680018
*********************************************************************** 41760018
*                                                                     * 41840018
*        RETURN TO USER VIA SVC 3 WITH RETURN CODE = 4 IN REG15       * 41920018
*        INDICATING SUCCESSFUL RESTART                                * 42000018
*                                                                     * 42080018
*********************************************************************** 42160018
*                                                                     * 42240018
RERSKOP  EQU   *                                                        42400017
         LA    RF,RESTART          LOAD RESTART RETURN CODE IN REG 15.  42800017
         MVC   TCBNSTAE(FOUR),RBEXSAV8 RESTORE USER SCB CHAIN    Y02076 42850002
         MVC   TCBPIE(FOUR),RBEXSAV8+FOUR RESTORE USER PIE CHAIN Y02076 42900002
         SVC   3    RETURN CONTROL TO USER VIA EXIT SVC.                43200017
*                                                                YM5921 43200502
         DROP  RE,RF               DSAB & DEB                    YM5921 43350602
*                                                                     * 43351102
*********************************************************************** 43360018
*                                                                     * 43440018
*        BRANCH TO SUBROUTINE TO ISSUE CONSOLE MESSAGE AND            * 43520018
*        ISSUE SYSTEM ABEND 13F FOR UNSUCCESSFUL RESTART              * 43600018
*                                                                     * 43680018
*********************************************************************** 43760018
*                                                                     * 43840018
RERABEND EQU   *                                                        44000017
         BAL   R2,RERWTO           GO TO WRITE MESSAGE TO CONSOLE       44400017
         L     R1,ABENDCOD         LOAD PARM REG WITH ABEND CODE.       44800017
         ABEND (1)                 ABEND JOB.                           45600017
*                                                                     * 74580018
*********************************************************************** 74670018
*                                                                     * 74760018
*        SUBROUTINE TO ISSUE CONSOLE MESSAGE                          * 74850018
*                                                                     * 74940018
*********************************************************************** 75030018
*                                                                     * 75120018
RERWTO   EQU   *                                                        75220017
         L     R7,TCBTIO           GET ADDR OF TIOT                     75280017
         LTR   R8,R8               ANY ERRORS OCCURED?          YA00343 75300002
         BNZ   RERMSG1             YES-GO WRITE UNSUCCESSFUL MESSAGE    75320017
*                                                                     * 75328018
*********************************************************************** 75336018
*        CONSTRUCT MESSAGE FOR SUCCESSFUL RESTART                     * 75344018
*********************************************************************** 75352018
*                                                                     * 75360018
         USING MSG2SECT,R3                                              75368018
         MVC   MC2PLIST(LPLIST2),MSG2  MOVE IN MSG2 SHELL               75376018
         MVC   MSG2JOB(LJOBNM),ZERO(R7)  MOVE JOBNAME TO MSG2           75384018
         LA    R1,MC2PLIST                                              75392018
         B     RERWT               GO TO WRITE MESSAGE                  75400017
*                                                                     * 75403018
*********************************************************************** 75406018
*        CONSTRUCT MESSAGE FOR UNSUCCESSFUL RESTART                   * 75409018
*********************************************************************** 75412018
*                                                                     * 75415018
RERMSG1  EQU   *                                                        75420017
         USING MSG1SECT,R3                                              75421018
         MVC   MC1PLIST(LPLIST1),MSG1  MOVE IN MSG1 SHELL               75462018
         MVC   MSG1JOB(LJOBNM),ZERO(R7)  MOVE JOBNAME TO MSG1 FROM TIOT 75502018
         CH    R8,K28                   IS RETURN CODE 28.       A37817 75505020
         BE    GETUCB                   YES-GO SET UNIT ADDR.    A37817 75508020
         CH    R8,K40                   IS RETURN CODE 40.       A37817 75511020
         BE    GETUCB                   YES-GO SET UNIT ADDR.    A37817 75514020
         CH    R8,K60                   IS RETURN CODE 60.       A37817 75517020
         BE    GETUCB                   YES-GO SET UNIT ADDR.    A37817 75520020
         CH    R8,K64                   IS RETURN CODE 64.       A37817 75523020
         BE    GETUCB                   YES-GO SET UNIT ADDR.    A37817 75526020
         CH    R8,K218                  IS RETURN CODE 218       YM7337 75528002
         BE    GETUCB                   YES-GO SET UNIT ADDR.    YM7337 75528402
         CH    R8,K251                  IS RETURN CODE 251       YM7337 75528802
         BE    GETUCB                   YES-GO SET UCB ADDR.     YM7337 75528902
*                                                                       75529020
CONTMSG  EQU   *                                                 A37817 75532020
         CVD   R8,MSGWK            CONVERT ERROR CODE TO                75542018
         UNPK  MSGWK(THREE),MSGUNPK(TWO)    PRINTABLE CHARACTER         75582018
         OI    MSGZONE,EBCDICMK    CONVERT 2ND BYTE TO EBCDIC           75622018
         MVC   MSG1ERCD(THREE),MSGWK  MOVE ERROR CODE TO MSG1    YM5301 75662002
         LA    R1,MC1PLIST         GET ADDR OF PARM LIST                75702018
RERWT    EQU   *                                                        75742018
         WTO   ,MF=(E,(1))                                              75800017
         BR    R2                  RETURN TO CALLER                     75820017
GETUCB   EQU   *                        SET UP UNIT ADDR  IN     A37817 75822020
         MVI   MSG1ERCD+3,C','           ERROR MESSAGE.          YM5955 75824002
         MVC   MSG1ERCD+4(3),13(RD)     GET UNIT ADDR FROM UCB.  YM5955 75826002
         MVI   MSG1ERCD+7,C')'                                   YM5959 75828002
         B     CONTMSG                  FINISH BUILDING ERR MSG. A37817 75830020
MSG1     WTO   'IHJ007I RESTART NOT SUCCESSFUL FOR          (   )    ',*75832002
               MF=L,ROUTCDE=(2,11),DESC=(6)                      YM5955 75840002
* MSG1 TEXT = IHJ007I RESTART NOT SUCCESSFUL FOR JOBNAME (XX,UUU)       75850020
         SPACE                                                          75860018
MSG2     WTO   'IHJ008I          RESTARTED',MF=L,ROUTCDE=(2,11),       *75870018
               DESC=(6)                                                 75880018
* MSG2 TEXT = IHJ008I JOBNAME RESTARTED                                 75890018
LPLIST1  EQU   61                       ERR MSG LENGTH           YM5955 75900002
LPLIST2  EQU   34                                                       75910018
ZERO     EQU   0                                                        75920018
LJOBNM   EQU   8                                                        75930018
EBCDICMK EQU   X'F0'                                                    75940018
THREE    EQU   3                                                        75950018
TWO      EQU   2                                                        75960018
         DS    0F                                                       76000017
ABENDCOD DC    X'8013F000'         ABEND CODE FOR UNSUCCESSFUL   A33991 76400020
*                                       RESTART                  A33991 76800020
SP253    DC    X'FD000000'         SUBPOOL 253 FOR RSTWA FREEMAIN       77200000
RERMASK  DC    X'00FFFFF8'         MASK FOR LENGTH OF FREEMAIN   A32683 77300020
MAXMSGLN DC    H'60'                    MAXIMUM MESSAGE LENGTH   A37817 77400020
RER256   DC    H'256'                                                   77600017
K28      DC    H'28'                                             A37817 77604020
K40      DC    H'40'                                             A37817 77608020
K60      DC    H'60'                                             A37817 77612020
K64      DC    H'64'                                             A37817 77616020
K218     DC    H'218'                   218 ERROR CODE CONSTANT  YM7337 77616402
K251     DC    H'251'                   251 ERROR CODE CONSTANT  YM7337 77617202
*                                                                     * 77618000
*        MAINTENANCE SPACE                                            * 77618400
*                                                                     * 77618800
PATCH    DC    XL((*-IGC0V05B)/20)'00'   FIVE PERCENT MAINTENANCE SPACE 77619200
*                                                                     * 77619600
MSG1SECT DSECT                                                          77620018
         DS    24F                                                      77640018
CK1WORD  DS    F                                                        77660018
MC1PLIST DS    0F                                                       77680018
MSG1LN   DS    CL2                 LENGTH OF MESSAGE                    77700018
MSG1FLGS DS    CL2                 MCS FLAGS                            77720018
MSG1BGIN DS    CL35                     MESSAGE TEXT--NOT        A37817 77730020
*                                       RESTARTED                A37817 77740020
MSG1JOB  DS    CL8                 JOBNAME                              77760018
         DS    CL2                 OPEN PAREN FOR ERROR CODE            77780018
MSG1ERCD DS    CL7                      ERROR CODE               YM5955 77800002
         DS    CL1                 CLOSED PAREN FOR ERROR CODE          77820018
MSG1CDS  DS    CL4                 MCS DESCRIPTOR & ROUTCODES           77840018
UNPKAREA DS    0D                                                       77860018
MSGWK    DS    CL1                 STORE UNPKD ERROR MSG CODE           77880018
MSGCD    DS    CL1                 2 BYTE MSG CODE                      77900018
MSGZONE  DS    CL4                 ZONE FIELD OF MSG CODE               77920018
MSGUNPK  DS    CL2                 MSG CODE TO BE CONVERTED             77940018
MSG2SECT DSECT                                                          77960018
MC2PLIST DS    0F                                                       78020018
MSG2LN   DS    CL2                 MESSAGE LENGTH                       78040018
MSG2FLGS DS    CL2                 MCS PLAGS                            78060018
MSG2BGIN DS    CL8                 MESSAGE ID                           78080018
MSG2JOB  DS    CL8                 JOBNAME                              78100018
         DS    CL10                MESSAGE TEXT--RESTARTED              78120018
MSG2CDS  DS    CL4                 MCS DESCRIPTOR & ROUTE CODES         78140018
         SPACE                                                          78160018
         IEEVRSWA VER=3                 USE AOS2 VERSION OF WA          78450000
         DCBD  DSORG=(BS,PO),DEVD=(DA,TA)                               78800017
LUPDATE1 EQU   DCBTRBAL-IHADCB+L'DCBTRBAL LENGTH OF 1ST DCB UPDT Y02083 78850002
         IKJTCB                                                         79200000
         IKJRB                                                          79250000
         IEZDEB                                                  Y02083 79300002
         IHADSAB                                                 Y02083 79350002
DBOFLAGS EQU   8                                                        79600018
DBMOD    EQU   X'40'                                                    80000018
RERLEAVE EQU   X'B0'                                                    80400018
RERRWIND EQU   X'90'                                                    80800018
RSSPBKSZ EQU   X'08'                                                    81400017
R0       EQU   0                                                        81600017
R1       EQU   1                                                        82400017
R2       EQU   2                                                        83200017
R3       EQU   3                                                        84000017
R4       EQU   4                                                        84800017
R5       EQU   5                                                        85600017
R6       EQU   6                                                        86400017
R7       EQU   7                                                        87200017
R8       EQU   8                                                        88000017
R9       EQU   9                                                        88800017
RA       EQU   10                                                       89600017
RB       EQU   11                                                       90400017
RC       EQU   12                                                       91200017
RD       EQU   13                                                       92000017
RE       EQU   14                                                       92800017
RF       EQU   15                                                       93600017
*                                                                       93620018
*        DECIMAL CONSTANTS, POSITIONS, LENGTHCODES                      93640018
*                                                                       93660018
ONE      EQU   1                   DECIMAL - 1                          93680018
FOUR     EQU   4                   DECIMAL - 4                   Y02083 93690002
N8       EQU   8                   DECIMAL - 8                   Y02076 93692002
DEC256   EQU   256                 DECIMAL - 256                        93700018
*                                                                       93720018
CONDCODE EQU   8                   CONDITION CODE                       93740018
SEQPOS   EQU   37                  DEB-VOL-SEQ POSITION                 93760018
*                                                                       93780018
RBEXSAV4 EQU   RBEXSAVE+4          DCB CLOSE PARM                       93800002
RBEXSAV8 EQU   RBEXSAVE+8          TEMP SAVE FOR SCB/PIE CHAINS  Y02076 93810002
*                                                                       93820018
LMSG1    EQU   8         LENGTH OF MSG1-INITIAL                         93840018
LMSG1A   EQU   35                  MSG1-ALL                             93860018
LMSG2    EQU   10                  MSG2                                 93880018
LMSG3    EQU   5                   MSG - ' (  )'                        93900018
LFLAG    EQU   1                   RESTART FLAG                         93920018
LRETCOD  EQU   2                   RET. CODE                            93940018
LBLKSZE  EQU   2                   BLOCK SIZE                           93960018
LTIOT    EQU   4                   TIOT                                 93980018
LJOBNAME EQU   8                   JOBNAME                              94000018
LERRCODE EQU   2                   ERROR CODE                           94020018
*                                                                       94040018
*        HEXADECIMAL VALUES ( CODES,MASKS)   AND CHARACTERS             94060018
*                                                                       94080018
HEXONE   EQU   X'01'     HEXADECIMAL - 1                                94100018
ORMK     EQU   X'F0'               MASK                                 94120018
MSGCODE  EQU   C'8'                MESSAGE CODE                         94140018
VOLSEQNO EQU   37        OFFSET TO VOL SEQ NO IN DEB                    94160018
FIRSTVOL EQU   X'01'     VOL SEQ NO IN CHKPT DEB SET TO INDICATE 1STVOL 94180018
*                                                                       94200018
         END                                                            94400017
./  ADD  SSI=32150043,NAME=IHJQCP30
         TITLE 'IHJQCP30  MVT CHECKMAIN  IGC0F06C'                      00700018
         COPY  LCGASMSW                                                 00750000
         AIF   ('&LIB' EQ 'LIB1').LIB1BA1  TEST FOR LIB1(OS)            00900000
CP30     TITLE 'IHJQCP30 AOS/2 CHECKMAIN 1 ROUTINE - IGC0F06C'          00950000
*                                                                       01000000
* NAME - CHECKMAIN 1 - IHJQCP30 - IGC0F06C                              01050000
*                                                                       01100000
* STATUS                                                                01150000
*                                                                       01200000
*    CHANGE LEVEL=0                                                     01250000
*                                                                       01300000
* FUNCTION                                                              01350000
*                                                                       01360000
*         CHECKMAIN 1 CREATES A RECORD (ASR) OF THE EXTENTS OF THE      01370000
*         ALLOCATED REGION STORAGE PAGES ON THE CHECKPOINT DATA SET     01380000
*         AND COPIES THE ALLOCATED (VALID) PAGES DESCRIBED BY THE ASR   01390000
*         AS CORE IMAGE RECORDS (CIR) ONTO THE CHECKPOINT DATA SET.     01392000
*         THIS ASR/CIR SEQUENCE IS REPEATED UNTIL ALL VALID REGION      01394000
*         STORAGE PAGES HAVE BEEN CHECKPOINTED.                         01396000
*                                                                       01398000
* ENTRY POINTS                                                          01398400
*                                                                       01398800
*         CHECKMAIN 1 IS ENTERED VIA XCTL FROM THE PREVIOUS CHECKPOINT  01399200
*         LOAD MODULE AT ENTRY POINT IGC0F06C.                          01399600
*                                                                       01399700
* INPUT                                                                 01399800
*                                                                       01399900
*         GPR1- ADDRESS OF CHECKPOINT WORK AREA                         01449900
*                                                                       01451902
* OUTPUT                                                                01453902
*                                                                       01455902
*         GPR1- ADDRESS OF CHECKPOINT WORK AREA                         01457902
*                                                                       01458302
*         CHECKPOINT DATA SET- ASR'S AND CIR'S DESCRIBING ALL USER      01458702
*         ALLOCATED SPACE WITHIN HIS REGION                             01459102
*                                                                       01459502
* EXTERNAL REFERENCES                                                   01459602
*                                                                       01459702
*         NONE                                                          01459802
*                                                                       01459900
* EXITS, NORMAL                                                         01469900
*                                                                       01479900
*               - TO CHECKMAIN 2 AT ENTRY IGC0G06C VIA XCTL TO          01489900
*                 CHECKPOINT THE SUPERVISOR CONTROL BLOCKS AS SUR'S.    01491900
*                 UPON EXIT THE PARAMETERS ARE AS FOLLOWS-              01493900
*                 GPR 12 - ADDRESS OF CHKWA                             01495900
*                 GPR13 - ADDRESS OF STANDARD SAVE AREA                 01497900
*                                                                       01498300
* EXITS, ERROR                                                          01498700
*                                                                       01499100
*               1) TO RESUME I/O ROUTINE (IGC0N06C) VIA XCTL TO         01499500
*                  PROVIDE ITS NORMAL FUNCTIONS AND TO PASS AN ERROR    01499600
*                  CODE TO THE CHECKPOINT EXIT ROUTINE INDICATING THAT  01499700
*                  AN I/O ERROR HAS OCCURRED.                           01499800
*                  UPON EXIT THE PARAMETERS ARE AS FOLLOWS-             01549800
*                  GPR 1 - ADDRESS OF CHKWA                             01559800
*                  CHKWA - AN ERROR CODE OF X'0C' IS PASSED IN THE      01569800
*                          LAST BYTE OF THE CKRETCOD FIELD.             01579800
*                                                                       01589800
*              2)  TO RESUME I/O ROUTINE (IGC0N06C) VIA XCTL TO         01591800
*                  PROVIDE ITS NORMAL FUNCTIONS AND TO PASS AN ERROR    01593800
*                  CODE TO THE CHECKPOINT EXIT ROUTINE THAT AN          01595800
*                  UNRECOVERABLE EOV CONDITION (TWO RETRIES HAVE        01597800
*                  OCCURRED ON TAPE, OR THE DATA SET IS ON A DIRECT     01598200
*                  ACCESS DEVICE)HAS OCCURRED.                          01598600
*                  UPON EXIT THE PARAMETERS ARE THE SAME AS FOR CASE 1  01599000
*                  EXCEPT THAT THE LAST BYTE OF THE CKRETCOD FIELD      01599400
*                  CONTAINS AN X'08'.                                   01599500
*                                                                       01599600
*              3)  TO CHECKPOINT HOUSEKEEPING ROUTINE (IGC0206C) TO     01599700
*                  ATTEMPT REPROCESSING ON A NEW TAPE WHEN AN EOV       01633100
*                  HAS OCCURRED FOR THE FIRST TIME ON TAPE.             01643100
*                                                                       01653100
* TABLES/WORK AREAS                                                     01663100
*                                                                       01665100
*         DCB  DCBSYNAD                                                 01665500
*              DCBNCP                                                   01665900
*              DCBDEBAD                                                 01666300
*                                                                       01666400
*         DEB  DEBNMEXT                                                 01666500
*                                                                       01677600
*         DECB RECORD LENGTH FIELD                                      01687600
*                                                                       01688000
*         TCB  TCBPQE                                                   01688400
*                                                                       01688800
*         DPQE PQEFPQE                                                  01692500
*                                                                       01694500
*         PQE  PQEREGN                                                  01694900
*              PQEFBQE                                                  01695300
*              PQESIZE                                                  01695700
*                                                                       01696100
*         FBQE FWDPTR                                                   01696200
*              SIZE                                                     01746200
*              FBQAREA                                                  01756200
*                                                                       01766200
* ATTRIBUTES                                                            01776200
*                                                                       01786200
*         KEY 0, SUPERVISOR STATE, ENABLED, TYPE 4 SVC.                 01788200
*                                                                       01790200
*         APPLICABILITY                                                 01792200
*                                                                       01794200
*              AOS/2                                                    01794600
*                                                                       01795000
*         MODULE CHARACTERISTICS                                        01795400
*                                                                       01795800
*              TYPE - LOAD MODULE                                       01795900
*                                                                       01796000
*              RESIDENCE - SYSTEM LINK PACK AREA                        01796100
*                                                                       01812800
*         DEPENDENCIES                                                  01822800
*                                                                       01824800
*         - THE CHECKPOINT DATA SET MUST BE POSITIONED TO ACCEPT THE    01826800
*           FIRST ASR RECORD.                                           01828800
*         - THE CHKWA MUST BE OBTAINED FROM LSQA (SP253) AND PROPERLY   01829200
*           INITIALIZED BY THE CHECKPOINT HOUSEKEEPING ROUTINE.         01829300
*         - THE CHECKPOINT PRESERVE ROUTINE MUST GIVE CONTROL TO        01829400
*           CHECKMAIN 1 WITH KEY 0, SUPERVISOR STATE, AND INTERRUPS     01835000
*           ENABLED.                                                    01837000
*                                                                       01839000
* NOTES                                                                 01839400
*                                                                       01839800
*         OPERATION                                                     01840200
*                                                                       01840300
*                                                                       01840400
*         INITIALIZATION PROCESSING                                     01840500
*                                                                       01890500
*         THE MODULE RECEIVES CONTROL FROM THE SCHEDULAR PORTION OF     01900500
*         CHECKPOINT VIA XCTL. UPON RECEIVING CONTROL THE MODULE        01910500
*         ESTABLISHES ADDRESSABILITY FOR THE CODE AND FOR CHECKPOINT    01920500
*         WORK AREA (CHKWA) PASSED IN GPR 1. GPR 12 IS USED AS THE BASE 01930500
*         FOR THE WORK AREA. INITIALIZATION IS PERFORMED FOR THE I/O    01932500
*         OPERATIONS USED TO WRITE OUT THE REGION. THIS CONSISTS OF     01934500
*         SETTING GPR 13 TO THE ADDRESS OF AN 18 WORD REGISTER SAVE     01936500
*         AREA (CKREGSAV) CONTAINED IN THE CHKWA. THIS SAVE AREA IS     01938500
*         USED BY THE BSAM/BPAM WRITE AND CHECK ROUTINES. THE ADDRESS   01938900
*         OF THE CHECKMAIN 1 SYNAD ROUTINE (CM2E320) IS PLACED IN THE   01939300
*         DCBSYNAD FIELD OF THE DCB. THE TWO DECB'S CONTAINED IN THE    01939700
*         CHKWA ARE INITIALIZED TO A BUFFER LENGTH OF 2048 (2K) BYTES.  01940100
*         THEN IF THE NUMBER OF CHANNEL PROGRAMS AS SPECIFIED IN THE    01940200
*         DCBNCP FIELD OF THE CHECKPOINT DCB IS 1, A SWITCH IS SET IN   01940300
*         THE CHKWA TO INDICATE THAT SINGLE BUFFERING IS TO BE USED.    01940400
*         INITIALIZATION IS THEN PERFORMED FOR THE MAPPING OF THE USER  01957100
*         REGION.                                                       01967100
*                                                                       01969100
*         THE ADDRESS OF THE USER TCB IS OBTAINED FROM THE CHKTCBAD     01971100
*         FIELD OF THE CHKWA. THE STARTING ADDRESS OF THE REGION IS     01973100
*         OBTAINED VIA THE PQE AND IS SET AS THE FIRST ELEMENT START    01973500
*         ADDRESS. THE 2K ASR BUFFER IS ESTABLISHED IN THE 4K SUR/SSCR  01973602
*         BUFFER AND THE ASR HEADER IS INTIALIZED TO 0.                 01980602
*                                                                       01983902
*         MAPPING THE EXTENTS OF ALLOCATED USER STORAGE                 01987202
*                                                                       01990502
*         1)   THE ADDRESS OF THE FIRST/NEXT FBQE IS OBTAINED FROM      01993802
*              THE PREVIOUS FBQE/PQE FORWARD POINTER FIELD. A TEST      01997102
*              TO DETERMINE IF AN FBQE EXISTS IS PERFORMED, AND IF      02000402
*              NOT, PROCESSING CONTINUES WITH STEP 3. IF THERE IS       02003702
*              AN FBQE, THE FREE AREA STARTING ADDRESS IS COMPARED      02007002
*              TO THE CURRENT ELEMENT STARTING ADDRESS. IF THEY ARE     02010302
*              EQUAL,PROCESSING CONTINUES WITH STEP 2. IF THEY ARE      02013600
*              NOT EQUAL, THE CURRENT ELEMENT ENDING ADDRESS IS SET     02023600
*              EQUAL TO THE FREE AREA STARTING ADDRESS, AND A CALL      02033600
*              IS MADE TO THE 'SETASRE' ROUTINE. UPON RETURN FROM       02035600
*              SETASRE PROCESSING CONTINUES WITH STEP 2.                02037600
*                                                                       02039600
*         2)   A TEST IS PERFORMED TO DETERMINE IF THE REST OF THE      02041600
*              REGION IS FREE. THE ADDRESS OF THE END OF THE REGION     02042000
*              IS COMPARED TO THE ADDRESS OF THE END OF THE FREE AREA   02042100
*              DESCRIBED BY THE FBQE. IF THEY ARE EQUAL, PROCESSING     02042200
*              CONTINUES WITH STEP 4. IF THE REST OF THE REGION IS      02042300
*              NOT FREE, THE CURRENT ELEMENT START ADDRESS IS SET       02051900
*              EQUAL TO THE END OF THE FREE AREA DESCRIBED BY THE       02053900
*              FBQE, AND PROCESSING CONTINUES WITH STEP 1.              02055900
*                                                                       02057900
*         3)   WHEN THERE ARE NO MORE FBQE'S, IT IS ASSUMED THAT THE    02059900
*              REST OF THE REGION IS ALLOCATED. THEREFORE, THE CURRENT  02060300
*              ELEMENT ENDING ADDRESS IS SET EQUAL TO THE REGION        02060700
*              ENDING ADDRESS, AND A CALL IS MADE TO THE SETASRE        02061100
*              ROUTINE. UPON RETURN FROM SETASRE, PROCESSING CONTINUES  02061500
*              WITH STEP 4.                                             02071100
*                                                                       02073100
*         4)   WHEN THERE ARE NO FBQE'S THE LAST ASR FLAG IS SET IN     02075100
*              THE ASR HEADER, AND PROCESSING CONTINUES AS DESCRIBED    02077100
*              UNDER 'WRITING THE ASR AND CIR'S.                        02079100
*                                                                       02079500
*         FORMATTING THE ASR - SETASRE                                  02079900
*                                                                       02080300
*         1)   UPON ENTRY, A TEST IS PERFORMED TO DETERMINE IF THE      02080700
*              ASR BUFFER IS FULL (IE. IF THE ASRE COUNT IN THE ASR     02130700
*              HEADER IS EQUAL TO 255). IF SO, PROCESSING CONTINUES     02140700
*              WITH STEP 1 UNDER THE HEADING 'WRITING THE ASR AND       02150700
*              CIR'S. IF THE ASR BUFFER IS NOT FULL, PROCESSING         02160700
*              CONTINUES WITH STEP 2.                                   02170700
*                                                                       02172700
*         2)   THE EXTENTS OF THE ALLOCATED AREA ARE PLACED INTO THE    02174700
*              NEXT ASRE SLOT IN THE ASR BUFFER. THIS SLOT IS DEFINED   02176700
*              AS  (ASR BUFFER STARTING ADDRESS+(8*(ASRE COUNT+1))).    02178700
*              THE ASRE COUNT IS UPDATED BY 1, AND RETURN IS MADE TO    02179100
*              THE CALLER.                                              02179500
*                                                                       02179900
*         WRITING THE ASR AND CIR'S.                                    02180300
*                                                                       02180400
*         1)   UPON ENTRY, A CALL IS MADE TO THE WRITERTN SUBROUTINE    02180500
*              TO OUTPUT THE COMPLETED ASR. UPON RETURN, THE ASRE       02180600
*              COUNT IS CHECKED FOR A 0 VALUE. IF 0, IT IS ASSUMED      02197300
*              THAT THIS IS THE LAST ASR, AND PROCESSING CONTINUES      02207300
*              WITH STEP 2. IF THE ASRE COUNT IS NOT 0, THE COUNT IS    02209300
*              USED AS A LOOP COUNT. EACH ASRE IS RETRIEVED FROM THE    02211300
*              ASR RECORD (ASRE LENGTH = 8 BYTES). THE STORAGE          02213300
*              DESCRIBED BY THE ELEMENT IS WRITTEN IN 2K BLOCKS BY      02213700
*              SUCCESSIVE CALLS TO THE WRITERTN SUBROUTINE. AFTER THE   02213800
*              THE LAST ASRE HAS BEEN PROCESSED, THE LAST ASR FLAG      02213900
*              IS TESTED. IF ON, PROCESSING CONTINUES WITH STEP 2.      02219500
*              IF NOT ON, THE ASR HEADER IS RE-INITIALIZED TO 0, AND    02221500
*              PROCESSING CONTINUES WITH STEP 2 UNDER THE HEADING       02223500
*              'FORMATTING THE ASRE'.                                   02223900
*                                                                       02224300
*         2)   IF THE LAST WRITE HAS NOT BEEN CHECKED, A CALL IS MADE   02224700
*              TO THE CHECK SUBROUTINE AND THE CHECK FOR EOV SUBRTN.    02224800
*              UPON RETURN, OR IF THE LAST WRITE HAD BEEN CHECKED, AN   02224900
*              XCTL IS PERFORMED TO THE NEXT LOAD OF CHECKMAIN.         02225000
*                                                                       02238900
*                                                                       02248900
*         REGISTER USAGE WITHIN MODULE                                  02250900
*                                                                       02251300
*         0    PARAMETER REGISTER, WORK REGISTER                        02251700
*         1    PARAMETER REGISTER, WORK REGISTER                        02252100
*         2    BASE FOR DCB, RETURN REGISTER FOR WRITERTN               02252500
*         3    BASE FOR PQE AND FBQE                                    02252600
*         4    BASE FOR TCB, AND ASR BUFFER POINTER                     02252700
*         5    RETURN REG FOR CKEOVOL, CKWRITE1                         02252800
*         6    RETURN REG FOR SETASRE                                   02257400
*         7    ASRE INDEX REG                                           02259400
*         8    ELEMENT COUNT REG                                        02261400
*         9    (UNUSED)                                                 02261800
*         A    BUFFER ADDRESS TO WRITE FROM (PARAM FOR SETASRE)         02261900
*         B    BASE FOR CODE                                            02262000
*         C    BASE FOR CHKWA                                           02262100
*         D    ADDRESS OF SAVE AREA FOR ACCESS METHOD USE               02266700
*         E    RETURN FOR CMSYNAD, IMPLICITLY USED BY ACCESS METHODS    02268700
*         F    WORK REGISTER, ACCUMULATOR, TEMPORARY STORAGE            02270700
         EJECT                                                          02271100
IGC0F06C CSECT                                                          02271200
*                                                                YM2776 02283701
         BALR  RB,R0               ESTABLISH BASE                       02296401
         USING *,RB                                                     02308901
         B     BEGIN               BRANCH AROUND CSECT NAME             02321400
         DC    H'0'                PAD TO DOUBLEWORD BOUNDARY           02331400
         DC    C'IGC0F06C'         CSECT NAME                           02341400
BEGIN    LR    RC,R1               BASE FOR CHECKPOINT WORK AREA        02351400
         USING CHKWA,RC                                                 02361400
         LA    RD,CKREGSAV         GET ADDRESS OF SAVE AREA FOR I/O     02363400
         L     R2,CKDCBAD          GET CHKPT. DCB ADDRESS               02365400
         USING IHADCB,R2                                                02367400
         LA    RF,CM2E320          GET ADDRESS OF SYNAD RTN             02369400
         STCM  RF,M7,DCBSYNAD+N1   STORE ADDRESS IN DCB (3 BYTES)       02369800
         XC    CMWA(CMWAEND-CMWA),CMWA  CLEAR THE WORK AREA, SWITCHES   02370200
         LA    RF,N2048            INITIALIZE BUFFER SIZE IN DECB'S     02370600
         STH   RF,CKLNGTH1         DECB1 TO 2K                          02371000
         STH   RF,CKLNGTH2         DECB2 TO 2K                          02371100
         CLI   DCBNCP,N1           IS 1 CHANNEL PROGRAM SPECIFIED       02371200
         BH    CM2E050             NO- USE 2 CHANNEL PROGRAMS           02371300
         OI    SWITCH,CMSINGLE     INDICATE 1 CHANNEL PROGRAM           02388000
CM2E050  MVC   CKMXLIST(N8),CMN40NM MOVE IN DEFAULT NAME OF NEXT MODULE 02398000
         L     R4,CKTCBAD          GET ADDRESS OF USER'S TCB            02400000
         USING TCB,R4                                                   02402000
         L     R3,TCBPQE           GET POINTER TO DPQE-8                02404000
         USING PQESECT,R3                                               02404400
         DROP  R4                  STOP USING R4 AS TCB POINTER         02404500
         L     R3,PQEFPQE          GET ADDRESS OF REGION PQE            02404600
         L     RF,PQEREGN          GET START ADDRESS OF REGION          02410200
         LA    RF,Z(RF)            CLEAR HIGH ORDER BYTE TO 0.          02412200
         ST    RF,CMCESA           SET-ELEMENT START ADDR = REG. START  02414200
         MVC   CMRGEND,CKPPE       SET CMRGEND EQUAL TO CKPPE    Y02076 02414602
         DROP  R3                  STOP USING R3 AS PQE BASE            02415400
         USING FBQESECT,R3         START USING IT AS AN FBQE POINTER    02415500
         STCM  R3,M7,CMPQEAD+N1    SAVE THE PQE ADDRESS FOR COMPARES    02415600
         LR    R1,RC               GET ADDR OF                   Y02076 02425602
         A     R1,CKBFOFST         SUR/SSCR BUFFER               Y02076 02427602
         STCM  R1,M7,CMASRAD+N1    SAVE THE ASR BUFFER ADDRESS          02429600
         XC    Z(N8,R1),Z(R1)      ZERO OUT THE ASR HEADER AND FLAGS    02439600
         SPACE 3                                                        02441600
*        START OF REGION MAPPING                                        02442000
         SPACE 2                                                        02442400
CM2E100  CLC   CMPQEAD+N1(N3),FWDPTR+N1 IS THERE AN FBQE                02442800
         BE    CM2E130             NO, FWD PTR POINTS TO PQE            02443200
         L     R3,FWDPTR           GET ADDR OF NEXT FBQE FROM PREV.     02443300
         CLC   FBQAREA+N1(N3),CMCESA+N1 DOES ELEM. START = FREE START   02443400
         BE    CM2E120             YES, GO TEST FOR END OF REGION       02443500
         MVC   CMCEEA+N1(N3),FBQAREA+N1 SET ELEMENT END=FREE AREA START 02448100
         BAL   R6,SETASRE          BUILD AN ASRE                        02450100
CM2E120  L     RF,SIZE             GET SIZE OF FREE AREA                02452100
         A     RF,FBQAREA          CALCULATE END OF FREE AREA           02452500
         C     RF,CMRGEND          IS FREE AREA END = REGION END        02452600
         BNL   CM2E140             YES, GO WRITE OUT CURRENT ASR        02452702
         ST    RF,CMCESA           SET CURR. ELEM. START= FREE AREA END 02452800
         B     CM2E100             GO SEARCH FOR NEXT FREE AREA         02457400
         SPACE                                                          02459400
*        THE REST OF THE REGION IS ALLOCATED                            02461400
         SPACE                                                          02461800
CM2E130  MVC   CMCEEA(N4),CMRGEND  SET ELEM.END = REGION END            02461900
         BAL   R6,SETASRE          BUILD THE LAST ASRE                  02462000
CM2E140  L     R4,CMASRAD          GET ADDRESS OF ASR BUFFER            02462100
         USING ASRHDR,R4                                                02512100
         OI    ASRFLG1,ASRLAST     SET LAST ASR FLAG IN ASR HEADER      02522100
CM2E150  DS    0H                  LABEL                                02532100
         LR    RA,R4               SET TO WRITE FROM ASR BUFFER         02542100
         TM    CKFLAG1,CKVEQR      IS THIS TASK V=R?             YM2776 02544101
CKVEQR   EQU   8                        V=R BIT IN W. A.        YA00258 02544502
         BNO   CKNOVEQR            NO, GO ON                     YM2776 02546101
         LRA   RA,0(,RA)           LOAD REAL ADDRESS OF ASR      YM2776 02548101
CKNOVEQR DS    0H                                                YM2776 02550102
         BAL   R2,WRITERTN         WRITE OUT THE ASR BUFFER             02552100
         SPACE 3                                                        02554100
* WRITE OUT THE ALLOCATED STORAGE DESCRIBED BY THIS ASR RECORD          02556100
         SPACE                                                          02558100
         LH    R8,ASRCOUNT         GET ELEMENT COUNT FROM ASR BUFFER    02560100
         LTR   R8,R8               IS COUNT 0                           02560500
         BZ    CM2E190             YES, GO PREPARE TO EXIT              02560900
         SR    R7,R7               CLEAR ASRE INDEX                     02561300
CM2E170  LA    R7,N8(R0,R7)        SET ASRE INDEX = ASRE INDEX + 8      02561700
         L     RA,N0(R7,R4)        SET CIR BUFFER START=ELEMENT START   02561800
CM2E180  BAL   R2,WRITERTN         WRITE THE CIR                        02561900
         LA    RA,N2048(R0,RA)     UP CIR BUFFER START BY 2K            02562000
         C     RA,N4(R4,R7)        HAS ALLOCATED AREA WRITTEN           02578700
         BL    CM2E180             NO, WRITE MORE                       02588700
         BCT   R8,CM2E170          BRANCH IF MORE ASRE'S LEFT           02590700
         TM    ASRFLG1,ASRLAST     IS THIS LAST ASR                     02592700
         ST    R8,ASRHDR           RESET ASR HEADER TO 0 (GPR8 IS 0)    02594700
         BZ    CM2E220             NOT LAST ASR SO RETURN TO SETASRE    02595100
CM2E190  DS    0H                  LABEL                                02595200
         TM    SWITCH,CMWRITE1     HAS LAST WRITE BEEN CHECKED          02595300
         BZ    CM2E200             YES, GO FREE THE BUFFER AND LEAVE    02600900
         BAL   R5,CKWRITE1         NO, CHECK THE WRITE                  02602900
         BAL   R5,CKEOVOL          CHECK FOR END OF VOLUME              02604900
         SPACE 3                                                        02605300
CM2E200  DS    0H                  LABEL                                02606102
         LR    R1,RC               PUT CHKWA ADDRESS BACK IN GPR1.      02606200
         LA    RF,CKMXLIST         GET ADDRESS OF MODULE NAME           02606300
         ST    RF,CKMN40AD         PUT IT IN THE WORK AREA              02606400
         LA    RF,CKMN40AD         GET ADDR OF ADDR                     02620300
         XCTL  SF=(E,(15))         XCTL TO NEXT LOAD                    02630300
         SPACE 3                                                        02632300
*        SETASRE ROUTINE - BUILDS AN ASR ENTRY AND WRITES OUT THE       02632700
*              ASR RECORD AND ITS DESCRIBED STORAGE IF THE ASR IS FULL  02633100
         SPACE                                                          02633500
SETASRE  DS    0H                                                       02633900
CM2E210  L     R4,CMASRAD          GET ADDRESS OF ASR HEADER            02634000
         USING ASRHDR,R4                                                02634100
         CLI   ASRCOUNT+N1,N255    IS ASR BUFFER FULL                   02634200
         BNL   CM2E150             YES, GO WRITE THE ASR AND CIR'S      02638800
CM2E220  DS    0H                  LABEL                                02640800
         LH    RF,ASRCOUNT         GET THE NUMBER OF ASRE'S IN BUFFER   02642800
         LA    RF,N1(R0,RF)        ADD 1                                02643200
         STH   RF,ASRCOUNT         UPDATE THE COUNT IN THE ASR HEADER   02643300
         SLL   RF,N3               MULTIPLY BY 8 TO GET INDEX VALUE     02643400
         AR    RF,R4               GENERATE POINTER TO ASRE             02643500
         MVC   Z(N8,RF),CMCESA     MOVE IN AREA START AND END ADDRESSES 02648100
         BR    R6                  RETURN TO CALLER                     02650100
         EJECT                                                          02652100
*                                                                       02652500
*        WRITE RTN - CHECKMAIN 1 WRITE ROUTINE                          02652600
*                                                                       02652700
WRITERTN DS    0H                                                       02652800
CM2E240  TM    SWITCH,CMWRITE1     WAS LAST WRITE ON DECB 1             02702800
         BZ    CM2E260             NO, GO USE DECB 1                    02712800
         TM    SWITCH,CMSINGLE     WAS SINGLE BUFFERING REQUESTED       02722800
         BO    CM2E250             YES, GO CHECK THE WRITE              02732800
         WRITE CKDECB2,SF,,(RA),,MF=E  WRITE AN ASR/CIR WITH DECB 2.    02742800
         BAL   R5,CKWRITE1         GO CHECK DECB1                       02744800
         CHECK CKDECB2             NOW CHECK DECB2                      02746800
         CLI   CKRETIO,CKIOERR     WAS THERE AN I/O ERROR               02748800
         BE    CM2E280             YES, GO STOP THE CHECKPOINT          02750800
         NI    SWITCH,ON-CMWRITE1  NO, TURN OFF THE DECB 1 SWITCH       02751200
         BAL   R5,CKEOVOL          GO CHECK FOR END OF VOLUME.          02751600
         BR    R2                  RETURN TO CALLER                     02752000
         SPACE 2                                                        02752400
CM2E250  BAL   R5,CKWRITE1         DECB 1                               02752500
         BAL   R5,CKEOVOL          CHECK FOR EOV                        02752600
CM2E260  DS    0H                                                       02762602
         WRITE CKDECB1,SF,,(RA),,MF=E WRITE ASR/CIR WITH DECB1          02766600
         OI    SWITCH,CMWRITE1     SET SWITCH FOR DECB1.                02769400
         BR    R2                  RETURN TO CALLER                     02779400
         SPACE                                                          02781400
CM2E280  MVI   CKMXLIST+N4,CHARN   CAUSE XCTL TO IGC0N06C               02783400
         B     CM2E200             GO FREE THE BUFFER AND RETURN.       02785400
         SPACE 3                                                        02785800
*        CKWRITE1 ROUTINE                                               02785900
         SPACE 1                                                        02786000
*              THIS ROUTINE PERFORMS THE CHECK FOR DECB 1.              02791600
CKWRITE1 EQU   *                   CHECK RTN FOR DECB                   02793600
CK2E270  CHECK CKDECB1                                                  02795600
         CLI   CKRETIO,CKIOERR     Q. I/O ERROR                         02796000
         BCR   NOTEQ,R5            A. NO. RETURN TO CALLER              02796400
         B     CM2E280             A. YES. GO XCTL TO IGC0N06C   Y02076 02796802
         SPACE 3                                                        02796900
*        SYNAD ROUTINE FOR CHECKMAIN1                                   02797000
         SPACE 1                                                        02797100
*              THIS ROUTINE SETS THE ERROR CODE AND MSG NUMBER IN THE   02811000
*              CHECKPOINT WORK AREA.  THE CHECK ROUTINES WILL TEST      02821000
*              THE FLAG AND TERMINATE PROCESSING.                       02823000
CMSYNAD  EQU   *                   SYNAD RTN                            02823400
CM2E320  MVI   CKRETIO,CKIOERR     SET FLAG OF 12 FOR I/O ERROR         02823800
         LA    R0,NX317            SET MESSAGE NUMBER/ERROR CODE        02824200
         STH   R0,CKMSGCOD         INTO WORK AREA                       02824600
         RETURN                                                         02824700
*        CKEOVOL - THIS SUBROUTINE DETERMINES IF AN END OF VOLUME       02824800
*                  CONDITION IS PENDING.                                02824900
CKEOVOL  EQU   *                   END OF VOLUME ROUTINE                02829500
CM2E290  TM    CKFLAG1,CKTAPE      Q. IS CHECKPOINT DATA SET ON TAPE    02831500
         BZ    CM2E300             NO. IT IS A DIRECT ACCESS DEVICE     02833500
         L     RF,CKTSTEOV         GET ADDR OF VOL. SEQUENCE NUMBER     02833900
         CLC   Z(N4,RF),CKEOVCMR   Q. DID EOV OCCUR (HAS IT CHANGED)    02834000
         BCR   EQ,R5               A. NO RETURN TO CALLER               02834100
         TM    CKFLAG2,CKEOV       EOV ON PREVIOUS TAPE                 02834200
         BO    CM2E310             YES, GO CANCEL THE CHECKPOINT        02838800
         OI    CKFLAG2,CKEOV       TURN ON THE EOV INDICATOR            02840800
         MVI   CKMXLIST+N4,CHAR2   SET REG TO CAUSE XCTL TO IGC0206C    02842800
         B     CM2E200             GO FREE THE ASR BUFFER AND TRY AGAIN 02843200
*        EOV ON DASD                                                    02843300
         SPACE                                                          02843400
CM2E300  L     RF,CKDCBAD          GET DCB ADDRESS                      02843500
         USING IHADCB,RF                                                02874800
         L     RF,DCBDEBAD         GET DEB ADDRESS                      02884800
         DROP  RF                                                       02894800
         USING DEBBASIC,RF                                              02904800
         CLC   DEBNMEXT(N1),CKTSTEOV    EOV ON DASD                     02905200
         BCR   EQ,R5                    NO, RETURN TO CALLER            02905600
         DROP  RF                                                       02906000
         SPACE                                                          02916400
*        AN EOV ON DASD OR SECOND EOV ON TAPE HAS OCCURRED              02926400
         SPACE                                                          02926800
CM2E310  MVI   CKRETIO,CKEOVCOD    SET UP RETURN CODE OF 8.             02926900
         MVI   CKMXLIST+N4,CHARN   SET TO GO TO IGC0N06C                02930400
         LA    RF,CKERIO7          SET UP EOV ERROR                     02932400
         STH   RF,CKMSGCOD              MESSAGE CODE                    02932800
         B     CM2E200             GO FREE ASR BUFFER AND EXIT          02933200
         EJECT                                                          02933600
*              CONSTANTS FOR CHECKMAIN 1.                               02933700
         SPACE 3                                                        02933800
CMN40NM  DC    C'IGC0G06C'         NAME OF CHECKMAIN2 (IHJVCP40)        02942500
         SPACE 3                                                        02944500
*              MASK EQUATES                                             02946500
         SPACE 3                                                        02948500
M7       EQU   7                   MASK FOR ICM/STCM INSTRUCTIONS.      02950500
NOTEQ    EQU   7                   MASK TO BRANCH ON NOT EQUAL COMPARE  02950900
EQ       EQU   8                   MASK TO BRANCH ON EQUAL COMPARE      02951000
ON       EQU   255                 MASK FOR BIT RESET                   02951102
         SPACE 3                                                        02951200
*              GENERAL EQUATES                                          02960900
         SPACE 3                                                        02962900
Z        EQU   0                   ZERO                                 02964900
N0       EQU   0                   NUMBER 0                             02966900
N1       EQU   1                   NUMBER 1                             02968900
N3       EQU   3                   NUMBER 3                             02969300
N4       EQU   4                   NUMBER 4                             02969700
N7       EQU   7                   NUMBER 7                             02970100
N8       EQU   8                   NUMBER 8                             02970500
N2048    EQU   2048                2K BLOCK SIZE                        02970600
N255     EQU   255                 MAX. NO. OF ASRE'S IN AN ASR RECORD  02970700
         SPACE 3                                                        02970800
*              ERROR MESSAGE CODES/RETURN CODES                         03020800
         SPACE 3                                                        03030800
CKEOVCOD EQU   8                   RETURN CODE FOR END OF VOLUME        03040800
NX317    EQU   X'317'              ERROR CODE FOR I/O ERROR             03050800
CKERIO7  EQU   X'31B'              MESSAGE CODE FOR END OF VOLUME       03060800
CHAR2    EQU   C'2'                EBCDIC 2                             03062800
CHARN    EQU   C'N'                EBCDIC N                             03064800
         SPACE 3                                                        03066800
*              PATCH AREA FOR MAINTENANCE                               03068800
         SPACE 3                                                        03069200
PATCH    EQU   *                   END OF MODULE                        03069600
CM1LEN   EQU   PATCH-IGC0F06C      LENGTH OF CSECT                      03070000
PATCHLEN EQU   CM1LEN/10           LENGTH OF PATCH AREA                 03070400
CMIPATCH DS    CL(PATCHLEN)        PATCH AREA OF 10 PERCENT.            03070500
         EJECT                                                          03070600
*              DSECT  USED FOR ASR HEADER                               03070700
         SPACE 3                                                        03087400
ASRHDR   DSECT                                                          03097400
ASRCOUNT DS    H                   NUMBER OF ENTRIES IN ASR RECORD      03099400
ASRFLG1  DS    X                   ASR FLAG BYTE                        03101400
ASRLAST  EQU   X'80'               LAST ASR RECORD                      03103400
ASRRESV  DS    5X                  RESERVED                             03103800
         EJECT                                                          03103900
         IEEVCHWA  VER=3           USE VERSION 3 OF WA                  03104000
CMWA     DS    0D                  START OF CHECKMAIN WORK AREA         03109600
CKRETIO  EQU   CKRETCOD+1          CELL FOR RETURN CODE                 03111600
CKTSTEOV EQU   CKUNIT              EOV TEST 1                           03113602
CKEOVCMR EQU   CKUNIT+4            EOV TEST 2                           03114002
* THE ORDER OF THE NEXT TWO FIELDS MUST BE CMCESA, CMCEEA               03114400
CMCESA   DS    F                   CURRENT ELEMENT START ADDRESS        03114800
CMCEEA   DS    F                   CURRENT ELEMENT ENDING ADDRESS       03114900
SWITCH   DS    F                   SWITCH WORD                          03115000
CMWRITE1 EQU   2                   INDICATES WRITE1 WAS LAST WRITE      03115100
CMSINGLE EQU   1                   INDICATES SINGLE BUFFERING           03129000
CKMN40AD DS    F                   SET TO ADDRESS OF CKMXLIST FOR XCTL  03139000
CKMXLIST DS    2F                  NAME OF NEXT MODULE TO GET CONTROL   03141000
CMRGEND  DS    F                   REGION END ADDRESS                   03141400
CMASRAD  DS    F                   ADDRESS OF START OF ASR BUFFER       03141800
CMPQEAD  DS    F                   ADDRESS OF THE PQE FOR REGION        03142200
CMWAEND  EQU   *                   END OF CHECKMAIN WORK AREA           03142600
         EJECT                                                          03142700
         IKJTCB                                                         03142800
         EJECT                                                          03142900
         IHAPQE                                                         03147500
         EJECT                                                          03149500
         IHAFBQE                                                        03151500
         EJECT                                                          03151900
         IHADCB DSORG=(BS,PO),DEVD=(DA,TA)                              03152000
         EJECT                                                          03152100
         IEZDEB                                                         03152200
.LIB1BA1 ANOP                                                           03156800
         AIF   ('&LIB' EQ 'LIB2').LIB2BA1  TEST FOR LIB2(AOS)           03158800
*                                                                       03161600
*0000501000-516000,540000-543000,549000                          A38515 03166200
*   STATUS ... CHANGE LEVEL 001                                         03170800
*                                                                       03220800
*   FUNCTION ...                                                        04000017
*                                                                       05000017
*        WRITES CORE IMAGE RECORDS (CIR'S) OF THE REGION              * 06000017
*        ON CHKPT DATA SET, AND TRANSFERS CONTROL TO THE NEXT LOAD OF   07000017
*        CHECKPOINT.                                                    08000017
*                                                                       09000017
*   ENTRY ...                                                           10000017
*                                                                       11000017
*        CHKMAIN IS ENTERED VIA A TRANSFER CONTROL FROM THE PREVIOUS    12000017
*        CHECKPOINT LOAD AT ENTRY POINT IGC0F06C                        16000017
*                                                                       16300017
*   INPUT ...                                                           16600017
*                                                                       16900017
*   ..   DATA SET UP BY PREVIOUS LOADS OF CHECKPOINT AND MADE AVAILABLE 17200017
*        TO CHKMAIN IN THE CHKPT WORK AREA (W.A.).                      17500017
*   ..   THE ADDRESS OF THE CHKPT W.A. IS PASSED IN GENERAL REGISTER 1  17800017
*        BY THE PREVIOUS LOAD OF CHECKPOINT.                            18100017
*   ..   THE FOLLOWING DATA, RESIDING IN THE CHKPT W.A. IS USED BY THE  18400017
*        CHKMAIN ROUTINE.                                               18700017
*              CKWAOFST - OFFSET TO BEGINNING OF CHKMAIN AND CHKPT W.A. 19000017
*              CKBFOFST - OFFSET TO BEGINNING OF CHKPT'S BUFFER         19300017
*              CKDCBAD  - POINTER TO CHKPT DATA SET DCB                 19600017
*              CKWACL   - LENGTH OF CHKPT W.A.                          19900017
*              CKBUFL   - LENGTH OF CHKPT BUFFER                        20200017
*              CKTCBAD  - POINTER TO PP TCB                             20500017
*              CKPPM    - POINTER TO FIRST BYTE IN PP AREA              20800017
*              CKPPE    - POINTER TO LAST BYTE IN PP AREA               21100017
*              CKDECB1  - POINTER TO DECB FOR WRITE 1                   21400017
*              CKDECB2  - POINTER TO DECB FOR WRITE 2                   21700017
*                                                                       22000017
*   OUTPUT ...                                                          22300017
*                                                                       22600017
*   ..   OUTPUT CONSISTS OF CORE IMAGE RECORDS OF CHKPT DATA SET      * 22900017
*                                                                       23200017
*   EXITS ...                                                           23500017
*                                                                       23800017
*   NORMAL- XCTL TO IGC0G06C (NEXT LOAD OF RESTART)                   * 24100017
*   ERROR                                                             * 24400017
*   (1)UNRECOVERABLE EOV ON CKPT DATA SET- XCTL TO IGC0N06C WITH      * 24700017
*      RETURN CODE OF 8                                               * 25000017
*   (2)RECOVERABLE EOV ON CKPT DATA SET- XCTL TO IGC0206C             * 25300017
*   (3)I/O ERROR- XCTL TO IGC0N06C WITH RETURN CODE OF 12             * 25600017
*                                                                     * 25900017
*                                                                     * 26200017
*                                                                       26500017
*   WORK AREAS ...                                                      26800017
*                                                                       27100017
*   ..   CHKMAIN USES THE FOLLOWING WORK AREAS WHICH ARE BUILT BY THE   27400017
*        FIRST LOAD OF CHECKPOINT.                                      27700017
*                                                                       28000017
*              CHKWA - CHKPT W.A. BUILT BY CHKPT CONTAINING DATA TO BE  28300017
*                      UTILIZED BY SUBSEQUENT LOADS OF CHECKPOINT.      28600017
*              CMWA  - WORK AREA ALLOCATED BY CHKPT FOR USE BY THE      28900017
*                      CHKDCB AND CHKMAIN ROUTINES.                     29200017
*                                                                       29500017
         EJECT                                                          29800018
*                                                                       30100017
*                                                                       30400017
*       THIS ROUTINE WRITES OUT THE PROBLEM PROGRAM STORAGE.            30700017
*                                                                       31000017
*                                                                       31300017
IGC0F06C CSECT                                                          33300017
*2841010000-020000,298000,384000,444000-447000,471000,513000,           33370018
*    552000-558000,585000,627000,657000-663000,672000,786000,801000,    33440018
*    825000,837000-846000                                               33510018
         BALR  RB,R0          ESTABLISH BASE                            33600017
         USING *,RB                                                     33900017
         USING CHKWA,RC       ADDRESS CHKPT W.A.                        34200017
         USING IHADCB,R2      ADDRESS CHKPT DCB.                        34500017
         LR    RC,R1          GET ADDR OF CHKPT W.A.                    34800017
         LA    RD,CKREGSAV    GET ADDR OF REG S.A.                      35100017
         L     R2,CKDCBAD     GET CHKPT DCB ADDR                        35400017
         LA    RF,CM2A2       GET ADDR OF CHKMAIN SYNAD ROUTINE         35700017
         ST    RF,CMSYSA                                                36000017
         MVC   DCBSYNAD+N1(N3),CMSYSA+N1     PUT ADR. OF CM2A2          36300017
*                                            IN SYNAD FIELD             36600017
         MVI   SWITCH,X0      INITIALIZE SWITCHES                       36900017
         CLI   DCBNCP,X1      Q.  IS SINGLE BUFFERING INDICATED         37200017
         BH    CM2E1          NO-MULTIPLE BUFFERING SPECIFIED.          37500017
         OI    SWITCH,CMS1    SET CMS1 ON- SINGLE BUFFERING             37800017
CM2E1    EQU   *                                                        38100017
         L     RA,CKPPE       CALCULATE LOW AND HIGH BOUNDS OF          38700017
         LTR   RA,RA               Q. W.A. IN H0                   I283 38760019
         BNE   CM2E2               A. YES  SKIP H1 W.A. CODE       I283 38820019
         L     RA,CKPPEL           A. NO  W.A. IS IN H1            I283 38880019
CM2E2    EQU   *                                                   I283 38940019
         LR    R9,RC          AREA ABOVE W.A.                           39000017
         A     R9,CKWACL                                                39300017
         BAL   R8,CMINTW      GO TO WRITE OUT CORE ABOVE W.A.           39600017
         LA    RA,CHKWA       GET LOW AND HIGH BOUNDS OF                39900017
         BCTR  RA,R0          DECREMENT COUNT                           40200017
         L     R9,CKPPM       AREA ABOVE W.A.                           40500017
         LTR   R9,R9               Q. W.A. IN H0                   I283 40560019
         BNE   CM2E3               A. YES  SKIP H1 W.A. CODE       I283 40620019
         L     R9,CKPPML           A. W.A. IS IN H1               M2811 40680019
CM2E3    EQU   *                                                   I283 40740019
         BAL   R8,CMINTW      GO TO WRITE OUT CORE BELOW W.A.           40800017
         L     RA,CKPPEL      GET HIGH BOUNDARY OF HIERARCHY ONE.       41100017
         LTR   RA,RA          Q. DOES THIS REGION HAVE A HIERARCHY      41400017
         BZ    CMSKP          NO                                        41700017
         L     R9,CKPPE            SET UP TEST FOR H0 SEGMENT      I283 41770019
         LTR   R9,R9               Q. IS THERE AN H0 SEGMENT       I283 41840019
         BE    CMSKP               A. NO  H1 ALREADY WRITTEN       I283 41910019
         L     R9,CKPPML      GET LOW BOUNDARY OF HIERARCHY ONE.        42000017
         BAL   R8,CMINTW      GO TO WRITE OUT HIERARCHY ONE CORE.       42300017
CMSKP    EQU   *                                                        42600017
         TM    SWITCH,CMS2    Q. HAS LAST WRITE BEEN CHECKED            42900017
         BZ    CMSKP2         YES-SKIP CODE TO CHECK.LAST WRITE         43200017
         BAL   R5,CMCHK1      GO TO CHECK LAST WRITE                    43500017
         BAL   R5,CMEOV       GO TO SEE IF EOV OCCURRED                 43800017
CMSKP2   EQU   *                                                        44100017
         MVC   CKMXLIST(N8),CKMN40      XCTL PARAMETER                  44500018
CMXCTL   EQU   *                                                        45000017
         LR    R1,RC          LOAD PARM REG WITH ADDR OF W.A.           45300017
         LA    RF,CKMXLIST                                              45600017
         ST    RF,CKMN40AD                                              45900017
         LA    RF,CKMN40AD                                              46200017
         XCTL  SF=(E,(15))   XCTL TO NEXT LOAD                          46500017
*                                                                       46620018
*        REPMAIN SYNAD ROUTINE                                          46680018
*                                                                       46740018
CM2A2    EQU   *                                                        46800017
         MVI   CKRETIO,CKIOERR     ERROR CODE INTO WORK AREA            47100018
         LA    R0,NX317                                                 47400017
         STH   R0,CKMSGCOD                                              47700017
         RETURN                                                         48000017
*                                                                       48070018
*        END OF VOLUME                                                  48140018
*                                                                       48210018
CMEOV    EQU   *                                                        48300017
         TM    CKFLAG1,CKTAPE   Q. CHKPT DATA SET ON TAPE               48600017
         BZ    CMEOVDA        DIRECT ACCESS EOV                         48900017
         L     RF,CKTSTEOV                                              49200017
         CLC   N0(N4,RF),CKEOVCMR       Q.   DID  EOV OCCUR             49500017
         BE    N0(R5)                   A.   NO  CONTINUE PROCESS       49800017
         MVI   CKRETCOD+N1,X'14'   YES - SET EOV ERR CODE - 14   A38515 50300021
         LA    RF,CKTPEOV     INDICATE TAPE EOV ERROR            A38515 50800021
         B     CMEOVER             GO TO EXIT ROUTINE            A38515 51300021
CMEOVDA  EQU   *                                                        51900017
         USING IHADCB,RF                                                52200017
         L     RF,CKDCBAD    GET ADR. OF CHKPT DCB                      52500017
         L     RF,DCBDEBAD   GET ADR. OF CHKPT DEB                      52800017
         DROP  RF                                                       53100017
         CLC   DEBNMEXT(N1,RF),CKTSTEOV      Q.  EOV ON DA DEVICE       53400017
         BE    N0(R5)                        NO CONTINUE PROCESS        53700017
         MVI   CKRETCOD+N1,CKPGMERR SET RETURN CODE TO 8         A38515 53800021
         LA    RF,CKERIO7     INDICATE DISK EOV ERROR            A38515 54000021
CMEOVER  EQU   *                                                 A38515 54200021
         STH   RF,CKMSGCOD                                              54600017
         B     CMIORE                   XCTL INTERFACE                  56100017
         EJECT                                                          56160018
*                                                                       56220018
*        DOUBLE BUFFERING                                               56280018
*                                                                       56340018
CMSMBUF  EQU   *                                                        56400017
         TM    SWITCH,CMS1    Q. SINGLE BUFFERING                       56700017
         BO    CMSBUF         YES                                       57000017
         STH   R6,CKLNGTH2    PUT LENGTH OF CIR IN DECB.                57300017
         WRITE CKDECB2,SF,,(RA),,MF=E   WRITE A CIR.                    57600017
         BAL   R5,CMCHK1      GO TO CHECK WRITE 1.                      57900017
         CHECK CKDECB2                                                  58200017
         CLI   CKRETIO,CKIOERR     Q.  I/O ERROR                        58500018
         BE    CMIORE                   XCTL INTERFACE                  58800017
         XI    SWITCH,CMS2    TURN OFF SWITCH INDICATING THAT           59100017
*                             LAST WRITE USED DECB1.                    59400017
         BAL   R5,CMEOV       GO TO SEE IF EOV OCCURRED.                59700017
         BR    R3                  RETURN TO CALLER                     60000017
*                                                                       60070018
*        SINGLE BUFFERING                                               60140018
*                                                                       60210018
CMSBUF   EQU   *                                                        60300017
         BAL   R5,CMCHK1      GO TO CHECK WRITE 1.                      60600017
         BAL   R5,CMEOV       GO TO SEE IF EOV OCCURRED.                60900017
         B     CMCOMW         GO TO WRITE OUT A CIR.                    61200017
CMWRTO   EQU   *                                                        61500017
         TM    SWITCH,CMS2 Q. DID LAST WRITE USE DECB1                  61800017
         BO    CMSMBUF        YES                                       62100017
CMCOMW   EQU   *                                                        62400017
         BAL   R5,CMWRT1           DO WRITE 1                           62700018
         OI    SWITCH,CMS2    TURN ON INDICATION THAT LAST WRITE        63000017
*                             USED DECB1.                               63300017
         BR    R3                  RETURN TO CALLER                     63600017
CMWRT1   EQU   *                                                        63900017
         STH   R6,CKLNGTH1    PUT LENGTH OF CIR IN DECB1.               64200017
         WRITE CKDECB1,SF,,(RA),,MF=E   WRITE A CIR.                    64500017
         BR    R5                  RETURN TO CALLER                     64800017
CMCHK1   EQU   *                                                        65100017
         CHECK CKDECB1                                                  65400017
         CLI   CKRETIO,CKIOERR     Q.  I/O ERROR                        65800018
         BCR   NOTEQ,R5            A.  NO  RETURN TO CALLER             66200018
CMIORE   EQU   *                                                        66600017
         MVC   CKMXLIST(N8),CKMN40      SET UP XCTL PARM. LIST          66900017
         MVI   CKMXLIST+N4,CHARN        FOR I/O RESUME                  67200018
         B     CMXCTL              XCTL INTERFACE                       67500017
*                                                                       67570018
*        WRITE INTERFACE                                                67640018
*                                                                       67710018
CMLSWT   EQU   *                                                        67800017
         CH    R7,NOISE    Q. WOULD CIR BE MISTAKEN FOR NOISE           68100017
         BL    CMNOISE     YES                                          68400017
         LR    R6,R7          GET LENGTH OF CIR.                        68700017
CMCOM    EQU   *                                                        69000017
         LR    RA,R9          GET ADDR OF BEGINNING OF CIR.             69300017
         BAL   R3,CMWRTO      GO TO WRITE LAST CIR FOR THIS AREA.       69600017
         B     N0(R8)         RETURN TO CALLER                          69900017
CMNOISE  EQU   *                                                        70200017
         LH    R6,NOISE       INSURE CIR IS AT LEAST MINIMUM LENGTH.    70500017
         B     CMCOM          GO TO WRITE CIR                           70800017
CMINTW   EQU   *                                                        71100017
         LA    RA,N1(R0,RA)       INCREMENT HIGH BOUND PTR.             71400017
         LR    R7,RA          CALCULATE LENGTH OF AREA                  71700017
         SR    R7,R9          TO BE WRITTEN OUT.                        72000017
         L     R6,CKBUFL      GET BLKSIZE                               72300017
CMWAGN   EQU   *                                                        72600017
         LTR   R7,R7          Q. ANY MORE TO BE WRITTEN OUT.            72900017
         BZ    N0(R8)         NO RETURN                                 73200017
         CR    R7,R6          Q. LENGTH TO BE WRITTEN LESS THAN BLKSIZE 73500017
         BNH   CMLSWT         YES- WRITE OUT SHORT BLOCK                73800017
         SR    RA,R6          GET ADDR OF BEGINNING OF CIR.             74100017
         SR    R7,R6          COMPUTE LENGTH OF AREA THAT WILL BE LEFT. 74400017
         BAL   R3,CMWRTO      GO TO WRITE A CIR.                        74700017
         B     CMWAGN         PROCESS NEXT CIR                          75000017
         EJECT                                                          75060018
*                                                                       75120018
*        DEFINED CONSTANTS                                              75180018
*                                                                       75240018
NOISE    DC    H'18'     MINIMUM LENGTH FOR CHKPT RECORD.               75300017
CKMN40   DC    CL8'IGC0G06C'  NAME OF NEXT LOAD OF RESTART              75600017
         SPACE 4                                                        75700018
         IEEVCHWA                  OS VERSION OF WA                     75950000
CKTSTEOV EQU CKUNIT                                                     76200017
CKEOVCMR EQU CKUNIT+4                                                   76500017
CMADEOV  DS    F    SAVE AREA FOR INFORMATION NEEDED                    76800017
CMNEOV   DS    F    TO TEST IF EOV OCCURRED.                            77100017
SWITCH   DS    F     SWITCH                                             77400017
CMS1     EQU   1    INDICATES SINGLE BUFFERING.                         77700017
CMS2     EQU   2    INDICATES WRITE 1 WAS LAST WRITE.                   78000017
CKMXLIST DS    2F   NAME OF NEXT MODULE TO RECEIVE CONTROL.             78300017
CKMN40AD DS    F       CHECKMAIN                                        78600018
CMSYSA   DS    F     SYSTEM                                             78900017
         IHBABCTL                                                       79200017
         DCBD  DSORG=(BS,PO),DEVD=(DA,TA)                               79500017
         EJECT                                                          79530018
*                                                                       79560018
*        GENERAL EQUATES                                                79590018
*                                                                       79620018
CKRETIO  EQU   CKRETCOD+1                                               79650018
CHARN    EQU   C'N'                                                     79680018
CHAR2    EQU   C'2'                                                     79710018
NOTEQ    EQU   7                                                        79740018
SURL     EQU   200  LENGTH OF SUR BUFFER.                               79800017
X0       EQU   X'0'                                                     79900018
X1       EQU   X'01'                                                    80000018
NX317    EQU   X'317'                                                   80100018
CKERIO7  EQU   X'031B'                                                  80400017
CKTPEOV  EQU   X'031C'        TAPE EOV ERROR                     A38515 80500021
DEBNMEXT EQU   16     NUMBER OF EXTENTS FOR THIS DEB                    80700017
*                                                                       81000017
*        EQUATES FOR GENERAL DISPLACEMENTS                              81300017
*                                                                       81600017
N0       EQU   0                                                        81900017
N1       EQU   1                                                        82200017
N3       EQU   3                                                        82800017
N4       EQU   4                                                        83100017
N8       EQU   8                                                        83400017
.LIB2BA1 ANOP                                                           83450000
         END                                                            84900017
./  ADD  SSI=73130581,NAME=IHJQCP31
         TITLE ' IHJQCP31  MVT CHECKMAIN  IGC0G06C  '                   00300018
         COPY  LCGASMSW                                                 00350000
         AIF   ('&LIB' EQ 'LIB1').LIB1BA1  TEST FOR LIB1(OS)            00500000
CP31     TITLE 'IHJQCP31 AOS/2 CHECKMAIN 2 ROUTINE - IGC0G06C'          00550000
*                                                                       00560000
*        RELEASE 3.0 DELETIONS/CHANGES                                  00560537
*A019171                                                        ZA05247 00560937
*0000                                                           ZA03227 00561037
*        RELEASE 3.7 CHANGES                                            00564037
*A021949-021950,A022507,A022644-022659                         @ZA14558 00567037
*A022652,A022661,D022655,D022656,D022657                       @ZA19627 00568037
*A265800                                                       @ZA27110 00569037
* STATUS                                                                00570000
*                                                                       00580000
*    CHANGE LEVEL = 0                                                   00590000
*                                                                       00592000
* FUNCTION                                                              00594000
*                                                                       00596000
*    MODULE NAME - IHJQCP31                                             00598000
*                                                                       00598400
*    THIS MODULE CREATES RECORDS  (SUR) OF CERTAIN VIRTUAL STORAGE      00598800
*    MANAGEMENT, CONTENTS SUPERVISION, TASK MANAGEMENT, AND PAGING      00599200
*    SUPERVISOR CONTROL BLOCKS AND OUTPUTS THESE RECORDS TO THE         00599600
*    CHECKPOINT DATA SET. THESE CONTROL BLOCKS, ALONG WITH              00599700
*    PERTINENT INFORMATION NECESSARY FOR THEIR RECREATION ARE           00599800
*    CONTAINED IN MULTIPLE 400 BYTE SUR RECORDS.                 YM7049 00599902
*                                                                       00649900
* ENTRY POINTS                                                          00659900
*                                                                       00669900
*    CHECKMAIN 2 (IGC0G06C) IS ENTERED FROM CHECKMAIN 1          Y02076 00679902
*    (IGC0F06C) TO CHECKPOINT THE SUPERVISOR CONTROL BLOCKS      Y02076 00689902
*                                                                       00691900
* INPUT                                                                 00693900
*                                                                       00695900
*    GPR 12 CONTAINS THE ADDRESS OF THE CHECKPOINT WORK AREA            00697900
*    (CHKWA).                                                           00698300
*                                                                       00698700
* OUTPUT                                                                00699100
*    SAME AS THE ENTRY PARAMETERS FOR NORMAL EXIT                       00699500
*                                                                       00699600
*    FOR ERROR EXIT GPR 1 CONTAINS ADDRESS OF CHKWA AND AN ERROR        00699700
*    CODE  IS PASSED IN THE LAST BYTE OF THE CKRETCOD FIELD.            00699800
*                                                                       00733200
* EXTERNAL REFERENCES                                                   00743200
*                                                                       00753200
*    NONE                                                               00763200
*                                                                       00765200
* EXITS,NORMAL                                                          00765600
*                                                                       00766000
*    TO CHECKMAIN 3 AT ENTRY IGC0H06C VIA XCTL TO                       00766400
*    CHECKPOINT USER INFORMATION AS SUR'S.                              00766500
*    UPON EXIT THE PARAMETERS ARE AS FOLLOWS.                           00777600
*    GPR12 CONTAINS ADDRESS OF CHKWA.                                   00787600
*    DECB USED FOR WRITING SURS.                                        00788000
*    ADDRESS OF NEXT BYTE AVAILABLE IN OUTPUT BUFFER                    00788400
*    AND NUMBER OF BYTES LEFT IN BUFFER IN CHECKPOINT                   00788800
*    WORK AREA. (CKBFSTAD, CKBFLWA).                                    00792500
*                                                                       00794500
* EXITS, ERROR                                                          00794900
*                                                                       00795300
*    -1) TO RESUME I/O ROUTINE AT ENTRY IGC0N06C VIA XCTL               00795700
*    TO PROVIDE ITS NORMAL FUNCTIONS AND TO PASS AN                     00796100
*    ERROR CODE TO THE CHECKPOINT EXIT ROUTINE                          00796200
*    INDICATING THAT AN I/O ERROR HAS OCCURRED.                         00846200
*    UPON EXIT THE PARAMETERS ARE AS FOLLOWS-                           00856200
*    GPR 1 - ADDRESS OF CHKWA                                           00866200
*    CHKWA - AN ERROR CODE OF X'0C' IS PASSED IN THE                    00876200
*    .       LAST BYTE OF THE CKRETCOD FIELD.                           00886200
*                                                                       00888200
*    2) TO RESUME I/O ROUTINE (IGC0N06C) VIA XCTL TO                    00890200
*    PERFORM ITS NORMAL FUNCTIONS AND TO PASS AN                        00892200
*    ERROR CODE TO THE CHECKPOINT EXIT ROUTINE THAT                     00894200
*    AN END OF VOLUME CONDITION (TWO RETRIES HAVE BEEN                  00894600
*    ATTEMPTED ON TAPE, OR THE PRIMARY DEB EXTENT                       00895000
*    HAS BEEN EXHAUSTED FOR DASD) HAS OCCURRED.                         00895400
*    UPON EXIT THE PARAMETERS ARE THE SAME AS FOR                       00895800
*    CASE 1 EXCEPT THAT THE LAST BYTE OF CKRETCOD                       00895900
*    IS AN X'08'.                                                       00896000
*                                                                       00896100
*    3) TO CHECKPOINT HOUSEKEEPING ROUTINE (IGC0206C) TO                00912800
*    ATTEMPT REPROCESSING ON A NEW TAPE WHEN AN EOV                     00922800
*    HAS OCCURRED FOR THE FIRST TIME ON TAPE.                           00924800
*    UPON EXIT THE PARAMETERS ARE AS FOLLOWS-                           00926800
*    GPR 1 - ADDRESS OF CHKWA                                           00928800
*    CHKWA - FIRST TAPE EOV FLAG IS SET.                                00929200
*                                                                       00929300
* TABLES/WORK AREAS                                                     00929400
*                                                                       00939000
*    DEB   DEBNMEXT                                                     00939400
*                                                                       00940300
*    CVT   CVTABEND                                              Y02076 00940402
*    .     CVTLINK                                               Y02076 00941402
*                                                                       00942402
*    SCVT  SCVTSVCT                                                     00955300
*                                                                       00965300
*    TCB   TCBMSS                                                       00969700
*    .     TCBLLS                                                       00970100
*    .     TCBJPQ                                                       00970200
*    .     TCBNSTAE                                                     00970300
*    .     TCBFOEA                                               Y02076 00971302
*    .     TCBOTC                                                Y02076 00972302
*    .     TCBRBP                                                Y02076 00973302
*    .     TCBSTABB                                              Y02076 00974302
*                                                                       00975200
*    RB    RBSIZE                                                       00977200
*    .     RBSTAB1                                               Y02076 00978202
*    .     RBSTAB2                                                      00979600
*    .     RBINTCOD                                              Y02076 00979802
*    .     RBEP                                                  Y02076 00980002
*    .     RBCDE1                                                Y02076 00980102
*    .     RBLINK                                                       00980202
*                                                                       00985100
*    CDE   CDATTR                                                Y02076 00987102
*    .     CDATTR2                                               Y02076 00989102
*    .     CDCHAIN                                                      00989500
*    .     CDRRBP                                                Y02076 00989902
*    .     CDENTPT                                                      00990000
*    .     CDNAME                                                       00990100
*    .     CDXLMJP                                                      01032000
*                                                                       01072000
*    XL    EXLLNTH                                                      01074000
*                                                                       01074100
*    LLE   LLECDPT                                               Y02076 01074202
*    .     LLECHN                                                Y02076 01088202
*                                                                       01098200
*    DCB   DCBDEBAD                                                     01100200
*    .     DCBSYNA                                               Y02076 01100602
*                                                                       01101000
*    SCB   SCBCHAIN                                                     01101400
*    .     SCBOWNRA                                                     01101800
*                                                                       01101900
*    SPQE  SPQEAD                                                Y02076 01102002
*    .     SPDQEPTR                                              Y02076 01102102
*    .     SPQEFLGS                                              Y02076 01106802
*                                                                       01108800
*    DQE   DQFQEPTR                                                     01110800
*    .     DQEPTR                                                       01111200
*                                                                       01111300
*    FQE   FQEPTR                                                       01111400
*                                                                       01123000
*    FOE   FOEFLINK                                                     01133000
*    .     FOEVINDX                                              Y02076 01133202
*                                                                       01133400
* ATTRIBUTES                                                            01133800
*                                                                       01134200
*    KEY 0, SUPERVISOR STATE, ENABLED                                   01134600
*                                                                       01134700
*  CHARACTER CODE DEPENDENCIES                                          01134800
*                                                                       01138700
*    NONE                                                               01140700
*                                                                       01141100
*  NOTES                                                                01141500
*                                                                       01141900
*    APPLICABILITY                                                      01142300
*                                                                       01142400
*    AOS/2                                                              01142500
*                                                                       01146400
*    MODULE CHARACTERISTICS                                             01148400
*                                                                       01148800
*    TYPE - LOAD MODULE                                                 01149200
*    RESIDENCE - SYSTEM LINK PACK AREA                                  01149600
*                                                                       01150000
*    DEPENDENCIES                                                       01150100
*                                                                       01150200
*    -SIZE OF CONTROL BLOCKS TO BE CHECKPOINTED                         01160100
*    -A CDE EXISTS FOR THE JOB PACK AREA OF THE REGION                  01170100
*                                                                       01170200
*    INTERFACES                                                         01208500
*                                                                       01218500
*    -WRITE/CHECK MACRO                                                 01228500
*    -STANDARD DSECTS USED TO REFERENCE CONTROL BLOCKS                  01238500
*                                                                       01240500
*                                                                       01242500
*    OPERATION                                                          01244500
*                                                                       01246500
*    THE CHECKMAIN2 ROUTINE RECEIVES CONTROL AFTER ALL ALLOCATED        01246600
*    REGION BLOCKS HAVE BEEN CHECKPOINTED. UPON ENTRY,                  01246700
*    INITIALIZATION PROCESSING IS INVOKED. THIS INITIALIZATION          01259500
*    CONSISTS OF THE FOLLOWING.                                         01269500
*                                                                       01271500
*    .     - PLACING ADDRESS OF SYNAD ROUTINE IN DCB                    01271900
*    .     - SETTING THE NORMAL XCTL EXIT MODULE NAME TO                01272000
*    .       IGC0H06C (CHECKMAIN 3).                                    01272100
*    .     - SETTING THE BUFFER CONTROL PARAMETERS FOR THE SUR          01272200
*    .       BUFFER CONTAINED IN THE CHECKPOINT WORK AREA.              01276500
*                                                                       01278500
*    PROCESSING THEN CONTINUES AS DESCRIBED UNDER THE HEADING           01280500
*    'CHECKPOINTING THE VIRTUAL STORAGE CONTROL BLOCKS'.                01280600
*                                                                       01280700
*    'CHECKPOINTING THE VIRTUAL STORAGE CONTROL BLOCKS'                 01291300
*                                                                       01301300
*    THE VSM CONTROL BLOCKS CHECKPOINTED BY THIS ROUTINE ARE            01301700
*    THE SPQE, DQE, AND FQE CONTROL BLOCK CHAINS FOR THE STC,           01302100
*    INITIATOR, AND PROBLEM PROGRAM TASKS. THE SPQE, DQE, AND    Y02076 01305602
*    FQE ARE EACH 16 BYTES LONG. THE CHECKCODE VALUES ASSIGNED   Y02076 01307602
*    TO THESE BLOCKS ARE                                         Y02076 01308002
*    .         - SPQE - X'06'                                           01308400
*    .         - DQE  - X'07'                                           01308800
*    .         - FQE  - X'02'                                           01309200
*    THE ORDER OF PROCESSING IS TO CHECKPOINT THE CHAIN AS FOLLOWS      01312700
*    .         SPQE1, DQE1, FQE1,FQE1,DQE1,FQE1,FQE1,SPQE2,DQE2,        01314702
*    .         FQE2, ETC.                                               01315100
*                                                                       01315500
*                                                                       01315900
*    CHECKPOINTING THE JOB PACK AREA CDE QUEUE                          01316300
*                                                                       01325300
*    THE CDE'S AND THEIR ASSOCIATED EXTENT LISTS ARE CHECKPOINTED.      01327300
*    THE ORDER OF PROCESSING IS TO CHECKPOINT THE CHAIN AS FOLLOWS      01329300
*    .         MAJCDE1, EXTENT LIST1, MINOR CDE1, MAJOR CDE2,           01331300
*    .         EXTENT LIST2, ETC.                                       01333300
*    CDE'S WHICH HAVE BEEN CREATED OR USED FOR THE LINK OR XCTL         01333700
*    FUNCTIONS WILL CONTAIN A POINTER TO THE RB WHICH USED THE          01334100
*    FUNCTION. THE RB FOR THE CDE WILL BE CHECKPOINTED AT A LATER       01334500
*    TIME. SINCE THE RB IS CREATED IN LSQA, THE RB ADDRESS IN THE       01334600
*    CDE WILL HAVE TO BE RELOCATED A 'RESTART TIME'. TO DO THIS,        01345500
*    CHECKPOINT MUST NOTE THE POSITION OF THE REQUESTING RB ON THE      01355500
*    P/P TCB RB QUEUE AND PASS IT TO THE RESTART FUNCTION WITH THE      01355900
*    CDE. THE CHECKCODES ASSIGNED TO THE BLOCKS ARE                     01356300
*    .         - CDE - X'09'                                            01358100
*    .         - EXTENT LIST - X'17'                                    01360100
*    WHEN ALL CDE'S AND EXTENT LISTS HAVE BEEN WRITTEN TO THE           01360500
*    CHECK POINT DATA SET PROCESSING CONTINUES WITH CHECKPOINTING       01360900
*    THE P/P LOAD LIST ELEMENT QUEUE.                                   01361300
*                                                                       01361400
*                                                                       01361500
*    'CHECKPOINTING THE P/P LOAD LIST ELEMENT QUEUE'                    01361600
*                                                                       01365700
*    THE LOAD LIST ELEMENT (LLE) QUEUE IS CREATED WHENEVER A LOAD       01367700
*    MACRO INSTRUCTION IS ISSUED BY OR FOR THE JOB STEP TASK. THE       01369700
*    LLE CONTAINS A POINTER TO A CDE, AND ANOTHER FIELD INDICATING      01369800
*    THE NUMBER OF TIMES LOAD HAS BEEN ISSUED FOR THE MODULE. IF        01369900
*    THE MODULE HAD TO BE FETCHED INTO THE USER REGION, THE CDE         01373700
*    WILL BE ON THE 'JOB PACK AREA CDE QUEUE'. IF THE MODULE            01375700
*    RESIDES IN THE SYSTEM LINK PACK AREA, THE CDE WILL BE ON THE       01376100
*    'ACTIVE LPA CDE QUEUE'.                                            01376500
*                                                                       01376900
*    FOR THOSE LLE'S WHOSE CDE IS ON THE ACTIVE LPAQ, IT IS             01377300
*    NECESSARY TO CHECKPOINT NOT ONLY THE LLE, BUT ALSO THE             01377400
*    MODULE NAME AND ENTRY POINT ADDRESS. THIS ADDITIONAL               01377500
*    INFORMATION IS UED TO RECREATE THE LPA CDE QUEUE AT RESTART        01377600
*    TIME AND TO VERIFY THAT THE MODULE OCCUPIES THE SAME VIRTUAL       01377800
*    ADDRESS SPACE AS IT DID AT CHECKPOINT TIME.                        01377900
*                                                                       01378000
*    FOR LLE'S WHOSE CDE'S ARE ON THE JPQ, IT IS NECESSARY TO NOTE      01378100
*    THE POSITION OF THE CDE ON THE JPQ AS THE CDE'S WILL BE            01381700
*    RELOCATED DURING RESTART.                                          01383700
*                                                                       01384100
*    THE CHECKCODES USED FOR THE LLE'S ARE                              01384500
*    .         - LLE WHOSE CDE IS ON JPQ - X'0A'                        01384900
*    .         - LLE WHOSE CDE IS ON THE ACTIVE LPAQ - X'0E'            01385300
*                                                                       01385400
*                                                                       01385500
*    'CHECKPOINTING THE P/P TASK REQUEST BLOCK (RB) QUEUE'              01386700
*                                                                       01388700
*    AT CHECKPOINT TIME THE P/P RB QUEUE CAN ONLY CONTAIN PRB'S         01388800
*    AND SVRB'S. THE SVRB ALWAYS DESCRIBES AN SVC WHICH IS              01388900
*    RESIDENT IN EITHER THE MODIFIED LINK PACK AREA, FIXED LINK         01389000
*    PACK AREA, PAGED LINK PACK AREA, OR THE RESIDENT NUCLEUS.          01419100
*    INTERRUPT SUPERVISION CREATES THE SVRB FOR ALL TYPE 2,3, AND       01429100
*    THE INITIAL LOAD OF ALL TYPE 4 SVC'S. CONTENTS SUPERVISION         01439100
*    CREATES THE SVRB FOR ALL SUBSEQUENT LOADS OF TYPE 4 SVC'S.         01449100
*    THE SVC TABLE RESIDENT IN THE NUCLEUS CONTAINS THE ENTRY           01449200
*    POINT ADDRESSES FOR ALL TYPE 2, 3, AND 4 SVC'S, WHILE ANY          01449300
*    SUBSEQUENT LOADS OF A TYPE 4 SVC MUST BE FOUND THROUGH A           01449400
*    CDE ON THE ACTIVE LPA CDE QUEUE, WHEN THE MODULE HAS BEEN          01459400
*    FIX'ED OR MODIFIED, OR THROUGH THE LINK PACK DIRECTORY FOR         01469400
*    PAGED LPA MODULES. IN THIS CASE, THE SVRB WILL CONTAIN THE         01469500
*    ADDRESS OF THE CDE OR LPDE FOR THE REQUESTED MODULE.               01472800
*                                                                       01474800
*    PRB'S ARE CREATED FOR THE USER WHENEVER A LINK, SYNCH, OR          01475200
*    XCTL MACRO INSTRUCTION IS EXECUTED BY THE PROBLEM PROGRAM.         01475600
*    THE PRB IS CREATED BY CONTENTS SUPERVISION, AND, IN THE            01476000
*    CASE OF LINK OR XCTL, A CDE IS USED TO RELATE THE RB TO THE        01476100
*    REQUESTED MODULE. THE CDE MAY BE ON THE JPQ AND, IF SO, ITS        01476200
*    POSITION MUST BE NOTED FOR RESTART, OR, THE CDE MAY BE FOR         01484500
*    A MODULE RESIDENT IN THE LPA IN WHICH CASE THE MODULE NAME         01486500
*    AND ENTRY POINT ADDRESS MUST BE SAVED FOR RESTART. NOTE THAT       01488500
*    ANY TIME A LINK, LOAD OR XCTL IS ISSUED BY THE P/P FOR A           01490500
*    MODULE IN THE LPA, A CDE IS CREATED AND PLACED ON THE ACTIVE       01492500
*    LPA CDE QUEUE (UNLESS ONE ALREADY EXISTS IN WHICH CASE THE         01492900
*    CDE IS USED AGAIN), AND WHENEVER A DELETE OR EXIT SVC IS           01493000
*    ISSUED, THE CDE IS REMOVED FROM THE LPAQ IF THERE IS NO MORE       01502300
*    USE FOR IT.                                                        01504300
*                                                                       01506300
*    THE CHECKCODES USED FOR THE RB QUEUE ARE                           01508300
*    .         - SVRB FOR TYPE 2, 3, AND 1ST LOAD OF 4 - X'1F'          01510300
*    .         - SVRB FOR SUBSEQUENT LOADS OF TYPE 4 - X'1E'            01510700
*    .         - EOV SVRB - X'1D'                                Y02076 01510902
*    .         - SYNCH'ED PRB - X'05'                                   01511100
*    .         - PRB WITH CDE IN JPQ - X'0B'                            01511500
*    .         - PRB WITH CDE ON LPAQ - X'0C'                           01511600
*                                                                       01511700
*                                                                       01511800
*    'CHECKPOINTING THE STAE CONTROL BLOCKS'                            01521400
*                                                                       01531400
*    STAE CONTROL BLOCKS (SCB'S) ARE CREATED TO ALLOW THE               01534200
*    PROGRAMMER TO RECOVER FROM AN ABEND CAUSED BY A ROUTINE            01536200
*    INVOKED BY LINK OR SYNCH. THESE CONTROL BLOCKS POINT TO            01538200
*    THE PROGRAM (RB) TO RECEIVE CONTROL SHOULD AN ABEND OCCUR.         01538600
*    SINCE THE RB'S WILL BE RELOCATED AT RESTART, THE POSITION          01539000
*    OF THE STAE RB ON THE P/P RB QUEUE HAS TO BE PASSED TO             01539400
*    RESTART. ALSO, THE TCB CONTAINS FLAGS WHICH MUST BE                01539500
*    RESTORED AT RESTART TIME. THE CHECKCODES ASSIGNED ARE              01539600
*    .         - TCBNSTAE FLAGS - X'0D'                                 01539700
*    .         - SCB - X'11'                                            01548300
*                                                                       01550300
*    'CHECKPOINTING THE P/P FOE CONTROL BLOCKS'                         01552300
*                                                                       01554300
*    A FIX OWNERSHIP ELEMENT (FOE) IS CREATED FOR EACH PAGE             01556300
*    FIXED BY A TASK THROUGH THE PGFIX SVC FUNCTION. THIS CHAIN         01556700
*    IS ADDRESS ORDERED FROM LOW ADDRESS TO HIGH AND IS ANCHORED        01556800
*    BY THE TCBFOE FIELD OF THE JOB STEP TCB. EACH FOE HAS A            01556900
*    COUNT RELATING THE NUMBER OF TIMES THE PAGE HAS BEEN FIXED.        01558000
*    ONLY THOSE FOE'S DESCRIBING SPACE WITHIN THE USER'S         Y02076 01559002
*    PRIVATE REGION AND NOT IN LSQA WILL BE SAVED IN THE         Y02076 01559202
*    CHECKPOINT DATA SET.                                        Y02076 01559402
*                                                                       01560000
*    - FOE CHECKCODE = X'08'                                            01560100
*                                                                       01560200
         EJECT                                                          01562600
IGC0G06C CSECT                                                          01564600
*                                                                YM2776 01565001
         BALR  RB,N0               ESTABLISH BASE FOR CODE              01566600
         USING *,RB                CODE                                 01567000
         USING CHKWA,RC            BASE FOR CHKPT WORK AREA             01567400
         L     R2,CKDCBAD          GET @ CHECKPOINT DCB                 01596400
         USING IHADCB,R2           DCB                                  01606400
         LA    R7,SYNAD            GET @ OF SYNAD ROUTINE               01616400
         STCM  R7,M7,DCBSYNA       PUT @ IN DCB                         01618400
         DROP  R2                  DCB                                  01620400
         L     R5,CKTCBAD          GET @ OF TCB                         01622400
         USING TCB,R5              TCB                                  01624400
         MVC   CKMN40(N8),CKMN3NM  SET DEFAULT XCTL MODULE NAME TO CM3. 01624800
         LA    R4,SURL             GET LENGTH OF A SUR BUFFER           01625200
         STH   R4,CKLNGTH1         INITIALIZE DECB FOR RECORD LENGTH    01625600
         ST    R4,CKBFLWA          INIT. NO. BYTES LEFT IN BUFFER       01625700
         L     R8,CKBFOFST         CALCULATE                            01625800
         AR    R8,RC               START ADDR OF SUR BUFFER             01625900
         ST    R8,CKBFSTAD         INIT. PTR TO NEXT AVAIL. BYTE        01637600
         ST    R8,CMBUF            SAVE BUFFER ADDRESS FOR LATER        01639600
         TM    CKFLAG1,CKVEQR      IS THIS TASK V=R?             YM2776 01639701
CKVEQR   EQU   8                   V=R FLAG IN W.A.             YA00258 01639802
         BNO   CKNOVEQR            NO, GO ON                     YM2776 01639901
         LRA   R8,0(,R8)           GET REAL ADDRESS OF BUFFER    YM2776 01642001
CKNOVEQR DS    0H                                                YM2776 01644002
         ST    R8,CKAREA1          INIT. DECB FOR WRITE AREA ADDRESS    01646801
         SR    R3,R3               ZERO OUT REG FOR LATER               01648901
         XC    CKAPPLNT,CKAPPLNT   SET APPENDAGE LENGTH = 0             01651001
         SPACE 3                                                        01653101
*                                                                       01655201
*        START OF CHECKPOINTING THE VIRTUAL STORAGE CONTROL BLOCKS.     01657301
*                                                                       01659401
         SPACE                                                          01661501
         L     R5,TCBOTC           GET ADDR OF INITIATOR TCB            01663601
         LA    R6,N2               SET LOOP COUNTER TO 2                01665701
C7A4     L     R5,TCBOTC           GET ORIGINATING TCB                  01667801
         SPACE 3                                                        01669901
*        START OF SPQE PROCESSING FOR THIS TASK                         01672001
         SPACE                                                          01674101
C7B3     ICM   R3,M7,TCBMSSB       GET ADDR OF FIRST SPQE               01676201
         USING SPQESECT,R3         SPQE                                 01678301
C7H6     LTR   RA,R3               SEE IF ANYMORE SPQE'S AND SAVE @     01680401
         BZ    C7B7                NO MORE, DO NEXT TCB                 01682501
         MVI   CKCODE,SPQECODE     SET CHECK CODE                       01684601
         LA    RF,SPQESIZE         SET LENGTH OF BLOCK           Y02076 01686702
         ST    RF,CKLNT            *                                    01688801
         BAL   RD,WRITESUR         CHECKPOINT THE SPQE                  01690901
         TM    SPQEFLGS,SPSHARE    IS SPQE OWNED                        01693001
         BO    C7H4                NO - SHARED SO NO DQE'S.             01695101
C7F3     L     R3,SPDQEPTR         YES- GET DQE POINTER          Y02076 01697202
         LA    RF,DQFQLEN                                               01699301
         ST    RF,CKLNT            PLACE DQE/FQE LENGTH FOR WRITESUR    01701401
         DROP  R3                  SPQE                                 01703500
         USING DQESECT,R3          DQE                                  01706600
CKDQE    LTR   R9,R3               SEE IF ANYMORE DQE'S AND SAVE @      01708600
         BZ    C7H4                NO, GO GET NEXT SPQE                 01710600
         MVI   CKCODE,DQECODE      SET THE CHECKCODE                    01712600
         BAL   RD,WRITESUR         CHECKPOINT THE DQE                   01712700
         SPACE 3                                                        01712800
*              FQE PROCESSING                                           01712900
         SPACE                                                          01721200
         ICM   R3,M7,DQFQEPTR+N1   GET ADDRESS OF FQE                   01723200
         DROP  R3                  DQE                                  01725200
         USING FQESECT,R3          FQE                                  01727200
         MVI   CKCODE,FQECODE      SET SUR CODE FOR FQE                 01729200
CKFQE    LTR   R3,R3               ANYMORE FQE'S                        01729300
         BZ    NXTDQE              NO, DO NEXT DQE                      01729400
         BAL   RD,WRITESUR         YES, CHECKPOINT THE FQE              01730400
         ICM   R3,M7,FQEPTR+N1     GET @ NEXT FQE                       01730800
         B     CKFQE               DO NEXT FQE, IF ANY                  01731200
         SPACE 3                                                        01731600
NXTDQE   LR    R3,R9               RESTORE DQE POINTER                  01732000
         DROP  R3                  FQE                                  01732100
         USING DQESECT,R3          DQE                                  01732200
         ICM   R3,M7,DQEPTR+N1     GET @ OF NEXT DQE                    01732300
         B     CKDQE               GO PROCESS NEXT DQE                  01734700
         SPACE 3                                                        01736700
C7H4     LR    R3,RA               RESTORE SPQE POINTER                 01738700
         DROP  R3                  DQE                                  01739100
         USING SPQESECT,R3         SPQE                                 01739500
         L     R3,SPQEAD           GET @ OF NEXT SPQE            Y02076 01747002
         B     C7H6                GO PROCESS NEXT SPQE                 01749000
         DROP  R3                  SPQE                                 01751000
         SPACE 3                                                        01753000
C7B7     L     R5,CKTCBAD          GET P/P TCB @                        01753400
         BCTR  R6,R0               DECREMENT LOOP COUNT BY 1.           01753800
         LTR   R6,R6               DETERMINE WHICH TASK IS NEXT         01754200
         BZ    C7B3                DO P/P TASK NEXT                     01754600
         BP    C7A4                DO INIT TASK NEXT                    01754700
         EJECT                                                          01754800
*                                                                       01754900
*        START OF CHECKPOINTING THE JPA CDE QUEUE.                      01756800
*                                                                       01758800
         SPACE 3                                                        01759200
         ICM   R3,M7,TCBJPQB       GET @ OF FIRST JPA CDE.              01759600
C9E2     LTR   R9,R3               ANY MORE CDE'S, AND SAVE ADDR        01760000
         BZ    C7H8A               NO, GO DO THE LLE'S.                 01760400
         MVI   CKCODE,CDECODE      SET SUR CODE FOR A CDE               01760500
         LA    RF,CDELEN           MOVE IN LENGTH                       01760600
         ST    RF,CKLNT            *                                    01760700
         USING CDENTRY,R3          CDE                                  01761300
         L     RA,CDRRBP           GET @ OF RB ASSOC. WITH CDE   Y02076 01761702
*                                  NOTE-- BYTE 0 GPR 10 =0 FROM SPQE    01762100
*                                         PROCESSING                    01762200
         BAL   RD,SRCHRBQ          CHECKPOINT THE CDE                   01762300
         TM    CDATTR,CDMIN        IS IT A MINOR CDE                    01762400
         BO    C9K4                YES, BYPASS EXTENT LIST PROC.        01764100
         SPACE                                                          01766100
*        START OF EXTENT LIST PROCESSING                                01766500
         SPACE                                                          01766900
         OC    CDXLMJP+1(3),CDXLMJP+1  IS EXTENT ADDR ZERO      ZA03227 01767037
         BZ    C9K4                BYPASS EXTENT LIST PROCESS   ZA03227 01767237
         TM    CDATTR2,CDXLE       IS EXTENT BLOCK BUILT        ZA03227 01767337
         BNO   C9K4                BYPASS EXTENT LIST PROCESS   ZA03227 01767437
         L     R3,CDXLMJP          @ OF EXTENT LIST FROM CDE     Y02076 01767837
         DROP  R3                  CDE                                  01767937
         MVI   CKCODE,XLCODE       MOVE IN CHECKCODE FOR EXT. LIST      01768037
         USING XTLST,R3            EXTENT LIST                          01768100
         MVC   CKLNT(N4),XTLLNTH   CHECK THE LENGTH                     01768500
         DROP  R3                  EXTENT LIST                          01768900
         BAL   RD,WRITESUR         CHECKPOINT THE EXTENT LIST           01769300
C9K4     LR    R3,R9               RESTORE CDE POINTER                  01794900
         USING CDENTRY,R3          CDE                                  01804900
         L     R3,CDCHAIN          GET ADDR NEXT CDE             Y02076 01814902
         B     C9E2                PROCESS NEXT CDE                     01816900
         DROP  R3                  CDE                                  01818900
         EJECT                                                          01819300
*                                                                       01819700
*        START OF CHECKPOINTING THE P/P LLE QUEUE                       01820100
*                                                                       01820500
C7H8A    L     R3,TCBLLS           GET ADDR OF FIRST LLE         Y02076 01820602
         LA    RF,LLELEN           MOVE IN LENGTH OF LLE                01820700
         ST    RF,CKLNT            *                                    01829200
C7H8     LTR   R3,R3               IS THERE AN LLE                      01831200
         BZ    C7H7A               NO- GO CHECKPOINT THE RB'S           01833200
         USING LLE,R3              LLE                                  01835200
         L     RA,LLECDPT          GET @ OF CDE ASSOC. WITH LLE  Y02076 01837202
         USING CDENTRY,RA          CDE                                  01837600
         TM    CDATTR,CDNIP        IS CDE FOR LPA MODULE                01837700
         BO    C7H81               YES, CHECKPOINT NAME AND ENTRY PT.   01837800
         MVI   CKCODE,LLEJCODE     NO, CHECKPOINT CDE POSITION          01846300
         BAL   RD,SRCHJPQ          CHECKPOINT THE LLE                   01848300
C7H82    L     R3,LLECHN           GET ADDR OF NEXT LLE          Y02076 01850302
         B     C7H8                PROCESS NEXT LLE                     01852300
         SPACE 3                                                        01854300
C7H81    MVI   CKCODE,LLELCODE     LLE WITH CDE ON LPAQ (SET CODE)      01854700
         MVI   CKAPPLEN,LLEAPLEN   SET SUR APPEDAGE LENGTH FOR LLE      01854800
         BAL   RD,WRITESUR         CHECKPOINT THE LLE                   01854900
         B     C7H82               GO GET NEXT LLE                      01863400
         DROP  R3,RA               LLE,CDE                              01865400
         EJECT                                                          01867400
*                                                                       01869400
*        START OF CHECKPOINTING THE P/P TASK RB QUEUE                   01871400
*                                                                       01871800
C7H7A    ICM   R3,M7,TCBRBP+N1     GET @ OF CHECKPOINT SVRB             01871900
         SH    R3,CMPFXLN          BACK UP TO START OF PREFIX           01872000
         USING RBPRFXST,R3         RB                                   01880500
         SPACE 3                                                        01882500
CKSVRB   TM    RBSTAB2,RBTCBNXT    IS THIS THE LAST RB                  01884500
         BO    C11H5               YES, GO DO THE STAE BLOCKS           01886500
         ICM   R3,M7,RBLINKB       GET @ NEXT RB                        01888500
         SH    R3,CMPFXLN          BACK UP TO START OF PREFIX           01888900
         LH    RF,RBSIZE           GET SIZE OF RB IN DBL WDS            01889000
         SLL   RF,N3               MULT. BY 8 TO COMPUTE NO OF BYTES    01889100
         ST    RF,CKLNT            SET LENGTH FOR WRITE SUR             01891900
         ICM   RA,M7,RBCDE1        GET @ OF CDE/LPDE FOR RB             01893900
         TM    RBSTAB1,RBFTSVRB    IS RB AN SVRB                        01895900
         BO    C7H71               YES, GO HANDLE SVRB                  01896300
*                                                                       01896700
*        PRB PROCESSING                                                 01897100
*                                                                       01897500
         MVI   CKCODE,PRBSCODE     SET CODE FOR SYNCHED PRB             01904800
         LTR   RA,RA               IS RBCDE FIELD=0.                    01906800
         BZ    C7H72               YES - CHECKPOINT SYNCHED PRB         01908800
         MVI   CKCODE,PRBLCODE     SET CODE FOR PRB W/CDE ON LPAQ       01910800
         USING CDENTRY,RA          CDE                                  01911200
         TM    CDATTR,CDNIP        IS CDE ON LPAQ (LOADED BY NIP)       01911600
         BO    C7H73               YES, GO CHECKPOINT NAME AND EP. TOO  01912000
         MVI   CKCODE,PRBJCODE     SET CODE FOR PRB W/CDE ON JPQ        01912100
         BAL   RD,SRCHJPQ          CHECKPOINT RB WITH CDE POSITION      01912200
         B     CKSVRB              GO SEE IF THIS WAS LAST RB           01913000
         SPACE 3                                                        01913400
*        SVRB PROCESSING                                                01913800
         SPACE                                                          01914200
C7H71    L     RD,RBLINK           GET RB @                      Y02076 01914402
         DROP  R3                  RB                            Y02076 01914602
         SH    RD,CMPFXLN          BACK UP TO PREFIX             Y02076 01914802
         USING RBPRFXST,RD         ADDRESS RB                    Y02076 01915002
         CLI   RBINTCOD+N1,EOVSVC  Q - EOV SVRB                  Y02076 01915202
         DROP  RD                  RB                            Y02076 01915402
         BNE   C7H71A              BR NO                         Y02076 01915602
         MVI   CKCODE,SVRBEOVC     SET SUR CODE AND              Y02076 01915802
         MVI   CKAPPLEN,N0         APP. LNGTH TO ZERO            Y02076 01916002
         B     C7H72               COMPLETE EOV SVRB ENTRY       Y02076 01916202
C7H71A   MVI   CKCODE,SVRB234C     TYPE 2,3,4 SVRB APP. LEN.     Y02076 01916702
         MVI   CKAPPLEN,SVRB234A   SET APPENDAGE LENGTH         ZA05247 01917137
         LTR   RA,RA               IS CDE ADDRESS=0                     01918700
         BZ    C7H72               YES- IT IS A TYPE 2,3,4 SVRB         01920700
         MVI   CKCODE,SVRB4NCD     NO - IT IS THE NTH LOAD OF TYPE4 SVC 01920800
C7H73    MVI   CKAPPLEN,RBLPALEN   SET APP. LENGTH FOR 4N OR LPA PRB    01920900
C7H72    BAL   RD,WRITESUR         CHECKPOINT THE RB                    01921000
         B     CKSVRB              GO SEE IF THIS WAS LAST RB           01927600
         DROP  RA                  CDE                           Y02076 01929602
         EJECT                                                          01931600
*                                                                       01933600
*        START OF CHECKPOINTING THE STAE CONTROL BLOCKS                 01934000
*                                                                       01934400
         SPACE 3                                                        01934500
C11H5    LA    R3,TCBNSTAE         GET @ OF STAE FLAGS                  01934600
         MVI   CKCODE,NSTAECOD     SET CHECKCODE FOR TCBNSTAE FIELD     01934700
         LA    RF,NSTAELEN         SET LENGTH OF TCBNSTAE FIELD         01936400
         ST    RF,CKLNT            FOR WRITESUR                         01938400
         BAL   RD,WRITESUR         CHECKPOINT TCBNSTAE                  01938800
         ICM   R3,M7,TCBSTABB      GET @ OF FIRST SCB                   01939200
         MVI   CKCODE,SCBCODE      SET CHECKCODE FOR SCB                01939600
         LA    RF,SCBLEN           SET LENGTH OF SCB                    01939700
         ST    RF,CKLNT            FOR WRITESUR                         01940200
         USING SCB,R3              SCB                                  01940600
CKSCB0   LTR   R3,R3               ANY SCB'S                            01941000
         BZ    CKFOE1              GO PROCESS FOE'S IF ANY              01941100
         ICM   RA,M7,SCBOWNRA      GET @ OF RB FROM SCB                 01941200
         BAL   RD,SRCHRBQ          CHECKPOINT SCB WITH RB POSITION      01941300
         ICM   R3,M7,SCBCHAIN+N1   GET @ OF NEXT SCB                    01942800
         B     CKSCB0              GO PROCESS NEXT SCB                  01944800
         DROP  R3                  SCB                                  01945200
         EJECT                                                          01945600
*        CHECKPOINTING THE P/P FOE CONTROL BLOCKS                       01945700
*                                                                       01946200
         SPACE 3                                                        01946600
CKFOE1   MVI   CKCODE,FOECODE      PUT X'08' IN SUR CODE (CODE FOR FOE) 01947000
         LA    RF,FOELEN           SET LENGTH FOR A FOE                 01947400
         ST    RF,CKLNT            FOR WRITESUR                         01953200
         ICM   R3,M7,TCBFOEA       GET @ OF  FIRST FOE                  01955200
CKFOE    BZ    C11H7               NO FOE'S LEFT, SO XCTL TO CHECKMAIN3 01957200
         SR    RF,RF               CLEAR HI AND LO BYTES         Y02076 01957402
         USING FOE,R3              FOE                           Y02076 01957602
         ICM   RF,M6,FOEVINDX      LOAD 2ND & 3RD BYTES WITH     Y02076 01957802
*                                  VIRTUAL INDEX.  THIS WILL     Y02076 01958002
*                                  GENERATE A VIRTUAL ADDRESS.   Y02076 01958202
         C     RF,CKPPM            IS ADDR BELOW USER REGION     Y02076 01958402
         BL    CKFOE2              BR YES, DON'T SAVE FOE        Y02076 01958602
         C     RF,CKPPE            IS ADDR ABOVE USER REGION     Y02076 01958802
         BNL   CKFOE2              BR YES, DON'T SAVE FOE        Y02076 01959002
         BAL   RD,WRITESUR         SAVE (CHKPT) FOE              Y02076 01959202
CKFOE2   DS    0H                                                Y02076 01959402
         ICM   R3,M7,FOEFLINK      GET ADDR OF NEXT FOE          Y02076 01959602
         B     CKFOE               SEE IF ALL DONE                      01960300
         DROP  R3                  FOE                                  01960700
         EJECT                                                          01961100
*                                                                       01962700
*        XCTL PROCESSING TO NEXT LOAD                                   01964700
*                                                                       01965100
C11H7    LA    RF,CKMN40           GET @ OF NAME OF NEXT MODULE         01965500
         LR    R1,RC               RESTORE @ OF CHKWA TO GPR 1          01965900
         ST    RF,CK40XCTL         PUT IT IN PARAM LIST                 01966000
         LA    RF,CK40XCTL         GET @ OF PARAM LIST                  01966100
         XCTL  SF=(E,(15))         XCTL TO NEXT LOAD                    01967700
         EJECT                                                          01969700
*                                                                       01970100
*        ROUTINE TO DETERMINE POSITION OF A CDE ON TCBJPQ               01970500
*                                                                       01970900
*        INPUT - @ OF CDE TO BE FOUND IN GPR 10.                        01971000
*                                                                       01971100
*              - RETURN @ IN GPR 13. ROUTINE BRANCHES TO WRITESUR.      01993900
*                                                                       02003900
         SPACE 3                                                        02013900
SRCHJPQ  DS    0H                  LABEL                                02015900
C13A2    L     R8,TCBJPQ           GET @ OF FIRST CDE ON JPQ            02016300
         LA    R6,N1               SET POSITION INDEX TO 1.             02016700
         LA    R8,N0(R8)           CLEAR HI BYTE FOR COMPARES           02017100
C13A3    CR    R8,RA               CDE=CDE OF BLOCK                     02017500
         BE    WRITESUR            YES, CDE FOUND GO CHECKPOINT BLOCK   02025100
         USING CDENTRY,R8          CDE                                  02027100
         L     R8,CDCHAIN          GET ADDRESS OF NEXT CDE       Y02076 02029102
         LA    R6,N1(R6)           INCREMENT INDEX BY 1                 02031100
         B     C13A3               SEE IF THIS IS THE ONE               02031500
         DROP  R8                  CDE                                  02031900
         EJECT                                                          02032300
*                                                                       02032700
*        ROUTINE TO DETERMINE POSITION OF AN RB ON P/P TCB RB CHAIN     02040300
*                                                                       02042300
*        INPUT - @ OF RB TO BE FOUND IN GPR 10.                         02044300
*                                                                       02046300
*              - RETURN @ IN GPR 13. ROUTINE BRANCHES TO WRITESUR.      02046700
*                                                                       02047100
*                                                                       02047500
         SPACE 3                                                        02047900
SRCHRBQ  SR    R6,R6               INIT. POSITION INDEX = 0.            02055500
         LTR   RA,RA               IS RB @ = 0                          02057500
         BZ    WRITESUR            YES, NO RB SO LEAVE                  02059500
         L     R8,TCBRBP           GET FIRST RB @ FROM TCB              02061500
         LA    R8,N0(R8)           CLEAR HI BYTE FOR COMPARES.          02061900
SRCHRB2  LA    R6,N1(R6)           INCR. POSITION INDEX BY 1.           02062300
         CR    R8,RA               RB=RB OF BLOCK                       02062700
         BE    WRITESUR            YES, RB FOUND GO CHECKPOINT BLOCK    02063100
         USING RBSECT,R8           RB                                   02070700
         TM    RBSTAB2,RBTCBNXT    IS THIS LAST RB                      02072700
         BO    SRCHRBQ1            YES, RB NOT FOUND                    02074700
         ICM   R8,M7,RBLINKB       GET @ OF NEXT RB                     02076700
         B     SRCHRB2             GO SEE IF THIS IS THE ONE            02077100
SRCHRBQ1 SR    R6,R6               RB NOT FOUND SO RESET INDEX TO 0.    02077500
*        FALL THROUGH TO WRITESUR                                       02077900
         DROP  R8                  RB                                   02078300
         EJECT                                                          02085900
*                                                                       02087900
*        ROUTINE TO FORMAT THE SUR BUFFER                               02089900
*                                                                       02091900
*        INPUT-SIZE OF CONTROL BLOCK IN CKLNT                           02092300
*             -@ OF CONTROL BLOCK TO CHECKPOINT IN GPR 3                02092700
*             -APPENDAGE LENGTH FOR SUR IN CKAPPLNT (2 BYTES)           02093100
*             -CHECKCODE FOR CONTROL BLOCK IN CKCODE                    02093500
*             -@ OF NEXT BYTE OF BUFFER IN CKBFSTAD                     02101100
*             -@ OF START OF SUR BUFFER IN CMBUF                        02103100
*             -NUMBER OF BYTES LEFT IN BUFFER IN CKBFLWA                02105100
*             -@ OF CDE/LPDE IF NECESSARY IN GPR 10                     02107100
*             -POSITION OF CDE/RB ON QUEUE IF NECESSARY IN GPR 6.       02107500
*             -RETURN ADDRESS IN GPR 13.                                02107900
*                                                                       02108300
*                                                                       02108700
*        OUTPUT-CKAPPLNT SET TO 0 (2 BYTES)                             02116300
*              -CKBFSTAD UPDATED TO @ OF NEXT AVAIL. BYTE               02118300
*              -CKBFLWA UPDATED TO NO OF BYTES LEFT IN BUFFER           02120300
*                                                                       02122300
*                                                                       02122700
         SPACE 3                                                        02123100
WRITESUR DS    0H                  BUFFER HANDLER ROUTINE               02123500
C13A1    STM   R2,RD,CKOBHSAV      SAVE REGS                            02123900
         LH    R4,CKAPPLNT         GET APPENDAGE LENGTH IF ANY          02131500
         A     R4,CKLNT            INCREMENT BY BLOCK LENGTH            02133500
         LA    R4,N1(R4)           ADD 1 FOR CHECKCODE                  02135500
*        R4 NOW CONTAINS # OF BYTES  NEEDED TO CHECKPOINT THIS BLOCK    02137500
         C     R4,CKBFLWA          IS THERE ENOUGH ROOM IN BUFFER       02137900
         BNH   C13C1               YES, GO MOVE THE BLOCK               02138300
         CLC   CMBUF+N1(N3),CKBFSTAD+N1 IS SUR BUFFER EMPTY             02138700
         BE    C13C1               YES, MOVE AS MUCH AS POSSIBLE        02139100
         L     R7,CKBFLWA          GET LENGTH AVAIL.                    02162800
         LTR   R7,R7               IS SUR BUFFER FULL                   02172800
         BZ    C13A22              YES, BYPASS SETTING NEXT BYTE TO 0   02182800
         L     R8,CKBFSTAD         GET @ OF NEXT AVAIL. BYTE            02184800
         MVI   N0(R8),N0           SET NEXT BYTE OF BUFFER TO 0 TO      02185200
*                                  INDICATE END OF DATA                 02185600
C13A22   BAL   R7,WRITERTN         WRITE OUT CURRENT SUR BUFFER         02186000
C13C1    L     R8,CKBFSTAD         GET @ NEXT AVAIL. BYTE               02186400
         MVC   N0(N1,R8),CKCODE    MOVE IN CHECKCODE FOR BLOCK          02186500
         BCTR  R4,R0               DECR. BLKLEN BY LENGTH OF CHECKCODE  02186600
         LA    R8,N1(R8)           UPDATE @ OF NEXT AVAIL. BYTE         02188500
         ST    R8,CKBFSTAD         *                                    02190500
         L     RF,CKBFLWA          UPDATE REMAINING BYTE COUNT          02190900
         BCTR  RF,R0               *                                    02191300
         ST    RF,CKBFLWA          *                                    02191700
C13C2    C     R4,CKBFLWA          BLKLEN > # BYTES LEFT                02192100
         BH    C13C3               YES, GO MOVE AS MUCH AS POSSIBLE     02192200
         LR    RF,R4               COMPUTE LENGTH TO BE MOVED           02192300
         SH    RF,CKAPPLNT         REMOVE APPENDAGE SIZE IF ANY         02194800
         C     RF,HUNDRED          MOVING MORE THAN FF BYTES ? @ZA14558 02195437
         BNL   CMVCL               YES BRANCH TO MVCL          @ZA14558 02196037
         BCTR  RF,R0               ADJUST FOR EXECUTE OF MOVE           02196800
         EX    RF,MOVEBLK          MOVE THE BLOCK TO SUR BUFFER         02198800
         CLI   CKCODE,XLCODE       IS IT AN EXTENT LIST                 02199200
         BE    C13D1               YES, GO UPDATE BUFFER POINTERS       02199600
         L     RD,CKLNT            GET LENGTH OF BLOCK                  02199700
         A     RD,CKBFSTAD         COMPUTE @ OF APPENDAGE AREA IN BUF   02199800
         CLI   CKCODE,PRBLCODE     IS IT PRB W/CDE ON LPAQ              02199900
         BE    APNDEP              YES, GO PUT IN MODULE NAME AND EP    02203400
         CLI   CKCODE,LLELCODE     IS IT LLE W/CDE ON LPAQ              02205400
         BE    APNDEP              YES, GO PUT IN MODULE NAME AND EP    02205800
         CLI   CKCODE,PRBJCODE     IS IT PRB W/CDE ON JPQ               02206200
         BE    CKPRB               YES, GO PUT CDE POSITION IN RBCDE    02206600
         CLI   CKCODE,LLEJCODE     IS IT LLE W/CDE ON JPQ               02206700
         BE    CKLLE               YES, GO PUT CDE POSITION IN LLCDPTR  02206800
         CLI   CKCODE,SCBCODE      IS IT A STAE CONTROL BLOCK           02213600
         BE    CKSCB               YES, GO PUT RB POSITION IN SCBOWNRA  02215600
         CLI   CKCODE,SVRBEOVC     IS IT AN EOV SVRB             Y02076 02216102
         BE    C13D1               BR YES                        Y02076 02216602
         CLI   CKCODE,SVRB234C     IS IT T2,3,4 SVRB                    02217600
         BE    CKT234              YES, GO APPEND EP AND SVC NO.        02219600
         CLI   CKCODE,SVRB4NCD     IS IT N'TH LOAD OF T4 SVC.           02220000
         BE    APNDEP              YES, GO PUT IN MODULE NAME AND EP    02220400
         CLI   CKCODE,CDECODE      IS IT A CDE                          02227800
         BNE   C13D1               NO, JUST UPDATE BUFFER POINTERS      02229800
         USING CDENTRY,R8          CDE                                  02231800
         ST    R6,CDRRBP           RB POS. INDEX IN CDE IN BUF   Y02076 02231902
         TM    CDATTR2,CDOLY       Q - OVERLAY PROGRAM           Y02076 02232002
         BZ    C13D1               BR NO                         Y02076 02232102
         L     R2,CDXLMJP          GET EXTENT LIST ADDR          Y02076 02232202
         USING XTLST,R2            XTLST                         Y02076 02232302
         L     R2,XTLMSBAA         GET SEGTAB ADDR               Y02076 02232402
         DROP  R2                  XTLST                         Y02076 02232502
         L     RF,CVTPTR           GET CVT ADDR                  Y02076 02232602
         USING CVTMAP,RF           CVT                           Y02076 02232702
         CLC   N1(N3,R2),CVTLINK+N1 LINKLIB DCB                  Y02076 02232802
         BNE   C13D1               BR NO                         Y02076 02233002
         OI    CDRRBP,LINKLIB      SET LINKLIB INDICATOR         Y02076 02233102
         DROP  RF                  CVT                           Y02076 02233202
C13D1    L     R8,CKBFSTAD         GET @ OF NEXT AVAIL. BYTE OF BUFFER  02234200
         AR    R8,R4               UPDATE NEW START @ FOR NEXT BLOCK    02234600
         ST    R8,CKBFSTAD         * SAVE IT FOR NEXT CALL              02235000
         L     RF,CKBFLWA          GET OLD BYTES REMAINING              02235400
         SR    RF,R4               COMPUTE NEW BYTES REMAINING          02235500
         ST    RF,CKBFLWA          SAVE IT FOR NEXT CALL                02243100
C13D2    XC    CKAPPLNT,CKAPPLNT   CLEAR APPENDAGE LENGTH CELL          02245100
         LM    R2,RD,CKOBHSAV      RESTORE REGS                         02247100
         BR    RD                  RETURN TO CALLER                     02249100
         SPACE 3                                                        02249500
*        BLOCK IS TOO LONG FOR THE BUFFER SO IT MUST BE SEGMENTED       02249900
         SPACE 3                                                        02250300
C13C3    L     RF,CKBFLWA          GET LENGTH AVAIL. IN BUFFER          02250700
         C     RF,HUNDRED          LENGTH GREATER THAN FF HEX  @ZA14558 02250837
         BNL   CMVCL               YES BRANCH                  @ZA14558 02251237
         BCTR  RF,R0               ADJUST FOR EXECUTE OF MOVE           02251637
         EX    RF,MOVEBLK          FILL THE BUFFER                      02252037
         A     R3,CKBFLWA          UPDATE BLOCK POINTER                 02252437
         S     R4,CKBFLWA          UPDATE BLOCK LENGTH                  02253200
         BAL   R7,WRITERTN         WRITE OUT FILLED BUFFER              02255200
         L     R8,CKBFSTAD         RESTORE BUFFER POINTER               02257200
         LTR   R4,R4               ANY MORE TO BE MOVED                 02257600
         BP    C13C2               YES, GO MOVE IT                      02257700
         B     C13D2               NO, GO RESET APP. LEN AND RETURN     02264400
* USE MVCL AS LENGTH IS TOO LONG FOR MVC INSTRUCTION           @ZA14558 02264537
CMVCL    EQU   *                                               @ZA14558 02264637
         L     R8,CKBFSTAD         GET STARTING ADDRESS OF SUR @ZA14558 02264737
         LR    RE,R8               GET SUR ADDRESS INTO REG E  @ZA14558 02264837
         LR    R6,R3               GET FIELD ADDRESS IN REG 6  @ZA14558 02264937
         LR    R7,RF               PUT LENGTH INTO REG      7  @ZA14558 02265037
         MVCL  RE,R6               MOVE BIG BLOCK              @ZA14558 02265137
         L     RF,CKBFLWA          RELOAD REG F                @ZA14558 02265237
         CR    R4,RF               COMPARE REG 4 WITH F        @ZA19627 02265337
         BL    AHEAD               BRANCH IF 4 IS LESS         @ZA19627 02265437
         SR    R4,RF               DECREMENT LENGTH IN REG  4  @ZA14558 02265537
         AR    R3,RF               POINT R3 TO NEW FIELD ADDR  @ZA14558 02265637
         BAL   R7,WRITERTN         WRITE SUR BUFFER OUT        @ZA14558 02265737
         L     R8,CKBFSTAD         RELOAD SUR STARTING ADDRESS @ZA27110 02265837
         LTR   R4,R4               ALL DATA PUT OUT ???        @ZA14558 02266037
         BP    C13C2               NOT YET GO FINISH           @ZA14558 02266237
         B     C13D2               YES END OF PROCESSING       @ZA14558 02266437
AHEAD    EQU   *                                               @ZA19627 02266637
         AR    R8,R4               POINT TO NEXT SUR RECORD    @ZA19627 02266837
         ST    R8,CKBFSTAD         SET UP ADDRESS OF NEXT SUR  @ZA19627 02267037
         SR    RF,R4               DECREMENT BYTE COUNT LEFT   @ZA19627 02267237
         ST    RF,CKBFLWA          SAVE COUNT IN WORK AREA     @ZA19627 02267437
         B     C13D2               BRANCH TO PROCESS NEXT SUR  @ZA19627 02267637
*                                                              @ZA14558 02267837
         SPACE 3                                                        02268037
*        THE BLOCK IS A PRB WITH CDE ON JPA QUEUE                       02268400
         SPACE                                                          02270400
         USING RBPRFXST,R8         RB                                   02270800
CKPRB    STCM  R6,M7,RBCDE1        PUT CDE INDEX INTO RB IN BUFFER      02271200
         B     C13D1               GO UPDATE BUFFER POINTERS            02271600
         DROP  R8                  RB                                   02272300
         SPACE 3                                                        02272700
*        THE BLOCK IS AN LLE WITH CDE ON JPA QUEUE                      02273100
         SPACE                                                          02273500
         USING LLE,R8              LLE                                  02273600
CKLLE    ST    R6,LLECDPT          CDE INDEX IN LLE IN BUFFER    Y02076 02273702
         B     C13D1               GO UPDATE BUFFER POINTERS            02273800
         DROP  R8                  LLE                                  02275700
         SPACE 3                                                        02277700
*        THE BLOCK IS AN SCB                                            02278100
         SPACE                                                          02278500
         USING SCB,R8              SCB                                  02278900
CKSCB    STCM  R6,M7,SCBOWNRA      PLACE RB INDEX INTO SCB IN BUFFER    02279300
         B     C13D1               GO UPDATE BUFFER POINTERS            02279400
         DROP  R8                  SCB                                  02279500
         SPACE 3                                                        02285600
*        THE BLOCK IS AN SVRB FOR A TYPE 2, 3, OR 1ST LOAD OF A         02287600
*              TYPE 4 SVC.                                              02289600
         SPACE                                                          02291600
         USING RBPRFXST,R3         RB                                   02292000
CKT234   L     RF,RBLINK           GET @ OF PREV. RB.                   02292100
         DROP  R3                  RB                                   02292200
         SH    RF,CMPFXLN          BACKUP TO PREFIX                     02293700
         USING RBPRFXST,RF         RB (PREVIOUS)                        02295700
         LH    R0,RBINTCOD         GET SVC NO. FOR THIS SVRB            02296100
         STC   R0,N4(RD)           PUT SVC NO. INTO SUR APPENDAGE AREA  02296500
         DROP  RF                  RB (PREVIOUS)                        02296900
         L     RE,CVTPTR           GET @ OF CVT                         02297400
         USING CVT,RE              CVT                                  02297800
         L     RE,CVTABEND         GET @ OF SECONDARY CVT               02298200
         DROP  RE                  CVT                                  02298300
         USING SCVTSECT,RE         SCVT                                 02299600
         L     RE,SCVTSVCT         GET @ OF SVC TABLE (IBMORG)          02301600
         DROP  RE                  SCVT                                 02302000
CKT234EP SLL   R0,N3               MAKE SVC NO. AN INDEX FACTOR  Y02076 02303802
         AR    RE,R0               GET @ OF SVC TABLE ENTRY             02303900
         MVC   N0(N4,RD),N0(RE)    MOVE ENTRY POINT @ TO SUR APPENDAGE  02309300
         B     C13D1               GO UPDATE BUFFER POINTERS            02311300
         SPACE 3                                                        02316600
*        THE BLOCK IS A SUBSEQUENT LOAD OF A TYPE 4 SVC, A PRB          02318100
*        WITH THE CDE ON THE LPAQ, OR AN LLE WITH THE CDE ON THE LPAQ   02320100
         SPACE                                                          02320500
         USING CDENTRY,RA          CDE                                  02320900
APNDEP   MVC   N0(N8,RD),CDNAME    MOVE MODULE NAME TO SUR APPENDAGE    02321000
         MVC   N8(N4,RD),CDENTPT   MOVE IN ENTRY POINT ADDRESS          02321100
         DROP  RA                  CDE                                  02321200
         B     C13D1               GO UPDATE THE POINTERS               02322700
*                                                                       02324700
*        THE FOLLOWING INSTRUCTION IS THE SUBJECT OF EXECUTE            02325100
*        INSTRUCTIONS TO MOVE A CONTROL BLOCK INTO THE SUR BUFFER.      02325500
*                                                                       02325600
         SPACE                                                          02325700
MOVEBLK  MVC   N0(N0,R8),N0(R3)    MOVES BLOCK TO SUR BUFFER            02325800
         EJECT                                                          02330800
*                                                                       02332800
*        ROUTINE TO OUTPUT THE SUR RECORD                               02334800
*                                                                       02335200
*        INPUT - RETURN ADDRESS IN GPR 7.                               02335600
*                                                                       02336000
*        OUTPUT - SUR BUFFER WRITTEN TO CHECKPOINT DATA SET             02336100
*               - SUR BUFFER POINTERS REINITIALIZED.                    02336200
*                                                                       02336300
*                                                                       02337600
         SPACE 3                                                        02339600
WRITERTN L     R5,CKDCBAD          GET DCB @ FOR CHECKPOINT DATA SET    02340000
         LA    RD,CKREGSAV         GET @ OF STD SAVE AREA FOR BSAM      02340400
         WRITE CKDECB1,SF,(5),,MF=E     WRITE OUT THE SUR BUFFER        02340700
         CHECK CKDECB1             COMPLETE THE WRITE                   02341100
         TM    CKFLAG1,CKTAPE      IS DATA SET ON TAPE                  02341200
         BZ    CMEOVDA             NO THEN CHECK FOR EOV ON DASD        02342400
         L     RF,CKTSTEOV         GET @ VOL SEQ NO IN UCB              02344400
         CLC   N0(N4,RF),CKEOVCMR  DID EOV OCCUR (IS SEQ NO CHANGED)    02344500
         BNE   CMEOV               YES, EOV IS INDICATED                02344600
CMTIOTST CLI   CKRETIO,CKIOERR     WAS THERE AN I/O ERROR               02344700
         BE    CKEROUT             YES, GO XCTL TO I/O RESUME           02345100
C13B1    L     RF,CMBUF            RE-INITIALIZE THE CURRENT BUFFER     02345500
         ST    RF,CKBFSTAD         POINTER TO START OF SUR BUFFER       02345600
         LA    RF,SURL             RE-INITIALIZE THE NUMBER OF BYTES    02345700
         ST    RF,CKBFLWA          AVAILABLE TO LENGTH OF SUR           02345802
         BR    R7                  RETURN TO CALLER                     02345900
         SPACE 3                                                        02347000
         USING IHADCB,RF           DCB                                  02349000
CMEOVDA  L     RF,CKDCBAD          GET @ OF CHKPT DCB                   02349100
         L     RF,DCBDEBAD         GET @ OF DEB                         02349200
         DROP  RF                  DCB                                  02349700
         USING DEBBASIC,RF         DEB                                  02350100
         CLC   DEBNMEXT(N1),CKTSTEOV    IS IT EOV ON DASD               02350500
         DROP  RF                  DEB                                  02350600
         BE    CMTIOTST            NO, CHECK FOR I/O ERROR              02350700
CMEOVER  MVI   CKRETIO,N8          SET RETURN CODE TO 8                 02355100
         LA    RF,CKERIO7          INDICATE EOV MESSAGE CODE            02357100
         STH   RF,CKMSGCOD         PUT IT IN WORK AREA                  02359100
CKEROUT  MVI   CKXCTL,CHARN        SET TO XCTL TO IGC0N06C              02359500
         B     C11H7               GO XCTL                              02359900
         SPACE                                                          02360300
CMEOV    TM    CKFLAG2,CKEOV       IS IT 2ND EOV FOR THIS REQUEST       02360600
         BO    CMEOVER             YES, GO TERMINATE CHECKPOINT         02361000
         OI    CKFLAG2,CKEOV       1ST EOV SO TRY AGAIN                 02361100
         MVI   CKXCTL,CHAR2        SET TO XCTL TO IGC0206C              02361200
         B     C11H7               GO XCTL                              02362400
         SPACE 3                                                        02364400
*                                                                       02364800
*        CHECKMAIN 2 SYNAD ROUTINE                                      02364900
*                                                                       02365000
         SPACE                                                          02366200
SYNAD    LA    R0,X317             GET MESSAGE CODE FOR I/O ERROR       02368200
         STH   R0,CKMSGCOD         PUT IT IN CHKWA.                     02368600
         MVI   CKRETIO,CKIOERR     SET I/O ERROR FLAG                   02368700
         BR    RE                  RETURN TO CALLER                     02368800
         DROP  R5,RB,RC            TCB,CODE,CHKWA                       02368900
         EJECT                                                          02369000
*                                                                       02369100
*              CONSTANTS AND EQUATES                                    02370300
*                                                                       02372300
         SPACE 3                                                        02372400
         DS    0F                                                       02372537
HUNDRED  DC    X'00000100'         HEX VALUE OF 100 DEC 256    @ZA14558 02372637
ONE8FOX  DC    X'0000018F'         HEX VALUE OF FULL SUR       @ZA14558 02372737
CKMN3NM  DC    C'IGC0H06C'         NAME OF CHECKMAIN 3.                 02372837
         DS    0H                  ALIGNMENT                            02372937
CMPFXLN  DC    AL2(RBPRFLNA)       LENGTH OF THE RB PREFIX              02373037
CKMH4    DC    H'4'                USED TO GET @ OF SVCTABLE-4, HI IBM  02373300
*                                  SVC NUMBER, LO USER SVC NUMBER.      02373400
         SPACE 3                                                        02373500
EOM      EQU   *                   END OF MODULE                        02392300
MODLEN   EQU   EOM-IGC0G06C        LENGTH OF MODULE                     02402300
AREALEN  EQU   MODLEN/10           LENGTH OF PATCH AREA                 02404300
PAREA    DS    CL(AREALEN)         PATCH AREA FOR MAINT. OF 10%         02406300
         SPACE 3                                                        02408300
N0       EQU   0                   0                                    02410300
N1       EQU   1                   1                                    02410700
N2       EQU   2                   2                                    02411100
N3       EQU   3                   3                                    02411500
N4       EQU   4                   4                                    02411900
N8       EQU   8                   8                                    02418200
LINKLIB  EQU   B'10000000'         LINKLIB IND FOR CDE           Y02076 02419202
         SPACE                                                          02420200
M3       EQU   3                   MASK FOR BYTES 2 AND 3 OF REG        02422200
M6       EQU   6                   REG MASK FOR BYTES 1 & 2      Y02076 02422502
M7       EQU   7                   MASK FOR BYTES 1-3 OF REG            02424200
NOTEQ    EQU   7                   MASK TO BRANCH ON UNEQUAL COMPARE    02424300
         SPACE                                                          02424400
CHARN    EQU   C'N'                EBCDIC N                             02430700
CHAR2    EQU   C'2'                ECBDIC 2                             02432700
X317     EQU   X'317'              ERROR MSG NUMBER FOR I/O ERROR       02434700
CKERIO7  EQU   X'31B'              INDICATES EOV ERROR                  02436700
         SPACE                                                          02436800
SURL     EQU   400                 LENGTH OF A SUR RECORD        YM7049 02436902
         SPACE                                                          02443200
SPQECODE EQU   6                   CHECKCODE FOR SPQE                   02445200
SPQESIZE EQU   16                  LENGTH OF AN SPQE             Y02076 02447202
DQECODE  EQU   7                   CHECKCODE FOR DQE                    02449200
FQECODE  EQU   2                   CHECKCODE FOR FQE                    02449300
DQFQLEN  EQU   16                  LENGTH OF A DQE OR FQE               02449400
CDECODE  EQU   9                   CHECKCODE FOR CDE                    02449500
CDELEN   EQU   32                  LENGTH OF CDE                 Y02076 02455702
XLCODE   EQU   X'17'               CHECKCODE FOR EXTENT LIST            02457700
LLEJCODE EQU   X'0A'               CHECKCODE FOR LLE W/CDE ON JPQ       02459700
LLELCODE EQU   X'0E'               CHECKCODE FOR LLE W/CDE ON LPAQ      02461700
LLELEN   EQU   12                  LENGTH OF AN LLE              Y02076 02462102
LLEAPLEN EQU   12                  LENGTH OF SUR APPENDAGE FOR LLE      02462200
PRBSCODE EQU   5                   CHECKCODE FOR SYNCHED PRB            02462300
PRBLCODE EQU   X'0C'               CHECKCODE FOR PRB W/CDE ON LPAQ      02464300
PRBJCODE EQU   X'0B'               CHECKCODE FOR PRB W/CDE ON JPQ       02466300
SVRB234C EQU   X'1F'               CHECKCODE FOR TYPE 2, 3, 4 SVRB      02468300
SVRB4NCD EQU   X'1E'               CHECKCODE FOR TYPE 4N SVRB           02473600
SVRB234A EQU   5                   SUR APP. LEN. FOR TYPE 2,3,4 SVRB    02475600
RBLPALEN EQU   12                  SUR APP. LEN. FOR 4N SVRB, LPAQ PRB  02477600
NSTAECOD EQU   X'0D'               CHECKCODE FOR TCBNSTAE FIELD         02478000
NSTAELEN EQU   4                   LENGTH OF TCBNSTAE FIELD OF TCB      02478400
SCBCODE  EQU   X'11'               CHECKCODE FOR SCB                    02478800
FOECODE  EQU   X'08'               CHECKCODE FOR FOE                    02479300
EOVSVC   EQU   55                  SVC 55 (EOV)                  Y02076 02479402
SVRBEOVC EQU   X'1D'               EOV SVRB CODE FOR SUR         Y02076 02479502
         EJECT                                                          02479602
         IEEVCHWA VER=3            AOS2 VERSION OF WA                   02479900
         EJECT                                                          02480300
*        CHECKMAIN WORK AREA PORTION OF CHECKPOINT WORK AREA            02480700
         SPACE                                                          02480800
CKRETIO  EQU   CKRETCOD+1          BYTE FOR ERROR RETURN CODE           02480900
CKTSTEOV EQU   CKUNIT              @ OF VOL SEQ NO IN UCB (TAPE)        02482400
*                                  CURRENT EXTENT NO. (DASD)            02484400
CKEOVCMR EQU   CKUNIT+4            VOL SEQ NO OF CURRENT VOL. (TAPE)    02484800
CMADEOV  DS    F                   SAVE AREA FOR INFO NEEDED            02485200
CMNEOV   DS    F                   TO TEST IF EOV OCCURRED              02485600
CKBFLWA  DS    F                   REMAINING BYTES IN BUFFER            02490500
CKBFSTAD DS    F                   NEXT BYTE IN BUFFER TO BE FILLED     02492500
CMBUF    DS    F                   BUFFER ADDRESS                       02494500
CKMN40   DS    2F                  SAVE AREA FOR XCTL ADDRESS           02494900
CK40XCTL DS    F                   SAVE AREA FOR XCTL                   02495300
CKOBHSAV DS    12F                 SAVE AREA FOR SUBROUTINES            02496600
CME2     DS    CL1                 BIG BLOCK SWITCH                     02498600
CKCODE   DS    CL1                 SUR CODE FOR THIS BLOCK              02499000
CKLNT    DS    F                   SUR LENGTH FOR THIS BLOCK            02499100
CMSYSA   DS    F                   SYSTEM WORK CELL                     02499200
CKXCTL   EQU   CKMN40+4            ALLOWS FOR CHANGE OF XCTL ADDRESS    02499300
SWITCH   DS    F                   SWITCH WORD                          02499600
CKAPPLNT DS    H                   APPENDAGE LENGTH FOR THIS BLOCK      02500000
CKAPPLEN EQU   CKAPPLNT+N1         OFFSET TO SECOND BYTE                02500100
         EJECT                                                          02500200
         CVT   DSECT=YES,PREFIX=NO                                      02501300
         EJECT                                                          02503300
         IHASCVT                                                        02503700
         EJECT                                                          02504000
         IKJTCB                                                         02504400
         EJECT                                                          02504800
         IKJRB                                                          02509100
         EJECT                                                          02511100
         IHASCB                                                         02513100
         EJECT                                                          02513200
         IHACDE                                                         02513300
         EJECT                                                          02513400
         IHAXTLST                                                       02513900
         EJECT                                                          02514300
         IHALLE                                                         02514700
         EJECT                                                          02514800
         IHASPQE                                                        02514900
         EJECT                                                          02516100
         IHADQE                                                         02518100
         EJECT                                                          02518500
         IHAFQE                                                         02518600
         EJECT                                                          02519800
         IHAFOE                                                         02521800
         EJECT                                                          02522200
         IHADCB DSORG=(PO,PS),DEVD=(DA,TA)                              02522300
         EJECT                                                          02526300
         IEZDEB                                                         02528300
.LIB1BA1 ANOP                                                           02530300
         AIF   ('&LIB' EQ 'LIB2').LIB2BA1  TEST FOR LIB2(AOS)           02530400
*                                                                       02530700
*                                                                     * 02534400
* STATUS - CHANGE LEVEL 001                                           * 02538400
*                                                                     * 02542400
*                                                                     * 02546400
* FUNCTION...                                                         * 02550400
*   WRITES SUPERVISOR RECORDS ON CHKPT DATA SET. THESE CONTAIN THE    * 02554400
*   MAIN STORAGE SUPERVISOR'S CONTROL BLOCKS, AND SOME OF THE CONTENTS* 02558400
*   SUPERVISOR'S CONTROL BLOCKS,INCLUDING RB'S AND LLE'S.             * 02562400
*                                                                     * 02581200
*                                                                     * 02600017
* ENTRY...                                                            * 02800017
*   IGC0G06C                                                          * 03000017
*                                                                     * 03200017
*                                                                     * 03400017
* INPUT...                                                            * 03600017
*   N/A                                                               * 03800017
*                                                                     * 04000017
*                                                                     * 04200017
* OUTPUT...                                                           * 04400017
*   CHKPT DATA SET SUPERVISOR RECORDS                                 * 04600017
*                                                                     * 04800017
*                                                                     * 05000017
* EXITS                                                               * 05200017
*   NORMAL- XCTL TO IGC0H06C (NEXT LOAD OF RESTART)                   * 05400017
*   ERROR                                                             * 05600017
*   (1)UNRECOVERABLE EOV ON CKPT DATA SET- XCTL TO IGC0N06C WITH      * 05800017
*      RETURN CODE OF 8                                               * 06000017
*   (2)RECOVERABLE EOV ON CKPT DATA SET- XCTL TO IGC0206C             * 06200017
*   (3)I/O ERROR- XCTL TO IGC0N06C WITH RETURN CODE OF 12             * 06400017
*                                                                     * 06600017
*                                                                     * 06800017
         EJECT                                                          07000017
*                                                                       07200017
*       THIS LOAD OF CHKMAIN WRITES OUT THE FOLLOWING                   07400017
*       CONTROL BLOCKS.                                                 07600017
*                                                                       07800017
*                                            CODE      LENGTH           07880017
*                                            IN HEX    IN BYTES         07960017
*                                                                       08040017
*        DQE   DESCRIPTOR QUEUE ELEMENT        7          16            08120017
*        LLE   LOAD LIST ELEMENT                                        08200017
*              LLE WITH CDE IN JPA             A           8            08280017
*              LLE WITH CDE IN LPA             E           8            08360017
*        PQE   PARITION QUEUE ELEMENT          4          32            08440017
*              PQE WITH FBQE                   3          32            08520017
*        PRB   PROGRAM REQUEST BLOCK                                    08600017
*              PRB WITH CDE IN JPA             B          32            08680017
*              PRB WITH CDE IN LPA             C          32            08760017
*              PRB WITH NO CDE (SYNCH)         5          32            08840018
*        SCB   STAE CONTROL BLOCK             11          16     A37977 08920020
*        SPQE  SUB-POOL QUEUE ELEMENT          6           8            09000017
*        STAE  TCB STAE                        D           4     A37977 09050020
*        SVRB  SUPERVISOR REQUEST BLOCK                                 09080017
*              RESIDENT SVRB                  1F         FROM           09160017
*              TRANSIENT SVRB                 1E       RBSIZE BYTE      09240017
*        USER  USER FIELD IN TCB               F           4            09320017
*                                                                       09400017
*        ORDER IN WHICH CONTROL BLOCKS ARE WRITTEN OUT           A37977 09450020
*        (READ ACROSS)                                           A37977 09460020
*                                                                A37977 09470020
*        PQE     SPQE         DQE    RB     LLE    TCBNSTAE      A37977 09500020
*        SCB     TCBUSER      CDE    TCBFIELDS     G.P. REGS     A37977 09550020
*        DEB     IRB          F.P. REGS            TIOT          A37977 09560020
         SPACE 2                                                        09600018
IGC0G06C CSECT                                                          09800017
*3050004000,010000,088400,096000-097000,116000,132000,168000,182000,    09820018
*    192000,198000,214000,224000-231000,234000,248000,257000,           09840018
*    266000-268000,270000,278000,294000,308000,310000,319000-338200,    09860018
*    346000,349500,352800-354000,359000,366000-368000,374000,382000,    09880018
*    386000,388000,392000,408000-432000,434000,456000-460000,462000,    09900018
*    472000,482000-496000,508000,514000-526000,532000-575000,           09920018
*    614000-615000,630000-632000,680000,686300,904000-910000            09940018
*470500                                                           M3721 09950019
*089200,390370-390800,390920-391840                              A37977 09952020
*0417604000,622000-636000,652000-656000                          A38515 09956021
         EJECT                                                          09960018
C7A1     BALR  RB,N0          ESTABLISH BASE                            10000017
         USING *,RB                                                     10200017
         USING CHKWA,RC                                                 10400017
         USING IHADCB,R2                                                10500017
         USING TCBSECT,R5                                               10550018
         L     R2,CKDCBAD     CHKPT. DCB ADDRESS                        10600017
         LA    R7,C13B5       ADDRESS OF SYNAD ROUTINE                  10800017
         ST    R7,CMSYSA      STORE ADDRESS IN W.A.                     11000017
         MVC   SYNADCB(N3),CMSYS1       AND CHKPT DCB                   11200017
         L     R5,CKTCBAD     TCB ADDRESS                               11400017
         DROP  R2                                                       11500017
         MVC   CKMN40(N8),CKMN32A       SET UP XCTL PARM LIST           11600018
         LA    R4,SURL        BUFFER LENGTH.                            11800017
         STH   R4,CKLNGTH1    INITIALIZE DECB1                          12000017
         ST    R4,CKBFLWA     INIT.NO. OF REMAINING                     12100017
*                             BYTES IN BUFFER                           12200017
         L     R8,CKBFOFST    BUFFER ADDRESS                            12400017
         AR    R8,RC                                                    12600017
         ST    R8,CKBFSTAD    INIT. STARTING ADDRESS OF BUFFER          12800017
         ST    R8,CMBUF       SAVE BUFFER ADDRES                        13000017
*                                                                       13250017
*        ROUTINE TO PROCESS PQE'S                                       13300017
*                                                                       13350017
         L     R3,TCBPQE      DUMMY PQE                                 13400017
         L     R3,PQENXT(R3)  GET FIRST PQE                             13600017
C7B1A    EQU   *                                                        13800017
         C     R3,N0(R3)      ANY FBQES                                 14000017
         BNE   C7B1B               BRANCH IF YES                        14200017
         MVI   CKCODE,N4      PQE WITH NO FBQE PTR CODE                 14400017
         B     C7B1C          NO  FBQES                                 14600017
C7B1B    EQU   *                                                        14800017
         MVI   CKCODE,N3      PQE WITH FBQE PTRS CODE                   15000017
C7B1C    EQU   *                                                        15200017
         MVI   CKLNT,N32      PQE=LENGTH 32                             15400017
         BAL   RD,C13A1       GO TO WRITE SUP RECORDS ROUTINE           15600017
         L     R3,PQENXT(R3)       GET NEXT PQE                         15800017
         LTR   R3,R3          Q. LAST PQE                               16000017
         BNE   C7B1A          PROCESS NEXT FBQE                         16060017
         EJECT                                                          16090018
*                                                                       16120017
*        ROUTINE TO PROCESS SPQE'S AND DQE'S FOR                        16180017
*              (1)  L-SHAPED PROGRAM                                    16240017
*              (2)  INITIATOR                                           16300017
*              (3)  PROBLEM PROGRAM                                     16360017
*                                                                       16420017
*                                                                       16480017
         L     R5,TCBOTC      INITIATOR'S TCB                           16580017
         LA    R6,N2          SET COUNT TO 2                            16780018
C7A4     EQU   *                                                        17000017
         L     R5,TCBOTC      GET ORIGINATING TCB                       17200017
C7B3     EQU   *                                                        17400017
         L     R3,TCBMSS      GET SPQE POINTER                          17600017
C7D3     EQU   *                                                        17800017
         LA    R3,N0(R3)                                                18000017
         LTR   RA,R3          Q.  LAST SPQE      ALSO SAVE R3           18200018
         BZ    C7H6           GO TO   PP TCB                            18400017
         MVI   CKCODE,N6      SPQE CODE = 6                             18600017
         MVI   CKLNT,N8       LENGTH=8                                  18800017
         BAL   RD,C13A1       WRITE SUP RECORDS ROUTINE                 19000017
         TM    N0(R3),X80     Q. OWNED SPQE                             19400017
         BO    C7H4           NO- SKIP CODE TO SAVE DQES.               19600017
C7F3     EQU   *                                                        19700018
         L     R3,SPQEDQE(R3) YES  GET DQE POINTER                      19800018
         LA    R3,N0(R3)                                                20000017
         LTR   R3,R3          Q.  ANY DQE'S                             20200017
         BZ    C7H4           NO                                        20400017
         MVI   CKCODE,N7      DQE = CODE 7                              20600017
         MVI   CKLNT,N16      LENGTH =16                                20800017
         BAL   RD,C13A1       TO OUTPUT BUFFER HANDLER                  21000017
         B     C7F3           SAVE DQES                                 21200017
C7H4     EQU   *                                                        21300018
         L     R3,N0(RA)      RESTORE R3                                21400018
         B     C7D3           PROCESS NEXT SPQE                         21600017
C7H6     EQU   *                                                        21800017
         L     R5,CKTCBAD     GET PP TCB                                22000017
         BCTR  R6,N0          DECREMENT COUNT                           22200017
         LTR   R6,R6          Q. HAVE INITIATOR SPQE'S BEEN SAVED       22500018
         BH    C7A4           A. NO -GO TO SAVE THEM                    22800018
         BE    C7B3           A. YES SAVE P/P SPQE'S                    23100018
         EJECT                                                          23300018
*                                                                       23600017
*                                                                       23800017
*        ROUTINE TO SAVE PRB'S                                          24000017
*                                                                       24200017
*                                                                       24400017
C10A1    EQU   *                                                        24600017
         L     R3,N0(R5)      CHKPT SVRB                                25000017
         USING RBSECT,R3                                                25200017
         L     R3,NEXTRB      GET FIRST PRB                             25400017
         LA    R2,C10H4       RETURN ADDR                               25600017
C10A2    EQU   *                                                        25700018
         TM    RBSTAB,TRANS   Q.  SVRB FOR TRANS SVC                    25800017
         BO    C10J1          YES                                       26000017
         TM    RBSTAB,RBFTP   Q.  SVRB FOR TYPE 2 SVC                   26200017
         BO    C10K1          YES                                       26400017
         LH    RF,PRBCDE      CODE FOR PRB WITH CDE IN JPA              26500018
         LA    RD,N1(RF)      CODE FOR PRB WITH CDE IN LPA              26600018
         L     R4,RBEP        GET THE CDE FOR THIS PRB                  27000018
         LA    R4,N0(R0,R4)   CLEAR HI ORDER BYTE                       27200017
         LTR   R4,R4          IS THERE A CDE FOR THIS PRB               27400017
         BP    C10D1          YES                                       27600017
         MVI   CKCODE,N5      CODE FOR SYNCHED PRB IS 5                 27800018
         B     C10K2          TO SVRB ROUTINE                           28000017
C10D1    EQU   *                                                        28200017
         L     R7,TCBJPQ      FIRST CDE OFF TCB                         28400017
         USING CDESECT,R7                                               28600017
         LA    R6,N1          FIRST CDE INDICATOR                       28800017
         LA    R7,N0(R7)      CLEAR HI BYTE                             29000017
C10F1    EQU   *                                                        29100017
         CR    R7,R4          Q.  CDE OFF TCB = CDE OFF PRB             29200017
         BE    C10F2          CDE IN JOB PACK AREA                      29400018
         L     R7,CDATTR1          NEXT CDE OFF TCB                     29600017
         LA    R7,N0(R7)                                                29800017
         LTR   R7,R7          Q.  LAST CDE                              30000017
         BZ    C10H1          YES                                       30200017
         LA    R6,N1(R6)      INCREMENT THE COUNTER                     30400017
         B     C10F1          PROCESS NEXT CDE                          30600017
         EJECT                                                          30680018
*                                                                       30760018
*        SPECIAL HANDLING FOR SVRB'S                                    30840018
*                                                                       30920018
C10J1    EQU   *                                                        30930018
         L     R6,CVTPTR      GET ADR. OF CVT                           30940018
         USING CVTSECT,R6                                               30950018
         L     R6,CVTABEND    GET ADR. OF 2NDARY CVT                    30960018
         USING SCVTSECT,R6                                              30970018
         L     R6,SCVTTACT    GET ADR. OF TRANS. CONTROL TABLE          30980018
         DROP  R6                                                       30990018
         AH    R6,RBTABNO     ADR OF TACT ENTRY FOR SVRB                31000018
         L     R6,N0(R6)      ADR OF BEGINNING OF XSNT AREA             31010018
         LA    R6,N0(R6)      CLEAR HI BYTE                             31020018
         L     R4,OLDPSW5     INSTR CTR FROM PSW IN SVRB                31030018
         SR    R4,R6          GET RELATIVE OFFSET                       31040018
*                             INTO TRANSIENT AREA                       31050018
         ST    R4,CMSYSA      SAVE RELATIVE OFFSET                      31060018
         MVI   CKCODE,N30     CODE FOR XSNT SVRB IS 30                  31070018
         B     C10K2          TO GET SIZE AND SET UP BUFFER             31080018
C10K1    EQU   *                                                        31090018
         MVI   CKCODE,N31     RESIDENT SVC                              31100018
C10K2    EQU   *                                                        31110018
         IC    R4,RBSIZE                                                31120018
         SLL   R4,N3          GET LENGTH OF SVRB,                       31200017
         STC   R4,CKLNT       INCLUDING EXTENDED SAVE AREA              31400017
         BAL   RD,C13A1       WRITE OUT SUR                             31600017
         BR    R2             RETURN TO CALLER                          31800017
*                                                                       33840017
*                                                                       33860017
*        INTERFACE WITH OUTPUT BUFFER ROUTINE SET UP FOR                33880017
*        PRB OR LLE WITH CDE IN LINK PACK AREA                          33900017
*                                                                       33920017
*        REGISTER INPUT                                                 33940017
*                                                                       33960017
*        R2    RETURN ADDRESS                                           33980017
*        R3    ADDRESS OF BLOCK TO BE WRITTEN                           34000017
*        R6    NUMBER OF BLOCK                                          34020017
*        RD    LENGTH AND CODE FOR BLOCK ADDRESSED IN R3                34040017
*                                                                       34060017
*        ON RETURN RD WILL NOT CONTAIN ORIGINAL INPUT                   34080017
*                                                                       34100017
C10H1    EQU   *                                                        34200017
         LA    RD,LPACDE(RD)  INCREMENT LENGTH BY 12 BYTES TO           34260018
*                             ACCOMMODATE MODULE NAMES                  34320018
*                             AND ENTRY POINTS                          34360018
         STH   RD,CKLNT       PRB OR LLE WITH CDE IN LPA                34400017
         BAL   RD,C13A1       WRITE OUT SUR                             34800017
         BR    R2             RETURN                                    34830017
         EJECT                                                          34840018
*                                                                       34860017
*                                                                       34890017
*        INTERFACE WITH OUTPUT BUFFER ROUTINE SET UP FOR                34920017
*        PRB OR LLE WITH CDE IN JOB PACK AREA                           34940018
*        TCB STAE AND USER FIELDS AND SCB'S                             34960018
*                                                                       34980017
*        REGISTER INPUT                                                 35010017
*                                                                       35040017
*        R2    RETURN ADDRESS                                           35070017
*        R3    ADDRESS OF BLOCK TO BE WRITTEN                           35100017
*        R6    NUMBER OF BLOCK                                          35130017
*        RF    LENGTH AND CODE FOR BLOCK ADDRESSED IN R3                35140018
*                                                                       35160017
*        ON RETURN RD WILL NOT CONTAIN ORIGINAL INPUT                   35190017
*                                                                       35220017
C10F2    EQU   *                                                        35250017
         STH   RF,CKLNT       STORE CODE AND LENGTH.                    35350018
         BAL   RD,C13A1       WRITE OUT SUR                             35600017
         BR    R2             RETURN TO CALLER                          35800017
*                                                                       35980017
*        UPDATES PRB POINTER                                            36060017
*                                                                       36140017
C10H4    EQU   *                                                        36220017
         L     R3,NEXTRB      GET NEXT PRB ON CHAIN                     36300017
         LA    R3,N0(R3)      CLEAR HIGH BYTE                           36380017
         CR    R3,R5          Q.  LAST PRB                              36460017
         BNE   C10A2          A.  NO   LOOP TO PROCESS                  36660018
*                                                                       37000017
*                                                                       37200017
*        ROUTINE TO SAVE LLE'S                                          37400018
*                                                                       37600017
*                                                                       37800017
         L     R3,TCBLLS      FIRST LLE OFF TCB                         38000017
C11H4    EQU   *                                                        38200018
         LTR   R3,R3          Q.  ARE THERE ANY LLE'S                   38400017
         BNH   C11H5               DO STAE AND USER FIELD               38500018
         L     R4,LLECOUNT(R3)     FIRST CDE OFF LLE                    38600018
         LA    R4,N0(R0,R4)                                             38630018
         LA    RF,LLECOD     CODE= 10 FOR LLE                           38660018
         LA    RD,LLECDE     CODE= 14 FOR LLE WITH CDE IN LPA           38690018
         BAL   R2,C10D1            FIND THE CDE                         38720018
         L     R3,LLECHAIN(R3)     GET THE NEXT LLE                     38750018
         B     C11H4               PROCESS IT                           38780018
         EJECT                                                          38810018
*                                                                       38840018
*        ROUTINE TO SAVE TCB STAE AND USER FIELDS AND SCB'S             38870018
*                                                                       38900018
C11H5    EQU   *                                                        39000017
         LA    R8,C10F2       QUEUE POSITIONAL RTN ADRS FOR PRB         39004018
         LA    R3,TCBNSTAE    GET ADR OF STAE FIELD                     39008017
         LA    RF,STAECODE    GET CODE FOR STAE                         39016017
         BALR  R2,R8          WRITE OUT STAE FIELD                      39024017
         L     R3,TCBNSTAE    GET ADR OF FIRST SCB               A37977 39026020
C11J1    EQU   *                                                 A37977 39042020
         LA    R3,N0(R3)      CLEAR FLAG BYTE                    A37977 39044020
         LTR   R3,R3          IF NO SCB'S                        A37977 39049020
         BZ    C11H7          PROCESS USER FIELD                 A37977 39056020
         LA    R6,N1          INITIALIZE POSITIONAL POINTER      A37977 39063020
         CLC   N1(N3,R5),SCBRB(R3)  Q.  IS IT THE FIRST RB       A37977 39072020
         BE    C11J4                A.  YES PUT IT IN BUFFER     A37977 39074020
         L     R7,N0(R5)            A.  NO GET ADDR.OF NEXT RB   A37977 39076020
*                                                                A37977 39078020
         USING RBSECT,R7                                         A37977 39080020
*                                                                A37977 39082020
C11J2    EQU   *                                                        39086017
         TM    STAB2,LASTRB        Q.  IS THIS THE LAST RB       A37977 39088020
         BO    C11J3               A.  YES PUT SCB IN BUFFER     A37977 39090020
         LA    R6,N1(R6)           INCREMENT POSITONAL PTR       A37977 39090420
         CLC   RBLINK(N3),SCBRB(R3)   Q.  IS IT THIS RB          A37977 39092020
         BE    C11J4               A.  YES PUT SCB IN BUFFER     A37977 39094020
         L     R7,NEXTRB           A.  NO GET NEXT RB            A37977 39096020
         B     C11J2               AND PROCESS IT                A37977 39098020
C11J3    EQU   *                                                 A37977 39104020
         SR    R6,R6               SHOW RB NOT ON ACTIVE QUEUE   A37977 39104420
C11J4    EQU   *                                                 A37977 39104820
         MVI   CKLNT,SCBSIZE       SET UP LENGTH AND CODE        A37977 39106020
         MVI   CKCODE,SCBCODE      FOR BUFFER ROUTINE            A37977 39108020
         BAL   RD,C13A1            LINK TO BUFFER HANDLER        A37977 39108420
         L     R3,N0(R3)           GET NEXT SCB                  A37977 39108820
         B     C11J1               AND PROCESS IT                A37977 39110020
C11H7    EQU   *                                                        39185017
         LA    R3,TCBUSER          GET ADRS OF USER FIELD               39186017
         LA    RF,USERCODE         GET CODE FOR USER FIELD              39188017
         BALR  R2,R8               AND WRITE IT OUT                     39190017
*                                                                       39240018
*        XCTL  INTERFACE                                                39290018
*                                                                       39340018
C11H6    EQU   *                                                        39400017
         LR    R1,RC          PUT W.A. ADDR IN PARM REG                 39500018
         LA    RF,CKMN40           SET UP XCTL PARM LIST                39600017
         ST    RF,CK40XCTL                                              39800017
         LA    RF,CK40XCTL                                              40000017
         XCTL  SF=(E,(15))   XCTL TO NEXT LOAD                          40400017
         EJECT                                                          41400018
*                                                                       43600017
*                                                                       43800017
*        ROUTINE TO HANDLE OUTPUT BUFFER                                43820017
*                                                                       43840017
*                                                                       43860017
*        REGISTER INPUT TO THIS ROUTINE                                 43880017
*                                                                       43900017
*        R3    ADR OF BLOCK TO BE WRITTEN                               43920017
*        R6    NUMBER OF BLOCK FOR PRB'S AND LLE'S                      43940017
*        RD    RETURN ADR                                               43960017
*                                                                A37977 43970020
*        POSITIONAL POINTERS ARE MOVED FROM THE REGISTER         A37977 43972020
*        SAVE AREA (CKOBHSAV) TO THE POINTER FIELD               A37977 43974020
*        FIELD IN THE CONTROL BLOCK IN THE BUFFER                A37977 43976020
*                                                                       43980017
*                                                                       44000017
*        REGISTERS R2 THRU RD ARE SAVED ON ENTRY AND RESTORED           44020017
*              BEFORE RETURNING                                         44040017
*                                                                       44060017
*                                                                       44080017
*                                                                       44200017
*                                                                       44400017
C13A1    EQU   *                                                        44600017
         STM   R2,RD,CKOBHSAV  SAVE GPRS.                               44800017
         SR    R4,R4          CLEAR REGISTER 4                          45000017
         LA    RD,CKREGSAV                                              45200017
         IC    R4,CKLNT       PLACE LENGTH INTO REG 4                   45400017
         L     R6,CKBFLWA     REMAINING BYTES IN BUFFER                 46400017
         LA    R4,N1(R4)      ALLOW FOR CODE BYTE                       46600017
         L     RA,CKBFSTAD    NEXT BYTE IN BUFFER TO BE FILLED          46800017
         CR    R4,R6        Q. ARE THERE ENOUGH BYTES LEFT FOR SUR      47000017
         BL    C13C1          YES MOVE SUR TO BUFFER              M3721 47050019
         BAL   R7,C13B2       NO THEN WRITE OUT BUFFER                  47100018
         ST    R8,CKBFSTAD    INITIALIZE TO START OF BUFFER             47150018
         LR    RA,R8                                                    47200018
         LA    R6,SURL        LENGTH OF BUFFER                          47250018
         ST    R6,CKBFLWA     SAVE BUFFER LENGTH                        47320018
C13C1    EQU   *                                                        47400017
         MVC   N0(N1,RA),CKCODE                                         47600017
         SH    R4,CMTWO                                                 47800017
         EX    R4,CKMVTOBF    EXECUTE MVC INSTRUCTION                   48000017
         LA    R7,N1          CODE FOR CDE IN LPA                       48100018
         CLI   CKCODE,CODEC   Q. PRB WITH CDE IN LPA                    48200018
         BE    CKPRBC         YES BRANCH TO PROCESS                     48300018
         CLI   CKCODE,CODEE   Q. LLE WITH CDE IN LPA                    48400018
         BE    CKLLEC         YES BRANCH TO PROCESS                     48500018
         SR    R7,R7          NO CDE IN LPA                             48600018
         CLI   CKCODE,CODEB   Q  PRB WITH CDE IN JPA                    48700018
         BE    CKPRB          YES BRANCH TO PROCESS                     48800018
         CLI   CKCODE,CODEA   Q. LLE WITH CDE IN JPA                    48900018
         BE    CKLLE          YES BRANCH TO PROCESS                     49000018
         CLI   CKCODE,SCBCODE     Q.  STAE CONTROL BLOCK         A37977 49050020
         BE    CKSCB              A.  YES SET UP RB PTR          A37977 49060020
         CLI   CKCODE,CODE1E  Q TRANSIENT SVRB                          49100018
         BNE   C13D1          NO ADDITIONAL PROCESSING                  49200018
*                             IS NOT NECESSARY                          49300018
         MVC   N22(N3,RA),CMSYS1   SET RELATIVE ENTRY                   49400018
*                                  OFFSET IN XSNT AREA                  49500018
C13D1    AH    R4,CMTWO       ADJUST NEW ADDRESS                        49800017
         AR    RA,R4          ADJUST NEW START ADDRESS FOR NEXT MOVE    50000017
         ST    RA,CKBFSTAD    STORE ADDRESS                             50200017
         SR    R6,R4          ADJUST NEW REMAINING BYTE AMOUNT          50400017
         ST    R6,CKBFLWA     STORE IN WORK AREA                        50600017
         LM    R2,RD,CKOBHSAV  RESTORE GPRS.                            51000017
         BR    RD             RETURN TO CALLER                          51200017
CKMVTOBF MVC   N1(N1,RA),N0(R3)                                         52800017
*                                                                       53000017
CKPRBC   EQU   *                                                        53300018
         L     RE,N12(R3)          GET CDE                              53600018
         MVC   N33(N12,RA),N8(RE)  ADD NAME AND ENTRY POINT             53900018
CKPRB    EQU   *                                                        54200018
         STC   R7,N15(RA)          CDE INDICATOR                        54500018
         MVC   N16(N1,RA),CHSAV6   POSITIONAL POINTER                   54800018
         B     C13D1               ADJUST POINTERS AND RETURN           55100018
CKLLEC   EQU   *                                                        55400018
         L     RE,N4(R3)           GET CDE                              55700018
         MVC   N9(N12,RA),N8(RE)   ADD NAME AND ENTRY POINT             56000018
CKLLE    EQU   *                                                        56300018
         STC   R7,N7(RA)           CDE INDICATOR                        56600018
         MVC   N8(N1,RA),CHSAV6    POSITIONAL POINTER                   56900018
         B     C13D1               ADJUST POINTERS AND RETURN           57200018
CKSCB    EQU   *                                                        57250020
         MVC   N16(N1,RA),CHSAV6    POSITIONAL POINTER           A37977 57350020
         B     C13D1               ADJUST POINTERS AND RETURN    A37977 57400020
         EJECT                                                          57505017
*                                                                       57510017
*                                                                       57515017
*        ROUTINE TO WRITE OUT SUPERVISOR RECORDS                        57520017
*                                                                       57525017
*                                                                       57530017
*        REGISTER INPUT TO THIS ROUTINE                                 57535017
*                                                                       57540017
*        RA    POINTS TO FIRST UNUSED BYTE IN OUTPUT BUFFER             57545017
*        R7    RETURN ADDRESS FOR NORMAL COMPLETION                     57550017
*                                                                       57555017
*                                                                       57560017
*        REGISTER OUTPUT FROM THIS ROUTINE                              57565017
*                                                                       57570017
*        R8    POINTS TO START OF FREE BUFFER AREA                      57575017
*                                                                       57580017
C13B2    MVI   N0(RA),N0      SET END OF SUR BYTE                       57600017
         L     R8,CKBFOFST         INIT. START OF BUFFER                58200017
         AR    R8,RC                                                    58400017
         L     R5,CKDCBAD     DCB ADDRESS                               58600017
*                                                                       58700017
         WRITE CKDECB1,SF,(5),(8),MF=E                                  58800017
*                                                                       59000017
         CHECK CKDECB1                                                  59200017
*                                                                       59400017
         TM    CKFLAG1,CKTAPE   Q. CHKPT DATA SET ON TAPE               59600017
         BZ    CMEOVDA            NO THEN CHECK FOR EOV ON DA           59800017
         L     RF,CKTSTEOV                                              60000017
         CLC   N0(N4,RF),CKEOVCMR       DID EOV OCCUR                   60200017
         BE    CMTIOTST            NO - GO CHECK FOR I/O ERRS    A38515 60280021
         MVI   CKRETCOD+N1,X'14'   YES - SET EOV ERR CODE - 14   A38515 60360021
         LA    RF,CKTPEOV     SET UP FOR TAPE ERROR              A38515 60440021
         B     CMEOVER             GO TO EXIT ROUTINE            A38515 60520021
CMTIOTST EQU   *                                                        60600017
         CLI   CKRET1,CKIOERR      Q.  I/O ERROR                        60800017
         BCR   NOTEQ,R7                 A.  NO  RETURN                  61000017
CKEROUT  EQU   *                                                        61200017
         MVI   CKXCTL,CHARN        TO GIVE CONTROL TO I/O               61600017
*                                       RESUME                          61700017
         B     C11H6                    XCTL INTERFACE                  61800017
CMEOVDA  EQU   *                                                        63800017
         USING IHADCB,RF                                                64000017
         L     RF,CKDCBAD    GET ADR. OF CHKPT DCB                      64200017
         L     RF,DCBDEBAD   GET ADR. OF CHKPT DEB                      64400017
         DROP  RF                                                       64600017
         CLC   DEBNMEXT(N1,RF),CKTSTEOV    Q. EOV  ON DA DEVICE         64800017
         BE    CMTIOTST                NO -  CONTINUE PROCESSING        65000017
         MVI   CKRET1,CKPGMERR     SET RETURN CODE TO 8          A38515 65100021
         LA    RF,CKERIO7     INDICATE DISK ERROR                A38515 65300021
CMEOVER  EQU   *                                                 A38515 65500021
         STH   RF,CKMSGCOD                                              65800017
         B     CKEROUT                  XCTL  FOR IORESUME              66000017
*                                                                       66200017
*                                                                       66400017
*        CHECKMAIN SYNAD ROUTINE                                        66600017
*                                                                       66800017
C13B5    EQU   *                                                        67000017
         LA    R0,X317                                                  67200017
         STH   R0,CKMSGCOD                                              67400017
         MVI   CKRETCOD+N1,CKIOERR      I/O ERROR                       67600017
         BR    RE                       RETURN TO CALLER                67800017
         EJECT                                                          67900018
*                                                                       68050017
*        GENERAL CONSTANTS                                              68100017
*                                                                       68150017
CKMN32A  DC    CL8'IGC0H06C'            XCTL NAME                       68200017
CMTWO    DC    H'2'                     FOR CHANGING                    68600017
PRBCDE   DC    X'200B'        PRB WITH CDE IN JPA                       68630018
*                                                                       68660017
*        GENERAL EQUATES                                                68690017
*                                                                       68720017
USERCODE EQU   X'040F'             TCB USER CODE                        68750017
STAECODE EQU   X'040D'             TCBSTAE CODE                         68800017
LLECOD   EQU   X'080A'             LOAD LIST ENTRY                      68900017
LLECDE   EQU   X'080E'             LLE WITH CDE IN LPA                  69000017
CKERIO7  EQU   X'031B'             INDICATES EOV ERROR                  69100017
CKTPEOV  EQU   X'031C'        TAPE EOV ERROR                     A38515 69120021
LPACDE   EQU   X'0C00'             TO INCREMENT BLOCK LENGTH            69150018
X317     EQU   X'317'              SYNAD CONSTANT                       69200017
SCBSIZE  EQU   16                  SCB SIZE                      A37977 69210020
SCBRB    EQU   13                  RB PTR. IN SCB                A37977 69250020
X80      EQU   X'80'               MASK FOR OWNED SPQE                  69300017
CHARN    EQU   C'N'                FOR XCTL ON UNRECOVERABLE ERROR      69400017
CHAR2    EQU   C'2'                FOR EOV XCTL                         69500017
LASTRB   EQU   X'80'               INDICATES LAST RB ON CHAIN           70250017
EQ       EQU   8                   MASK FOR BRANCH ON EQUAL             70270017
NOTEQ    EQU   7                   MASK FOR BRANCH ON NOT EQUAL         70290017
DEBNMEXT EQU   16                  NUMBER EXTENTS FOR DEB               70310017
SURL     EQU   200                 LENGTH OF SUR                        70330017
SCBCODE  EQU   X'11'               STAE CONTROL BLOCK            A37977 70332020
CODEA    EQU   X'0A'               LLE WITH CDE IN JPA                  70333018
CODEB    EQU   X'0B'               PRB WITH CDE IN JPA                  70336018
CODEC    EQU   X'0C'               PRB WITH CDE IN LPA                  70339018
CODEE    EQU   X'0E'               LLE WITH CDE IN LPA                  70342018
CODE1E   EQU   X'1E'               TRANSIENT SVRB                       70345018
          EJECT                                                         70350017
*                                                                       70400017
CKTSTEOV EQU CKUNIT                                                     70800017
CKEOVCMR EQU CKUNIT+4                                                   71000017
CMADEOV  DS    F    SAVE AREA FOR INFORMATION NEEDED                    71200017
CMNEOV   DS    F    TO TEST IF EOV OCCURRED                             71400017
CKBFLWA  DS    F              REMAINING BYTES IN THE BUFFER             71600017
CKBFSTAD DS    F              NEXT BYTE IN BUFFER TO BE FILLED          71800017
CMBUF    DS    F              BUFFER ADDRESS                            72000017
CKMN40   DS    2F           CHECKMAIN                                   72200017
CK40XCTL DC    F'0'    XCTL  PARM                                       72400017
SWITCH   EQU   CK40XCTL     SWITCH                                      72600017
CKOBHSAV DS    12F      SAVE AREA                                       72800017
CKLNT    DS    CL1            SUR LENGTH                                73000017
CKCODE   DS    CL1            SUR CODE                                  73200017
CMSYSA   DS    F     SYSTEM                                             73400017
CMSYS1   EQU   CMSYSA+1                                                 73420017
CHSAV6   EQU   CKOBHSAV+19         POSITIONAL POINTER FOR               73440017
*                                  LLE AND PRB INPUT IN REG 6           73460017
CKXCTL   EQU   CKMN40+4            ALLOWS FOR CHANGE OF XCTLEE          73480017
CKRET1   EQU   CKRETCOD+1                                               73500017
         EJECT                                                          73520017
         IHBABCTL                                                       73600017
         EJECT                                                          73620017
*                                                                       73640017
*        FURTHER DEFINITIONS FOR RB DSECT                               73660017
*                                                                       73680017
NEXTRB   EQU   RBLINK-1       FULL WORD BOUNDARY FOR LINK FIELD         73700017
OLDPSW5  EQU   RBOPSW+4       SECOND WORD OF PSW IN RB                  73720017
STAB2    EQU   RBSTAB+1            SECOND RB STAB BYTE                  73740017
TRANS    EQU   X'D0'               MASK FOR TRANSIENT SVC               73760017
*                                                                       73800017
*     OFFSETS FOR PQE                                                   74000017
*                                                                       74200017
FWDPTR   EQU   0                                                        74400017
BCKPTR   EQU   4                                                        74600017
PQENXT   EQU   8                                                        74800017
PQEPREV  EQU   12                                                       75000017
PQETCB   EQU   16                                                       75200017
PQESTAD  EQU   20                                                       75400017
PQERGSZ  EQU   24                                                       75600017
         EJECT                                                          75800017
        DCBD    DSORG=(PO,PS),DEVD=(DA,TA)                              76000017
SYNADCB  EQU   DCBSYNAD+1                                               76200017
         EJECT                                                          76400017
         SPACE                                                          83200017
*                                                                       83800017
*    EQUATES USED FOR DISPLACEMENTS                                     84400017
*                                                                       85000017
N0       EQU   0                                                        85600017
N1       EQU   1                                                        86200017
N2       EQU   2                                                        86500018
N3       EQU   3                                                        86800017
N4       EQU   4                                                        87400017
N5       EQU   5                                                        87700018
N6       EQU   6                                                        88000017
N7       EQU   7                                                        88600017
N8       EQU   8                                                        89200017
N9       EQU   9                                                        89800017
N12      EQU   12                                                       91600017
N15      EQU   15                                                       92200017
N16      EQU   16                                                       92800017
N22      EQU   22                                                       94000017
N30      EQU   30                                                       94600017
N31      EQU   31                                                       95200017
N32      EQU   32                                                       95800017
N33      EQU   33                                                       96400017
.LIB2BA1 ANOP                                                           96450000
         END                                                            98200017
./  ADD  SSI=82070168,NAME=IHJQCP32
         TITLE 'IHJQCP32 CHECKMAIN 3 ROUTINE - IGC0H06C'                00370002
*                                                                       00380000
* STATUS                                                                00390000
*                                                                       00392000
* FUNCTION                                                              00394000
*                                                                       00396000
*    CHECKMAIN 3 CREATES A RECORD (SUR) OF CERTAIN USER RELATED         00398000
*    AND DATA MANAGEMENT CONTROL BLOCKS AND OUTPUTS THIS                00398400
*    RECORD TO THE CHECKPOINT DATA SET. FOLLOWING ARE THE        Y02076 00398802
*    RECORDS, LENGTHS, AND ASSOCIATED SUR CODES IN THE ORDER     Y02076 00399002
*    THEY ARE BUILT AND WRITTEN TO THE CHECKPOINT DATA SET BY    Y02076 00399102
*    THIS MODULE:                                                Y02076 00399202
*                                                                Y02076 00399402
*    RECORD TYPE             LENGTH      SUR CODE                Y02076 00399602
*                                                                Y02076 00399702
*    TCBUSER FIELD              4         X'0F'                  Y02076 00399802
*    TCBCAUF FIELD              4         X'0F'                @ZA32921 00399937
*    TCBFSA FIELD               4         X'0F'                  Y02076 00400037
*    CHECKPOINT DCB ADDR        4         X'0F'                  Y02076 00400237
*    CHECKPOINT DCB SYNAD       4         X'0F'                  Y02076 00400302
*    CHECKPOINT DCB BLKSIZE     2         X'0F'                  Y02076 00400402
*    REGISTERS (G.P.)          64         X'10'                  Y02076 00400502
*    DEB (NON-ISAM)          VARIABLE     X'80'                  Y02076 00400602
*    DEB (ISAM)              VARIABLE     X'81'                  Y02076 00400702
*    DEB (DUMMY)             VARIABLE     X'82'                  Y02076 00400802
*    IRB                     VARIABLE     X'12'                  Y02076 00401002
*    DEB EXTENSION           VARIABLE     X'20'                  Y02076 00401102
*    REGISTERS (FLOATING)      32         X'13'                  Y02076 00401202
*    TIOT                    VARIABLE     X'14'                  Y02076 00401302
*    DSAB RECORD (NON-LAST)    22         X'04'                  Y02076 00401402
*    DSAB RECORD (LAST)        22         X'44'                  Y02076 00401502
*    SPIE SSCR               VARIABLE    X'0102'                 Y02076 00401702
*                                                                       00401902
* ENTRY POINTS                                                          00402102
*                                                                       00402302
*    IGC0H06C -ENTERED FROM THE CHECKMAIN 2 ROUTINE                     00402502
*                                                                       00402702
* INPUT                                                                 00416600
*    GPR12- ADDRESS OF CHECKPOINT WORK AREA                             00426600
*                                                                       00428600
* OUTPUT                                                                00430600
*    GPR1-CONTAINS ADDRESS OF CHKWA                                     00432600
*                                                                       00433000
* EXTERNAL REFERENCES                                                   00433100
*    NONE                                                               00433200
*                                                                       00438800
* EXITS, NORMAL                                                         00440800
*    TO I/O RESUME TO INDICATE NORMAL COMPLETION OF                     00442800
*    THE CHECKMAIN FUNCTIONS                                            00443200
*                                                                       00443600
* EXITS, ERROR                                                          00444000
*    TO RESUME I/O ROUTINE (IGC0N06C) VIA XCTL TO                       00444102
*    PROVIDE ITS NORMAL FUNCTIONS AND TO PASS AN ERROR                  00444200
*    CODE TO THE CHECKPOINT EXIT ROUTINE INDICATING THAT                00444300
*    AN I/O ERROR HAS OCCURRED.                                         00458200
*    UPON EXIT THE PARAMETERS ARE AS FOLLOWS-                           00468200
*    GPR 1 - ADDRESS OF CHKWA                                           00470200
*    CHKWA - AN ERROR CODE OF X'0C' IS PASSED IN THE                    00470600
*             LAST BYTE OF THE CKRETCOD FIELD.                          00471000
*                                                                       00471400
*    2) TO RESUME I/O ROUTINE (IGC0N06C) VIA XCTL TO                    00471800
*    PROVIDE ITS NORMAL FUNCTIONS AND TO PASS AN ERROR                  00471900
*    CODE TO THE CHECKPOINT EXIT ROUTINE THAT AN                        00472000
*    UNRECOVERABLE EOV CONDITION (TWO RETRIES HAVE                      00472100
*    OCCURRED ON TAPE, OR THE DATA SET IS ON A DIRECT                   00476700
*    ACCESS DEVICE) HAS OCCURRED.                                       00478700
*    UPON EXIT THE PARAMETERS ARE THE SAME AS FOR CASE 1                00480700
*    EXCEPT THAT THE LAST BYTE OF THE CKRETCOD FIELD                    00481100
*    CONTAINS AN X'08'.                                                 00481200
*                                                                       00481300
*    3) TO CHECKPOINT HOUSEKEEPING ROUTINE (IGC0206C) TO                00481400
*    ATTEMPT REPROCESSING ON A NEW TAPE WHEN AN EOV                     00486000
*    HAS OCCURRED FOR THE FIRST TIME ON TAPE                            00488000
*                                                                       00490000
* TABLES/WORK AREAS                                                     00490400
*    CHKWA                                                              00490500
*                                                                       00490600
*    DCB   DCBDEBAD                                                     00490700
*    .     DCBSYNAD                                                     00512500
*    .     DCBMACRF                                                     00522500
*    .     DCBDSORG                                              Y02076 00522702
*                                                                       00532500
*    DEB   DEBDCBAD                                              Y02076 00534502
*    .     DEBNNEXT                                                     00541800
*    .     DEBAPPG                                                      00545800
*    .     DEBAPPAD                                              Y02076 00546002
*    .     DEBDEBAD                                              Y02076 00546202
*    .     DEBXSCL                                               Y02076 00546402
*    .     DEBFIEAD                                              Y02076 00546602
*    .     DEBFLGS1                                              Y02076 00546802
*    .     DEBIRBAD                                              Y02076 00547002
*    .     DEBLNGTH                                              Y02076 00547202
*    .     DEBXTNP                                               Y02076 00547402
*                                                                       00547800
*    DEBX  DEBXLNGH                                              Y02076 00548002
*                                                                       00548600
*    RB    RBIQE                                                        00549000
*    .     RBNEXAV                                                      00556300
*    .     RBREGSAVE                                             Y02076 00556502
*    .     RBSIZE                                                Y02076 00556702
*    .     RBSTAB2                                               Y02076 00556902
*                                                                       00558300
*    TCB   TCBUSER                                                      00560300
*    .     TCBTIO                                                       00562700
*    .     TCBDEB                                                       00563100
*    .     TCBFSA                                                       00563500
*    .     TCBOTC                                                       00570800
*    .     TCBRBP                                                       00572800
*    .     TCBJSCB                                               Y02076 00573202
*                                                                Y02076 00573402
*    JSCB  JSCDSABQ                                              Y02076 00573602
*                                                                Y02076 00573802
*    QDB   QDBFELMP                                              Y02076 00574002
*                                                                Y02076 00574202
*    DSAB  DSABDCBM                                              Y02076 00574402
*    .     DSABFCHN                                              Y02076 00574602
*    .     DSABFLG1                                              Y02076 00574702
*    .     DSABFLG2                                              Y02076 00574902
*    .     DSABFLG4                                              Y02076 00575002
*    .     DSABOPCT                                              Y02076 00575202
*    .     DSABORG                                               Y02076 00575302
*    .     DSABTCBP                                              Y02076 00575502
*    .     DSABTIOT                                              Y02076 00575602
*                                                                Y02076 00575802
*    TIOT  TIOEDDNM                                              Y02076 00575902
*                                                                       00576302
* ATTRIBUTES                                                            00576800
*    KEY 0, SUPERVISOR STATE, ENABLED.                                  00577200
*                                                                       00577600
* CHARACTER CODE DEPENDENCY                                             00578000
*    NONE                                                               00578100
*                                                                       00615000
* NOTES                                                                 00625000
*    APPLICABILITY-VS2-2                                                00635002
*    MODULE CHARACTERISTICS-WRITTEN TO A 4K DESIGN POINT                00645000
*    TYPE- LOAD, RESIDENCE- SYSTEM LINK PACK AREA                       00647000
*                                                                       00649000
* VS2/3 CHANGES/DELETIONS                                               00649437
*013044                                                         ZA03159 00649837
*008883-009137,009535,009692-009710,013044-013055              @ZA03659 00650237
*007856-007860                                                 @ZA03659 00650637
*C814002,820402                                                @ZA06111 00650837
*A00817013,00817023,01355503                                   @ZA06140 00650937
*A888604-888607                                                @ZA06667 00651037
*A00882503-00882504                                            @ZA08283 00651137
*C008827                                                       @ZA10272 00651237
*C00912803                                                     @ZA12190 00651337
*A00882704-00882705                                            @ZA11565 00651437
*C007980-007996,A007997-007998,A013003                         @ZA17960 00651537
*A008840-008845                                                @ZA27047 00651637
*A009713-009733,013006                                         @ZA28860 00652137
*A007260-007280                                                @ZA32921 00652237
*                                                                       00652637
         EJECT                                                          00653637
IGC0H06C CSECT                                                          00654637
*                                                                YM2776 00655637
         BALR  RB,E0               ESTABLISH BASE REGISTER              00656637
         USING *,RB                BASE REGISTER 11                     00662637
         USING CHKWA,RC            BASE FOR CHECKPOINT WORK AREA        00663637
         USING TCB,R4              BASE FOR TCB                         00664600
         USING IHADCB,R2           DCB                                  00674600
         CNOP  4,8                 ALIGN EYE-CATCHER TO DOUBLE WORD     00676602
         B     C10A1               BRANCH AROUND CSECT NAME CONSTANT    00676702
         DC    CL8'IGC0H06C'       CSECT NAME                           00676800
         DC    CL8'@ZA32921'       LAST CODE SHIP                       00676937
         DC    CL8'&SYSDATE'       LAST DATE SHIP                       00677937
C10A1    L     R2,CKDCBAD          CHKPT. DCB ADDRESS                   00678937
         LA    R7,C13B5            ADDRESS OF SYNAD ROUTINE             00681000
         STCM  R7,E7,DCBSYNAD+E1   STORE ADDRESS IN DCB                 00683000
         MVC   CKMN40(E8),CKMN40A  SET XCTL DEFAULT EXIT TO IGC0N06C    00685000
         MVI   CKLNT+E3,E4         INIT CKLNT TO 4                      00685100
         L     R4,CKTCBAD          GET JOB STEP TCB                     00695300
         DROP  R2                  DCB                                  00705300
         SPACE 2                                                        00709001
*                                                                       00710601
*        SAVE TCB FIELDS AND PREVIOUS CHECKPOINT DATA                   00712201
*        THE USER BLKSIZE WILL BE WRITTEN IN THE SUR                    00713801
*                                                                       00715401
*        THIS ROUTINE WILL CHECKPOINT VARIOUS TCB FIELDS                00717002
*        NECESSARY FOR RESTART.                                         00718602
         SPACE 2                                                        00720201
         LA    R3,TCBUSER          ADDRESS OF TCBUSER FIELD             00721801
         MVI   CKCODE,E15          CODE=X'0F'                           00723401
         BAL   RD,C13A1            LINK TO BUFFER HANDLER RTN           00725001
         L     R3,TCBEXT2          GET THE ADDRESS OF TCB XTN  @ZA32921 00726037
         LA    R3,20(R3)           POINT TO CICS AUTH AREA     @ZA32921 00727037
         BAL   RD,C13A1            PUT IT OUT                  @ZA32921 00728037
         LA    R3,TCBFSA           ADDR OF FIRST PP SAVE AREA           00731401
         BAL   RD,C13A1            LINK TO BUFFER H.R.                  00733001
         LA    R3,CKDCBAD          CHECKPOINT DCB ADDRS                 00744201
         BAL   RD,C13A1            LINK TO BUFFER H.R.                  00745801
         LA    R3,CKSYNAD          GET USER'S CHKPT SYNAD ADDRESS       00747400
         BAL   RD,C13A1            LINK TO BUFFER HDLR RTN              00757400
         LA    R3,CKDCBSI          GET ADDR OR USER'S BLKSIZE           00757500
         MVI   CKLNT+E3,E2         LENGTH OF FIELD                      00757600
         BAL   RD,C13A1            LINK TO BUFFER HDLR RTN              00757700
         L     R3,TCBRBP           GET ADDR OF CHKPT SVRB               00757800
         LA    R3,RBGRSAVE-RBSECT(R3) G.P. REGISTERS                    00757902
         MVI   CKCODE,E16          CODE=X'10'                           00759600
         MVI   CKLNT+E3,E64        LENGTH OF USER'S GPR'S               00761600
         BAL   RD,C13A1            LINK TO BUFFER HDLR RTN              00762000
         EJECT                                                          00762400
*        CHECKPOINTING THE P/P DEB'S AND IRB'S - THIS ROUTINE WILL      00762802
*        CHECKPOINT ALL NORMAL,DUMMY, AND ISAM DEB'S ASSOCIATED WITH    00762902
*        THE P/P TCB AS WELL AS ANY IRG'S ASSOCIATED WITH THE DEB'S.    00763000
*        SUR CODES ASSIGNED ARE ISAM DEB (X'81'), DUMMY DEB (X'82'),    00767000
*        NON-ISAM DEB (X'80'), IRB (X'12').                             00769000
         SPACE 3                                                        00769400
*                                                                       00769800
*        START OF DEB PROCESSING                                        00770200
*                                                                       00770600
         L     R8,TCBDEB           GET DEB ADDRESS FORM TCB             00770700
         USING DEBBASIC,R8         DEB                                  00770800
C12F1    LR    R3,R8               SAVE ADDRESS OF DEBBASIC             00770900
         S     R3,KDEBAVTL         GET ADDRESS OF DEB APPENDAGE TABLE   00774600
         SR    RF,RF               CLEAR WORKREG                        00776600
         IC    RF,DEBLNGTH-DEB(R3) GET LENGTH OF DEB IN DBLE WORDS      00777000
         SLL   RF,E3               GET LENGTH IN BYTES                  00777400
         LR    R0,RF               GET DEB LENGTH                YM7807 00778802
         ICM   R0,M8,SP253         INSERT SUBPOOL NUMBER         YM7807 00779202
         ST    R0,CKERAS04         SAVE R0 FOR FREEMAIN          YM7807 00779602
         GETMAIN R,LV=(0)          GET CORE FOR DEB WORK SPACE   YM7807 00780002
         LH    RF,CKERAS04+E2      RESTORE DEB LENGTH            YM7837 00781602
         ST    R1,CKERAS05         SAVE R1 FOR FREEMAIN          YM7807 00785202
         LA    R7,DEBAVTLN(R1)          CALC DEBBASIC WA ADR   @ZA03659 00785637
         ST    R7,CKERAS07              SAVE FOR PURGE/RESTORE @ZA03659 00786037
         ST    R3,CKERAS06         SAVE DEB ADDRESS              YM7807 00786802
         LR    R7,R8               GET DEB ADDR FOR CALC         YM5720 00788402
         LA    R9,DEBPRFLN         GET LENGTH OF PREFIX          YM5720 00790002
         SR    R7,R9               POINT TO DEB PREFIX           YM5720 00791602
         USING DEBPREFX,R7         ADDRESS DEB PREFIX            YM5720 00793202
         L     R9,DEBXTNP          GET DEB EXTENSION ADDR        YM5720 00794802
         USING DEBXTN,R9           ADDRESS DEB EXTENSION         YM5720 00796402
         CLC   DEBDEVED(2),ABLEV   IS THIS A SAM DUMMY DEB     @ZA17960 00798037
         BE    DUMMY               BRANCH AHEAD IF YES         @ZA17960 00798637
         CLI   DEBEXSCL,X'00'      POSSIBLE SUBSYSTEM DEB      @ZA17960 00799237
         BNE   C12F2               BRANCH IF NOT               @ZA17960 00799837
DUMMY    EQU   *                                               @ZA17960 00800437
         LA    R3,DEBPREFX-DEB(R3) POINT TO BEGINNING OF DUMMY DEB      00801202
         MVI   CKCODE,E130         CODE= X'82' FOR DUMMY DEB            00802802
         L     R7,DEBXDSAB         FETCH DSAB ADDRESS            YM5720 00804402
         USING DSAB,R7             ADDRESS DSAB                  YM5720 00806002
         L     R7,DSABTIOT         FETCH TIOT ENTRY ADDRESS      YM5720 00807602
         USING TIOENTRY,R7         ADDRESS TIOT ENTRY            YM5720 00809202
         TM    TIOELINK,TIOESSDS   SUBSYSTEM DATA SET            YM5720 00810802
         DROP  R7                  TIOT ENTRY ADDRESSABILITY     YM5720 00812402
         BZ    C12F41              IF NOT, BRANCH              @ZA06111 00814037
         LA    R3,E8(,R3)          ADJUST SUBSYSTEM DEB PREFIX   YM5720 00815037
*                                  ADDRESS (PREFIX=8 BYTES)      YM5720 00816037
         MVI   CKCODE,EX83         CODE X'83' = SUBSYSTEM DEB    YM5720 00817037
         LA    R7,DEBPRLSS(R1)     LOAD SUBSYSTEM PREFIX       @ZA06140 00817337
         ST    R7,CKERAS07         SAVE FOR PURGE RESTORE      @ZA06140 00817637
         B     C12F41              BR TO PUT DEB IN BUFFER     @ZA06111 00818037
C12F2    EQU   *                                                 Y02049 00822002
         TM    DEBXDSO1,DCBDSGIS   IS THIS AN ISAM DATA SET      Y02049 00823602
         BZ    C12F4               NO - BRANCH                          00825202
         TM    DEBXMCF1,DCBMRECP   IS THIS VALID ISAM DCB        Y02049 00826802
         BNZ   C12F4               NO, IT IS AN EXCP DCB. BR.           00828402
         DROP  R9                                                Y02049 00830002
         LA    R7,DEBAPPAD         GET PTR TO ISAM EXTENT PTRS          00831602
         LA    R9,CMSYSA+E2        GET PTR TO TEMP SAVE AREA            00833202
         LA    R6,E4               LOOP COUNT=4                         00834802
C12F3    LA    R7,E4(R7)           POINT TO NEXT (FIRST) ONE            00836400
         LA    R9,E2(R9)           BUMP TEMP SAVE AREA PTR              00846402
         L     R2,E0(R7)           GET FIRST PTR                        00846800
         LA    R2,E0(R2)           ZERO HI BYTE                         00847200
         LTR   R2,R2               PTR IS ZERO                          00847300
         BZ    C12F7               YES BRANCH                           00847400
         SR    R2,R8               GET RELATIVE TRACK OFFSET            00857600
C12F7    STH   R2,E0(R9)           SAVE RELATIVE OFFSET IN CHKWA        00867702
         BCT   R6,C12F3            DECREMENT COUNT                      00871100
         MVI   CKCODE,E129         CODE=X'81' FOR ISAM DEB              00873100
         B     C12F41              CONTINUE PROCESSING           YM7807 00873502
C12F4    MVI   CKCODE,E128         CODE=X'80' FOR NON ISAM DEB          00874302
*                                                                       00874402
*        SINCE THE TIOT IS A SERIALLY REUSABLE RESOURCE, THE     YM7807 00875102
*        ORDER OF THE UCB ENTRIES FOR ANY DD ENTRY CANNOT BE     YM7807 00877102
*        EXPECTED TO REFLECT THE STATUS OF ANY PARTICULAR DCB    YM7807 00877302
*        OR DEB.  THEREFORE, WHEN THE DEB'S ARE WRITTEN TO THE   YM7807 00877702
*        CHECKPOINT DATA SET, THE UCB ADDRESSES WILL BE REPLACED YM7807 00877802
*        BY VOLUME SERIAL NUMBERS IN THE FOLLOWING MANNER:       YM7807 00878202
*                                                                       00878702
*      0 +++++++++++                                             YM7807 00878802
*        + VOL SER +      VOL SER NO.= VOLUME SERIAL NUMBER      YM7807 00878902
*      4 +++++++++++                                             YM7807 00879102
*        + NO.+ CC +      CCHH = EXTENT INFORMATION IN DEB       YM7807 00879502
*      8 +++++++++++                                             YM7807 00879602
*        + *H + CC +      * = SAVE AREA FOR OVERLAYED FILE MASK  YM7807 00879702
*     12 +++++++++++                                             YM7807 00879802
*        + HH + TT +      TT = NUMBER OF TRACKS IN EXTENT        YM7807 00879902
*     16 +++++++++++                                             YM7807 00880002
*                                                                       00880102
*        THE RESTART MOUNT VERIFICATION PROCESSOR (IGC0M05B)     YM7807 00880202
*        WILL RESTORE THE DEB EXTENTS AT RESTART TIME.           YM7807 00880602
*                                                                       00881002
C12F41   EQU   *                                                 YM7807 00881702
         STM   R4,R7,CKERAS00      SAVE MOVE-LONG REGS           YM7807 00881802
         L     R4,CKERAS05         LOAD TO-ADDRESS               YM7807 00881902
         LR    R6,R3               LOAD FROM-ADDRESS             YM7807 00882002
         LR    R5,RF               LOAD TO-LENGTH                YM7807 00882102
         LR    R7,RF               LOAD FROM-LENGTH              YM7807 00882202
         MVCL  R4,R6               MOVE DEB TO GOTTEN AREA       YM7807 00882302
         L     R3,CKERAS05         GET NEW DEB POINTER           YM7807 00882402
         LM    R4,R7,CKERAS00      RESTORE MOVE-LONG REGS        YM7807 00882502
         CLI   CKCODE,E130         IS THIS A DUMMY DEB         @ZA08283 00882637
         BE    C12F5               YES BYPASS NEXT TESTS       @ZA10272 00882737
         CLI   CKCODE,EX83         IS THIS A SUBSYSTEM DEB     @ZA11565 00882837
         BE    C12F5               YES BYPASS NEXT TESTS       @ZA11565 00882937
         CLC   DEBAPPB-DEB(E3,R3),CKERAS06+E1  DOES APP VECTOR   YM7807 00883037
*                                  TABL PTR POINT TO DEBAVT?     YM7807 00883137
         BNE   C12F42              NO, GET VOL SER NUMBER        YM7807 00883237
         XC    DEBAPPB-DEB(E3,R3),DEBAPPB-DEB(R3) ZERO OUT AVT   YM7807 00883337
*                                  POINTER IN DEB                YM7807 00883437
C12F42   EQU   *                                                 YM7807 00883537
         CLI   DEBEXSCL-DEB(R3),E4 IS THIS A DA DEB?             YM7807 00883637
         BNE   C12F5               NO, BYPASS DA PROCESSING      YM7807 00883737
         CLI   DEBAMTYP-DEB(R3),E1 IS THIS A VSAM DEB?           YM7837 00883837
         BE    C12F5               YES, BYPASS PROCESSING        YM7837 00883937
         CLI   CKCODE,E129         IS THIS AN ISAM DEB?        @ZA27047 00884037
         BNE   NOTISAM             NO,BYPASS NEXT TEST         @ZA27047 00884137
         TM    DEBFLGS1-DEB(R3),DEBCINDI IS THIS AN ISAM (CI)  @ZA27047 00884237
*                                  COMPATABILITY INTERFACE DEB @ZA27047 00884337
         BO    C12F5               YES, BYPASS DA PROCESSING   @ZA27047 00884437
NOTISAM  EQU   *                                               @ZA27047 00884537
         STM   R4,R6,CKERAS00      SAVE REGISTERS                YM7807 00884637
         SR    R4,R4               CLEAR COUNT REGISTER          YM7807 00884737
         IC    R4,DEBNMEXT-DEB(R3) INSERT NO. OF EXTENTS         YM7807 00884837
         LA    R5,DEBBASND-DEB(R3) POINT TO DASD SECTION OF DEB  YM7807 00884937
         USING DEBDASD,R5          DA EXTENT SECTION OF DEB      YM7807 00885037
         USING UCBOB,R6            UCB ADDRESSABILITY            YM7807 00885137
         CLI   CKCODE,E129         IS THIS AN ISAM DEB?          YM7807 00885237
         BE    C12F44              YES, BYPASS FIRST(PHONY) XTNT YM7807 00885337
C12F43   EQU   *                                                 YM7807 00885437
         L     R6,DEBUCBAD         POINT TO UCB                  YM7807 00885537
         STCM  R6,M8,DEBSTRHH      DEBDVMOD TO FIRST BYTE OF     YM7807 00885637
*                                  STARTING HH (TEMP. HOLD AREA) YM7807 00885737
         MVC   DEBUCBAD(E6),UCBVOLI MOVE VOL SER TO DEB EXTENT   YM7807 00885837
C12F44   EQU   *                                                 YM7807 00886002
         LA    R5,E16(,R5)         POINT TO NEXT EXTENT          YM7807 00886402
         BCT   R4,C12F43           BRANCH IF MORE EXTENTS        YM7807 00886802
         LM    R4,R6,CKERAS00      RESTORE REGISTERS             YM7807 00887202
         DROP  R5,R6                                             YM7807 00887302
*                                                                       00887437
*    IF A PURGE LIST (PIRL) IS TO BE SAVED - ADDR OF PIRL (DEBUSRPG)    00887537
*    IS SAVED IN CKERAS09 FOR USE WHEN STORING PIRL (X'21') IN          00887637
*    SUR BUFFER.  THEN THE LENGTH OF THE PIRL IS STORED IN THE          00887737
*    DEBUSRPG FIELD (BEFORE DEB GOES TO SUR BUFFER) SO THAT IT          00887937
*    IS AVAILABLE AT RESTART TIME.                             @ZA03659 00888337
*                                                                       00888437
C12F5    ST    RF,CKLNT            PLACE DEB LENGTH IN CKLNT            00888637
         XC    CKERAS08(E8),CKERAS08 ZERO ERAS08,09 FOR PIRO   @ZA03659 00888737
         CLI   CKCODE,E130         IS THIS A DUMMY DEB         @ZA06667 00889137
         BE    C12F5A              YES NO PIRL ACTIVITY        @ZA06667 00889637
         CLI   CKCODE,EX83         IS THIS A SUBSYSTEM DEB     @ZA06667 00890537
         BE    C12F5A              YUP BYPASS PIRL ACTIVITY    @ZA06667 00891437
         DROP  R8                                              @ZA03659 00893237
         L     RD,CKERAS07              GET DEB WORK AREA ADR  @ZA03659 00894137
         USING DEBBASIC,RD                                     @ZA03659 00895037
         CLC   DEBUSRPG+E1(E3),PURG00   WAS I/O PURGED         @ZA03659 00895937
         BE    C12F5A                   BR IF NO               @ZA03659 00896837
         CLC   DEBUSRPG+E1(E3),PURGFF   IS I/O TO BE RESTORED  @ZA03659 00897737
         BE    C12F5A                   BR IF NO               @ZA03659 00898937
         MVC   CKERAS09+E1(E3),DEBUSRPG+E1 SAVE PIRL LIST ADR  @ZA03659 00908937
         L     RF,CVTPTR                ADR CVT-GET IOCOM ADR  @ZA03659 00910937
         USING CVTMAP,RF                  FOR GETTING PIRL LNG @ZA03659 00911737
         L     RF,CVTIXAVL              PTR TO IOS COM AREA    @ZA03659 00912537
         LH    RF,X00(RF)               GET NO. I/O DRIVERS    @ZA03659 00912637
         SLL   RF,E3                    MULT BY 8              @ZA03659 00912737
         LA    RF,X'10'(RF)             ADD 16 FOR HEADER      @ZA12190 00912837
         STH   RF,DEBUSRPG+E2           SAVE LNGTH FOR RESTART @ZA03659 00912937
         STH   RF,CKERAS08              ALSO IN CKERAS08       @ZA03659 00913337
         DROP  RD                                              @ZA03659 00913437
         USING DEBBASIC,R8                                     @ZA03659 00913537
C12F5A   EQU   *                        GO PUT DEB IN SUR BUFR @ZA03659 00913737
         BAL   RD,C13A1            LINK TO BUFFER HDLR RTN              00914337
         LM    R0,R1,CKERAS04      LOAD FREEMAIN REGISTERS       YM7807 00914737
         FREEMAIN R,LV=(0),A=(1)   FREE DEB WORK AREA            YM7807 00915137
         CLI   CKCODE,E130         IS IT DUMMY DEB               Y02076 00916337
         BE    C12F10              YES-BYPASS IRB PROC.          Y02076 00917537
         CLI   CKCODE,EX83         SUBSYSTEM DEB                 YM5720 00918737
         BE    C12F10              YES-BYPASS IRB PROC           YM5720 00919937
         LR    R6,R8               ADR OF DEB BASIC              YM7573 00921137
         LA    R9,DEBPRFLN         GET LENGTH OF PREFIX          YM7573 00922337
         SR    R6,R9               POINT TO DEB PREFIX           YM7573 00923537
         USING DEBPREFX,R6         ADDRESS DEB PREFIX            YM7573 00924737
         CLI   DEBAMTYP,TCAMAP     TCAM WITH KEY 6 IRB           YM7573 00925937
         BE    C12F10              YES, NO IRB SAVE REQ          YM7573 00927137
         DROP  R6                                                YM7573 00928337
         L     R7,DEBIRBAD         DEB'S IRB ADDRESS                    00929537
*                                                                       00930737
*        START OF IRB PROCESSING                                        00931937
*                                                                       00933137
         LA    R7,E0(R7)           CLEAR HI BYTE                        00934337
         LTR   R7,R7               IRB ADDRESS=0                        00935537
         BZ    C12F10              NO - BRANCH                          00936737
         USING RBSECT,R7           RB                                   00937937
         LR    R3,R7               SET R3=IRB ADDRESS                   00939137
         SR    R6,R6               CLEAR WORK REG                       00940337
         LH    R6,RBSIZE           LOAD SIZE OF RB                      00941537
         SLL   R6,E3               GET LENGTH IN BYTES                  00942737
         S     R3,KRBPRFXL         ADDRESS OF IRB PREFIX                00943937
         MVI   CKCODE,E18          CODE=X'12'                           00945137
         ST    R6,CKLNT            PLACE IRB LENGTH IN CKLNT            00946337
         BAL   RD,C13A1            LINK TO BUFFER HDLR RTN              00947537
*                                                                Y02076 00948737
*        ROUTINE TO SAVE DEB EXTENSIONS                          Y02076 00949937
*                                                                Y02076 00951137
C12F10   TM    DEBFLGS1,DEBXTNIN   DEB EXTENSION PRESENT         Y02076 00952337
         BZ    C12F12A             IF NOT, BR                  @ZA03659 00953537
         LA    R3,DEBBASIC-DEBPREFX GET ADDR                     Y02076 00954737
         LNR   R3,R3               OF                            Y02076 00955937
         AR    R3,R8               DEB PREFIX                    Y02076 00957137
         USING DEBPREFX,R3         ADDR DEB PREFIX               Y02076 00958337
         L     R3,DEBXTNP          GET DEB EXTENSION ADDR        Y02076 00959537
         USING DEBXTN,R3           ADDR DEB EXTENSION            Y02076 00960737
         LH    R7,DEBXLNGH         GET LENGTH OF DEB EXT         Y02076 00961937
         ST    R7,CKLNT            STORE IN WORKAREA             Y02076 00963137
         MVI   CKCODE,X20          SET DEB EXTENSION CODE        Y02076 00964337
         BAL   RD,C13A1            LINK TO BUFFER HANDLER        Y02076 00965537
         DROP  R3                  DROP DEB EXTENSION            Y02076 00966737
*                                                                       00967837
*    IF PIRL (RESTORE I/O LIST) IS TO BE CHECKPOINTED - ADDRESS         00968437
*    OF PIRL WOULD HAVE BEEN SAVED (FROM DEBUSRPG) IN CKERAS09          00968837
*    BEFORE DEB WAS CHECKPOINTED                               @ZA03659 00969237
*                                                                       00969337
C12F12A  EQU   *                        PROCESS PIRL           @ZA03659 00969437
         L     R3,CKERAS09              GET @ PIRL IF ONE      @ZA03659 00969537
         LTR   R3,R3                    DOES ONE EXIST         @ZA03659 00969837
         BZ    C12F12                   BR IF NOT              @ZA03659 00969937
         MVI   CKCODE,X21               SET PIRL ID CODE       @ZA03659 00970037
         LH    RF,CKERAS08              GET LNGTH OF PIRL      @ZA03659 00970137
         ST    RF,CKLNT                 LNGTH FOR BUFF HNDLER  @ZA03659 00970537
         BAL   RD,C13A1                 LINK TO BUFR HNDLR     @ZA03659 00971037
EPCB     EQU   *                                               @ZA28860 00971337
* WE WILL CHECKPOINT EPCBS OFF OF THE PIRL HERE.               @ZA28860 00971437
* THE FIRST EPCB WILL HAVE A CODE OF X'22' AND                 @ZA28860 00971537
* ALL SUBSEQUENT EPCBS WILL HAVE CODE X'23'                    @ZA28860 00971637
*                                                              @ZA28860 00971737
         L     R3,24(R3)           GET THE FIRST EPCB          @ZA28860 00971837
         LA    R3,0(R3)            CLEAR THE HIGH ORDER BYTE   @ZA28860 00971937
         LTR   R3,R3               ARE THERE ANY EPCBS ???     @ZA28860 00972037
         BZ    C12F12              NO BRANCH                   @ZA28860 00972137
         MVI   CKCODE,X'22'        SET CODE FOR FIRST EPCB     @ZA28860 00972237
EPCBN    EQU   *                                               @ZA28860 00972337
         L     R7,0(R3)            GET NEXT EPCB LINK POINTER  @ZA28860 00972437
         LH    RF,EPCBLEN          SET EPCP LENGTH             @ZA28860 00972537
         ST    RF,CKLNT            SAVE THE LENGTH             @ZA28860 00972637
         BAL   RD,C13A1            WRITE OUT EPCB              @ZA28860 00972737
         LA    R3,0(R7)            SET UP NEXT EPCB            @ZA28860 00972837
         LTR   R3,R3               ANY MORE EPCBS ?????        @ZA28860 00972937
         BZ    C12F12              NO BRANCH                   @ZA28860 00973037
         MVI   CKCODE,X'23'        SET UP CODE FOR EPCB + N    @ZA28860 00973137
         B     EPCBN               BRANCH TO PROCESS           @ZA28860 00973237
*                                                              @ZA28860 00973337
C12F12   L     R8,DEBDEBAD         GET NEXT DEB                         00973437
         LA    R8,E0(R8)           CLEAR HI BYTE                        00973537
         LTR   R8,R8               IS THERE ANOTHER DEB                 00973637
         BP    C12F1               YES LOOP TO PROCESS IT               00973737
         DROP  R7,R8               RB,DEB                               00973837
*                                                                       00975037
*        ROUTINE TO SAVE FLOATING POINT REGISTERS                       00975137
*                                                                       00976337
C12K1    STD   R0,FLTPTSAV         STORE                                00977537
         STD   R2,FLTPTSAV+E8      FLOATING                             00978737
         STD   R4,FLTPTSAV+E16     POINT                                00979937
         STD   R6,FLTPTSAV+E24     REGISTERS                            00981137
         LA    R3,FLTPTSAV         GET ADDR OF FLT. PT. REGS            00982337
         MVI   CKCODE,E19          CODE=X'13'                           00983537
         MVI   CKLNT+E3,E32        LENGTH                               00984737
         BAL   RD,C13A1            LINK TO BUFFER HANDLER               00985937
*                                                                       00987137
*        SAVE THE TIOT                                           Y02076 00988337
*                                                                       00989537
         L     R3,TCBTIO           GET ADDR OF TIOT FROM TCBTIO         00990737
         MVI   CKCODE,E20          CODE=X'14'                           00991937
         MVC   CKLNT(E4),CKTIOLN   LENGTH OF TIOT                       00993137
         BAL   RD,C13A1            LINK TO BUFFER HANDLER               00994602
*                                                                Y02076 00996302
*        SAVE SELECTIVE DSAB INFORMATION                         Y02076 00996737
*                                                                Y02076 00997937
C12L1    LA    R3,SURL(,RC)        ADDR CORE TO BUILD            Y02076 00999137
         A     R3,CKBFOFST         DSAB RECORDS                  Y02076 01000337
         L     R8,TCBJSCB          GET JSCB ADDR                 Y02076 01001537
         USING IEZJSCB,R8          ADDR JSCB                     Y02076 01002737
         L     R8,JSCDSABQ         GET ADDR OF DSAB QDB          Y02076 01003937
         USING QDB,R8              ADDR QDB                      Y02076 01005137
         L     R8,QDBFELMP         GET ADDR OF 1ST DSAB          Y02076 01006337
         USING DSAB,R8             ADDR DSAB                     Y02076 01007537
         USING XDSAB,R3            ADDR DSAB INFO                Y02076 01008737
C12L2    MVC   XDSAOPCT,DSABOPCT   SAVE OPEN COUNT               Y02076 01009937
         MVC   XDSABORG,DSABORG    SAVE DSORG                    Y02076 01011137
         MVC   XDSAFLG1(L'DSABFLG1+L'DSABFLG2),DSABFLG1 SAVE     Y02076 01012337
*                                  FLAGS 1 AND 2                 Y02076 01013537
         MVC   XDSAFLG4,DSABFLG4   SAVE ONLY CKDS AND CKSI OF    Y02076 01014737
         NI    XDSAFLG4,DSABCKDS+DSABCKSI FLAG 4                 Y02076 01015937
         MVC   XDSADCBM,DSABDCBM   SAVE DCB MODIFICATION MASK    Y02076 01017137
         MVI   XDSAFLGS,X00        INIT DSAB PROCESS FLAGS       Y02076 01018337
         OC    DSABTCBP,DSABTCBP   IS TCB ADDR PRESENT           Y02076 01019537
         BZ    C12L4               IF NOT, BR                    Y02076 01020737
         OI    XDSAFLGS,XDSATCBP   SET TCB ADDR INDICATOR        Y02076 01021937
C12L4    L     R2,DSABTIOT         GET DD ENTRY ADDR             Y02076 01023137
         USING TIOENTRY,R2         ADDR DD ENTRY                 Y02076 01024337
         CLI   TIOEDDNM,BLANK      BLANK DD NAME                 Y02076 01025537
         BE    C12L6               IF BLANK, BR                  Y02076 01026737
         MVC   XDSADDNM,TIOEDDNM   SAVE DD NAME                  Y02076 01027937
         B     C12L8               SKIP BLANK DD PROCESSING      Y02076 01029137
         DROP  R2                  DROP TIOT ENTRY               Y02076 01030337
C12L6    OI    XDSAFLGS,XDSACCAT   SET CONCATENATION INDICATOR   Y02076 01031537
C12L8    MVI   CKCODE,X04          SET DSAB BLK ID               Y02076 01032737
*********************************************************************** 01033937
*    IF DATA SET IS AN IMPLIED VSAM PRIVATE CATALOG - DDNAME CANNOT     01035137
*    BE GUARANTEED TO BE THE SAME BETWEEN CHECKPOINT AND RESTART -      01036337
*    THEREFORE SET CODE X'24' FOR THOSE TYPES OF DATA SETS      ZA00103 01037537
*********************************************************************** 01038737
         TM    DSABFLG3,DSABCATL   IS IT A CATL DATA SET        ZA00103 01039937
         BZ    C12L9               BRANCH IF NOT                ZA00103 01041137
         CLC   XDSADDNM(E4),PRIVCATL  IS DDNAME GENERATED       ZA00103 01042337
         BNE   C12L9               BRANCH IF NOT                ZA00103 01043537
         OI    CKCODE,X24          SET X'24' DSAB BLK CODE      ZA00103 01044737
C12L9    ICM   R8,E15,DSABFCHN     FETCH/TEST NEXT DSAB ADDR    ZA00103 01045937
         BNZ   C12L10              BR IF NOT LAST                Y02076 01047137
         OI    CKCODE,X44          SET LAST BSAB BLK INDICATOR  ZA00103 01048337
C12L10   LA    R2,XDSABSIZ         SET DSAB BLK SIZE             Y02076 01049537
         ST    R2,CKLNT            FOR BUFFER HANDLER            Y02076 01050737
         BAL   RD,C13A1            CALL BUFFER HANDLER           Y02076 01051937
         LTR   R8,R8               TEST NEXT DSAB ADDR           Y02076 01053137
         BNZ   C12L2               IF ANOTHER, GO PROCESS        Y02076 01054337
         DROP  R3,R8               XDSAB AND DSAB                Y02076 01055537
*                                                                Y02076 01056737
*        FLUSH SUR BUFFER BEFORE SAVING SPIE DATA                Y02076 01057937
*                                                                Y02076 01059137
C12M1    CLC   CMBUF(E4),CKBFSTAD  ANY DATA LEFT IN BUFFER       Y02076 01060337
         BE    C12D2               NO- BRANCH                    YM6584 01061537
         L     RA,CKBFSTAD         LOAD NEXT BYTE IN BUFFER      Y02076 01062737
         LA    RD,CKREGSAV         GET ADDR OF REG SAVE AREA     Y02076 01063937
         BAL   R7,C13B2A           WRITE OUT REMAINING DATA      Y02076 01065137
*                                                                Y02076 01066337
*        INTERFACE WITH SUPERVISOR FOR SPIE DATA                 Y02076 01067537
*                                                                Y02076 01068737
C12D2    EQU   *                   FLUSH BYPASS ENTRY            YM6584 01069937
         L     RF,CVTPTR           GET CVT ADDR                  Y02076 01071137
         USING CVTMAP,RF           CVT                           Y02076 01072337
         L     RF,CVTCSPIE         ADDR OF SPIE CHKPT RTN        Y02076 01073537
         DROP  RF                  CVT                           Y02076 01074737
         LR    R1,RC               GET ADDR OF                   Y02076 01075937
         A     R1,CKBFOFST         4K SUR AREA FOR SPIE          Y02076 01077137
         USING SSCR,R1             SSCR                          Y02076 01078337
         MVC   SSCRID(N4),CKSSCRID INIT SSCR HDR                 Y02076 01079537
         XC    SSCRFCHN(SSCRDCBA-SSCRFCHN),SSCRFCHN              Y02076 01080737
         OI    SSCRFLG1,SSCRCKRS   SET CHKPT INDICATOR           Y02076 01081937
         LA    RD,CKREGSAV         SAVE AREA ADDRESS             Y02076 01083137
         BALR  RE,RF               GO TO SPIE CHKPT RTN          Y02076 01084337
         SR    R2,R2               CLEAR REG                     Y02076 01085537
         ICM   R2,M3,SSCRDATL      GET & TEST DATA LENGTH        Y02076 01086737
         BZ    C12D4               IF NO DATA, EXIT              Y02076 01087937
         AH    R2,SSCRHDRL         GET TOTAL RECORD LENGTH       Y02076 01089137
         STH   R2,CKLNGTH1         STORE LENGTH IN DECB          Y02076 01090337
         BAL   R7,C13B2A           WRITE OUT SSCR                Y02076 01091537
*                                                                       01092737
*        XCTL  FOR ALL EXITS                                            01093937
*                                                                       01095137
C12D4    LR    R1,RC               LOAD R1 WITH CHKPT W.A. ADDRESS      01096337
         LA    RF,CKMN40           LOAD ADDR OF NEXT LOAD               01097537
         ST    RF,CK40XCTL         ST IN WORKAREA                       01098737
         LA    RF,CK40XCTL         ADDR OF WORKAREA FIELD               01099937
         XCTL  SF=(E,(15))         XCTL TO NEXT LOAD                    01101137
         EJECT                                                          01102337
*                                                                       01103537
*        ROUTINE TO HANDLE OUTPUT BUFFER                                01104737
*                                                                       01105937
* THIS ROUTINE WILL MOVE DATA FROM AN ADDRESSED AREA TO THE NEXT        01107137
* AVAILABLE BLOCK IN THE SUR BUFFER. IF THERE IS NO ROOM IN THE         01108337
* BUFFER,THE BUFFER WILL BE WRITTEN OUT, AND THE BLOCK MOVED TO         01109537
* THE NOW FREE BUFFER.                                                  01110737
*                                                                       01111937
* REGISTER INPUT-                                                       01113137
*                                                                       01114337
*        R3    ADDRESS OF BLOCK TO BE MOVED                             01115537
*        RD    RETURN ADDRESS                                           01116737
*                                                                       01117937
C13A1    STM   R2,RD,CKOBHSAV      SAVE REGISTERS IN CHKWA              01119137
         LA    RD,CKREGSAV         GET ADDR OF SAVE AREA FOR            01120337
*                                  WRITE/CHECK IN GPR 13                01121537
         LR    R8,R3               SAVE ADDRESS OF BLOCK                01122737
         L     RA,CKBFSTAD         NEXT BYTE IN BUFFER TO BE FILLED     01123937
         L     R3,CKLNT            GET LENGTH OF BLOCK                  01125137
         L     R4,CKBFLWA          GET REMAINING BYTES IN BUFFER        01126337
         LA    R3,E1(R3)           ALLOW FOR CODE BYTE                  01127537
         CR    R3,R4               ENOUGH BYTES LEFT FOR BLOCK          01128737
         BL    C13C2               YES-BRANCH                           01129937
         C     RA,CMBUF            IS BUFFER PTR ALREADY AT START       01131137
         BE    C13C2               YES - BRAN                           01132337
         BAL   R7,C13B2            NO,WRITE OUT BUFFER.                 01133537
C13C2    MVC   E0(E1,RA),CKCODE    MOVE IN CODE BYTE                    01134737
         LA    RA,E1(RA)           INCREMENT BUFFER POINTER             01135937
         BCTR  R3,E0               DECREMENT BUFFER LENGTH              01137137
         BCTR  R4,E0               DECREMENT AMT BYTES LEFT IN BUFFER   01138337
C13C3    LTR   R3,R3               ANY MORE BYTES IN BLOCK              01139537
         BZ    C13E3               NO - BRANCH                          01140737
         CR    R3,R4               Q. ARE THERE MORE BYTES LEFT IN      01141937
*                                  THE BLOCK THAN IN THE BUFFER         01143137
         BNH   C13F1               A. NO USE BLOCK AS COUNTER           01144337
         LR    R2,R4               A. YES USE BUFFER AS COUNTER         01145537
         B     C13E1               MOVE SUR INTO BUFFER                 01146737
C13F1    LR    R2,R3               USE BLOCK LENGTH AS COUNTER          01147937
*                                                                       01149137
*        MOVE BLOCK INTO BUFFER                                         01150337
*        SPECIAL HANDLING FOR DEB'S AND IRB'S                           01151537
*        LINK TO C13B2A TO WRITE OUT BUFFER                             01152737
*        BRANCH TO C13C3 TO PROCESS REST OF BLOCK                       01153937
*                                                                       01155137
         USING DEBBASIC,R7         DEB                                  01156337
         USING RBSECT,R8           RB                                   01157537
C13E1    STM   R4,R7,CKERAS00      SAVE MOVE-LONG REGS           YM7357 01158737
         LR    R4,RA               GET TO-ADDRESS                YM7357 01159937
         LR    R6,R8               GET FROM-ADDRESS              YM7357 01161137
         LR    R5,R2               GET TO-LENGTH                 YM7357 01162337
         LR    R7,R2               GET FROM-LENGTH               YM7357 01163537
         MVCL  R4,R6               DATA TO SUR                   YM7357 01164737
         LM    R4,R7,CKERAS00      RESTORE MOVE-LONG REGS        YM7357 01166102
C13E2    TM    CKCODE,EX80         IS THIS A DEB                        01167702
         BZ    C13E4               NO CHECK FOR IRB                     01169302
         CLI   CKCODE,E130         IS THIS A DUMMY DEB                  01170902
         BE    C13E5               BRANCH IF YES                        01172502
         CLI   CKCODE,EX83         IS THIS A SUBSYSTEM DEB       YM5720 01174102
         BE    C13E5               BRANCH IF YES                 YM5720 01175702
CKDEBAD1 CLI   CKCODE,E129         ISAM DEB                             01177302
         MVI   CKCODE,EX7F         INSURE ONLY ONCE THRU                01177400
         BNE   C13E5               BRANCH IF NO                         01178400
         LA    RE,DEBFIEAD-DEB(RA) ADDR OF ISAM PTRS                    01180400
         MVC   E2(E2,RE),CMSYSA+E4  MOVE                                01180500
         MVC   E6(E2,RE),CMSYSA+E6  POSITIONAL                          01183700
         MVC   E10(E2,RE),CMSYSA+E8 POINTERS                            01185700
         MVC   E14(E2,RE),CMSYSA+E10 TO DEB                             01186102
         B     C13E5               CONTINUE BUFFER HDLR                 01187700
C13E4    CLI   CKCODE,EX12         IS THIS AN IRB                       01190102
         BNE   C13E5               NO CONTINUE BUFFER HANDLING          01190200
         MVI   CKCODE,EX7F         INSURE ONLY ONCE THROUGH             01192600
         L     R8,CKOBHSAV+E20     ADDR OF IRB BASIC SECTION            01194600
         TM    RBSTAB2,EX0C        ANY IQE'S                            01196600
         BC    E12,C13E5           NO-SKIP NEXT CODE                    01197000
         L     RE,RBNEXAV          COMPUTE OFFSET TO NEXT AVAILABLE IQE 01197400
         SR    RE,R8               GET OFFSET                           01197500
         STCM  RE,E15,RBNEXAV+RBPRFLNA-RBSECT(RA) PUT OFFSET IN IRB     01201202
*                                  IN BUFFER                            01203202
         L     RE,RBIQE            COMPUTE OFFSET                       01203600
         SR    RE,R8               TO LIST ORIGIN OF IQE'S              01204002
         STCM  RE,E7,RBIQE1+RBPRFLNA-RBSECT(RA) STORE IN IRB            01204402
C13E5    AR    RA,R2               INCREMENT BUFFER PTR          YM7357 01205002
         SR    R3,R2               GET REMAINING BYTES IN BLOCK         01210000
         SR    R4,R2               GET REMAINING BYTES IN BUFFER        01212000
         AR    R8,R2               INCREMENT ADDRS OF BLOCK             01214000
         LTR   R4,R4               ANY MORE BYTES IN BUFFER             01214400
         BH    C13C3               YES- CHECK BLOCK LENGTH              01214800
         BAL   R7,C13B2A           NO - WRITE OUT BUFFER                01214900
         B     C13C3               PUT REMAINDER OF BLOCK THROUGH LOOP  01220300
C13E3    LA    R3,E4               RESET LENGTH TO FOUR                 01224302
         ST    R3,CKLNT            STORE IN W.A.                        01224700
         ST    R4,CKBFLWA          REINITIALIZE BYTES LEFT IN BUFFER    01225100
         ST    RA,CKBFSTAD         RE-INITIALIZE STARTING ADR OF BUFFER 01225500
         LM    R2,RD,CKOBHSAV      RESTORE REGS                         01225600
         BR    RD                  RETURN                               01225700
         EJECT                                                          01225802
*                                                                       01229600
*        ROUTINE TO WRITE OUT BUFFER                                    01229700
*                                                                       01229800
C13B2    LTR   R4,R4               ARE BYTES LEFT IN BUFFER=0           01229900
         BZ    C13B2A              YES-BRANCH                           01234900
         MVI   E0(RA),E0           SET END OF USABLE DATA BYTE          01236900
C13B2A   L     RA,CMBUF            INIT START OF BUFFER                 01239302
         TM    CKFLAG1,CKVEQR      IS THIS TASK V=R?             YM2776 01239401
CKVEQR   EQU   8                   V=R FLAG IN W.A.             YA00258 01239502
         BNO   CKNOVEQR            NO, GO ON                     YM2776 01239602
         LRA   RA,0(,RA)           GET REAL ADDRESS OF BUFFER    YM2776 01241101
CKNOVEQR WRITE CKDECB1,SF,,(RA),MF=E WRITE SUR                          01242702
         CHECK CKDECB1             CHECK SUR                            01245302
         TM    CKFLAG1,CKTAPE      CHKPT DATA SET ON TAPE               01246200
         BZ    CMEOVDA             BRANCH IF NO                         01247100
         L     RF,CKTSTEOV         LOAD ADDR OF DEB VOL COUNT           01248002
         CLC   E0(E4,RF),CKEOVCMR  DID EOV OCCUR                        01248900
         BNE   CMEOV               BRANCH IF YES                        01249800
CMTIOTST CLI   CKRETCOD+E1,CKIOERR I/O ERROR                            01251602
         BE    C12D4               BRANCH TO XCTL RTN                   01252601
         L     RA,CMBUF            INIT START OF BUFFER          YM2776 01253501
         ST    RA,CKBFSTAD         RE-INIT BUFFER PTR                   01253701
         LA    R4,SURL             GET LENGTH OF SUR                    01254801
         ST    R4,CKBFLWA          RE-INIT REMAINING BYTES IN BUFFER    01255901
         BR    R7                  RETURN TO BUFFER HANDLER             01257001
*                                  OR XCTL INTERFACE                    01258101
         EJECT                                                          01259201
*                                                                       01260301
*        END OF VOLUME TESTING                                          01261401
*                                                                       01262501
CMEOV    TM    CKFLAG2,CKEOV       2ND EOV FOR THIS REQUEST             01264702
         BO    CMEOVER             YES- PREPARE TO GO TO EXIT RTN       01265801
         OI    CKFLAG2,CKEOV       TURN ON EOV INDICATOR                01266901
         MVI   CKMN40+E4,C2        SET MOD NAME TO IGC0206C             01268002
         B     C12D4               XCTL INTERFACE                       01269101
         USING IHADCB,RF           DCB                                  01271302
CMEOVDA  L     RF,CKDCBAD          GET ADR. OF CHKPT DCB                01272402
         L     RF,DCBDEBAD         GET ADR. OF CHKPT DEB                01273501
         DROP  RF                  DCB                                  01274601
         USING DEBBASIC,RF         DEB                                  01275701
         CLC   DEBNMEXT(E1),CKTSTEOV DID EOV OCCUR ON DA DEVICE         01276802
         BE    CMTIOTST            NO- CONTINUE PROCESSING              01279001
         DROP  RF                  DEB                                  01280101
CMEOVER  LA    RF,CKERIO7          INDICATE EOV ERROR                   01282302
         STH   RF,CKMSGCOD         PUT IN W.A.                          01283401
         MVI   CKRETCOD+E1,E8      PUT IN RETURN CODE ERROR             01284501
         B     C12D4               XCTL INTERFACE                       01285601
*                                                                       01286701
*        CHECKMAIN SYNAD ROUTINE                                        01287801
*                                                                       01288901
C13B5    MVI   CKRETCOD+E1,CKIOERR  I/O ERROR                           01291102
         LA    R7,CKIOEROR         I/O ERROR CODE                       01292201
         STH   R7,CKMSGCOD         STORE IN WORK AREA                   01293301
         BR    RE                  RETURN                               01294401
         EJECT                                                          01295501
*                                                                       01296601
*        GENERAL CONSTANTS                                              01297701
*                                                                       01298801
         DS    0F                                                       01299901
PRIVCATL DC    CL4'SYS0'           GENERATED DDNAME-1ST 4 CHAR. ZA00103 01300302
ABLEV    DC    CL2'AV'             DUMMY DEB MODULE            @ZA17960 01300537
EPCBLEN  DC    XL2'00BC'           LENGTH OF AN EPCB           @ZA28860 01300637
         DS    0F                                                       01300737
CKMN40A  DC    CL8'IGC0N06C'       ADDR OF NEXT LOAD                    01301001
KRBPRFXL DC    AL4(RBPRFLNA)       ADDR OF IRB LENGTH                   01302100
KDEBAVTL DC    AL4(DEBAVTLN)       ADDR OF DEB LENGTH                   01304100
CKSSCRID DC    X'01',X'02',AL2(SSCRDATA-SSCRID) SSCR HDR         Y02076 01304302
SP253    DC    AL1(253)                 SUBPOOL 253 CONSTANT    ZA03159 01304437
PURG00   DC    XL3'000000'              PURGE/RESTORE TESTS    @ZA03659 01305137
PURGFF   DC    XL3'FFFFFF'              PURGE/RESTORE TESTS    @ZA03659 01305537
PATCH    EQU   *                   PATCH START                          01306937
CM3LN    EQU   PATCH-IGC0H06C      LENGTH OF CSECT                      01307637
CM3PALN  EQU   CM3LN/10            GET LENGTH OF PATCH AREA             01308337
CM3PATCH DC    XL(CM3PALN)'00'     10 PERCENT ALLOWANCE FOR PATCH AREA  01309037
*                                                                       01310700
*        GENERAL  EQUATES                                               01311100
*                                                                       01311500
E0       EQU   0                   DISPLACEMENT                         01311900
E1       EQU   1                   1                                    01312537
E2       EQU   2                   2                                    01313237
E3       EQU   3                   3                                    01313937
E4       EQU   4                   4                                    01314637
N4       EQU   4                   4 CONSTANT                    Y02076 01315337
X04      EQU   X'04'               NONLAST DSAB RCD CODE         Y02076 01316037
E5       EQU   5                   DISPLACEMENT FOR W.A. SAVE AREA      01316737
E6       EQU   6                   6                                    01318600
E7       EQU   7                   7                                    01319000
E8       EQU   8                   8                                    01319400
M8       EQU   8                   MASK FOR HIGH ORDER BYTE      YM7807 01319502
E9       EQU   9                   9                                    01320237
E10      EQU   10                  10                                   01320737
E12      EQU   12                  BRANCH CONDITION CODE                01321937
E14      EQU   14                  DISPLACEMENT                         01323137
E15      EQU   15                  CODE FOR USE FIELD                   01326300
E16      EQU   16                  CODE FOR USER'S GPR'S                01327400
E18      EQU   18                  CODE FOR IRB                         01328500
E19      EQU   19                  CODE FOR FLOATING PT REG             01329600
E20      EQU   20                  CODE FOR TIOT                        01330700
E21      EQU   21                  CODE FOR PIE                         01331800
E24      EQU   24                  FIELD DISPLACEMENT                   01332900
X24      EQU   X'24'               IMPLIED PRIV. CATL DSAB CODE ZA00103 01333302
E32      EQU   32                  LENGTH OF FLOATING POINT REGS        01334000
X20      EQU   X'20'               DEB EXTENSION CODE            Y02076 01335137
X21      EQU   X'21'               RESTORE LIST(PIRL) CODE     @ZA03659 01336537
E64      EQU   64                  LENGTH OF G.P. REG                   01337337
X44      EQU   X'44'               LAST DSAB RCD CODE            Y02076 01337537
X00      EQU   X'00'               0 CONSTANT                    Y02076 01338737
E128     EQU   128                 CODE FOR NON- ISAM DEB               01339937
E129     EQU   129                 CODE FOR ISAM DEB                    01341137
E130     EQU   130                 CODE FOR DUMMY DEB                   01342337
EX0C     EQU   X'0C'               MASK FOR IQE                         01343537
EX12     EQU   X'12'               CODE FOR IRB                         01344737
EX80     EQU   X'80'               CODE FOR NON-ISAM DEB                01345937
EX83     EQU   X'83'               CODE FOR SUBSYSTEM DEB        YM5720 01347137
EXFF     EQU   X'FF'               BIT RESET MASK                       01348337
EX7F     EQU   X'7F'               CODE RESET MASK                      01349537
C2       EQU   C'2'                CONSTANT OF 2                        01350737
BLANK    EQU   C' '                BLANK CONSTANT                Y02076 01351937
M3       EQU   3                   REG MASK FOR BYTES 2 & 3      Y02076 01353137
TCAMAP   EQU   X'84'               TCAM DEB WITH KEY 6 IRB       YM7573 01354337
DEBPRLSS EQU   X'08'               DEB PURGE RESTORE SUBSYSTEM @ZA06140 01355537
*        EQUATES FOR LENGTHS AND CODES                                  01356737
*                                                                       01357937
SURL     EQU   400                 LENGTH OF SUR                 YM7049 01359137
DEBPRFLN EQU   16                  LENGTH OF DEB PREFIX          Y02049 01360337
CKERIO7  EQU   X'031B'             ERROR MSG CODE FOR EOV               01361537
CKIOEROR EQU   X'0317'             ERROR MSG CODE FOR I/O ERROR         01362737
         EJECT                                                          01363937
         IEEVCHWA VER=3            AOS2 VERSION OF WA                   01365137
CKTSTEOV EQU   CKUNIT              EOV TEST 1                           01366337
CKEOVCMR EQU   CKUNIT+4            EOV TEST 2                           01367537
CMADEOV  DS    F                   SAVE AREA FOR INFO NEEDED            01368737
CMNEOV   DS    F                   TO TEST IF EOV OCCURRED              01369937
CKBFLWA  DS    F                   REMAINING BYTES IN BUFFER            01371137
CKBFSTAD DS    F                   NEXT BYTE IN BUFFER TO BE FILLED     01372337
CMBUF    DS    F                   BUFFER                               01373537
CKMN40   DS    2F                  SAVE AREA                            01374737
CK40XCTL DS    F'0'                SAVE AREA FOR XCTL                   01375937
CKOBHSAV DS    12F                 SAVE AREA                            01377137
CME2     DS    CL1                 BIG BLOCK SWITCH                     01378337
CKCODE   DS    CL1                 SUR CODE                             01379537
CKLNT    DS    F                   SUR LENGTH                           01380737
CMSYSA   DS    F                   SWITCHES                             01381937
FLTPTSAV DS    4D                  FLOATING POINT SAVE AREA             01383137
         EJECT                                                          01384337
*                                                                Y02076 01385537
*        DSECT FOR DSAB SUR RECORD                               Y02076 01386737
*                                                                Y02076 01387937
XDSAB    DSECT                     DSAB BLK DSECT                Y02076 01389137
XDSAOPCT DS    CL2                 DCB OPEN COUNT                Y02076 01390337
XDSABORG DS    CL2                 DATA SET ORG                  Y02076 01391537
XDSAFLG1 DS    CL1                 DSAB FLAG 1                   Y02076 01392737
XDSAFLG2 DS    CL1                 DSAB FLAG 2                   Y02076 01393937
XDSAFLG4 DS    CL1                 DSAB FLAG 4                   Y02076 01395137
XDSADCBM DS    CL6                 DCB MODIFICATION MASK         Y02076 01396337
XDSADDNM DS    CL8                 DD NAME                       Y02076 01397537
XDSAFLGS DS    CL1                 DSAB PROCESS FLAGS            Y02076 01398737
XDSACCAT EQU   X'80'               DSAB IS CONCATENATED          Y02076 01399937
XDSATCBP EQU   X'40'               DSAB HAS TCB ADDR             Y02076 01401137
XDSABSIZ EQU   *-XDSAB             DSAB BLK SIZE                 Y02076 01402337
         TITLE 'IHJQCP32 - JSCB'                                        01403537
         IEZJSCB                                               , Y02076 01404737
         TITLE 'IHJQCP32 - QDB'                                         01405937
         IHAQDB                                                , Y02076 01407137
         TITLE 'IHJQCP32 - DSAB'                                        01408337
         IHADSAB                                               , Y02076 01409537
         TITLE 'IHJQCP32 - TIOT'                                        01410737
         IEFTIOT1                                              , Y02076 01411937
         TITLE 'IHJQCP32 - CVT'                                  Y02076 01413137
         CVT   DSECT=YES,PREFIX=YES,LIST=YES                     Y02076 01414337
         TITLE 'IHJQCP32 - SPIE CHKPT BLOCK'                     Y02076 01415537
* SPIE CHKPT BLOCK                                               Y02076 01416737
         IHJSSCR                                               , Y02076 01417937
         TITLE 'IHJQCP32 - TASK CONTROL BLOCK'                          01419137
* TASK CONTROL BLOCK                                                    01420337
         IKJTCB                                                         01421537
         TITLE 'IHJQCP32 - REQUEST BLOCK - S.V.R.B., I.R.B.'            01422737
* REQUEST BLOCK - S.V.R.B.,I.R.B.'                                      01423937
         IKJRB                                                          01425137
         TITLE 'IHJQCP32 - DATA EVENT BLOCK'                            01426337
* DATA EVENT BLOCK                                                      01427537
         IEZDEB                                                         01428737
DEBAVTLN EQU   DEBBASIC-DEBAVT     AVT LENGTH                           01429937
         TITLE 'IHJQCP32 - DATA CONTROL BLOCK'                          01431137
* DATA CONTROL BLOCK                                                    01432337
         IHADCB DSORG=(PO,PS),DEVD=(DA,TA)                              01433502
         TITLE 'IHJQCP32 - UNIT CONTROL BLOCK'                          01483502
* UNIT CONTROL BLOCK                                                    01533502
         IEFUCBOB                                                       01583502
         END                                                            81400017
./  ADD  SSI=81150474,NAME=IHJQRS20
RS20     TITLE 'IHJQRS20 AOS/2 REPMAIN 1 ROUTINE - IGC0505B'            01050000
*                                                                       01060003
*   VS2/REL3 CHANGES/DELETIONS                                          01070003
*31775,33318-33338,35199-35260,37451-37463,37534-37538         @ZM33369 01080003
*A030698-030751,030852-030997,031035-031055                     ZA02207 01090037
* APAR OZ31478 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 01092037
*C037379,037408,037419,037526,037538,039248,039312,039363,     @ZSUT222 01093037
*C039808                                                       @ZSUT222 01094037
*A036964-036979,037626                                         @ZSUT222 01096037
*                                                                       01100000
* NAME - REPMAIN 1 - IHJQRS20 -IGC0505B                                 01150000
*                                                                       01200000
* STATUS                                                                01250000
*                                                                       01300000
*         CHANGE LEVEL=0                                                01350000
*                                                                       01400000
* FUNCTION                                                              01450000
*                                                                       01500000
*         THIS MODULE OF THE RESTART FACILITY RECREATES THE USER REGION 01550000
*         AS IT EXISTED AT CHECKPOINT TIME, AND REESTABLISHES THE       01560000
*         VIRTUAL STORAGE MANAGEMENT CONTROL BLOCKS TO REFLECT THE      01570000
*         STATUS OF THE REGION.                                         01580000
*                                                                       01590000
* ENTRY POINTS                                                          01592000
*                                                                       01594000
*         REPMAIN 1 IS ENTERED FROM RESTART HOUSEKEEPING (IGC0205B)     01596000
*         TO RECREATE THE USER REGION.                                  01598000
*                                                                       01598400
* INPUT                                                                 01598800
*                                                                       01599200
*         GPR 1 - CONTAINS THE ADDRESS OF THE RESTART WORK AREA         01599602
*                                                                       01599802
* OUTPUT                                                         Y02076 01600002
*                                                                Y02076 01600102
*         GPR 1 - CONTAINS THE ADDRESS OF THE RESTART WORK AREA  Y02076 01600302
*                                                                Y02076 01600502
* EXTERNAL REFERENCES                                            Y02076 01600602
*                                                                Y02076 01600702
*         NONE                                                   Y02076 01600902
*                                                                Y02076 01601002
* EXITS, NORMAL                                                         01601102
*                                                                       01601302
*               - TO REPMAIN 2 (IGC0605B) TO RESTORE CONTENTS           01649900
*                 SUPERVISION AND TASK MANAGEMENT CONTROL BLOCKS.       01659900
*                 UPON EXIT THE PARAMETERS ARE AS FOLLOWS-              01669900
*                 GPR 12 - CONTAINS ADDRESS OF RSTWA.                   01679900
*                 DECB USED FOR READING THE RESTART DATA SET IS         01689900
*                 INITIALIZED TO READ THE SUR'S.                        01691900
*                 THE ADDRESS OF THE NEXT SUR IN THE BUFFER, AND        01693900
*                 THE NUMBER OF BYTES LEFT IN THE BUFFER ARE PASSED     01695900
*                 IN THE RSTWA.                                         01697900
*                                                                       01698300
* EXITS, ERROR                                                          01698700
*                                                                       01699100
*              -  TO REPMAIN 5 (IGC0905B) TO FREE ANY CONTROL BLOCKS    01699500
*                 USED BY RESTART AND TO RE-INITIALIZE THE REGION       01699600
*                 FOR TERMINATION. REPMAIN 5 IS GIVEN CONTROL IN THE    01699700
*                 EVENT OF AN I/O ERROR.                                01699800
*                 UPON EXIT THE PARAMETERS ARE AS FOLLOWS-              01749800
*              (1)ERROR CODE OF 035 TO INDICATE AN I/O ERROR.  @ZSUT222 01759837
*              (2)ERROR CODE OF 041 TO INDICATE WRONG LENGTH   @ZSUT222 01759937
*                 RECORD DETECTED READING THE CHECKPOINT D/S.  @ZSUT222 01760037
*              (3)ERROR CODE OF 202 TO INDICATE A SETLOCK      @ZSUT222 01760137
*                 ERROR.                                       @ZSUT222 01760237
*                                                                       01769800
* TABLES/WORK AREAS                                                     01779800
*                                                                       01789800
*         RSTWA                                                         01791800
*                                                                       01793800
*         RPMWA1                                                        01795800
*                                                                       01797800
*         DCB   DCBSYNAD                                         Y02076 01798202
*                                                                       01798600
*         TCB   TCBPKF                                           Y02076 01799002
*               TCBPQE                                                  01799400
*                                                                       01799500
*         PQE   PQEREGN                                                 01799702
*               PQEFPQE                                                 01849700
*                                                                       01859700
*         SPQE  SPQEPTR                                                 01869700
*               SPDQEPTR                                                01879700
*               SPQEFLGS                                                01889700
*               SPQEID                                                  01891700
*               SPQEAD                                           Y02076 01891902
*               SPQEKEY                                          Y02076 01892102
*                                                                       01893700
*         DQE   DQFQEPTR                                                01895700
*               DQEPTR                                                  01897700
*                                                                       01898100
*         FQE   FQEPTR                                                  01898500
*                                                                       01899400
* ATTRIBUTES                                                            01899500
*                                                                       01899600
*         KEY 0, SUPERVISOR STATE, ENABLED                              01949600
*                                                                       01959600
*         APPLICABILITY                                                 01969600
*                                                                       01979600
*               AOS/2                                                   01989600
*                                                                       01991600
*         MODULE CHARACTERISTICS                                        01993600
*                                                                       01995600
*              TYPE - LOAD MODULE                                       01997600
*                                                                       01998000
*              RESIDENCE - SYSTEM LINK PACK AREA                        01998400
*                                                                       01998800
*         DEPENDENCIES                                                  01999200
*                                                                       01999300
*              SIZE AND FORMATS OF CONTROL BLOCKS FORMATTED             01999400
*                                                                       01999500
*              REGION MUST BE COMPLETLY ALLOCATED TO SUBPOOL 0.         02049500
*                                                                       02059500
*         INTERFACES                                                    02069500
*                                                                       02079500
*              READ/CHECK MACROS                                        02089500
*                                                                       02091500
*              FREEMAIN/GETMAIN                                         02093500
*                                                                       02095500
* NOTES                                                                 02097500
*                                                                       02097900
*         OPERATION                                                     02098300
*                                                                       02098700
*         THIS ROUTINE RE-INSTATES THE USER REGION CHECKPOINTED BY      02099100
*         CHECKMAIN 1. IT ALSO RECREATES THE VIRTUAL STORAGE MANAGEMENT 02099200
*         CONTROL BLOCKS CHECKPOINTED BY CHECKMAIN 2. UPON ENTRY, THE   02099300
*         THE FOLLOWING INITIALIZATION PROCESSING TAKES PLACE.          02099400
*                                                                       02149400
*              GPR 12 IS SET AS BASE FOR THE RESTART WORK AREA (RSTWA), 02159400
*              AND THE ADDRESS OF THE REPMAIN WORK AREA (RPMWA1) IS     02169400
*              OBTAINED.                                                02179400
*                                                                       02189400
*              THE REPMAIN SYNAD ROUTINE ADDRESS IS PLACED IN THE       02191400
*              RESTART DCB.                                             02193400
*                                                                       02195400
*              THE DEFAULT XCTL EXIT ROUTINE NAME IS SET TO REPMAIN 2   02197400
*              (IGC0605B).                                              02197800
*                                                                       02199100
*              THE ADDRESS OF THE RESTART PQE IS OBTAINED FROM THE      02199200
*              P/P TCB ADDRESSED BY THE RSTWA.                          02199300
*                                                                       02249300
*              THE REGION BOUNDS (START/END) ARE OBTAINED FROM THE      02259300
*              RSTWA AND THE CURRENT POSITION POINTER WITHIN THE        02269300
*              REGION IS SET EQUAL TO THE BEGINNING OF THE REGION.      02279300
*                                                                       02289300
*              A 2K BLOCK OF THE RESTART WORK AREA IS USED       Y02076 02291502
*              FOR THE ASR BUFFER.                               Y02076 02291702
*                                                                       02293300
*         PROCESSING THEN CONTINUES AS DESCRIBED UNDER THE HEADING      02295300
*         'RESTORING THE USER REGION STORAGE'.                          02297300
*                                                                       02297700
*         RESTORING THE USER REGION STORAGE                             02298100
*                                                                       02298500
*         1.   THE ASR RECORD IS READ INTO THE ASR BUFFER               02298900
*                                                                       02299000
*         2.   THE FIRST/NEXT ASRE IS OBTAINED FROM THE ASR, AND A      02299100
*              TEST IS PERFORMED TO DETERMINE IF THE CURRENT REGION     02299200
*              POINTER IS EQUAL TO THE ASRE START POINTER. IF SO,       02332800
*              PROCESSING CONTINUES WITH STEP 3. IF NOT, THEN THE       02342800
*              AREA FROM THE CURRENT REGION POINTER TO THE ASRE START   02352800
*              POINTER IS FREE REGION STORAGE, AND A FREEMAIN FOR       02362800
*              SP250 IS ISSUED. THIS FREEMAIN CREATES AN FBQE FOR       02364800
*              THE FREE STORAGE, AS WELL AS PERFORMING ALL NECESSARY    02365200
*              INTERFACES WITH THE PAGING SUPERVISOR. PROCESSING THEN   02365600
*              CONTINUES WITH STEP 3.                                   02366000
*                                                                       02366100
*         3.   THE CURRENT REGION POINTER IS UPDATED TO POINT TO THE    02366200
*              END OF THE STORAGE BLOCK DESCRIBED BY THE ASRE. THE      02366300
*              STORAGE DESCRIBED BY THE ASRE IS THEN READ DIRECTLY      02377500
*              TO ITS VIRTUAL STORAGE LOCATION BY SUCCESSIVE READS      02387500
*              FROM THE RESTART DATA SET. AFTER THE LAST READ HAS       02387900
*              BEEN PERFORMED, A TEST IS MADE TO DETERMINE IF THE       02388300
*              ASR HAS ANY MORE ASRE'S. IF SO, PROCESSING CONTINUES     02388700
*              WITH STEP 2. IF NOT, A TEST IS MADE TO DETERMINE IF      02392400
*              THIS IS THE LAST ASR. IF NOT, PROCESSING CONTINUES       02394400
*              WITH STEP 1, OTHERWISE, IF THE CURRENT REGION POINTER    02394800
*              IS NOT EQUAL TO THE REGION ENDING ADDRESS, A FREEMAIN    02395200
*              IS ISSUED FOR THE REMAINDER OF THE REGION.        Y02076 02395602
*              PROCESSING THEN CONTINUES AS DESCRIBED UNDER THE  Y02076 02396102
*              HEADING 'RESTORING THE VSM CONTROL BLOCK QUEUES'. Y02076 02396202
*                                                                       02446200
*         RESTORING THE VSM CONTROL BLOCK QUEUES                        02456200
*                                                                       02466200
*         THIS ROUTINE WILL RESTORE THE VSM CONTROL BLOCKS (SPQE, DQE,  02476200
*         FQE) FOR SYSTEM TASK CONTROL (STC), INITIATOR, AND PROBLEM    02486200
*         PROGRAM TASKS. IT INITIALIZES THE I/O CONTROL BLOCKS FOR      02488200
*         READING SUR RECORDS, AND CAUSES THE FIRST SUR TO BE READ IN.  02490200
*         PROCESSING THEN CONTINUES WITH STEP 1.                        02492200
*                                                                       02494200
*         1.   THE STC TCB ADDRESS IS OBTAINED, AND A COUNTER IS SET    02494600
*              TO 2 TO INDICATE THAT THE INIT AND P/P HAVE NOT BEEN     02495000
*              PROCESSED. PROCESSING THEN CONTINUES WITH STEP 2.        02495400
*                                                                       02495800
*         2.   THE BLOCK LENGTH USED BY THE BUFFER HANDLER AND          02495900
*              GETMAIN ROUTINES IS SET TO THE LENGTH OF AN SPQE,        02496000
*              AND A CALL IS MADE TO THE RSGET ROUTINE WHICH WILL       02496100
*              GET STORAGE FOR THE SPQE, AND MOVE THE SPQE TO THE       02512800
*              CORE OBTAINED. UPON RETURN, THE STORAGE PROTECT   Y02076 02523002
*              KEY OF THE SPQE IS TESTED AND IF GREATER THAN 8,  Y02076 02523202
*              IT IS UPDATED TO THE KEY OF THE PP TCB (TCBPKF).  Y02076 02523402
*              THEN, A SWITCH IS SET TO                          Y02076 02523602
*              INDICATE THAT THIS IS THE LAST SPQE IF THE LAST SPQE     02524800
*              FLAG IS SET IN THE SPQE. THEN, THE SPID IS CHECKED       02526800
*              FOR SUBPOOL 0. IF NOT, PROCESSING CONTINUES WITH STEP    02528800
*              3. IF SO, SPECIAL PROCESSING IS ENTERED TO HANDLE THE    02529200
*              SHARED SP 0. IF THE TASK CURRENTLY BEING RESTORED IS     02529300
*              THE STC, THE ADDRESS OF THE SPQE IS SAVED, AND           02529400
*              PROCESSING CONTINUES WITH STEP 3. IF NOT, THE ADDRESS    02535000
*              OF THE STC SP0 SPQE IS PLACED IN THE SPQEDQE FIELD       02537000
*              TO CONNECT THE SPQE TO THE OWNER OF THE SUBPOOL, AND     02539000
*              PROCESSING CONTINUES WITH STEP 3.                        02539400
*                                                                       02539800
*         3.   THE SPQE IS PLACED ON THE CHAIN OF RESTORED SPQE'S       02540200
*              FOR THE TASK IN THE RPMWA. THE ADDRESS OF THE NEXT       02540300
*              DATA BLOCK IS OBTAINED. THE BLOCK LENGTH IS SET TO       02540400
*              THE SIZE OF AN FQE/DQE (16 BYTES) AND A TEST IS          02540500
*              PERFORMED TO DETERMINE IF THIS IS A DQE. IF NOT,         02590500
*              PROCESSING CONTINUES AS DESCRIBED BY STEP 6.             02600500
*                                                                       02610500
*         4.   IF THIS IS A DQE, A CALL IS MADE TO RSGET TO GET AND     02620500
*              MOVE THE BLOCK TO A DQE IN LSQA. UPON RETURN, THE        02630500
*              DQE IS CHAINED TO THE SPQE AND PROCESSING CONTINUES      02632500
*              WITH STEP 5.                                             02634500
*                                                                       02636500
*         5.   THE ADDRESS OF THE NEXT DATA BLOCK IS OBTAINED, AND      02638500
*              A TEST IS MADE TO DETERMINE IF IT IS AN FQE. IF NOT,     02638900
*              PROCESSING CONTINUES WITH STEP 4. OTHERWISE, THE         02639300
*              RSGET ROUTINE IS CALLED, AND THE FQE IS PLACED ON        02639700
*              THE DQE. PROCESSING THEN CONTINUES WITH STEP 5.          02640100
*                                                                       02640200
*         6.   IF THE LAST SPQE SWITCH IS NOT ON, PROCESSING            02640300
*              CONTINUES WITH STEP 2. IF ON, THE SWITCH IS TURNED       02640400
*              OFF, AND THE COUNTER, SET TO 2 AT INITIALIZATION         02657100
*              TIME, IS DECREMENTED BY 1. DEPENDING ON THE COUNTER      02667100
*              VALUES, THE FOLLOWING PROCESSING TAKES PLACE.            02669100
*                                                                       02671100
*                   COUNTER = 1    THE INITIATOR SPQE CHAIN MUST        02673100
*                                  BE PROCESSED AND PROCESSING          02673500
*                                  CONTINUES WITH STEP 2.               02673600
*                                                                       02673700
*                   COUNTER = 0    THE P/P SPQE CHAIN MUST BE           02679300
*                                  PROCESSED AND PROCESSING             02681300
*                                  CONTINUES WITH STEP 2.               02683300
*                                                                       02683700
*                   COUNTER = NEG. ALL SPQE CHAINS HAVE BEEN            02684100
*                                  PROCESSED, GPR 1 IS SET TO           02684500
*                                  POINT TO THE RSTWA AND EXIT IS       02684600
*                                  MADE VIA XCTL TO REPMAIN 2.          02684700
         EJECT                                                          02684800
IGC0505B CSECT                                                          02734800
         BALR  RB,R0               EST. ADDRESSABILITY                  02744800
         USING *,RB                ADDRESS CODE                         02754802
         B     BEGIN               GO AROUND ID                         02764800
         DC    H'0'                ALIGN TO DOUBLE WORD BDY             02774800
         DC    CL8'IGC0505B'       MODULE NAME                 @ZSUT222 02776837
         DC    CL8'&SYSDATE'       LAST DATE SHIPPED           @ZSUT222 02776937
         DC    CL8'@ZSUT222'       LAST CODE SHIPPED           @ZSUT222 02777037
BEGIN    LR    RC,R1               GET ADDR OF RESTART WORK AREA        02778800
         USING RSTWA,RC            ADDRESS WORKAREA                     02780802
         LR    RA,RC               COMPUTE ADDR OF                      02782802
         A     RA,RSMWOFST         REPMAIN WORK AREA                    02783202
         USING RPMWA1,RA           ADDRESS REPMAIN WORKAREA             02783602
         LA    RD,RSREGSAV         GET SAVE AREA ADDR FOR ACCESS METH.  02784000
         XC    LOCLOCK,LOCLOCK     CLEAR LOCAL LOCK SWITCH     @Z30ESHP 02785603
*                                                                YM6541 02787803
*        FREEMAIN TO RELEASE ANY RESIDUAL SUBPOOL 252            YM6541 02789403
*        ALLOCATIONS - NAMELY THE CHECKPOINT D/S IOB             YM6541 02791003
*                                                                YM6541 02792603
         FREEMAIN R,SP=252                                       YM6541 02794203
*                                                                YM7523 02795803
*        GET 2K CORE USED BY OPEN IN 005B                        YM7523 02797403
*                                                                YM7523 02799003
         LA    R0,TWOKBLK               2K                       YM7523 02800603
         ICM   R0,M8,RMSP250            SP250                    YM7523 02802203
         GETMAIN R,LV=(R0)                                       YM7523 02803803
         LA    R2,RSBDCB           GET ADDRESS OF RESTART DCB           02805402
         USING IHADCB,R2           ADDRESS DCB                          02806602
         LA    RF,SYNAD            GET ADDRESS OF RM1 SYNAD ROUTINE     02807802
         STCM  RF,M7,DCBSYNAD+N1   PUT SYNAD ADDRESS IN DCB.            02809002
         XC    RPMWA1(RPMWAEND-RPMWA1),RPMWA1   CLEAR THE WORK AREA     02810202
         LA    RF,N2048            SET UP RECORD LENGTH FOR CIR'S       02811400
         STH   RF,RSLNGTH1         PUT IT IN DECB 1                     02813400
         MVC   RPMXLIST(N8),RM2NAME SET DEFAULT XCTL NAME        Y02076 02813602
         SPACE 3                                                        02823600
*        START OF ASRE PROCESSING                                       02825600
         SPACE 3                                                        02827600
RM2E100  L     R4,RSTCBAD          GET ADDRESS OF P/P TCB               02828000
         USING TCB,R4              ADDRESS TCB                          02828402
         L     R4,TCBPQE           GET ADDR OF DPQE                     02828800
         DROP  R4                  TCB                                  02828902
         USING PQESECT,R4          ADDRESS PQE                          02829002
         L     R4,PQEFPQE          GET ADDR OF PQE                      02829100
         L     RF,PQEREGN          GET START ADDR OF REGION             02879100
         ST    RF,RPMCESA          SET CURRENT START = REGION START     02889100
         A     RF,RSPPE            CALCULATE END OF REGION       Y02076 02899102
         ST    RF,RPMRGEND         SAVE IT FOR LATER COMPARES           02909100
         DROP  R4                  FREE R4 FOR OTHER USE                02919100
         LR    R6,RC               GET ADDRESS OF                Y02076 02919302
         A     R6,RSBFOFST         SUR/SSCR BUFFER               Y02076 02919502
         USING ASRHDR,R6           ADDRESS ASR                          02925102
RM2E110  LR    R9,R6               SET UP TO READ INTO ASR BUFFER       02927100
         BAL   R8,READRTN          READ AN ASR RECORD                   02927500
         SR    R4,R4               SET ASRE COUNTER = 0                 02927900
         SR    R5,R5               SET ASRE INDEX = 0                   02928300
RM2E120  CH    R4,ASRCOUNT         HAVE ALL ASRE'S BEEN PROCESSED       02928700
         BNL   RM2E150             YES, GO SEE IF ANY MORE ASR'S.       02928800
         LA    R4,N1(R4)           UP COUNT BY 1.                       02928900
         LA    R5,N8(R5)           UP INDEX BY 8 TO POINT TO NEXT ASRE  02929000
         L     R9,ASRHDR(R5)       GET ELEMENT START FROM ASRE          02945700
         C     R9,RPMCESA          IS ELEM. START = CURRENT START       02955700
         BE    RM2E130             YES, GO SET CURR START EQ ELEM. END  02957700
         L     R1,RPMCESA          GET START OF AREA TO FREEMAIN        02959700
         LR    R0,R9               CALCULATE LENGTH TO FREE             02961700
         S     R0,RPMCESA          IE. ENTRY START - CURRENT START      02962100
         ICM   R0,M8,RMSP250       SET UP SUBPOOL NUMBER                02962200
         FREEMAIN R,LV=(0),A=(1)   CREATE APPROPRIATE FBQE.             02962300
RM2E130  L     RF,ASRHDR+N4(R5)    SET THE CURRENT START ADDRESS        02967900
         ST    RF,RPMCESA          = THE ELEMENT END ADDRESS            02969900
         SPACE                                                          02971900
*        NOTE THAT THE READ BUFFER ADDRESS (R9) IS = ELEMENT START      02972300
         SPACE                                                          02972700
RM2E140  BAL   R8,READRTN          READ CIR INTO REGION                 02973100
         LA    R9,N2048(R9)        BUMP READ ADDRESS BY CIR REC. SIZE   02973200
         C     R9,RPMCESA          HAS READ ADDRESS REACHED ELEM. END   02973300
         BL    RM2E140             NO, CONTINUE TO READ.                02973400
         B     RM2E120             YES, GO PROCESS NEXT ASRE, IF ANY.   03023400
         SPACE 3                                                        03033400
*        ALL ENTRIES OF AN ASR RECORD HAVE BEEN PROCESSED.              03043400
*        DETERMINE IF ANY MORE ASR RECORDS REMAIN.  IF NOT,             03053400
*        THE REGION HAS BEEN RESTORED.                                  03063400
         SPACE 3                                                        03065400
RM2E150  TM    ASRFLG1,ASRLAST     IS THIS LAST ASR RECORD              03067400
         BZ    RM2E110             NO, GO READ NEXT ASR                 03069400
         STM   RE,RC,RSREGSAV+12   SAVE REGISTERS               ZA02207 03069837
         L     R4,RSTCBAD          GET TCB ADDR                 ZA02207 03070237
         USING TCB,R4                                           ZA02207 03070637
         L     R4,TCBMSS           GET SUBPOOL PTR              ZA02207 03071037
         DROP  R4                                               ZA02207 03071137
         USING SPQESECT,R4         MAP SPQE                     ZA02207 03071237
         L     R3,RPMRGEND         GET REGION END               ZA02207 03071337
         S     R3,RPMCESA          GET SIZE TO FREE             ZA02207 03071437
RM2E152  EQU   *                                                ZA02207 03075137
         CLC   RPMCESA(N4),RPMRGEND IS CURR. START = REG. END           03079437
         BNL   RM2E161             YES, END OF REGION WAS ALLOCATED     03083237
RM2E153  EQU   *                                                ZA02207 03085237
         TM    SPQEFLGS,SPSHARE    SHARED SPQE?                 ZA02207 03085637
         BNO   RM2E154             NO, BRANCH                   ZA02207 03086037
         L     R4,SPDQEPTR         PTR TO OWNED SPQE            ZA02207 03086437
RM2E154  EQU   *                                                ZA02207 03086837
         CLI   SPQEID,SP0          IS SUBPOOL ZERO?             ZA02207 03086937
         BE    RM2E156             YES, BRANCH                  ZA02207 03089637
         L     R4,SPQEAD           GET NEXT SPQE                ZA02207 03091637
         B     RM2E153             GO CHECK FOR SP00            ZA02207 03092037
RM2E156  EQU   *                                                ZA02207 03092137
         L     R5,SPDQEPTR         GET DQE PTR                  ZA02207 03092237
         USING DQESECT,R5          MAP DQE                      ZA02207 03093037
RM2E157  EQU   *                                                ZA02207 03093437
         CLC   DQEBLKAD+1(3),RPMCESA+1  STARTING ADDR TO FREE?  ZA02207 03093837
         BE    RM2E158             YES, BRANCH                  ZA02207 03094237
         L     R5,DQEPTR           GET NEXT DQE PTR             ZA02207 03094337
         B     RM2E157             YES, BRANCH                  ZA02207 03094437
RM2E158  EQU   *                                                ZA02207 03094537
         L     R7,DQELNTH          GET LENGTH OF DQE            ZA02207 03095237
         LR    R0,R7               LENGTH TO FREE               ZA02207 03095637
         CR    R7,R3               FREE WHAT IS NEEDED          ZA02207 03096037
         BNH   RM2E159             YES, BRANCH                  ZA02207 03096437
         LR    R0,R3               LENGTH TO FREE               ZA02207 03096837
         LR    R7,R3               LENGTH TO ADD RPMCESA        ZA02207 03096937
RM2E159  EQU   *                                                ZA02207 03097737
         L     R1,DQEBLKAD         ADRESS TO FREE               ZA02207 03099737
         ICM   R0,M8,RMSP250       SET UP SUBPOOL NUMBER                03102237
         FREEMAIN R,LV=(0),A=(1)   FREE THE END OF THE REGION           03103137
         SR    R3,R7              DECREMENT LENGTH TO FREE      ZA02207 03103537
         BZ    RM2E161             ZERO TO FREE                 ZA02207 03103937
         A     R7,RPMCESA          ADD TO ADDR TO FREE NEXT     ZA02207 03104337
         ST    R7,RPMCESA          SAVE ADDR TO FREE NEXT       ZA02207 03104737
         B     RM2E152             NEXT DQE TO FREE             ZA02207 03104837
RM2E161  LM    RE,RC,RSREGSAV+12   RESTORE REGS                 ZA02207 03105137
         DROP  R4,R5                                            ZA02207 03105537
         SPACE 3                                                        03106000
*        THIS IS THE END OF CIR PROCESSING. THE REGION HAS BEEN         03108537
*        RESTORED.                                                      03111237
         DROP  R6                  BASE FOR ASR HEADER                  03113937
         EJECT                                                          03116637
*        THE FOLLOWING PROCESSING RESTORES THE VSM CONTROL BLOCKS       03119337
         SPACE 3                                                        03122037
         L     R6,RSBFOFST         GET OFFSET TO SUR BUFFER      Y02076 03124737
         AR    R6,RC               CALCULATE ADDRESS OF SUR BUFFER      03127437
         ST    R6,RSAREA1          SET ADDR OF SUR BUFFER INTO DECB1    03130137
         LA    RF,SURL             SET READ LENGTH = TO                 03132837
         STH   RF,RSLNGTH1         SUR BUFFER LEN                       03135537
         ST    R6,RSBFSTAD         INIT  BUFFER PTR TO START OF BUFFER  03138200
         SR    R3,R3               SET BLOCK LENGTH TO 0 FOR RPM500     03148200
         ST    R3,RSBFLWA          SET NO. OF BYTES LEFT IN BUF=0.      03158200
*                                  TO FORCE A READ ON FIRST CALL.       03158600
         BAL   RE,RPM500           READ IN FIRST SUR                    03158700
         SPACE 3                                                        03158800
*        START OF VSM CONTROL BLOCK PROCESSING                          03158900
         SPACE 3                                                        03165700
RPM600A  L     RF,CVTADDR(N0,N0)   GET CVT ADDR                @Z30ESHP 03166103
         USING CVTMAP,RF                                       @Z30ESHP 03166503
         L     R7,CVTTCBP          GET PTR TO NEXT TCB         @Z30ESHP 03166903
         LA    R7,CURASOFS(R7)     GET ADR OF CURR ASCB ADR    @Z30ESHP 03167303
         L     R7,N0(R7)           GET ADR OF CURR ASCB        @Z30ESHP 03167403
         ST    R7,USERASCB         SAVE FOR USE IN FREEMAIN    @Z30ESHP 03167503
         BAL   R7,LOCKGET          OBTAIN LOCAL LOCK           @ZM33369 03177503
         LA    R6,N2               SET COUNTER TO 2 TO SIGNIFY STC      03178103
*                                  SPQE/DQE/FQE'S BEING RESTORED        03179403
         NI    SWITCH,ON-LSPQE     RESET LAST SPQE SWITCH               03180503
         LA    R8,RPMMSS1          INIT. SPQE ANCHOR ADDRESS TO STC     03183603
*                                  CHAIN.                               03186703
RPM600   MVI   RMBLKSIZ+N3,SPQESIZE SET UP TO GM AN SPQE                03189803
         BAL   RD,RSGETA           GET CORE FOR AN SPQE        @Z30ESHP 03192903
         USING SPQESECT,R1         ADDRESS SPQE                         03196003
         CLI   SPQEKEY,KEY8        LOOK AT SPQE KEY              Y02076 03199103
         BL    RPM605              BR IF LESS THAN 8             Y02076 03202203
*                                  KEY IS NOT SUBJECT TO CHANGE  Y02076 03205303
         L     RF,RSTCBAD          GET TCB ADDRESS               Y02076 03208403
         USING TCB,RF              TCB                           Y02076 03211503
         MVC   SPQEKEY,TCBPKF      UPDATE PROTECT KEY            Y02076 03214603
         DROP  RF                  TCB                           Y02076 03217703
RPM605   TM    SPQEFLGS,LASTSPQE   IS IT LAST SPQE FOR TASK      Y02076 03220803
         BZ    RPM610              NO, CONTINUE                         03223903
         OI    SWITCH,LSPQE        YES, SET FLAG TO GO TO NEXT TASK     03227003
RPM610   CLI   SPQEID,SP0          IS SPQE FOR SP 0.                    03230103
         BNE   RPM620              NO, CONTINUE                         03233203
CKSP0LS  LA    RF,N1               CHECK TO SEE IF PROCESSING IS YM5714 03236302
         CR    R6,RF                 FOR THE INIT TCB            YM5714 03246302
         BNL   SAVLSPQ             YES, GO SAVE THE ADDRESS      YM5714 03256302
RPM6H4   MVC   SPDQEPTR,RSSTCSP0   POINT THIS SPQE TO INIT SPQE  YM5714 03266302
         DROP  R1                  SPQE                                 03276302
         USING SPQESECT,R8         ADDRESS SPQE                         03278302
RPM620   ST    R1,SPQEAD           CHAIN TO ANCHOR OR PREV SPQE  Y02076 03280302
         LR    R8,R1               UPDATE SPQE CHAIN REG                03282300
         LR    R4,R1               INIT. DQE CHAIN ANCHOR               03284300
         LA    R3,SPQESIZE         SPECIFY LENGTH OF PREVIOUS BLOCK     03284700
         BAL   RE,RPM500           GET NEXT INPUT BLOCK                 03285100
         MVI   RMBLKSIZ+N3,DQFQSIZE SET UP FOR SIZE OF DQE OR FQE       03285502
RPM6J3   CLI   N0(R3),DQECODE      IS IT A DQE                          03285900
         BE    PROCDQE             YES, GO PROCESS DQE'S                03286000
RPM6A5   TM    SWITCH,LSPQE        WAS THIS LAST SPQE FOR THE TASK      03286100
         BZ    RPM600              NO, PROCESS THIS NEXT SPQE           03286200
RPM6E42  NI    SWITCH,ON-LSPQE     YES, TURN OFF THE SWITCH             03302900
         BCTR  R6,R0               DECREMENT COUNTER BY 1.              03312900
         LTR   R6,R6               SEE WHICH TASK IS NEXT               03314900
         BP    RPM6E70             INITIATOR NEXT                       03316900
         BM    RPM504A             ALL DONE GO XCTL TO NEXT LOAD        03318900
         LA    R8,RPMMSS3          P/P NEXT, UPDATE CHAIN ANCHOR ADDR.  03319300
         B     RPM600              GO PROCESS P/P VSM BLOCKS            03319400
         SPACE                                                          03319500
RPM6E70  LA    R8,RPMMSS2          UPDATE CHAIN ANCHOR ADDR             03325100
         B     RPM600              GO PROCESS INITIATOR VSM BLOCKS      03327100
         SPACE                                                          03329100
RPM504A  LR    R1,RC               SET RSTWA ADDR TO GPR1               03329500
         L     RF,LOCLOCK          CHECK IF LOCK HELD          @Z30ESHP 03329603
         LTR   RF,RF               IS IT HELD                  @Z30ESHP 03329703
         BZ    RPM504B             BR IF NO                    @Z30ESHP 03329803
         BAL   R7,LOCKREL          RELEASE LOCAL LOCK          @ZM33369 03331803
         XC    LOCLOCK,LOCLOCK     CLEAR LOCAL LOCK SWITCH     @ZM33369 03333803
RPM504B  LA    RF,RPMXLIST         GET ADDR OF MODULE NAME     @Z30ESHP 03339503
         ST    RF,RPMN40AD         SAVE THE ADDRESS                     03342003
         LA    RF,RPMN40AD         GET THE ADDRESS OF THE ADDRESS       03344503
         XCTL  SF=(E,(15))         PASS CONTROL TO NEXT MODULE          03347003
         SPACE 3                                                        03349503
SAVLSPQ  ST    R1,RSSTCSP0         SAVE ADDR OF SUBPOOL 0 SPQE   YM5714 03352003
         B     RPM620              GO QUEUE THE SPQE.                   03354500
         DROP  R8                  SPQE                                 03356502
         SPACE 3                                                        03356900
*                    DQE/FQE PROCESSING                                 03357300
         SPACE 3                                                        03357700
         USING DQESECT,R4          R4 POINTS TO DQE OR SPQE. CHAIN FLD  03358100
*                                  WILL BE AT +4 REGARDLESS.            03358200
PROCDQE  BAL   RD,RSGETA           GET CORE AND MOVE DQE       @Z30ESHP 03358303
         STCM  R1,M7,DQEPTR+N1     PUT DQE ON CHAIN OFF SPQE            03358400
         LR    R4,R1               UPDATE DQE CHAIN PTR                 03363000
         LR    R9,R1               INIT. FQE CHAIN ANCHOR REG.          03365000
         USING FQESECT,R9          R9 POINTS TO DQE OR FQE. CHAIN FLD.  03367000
*                                  WILL BE AT +0 REGARDLESS.            03367400
RPMGE4   LA    R3,DQFQSIZE         SPECIFY LENGTH OF PREV. BLOCK        03367500
         BAL   RE,RPM500           GET NEXT INPUT BLOCK                 03367600
         CLI   N0(R3),FQECODE      IS IT AN FQE                         03367700
         BNE   RPM6J3              NO, GO BACK AND SEE IF IT'S A DQE    03372300
         BAL   RD,RSGETA           YES, GET CORE AND MOVE FQE  @Z30ESHP 03374303
         STCM  R1,M7,FQEPTR+N1     CHAIN FQE ON FQE CHAIN OFF DQE       03376300
         LR    R9,R1               UPDATE THE FQE CHAIN PTR             03376700
         B     RPMGE4              GO GET NEXT BLOCK.                   03376800
         DROP  R9,R4               FQE AND DQE                          03376902
         EJECT                                                          03377000
*        SUR BUFFER HANDLING ROUTINE.                                   03427000
*                                                                       03437000
*              ASSUMES R3 CONTAINS LENGTH OF PREVIOUS BLOCK.            03447000
*              RETURNS WITH ADDRESS OF CODE BYTE OF NEXT BLOCK IN R3    03457000
*              RETURNS ON RE.                                           03467000
*                                                                       03469000
*              SAVES AND RESTORES GPR'S 4 THRU E.                       03471000
*              RESTORES GPR1 FROM RSCORE TO PRESERVE ADDR OF LAST BLOCK 03473000
*              GETMAINED.                                               03475000
         SPACE                                                          03475400
RPM500   DS    0H                  SUR BUFFER DEBLOCKING ROUTINE        03475800
         STM   R4,RE,RMSAVAR       SAVE REGS IN REPMAIN SAVE AREA       03476200
         LA    RD,RSREGSAV         GET ADDRESS OF S/A FOR READ/CHECK    03476600
         L     R4,RSBFLWA          GET NO. OF BYTES LEFT IN SUR BUF     03476700
         LA    R3,N1(R3)           ADD 1 TO BLOCK LEN. FOR CTL CHAR.    03476800
         SR    R4,R3               COMPUTE NO. OF BYTES LEFT IN BUF.    03476900
         BNP   RPM505              BR. IF NO BYTES LEFT IN BUFFER       03493600
         A     R3,RSBFSTAD         COMPUTE NEXT BLOCK ADDRESS           03503600
         CLI   N0(R3),N0           IS THIS AN IDENTIFIER BYTE           03505600
         BE    RPM505              NO, GO READ THE NEXT RECORD          03507600
RPM506   ST    R3,RSBFSTAD         SAVE ADDRESS OF NEW DATA             03509600
         ST    R4,RSBFLWA          SAVE NO. OF BYTES LEFT IN BUFFER     03510000
         L     R1,RSCORE           RESTORE PTR TO LAST CORE OBTAINED    03510100
         LM    R4,RE,RMSAVAR       RESTORE REGS.                        03510200
         BR    RE                  RETURN TO CALLER                     03515800
         SPACE 3                                                        03517800
RPM505   L     R9,RSAREA1          GET ADDRESS OF SUR BUFFER FROM DECB  03519800
         L     R8,LOCLOCK          GET LOCAL LOCK SWITCH       @ZM33369 03519903
         LTR   R8,R8               IS LOC LOCK HELD            @ZM33369 03520003
         BZ    RPM505A             BRANCH IF NO                @ZM33369 03520103
         BAL   R7,LOCKREL          GO RELEASE LOC LOCK         @ZM33369 03521903
RPM505A  BAL   R8,READRTN          GO READ A RECORD            @ZM33369 03524403
         L     R8,LOCLOCK          DO WE NEED LOCK             @ZM33369 03524803
         LTR   R8,R8               FOR GETMAIN(P)              @ZM33369 03525203
         BZ    RPM505B             BRANCH IF NO                @ZM33369 03525603
         BAL   R7,LOCKGET          GO GET LOCK                 @ZM33369 03526003
RPM505B  LR    R3,R9               SET BLOCK ADDR = START OF BUFFER     03526203
         LA    R4,SURL             INITIALIZE BUFFER LENGTH             03528003
         B     RPM506              CLEAN UP AND RETURN                  03529803
         EJECT                                                          03531603
*        RSGET SUBROUTINE                                               03533403
*              INPUT= SIZE OF BLOCK AND ADDRESS OF DATA TO BE MOVED     03535200
*              OUTPUT= @ OF CORE OBTAINED AND DATA MOVED                03545200
*                                                                       03547200
*        RMSAVAR - CONTAINS LENGTH OF BLOCK TO BE GM'D AND MOVED.       03547600
*        R3 -  ADDRESS OF BLOCK TO BE MOVED - 1.                        03548000
*        RD -  RETURN REG                                               03548400
         SPACE                                                          03548800
RSGET    L     R0,RMBLKSIZ         GET LENGTH TO BE GM'D                03548900
         ICM   R0,M8,RMSP255       SPECIFY SUBPOOL 255                  03549000
         GETMAIN R,LV=(0)          GET THE CORE FROM 255                03549100
RSGETB   ST    R1,RSCORE           SAVE ADDRESS OF GM'D CORE   @Z30ESHP 03553703
         L     RF,RMBLKSIZ         GET THE LENGTH OF THE BLOCK          03555700
         BCTR  RF,R0               ADJUST FOR EXECUTE OF MOVE           03557700
         EX    RF,RM1MOVE          MOVE THE BLOCK                       03558100
         BR    RD                  RETURN TO CALLER                     03558200
RM1MOVE  MVC   N0(N1,R1),N1(R3)    BLOCK MOVER                          03558300
*                                                                       03565203
*   ENTRY PT FOR GETMAIN OF 16 BYTE CELLS FOR VSM BLOCKS       @Z30ESHP 03567203
*                                                                       03569203
RSGETA   IC    R0,RMSP255          SUBPOOL 255 IN BYTE 0       @Z30ESHP 03571203
         L     R7,USERASCB         GET USER'S ASCB ADR         @Z30ESHP 03571703
         GETMAIN P,SP=(R0),BRANCH=YES   GET 16 BYTE CELL       @Z30ESHP 03572003
         B     RSGETB              GO TO SAVE ADR              @Z30ESHP 03579803
         EJECT                                                          03587703
         SPACE 3                                                        03595103
*        READRTN - REPMAIN 1 I/O ROUTINE                                03602503
*                                                                       03609903
*              RETURNS ON GPR 8.                                        03617303
*              ASSUMES ADDRESS OF AREA TO BE READ INTO IS IN GPR 9.     03624703
         SPACE 3                                                        03632103
READRTN  DS    0H                                                Y02076 03639503
         READ  RSDECB1,SF,,(R9),,MF=E READ CIR/SUR               Y02076 03646903
         SPACE 3                                                        03654303
*        CKREAD1 SUBROUTINE - USED TO CHECK DECB1 AND TEST FOR ERROR.   03661700
         SPACE 3                                                        03661902
CKREAD1  CHECK RSDECB1             CHECK IT                             03666500
         CLI   RSRETCOD+N1,ZERO    WAS THERE AN ERROR           YA00153 03666902
         BNE   READER              YES, GO XCTL TO IGC0905B     YA00153 03667302
         BR    R8                  RETURN                               03667502
         SPACE 3                                                        03667600
*        AN I/O ERROR HAS BEEN ENCOUNTERED                              03684300
         SPACE 3                                                        03694300
READER   MVI   RPMXLIST+N4,CHAR9   MAKE XCTL GO TO REPMAIN 5.           03696300
         MVC   RSREGSAV(8),MODID   SAVE NAME OF MODULE THAT    @ZSUT222 03696437
*                                  HAS DETECTED THE ERROR      @ZSUT222 03696837
         STM   0,15,RSREGSAV+8     SAVE CURRENT REGISTERS      @ZSUT222 03697937
         B     RPM504A             GO XCTL.                             03698300
         SPACE 3                                                        03712000
*        REPMAIN 1 SYNAD ROUTINE                                        03725900
         SPACE 3                                                        03735900
SYNAD    MVI   RSRETCOD+N1,ERR035       SET I/O ERROR CODE     @ZSUT222 03737937
         L     R1,RSIOBPT1              GET ADDR OF IOB         YA00153 03738937
         TM    N13(R1),WLR              IS THIS WRONG LEN ERR   YA00153 03739937
         BCR   ZEROES,RE                NO - RETURN             YA00153 03740937
         MVI   RSRETCOD+N1,ERR041       SET WRONG LEN IND      @ZSUT222 03741937
         RETURN                                                         03744302
*                                                                       03744703
*    ROUTINE FOR GETTING LOCAL LOCK FOR GETMAIN/FREEMAIN (P)   @ZM33369 03745103
*                                                                       03745503
LOCKGET  LA    RF,RSREGSAV         GET ADDR REG SAV AREA       @ZM33369 03746303
         STM   RB,RE,N0(RF)        SAV REGS 11-14              @Z30ESHP 03746703
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                @Z30ESHP,03746803
               RELATED=(LOCREL,(IGC0505B,LOCKREL))             @Z30ESHP 03749703
         LTR   RD,RD               SETLOCK SUCCESSFUL          @Z30ESHP 03751703
         LM    RB,RE,N0(RF)        RESTORE REGS                @Z30ESHP 03752103
         BZ    RPM600C             BR IF YES                   @Z30ESHP 03752503
         MVI   RSRETCOD+N1,ERR202  SET ERROR CODE 202          @ZSUT222 03752637
         B     READER              BR TO ERROR EXIT            @Z30ESHP 03753037
RPM600C  ST    RF,LOCLOCK          SET LOC LOCK SWITCH         @Z30ESHP 03753237
         BR    R7                  RETURN TO CALLER            @ZM33369 03753403
*                                                                       03753503
*  ROUTINE TO RELEASE LOCAL LOCK BEFORE ENTERING READ ROUTINE  @ZM33369 03753603
*                                                                       03753703
LOCKREL  LA    RF,RMSAVAR+44       GET REG SAV AREA ADDR       @ZSUT222 03753837
         STM   RB,RE,N0(RF)        SAVE REGS 11-14             @Z30ESHP 03754203
         SETLOCK RELEASE,TYPE=LOCAL,                           @Z30ESHP,03754603
               RELATED=(LOCSET,(IGC0505B,LOCKGET))             @ZM33369 03755203
         LM    RB,RE,N0(RF)        RESTORE REGS                @Z30ESHP 03755603
         BR    R7                  RETURN TO CALLER            @ZM33369 03756203
         EJECT                                                          03756703
*        CONSTANTS                                                      03757303
         SPACE 3                                                        03758703
RM2NAME  DC    C'IGC0605B'         NAME OF REPMAIN2                     03761603
MODID    DC    CL8'IGC0505B'       MODULE ID                   @ZSUT222 03762637
RMSP250  DC    AL1(250)            SP NO. TO FREE PIECES OF REGION      03764503
RMSP255  DC    AL1(255)            SUBPOOL 255                          03767403
         SPACE 3                                                        03770302
*        PATCH AREA FOR MAINTENANCE OF 10%                              03772902
         SPACE 3                                                        03775502
PATCH    EQU   *                   END OF MODULE                        03778102
RM1LEN   EQU   PATCH-IGC0505B      LENGTH OF MODULE                     03780702
PATCHLEN EQU   RM1LEN/10           LENGTH OF PATCH AREA REQUIRED        03783302
RM1PATCH DS    CL(PATCHLEN)        PATCH AREA FOR MAINTENANCE           03785902
         SPACE 3                                                        03788502
*        REGISTER EQUATES                                               03791102
         SPACE 3                                                        03793702
R0       EQU   0                   REGISTER 0                           03796302
R1       EQU   1                   REGISTER 1                           03798902
R2       EQU   2                   REGISTER 2                           03801502
R3       EQU   3                   REGISTER 3                           03804102
R4       EQU   4                   REGISTER 4                           03806700
R5       EQU   5                   REGISTER 5                           03816700
R6       EQU   6                   REGISTER 6                           03826700
R7       EQU   7                   REGISTER 7                           03836700
R8       EQU   8                   REGISTER 8                           03846700
R9       EQU   9                   REGISTER 9                           03848700
RA       EQU   10                  REGISTER 10                          03850700
RB       EQU   11                  REGISTER 11                          03852700
RC       EQU   12                  REGISTER 12                          03854700
RD       EQU   13                  REGISTER 13                          03854800
RE       EQU   14                  REGISTER 14                          03854900
RF       EQU   15                  REGISTER 15                          03855000
         SPACE 3                                                        03871100
*        GENERAL EQUATES                                                03881100
         SPACE 3                                                        03883100
N0       EQU   0                   0                                    03885100
N1       EQU   1                   1                                    03887100
N2       EQU   2                   2                                    03887200
N3       EQU   3                   3                                    03892600
N4       EQU   4                   4                                    03894600
N6       EQU   6                   CONSTANT OF 6                 Y02076 03894802
N8       EQU   8                   8                                    03896600
N13      EQU   13                       CONSTANT 13             YA00153 03896702
N16      EQU   16                  16 - SIZE OF DQE/FQE                 03897000
N2048    EQU   2048                2048 - SIZE OF CIR AND ASR RECORDS   03897400
M7       EQU   7                   MASK FOR STORING 3 LO BYTES OF REG   03897800
M8       EQU   8                   MASK FOR ICM TO BYTE 0 OF REG.       03897900
TWOKBLK  EQU   2048                2K CORE                       YM7523 03907902
SPQESIZE EQU   16                  SIZE OF AN SPQE               Y02076 03911302
DQFQSIZE EQU   16                  SIZE OF DQE OR FQE                   03921300
FQECODE  EQU   X'02'               SUR CODE FOR FQE                     03923300
SPQECODE EQU   X'06'               SUR CODE FOR SPQE                    03923700
DQECODE  EQU   7                   SUR CODE FOR DQE                     03924100
ON       EQU   255                 ALL ONES.                            03924500
SURL     EQU   400                 LENGTH OF THE SUR BUFFER      YM7049 03924602
CHAR9    EQU   C'9'                EBCDIC 9                             03924700
ERR035   EQU   35                  I/O ERROR CODE              @ZSUT222 03924837
SP0      EQU   0                   SUBPOOL 0.                           03929300
KEY8     EQU   8                   CONSTANT FOR KEY 8            Y02076 03929502
ZERO     EQU   0                        0 FOR TESTING RET CODE  YA00153 03929902
ZEROES   EQU   8                        COND FOR BCR            YA00153 03930302
WLR      EQU   X'40'                    WRONG LNGTH RECORD      YA00153 03930702
*                                       INDICATION IN IOB       YA00153 03931102
ERR041   EQU   41                       ERROR CODE FOR WRONG   @ZSUT222 03931237
*                                       LENGTH RECORD WHILE     YA00153 03933702
*                                       READING CHKPT DATA SET  YA00153 03935702
CVTADDR  EQU   X'10'               CVT ADDR                    @Z30ESHP 03936103
CURASOFS EQU   X'0C'               OFFSET FOR CURRENT ASCB     @Z30ESHP 03936203
ERR202 EQU     202                 SETLOCK ERROR CODE          @ZSUT222 03936337
         EJECT                                                          03936502
*              DESCRIPTION OF REPMAIN WORK AREA                         03939002
         SPACE 3                                                        03941502
RPMWA1   DSECT                     REPMAIN WORK AREA DSECT              03944002
RPMERAS1 DS    F                   TEMP SAVE AREA                Y02076 03946502
RMNEOV   DS    A                   RESERVED                             03949002
RSBFSTAD DS    A                   BUFFER POINTERS                      03951502
RSBFLWA  DS    A                   *                                    03954000
RPMMSS1  DS    A                   ADDRESS OF NEW STC MSS CHAIN         03964000
RPMMSS2  DS    A                   ADDRESS OF NEW INIT MSS CHAIN        03964400
RPMMSS3  DS    A                   ADDRESS OF NEW P/P MSS CHAIN         03964800
RPMRB    DS    A                   ADDRESS OF RESTORED RB CHAIN         03965200
RPMLLE   DS    A                   ADDRESS OF RESTORED LLE CHAIN        03965600
RPMCDE   DS    A                   ADDRESS OF RESTORED CDE CHAIN        03965700
RPMDEB   DS    A                   ADDRESS OF RESTORED DEB CHAIN        03969500
RPMFOE   DS    A                   ADDRESS OF RESTORED FOE CHAIN        03971500
RSCORE   DS    A                   ADDRESS OF CORE ACQUIRED BY LAST GM  03971900
RSW001   DS    F                   *                                    03972300
RSW002   DS    F                   *                                    03972700
RPMSQE   DS    A                   ADDRESS OF DEQUEUED SPQE CHAIN       03973100
SWITCH   DS    F                   I/O SWITCH WORD                      03973200
LSPQE    EQU   4                   LAST SPQE FOR THIS TASK FLAG         03979100
RPMN40AD DS    A                   SET TO ADDRESS OF RPMXLIST           03979500
RPMXLIST DS    2F                  NAME OF NEXT MODULE TO GET CONTROL   03979900
RPMCESA  DS    F                   CURRENT ENTRY START ADDRESS          03980300
RPMRGEND DS    F                   ADDRESS OF END OF REGION             03980700
RMSAVAR  DS    15F                 REG SAVE FOR RPM500 RTN     @ZSUT222 03980837
RMBLKSIZ DS    F                   SIZE OF BLOCK TO BE GETMAINED.       03983737
RSSTCSP0 DS    F                   ADDR OF STC SPQE FOR SP 0.           03984700
RPMWAEND EQU   *                   END OF REPMAIN WORK AREA             03986700
         EJECT                                                          03987100
*              DSECT USED FOR ASR HEADER                                03987500
         SPACE 3                                                        03987900
ASRHDR   DSECT                                                          03988300
ASRCOUNT DS    H                   NUMBER OF ENTRIES IN ASR RECORD      03988400
ASRFLG1  DS    X                   ASR FLAG BYTE                        03988500
ASRLAST  EQU   X'80'               LAST ASR RECORD                      04023700
ASRRESV  DS    5X                  RESERVED                             04033700
         EJECT                                                          04043700
         IEEVRSWA                                                       04053700
USERASCB EQU   RSERAS00            USER ASCB ADDR              @Z30ESHP 04054103
LOCLOCK  EQU   RSERAS01            LOCAL LOCK HELD SWITCH      @Z30ESHP 04054503
         EJECT                                                          04055700
         IHAPSA                                                @Z30ESHP 04055803
         CVT                                                   @Z30ESHP 04056103
         IHAGDA                                                @Z30ESHP 04056503
         IHALDA                                                @Z30ESHP 04057303
         IHAWSAVT                                              @Z30ESHP 04057403
         IKJTCB                                                         04057700
         EJECT                                                          04058100
         IHAPQE                                                         04058500
         SPACE 5                                                        04058900
         IHASPQE                                                        04059000
         SPACE 5                                                        04059100
         IHADQE                                                         04070800
         SPACE 5                                                        04080800
         IHAFQE                                                         04081200
         EJECT                                                          04081600
         IHADCB DSORG=(BS,PO),DEVD=(DA,TA)                              04082000
         END                                                            04082437
./  ADD  SSI=81150476,NAME=IHJQRS21
RS21     TITLE 'IHJQRS21 AOS/2 REPMAIN 2 ROUTINE - IGC0605B'            01250000
*                                                                       01300000
* STATUS                                                                01350000
*                                                                       01400000
*    CHANGE LEVEL = 0                                                   01450000
*                                                                       01500000
* FUNCTION                                                              01550000
*                                                                       01600000
*    MODULE NAME - IHJQRS21                                             01650000
*                                                                       01700000
*    THIS MODULE OF THE RESTART FACILITY RECREATES THE CONTENTS         01750000
*    SUPERVISION AND TASK MANAGEMENT CONTROL BLOCKS AS THEY             01800000
*    EXISTED AT CHECKPOINT TIME. EXTENSIVE USE IS MADE OF SYSTEM        01850000
*    FUNCTIONS (LOAD, DELETE AND SPECIALIZED QUEUE SEARCH               01900000
*    ALGORITHMS) TO RECREATE THE LOAD LIST, JOB PACK AREA, REQUEST      01950000
*    BLOCK AN SUPERVISOR CONTROL BLOCK QUEUES                           01960000
*                                                                       01970000
* ENTRY POINTS                                                          01980000
*                                                                       01990000
*    REPMAIN 2 IS ENTERED FROM REPMAIN 1 (IGC0505B) TO PERFORM          01992000
*    THE ABOVE FUNCTION                                                 01994000
*                                                                       01996000
* INPUT                                                                 01998000
*                                                                       01998400
*    GPR 12 - CONTAINS THE ADDRESS OF THE RSTWA.                        01998800
*    THE DECB USED FOR READING THE RESTART DATA SET IS INITIALIZED      01999200
*    TO READ THE SUR'S.                                                 01999600
*    THE ADDRESS OF THE NEXT DATA BLOCK, AND THE NUMBER OF BYTES        01999700
*    LEFT IN THE BUFFER ARE IN THE RSTWA.                               01999800
*                                                                       01999900
* OUTPUT                                                                02049900
*                                                                       02059900
*    SAME AS THE ENTRY PARAMETERS FOR NORMAL EXIT.                      02069900
*                                                                       02079900
*    FOR ERROR EXIT AN ERROR CODE OF:                            Y02076 02089902
*           036 - TO INDICATE AN I/O ERROR ON CHECKPOINT D/S   @ZSUT222 02096937
*           042 - TO INDICATE WLR READ FROM CHECKPOINT D/S.    @ZSUT222 02097037
*           052 - TO INDICATE THAT A MODULE WHICH WAS BEING    @ZSUT222 02097137
*                 USED AT CHECKPOINT TIME IS NO LONGER AVAIL.  @ZSUT222 02097237
*           053 - TO INDICATE THAT A MODULE WHICH WAS BEING    @ZSUT222 02097337
*                 USED AT CHECKPOINT TIME IS LOCATED AT A      @ZSUT222 02097437
*                 DIFFERENT ADDRESS IN THE LPA OR NUCLEUS      @ZSUT222 02097537
*           201 - TO INDICATE A PAGE FIX (PGFIX) ERROR         @ZSUT222 02097637
*           202 - TO INDICATE A SETLOCK ERROR                  @ZSUT222 02097737
*                                                                       02098237
* EXTERNAL REFERENCES                                                   02098300
*                                                                       02098700
*         IEAVVMSR - TO SEARCH LINK PACK AREA DIRECTORY.                02099100
*         IEAQCDSR - TO SEARCH THE ACTIVE LPA QUEUE.                    02099500
*                                                                       02099600
* EXITS,NORMAL                                                          02099700
*                                                                       02099800
*    TO REPMAIN 3 (IGC0705B) TO RESTORE USER AND DATA MANAGEMENT        02149800
*    RELATED CONTROL BLOCKS.                                            02159800
*                                                                       02169800
* EXITS,ERROR                                                           02179800
*                                                                       02189800
*    TO REPMAIN 5 (IGC0905B) TO FREE ANY CONTROL BLOCKS USED BY         02191800
*    RESTART AND TO REINITIALIZE THE REGION FOR TERMINATION.            02193800
*                                                                       02195800
* TABLES/WORK AREAS                                                     02197800
*                                                                       02198200
*    RSTWA                                                              02198600
*                                                                       02199000
*    RPMWA1                                                             02199400
*                                                                       02199500
*    DCB       DCBSYNAD                                                 02199600
*                                                                       02199700
*    CDE       CDATTR                                            Y02076 02249702
*    CDE       CDCHAIN                                                  02259700
*    CDE       CDUSE                                             Y02076 02269702
*    CDE       CDXLMJP                                                  02279700
*    CDE       CDENTPT                                           Y02076 02280702
*                                                                       02289700
*    LLE       LLECHN                                            Y02076 02291702
*    LLE       LLECDPT                                           Y02076 02293702
*                                                                       02295700
*    RB        RBSIZE                                                   02297700
*    RB        RBSTAB1                                           Y02076 02298102
*    RB        RBSTAB2                                           Y02076 02298302
*    RB        RBCDFLGS                                          Y02076 02298402
*    RB        RBCDE1                                            Y02076 02298502
*    RB        RBOPSW                                                   02298900
*    RB        RBLINK                                                   02299300
*                                                                       02349600
*    CVT       CVTABEND                                                 02359600
*    CVT       CVTLPDSR                                          Y02076 02360602
*    CVT       CVTQCDSR                                          Y02076 02361602
*    CVT       CVTQLPAQ                                          Y02076 02362602
*                                                                       02369600
*    SCVT      SCVTSVCT                                                 02379600
*                                                                       02389600
*    SVC TABLE                                                   Y02076 02391602
*                                                                       02395600
*    SCB       SCBCHAIN                                                 02397600
*    SCB       SCBOWBRA                                                 02398000
*    SCB       SCBCODE                                           Y02076 02398202
*                                                                       02398400
*    FOE       FOEFLINK                                                 02398800
*    FOE       FOEFXCT                                           Y02076 02399002
*    FOE       FOEVINDX                                                 02399200
*                                                                       02399300
*    TCB       TCBPKF                                            Y02076 02400302
*                                                                Y02076 02400502
*    XTLST     XTLLNTH                                           Y02076 02400702
*                                                                Y02076 02400902
*    PSA       PSALITA                                           Y02076 02401102
*                                                                       02401302
* ATTRIBUTES                                                            02402302
*                                                                       02449500
*    KEY 0, SUPERVISOR STATE, ENABLED                                   02459500
*                                                                       02469500
* CHARACTER CODE DEPENDENCY                                             02479500
*                                                                       02489500
*    NONE                                                               02491500
*                                                                       02493500
* NOTES                                                                 02495500
*                                                                       02497500
*    THIS MODULE OF RESTART RECREATES THE JOB PACK AREA CDE             02497900
*    QUEUE, THE P/P LLE QUEUE, THE TASK RB QUEUE, AND THE               02498300
*    TASK SCB QUEUE. UPON ENTRY THE FOLLOWING INITIALIZATION            02498700
*    PROCESSING OCCURS.                                                 02499100
*                                                                       02499200
*    - THE @ OF RPMWA1 IS OBTAINED FROM RSTWA                           02499300
*    - THE REPMAIN 2 SYNAD ROUTINE ADDRESS IS PLACED IN THE DCB         02499400
*    - THE DEFAULT EXIT MODULE NAME IS SET TO REPMAIN 3 (IGC0705B)      02549400
*    - THE @ OF THE NEXT DATA BLOCK IS OBTAINED FROM RPMWA1.            02559400
*                                                                       02569400
*                                                                       02579400
*    'RESTORING THE JOB PACK AREA CDE QUEUE (JPQ)'                      02589400
*                                                                       02591400
*    THIS ROUTINE RESTORES THE MAJOR/MINOR JOB PACK AREA CDE            02593400
*    QUEUE AS WELL AS THE EXTENT LIST FOR EACH MODULE LOADED INTO       02595402
*    THE USER REGION. THE RESTORED QUEUE IS ANCHORED IN THE             02597400
*    REPMAIN WORK AREA IN THE EXACT ORDER AS AT CHECKPOINT TIME.        02597800
*                                                                       02598200
*                                                                       02598600
*    'RESTARTING THE P/P LLE CHAIN'                                     02599000
*                                                                       02599100
*    THIS ROUTINE RECREATES THE P/P LLE CHAIN AS IT EXISTED AT          02599200
*    CHECKPOINT TIME. THE RESTORED CHAIN IS ANCHORED TO THE             02599300
*    RPMWA1 LLE QUEUE HEADER. TWO TYPES OF LLE ARE PROCESSED,           02649300
*    THE FIRST TYPE, AN 'LLE WITH A CDE IN THE JPQ' HAS A               02659300
*    POSITION INDEX, CREATED AT CHECKPOINT TIME, TO THE CORRECT         02669300
*    CDE ON THE JPQ. THIS INDEX IS IN THE LLCDPTR FIELD OF THE          02679300
*    LLE. THE SECOND TYPE OF LLE, 'LLE WITH A CDE ON THE ACTIVE         02689300
*    LPAQ', CONTAINS AN APPENDAGE WITH THE ENTRY POINT NAME AND         02691300
*    ADDRESS OF THE 'LOADED' PROGRAM. IN EACH CASE, IT IS NECESSARY     02693300
*    TO FIND THE CDE FOR THE LLE AND RECONSTRUCT THE LLE CHAIN.         02695300
*                                                                       02697300
*                                                                       02697700
*    'RESTARTING THE P/P RB QUEUE'                                      02698100
*                                                                       02698500
*    THIS ROUTINE RECREATES THE RB QUEUE AS IT EXISTED AT               02698900
*    CHECKPOINT TIME. THE RESTORED CHAIN IS ANCHORED TO THE RPMWA1      02699000
*    RB QUEUE HEADER. SEVERAL RB TYPES ARE POSSIBLE, AND EACH           02699100
*    REQUIRES SPECIAL PROCESSING. FOR THOSE RB'S REPRESENTING           02699200
*    PROGRAMS IN THE SYSTEM NUCLEUS OR LINK PACK AREA, THE LOCATION     02749200
*    OF THE ROUTINE AT RESTART TIME MUST BE THE SAME AS AT              02759200
*    CHECKPOINT TIME. IF THIS IS NOT THE CASE, RESTART CANNOT           02769200
*    CONTINUE, AND ERROR PROCEDURES MUST BE INVOKED. FOR THOSE RB'S     02779200
*    REPRESENTING PROGRAMS IN THE JPQ, THE POINTER TO THE CDE MUST      02789200
*    BE RE-SET IN THE RB.                                               02791200
*                                                                       02793200
*                                                                       02795200
*    'RESTORING THE P/P STAE CONTROL BLOCKS'                            02797200
*                                                                       02797600
*    THIS ROUTINE RESTORES THE TCBNSTAE FLAGS AND THE SCB CHAIN         02798000
*    AS IT EXISTED AT CHECKPOINT TIME. THE RESTORED CHAIN IS            02798400
*    ANCHORED TO THE RPMWA1 SCB QUEUE HEADER. IT SHOULD BE NOTED        02798800
*    THAT CHECKPOINT OUTPUTS ALL SCB'S WHILE RESTART RECREATES          02798900
*    ONLY STAE SCB'S. THUS AN SCB FOR A STAI REQUEST IS NOT             02799000
*    RESTARTED.                                                         02799100
*                                                                       02849100
*                                                                       02859100
*    'RESTORING THE P/P FOE CONTROL BLOCKS'                             02869100
*                                                                       02879100
*    THIS ROUTINE RESTORES THE FOE CHAIN CHECKPOINTED BY                02889100
*    CHECKMAIN 2.  IT INVOKES THE PGFIX SERVICE ROUTINE TO              02891100
*    REINSTATE THE FOE CHAIN IN THE P/P TCB.  THE RESTORED              02893100
*    FOE CHAIN ANCHORED IN THE REPMAIN WORK AREA IS SAVED               02895100
*    FOR LATER PROCESSING BY REPMAIN 4 TO ADJUST THE FIX                02897100
*    COUNTS ON THE P/P TCBFOE QUEUE.                                    02897500
*                                                                       02897900
* VS2-REL 3 - CHANGES/DELETIONS:                                        02898002
* 041498,046900                                                @ZA01488 02898102
* 043585-043611                                                @ZA02857 02898202
* 039620                                                       @Z30ESHP 02903102
* 036722                                                       @ZA03177 02903337
* A04054800-04055800                                           @ZA11616 02908137
*A044262-044278,A044310,A044354-044446,A046010                 @ZA14558 02909137
*C037065                                                       @ZA18323 02910137
*A044370,A044390,C044374                                       @ZA19627 02911137
* APAR OZ31479 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 02911437
*C035610,035850,036394,036730,041558,041708,043673,043828      @ZSUT222 02911737
*C045551,045591,045695,046948,046964-046972,046976,046980      @ZSUT222 02912037
*C047034                                                       @ZSUT222 02912237
*A036740-036772,046032,046952-046960                           @ZSUT222 02912437
     EJECT                                                              02913002
IGC0605B CSECT                                                          02917902
         BALR  RB,R0               ADDRESSABILITY FOR CODE              02922802
         USING *,RB                CODE                                 02927702
         USING RSTWA,RC            RESTART WORK AREA                    02932600
         B     RPMNST              GO AROUND ID                         02942600
         DC    H'0'                ALIGNMENT                            02952600
         DC    CL8'IGC0605B'       MODULE NAME                 @ZSUT222 02962637
         DC    CL8'&SYSDATE'       LAST DATE SHIPPED           @ZSUT222 02963137
         DC    CL8'@ZSUT222'       LAST CODE SHIPPED           @ZSUT222 02963637
RPMNST   L     R9,RSMWOFST         OFFSET TO REPMAIN'S WORK AREA        02964600
         AR    R9,RC               ESTABLISH BASE FOR REPMAIN'S W. A.   02965000
         USING RPMWA1,R9           REPMAIN WORK AREA                    02965400
         LA    R2,RSBDCB           @ OF RESTART DCB                     02965800
         USING IHADCB,R2           DCB                                  02966200
         LA    R7,RPM127           GET @ OF REPMAIN 2 SYNAD ROUTINE     02966300
         STCM  R7,M7,DCBSYNA       PUT IT IN RESTART DCB                02977500
         MVC   RPMN40(N8),RM3NAME  SET DEFAULT EXIT TO IGC0705B         02987500
         DROP  R2                  DCB                                  02987900
         XC    RSAPPLNT,RSAPPLNT   CLEAR SUR APPENDAGE LENGTH CELL      02988300
         MVI   RSSWIT1,N0          CLEAR THE SWITCH BYTE                02988700
         L     R7,RSBFSTAD         GET @ OF NEXT DATA BLOCK IN SURBUF   02992400
         CLI   N0(R7),CDECODE      IS NEW BLOCK A CDE                   02992802
         BNE   R11C1               NO-PROCESS LLE CHAIN                 02993200
         LA    R4,RPMCDE           GET @ OF JPQ ANCHOR IN RPMWA1        02994400
R10A2    LA    R3,CDELEN           GET LENGTH OF A CDE                  02994800
         ST    R3,RPLNT            SET LENGTH FOR RSGET AND BUFFER RTN  02995200
         BAL   RD,RSGET            GET LSQA SPACE AND MOVE THE CDE      02995600
         USING CDENTRY,R4          CDE PREV.                            02996000
         ST    R1,CDCHAIN          CHAIN CDE TO PREVIOUS CDE     Y02076 02996102
         BAL   RE,R13A1            READ NEXT DATA                       02996200
         DROP  R4                  CDE PREV.                            03046200
         USING CDENTRY,R1          CDE CURRENT                          03056200
         TM    CDATTR,CDMIN        IS THIS CDE A MINOR                  03066200
         BO    R10F2               YES, GO SEE IF LAST CDE WAS ALSO     03076200
         DROP  R1                  CDE CURRENT                          03086200
         LR    R4,R1               NO, MAJOR SO NEW BLOCK CAN BE XL     03088200
         L     R7,RSBFSTAD         GET @ OF NEW BLOCK SUR CODE          03090200
         CLI   N0(R7),XLCODE       IS NEW BLOCK AN EXTENT LIST          03092200
         BNE   R10C2               NO. GO SEE IF CDE'S DONE             03094200
         OI    RSSWIT1,BIGBLOCK    SET BIG BLOCK SWITCH                 03094600
         LA    RF,N1(R7)           GET BASE OF XL IN SUR BUFFER         03095000
         USING XTLST,RF            EXTENT LIST                          03095400
         ICM   R0,MF,XTLLNTH       GET LENGTH OF THE EXTENT LIST        03095800
         ST    R0,RPLNT            SET UP LENGTH OF BLOCK FOR RSGET,    03095900
*                                  BUFFER HANDLER FOR MOVE              03096000
         DROP  RF                  EXTENT LIST                          03096100
         BAL   RD,RSGET            GM THE XL BUT DON'T MOVE IT          03112800
         USING CDENTRY,R4          CDE PREVIOUS                         03122800
         ST    R1,CDXLMJP          PUT @ OF XL IN CDE            Y02076 03124802
         BAL   RE,R13A1            GO MOVE XL AND READ NEXT DATA        03126800
         SPACE 3                                                        03128800
R10C2    L     R6,CDCHAIN          GET @ NEXT CDE FROM PREV.            03129200
         LTR   R6,R6               IS IT LAST CDE                       03129400
         BZ    R11C1               YES, GO DO LLE'S                     03135000
         B     R10A2               NO, GO DO NEXT CDE                   03137000
         SPACE 3                                                        03139000
R10F2    TM    CDATTR,CDMIN        WAS PREV. CDE A MINOR                03139400
         BZ    R10F3               NO, GO PUT @ OF MAJ IN MINOR         03139800
         L     R4,CDXLMJP          YES, GET @ OF MAJ FROM MINOR         03140200
         DROP  R4                  CDE PREVIOUS                         03140300
         USING CDENTRY,R1          CDE CURRENT                          03140400
R10F3    ST    R4,CDXLMJP          PUT @ OF MAJ CDE INTO MINOR   Y02076 03140502
         LR    R4,R1               MAKE CURRENT PREVIOUS                03190500
         B     R10C2               TEST FOR LAST CDE                    03200500
         DROP  R1                  CDE CURRENT                          03210500
         EJECT                                                          03220500
*                                                                       03230500
*        RESTARTING THE P/P LLE CHAIN                                   03232500
*                                                                       03234500
         SPACE 3                                                        03236500
R11C1    LA    RA,RPMLLE           GET @ OF REPMAIN LLE ANCHOR          03238500
R11D1    L     R7,RSBFSTAD         GET @ OF CHECKCODE FOR BLOCK         03238900
         CLI   N0(R7),LLEJCODE     IS THIS AN LLE W/CDE ON JPQ          03239300
         BE    R11D11              YES, GO RESTART IT                   03239700
         CLI   N0(R7),LLELCODE     IS THIS AN LLE W/CDE ON LPAQ         03240100
         BNE   R11RB               NO, GO DO RB CHAIN                   03240200
R11D11   LA    R0,LLELEN           GET LENGTH OF LLE                    03240300
         ST    R0,RPLNT            SET SIZE TO GET AND MOVE             03240400
         BAL   RD,RSGET            GET AND MOVE THE LLE                 03257100
         USING LLE,RA              LLE                                  03267100
         ST    R1,LLECHN           PUT LLE ON RPMWA LLE CHAIN    Y02076 03269102
         LR    RA,R1               UPDATE CHAIN POINTER                 03271100
         CLI   N0(R7),LLELCODE     IS IT AN LLE W/CDE ON LPAQ           03273100
         BNE   R11D1B              NO, GO FIND CDE ON JPQ               03273500
         BAL   RE,RPMCDLDR         GO, CREATE CDE ON LPAQ               03273600
R11D1A   ST    R1,LLECDPT          PUT @ OF CDE IN LLE           Y02076 03273702
         BAL   RE,R13A1            GET NEXT DATA BLOCK                  03279300
         B     R11D1               GO PROCESS NEXT BLOCK                03281300
         SPACE 3                                                        03283300
R11D1B   SR    R0,R0               GET CDE POSITION INDEX FROM LLE      03283700
         L     R0,LLECDPT          FOR SEARCH ROUTINE            Y02076 03284102
         BAL   RE,RPMJPQS          GO FIND CDE ON JPQ                   03284500
         B     R11D1A              GO PUT CDE ADDRESS IN LLE            03284600
         DROP  RA                  LLE                                  03284700
         EJECT                                                          03284800
*                                                                       03334800
*        RESTARTING THE P/P RB QUEUE                                    03344800
*                                                                       03354800
         SPACE 3                                                        03364800
R11RB    LA    RA,RPMRB            GET @ OF RB ANCHOR CELL IN RPMWA1    03374800
         S     RA,RMRBLINK         ADJUST CHAIN TO POINT TO RBPRFXST    03376800
R10G3    L     R7,RSBFSTAD         GET @ OF SUR BLOCK                   03378800
         LA    R1,N1(R7)           BUMP PAST CHECKCODE                  03380800
         USING RBPRFXST,R1         RB IN SUR BUFFER                     03382800
         SR    R0,R0               CLEAR REG                            03383200
         ICM   R0,M3,RBSIZE        GET RBSIZE IN DOUBLE WORDS           03383600
         SLL   R0,N3               MULTIPLY BY 8 TO GET LEN IN BYTES    03384000
         ST    R0,RPLNT            SET BLOCK LENGTH=LENGTH OF RB        03384400
         BAL   RD,RSGET            GETMAIN AND MOVE THE RB              03384500
         DROP  R1                  RB IN SUR BUFFER                     03384600
         USING RBPRFXST,RA         RB ANCHOR PTR                        03384700
         LA    R0,RBPRFLNA(R1)     ADJUST ADDRESS BEYOND PREFIX         03401400
         STCM  R0,M7,RBLINKB       PUT RB ON REPMAIN RB QUEUE IN W/A    03411400
         LR    RA,R1               UPDATE CHAIN ANCHOR                  03413400
         L     R5,RSTCBAD          GET ADDR OF RESTART TCB              03415400
         STCM  R5,M7,RBLINKB       PUT IT IN RB                         03417400
         TM    RBSTAB1,RBFTSVRB    IS IT AN SVRB                        03417800
         BO    R10G3A              YES, GO HANDLE SVRB'S                03417900
         USING TCB,R5              TCB                                  03418000
         MVZ   RBOPSW+N1(N1),TCBPKF MOVE PROTECT KEY TO PSW             03423602
         DROP  R5                  TCB                                  03425600
         CLI   N0(R7),PRBSCODE     IS IT A SYNCHED PRB                  03427600
         BE    R10G3K              YES, GO GET NEXT BLOCK               03428000
         CLI   N0(R7),PRBLCODE     IS IT PRB W/CDE ON LPAQ              03428400
         BNE   R10G3F              NO, PRB W/CDE ON JPQ                 03428800
         BAL   RE,RPMCDLDR         GO CREATE CDE ON LPAQ                03428900
R10G3G   STCM  R1,M7,RBCDE1        PUT @ OF CDE IN RB                   03429000
R10G3K   BAL   RE,R13A1            GET @ OF NEXT DATA BLOCK             03429100
         TM    RBSTAB2,RBTCBNXT    WAS IT THE LAST RB                   03479100
         BO    R11A3               YES, GO DO STAE CONTROL BLOCKS       03489100
         B     R10G3               GO PROCESS THE NEXT RB               03499100
R10G3F   SR    R0,R0               GET CDE POSITION INDEX ON JPQ        03509100
         ICM   R0,M7,RBCDE1        FOR SEARCH ROUTINE                   03519100
         BAL   RE,RPMJPQS          GO FIND CDE ON JPQ                   03521100
         B     R10G3G              GO PUT @ OF CDE IN RB                03523100
         SPACE 3                                                        03525100
R10G3A   LA    R6,N1(R7)           GET PAST SURCODE                     03527100
         XC    RBCDE1,RBCDE1       CLEAR POSSIBLE CDE ADDR       YM7054 03527202
         OI    RBCDFLGS,RBNOCELL   PREVENT SUBSEQUENT FREECELL   Y02076 03527302
         A     R6,RPLNT            GET ADDRESS OF SUR APPENDAGE         03527500
         CLI   N0(R7),SVRB234C     IS IT A TYPE 2,3,4 SVRB              03527900
         BE    R10G3B              YES, GO FIND EP FROM SVC TABLE       03528300
*        THEN SVRB MUST BE FOR TYPE 4 NTH LOAD (N>=2)                   03528700
         CLI   N0(R7),SVRBEOVC     SVRB FOR EOV                  Y02076 03528802
         BNE   R10G3A1             BR NO                         Y02076 03529002
         SR    RF,RF               SET APP LENGTH                Y02076 03529102
         MVC   RSERAS00(8),EOVRETNM SETUP EOV-EXIT RETURN NAME   YM7050 03529502
         LA    R6,RSERAS00         POINT REG 6 TO IT             YM7050 03534202
         B     R10G3A1A            GO FIND CDE WITH EP           YM7050 03537002
R10G3A1  LA    RF,RBLPALEN         SET APPENDAGE LENGTH FOR AN   Y02076 03538602
R10G3A1A ST    RF,RSAPPLNT         RB W/CDE ON LPAQ.                    03540202
         LA    RF,RSREGSAV         GET SAVEAREA ADDR             Y02076 03541802
         STM   R0,RF,N0(RF)        SAVE REGS                     Y02076 03543402
R10G3A2  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        ,03545002
               RELATED=(LOCAL,IGC0605B(R10G3A5))                 Y02076 03546602
         LTR   RD,RD               SETLOCK SUCCESSFUL            Y02076 03548202
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 03549802
         BNZ   RPMSLERR            IF NOT, BR                    Y02076 03551402
R10G3A3  SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                          ,03553002
               RELATED=(CMS,IGC0605B(R10G3A4))                   Y02076 03554602
         LTR   RD,RD               SETLOCK SUCCESSFUL            Y02076 03556202
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 03557802
         BZ    R10G3A3B            IF YES, BR                    Y02076 03559402
         MVI   RSRETCOD+N1,ERR202  STORE SETLOCK ERROR CODE    @ZSUT222 03561037
         B     R10G3A5             GO RELEASE LOCAL LOCK         Y02076 03562602
R10G3A3B BAL   RE,CDSEARCH         FIND THE CDE ON THE LPAQ      Y02076 03564202
         LTR   R2,R2               CDE FOUND                     Y02076 03565802
         BZ    R10G3A3C            IF NOT, BR                    Y02076 03567402
         USING CDENTRY,R2          ADDRESS CDE                   Y02076 03569002
         L     R1,CDENTPT          GET EPA BEFORE CDE MOVES      Y02076 03570602
         DROP  R2                  CDE                           Y02076 03572202
R10G3A3C LA    RF,RSREGSAV         GET SAVEAREA ADDR             Y02076 03573802
         STM   R0,RF,N0(RF)        SAVE REGS                     Y02076 03575402
R10G3A4  SETLOCK RELEASE,TYPE=CMS,                                     ,03577002
               RELATED=(CMS,IGC0605B(R10G3A3))                   Y02076 03578602
R10G3A5  SETLOCK RELEASE,TYPE=LOCAL,                                   ,03580202
               RELATED=(LOCAL,IGC0605B(R10G3A2))                 Y02076 03581802
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 03583402
         CLI   RSRETCOD+N1,ERR202  SETLOCK ERROR               @ZSUT222 03585037
         BE    RPMERR              IF YES, BR                    Y02076 03586602
         CLI   N0(R7),SVRBEOVC     SVRB FOR EOV                  YM7050 03587002
         BNE   R10G3A5A            IF NOT, SKIP EOV PROCESSING   YM7050 03587402
         LTR   R2,R2               WAS CDE FOUND                 YM7050 03587802
         BZ    R10G3A6             IF NOT, LOOK ON LPAQ          YM7050 03587902
         LR    R0,R1               EPA TO REG 0                  YM7050 03588002
         B     R10G3A8A            GO UPDATE EOV PSW             YM7050 03588102
R10G3A5A LTR   R2,R2               CDE FOUND                     YM7050 03593402
         BNZ   R10G3C              YES, GO SEE IF SVRB IS RESIDENT      03595402
         TM    RBSTAB1,RBTRSVRB    IS IT A TRANSIENT SVRB               03597402
         BZ    R11A5               NO, RESIDENT SO CANNOT RESTART       03599402
R10G3A6  ICM   R0,MF,N0(R6)        GET LEFT HALF OF NAME         YM7050 03601402
         ICM   R1,MF,N4(R6)        GET RIGHT HALF OF NAME        Y02076 03603402
         LA    RF,RSREGSAV         ADDRESS REG SAVEAREA          Y02076 03607402
         STM   R0,RF,N0(RF)        SAVE REGS                     Y02076 03609402
R10G3A7  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        ,03611402
               RELATED=(LOCAL,IGC0605B(R10G3A8))                 Y02076 03613402
         LTR   RD,RD               SETLOCK ERROR                 Y02076 03615402
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 03617402
         BNZ   RPMSLERR            IF SETLOCK ERROR, BR          Y02076 03619402
         STM   R6,R9,CKSAVAR6      SAVE REGS ACROSS IEAVVMSR     Y02076 03621402
         DROP  R9                  RPMWA1 PERM                          03623402
         LR    R2,R9               SET UP TEMPORARY BASE FOR RPMWA1     03625402
         USING RPMWA1,R2           RPMWA1 TEMP                          03627402
         L     R3,CVTPTR           GET @ OF CVT                         03629402
         USING CVT,R3              CVT                                  03631402
         L     RE,CVTLPDSR         GET @ OF IEAVVMSR                    03633402
         BALR  RE,RE               SEARCH FOR LPDE                      03635402
         B     R11CEPA             FOUND, GO RESTORE AND COMPARE EP'S   03637402
         MVI   RSRETCOD+N1,ERR052  NOT FOUND, SET LPAQ ERR CODE@ZSUT222 03639437
         B     R10G3A7B            GO RELEASE LOCAL LOCK         Y02076 03641402
R11CEPA  LM    R6,R9,CKSAVAR6      RESTORE REGS                  Y02076 03643402
         LR    R1,R0               GET BASE FOR CDE                     03653400
         USING CDENTRY,R1          CDE                                  03663400
         L     R0,CDENTPT          GET EPA BEFORE CDE MOVES      Y02076 03664402
R10G3A7B LA    RF,RSREGSAV         ADDRESS REG SAVEAREA          Y02076 03665402
         STM   R0,RF,N0(RF)        SAVE REGS ACROSS SETLOCK      Y02076 03666402
R10G3A8  SETLOCK RELEASE,TYPE=LOCAL,                                   ,03667402
               RELATED=(LOCAL,IGC0605B(R10G3A7))                 Y02076 03668402
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 03669402
         CLI   RSRETCOD+N1,N0      ERROR ENCOUNTERED             Y02076 03670402
         BNE   RPMERR              IF ERROR, GO XCTL TO 905B     Y02076 03671402
         CLI   N0(R7),SVRBEOVC     SVRB FOR EOV                  Y02076 03671602
         BNE   R10G3A9             IF NOT, BR                    Y02076 03671802
R10G3A8A STCM  R0,M7,RBOPSW+N5     UPDATE EOV RETURN ADDRESS     YM7050 03672002
         B     R10G3K              GO GET NEXT RB                Y02076 03672102
R10G3A9  CLM   R0,M7,N9(R6)        RESTART EPA MATCH CHECKPOINT ZA03177 03672237
         BE    R10G3G              IF YES, GO UPDATE RB LPDE @   Y02076 03672402
         DROP  R2,R3               RPMWA1 TEMP, CVT                     03672502
         USING RPMWA1,R9           RPMWA1 PERM                          03672600
R11A5    MVI   RSRETCOD+N1,ERR053  SET LPAQ ERROR CODE IN RSTWA@ZSUT222 03673037
RPMERR   MVI   RPMN40+N4,CHAR9     SET TO XCTL TO IGC0905B              03673837
         MVC   RSREGSAV(8),MODID   SAVE NAME OF MODULE THAT    @ZSUT222 03674037
*                                  HAS DETECTED THE ERROR.     @ZSUT222 03674237
         STM   0,15,RSREGSAV+8     SAVE CURRENT REGS           @ZSUT222 03677237
         B     R11A4               GO XCTL                              03679237
         SPACE 3                                                        03681237
*                                                                       03690000
*        CDE FOUND ON ACTIVE LPAQ                                       03700000
*                                                                       03702000
R10G3C   TM    RBSTAB1,RBTRSVRB    IS IT A TRANSIENT SVRB               03704000
         BO    R11A5               NO - ERROR ON LPAQ - SET CODE,XCTL   03706000
         USING CDENTRY,R2          CDE                                  03706400
         CLM   R1,M7,N9(R6)        RESTART EPA MATCH CHECKPOINT ZA18323 03706537
         BNE   R11A5               NO - ERROR - SET CODE AND XCTL       03706600
         DROP  R2                  CDE                                  03712200
         LR    R1,R2               YES, MOVE ADDR FOR STORE             03714200
         B     R10G3G              GO STORE CDE @ IN RB.                03716200
         SPACE 3                                                        03716600
*        SVRB IS FOR TYPE 2, 3, OR 1ST LOAD OF TYPE 4 SVC.              03717000
         SPACE 3                                                        03717400
R10G3B   SR    R0,R0               CLEAR INDEX REG                      03717500
         IC    R0,N4(R6)           GET  SVC NUMBER FROM SUR APPENDAGE   03717600
         L     RE,CVTPTR           GET @ OF CVT                         03717700
         USING CVT,RE              CVT                                  03767700
         L     RE,CVTABEND         GET @ OF SECONDARY CVT               03777700
         DROP  RE                  CVT                                  03787700
         USING SCVTSECT,RE         SCVT                                 03797700
         L     RE,SCVTSVCT         GET @ OF SVC TABLE (IBMORG)          03807700
         DROP  RE                  SCVT                                 03809700
RMT234EP SLL   R0,N3               MAKE SVC NO. AN INDEX         Y02076 03816502
         AR    RE,R0               GET @ OF SVC TABLE ENTRY             03816900
         LA    R0,SVRB234A         GET APPENDAGE LENGTH FOR T234 SVRB   03817300
         ST    R0,RSAPPLNT         PUT IT IN RPMWA1 FOR BUFFER HANDLER  03817400
         CLC   N1(N3,RE),N1(R6)    ENTRY POINT @ OK.                    03817500
         BE    R10G3K              YES, GO GET NEXT BLOCK               03817600
         B     R11A5               NO, GO SET LPAQ ERROR AND XCTL       03834300
         EJECT                                                          03860500
*                                                                       03860900
*        STAE CONTROL BLOCK PROCESSING                                  03861300
*                                                                       03861700
         SPACE 3                                                        03861800
R11A3    L     R7,RSBFSTAD         GET @ OF SUR ENTRY                   03861902
         MVC   RSNSTAE(N4),N1(R7)  MOVE STAE INFO TO WORKAREA           03862002
         LA    R4,RSNSTAE          GET @ OF SCB ANCHOR IN RPMWA1        03912002
         XC    N1(N3,R4),N1(R4)    SET LAST SCBCHAIN FIELD TO 0.        03922000
         LA    R3,NSTAELEN         SET BLOCK LENGTH TO                  03932000
         ST    R3,RPLNT            LENGTH OF STAE FIELD                 03942000
R11A3A   BAL   RE,R13A1            GET @ OF NEXT DATA BLOCK             03952000
         CLI   N0(R7),SCBCODE      IS THIS AN SCB                       03954000
         BNE   RPMFOE1             NO, GO PROCESS FOE'S                 03956000
         LA    R3,SCBLEN           LENGTH OF AN SCB                     03958000
         ST    R3,RPLNT            SET LENGTH TO GETMAIN                03960000
         LA    RF,N1(R7)           GET @ OF SCB IN SUR BUFFER           03960400
         USING SCB,RF              SCB IN BUFFER                        03960800
         ICM   RE,M7,SCBOWNRA      IS RB POSITION INDEX 0 (STAI SCB)    03961200
         BZ    R11A3A              YES, STAI SCB SO DO NOT RESTART      03961600
         DROP  RF                  SCB IN BUFFER                        03961700
         LR    R0,R3               INIT R0 FOR GETMAIN           Y02076 03961802
         ICM   R0,M8,RMSP255       IN SUBPOOL 255              @Z30ESHP 03962002
         BAL   RD,RSGETA           GETCORE AND MOVE SCB IN       Y02076 03962102
         USING SCB,R4              SCB IN LSQA                          03962202
         STCM  R1,M7,SCBCHAIN+N1   CHAIN SCB TO PREVIOUS SCB            03978600
         LR    R4,R1               ADVANCE CHAIN POINTER                03988600
         XC    SCBCHAIN+N1(N3),SCBCHAIN+N1 SET FWD CHAIN @ = 0          03990602
         B     R11A3A              GO GET NEXT DATA BLOCK               03992600
         DROP  R4                  SCB IN LSQA                          03994600
         EJECT                                                          03995000
*                                                                       03995100
*        FOE CONTROL BLOCK PROCESSING                                   03995200
*                                                                       04000800
         SPACE 3                                                        04002800
RPMFOE1  SR    R3,R3               SET TOTAL FIX CTR=0           Y02076 04005802
         SR    RA,RA               SET FOE CTR=0                 Y02076 04008802
         LA    R4,RPMFOE           GET ADDR OF FOE ANCHOR        Y02076 04011802
RPMFOE2  CLI   N0(R7),FOECODE      IS THIS AN FOE                Y02076 04014802
         BNE   RPMFOE3             BR NO, GO FIX PAGES           Y02076 04017802
         LA    RD,FOELEN           GET LENGTH OF FOE             Y02076 04020802
         ST    RD,RPLNT            SET LENGTH FOR GETMAIN        Y02076 04023802
         BAL   RD,RSGET            GET/MOVE FOE                  Y02076 04026802
         LA    RA,N1(,RA)          INCR FOE CTR BY 1             Y02076 04029802
         USING FOE,R4              FOE                           Y02076 04032802
         STCM  R1,M7,FOEFLINK      CHAIN FOE TO CHAIN            Y02076 04035802
         LR    R4,R1               UPDATE CHAIN PTR              Y02076 04038802
         AH    R3,FOEFXCT          INCR TOTAL FIX CTR            Y02076 04041802
         BAL   RE,R13A1            GET NEXT DATA BLOCK           Y02076 04044802
         B     RPMFOE2             GO SEE IF IT IS AN FOE        Y02076 04047802
RPMFOE3  LTR   RA,RA               ANY FOE'S                     Y02076 04050802
         BZ    R11A4               BR NO, GO XCTL                Y02076 04053802
         SR    R1,R1               ZERO REG 1                  @ZA11616 04054837
         STCM  R1,M7,FOEFLINK      ZERO LAST LINK POINTER      @ZA11616 04055837
         LR    R1,R3               CALCULATE LENGTH OF GETMAIN   Y02076 04056802
         SLL   R1,N3               FOR FIXLIST (VSL)             Y02076 04059802
         LA    R0,N4(,R1)          AND ECB 8*FIXES+4             Y02076 04062802
         ICM   R0,M8,RMSP254       SETUP TO GET FROM SP254       Y02076 04065802
         ST    R0,RSW001           SAVE LENGTH FOR FREEMAIN      Y02076 04068802
         GETMAIN R,LV=(0)          GET ECB AND VSL               Y02076 04071802
         ST    R1,RSW002           SAVE ADDR OF ECB AND VSL      Y02076 04074802
         LA    R8,N4(,R1)          GET ADDR OF VSL               Y02076 04077802
         LA    R4,RPMFOE           GET ADDR OF FOE ANCHOR        Y02076 04080802
         SR    RD,RD               CLEAR WORK REG                Y02076 04083802
RPMFOE4  ICM   R4,M7,FOEFLINK      GET ADDR OF 1ST/NEXT FOE      Y02076 04086802
         ICM   RD,M6,FOEVINDX      GET START ADDR TO FIX         Y02076 04089802
         LR    RE,RD               COMPUTE END                   Y02076 04092802
         AH    RE,RMH4096          ADDR+1                        Y02076 04095802
         LH    R3,FOEFXCT          GET FOE FIX COUNT             Y02076 04098802
RPMFOE4A STM   RD,RE,N0(R8)        STORE START AND END ADDR      Y02076 04101802
*                                  FOR THIS ENTRY                Y02076 04104802
         LA    R8,N8(,R8)          POINT TO NEXT VSL ENTRY       Y02076 04107802
         BCT   R3,RPMFOE4A         CONTINUE UNTIL FIX CTR=0      Y02076 04110802
         BCT   RA,RPMFOE4          CONTINUE UNTIL FOE CTR=0      Y02076 04112302
         SH    R8,RMH4             POINT TO PREVIOUS ENTRY       Y02076 04113802
         OI    N0(R8),X80          SET LAST VSL ENTRY FLAG       Y02076 04116802
         L     R8,RSW002           GET ECB ADDRESS               Y02076 04119802
         LA    R1,N4(,R8)          GET START ADDR OF FIX LIST    Y02076 04122802
         XC    N0(N4,R8),N0(R8)    CLEAR ECB                     Y02076 04125802
         DROP  R4                  FOE                           Y02076 04128802
         PGFIX L,LA=(R1),ECB=(R8),LONG=N,RELEASE=N               Y02076 04131802
         LTR   RF,RF               DID FIX GO OK                 Y02076 04134802
         BZ    RPMFOE7             BR YES, GO FREE ECB & VSL     Y02076 04137802
         CLM   RF,M1,RMRC8         IS PGFIX STILL ACTIVE         Y02076 04140802
         BNE   RPMFOE6             BR NO--ERROR                  Y02076 04143802
         WAIT  ECB=(R8)            NOT YET DONE, SO WAIT         Y02076 04146802
         CLI   N0(R8),PC40         WAS PGFIX SUCCESSFUL        @ZA01488 04149802
         BE    RPMFOE7             BR YES                        Y02076 04152802
RPMFOE6  MVI   RSRETCOD+N1,ERR201  SET '201' ERROR CODE        @ZSUT222 04155837
RPMFOE7  L     R0,RSW001           GET LENGTH OF ECB+VSL         Y02076 04158802
         ICM   R0,M8,RMSP254       SET SP TO 254                 Y02076 04161802
         L     R1,RSW002           GET ADDR OF ECB & VSL         Y02076 04164802
         FREEMAIN R,LV=(0),A=(1)   FREE ECB & VSL                Y02076 04167802
         CLI   RSRETCOD+N1,ERR201  WAS THERE AN ERROR          @ZSUT222 04170837
         BE    RPMERR              BR YES                        Y02076 04173802
******* FALL THROUGH TO R11A4 TO XCTL TO REPMAIN 3 *****                04209900
         EJECT                                                          04210300
*                                                                       04210700
*              XCTL PROCESSING                                          04210800
*                                                                       04210900
         SPACE 3                                                        04216700
R11A4    LA    RF,RPMN40           GET @ OF NAME TO XCTL TO             04218700
         ST    RF,RP40XCTL         SAVE IT FOR XCTL                     04220700
         LR    R1,RC               SET @ OF RSTWA TO GPR1               04221100
         LA    RF,RP40XCTL         GET @ OF @                           04221500
         XCTL  SF=(E,(15))         XCTL TO NEXT LOAD                    04221900
         EJECT                                                          04222300
*                                                                       04222400
*        RPMJPQS - ROUTINE TO LOCATE A CDE ON THE RESTARTED P/P JPQ     04222500
*                                                                       04238700
*        INPUT - POSITION INDEX OF CDE ON THE JPQ IN GPR 0              04248700
*                RETURN ADDRESS IN GPR 14.                              04250700
*                                                                       04252700
*        OUTPUT- @ OF CDE IN GPR 1                                      04254700
*                                                                       04255100
         SPACE 3                                                        04260500
RPMJPQS  L     R1,RPMCDE           GET @ OF FIRST CDE ON JPQ            04262500
         LA    RF,N1               SET SEARCH COUNT=1                   04264500
RPMJPQS1 CR    R0,RF               SEARCH COUNT=POSITION INDEX          04264900
         BCR   EQ,RE               EQUAL, RETURN                        04265300
         USING CDENTRY,R1          CDE                                  04265700
         L     R1,CDCHAIN          GET @ NEXT CDE                       04265800
         LA    RF,N1(RF)           INCREMENT SEARCH COUNT BY 1          04265900
         B     RPMJPQS1            SEE IF THIS IS THE ONE               04271300
         DROP  R1                  CDE                                  04273300
         EJECT                                                          04275300
*                                                                       04275700
*        THIS SUBROUTINE ISSUES A GETMAIN FOR A CONTROL BLOCK           04276100
*        AND MOVES THE BLOCK TO THE ACQUIRED CORE FROM THE              04276500
*        SUR BUFFER.                                                    04276600
*                                                                       04276700
*        INPUT - @ OF BLOCK TO BE MOVED MINUS 1 IN GPR 7.               04282100
*              - LENGTH TO BE MOVED IN RPLNT                            04284100
*              - BIG BLOCK SWITCH. IF ONE BYPASS MOVE                   04286100
*                                  IF ZERO MOVE BLOCK                   04286500
*              - RETURN @ IN GPR 13                                     04286900
*                                                                       04287300
*        OUTPUT - @ OF ACQUIRED STORAGE IN GPR 1 AND RSCORE.            04287400
*               - BLOCK MOVED IF REQUIRED                               04287500
*                                                                       04292900
*        NOTE - IF ENTERED AT RSGETA THE SUBPOOL # AND LENGTH MUST      04294900
*               BE SET INTO GPR 0 BY CALLER.                            04296900
*                                                                       04297300
         SPACE 3                                                        04297700
RSGET    L     R0,RPLNT            GET THE LENGTH OF THE BLOCK          04298100
         ICM   R0,M8,RMSP255       GET FROM SUBPOOL 255                 04298200
RSGETA   GETMAIN R,LV=(0)          GET THE CORE                         04298300
         ST    R1,RSCORE           SAVE PTR TO ACQUIRED CORE            04312800
         TM    RSSWIT1,N1          IS IT A BIG BLOCK (IE. XL)           04322800
         BCR   ONES,RD             YES, RETURN WITHOUT MOVING BLOCK     04324800
         L     RF,RPLNT            GET LENGTH TO MOVE                   04326800
         BCTR  RF,R0               ADJUST FOR EXECUTE                   04327200
         EX    RF,RSGETMOV         MOVE THE BLOCK                       04327300
         BR    RD                  RETURN TO CALLER                     04327400
         SPACE                                                          04332200
RSGETMOV MVC   N0(N0,R1),N1(R7)    EXECUTED MOVE TO MOVE BLOCK          04334200
         EJECT                                                          04336200
*                                                                       04336600
*        RPMCDLDR - ROUTINE TO LOCATE A CDE ON THE ACTIVE LPAQ          04337000
*                                                                       04337100
*        INPUT - @ OF CHECKCODE FOR BLOCK IN SUR BUFFER IN GPR 7.       04341900
*              - LENGTH OF BLOCK IN RPLNT                               04343900
*              - ENTRY POINT NAME AND @ IN SUR APPENDAGE                04345900
*              - RETURN ADDRESS IN GPR 14.                              04346300
*        OUTPUT- CDE BUILT ON LPAQ                                      04346700
*              - @ OF CDE IN GPR1                                       04346800
*                                                                       04351600
RPMCDLDR ST    RE,CKSAVARE         SAVE RETURN REG                      04353600
         LA    R6,N1(R7)           GET @ OF START OF BLOCK IN SUR BUF   04355600
         A     R6,RPLNT            CALCULATE START OF SUR APPENDAGE     04356000
         LA    R0,LLEAPLEN         SET APPENDAGE LENGTH FOR             04356402
         ST    R0,RSAPPLNT         BUFFER HANDLER                       04356502
         L     RF,CVTPTR           GET CVT ADDRESS             @ZA02857 04358502
         USING CVT,RF              AVOID SEARCH IN JOB/STPLIB  @ZA02857 04360502
         L     R1,CVTLINK          GET LINK LIB DCB ADDR       @ZA02857 04360902
         DROP  RF                                              @ZA02857 04361002
         LOAD  EPLOC=(R6),DCB=(R1)  LOAD MODULE TO SET UP CDE  @ZA02857 04361102
         LR    RD,R0               SAVE EP @                            04363300
         CLM   RD,M7,N9(R6)        ENTRY POINT @ OK                     04365300
         BNE   RPMCDLD1            NO, GO DELETE THE MODULE             04365700
         LA    RF,RSREGSAV         GET SAVEAREA ADDR             Y02076 04365902
         STM   R0,RF,N0(RF)        SAVE REGS                     Y02076 04366002
RPMCD1   SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        ,04366102
               RELATED=(LOCAL,IGC0605B(RPMCD4))                  Y02076 04366302
         LTR   RD,RD               SETLOCK ERROR                 Y02076 04366502
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 04366602
         BNZ   RPMSLERR            IF YES, BR                    Y02076 04366702
RPMCD2   SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                          ,04366802
               RELATED=(CMS,IGC0605B(RPMCD3))                    Y02076 04366902
         LTR   RD,RD               SETLOCK ERROR                 Y02076 04367002
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 04367102
         BZ    RPMCD2B             IF NOT, BR                    Y02076 04367202
         MVI   RSRETCOD+N1,ERR202  STORE SETLOCK ERROR CODE    @ZSUT222 04367337
         B     RPMCD4              GO RELEASE LOCAL LOCK         Y02076 04367537
RPMCD2B  BAL   RE,CDSEARCH         GO FIND CDE ON LPAQ           Y02076 04367602
         USING CDENTRY,R2          CDE                           Y02076 04367702
         ST    R2,RMCDSAV          SAVE CDE ADDR                 Y02076 04367802
         TM    CDATTR,CDMIN        MINOR CDE                     Y02076 04368102
         BZ    RPMCDLD2            BR NO                         Y02076 04368402
         L     R2,CDXLMJP          BUMP COUNT IN MAJOR CDE       Y02076 04368702
RPMCDLD2 LH    RF,CDUSE            GET CDE USE COUNT             Y02076 04369302
         LA    RF,N1(,RF)          INCR BY ONE                   Y02076 04369602
         STH   RF,CDUSE            PUT IT BACK                   Y02076 04369902
         LA    RF,RSREGSAV         GET SAVEAREA ADDR             Y02076 04370102
         STM   R0,RF,N0(RF)        SAVE REGS                     Y02076 04370202
RPMCD3   SETLOCK RELEASE,TYPE=CMS,RELATED=(CMS,IGC0605B(RPMCD2)) Y02076 04370402
RPMCD4   SETLOCK RELEASE,TYPE=LOCAL,                                   ,04370502
               RELATED=(LOCAL,IGC0605B(RPMCD1))                  Y02076 04370802
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 04371802
RPMCDLD1 DELETE EPLOC=(R6)         RELEASE THE LLE                      04381800
         CLI   RSRETCOD+N1,ERR202  SETLOCK ERROR               @ZSUT222 04382837
         BE    RPMERR              IF YES, BR                    Y02076 04383002
         CLM   RD,M7,N9(R6)        ENTRY POINT @ OK                     04383800
         BNE   R11A5               NO, LPAQ ERROR SO STOP RESTART       04384200
         L     R1,RMCDSAV          SET CDE @ FOR RETURN                 04393100
         L     RE,CKSAVARE         RESTORE RETURN REG.                  04395100
         BR    RE                  RETURN TO CALLER                     04397100
         DROP  R2                  CDE ON LPAQ                          04397500
         EJECT                                                          04397900
*                                                                       04398300
*        INPUT BUFFER HANDLER ROUTINE                                   04398400
*                                                                       04398500
*        INPUT - @ OF CURRENT BLOCK IN RSBFSTAD                         04399000
*              - LENGTH OF CURRENT BLOCK IN RPLNT                       04399400
*              - LENGTH OF APPENDAGE FOR CURRENT BLOCK, IF ANY          04399800
*              - @ OF ACQUIRED STORAGE IN GPR 1 (FOR BIG BLOCKS)        04399900
*              - FLAG SET IF MOVE REQUESTED (FOR BIG BLOCKS)            04408800
*              - NUMBER OF BYTES LEFT IN BUFFER IN RSBFLWA              04410800
*                                                                       04412800
*        OUTPUT- @ OF NEXT BLOCK IN RSBFSTAD AND IN GPR 7               04414800
*              - NUMBER OF BYTES LEFT IN BUFFER IN RSBFLWA              04416800
*              - APPENDAGE LENGTH SET TO ZERO                           04417200
*                                                                       04417600
         SPACE 3                                                        04418100
R13A1    DS    0H                  BUFFER HANDLER ROUTINE               04418500
         STM   R1,RF,CKSAVAR+N4    SAVE REGS                            04418900
         LA    RD,RSREGSAV         SAVE AREA ADDRESS                    04419000
         L     R3,RPLNT            LENGTH OF BLOCK                      04419100
         L     R4,RSBFLWA          REMAINING BYTES                      04419200
         L     RA,RSBFSTAD         NEXT ADDRESS IN BUFFER               04421500
         LA    RA,N1(RA)           ALLOW FOR CODE BYTE                  04423500
         BCTR  R4,R0               ALLOW FOR CODE BYTE                  04425500
         TM    RSSWIT1,BIGBLOCK    IS THIS A BIG BLOCK                  04425900
         BZ    R13A2               NO-BRANCH                            04426000
         NI    RSSWIT1,ON-BIGBLOCK YES- TURN OFF SWITCH                 04426102
R13B1    EQU   *                                               @ZA14558 04427837
         C     R3,HUNDRED          ARE BYTES GREATER THAN FF ? @ZA14558 04428337
         BNL   CMVCL               YES BRANCH                  @ZA14558 04428837
         CR    R3,R4               ARE BYTES LEFT IN BLOCK GT  @ZA14558 04429337
*                                  BYTES LEFT IN BUFFER                 04429800
         BNH   R13F1               NO   USE BLOCK LENGTH                04430200
         LR    R2,R4               YES  USE BYTES LEFT IN BUFFER        04430600
         BAL   R5,R13E1            MOVE IN SUR                          04431000
BACK     EQU   *                                               @ZA14558 04431137
         L     R1,RSW001           RESTORE PTR TO NEXT BYTE IN GOTTEN   04431537
*                                  CORE                                 04431937
         B     R13B1               LOOP WITH LEFT OVER BYTES            04432337
R13F1    LR    R2,R3               USE BLOCK LENGTH AS CTR              04433000
         B     R13E1               MOVE IN SUR                          04435000
* FOR BLOCKS GREATER THAN FF IN LENGHT WE WILL USE A MVCL      @ZA14558 04435437
CMVCL    EQU   *                                               @ZA14558 04435837
         CR    R3,R4               LENGTH > BUFFER REMAINDER ? @ZA14558 04436237
         BH    CMVCL1              YES BRANCH AND USE BFR SIZE @ZA14558 04436637
         LR    R2,R3               USE BLOCK LENGTH            @ZA14558 04437037
         LR    R6,R1               SET UP REG 6 TO FIELD       @ZA19627 04437437
         LR    R7,R2               SET REG 7 TO LENGTH         @ZA19627 04437637
         B     AHEAD               BRANCH AROUND               @ZA19627 04437837
CMVCL1   EQU   *                                               @ZA14558 04438037
         LR    R2,R4               SET LENGTH IN REG 2         @ZA14558 04438237
         LR    R6,R1               POINT R6 TO FIELD           @ZA14558 04438437
         LR    R7,R4               SET LENGTH IN REG 7         @ZA14558 04438637
AHEAD    EQU   *                                               @ZA19627 04438837
         LR    R8,RA               POINT R8 TO SUR             @ZA14558 04439437
         LR    R9,R2               SET LENGTH IN REG 9         @ZA14558 04439837
         MVCL  R6,R8               MOVEIT                      @ZA14558 04440237
         L     R9,RSMWOFST         SET REG 9                   @ZA14558 04440637
         AR    R9,RC               RESTORE REG 9               @ZA14558 04440837
         AR    RA,R2               INCREMENT BUFFER ADDRESS    @ZA14558 04441037
         AR    R1,R2               INCREMENT FIELD ADDRESS     @ZA14558 04441437
         ST    R1,RSW001           SAVE POINTER TO FIELD       @ZA14558 04441837
         SR    R4,R2               GET BYTES LEFT IN BUFFER    @ZA14558 04442237
         SR    R3,R2               GET BYTES LEFT IN BLOCK     @ZA14558 04442637
         BZ    R13A3               NONE LEFT BRANCH            @ZA14558 04443037
         LTR   R4,R4               TEST BUFFER BYTES LEFT      @ZA14558 04443437
         BNZ   BACK                NOT ZERO BRANCH             @ZA14558 04443837
         BAL   R7,R13D2            ZERO READ SUR               @ZA14558 04444237
         B     BACK                TEST NEXT FIELD             @ZA14558 04444637
         EJECT                                                          04445037
*                                                                       04445437
*        MOVE IN SUR ROUTINE                                            04445837
*                                                                       04446237
R13E1    DS    0H                  SUR PROCESSING                       04446637
         BCTR  R2,R0               DECREMENT COUNT                      04447037
         EX    R2,RSMOVE           EXECUTE MOVE                         04448800
         LA    R2,N1(R2)           INCREMENT COUNT                      04458800
         AR    RA,R2               INCREMENT BUFFER PTR                 04460800
         AR    R1,R2               INCREMENT AREA POINTER               04461200
         ST    R1,RSW001           SAVE PTR TO NEXT BYTE IN GOTTEN      04461300
         SR    R4,R2               GET BYTES LEFT IN BUFFER             04461400
         SR    R3,R2               GET BYTES LEFT IN BLOCK              04461500
         BZ    R13A3               NO MORE BYTES IN BLOCK               04461700
         LTR   R4,R4               ANY MORE BYTES IN BUFFER             04462100
         BCR   NE,R5               YES, RETURN                          04465100
         BAL   R7,R13D2            READ NEW DATA                        04467100
         BR    R5                  RETURN                               04469100
         SPACE 2                                                        04469500
R13A2    SR    R4,R3               COMPUTE NEW REMAINDER                04469900
         S     R4,RSAPPLNT         ALLOW FOR APPENDAGE, IF ANY          04470300
         BZ    R13D1               NO MORE BYTES LEFT IN BUFFER         04470700
         AR    RA,R3               GET PTR TO NEXT DATA                 04470800
         A     RA,RSAPPLNT         ALLOW FOR APPENDAGE, IF ANY          04470900
R13A3    CLI   N0(RA),N0           MORE USEABLE DATA IN BUF             04471000
         BE    R13D1               NO                                   04473200
         LTR   R4,R4               ANY MORE BYTES IN BUFFER             04475200
         BZ    R13D1               NO                                   04477200
         ST    RA,RSBFSTAD         ADDRESS OF NEW DATA                  04477600
         ST    R4,RSBFLWA          RESTORE REMAINDER                    04477700
R13C1    XC    RSAPPLNT(N4),RSAPPLNT ZERO THE APPENDAGE LENGTH          04483802
         ST    RA,CKSAVAR7         SET UP @ OF NEW BLOCK FOR RETURN     04485800
         LM    R1,RF,CKSAVAR+N4    RESTORE REGS                         04485900
         BR    RE                  RETURN                               04486000
R13D1    BAL   R7,R13D2            TO I/O ROUTINE                       04490202
         B     R13C1               RETURN                               04492200
         EJECT                                                          04494200
*                                                                       04494300
*        ROUTINE TO HANDLE I/O                                          04498400
*                                                                       04500400
*        INPUT - RETURN ADDRESS IN GPR 7                                04502400
*                                                                       04502500
*        OUTPUT- NEW RECORD READ AND BUFFER POINTERS ADJUSTED           04506600
*                                                                       04508600
         SPACE 3                                                        04510600
R13D2    DS    0H                  I/O HANDLER                          04510700
         LR    RA,RC               BASE ADDRESS                         04514800
         A     RA,RSBFOFST         ADD OFFSET TO BUFFER                 04516800
         READ  RSDECB1,SF,,(RA),,MF=E                                   04518800
         CHECK RSDECB1                                                  04518900
         CLI   RSRETCOD+N1,ZERO    I/O ERRORS                   YA00153 04523002
         BNE   RPMERR              YES                          YA00153 04525002
         ST    RA,RSBFSTAD         1ST BYTE OF BUFFER                   04527000
         LA    R4,SURL             GET BUFFER LENGTH                    04527100
         ST    R4,RSBFLWA          INITIALIZE LENGTH OF BUFFER          04537300
         BR    R7                  RETURN                               04547300
         SPACE 3                                                        04547700
*                                                                       04548100
*        SYNAD ROUTINE                                                  04549300
*                                                                       04551300
         SPACE 3                                                        04551700
RPM127   DS    0H                  SYNAD ROUTINE                        04553100
         MVI   RSRETCOD+N1,ERR036       I/O ERROR CODE         @ZSUT222 04555137
         L     R1,RSIOBPT1              GET ADDR OF IOB         YA00153 04556137
         TM    N13(R1),WLR              IS THIS WRONG LEN ERR   YA00153 04557137
         BCR   ZEROES,RE                NO - RETURN             YA00153 04558137
         MVI   RSRETCOD+N1,ERR042       SET WLR ERROR CODE     @ZSUT222 04559137
         RETURN                                                         04563202
*                                                                       04564102
         EJECT                                                          04565002
*                                                                Y02076 04565902
*        SETLOCK ERROR SET ROUTINE                               Y02076 04566802
*                                                                Y02076 04567702
         SPACE 2                                                        04568602
RPMSLERR MVI   RSRETCOD+N1,ERR202  STORE SETLOCK ERROR CODE    @ZSUT222 04569537
         B     RPMERR              GO XCTL TO ERROR LOAD         Y02076 04570402
         SPACE 3                                                        04571302
RSMOVE   MVC   N0(N1,R1),N0(RA)    MOVE IN BLOCK                        04572202
         EJECT                                                          04573102
*                                                                       04574002
*        CDSEARCH ROUTINE INTERFACES WITH SYSTEM IEAQCDSR               04574902
*                 ROUTINE TO FIND A CDE ON THE LPA CDE QUEUE.           04575802
*                                                                       04576702
*        INPUT - GPR 6 CONTAINS @ OF NAME TO BE FOUND                   04577602
*                GPR 14 RETURN ADDRESS                                  04578502
*                                                                       04579402
*        OUTPUT- GPR2= @ OF CDE IF FOUND                                04580302
*                    = 0 IF NOT FOUND                                   04581202
*                                                                       04582102
*                                                                       04583002
         SPACE                                                          04583902
CDSEARCH STM   R3,RF,RSREGSAV      SAVE REGS IN RESTART WORK AREA       04584802
         L     R4,RSTCBAD          GET @ OF TCB FOR IEAQCDSR            04585702
         L     RE,CVTPTR           GET @ OF CVT                         04586602
         USING CVT,RE              CVT                                  04587502
         L     R8,CVTQLPAQ         GET @ OF ACTIVE LPA CDE QUEUE        04588402
         LR    R9,R6               SET UP @ OF SEARCH NAME FOR RTN      04589302
         L     RE,CVTQCDSR         GET @ OF CDE QUEUE SEARCH ROUTINE    04590202
         DROP  RE                  CVT                                  04591102
         BALR  RE,RE               SEARCH LPAQ VIA IEAQCDSR             04592002
         NOPR  R0                  FALL THROUGH                         04592902
         NOPR  R0                  FALL THROUGH                         04593802
         LR    R2,RB               MOVE CDE @ TO OUTPUT REG             04594702
*                                  NOTE-- RB HAS @ IF FOUND OR 0        04595602
*                                          IF NOT FOUND.                04596502
         LM    R3,RF,RSREGSAV      RESTORE REGS                         04597402
         BR    RE                  RETURN TO CALLER                     04598302
         EJECT                                                          04599202
*                                                                       04600102
*        CONSTANTS                                                      04601002
         DS    0F                                                       04601337
HUNDRED  DC    X'00000100'         DEC 256  HEX 100            @ZA14558 04601637
RMRBLINK DC    A(RBLINK-RBPRFXST)  OFFSET TO RBCHAIN FIELD IN RB        04601902
RM3NAME  DC    C'IGC0705B'         NAME OF REPMAIN 3                    04602802
MODID    DC    CL8'IGC0605B'       MODULE ID                   @ZSUT222 04603237
EOVRETNM DC    C'IFG0551N'         EOV EXIT RTN RET NAME         Y02076 04603702
RMH4     DC    H'4'                4 - USED TO COMPUTE @ OF IEASVCNO    04604602
RMH4096  DC    H'4096'             PAGE SIZE FOR BUILDING FIX LIST      04605502
RMSP253  DC    AL1(253)            SUBPOOL 253 FOR SCB           Y02076 04606402
RMSP254  DC    AL1(254)            SUBPOOL 254 FOR FIX PARAMETER LIST   04607302
RMSP255  DC    AL1(255)            SUBPOOL 255                          04608202
RMRC8    DC    AL1(8)              RETURN CODE OF 8              Y02076 04609102
         SPACE 3                                                        04610002
*        PATCH AREA FOR MAINTENANCE OF 10%                              04610902
         SPACE 3                                                        04611802
PATCH    EQU   *                   PATCH AREA                           04612702
RM2LEN   EQU   PATCH-IGC0605B      LENGTH OF MODULE                     04613602
PATCHLEN EQU   RM2LEN/10           LENGTH OF PATCH AREA REQUIRED        04614502
RM2PATCH DS    CL(PATCHLEN)        PATCH AREA FOR MAINTENANCE           04615402
         EJECT                                                          04616302
*                                                                       04617202
*        GENERAL REGISTER EQUATES                                       04618102
*                                                                       04619002
         SPACE 3                                                        04619902
R0       EQU   0                   0                                    04620802
R1       EQU   1                   1                                    04621702
R2       EQU   2                   2                                    04622602
R3       EQU   3                   3                                    04623502
R4       EQU   4                   4                                    04624402
R5       EQU   5                   5                                    04625302
R6       EQU   6                   6                                    04626202
R7       EQU   7                   7                                    04627102
R8       EQU   8                   8                                    04628002
R9       EQU   9                   9                                    04628902
RA       EQU   10                  10                                   04629802
RB       EQU   11                  11                                   04630702
RC       EQU   12                  12                                   04631602
RD       EQU   13                  13                                   04632502
RE       EQU   14                  14                                   04633402
RF       EQU   15                  15                                   04634302
         SPACE 3                                                        04635202
*                                                                       04636102
*        GENERAL EQUATES                                                04637002
*                                                                       04637902
         SPACE 3                                                        04638802
N0       EQU   0                   0                                    04639702
N1       EQU   1                   1                                    04640602
N2       EQU   2                   2                                    04641502
N3       EQU   3                   3                                    04642402
N4       EQU   4                   4                                    04643302
N5       EQU   5                   5                                    04644202
N8       EQU   8                   8                                    04645102
N9       EQU   9                   9                                    04646002
N13      EQU   13                       CONSTANT 13             YA00153 04646402
X80      EQU   X'80'               MASK TO SET HIGH ORDER BIT OF BYTE   04646902
CDECODE  EQU   9                   CHECKCODE FOR CDE                    04647802
CDELEN   EQU   32                  LENGTH FOR CDE                Y02076 04648702
XLCODE   EQU   X'17'               CHECKCODE FOR EXTENT LIST            04649602
LLEJCODE EQU   X'0A'               CHECKCODE FOR LLE W/CDE ON JPQ       04650502
LLELCODE EQU   X'0E'               CHECKCODE FOR LLE W/CDE ON LPAQ      04651400
LLELEN   EQU   12                  LENGTH OF AN LLE              Y02076 04661402
LLEAPLEN EQU   12                  LENGTH OF SUR APPENDAGE FOR LLE      04663400
PRBSCODE EQU   5                   CHECKCODE FOR SYNCHED PRB            04663800
PRBLCODE EQU   X'0C'               CHECKCODE FOR PRB W/CDE ON LPAQ      04664200
PRBJCODE EQU   X'0B'               CHECKCODE FOR PRB W/CDE ON JPQ       04664600
SVRB234C EQU   X'1F'               CHECKCODE FOR TYPE 2, 3, 4 SVRB      04664700
SVRB4NCD EQU   X'1E'               CHECKCODE FOR TYPE 4N SVRB           04667800
SVRBEOVC EQU   X'1D'               EOV SVRB CODE IN SUR          Y02076 04668002
SVRB234A EQU   5                   SUR APP. LEN. FOR TYPE 2,3,4, SVRB   04669800
RBLPALEN EQU   12                  SUR APP. LEN. FOR 4N SVRB, LPAQ PRB  04671800
NSTAECOD EQU   X'0D'               CHECKCODE FOR TCBNSTAE FIELD         04673800
NSTAELEN EQU   4                   LENGTH OF TCBNSTAE FIELD OF TCB      04673900
SCBCODE  EQU   X'11'               CHECKCODE FOR SCB                    04676200
FOECODE  EQU   X'08'               CHECKCODE FOR FOE                    04680200
CC0      EQU   8                   MASK FOR CONDITION CODE 0            04680600
EQ       EQU   8                   MASK FOR EQUAL COMPARE (CC=0)        04680700
NE       EQU   7                   MASK FOR UNEQUAL COMPARE (CC=1,2,3)  04680800
ONES     EQU   1                   MASK TO BRANCH ON ONES (CC=3)        04683100
M1       EQU   1                   MASK FOR BYTE 3 OF REG               04685100
M3       EQU   3                   MASK FOR BYTES 2&3 OF REG            04687100
M6       EQU   6                   MASK FOR BYTES 1&2 OF REG            04687500
M7       EQU   7                   MASK FOR ICM/STCM TO GET 3 LO BYTES  04687600
M8       EQU   8                   MASK FOR ICM TO BYTE 0 OF REG.       04687700
MF       EQU   15                  MASK FOR ICM FOR WHOLE REG           04688200
PC0      EQU   0                   MASK TO TEST FOR POST CODE OF 0      04688600
PC4      EQU   4                   MASK TO TEST FOR POST CODE OF 4      04689000
PC40     EQU   X'40'                   ECB CODE-SUCCESS PGFIX  @ZA01488 04690002
ON       EQU   255                 ALL ONES                             04691402
SURL     EQU   400                 LENGTH OF SUR BUFFER          YM7049 04692402
CHAR9    EQU   C'9'                EBCDIC 9                             04693402
ERR036   EQU   36                  ERROR CODE FOR I/O ERROR    @ZSUT222 04694837
ERR052   EQU   52                  ERROR CODE IF LPA OR NUCLEUS@ZSUT222 04695237
*                                  MODULE HAS BEEN REMOVED     @ZSUT222 04695637
*                                  SINCE CHECKPOINT WAS TAKEN. @ZSUT222 04696037
ERR053   EQU   53                  ERROR CODE IF LPA OR NUCLEUS@ZSUT222 04696437
*                                  MODULE HAS BEEN MOVED SINCE @ZSUT222 04696837
*                                  CHECKPOINT WAS TAKEN.       @ZSUT222 04697237
ERR201   EQU   201                      PGFIX ERROR CODE       @ZSUT222 04697637
ERR202   EQU   202                      SETLOCK ERROR CODE     @ZSUT222 04698037
ZERO     EQU   0                        0 FOR TESTING RET CODE  YA00153 04699502
ZEROES   EQU   8                        CONDITION FOR BCR       YA00153 04700402
WLR      EQU   X'40'                    WRONG LENGTH RECORD     YA00153 04701402
*                                       INDICATION IN IOB       YA00153 04702402
ERR042   EQU   42                       ERROR CODE FOR WRONG   @ZSUT222 04703437
*                                       LENGTH RECORD WHILE     YA00153 04704402
*                                       READING CHKPT D/S       YA00153 04705402
         EJECT                                                          04706402
*                                                                       04707402
*              DESCRIPTION OF REPMAIN WORK AREA                         04708402
*                                                                       04709402
         SPACE 3                                                        04710402
RPMWA1   DSECT                                                          04711402
RPMERAS1 DS    F                   TEMP SAVE AREA                Y02076 04712402
RMNEOV   DS    A                   RESERVED                             04713402
RSBFSTAD DS    A                   BUFFER POINTERS                      04714402
RSBFLWA  DS    A                   *                                    04715402
RPMMSS1  DS    A                   ADDRESS OF NEW STC MSS CHAIN         04716402
RPMMSS2  DS    A                   ADDRESS OF NEW INIT MSS CHAIN        04717402
RPMMSS3  DS    A                   ADDRESS OF NEW P/P MSS CHAIN         04718402
RPMRB    DS    A                   ADDRESS OF RESTORED RB CHAIN         04719402
RPMLLE   DS    A                   ADDRESS OF RESTORED LLE CHAIN        04720402
RPMCDE   DS    A                   ADDRESS OF RESTORED CDE CHAIN        04721402
RPMDEB   DS    A                   ADDRESS OF RESTORED DEB CHAIN        04722402
RPMFOE   DS    A                   ADDRESS OF RESTORED FOE CHAIN        04723402
RSCORE   DS    A                   ADDRESS OF CORE ACQUIRED BY LAST GM  04724402
RSW001   DS    F                   *                                    04725402
RSW002   DS    F                   *                                    04726402
RPLNT    DS    A                   LENGTH OF THE BLOCK                  04727402
RMADEOV  DS    F                   SAVE AREA FOR INFORMATION NEEDED     04728402
         DS    0D                  ALIGNMENT                            04729402
CKSAVAR  DS    16F                 SAVE AREA                            04730402
CKSAVAR6 EQU   CKSAVAR+24          SAVE CELL FOR GPR'S 6-9       Y02076 04731402
CKSAVAR7 EQU   CKSAVAR+28          SAVE CELL FOR REG 7           Y02076 04732402
CKSAVARE EQU   CKSAVAR+56          SAVE CELL FOR GPR 14.                04733402
RPMN40   DS    D                   MODULE NAME FOR XCTL                 04734402
RP40XCTL DS    F                   POINTER TO XCTL PARAMETER LIST       04735402
RSSWIT1  DS    X                   SWITCH                               04736402
BIGBLOCK EQU   1                   BIG BLOCK SWITCH                     04737402
RSAPPLNT DS    F                   LENGTH OF SUR APPENDAGE              04738402
RMCDSAV  DS    F                   SAVE CELL FOR LPA CDE SEARCH         04739402
         EJECT                                                          04740402
         IEEVRSWA                                                       04741402
         EJECT                                                          04742402
         CVT   DSECT=YES                                                04743402
         EJECT                                                          04744402
         IHASCVT                                                        04745402
         EJECT                                                          04746402
         IKJTCB                                                         04747402
         EJECT                                                          04748402
         IKJRB                                                          04749402
         EJECT                                                          04750402
         IHASCB                                                         04751402
         EJECT                                                          04752402
         IHACDE                                                         04753402
         EJECT                                                          04754402
         IHAPSA                                                         04755402
         EJECT                                                          04756402
         IHAXTLST                                                       04757402
         EJECT                                                          04758402
         IHALLE                                                         04759402
         EJECT                                                          04760402
         IHAFOE                                                         04761402
         EJECT                                                          04762402
         IHADCB DSORG=(PO,PS),DEVD=(DA,TA)                              04763402
         END                                                            04764437
./  ADD  SSI=82070236,NAME=IHJQRS22
RM22     TITLE 'IHJQRS22 AOS/2 REPMAIN 3 ROUTINE - IGC0705B'            00550000
*                                                                       00552000
*0000                                                            YM3022 00554000
* VS2/REL3 CHANGES AND DELETIONS                                        00554402
*014582,014593-014595                                            ZM0484 00554802
*DEL 014741,014791-014816                                        ZM0484 00555202
*014552-014659,015061,019158                                   @ZA03659 00555637
*C013361,A013362-013363,A018707                                @ZA17960 00556008
* APAR OZ31480 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 00556208
*C015723,017850,017928,019881,020699,020702                    @ZSUT222 00556408
*A017788-017798,018656                                         @ZSUT222 00556608
* VS2/REL4 CHANGES AND DELETIONS                                        00557008
*                                                                       00558037
*                                                              @Z40RSRB 00558108
*A460337-463237,A464637,A874837                                @ZA28860 00558537
*C336500,A337000-338000                                        @ZA31057 00559037
*A010289-010291                                                @ZA32921 00559508
* STATUS - CHANGE LEVEL 001                                             00560000
*                                                                       00570000
* FUNCTION- THIS ROUTINE RESTORES PERTINENT INFORMATION IN THE TCB,     00580000
*    RESTORES DEB'S, DEB EXTENSIONS, AND IRB'S AND MOVES THE     Y02076 00590502
*    CHECKPOINT TIME TIOT INTO THE RESTART WORKAREA.             Y02076 00591002
*    IT UPDATES THE RESTART DSAB'S WITH SELECTED FIELDS SAVED    Y02076 00591502
*    AT CHECKPOINT TIME. FINALLY, AN SSCR OR THE ECR (END OF     Y02076 00591602
*    CHECKPOINT RECORD) IS READ INTO THE SUR/SSCR BUFFER.        Y02076 00591702
*                                                                       00598000
* ENTRY POINTS                                                          00598400
*          IGC0705B                                                     00598800
*                                                                       00599200
* INPUT-                                                                00599600
*    GPR12-CONTAINS ADDRESS OF RSTWA                                    00599700
*    RSTWA-CONTAINS THE ADDR OF NEXT DATA BLOCK AND NUMBER OF BYTES     00599800
*          LEFT IN BUFFER                                               00599900
*                                                                       00649900
* OUTPUT-                                                               00659900
*    GPR12-CONTAINS ADDRESS OF RSTWA                                    00669900
*                                                                       00679900
* EXTERNAL REFERENCES                                                   00689900
*    NONE                                                               00691900
*                                                                       00693900
* EXITS, NORMAL-                                                        00695900
*    XCTL TO IGC0805B                                                   00697900
*                                                                       00698300
* EXITS, ERROR-                                                         00698700
*    I/O ERROR- XCTL TO IGC0905B WITH RETURN CODE:                      00699102
*          32  - INDICATING A MISSING DD ERROR                          00699308
*          37  - INDICATING AN I/O ERROR                                00699408
*          43  - WRONG LENGTH ERROR ON CHECKPOINT DATA SET              00699508
*                                                                       00699608
* TABLES/WORK AREAS                                                     00699708
*                                                                       00700102
*    DCB-DCBSYNAD                                                       00701102
*    .   DCBDEBAD                                                       00749800
*                                                                       00759800
*    DEB-DEBTCBB                                                 Y02076 00769802
*    .   DEBDEBB                                                 Y02076 00779802
*    .   DEBIRBB                                                 Y02076 00789802
*    .   DEBAPPAD                                                       00791800
*    .   DEBDCBAD                                                Y02076 00793802
*    .   DEBEXSCL                                                Y02076 00795802
*    .   DEBLNGTH                                                Y02076 00797802
*    .   DEBPROTG                                                       00798200
*    .   DEBPREFX                                                Y02076 00798302
*    .   DEBXTNP                                                 Y02076 00798402
*                                                                Y02076 00798502
*    DEBX-DEBXLNGH                                               Y02076 00798602
*    .    DEBXDBPR                                               Y02076 00798702
*                                                                       00798902
*    TCB-TCBUSER                                                        00799000
*    .   TCBJSCB                                                 Y02076 00799402
*    .   TCBFSA                                                         00799500
*    .   TCBPKF                                                  Y02076 00800002
*    .   TCBRBP                                                  Y02076 00800102
*                                                                       00800502
*    RB-RBOPSW                                                          00801002
*    .  RBIQE                                                           00833100
*    .  RBNEXAV                                                         00843100
*    .  RBGRSAVE                                                        00853100
*    .  RBSIZE                                                   Y02076 00853602
*    .  RBSTAB2                                                  Y02076 00854102
*                                                                       00863100
*    JSCB-JSCDSABQ                                               Y02076 00863602
*                                                                Y02076 00864102
*    QDB-QDBFELMP                                                Y02076 00864602
*                                                                Y02076 00865102
*    DSAB-DSABDCBM                                               Y02076 00865202
*    .    DSABFCHN                                               Y02076 00865302
*    .    DSABFLG1                                               Y02076 00865402
*    .    DSABFLG2                                               Y02076 00865502
*    .    DSABFLG4                                               Y02076 00865602
*    .    DSABOPCT                                               Y02076 00865702
*    .    DSABORG                                                Y02076 00865802
*    .    DSABTCBP                                               Y02076 00865902
*    .    DSABTIOT                                               Y02076 00866002
*                                                                Y02076 00866502
*    TIOT-TIOEDDNM                                               Y02076 00866602
*                                                                       00867002
* ATTRIBUTES                                                            00867502
*    KEY 0,SUPERVISOR STATE, ENABLED                                    00868002
*                                                                       00868502
* CHARACTER CODE DEPENDENCY                                             00869002
*                                                                       00877600
* NOTES                                                                 00887600
*    WRITTEN TO A 4K DESIGN POINT,TYPE-LOAD,SYSTEM LINK PACK AREA       00888000
*                                                                       00888400
*                                                                       00888800
         EJECT                                                          00892500
IGC0705B CSECT                                                          00894500
         BALR  RB,N0               ADDRESSABILITY FOR MODULE            00894900
         USING *,RB                BASE REGISTER 11                     00895300
         USING RSTWA,RC            BASE FOR RESTART W.A.                00895700
         B     RPMNST              BRANCH AROUND DC                     00896100
         DC    H'0'                PAD TWO BYTES TO ZERO                00896200
         DC    CL8'IGC0705B'       MODULE NAME                 @ZSUT222 00946208
         DC    CL8'&SYSDATE'       LAST DATE SHIPPED           @ZSUT222 00948208
         DC    CL8'@ZA32921'       LAST CODE SHIPPED           @ZSUT222 00950308
         DC    CL8'@SU80800'       SELECTABLE UNIT ID          @ZSUT222 00952208
RPMNST   L     R9,RSMWOFST         OFFSET TO REPMAIN'S W.A.      Y02076 00956202
         AR    R9,RC               TO ESTABLISH BASE FOR W.A.           00966200
         USING RPMWA1,R9           BASE FOR RPMWA                       00976200
         LA    R2,RSBDCB           RESTART'S DCB                        00986200
         USING IHADCB,R2           DCB                                  00988200
         LA    R7,RPM127           ADDRESS OF REPMAIN SYNAD ROUTINE     00990200
         STCM  R7,N7,DCBSYNAD+N1   STORE ADDR IN DCBSYNAD               00992200
         USING TCB,R5              TCB                                  00994200
         L     R5,RSTCBAD          GET TCB ADDRESS                      00994600
         MVI   RSSWIT1,N0          SET SWITCHES TO ZERO                 00995000
         MVC   RPMN40,RPMN40A      SET DEFAULT XCTL NAME                00995400
         XC    RPLNT(N4),RPLNT     CLEAR LENGTH FIELD                   00995800
         MVI   RPLNT+N3,N4         INITIALIZE BLOCK LENGTH TO 4         00995900
         DROP  R2                  DCB                                  00996000
*                                                                       00996100
*        RESTORE TCB AND SVRB INFORMATION                               01012802
*                                                                       01022800
R12A1    L     R3,RSBFSTAD         LOAD ADDR OF DATA                    01024800
         MVC   TCBUSER,N1(R3)      MOVE ADDR OF OLD USER TO TCB         01026800
         BAL   RE,R13A1            GO TO INPUT BUFFER HANDLER           01028800
         L     R4,TCBEXT2          GET TCBEXTN PTR IN REG 4    @ZA32921 01028908
         MVC   20(4,R4),N1(R3)     MOVE IN CICS AUTH FIELD     @ZA32921 01029008
         BAL   RE,R13A1            GO TO INPUT BUFFER HANDLER  @ZA32921 01029108
         MVC   TCBFSA+N1(N3),N2(R3) MOVE OLD FSA TO TCB                 01029402
         BAL   RE,R13A1            TO INPUT BUFFER HANDLER              01035000
         MVC   RSCKDCB,N1(R3)      MOVE IN CHECKPOINT DCB ADR.          01040302
         BAL   RE,R13A1            TO INPUT BUFFER HANDLER              01040400
         L     R4,RSCKDCB          GET CHPT DCB ADR.                    01040500
         USING IHADCB,R4           DCB                                  01080300
         MVC   DCBSYNA(N3),N2(R3)  MOVE USER SYNAD ADR INTO             01090300
*                                  CHKPT DCB                            01100300
         BAL   RE,R13A1            TO INPUT BUFFER HANDLER              01110300
         MVC   RSDCBSI(N2),N1(R3)  MOVE USER BLOCKSIZE                  01112300
         MVI   RPLNT+N3,N2         LENGTH OF FIELD                      01114300
         BAL   RE,R13A1            LINK TO BUFFER HANDLER               01116300
         L     R7,TCBRBP           GET ADDR OF RESTART SVRB      Y02076 01120302
         USING RBSECT,R7           RB                                   01133600
         MVC   RBGRSAVE(N64),N1(R3) MOVE GPR'S INTO SVRBA6C      Y02076 01143602
         MVI   RPLNT+N3,N64        LENGTH OF GPR'S                      01145600
         BAL   RE,R13A1            TO INPUT BUFFER HANDLER              01146000
         DROP  R4,R7               DCB,RB                               01146400
         EJECT                                                          01146800
*                                                                       01151200
*        ROUTINE TO RESTORE DEB CHAIN                                   01153200
*                                                                       01155200
R12F1    SR    R4,R4               INITALIZE PTR TO NEXT DEB            01155702
         TM    N0(R3),X80          IS THIS A DEB                        01166700
         BZ    R12H3               BRANCH IF NOT                        01176700
R12J1    EQU   *                   TEST FOR DUMMY DEB                   01177100
         SR    R0,R0               ZERO OUT REG FOR DEB LENGTH   YM3022 01177200
         CLI   N0(R3),N130         IS THIS A DUMMY DEB                  01177500
         BE    R12J15              IF YES, BRANCH                YM5720 01177902
         CLI   N0(R3),X83          IS THIS A SUBSYSTEM DEB       YM5720 01179902
         BNE   R12J2               IF NOT, BRANCH                YM5720 01180302
         IC    R0,DEBLNGTH+N1-DEBXTNP(R3) GET LENGTH OF DEB IN   YM5720 01180702
*                                  DOUBLE WORDS                  YM5720 01181102
         B     R12J3               GET CORE FOR DEB              YM5720 01181502
R12J15   EQU   *                   DUMMY DEB                     YM5720 01183302
         IC    R0,DEBLNGTH+N1-DEBPREFX(R3) GET LENGTH OF DUMMY DEB      01185902
*                                  IN DOUBLE WORDS                      01187702
         B     R12J3               GET CORE FOR DEB                     01189502
R12J2    EQU   *                   GET LENGTH FOR ISAM/NON-ISAM DEB     01191302
         IC    R0,DEBLNGTH+N1-DEB(R3) GET LENGTH OF DEB IN              01193102
*                                  DOUBLE WORDS                         01194902
R12J3    SLL   R0,N3               GET LENGTH IN BYTES                  01196702
         ICM   R0,N8,RM230         INSERT SUBPOOL NUMBER         Y02076 01198502
         LR    R2,R0               SAVE LENGTH                          01200302
         LA    R2,N0(R2)                CLEAR HI ORDER BYTE      Y02076 01202102
         MODESET EXTKEY=DATAMGT    SET KEY FOR GETMAIN           Y02076 01212502
         GETMAIN    R,LV=(0)                                            01222502
         MODESET EXTKEY=ZERO       RESTORE KEY 0                 Y02076 01232502
         ST    R1,CKSAVAR          STORE ADDR IN W.A.                   01242500
         ST    R1,RSCORE           SAVE ADDR OF GOTTEN CORE             01252500
         CLI   N0(R3),N130         IS THIS A DUMMY DEB                  01262500
         BNE   R12J35              BRANCH IF NO                  YM5720 01272502
         LA    R6,DEBBASIC-DEBPREFX(R1) DUMMY BASIC SECTION POINTER     01282502
         B     R12A4               GO MOVE IN DEB                       01286500
R12J35   EQU   *                   TEST FOR SUBSYSTEM DEB        YM5720 01288502
         CLI   N0(R3),X83          IS THIS A SUBSYSTEM DEB       YM5720 01288902
         BNE   R12J4               IF NOT, BRANCH                YM5720 01289302
         LA    R6,DEBBASIC-DEBXTNP(R1) SUBSYSTEM BASIC SECTION   YM5720 01289702
*                                  ADDRESS (PREFIX=8 BYTES)      YM5720 01290102
         B     R12A4               GO MOVE IN DEB                YM5720 01290202
R12J4    LA    R6,DEBBASIC-DEB(R1) PTR TO DEB BASIC SECTION             01290502
         USING DEBBASIC,R6         DEB                                  01290900
         CLI   N0(R3),N129         IS DEB FOR ISAM DATA SET             01291300
         BNE   R12A4               NO-BRANCH                            01291700
         LA    R7,DEBAPPAD+N1-DEB(R3) GET ADR OF WORD BEFORE ISAM PTRS  01292102
         LA    R8,N4               THERE ARE 4 OF THEM                  01292300
R12A3    LA    R7,N4(R7)           GET ADR. OF NEXT PTR.                01292400
         LR    R3,R6               GET BASIC SECTION ADR.               01309100
         MVC   RP40XCTL(N2),N2(R7) HALFWORD TO APPROPRIATE BDY          01319102
         AH    R3,RP40XCTL         RELOCATE POINTER                     01321102
         CR    R3,R6               Q. IS PTR ZERO                       01323100
         BE    R12A5               YES, DO NEXT POINTER                 01325100
         STCM  R3,N7,N1(R7)        SET EXTENT POINTER                   01325500
R12A5    BCT   R8,R12A3            ALL POINTERS DONE                    01325600
R12A4    LA    R3,N0(R0,R2)        GET LENGTH OF DEB                    01331302
         ST    R3,RPLNT            STORE IN W.A.                        01333300
         MVI   RSSWIT1,N1          POTENTIAL BIG BLOCK                  01335300
         BAL   RE,R13A1            GET NEXT DATA                        01335700
         CLI   DEBEXSCL,N0         IS THIS A SUBSYS TYPE DEB   @ZA17960 01336137
         BE    R12A2               YES BRANCH                  @ZA17960 01336237
         CLC   DEBDEVED(2),ABLEV   IS THIS A DUMMY SAM DEB     @ZA17960 01336337
         BNE   AROUND              NO BRANCH AROUND            @ZA31057 01336537
         TM    DEBEXSCL,X'02'      DUMMY DEB ???               @ZA31057 01337037
         BO    R12A2               YES                         @ZA31057 01337537
AROUND   EQU   *                                               @ZA31057 01338037
         TM    DEBPROTG,X80        EIGHT OR GREATER              YM7339 01339302
         BZ    R12A45              NO                            YM7339 01341302
         MVZ   DEBPROTG,TCBPKF     UPDATE DEB PROTECT KEY               01342302
R12A45   EQU   *                   INSTR MUST FOLLOW             YM7339 01344302
         OC    DEBAPPB(N3),DEBAPPB APPENDAGE PTR = 0                    01345102
         BNZ   R12A2               BRANCH IF NOT                        01347902
         MVC   DEBAPPB(N3),CKSAVAR+N1 UPDATE DEB APPEN PTR              01350700
R12A2    STCM  R4,N7,DEBDEBB       CHAIN DEBS                           01362702
         MVC   DEBTCBB(N3),RSTCBAD+N1 STORE IN TCB ADR.                 01363102
         STCM  R6,N7,RPMDEB+N1     DEB CHAIN INTO W.A.                  01363500
         L     R7,DEBDCBAD         GET DCB ADDRESS                      01363900
         USING IHADCB,R7           DCB                                  01364300
         STCM  R6,N7,DCBDEBA       DEB ADR TO DCB                       01364400
         LR    R4,R6               SAVE BACK CHAIN                      01364500
         DROP  R7                  DCB                                  01364600
*                                                                       01369200
*        ROUTINE TO RESTORE IRB'S AND IQE'S                             01371200
*                                                                       01373200
         CLI   N0(R3),N18          Q.  IS NEXT BLOCK AN IRB             01373600
         BNE   R12F3               NO-BRANCH                            01373700
         LH    R0,RBSIZE+N1+RBPRFLNA-RBSECT(R3) SIZE IN DOUBLE WORDS    01373802
         SLL   R0,N3               SIZE IN BYTES                        01378500
         ICM   R0,N8,RM253         SUBPOOL 253                          01380500
         LR    R6,R0               SAVE LENGTH                          01382500
         LA    R6,N0(R6)                CLEAR HI ORDER BYTE      Y02076 01382602
         GETMAIN  R,LV=(0)                                              01382900
         ST    R1,RSCORE           SAVE IRB ADDRESS                     01383000
         LR    R7,R1               ADDR OF GOTTEN CORE                  01383100
         A     R7,KRBPRFLN         GET ADDR OF RB BASIC SECTION         01383200
         USING RBSECT,R7           RB                                   01406500
         STCM  R7,N7,DEBIRBB-DEBBASIC(R4) MOVE IT TO DEB                01416500
         LA    R3,N0(R6)           LENGTH OF IRB                        01426500
         ST    R3,RPLNT            STORE IN W.A.                        01428500
         MVI   RSSWIT1,N1          POTENTIAL BIG BLOCK                  01428900
         BAL   RE,R13A1            TO INPUT BUFFER HANDLER              01429300
         TM    RBOPSW+N1,XF0       ZERO PROTECT KEY                     01429700
         BZ    R12F2               YES DO NOT RESET KEY                 01429800
         MVZ   RBOPSW+N1(N1),TCBPKF RESTORE PROTECT KEY                 01429902
R12F2    EQU   *                   IQE PROCESSING                       01430000
         TM    RBSTAB2,RBIQETP     ANY  IQE'S                           01437800
         BC    NOTHI,R12F3         NO BRANCH TO CHECK DEB               01439800
         L     RD,RBNEXAV          POINTER TO NEXT AVAIL. RB            01441800
         AR    RD,R7               ADD IRB ADDRESS                      01443800
         ST    RD,RBNEXAV          RESTORE TO RB FIELD                  01444200
         L     RD,RBIQE            PTR. TO LIST ORIGIN OF IQE'S         01444600
         AR    RD,R7               ADD IRB ADR.                         01445000
         ST    RD,RBIQE            RESTORE TO RBIQE FIELD               01445400
R12F3    EQU   *                   TEST FOR DEB                         01445500
         TM    N0(R3),X80          IS THIS A DEB                        01453300
         BO    R12J1               IF YES, GO PROCESS DEB        Y02076 01454302
         CLI   N0(R3),X20          IS THIS A DEB EXTENSION       Y02076 01454802
         BE    R12F4                    GO PROCESS DEB XTN     @ZA03659 01455237
         CLI   N0(R3),X21               A RESTORE LST(PIRL)?   @ZA03659 01457037
         BE    PIRL                YES PROCESS PIRL            @ZA28860 01460337
         CLI   N0(R3),X'22'        IS THIS THE FIRST EPCB ?    @ZA28860 01460437
         BE    EPCB1               YES BRANCH                  @ZA28860 01460537
         CLI   N0(R3),X'23'        IS THIS AN EPCB ???         @ZA28860 01460637
         BNE   R12H3               NO BRANCH FOR FLT PT REGS   @ZA28860 01460737
* WE WILL RESTORE THE EPCBS THAT WERE CHECKPOINTED             @ZA28860 01461137
* IN IHJQCP32 HERE.                                            @ZA28860 01461237
EPCBN    EQU   *                                               @ZA28860 01461337
         L     R0,EPCBCODE         SET UP SP230 AND BC LENGTH  @ZA28860 01461437
         LR    R2,R0               SAVE IN REG 2               @ZA28860 01461537
         LA    R2,0(0,R2)          CLEAR OUT SUBPOOL IN REG 2  @ZA28860 01461637
         GETMAIN R,LV=(0)          GETMAIN SPACE IN SP230      @ZA28860 01461737
         ST    R1,RSCORE           SAVE ADDRESS WE GETMAINED   @ZA28860 01461837
         ST    R2,RPLNT            SAVE LENGTH FOR MOVE        @ZA28860 01461937
         STCM  R1,N7,1(R6)         CHAIN EPCB INTO PIRL/EPCB   @ZA28860 01462037
         LR    R6,R1               SAVE ADDRESS                @ZA28860 01462437
         MVI   RSSWIT1,N1          SET BIG BLOCK SWITCH        @ZA28860 01462537
         BAL   RE,R13A1            GO TO BUFFER HANDLER        @ZA28860 01462637
         B     R12F3               CHECK NEXT RECORD           @ZA28860 01462737
EPCB1    EQU   *                                               @ZA28860 01462837
         LA    R6,24(0,R6)   POINT TO EPCB ADDRESS. REG 6 WAS  @ZA28860 01462937
*                            SET UP WHEN PROCESSING PIRL BELOW @ZA28860 01463037
         B     EPCBN               PROCESS EPCB                @ZA28860 01463137
PIRL     EQU   *                                               @ZA28860 01463237
*                                                                       01463337
*    ROUTINE TO REESTABLISH RESTORE I/O LIST (PIRL) - LENGTH            01463437
*    OF PIRL WAS SAVED IN DEBUSRPG FIELD AT CHECKPOINT TIME    @ZA03659 01463537
*                                                                       01463637
         DROP  R6                                              @ZA03659 01463737
         USING DEBBASIC,R4                                     @ZA03659 01463837
         SR    R0,R0                    CLEAR REG 0            @ZA03659 01463937
         ICM   R0,N3,DEBUSRPG+N2        GET PIRL LNGTH         @ZA03659 01464037
         LR    R2,R0                    SAVE LENGTH            @ZA03659 01464137
         ICM   R0,N8,RM254              SET SUBPOOL 254 ID     @ZA03659 01464237
         GETMAIN R,LV=(0)               GET BLOCK FOR PIRL     @ZA03659 01464337
         ST    R1,RSCORE                SAVE LAST CORE GOTTEN  @ZA03659 01464437
         STCM  R1,N7,DEBUSRPG+N1        PIRL ADR IN DEBUSRPG   @ZA03659 01464537
         LR    R6,R1                    SET PIRL ADDRESS IN R6 @ZA28860 01464637
         ST    R2,RPLNT                 LNGTH TO REPMAIN WA    @ZA03659 01464837
         MVI   RSSWIT1,N1               SET BIG BLOCK SWITCH   @ZA03659 01465037
         BAL   RE,R13A1                 TO BUFFER HANDLER      @ZA03659 01465637
         DROP  R4,R7               DEB, RB                     @ZA03659 01465837
         B     R12F3                    SEE IF NEXT BLK IS DEB @ZA03659 01465937
*                                                                Y02076 01466137
*        ROUTINE TO RESTORE DEB EXTENSIONS                       Y02076 01466437
*                                                                Y02076 01466637
R12F4    SR    R0,R0               CLEAR WORK REG                Y02076 01468237
         ICM   R0,N3,DEBXLNGH-DEBXTN+N1(R3) GET LENGTH OF EXT.   Y02076 01470037
         LR    R2,R0                    SAVE LENGTH              ZM0484 01471837
         ICM   R0,N8,RM230         INSERT SUBPOOL NUMBER         Y02076 01473637
         MODESET EXTKEY=DATAMGT    SET KEY FOR GETMAIN           Y02076 01475437
         GETMAIN R,LV=(0)                                        Y02076 01477237
         MODESET EXTKEY=ZERO       RESTORE KEY 0                 Y02076 01479037
         ST    R1,RSCORE           SAVE ADDR OF GOTTEN CORE      Y02076 01480837
         ST    R2,RPLNT                 LNGTH INTO RPMAIN WA     ZM0484 01482637
         MVI   RSSWIT1,N1               SET BIG BLOCK SWITCH     ZM0484 01484437
         BAL   RE,R13A1                 TO BUFFER HANDLER        ZM0484 01486237
         LA    R6,DEBBASIC-DEBPREFX POINT TO                     Y02076 01488037
         LNR   R6,R6               DEB                           Y02076 01489837
         AR    R6,R4               PREFIX                        Y02076 01491637
         USING DEBPREFX,R6         ADDR DEB PREFIX               Y02076 01493437
         L     R1,RSCORE                GET DEB EXT ADDR         ZM0484 01495237
         ST    R1,DEBXTNP          UPDATE DEB DEB EXT ADDR       Y02076 01497037
         USING DEBXTN,R1           ADDR DEB EXTENSION            Y02076 01498837
         ST    R4,DEBXDBPR         UPDATE DEB EXT DEB ADDR       Y02076 01500637
         NI    DEBXFLG1,X'FF'-DEBXDSSI RESET SECURITY BIT      @Z40RSRB 01501508
         DROP  R1,R6               DEB EXT AND DEB PREFIX        Y02076 01502437
         B     R12F3                    SEE IF NXT BLK IS DEB  @ZA03659 01502708
         EJECT                                                          01509308
*                                                                       01509637
*        ROUTINE TO RESTORE FLOATING POINT REGISTERS                    01511437
*                                                                       01513237
R12H3    MVC   RSREGSAV(N32),N1(R3) SAVE FLT PT REGS                    01515037
         LD    R0,RSREGSAV         RESTORE                              01516837
         LD    R2,RSREGSAV+N8      FLOATING                             01518637
         LD    R4,RSREGSAV+N16     POINT                                01520437
         LD    R6,RSREGSAV+N24     REGISTERS                            01522237
         LA    R3,N32              LENGTH OF FLT PT REGS                01524037
         ST    R3,RPLNT            STORE IN W.A.                        01525837
         BAL   RE,R13A1            TO INPUT BUFFER HANDLER              01527637
*                                                                       01529437
*     ROUTINE TO READ IN THE TIOT TO THE SAVE AREA                      01531237
*                                                                       01533037
         MVC   RPLNT,RSTIOTO       LENGTH OF TIOT                       01534837
         LA    R1,RSTIOT           ADDRESS OF SAVE AREA                 01536600
         ST    R1,RSTIOTAD         SAVE PTR TO OLD TIOT                 01546600
         MVI   RSSWIT1,N1          POTENTIAL BIG BLOCK           Y02076 01556602
         BAL   RE,R13A1            MOVE IN BLOCK                        01566600
         EJECT                                                          01566702
*                                                                Y02076 01566802
*        ROUTINE TO RESTORE CERTAIN DSAB INFORMATION AND UPDATE  Y02076 01567002
*        THE DEB DSAB ADDRESS                                    Y02076 01567202
*                                                                Y02076 01567302
R12H4    L     RF,TCBJSCB          GET JSCB ADDR                 Y02076 01567402
         USING IEZJSCB,RF          ADDR JSCB                     Y02076 01567502
         L     RF,JSCDSABQ         GET QDB ADDR                  Y02076 01567602
         USING QDB,RF              ADDR QDB                      Y02076 01567702
         L     RF,QDBFELMP         GET 1ST DSAB ADDR             Y02076 01567802
         L     R3,RSBFSTAD         GET RECORD ADDR               Y02076 01567902
         DROP  RF                  DROP QDB                      Y02076 01568002
R12J00   LR    R2,RF               GET 1ST DSAB ADDR             Y02076 01568202
         USING DSAB,R2             ADDR DSAB                     Y02076 01568602
         USING XDSAB,R3            ADDR DSAB INFO                Y02076 01568802
R12J10   L     R4,DSABTIOT         GET DD ENTRY ADDR             Y02076 01568902
         USING TIOENTRY,R4         ADDR DD ENTRY                 Y02076 01569002
         CLC   XDSADDNM,TIOEDDNM   DD NAMES MATCH                Y02076 01569102
         BE    R12J30              IF EQUAL, BR                  Y02076 01569202
         ICM   R2,M15,DSABFCHN     FETCH/TEST NEXT DSAB @        Y02076 01569302
         BNZ   R12J10              IF ANOTHER DSAB, BR           Y02076 01569402
*********************************************************************** 01569502
*    IF DATA SET IS AN IMPLIED VSAM CATALOG (X'24') - THE GENERATED     01569602
*    DDNAME IS NOT NECESSARILY THE SAME BETWEEN CHECKPOINT AND          01570102
*    RESTART - FOR THESE DATA SETS DO NOT GENERATE ERROR CODE (034)     01570502
*    AND DO NOT UPDATE THE DSAB                                 ZA00103 01570902
*********************************************************************** 01571102
         TM    XID,X24             IS IT PRIVATE CATL D.S.      ZA00103 01571302
         BO    R12J40              BRANCH IF YES                ZA00103 01571802
R12J20   MVI   RSRETCOD+N1,ERR032  SET MISSING DD ERROR CODE   @ZSUT222 01572308
         B     RPMERR              ERROR EXIT                    Y02076 01572802
R12J30   MVC   DSABOPCT,XDSAOPCT   RESTORE OPEN COUNT            Y02076 01573902
         MVC   DSABORG,XDSABORG    RESTORE DSORG                 Y02076 01574002
         MVC   DSABFLG1(L'DSABFLG1+L'DSABFLG2),XDSAFLG1 RESTORE  Y02076 01574302
*                                  FLAGS 1 AND 2                 Y02076 01574502
         OC    DSABFLG4,XDSAFLG4   RESTORE CKDS AND CKSI OF      Y02076 01575202
*                                  FLAG 4                        Y02076 01575902
         MVC   DSABDCBM,XDSADCBM   RESTORE DCB MODIFICATION MSK  Y02076 01576602
         TM    XDSAFLGS,XDSATCBP   WAS TCB @ IN CHKPT DSAB       Y02076 01577302
         BZ    R12J40              BR IF NOT                     Y02076 01578002
         MVC   DSABTCBP,RSTCBAD    RESTORE TCB ADDR              Y02076 01578702
R12J40   TM    XID,X44             WAS THIS THE LAST DSAB       ZA00103 01579402
         BO    R12J50              IF YES, BR                   ZA00103 01580102
         LA    R4,XDSABSIZ         GET LENGTH OF DSAB INFO       Y02076 01580802
         ST    R4,RPLNT            AND STORE IN WORKAREA         Y02076 01581502
         BAL   RE,R13A1            TO INPUT BUFFER HANDLER       Y02076 01582202
         L     R3,RSBFSTAD         GET RECORD ADDR               Y02076 01582902
         TM    XDSAFLGS,XDSACCAT   CONCATENATED DSAB ENTRY       Y02076 01583602
         BZ    R12J00              IF NO, GO INIT DSAB SCAN      Y02076 01584302
         ICM   R2,M15,DSABFCHN     FETCH/TEST NEXT DSAB ADDR     Y02076 01585002
         BZ    R12J20              NO MORE DSAB'S IS AN ERROR    Y02076 01585702
         L     R4,DSABTIOT         FETCH DD ENTRY ADDR           Y02076 01586402
         CLI   TIOEDDNM,BLANK      IS DD NAME BLANK              Y02076 01587102
         BNE   R12J20              IF NOT, IT'S AN ERROR         Y02076 01587802
         B     R12J30              GO RESTORE DSAB               Y02076 01588502
*                                                                Y02076 01589202
*        ROUTINE TO READ POSSIBLE SSCR OR EOD RECORD             Y02076 01589902
*                                                                Y02076 01590602
R12J50   MVC   RSLNGTH1,SSCRBUFL   ANTICIPATE 4K RECORD          Y02076 01591302
         STM   R1,RF,CKSAVAR+N4    SAVE REGS                     Y02076 01592002
         LA    RD,RSREGSAV         PTR TO SAVEAREA IN REG13      YM5312 01592702
         BAL   R7,R13D2            READ SSCR OR EOD RCD          Y02076 01593402
         LM    R1,RF,CKSAVAR+N4    RESTORE REGS                  Y02076 01594102
RSOUT    LR    R1,RC               LOAD REG 1 WITH ADDR OF RSTWA        01594802
         LA    RF,RPMN40           GET ADDR OF NEXT LOAD                01595502
         ST    RF,RP40XCTL         STORE IN RPWA1                       01596202
         LA    RF,RP40XCTL         GET ADDR OF RPMWA FIELD              01596902
         XCTL  SF=(E,(15))         XCTL TO NEXT LOAD                    01597602
         EJECT                                                          01598302
*                                                                       01599002
*        INPUT BUFFER HANDLER ROUTINE                                   01599702
*                                                                       01600402
R13A1    DS    0H                  BUFFER HANDLER ROUTINE               01601102
         STM   R1,RF,CKSAVAR+N4    SAVE REGS                            01601802
         LA    RD,RSREGSAV         SAVE AREA ADDRESS                    01602502
         L     R3,RPLNT            LENGTH OF BLOCK                      01603200
         L     R4,RSBFLWA          REMAINING BYTES                      01605200
         L     RA,RSBFSTAD         NEXT ADDRESS IN BUFFER               01607200
         LA    RA,N1(RA)           ALLOW FOR CODE BYTE                  01609200
         BCTR  R4,R0               ALLOW FOR CODE BYTE                  01609600
         TM    RSSWIT1,N1          IS THIS A BIG BLOCK                  01609700
         BZ    R13A2               NO-BRANCH                            01609800
         NI    RSSWIT1,XFE         YES- TURN OFF SWITCH                 01615400
R13B1    CR    R3,R4               ARE BYTES LEFT IN BLOCK G.T.         01617400
*                                  BYTES LEFT IN BUFFER                 01619400
         BNH   R13F1               NO   USE BLOCK LENGTH                01619800
         LR    R2,R4               YES  USE BYTES LEFT IN BUFFER        01620200
         BAL   R5,R13E1            MOVE IN SUR                          01620600
         L     R1,RSW001           RESTORE PTR TO NEXT BYTE IN GOTTEN   01620700
*                                  CORE                                 01620802
         B     R13B1               LOOP WITH LEFT OVER BYTES            01620900
R13F1    LR    R2,R3               USE BLOCK LENGTH AS CTR              01634800
         BAL   R5,R13E1                 MOVE IN SUR              Y02076 01644802
         B     R13A3X                   GO UPDATE PTRS           Y02076 01645202
         EJECT                                                          01646800
*                                                                       01647200
*        MOVE IN SUR ROUTINE                                            01647600
*                                                                       01648000
R13E1    DS    0H                  SUR PROCESSING                       01648400
         STM   R4,R7,RSERAS00      SAVE MOVE-LONG REGS           YM7357 01650402
         LR    R4,R1               GET TO-ADDRESS                YM7357 01652402
         LR    R6,RA               GET FROM-ADDRESS              YM7357 01652802
         LR    R5,R2               GET TO-LENGTH                 YM7357 01653202
         LR    R7,R2               GET FROM-LENGTH               YM7357 01654902
         MVCL  R4,R6               DATA TO CORE                  YM7357 01656902
         LM    R4,R7,RSERAS00      RESTORE MOVE-LONG REGS        YM7357 01657002
         AR    RA,R2               INCREMENT BUFFER PTR                 01657302
         AR    R1,R2               INCREMENT AREA POINTER               01658702
         ST    R1,RSW001           SAVE PTR TO NEXT BYTE IN GOTTEN      01660402
         SR    R4,R2               GET BYTES LEFT IN BUFFER             01662102
         SR    R3,R2               GET BYTES LEFT IN BLOCK              01663802
         BZ    R13A4               NO MORE BYTES IN BUFFER              01665502
         LTR   R4,R4               ANY MORE BYTES IN BUFFER             01667202
         BCR   NE,R5               YES, RETURN                          01668902
         BAL   R7,R13D2            READ NEW DATA                        01670602
         BR    R5                  RETURN                               01672302
R13A4    TM    RSSWIT1,N2          IS THE THE LAST BLOCK                01674002
         BO    R13C1               YES- NO MORE RECORDS                 01675702
         B     R13A3               NO- READ NEXT DATA                   01677402
R13A2    SR    R4,R3               COMPUTE NEW REMAINDER                01679100
         BZ    R13D1               NO MORE BYTES LEFT IN BUFFER         01689100
         AR    RA,R3               GET PTR TO NEXT DATA                 01691100
R13A3    CLI   N0(RA),N0           MORE USEABLE DATA IN BUF             01695000
         BE    R13D1               NO                                   01697000
         LTR   R4,R4               ANY MORE BYTES IN BUFFER             01699000
         BZ    R13D1               NO                                   01702900
R13A3X   LR    R3,RA               NEW DATA ADDR TO R3                  01704902
         ST    R3,RSBFSTAD         ADDRESS OF NEW DATA                  01706900
         ST    R4,RSBFLWA          RESTORE REMAINDER                    01710800
R13C1    LM    R1,RF,CKSAVAR+N4    RESTORE REGS                         01714802
         L     R3,RSBFSTAD         ADDRESS OF DATA                      01729000
         BR    RE                  RETURN                               01739000
R13D1    BAL   R7,R13D2            TO I/O ROUTINE                       01743002
         B     R13C1               RETURN                               01743100
         EJECT                                                          01747800
*                                                                       01749800
*        ROUTINE TO HANDLE I/O                                          01751800
*                                                                       01752200
R13D2    DS    0H                  I/O HANDLER                          01752600
         LR    RA,RC               BASE ADDRESS                         01757300
         A     RA,RSBFOFST         ADD OFFSET TO BUFFER                 01759300
         READ  RSDECB1,SF,,(RA),,MF=E                                   01761300
         CHECK RSDECB1                                                  01761700
         CLI   RSRETCOD+N1,ZERO    I/O ERRORS                   YA00153 01762102
         BNE   RPMERR              YES                          YA00153 01766802
         ST    RA,RSBFSTAD         1ST BYTE OF BUFFER                   01768800
         LA    R4,SURL             GET BUFFER LENGTH                    01770800
         ST    R4,RSBFLWA          INITIALIZE LENGTH OF BUFFER          01771200
         BR    R7                  RETURN                               01771600
RPMERR   EQU   *                   PLACE ERROR                          01776300
         MVI   RPMN40+N4,CHAR9     FOR I/O ERROR XCTL.                  01778300
         MVC   RSREGSAV(8),MODID   SAVE NAME OF MODULE THAT    @ZSUT222 01778808
*                                  HAS DETECTED THE ERROR.     @ZSUT222 01779308
         STM   0,15,RSREGSAV+8     SAVE CURRENT REGISTERS.     @ZSUT222 01779808
         B     RSOUT               XCTL INTERFACE                       01780300
*                                                                       01780700
*        SYNAD ROUTINE                                                  01781100
*                                                                       01782600
RPM127   DS    0H                  SYNAD ROUTINE                        01784600
         MVI   RSRETCOD+N1,ERR037  ERROR CODE                  @ZSUT222 01785008
         L     R1,RSIOBPT1              GET IOB ADDR            YA00153 01785408
         TM    N13(R1),WLR              IS THIS WRONG LEN ERR   YA00153 01785508
         BCR   ZEROES,RE                NO - RETURN             YA00153 01785608
*                                                                       01785702
*        IF WRONG LENGTH INDICATION WAS ENCOUNTERED ON READ OF   YM7056 01786102
*        SSCR, IGNORE IT.  THE SPIE SSCR MAY BE PRESENT.         YM7056 01786502
*                                                                       01786902
         CLC   RSLNGTH1,SSCRBUFL        IS THIS 4K BUFR LEN      YM7056 01787302
         BNE   RPM129                   NO, VALID WLR IND.       YM7056 01789302
         MVI   RSRETCOD+N1,N0           ZERO OUT ERROR CODE      YM7056 01791302
         BR    RE                       RETURN                   YM7056 01791402
RPM129   EQU   *                                                        01791702
         MVI   RSRETCOD+N1,ERR043       SET WRONG LEN IND      @ZSUT222 01792808
         RETURN                                                         01800602
*                                                                       01808102
         EJECT                                                          01815602
RSMOVE   MVC   N0(N1,R1),N0(RA)    MOVE IN BLOCK                        01823102
*                                                                       01830600
*        GENERAL CONSTANTS                                              01840600
*                                                                       01850600
RPMN40A  DC    CL8'IGC0805B'       CSECT NAME FOR XCTL                  01860600
MODID    DC    CL8'IGC0705B'       MODULE ID                   @ZSUT222 01865608
KRBPRFLN DC    A(RBPRFLNA)         LENGTH OF RBPREFIX                   01870600
ABLEV    DC    CL2'AV'             DUMMY DEB MODULE PREFIX     @ZA17960 01870737
SSCRBUFL DC    H'4096'             MAX LENGTH OF SSCR RECORD     Y02076 01870937
RM230    DC    AL1(230)            SUBPOOL 230                   Y02076 01871102
RM253    DC    AL1(253)            SUBPOOL 253                          01872600
RM254    DC    AL1(254)            SUBPOOL 254                          01874600
         DS    0F                                                       01874737
EPCBCODE DC    XL4'E60000BC'       SUBPOOL 230 BC LENGTH EPCB  @ZA28860 01874837
         SPACE 2                                                        01875000
PATCH    EQU   *                   END OF MODULE                        01875400
RP3LN    EQU   PATCH-IGC0705B      LENGTH OF CSECT                      01890400
RP3PALN  EQU   RP3LN/10            LENGTH OF PATCH AREA                 01900400
RP3PATCH DS    XL(RP3PALN)         10 PERCENT ALLOWANCE FOR PATCH AREA  01902400
         SPACE                                                          01904400
*                                                                       01904800
*        EQUATES FOR REGISTER BRANCHES                                  01905200
*                                                                       01905300
NE       EQU   7                   CONDITION CODE 7                     01910300
NOTHI    EQU   12                  CONDITION CODE 12                    01912300
         SPACE                                                          01914300
*        EQUATES FOR BIT TESTING                                        01914700
*                                                                       01915100
X01      EQU   X'01'               TEST MASK                     Y02076 01915602
X20      EQU   X'20'               CODE FOR DEB EXTENSION        Y02076 01915702
X21      EQU   X'21'               RESTORE LIST(PIRL) CODE     @ZA03659 01915837
X44      EQU   X'44'               LAST DSAB RCD CODE            Y02076 01916002
XFE      EQU   X'FE'               X'FE'                                01916102
X80      EQU   X'80'               CODE FOR DEB                         01916602
X83      EQU   X'83'               CODE FOR SUBSYSTEM DEB        YM5720 01926602
XF0      EQU   X'F0'               MASK FOR PROTECT KEY                 01927800
         SPACE                                                          01937800
*        EQUATES FOR GENERAL DISPLACEMENTS                              01939800
*                                                                       01940200
N0       EQU   0                   0                                    01944400
N1       EQU   1                   1                                    01946400
N2       EQU   2                   2                                    01948400
N3       EQU   3                   3                                    01948500
N4       EQU   4                   4                                    01952700
N7       EQU   7                   7                                    01954700
N8       EQU   8                   8                                    01956700
N12      EQU   12                  12                                   01956800
N13      EQU   13                       CONSTANT 13             YA00153 01958802
N16      EQU   16                  16                                   01966800
N18      EQU   18                  CODE FOR IRB                         01967400
N20      EQU   20                  20                                   01977400
N24      EQU   24                  24                                   01977500
X24      EQU   X'24'               IMPLIED PRIV. CATL DSAB CODE ZA00103 01977602
N28      EQU   28                  28                                   01977800
N32      EQU   32                  LENGTH OF F.P.REGISTERS              01978200
N64      EQU   64                  LENGTH OF GPR                        01978300
N128     EQU   128                 CODE FOR NON-ISAM DEB                01981800
N129     EQU   129                 CODE FOR ISAM DEB                    01983800
N130     EQU   130                 CODE FOR DUMMY DEB                   01984200
ZERO     EQU   0                        0 FOR TESTING RET CODE  YA00153 01984302
ZEROES   EQU   8                        CONDITION FOR BCR       YA00153 01984402
WLR      EQU   X'40'                    WRONG LENGTH RECORD     YA00153 01984502
*                                       INDICATION IN IOB       YA00153 01986102
ERR043   EQU   43                       ERROR CODE FOR WRONG   @ZSUT222 01988108
*                                       LENGTH RECORD WHILE     YA00153 01988502
*                                       READING CHKPT D/S       YA00153 01988902
*                                                                       01989802
*        GENERAL REGISTER EQUATES                                       01991402
*                                                                       01993002
R0       EQU   0                   REGISTER 0                           01994602
R1       EQU   1                   REGISTER 1                           01996202
R2       EQU   2                   REG 2                                01997802
R3       EQU   3                   REG 3                                01999402
R4       EQU   4                   REG 4                                02001002
R5       EQU   5                   REG 5                                02002602
R6       EQU   6                   REG 6                                02004202
R7       EQU   7                   REG 7                                02005802
R8       EQU   8                   REG 8                                02007402
R9       EQU   9                   REG 9                                02009002
RA       EQU   10                  REG 10                               02010602
RB       EQU   11                  REG 11                               02012202
RC       EQU   12                  REG 12                               02013802
RD       EQU   13                  REG 13                               02015402
RE       EQU   14                  REG 14                               02017002
RF       EQU   15                  REG 15                               02018602
         SPACE                                                          02020202
RPMWA1   DSECT                                                          02021802
*                                                                       02023402
*        DSECT FOR REPMAIN WORK AREA                                    02025002
*                                                                       02026602
RPMERAS1 DS    F                   TEMP SAVE AREA                Y02076 02028202
RMNEOV   DS    F                   TO TEST IF EOV OCCURRED              02029800
RSBFSTAD DS    F                   ADDRESS OF DATA                      02039800
RSBFLWA  DS    F                   NUMBER OF BYTES REMAINING IN BUFFER  02041800
RPMMSS1  DS    F                   ADDR OF NEW L-SHAPED PROG MSS CHAIN  02041900
RPMMSS2  DS    F                   ADDRESS OF NEW INIT MSS CHAIN        02043200
RPMMSS3  DS    F                   ADDRESS OF NEW P/P MSS CHAIN         02045200
RPMRB    DS    F                   ADDRESS OF RESTORED RB CHAIN         02045600
RPMLLE   DS    F                   ADDRESS OF RESTORED LLE CHAIN        02045700
RPMCDE   DS    F                   ADDRESS OF RESTORED CDE CHAIN        02045800
RPMDEB   DS    F                   ADDRESS OF RESTORED DEB CHAIN        02048100
RPMFOE   DS    F                   ADDRESS OF RESTORED FOE CHAIN        02050100
RSCORE   DS    F                   ADDR OF CORE AQUIRED BY LAST GETMAIN 02052100
RSW001   DS    F                   POINTER TO NEXT BYTE AVAILABLE CORE  02052500
RSW002   DS    F                   POINTER TO REPMAIN SYNAD ROUTINE     02052600
RPLNT    DS    F                   LENGTH OF THE BLOCK                  02052700
RMADEOV  DS    F                   SAVE AREA FOR INFORMAION NEEDED      02053000
         DS    0D                  ALIGNMENT                            02053400
CKSAVAR  DS    16F                 GENERAL SAVE AREA                    02053500
RPMN40   DS    D                   MODULE NAME FOR XCTL                 02056400
RP40XCTL DC    F'0'                POINTER TO XCTL PARAMETER LIST       02058400
RSSWIT1  DS    X'00'               BIG BLOCK INDICATOR                  02058800
*                                                                       02059200
*        GENERAL EQUATES                                                02059300
*                                                                       02062800
CHAR9    EQU   C'9'                CHAR FOR XCTL TO REPMAIN 5           02064800
SURL     EQU   400                 BUFFER LENGTH                 YM7049 02065202
ERR037   EQU   37                  I/O ERROR CODE              @ZSUT222 02069908
ERR032   EQU   32                  MISSING DD ERROR CODE       @ZSUT222 02070208
BLANK    EQU   C' '                BLANK CONSTANT                Y02076 02070902
M7       EQU   7                   INSERT CHAR MASK              Y02076 02071402
M15      EQU   15                  INSERT CHAR MASK              Y02076 02071502
         EJECT                                                          02071908
*                                                                Y02076 02072008
*        DSECT FOR DSAB SUR RECORD                               Y02076 02072108
*                                                                Y02076 02072208
XDSAB    DSECT                     DSAB BLK DSECT                Y02076 02072308
XID      DS    CL1                 SUR ID                        Y02076 02072408
XDSAOPCT DS    CL2                 DCB OPEN COUNT                Y02076 02072508
XDSABORG DS    CL2                 DATA SET ORG                  Y02076 02072608
XDSAFLG1 DS    CL1                 DSAB FLAG 1                   Y02076 02072708
XDSAFLG2 DS    CL1                 DSAB FLAG 2                   Y02076 02072808
XDSAFLG4 DS    CL1                 DSAB FLAG 4                   Y02076 02072908
XDSADCBM DS    CL6                 DCB MODIFICATION MASK         Y02076 02073008
XDSADDNM DS    CL8                 DD NAME                       Y02076 02073108
XDSAFLGS DS    CL1                 DSAB PROCESS FLAGS            Y02076 02073208
XDSACCAT EQU   X'80'               DSAB IS CONCATENATED          Y02076 02073308
XDSATCBP EQU   X'40'               DSAB HAS TCB ADDR             Y02076 02073408
XDSABSIZ EQU   *-XDSAOPCT          DSAB BLK SIZE                 Y02076 02073508
         TITLE 'IHJQRS22 - REPMAIN  WORK AREA'                          02073602
         IEEVRSWA  VER=3    USE AOS2  VERSION OF WA                     02073802
         TITLE 'IHJQRS22 - DATA CONTROL BLOCK'                          02074002
*  DATA CONTROL BLOCK                                                   02074202
         IHADCB DSORG=(PO,PS),DEVD=(DA,TA)                              02074402
         TITLE 'IHJQRS22 - TASK CONTROL BLOCK'                          02074600
*  TASK CONTROL BLOCK                                                   02076600
         IKJTCB                                                         02076700
         TITLE 'IHJQRS22 - REQUEST BLOCK - S.V.R.B.,I.R.B.'             02080000
*  REQUEST BLOCK - S.V.R.B.,I.R.B.                                      02082000
         IKJRB                                                          02082400
         TITLE 'IHJQRS22 - DATA EVENT BLOCK'                            02082800
*  DATA EVENT BLOCK                                                     02083200
         IEZDEB                                                         02083300
         TITLE 'IHJQRS22 - JSCB'                                        02084302
         IEZJSCB                                               , Y02076 02084402
         TITLE 'IHJQRS22 - QDB'                                         02084502
         IHAQDB                                                , Y02076 02084802
         TITLE 'IHJQRS22 - DSAB'                                        02084902
         IHADSAB                                               , Y02076 02085002
         TITLE 'IHJQRS22 - TIOT'                                        02085102
         IEFTIOT1                                              , Y02076 02085202
         EJECT                                                          02085402
         END                                                            02135408
./  ADD  SSI=81150478,NAME=IHJQRS23
         TITLE 'IHJQRS23 - AOS/2 REPMAIN 4 ROUTINE - IGC0805B'          02250000
*        VS2 RELEASE 037 CHANGES                               @ZSUT222 02260037
* APAR OZ31481 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 02270037
*C056956,057035,061893,062015,063684,064530                    @ZSUT222 02277037
*A062749-062754,063748                                         @ZSUT222 02284037
* STATUS                                                                02300000
*                                                                       02350000
* FUNCTION-                                                             02400000
*                                                                       02450000
*    REPMAIN 4 RESETS THE SUPERVISOR CONTROL BLOCKS TO REFLECT          02500000
*    THE STATUS OF THE RESTARTING TASK AT CHECKPOINT TIME. IT           02550000
*    ALSO RELEASES CONTROL OF ALL LPA MODULES FOR RESTART BY            02600000
*    USING THE DELETE SYSTEM FUNCTION.                                  02650002
*                                                                       02800000
* ENTRY POINTS                                                          02850000
*         IGC0805B                                                      02900000
*    ENTERED FROM REPMAIN 3 TO UPDATE THE RESTART                       02950000
*    SYSTEM CONTROL BLOCKS TO REFLECT THE STATUS OF THE USER            03000000
*    CHECKPOINT TIME.                                                   03050000
*                                                                       03100000
* INPUT-                                                                03150000
*    GPR12- CONTAINS THE ADDRESS OF THE RESTART WORK AREA(RSTWA)        03200000
*                                                                       03250000
* OUTPUT                                                                03300000
*    GPR 1-CONTAINS THE ADDRESS OF THE RSTWA                            03350002
*                                                                       03400000
* EXTERNAL REFERENCES                                                   03450000
*    NONE                                                               03500000
*                                                                       03550000
* EXITS, NORMAL                                                         03600000
*    REPMAIN 5(IGC0905B) TO FREE THE RESTART CONTROL                    03650000
*    BLOCKS REPLACED BY THE CHECKPOINTED CONTROL BLOCKS                 03700000
*    AND TO RESET THE KEYS ON THE ALLOCATED PAGES OF                    03750000
*    THE REGION                                                         03800000
*                                                                       03850000
* EXITS, ERROR                                                          03900000
*    REPMAIN 5(IGC0905B) WITH RSRETCOD SET TO 202              @ZSUT222 03950037
*    IF SETLOCK ERROR ENCOUNTERED                                Y02076 03953002
*                                                                       04000000
* TABLES/WORK AREAS                                                     04050000
*                                                                       04100000
*    RSTWA                                                              04150000
*                                                                       04200000
*    RPMWA                                                              04250000
*                                                                       04300000
*    TCB       TCBMSS                                                   04350000
*    .         TCBOTC                                                   04400000
*    .         TCBLLS                                            Y02076 04450002
*    .         TCBRBP                                                   04500000
*    .         TCBPKF                                            Y02076 04550002
*    .         TCBJPQ                                                   04600000
*    .         TCBJLB                                                   04650000
*                                                                       04700000
*    LLE       LLECOUNT                                          Y02076 04750002
*    .         LLESYSCT                                          Y02076 04753002
*    .         LLECHN                                            Y02076 04800002
*    .         LLECDPT                                           Y02076 04850002
*                                                                       04900000
*    CDE       CDUSE                                             Y02076 04950002
*    .         CDCHAIN                                                  05000000
*    .         CDRRBP                                            Y02076 05050002
*    .         CDXLMJP                                                  05100000
*    .         CDATTR                                            Y02076 05103002
*    .         CDATTR2                                           Y02076 05150002
*    .         CDNAME                                            Y02076 05153002
*                                                                       05200000
*    RB        RBLINK                                                   05250000
*                                                                       05300000
*    SCB       SCBCHAIN                                          Y02076 05350002
*    .         SCBOWNRA                                          Y02076 05353002
*    .         SCBPKEY                                           Y02076 05356002
*                                                                Y02076 05359002
*    CVT       CVTLINK                                           Y02076 05359602
*                                                                Y02076 05359702
*    PSA       PSALITA                                           Y02076 05359802
*                                                                Y02076 05359902
*    XTLST     XTLMSBAA                                          Y02076 05362902
*                                                                       05365902
* ATTRIBUTES-                                                           05396000
*    KEY 0, SUPERVISOR STATE, ENABLED                                   05398000
*                                                                       05398400
* CHARACTER CODE DEPENDENCY                                             05398800
*    NONE                                                               05399200
*                                                                       05399600
* NOTES                                                                 05399700
*    APPLICABILITY-AOS/2                                                05399800
*    DEPENDENCIES- NONE                                                 05399900
*    INTERFACES- DELETE AND SETLOCK                              Y02076 05449902
*                                                                       05459900
         EJECT                                                          05469900
IGC0805B CSECT                                                          05479900
         BALR  RB,N0               ADDRESSABILITY FOR MODULE            05489900
         USING *,RB                BASE REGISTER 11                     05491900
         USING RSTWA,RC            RESTART WORK AREA                    05493900
         USING RPMWA1,R9           REPMAIN WORK AREA                    05495900
         USING TCB,R5              TCB                                  05497900
         USING RBSECT,R4           RB                                   05498300
         B     RM4BEGIN            BRANCH AROUND CONSTANTS              05498700
         DC    H'0'                PAD TWO BYTES ZEROS                  05499100
         DC    CL8'IGC0805B'       MODULE NAME                 @ZSUT222 05499537
         DC    CL8'&SYSDATE'       LAST DATE SHIPPED           @ZSUT222 05506537
         DC    CL8'@ZSUT222'       LAST CODE SHIPPED           @ZSUT222 05513537
RM4BEGIN L     R9,RSMWOFST         OFFSET TO REPMAIN'S W.A.             05520537
         AR    R9,RC               TO ESTABLISH BASE FOR W.A.           05527537
         L     R5,RSTCBAD          GET TCB ADDR                         05534537
         LA    R3,RPMMSS3          GET PTRS TO                          05549800
         LA    R4,TCBMSS           NEW AND OLD TCBMSS CHAINS            05559800
         BAL   R6,RPMSWAP          AND SWAP THEM                        05569800
         L     R5,TCBOTC           GET INIT TCB                         05579800
         LA    R4,TCBMSS           INIT TCBMSS                          05589800
         LA    R3,RPMMSS2          SWAP MSS CHAINS                      05591800
         BAL   R6,RPMSWAP          GO TO SWAP RTN                       05593800
         L     R5,TCBOTC           GET STC TCB                   Y02076 05595802
         LA    R4,TCBMSS           STC TCBMSS                           05597800
         LA    R3,RPMMSS1          SWAP MSS CHAINS                      05598200
         BAL   R6,RPMSWAP          GO TO SWAP RTN                       05598600
         L     R5,RSTCBAD          P/P TCB                              05600202
         L     R4,TCBRBP           RESTART SVRB                         05600702
         LA    R4,RBLINK           SVRB'S RB PTR                        05601202
         LA    R3,RPMRB            ADRS OF RESTORED RB CHAIN            05601702
         BAL   R6,RPMSWAP          SWAP RB CHAINS                       05602202
         DROP  R4                  RB                            Y02076 05602702
         SPACE 2                                                        05633100
*                                                                       05643100
* ANY LLE WITH A CDE ON THE LPAQ WILL BE DELETED VIA USE OF THE         05653100
* DELETE SYSTEM SERVICE.                                                05663100
*                                                                       05665100
         L     R8,TCBLLS           ADDRESS OF RESTART LLE CHAIN         05665502
R11A1    LTR   R8,R8               ANY LLE'S                     Y02076 05666302
         BZ    R11A4               NO'SWAP LLE'S                        05666400
         USING LLE,R8              LLE                                  05666500
         L     R7,LLECHN           GET ADDRESS OF NEXT LLE              05677600
         L     R3,LLECDPT          ADDRESS OF CDE FOR MODULE            05687600
         USING CDENTRY,R3          CDE                                  05688000
         TM    CDATTR,CDNIP        CDE IN LPAQ                          05688400
         BZ    R11A3               NO GET NEXT LLE                      05688800
         LH    R6,LLECOUNT         GET TOTAL LOAD COUNT          Y02076 05689802
         BCT   R6,R11A1A           DECR BY 1, IF COUNT WAS       YM7045 05690802
*                                  GREATER THAN 1, GO DELETE     YM7045 05690902
         B     R11A3               IF COUNT WAS 1, SKIP DELETE   YM7045 05691202
*        THE DELETE COUNT HAS BEEN CORRECTED BY -1               YM7045 05691302
R11A1A   LA    RF,RSREGSAV         GET SAVEAREA ADDR             YM7045 05691402
         STM   R0,RF,N0(RF)        SAVE REGS                     Y02076 05691502
R11A11   SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02076,05691802
               RELATED=(LOCAL,IGC0805B(R11A14))                  Y02076 05692802
         LTR   RD,RD               SETLOCK ERROR                 Y02076 05693402
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 05693502
         BNZ   R13A1               IF ERROR, BR                  Y02076 05693602
R11A12   SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                    Y02076,05693802
               RELATED=(CMS,IGC0805B(R11A13))                    Y02076 05694802
         LTR   RD,RD               SETLOCK ERROR                 Y02076 05694902
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 05695402
         BZ    R11A12B             IF NO ERROR, BR               Y02076 05695502
         MVI   RSRETCOD+N1,ERR202 STORE SETLOCK ERROR CODE     @ZSUT222 05695637
         B     R11A14              GO RELEASE LOCAL LOCK         Y02076 05696237
R11A12B  LH    R4,CDUSE            GET CDE USE COUNT             Y02076 05696537
         SR    R4,R6               DECR BY TOTAL LLE USE         Y02076 05696802
*                                  COUNT - 1                     Y02076 05697802
         STH   R4,CDUSE            UPDATE CDE USE COUNT          Y02076 05698802
         STM   R0,RF,N0(RF)        SAVE REGS                     Y02076 05699402
R11A13   SETLOCK RELEASE,TYPE=CMS,                               Y02076,05699802
               RELATED=(CMS,IGC0805B(R11A12))                    Y02076 05700802
R11A14   SETLOCK RELEASE,TYPE=LOCAL,                             Y02076,05701802
               RELATED=(LOCAL,IGC0805B(R11A11))                  Y02076 05702802
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 05703402
         CLI   RSRETCOD+N1,ERR202 SETLOCK ERROR                @ZSUT222 05703537
         BE    RSOUT               IF ERROR, GO XCTL TO 905B     Y02076 05703737
R11A3    MVC   RPMN40,CDNAME       INSURE NAME IS AVAILABLE      Y02076 05703802
         LA    R4,N1               SET                           Y02076 05704802
         STH   R4,LLECOUNT         TOTAL AND                     Y02076 05705802
         STH   R4,LLESYSCT         SYSTEM COUNTS TO 1 SO         Y02076 05706802
*                                  LLE WILL BE FREED BY DELETE   Y02076 05707802
         DELETE EPLOC=RPMN40                                     Y02076 05708802
         LR    R8,R7               ADDR OF NEXT LLE              Y02076 05709802
         B     R11A1               BRANCH                               05746200
         DROP  R3,R8               CDE,LLE                              05756200
*                                                                       05766200
* SWAP THE LLE,CDE AND STAE POINTERS                                    05776200
*                                                                       05786200
R11A4    LA    R3,RPMLLE           ADDRESS OF RESTORED LLE              05788200
         LA    R4,TCBLLS           ADDRESS OF RESTART LLE CHAIN         05790200
         BAL   R6,RPMSWAP          SWAP LLE CHAINS                      05792200
         LA    R4,TCBJPQ           ADDR OF RESTART CDE CHAIN            05794200
         LA    R3,RPMCDE           ADDR OF RESTORED CDE'S               05794600
         BAL   R6,RPMSWAP          SWAP CDE CHAINS                      05795000
         MVC   RSINT+N1(N3),RPMDEB+N1 PASS RESTORED DEB CHAIN           05796002
*                                                                       05796102
*     ROUTINE TO MODIFY POINTERS IN CDE'S AND SCB'S                     05822802
*     THIS ROUTINE FIRST TESTS THE CDE OVERLAY FLAG AND IF SET,  Y02076 05823402
*     THE SEGTAB NOTE LIST AND DCB ADDRESSES ARE UPDATED.        Y02076 05824002
*     NEXT THIS ROUTINE RESTORES THE POINTERS TO THE RB IN EACH  Y02076 05824802
*     CDE.  BEFORE RESTORATION, EACH CDE CONTAINS A POSITIONAL          05826800
*     POINTER IN THE FORM OF AN INTEGER N.  THE ROUTINE                 05828800
*     FOLLOWS THE CHAIN OF RB'S UNTIL IT FINDS THE 'NTH' RB.  IT THEN   05829200
*     PUTS THE ADDRESS OF THIS RB INTO THE CDE.                  Y02076 05829302
*     THE RB POINTER IN THE SCB IS RESTORED IN THE SAME WAY             05839000
*                                                                       05839400
         SPACE 1                                                        05839800
*                                                                       05840200
*        RESET RB POINTER IN CDE                                        05840300
*                                                                       05840400
         ICM   R3,M15,TCBJPQ       GET/TEST 1ST CDE ADDR         YM7347 05840502
         BZ    R12A10              IF NO CDE, BR                 YM7347 05850502
         USING CDENTRY,R3          CDE                                  05880300
         L     R2,CVTPTR           LOCATE CVT                           05890300
         USING CVT,R2              CVT                                  05900300
R11B1    TM    CDATTR2,CDOLY       OVERLAY PROGRAM               Y02076 05900802
         BZ    R11B3               BR NO                         Y02076 05901302
         L     R4,CDXLMJP          GET EXTENT LIST ADDR          Y02076 05901802
         USING XTLST,R4            XTLIST                        Y02076 05902302
         L     R6,XTLMSBAA         GET SEGTAB ADDR               Y02076 05902802
         DROP  R4                  XTLIST                        Y02076 05903302
         LA    R4,N16(,R4)         GET NOTE LIST ADDR            Y02076 05903802
         ST    R4,N4(,R6)          NOTE LIST ADDR IN SEGTAB      Y02076 05904302
         TM    CDRRBP,LINKLIB      DID SEGTAB POINT TO LINKLIB   Y02076 05904802
*                                  AT CHKPT TIME                 Y02076 05905302
         MVI   CDRRBP,N0           RESET IND IF ON               Y02076 05905802
         BO    R11B2               BR YES                        Y02076 05906302
         MVC   N1(N3,R6),TCBJLB+N1 SEGTAB DCB PTR TO JOBLIB DCB  Y02076 05906802
         B     R11B3               GO AROUND                     Y02076 05907302
R11B2    MVC   N1(N3,R6),CVTLINK+N1 SEGTAB DCB PTR TO LINKLIB    Y02076 05908302
*                                  DCB                           Y02076 05908802
R11B3    SR    R4,R4               CLEAR WORKREG                        05910300
         IC    R4,CDRRBP+N3        POSITIONAL PTR TO PRB         Y02076 05920302
         LTR   R4,R4               CDE HAVE AN RB                       05933600
         BZ    R11B5               NO,BRANCH                     Y02076 05943602
         LA    R6,N1               SET SEARCH COUNT=1                   05945600
         L     R7,TCBRBP           GET FIRST RB                         05946000
         USING RBSECT,R7           RB                                   05946400
R11E3    CR    R4,R6               IS THIS RB FOR THIS CDE              05946800
         BE    R11E4               YES-BRANCH                           05951200
         L     R7,RBLINK           GET NEXT RB                          05953200
         LA    R6,N1(N6)           INCREMENT SEARCH COUNT               05955200
         B     R11E3               CHECK THIS PRB                       05955600
R11E4    ST    R7,CDRRBP           UPDATE CDE RB PTR             Y02076 05955702
R11B5    L     R3,CDCHAIN          GET NEXT CDE                         06090500
         LTR   R3,R3               ANY MORE CDE'S                       06091300
         BNZ   R11B1               YES-BRANCH                           06091702
         DROP  R3                  CDE                                  06092100
*                                                                       06092200
*        RESET RB POINTER IN SCB'S                                      06092300
*                                                                       06092400
R12A10   L     R3,RSNSTAE          GET ADDRESS OF FIRST SCB      YM7347 06109102
         USING SCB,R3              SCB                                  06119100
R12A11   LA    R3,N0(R3)           CLEAR HIGH BYTE                      06121100
         LTR   R3,R3               ANY SCB'S                            06123100
         BZ    R12B1               NO-BRANCH                            06125100
         LA    R6,N1               SET SEARCH COUNT=1                   06125500
         SR    R4,R4               CLEAR WORK REG                       06125600
         IC    R4,SCBOWNRA+N2      GET POSITIONAL NUMBER                06125700
         L     R7,TCBRBP           GET ADDRESS OF RB                    06131300
R12A12   CR    R4,R6               SEARCH COUNT =POSITIONAL INDEX       06133300
         BE    R12A13              YES-UPDATE SCB RB PTR                06135300
         L     R7,RBLINK           GET NEXT RB                          06135700
         LA    R6,N1(R6)           INCREMENT SEARCH COUNT BY 1          06136100
         B     R12A12              LOOP TO CONTINUE SEARCH              06136500
R12A13   STCM  R7,N7,SCBOWNRA      PUT RB POINTER IN SCB                06136600
         CLI   SCBPKEY,N8          IS KEY SUBJECT TO CHANGE      Y02076 06137602
         BL    R12A13A             BR NO                         Y02076 06137802
         MVC   SCBPKEY,TCBPKF      ADJUST USER KEY               Y02076 06138002
R12A13A  L     R3,SCBCHAIN         GET NEXT SCB ADDRESS                 06138602
         B     R12A11              LOOP TO PROCESS NEXT SCB             06139602
         DROP  R3,R7               SCB,RB                               06150700
*                                                                       06160700
* FOR A LLE WITH A CDE IN THE LPAQ THE CDE USE COUNT             Y02076 06162702
* WILL BE INCREMENTED BY THE LLE RESPONSIBILITY COUNT.           Y02076 06163102
*                                                                       06163900
R12B1    EQU   *                   UPDATE COUNT                         06164300
         L     R3,TCBLLS           GET FIRST LLE ON P/P TCB             06164400
R12B11   LTR   R3,R3               ARE THERE ANY LLE'S           Y02076 06164602
         BZ    RSOUT               NO-BRANCH                     Y02076 06169202
         USING LLE,R3              LLE                                  06171200
         L     R7,LLECDPT          LOAD ADDR OF CDE                     06173200
         USING CDENTRY,R7          CDE                                  06173600
         TM    CDATTR,CDMIN        IS THIS A MINOR CDE                  06173700
         BZ    R12B11A             NO-BRANCH                            06173800
         L     R7,CDXLMJP          GET ADDR OF MAJOR CDE                06173900
R12B11A  TM    CDATTR,CDNIP        LLECDE IN LPA                        06178500
         BZ    R12B12              NO-BRANCH                            06180500
         LH    R6,LLECOUNT         GET LLE TOTAL LOAD COUNT      Y02076 06181502
         BCT   R6,R12B11A1         DECR BY 1, IF COUNT WAS       YM7045 06182502
*                                  GREATER THAN 1, UPDATE CDE    YM7045 06182902
         B     R12B12              OTHERWISE, SKIP CDE UPDATE    YM7045 06183502
R12B11A1 EQU   *                   NON-ZERO ENTRY                YM7045 06184502
*        THE LOAD COUNT HAS ALREADY BEEN CORRECTED BY -1         YM7045 06184902
         LA    RF,RSREGSAV         GET SAVEAREA ADDR             Y02076 06185102
         STM   R0,RF,N0(RF)        SAVE REGS                     Y02076 06185202
R12B11B  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02076,06185502
               RELATED=(LOCAL,IGC0805B(R12B11E))                 Y02076 06186502
         LTR   RD,RD               SETLOCK ERROR                 Y02076 06187102
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 06187202
         BNZ   R13A1               IF ERROR, BR                  Y02076 06187302
R12B11C  SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                    Y02076,06187502
               RELATED=(CMS,IGC0805B(R12B11D))                   Y02076 06188502
         LTR   RD,RD               SETLOCK ERROR                 Y02076 06188602
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 06189102
         BZ    R12B11CA            IF NO ERROR, BR               Y02076 06189202
         MVI   RSRETCOD+N1,ERR202  STORE SETLOCK ERROR CODE    @ZSUT222 06189337
         B     R12B11E             GO RELEASE LOCAL LOCK         Y02076 06189937
R12B11CA LH    R0,CDUSE            GET CDE USE COUNT             Y02076 06190237
         AR    R6,R0               BUMP BY LLE TOTAL COUNT-1     Y02076 06190502
         STH   R6,CDUSE            UPDATE CDE USE COUNT          Y02076 06191502
         STM   R0,RF,N0(RF)        SAVE REGS                     Y02076 06192102
R12B11D  SETLOCK RELEASE,TYPE=CMS,                               Y02076,06192502
               RELATED=(CMS,IGC0805B(R12B11C))                   Y02076 06193502
R12B11E  SETLOCK RELEASE,TYPE=LOCAL,                             Y02076,06194502
               RELATED=(LOCAL,IGC0805B(R12B11B))                 Y02076 06195502
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 06198502
         CLI   RSRETCOD+N1,ERR202  SETLOCK ERROR               @ZSUT222 06201537
         BE    RSOUT               IF ERROR, GO XCTL TO 905B     Y02076 06204502
R12B12   L     R3,LLECHN           GET NEXT LLE                         06229900
         B     R12B11              LOOP PROCESS LLE                     06230000
         DROP  R3,R7               LLE,CDE                              06237800
RSOUT    MVC   RPMN40,RPMN40A      SET FIELD FOR XCTL TO NEXT LOAD      06274800
         MVC   RSREGSAV(8),MODID   SAVE NAME OF MODULE THAT    @ZSUT222 06274937
*                                  HAS DETECTED THE ERROR      @ZSUT222 06275037
         STM   0,15,RSREGSAV+8     SAVE THE CURRENT REGISTERS  @ZSUT222 06275437
         LR    R1,RC               SAVE ADDR OF RESTART W.A.            06275537
         LA    RF,RPMN40           GET ADDR OF NEXT LOAD                06275600
         ST    RF,RP40XCTL         STORE ADDR IN W.A.                   06276000
         LA    RF,RP40XCTL         GET ADDR OF RP40XCTL IN W.A.         06276400
         XCTL  SF=(E,(15))         XCTL TO NEXT LOAD                    06276500
*                                                                       06276600
RPMSWAP  DS    0H                  SWAP ROUTINE                         06326600
         XC    N1(N3,R3),N1(R4)    SWAP                                 06336600
         XC    N1(N3,R4),N1(R3)       TWO                               06346600
         XC    N1(N3,R3),N1(R4)         VALUES                          06356600
         BR    R6                  RETURN                               06366600
*                                                                Y02076 06367202
R13A1    DS    0H                  SETLOCK ERROR ROUTINE         Y02076 06367802
         MVI   RSRETCOD+N1,ERR202  STORE SETLOCK ERROR CODE    @ZSUT222 06368437
         B     RSOUT               GO XCTL TO 905B               Y02076 06369637
         EJECT                                                          06370137
*        DEFINED CONSTANTS                                              06370600
*                                                                       06372600
RPMN40A  DC    CL8'IGC0905B'       NEXT LOAD OF REPMAIN                 06374600
MODID    DC    CL8'IGC0805B'       MODULE ID                   @ZSUT222 06374837
PATCH    EQU   *                   END OF MODULE                        06375000
RM4LN    EQU   PATCH-IGC0805B      LENGTH OF CSECT                      06375400
RM4PALN  EQU   RM4LN/10            LENGTH OF PATCH AREA                 06375800
RM4PATCH DS    XL(RM4PALN)         10 PERCENT ALLOWANCE FOR PATCH AREA  06376200
*                                                                       06376300
*        EQUATES FOR GENERAL DISPLACEMENTS                              06376400
*                                                                       06376500
N0       EQU   0                   0                                    06393200
N1       EQU   1                   1                                    06403200
N2       EQU   2                   2                                    06405200
N3       EQU   3                   3                                    06407200
N4       EQU   4                   4                                    06409200
N6       EQU   6                   6                                    06409600
N7       EQU   7                   7                                    06409700
N8       EQU   8                   8                             Y02076 06409902
N16      EQU   16                  16                                   06410102
LINKLIB  EQU   B'10000000'         LINKLIB IND FOR CDE           Y02076 06410302
*                                                                       06415400
*        GENERAL REGISTER EQUATES                                       06417400
*                                                                       06419400
R0       EQU   0                   REG 0                                06419800
R1       EQU   1                   REG 1                                06420200
R2       EQU   2                   REG 2                                06420600
R3       EQU   3                   REG 3                                06420700
R4       EQU   4                   REG 4                                06420800
R5       EQU   5                   REG 5                                06420900
R6       EQU   6                   REG 6                                06434800
R7       EQU   7                   REG 7                                06444800
R8       EQU   8                   REG 8                                06446800
R9       EQU   9                   REG 9                                06447200
RA       EQU   10                  REG 10                               06447600
RB       EQU   11                  REG 11                               06448000
RC       EQU   12                  REG 12                               06448400
RD       EQU   13                  REG 13                               06448500
RE       EQU   14                  REG 14                               06448600
RF       EQU   15                  REG 15                               06448700
*                                                                Y02076 06451702
*        EQUATED CONSTANTS                                       Y02076 06452302
*                                                                Y02076 06452902
ERR202   EQU   202                 SETLOCK ERROR CODE          @ZSUT222 06453037
M15      EQU   15                  ICM MASK FOR ALL BYTES        YM7347 06454502
         EJECT                                                          06456602
*                                                                       06458102
*        DSECT FOR REPMAIN WORK AREA                                    06459602
*                                                                       06461102
RPMWA1   DSECT                                                          06462602
RPMERAS1 DS    F                   TEMP SAVE AREA                Y02076 06464102
RMNEOV   DS    F                   TO TEST IF EOV OCCURRED              06465602
RSBFSTAD DS    F                   ADR OF NEXT BYTE IN BUFFER           06467102
RSBFLWA  DS    F                   NO. OF REMAINING BYTES IN BUFFER     06468602
RPMMSS1  DS    F                   ADDR OF NEW L-SHAPED PROG MSS CHAIN  06470102
RPMMSS2  DS    F                   ADDRESS OF NEW INIT MSS CHAIN        06471602
RPMMSS3  DS    F                   ADDRESS OF NEW P/P MSS CHAIN         06473102
RPMRB    DS    F                   ADDRESS OF RESTORED RB CHAIN         06474602
RPMLLE   DS    F                   ADDRESS OF RESTORED LLE CHAIN        06476102
RPMCDE   DS    F                   ADDRESS OF RESTORED CDE CHAIN        06477602
RPMDEB   DS    F                   ADDRESS OF RESTORED DEB CHAIN        06479100
RPMFOE   DS    F                   ADDRESS OF RESTORED FOE CHAIN        06489100
RSCORE   DS    F                   ADDR OF CORE AQUIRED BY LAST GETMAIN 06491100
RSW001   DS    F                   POINTER TO NEXT BYTE AVAILABLE CORE  06495000
RSW002   DS    F                   POINTER TO REPMAIN SYNAD ROUTINE     06497000
RPLNT    DS    F                   LENGTH OF THE BLOCK                  06499000
RMADEOV  DS    F                   SAVE AREA FOR INFORMATION NEEDED     06502900
         DS    0D                  ALIGNMENT                            06504900
CKSAVAR  DS    16F                 GENERAL SAVE AREA                    06506900
RPMN40   DS    D                   MODULE NAME FOR XCTL                 06510800
RP40XCTL DC    F'0'                POINTER TO XCTL PARAMETER LIST       06512800
RSSWIT1  DS    X'00'               BIG BLOCK INDICATOR                  06514800
         TITLE 'IHJQRS23 - RESTART WORK AREA'                           06529000
         IEEVRSWA                                                       06539000
         TITLE 'IHJQRS23 - TASK CONTROL BLOCK'                          06541000
         IKJTCB                                                         06543000
         TITLE 'IHJQRS23 - STAE CONTROL BLOCK'                          06543100
         IHASCB                                                         06547800
         TITLE 'IHJQRS23 - LOAD LIST ELEMENT'                           06549800
         IHALLE                                                         06551800
         TITLE 'IHJQRS23 - CONTENTS DIRECTORY ENTRY'                    06552200
         IHACDE                                                         06552600
         TITLE 'IHJQRS23 - REQUEST BLOCK - SVRB,IRB,PRB'                06557300
         IKJRB                                                          06559300
         TITLE 'IHJQRS23 - CONTROL VECTOR TABLE'                        06561300
         CVT   DSECT=YES,PREFIX=NO                                      06561700
         TITLE 'IHJQRS23 - PREFERENTIAL STORAGE AREA'                   06564702
         IHAPSA                                                         06567702
         TITLE 'IHJQRS23 - EXTENT LIST'                                 06571200
         IHAXTLST                                                       06571600
         END                                                            06581137
./  ADD  SSI=81920346,NAME=IHJQRS24
         TITLE 'IHJQRS24 - AOS/2 REPMAINS - IGC0905B'                   00370000
*                                                                       00380000
* STATUS -                                                              00390000
*                                                                       00392000
* FUNCTION-                                                             00394000
*    THIS ROUTINE PERFORMS CLEANUP PROCESSING SUCH AS RESETTING         00396000
*    KEYS ON PAGES WITHIN THE REGION,FREEING STORAGE FOR CONTROL        00398000
*    BLOCKS WHICH ARE NO LONGER NEEDED, AND IF ERROR PROCESSING         00398400
*    IS INDICATED, REINITIALIZING THE REGION TO ALLOW FOR PROPER        00398800
*    TERMINATION OF THE RESTART REQUEST.                                00399202
*    THIS MODULE DETECTS THE FOLLOWING ERRORS AND SETS A                00399407
*    MESSAGE CODE TO INDICATE THE TYPE OF ERROR AS FOLLOWS:             00399607
*        ERROR CODE     ERROR TYPE                                      00399807
*    1).    202         SET LOCK ERROR                                  00400007
*    2).    217         FINDPAGE ERROR                                  00400207
*                                                                       00400502
* ENTRY POINTS                                                          00401002
*          IGC0905B                                                     00401502
*                                                                       00402002
* INPUT-                                                                00449900
*    GPR12-CONTAINS ADDRESS OF THE RESTART WORK AREA                    00459900
*    ERROR CODE IN RSTWA                                                00469900
*                                                                       00479900
* OUTPUT-                                                               00489900
*    GPR1-CONTAINS THE ADDRESS OF RSTWA                                 00491900
*                                                                       00493900
* EXTERNAL REFERENCES                                                   00495900
*         FINDPAGE                                                      00497900
*         SPIE C/R ROUTINE                                       Y02076 00498002
*                                                                       00498300
* EXITS, NORMAL-                                                        00498700
*    XCTL TO JFCB PROCESSOR (IGC0G05B) TO REBUILD OPEN DATA SET TABLES  00499100
*                                                                       00499500
* EXITS, ERROR-                                                         00499600
*    XCTL TO IGC0V05B TO CONCLUDE ERROR PROCESSING.                     00499707
*                                                                       00533200
* TABLES/WORK AREAS                                                     00543200
*                                                                       00543702
*    RSTWA                                                              00553202
*                                                                       00553702
*    RPMWA                                                              00554202
*                                                                       00563200
*    TCB-TCBFLGS6                                                Y02076 00565202
*    .   TCBMSS                                                         00565600
*    .   TCBOTC                                                         00566000
*    .   TCBPKF                                                         00566400
*                                                                       00577600
*    RB-RBSIZE                                                          00587602
*    .  RBLINK                                                          00588002
*                                                                       00588400
*    SPQE-SPQEFLGS                                                      00588800
*    .    SPDQEPTR                                                      00592500
*    .    SPQEAD                                                        00594500
*    .    SPQEID                                                        00594900
*                                                                       00595300
*    DQE-DQFQEPTR                                                       00595700
*    .   DQEPTR                                                         00596102
*    .   DQEBLKAD                                                Y02076 00596602
*    .   DQELNTH                                                 Y02076 00596702
*                                                                       00597102
*    FQE-FQEPTR                                                         00646202
*                                                                       00656200
*    CVT-CVTPVTP                                                        00666202
*    .   CVTCSPIE                                                Y02076 00666702
*                                                                       00676200
*    PVT-PVTPFP2                                                 Y02076 00686202
*                                                                       00688200
*    XPTE-XPTPROT                                                       00690200
*                                                                       00692200
*    CDE-CDCHAIN                                                 Y02076 00694202
*    .   CDXLMJP                                                 Y02076 00694602
*                                                                       00695000
*    LLE-LLECHN                                                  Y02076 00695402
*                                                                       00695800
*    SCB-SCBCHAIN                                                       00695902
*                                                                       00696000
*    XTLST-XTLLNTH                                               Y02076 00712802
*                                                                Y02076 00713302
*    FOE-FOEFLNKF                                                Y02076 00713802
*                                                                Y02076 00714302
*    SSCR-SSCRID                                                 Y02076 00714802
*    .    SSCRFLG1                                               Y02076 00715302
*                                                                Y02076 00715802
*    PSA-PSALITA                                                 Y02076 00716302
*                                                                Y02076 00716802
*    SDWA-SDWARCDE                                               Y02076 00717302
*    .    SDWARTYA                                               Y02076 00717802
*                                                                       00722800
* ATTRIBUTES                                                            00724800
*    ENABLED,KEY 0 SUPERVISOR STATE                                     00726800
*                                                                       00728800
* CHARACTER CODE DEPENDENCY                                             00729200
*    NONE                                                               00729300
*                                                                       00729400
* NOTES                                                                 00735000
*    APPLICABILITY-AOS/2                                                00737000
*    SIZE- 4K DESIGN POINT                                              00739000
*    TYPE-LOAD                                                          00739400
*    RESIDENCE- SYSTEM LINK PACK AREA                                   00739800
*                                                                       00740200
* VS2-REL 3 - CHANGES/DELETIONS:                                        00743202
* 011168,014248,014281-014645                                   ZA01488 00745202
*                                                                       00746302
*APAR OZ31482 HAS BEEN FLAGGED AS @ZSUT222                     @ZSUT222 00746807
*C008160,008179,009489,009497,011107,011119,011152,011165      @ZSUT222 00747307
*C011560,011760,014270,015544,015562,016194,016203             @ZSUT222 00747607
*A008189-008209,009507-009527,011110-011116,011166-011168      @ZSUT222 00747907
*A015490,015502,015526-015538,015745                           @ZSUT222 00748807
*D011088,011092,011235                                         @ZA33625 00748907
*C011127,A011130-011139                                        @ZA33625 00749007
         EJECT                                                          00749302
IGC0905B CSECT                                                          00752302
         BALR  RB,N0               ESTABLISH ADDRESSABILITY             00755300
         USING *,RB                BASE REG=11                          00765300
         USING RSTWA,RC            BASE FOR RESTART W.A.                00767300
         USING RPMWA1,RA           BASE FOR REPMAIN W.A.                00769300
         USING TCB,R5              TCB                                  00769700
         B     RM5BEGIN            BRANCH AROUND EYE CATCHER   @Z30ESHP 00770100
         DC    H'0'                PAD 2 BYTES OF ZERO                  00774402
         DC    CL8'IGC0905B'       MODULE NAME                 @ZSUT222 00774807
         DC    CL8'&SYSDATE'       LAST DATE SHIPPED           @ZSUT222 00775107
         DC    CL8'@ZA33625'       LAST CODE SHIPPED           @ZSUT222 00775407
         DC    CL8'@SU80700'       SELECTABLE UNIT ID          @ZSUT222 00775707
RM5BEGIN XC    LOCLOCK,LOCLOCK     CLEAR LOC LOCK SWITCH       @Z30ESHP 00776007
RM5START L     RA,RSMWOFST         OFFSET TO REPMAIN W.A.               00776307
         AR    RA,RC               TO ESTABLISH BASE FOR WA             00777200
         L     R5,RSTCBAD          ADDR OF TCB                          00779200
         MVI   SWITCH,N0           CLEAR SWITCH                         00779600
         LH    R1,RSRETCOD         GET ERROR INDICATOR                  00780100
         LTR   R1,R1               PREVIOUS ERROR                       00780202
         BZ    R8A1                NO-BRANCH                            00785100
         MVI   SWITCH,N1           SET FIRST PASS ERROR SWITCH          00789100
*                                                                       00789500
* FREE SUBPOOLS FOR STC,INITIATOR,AND P/P                               00789902
*                                                                       00790000
R8B0     L     RF,LOCLOCK          IS LOCAL LOCK HELD          @Z30ESHP 00804000
         LTR   RF,RF               IS IT SET                   @Z30ESHP 00806000
         BNZ   R8B0B               BR IF YES                   @Z30ESHP 00814000
         LA    RF,CKSAVAR          GET REG SAVE ADDR           @ZSUT222 00816007
         STM   R0,RF,N0(RF)        SAVE REGS                   @Z30ESHP 00816400
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                @Z30ESHP,00816800
               RELATED=(REL,IGC0905B(XCTLA))                   @Z30ESHP 00817200
         LTR   RD,RD               LOCK SUCCESSFUL             @Z30ESHP 00817600
         LM    R0,RF,N0(RF)        RESTORE REGS                @Z30ESHP 00817700
         BZ    R8B0A               BR IF LOCK OK               @Z30ESHP 00817800
         MVI   RSRETCOD+N1,ERR202  SET LOCK ERROR              @ZSUT222 00817907
         MVC   RSREGSAV(8),MODID   SAVE NAME OF MODULE THAT    @ZSUT222 00818907
*                                  HAS DETECTED THE ERROR.     @ZSUT222 00819907
         STM   0,15,RSREGSAV+8     SAVE CURRENT REGISTERS.     @ZSUT222 00820907
         B     PREXCTL             BR TO ERROR EXIT            @Z30ESHP 00824600
R8B0A    ST    RF,LOCLOCK          SET LOCAL LOCK SWITCH       @Z30ESHP 00826600
         L     RF,CVTADDR(N0,N0)   GET CVT ADR                 @Z30ESHP 00827000
         USING CVTMAP,RF                                       @Z30ESHP 00827100
         L     R7,CVTTCBP          GET PTR TO NEXT TCB         @Z30ESHP 00827200
         LA    R7,CURASOFS(R7)     ADR CURR ASCB ADR           @Z30ESHP 00830900
         L     R7,N0(R7)           CURR ASCB ADR               @Z30ESHP 00832900
         ST    R7,USERASCB         SAVE FOR FREEMAIN           @Z30ESHP 00833300
R8B0B    L     R5,RSTCBAD          GET ADDR OF P/P TCB         @Z30ESHP 00834600
         LA    R6,N2               SET CONTROL COUNT=2                  00838300
         L     R3,RPMMSS1          GET FIRST SPQE TO BE FREED           00842000
R8B1     LTR   R3,R3               ANY SPQE'S TO BE FREED        Y02076 00862002
         BZ    R8G1                NO-BRANCH                            00872000
         USING SPQESECT,R3         SPQE                                 00874000
         TM    SPQEFLGS,SPQEOWN    IS SUBPOOL OWNED                     00874100
         BO    R8C1                YES- BRANCH                          00874200
         SR    R4,R4               SET INHIBIT DQE FREE SWITCH          00888200
         B     R8C2                FREE SPQE                            00898200
R8C1     L     R4,SPDQEPTR         GET ADDR OF FIRST DQE                00900200
R8C2     MVC   CKSAVAR(N4),SPQEAD  SAVE ADDR OF NEXT SPQE               00900600
         LA    R8,SPQESIZE         LENGTH OF SPQE                Y02076 00901002
         BAL   R2,FREEMA           FREE SPQE                   @Z30ESHP 00901400
R8D1     LTR   R4,R4               ANY DQE'S                     Y02076 00901902
         BZ    R8E1                NO-DO NEXT SPQE                      00902000
         USING DQESECT,R4          DQE                                  00902100
         L     R9,DQFQEPTR         GET THE FIRST FQE                    00906800
R8D2     MVC   CKSAVAR+N4(N4),DQEPTR SAVE ADDR OF NEXT DQE              00908800
         LA    R8,N16              SET FREEMAIN LENGTH=LEN OF DQE/FQE   00910800
         LR    R3,R4               ADDR OF AREA TO BE FREED             00911200
         BAL   R2,FREEMA           FREE DQE                    @Z30ESHP 00911300
         LR    R7,R9               GET FQE ADDRESS                      00911400
         USING FQESECT,R7          FQE                                  00923000
R8D3     LA    R7,N0(R7)           CLEAR HIGH BYTE OF FQE               00933000
         LTR   R7,R7               ANY FQE'S                            00933400
         BZ    R8D4                NO-BRANCH                            00933800
         MVC   CKSAVAR+N8(N4),FQEPTR SAVE ADDR OF NEXT FQE              00934202
         LR    R3,R7               ADDR OF AREA TO BE FREED             00934600
         BAL   R2,FREEMA           FREE FQE                    @Z30ESHP 00934700
         L     R7,CKSAVAR+N8       GET ADDR OF NEXT FQE                 00934800
         B     R8D3                PROCESS NEXT FQE                     00938700
R8D4     L     R4,CKSAVAR+N4       GET ADDR OF NEXT DQE                 00940700
         B     R8D1                PROCESS DQE                          00941100
R8E1     L     R3,CKSAVAR          GET ADDR OF NEXT SPQE                00941500
         B     R8B1                LOOP PROCESS SPQE                    00941900
         DROP  R7                  FQE                                  00942300
*                                                                       00942400
*        RESTORE STORAGE PROTECT KEYS                                   00942500
*                                                                       00946400
*                                                                       00948400
R8A1     L     R3,TCBMSS           GET FIRST P/P SPQE                   00948800
         LA    RF,CKSAVAR          GET SAVEAREA ADDR           @ZSUT222 00948907
         STM   R0,RF,N0(RF)        SAVE REGS                     Y02076 00949107
R8A1A    SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02076,00949202
               RELATED=(LOCAL,IGC0905B(R8B1A))                   Y02076 00949302
         LTR   RD,RD               SETLOCK ERROR                 Y02076 00949402
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 00949502
         BZ    R8A1B               IF NO ERROR, BR               Y02076 00949602
         MVI   RSRETCOD+N1,ERR202  STORE SETLOCK ERROR CODE    @ZSUT222 00949707
         MVC   RSREGSAV(8),MODID   SAVE NAME OF MODULE THAT    @ZSUT222 00950707
*                                  HAS DETECTED THE ERROR.     @ZSUT222 00951707
         STM   0,15,RSREGSAV+8     SAVE CURRENT REGISTERS.     @ZSUT222 00952707
         B     RM5START            START OVER AGAIN              Y02076 00953707
R8A1B    SR    R2,R2               CLEAR REG                            00954707
R8A2     LTR   R3,R3               ANY SPQE'S                    Y02076 00955707
         BZ    R8B                 NO-BRANCH                            00956707
         SPACE 1                                                        00960100
         SR    R6,R6               CLEAR SUBPOOL0 SWITCH                00970100
         CLI   SPQEID,N0           SPQE FOR SP0                         00970200
         BNE   R8A3                NO-CHECK FOR SP252                   01008500
         LR    R9,R3               SAVE ADDR OF SPQE                    01018500
         L     R3,SPDQEPTR         GET ADDR OF OWNER SPQE               01028500
         BAL   R6,R8A4             SET R6 TO INDICATE SUBPOOL ZERO      01038502
*                                  AND GO TO PROCESS DQE                01040500
R8A3     CLI   SPQEFLGS,SPSHARE    SPQE SHARED                          01042500
         BO    R8A7                YES-PROCESS NEXT SPQE                01044500
R8A4     L     R4,SPDQEPTR         GET FIRST DQE                        01046500
R8A5     LTR   R4,R4               ANY DQE'S                     Y02076 01046702
         BZ    R8A6C               NO-BRANCH                            01059500
         L     R7,DQEBLKAD         GET BLOCK ADDR                       01069500
         L     R8,DQELNTH          GET LENGTH OF DQE                    01071500
         LA    R8,N0(R7,R8)        GET END ADDR OF BLOCK                01071900
         IC    R2,TCBPKF           GET PROTECT KEY                      01072000
         O     R2,F8               SET FETCH PROTECT ON                 01072100
         CLI   SPQEID,N252         SUBPOOL 252                          01072200
         BNE   R8A6                NO-BRANCH                            01076500
         N     R2,F7               SET FETCH PROTECT OFF         YA2091 01078502
R8A6     LR    R1,R7               SAVE ADDR OF PAGE FOR FINDAGE/SSK    01080502
         TM    TCBFLGS6,TCBRV      IS THIS A V=R TASK                   01080600
         BO    R8A6A               YES-BRANCH                           01080700
         L     RF,CVTPTR           LOCATE THE CVT                       01091300
         USING CVT,RF              CVT                                  01101300
         L     RF,CVTPVTP          GET ADDR OF THE PVT                  01101700
         DROP  RF                  CVT                                  01102100
         USING PVT,RF              PVT                                  01105600
         L     RF,PVTPFP           LOAD ADDR OF FINDPAGE         Y02076 01107602
         DROP  RF                  PVT                                  01108000
         BALR  RE,RF               BRANCH TO FINDPAGE                   01108400
         LTR   RF,RF               NORMAL RETURN                 Y02076 01109702
         BZ    R8A6D               BR YES                        Y02076 01110202
         MVI   RSRETCOD+N1,ERR217  SET ERROR CODE--'217'       @ZSUT222 01110707
         MVC   RSREGSAV(8),MODID   SAVE NAME OF MODULE THAT    @ZSUT222 01111007
*                                  HAS DETECTED THE ERROR.     @ZSUT222 01111307
         STM   0,15,RSREGSAV+8     SAVE CURRENT REGISTERS.     @ZSUT222 01111607
         B     R8B                 GO RELEASE LOCAL LOCK       @ZSUT222 01111907
R8A6D    EQU   *                                               @ZA33625 01112707
         USING XPTE,R1             XPTE                        @ZA33625 01113007
         STC   R2,XPTPROT          PUT KEY IN XPTE             @ZA33625 01113307
         DROP  R1                  XPTE                        @ZA33625 01113607
         LRA   R1,N0(R7)           PAGE IN CORE                @ZA33625 01113907
         BNZ   R8A6B               NO-BRANCH                            01114700
R8A6A    LA    RD,N6               LOAD REG WITH CHANGE & REFERENCE     01114800
*                                  BIT MASK                             01114900
         OR    R2,RD               SET KEY TO TURN ON REFERENCE         01115000
*                                  AND CHANGE BITS                      01115100
         LA    RF,CKSAVAR          GET SAVEAREA ADDR           @ZSUT222 01115207
         STM   R0,RF,N0(RF)        SAVE REGS                     Y02076 01115402
R8A6A1   SETLOCK OBTAIN,TYPE=SALLOC,MODE=UNCOND,                 Y02076,01115602
               RELATED=(SALLOC,IGC0905B(R8A6A2))                 Y02076 01115702
         LTR   RD,RD               SETLOCK ERROR                 Y02076 01116202
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 01116302
         BZ    R8A6A1B             IF NO ERROR, BR               Y02076 01116402
         MVI   RSRETCOD+N1,ERR202  STORE SETLOCK ERROR CODE    @ZSUT222 01116507
         MVC   RSREGSAV(8),MODID   SAVE NAME OF MODULE THAT    @ZSUT222 01116607
*                                  HAS DETECTED THE ERROR.     @ZSUT222 01116707
         STM   0,15,RSREGSAV+8     SAVE CURRENT REGISTERS.     @ZSUT222 01116807
         B     R8B1A               GO RELEASE LOCAL LOCK         Y02076 01116907
R8A6A1B  LRA   R1,N0(R7)           PAGE IN CORE                 ZA00601 01117007
         BNZ   R8A6A2                   BR IF NOT               ZA01488 01117107
         SSK   R2,R1               SET KEY ON EACH HALF KEY     ZA00601 01117207
         LA    R1,N2048(R1)        GET NEXT HALF PAGE                   01117307
         SSK   R2,R1               SET KEY                              01117407
         STM   R0,RF,N0(RF)        SAVE REGS                     Y02076 01117507
R8A6A2   SETLOCK RELEASE,TYPE=SALLOC,                            Y02076,01117607
               RELATED=(SALLOC,IGC0905B(R8A6A1))                 Y02076 01117707
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 01118002
         LA    RD,OFF-N6           SET MASK FOR ANDING                  01118200
         NR    R2,RD               RESET REG2 TO ORIGINAL KEY           01121300
R8A6B    AH    R7,H4096            GET ADDR OF NEXT PAGE                01125700
         CR    R7,R8               ANY MORE PAGES LEFT                  01127900
         BL    R8A6                YES-BRANCH                           01130100
         L     R4,DQEPTR           GET NEXT DQE                         01132300
         B     R8A5                LOOP-PROCESS DQE                     01134500
R8A7     L     R3,SPQEAD           GET NEXT SPQE                        01136700
         B     R8A2                BRANC                                01138900
R8A6C    LTR   R6,R6               SP0 SWITCH SET                       01141100
         BZ    R8A7                NO-BRANCH                            01143300
         LR    R3,R9               RESTORE P/P SP0 SPQE                 01145500
         B     R8A7                GET NEXT SPQE-BRANCH                 01155500
R8B      EQU   *                   ISSUE SETLOCK                 Y02076 01155902
         LA    RF,CKSAVAR          GET SAVEAREA ADDR           @ZSUT222 01156007
         STM   R0,RF,N0(RF)        SAVE REGS                     Y02076 01156207
R8B1A    SETLOCK RELEASE,TYPE=LOCAL,                             Y02076,01156302
               RELATED=(LOCAL,IGC0905B(R8A1A))                   Y02076 01156802
         LM    R0,RF,N0(RF)        RESTORE REGS                  Y02076 01157302
         CLI   RSRETCOD+N1,N0      ANY ERRORS ENCOUNTERED        Y02076 01157802
         BNE   RM5START            IF YES, START OVER AGAIN      Y02076 01157902
         B     R8B0                BRANCH                               01158100
*                                                                       01160100
*                                                                       01160500
*                                                                       01160900
R8G1     BCTR  R6,N0               DECREMENT CONTROL COUNT              01161300
         LTR   R6,R6               WERE INITIATORS SPQE'S SAVED         01161400
         BH    R8F1                BRANCH-FREE INIT SPQE'S              01161500
         BE    R8F2                BRANCH-FREE P/P SPQE'S               01161600
         B     R8F2A               BRANCH                               01165700
R8F2     L     R3,RPMMSS3          GET ADDR OF P/P SPQE                 01167700
         B     R8B1                BRANCH-FREE SPQE                     01169700
R8F1     L     R3,RPMMSS2          GET ADDR OF INITIATOR SPQE           01169800
         B     R8B1                BRANCH FREE SPQE                     01169900
R8F2A    L     RF,LOCLOCK          IS LOCAL LOCK HELD          @Z30ESHP 01171900
         LTR   RF,RF               IS IT ZERO                  @Z30ESHP 01173900
         BZ    RMFCD               BR IF NOT HELD              @Z30ESHP 01175900
         LA    RF,CKSAVAR          GET ADR OF REG SAV AREA     @ZSUT222 01176007
         STM   R0,RF,N0(RF)        SAVE REGS                   @Z30ESHP 01177800
         SETLOCK RELEASE,TYPE=LOCAL,                           @Z30ESHP,01179800
               RELATED=(SET,IGC0905B(R8B0))                    @Z30ESHP 01182100
         LM    R0,RF,N0(RF)        RESTORE REGS                @Z30ESHP 01182200
         XC    LOCLOCK,LOCLOCK     CLEAR LOCK SWITCH           @Z30ESHP 01182700
         DROP  R3,R4               SPQE,DQE                             01183700
*                                                                       01184100
*                                                                       01185900
*                                                                       01187700
RMFCD    L     R3,RPMCDE           GET ADDR OF CDE                      01189500
         USING CDENTRY,R3          CDE                                  01191300
RMFCD1   LA    R3,N0(R3)           CLEAR HIGH BYTE                      01193100
         LTR   R3,R3               ANY CDE'S TO BE FREED                01194900
         BZ    RMFRLLE             NO-BRANCH                            01196700
         LA    R8,CDELEN           GET LENGTH OF CDE             Y02076 01198502
         L     R7,CDCHAIN          SAVE ADDR OF NEXT CDE                01200300
         TM    CDATTR,CDMIN        IS THIS A MINOR CDE                  01202100
         BO    RMFCD2              YES-NO EXTENT LIST,BRANCH            01203900
         L     R4,CDXLMJP          SAVE ADDR OF EXTENT LIST             01205700
         BAL   R2,FREEM            FREE CDE                             01207500
         LR    R3,R4               GET ADDR OF EXTENT LIST              01209300
         L     R8,XTLLNTH-XTLST(R3) GET LENGTH OF EXTENT LIST           01211100
RMFCD2   BAL   R2,FREEM            FREE EXTENT LIST                     01212900
         LR    R3,R7               RESTORE CDE PTR                      01214700
         B     RMFCD1              LOOP TO FREE NEXT CDE                01216500
         DROP  R3                  CDE                                  01218300
*                                                                       01220100
*        ROUTINE TO FREE LLE'S                                          01221900
*                                                                       01223700
RMFRLLE  L     R3,RPMLLE           GET ADDR OF FIRST LLE                01225500
         USING LLE,R3              LLE                                  01227300
RMREP    LTR   R3,R3               ANY LLE'S TO BE FREED         Y02076 01229102
         BZ    RPMFRRB             NO-BRANCH TO FREE RB                 01239100
         LA    R8,N8               GET LENGTH OF LLE                    01249100
         L     R7,LLECHN           SAVE ADDR OF NEXT LLE                01249200
         BAL   R2,FREEM            FREE LLE                             01249300
         LR    R3,R7               GET ADDR OF NEXT LLE                 01249400
         B     RMREP               LOOP-PROCESS LLE                     01259400
         DROP  R3                  LLE                                  01269400
*                                                                       01269500
*        ROUTINE TO FREE RB'S                                           01272800
*                                                                       01274800
RPMFRRB  L     R3,RPMRB            GET FIRST RB TO BE FREED             01275200
         USING RBSECT,R3           RB                                   01275600
         LA    R3,N0(R3)           CLEAR HIGH BYTE                      01276000
         LTR   R3,R3               ANY RB'S TO BE FREED                 01276100
         BZ    RMFRFOE             NO-BRANCH TO FREE FOE'S       Y02076 01276202
RMRBFREE LH    R8,RBSIZE           GET LENGTH OF RB                     01284500
         SLL   R8,N3               CONVERT TO BYTES                     01286500
         L     R4,RBLINK           SAVE ADDR OF NEXT RB                 01288500
         S     R3,KRBPREFX         GET ADDR OF PREFIX                   01290500
         BAL   R2,FREEM            FREE RB                              01292500
         LA    R3,N0(R4)           GET NEXT RB                          01292900
         CR    R3,R5               ANY MORE RB'S                        01293000
         BNE   RMRBFREE            YES-FREE RB                          01302300
*                                                                Y02076 01304302
*        ROUTINE TO FREE FOE'S                                   Y02076 01306302
*                                                                Y02076 01308302
RMFRFOE  L     R3,RPMFOE           GET ADDR OF FIRST FOE                01338200
         USING FOE,R3              FOE                                  01338600
RMFOEF   LA    R3,N0(R3)           CLEAR HIGH BYTE                      01339000
         LTR   R3,R3               FOE POINTER=0                        01339400
         BZ    RMFOEL              YES-BRANCH                           01339500
         LA    R8,FOELEN           GET LENGTH OF FOE                    01339600
         L     R7,FOEFLNKF         SAVE ADDR OF NEXT FOE                01339700
         BAL   R2,FREEM            FREE THE FOE                         01348300
         LR    R3,R7               GET ADDR OF NEXT FOE                 01350300
         B     RMFOEF              PROCESS NEXT FOE                     01352300
RMFOEL   XC    RPMFOE(N4),RPMFOE   SET FOE HEADER IN RPMW=0             01354300
         B     R9A0                BRANCH                               01356300
         DROP  R3                  FOE                                  01356700
*                                                                       01356800
*        SUBROUTINE TO FREE CORE FROM SUBPOOL 255                       01356902
*                                                                       01358000
*        REGISTER INPUT                                                 01360002
*              R2  RETURN ADDRESS                                       01360102
*              R3  ADDRESS OF CORE TO BE FREED                          01360202
*              R8  LENGTH OF CORE TO BE FREED                           01362602
*                                                                       01364600
*                                                                       01366600
*                                                                       01366700
*  ENTRY PT FOR FREEMAIN OF 16 BYTE CELLS FOR VSM BLOCKS       @Z30ESHP 01366800
*                                                                       01366900
FREEMA   L     R0,SP255            SUBPOOL ID                  @Z30ESHP 01374200
         L     R7,USERASCB         GET USER ASCB ADR           @Z30ESHP 01380200
         FREEMAIN P,A=(R3),BRANCH=YES                          @Z30ESHP 01380600
         B     FREEMB              BR TO CONTINUE              @Z30ESHP 01381000
FREEM    DS    0H                  RTN TO FREE BLOCKS                   01381800
         LR    R1,R3               GET ADDR OF BLOCK TO BE FREED        01389100
         L     R0,SP255            INDICATE SP=255                      01396400
         OR    R0,R8               GET LENGTH OF BLOCK TO BE FREED      01406400
         FREEMAIN R,LV=(0),A=(1)   FREE BLOCK                           01416400
FREEMB   LA    R3,N0(R3)           CLEAR HIGH BYTE             @Z30ESHP 01418400
         C     R3,RSCORE           WAS THIS THE LAST BLOCK RESTORED     01420400
         BCR   NOTEQ,R2            NO-RETURN TO CALLER                  01422400
R9A0     CLI   SWITCH,N1           ERROR SWITCH ON                      01424400
         BE    PREXCTL                  IF ERRS-BR TO EXIT      ZA01488 01424802
         LR    R1,RC               GET ADDRESS OF                Y02076 01425002
         A     R1,RSBFOFST         SSCR BUFFER                   Y02076 01425102
         USING SSCR,R1             SSCR                          Y02076 01425302
         LA    R2,SPIEID           ESTABLISH SPIE CODE           Y02076 01425402
         CH    R2,SSCRID           SPIE SSCR                     Y02076 01425502
         BNE   XCTLA               BR NO                         Y02076 01425602
         NI    SSCRFLG1,OFF-SSCRCKRS SET CK/RS FLG TO RS         Y02076 01426302
         DROP  R1                  SSCR                          Y02076 01426502
         L     RF,CVTPTR           GET CVT ADDRESS               Y02076 01426602
         USING CVTMAP,RF           CVT                           Y02076 01426702
         L     RF,CVTCSPIE         GET @ OF SPIE RS RTN          Y02076 01426802
         DROP  RF                  CVT                           Y02076 01426902
         LA    RD,CKSAVAR          GET REG SAVE AREA @         @ZSUT222 01427007
         BALR  RE,RF               CALL SPIE RESTART RTN         Y02076 01427407
         MVC   RSPIE(N4),TCBPIE    SAVE PIE ANCHOR               Y02076 01427507
         XC    TCBPIE(N4),TCBPIE   PREVENT USER SPIE FROM        Y02076 01427607
*                                  GETTING CONTROL               Y02076 01427707
         B     XCTLA               GO XCTL                       Y02076 01427802
*                                                                       01428002
PREXCTL  EQU   *                   ERROR EXIT ENTRY              YM7843 01548002
         MVC   RPMN40,RPMN40A      SETUP MODULE NAME FOR XCTL  @ZSUT222 01549007
         MVI   RPMN40+N4,CHARV     SET XCTL TO IGC0V05B                 01549607
         B     ERRXCTL                                         @ZSUT222 01550207
*                                                                       01550807
*        XCTL  INTERFACE FOR ALL EXITS                                  01551407
*                                                                       01552007
XCTLA    EQU   *                                               @ZSUT222 01552607
         MVC   RPMN40,RPMN40A      SETUP MODULE NAME FOR XCTL  @ZSUT222 01553207
ERRXCTL  EQU   *                                               @ZSUT222 01553807
         L     RF,LOCLOCK          GET LOCK SWITCH             @ZSUT222 01554407
         LTR   RF,RF               IS LOCL LOCK HELD           @Z30ESHP 01555007
         BZ    XCTLAA              BR IF NO                    @Z30ESHP 01555607
         LA    RF,CKSAVAR          GET REGSAVE ADR             @ZSUT222 01556207
         STM   R0,RF,N0(RF)        SAVE REGS                   @Z30ESHP 01558200
         SETLOCK RELEASE,TYPE=LOCAL,                           @Z30ESHP,01558300
               RELATED=(SET,IGC0905B(R8B0))                    @Z30ESHP 01558400
         LM    R0,RF,N0(RF)        RESTORE REGS                @Z30ESHP 01559600
         XC    LOCLOCK,LOCLOCK     CLEAR LOCK SWITCH           @Z30ESHP 01561600
XCTLAA   LA    RF,RPMN40           LOAD ADDR OF XCTL NAME      @Z30ESHP 01561700
         ST    RF,RP40XCTL         STORE IN WORK AREA                   01562900
         LA    RF,RP40XCTL         GET ADDR. OF WORK AREA FIELD         01564100
         LR    R1,RC               LOAD ADDR OF RESTART W.A.            01565300
         XCTL  SF=(E,(15))         XCTL TO NEXT LOAD                    01567300
         EJECT                                                          01569502
*                                                                       01571702
*        DEFINED  CONSTANTS                                             01572502
*                                                                       01573302
RPMN40A  DC    CL8'IGC0G05B'       NAME OF NEXT REPMAIN LOAD            01574102
MODID    DC    CL8'IGC0905B'       MODULE ID                   @ZSUT222 01574507
         DS    0F                  ALIGNMENT                            01574902
SP250    DC    X'FA001000'         GETMAIN CONSTANT FOR 4K FROM SP250   01575702
SP255    DC    X'FF000000'         GET CORE FROM LSQA                   01576502
KRBPREFX DC    AL4(RBPRFLNA)       LENGTH OF RB PREFIX                  01577302
F7       DC    F'7'                MASK FOR PROTECT OFF          YA2091 01578502
F8       DC    F'8'                MASK FOR FETCH PROTECT ON            01579702
RETCOD12 DC    H'12'               RTM NO-RTCA-ENTRY CODE        Y02076 01580902
H4096    DC    H'4096'             PAGE UPDATE                          01582102
PATCH    EQU   *                   END OF MODULE                        01583302
RM5LEN   EQU   PATCH-IGC0905B      LENGTH OF MODULE                     01584502
RM5PALEN EQU   RM5LEN/10           LENGTH OF PATCH AREA                 01585702
RM5PATCH DS    XL(RM5PALEN)        10 PERCENT ALLOWANCE FOR PATCH AREA  01586902
         SPACE 2                                                        01588102
*                                                                       01589302
*        GENERAL EQUATES                                                01590502
*                                                                       01591702
N0       EQU   0                   0                                    01592902
N1       EQU   1                   1                                    01594102
N2       EQU   2                   2                                    01595302
N3       EQU   3                   3                                    01596502
N4       EQU   4                   4                                    01597702
N6       EQU   6                   6                                    01598902
N8       EQU   8                   8                                    01600102
N16      EQU   16                  LENGTH OF DQE/FQE                    01601302
N24      EQU   24                  LENGTH OF CDE                        01602502
N252     EQU   252                 SUBPOOL 252                          01603700
N2048    EQU   2048                LENGTH OF HALF PAGE                  01604900
SPIEID   EQU   X'102'              SPIE SSCR ID                  Y02076 01605402
NOTEQ    EQU   7                   CONDITION CODE                       01614900
OFF      EQU   X'FF'               ONE BYTE OF ALL FOXES                01615300
CHARV    EQU   C'V'                CHARACTER FOR ERROR XCTL             01616900
SPQESIZE EQU   16                  LENGTH OF SPQE                Y02076 01619102
CDELEN   EQU   32                  CDE LENGTH                    Y02076 01619302
ERR217   EQU   217                 FIND PAGE ERROR CODE        @ZSUT222 01619407
ERR202   EQU   202                 SETLOCK ERROR CODE          @ZSUT222 01620307
CVTADDR  EQU   X'10'               CVT ADDR                    @Z30ESHP 01622307
CURASOFS EQU   X'0C'               OFFSET FOR CURR ASCB        @Z30ESHP 01623200
*                                                                       01629200
*        REGISTER EQUATES                                               01632800
*                                                                       01636400
R0       EQU   0                   REG 0                                01640000
R1       EQU   1                   REG 1                                01643600
R2       EQU   2                   REG 2                                01647200
R3       EQU   3                   REG 3                                01650800
R4       EQU   4                   REG 4                                01654400
R5       EQU   5                   REG 5                                01658000
R6       EQU   6                   REG 6                                01661600
R7       EQU   7                   REG 7                                01665200
R8       EQU   8                   REG 8                                01668800
R9       EQU   9                   REG 9                                01672400
RA       EQU   10                  REG 10                               01676000
RB       EQU   11                  REG 11                               01679600
RC       EQU   12                  REG 12                               01683200
RD       EQU   13                  REG 13                               01686800
RE       EQU   14                  REG 14                               01690400
RF       EQU   15                  REG 15                               01694000
         EJECT                                                          01697600
*                                                                       01701200
*        DSECT FOR REPMAIN WORK AREA                                    01704800
*                                                                       01708400
RPMWA1   DSECT                                                          01712000
         SPACE 1                                                        01715600
RPMERAS1 DS    F                   TEMP SAVE AREA                Y02076 01719202
RMNEOV   DS    F                   TO TEST IF EOV OCCURRED              01722800
RSBFSTAD DS    F                   ADDRESS OF DATA                      01726400
RSBFLWA  DS    F                   NUMBER OF BYTES REMAINING IN BUFFER  01730000
RPMMSS1  DS    F                   ADDR OF NEW L-SHAPED PROG MSS CHAIN  01733600
RPMMSS2  DS    F                   ADDRESS OF NEW INIT MSS CHAIN        01737200
RPMMSS3  DS    F                   ADDRESS OF NEW P/P MSS CHAIN         01740800
RPMRB    DS    F                   ADDRESS OF RESTORED RB CHAIN         01744400
RPMLLE   DS    F                   ADDRESS OF RESTORE LLE CHAIN         01748000
RPMCDE   DS    F                   ADDRESS OF RESTORE CDE CHAIN         01751600
RPMDEB   DS    F                   ADDRESS OF RESTORED DEB CHAIN        01755200
RPMFOE   DS    F                   ADDRESS OF RESTORED FOE CHAIN        01758800
RSCORE   DS    F                   ADDR OF CORE ACQUIRED BY LAST GETMN. 01762400
RSW001   DS    F                   POINTER TO NEXT BYTE AVAILABLE CORE  01766000
RSW002   DS    F                   POINTER TO REPMAIN SYNAD ROUTINE     01769600
RPLNT    DS    F                   LENGTH OF BLOCK                      01773200
RMADEOV  DS    F                   SAVE AREA FOR INFORMATION NEEDED     01776800
         DS    0D                  ALIGNMENT                            01780400
CKSAVAR  DS    16F                 GENERAL SAVE AREA                    01784000
RPMN40   DS    D                   MODULE NAME FOR XCTL                 01787600
RP40XCTL DC    F'0'                POINTER TO XCTL PARAMETER LIST       01791200
RSSWIT1  DS    X'00'               BIG BLOCK INDICATOR                  01794800
SWITCH   EQU   RSW001              ERROR SWITCH                         01798400
         TITLE 'IHJQRS24 - RESTART WORK AREA'                           01802000
* RESTART WORK AREA                                                     01805600
         IEEVRSWA                                                       01809200
LOCLOCK  EQU   RSERAS00            LOCK SWITCH                 @Z30ESHP 01811200
USERASCB EQU   RSERAS01            USER ASCB ADDR              @Z30ESHP 01811600
         IHAGDA                                                @Z30ESHP 01812000
         IHALDA                                                @Z30ESHP 01812400
         IHAWSAVT                                              @Z30ESHP 01812500
         TITLE 'IHJQRS24 - CONTROL VECTOR TABLE'                        01812802
* CONTROL VECTOR TABLE                                                  01816402
         CVT   DSECT=YES,PREFIX=NO                                      01820000
         TITLE 'IHJQRS24 - PAGE VECTOR TABLE'                           01823600
* PAGE VECTOR TABLE                                                     01827200
         IHAPVT                                                         01830800
         TITLE 'IHJQRS24 - TASK CONTROL BLOCK'                          01834400
* TASK CONTROL BLOCK                                                    01838000
         IKJTCB                                                         01841600
         TITLE 'IHJQRS24 - SUBSYSTEM CHECKPOINT RECORD'          Y02076 01845202
* SUBSYSTEM CHECKPOINT RECORD                                    Y02076 01848802
         IHJSSCR                                               , Y02076 01852402
         TITLE 'IHJQRS24 - REQUEST BLOCK'                               01856000
* REQUEST BLOCK - S.V.R.B.,I.R.B.,P.R.B.                                01859600
         IKJRB                                                          01863200
         TITLE 'IHJQRS24 - SUBPOOL QUEUE ELEMENT'                       01866800
* SUBPOOL QUEUE ELEMENT                                                 01870400
         IHASPQE                                                        01874000
         TITLE 'IHJQRS24 - PREFERENTIAL STORAGE AREA'            Y02076 01877602
* PREFERENTIAL STORAGE AREA                                      Y02076 01881202
         IHAPSA                                                         01884802
         TITLE 'IHJQRS24 - DESCRIPTOR QUEUE ELEMENT'                    01888400
* DESCRIPTOR QUEUE ELEMENT                                              01892000
         IHADQE                                                         01895600
         TITLE 'IHJQRS24 - FREE QUEUE ELEMENT'                          01899200
* FREE QUEUE ELEMENT                                                    01902800
         IHAFQE                                                         01906400
         TITLE 'IHJQRS24 - CONTENTS DIRECTORY ENTRY'                    01910000
* CONTENTS DIRECTORY ENTRY                                              01913600
         IHACDE                                                         01917200
         TITLE 'IHJQRS24 - EXTENT LIST'                                 01920800
* EXTENT LIST                                                           01924400
         IHAXTLST                                                       01928000
         TITLE 'IHJQRS24 - LOAD LIST ELEMENT'                           01931602
* LOAD LIST ELEMENT                                                     01935200
         IHALLE                                                         01938800
         TITLE 'IHJQRS24 - FIX OWNERSHIP ELEMENT'                       01942400
* FIX OWNERSHIP ELEMENT                                                 01946000
         IHAFOE                                                         01949600
         TITLE 'IHJQRS24 - EXTERNAL PAGE TABLE'                         01953200
* EXTERNAL PAGE TABLE                                                   01956800
         IHAXPTE                                                        01960400
         END                                                            01964007
