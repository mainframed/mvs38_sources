./  ADD  SSI=70760389,NAME=IGC0002G
 TITLE 'IGC0002G - OBTAIN - ENTRY POINT - READ DSCB'                    00020000
IGC0002G CSECT                                                          00022021
*                                                                       00024021
*          VS2 RELEASE 037 CHANGES                                      00024137
*A0000                                                         @ZA17992 00024237
*          VS2 RELEASE 03 DELETIONS/CHANGES                             00024403
*000023200-24000                                                Z30AAJC 00024803
*0000                                                            ZM0144 00024903
*          VS1 RELEASE 02 DELETIONS                                     00025002
*0000                                                            X02989 00025402
*0000                                                           XA00356 00025802
*0000049797                                                      XM0876 00028702
*0000                                                            XM1039 00030702
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00032502
*0000018600-019600                                               YM0117 00032702
*0000000971,003000-003200,004120-004400,008600,009000,016673,    Y02080 00032802
*0000016703,016766-016797,016859,016887-016889,016977,017200-    Y02080 00032902
*0000017400,017900-018120,018260,019790-020000,020400,021250-    Y02080 00033002
*0000021321,021346-021617,021640,021761-021850,021964,022600,    Y02080 00033102
*0000024600-026600,028260,031000,032600,033860,035400-036400,    Y02080 00033202
*0000037000,037600,045500,045600-046200,049700,049744-049900,    Y02080 00033302
*0000053730-053750,053770-053800,058800,060250-060340,060584-    Y02080 00033402
*0000060592,062000,063000,073420-080700                          Y02080 00033502
*0000000030-000150,005200,007000,008800,016885,017135,039400-    Y02078 00033602
*0000039600,042000-042200,043000,043400-043600,045400,046480,    Y02078 00033702
*0000046600,047800-048000,048400,055600,056200,056600-057200,    Y02078 00033802
*0000058400,063600-063800,064800,068400,069000-069200,070200,    Y02078 00033902
*0000072800-073000                                               Y02078 00034002
*0000                                                            Y02132 00034202
*0000                                                            Y02082 00034402
*0000021480                                                      YM1312 00034502
*0000005000-005200,050540-050700,060290-060300                   YM3996 00034602
*0000060260                                                      YM5902 00034702
*0000051420,053020,053140,053340                                 YM5378 00035002
*          RELEASE 22 DELETIONS                                         00036202
*          RELEASE 21 DELETIONS                                         00039102
*1195008600,009000,010480,016200-016400,038400,043600            A38860 00042002
*1195016010-016020                                               A37199 00044902
*1195037000,037600                                               A44463 00047802
*0000018400,020200,020600                                        A42200 00050702
*0000019800,045800                                              SA49351 00053602
*          RELEASE 21.7 DELETIONS                                       00059402
*0000011100-016270,016704-016750,016770-016794,016800-016811,   SA56452 00062302
*0000016874,016937,017000,017070,017800,020600-021000,021200,   SA56452 00065202
*0000021400,021600,021970-021998,022100,050000-053400,053691-   SA56452 00068102
*0000053709,053714-053719,080700                                SA56452 00071002
*0000043600                                                     SA56392 00071402
*0000                                                           SA56450 00071802
*0000042800,066400                                              SA48172 00073002
*          RELEASE 20 DELETIONS                                         00073902
*3510000250-000420,000500-000650,053800,079400                   S20201 00076802
*3510                                                            A34440 00079702
*3510051200-051780,051790                                        M0696  00082602
*          RELEASE 19 DELETIONS                                         00085502
*2741024440-024560                                               A25499 00088402
*                                                                       00093302
*MODULE NAME - IGC0002G                                                 00093702
*                                                                       00094102
*DESCRIPTIVE NAME - OBTAIN - ENTRY POINT - READ DSCB                    00099202
*                                                                       00101202
*COPYRIGHT - NONE                                                       00103202
*                                                                       00103602
*CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD           00104002
*                                                                       00104402
*STATUS CHANGE LEVEL 005                                                00104702
*                                                                       00106702
*ATTRIBUTES - REENTRANT                                                 00109802
*                                                                       00114902
*FUNCTION - THIS MODULE IS THE ENTRY POINT TO OBTAIN. THIS MODULE HAS   00120000
*          TWO OPTIONS. THE SEARCH OPTION SEARCHES THE VTOC FOR THE     00140000
*          NAMED DSCB AND THE SEEK OPTION SEEKS TO THE APPROPRIATE      00160000
*          TRACK AND SEARCHES THAT TRACK FOR THE GIVEN CCHHR. THE       00180000
*          DATA PORTION OF THE DSCB IS READ FOR THE SEARCH OPTION;      00200000
*          THE KEY AND DATA PORTIONS ARE READ FOR THE SEEK OPTION.      00210000
*          FOR THE SEARCH OPTION WITH A VIO DATA SET, THE DATA          00211002
*          PORTION OF THE FORMAT 1 DSCB IS MOVED FROM THE VDSDSCB       00212002
*          INTO THE USER'S WORK AREA, AND THE CCHHR IS SET TO ZERO.     00213002
*          VSAM SUPPORT REQUIRES THAT IF A DSCB IS NOT FOUND IN  X02989 00214002
*          A SEARCH OPERATION AND IF VSAM IS ON THE VOLUME,      X02989 00216002
*          CONTROL IS TRANSFERRED TO MODULE IGC0102G TO TRY TO   X02989 00218002
*          FIND THE DATA SET WITHIN A VSAM DATA SPACE.OTHERWISE, X02989 00218402
*          A NORMAL ERROR EXIT IS EFFECTED.                      X02989 00218502
*                                                                       00220000
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGC0002G. ENTRY IS    00240000
*          MADE UPON SVC 27 FROM ANY SYSTEM OR PROBLEM PROGRAM.         00260000
*                                                                       00280000
*SUPERVISOR CALLS AND MACROS. THE FOLLOWING ARE SUPERVISOR CALLS        00340000
*          ISSUED IN THE MACRO EXPANSIONS:                              00360000
*                    EXCP(0) READ FROM DIRECT ACCESS DEVICE             00380000
*                    WAIT(1) WAIT ON EVENT CONTROL BLOCK                00400000
*                    ENQ(56) ENQ ON SYSZTIOT                            00410002
*                    DEQ(48) DEQ FROM SYSZTIOT                          00420002
*                                                                       00430002
*OTHER MACROS USED:                                                     00460000
*          IECOBTWA - OBTAIN WORK AREA EXPANSION                        00470002
*          IECSDSL1 - ENABLES SYMBOLIC ADDRESSING OF DSCBS              00480002
*          IDDVDSCB - EXPANDS THE VDSCB                                 00490002
*          IECDSECS - EXPANDS THE ASCB, CVT, DSAB, JSCB, PSA, QDB, RB,  00500002
*                     RRPL, TCB, TIOT, AND UCB DSECTS                   00520002
*                                                                       00540000
*INPUT -   AT ENTRY TO THIS MODULE REG 1 POINTS TO THE PARAMETER LIST.  00560000
*          THE PARAMETER LIST CONSISTS OF FOUR WORDS:                   00580000
*                    WORD 1 - SEARCH CODE = X'C1000000'                 00600000
*                             SEEK CODE = X'C0800000'                   00620000
*                    WORD 2 - SEARCH = ADDR OF DATA SET NAME            00640000
*                             SEEK = ADDR OF CCHHR OF DSCB              00660000
*                    WORD 3 - ADDR OF VOLUME SERIAL NUMBER              00680000
*                    WORD 4 - ADDR OF 140 BYTE WORK AREA.               00700002
*                                                                       00720000
*OUTPUT -  THE DSCB IS RETURNED IN THE GIVEN WORK AREA. IF THE OPTION   00740000
*          WAS SEARCH, THE DSCB WILL OCCUPY THE FIRST 96 BYTES OF THE   00760000
*          WORK AREA, AND THE CCHHR OF THE DSCB WILL BE THE NEXT 5      00780000
*          BYTES. IF THE OPTION WAS SEEK, THE DSCB WILL OCCUPY THE      00800000
*          FIRST 140 BYTES OF THE WORK AREA.                            00820000
*          WHEN CONTROL IS PASSED TO IGC0102G, REGISTER 10 POINTS       00824002
*          TO THE PARAMETER LIST, AND REGISTER 13 POINTS TO THE         00828002
*          OBTAIN WORK AREA.                                            00832002
*                                                                       00840000
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    00860002
*          USER WORK AREA = 140 BYTES                                   00880002
*          OBTAIN WORK AREA = 580 BYTES                                 00900002
*                                                                       00920000
*ERROR CONDITIONS - UPON EXIT REGISTER 15 WILL CONTAIN THE COMPLETION   00940000
*          CODE OF OBTAIN AS FOLLOWS--                                  00960000
*              00 - SUCCESSFUL OBTAIN                                   00980000
*              04 - VOLUME NOT MOUNTED                                  01000000
*              08 - DSCB NOT FOUND IN VTOC                              01020000
*              0C - PERMANENT I/O ERROR                                 01040000
*              10 - INVALID WORK AREA POINTER                     13395 01044000
*              14 - (SEEK MODE) ABSOLUTE TRACK ADDRESS IS OUT     13395 01052000
*                   OF THE BOUNDARY OF THE VTOC EXTENT.           13395 01056000
*                                                                       01060000
*RESTRICTIONS - NO SECURITY PROTECTION                                  01080000
*                                                                       01100000
*REGISTER USAGE:                                                        01110002
*                                                                       01120002
R0       EQU   0                        REGISTER ZERO                   01130002
R1       EQU   1                        REGISTER ONE                    01140002
R2       EQU   2                        REGISTER TWO                    01150002
RDSAB    EQU   2                        DSAB POINTER             Y02132 01155002
R3       EQU   3                        REGISTER THREE                  01160002
P1       EQU   3                        REGISTER THREE                  01170002
R4       EQU   4                        REGISTER FOUR                   01180002
P2       EQU   4                        REGISTER FOUR                   01190002
R5       EQU   5                        REGISTER FIVE                   01200002
P3       EQU   5                        POINTER TO VOL SER              01210002
R6       EQU   6                        REGISTER SIX                    01220002
P4       EQU   6                        PTR TO CALLER'S WORK AREA       01230002
R7       EQU   7                        REGISTER SEVEN                  01240002
R8       EQU   8                        REGISTER EIGHT                  01250002
RCVT     EQU   8                        CVT POINTER                     01260002
R9       EQU   9                        REGISTER NINE                   01270002
RWKAPTR  EQU   9                        OBTAIN WORK AREA POINTER        01280002
PL       EQU   10                       PARAMETER LIST POINTER          01290002
RUCB     EQU   11                       UCB POINTER                     01300002
RB       EQU   11                       REGISTER ELEVEN          A37199 01310002
RBASE    EQU   12                       BASE REGISTER                   01320002
RWKAREA  EQU   13                       PTR TO CALLER'S WORK AREA       01330002
RETURN   EQU   14                       RETURN REGISTER                 01340002
RE       EQU   14                       REGISTER FOURTEEN        A37199 01350002
R15      EQU   15                       EQUATE FOR REGISTER 15   Y02080 01360002
WORKREG  EQU   15                       WORK REGISTER                   01370002
*                                                                       01380002
* OTHER EQUATES                                                         01390002
*                                                                       01400002
K0       EQU   0                        CONSTANT OF ZERO         YM0839 01410002
K1       EQU   1                        CONSTANT OF ONE          Y02078 01420002
ONE      EQU   1                        ONE CHARACTER            S20201 01430002
K2       EQU   2                        CONSTANT OF TWO          Y02132 01435002
K3       EQU   3                        CONSTANT OF THREE        YM8538 01436002
K4       EQU   4                        CONSTANT OF FOUR         YM0839 01440002
NONZERO  EQU   4                        NON-ZERO VALUE           YM1312 01445002
FW       EQU   4                        BYTES IN FULL WORD       S20201 01450002
C7       EQU   7                        CHARACTER OF SEVEN       S20201 01460002
K8       EQU   8                        CONSTANT OF EIGHT        Y02078 01465002
K12      EQU   12                       CONSTANT OF 12          SA56452 01470002
K16      EQU   16                       CONSTANT OF 16          SA56452 01480002
CSWAD    EQU   8                        CSW OFFSET IN IOB       SA56392 01485002
NOVSAM   EQU   X'00'                    NO VSAM ON VTOC FLAG     X02989 01490002
NOF1DSCB EQU   8                        NO F1 DSCB ERROR CODE    Y02132 01495002
CCHHRL   EQU   5                        LENGTH OF CCHHR          Y02078 01500002
VDATALN  EQU   81                       VDSDSCB DATA LENGTH      Y02132 01505002
DATAL    EQU   96                       DSCB DATA PORTION LENGTH Y02078 01510002
F1       EQU   C'1'                     FORMAT 1 DSCB ID         Y02078 01520002
F4       EQU   C'4'                     FORMAT 4 DSCB ID         Y02078 01530002
SEEKCODE EQU   X'80'                    SEEK OPTION CODE         Y02132 01535002
DOSBIT   EQU   X'80'                    DOS BIT IN DS4VTOCI      Y02078 01540002
DIRFBIT  EQU   X'04'                    DIRF BIT IN DS4VTOCI     Y02078 01550002
WKALNGTH EQU   139                      LENGTH-1 OF WORK AREA    Y02078 01560002
UNRELATD EQU   X'02'                    UNRELATED FLAG IN IOB   SA56452 01570002
RPSMSK   EQU   X'10'                    TESTS RPS BIT IN UCB    SA56452 01580002
SKIP     EQU   X'10'                    CCW SKIP FLAG           SA48172 01590002
SLI      EQU   X'20'                    CCW SUPPRESS LENGTH     SA48172 01600002
*                                       INDICATOR               SA48172 01610002
*                                                                       01690002
         BALR  RBASE,K0                 INITIALIZE BASE REGISTER Y02080 01700002
         USING BEGIN,RBASE              CSECT ADDRESSABILITY     Y02080 01710002
         USING OBTNWKA,RWKAPTR          WORK AREA ADDRESSABILITY Y02080 01720002
         USING UCB,RUCB                                                 01760000
*                                                                       01770002
* THIS SECTION OBTAINS THE OBTAIN WORK AREA.                            01780002
*                                                                       01782000
BEGIN    EQU   *                                                 Y01077 01814000
         LR    PL,R1                    PARAMETER LIST POINTER          01826000
         LM    P3,P4,K8(PL)             LOAD VOL SER NUMBER ADDR YM0117 01860002
*                                       AND WORK AREA ADDRESS    YM0117 01880002
         LA    RWKAREA,0(P4)            LOAD BASE REGISTER FOR   A42200 01966021
*                                       USER'S WORK AREA         A42200 01972021
         L     R9,K0(R4)                LOAD SVRB ADDRESS        Y02080 01976002
         IECRES GET,PREFIX=FIRST,LV=OWALNGTH,ID=OBWA,            Y02080X01980002
               STM=(R2,RWKAREA,96(R9))  OBTAIN WORK AREA         Y02080 01984002
         LR    RWKAPTR,R1               LOAD BASE REGISTER FOR   A42200 02010021
*                                       OBTAIN'S WORK AREA       A42200 02020021
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO AFTER Y02082X02024002
                                        ISSUING THE IECRES GET   Y02082X02028002
                                        FOR CORE IN KEY 5        Y02082 02032002
*                                                                       02036002
         IECRES LOAD,EXTPR=(RWKAPTR),MODNM=FIRSTLD,BRANCH=NO     Y02080X02040002
                                        LET OPTIONAL TRACE PRINT Y02080X02044002
                                        THIS MODULE'S NAME       Y02080 02048002
*                                                                       02052002
         L     R1,IECRRPRM              RECOVERY RTN LIST ADDR   Y02144 02056002
         USING RRPLIST,R1               PARM LIST ADDRESSABILITY Y02144 02060002
         OI    RRFUNCTN,RRFOBTN         SET OBTAIN FUNCTION BIT  Y02144 02064002
         DROP  R1                                                Y02144 02068002
*                                                                       02072002
         ST    R4,TCBADDR               SAVE INPUT TCB ADDRESS   Y02078 02080002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02080 02084002
         USING CVT,RCVT                 CVT ADDRESSABILITY       Y02080 02088002
*                                                                       02103402
* THIS SECTION CHECKS VALIDITY OF USER'S WORK AREA POINTER              02106702
*                                                                       02110002
VALCK    EQU   *                                                SA56452 02120002
         STM   RB,R3,IECREGSV+K12       SAVE REGISTERS 11-3      Y02080 02130002
         XR    R7,R7                    INITIALIZE REGISTER      Y02080 02131002
*                                                                       02133102
* IF THE CALLER IS IN PROTECT KEY OF ZERO OR IN SUPERVISOR              02133402
* STATE, THE WORK AREA DOES NOT HAVE TO BE CHECKED SINCE                02133702
* HE MAY USE ANY REGION IN MAIN STORAGE                                 02134002
*                                                                       02134302
         TESTAUTH FCTN=1,KEY=YES,STATE=YES,BRANCH=YES  TEST IF   Y02080X02136002
                                        CALLER IS IN KEY 0 OR    Y02080X02137002
                                        IN SUPERVISOR STATE      Y02080 02138002
         LTR   R15,R15                  TEST IF ANY TRUE         Y02080 02139002
         BZ    RESTORE                  BRANCH IF YES            Y02080 02140002
         LA    R1,K0(P4)                STARTING ADDRESS         Y02080 02141002
         LA    R2,WKALNGTH(R1)          ENDING ADDRESS           Y02080 02142002
OBTNLOCK SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02080X02143002
               RELATED=(LOCAL,IGC0002G(RLSELOCK))  OBTAIN LOCK   Y02080 02144002
         LM    RB,RE,IECREGSV+K12       RESTORE REGISTERS 11-14  Y02080 02145002
         L     R15,CVT0VL00             VALIDITY CHECK RTN ADDR  Y02080 02146002
         BALR  RETURN,R15               LINK TO VALIDITY CHECK   Y02080 02147002
         BZ    RLSELOCK                 BRANCH IF VALID ADDRESS  YM1312 02147502
         LA    R7,NONZERO               INDICATE INVALID ADDRESS YM1312 02148002
*                                                                       02148502
RLSELOCK SETLOCK RELEASE,TYPE=LOCAL,                             Y02080X02149002
               RELATED=(LOCAL,IGC0002G(OBTNLOCK))  RELEASE LOCK  Y02080 02150002
RESTORE  EQU   *                        RESTORE REGISTERS        Y02080 02151002
         LM    RB,R3,IECREGSV+K12       RESTORE REGISTERS 11-3   Y02080 02152002
         LTR   R7,R7                    TEST IF ADDRESS VALID    Y02080 02153002
         BZ    ADDROK                   BRANCH IF VALID          Y02080 02154002
         LA    WORKREG,K16              INSERT ERROR CODE       SA56452 02162002
         B     SETCODE                  BR TO STORE ERROR CODE  SA56452 02166002
PERMERR  EQU   *                                                SA56452 02167002
         LA    WORKREG,K12              LOAD ERROR CODE         SA56452 02168002
SETCODE  EQU   *                                                SA56452 02169002
         STH   WORKREG,ERCODE           STORE ERROR CODE        SA56452 02170002
         B     LEAVE                    RETURN TO CALLER        SA56452 02171002
*                                                                       02172002
* THIS SECTION SEARCHES THE UCB LOOKUP TABLE TO FIND THE UCB ADDRESS.   02173002
*                                                                       02174002
ADDROK   EQU   *                        FIND THE UCB ADDRESS     Y02080 02175002
         OC    0(6,P3),0(P3)            CHECK FOR ZERO VOL       A25499 02176002
*                                       SERIAL                   A25499 02177002
         BZ    ENDADDR                  DON'T LOOK FOR UCB IF 0  A25499 02178002
         TM    K1(PL),SEEKCODE          TEST FOR THE SEEK OPTION Y02132 02179002
         BO    UCBSRCH                  BRANCH IF SEEK SPECIFIED Y02132 02180002
*                                                                Y02132 02181002
         L     P2,K4(,PL)               LOAD DSNAME ADDRESS      Y02132 02182002
         ST    P2,DSMADTW3              SAVE DSNAME ADDRESS      Y02144 02183002
         CLC   BLANKS,K0(P3)            TEST FOR A VALID VIRTUAL Y02132 02184002
*                                       UCB VOLUME SERIAL NUMBER Y02132 02185002
         BNE   UCBSRCH                  BRANCH IF NOT BLANKS     Y02132 02186002
         CLC   CSYS,K0(P2)              TEST FOR CHARACTERS SYS  Y02132 02187002
*                                       IN BYTES 0-2 OF THE DSN  Y02132 02188002
         BNE   UCBSRCH                  BRANCH IF NOT A VIO DSCB Y02132 02189002
         CLC   CDOTT,K8(P2)             TEST FOR .T IN BYTES 8-9 Y02132 02190002
         BNE   UCBSRCH                  BRANCH IF NOT A VIO DSCB Y02132 02191002
         CLC   CDOTR,K16(P2)            TEST FOR CHARACTERS .R   Y02132 02192002
*                                       IN BYTES 16-17           Y02132 02193002
         BE    VIODSTST                 BRANCH IF A POSSIBLE     Y02132 02194002
*                                       VIRTUAL DATA SET         Y02132 02195002
*                                                                       02196002
UCBSRCH  EQU   *                        UCB SEARCH               Y02132 02197002
         L     RCVT,CVTPTR              SET UP CVT BASE REGISTER Y01077 02200000
         L     R2,CVTILK2               LOAD ADDR OF UCB ADDR TABLE     02240000
UCBLOOP  EQU   *                                                        02280000
         SR    WORKREG,WORKREG          CLEAR SUBUCB POINTRR.           02300000
         SR    RUCB,RUCB                CLEAR UCB POINTER        ZM0144 02300103
         ICM   RUCB,3,0(R2)             LOAD 16 BIT UCB ADDR    Z30AAJC 02320003
         BZ    NEXTADDR                 BRANCH IF NO UCB        Z30AAJC 02340003
         CLM   RUCB,3,EXTCONST          LAST TABLE ENTRY?       Z30AAJC 02360003
         BE    ENDADDR                  BRANCH IF AT END OF TBL Z30AAJC 02380003
         TM    UCBTBYT3,UCB3DACC       TEST FOR DIRECT ACCESS           02420000
         BZ    NEXTADDR                BR IF NOT                        02440000
         TM    SRTESTAT,SRTEONLI        SEE IF THIS UCB IS       A25499 02665019
*                                       ONLINE                   A25499 02670019
         BZ    NEXTADDR                 IF NOT, TRY NEXT UCB     A25499 02675019
         CLC   SRTEVOLI(6),0(P3)       COMPARE VOLUME SERIAL NUMBERS    02680000
         BE    PRIMUCB                 BR IF FOUND                      02700000
NEXTADDR LA    R2,2(R2)                TRY NEXT ADDR IN UCB ADDR TABLE  02720000
         B     UCBLOOP                                                  02740000
*                                                                       02760000
ENDADDR  LA    WORKREG,4               LOAD ERROR CODE                  02780000
         B     SETCODE                                                  02800000
*                                                                       02820000
*                                                                       02832000
PRIMUCB  EQU   *                                                        02840000
         L     R1,IECRRPRM              RECOVERY RTN LIST ADDR   Y02144 02850002
         USING RRPLIST,R1               PARM LIST ADDRESSABILIT  Y02144 02860002
         ST    RUCB,RRUCBPTR            SAVE UCB ADDRESS         Y02144 02870002
         DROP  R1                                                Y02144 02880002
*                                                                       03020000
* BUILD DEB                                                             03040000
*                                                                       03060000
BUILDEB  EQU   *                       BUILD DEB                 Y02144 03070002
         LA    R1,DEB                  BUILD DEB                        03080000
         MVI   16(R1),X'01'            NUM OF EXTS = 1                  03120000
         LA    R2,DCB                                                   03140000
         ST    R2,24(R1)               INSERT DCB ADDR                  03160000
         MVI   24(R1),X'0F'            INSERT DEB ID                    03180000
         MVC   29(3,R1),CVTXAPG+1      INSERT IOS APPAD TAB ADDR        03200000
         MVI   28(R1),X'04'            INSERT EXT SCALE                 03220000
         ST    RUCB,32(R1)             INSERT UCB ADDR                  03240000
         MVI   32(R1),X'C0'            INSERT DEVICE MOD                03280000
         MVC   42(6,R1),EXTCONST       INSERT EXTS AND TK COUNT         03300000
         ST    R1,DEBPTR               BUILD DCB                        03320000
*                                                                       03340000
* BUILD IOB                                                             03360000
*                                                                       03380000
         OI    IOB,UNRELATD             SET UNRELATED BIT IN IOB A37199 03392021
         LA    R0,ECB                                                   03400000
         ST    R0,IOB+4                 POINT TO ECB.                   03420000
         TM    UCBTBYT2,RPSMSK          DOES DEVICE HAVE RPS     S20201 03421002
         BZ    NORPS1                   NO, CONTINUE AS NORMAL   S20201 03422002
         LA    R0,THETA                 GET ADDRESS OF THETA     S20201 03423002
         O     R0,RPSCCW                GET SET SECTOR COMMAND   S20201 03424002
*                                       CODE                     S20201 03425002
         ST    R0,CCW0                  BUILD SET SECT. CCW      S20201 03426002
         MVC   CCW0+FW(FW),RPSCCW+FW    BUILD FLAGS & LENGTH     S20201 03427002
         LA    R0,CCW0                  ADDR OF RPS CHANNEL PGM. S20201 03428002
         B     IOBCONT                  CONTINUE                 S20201 03429002
NORPS1   EQU   *                                                 S20201 03430002
         LA    R0,CCW1                                                  03440000
IOBCONT  EQU   *                                                 S20201 03450002
         ST    R0,IOB+16                POINT TO START OF CHANL PRGRM.  03460000
         LA    R0,DCB                                                   03480000
         ST    R0,IOB+20                POINT TO DCB.                   03500000
         L     R0,SRTEFSCT              PICK UP TTR0 OF VTOC     Y02080 03640002
         L     WORKREG,CVTPCNVT        LOAD ADDR OF CONVERT ROUTINE     03660000
         LA    R2,SEEK                 PUT MBBCCHHR IN SEEK FIELD       03680000
         STM   RWKAPTR,RWKAREA,IECREGSV+K12  SAVE REGISTERS 9-13 Y02080 03700002
         LR    R3,RWKAPTR               SAVE WORK AREA POINTER.         03720000
         BALR  RETURN,WORKREG          CONVERT TTR0 TO MBBCCHHR         03740000
         LM    RWKAPTR,RWKAREA,IECREGSV+K12-OBTNWKA(R3)  RESTORE Y02080 03760002
         TM    0(PL),X'01'             TEST FOR SEARCH CODE             03780000
         BZ    SEEKDSCB                BR IF NOT                        03800000
*                                                                       03820000
* THIS SECTION RELOCATES & EXECUTES THE SEARCH OPTION CHANNEL PROGRAM.  03840021
*                                                                       03860000
SRCHDSCB EQU   *                       BUILD CCW                 Y02144 03870002
         L     WORKREG,4(0,PL)          LOAD DSNAME PTR          YM8538 03871002
         CLC   F4NAME,0(WORKREG)        CHECK IF F4 ONLY         YM8538 03872002
         BNE   F1SEARCH                 GO READ FORMAT 1         YM8538 03873002
         LM    R0,R5,CHANPROG           CCWS TO READ F4 ONLY     YM8538 03874002
         AR    R0,RWKAPTR               RESOLVE CCW1 ADDRESS     YM8538 03875002
         AR    R2,RWKAPTR               RESOLVE CCW2 ADDRESS     YM8538 03875202
         AR    R4,RWKAPTR               RESOLVE CCW3 ADDRESS     YM8538 03876002
         LA    R5,0(0,R5)               CLEAR FLAGS              YM8538 03877002
         STM   R0,R5,CCW1               SETUP 3 CCWS             YM8538 03878002
         BAL   RETURN,EXECIO            READ F4 ONLY             YM8538 03879002
         CLI   DS4IDFMT,F4             TEST FOR FORMAT 4 ID      YM8538 03879102
         BNE   PERMERR                 BRANCH IF NOT             YM8538 03879202
         MVC   DS1FMTID(L'F4DSCB),F4DSCB MOVE F4 TO F1 BUFFER    YM8538 03879402
         MVC   NEWCCHHR,SEEK+K3         RETURN F4 CCHHR          YM8538 03879802
         B     RETPARMS                 BRANCH TO RETURN INFO    YM8538 03879902
*                                                                YM8538 03880902
F1SEARCH EQU   *                        SEARCH FOR F1 DSCB       YM8538 03881102
*                                                                YM8538 03881302
         LM    R0,R7,CHANPROG          LOAD CCW1 TO CCW4 CONSTANTS      03881902
         AR    R0,RWKAPTR               RESOLVE ADDR IN CCW1.           03900000
         AR    R2,RWKAPTR               RESOLVE ADDR IN CCW2.           03920000
         AR    R4,RWKAPTR              RESOLVE ADDR IN CCW3      Y02078 03940002
         AR    R6,RWKAPTR              RESOLVE ADDR IN CCW4      Y02078 03960002
         STM   R0,R7,CCW1              STORE CCW1 TO CCW4               03980000
         LA    WORKREG,CCW9-CCW1                                        04000000
         AR    R2,WORKREG              RESOLVE ADDR IN CCW5             04020000
         STM   R2,R3,CCW5              STORE CCW5                       04040000
         LA    WORKREG,CCW11-CCW9                                       04060000
         AR    R2,WORKREG              RESOLVE ADDR IN CCW8             04080000
         STM   R2,R3,CCW8              STORE CCW8                       04100000
         LM    R0,R7,CHANPROG+32       LOAD CCW9 TO CCW12 CONSTANTS     04120000
         L     WORKREG,4(0,PL)         LOAD ADDR OF DATA SET NAME       04140000
         LA    WORKREG,0(WORKREG)      CLEAR HIGH ORDER BYTE    SA56450 04150002
         AR    R0,WORKREG              RESOLVE ADDR IN CCW9             04160000
         AR    R2,RWKAPTR               RESOLVE ADDR IN CCW2.           04180000
         AR    R4,RWKAPTR              RESOLVE ADDR IN CCW11     Y02078 04200002
         AR    R6,RWKAPTR              RESOLVE ADDR IN CCW12     Y02078 04220002
         STM   R0,R7,CCW9              STORE CCW9 TO CCW 12             04240000
         STM   R0,R1,CCW6              STORE CCW6                       04260000
         STM   R4,R5,CCW7              STORE CCW7               SA48172 04280002
         MVI   CCW7+4,SLI+SKIP         SET SLI AND SKIP BITS    SA48172 04292002
EXECUTE  BAL   RETURN,EXECIO           EXECUTE THE CHANNEL PROGRAM      04320000
         L     R2,IOB+CSWAD            GET CSW COMMAND ADDRESS  SA56392 04322002
         LA    R2,0(R2)                CLEAR HIGH BYTE          SA56392 04324002
         LA    R3,CCW8                 GET CCW8 ADDRESS         SA56392 04326002
         CLR   R2,R3                   DOES CSW POINT TO CCW8   SA56392 04328002
         BE    TESTDOS                 YES, FORMAT 1 DSCB       SA56392 04330002
*                                      WAS NOT FOUND            SA56392 04332002
         CLI   DS1FMTID,F1             TEST FOR FORMAT 1 ID      Y02078 04340002
         BNE   PERMERR                 BAD VTOC - I/O ERR CODE  SA56392 04360002
         SR    WORKREG,WORKREG         ZERO REG                         04380000
         STC   WORKREG,ERCODE          TURN OFF FIRST PASS INDICATOR    04400000
         IC    WORKREG,NEWCCHHR+4      PICK UP R OF NEXT RECORD         04420000
         BCTR  WORKREG,R0              DECREMENT R BY ONE               04440000
         LTR   WORKREG,WORKREG         CHECK FOR DSCB LAST ON TRACK     04460000
         BNE   NOTLAST                 BR IF NOT                        04480000
         IC    WORKREG,DS4DEVDT        SET R TO LAST DSCB ON THE TRACK  04500000
NOTLAST  STC   WORKREG,NEWCCHHR+4      STORE R OF DSCB READ INTO CORE   04520000
*                                                                YM8538 04521002
RETPARMS EQU   *                        UPDATE USER PARM LIST    YM8538 04522002
*                                                                YM8538 04523002
         L     R1,TCBADDR              LOAD TCB ADDRESS          Y02078 04524002
         USING TCB,R1                  TCB ADDRESSABILITY        Y02078 04528002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 04532002
         MVC   K0(DATAL,RWKAREA),DS1FMTID  MOVE IN F1 DSCB DATA  Y02078 04540002
         MVC   DATAL(CCHHRL,RWKAREA),NEWCCHHR  MOVE IN CCHHR     Y02078 04541002
         MODESET EXTKEY=ZERO           RETURN TO KEY ZERO        Y02082 04542002
         DROP  R1                                                Y02078 04543002
*                                                                       04545021
* THIS SECTION FREES THE WORK AREA AND RETURNS TO THE CALLER.           04550002
*                                                                       04555021
LEAVE    EQU   *                        SAVE RETURN CODE         Y02080 04560002
         LH    R8,ERCODE                SAVE RETURN CODE         Y02080 04570002
         IECRES FREE,PREFIX=FIRST,A=(RWKAPTR)  FREE WORK AREA    Y02080 04580002
         USING CVT,WORKREG              CVT ADDRESSABILITY       Y02080 04590002
         L     WORKREG,CVTPTR           LOAD CVT ADDRESS         Y02080 04600002
         L     RETURN,CVTEXPRO          LOAD EXIT PROLOG ADDRESS Y02080 04610002
         LR    WORKREG,R8               RESTORE RETURN CODE      Y02080 04620002
         RETURN ,                       RETURN                   Y02080 04630002
         DROP  WORKREG                                           Y02080 04634002
*                                                                       04640000
* IF THE FORMAT 1 DSCB WAS NOT FOUND ON THE FIRST PASS, AND THE         04644021
* DOS OR DIRF BIT IS SET IN THE FORMAT 4 DSCB, THIS SECTION             04648002
* MODIFIES THE CHANNEL PROGRAM TO READ EVERY DSCB IN THE VTOC.          04652021
*                                                                       04656021
TESTDOS  EQU   *                       TEST IF DOS OR DIRF SET   Y02078 04658002
         TM    DS4VTOCI,DOSBIT+DIRFBIT  TEST IF DOS OR DIRF SET  Y02078 04660002
         BZ    NODSCB                  BR IF NOT                        04680000
         TM    ERCODE,X'80'            TEST FOR SECOND PASS             04700000
         BO    NODSCB                  BR IF YES                        04720000
         OI    ERCODE,X'80'            TURN ON FIRST PASS INDICATOR     04740000
         CLC   DS4HPCHR(4),DS4VTOCE+6   IS HIGH PRIME CCHH END OF VTOC. 04760000
         BNE   NEWHIGH                  BRANCH IF NOT            Y02078 04780002
         CLC   DS4HPCHR+K4(K1),DS4DEVDT  IS HIGH PRIME R THE     Y02078 04800002
*                                       LAST RECORD ON THE TRACK Y02078 04810002
         BE    NODSCB                   BRANCH IF YES.                  04820000
NEWHIGH  EQU   *                       SET NEW HIGH              Y02078 04840002
         MVC   DS4HPCHR(4),DS4VTOCE+6     INSERT CCHH OF VTOE END.      04860000
         MVC   DS4HPCHR+4(1),DS4DEVDT  PICK UP NEW R                    04880000
         MVI   CCW3+4,X'50'            STORE NEW CCW3                   04900000
         B     EXECUTE                                                  04920000
*                                                                       04940000
NODSCB   LA    WORKREG,8               LOAD ERROR CODE                  04960000
         CLI   DS4AMCAT,NOVSAM         CHECK FOR NO VSAM ON VOL  X02989 04972002
         BE    SETCODE                 NORMAL PATH FOR ERROR     X02989 04974002
         LR    RWKAREA,RWKAPTR          W/A ADDR IN REGISTER 13  Y02080 04978002
         IECRES LOAD,EXTPR=(RWKAPTR),MODNM=VSAMMOD,BRANCH=DIRECT Y02080 04982002
*                                                                       04984002
* FOR A POSSIBLE VIO DATA SET, THIS SECTION FIRST ATTEMPTS TO ENQ       04986002
* ON THE TIOT.  IT THEN SEARCHES THE DSAB CHAIN FOR A TIOT ENTRY        04990002
* CONTAINING A VIRTUAL UCB WHOSE VDSDSCB CONTAINS THE DATA SET NAME     04994002
* BEING OBTAINED AND WHOSE VOLUME SERIAL MATCHES THE VOLUME SERIAL      04998002
* IN THE PARAMETER LIST.  IF A DSNAME/VOL SER MATCH IS FOUND, IT        05002002
* MOVES THE 81 BYTE DATA PORTION OF THE VDSDSCB INTO THE CALLER'S       05006002
* WORK AREA.  NOTE THAT IF THE ENQ RETURN CODE INDICATED THAT THE TASK  05010002
* PREVIOUSLY HAD CONTROL OF THE RESOURCE, NO SUBSEQUENT DEQ IS ISSUED.  05014002
*                                                                       05018002
VIODSTST EQU   *                        TEST FOR VIO DATA SET    Y02132 05022002
         L     RDSAB,TCBADDR            GET TCB ADDRESS          Y02132 05026002
         USING TCB,RDSAB                TCB ADDRESSABILITY       Y02132 05030002
         L     RDSAB,TCBJSCB            GET JSCB ADDRESS         Y02132 05034002
         USING IEZJSCB,RDSAB            JSCB ADDRESSABILITY      Y02132 05038002
         L     RDSAB,JSCBACT            GET ACTIVE JSCB ADDRESS  Y02132 05042002
         L     RDSAB,JSCDSABQ           GET DSAB QDB ADDRESS     Y02132 05046002
         ST    RDSAB,DSABQDB            SAVE FOR TIOT ENQ        Y02132 05050002
         L     WORKREG,CVTPTR           LOAD CVT ADDRESS         YM3996 05053002
         L     WORKREG,CVTTCBP-CVT(,WORKREG)  LOAD TCB/ASID PTRS YM3996 05056002
         L     WORKREG,K12(,WORKREG)    LOAD CURRENT ASID ADDR   YM3996 05059002
         USING ASCB,WORKREG             ASCB ADDRESSABILITY      YM3996 05062002
         MVC   TIOTMNR(K2),ASCBASID     MOVE ASID INTO ENQ MINOR YM3996 05065002
         DROP  WORKREG                                           YM3996 05068002
         MVC   MJELNAME(L'TIOTMJR),TIOTMJR  MAJOR RESOURCE NAME  Y02132 05074002
         MVC   ENQAREA(ENQLTH),ENQLIST  MOVE IN ENQ PARM LIST    Y02132 05078002
         ENQ   (MJELNAME,TIOTMNR),MF=(E,ENQAREA)  ISSUE ENQ      Y02132 05082002
*                                                                Y02132 05086002
         LTR   R15,R15                  TEST IF SUCCESSFUL ENQ   Y02132 05090002
         BNZ   DSABSRCH                 BRANCH IF NOT            Y02132 05094002
         OI    DSMADTB2,DSMTIOTE        SET TIOT ENQ'ED SWITCH   Y02144 05098002
         LA    R15,TIOTMNR              MINOR RESOURCE ADDRESS   Y02144 05102002
         ST    R15,DSMADTW2             SAVE MINOR RESOURCE ADDR Y02144 05106002
*                                                                       05110002
DSABSRCH EQU   *                        GET DSAB                 Y02132 05114002
         L     RDSAB,DSABQDB            GET DSAB QDB ADDR        Y02132 05118002
         USING QDB,RDSAB                QDB ADDRESSABILITY       Y02132 05122002
         L     RDSAB,QDBFELMP           GET PTR TO FIRST DSAB    Y02132 05126002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02132 05130002
VDSABTST EQU   *                        IS THERE ANOTHER DSAB    Y02132 05134002
         LTR   RDSAB,RDSAB              IS THERE ANOTHER DSAB    Y02132 05138002
         LA    RB,UCBSRCH               SET UP RETURN ADDRESS    YM5378 05142002
         BZ    DEQTEST1                 BRANCH IF NOT            Y02132 05146002
         L     R3,DSABTIOT              GET TIOT ADDRESS         Y02132 05150002
         USING TIOENTRY,R3              TIOT ADDRESSABILITY      Y02132 05154002
         L     RUCB,TIOEFSRT-K1         GET UCB ADDRESS          Y02132 05158002
         LA    RUCB,K0(RUCB)            CLEAR HIGH BYTE          Y02132 05162002
         LTR   RUCB,RUCB                IS THERE A UCB ADDRESS   Y02132 05166002
         BZ    TRYNEXT                  BRANCH IF NOT            Y02132 05170002
         TM    UCBJBNR,UCBVRDEV         TEST IF A VIRTUAL UCB    Y02132 05174002
         BZ    TRYNEXT                  BRANCH IF NOT            Y02132 05178002
         CLC   SRTEVOLI,K0(P3)          COMPARE VOL SER'S        Y02132 05182002
         BNE   TRYNEXT                  BRANCH IF NOT EQUAL      Y02132 05186002
         LR    R3,RUCB                  VDSCB ADDRESS            Y02132 05190002
         USING VDSCB,R3                 VDSCB ADDRESSABILITY     Y02132 05194002
         CLC   VDSDSCB(L'DS1DSNAM),K0(P2)  COMPARE DSNAME'S      Y02132 05198002
         BE    SCRTHTST                 BRANCH IF EQUAL          Y02132 05202002
TRYNEXT  EQU   *                        GET NEXT DSAB            Y02132 05206002
         L     RDSAB,DSABFCHN           GET NEXT DSAB ADDRESS    Y02132 05210002
         B     VDSABTST                 GO TEST IT               Y02132 05214002
*                                                                       05218002
SCRTHTST EQU   *                        IS VDSCB SCRATCHED       Y02132 05222002
         CLC   VDSABSTT,EXTCONST        TEST IF VDSCB SCRATCHED  Y02132 05226002
         BNE   VIOBTAIN                 BRANCH IF NOT SCRATCHED  Y02132 05230002
         LA    WORKREG,NOF1DSCB         NO F1 DSCB ERROR CODE    Y02132 05234002
         STH   WORKREG,ERCODE           SAVE ERROR CODE          Y02132 05238002
         B     DEQTEST                  GO DEQ FROM THE TIOT     Y02132 05242002
*                                                                       05246002
VIOBTAIN EQU   *                        OBTAIN VIO DATA SET DSCB Y02132 05250002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02132 05254002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02132 05258002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02132 05262002
         MVC   K0(VDATALN,RWKAREA),VDSDSCB+L'DS1DSNAM            Y02132 05266002
         XC    VDATALN(DATAL-VDATALN,RWKAREA),VDATALN(RWKAREA)   Y02132 05270002
*                                       CLEAR REST OF DATA AREA  Y02132 05274002
         XC    DATAL(CCHHRL,RWKAREA),DATAL(RWKAREA)              Y02132 05278002
*                                       CLEAR CCHHR AREA         Y02132 05282002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02132 05286002
         DROP  R1                                                Y02132 05290002
*                                                                       05294002
DEQTEST  EQU   *                        DEQ TIOT                 Y02132 05298002
         LA    RB,LEAVE                 SET UP RETURN ADDRESS    YM5378 05302002
DEQTEST1 EQU   *                        TEST IF TIOT ENQ'ED      Y02132 05306002
         TM    DSMADTB2,DSMTIOTE        TEST IF TIOT ENQ'ED      Y02132 05310002
         BCR   8,RB                     BRANCH IF NOT            YM5378 05314002
         MVC   ENQAREA(DEQLTH),DEQLIST  MOVE IN DEQ PARM LIST    Y02132 05318002
         DEQ   (MJELNAME,TIOTMNR),MF=(E,ENQAREA)  ISSUE DEQ      Y02132 05322002
*                                                                       05326002
         NI    DSMADTB2,X'FF'-DSMTIOTE  RESET TIOT ENQ'ED BIT    Y02144 05330002
         BR    RB                       RETURN                   YM5378 05334002
*                                                                       05346021
* THIS SECTION EXECUTES A CHANNEL PROGRAM.                              05352021
*                                                                       05360000
EXECIO   EQU   *                                                 S20201 05361002
         TM    UCBTBYT2,RPSMSK          DOES DEVICE HAVE RPS     S20201 05362002
         BZ    NORPS3                   NO, CONTINUE AS NORMAL   S20201 05363002
         LA    R2,THETA                 GET THETA ADDRESS        S20201 05364002
         XC    CCW2+FW(FW),CCW2+FW      CLEAR WORK WORD          S20201 05365002
         MVC   CCW2+FW(ONE),UCBTBYT4    GET DEVICE CODE          S20201 05366002
         O     R2,CCW2+FW               PUT IN HIGH BYTE         S20201 05367002
         L     R0,PARM0                 GET DDK FOR SCR          S20201 05368002
         IC    R0,SEEK+C7               GET RECORD NUMBER        S20201 05369002
         USING CVT,RCVT                 CVT ADDRESSABILITY       Y02080 05370002
         L     WORKREG,CVT0SCR1         GET ROUTINE ADDRESS      Y01077 05371000
         LR    R3,R9                    SAVE REGISTER            S20201 05372002
         STM   RWKAPTR,RETURN,IECREGSV+K12   SAVE REGISTERS 9-14 Y02080 05373002
         BALR  RETURN,WORKREG           GET SECTOR VALUE         S20201 05376002
         LM    RWKAPTR,RETURN,IECREGSV+K12-OBTNWKA(R3)  RESTORE  Y02080 05377002
NORPS3   EQU   *                                                 S20201 05381002
         EXCP  IOB                                               S20201 05382002
         WAIT  1,ECB=ECB                                                05400000
         TM    ECB,X'20'               TEST ECB FOR PERMANENT ERROR     05420000
         BZ    PERMERR                 BR IF ERROR                      05440000
         BR    RETURN                                                   05460000
*                                                                       05464002
* THIS SECTION READS THE FORMAT 4 DSCB AND ENSURES THAT THE USER'S      05468002
* CCHHR IS WITHIN THE EXTENTS OF THE VTOC.                              05472002
*                                                                       05480000
SEEKDSCB LM    R0,R5,CHANPROG          LOAD CCW1 TO CCW3 CONSTANTS      05500000
         AR    R0,RWKAPTR               RESOLVE ADDR IN CCW1.           05520000
         AR    R2,RWKAPTR               RESOLVE ADDR IN CCW10.          05540000
         AR    R4,RWKAPTR               RESOLVE ADDR IN CCW3     Y02078 05560002
         STM   R0,R5,CCW1              STORE CCW1 TO CCW3               05580000
         MVI   CCW3+4,X'00'            TURN OFF COMMAND CHAIN BIT       05600000
         BAL   RETURN,EXECIO           EXECUTE THE CHANNEL PROGRAM      05640000
         CLI   DS4IDFMT,F4             TEST FOR FORMAT 4 ID      Y02078 05660002
         BNE   PERMERR                 BRANCH IF NOT             Y02078 05720002
FIX      LA    R1,DEB                                                   05740000
         MVC   38(8,R1),DS4VTOCE+2     MOVE EXTENTS OF VTOC INTO DEB    05760000
         L     WORKREG,4(0,PL)         LOAD ADDR OF DATA SET CCHHR      05780000
         CLC   0(4,WORKREG),DS4VTOCE+2 CHECK FOR EXTENT WITHIN @ZA17992 05782037
         BC    4,ERROR20                VTOC                   @ZA17992 05784037
         CLC   0(4,WORKREG),DS4VTOCE+6  CHECK ABSOLUTE TRACK ADDR 13395 05786016
         BC    2,ERROR20               BRANCH IF OUT OF VTOC EXT  13395 05792016
         CLC   SEEK+K3(CCHHRL),0(WORKREG) CHECK IF F4 WANTED     YM8538 05793002
         BNE   READF1                   BRANCH TO READ F1 DSCB   YM8538 05795002
         MVC   DS1DSNAM,F4NAME          FORMAT 4 DSNAME          YM8538 05796002
         MVC   DS1FMTID(L'F4DSCB),F4DSCB F4 DSCB TO RETURN AREA  YM8538 05797002
         B     RETPARM2                 RETURN TO CALLER         YM8538 05799002
*                                                                YM8538 05799202
READF1   EQU   *                        READ FORMAT 1 DSCB       YM8538 05799402
*                                                                YM8538 05799602
         MVC   SEEK+3(5),0(WORKREG)    MOVE DATA SET CCHHR TO IOS SEEK  05800000
         LM    R0,R1,CHALPROG          LOAD CCW3 CONSTANT               05820000
         AR    R0,RWKAPTR              RESOLVE ADDR IN CCW3      Y02078 05840002
*                                                                       05842000
* THIS SECTION RELOCATES AND EXECUTES THE SEEK OPTION CHANNEL PROGRAM.  05846021
*                                                                       05852021
         STM   R0,R1,CCW3              STORE CCW3                       05860000
         BAL   RETURN,EXECIO           EXECUTE THE CHANNEL PROGRAM      05900000
*                                                                YM8538 05901002
RETPARM2 EQU   *                        RETURN PARMS TO CALLER   YM8538 05901202
*                                                                YM8538 05901402
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 05902002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 05904002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 05906002
         MVC   K0(L'OBTDSCB,RWKAREA),OBTDSCB  MOVE IN DSCB       Y02078 05910002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 05920002
         DROP  R1                                                Y02078 05930002
         B     LEAVE                                                    05960000
ERROR20  EQU   *                                                  13395 05965016
         LA    WORKREG,20              CCHH OUT OF VTOC EXTENT    13395 05970016
         B     SETCODE                 BRANCH TO RETURN           13395 05975016
*                                                                       05980000
*** PROGRAM CONSTANTS                                                   06000000
*                                                                       06020000
CSYS     DC    CL3'SYS'                 CONSTANT OF 'SYS'        Y02132 06021002
CDOTT    DC    CL2'.T'                  CONSTANT OF '.T'         Y02132 06022002
CDOTR    DC    CL2'.R'                  CONSTANT OF '.R'         Y02132 06023002
BLANKS   DC    CL6' '                   SIX EBCDIC BLANKS        Y02132 06024002
F4NAME   DC    0XL44'04',44X'04'        FORMAT 4 DSNAME          YM8549 06025002
DEQLIST  DEQ   (,,6,SYSTEM),MF=L        DEQ PARAMETER LIST       YM5902 06026002
DEQLTH   EQU   *-DEQLIST                LENGTH OF DEQ PARM LIST  Y02132 06027002
TIOTMJR  DC    CL8'SYSZTIOT'            TIOT MAJOR RESOURCE NAME Y02132 06028002
ENQLIST  ENQ   (,,S,6,SYSTEM),RET=HAVE,MF=L  ENQ PARAMETER LIST  Y02132 06031002
ENQLTH   EQU   *-ENQLIST                LENGTH OF ENQ PARM LIST  Y02132 06032002
EXTCONST DC    X'FFFFFFFF7FFF'         LAST CCHH AND NUM OF TKS         06040000
RPSCCW   DS    0F                       SET SECTOR COMMAND       S20201 06042002
         DC    X'23'                    COMMAND CODE             S20201 06044002
         DC    X'000000'                ADDR                     S20201 06046002
         DC    X'4000'                  FLAGS                    S20201 06048002
         DC    H'1'                     COUNT                    S20201 06050002
PARM0    DS    0F                       AREA TO BUILD PARAMETERS S20201 06052002
DD       DC    X'0060'                  DATA LENGTH              S20201 06054002
K        DC    X'2C'                    KEY  LENGTH              S20201 06056002
R        DC    X'0'                     RECORD NUMBER            S20201 06058002
*                                                                       06060000
*** THE FOLLOWING CHANNEL PROGRAM SEARCHES THE VTOC FOR THE NAMED DSCB. 06080000
*** THE NAMED DSCB IS READ INTO THE INPUT AREA.                         06100000
*                                                                       06120000
CHANPROG DS    0F                                                       06140000
*CCW1                                                                   06160000
         DC    X'31'                   SEARCH EQUAL ID (SEEK+3)         06180000
         DC    AL3(3+SEEK-OBTNWKA)     SEEK ADDR                 Y02080 06200002
         DC    X'4000'                                                  06220000
         DC    H'5'                                                     06240000
*CCW2                                                                   06260000
         DC    X'08'                   TIC TO CCW1                      06280000
         DC    AL3(0+CCW1-OBTNWKA)     TIC TO ADDR               Y02080 06300002
         DC    F'0'                                                     06320000
*CCW3                                                                   06340000
         DC    X'06'                    READ DATA OF F4 DSCB     Y02078 06360002
         DC    AL3(0+F4DSCB-OBTNWKA)    DATA ADDR                Y02078 06380002
         DC    X'4000'                                                  06400000
         DC    H'96'                                                    06420000
*CCW4                                                                   06440000
         DC    X'F1'                    SEARCH HI OR EQ LST FMT1.       06460000
         DC    AL3(0+DS4HPCHR-OBTNWKA)  SEARCH ADDR              Y02078 06480002
         DC    X'4000'                                                  06500000
         DC    H'5'                                                     06520000
*CCW5                                   TO BE CONSTRUCTED               06540000
*                                       TIC TO CCW9                     06560000
*CCW6                                   TO BE CONSTRUCTED               06580000
*                                       SEARCH EQUAL KEY (DS NAME)      06600000
*CCW7                                   TO BE CONSTRUCTED               06620000
*                                       READ DATA OF THE LAST   SA48172 06622002
*                                       FORMAT 1 WITH THE SKIP  SA48172 06624002
*                                       BIT SET IN ORDER TO END SA48172 06626002
*                                       THE CHANNEL PROGRAM     SA48172 06628002
*CCW8                                   TO BE CONSTRUCTED               06660000
*                                       TIC TO CCW11                    06680000
*CCW9                                                                   06700000
         DC    X'29'                   SEARCH EQUAL KEY (DS NAME)       06720000
         DC    AL3(0)                                                   06740000
         DC    X'6000'                                                  06760000
         DC    H'44'                                                    06780000
*CCW10                                                                  06800000
         DC    X'08'                   TIC TO CCW4                      06820000
         DC    AL3(0+CCW4-OBTNWKA)     TIC TO ADDR               Y02078 06840002
         DC    F'0'                                                     06860000
*CCW11                                                                  06880000
         DC    X'06'                    READ DATA OF F1 DSCB     Y02078 06900002
         DC    AL3(DS1FMTID-OBTNWKA)    DATA ADDR                Y02078 06920002
         DC    X'4000'                                                  06940000
         DC    H'96'                                                    06960000
*CCW12                                                                  06980000
         DC    X'12'                   READ COUNT (NEWCCHHR)            07000000
         DC    AL3(0+NEWCCHHR-OBTNWKA) DATA ADDR                 Y02078 07020002
         DC    X'2000'                                                  07040000
         DC    H'5'                                                     07060000
*                                                                       07080000
*** THE FOLLOWING CHANNEL PROGRAM SEARCHES A TRACK AND READS A DSCB     07100000
*** INTO THE INPUT AREA.                                                07120000
*                                                                       07140000
CHALPROG DS    0F                                                       07160000
*CCW1                                   TO BE CONSTRUCTED               07180000
*                                       SEARCH EQUAL ID (SEEK+3)        07200000
*CCW2                                   TO BE CONSTRUCTED               07220000
*                                       TIC TO CCW1                     07240000
*CCW3                                                                   07260000
         DC    X'0E'                    READ KEY & DATA OF DSCB  Y02078 07280002
         DC    AL3(OBTDSCB-OBTNWKA)     DATA ADDR                Y02078 07300002
         DC    X'0000'                                                  07320000
         DC    H'140'                                                   07340000
*                                                                       07350002
* TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                       07360002
*                                                                       07370002
         XCTLTABL ID=(FIRSTLD,IGC0002G,VSAMMOD,IGC0102G),        Y02080X07380002
               SVC=027,LENGTH=,BRT=YES                           Y02080 07390002
         SPACE 2                                                 Y02080 07400002
         IECDSECS CVT,DSAB,JSCB,QDB,PSA,RB,RRPL,TCB,TIOT,UCB,    Y02132X07410002
               ASCB,                                             YM3996X07413002
               EXPAND=YES                                        Y02132 07420002
WORKAREA IECOBTWA EP,F4,D1=(1),ADT=YES  OBTAIN WORK AREA         Y02144 07500002
         EJECT                                                   Y02132 07550002
         IDDVDSCB                       VDSCB MAPPING MACRO      Y02132 07600002
         END                                                            08080000
./  ADD  SSI=72590400,NAME=IGC0002I
 TITLE 'IGC0002I - DADSM SCRATCH - ENTRY POINT'                         00020000
IGC0002I CSECT                                                   A53147 00023002
*                                                                       00026020
*          VS1 RELEASE 02 DELETIONS                                     00028402
*0000                                                           OX00362 00028802
*          RELEASE 18 DELETIONS                                         00029020
*1652026800                                                       21421 00032018
*1652                                                             MCS   00035018
*          RELEASE 19 DELETIONS                                         00038018
*          RELEASE 20 DELETIONS                                         00044018
*0953020200,055200,064200                                        S20201 00045020
*0953025400,026200,026400,060800,061700-062000                   A33080 00047020
*0953                                                            M0688  00048020
*0953000100,000260,002400-003800,004400,005400-005600,008400-    M1889  00048620
*0953008800,013400-015000,026430-026600,072800,074400            M1889  00049220
*          RELEASE 21 DELETIONS                                         00050018
*1198004400-004600,014100,015800,086000-086600                   A37199 00051021
*1198                                                            A42478 00053021
*0000023200                                                     SA49351 00055021
*          RELEASE 21.7 DELETIONS                                       00055102
*0000000230,001600,020062,020068-020086,020092,020400-020600,    A53147 00055202
*0000040000,054800-055050,055080-055190,055500,063600-064120,    A53147 00055302
*0000066900,067200-069200,071600-074320                          A53147 00055402
*0000021800-021900,026010,026210,026350,028800-029400,029420,   SA56369 00055502
*0000021800-021900,026010,026210,026350,028800-029400,029420,   SA56369 00055602
*0000029550-029700,030000-030600,031400-031905,031920,031930,   SA56369 00055702
*0000031945,031960-031975,060500,063200,074440,081800-083000,   SA56369 00055802
*0000085600-085800,087400-087800                                SA56369 00055902
*0000021000,026020-026350,056000                                SA57158 00056002
*0000061100                                                     SA57621 00056102
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00062002
*0000000280,000289,000620-000800,001000,001400-001600,004800-    Y02080 00062102
*0000005000,006200-006400,006800-007000,008400-008600,013200-    Y02080 00062202
*0000013500,014100-014400,015400,019100,020050-020051,020078-    Y02080 00062302
*0000020085,020092,020150-020216,021200,021980-022120,022160-    Y02080 00062402
*0000023200,023600-023800,025100-025200,025600-025800,026208-    Y02080 00062502
*0000026220,026227-026276,026282-026284,026290-026292,026294-    Y02080 00062602
*0000026590,026653,026716,028670-028830,029500-029550,031910-    Y02080 00062702
*0000031955,031985,032400,032800,047000-054600,055060,055200-    Y02080 00062802
*0000055600,055800,056200,057410-057510,060400,060520-060580,    Y02080 00062902
*0000062300,063900,064250-065400,066033-066066,066200-066800,    Y02080 00063002
*0000070400,071500-088200                                        Y02080 00063102
*0000000030-000150                                               Y02078 00063202
*0000001600-003400,005200-007800,008200-009800,012900-013700,    Y02082 00063302
*0000014100-015600,020053-020100,021940,026240,026370-026390,    Y02082 00063402
*0000026603-028660,028870,030000-030200,032000,032600-060200,    Y02082 00063502
*0000063400-064200                                               Y02082 00063602
*0000                                                            Y02144 00063802
*0000027170,067000-067200                                        Y02132 00064002
*0000026390                                                      YM1312 00064102
*0000                                                            YM1241 00064202
*0000033700,034300,036820-036825,036840,036850,064990-065000     YM1337 00064302
*0000026730-026770,026870-026930,028170,038900,068100-068200,    YM1063 00064402
*0000071800-072000                                               YM1063 00064502
*0000035300                                                      YM3960 00064602
*0000025300-025500                                               YM5399 00065002
*0000024120-024140                                               YM5748 00065402
*0000028900,029020,039400,040800                                 YM7036 00065502
*0000034300,035300,036770,067900                                 YM2880 00066702
*0000                                                            YM2887 00066802
*0000                                                            YM6992 00066902
*0000065280                                                      YM7831 00067002
*                                                                       00080002
*0000    EXTENDED MVS CVOL SUPPORT                             @Z40CSRC 00080537
*                                                                       00081002
*        SU60 ADDITIONS/DELETIONS                              @G60ASBJ 00081260
*A 020116,021700,023200,023280-123340                          @G60ASBJ 00081460
*C 000842,001400,004400,023240                                 @G60ASBJ 00081660
*D 004600                                                      @G60ASBJ 00082060
*                                                              @G60ASBJ 00082460
*MODULE NAME - IGC0002I                                                 00082860
*                                                                       00083260
*DESCRIPTIVE NAME - DADSM SCRATCH                              @G60ASBJ 00083660
*                                                                       00085002
*COPYRIGHT - NONE                                                       00086002
*                                                                       00087002
*CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD           00088002
*                                                                       00089002
*STATUS CHANGE LEVEL 007                                                00090021
*                                                                       00092002
*ATTRIBUTES - REENTRANT                                                 00100002
*                                                                       00120000
*FUNCTION - THIS MODULE IS THE  BEGINNING  OF  SCRATCH. IT FIRST        00140060
*          OBTAINS THE SCRATCH WORK AREA.  THEN IT ISSUES AN ENQ        00144002
*          ON THE TIOT (UNLESS THE TIOT WAS ALREADY ENQ'ED UPON BY      00148002
*          DYNAMIC DELLOCATION).  IF THIS RESOURCE IS UNAVAILABLE,      00152002
*          THE DATA SET IS IN THE PROCESS OF BEING OPENED OR CLOSED     00156002
*          AND THEREFORE CANNOT BE SCRATCHED.                           00160002
*          THIS MODULE THEN ATTEMPTS TO FIND A PRIMARY (DEMOUNTABLE)    00164002
*          UCB ADDRESS.  IF A UCB ADDRESS WAS SUPPLIED BY THE CALLER,   00168002
*          THE TIOT IS SEARCHED TO SEE IF THE UNIT IS ALLOCATED TO      00172002
*          THE JOB.  IF ALLOCATED, THE UNIT IS TESTED TO DETERMINE      00176002
*          IF ITS ASSOCIATED VOLUME CAN BE DEMOUNTED.  IF NO UCB        00180002
*          ADDRESS WAS SUPPLIED OR IF THE SUPPLIED ADDRESS IS EITHER    00184002
*          NOT ALLOCATED OR NOT DEMOUNTABLE, THE TIOT IS SEARCHED TO    00188002
*          SEE IF ANY VOLUME IN THE VOLUME LIST IS MOUNTED ON A UNIT    00192002
*          ALLOCATED TO THE JOB.  IF A VOLUME IS MOUNTED, ITS UCB IS    00196002
*          TESTED FOR DEMOUNTABILITY.  IF A UCB IS FOUND THAT IS BOTH   00200002
*          ALLOCATED AND DEMOUNTABLE, IT BECOMES THE PRIMARY UCB.       00204002
*          BEFORE BRANCHING TO THE NEXT LOAD OF SCRATCH, THIS MODULE    00208002
*          ISSUES AN ENQ ON THE DATA SET NAME.  IF THE RETURN CODE      00212002
*          INDICATES THAT THE TASK PREVIOUSLY HAD CONTROL OF THE        00216002
*          RESOURCE, THE ENQ IS REISSUED TO OBTAIN EXCLUSIVE CONTROL    00220002
*          AND A BIT IS SET TO INDICATE A DEB SEARCH MUST BE DONE       00224002
*          IN MODULE IGG0290A TO ENSURE NO ONE IS CURRENTLY OPEN TO     00228002
*          THE DATA SET.  IF THE RETURN CODE FROM EITHER ENQ INDICATES  00232002
*          THAT THE RESOURCE IS UNAVAILABLE, THE DATA SET IS OPEN AND   00236002
*          THEREFORE CANNOT BE SCRATCHED.                               00240002
*          FOR A POSSIBLE VIO DATA SET, THE MODULE SEARCHES THE DSAB    00250002
*          CHAIN FOR A TIOT ENTRY CONTAINING A VIRTUAL UCB WHOSE        00260002
*          VDSDSCB CONTAINS THE DATA SET NAME BEING SCRATCHED AND       00270002
*          WHOSE VOLUME SERIAL NUMBER IN THE VDSUCB MATCHES THE FIRST   00280002
*          VOLUME SERIAL IN THE VOLUME LIST.  IF A DSNAME/VOL SER       00290002
*          MATCH IS FOUND, IT ISSUES VSCRATCH (IF THE DATA SET HAD      00300002
*          BEEN OPENED) AND ZEROS THE DATA PORTION OF THE VDSDSCB.      00310002
*                                                                       00400000
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGC0002I. ENTRY IS    00420000
*          MADE FROM IGG029DU.                                @G60ASBJ  00440060
*                                                                       00480002
*SUPERVISOR CALLS AND EXTERNAL ROUTINES USED BY THIS MODULE -           00500002
*          ENQ(56)  - ENQ'S ON SYSZTIOT AND SYSDSN                      00520002
*          TESTAUTH - DETERMINES IF THE CALLER IS AUTHORIZED,           00540002
*                     IN SUPERVISOR STATE, OR IN KEY ZERO               00560002
*          SETLOCK  - OBTAINS/RELEASES THE LOCAL MEMORY LOCK            00580002
*          MODESET  - SWITCHES TO THE CALLER'S KEY                      00600002
*          IEC0VL00 - CHECKS THE VALIDITY OF THE VOLUME LIST ADDRESS    00620002
*          VSCRATCH - DELETES VBP CONTROL BLOCKS, FREES PAGING SPACE    00630002
*          IECRES   - OBTAINS THE WORK AREA                             00640002
*                   - BRANCHES TO OTHER SCRATCH MODULES                 00660002
*                                                                       00680002
*OTHER MACROS ISSUED -                                                  00700002
*          IDDVDSCB - EXPANDS THE VDSCB                                 00710002
*          IECDSECS - EXPANDS THE CVT, DSAB, JSCB, PSA, QDB, RB,        00720002
*                     RRPL, TIOT, TCB, AND UCB DSECTS                   00740002
*          IECSCRWA - EXPANDS THE SCRATCH WORK AREA                     00760002
*          XCTLTABL - BUILDS A LIST OF MODULE NAMES AND ADDRESSES       00780002
*                                                                       00800000
*INPUT -   AT ENTRY TO THIS MODULE REGISTER 1 POINTS TO THE PARAMETER   00820002
*          LIST.  REGISTER 0 MAY POINT TO A UCB, OR IT MAY CONTAIN NO   00840002
*          ADDRESS. THE PARAMETER LIST CONSISTS OF 4 WORDS:             00860002
*          WORD 1 - CHECK PURGE DATE = X'41004000'                      00870002
*                 - OVERRIDE PURGE DATE = X'41005000'                   00874002
*                   BIT 0 OF THE 2ND OPTION BYTE IS SET BY DYNAMIC      00878002
*                   UNALLOCATION AND BY JOB AND STEP TERMINATION        00882002
*                   TO INDICATE NOT TO INVOKE DYNAMIC ALLOCATION.       00886002
*                   BIT 0 OF THE THIRD OPTION BYTE IS SET BY            00890002
*                   DYNAMIC UNALLOCATION TO INDICATE THAT THE           00894002
*                   TIOT HAS ALREADY BEEN ENQ'ED.                       00898002
*          WORD 2 - ADDRESS OF THE DATA SET NAME                        00910002
*                   IF BIT 0 IS SET, ENTRY IS FROM JOB TERMINATION      00920002
*                   OR FROM STEP TERMINATION.  IF BIT 1 IS SET, ENTRY   00930002
*                   IS FROM THE READER OR WRITER.                       00940002
*          WORD 3 - NOT USED                                            00950002
*          WORD 4 - ADDRESS OF THE VOLUME LIST                          00960002
*          THE VOLUME LIST IS VARIABLE IN LENGTH. THE FIRST TWO BYTES   01000000
*          INDICATE THE NUMBER OF 12 BYTE VOLUME ID FIELDS WHICH        01020000
*          FOLLOW. A 12 BYTE VOLUME ID FIELD CONTAINS A FOUR BYTE       01040000
*          DEVICE CODE, SIX BYTE VOLUME SERIAL NUMBER, ONE BYTE SPARE,  01060000
*          AND ONE BYTE USED FOR RETURNING THE STATUS OF THE DATA SET   01080000
*          ON THAT VOLUME AS FOLLOWS:                                   01100000
*                    BINARY 0 - SUCCESSFUL SCRATCH                      01120000
*                    BINARY 1 - DSCB NOT FOUND IN VTOC                  01140000
*                    BINARY 2 - PASSWORD DIFFICULITY                    01160000
*                    BINARY 3 - UNEXPIRED PURGE DATE                    01180000
*                    BINARY 4 - PERMANENT I/O ERROR                     01200000
*                    BINARY 5 - APPROPRIATE UCB UNAVAILABLE             01220000
*                    BINARY 6 - OPERATOR UNABLE TO MOUNT VOLUME         01240000
*                    BINARY 7 - DATA SET IS OPEN                        01250002
*                                                                       01260000
*OUTPUT -  WHEN CONTROL IS TRANSFERED TO THE NEXT MODULE, REGISTER 13   01290002
*          POINTS TO THE WORK AREA, WHICH CONTAINS THE ADDRESS OF A     01320002
*          PRIMARY UCB IN 'PRUCBPTR' (IF ONE IS AVAILABLE).  ALSO,      01330002
*          'VOLNUM' CONTAINS THE NUMBER OF VOLUMES IN THE VOLUME        01340002
*          LIST, AND 'VOLPTR' CONTAINS THE ADDRESS OF THE FIRST ENTRY   01350002
*          IN THE VOLUME LIST.  REGISTER 9 POINTS TO THE CVT, AND       01360002
*          REGISTER 10 POINTS TO THE INPUT PARAMETER LIST.              01370002
*                                                                       01380020
*ERROR CONDITIONS - UPON RETURN TO THE CALLER, REGISTER 15 CONTAINS     01390002
*          ONE OF THE FOLLOWING VALUES TO INDICATED THE COMPLETION      01400002
*          STATUS OF THE SCRATCH FUNCTION:                              01410002
*          00 - SUCCESSFUL COMPLETION                                   01420002
*          04 - NO UNIT AVAILABLE FOR MOUNTING ANY OF THE VOLUMES IN    01430002
*               THE VOLUME LIST.  THE STATUS BYTE OF EVERY ENTRY IN     01440002
*               THE VOLUME LIST IS SET TO X'05'.                        01450002
*          08 - UNABLE TO SCRATCH ON ONE OR MORE VOLUMES.  THIS CODE    01460002
*               IS ACCOMPANIED BY A SETTING OF THE STATUS BYTE OF       01470002
*               EACH VOLUME LIST ENTRY AS DESCRIBED UNDER 'INPUT'.      01480002
*          12 - THE NUMBER OF VOLUMES IN THE VOLUME LIST WAS ZERO,      01490002
*               OR THE VOLUME LIST WAS NOT IN THE USER'S REGION.        01500002
*                                                                       01510002
*STORAGE - PROGRAM CODE = LESS THAN 2048 BYTES                          01520002
*          WORK AREA = 896 BYTES                                        01530002
*                                                                       01540002
*ERROR CONDITIONS IN THIS MODULE - THE NUMBER OF VOLUMES IN THE VOLUME  01550002
*          LIST IS ZERO, THE VOLUME LIST ADDRESS IS NOT IN THE USER'S   01560002
*          REGION, THE DATA SET IS CURRENTLY OPEN, OR THE VIO DSCB      01570002
*          CANNOT BE FOUND.                                             01580002
*                                                                       01590002
*                                                                       01600000
*REGISTER USAGE:                                                        01620000
R0       EQU   0                                                        01640000
R1       EQU   1                                                        01660000
RUCBSAVE EQU   1                        CALLER'S UCB ADDRESS     Y02082 01670002
R2       EQU   2                                                        01680000
RDSAB    EQU   2                        POINTER TO THE DSAB      Y02082 01690002
R3       EQU   3                                                        01700000
RTIOT    EQU   3                        POINTER TO THE TIOT      Y02082 01710002
P1       EQU   3                                                        01720000
REND     EQU   4                        POINTER TO END OF ENTRY  Y02082 01730002
R4       EQU   4                                                        01740000
P2       EQU   4                                                        01760000
R5       EQU   5                                                        01780000
VOLCTR   EQU   5                                                        01800000
P4       EQU   6                                                        01820000
R7       EQU   7                                                        01826013
R8       EQU   8                                                        01832013
VOLISTX  EQU   8                                                        01840000
SVRBREG  EQU   8                        SVRB ADDRESS             Y02080 01850002
R9       EQU   9                                                        01860000
RCVT     EQU   9                                                        01880000
PL       EQU   10                                                       01900000
RUCB     EQU   11                                                       01920000
RBASE    EQU   12                                                       01940000
RWKAREA  EQU   13                                                       01960000
RETURN   EQU   14                                                       01980000
R15      EQU   15                       EQUATE FOR REGISTER 15   Y02080 01990002
WORKREG  EQU   15                                                       02000000
*                                                                       02001020
*OTHER EQUATES                                                          02002020
*                                                                       02003020
K0       EQU   0                        CONSTANT OF ZERO         Y02082 02004002
K1       EQU   1                        CONSTANT OF 1            Y02082 02005002
C1       EQU   1                        CONSTANT OF 1            S20201 02006002
K2       EQU   2                        CONSTANT OF 2            Y02082 02007002
K3       EQU   3                        CONSTANT OF 3            Y02082 02009002
K8       EQU   8                        CONSTANT OF 8            Y02132 02009202
K4       EQU   4                        CONSTAND OF 4            Y02082 02010002
NONZERO  EQU   4                        NON-ZERO VALUE           YM1312 02010502
K12      EQU   12                       CONSTANT OF 12           Y02082 02011002
K16      EQU   16                       CONSTANT OF 16           Y02132 02011202
K44      EQU   44                       CONSTANT OF 44         @G60ASBJ 02011660
APD      EQU   29                       DISP. TO APPG PTR IN DEB Y02082 02012002
RTNCODE8 EQU   8                        RETURN CODE OF 8         Y02082 02013002
BADLIST  EQU   12                       BAD VOL LIST ERROR CODE  Y02082 02014002
VOLSER   EQU   4                        OFFSET TO VOLUME SERIAL  Y02082 02015002
*                                       IN A VOLUME LIST ENTRY   Y02082 02016002
STATUS   EQU   11                       OFFSET TO VOLIST STATUS  Y02082 02017002
ENTRYL   EQU   12                       VOLIST ENTRY LENGTH      Y02082 02018002
VDATALN  EQU   81                       VDSDSCB DATA LENGTH      Y02132 02018802
DYNUNALL EQU   X'80'                    DYNAMIC UNALLOCATION BIT Y02082 02019002
OPENDS   EQU   X'07'                    OPEN DATA SET ERROR CODE Y02082 02020002
NOF1     EQU   X'01'                    NO F1 DSCB ERROR CODE    Y02132 02021002
IOERR    EQU   X'04'                    VSCRATCH (I/O) ERR CODE  YM6992 02021202
BLANK    EQU   C' '                     EBCDIC BLANK             YM2880 02022002
OFF      EQU   X'FF'                    MASK TO RESET SWITCHES @Z40CSRC 02023037
*                                                                       02025021
         BALR  RBASE,R0                                                 02080000
         USING *,RBASE                                          SA57158 02100002
         USING SCRTHWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 02120002
         USING UCB,RUCB                                                 02140000
         USING CVT,RCVT                                                 02160000
         USING RBBASIC,SVRBREG          SVRB ADDRESSABILITY    @G60ASBJ 02170060
*                                                                       02192021
* THIS SECTION OBTAINS THE SCRATCH WORK AREA.                           02194002
*                                                                       02196021
BEGIN    EQU   *                                                 Y01077 02214000
         LPR   PL,R1                    SAVE PARAMETER LIST PTR  Y02080 02240002
         LR    RUCB,R0                  SAVE POSSIBLE UCB ADDR   Y02080 02250002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02080 02260002
         L     SVRBREG,0(R4)            LOAD SVRB ADDRESS        Y02080 02300002
         ST    RETURN,RBEXSAVE+K44      SAVE REGISTER 14       @G60ASBJ 02320060
         IECRES GET,PREFIX=FIRST,LV=SWALNGTH,ID=SCWA,            Y02080X02322060
               STM=(R2,RBASE,RBEXSAVE)  OBTAIN WORK AREA       @G60ASBJ 02324060
         LR    RWKAREA,R1               LOAD BASE REG FOR WORK AREA     02326060
         L     RETURN,RBEXSAVE+K44      RESTORE REGISTER 14    @G60ASBJ 02328060
         ST    RETURN,SCRSAVE           SAVE R14 IN SCRATCH    @G60ASBJX02330060
                                        WORKAREA               @G60ASBJ 02332060
         DROP SVRBREG                                          @G60ASBJ 02334060
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO AFTER Y02082X02344002
                                        ISSUING THE IECRES GET   Y02082 02348002
*                                                                       02352002
         IECRES LOAD,MODNM=LOAD1,EXTPR=(RWKAREA),BRANCH=NO       Y02080X02356002
                                        LET OPTIONAL TRACE PRINT Y02080X02360002
                                        THIS MODULE'S NAME       Y02080 02364002
*                                                                       02368002
         L     R1,IECRRPRM              RECOVERY RTN LIST ADDR   Y02144 02372002
         USING RRPLIST,R1               PARM LIST ADDRESSABILITY Y02144 02376002
         OI    RRFUNCTN,RRFSCRTH        SET SCRATCH FUNCTION BIT Y02144 02380002
         DROP  R1                                                Y02144 02384002
*                                                                       02388002
         ST    R4,TCBADDR               SAVE INPUT TCB POINTER   Y02078 02392002
         ST    PL,OLDPLPTR              STORE PARAMETER LIST POINTER    02400000
         OI    SISW1,NOSMFRCD           SET NO SMF RECORD SWITCH YM5399X02402002
                                        UNTIL AT LEAST ONE       YM5399X02404002
                                        SCRATCH IS SUCCESSFUL    YM5399 02406002
         L     P1,K12(,PL)              LOAD ADDRESS OF VOL LIST YM5399 02407002
         LRA   P1,K0(,P1)               LOAD REAL ADDRESS OF     YM5399X02408002
                                        VOLUME LIST              YM5399 02410002
         BC    5,ERREXIT                BR IF INVALID (INVALID   YM5748 02412002
*                                       SEGMENT TABLE ENTRY OR   YM5748 02414002
*                                       INVALID SEGMENT OR PAGE  YM5399 02416002
*                                       TABLE LENGTH)            YM5399 02418002
         LM    P1,P4,0(PL)              LOAD PARAMETER LIST             02420000
*                                            P1 = SCRATCH OPTIONS       02440000
*                                            P2 = DATA SET NAME ADDR    02460000
*                                            P3 = SPARE                 02480000
*                                            P4 = VOLUME LIST ADDR      02500000
         MVC   PDSNAME,K0(P2)           SAVE DSNAME IN PROTECTED YM1337 02505002
*                                       WORK AREA                YM1337 02510002
         LA    P2,PDSNAME               GET ADDR OF PROTECTED    YM1337 02515002
*                                       DSNAME                   YM1337 02516002
         ST    P2,DSMADTW3              SAVE ADDRESS OF DSNAME   Y02144 02520002
         MVC   VOLNUM,0(P4)             MOVE NUMBER OF VOLUMES   Y02080 02560002
         LH    VOLCTR,VOLNUM            LOAD NBR OF VOLS IN LIST Y02080 02580002
         LTR   VOLCTR,VOLCTR            IS LIST EMPTY                   02600000
         BNP   ERREXIT                  BRANCH IF YES           SA56369 02601002
*                                                                       02603002
* THIS SECTION CHECKS IF THE VOLUME LIST ADDRESS IS WITHIN THE USER'S   02605002
* REGION.  IF THE CALLER IS IN SUPERVISOR STATE OR IN KEY ZERO, THEN    02607002
* THE VOLUME LIST ADDRESS DOES NOT HAVE TO BE CHECKED.                  02609002
*                                                                       02611002
VALCK    EQU   *                                                SA57158 02622602
         TESTAUTH FCTN=1,KEY=YES,STATE=YES,BRANCH=YES  TEST IF   Y02080X02624002
                                        CALLER IS IN KEY 0 OR    Y02080X02625002
                                        IN SUPERVISOR STATE      Y02080 02626002
         LTR   R15,R15                  TEST IF ANY TRUE         Y02080 02627002
         BZ    BYPASS                   BRANCH IF YES           SA57158 02627702
*                                                                       02627802
* THIS SECTION CALCULATES THE STARTING AND ENDING ADDRESSES OF          02627902
* THE AREA TO BE CHECKED                                                02628002
*                                                                       02628102
         MH    VOLCTR,TWELVE            12 TIMES NUMBER OF      SA57158 02628702
*                                       VOLUMES                 SA57158 02628802
         LA    VOLCTR,C1(VOLCTR)        ADD ONE                 SA57158 02628902
         LA    R1,0(P4)                 RELOAD VOLIST ADDRESS    Y02080 02629002
         LR    R2,R1                    GET STARTING ADDRESS     Y02080 02629102
         AR    R2,VOLCTR                GET ADDRESS OF LAST      Y02080 02629202
*                                       BYTE OF VOLIST          SA57158 02629302
         STM   RUCB,P1,IECREGSV+K12     SAVE REGISTERS 11-3      Y02080 02630002
         LR    R7,RWKAREA               SAVE WORK AREA ADDRESS   Y02080 02631002
         XR    R5,R5                    INITIALIZE REGISTER      YM1241 02631502
OBTNLOCK SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02080X02632002
               RELATED=(LOCAL,IGC0002I(RLSELOCK))  OBTAIN LOCK   Y02080 02633002
         LM    RUCB,RETURN,IECREGSV+K12-SCRTHWKA(R7)  RESTORE    Y02080 02634002
         L     R4,TCBADDR               TCB ADDRESS IN REG 4     Y02078 02635002
         L     R15,CVT0VL00             VALIDITY CHECK RTN ADDR  Y02080 02637002
         BALR  RETURN,R15               LINK TO VALIDITY CHECK   Y02080 02638002
         BZ    RLSELOCK                 BRANCH IF VALID ADDRESS  YM1312 02638502
         LA    R5,NONZERO               INDICATE INVALID ADDRESS YM1312 02639002
*                                                                       02639502
RLSELOCK SETLOCK RELEASE,TYPE=LOCAL,                             Y02080X02640002
               RELATED=(LOCAL,IGC0002I(OBTNLOCK))  RELEASE LOCK  Y02080 02641002
         LM    RUCB,P1,IECREGSV+K12-SCRTHWKA(R7)  RESTORE REGS   Y02080 02642002
         LTR   R5,R5                    TEST IF ADDRESS VALID    Y02080 02643002
         BNZ   ERREXIT                  BRANCH IF NOT VALID      Y02080 02644002
         LH    VOLCTR,VOLNUM            GET VOLUME COUNT         Y02080 02645002
*                                                                       02647002
* THIS SECTION ATTEMPTS TO ENQ ON THE TIOT, UNLESS SCRATCH HAS BEEN     02649002
* CALLED BY DYNAMIC UNALLOCATION (IF THE CALLER IS IN KEY ZERO AND BIT  02651002
* 0 OF OPTION BYTE 3 OF THE FIRST WORD OF THE PARAMETER LIST IS SET).   02653002
*                                                                       02655002
BYPASS   EQU   *                        ENQ ON THE TIOT          Y02082 02657002
         L     RDSAB,TCBADDR            LOAD TCB ADDRESS         Y02082 02659002
         USING TCB,RDSAB                TCB ADDRESSABILITY       Y02082 02661002
         L     RDSAB,TCBJSCB            GET JSCB ADDRESS         Y02082 02663002
         USING IEZJSCB,RDSAB            JSCB ADDRESSABILITY      Y02082 02665002
         L     RDSAB,JSCBACT            GET ACTIVE JSCB ADDRESS  Y02082 02667002
         L     RDSAB,JSCDSABQ           GET DSAB QDB ADDRESS     Y02082 02669002
         ST    RDSAB,DSABQDB            SAVE FOR TIOT ENQ        Y02082 02671002
         TESTAUTH FCTN=1,KEY=YES,BRANCH=YES  TEST IF CALLER IS   YM1063X02673002
                                        AUTHORIZED OR KEY ZERO   YM1063 02675002
*                                                                YM1063 02676002
         LTR   R15,R15                  TEST IF EITHER TRUE      YM1063 02677002
         BNZ   FIRSTENQ                 BRANCH IF NOT TO ENQ     Y02082 02679002
         TM    K2(PL),DYNUNALL          TEST IF ENTERED FROM     Y02082X02681002
                                        DYNAMIC UNALLOCATION     Y02082 02682002
         BO    SKIPENQ                  BRANCH IF YES            Y02082 02683002
*                                                                Y02082 02684002
FIRSTENQ EQU   *                        FIRST ENQ                Y02082 02685002
         L     R2,CVTTCBP               LOAD TCB/ASID POINTERS   YM1063 02686002
         L     R2,K12(,R2)              LOAD CURRENT ASID ADDR   YM1063 02687002
         USING ASCB,R2                  ASCB ADDRESSABILITY      YM1063 02688002
         MVC   TIOTMNR(K2),ASCBASID     MOVE ASID INTO ENQ MINOR YM1063 02689002
*                                       RESOURCE NAME            YM1063 02690002
         DROP  R2                                                YM1063 02691002
         MVC   MJNAME(L'TIOTMJR),TIOTMJR  MAJOR RESOURCE NAME    Y02082 02695002
         MVC   ENQAREA(ENQLTH1),ENQLIST1  MOVE IN PARAMETER LIST Y02082 02697002
         ENQ   (MJNAME,TIOTMNR),MF=(E,ENQAREA)  ENQ ON SYSZTIOT  Y02082 02699002
         LTR   R15,R15                  TEST IF SUCCESSFUL ENQ   Y02082 02701002
         BZ    SETENQSW                 BRANCH IF YES            Y02082 02703002
*                                                                       02704002
         LA    VOLISTX,K2(P4)           ADDRESS OF FIRST VOLUME  Y02082 02705002
OPENERR  EQU   *                        OPEN DATA SET ERROR      Y02082 02705502
         LA    R3,OPENDS                OPEN DATA SET ERROR CODE Y02132 02706002
         B     SETERRCD                 GO STORE THE STATUS BYTE Y02132 02706502
NOF1DSCB EQU   *                        NO F1 DSCB ERROR         Y02132 02707002
         LA    R3,NOF1                  NO F1 DSCB ERROR CODE    Y02132 02707502
SETERRCD EQU   *                        SET ERROR CODE           Y02132 02708002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 02709002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 02711002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 02713002
ERRLOOP  EQU   *                        BEGIN LOOP               Y02082 02715002
         STC   R3,STATUS(VOLISTX)       SET ERROR CODE IN VOLIST Y02132 02717002
         LA    VOLISTX,ENTRYL(VOLISTX)  NEXT VOL LIST ENTRY ADDR Y02082 02719002
         BCT   VOLCTR,ERRLOOP           BRANCH IF MORE VOLUMES   Y02082 02721002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 02723002
         LA    VOLISTX,K2(P4)           RELOAD ADDR OF 1ST VOL   Y02082 02725002
         LA    WORKREG,RTNCODE8         ERROR RETURN CODE        Y02082 02727002
         B     SETCODE                  GO SAVE ERROR CODE       Y02082 02729002
*                                                                       02730002
SETENQSW EQU   *                        SET ENQ SWITCH           Y02082 02731002
         LA    R1,TIOTMNR               MINOR RESOURCE NAME ADDR Y02144 02731402
         ST    R1,DSMADTW2              SAVE MINOR ENQ NAME ADDR Y02144 02731802
         OI    DSMADTB2,DSMTIOTE        SET TIOT ENQ'ED SWITCH   Y02144 02732202
         OI    SISW1,TIOTENQ            SET TIOT ENQ'ED SWITCH   Y02082 02733002
SKIPENQ  EQU   *                        ENQ SKIPPED              Y02082 02735002
         LA    VOLISTX,K2(P4)           ADDRESS OF FIRST VOLUME  Y02082 02737002
         LTR   RUCBSAVE,RUCB            TEST FOR PASSED UCB ADDR Y02082 02739002
         BZ    FINDUNIT                 BRANCH IF ZERO           Y02082 02741002
         LA    RUCBSAVE,K0(RUCBSAVE)    CLEAR HIGH BYTE          Y02082 02743002
         TM    UCBJBNR,UCBVRDEV         TEST IF A VIRTUAL UCB    Y02132 02745002
         BZ    USERSUCB                 BRANCH IF NOT            Y02132 02747002
         ST    RUCB,PRUCBPTR            SAVE INPUT UCB ADDRESS   Y02132 02749002
         B     VIODSTST                 BRANCH TO VIO D/S TEST   Y02132 02751002
*                                                                       02765002
* IF THE USER SUPPLIED A UCB ADDRESS, THIS SECTION SEARCHES THE         02767002
* TIOT TO DETERMINE IF THE UNIT IS ALLOCATED TO THE JOB.  IF IT IS      02769002
* ALLOCATED, IT BECOMES THE PRIMARY UCB IF IT IS DEMOUNTABLE.           02771002
*                                                                       02773002
USERSUCB EQU   *                        USER SUPPLIED UCB ADDR   Y02082 02775002
         L     RDSAB,DSABQDB            LOAD DSAB QDB ADDRESS    Y02082 02777002
         USING QDB,RDSAB                QDB ADDRESSABILITY       Y02082 02779002
         L     RDSAB,QDBFELMP           GET FIRST DSAB ADDRESS   Y02082 02781002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02082 02783002
UDSABTST EQU   *                        DSAB TEST                Y02082 02785002
         LTR   RDSAB,RDSAB              IS THERE ANOTHER DSAB    Y02082 02787002
         BZ    FINDUNIT                 BRANCH IF NOT            Y02082 02789002
         L     RTIOT,DSABTIOT           LOAD TIOT ADDRESS        Y02082 02791002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02082 02793002
         SR    REND,REND                ZERO REGISTER FOR IC     Y02082 02795002
         IC    REND,TIOELNGH            LENGTH OF TIOT ENTRY     Y02082 02797002
         AR    REND,RTIOT               ADDRESS OF FIRST BYTE    Y02082 02799002
*                                       PAST THE TIOT ENTRY      Y02082 02801002
         LA    RTIOT,TIOEFSRT-K1        ADDR OF FIRST UCB ADDR   Y02082 02803002
UNEXTUCB EQU   *                        END OF ENTRY             Y02082 02805002
         CR    RTIOT,REND               TEST IF AT END OF ENTRY  Y02082 02807002
         BNL   UNXTDSAB                 BRANCH IF YES            Y02082 02809002
         L     RUCB,K0(,RTIOT)          GET UCB ADDRESS          Y02082 02811002
         LA    RUCB,K0(RUCB)            CLEAR HIGH BYTE          Y02082 02813002
         LTR   RUCB,RUCB                IS THERE A UCB ADDRESS   Y02082 02815002
         BZ    UINCRPTR                 BRANCH IF NOT            YM1063 02817002
         CR    RUCB,RUCBSAVE            TEST IF EQUAL TO THE     Y02082 02819002
*                                       USER-SUPPLIED UCB ADDR   Y02082 02821002
         BE    LINKTEST                 BRANCH IF YES            Y02082 02823002
UINCRPTR EQU   *                                                 YM1063 02824002
         LA    RTIOT,L'TIOESTTB+L'TIOEFSRT(RTIOT)  INCREMENT TO  Y02082 02825002
*                                       NEXT UCB ADDRESS IN TIOT Y02082 02827002
         B     UNEXTUCB                 GO TRY NEXT UCB ADDRESS  Y02082 02829002
*                                                                       02830002
UNXTDSAB EQU   *                        NEXT DSAB                Y02082 02831002
         L     RDSAB,DSABFCHN           GET NEXT DSAB ADDRESS    Y02082 02833002
         B     UDSABTST                 GO TEST IT               Y02082 02835002
*                                                                       02879002
* THIS SECTION LINKS TO A ROUTINE THAT DETERMINES IF THE UNIT IS        02880002
* ELIGIBLE FOR DEMOUNTING.                                              02881002
*                                                                       02882002
LINKTEST BAL   RETURN,TESTUCB           GO TEST DEMOUNTABILITY  SA56369 02884002
         LTR   RUCB,RUCB                TEST IF DEMOUNTABLE     SA56369 02885002
         BZ    FINDUNIT                 BRANCH IF NOT           SA56369 02886002
         ST    RDSAB,PRDSABAD           SAVE PRIMARY DSAB ADDR   Y02082 02894002
         ST    RUCB,PRUCBPTR            SAVE PRIMARY UCB ADDRESS Y02082 02898002
         L     RETURN,DSABTIOT          LOAD TIOT ENTRY ADDRESS  YM7036 02898402
         LA    RETURN,TIOEJFCB-TIOENTRY(,RETURN)  POINT TO JFCB  YM7036X02899002
                                        PREFIX ADDRESS           YM7036 02900002
         IECRES LOCJFCB,(RETURN)        LOCATE THE JFCB          YM7036 02901002
         CLC   PDSNAME,JFCBDSNM-INFMJFCB(RETURN)  CHECK IF       YM7036X02902002
                                        THIS IS THE RIGHT TIOT   YM7036X02903002
                                        ENTRY FOR THIS DSNAME    YM7036 02904002
         BE    FOUNDUCB                 BRANCH IF CORRECT        YM7036 02905002
         OI    SISW2,UCBFNDSW           SET THE UCB FOUND SWITCH YM7036 02906002
         B     UINCRPTR                 GO TRY NEXT TIOT ENTRY   YM7036 02907002
*                                                                       02941021
* THIS SECTION TESTS IF THE UCB IS DEMOUNTABLE.                         02942002
*                                                                       02943021
TESTUCB  EQU   *                                                        02945013
         TM    SRTESTAB,SRTEBSVL        TEST FOR SHARED VOLUME          02980013
         BZ    WRONGUCB                 BR IF SHARED                    02990013
         TM    UCBTBYT3,UCB3DACC        TEST IF DIRECT ACCESS    Y02082 03000002
         BZ    WRONGUCB                 BRANCH IF NOT            Y02082 03010002
         TM    UCBDMCT,UCBDMC           TEST IF DATAMGT COUNT=0  Y02082 03020002
         BNZ   WRONGUCB                 BRANCH IF NOT            Y02082 03030002
         TM    SRTESTAT,SRTEONLI        TEST FOR ONLINE DEVICE  SA56369 03040002
         BZ    WRONGUCB                 BRANCH IF NOT ONLINE    SA56369 03060002
         TM    SRTESTAT,SRTERESV+SRTEPRES+SRTESYSR  TEST FOR RESERVED,  03080000
*                                       PERMANENTLY RESIDENT, OR        03100000
*                                       SYSTEM RESIDENT VOLUME          03120000
         BNZ   WRONGUCB                 BRANCH IF YES           SA56369 03140002
         BR    RETURN                   RETURN IF UCB IS OKAY   SA56369 03180002
WRONGUCB EQU   *                                                SA56369 03196002
         SR    RUCB,RUCB                DISCARD THE UCB ADDRESS SA56369 03196502
         BR    RETURN                   RETURN                  SA56369 03197002
*                                                                       03197502
* THIS SECTION INITIALIZES REGISTERS AND COUNTERS BEFORE                03198002
* BRANCHING TO IGG0290E.                                                03198502
*                                                                       03199002
NOPRIUCB EQU   *                        SET FLAG                 Y02082 03200002
         OI    STYPEFLG,NOMNTDEV        TURN ON NO DEVICE BIT    Y02082 03210002
FOUNDUCB LA    VOLISTX,2(P4)            LOAD ADDR OF FIRST VOLUME       03220000
         LH    VOLCTR,VOLNUM            LOAD NBR OF VOLS IN LIST Y02080 03240002
         ST    VOLISTX,VOLPTR           SAVE ADDR OF 1ST ENTRY   Y02082 03250002
         NI    SISW2,X'FF'-UCBFNDSW     TURN OFF UCB FOUND SWTCH YM7036 03252002
*                                                                       03260002
* THIS SECTION ISSUES AN EXCLUSIVE ENQ DIRECTED TO THE INITIATOR'S      03270002
* TCB WITH A MAJOR RESOURCE NAME OF SYSDSN AND THE DATA SET NAME AS     03280002
* THE MINOR RESOURCE NAME. IF THE RETURN CODE INDICATES THE TASK        03290002
* PREVIOUSLY HAD CONTROL OF THE RESOURCE, THE ENQ IS REISSUED AND       03300002
* A BIT IS SET TO INDICATE A DEB SEARCH MUST BE DONE TO ENSURE NO       03310002
* ONE IS CURRENTLY OPEN TO THE DATA SET.                                03320002
*                                                                       03330002
         MVC   ENQAREA(ENQLTH2),ENQLIST2  MOVE IN PARAMETER LIST Y02082 03350002
         MVC   MJNAME(L'DSNMJR),DSNMJR  MAJOR RESOURCE NAME      Y02082 03360002
         LA    P2,PDSNAME+L'PDSNAME-K1  LAST BYTE OF DSNAME      YM2880 03361002
TESTDSN  EQU   *                        SEARCH FOR NON-BLANK     YM2880 03362002
         CLI   K0(P2),BLANK             IS THIS ONE A BLANK      YM2880 03363002
         BNE   GETLNGTH                 BRANCH IF NO TO COMPUTE  YM2880X03364002
                                        LENGTH OF NAME FOR ENQ   YM2880 03365002
         BCT   P2,TESTDSN               TRY NEXT BYTE            YM2880 03366002
GETLNGTH EQU   *                        CALCULATE LENGTH         YM2880 03367002
         LA    R2,PDSNAME-K1            BYTE PRECEDING DSNAME    YM2880 03368002
         SR    P2,R2                    P2 HAS LENGTH FOR ENQ    YM2880 03369002
         L     R2,TCBADDR               LOAD TCB ADDRESS         Y02082 03380002
         USING TCB,R2                   TCB ADDRESSABILITY       Y02082 03390002
         L     R2,TCBJSCB               GET JSCB ADDRESS         Y02082 03400002
         USING IEZJSCB,R2               JSCB ADDRESSABILITY      Y02082 03410002
         L     R2,JSCBACT               GET ACTIVE JSCB ADDRESS  YM2887 03411002
         L     R2,JSCBTCBP              INITIATOR TCB ADDRESS    Y02082 03420002
         ENQ   (MJNAME,PDSNAME,,(P2)),TCB=(R2),RET=USE,MF=(E,ENQAREA)  X03430002
                                                                 YM2880 03431002
         LTR   R15,R15                  TEST RETURN CODE         Y02082 03440002
         BNZ   ERRTEST                  BRANCH IF ENQ FAILED     Y02082 03450002
*                                                                       03455002
         TM    SISW2,DSNENQCV           SUFFIXED CVOL NAME ?   @Z40CSRC 03455337
         BO    CLRCVOLN                 YES, GO CLEAR SUFFIX   @Z40CSRC 03455637
         OI    DSMADTB2,DSMDSNE         SET DSN ENQ'ED SWITCH    Y02144 03456002
         OI    SISW1,DSNENQ             SET ENQ ON SYSDSN SWITCH Y02082 03460002
         B     CHKCVOL                  GO CHK FOR A CVOL      @Z40CSRC 03470037
ERRTEST  EQU   *                        IS DSN ALREADY ENQ'ED    Y02082 03480002
         CLI   ENQAREA+K3,RTNCODE8      TEST IF TASK ALREADY     Y02082 03490002
*                                       ENQ'ED ON SYSDSN         Y02082 03500002
         BNE   CLRERRCV                 BRANCH IF NOT          @Z40CSRC 03510037
         TM    SISW2,DSNENQCV           DID CVOL ENQ FAIL      @Z40CSRC 03512037
         BO    CLRERRC2                 YES, FAIL REQUEST      @Z40CSRC 03514037
         MVC   ENQAREA(ENQLTH3),ENQLIST3  MOVE IN PARAMETER LIST Y02082 03520002
         ENQ   (MJNAME,PDSNAME,,(P2)),TCB=(R2),RET=CHNG,MF=(E,ENQAREA) X03530002
                                                                 YM2880 03531002
         LTR   R15,R15                  TEST RETURN CODE         Y02082 03540002
         BNZ   CLRERRCV                 BR IF NOT SUCCESSFUL   @Z40CSRC 03550037
         OI    SISW1,DEBSRCH            DEB SEARCH REQUIRED SW   Y02082 03560002
*                                                                       03560337
* HAVING JUST SUCCESSFULLY ENQUEUED ON SYSDSN, CHECK FOR SCRATCHING     03560637
* A CVOL (DSNAME='SYSCTLG').  IF SO, DO AN ADDITIONAL ENQ USING         03560937
* THE NAME SYSCTLG.VXXXXXX WHERE XXXXXX IS THE VOLSER.                  03561237
* THIS WILL CHECK FOR USERS OPEN TO THE CVOL VIA SVC 26 (CATALOG        03561537
* MANAGEMENT) AND SVC 22 (OPENJ).                                       03561837
* IF THE CVOL IS ALREADY ENQUEUED UPON, FAIL THE REQUEST.               03562137
* A DEB SEARCH WOULD BE INSUFFICIENT, SINCE SVC 26 USES A DUMMY         03562437
* DEB THAT IS NOT ON THE DEB CHAIN.                                     03562737
*                                                                       03563037
CHKCVOL  EQU   *                        CHECK FOR A CVOL       @Z40CSRC 03563237
         CLC   PDSNAME(L'CSYSCTNM),CSYSCTNM SCRATCHING A CVOL  @Z40CSRC 03563337
         BNE   NEXTLOAD                 NO, GO TO NEXT LOAD    @Z40CSRC 03563637
         OI    SISW2,DSNENQCV           FLAG SUFFIXED CVOL ENQ @Z40CSRC 03563937
         LA    P2,PDSNAME(P2)           POINT BEYOND DSNAME    @Z40CSRC 03564237
         MVC   K0(L'CDOTV,P2),CDOTV     MOVE IN '.V'           @Z40CSRC 03564537
         MVC   L'CDOTV(L'UCBVOLI,P2),VOLSER(VOLISTX) MV VOLSER @Z40CSRC 03564837
         LA    P2,KDOTVVL-K1(,P2)       ADDR OF LAST CHAR      @Z40CSRC 03565137
         B     GETLNGTH                 GO ENQ ON SYSCTLG.V... @Z40CSRC 03565437
NEXTLOAD EQU   *                        GO TO IGG0290E           Y02082 03570002
         LA    R2,LOAD2                 POINT TO IGG0290E        Y02080 03580002
         B     CONTINUE                 GO BRANCH TO IGG0290E    Y02082 03590002
*                                                                       03591037
* CLEAR SUFFIX QUALIFIER FROM CVOL NAME                                 03592037
*                                                                       03593037
CLRCVOLN EQU   *                        CLEAR CVOL NAME        @Z40CSRC 03594037
         LA    P2,PDSNAME-KDOTVVL(P2)   POINT AT '.VXXXXXX'    @Z40CSRC 03595037
         MVC   K0(KDOTVVL,P2),KDOTVVL(P2) BLANK OUT SUFFIX     @Z40CSRC 03596037
         B     NEXTLOAD                 GO TO NEXT LOAD        @Z40CSRC 03597037
CLRERRCV EQU   *                        CVOL CLRING FOR ERRS   @Z40CSRC 03597437
         TM    SISW2,DSNENQCV           IS DSNAME SUFFIXED     @Z40CSRC 03597837
         BNO   OPENERR                  NO, GO TO ERROR RTN    @Z40CSRC 03598237
CLRERRC2 EQU   *                        CLEAR SUFFIX           @Z40CSRC 03598637
         NI    SISW2,OFF-DSNENQCV       SHOW NOTHING TO DEQ    @Z40CSRC 03598837
         LA    P2,PDSNAME-KDOTVVL(P2)   POINT AT '.VXXXXXX'    @Z40CSRC 03599037
         MVC   K0(KDOTVVL,P2),KDOTVVL(P2) BLANK OUT SUFFIX     @Z40CSRC 03599437
         B     OPENERR                  GO TO ERROR ROUTINE    @Z40CSRC 03599837
*                                                                       03600002
* THIS SECTION SEARCHES THE TIOT TO SEE IF ANY VOLUME IN THE VOLUME     03610002
* LIST IS MOUNTED ON A UNIT ALLOCATED TO THE JOB.  IF MOUNTED, IT       03620002
* LINKS TO A ROUTINE THAT DETERMINES IF THE UNIT IS DEMOUNTABLE.        03630002
*                                                                       03640002
FINDUNIT EQU   *                        FIND A UNIT              Y02082 03650002
         TM    SISW2,UCBFNDSW           TEST IF A UCB WAS FOUND  YM7036 03652002
         BO    FOUNDUCB                 BRANCH IF YES            YM7036 03654002
         OC    VOLSER(L'SRTEVOLI,VOLISTX),VOLSER(VOLISTX)  TEST  Y02082 03660002
*                                       FOR VALID VOLUME SERIAL  Y02082 03670002
         BZ    NOUNIT                   BRANCH IF ZERO           Y02082 03680002
         CLC   VOLSER(L'SRTEVOLI,VOLISTX),BLANKS  TEST FOR VALID Y02132 03680502
*                                       VIRTUAL UCB VOL SER      Y02132 03681002
         BNE   NOVIOVOL                 BRANCH IF NOT            Y02132 03681502
         CLC   CSYS,PDSNAME             CHECK FOR CHARACTERS SYS YM1337 03682502
*                                       IN BYTES 0-2 OF THE DSN  Y02132 03683002
         BNE   NOVIOVOL                 BRANCH IF NOT            Y02132 03683502
         CLC   CDOTT,PDSNAME+K8         TEST FOR .T IN BYTES 8-9 YM1337 03684002
         BNE   NOVIOVOL                 BRANCH IF NOT            Y02132 03684502
         CLC   CDOTR,PDSNAME+K16        CHECK FOR CHARACTERS .R  YM1337 03685002
*                                       IN BYTES 16-17           Y02132 03685502
         BE    VIODSTST                 BRANCH IF YES TO TEST IF Y02132 03686002
*                                       A VIO DATA SET           Y02132 03686502
*                                                                       03687002
NOVIOVOL EQU   *                        GET FIRST DSAB ADDRESS   Y02132 03687502
         L     RDSAB,DSABQDB            LOAD DSAB QDB ADDRESS    Y02082 03690002
         USING QDB,RDSAB                QDB ADDRESSABILITY       Y02082 03700002
         L     RDSAB,QDBFELMP           GET FIRST DSAB ADDRESS   Y02082 03710002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02082 03720002
DSABTEST EQU   *                        DSAB TEST                Y02082 03730002
         LTR   RDSAB,RDSAB              IS THERE ANOTHER DSAB    Y02082 03740002
         BZ    NOUNIT                   BRANCH IF NOT            Y02082 03750002
         L     RTIOT,DSABTIOT           GET TIOT POINTER         Y02082 03760002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02082 03770002
         SR    REND,REND                ZERO REGISTER FOR IC     Y02082 03780002
         IC    REND,TIOELNGH            LENGTH OF TIOT ENTRY     Y02082 03790002
         AR    REND,RTIOT               ADDRESS OF TIOT ENTRY    Y02082 03800002
*                                       PAST THE TIOT ENTRY      Y02082 03810002
         LA    RTIOT,TIOEFSRT-K1        ADDR OF FIRST UCB ADDR   Y02082 03820002
NEXTUCB  EQU   *                        GET NEXT UCB             Y02082 03830002
         CR    RTIOT,REND               TEST IF AT END OF ENTRY  Y02082 03840002
         BNL   NEXTDSAB                 BRANCH IF YES            Y02082 03850002
         L     RUCB,K0(,RTIOT)          GET UCB ADDRESS          Y02082 03860002
         LA    RUCB,K0(RUCB)            CLEAR HIGH BYTE          Y02082 03870002
         LTR   RUCB,RUCB                IS THERE A UCB ADDRESS   Y02082 03880002
         BZ    NXTENTRY                 BRANCH IF NOT            YM1063 03890002
         CLC   SRTEVOLI,VOLSER(VOLISTX)  COMPARE VOL SER NUMBERS Y02082 03900002
         BNE   NXTENTRY                 BRANCH IF NOT EQUAL      Y02082 03910002
*                                                                       03915002
         BAL   RETURN,TESTUCB           TEST IF UCB DEMOUNTABLE  Y02082 03920002
*                                                                       03925002
         LTR   RUCB,RUCB                TEST IF DEMOUNTABLE      Y02082 03930002
         BZ    NXTENTRY                 BRANCH IF NOT            YM7036 03932002
         ST    RDSAB,PRDSABAD           SAVE PRIMARY DSAB ADDR   YM7036 03933002
         ST    RUCB,PRUCBPTR            SAVE PRIMARY UCB ADDRESS YM7036 03934002
         L     RETURN,DSABTIOT          LOAD TIOT ENTRY ADDRESS  YM7036 03934402
         LA    RETURN,TIOEJFCB-TIOENTRY(,RETURN)  POINT TO JFCB  YM7036X03935002
                                        PREFIX ADDRESS           YM7036 03936002
         IECRES LOCJFCB,(RETURN)        LOCATE THE JFCB          YM7036 03937002
         CLC   PDSNAME,JFCBDSNM-INFMJFCB(RETURN)  CHECK IF       YM7036X03938002
                                        THIS IS THE RIGHT TIOT   YM7036X03939002
                                        ENTRY FOR THIS DSNAME    YM7036 03940002
         BE    FOUNDUCB                 BRANCH IF CORRECT        YM7036 03941002
         OI    SISW2,UCBFNDSW           SET THE UCB FOUND SWITCH YM7036 03942002
NXTENTRY EQU   *                        NEXT ENTRY               Y02082 03950002
         LA    RTIOT,L'TIOESTTB+L'TIOEFSRT(,RTIOT)  INCREMENT TO Y02082 03960002
*                                       NEXT UCB ADDRESS IN TIOT Y02082 03970002
         B     NEXTUCB                  GO TEST NEXT UCB ADDRESS Y02082 03980002
*                                                                       03985002
NEXTDSAB EQU   *                        NEXT DSAB                Y02082 03990002
         L     RDSAB,DSABFCHN           GET NEXT DSAB ADDRESS    Y02082 04000002
         B     DSABTEST                 GO TEST IT               Y02082 04010002
NOUNIT   EQU   *                        NO UNIT                  Y02082 04020002
         BCT   VOLCTR,TRYNEXT           TEST IF MORE VOLUMES     Y02082 04030002
         TM    SISW2,UCBFNDSW           TEST IF A UCB WAS FOUND  YM7036 04032002
         BO    FOUNDUCB                 BRANCH IF YES            YM7036 04034002
         B     NOPRIUCB                 BRANCH IF NOT            Y02082 04040002
TRYNEXT  EQU   *                        NEXT VOLUME LIST ENTRY   Y02082 04050002
         LA    VOLISTX,ENTRYL(VOLISTX)  POINT TO NEXT ENTRY      Y02082 04060002
*                                       IN THE VOLUME LIST       Y02082 04070002
         B     NOVIOVOL                 GO TRY NEXT VOLUME       YM7036 04080002
*                                                                       06030002
* THIS SECTION PREPARES TO BRANCH TO THE LAST LOAD OF SCRATCH.          06040002
*                                                                       06050002
ERREXIT  EQU   *                                                SA56369 06060002
         LA    WORKREG,BADLIST          ERROR CODE FOR EMPTY    SA57261 06110002
*                                       VOLUME LIST OR INVALID  SA57261 06120002
*                                       VOLUME LIST ADDRESS     SA57261 06130002
SETCODE  EQU   *                        SET CODE                 Y02082 06135002
         STH   WORKREG,ERCODE          STORE ERROR CODE IN VOL LIST     06140013
         OI    STYPEFLG,EXITBIT         SET EXIT BIT             Y02082 06145002
         LA    R2,LASTLOAD              POINT TO IGG0290D        Y02080 06390002
*                                                                       06410002
* THIS SECTION BRANCHES TO ANOTHER LOAD OF SCRATCH.                     06420002
*                                                                       06430002
CONTINUE EQU   *                        GO TO NEXT LOAD          Y02082 06440002
         MVC   WKADEB+APD(K3),CVTXAPG+K1  POINT DEB TO IOS AVT   Y02082 06450002
         L     PL,OLDPLPTR              GET PARAMETER LIST PTR   Y02082 06460002
         IECRES LOAD,EXTPR=(RWKAREA),MODNM=(R2),BRANCH=DIRECT    Y02082 06470002
*                                                                       06471002
* THIS SECTION SEARCHES THE DSAB CHAIN FOR A TIOT ENTRY CONTAINING      06472002
* A VIRTUAL UCB WHOSE VDSDSCB CONTAINS THE DATA SET NAME BEING          06473002
* SCRATCHED AND WHOSE VOLUME SERIAL NUMBER IN THE VDSUCB MATCHES        06474002
* THE FIRST VOLUME SERIAL IN THE VOLUME LIST. IF A DSNAME/VOL SER       06475002
* MATCH IS FOUND, IT ISSUES VSCRATCH AND ZEROS THE VDSDSCB.             06476002
*                                                                       06477002
VIODSTST EQU   *                        FIND VIO DSN             Y02132 06478002
         OI    STYPEFLG,VIOBIT          SET VIO BIT              Y02132 06479002
         L     RDSAB,DSABQDB            GET DSAB QDB ADDRESS     Y02132 06480002
         USING QDB,RDSAB                QDB ADDRESSABILITY       Y02132 06481002
         L     RDSAB,QDBFELMP           GET PTR TO FIRST DSAB    Y02132 06482002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02132 06483002
VDSABTST EQU   *                        DSAB TEST                Y02132 06484002
         LTR   RDSAB,RDSAB              IS THERE ANOTHER DSAB    Y02132 06485002
         BZ    NOMATCH                  BRANCH IF NOT            Y02132 06486002
         L     RTIOT,DSABTIOT           GET TIOT ADDRESS         Y02132 06487002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02132 06488002
         L     RUCB,TIOEFSRT-K1         GET UCB ADDRESS          Y02132 06489002
         LA    RUCB,K0(RUCB)            CLEAR HIGH BYTE          Y02132 06490002
         LTR   RUCB,RUCB                IS THERE A UCB ADDRESS   Y02132 06491002
         BZ    VNXTDSAB                 IF NO, TRY NEXT DSAB     Y02132 06492002
         TM    UCBJBNR,UCBVRDEV         TEST IF A VIRTUAL UCB    Y02132 06493002
         BZ    VNXTDSAB                 BRANCH IF NOT            Y02132 06494002
         CLC   SRTEVOLI,VOLSER(VOLISTX)  COMPARE VOL SER'S       Y02132 06495002
         BNE   VNXTDSAB                 BRANCH IF NOT EQUAL      Y02132 06496002
         LR    R7,RUCB                  VDSCB ADDRESS            Y02132 06497002
         USING VDSCB,R7                 VDSCB ADDRESSABILITY     Y02132 06498002
         CLC   DS1DSNAM,PDSNAME         COMPARE DSNAME'S         YM1337 06500002
         BNE   VNXTDSAB                 BRANCH IF NOT EQUAL      Y02132 06501002
VIOSCRTH EQU   *                        TEST COUNT               Y02132 06502002
         CLI   DSABOPCT,K0              IS DSAB OPEN COUNT ZERO  Y02132 06503002
         BNE   OPENERR                  BRANCH IF NOT            Y02132 06504002
         CLI   UCBDMCT,K0               IS UCB DATAMGT COUNT 0   Y02132 06505002
         BNE   OPENERR                  BRANCH IF NOT            Y02132 06506002
         L     R1,VDSDSPCT              GET PTR TO DSPCT         Y02132 06507002
         LTR   R1,R1                    DOES IT EQUAL ZERO       Y02132 06508002
         BZ    NOVSCRTH                 BRANCH IF YES            Y02132 06509002
*                                                                       06510002
         XC    VDSDSPCT,VDSDSPCT        ZERO VDSDSPCT PTR        YM7831 06510402
*                                                                       06510802
         STM   RUCB,RETURN,IECREGSV+K12  SAVE REGISTERS 11-14    Y02132 06511002
         LR    R2,RWKAREA               SAVE WORK AREA ADDRESS   Y02132 06512002
OBTNLCK2 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02132X06513002
               RELATED=(LOCAL,IGC0002I(RLSELCK2))  OBTAIN LOCK   Y02132 06514002
         LM    RUCB,RETURN,IECREGSV+K12-SCRTHWKA(R2)  RESTORE    Y02132 06515002
         VSCRATCH DSPCT=(1)             ISSUE VSCRATCH MACRO     Y02132X06516002
                                        REGISTER 13 POINTS TO    Y02132X06517002
                                        THE 18 WORD SAVE AREA    Y02132 06518002
*                                                                YM6992 06518402
         LR    R1,R15                   SAVE VSCRATCH RETURN CDE YM6992 06518802
         STM   RUCB,RETURN,IECREGSV+K12  SAVE REGISTERS 11-14    Y02132 06519002
         LR    R2,RWKAREA               SAVE WORK AREA ADDRESS   Y02132 06520002
RLSELCK2 SETLOCK RELEASE,TYPE=LOCAL,                             Y02080X06521002
               RELATED=(LOCAL,IGC0002I(OBTNLCK2))  RELEASE LOCK  Y02080 06522002
         LM    RUCB,RETURN,IECREGSV+K12-SCRTHWKA(R2)  RESTORE    Y02132 06523002
         LTR   R1,R1                    TEST VSCRATCH RETURN CDE YM6992 06523402
         BZ    NOVSCRTH                 BRANCH IF NO ERROR       YM6992 06523802
         L     R1,TCBADDR               LOAD TCB ADDRESS         YM6992 06524202
         USING TCB,R1                   TCB ADDRESSABILITY       YM6992 06524602
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY YM6992 06525002
         MVI   STATUS(VOLISTX),IOERR    I/O ERROR CODE           YM6992 06525402
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       YM6992 06525802
         DROP  R1                                                YM6992 06526202
         BCT   VOLCTR,VIOERR            ERROR IF MORE VOLUMES    YM6992 06526602
         LA    WORKREG,RTNCODE8         SCRATCH ERROR CODE       YM6992 06527002
         B     SETCODE                  GO BRANCH TO LAST LOAD   YM6992 06527402
*                                                                YM6992 06527802
NOVSCRTH EQU   *                        ZERO OUT THE VIO DSCB    Y02132 06528002
         XC    DS1FMTID(VDATALN),DS1FMTID  ZERO OUT THE VIO DSCB Y02132X06529002
                                        EXCEPT THE DSNAME FIELD  Y02132 06530002
         XR    R1,R1                    ZERO REGISTER            Y02132 06532002
         BCTR  R1,K0                    DECREMENT TO MINUS 1     Y02132 06533002
         STH   R1,VDSABSTT              INDICATE D/S SCRATCHED   Y02132 06534002
         DROP  R7                                                Y02132 06535002
         NI    SISW1,X'FF'-NOSMFRCD     RESET NO SMF RECORD BIT  Y02132 06536002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02132 06537002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02132 06538002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02132 06539002
         MVI   STATUS(VOLISTX),K0       SUCCESSFUL SCRATCH CODE  Y02132 06540002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02132 06541002
         DROP  R1                                                Y02132 06542002
         BCT   VOLCTR,VIOERR            ERROR IF MORE VOLUMES    Y02132 06543002
         XR    WORKREG,WORKREG          SUCCESSFUL SCRATCH CODE  Y02132 06544002
         B     SETCODE                  GO BRANCH TO LAST LOAD   Y02132 06545002
VIOERR   EQU   *                        SET ERROR CODE           Y02132 06546002
         LA    VOLISTX,ENTRYL(VOLISTX)  NEXT VOL LIST ENTRY ADDR Y02132 06547002
         B     NOF1DSCB                 GO SET AN ERROR CODE OF  Y02132 06548002
*                                       X'01' FOR OTHER ENTRIES  Y02132 06549002
VNXTDSAB EQU   *                        NEXT                     Y02132 06550002
         L     RDSAB,DSABFCHN           GET NEXT DSAB ADDRESS    Y02132 06551002
         B     VDSABTST                 GO TEST IT               Y02132 06552002
NOMATCH  EQU   *                        NO VIO DSN MATCH         Y02132 06553002
         OC    PRUCBPTR,PRUCBPTR        TEST FOR INPUT UCB ADDR  Y02132 06554002
         BZ    NOF1DSCB                 BRANCH IF NONE           Y02132 06555002
         NI    STYPEFLG,X'FF'-VIOBIT    RESET VIO BIT            Y02132 06556002
         XC    PRUCBPTR,PRUCBPTR        CLEAR INVALID UCB ADDR   Y02132 06557002
         B     NOVIOVOL                 BRANCH TO NON-VIO LOGIC  Y02132 06558002
*                                                                       06560000
*** PROGRAM CONSTANTS                                                   06580000
*                                                                       06600000
TWELVE   DC    H'12'                                             A33080 06610020
CSYSCTNM DS    0CL8                     CVOL DSNAME 'SYSCTLG ' @Z40CSRC 06611037
CSYS     DC    CL3'SYS'                 CONSTANT OF 'SYS'        Y02132 06620002
         DC    C'CTLG '                 REST OF 'SYSCTLG '     @Z40CSRC 06621037
CDOTT    DC    CL2'.T'                  CONSTANT OF '.T'         Y02132 06630002
CDOTR    DC    CL2'.R'                  CONSTANT OF '.R'         Y02132 06640002
CDOTV    DC    C'.V'                    CONSTANT OF '.V'       @Z40CSRC 06641037
BLANKS   DC    CL6' '                   SIX EBCDIC BLANKS        Y02132 06650002
TIOTMJR  DC    CL8'SYSZTIOT'            TIOT MAJOR RESOURCE NAME Y02082 06730002
DSNMJR   DC    CL8'SYSDSN'              DSN MAJOR RESOURCE NAME  Y02082 06740002
ENQLIST1 ENQ   (,,E,6,SYSTEM),RET=HAVE,MF=L  TIOT ENQ PARM LIST  Y02082 06750002
ENQLTH1  EQU   *-ENQLIST1               LENGTH OF ENQ PARM LIST  Y02082 06760002
ENQLIST2 ENQ   (,,E,,SYSTEM),RET=USE,MF=L  1ST DSN ENQ LIST      YM2880 06770002
ENQLTH2  EQU   *-ENQLIST2               LENGTH OF ENQ PARM LIST  Y02082 06780002
ENQLIST3 ENQ   (,,E,,SYSTEM),RET=CHNG,MF=L  2ND DSN ENQ LIST     YM2880 06790002
ENQLTH3  EQU   *-ENQLIST3               LENGTH OF ENQ PARM LIST  Y02082 06800002
*                                                                       06980020
*** TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                     07040002
*                                                                       07100020
         XCTLTABL ID=(LOAD1,IGC0002I,LOAD2,IGG0290E,LASTLOAD,    Y02080X07150002
               IGG0290D),SVC=029,LENGTH=,BRT=YES                 Y02080 07160002
         SPACE 2                                                 Y02080 07170002
         IECDSECS ASCB,CVT,DSAB,JSCB,PSA,QDB,RB,RRPL,TIOT,TCB,   YM1063X07180002
               UCB,EXPAND=YES                                    YM1063 07200002
WORKAREA IECSCRWA EP,ADT=YES            SCRATCH WORK AREA        Y02144 07660002
         EJECT                                                   Y02132 07680002
         IDDVDSCB                       VDSCB EXPANSION          Y02132 07700002
         EJECT                                                   Y02132 07720002
         ORG   VDSDSCB                                           Y02132 07740002
         IECSDSL1 (1)                   FORMAT 1 DSCB EXPANSION  Y02132 07760002
         EJECT                                                   YM7036 07770002
         IEFJFCBN                       JFCB DSECT               YM7036 07780002
KDOTVVL  EQU   L'CDOTV+L'UCBVOLI        LENGTH OF CVOL SUFFIX  @Z40CSRC 07781037
         END                                                            08840000
./  ADD  SSI=41070001,NAME=IGC0003B
 TITLE 'IGC0003B - DADSM - SPACE ALLOCATION ENTRY POINT'                00020000
IGC0003B CSECT                                                          00023017
*                                                                       00023802
*MODULE NAME = IGC0003B                                                 00024202
*                                                                       00024602
*DESCRIPTIVE NAME = DADSM - SPACE ALLOCATION ENTRY POINT                00024702
*                                                                       00025102
*COPYRIGHT = NONE                                                       00025502
*                                                                       00025902
*CHANGE ACTIVITY = SEE BELOW                                            00026002
*                                                                       00026202
*        VS2 RELEASE 02 DELETIONS/CHANGES                               00026602
*0000000250-000260,000600,001800-003800,012800-014000,016800,    Y02080 00027002
*0000025000,028700-029400,030380-030390,031040-031070,031130-    Y02080 00027202
*0000031220,031340-031370,033000,033600,033800-034200,036200,    Y02080 00028002
*0000041920-041980,043500-043800,044000,044380-044400,044800-    Y02080 00028802
*0000045800,046400,048080-048520,061200-062200,090200-096200,    Y02080 00029602
*0000102500-103800,104100,111400-132400,132800-134000,134600     Y02080 00030402
*0000011000,039100,086200,088200,104400                          Y02132 00031202
*0000008600-008800,010880,046400                                 Y02134 00032002
*0000000030-000150,030410-030440                                 Y02078 00032802
*0000                                                            Y02082 00033602
*0000032600-032800,132400-132800,133600-134400                   Y02144 00034402
*0000                                                            Y02072 00035202
*0000001800-002800,061200-062200,104600                          YM3997 00035302
*0000                                                            YM5371 00035402
*0000063400-064000                                               YM6546 00035502
*0000034000-034200                                               XM2969 00035602
*        RELEASE 21.7 DELETIONS/CHANGES                                 00036002
*0000002800-003800,009400-010600,014000,035200-035600,041955-   SA53147 00036802
*0000041985,052200-053200,058200-059200,061200-081200,102500-   SA53147 00037602
*0000103000,134800                                              SA53147 00038402
*        RELEASE 21 DELETIONS/CHANGES                                   00039202
*1193                                                            S21042 00040002
*1193107900                                                      S21042 00040802
*1193024600,028800-030000,030400-031600,033800,104200-104400,    S21016 00041602
*1193104700-104800,105200                                        S21016 00042402
*1193010600-011400,033200-033400,034000,041900,044000,057200,    A42446 00043202
*1193068200,083200-086200,103500,113600                          A42446 00044002
*1193000441,033800,037800,038200,038600,039000,040200,104850-    A40967 00044802
*1193104950                                                      A40967 00045602
*1193030470,030950                                               M0705  00046402
*0000007200,008000-008200,011200,014000,030230,032400,036400,    A46776 00047202
*0000041950,046410-046510,090200,104300-109900                   A46776 00048002
*0000044400                                                     SA49351 00048802
*          RELEASE 19 DELETIONS                                         00049602
*1772043050-043350,045400-046000,056800-059000,059240-059520,    O19117 00050402
*1772062600-063000,065100,065520,065560,065620-065640,065720,    O19117 00051202
*1772066000-071800,073300,076660-076720,078800,086200,089400-    O19117 00052002
*1772089600,096200-097000,099600                                 O19117 00052802
*1772065100-065400                                               M4523  00053602
*          RELEASE 20 DELETIONS                                         00054402
*0613000260-000312,000410-000500,001000-005600,009200-011600,    20201  00055202
*0613012200-012600,013200-016400,043120-043240,049400-100400,    20201  00056002
*0613102600-103800,104500                                        20201  00056802
*                                                                       00057602
*STATUS CHANGE LEVEL 009                                                00058402
*                                                                       00059202
*FUNCTION/OPERATION: THIS MODULE OBTAINS THE CORE FOR THE WORK AREA   * 00060002
*   REQUIRED FOR THIS MODULE AND SUBSEQUENT DADSM AND ISAM ALLOCATE   * 00080000
*   MODULES.  IT THEN BUILDS THE DEB/DCB, THE IOB, AND THE ECB.       * 00100002
*   IF THE DEVICE HAS THE RPS FEATURE, THE ADDRESS OF THE RPS SIO     * 00180002
*   APPENDAGE IGG019EK IS LOCATED, AND A 128 BYTE RPS WORK AREA       * 00280002
*   IS OBTAINED.                                                      * 00300002
*                                                                     * 00580000
*ENTRY POINTS:                                                        * 00600000
*        IGC0003B - ENTRY IS MADE FROM TASK SCHEDULER OR UTILITY      * 00620000
*   PROGRAMS REQUESTING ALLOCATION OF SPACE ON A DIRECT ACCESS VOLUME.* 00640000
*   DADSM IS CALLED BY ISSUEING AN SVC 32.                            * 00660000
*                                                                     * 00680000
*INPUT: ON ENTRY TO THIS MODULE REGISTER ZERO WILL CONTAIN THE CORE   * 00700000
*   ADDRESS OF A JFCB OR A PARTIAL DSCB WHICH WILL CONTAIN THE        * 00720021
*   NECESSARY ALLOCATION DATA.  IF THE HIGH ORDER BIT OF REGISTER     * 00740000
*   ZERO IS A ZERO, ENTRY WAS MADE FROM THE TASK SCHEDULER AND        * 00760000
*   REGISTER ZERO WILL POINT TO A JFCB.  IF THE HIGH ORDER BIT OF     * 00780000
*   REGISTER ZERO IS A ONE, ENTRY WAS MADE FROM A UTILITY PROGRAM     * 00800021
*   AND REGISTER ZERO WILL POINT TO A PARTIAL FORMAT 1 DSCB.          * 00820021
*   REGISTER ONE WILL POINT TO A LIST OF UCB ADDRESSES THE FIRST OF   * 00840000
*   WHICH WILL BE USED IN THIS ALLOCATION.  REGISTER TWO WILL POINT   * 00844002
*   TO A VARIABLE LENGTH LIST OF DSAB POINTERS.  THE FIRST FULLWORD   * 00848002
*   POINTS TO THE DSAB BEING ALLOCATED.  THE SECOND FULLWORD POINTS   * 00852002
*   TO THE DSAB REPRESENTING THE FIRST DD CARD.  THE THIRD IS ZERO    * 00856002
*   IF THERE IS ONLY ONE DD CARD, OR A POINTER TO THE DSAB FOR THE    * 00860002
*   SECOND DD CARD.  THE FOURTH WORD IS ZERO IF THERE IS NO THIRD     * 00864002
*   DD CARD, OR A POINTER TO THE DSAB FOR THE THIRD DD CARD, OR       * 00868002
*   ABSENT IF THERE IS NO SECOND DD CARD.  THE FIFTH WORD IS ZERO     * 00872002
*   IF THERE ARE THREE CONCATENATED DD CARDS, OR ABSENT OTHERWISE.    * 00876002
*   IF BIT JFCVRDS IS SET IN THE JFCB, REGISTER 1 POINTS TO A         * 00884002
*   FULLWORD CONTAINING THE DEVICE CODE INSTEAD OF A UCB ADDRESS.     * 00888002
*                                                                     * 00900000
*OUTPUT: REGISTER 4 WILL BE NON-ZERO.                                 * 00940002
*   REGISTER 2 (A POINTER TO A DSAB LIST FOR ISAM ALLOCATE) WILL      * 00960002
*   BE LOADED FROM THE SVRB AND SAVED IN THE WORK AREA.               * 00980002
*   REGISTER 7 WILL POINT TO THE UCB OR TO THE DEVICE CODE.           * 01100002
*   REGISTER 11 WILL POINT TO THE JFCB OR PARTIAL F1 DSCB.            * 01120021
*   REGISTER 13 WILL POINT TO THE WORK AREA.                          * 01140021
*                                                                     * 01180000
*EXTERNAL ROUTINES:                                                   * 01200000
*        IECRES - GET CORE FOR WORK AREA AND BRANCH TO ANOTHER LOAD   * 01280002
*                                                                     * 01300002
*EXITS:  BRANCH TO IGG0325A FOR NON-VIO SPACE ALLOCATION.             * 01400002
*        BRANCH TO IGG0325I FOR VIO SPACE ALLOCATION.                 * 01420002
*                                                                     * 01660000
*TABLES/WORK AREAS: DADSM WORK AREA DESCRIBED BY MACRO 'IECALLWA'     * 01680002
*                                                                     * 01700000
*              ***************************************                * 01720000
*              *             DADSM TABLE             *                * 01740000
*              ***************************************                * 01760000
*                                                                     * 01780000
*              ***************************************                * 01800000
*              *        *         *                  *                * 01820000
*              *  TYPE  *  NO OF  *     USED HOLE    *                * 01840000
*              *  FLAG  * ENTRIES *      COUNTER     *                * 01860000
*              *        *         *                  *                * 01880000
*              ***************************************                * 01900000
*              *                  *                  *                * 01920000
*              *       RTA        *      RTA+1       *                * 01940000
*              *                  *                  *                * 01960000
*              ***************************************                * 01980000
*              *                  *                  *                * 02000000
*              *       RTA        *      RTA+1       *                * 02020000
*              *                  *                  *                * 02040000
*              ***************************************                * 02060000
*              *                  *                  *                * 02080000
*              *       RTA        *      RTA+1       *                * 02100000
*              *                  *                  *                * 02120000
*              ***************************************                * 02140000
*              *                  *                  *                * 02160000
*              *       RTA        *      RTA+1       *                * 02180000
*              *                  *                  *                * 02200000
*              ***************************************                * 02220000
*              *                  *                  *                * 02240000
*              *       RTA        *      RTA+1       *                * 02260000
*              *                  *                  *                * 02280000
*              ***************************************                * 02300000
*                                                                     * 02320000
*              TYPEFLG  =  02 - BPAM DIRECTORIES REQUESTED.           * 02340000
*                                                                     * 02344021
*                       =  40 - USER LABELS REQUESTED                 * 02348021
*                                                                     * 02352021
*                       =  80 - SET MUST COMPLETE IS ACTIVE           * 02356021
*                                                                     * 02360000
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.  * 02380000
*                                                                     * 02400000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.      * 02420000
*                                                                     * 02440000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT* 02460021
*                                                                     * 02480000
*ATTRIBUTES: REENTRANT                                                * 02500002
*                                                                     * 02520000
*NOTES:                                                               * 02540000
*   RETURN CODES THAT CAN BE ISSUED BY THE SPACE ALLOCATION FUNCTION. * 02560000
*                                                                     * 02580000
*   00 - SUCCESSFUL ALLOCATION                                        * 02600000
*                                                                     * 02620000
*   04 - DUPLICATE NAME DSCB EXISTS                                   * 02640000
*                                                                     * 02660000
*   08 - NO ROOM AVAILABLE IN THE VTOC                                * 02680000
*                                                                     * 02700000
*   0C - PERMANENT I/O ERROR                                          * 02720000
*                                                                     * 02740000
*   10 - REQUESTED ABSOLUTE TRACK NOT AVAILABLE                       * 02760000
*                                                                     * 02780000
*   14 - REQUESTED QUANTITY NOT AVAILABLE                             * 02800000
*                                                                     * 02820000
*   18 - AVERAGE RECORD LENGTH GREATER THAN 65,535 BYTES              * 02840000
*                                                                     * 02860000
*   1C - DSORG OR DISP WRONG IN ISAM INDEX REQUEST                    * 02861021
*                                                                     * 02862021
*   20 - NO PRIME AREA REQUESTED FOR ISAM                             * 02863021
*                                                                     * 02864021
*   24 - ISAM PRIME AREA MUST BE REQUESTED BEFORE OVFLOW              * 02865021
*                                                                     * 02866021
*   28 - SPACE PARAMETER WRONG - MUST BE ON CYLINDER BOUNDARY         * 02867021
*                                                                     * 02868021
*   2C - ISAM DSNAME ELEMENT DUPLICATION                              * 02869021
*                                                                     * 03020000
*   34 - INVALID JFCB OR PARTIAL DSCB POINTER                         * 03023021
*                                                                     * 03026021
*   38 - NOT ENOUGH SPACE ON VOLUME FOR DIRECTORY                     * 03029021
*                                                                     * 03032021
*   40 - INVALID USER LABEL REQUEST                                   * 03035021
*                                                                     * 03040021
*   4C - NO SPACE PARAMETER GIVEN FOR A NEW DATA SET OR               * 03046021
*        ZERO SPACE REQUESTED AT ABSOLUTE TRACK ZERO                  * 03048021
*                                                                     * 03050021
*   50 - INVALID REQUEST FOR ISAM INDEX                               * 03053021
*                                                                     * 03056021
*   54 - ISAM MULTIVOLUME INDEX NOT ALLOWED                           * 03059021
*                                                                     * 03062021
*   58 - ISAM DSNAME ELEMENT INVALID                                  * 03065021
*                                                                     * 03068021
*   5C - ISAM MULTIVOLUME OVFLOW REQUEST NOT ALLOWED                  * 03071021
*                                                                     * 03074021
*   60 - ABSTR AND CYL REQUESTS CONFLICT                              * 03077021
*                                                                     * 03080021
*   64 - CYL AND CONTIG REQUESTS CONFLICT                             * 03083021
*                                                                     * 03086021
*   68 - INVALID SPACE SUBPARAMETER                                   * 03089021
*                                                                     * 03092021
*   6C - PRIMARY SPACE REQUEST FOR AN ISAM DATA SET IS ZERO OR        * 03094021
*        PRIMARY SPACE IS ZERO FOR AN ABSTR REQUEST                   * 03096021
*                                                                     * 03098021
*   70 - ISAM INDEX REQUEST DUPLICATION                               * 03101021
*                                                                     * 03110021
*   80 - DIRECTORY SPACE REQUESTED IS LARGER THAN PRIMARY SPACE       * 03125021
*                                                                     * 03128021
*   84 - SPACE REQUEST MUST BE ABSTR FOR A DOS VOLUME                 * 03131021
*                                                                     * 03140021
*   8C - INDEX MUST BE REQUESTED BEFORE PRIME AREA                    * 03143021
*                                                                     * 03146021
*   90 - INVALID THIRD DD CARD FOR ISAM ALLOCATION                    * 03149021
*                                                                     * 03150002
*   94 - OVERLAPPING EXTENTS IN THE VTOC                              * 03152002
*                                                                     * 03154002
*   98 - OVERLAPPING DOS SPLIT CYLINDER EXTENTS IN THE VTOC           * 03156002
*                                                                     * 03158002
*   9C - DADSM ALLOCATION TERMINATED DUE TO POSSIBLE VTOC ERRORS      * 03160002
*                                                                     * 03162002
*   A0 - ISAM ALLOCATION TERMINATED DUE TO POSSIBLE VTOC ERRORS       * 03164002
*                                                                     * 03166002
*   A4 - ALLOCATION TERMINATED DUE TO DOS STACKED PACK FORMAT         * 03168002
*                                                                     * 03180000
*OTHER MACROS USED:                                                   * 03200002
*   IECSDSL1 - BUILD DSCB'S                                           * 03220000
*   IECDSECS - EXPAND THE CVT, RRPL, AND UCB DSECTS                   * 03260002
*   IECRPS - INITIALIZE FOR RPS PROCESSING                            * 03290002
*   IECALLWA - ALLOCATE WORK AREA EXPANSION                           * 03300002
*                                                                     * 03370021
*STORAGE: PROGRAM CODE - LESS THAN 1024 BYTES                         * 03380002
*   WORK AREA - AS DEFINED IN THE IECALLWA MACRO                 XM2969 03400002
*   RPS WORK AREA - AS DEFINED IN THE IECRPS MACRO               XM2969 03420002
*                                                                       03440000
*REGISTER USAGE-                                                        03460000
*                                                                       03480000
         BALR  BASEREG,0                                                03580000
         USING BEGINA,BASEREG                                           03600000
         USING ALLOCWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 03620002
         USING JFCB,RJFCBPTR            JFCB ADDRESSABILITY      Y02132 03640002
         USING UCB,RUCBPTRL                                             03660000
         USING CVT,RCVT                                                 03680000
*                                                                       03700000
REGZERO  EQU   0                                                        03720000
REGONE   EQU   1                                                        03740000
REGTWO   EQU   2                                                        03760000
REGTHREE EQU   3                                                        03800000
REGFOUR  EQU   4                                                        03840000
REGFIVE  EQU   5                                                        03880000
REGSIX   EQU   6                                                        03920000
REGSEVEN EQU   7                                                        03940000
RUCBPTRL EQU   7                        UCB POINTER                     03960000
REGEIGHT EQU   8                        WORK REGISTER                   03980000
RERRPASS EQU   8                        ERROR PASS REGISTER             04000000
REGNINE  EQU   9                        WORK REGISTER                   04040000
REGTEN   EQU   10                       WORK REGISTER                   04060000
RJFCBPTR EQU   11                       JFCB POINTER                    04080000
BASEREG  EQU   12                       BASE REGISTER                   04100000
RWKAREA  EQU   13                       WORK AREA POINTER               04120000
RBAK     EQU   14                                                       04140000
RCVT     EQU   15                                                       04160000
REGFTEN  EQU   15                       WORK REGISTER                   04180000
*                                                                       04183021
* OTHER EQUATES                                                         04186021
*                                                                       04189021
SCHEDKEY EQU   1                        SCHEDULER KEY            Y02132 04192002
ECBADDR  EQU   4                        OFFSET TO ECB PTR IN IOB Y02132 04194002
K4       EQU   4                        CONSTANT OF 4            Y02080 04195002
DMKEY    EQU   5                        DATA MANAGEMENT KEY      Y02132 04196002
CHNPGADR EQU   16                       OFFSET TO CHAN PROG ADDR Y02132 04197002
UNRELATD EQU   X'02'                    UNRELATED FLAG IN IOB    Y02132 04198002
RPSMSK   EQU   X'10'                    TESTS RPS BIT IN UCB     20201  04199020
SVRBREG2 EQU   40                       OFFSET TO REGISTER 2     Y02134 04200002
*                                                                       04210002
* * * * * * * * * * * * *                                               04220000
*                                                                       04240000
*                                                                       04260000
* * * * * * * * * * * * *                                               04280000
*                                                                       04300000
BEGINA   EQU   *                                                 O19117 04306019
         LR    RJFCBPTR,REGZERO         POSITION JFCB POINTER    O19117 04330019
         LA    REGTEN,DMKEY             INITIALIZE FOR DM KEY    Y02132 04331002
         LTR   RJFCBPTR,RJFCBPTR        TEST FOR PARTIAL DSCB    Y02132 04332002
         BM    LOADUCB                  BRANCH IF YES            Y02132 04333002
         TM    JFCFLGS1,JFCVRDS         TEST FOR VIO DATA SET    Y02132 04334002
         BNO   LOADUCB                  BRANCH IF NOT VIO D/S    Y02132 04335002
         LR    REGSEVEN,REGONE          PTR TO DEVICE CODE       Y02132 04336002
         LA    REGTEN,SCHEDKEY          OBTAIN CORE IN SCHED KEY Y02132 04337002
         B     OBTNWKA                  GO GET THE WORK AREA     Y02132 04338002
LOADUCB  EQU   *                         BRANCH LABEL            Y02132 04339002
         L     REGSEVEN,0(REGONE)        GET UCB POINTER                04340000
OBTNWKA  EQU   *                         BRANCH LABEL            Y02132 04360002
         L     REGTWO,SVRBREG2(REGFIVE)  LOAD DSAB LIST ADDRESS  Y02134 04380002
*                                                                       04400002
* THIS SECTION OBTAINS THE ALLOCATE WORK AREA.                          04410002
*                                                                       04420000
         IECRES GET,PREFIX=FIRST,LV=AWALNGTH,KEY=(REGTEN),       Y02132X04430002
               ID=ALWA,STM=(REGTWO,BASEREG,96(REGFIVE))          Y02080 04440002
         LR    RWKAREA,REGONE           PICK UP WORKAREA POINTER        04460000
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO AFTER Y02082X04470002
                                        ISSUING THE IECRES GET   Y02082 04480002
*                                                                       04490002
         IECRES LOAD,EXTPR=(RWKAREA),MODNM=LOAD1,BRANCH=NO       Y02080X04500002
                                        LET OPTIONAL TRACE PRINT Y02080X04510002
                                        THIS MODULE'S NAME       Y02080 04520002
*                                                                       04530002
         L     REGONE,IECRRPRM          RECOVERY RTN LIST ADDR   Y02144 04540002
         USING RRPLIST,REGONE           PARM LIST ADDRESSABILITY Y02144 04560002
         OI    RRFUNCTN,RRFALLOC        ALLOCATE FUNCTION BIT    Y02144 04580002
         DROP  REGONE                                            Y02144 04600002
*                                                                       04620000
         ST    REGTWO,ADSABLST          SAVE REGISTER 2 FOR ISAM Y02134 04640002
         ST    RJFCBPTR,AJFCBPTR        SAVE JFCB ADDRESS        Y02080 04650002
*                                                                       04660000
* THIS SECTION BUILDS A DEB                                             04680000
*                                                                       04700000
         MVI   DEB+16,X'01'             SET NUMBER OF EXTENTS = 1       04720000
         LA    REGONE,DCB               LOAD POINTER TO DCB             04740000
         L     RCVT,CVTPTR              LOAD COMM VECT TABLE BASE       04760000
         L     REGTWO,CVTXAPG           GET IOS APPENDAGE TABLE ADDR    04780000
         LR    REGTHREE,REGSEVEN        LOAD UCB POINTER                04800000
         SR    REGFOUR,REGFOUR          LOAD BB AND START CC            04804013
MAINUCB  LM    REGFIVE,REGSIX,EXTCON1   LOAD START HH,END CCHH AND TRKS 04856013
         STM   REGONE,REGSIX,DEB+24     STORE IN DEB                    04860000
         MVI   DEB+24,X'0F'             INSERT DEB ID                   04880000
         MVI   DEB+28,X'04'             INSERT EXTENT SCALE             04900000
         MVI   DEB+32,X'C0'             INSERT DEVICE MODE              04920000
*                                                                       04925002
* THIS SECTION BUILDS THE DCB, IOB, AND ECB.                            04930002
*                                                                       04935002
         LA    REGONE,DEB               DEB ADDRESS              Y02132 04940002
         ST    REGONE,DEBPTR            PUT DEB ADDRESS IN DCB   Y02132 04945002
         LA    REGTWO,ECB               ECB ADDRESS              Y02132 04950002
         ST    REGTWO,IOB+ECBADDR       PUT ECB ADDRESS IN IOB   Y02132 04955002
         OI    IOB,UNRELATD             SET UNRELATED BIT IN IOB Y02132 04960002
         LA    REGTWO,CCW1              PUT IN CHAN PROG POINTER Y02132 04965002
         LA    REGTHREE,DCB             PUT DCB POINTER IN IOB   Y02132 04970002
         STM   REGTWO,REGTHREE,IOB+CHNPGADR  STORE IN IOB        Y02132 04975002
         LA    REGFOUR,VIOLOAD          INIT. BRANCH REGISTER    Y02132 04980002
         LTR   RJFCBPTR,RJFCBPTR        TEST FOR PARTIAL DSCB    Y02132 04985002
         BM    RPSTEST                  BRANCH IF YES            Y02132 04990002
         TM    JFCFLGS1,JFCVRDS         TEST FOR VIO DATA SET    Y02132 04995002
         BO    LOADRTN                  BRANCH IF VIO D/S        Y02132 05000002
*                                                                       05020020
*********************************************************************** 05120020
*   TEST FOR THE RPS FEATURE AND ISSUE THE IECRPS MACRO               * 05220002
*********************************************************************** 05420020
*                                                                       05520020
RPSTEST  EQU   *                        BRANCH LABEL             Y02132 05540002
         TM    UCBTBYT2,RPSMSK          DOES DEVICE HAVE RPS     20201  05620020
         BNO   NONRPS                   BRANCH IF NOT            A42446 05720021
         LA    REGFOUR,DEB              GET DEB'S ADDRESS        20201  06020020
         IECRPS RDEB=REGFOUR,WKREG1=REGNINE,EXTPR=RWKAREA        YM3997X06120002
                                        INITIALIZE FOR RPS       YM3997X06220002
                                        PROCESSING              SA53147 06320002
         MVC   WTGMODNM,LOAD1           RESTORE MODULE NAME      YM5371 06330002
*                                                                       08220020
NONRPS   EQU   *                                                 A42446 08420021
         LA    REGFOUR,LOAD2            NONZERO VALUE FOR REG 4  Y02132 08620002
LOADRTN  EQU   *                        BRANCH LABEL             Y02132 08640002
       IECRES LOAD,EXTPR=(RWKAREA),MODNM=(REGFOUR),BRANCH=DIRECT Y02132 08820002
*                                                                       10060000
* * * * * * * * * * * * *                                               10080000
*                                                                       10100000
***   CONSTANTS                                                         10120000
*                                                                       10140000
* * * * * * * * * * * * *                                               10160000
*                                                                       10180000
         DS    0F                                                       10200000
EXTCON1  DC    X'0000'                  BEGINNING CCHH FOR DEB   A40967 10210021
ENABLE   DC    X'FFFFFFFF7FFF'          ENDING CCHH FOR DEB      A40967 10220021
*                                                                       10400000
*** TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                     10410002
*                                                                       10420021
         XCTLTABL ID=(LOAD1,IGC0003B,LOAD2,IGG0325A,VIOLOAD,     Y02132X10440002
               IGG0325I,RPS19EK,IGG019EK),SVC=032,LENGTH=,       YM3997X10460002
               BRT=YES                                           YM3997 10470002
         SPACE 2                                                 Y02144 10480002
         IECDSECS CVT,RRPL,UCB,EXPAND=YES                        Y02144 10500002
*                                                                       11000000
* * * * * * * * * * * * *                                               11020000
*                                                                       11040000
***   WORKAREA                                                          11060000
*                                                                       11080000
* * * * * * * * * * * * *                                               11100000
*                                                                       11120000
DSCBWKAR IECALLWA EP,ADT=YES            ALLOCATE WORK AREA       Y02144 11140002
         EJECT                                                   Y02080 13300002
JFCB     DSECT                          JFCB DSECT               Y02132 13320002
         IEFJFCBN                                                Y02132 13340002
         END   IGC0003B                                         SA53147 13480002
./  ADD  SSI=72590404,NAME=IGC00030
         TITLE 'IGC00030 - DADSM RENAME - ENTRY POINT'           Y02082 00020002
IGC00030 CSECT                                                          00043000
*          RELEASE 15 DELETIONS                                       * 00046000
*1652                                                                   00047000
*          RELEASE 16 DELETIONS                                       * 00049000
*          RELEASE 17 DELETIONS                                       * 00052000
*3242000430,000730,020400,020600                                   MC0M 00053000
*3242029720                                                       17762 00054000
*          RELEASE 18 DELETIONS                                       * 00055000
*3522029700-029720,030800-030900                                  25343 00055518
*3522030900                                                       22000 00056018
*          RELEASE 19 DELETIONS                                       * 00058000
*          RELEASE 20 DELETIONS                                       * 00061000
*2162                                                            M0013  00062020
*2162056800                                                      20201  00063020
*          RELEASE 21 DELETIONS                                       * 00064000
*1231000400,004200-004400,024400-025000,047800-049800,052800,    A38860 00065021
*1231056200-056400,057000,065000-065300,065600,079700            A38860 00066021
*0000023000,063800                                              SA49351 00066421
*          RELEASE 21.7 DELETIONS                                       00066502
*0000004200-004400,020002-020120,020200-020400,023400-023800,   SA53147 00066602
*0000025200,034800-053800,060600-063660,065200-065400           SA53147 00066702
*0000020161-020162,026200                                       SA57261 00066802
*          RELEASE 22 DELETIONS                                       * 00067000
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00070002
*0000000030-000150,000700,001200,004800-005000,005600-007000,    Y02080 00070102
*0000007800-008000,012800-013600,015700-015800,021200,021700-    Y02080 00070202
*0000021920,021960-023000,025600-025800,029480-029720,030840-    Y02080 00070302
*0000030910,031900,032000-032700,033100-033200,034000,034300-    Y02080 00070402
*0000034400,035100,056600-056900,058830-059100,060600,063720-    Y02080 00070502
*0000064200,065000,066000-067200,071000-079800,080400,081200     Y02080 00070602
*0000081000-081200                                               Y02078 00070702
*0000000200,001600-003200,005200-006000,007300-007600,008400,    Y02082 00070802
*0000012400-014800,015700-015800,020020-020164,026200-029480,    Y02082 00070902
*0000030200-030400,031000-031100,033600,034200,035100-060200,    Y02082 00071002
*0000061100,065500-065600,071100-080800                          Y02082 00071102
*0000018440,027910,028060,028180                                 Y02132 00071402
*0000065400                                                      Y02144 00071602
*0000027010                                                      YM1312 00071702
*0000                                                            YM1241 00071802
*0000037000,038000,043240-043250,043280,043300,054000-054100     YM1337 00071902
*0000027610-027700,029350,047400,065250-065300,066650-066700     YM1063 00072002
*0000040200                                                      YM3960 00072102
*0000030100,030400,048400,051200                                 YM7036 00072502
*0000038200,040200,065050,065150                                 YM2880 00073902
*0000065450                                                      YM2887 00074002
*0000027760                                                      YM2895 00074202
*0000024090-024120                                               YM5748 00074302
*0000                                                            YM5399 00074402
*                                                                       00092402
*                                                                       00094302
* STATUS CHANGE LEVEL 003                                               00096202
*                                                              @G60ASBJ 00096560
*        SU60 CHANGES/DELETIONS                                @G60ASBJ 00096660
*A 020106,021650,022800,023000-023100,060800,060940            @G60ASBJ 00096760
*C 001060,001450,022900                                        @G60ASBJ 00096860
*D 060900-061000                                               @G60ASBJ 00097260
*                                                              @G60ASBJ 00097460
*   IGC00030 IS THE STANDARD MODULE NAME FOR IGC0003&              MC0M 00098102
*                                                                       00100000
*MODULE NAME - IGC00030                                                 00104002
*                                                                       00106002
*DESCRIPTIVE NAME - DADSM RENAME                               @G60ASBJ 00108060
*                                                                       00110002
*COPYRIGHT - NONE                                                       00112002
*                                                                       00114002
*CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD           00116002
*                                                                       00118002
*ATTRIBUTES - REENTRANT                                                 00120002
*                                                                       00140000
*FUNCTION - THIS MODULE IS THE  BEGINNING OF RENAME.   AFTER OBTAINING  00145060
*          THE RENAME WORK AREA, IT ISSUES AN ENQ ON THE TIOT.  IF      00150002
*          THIS RESOURCE IS UNAVAILABLE, THE DATA SET IS IN THE PROCESS 00155002
*          OF BEING OPENED OR CLOSED AND THEREFORE CANNOT BE RENAMED.   00160002
*          THIS MODULE THEN ATTEMPTS TO FIND A PRIMARY (DEMOUNTABLE)    00165002
*          UCB ADDRESS.  IF A UCB ADDRESS WAS SUPPLIED BY THE CALLER,   00170002
*          THE TIOT IS SEARCHED TO SEE IF THE UNIT IS ALLOCATED TO      00175002
*          THE JOB.  IF ALLOCATED, THE UNIT IS TESTED TO DETERMINE      00180002
*          IF ITS ASSOCIATED VOLUME CAN BE DEMOUNTED.  IF NO UCB        00185002
*          ADDRESS WAS SUPPLIED OR IF THE SUPPLIED ADDRESS IS EITHER    00190002
*          NOT ALLOCATED OR NOT DEMOUNTABLE, THE TIOT IS SEARCHED TO    00195002
*          SEE IF ANY VOLUME IN THE VOLUME LIST IS MOUNTED ON A UNIT    00200002
*          ALLOCATED TO THE JOB.  IF A VOLUME IS MOUNTED, ITS UCB IS    00205002
*          TESTED FOR DEMOUNTABILITY.  IF A UCB IS FOUND THAT IS BOTH   00210002
*          ALLOCATED AND DEMOUNTABLE, IT BECOMES THE PRIMARY UCB.       00215002
*          BEFORE BRANCHING TO THE NEXT LOAD OF RENAME, THIS MODULE     00220002
*          ISSUES AN ENQ ON THE DATA SET NAME.  IF THE RETURN CODE      00225002
*          INDICATES THAT THE TASK PREVIOUSLY HAD CONTROL OF THE        00230002
*          RESOURCE, THE ENQ IS REISSUED TO OBTAIN EXCLUSIVE CONTROL    00235002
*          AND A BIT IS SET TO INDICATE A DEB SEARCH MUST BE DONE       00240002
*          IN MODULE IGG03001 TO ENSURE NO ONE IS CURRENTLY OPEN TO     00245002
*          THE DATA SET.  IF THE RETURN CODE FROM EITHER ENQ INDICATES  00250002
*          THAT THE RESOURCE IS UNAVAILABLE, THE DATA SET IS OPEN AND   00255002
*          THERFORE CANNOT BE RENAMED.  IF THE DATA SET IS DETERMINED   00260002
*          TO BE A VIO DATA SET, IT IS NOT RENAMED.                     00265002
*          FOR ANY ERROR CONDITIONS IN THIS MODULE, THE TIOT IS         00270002
*          DEQ'ED (IF IT WAS ENQ'ED), THE WORK AREA IS FREED, AND       00275002
*          CONTROL IS RETURNED TO THE CALLER WITH AN APPROPRIATE        00280002
*          ERROR CODE IN REGISTER 15.  FOR SOME ERROR CONDITIONS        00285002
*          (AS NOTED UNDER 'ERROR CONDITONS'), AN ERROR CODE IS SET     00290002
*          IN THE STATUS BYTE OF EACH VOLUME LIST ENTRY.                00295002
*                                                                       00400000
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGC00030. ENTRY IS    00420002
*          MADE FROM IGG030DU.                                 @G60ASBJ 00440060
*                                                                       00460000
*SUPERVISOR CALLS AND EXTERNAL ROUTINES USED BY THIS MODULE -           00480002
*          DEQ(48)   - DEQ'S ON SYSZTIOT                                00500002
*          ENQ(56)   - ENQ'S ON SYSZTIOT AND SYSDSN                     00520002
*          TESTAUTH  - DETERMINES IF THE CALLER IS AUTHORIZED,          00540002
*                      IN SUPERVISOR STATE, OR IN KEY ZERO              00560002
*          MODESET   - SWITCHES TO THE CALLER'S KEY                     00580002
*          SETLOCK   - OBTAINS/RELEASES THE LOCAL MEMORY LOCK           00600002
*          IEC0VL00  - CHECKS THE VALIDITY OF THE VOLUME LIST ADDRESS   00620002
*          IECRES    - OBTAINS AND FREES THE WORK AREA                  00640002
*                    - BRANCHES TO THE NEXT LOAD OF RENAME              00660002
*                                                                       00680002
*OTHER MACROS USED:                                                     00720000
*          IECDSECS - EXPANDS THE CVT, DSAB, JSCB, PSA, QDB, RB,        00730002
*                     RRPL, TIOT, TCB, AND UCB DSECTS                   00735002
*          IDDVDSCB - EXPANDS THE VDSCB                                 00740002
*          IECRENWA - EXPANDS THE RENAME WORK AREA                      00750002
*          XCTLTABL - BUILDS A LIST OF MODULE NAMES AND ADDRESSES       00760002
*                                                                       00770002
*INPUT -   AT ENTRY TO THIS MODULE, REGISTER 1 POINTS TO THE            00780002
*          PARAMETER LIST. REGISTER 0 MAY OR MAY NOT CONTAIN A UCB      00820000
*          ADDRESS. THE PARAMETER LIST CONSISTS OF FOUR WORDS:          00840002
*                    WORD 1 - RENAME = X'41002000'                      00860000
*                    WORD 2 - ADDR OF OLD DATA SET NAME                 00880000
*                    WORD 3 - ADDR OF NEW DATA SET NAME                 00900000
*                    WORD 4 - ADDR OF VOLUME LIST                       00920000
*          THE VOLUME LIST IS VARIABLE IN LENGTH. THE FIRST TWO BYTES   00940000
*          INDICATE THE NUMBER OF 12 BYTE VOLUME ID FIELDS WHICH        00960000
*          FOLLOW. A 12 BYTE VOLUME ID FIELD CONTAINS A FOUR BYTE       00980000
*          DEVICE CODE, SIX BYTE VOLUME SERIAL NUMBER, ONE BYTE SPARE,  01000000
*          AND ONE BYTE USED FOR RETURNING THE STATUS OF THE DATA SET   01020000
*          ON THAT VOLUME AS FOLLOWS:                                   01040000
*                    BINARY 0 - SUCCESSFUL RENAME                       01060000
*                    BINARY 1 - DSCB NOT FOUND IN VTOC                  01080000
*                    BINARY 2 - PASSWORD DIFFICULITY                    01100000
*                    BINARY 3 - DUPLICATE NAME EXISTS                   01120002
*                    BINARY 4 - PERMANENT I/O ERROR                     01140000
*                    BINARY 5 - APPROPRIATE UCB UNAVAILABLE             01160000
*                    BINARY 6 - OPERATOR UNABLE TO MOUNT VOLUME         01180000
*                    BINARY 7 - DATA SET IS OPEN                        01190002
*                                                                       01200000
*OUTPUT -  REGISTER 9 POINTS TO THE CVT, AND REGISTER 10 POINTS TO      01240002
*          THE PARAMETER LIST.  REGISTER 13 POINTS TO THE WORK AREA,    01260002
*          IN WHICH 'VOLNUM' CONTAINS THE NUMBER OF VOLUMES TO BE       01280002
*          RENAMED, AND 'VOLPTR' CONTAINS THE ADDRESS OF THE FIRST      01290002
*          VOLUME IN THE VOLUME LIST.  'PRUCBPTR' CONTAINS THE PRIMARY  01300002
*          (DEMOUNTABLE) UCB ADDRESS, IF ONE IS AVAILABLE.              01320002
*                                                                       01340002
*ERROR CONDITONS - UPON RETURN TO THE CALLER, REGISTER 15 CONTAINS      01360002
*          ONE OF THE FOLLOWING VALUES TO INDICATE THE COMPLETION       01380002
*          STATUS OF THE RENAME FUNCTION:                               01400002
*              00 - SUCCESSFUL COMPLETION                               01420002
*              04 - NO UNIT AVAILABLE FOR MOUNTING ANY OF THE VOLUMES   01440002
*                   IN THE VOLUME LIST.  THE STATUS BYTE OF EACH ENTRY  01460002
*                   IN THE VOLUME LIST IS SET TO X'05'.                 01480002
*              08 - UNABLE TO RENAME ON ONE OR MORE VOLUMES. THIS CODE  01500000
*                   IS ACCOMPANIED BY A SETTING OF THE VOLUME STATUS    01520000
*                   BYTE AS DESCRIBED UNDER 'INPUT'.                    01540000
*              12 - THE NUMBER OF VOLUMES IN THE VOLUME LIST WAS ZERO,  01550002
*                   OR THE VOLUME LIST WAS NOT IN THE USER'S REGION.    01552002
*                                                                       01560000
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    01570002
*          WORK AREA = 676 BYTES                                        01580002
*                                                                       01590021
*                                                                       01600000
*REGISTER USAGE:                                                        01620000
R0       EQU   0                                                        01640000
R1       EQU   1                                                        01660000
RUCBSAVE EQU   1                        CALLER'S UCB ADDRESS     Y02082 01670002
R2       EQU   2                                                        01680000
RDSAB    EQU   2                        POINTER TO THE DSAB      Y02082 01690002
R3       EQU   3                                                        01700000
RTIOT    EQU   3                        POINTER TO THE TIOT      Y02082 01710002
P1       EQU   3                                                        01720000
R4       EQU   4                                                        01740000
REND     EQU   4                        POINTER TO END OF ENTRY  Y02082 01750002
P2       EQU   4                                                        01760000
R5       EQU   5                                                        01780000
VOLCTR   EQU   5                       NUMBER OF VOLUMES                01800000
P4       EQU   6                                                        01820000
R7       EQU   7                                                        01830000
VOLISTX  EQU   8                       VOLUME LIST POINTER              01840000
SVRBREG  EQU   8                       POINTER TO SVRB           Y02080 01842002
R9       EQU   9                                                        01860000
RCVT     EQU   9                       CVT POINTER                      01880000
PL       EQU   10                      PARAMETER LIST POINTER           01900000
RERRSAVE EQU   10                       ERROR CODE SAVE REGISTER Y02132 01910002
RUCB     EQU   11                      UCB POINTER                      01920000
RBASE    EQU   12                                                       01940000
RWKAREA  EQU   13                      WORKAREA POINTER                 01960000
RETURN   EQU   14                                                       01980000
R15      EQU   15                       EQUATE FOR REGISTER 15   Y02080 01990002
WORKREG  EQU   15                                                       02000000
*                                                                       02001002
* OTHER EQUATES                                                         02002002
*                                                                       02003002
K0       EQU   0                        CONSTANT OF 0            Y02082 02004002
K1       EQU   1                        CONSTANT OF 1            Y02082 02005002
K2       EQU   2                        CONSTANT OF 2            Y02080 02006002
K3       EQU   3                        CONSTANT OF 3            Y02082 02007002
NONZERO  EQU   4                        NON-ZERO VALUE           YM1312 02007502
K4       EQU   4                        CONSTANT OF 4            Y02080 02008002
K8       EQU   8                        CONSTANT OF 8            Y02132 02008202
K12      EQU   12                       CONSTANT OF 12           Y02080 02009002
RTNCODE8 EQU   8                        RETURN CODE OF 8         Y02082 02010002
K16      EQU   16                       CONSTANT OF 16           Y02132 02010202
K44      EQU   44                       CONSTANT OF 44         @G60ASBJ 02010660
NOLIST   EQU   12                       ERROR CODE FOR EMPTY    SA57261 02011002
*                                       VOL LIST                SA57261 02012002
VOLSER   EQU   4                        OFFSET TO THE VOLSER IN  Y02082 02013002
*                                       A VOLUME LIST ENTRY      Y02082 02014002
STATUS   EQU   11                       OFFSET TO STATUS BYTE    Y02082 02015002
ENTRYL   EQU   12                       VOLUME LIST ENTRY LENGTH Y02082 02016002
OPENDS   EQU   X'07'                    OPEN DATA SET ERROR      Y02082 02017002
RTNCODE4 EQU   4                        RETURN CODE OF 4         Y02132 02018002
NOF1     EQU   X'01'                    NO F1 DSCB ERROR CODE    Y02132 02019002
NODEVERR EQU   X'05'                    NO DEVICE ERROR CODE     Y02132 02020002
BLANK    EQU   C' '                     EBCDIC BLANK             YM2880 02021002
*                                                                       02040002
         BALR  RBASE,R0                                                 02080000
         USING BEGIN,RBASE                                              02100000
         USING RENAMWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 02120002
         USING UCB,RUCB                                                 02140000
         USING CVT,RCVT                                                 02160000
         USING RBBASIC,SVRBREG          SVRB ADDRESSABILITY    @G60ASBJ 02165060
*                                                                       02170002
* THIS SECTION OBTAINS THE RENAME WORK AREA.                            02180002
*                                                                       02190002
BEGIN    EQU   *                                                 Y01077 02194000
         LPR   PL,R1                    LOAD PARAMETER LIST ADDR Y02080 02200002
         LR    RUCB,R0                  LOAD UCB ADDRESS         Y02080 02220002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02080 02240002
         L     SVRBREG,0(R4)            LOAD SVRB ADDRESS        Y02080 02260002
         ST    RETURN,RBEXSAVE+44       SAVE REGISTER 14       @G60ASBJ 02280060
         IECRES GET,PREFIX=FIRST,LV=RWALNGTH,ID=REWA,            Y02080X02285060
               STM=(R2,RBASE,RBEXSAVE)                         @G60ASBJ 02290060
         LR    RWKAREA,R1              LOAD BASE REG FOR WORK AREA      02295060
         L     RETURN,RBEXSAVE+44      RESTORE REGISTER 14     @G60ASBJ 02300060
         ST    RETURN,RENSAVE          SAVE R14 IN RENAME WORK @G60ASBJX02305060
                                       AREA                    @G60ASBJ 02310060
         MODESET EXTKEY=ZERO           RETURN TO KEY ZERO AFTER  Y02082X02325002
                                       ISSUING THE IECRES GET    Y02082 02330002
*                                                                       02335002
         IECRES LOAD,MODNM=LOAD1,EXTPR=(RWKAREA),BRANCH=NO       Y02080X02340002
                                        LET OPTIONAL TRACE PRINT Y02080X02345002
                                        THIS MODULE'S NAME       Y02080 02350002
*                                                                       02355002
         L     R1,IECRRPRM             RECOVERY RTN LIST ADDR    Y02144 02360002
         USING RRPLIST,R1              PARM LIST ADDRESSABILITY  Y02144 02365002
         OI    RRFUNCTN,RRFRENAM       SET RENAME FUNCTION BIT   Y02144 02370002
         DROP  R1                                                Y02144 02375002
*                                                                       02380002
         ST    R4,TCBADDR              SAVE INPUT TCB ADDRESS    Y02078 02385002
         ST    PL,OLDPLPTR             STORE PARAMETER LIST POINTER     02400000
         L     P1,K12(,PL)              LOAD ADDRESS OF VOL LIST YM5399 02401002
         LRA   P1,K0(,P1)               LOAD REAL ADDRESS OF     YM5399X02402002
                                        VOLUME LIST              YM5399 02406002
         BC    5,EXIT                   BR IF INVALID (INVALID   YM5748 02409002
*                                       SEGMENT TABLE ENTRY OR   YM5748 02412002
*                                       INVALID SEGMENT OR PAGE  YM5399 02415002
*                                       TABLE LENGTH)            YM5399 02418002
         LM    P1,P4,0(PL)             LOAD PARAMETER LIST              02420000
*                                       P1 = RENAME OPTIONS             02440021
*                                       P2 = OLD DATA SET NAME ADDRESS  02460021
*                                       P3 = NEW DATA SET NAME ADDRESS  02480021
*                                       P4 = VOLUME LIST ADDRESS        02500021
         MVC   PDSNAME,K0(P2)          SAVE DSNAME IN PROTECTED  YM1337 02505002
*                                      WORK AREA                 YM1337 02510002
         LA    P2,PDSNAME              GET ADDR OF PROTECTED     YM1337 02515002
*                                      DSNAME                    YM1337 02516002
         ST    P2,DSMADTW3             SAVE ADDR OF DSNAME       Y02144 02520002
         OI    SISW1,NOSMFRCD          SET NO SMF RECORD SWITCH  Y02082 02530002
*                                      UNTIL AT LEAST ONE RENAME Y02082 02540002
*                                      IS SUCCESSFUL             Y02082 02550002
         MVC   VOLNUM,0(P4)            MOVE NUMBER OF VOLUMES    Y02080 02560002
         LH    VOLCTR,VOLNUM           LOAD NBR OF VOLS IN LIST  Y02080 02580002
         LTR   VOLCTR,VOLCTR           IS LIST EMPTY                    02600000
         BNP   EXIT                    BRANCH IF YES             Y02082 02620002
*                                                                       02623002
* THIS SECTION CHECKS IF THE VOLUME LIST ADDRESS IS WITHIN THE USER'S   02626002
* REGION.  IF THE CALLER IS IN SUPERVISOR STATE OR IN KEY ZERO, THE     02629002
* VOLUME LIST ADDRESS DOES NOT HAVE TO BE CHECKED.                      02632002
*                                                                       02635002
VALCHECK EQU   *                        VALIDITY CHECK           Y02078 02638002
         TESTAUTH FCTN=1,KEY=YES,STATE=YES,BRANCH=YES  TEST IF   Y02078X02641002
                                        CALLER IS IN KEY 0 OR    Y02078X02644002
                                        IN SUPERVISOR STATE      Y02078 02647002
         LTR   R15,R15                  TEST IF ANY TRUE         Y02078 02650002
         BZ    BYPASS                   BRANCH IF YES            Y02078 02653002
*                                                                       02656002
* THIS SECTION CALCULATES THE STARTING AND ENDING ADDRESSES OF          02659002
* THE AREA TO BE CHECKED.                                               02662002
*                                                                       02665002
         MH    VOLCTR,TWELVE            12 TIMES THE NBR OF VOLS Y02078 02666002
         LA    VOLCTR,K1(VOLCTR)        ADD ONE                  Y02078 02668002
         LA    R1,0(P4)                 STARTING ADDRESS         Y02078 02671002
         LR    R2,R1                                             Y02078 02674002
         AR    R2,VOLCTR                ADDRESS OF THE LAST BYTE Y02078 02677002
*                                       OF THE VOLUME LIST       Y02078 02680002
         STM   RUCB,P1,IECREGSV+K12     SAVE REGISTERS 11-3      Y02078 02683002
         L     R4,TCBADDR               TCB ADDRESS IN REG 4     Y02078 02684002
         LR    R7,RWKAREA               SAVE WORK AREA ADDRESS   Y02078 02686002
         XR    R5,R5                    INITIALIZE REGISTER      YM1241 02687002
OBTNLOCK SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02078X02689002
               RELATED=(LOCAL,IGC00030(RLSELOCK))  OBTAIN LOCK   Y02078 02692002
         LM    RUCB,RETURN,IECREGSV+K12-RENAMWKA(R7) RSTORE REGS YM1241 02693002
         L     R15,CVT0VL00             VALIDITY CHECK RTN ADDR  Y02078 02695002
         BALR  RETURN,R15               LINK TO VALIDITY CHECK   Y02078 02698002
         BZ    RLSELOCK                 BRANCH IF VALID ADDRESS  YM1312 02700002
         LA    R5,NONZERO               INDICATE INVALID ADDRESS YM1312 02701002
*                                                                       02702002
RLSELOCK SETLOCK RELEASE,TYPE=LOCAL,                             Y02078X02704002
               RELATED=(LOCAL,IGC00030(OBTNLOCK))  RELEASE LOCK  Y02078 02707002
         LM    RUCB,P1,IECREGSV+K12-RENAMWKA(R7)  RESTORE REGS   Y02078 02708002
         LTR   R5,R5                    TEST IF ADDRESS VALID    Y02078 02713002
         BNZ   EXIT                     BRANCH IF NOT VALID      Y02078 02716002
*                                                                       02719002
* THIS SECTION ATTEMPTS TO ENQ ON THE TIOT.  IF THE ENQ FAILS, THEN     02722002
* THE RENAME CANNOT PROCEED, SINCE THE CURRENT TASK ALREADY HAD         02725002
* CONTROL OF THE RESOURCE.                                              02728002
*                                                                       02731002
BYPASS   EQU   *                        ENQ ON TIOT             Y02082  02734002
         LH    VOLCTR,VOLNUM            RELOAD NUMBER OF VOLUMES Y02082 02737002
         L     RDSAB,TCBADDR            LOAD TCB ADDRESS         Y02082 02740002
         USING TCB,RDSAB                TCB ADDRESSABILITY       Y02082 02743002
         L     RDSAB,TCBJSCB            GET JSCB ADDRESS         Y02082 02746002
         USING IEZJSCB,RDSAB            JSCB ADDRESSABILITY      Y02082 02749002
         L     RDSAB,JSCBACT            GET ACTIVE JSCB ADDRESS  Y02082 02752002
         L     RDSAB,JSCDSABQ           GET DSAB QDB ADDRESS     Y02082 02755002
         ST    RDSAB,DSABQDB            SAVE FOR TIOT ENQ        Y02082 02758002
         L     R2,CVTTCBP               LOAD TCB/ASID POINTERS   YM1063 02760002
         L     R2,K12(,R2)              LOAD CURRENT ASID ADDR   YM1063 02762002
         USING ASCB,R2                  ASCB ADDRESSABILITY      YM1063 02764002
         MVC   TIOTMNR(K2),ASCBASID     MOVE ASID INTO ENQ MINOR YM1063 02766002
*                                       RESOURCE NAME            YM1063 02768002
         DROP  R2                                                YM1063 02770002
         MVC   MJNAME(L'TIOTMJR),TIOTMJR  MAJOR RESOURCE NAME    Y02082 02773002
         MVC   ENQAREA(ENQLTH1),ENQLIST1  MOVE IN PARAMETER LIST YM2895 02776002
         ENQ   (MJNAME,TIOTMNR),MF=(E,ENQAREA)  ENQ ON SYSZTIOT  Y02082 02779002
         LTR   R15,R15                  TEST IF SUCCESSFUL ENQ   Y02082 02782002
         BZ    SETENQSW                 BRANCH IF YES            Y02082 02785002
*                                                                       02786002
         LA    VOLISTX,K2(P4)           ADDRESS OF FIRST VOLUME  Y02082 02788002
OPENERR  EQU   *                        OPEN DATA SET ERROR      Y02082 02788502
         LA    R3,OPENDS                OPEN DATA SET ERROR CODE Y02132 02789002
         B     SETERRCD                 GO SET THE ERROR CODE    Y02132 02789502
NOF1DSCB EQU   *                        NO F1 DSCB ERROR         Y02132 02790002
         LA    R3,NOF1                  NO F1 DSCB ERROR CODE    Y02132 02790502
SETERRCD EQU   *                        RETURN CODE              Y02132 02791002
         LA    RERRSAVE,RTNCODE8        RETURN CODE OF 8         Y02132 02791502
SETSTATS EQU   *                        SET ERROR CODE IN VOLIST Y02132 02792002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 02794002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 02797002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 02800002
ERRLOOP  EQU   *                        MORE VOLUMES             Y02082 02803002
         STC   R3,STATUS(VOLISTX)       SET ERROR CODE IN VOLIST Y02132 02803502
         LA    VOLISTX,ENTRYL(VOLISTX)  NEXT VOL LIST ENTRY ADDR Y02082 02809002
         BCT   VOLCTR,ERRLOOP           BRANCH IF MORE VOLUMES   Y02082 02812002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 02815002
         B     DEQTEST                  GO PREPARE TO EXIT       Y02082 02821002
*                                                                       02822002
SETENQSW EQU   *                        SET TIOT ENQ'ED SWITCH   Y02082 02824002
         LA    R1,TIOTMNR               MINOR RESOURCE NAME ADDR Y02144 02825002
         ST    R1,DSMADTW2              SAVE MINOR NAME ADDR     Y02144 02826002
         OI    SISW1,TIOTENQ            SET TIOT ENQ'ED SWITCH   Y02082 02827002
         OI    DSMADTB2,DSMTIOTE        SET TIOT ENQ'ED SWITCH   Y02144 02828002
*                                                                       02829002
         LA    VOLISTX,K2(P4)           ADDRESS OF FIRST VOLUME  Y02082 02830002
         LTR   RUCBSAVE,RUCB            TEST FOR PASSED UCB ADDR Y02082 02833002
         BZ    FINDUNIT                 BRANCH IF ZERO           Y02082 02836002
         LA    RUCBSAVE,K0(RUCBSAVE)    CLEAR HIGH BYTE          Y02082 02839002
         TM    UCBJBNR,UCBVRDEV         TEST IF A VIRTUAL UCB    Y02132 02842002
         BZ    USERSUCB                 BRANCH IF NOT            Y02132 02845002
         ST    RUCB,PRUCBPTR            SAVE INPUT UCB ADDRESS   Y02132 02848002
         B     VIODSTST                 BRANCH TO VIO D/S TEST   Y02132 02851002
*                                                                       02857002
* IF THE USER SUPPLIED A UCB ADDRESS, THIS SECTION SEARCHES THE         02860002
* TIOT TO DETERMINE IF THE UNIT IS ALLOCATED TO THE JOB.  IF IT IS      02863002
* ALLOCATED, IT BECOMES THE PRIMARY UCB IF IT IS DEMOUNTABLE.           02866002
*                                                                       02869002
USERSUCB EQU   *                        USER SUPPLIED A UCB ADDR Y02082 02872002
         L     RDSAB,DSABQDB            LOAD DSAB QDB ADDRESS    Y02082 02875002
         USING QDB,RDSAB                QDB ADDRESSABILITY       Y02082 02878002
         L     RDSAB,QDBFELMP           GET FIRST DSAB ADDRESS   Y02082 02881002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02082 02884002
UDSABTST EQU   *                        DSAB TEST                Y02082 02887002
         LTR   RDSAB,RDSAB              IS THERE ANOTHER DSAB    Y02082 02890002
         BZ    FINDUNIT                 BRANCH IF NOT            Y02082 02893002
         L     RTIOT,DSABTIOT           LOAD TIOT ADDRESS        Y02082 02896002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02082 02899002
         SR    REND,REND                ZERO REGISTER FOR IC     Y02082 02902002
         IC    REND,TIOELNGH            LENGTH OF TIOT ENTRY     Y02082 02905002
         AR    REND,RTIOT               ADDRESS OF FIRT BYTE     Y02082 02908002
*                                       PAST THE TIOT ENTRY      Y02082 02911002
         LA    RTIOT,TIOEFSRT-K1        ADDR OF FIRST UCB ADDR   Y02082 02914002
UNEXTUCB EQU   *                        END OF ENTRY             Y02082 02917002
         CR    RTIOT,REND               TEST IF AT END OF ENTRY  Y02082 02920002
         BNL   UNXTDSAB                 BRANCH IF YES            Y02082 02923002
         L     RUCB,K0(,RTIOT)          GET UCB ADDRESS          Y02082 02926002
         LA    RUCB,K0(RUCB)            CLEAR HIGH BYTE          Y02082 02929002
         LTR   RUCB,RUCB                IS THERE A UCB ADDRESS   Y02082 02932002
         BZ    UINCRPTR                 BRANCH IF NOT            YM1063 02935002
         CR    RUCB,RUCBSAVE            TEST IF EQUAL TO THE     Y02082 02938002
*                                       USER-SUPPLIED UCB ADDR   Y02082 02941002
         BE    LINKTEST                 BRANCH IF YES            Y02082 02944002
UINCRPTR EQU   *                                                 YM1063 02945002
         LA    RTIOT,L'TIOESTTB+L'TIOEFSRT(RTIOT)   INCREMENT TO Y02082 02947002
*                                       NEXT UCB ADDRESS IN TIOT Y02082 02950002
         B     UNEXTUCB                 GO TRY NEXT UCB ADDRESS  Y02082 02953002
*                                                                       02954002
UNXTDSAB EQU   *                        GET NEXT DSAB            Y02082 02956002
         L     RDSAB,DSABFCHN           GET NEXT DSAB ADDRESS    Y02082 02959002
         B     UDSABTST                 GO TEST IT               Y02082 02962002
*                                                                       02964002
* THIS SECTION LINKS TO A ROUTINE THAT DETERMINES IF THE UNIT IS        02966002
* ELIGIBLE FOR DEMOUNTING.                                              02968002
*                                                                       02970002
LINKTEST BAL   RETURN,TESTUCB           TEST FOR PRIMARY UCB            02974000
         LTR   RUCB,RUCB               TEST FOR PRIMARY UCB             02980000
         BZ    FINDUNIT                BR IF NONE                       03000000
         ST    RDSAB,PRDSABAD           SAVE PRIMARY DSAB ADDR   Y02082 03020002
         ST    RUCB,PRUCBPTR            SAVE PRIMARY UCB ADDRESS Y02082 03030002
         L     RETURN,DSABTIOT          LOAD TIOT ENTRY ADDRESS  YM7036 03031002
         LA    RETURN,TIOEJFCB-TIOENTRY(,RETURN)  POINT TO JFCB  YM7036X03032002
                                        PREFIX ADDRESS           YM7036 03034002
         IECRES LOCJFCB,(RETURN)        LOCATE THE JFCB          YM7036 03036002
         CLC   PDSNAME,JFCBDSNM-INFMJFCB(RETURN)  CHECK IF       YM7036X03038002
                                        THIS IS THE RIGHT TIOT   YM7036X03040002
                                        ENTRY FOR THIS DSNAME    YM7036 03042002
         BE    FOUNDUCB                 BRANCH IF CORRECT        YM7036 03044002
         OI    SISW2,UCBFNDSW           SET THE UCB FOUND SWITCH YM7036 03046002
         B     UINCRPTR                 GO TRY NEXT TIOT ENTRY   YM7036 03048002
*                                                                       03050000
* CHECK THE UCB FOR PRIMARY QUALITIES.                                  03060000
*                                                                       03070000
TESTUCB  EQU   *                                                  25343 03077018
         TM    UCBTBYT3,UCB3DACC        TEST IF DIRECT ACCESS    Y02082 03087002
         BZ    WRONGUCB                 BRANCH IF NOT            Y02082 03097002
         TM    UCBDMCT,UCBDMC           TEST IF DATAMGT COUNT=0  Y02082 03107002
         BNZ   WRONGUCB                 BRANCH IF NOT            Y02082 03117002
         TM    SRTESTAT,SRTEONLI        TEST STATUS A FOR ON LINE       03120000
         BZ    WRONGUCB                 BRANCH IF NOT                   03130000
         TM    SRTESTAT,SRTERESV+SRTEPRES+SRTESYSR  TEST FORRESERVED,   03140000
*                                       PERMANENT OR SYSTEM RESIDENT    03150000
         BNE   WRONGUCB                 BRANCH IF YES                   03160000
         TM    SRTESTAB,SRTEBSVL        TEST FOR SHARED VOLUME          03170000
         BZ    WRONGUCB                 BR IF SHARED                    03180000
         BR    RETURN                   RETURN                   Y02080 03200002
WRONGUCB SR    RUCB,RUCB               DISCARD THIS UCB                 03300000
         BR    RETURN                   RETURN                   Y02080 03310002
*                                                                       03320002
* THIS SECTION INITIALIZES REGISTERS BEFORE BRANCHING TO IGG03002.      03330002
*                                                                       03340000
NOPRIUCB EQU   *                        INITIALIZE REGS          Y02082 03350002
         OI    RTYPEFLG,NOMNTDEV        TURN ON NO DEVICE BIT    Y02082 03360002
FOUNDUCB LA    VOLISTX,2(P4)           LOAD ADDR OF FIRST VOLUME        03380000
         LH    VOLCTR,VOLNUM           LOAD NBR OF VOLS IN LIST  Y02080 03400002
         ST    VOLISTX,VOLPTR          STORE VOLUME LIST INDEX          03460000
         NI    SISW2,X'FF'-UCBFNDSW     TURN OFF UCB FOUND SWTCH YM7036 03470002
*                                                                       03480002
* THIS SECTION ISSUES AN EXCLUSIVE ENQ DIRECTED TO THE INITIATOR'S      03500002
* TCB WITH A MAJOR RESOURCE NAME OF SYSDSN AND THE DATA SET NAME AS     03520002
* THE MINOR RESOURCE NAME.  IF THE RETURN CODE INDICATES THE TASK       03540002
* PREVIOUSLY HAD CONTROL OF THE RESOURCE, THE ENQ IS REISSUED AND       03560002
* A BIT IS SET TO INDICATE A DEB SEARCH MUST BE DONE TO ENSURE NO       03580002
* ONE IS CURRENTLY OPEN TO THE DATA SET.                                03600002
*                                                                       03620002
DSNAMENQ EQU   *                        ENQ DSNAME               Y02082 03640002
         MVC   ENQAREA(ENQLTH2),ENQLIST2  MOVE IN ENQ PARM LIST  Y02082 03660002
         MVC   MJNAME(L'DSNMJR),DSNMJR  MAJOR RESOURCE NAME      Y02082 03680002
         LA    P2,PDSNAME+L'PDSNAME-K1  LAST BYTE OF DSNAME      YM2880 03684002
TESTDSN  EQU   *                        SEARCH FOR NON-BLANK     YM2880 03688002
         CLI   K0(P2),BLANK             IS THIS ONE A BLANK      YM2880 03692002
         BNE   GETLNGTH                 BRANCH IF NO TO COMPUTE  YM2880X03696002
                                        LENGTH OF NAME FOR ENQ   YM2880 03700002
         BCT   P2,TESTDSN               TRY NEXT BYTE            YM2880 03704002
GETLNGTH EQU   *                        CALCULATE LENGTH         YM2880 03708002
         LA    R2,PDSNAME-K1            BYTE PRECEDING DSNAME    YM2880 03712002
         SR    P2,R2                    P2 HAS LENGTH FOR ENQ    YM2880 03716002
         L     R2,TCBADDR               LOAD TCB ADDRESS         Y02082 03720002
         USING TCB,R2                   TCB ADDRESSABILITY       Y02082 03740002
         L     R2,TCBJSCB               GET JSCB ADDRESS         Y02082 03760002
         USING IEZJSCB,R2               JSCB ADDRESSABILITY      Y02082 03780002
         L     R2,JSCBACT               GET ACTIVE JSCB ADDRESS  YM2887 03790002
         L     R2,JSCBTCBP              INITIATOR TCB ADDRESS    Y02082 03800002
         ENQ   (MJNAME,PDSNAME,,(P2)),TCB=(R2),RET=USE,          YM2880X03810002
               MF=(E,ENQAREA)           ENQ ON SYSDSN            YM2880 03820002
         LTR   R15,R15                  TEST RETURN CODE         Y02082 03840002
         BNZ   ERRTEST                  BRANCH IF ENQ FAILED     Y02082 03860002
*                                                                       03865002
         OI    DSMADTB2,DSMDSNE         SET DSN ENQ'ED SWITCH    Y02144 03870002
         OI    SISW1,DSNENQ             SET ENQ ON SYSDSN SWITCH Y02082 03880002
         B     LOADEXIT                 GO TO NEXT LOAD          Y02082 03900002
ERRTEST  EQU   *                        ERROR TEST               Y02082 03920002
         CLI   ENQAREA+K3,RTNCODE8      TEST IF TASK ALREADY     Y02082 03940002
*                                       ENQ'ED ON SYSDSN         Y02082 03960002
         BNE   OPENERR                  BRANCH IF NOT            Y02082 03980002
         MVC   ENQAREA(ENQLTH3),ENQLIST3  MOVE IN ENQ PARM LIST  Y02082 04000002
         ENQ   (MJNAME,PDSNAME,,(P2)),TCB=(R2),RET=CHNG,         YM2880X04010002
               MF=(E,ENQAREA)           ENQ ON SYSDSN            YM2880 04020002
         LTR   R15,R15                  TEST RETURN CODE         Y02082 04040002
         BNZ   OPENERR                  BRANCH IF NOT SUCCESSFUL Y02082 04060002
         OI    SISW1,DEBSRCH            DEB SEARCH REQUIRED SW   Y02082 04080002
LOADEXIT EQU   *                        EXIT TO NEXT LOAD        Y02082 04100002
         IECRES LOAD,EXTPR=(RWKAREA),MODNM=LOAD2,BRANCH=DIRECT   Y02080 04120002
*                                                                       04140002
* THIS SECTION SEARCHES THE TIOT TO SEE IF ANY VOLUME IN THE VOLUME     04160002
* LIST IS MOUNTED ON A UNIT ALLOCATED TO THE JOB.  IF MOUNTED, IT       04180002
* LINKS TO A ROUTINE THAT DETERMINES IF THE UNIT IS DEMOUNTABLE.        04200002
*                                                                       04220002
FINDUNIT EQU   *                        FIND A UNIT              Y02082 04240002
         TM    SISW2,UCBFNDSW           TEST IF A UCB WAS FOUND  YM7036 04250002
         BO    FOUNDUCB                 BRANCH IF YES            YM7036 04260002
         OC    VOLSER(L'SRTEVOLI,VOLISTX),VOLSER(VOLISTX)  TEST  Y02082 04280002
*                                       FOR VALID VOLUME SERIAL  Y02082 04300002
         BZ    NOUNIT                   BRANCH IF ZERO           Y02082 04320002
         CLC   VOLSER(L'SRTEVOLI,VOLISTX),BLANKS  TEST FOR VALID Y02132 04321002
*                                       VIRTUAL UCB VOL SER      Y02132 04322002
         BNE   NOVIOVOL                 BRANCH IF NOT            Y02132 04323002
         CLC   CSYS,PDSNAME             TEST FOR CHARACTERS SYS  YM1337 04325002
*                                       IN BYTES 0-2 OF DSNAME   Y02132 04326002
         BNE   NOVIOVOL                 BRANCH IF NOT A VIO DSN  Y02132 04327002
         CLC   CDOTT,PDSNAME+K8         TEST FOR .T IN BYTES 8-9 YM1337 04328002
         BNE   NOVIOVOL                 BRANCH IF NOT            Y02132 04329002
         CLC   CDOTR,PDSNAME+K16        TEST FOR CHARACTERS .R   YM1337 04330002
*                                       IN BYTES 16-17           Y02132 04331002
         BE    VIODSTST                 BRANCH IF A POSSIBLE     Y02132 04332002
*                                       VIO DATA SET             Y02132 04333002
*                                                                       04334002
NOVIOVOL EQU   *                        NO VIO VOL               Y02132 04335002
         L     RDSAB,DSABQDB            LOAD DSAB QDB ADDRESS    Y02082 04340002
         USING QDB,RDSAB                QDB ADDRESSABILITY       Y02082 04360002
         L     RDSAB,QDBFELMP           GET FIRST DSAB ADDRESS   Y02082 04380002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02082 04400002
DSABTEST EQU   *                        DSAB TEST                Y02082 04420002
         LTR   RDSAB,RDSAB              IS THERE ANOTHER DSAB    Y02082 04440002
         BZ    NOUNIT                   BRANCH IF NOT            Y02082 04460002
         L     RTIOT,DSABTIOT           GET TIOT POINTER         Y02082 04480002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02082 04500002
         SR    REND,REND                ZERO REGISTER FOR IC     Y02082 04520002
         IC    REND,TIOELNGH            LENGTH OF TIOT ENTRY     Y02082 04540002
         AR    REND,RTIOT               ADDRESS OF FIRST BYTE    Y02082 04560002
*                                       PAST THE TIOT ENTRY      Y02082 04580002
         LA    RTIOT,TIOEFSRT-K1        ADDR OF FIRST UCB ADDR   Y02082 04600002
NEXTUCB  EQU   *                        END OF ENTRY             Y02082 04620002
         CR    RTIOT,REND               TEST IF AT END OF ENTRY  Y02082 04640002
         BNL   NEXTDSAB                 BRANCH IF YES            Y02082 04660002
         L     RUCB,K0(,RTIOT)          GET UCB ADDRESS          Y02082 04680002
         LA    RUCB,K0(RUCB)            CLEAR HIGH BYTE          Y02082 04700002
         LTR   RUCB,RUCB                IS THERE A UCB ADDRESS   Y02082 04720002
         BZ    NXTENTRY                 BRANCH IF NOT            YM1063 04740002
         CLC   SRTEVOLI,VOLSER(VOLISTX)  COMPARE VOL SER NUMBERS Y02082 04760002
         BNE   NXTENTRY                 BRANCH IF NOT EQUAL      Y02082 04780002
*                                                                       04790002
         BAL   RETURN,TESTUCB           TEST IF UCB DEMOUNTABLE  Y02082 04800002
*                                                                       04810002
         LTR   RUCB,RUCB                TEST IF DEMOUNTABLE      Y02082 04820002
         BZ    NXTENTRY                 BRANCH IF NOT            YM7036 04822002
         ST    RDSAB,PRDSABAD           SAVE PRIMARY DSAB ADDR   YM7036 04824002
         ST    RUCB,PRUCBPTR            SAVE PRIMARY UCB ADDRESS YM7036 04826002
         L     RETURN,DSABTIOT          LOAD TIOT ENTRY ADDRESS  YM7036 04827002
         LA    RETURN,TIOEJFCB-TIOENTRY(,RETURN)  POINT TO JFCB  YM7036X04828002
                                        PREFIX ADDRESS           YM7036 04830002
         IECRES LOCJFCB,(RETURN)        LOCATE THE JFCB          YM7036 04832002
         CLC   PDSNAME,JFCBDSNM-INFMJFCB(RETURN)  CHECK IF       YM7036X04834002
                                        THIS IS THE RIGHT TIOT   YM7036X04836002
                                        ENTRY FOR THIS DSNAME    YM7036 04838002
         BE    FOUNDUCB                 BRANCH IF CORRECT        YM7036 04840002
         OI    SISW2,UCBFNDSW           SET THE UCB FOUND SWITCH YM7036 04842002
NXTENTRY EQU   *                        NEXT ENTRY               Y02082 04860002
         LA    RTIOT,L'TIOESTTB+L'TIOEFSRT(,RTIOT)  INCREMENT TO Y02082 04880002
*                                       NEXT UCB ADDRESS IN TIOT Y02082 04900002
         B     NEXTUCB                  GO TEST NEXT UCB ADDRESS Y02082 04920002
*                                                                       04930002
NEXTDSAB EQU   *                        GET NEXT DSAB            Y02082 04940002
         L     RDSAB,DSABFCHN           GET NEXT DSAB ADDRESS    Y02082 04960002
         B     DSABTEST                 GO TEST IT               Y02082 04980002
NOUNIT   EQU   *                        MORE VOLUMES             Y02082 05000002
         BCT   VOLCTR,TRYNEXT           TEST IF MORE VOLUMES     Y02082 05020002
         TM    SISW2,UCBFNDSW           TEST IF A UCB WAS FOUND  YM7036 05022002
         BO    FOUNDUCB                 BRANCH IF YES            YM7036 05024002
         B     NOPRIUCB                 BRANCH IF NOT            Y02082 05040002
TRYNEXT  EQU   *                        NEXT ENTRY               Y02082 05060002
         LA    VOLISTX,ENTRYL(VOLISTX)  POINT TO NEXT ENTRY      Y02082 05080002
*                                       IN THE VOLUME LIST       Y02082 05100002
         B     NOVIOVOL                 GO TRY NEXT VOLUME       YM7036 05120002
*                                                                       05130002
* THIS SECTION SEARCHES THE DSAB CHAIN FOR A TIOT ENTRY CONTAINING      05140002
* A VIRTUAL UCB WHOSE VDSDSCB CONTAINS THE DATA SET NAME TO BE          05150002
* RENAMED AND WHOSE VOLUME SERIAL NUMBER IN THE VDSUCB MATCHES          05160002
* THE FIRST VOLUME SERIAL IN THE VOLUME LIST.  IF A DSNAME/VOL SER      05170002
* MATCH IS FOUND, NO RENAME FUNCTION IS PERFORMED.                      05180002
*                                                                       05190002
VIODSTST EQU   *                        VIO DATA SET TEST        Y02132 05200002
         L     RDSAB,DSABQDB            GET DSAB QDB ADDRESS     Y02132 05210002
         USING QDB,RDSAB                QDB ADDRESSABILITY       Y02132 05220002
         L     RDSAB,QDBFELMP           GET FIRST DSAB ADDRESS   Y02132 05230002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02132 05240002
VDSABTST EQU   *                        DSAB TEST                Y02132 05250002
         LTR   RDSAB,RDSAB              IS THERE ANOTHER DSAB    Y02132 05260002
         BZ    NOMATCH                  BRANCH IF NOT            Y02132 05270002
         L     RTIOT,DSABTIOT           GET TIOT ADDRESS         Y02132 05280002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02132 05290002
         L     RUCB,TIOEFSRT-K1         GET UCB ADDRESS          Y02132 05300002
         LA    RUCB,K0(RUCB)            CLEAR HIGH BYTE          Y02132 05310002
         LTR   RUCB,RUCB                IS THERE A UCB ADDRESS   Y02132 05320002
         BZ    VNXTDSAB                 IF NO, TRY NEXT DSAB     Y02132 05330002
         TM    UCBJBNR,UCBVRDEV         TEST IF A VIRTUAL UCB    Y02132 05340002
         BZ    VNXTDSAB                 BRANCH IF NOT            Y02132 05350002
         CLC   SRTEVOLI,VOLSER(VOLISTX)  COMPARE VOL SER'S       Y02132 05360002
         BNZ   VNXTDSAB                 BRANCH IF NOT EQUAL      Y02132 05370002
         LR    R7,RUCB                  VDSCB ADDRESS            Y02132 05380002
         USING VDSCB,R7                 VDSCB ADDRESSABILITY     Y02132 05390002
         CLC   DS1DSNAM,PDSNAME         COMPARE DSNAME'S         YM1337 05410002
         BNE   VNXTDSAB                 BRANCH IF NOT EQUAL      Y02132 05420002
VIORENAM EQU   *                        VIO DSNAME FOUND         Y02132 05430002
         LA    R3,NODEVERR              RENAME IS NOT SUPPORTED  Y02132 05440002
*                                       FOR A VIRTUAL DATA SET   Y02132 05450002
         LA    RERRSAVE,RTNCODE4        RETURN CODE OF 4         Y02132 05460002
         B     SETSTATS                 GO SET THE STATUS BYTE   Y02132 05470002
VNXTDSAB EQU   *                        GET NEXT DSAB            Y02132 05480002
         L     RDSAB,DSABFCHN           GET NEXT DSAB ADDRESS    Y02132 05490002
         B     VDSABTST                 GO TEST IT               Y02132 05500002
NOMATCH  EQU   *                        TEST FOR INPUT UCB       Y02132 05510002
         OC    PRUCBPTR,PRUCBPTR        TEST FOR INPUT UCB ADDR  Y02132 05520002
         BZ    NOF1DSCB                 BRANCH IF NONE           Y02132 05530002
         XC    PRUCBPTR,PRUCBPTR        CLEAR INVALID UCB ADDR   Y02132 05540002
         B     NOVIOVOL                 BRANCH TO NON-VIO LOGIC  Y02132 05550002
*                                                                       05900002
* IF RENAME ENQ'ED ON THE TIOT, THIS SECTION ISSUES A DEQ.              05910002
*                                                                       05920002
DEQTEST  EQU   *                        DEQ TIOT                 Y02082 05930002
         TM    SISW1,TIOTENQ            TEST IF ENQ'ED ON TIOT   Y02082 05940002
         BNO   FREEWKA                  BRANCH IF NOT            Y02082 05950002
         MVC   ENQAREA(DEQLTH1),DEQLIST1  MOVE IN DEQ PARM LIST  Y02082 05960002
         MVC   MJNAME(L'TIOTMJR),TIOTMJR  MAJOR RESOURCE NAME    Y02082 05970002
         DEQ   (MJNAME,TIOTMNR),MF=(E,ENQAREA)  DEQ FROM TIOT    Y02082 05980002
*                                                                       05990002
         NI    DSMADTB2,X'FF'-DSMTIOTE  RESET TIOT ENQ'ED SWITCH Y02144 06000002
         B     FREEWKA                  GO FREE THE WORK AREA    Y02082 06010002
*                                                                       06020002
* THIS SECTION FREES THE WORK AREA AND RETURNS TO THE CALLER.           06030002
*                                                                       06040000
EXIT     EQU   *                        RETURN TO THE CALLER     Y02080 06060002
         LA    RERRSAVE,NOLIST          LOAD ERROR CODE          Y02080 06070002
FREEWKA  EQU   *                        FREE THE WORK AREA       Y02082 06075002
         L     SVRBREG,RENSAVE          SAVE REG 14 IN REG 8   @G60ASBJ 06080060
         IECRES FREE,PREFIX=FIRST,A=(RWKAREA)  FREE WORK AREA    Y02080 06087060
         LR    RETURN,SVRBREG           RESTORE R14            @G60ASBJ 06094060
         LR    R15,RERRSAVE             RESTORE ERROR CODE REG   Y02080 06110002
         RETURN ,                       RETURN                   Y02080 06420002
*                                                                       06440000
*** PROGRAM CONSTANTS                                                   06460000
*                                                                       06480000
CSYS     DC    CL3'SYS'                 CONSTANT OF 'SYS'        Y02132 06481002
CDOTT    DC    CL2'.T'                  CONSTANT OF '.T'         Y02132 06482002
CDOTR    DC    CL2'.R'                  CONSTANT OF '.R'         Y02132 06483002
BLANKS   DC    CL6' '                   SIX EBCDIC BLANKS        Y02132 06484002
TIOTMJR  DC    CL8'SYSZTIOT'            TIOT MAJOR RESOURCE NAME Y02082 06485002
DSNMJR   DC    CL8'SYSDSN'              DSN MAJOR RESOURCE NAME  Y02082 06490002
ENQLIST1 ENQ   (,,E,6,SYSTEM),RET=HAVE,MF=L   TIOT ENQ PARM LIST Y02082 06495002
ENQLTH1  EQU   *-ENQLIST1               LENGTH OF ENQ PARM LIST  Y02082 06500002
ENQLIST2 ENQ   (,,E,,SYSTEM),RET=USE,MF=L  1ST DSN ENQ LIST      YM2880 06505002
ENQLTH2  EQU   *-ENQLIST2               LENGTH OF ENQ PARM LIST  Y02082 06510002
ENQLIST3 ENQ   (,,E,,SYSTEM),RET=CHNG,MF=L  2ND DSN ENQ LIST     YM2880 06515002
ENQLTH3  EQU   *-ENQLIST3               LENGTH OF ENQ PARM LIST  Y02082 06520002
TWELVE   DC    H'12'                    VOL LIST ENTRY LENGTH    Y02078 06535002
DEQLIST1 DEQ   (,,6,SYSTEM),MF=L        SYSZTIOT DEQ LIST        YM2887 06545002
DEQLTH1  EQU   *-DEQLIST1               LENGTH OF DEQ LIST       Y02082 06550002
*                                                                       06570002
* TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                       06580002
*                                                                       06590002
         XCTLTABL ID=(LOAD1,IGC00030,LOAD2,IGG03002),            Y02080X06600002
               SVC=030,LENGTH=,BRT=YES                           Y02080 06620002
         SPACE 2                                                 Y02078 06660002
         IECDSECS ASCB,CVT,DSAB,JSCB,PSA,QDB,RB,RRPL,TIOT,TCB,   YM1063X06665002
               UCB,EXPAND=YES                                    YM1063 06670002
*                                                                       06780021
* *                                                                     06840021
* * * RENAME WORK AREA                                                  06900021
* *                                                                     06960021
*                                                                       07020021
WORKAREA IECRENWA EP,ADT=YES            RENAME WORK AREA         Y02144 07100002
         EJECT                                                   Y02132 07120002
         IDDVDSCB                       VDSCB EXPANSION          Y02132 07140002
         EJECT                                                   Y02132 07160002
         ORG   VDSDSCB                                           Y02132 07180002
         IECSDSL1 (1)                   FORMAT 1 DSCB EXPANSION  Y02132 07200002
         EJECT                                                   YM7036 07220002
         IEFJFCBN                       JFCB DSECT               YM7036 07240002
         END                                                            08140000
./  ADD  SSI=42110028,NAME=IGC0007H
         TITLE     'IGC0007H  -  DADSM  -  LSPACE SVC ROUTINE'          00200000
IGC0007H CSECT                                                   Y02080 00600002
*          VS2 RELEASE 03 DELETIONS/CHANGES                             00600403
*0000265900                                                     Z30AAJC 00600803
*          VS2 RELEASE 01.6 DELETIONS                           YA00295 00601002
*0000                                                                   00602002
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00603002
*0000006000,018000-024000,044000,049000,059000-061000,118000-    Y02080 00603102
*0000122000,130000,152000,156000,170000,176000-180000,186000,    Y02080 00603202
*0000206000,233000,233420-233600,233720,233840-233900,234460-    Y02080 00603302
*0000234960,235982,238000-238040,238960-246800,246810-260000,    Y02080 00603402
*0000262300-262400,263110-263130,263300-264900,274810,278500-    Y02080 00603502
*0000280500,284000,287800-288000,292000-300000,316000-346000,    Y02080 00603602
*0000370300-370700,386000-390000,392000-402000,418900-419000,    Y02080 00603702
*0000419300,468000,488000-528000,687200-696000,722200-724000,    Y02080 00603802
*0000760010-761200,766000,780200-781000,782000-842000,852000-    Y02080 00603902
*0000876000                                                      Y02080 00604002
*0000053000-056000,090000-092000,114000-116000,124000-125200,    Y02078 00604102
*0000164000-168000                                               Y02078 00604202
*0000000300-001500,233780-233960,370100,418050-418100,461500,    Y02082 00604302
*0000463500-463900                                               Y02082 00604402
*0000                                                            Y02144 00604502
*0000                                                            Y02132 00604602
*0000247400                                                      YM1312 00604802
*0000                                                            YM1241 00604902
*0000240250-240350,247900                                        YM5076 00605002
*          VS2 RELEASE 01 DELETIONS                                     00700000
*0000                                                            YM2930 00750000
*                                                                       00760000
*          RELEASE 18 DELETIONS                                         00800000
*          RELEASE 19 DELETIONS                                         01000000
*2483034000-072000,084000-092000,098000-104000,144000-146000,    S19028 01020019
*2483244000-246000,272000-276000,294000,460000-678000,680000,    S19028 01040019
*2483694000,698000-700000,710000,714000-718000,722000,742000-    S19028 01060019
*2483752000,772000-776000,862000                                 S19028 01080019
*2483                                                            A27329 01100019
*2483238400-239200                                               M3941  01150019
*          RELEASE 20 DELETIONS                                         01200000
*1242300000                                                      M5414  01250020
*1242254000                                                      A35588 01300020
*1242                                                            S20201 01350020
*          RELEASE 21 DELETIONS                                         01400000
*1195087000                                                      A38860 01402021
*1195004000,233300                                               A37199 01405021
*1195033000,048000-058000,092000,098000-104000,132000,284000     A40793 01410021
*1195143000,720600-721200,793000,794000,826000-832000,844000-    A42182 01430021
*1195850000                                                      A42182 01460021
*1195370100                                                      A42199 01500021
*0000288000,688000                                              SA49351 01550021
*          RELEASE 21.7 DELETIONS                                       01550202
*0000188000,204000,206000,220000,234000,260000,264000,266000,   SA48490 01551002
*0000268000-270000,270300,276000,276600-278000,312000,316000,   SA48490 01552002
*0000318000-342000,344000,348000,564000-573000                  SA48490 01552202
*0000240000-242000,250000,252000-258000,274800,275700           SA57953 01553002
*          RELEASE 22 DELETIONS                                         01600000
*                                                                       02400002
*                                                                       02401002
* MODULE NAME - IGC0007H                                                02402002
*                                                                       02403002
* DESCRIPTIVE NAME -  DADSM  -  LSPACE SVC ROUTINE                      02404002
*                                                                       02405002
* COPYRIGHT - NONE                                                      02406002
*                                                                       02407002
* CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD          02408002
*                                                                       02409002
*                                                                       02600000
* STATUS CHANGE LEVEL 003                                               02800021
*                                                                       03000000
* FUNCTION/OPERATION                                                    03200000
*    THIS MODULE IS THE FIRST LOAD OF SVC 78. THE SVC IS ISSUED         03300021
*    WHEN A DISPLAY SPACE COMMAND IS IN EFFECT OR SMF VOLUME            03400019
*    INFORMATION IS REQUIRED AND A DIRECT ACCESS VOLUME IS TO           03500019
*    BE DISMOUNTED. ITS FUNCTION IS TO TOTAL UP THE SPACE STILL         03600019
*    AVAILABLE ON A VOLUME AT DISMOUNT TIME AND TO RETURN THIS          03700019
*    INFORMATION TO THE CALLER AND/OR RECORD IT ON THE SMF DATA         03800019
*    SET. THIS MODULE LINKS TO THE VALIDITY CHECK ROUTINE TO            03900019
*    CHECK THE CALLER'S MESSAGE AREA POINTER AND TO THE RESIDENT        04000019
*    DIRECT ACCESS ADDRESS CONVERSION ROUTINE TO CONVERT THE            04100019
*    'TTR0' OF THE VTOC TO AN ABSOLUTE ADDRESS. IT ALSO CHECKS          04200019
*    TO INSURE THAT THE CALLER IS IN PROTECT KEY ZERO IF SMF            04300019
*    FUNCTIONS HAVE BEEN SPECIFIED. IT OBTAINS THE CORE FOR THE         04400002
*    WORK AREA REQUIRED BY THE SVC 78. THE CHANNEL PROGRAMS TO          04500019
*    READ THE DATA PORTION OF THE FORMAT 4 DSCB AND THE FIRST           04600019
*    FORMAT 5 DSCB ARE RELOCATED IN THE WORK AREA AND                   04700019
*    INITIALIZED. AFTER THIS MODULE ENQ'S ON THE VTOC, IT PASSES        04800021
*    CONTROL TO THE NEXT LOAD VIA IECRES (LOAD).  THE SECOND LOAD       04900002
*    (IGC0107H) READS IN THE FORMAT 4 DSCB AND THE FIRST FORMAT 5       05000021
*    DSCB. AS IT READS IN ANY CHAINED FORMAT 5 DSCB'S, IT TOTALS        05100021
*    THE AVAILABLE SPACE LISTED IN THEM AND SAVES THE LARGEST EXTENT.   05200021
*    IF SMF HAS BEEN SPECIFIED, THE MODULE IDENTIFICATION IS SENSED,    05300002
*    AND THE VOLUME LABEL IS READ.  IGC0107H BUILDS AN SMF RECORD       05400002
*    TYPE 19 AND RECORDS IT ON THE SMF DATA SET. IF 'DISPLAY SPACE'     05600002
*    INFORMATION IS REQUIRED, THE SPACE INFORMATION COLLECTED           05700021
*    FROM THE FORMAT 5 DSCB(S) IS CONVERTED TO EBCDIC AND PLACED IN     05800021
*    THE CALLER'S MESSAGE AREA. AFTER DEQ'ING THE VTOC AND FREEING      05900002
*    THE WORK AREA, IGC0107H RETURNS TO THE CALLER.                     06000002
*                                                                       07400000
* ENTRY POINT                                                           07600000
*    IGC0007H - ENTRY IS MADE TO THIS ROUTINE BY ISSUING AN SVC 78.     07800000
*                                                                       08000000
* INPUT ON ENTRY TO THIS MODULE                                         08200000
*    REGISTER ZERO WILL CONTAIN A POINTER TO THE UCB. BIT 0 OF          08300019
*    REGISTER ONE WILL BE ONE IF SMF VOLUME INFORMATION IS              08400019
*    DESIRED. BIT 1 OF REGISTER 1 WILL BE ONE IF THIS MODULE            08500019
*    SHOULD TEST TO DETERMINE IF SMF VOLUME INFORMATION IS              08600019
*    DESIRED. BITS 8 - 31 OF REGISTER ONE WILL CONTAIN THE              08700021
*    START ADDRESS OF A 30 BYTE AREA IN WHICH THE DISPLAY SPACE         08800019
*    DATA SHOULD BE RETURNED. A ZERO ADDRESS INDICATES THAT THE         08900019
*    DISPLAY SPACE INFORMATION IS NOT REQUIRED.  REGISTER FOUR          09000002
*    POINTS TO THE TCB.                                                 09100002
*                                                                       09400000
* OUTPUT                                                                09600000
*    WHEN CONTROL IS PASSED TO IGC0107H, THE VTOC IS ENQ'ED.            09800021
*    REGISTER 7 POINTS TO THE UCB.                                      10000021
*    REGISTER 9 POINTS TO THE 'DISPLAY SPACE' MESSAGE AREA.             10200021
*    REGISTER 13 POINTS TO THE WORKAREA.                                10400021
*                                                                       10600000
* EXTERNAL ROUTINES                                                     10800000
*    CVTPCNVT      - TTR CONVERSION ROUTINE                             11000000
*    CVT0VL00      - VALIDITY CHECK ROUTINE                             11200000
*    IECRES        - GET AND RELEASE CORE FOR WORK AREA                 11800002
*    RESERVE (56)  - ENQUEUE THE VTOC                                   12200002
*                                                                       12600000
* EXITS                                                                 12800000
*    CONTROL IS RETURNED TO THE CALLER IN BOTH NORMAL AND               13000002
*    ERROR EXITS. REGISTER 15 WILL CONTAIN A RETURN CODE. IF AN         13100021
*    ERROR OCCURS AND THE CALLER IS 'DISPLAY SPACE', AN ERROR           13200021
*    MESSAGE IS PLACED IN THE CALLER'S MESSAGE AREA.                    13300021
*                                                                       13400000
* RETURN CODES THAT CAN BE ISSUED BY LSPACE.                            13600000
*    00 - SUCCESSFUL PROCESSING                                         13800000
*    04 - PERMANENT I/O ERROR                                           14000000
*    08 - NON-STANDARD OS VOLUME                                        14200000
*    0C - INVALID UCB POINTER OR NOT A DIRECT ACCESS VOLUME OR          14260021
*         UCB NOT READY                                                 14320021
*    10 - UNSUCCESSFUL VALIDITY CHECK ON CALLER'S MESSAGE               14400019
*         POINTER OR INVALID SMF INDICATOR                              14500019
*                                                                       14800000
* TABLES/WORK AREAS                                                     15000000
*    LSPACE WORK AREA DESCRIBED BY MACRO IECLSPWA                       15200002
*                                                                       15400000
* ATTRIBUTES  REENTRANT                                                 15600002
*                                                                       15800000
* OTHER MACROS USED                                                     16000000
*    IECLSPWA - LSPACE WORK AREA EXPANSION                              16100002
*    IECSDSL1 - BUILD DSCB'S                                            16200000
*    IECDSECS - EXPANDS THE CVT, PSA, RB, RRPL, SMF, TCB, UCB DSECTS    16400002
*                                                                       17200000
*                                                                       17400000
         BALR  BASEREG,0                                                18200000
         USING BEGIN,BASEREG                                            18400000
         USING LSPACWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 18600002
         USING CVT,RCVT                                                 19000000
*                                                                       19200000
REGZERO  EQU   0                                                        19400000
REGONE   EQU   1                                                        19600000
RSMCA    EQU   1                                                 S19028 19700019
REGTWO   EQU   2                                                        19800000
REGTHREE EQU   3                                                        20000000
REGFOUR  EQU   4                                                        20200000
REGFIVE  EQU   5                        MSG PTR TO USER'S AREA          20400002
REGSIX   EQU   6                                                        20800000
REGSEVEN EQU   7                                                        21000000
RUCBPTRL EQU   7                        UCB POINTER                     21200000
REGEIGHT EQU   8                                                        21400000
REGNINE  EQU   9                                                        21600000
REGTEN   EQU   10                                                       21800000
WORKR    EQU   11                       WORK REGISTER           SA48490 22000002
BASEREG  EQU   12                       BASE REGISTER                   22200000
RWKAREA  EQU   13                       WORK AREA POINTER               22400000
REGSTORE EQU   13                                                       22600000
RBAK     EQU   14                                                       22800000
RCVT     EQU   15                                                       23000000
RERRPASS EQU   15                       ERROR PASS REGISTER             23200000
R15      EQU   15                       REGISTER 15              Y02080 23203002
R0       EQU   0                        WORK REGISTER            S20201 23306020
R2       EQU   2                        WORK REGISTER            S20201 23312020
R3       EQU   3                        WORK REGISTER            S20201 23318020
R9       EQU   9                        WORK REGISTER            A37199 23319021
*                                                                       23320021
* OTHER EQUATES                                                         23321021
*                                                                       23322021
FW       EQU   4                        BYTES IN A  FULL WORD    S20201 23324020
NONZERO  EQU   4                        NON-ZERO VALUE           YM1312 23325002
UNRELATD EQU   X'02'                    UNRELATED FLAG IN IOB    A37199 23330021
C7       EQU   7                        DISP OF SEVEN            S20201 23336020
C1       EQU   1                        ONE CHARACTER            S20201 23366020
EXTSA    EQU   96                       DISP. TO SVRB SAVE AREA  Y02080 23374002
DADEV    EQU   X'20'                    TESTS FOR DIRECT ACCESS SA48490 23546002
*                                       DEVICE                  SA48490 23596002
K2       EQU   2                        DISPLACEMENT OF TWO     SA48490 23597002
K29      EQU   29                       DISPLACEMENT OF 29      SA57953 23598002
*                                                                       23599002
* THIS SECTION SAVES REGISTERS BEFORE VALIDITY CHECKING THE             23599202
* MESSAGE AREA POINTER                                                  23599402
*                                                                       23599602
BEGIN    LR    REGSTORE,REGZERO         SAVE UCB POINTER                23600000
         LR    REGFIVE,REGONE           SAVE MSG PTR             S19028 23808019
         XR    REGZERO,REGZERO                                   S19028 23812019
         SLDL  REGZERO,8                ISOLATE AND SAVE THE     S19028 23816019
         SRL   REGONE,8                 SMF INDICATOR            S19028 23820019
         LR    REGSIX,REGZERO                                    S19028 23824019
         LA    REGZERO,X'3F'            TEST FOR A VALID SMF     S19028 23828019
         NR    REGZERO,REGSIX           INDICATOR                S19028 23832019
         BNZ   ERRVAL                   BRANCH IF INVALID        S19028 23836019
*                                                                       23837002
*** IF THE CALLER IS IN PROTECT KEY ZERO OR IN SUPERVISOR               23838002
*   STATE, THE MESSAGE POINTER DOES NOT HAVE TO BE VALIDITY CHECKED     23839002
*   SINCE HE MAY USE ANY REGION IN MAIN STORAGE                         23840002
*                                                                       23860002
         LR    REGNINE,REGONE           SAVE MESSAGE POINTER     Y02080 23880002
         L     REGEIGHT,0(,REGFOUR)     LOAD SVRB ADDRESS        Y02080 23900002
         STM   WORKR,REGFOUR,EXTSA(REGEIGHT)  SAVE REGS 11-4     Y02080 23920002
         XR    REGSEVEN,REGSEVEN        INITIALIZE REGISTER      Y02080 23940002
         TESTAUTH FCTN=1,KEY=YES,STATE=YES,BRANCH=YES            Y02080X23960002
                                        TEST IF CALLER IN KEY 0  Y02080X23980002
                                        OR SUPERVISOR STATE      Y02080 24000002
         LTR   R15,R15                  TEST IF ANY CASE IS TRUE Y02080 24010002
         BZ    RESTORE                  BRANCH IF YES            Y02080 24020002
         LTR   REGSIX,REGSIX            TEST IF SMF SPECIFIED    YM5076 24022002
         BZ    OBTNLOCK                 BRANCH IF NOT            YM5076 24024002
         LA    REGSEVEN,NONZERO         NO SMF FUNCTIONS CAN BE  YM5076X24026002
                                        SPECIFIED IF NOT IN KEY  YM5076X24028002
                                        ZERO OR SUPERVISOR STATE YM5076 24030002
         B     RESTORE                  GO RESTORE REGISTERS     YM5076 24032002
*                                                                YM5076 24034002
OBTNLOCK SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02080X24040002
               RELATED=(LOCAL,IGC0007H(RLSELOCK))  OBTAIN LOCK   Y02080 24060002
         LM    WORKR,RBAK,EXTSA(REGEIGHT) RESTORE REGS 11-14     YM1241 24065002
*                                                                       24680202
*** THIS SECTION INITIALIZES FOR THE VALIDITY CHECK ROUTINE AND         24680402
*   CHECKS IF THE MESSAGE POINTER IS IN THE CALLER'S REGION             24680602
*                                                                       24680802
         LA    REGONE,0(REGFIVE)        BEGINNING ADDRESS        Y02080 24681002
         LA    REGTWO,K29(REGONE)       ENDING ADDRESS           Y02080 24690002
*                                       REG 4 POINTS TO TCB      Y02080 24700002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02080 24710002
         L     RCVT,CVT0VL00            VALIDITY CHECK RTN ADDR  Y02080 24720002
         BALR  RBAK,RCVT                LINK TO VALIDITY CHECK   Y02080 24730002
         BZ    RLSELOCK                 BRANCH IF VALID ADDRESS  YM1312 24735002
         LA    REGSEVEN,NONZERO         INDICATE INVALID ADDRESS YM1312 24740002
*                                                                       24745002
RLSELOCK SETLOCK RELEASE,TYPE=LOCAL,                             Y02080X24750002
               RELATED=(LOCAL,IGC0007H(OBTNLOCK))  RELEASE LOCK  Y02080 24760002
RESTORE  EQU   *                        RESTORE REGS             Y02080 24770002
         LM    WORKR,REGFOUR,EXTSA(REGEIGHT)  RESTORE REGS 11-4  Y02080 24780002
         LTR   REGSEVEN,REGSEVEN        TEST IF ADDRESS VALID    YM5076X24790002
                                        OR IF THE SMF INDICATOR  YM5076X24793002
                                        IS VALID                 YM5076 24796002
         BNZ   ERRVAL                   BRANCH IF NOT            Y02080 24800002
         L     RCVT,CVTPTR              RELOAD CVT ADDRESS       Y02080 24810002
         LR    REGZERO,REGSIX           SAVE SMF INDICATOR      SA48490 26001002
*                                                                       26220002
* THIS SECTION INSURES THE UCB ADDRESS IS WITHIN VALID RANGE.           26230002
*                                                                       26250002
         LR    REGTEN,REGSTORE          ADDR UCB                SA48490 26260002
         LA    REGTEN,0(REGTEN)         CLEAR HIGH-ORDER BYTE   SA48490 26270002
         SRDL  REGTEN,16                IS ADDR OF UCB          SA48490 26280002
         LTR   REGTEN,REGTEN            CONTAINED IN A HALFWORD SA48490 26290002
         BNZ   ERREXIT3                 IF NO,INVALID UCB       SA48490 26300002
         SLDL  REGTEN,16                RESTORE REGISTER        SA48490 26310002
         USING UCB,REGTEN                                       SA48490 26320002
*                                                                       26340002
         TM    UCBJBNR,UCBVRDEV         TEST IF A VIRTUAL UCB    Y02132 26360002
         BO    ERREXIT4                 ERROR IF A VDSUCB        Y02132 26380002
*                                                                       26500002
* THIS SECTION CHECKS FOR VALID UCB                                     26510002
*                                                                       26520002
UCBADDR  EQU   *                                                SA48490 26530002
         L     REGSIX,CVTILK2           ADDR PORTION UCB        SA48490 26540002
*                                       LOOKUP TABLE            SA48490 26550002
UCBLOOP  EQU   *                                                SA48490 26560002
         CLC   0(K2,REGSIX),ENDTAB      IS THIS END OF TABLE    SA48490 26570002
         BE    ERREXIT3                 IF YES, INVALID UCB     SA48490 26580002
         SLR   REGTWO,REGTWO            CLEAR REGISTER          Z30AAJC 26590003
         ICM   REGTWO,3,0(REGSIX)       LOAD UCB ADDRESS        Z30AAJC 26592003
         CR    REGTEN,REGTWO                                    SA48490 26600002
         BE    OKUCB                    VALID UCB FOUND         SA48490 26610002
         LA    REGSIX,K2(REGSIX)        POINT TO NEXT ADDR IN   SA48490 26620002
*                                       TABLE                   SA48490 26630002
         B     UCBLOOP                  PICK UP NEXT ADDR       SA48490 26640002
OKUCB    EQU   *                                                SA48490 26650002
         CLI   UCBTBYT3,DADEV           IS THIS D.A. UCB        SA48490 26660002
         BNE   ERREXIT4                 ERROR IF NOT            SA48490 26670002
         DROP  REGTEN                                           SA48490 26680002
         LR    RUCBPTRL,REGSTORE        RELOAD UCB POINTER      SA48490 26690002
         USING UCB,RUCBPTRL                                     SA48490 26700002
BEGINB   LTR   REGSIX,REGZERO           ANY SMF FUNCTIONS       SA48490 27030002
         BZ    BEGINC                   BRANCH IF NOT            S19028 27060019
         LA    REGZERO,X'40'                                     S19028 27090019
         CR    REGZERO,REGSIX           IS TEST FOR SMF FUNCTION S19028 27120019
*                                       REQUIRED                        27150019
         BNE   BEGINC                   BRANCH IF NOT            S19028 27180019
         L     RSMCA,CVTSMCA                                     S19028 27210019
         LTR   RSMCA,RSMCA              TEST FOR SMF SYSTEM      S19028 27240019
         BZ    NOSMF                    BRANCH IF NOT            S19028 27270019
         USING SMCABASE,RSMCA                                    S19028 27300019
         TM    SMCAOPT,SMCAVOL          IS VOL INFO DESIRED      S19028 27330019
         BNO   NOSMF                    BRANCH IF NOT            S19028 27360019
         TM    SMCAMISC,SMCAUSER        ARE IBM RECORDS DESIRED  S19028 27390019
         BO    BEGINC                   BRANCH IF YES            S19028 27420019
NOSMF    XR    REGSIX,REGSIX            ZERO SMF INDICATOR       S19028 27450019
TESTEXIT EQU   *                                                SA57953 27480002
         LTR   REGNINE,REGNINE          IS DISPLAY SPACE         Y02080 27481002
*                                       DESIRED                 SA57953 27482002
         BNZ   BEGINC                   BRANCH IF YES            S19028 27510019
         XR    RERRPASS,RERRPASS        SET RETURN CODE          S19028 27540019
         B     RETURN                   RETURN TO CALLER        SA57953 27570002
BEGINC   EQU   *                                                SA48490 27600002
         LR    REGNINE,REGFIVE          SAVE MSG PTR             S19028 27630019
*                                                                       28200000
***  THIS SECTION OBTAINS THE LSPACE WORK AREA.                         28400002
*                                                                       28600000
         L     REGEIGHT,0(,REGFOUR)     LOAD SVRB ADDRESS        Y02080 28620002
         IECRES GET,PREFIX=FIRST,ID=LSWA,LV=LWALNGTH,            Y02080X28700002
               STM=(REGTWO,BASEREG,EXTSA(REGEIGHT))  OBTAIN W/A  Y02080 28720002
*                                       IGC0007H IS NOW RUNNING  Y02082 28740002
*                                       IN THE DATAMGT KEY AFTER Y02082 28760002
*                                       ISSUING THE IECRES GET   Y02082 28780002
*                                       FOR CORE IN KEY 5        Y02082 28800002
         LR    RWKAREA,REGONE           PICK UP WORK AREA POINTER       29000000
*                                                                       29100002
         IECRES LOAD,MODNM=LOAD1,EXTPR=(RWKAREA),BRANCH=NO       Y02080X29200002
                                        LET OPTIONAL TRACE PRINT Y02080X29300002
                                        THIS MODULE'S NAME       Y02080 29400002
*                                                                       29500002
         L     REGONE,IECRRPRM          RECOVERY RTN LIST ADDR   Y02144 29600002
         USING RRPLIST,REGONE           PARM LIST ADDRESSABILITY Y02144 29700002
         OI    RRFUNCTN,RRFLSPAC        SET LSPACE FUNCTION BIT  Y02144 29800002
         ST    RUCBPTRL,RRUCBPTR        SAVE UCB ADDRESS         Y02144 29900002
         DROP  REGONE                                            Y02144 29920002
*                                                                       29950002
         ST    REGFOUR,TCBADDR          SAVE INPUT TCB ADDRESS   Y02078 30000002
         STC   REGSIX,SMFFLAG           SAVE SMF INDICATOR       S19028 30100019
*                                                                       30200000
*** THIS SECTION BUILDS A DEB                                           30400000
*                                                                       30600000
         MVI   DEB+16,X'01'             SET NUMBER OF EXTENTS = 1       30800000
         LA    REGONE,DCB               LOAD DCB POINTER                31000000
         L     RCVT,CVTPTR              RELOAD CVT POINTER      SA48490 31200002
         USING CVT,RCVT                                         SA48490 31201002
         L     REGTWO,CVTXAPG           GET IOS APPENDAGE TABLE ADDRESS 31400000
         LR    REGTHREE,RUCBPTRL        LOAD MAIN UCB POINTER    Y02080 31600002
         XR    REGFOUR,REGFOUR          ZERO THE BIN NUMBER      Y02080 34451002
         LM    REGFIVE,REGSIX,EXTCON1   LOAD START HH,END CCHH AND TRKS 34800002
         STM   REGONE,REGSIX,DEB+24     STORE IN DEB                    35000000
         MVI   DEB+24,X'0F'             INSERT DEB ID                   35200000
         MVI   DEB+28,X'04'             INSERT EXTENT SCALE             35400000
         MVI   DEB+32,X'00'             INSERT DEVICE MODE              35600000
*                                                                       35800000
*** THIS SECTION BUILDS BLOCKS - DCB,IOB,ECB                            36000000
*                                                                       36200000
BLDBLKS  LA    REGONE,DEB               PUT IN DEB POINTER              36400000
         ST    REGONE,DEBPTR                                            36600000
         OI    IOB,UNRELATD             SET UNRELATED BIT IN IOB A37199 36700021
         LA    REGTWO,ECB               PUT IN ECB POINTER              36800000
         ST    REGTWO,IOB+4                                             37000000
         TM    UCBTBYT2,UCB2OPT3        TEST FOR RPS DEVICE      Y02082 37010002
         BZ    NORPS1                   NO, CONTINUE AS NORMAL   S20201 37020020
         LM    REGTWO,REGTHREE,RPSCCW   LOAD SET SECTOR CCW      Y02080 37030002
         ALR   REGTWO,RWKAREA                                    Y02080 37040002
         STM   REGTWO,REGTHREE,CCW0     STORE SET SECTOR CCW     Y02080 37050002
         LA    R2,CCW0                  ADDR OF RPS CHANNEL PGM. S20201 37080020
         B     IOBCONT                  CONTINUE                 S20201 37090020
NORPS1   EQU   *                                                 S20201 37100020
         LA    REGTWO,CCW1              PUT IN CHAN PROG POINTER        37200000
IOBCONT  EQU   *                                                 S20201 37300020
         LA    REGTHREE,DCB             PUT IN DCB POINTER              37400000
         STM   REGTWO,REGTHREE,IOB+16                                   37600000
*                                                                       37800000
* THIS SECTION LINKS TO THE 'ADDRESS CONVERSION' ROUTINE TO GET THE     38000000
* VTOC ADDRESS                                                          38200000
*                                                                       38400000
GOCVT    EQU   *                        GET THE VTOC ADDRESS     Y02080 38600002
         L     REGZERO,UCBVTOC          LOAD THE F4 DSCB TTR0    Y02080 39000002
         MVC   MIELNAME(6),SRTEVOLI     SAVE VOL SER FOR ENQ     A42182 39100021
ZEROCLR  IC    REGZERO,EXTCON1          CLEAR THE LOW ORDER BYTES       40400000
         STM   REGNINE,RWKAREA,REGSAVEA                                 40600000
         LA    REGTWO,SEEK              LOAD POINTER TO 8 BYTE AREA     40800000
         LR    REGTHREE,RWKAREA         SAVE WORK AREA POINTER          41000000
         L     RCVT,CVTPCNVT            LOAD CONVERSION ROUTINE BASE    41200000
         BALR  RBAK,RCVT                GO TO CONVERSION ROUTINE        41400000
         LM    REGNINE,RWKAREA,REGSAVEA-FIRST(REGTHREE)                 41600000
         MVC   VTOCADR(5),SEEK+3        SAVE VTOC ADDRESS               41800000
         TM    UCBTBYT2,UCB2OPT3        DOES DEVICE HAVE RPS     Y02082 41810002
         BZ    NORPS2                   NO, CONTINUE AS NORMAL   S20201 41820020
         LA    R2,THETA                 GET THETA ADDRESS        S20201 41830020
         XC    CCW2+FW(FW),CCW2+FW      CLEAR WORK WORD          S20201 41840020
         MVC   CCW2+FW(C1),UCBTBYT4     GET DEVICE CODE          S20201 41850020
         O     R2,CCW2+FW               PUT IN HIGH BYTE         S20201 41860020
         L     R0,PARM0                 PREPARE PARAMETERS FOR   S20201 41870020
         IC    R0,SEEK+C7               GET RECORD NUMBER        S20201 41880020
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02080 41890002
         L     RCVT,CVT0SCR1            GET ADDR SECTOR CNVT RTN Y02080 41900002
         STM   R9,RWKAREA,REGSAVEA      SAVE REGISTERS           S20201 41910020
         LR    R3,RWKAREA               SAVE SAVE AREA PTR       S20201 41920020
         BALR  RBAK,RCVT                GET SECTOR VALUE         Y02080 41930002
         LM    R9,RWKAREA,REGSAVEA-FIRST(R3) RESTORE REGS        S20201 41940020
NORPS2   EQU   *                                                 S20201 41950020
*                                                                       42000000
*** THIS SECTION RELOCATES THE CHANNEL PROGRAM TO THE WORK AREA. IT     42200000
*** ALSO INITIALIZES IT TO READ IN THE FORMAT 4 DSCB AND THE FIRST      42400000
*** FORMAT 5 DSCB                                                       42600000
*                                                                       42800000
         LM    REGZERO,REGSEVEN,CCWP    LOAD FIRST 4 CCW'S              43000000
         ALR   REGZERO,RWKAREA                                          43200000
         ALR   REGTWO,RWKAREA                                           43400000
         ALR   REGFOUR,RWKAREA                                          43600000
         ALR   REGSIX,RWKAREA                                           43800000
         STM   REGZERO,REGSEVEN,CCW1    STORE FIRST 4 CCW'S             44000000
*                                                                       44200000
         L     RUCBPTRL,DEB+32          RELOAD UCB POINTER              44400000
         LR    REGFIVE,REGNINE          RELOAD MESSAGE POINTER   A42182 44450021
         TM    UCBFL2,X'40'             IS UNIT NOT READY?       A42182 44500021
         BO    ERR5FREE                 BRANCH IF NOT READY      A42182 44550021
*                                                                       44600000
* LINK TO ENQ ROUTINE TO ENQ THE VTOC ON THIS VOLUME                    44800000
* SET UP TO ENQUEUE ON THE VTOC OF THIS VOLUME                          44900019
*                                                                       45000000
         MVC   MJELNAME(8),VTOCNAME     MOVE MAJOR QUE NAME TO WORKAREA 45200000
         MVI   ENQAREA,X'FF'            SET LAST ENTRY CODE             45400000
         SR    REGONE,REGONE            CLEAR CODE AND RETURN FIELDS    45600000
         STH   REGONE,ENQAREA+2                                         45800000
*                                                                       45900021
* LINK TO RESERVE ROUTINE TO ENQ THE VTOC ON THIS VOLUME.               46000021
*                                                                       46100021
         RESERVE (MJELNAME,MIELNAME,E,6,SYSTEMS),                YM3022X46200002
               MF=(E,ENQAREA),UCB=UCBPTR                         A42182 46300021
*                                                                       46320002
         OI    DSMADTB2,DSMVTOCR        SET VTOC ENQ'ED BIT      Y02144 46340002
*                                                                       46400021
*** THIS SECTION BRANCHES TO THE NEXT LOAD OF LSPACE (IGC0107H).        46800002
*                                                                       47800019
         IECRES LOAD,EXTPR=(RWKAREA),MODNM=LOAD2,BRANCH=DIRECT   Y02080 48800002
*                                                                       53800019
****************************************************************        54800019
*                                                                       55800019
ERR5FREE EQU   *                                                 A42182 56000021
         LA    REGTWO,ERRMSG5           POINT TO MESSAGE         A42182 56200021
         LA    REGTHREE,12                                       S19028 57800019
EXIT     LA    REGNINE,0(REGFIVE)       SHOULD MSG BE RETURNED   S19028 59800019
         LTR   REGNINE,REGNINE                                   S19028 61800019
         BZ    FREE                     BRANCH IF NO             S19028 63800019
         L     REGONE,TCBADDR           LOAD TCB ADDRESS         Y02078 63900002
         USING TCB,REGONE               TCB ADDRESSABILITY       Y02078 64000002
         MODESET EXTKEY=RBT234,WORKREG=4  SWITCH TO CALLER'S KEY Y02078 64100002
         DROP  REGONE                                            Y02078 64200002
         MVC   0(30,REGFIVE),0(REGTWO)  MOVE MSG TO CALLER AREA  S19028 65800019
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY    Y02078 65900002
*                                                                       68200000
* FREE THE WORK AREA                                                    68400000
*                                                                       68600000
FREE     EQU   *                                                SA49351 68660021
         LR    REGEIGHT,REGTHREE        SAVE RETURN CODE         Y02080 68680002
         LR    REGNINE,REGFIVE          SAVE MESSAGE POINTER     Y02080 68700002
         IECRES FREE,PREFIX=FIRST,A=(RWKAREA)  FREE WORK AREA    Y02080 68720002
RETURNPT EQU   *                        RETURN TO CALLER         Y02080 68740002
         MODESET EXTKEY=SUPR            RETURN TO SUPERVISOR KEY Y02082 68750002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02080 68760002
         USING CVT,RCVT                 CVT ADDRESSABILITY       Y02080 68780002
         L     RBAK,CVTEXPRO            LOAD EXIT PROLOG ADDRESS Y02080 68800002
         LR    RERRPASS,REGEIGHT        RESTORE RETURN CODE      Y02080 68820002
         LR    REGONE,REGNINE           RESTORE MESSAGE POINTER  Y02080 69400002
         RETURN ,                       RETURN TO CALLER         Y02080 69600002
*                                                                       69700002
ERREXIT3 LA    REGTWO,ERRMSG3                                           70200000
         BC    15,EXIT4                                                 70400000
ERREXIT4 LA    REGTWO,ERRMSG4                                           70600000
EXIT4    LA    RERRPASS,12                                              70800000
         LA    REGNINE,0(REGFIVE)       SHOULD MSG BE RETURNED   S19028 70880019
         LTR   REGNINE,REGNINE                                   S19028 70960019
         BZ    RETURN                   BRANCH IF NO             S19028 71040019
         USING TCB,REGFOUR              TCB ADDRESSABILITY       Y02078 71060002
         MODESET EXTKEY=RBT234,WORKREG=1  SWITCH TO CALLER'S KEY Y02078 71080002
         DROP  REGFOUR                                           Y02078 71100002
         MVC   0(30,REGFIVE),0(REGTWO)  MOVE MSG TO CALLER AREA  S19028 71120019
         MODESET EXTKEY=SUPR            RETURN TO SUPERVISOR KEY Y02082 71140002
         BC    15,RETURN                                                71200000
ERRVAL   LA    RERRPASS,16                                              72000000
RETURN   EQU   *                        SET FOR RETURN           Y02080 72020002
         LR    REGEIGHT,RERRPASS        SAVE RETURN CODE         Y02080 72040002
         LR    REGNINE,REGFIVE          SAVE MESSAGE POINTER     Y02080 72060002
         B     RETURNPT                 GO RETURN                Y02080 72080002
*                                                                       72600000
* CHANNEL PROGRAM FOR SEEK VTOC, READ IN FORMAT 4 AND FIRST FORMAT 5    72800000
* DSCB'S                                                                73000000
*                                                                       73200000
CCWP     CCW   X'31',VTOCADR-FIRST,X'40',5   SEARCH EQUAL ID FOR VTOC   73400000
         CCW   X'08',CCW1-FIRST,X'00',0      TIC BACK TO SEARCH         73600000
         CCW   X'06',DS4IDFMT-FIRST,X'40',96 READ DATA FOR VTOC DSCB    73800000
         CCW   X'9E',DSCBF5-8-FIRST,X'00',148 READ COUNT/KEY/DATA F5    74000000
RPSCCW   CCW   X'23',THETA-FIRST,X'40',1  SET SECTOR COMMAND     Y02080 74100002
*                                                                       75400000
* CONSTANTS AND MESSAGES                                                75600000
*                                                                       75800000
         DS    0F                                                       76000000
EXTCON1  DC    X'0000'                  CONSTANT FOR END CCHH OF DEB    76200000
         DC    X'FFFFFFFF7FFF'                                          76400000
ENDTAB   EQU   EXTCON1+K2               TEST FOR END OF UCB     SA48490 76410002
*                                       LOOKUP TABLE            SA48490 76420002
VTOCNAME DC    CL8'SYSVTOC'                                             76800000
*                                                                       77000000
ERRMSG3  DC    C'LSPACE-INVALID PARAMETER      '                        77800000
ERRMSG4  DC    C'LSPACE-NOT A DIRECT ACCESS VOL'                        78000000
ERRMSG5  DC    CL30'LSPACE-UCB NOT READY'                       SA42182 78010002
PARM0    DS    0F                       AREA TO BUILD PARAMETERS S20201 78120020
DD       DC    X'0060'                  DATA LENGTH              S20201 78140020
K        DC    X'2C'                    KEY  LENGTH              S20201 78160020
R        DC    X'0'                     RECORD NUMBER            S20201 78180020
*                                                                       78200002
* TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                       78220002
*                                                                       78240002
         XCTLTABL ID=(LOAD1,IGC0007H,LOAD2,IGC0107H),            Y02080X78260002
               SVC=078,LENGTH=,BRT=YES                           Y02080 78280002
         SPACE 2                                                 Y02080 78320002
         IECDSECS CVT,PSA,RB,RRPL,SMF,TCB,UCB,EXPAND=YES         Y02144 78400002
WORKAREA IECLSPWA EP,F4,ADT=YES         LSPACE WORK AREA         Y02144 78600002
REGSAVEA EQU   IECREGSV+12              REGISTER SAVE AREA       Y02080 80520002
UCBPTR   EQU   DEB+32                                            A42182 84700021
         END   IGC0007H                                          Y02080 87600002
./  ADD  SSI=71750032,NAME=IGC0102G
         TITLE 'IGC0102G - VSAM OBTAIN SUPPORT MODULE                  *00001000
                        '                                               00002000
IGC0102G CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(16)                                             0001 00007000
         DC    C'IGC0102G  77.175'                                 0001 00008000
         DROP  @15                                                      00009000
@PROLOG  DS    0H                                                  0002 00010000
         USING @DATD,RWKAPTR                                            00011000
         USING OBTNWKA,RWKAREA                                          00012000
         BALR  11,0                                                     00013000
         USING *,11                                                     00014000
*        /***********************************************************/  00015000
*        /* GET STORAGE FOR THE VSAM OBTAIN WORK AREA               */  00016000
*        /***********************************************************/  00017000
*        R2 = LENGTH(VSAMOBWA);         /* SET STORAGE SIZE NEEDED  */  00018000
         LA    R2,812                                              0036 00019000
*        GEN REFS (CVT,R2);                                        0037 00020000
         IECRES GET,EXTPR=(RWKAREA),LV=(R2),ID=OBWA,             Y02080X00021000
               STM=(R2,R14,12(RWKAREA))                          Y02080 00022000
         MODESET EXTKEY=SUPR            RETURN TO KEY ZERO AFTER Y02082X00023000
                                        ISSUING THE IECRES GET   Y02082 00024000
*        RWKAPTR = R1;                  /* VSAM OBTAIN W/A ADDRESS  */  00025000
         LR    RWKAPTR,R1                                          0038 00026000
*        RFY (R0,R1,R4,R5,R6,R7,R12,R14,RETCDREG) UNRSTD;          0039 00027000
*        /***********************************************************/  00028000
*        /*                                                         */  00029000
*        /* CONSTRUCT THE CPL REQUIRED TO CALL VSAM CATALOG MANAGE- */  00030000
*        /*    MENT TO ATTEMPT TO FIND THE NAMED DATA SET IN A VSAM */  00031000
*        /*   CATALOG.                                              */  00032000
*        /*                                                         */  00033000
*        /***********************************************************/  00034000
*        RFY CTGPL BASED(ADDR(VSLOCCPL));                          0040 00035000
*        CTGPL = CTGPL && CTGPL;        /* CLEAR THE CPL            */  00036000
         LA    @12,144                                             0041 00037000
         ALR   @12,RWKAPTR                                         0041 00038000
         XC    CTGPL(28,@12),CTGPL(@12)                            0041 00039000
*        CTGBYPSS = '1'B;               /* SET BYPASS SECURITY FLAG */  00040000
*        CTGNAME = '1'B;                /* FULL ENTRY NAME GIVEN    */  00041000
         OI    CTGBYPSS(@12),B'10000100'                           0043 00042000
*        CTGFUNC = CTGLOC;              /* LOCATE FCN REQUESTED     */  00043000
         NI    CTGFUNC(@12),B'00111111'                            0044 00044000
         OI    CTGFUNC(@12),B'00100000'                            0044 00045000
*        CTGAM0 = '1'B;                 /* VSAM REQUEST INDICATOR   */  00046000
         OI    CTGAM0(@12),B'00000001'                             0045 00047000
*        IF OBTTENQ = '1'B THEN         /* IF TIOT ENQUED   @ZA19743*/  00048000
         TM    OBTTENQ(RPLPTR),B'10000000'                         0046 00049000
         BNO   @RF00046                                            0046 00050000
*          DO;                          /* AND USER IS      @ZA19743*/  00051000
*          RFY (RETCDREG) RSTD;                                    0048 00052000
*            GEN (TESTAUTH FCTN=1,STATE=YES,KEY=YES,BRANCH=YES); /* */  00053000
         TESTAUTH FCTN=1,STATE=YES,KEY=YES,BRANCH=YES                   00054000
*            IF RETCDREG = 0 THEN       /* AUTHORIZED, THEN @ZA19743*/  00055000
         LTR   RETCDREG,RETCDREG                                   0050 00056000
         BNZ   @RF00050                                            0050 00057000
*              CTGTIOT = '1'B;          /* PASS ENQUE BIT   @ZA19743*/  00058000
         OI    CTGTIOT+144(RWKAPTR),B'00000100'                    0051 00059000
*            ELSE CTGTIOT = '0'B;       /* TO CATALOG       @ZA19743*/  00060000
         B     @RC00050                                            0052 00061000
@RF00050 NI    CTGTIOT+144(RWKAPTR),B'11111011'                    0052 00062000
*          RFY (RETCDREG) UNRSTD;                                  0053 00063000
@RC00050 DS    0H                                                  0054 00064000
*          END;                         /* MANAGEMENT, ELSE @ZA19743*/  00065000
*        ELSE;                          /* SET SWITCH OFF   @ZA19743*/  00066000
@RF00046 DS    0H                                                  0056 00067000
*        CTGENT = OBTDSNPT;             /* DATA SET NAME LOCATION   */  00068000
         LA    @12,144                                             0056 00069000
         ALR   @12,RWKAPTR                                         0056 00070000
         MVC   CTGENT(4,@12),OBTDSNPT(RPLPTR)                      0056 00071000
*        CTGWKA = ADDR(VSLOCWKA);       /* RETURN DATA LOCATION     */  00072000
         LA    @08,VSLOCWKA(,RWKAPTR)                              0057 00073000
         ST    @08,CTGWKA(,@12)                                    0057 00074000
*        CTGNOFLD = NODATAFL;           /* NO. OF DATA RETRIEVE FPLS*/  00075000
         MVI   CTGNOFLD(@12),X'06'                                 0058 00076000
*        DO R2 = INCR1 TO NODATAFL;     /* PROCESS MAIN DATA FPLS   */  00077000
         LA    R2,1                                                0059 00078000
@DL00059 DS    0H                                                  0060 00079000
*          VSCPLFLD(R2) = ADDR(VSFPLS(R2));/* SET CPL FPL PTR VALUE */  00080000
         LR    @12,R2                                              0060 00081000
         SLA   @12,2                                               0060 00082000
         LR    @08,R2                                              0060 00083000
         SLA   @08,5                                               0060 00084000
         LA    @08,VSFPLS-32(@08,RWKAPTR)                          0060 00085000
         ST    @08,@TF00001                                        0060 00086000
         ALR   @12,RWKAPTR                                         0060 00087000
         MVC   VSCPLFLD-4(4,@12),@TF00001                          0060 00088000
*          R3 = ADDR(VSFPLS(R2));       /* FPL ADDRESS              */  00089000
         LR    R3,@08                                              0061 00090000
*          CALL FPLBUILD;               /* COMMON FPL BUILDER       */  00091000
         BAL   @14,FPLBUILD                                        0062 00092000
*        END;                                                      0063 00093000
         AH    R2,@CH00038                                         0063 00094000
         CH    R2,@CH00200                                         0063 00095000
         BNH   @DL00059                                            0063 00096000
*        /* INITIALIZE THE FIELD NAMES IN THE FPLS                  */  00097000
*        DO R3 = INCR1 TO TOTALFLS;     /* PROCESS ALL OF THE FPLS  */  00098000
         LA    R3,1                                                0064 00099000
@DL00064 DS    0H                                                  0065 00100000
*          VSFPLFNM(R3) = TBLFPLNM(R3);                            0065 00101000
         LR    @12,R3                                              0065 00102000
         SLA   @12,5                                               0065 00103000
         ALR   @12,RWKAPTR                                         0065 00104000
         LR    @08,R3                                              0065 00105000
         SLA   @08,3                                               0065 00106000
         LA    @01,TBLFPLNM-8(@08)                                 0065 00107000
         MVC   VSFPLFNM-32(8,@12),0(@01)                           0065 00108000
*        END;                                                      0066 00109000
         AH    R3,@CH00038                                         0066 00110000
         CH    R3,@CH00036                                         0066 00111000
         BNH   @DL00064                                            0066 00112000
*        /* INITIALIZE THE WORK AREA HEADER INFORAMTION             */  00113000
*        WKALEN1 = ADDR(ENDWKA) - ADDR(VSLOCWKA);/* WORK AREA LENGTH*/  00114000
         L     @12,CTGWKA+144(,RWKAPTR)                            0067 00115000
         MVC   WKALEN1(2,@12),@CH01109                             0067 00116000
*        WKALEN2 = CLEAR;               /* CLEAR SECOND LNG FIELD   */  00117000
         SLR   @08,@08                                             0068 00118000
         STH   @08,WKALEN2(,@12)                                   0068 00119000
*        /* CONSTRUCT THE TEST FPLS FOR LOCATING ENTVOL             */  00120000
*        RFY (R4) RSTD;                                            0069 00121000
*        RFY CTGFL BASED(R4);                                      0070 00122000
*        DO R2 = R2 TO TOTALFLS;        /* PROCESS THE TEST FPLS    */  00123000
         B     @DE00071                                            0071 00124000
@DL00071 DS    0H                                                  0072 00125000
*          R4 = ADDR(VSFPLS(R2 - INCR1));/* PREVIOUS FPL ADDRESS    */  00126000
         LR    @12,R2                                              0072 00127000
         SLA   @12,5                                               0072 00128000
         LA    R4,VSFPLS-64(@12,RWKAPTR)                           0072 00129000
*          R3 = ADDR(VSFPLS(R2));       /* TEST FPL ADDRESS         */  00130000
         LA    R3,VSFPLS-32(@12,RWKAPTR)                           0073 00131000
*          CTGFLCHN = R3;               /* TEST FPL ADDRESS - CHAIN */  00132000
         ST    R3,CTGFLCHN(,R4)                                    0074 00133000
*          CALL FPLBUILD;               /* COMMON FPL BUILD         */  00134000
         BAL   @14,FPLBUILD                                        0075 00135000
*          RFY CTGFL BASED(R3);                                    0076 00136000
*          CTGFLDGC = VOLGRPCD;         /* VOLUME GROUP CODE VALUE  */  00137000
         MVI   CTGFLDGC(R3),X'03'                                  0077 00138000
*          CTGFLDCD = CTGFLDEQ;         /* TEST CONDITION CODE      */  00139000
         MVI   CTGFLDCD(R3),X'80'                                  0078 00140000
*        END;                                                      0079 00141000
         AH    R2,@CH00038                                         0079 00142000
@DE00071 CH    R2,@CH00036                                         0079 00143000
         BNH   @DL00071                                            0079 00144000
*        RFY (R4) UNRSTD;                                          0080 00145000
*        /* INITIALIZE THE TEST DATA AND ITS DESCRIPTORS            */  00146000
*        VSVOLTST = OBTVOLPT->VOLID;    /* VOL SER TEST DATA        */  00147000
         L     @12,OBTVOLPT(,RPLPTR)                               0081 00148000
         MVC   VSVOLTST(6,RWKAPTR),VOLID(@12)                      0081 00149000
*        VSCNTTST = INCR1;              /* COUNT REP NO. DATA       */  00150000
         MVC   VSCNTTST(2,RWKAPTR),@CH00038                        0082 00151000
*        RFY CTGFL BASED(ADDR(VSFPLS(7)));                  /*YM8135*/  00152000
*        CTGFLPT(1) = ADDR(VSVOLTST);   /* TEST DATA ADDRESS        */  00153000
         LA    @12,VSFPLS+192(,RWKAPTR)                            0084 00154000
         LA    @08,VSVOLTST(,RWKAPTR)                              0084 00155000
         ST    @08,CTGFLPT(,@12)                                   0084 00156000
*        CTGFLNG(1) = LENGTH(VSVOLTST); /* TEST DATA LENGTH         */  00157000
         MVC   CTGFLNG(4,@12),@CF00200                             0085 00158000
*        RFY CTGFL BASED(ADDR(VSFPLS(8)));                  /*YM8135*/  00159000
*        CTGFLPT(1) = ADDR(VSCNTTST);   /* TEST DATA ADDRESS        */  00160000
         LA    @12,VSFPLS+224(,RWKAPTR)                            0087 00161000
         LA    @08,VSCNTTST(,RWKAPTR)                              0087 00162000
         ST    @08,CTGFLPT(,@12)                                   0087 00163000
*        CTGFLNG(1) = LENGTH(VSCNTTST); /* TEST DATA LENGTH         */  00164000
         MVC   CTGFLNG(4,@12),@CF00077                             0088 00165000
*        /***********************************************************/  00166000
*        /* LOCATE CERTAIN DATA FROM THE SPECIFIED ENTRY IN A VSAM  */  00167000
*        /*   CATALOG, IF THE ENTRY EXISTS IN THE CATALOG           */  00168000
*        /***********************************************************/  00169000
*        RFY (R1,RETCDREG) RSTD;                                   0089 00170000
*        R1 = ADDR(VSLOCCPL);           /* SET THE CPL ADDRESS      */  00171000
         LA    R1,VSLOCCPL(,RWKAPTR)                               0090 00172000
*        GEN (SVC 26);                  /* CALL THE CATALOG LOCATE  */  00173000
         SVC 26                                                         00174000
*        RFY (R1) UNRSTD;                                          0092 00175000
*        /***********************************************************/  00176000
*        /* RETURN FROM VSAM CATALOG MANAGEMENT LOCATE              */  00177000
*        /***********************************************************/  00178000
*        RFY CTGFL BASED(ADDR(VSFPLS(5)));                 /*ZA00116*/  00179000
*        IF CTGFLPT(1) = CLEAR |        /*IF INVALID PTR OR   YM8135*/  00180000
*           CTGFLPT(1) -> ENTYPE = CTGTALIN | /*ALIEN REQ   @ZA06425*/  00181000
*           CTGFLPT(1) -> ENTYPE = CTGTUCAT | /*USER CAT    @ZA06425*/  00182000
*           CTGFLPT(1) -> ENTYPE = CTGTGBS | /*GDG BASE     @ZA06425*/  00183000
*           CTGFLPT(1) -> ENTYPE = CTGTANM THEN /*ALIAS NM  @ZA06425*/  00184000
         LA    @14,VSFPLS+128(,RWKAPTR)                            0094 00185000
         L     @14,CTGFLPT(,@14)                                   0094 00186000
         LTR   @14,@14                                             0094 00187000
         BZ    @RT00094                                            0094 00188000
         CLI   ENTYPE(@14),C'A'                                    0094 00189000
         BE    @RT00094                                            0094 00190000
         CLI   ENTYPE(@14),C'U'                                    0094 00191000
         BE    @RT00094                                            0094 00192000
         CLI   ENTYPE(@14),C'B'                                    0094 00193000
         BE    @RT00094                                            0094 00194000
         CLI   ENTYPE(@14),C'X'                                    0094 00195000
         BNE   @RF00094                                            0094 00196000
@RT00094 DS    0H                                                  0095 00197000
*          RETCDREG = NODSCB;           /*NO VSAM DATA SPACE ZA00116*/  00198000
         LA    RETCDREG,8                                          0095 00199000
*        ELSE                           /*VALID REQUEST       YM8135*/  00200000
*        IF RETCDREG = CLEAR |          /* ALL OKAY OR WORK AREA TOO*/  00201000
*          RETCDREG = RCVLSZ THEN       /*   SMALL, CHECK DATA      */  00202000
         B     @RC00094                                            0096 00203000
@RF00094 LTR   RETCDREG,RETCDREG                                   0096 00204000
         BZ    @RT00096                                            0096 00205000
         CH    RETCDREG,@CH00996                                   0096 00206000
         BNE   @RF00096                                            0096 00207000
@RT00096 DS    0H                                                  0097 00208000
*          DO;                          /* CHECK FOR DATA RETURNED  */  00209000
*            RFY IECSDSL1 BASED(ADDR(VSOBDSCB));                   0098 00210000
*            RETCDREG = CLEAR;          /* CLEAR RETURN CODE REG    */  00211000
         SLR   RETCDREG,RETCDREG                                   0099 00212000
*            RFY CTGFL BASED(ADDR(VSFPLS(1)));/* CREATE DATE FPLS   */  00213000
*            IF CTGFLPT(1) ¬= CLEAR &   /* VALID DATA POINTER       */  00214000
*              CTGFLNG(1) ¬= CLEAR THEN /* VALID LENGTH FOR DATA    */  00215000
         SLR   @14,@14                                             0101 00216000
         LA    @12,VSFPLS(,RWKAPTR)                                0101 00217000
         C     @14,CTGFLPT(,@12)                                   0101 00218000
         BE    @RF00101                                            0101 00219000
         C     @14,CTGFLNG(,@12)                                   0101 00220000
         BE    @RF00101                                            0101 00221000
*              DS1CREDT = VSCREDAT;     /* SET RETURNED DATA-F'S OK */  00222000
         MVC   DS1CREDT+4(3,RWKAPTR),VSCREDAT(RWKAPTR)             0102 00223000
*            ELSE;                      /* NO DATA                  */  00224000
@RF00101 DS    0H                                                  0104 00225000
*            RFY CTGFL BASED(ADDR(VSFPLS(2)));/* EXPIRE DATE FPLS   */  00226000
*            IF CTGFLPT(1) ¬= CLEAR &   /* VALID DATA POINTER       */  00227000
*              CTGFLNG(1)¬= CLEAR THEN /* VALID DATA LENGTH         */  00228000
         SLR   @14,@14                                             0105 00229000
         LA    @12,VSFPLS+32(,RWKAPTR)                             0105 00230000
         C     @14,CTGFLPT(,@12)                                   0105 00231000
         BE    @RF00105                                            0105 00232000
         C     @14,CTGFLNG(,@12)                                   0105 00233000
         BE    @RF00105                                            0105 00234000
*              DS1EXPDT = VSEXPDAT;     /* SET RETURNED DATA-F'S OK */  00235000
         MVC   DS1EXPDT+4(3,RWKAPTR),VSEXPDAT(RWKAPTR)             0106 00236000
*            ELSE;                      /* NO DATA                  */  00237000
@RF00105 DS    0H                                                  0108 00238000
*            RFY CTGFL BASED(ADDR(VSFPLS(3)));/* LOG RCRD SIZE FPL  */  00239000
*            IF CTGFLPT(1) ¬= CLEAR &   /* VALID DATA POINTER       */  00240000
*              CTGFLNG(1) ¬= CLEAR THEN /* VALID DATA LENGTH        */  00241000
         SLR   @14,@14                                             0109 00242000
         LA    @12,VSFPLS+64(,RWKAPTR)                             0109 00243000
         C     @14,CTGFLPT(,@12)                                   0109 00244000
         BE    @RF00109                                            0109 00245000
         C     @14,CTGFLNG(,@12)                                   0109 00246000
         BE    @RF00109                                            0109 00247000
*              IF VSLRECL ¬= -INCR1 THEN /* VALID DATA VALUE -NO F'S*/  00248000
         CLC   VSLRECL(4,RWKAPTR),@CF01113                         0110 00249000
         BE    @RF00110                                            0110 00250000
*                DSXLRECL = VSLRECL;    /* SET RETURNED LRECL       */  00251000
         MVC   DSXLRECL+92(2,RWKAPTR),VSLRECL+2(RWKAPTR)           0111 00252000
*              ELSE;                    /* NOT VALID DATA           */  00253000
@RF00110 DS    0H                                                  0113 00254000
*            ELSE;                      /* NO DATA                  */  00255000
@RF00109 DS    0H                                                  0114 00256000
*            RFY CTGFL BASED(ADDR(VSFPLS(4)));/* AMDSB FPL          */  00257000
*            IF CTGFLPT(1) ¬= CLEAR &   /* VALID DATA POINTER       */  00258000
*              CTGFLNG(1) ¬= CLEAR THEN /* VALID DATA LENGTH        */  00259000
         SLR   @14,@14                                             0115 00260000
         LA    @12,VSFPLS+96(,RWKAPTR)                             0115 00261000
         C     @14,CTGFLPT(,@12)                                   0115 00262000
         BE    @RF00115                                            0115 00263000
         C     @14,CTGFLNG(,@12)                                   0115 00264000
         BE    @RF00115                                            0115 00265000
*              DO;                      /* PROCESS AMDSB DATA VALUES*/  00266000
*                RFY IDAAMDSB BASED(ADDR(VSAMDSB));                0117 00267000
*                DSXKEYL = AMDKEYLN;    /* KEY LENGTH VALUE         */  00268000
         LA    @14,474                                             0118 00269000
         ALR   @14,RWKAPTR                                         0118 00270000
         MVC   DSXKEYL+94(1,RWKAPTR),AMDKEYLN+1(@14)               0118 00271000
*                DSXRKP = AMDRKP;       /* RELATIVE KEY POSITION    */  00272000
         MVC   DSXRKP+95(2,RWKAPTR),AMDRKP(@14)                    0119 00273000
*                DSXBLKL= AMDLRECL;     /* MAXIMUM LRECL            */  00274000
         MVC   DSXBLKL+90(2,RWKAPTR),AMDLRECL+2(@14)               0120 00275000
*              END;                     /* NO DATA                  */  00276000
*            ELSE;                                                 0122 00277000
@RF00115 DS    0H                                                  0123 00278000
*            RFY CTGFL BASED(ADDR(VSFPLS(6)));/* VOLUME FPL  ZA00116*/  00279000
*            IF CTGFLPT(1) ¬= CLEAR &   /* VALID DATA POINTER       */  00280000
*              CTGFLNG(1) ¬= CLEAR THEN /* VALID DATA LENGTH        */  00281000
         SLR   @14,@14                                             0124 00282000
         LA    @12,VSFPLS+160(,RWKAPTR)                            0124 00283000
         C     @14,CTGFLPT(,@12)                                   0124 00284000
         BE    @RF00124                                            0124 00285000
         C     @14,CTGFLNG(,@12)                                   0124 00286000
         BE    @RF00124                                            0124 00287000
*              DO;                      /* PROCESS VOLUME FIELDS    */  00288000
*                RFY GVO BASED(ADDR(VSVOLLOC));                    0126 00289000
*                IF CMFLNOEX < MAXEXTS THEN /* LESS THAN MAX NO. EXT*/  00290000
         LA    @14,573                                             0127 00291000
         ALR   @14,RWKAPTR                                         0127 00292000
         CLI   CMFLNOEX(@14),3                                     0127 00293000
         BNL   @RF00127                                            0127 00294000
*                  DSXNOEPV = CMFLNOEX; /* SET NO. OF EXTENTS ON VOL*/  00295000
         MVC   DSXNOEPV+63(1,RWKAPTR),CMFLNOEX(@14)                0128 00296000
*                ELSE                   /* MAXIMUM OR GREATER NO.   */  00297000
*                  DSXNOEPV = MAXEXTS;  /* SET MAXIMUM NO. EXTENTS  */  00298000
         B     @RC00127                                            0129 00299000
@RF00127 MVI   DSXNOEPV+63(RWKAPTR),X'03'                          0129 00300000
*                R2 = DSXNOEPV;         /* GET NO. OF EXTS TO MOVE  */  00301000
@RC00127 SLR   R2,R2                                               0130 00302000
         IC    R2,DSXNOEPV+63(,RWKAPTR)                            0130 00303000
*                RFY (R4) RSTD;                                    0131 00304000
*                R4 = ADDR(CMFLLKLN) + CMFLLKLN + LENGTH(CMFLLKLN);     00305000
         LA    R4,CMFOVERL+573(,RWKAPTR)                           0132 00306000
         SH    R4,@CH00036                                         0132 00307000
         LA    @14,CMFLLKLN(,R4)                                   0132 00308000
         MVC   @TF00001(2),CMFLLKLN(R4)                            0132 00309000
         AH    @14,@TF00001                                        0132 00310000
         AL    @14,@CF00077                                        0132 00311000
         LR    R4,@14                                              0132 00312000
*                R4 = R4 + R4->RANGELN + LENGTH(CMFLHKLN) +        0133 00313000
*                    LENGTH(CMFLEXLN);  /* EXTENTS START LOCATION   */  00314000
         LR    @14,R4                                              0133 00315000
         AH    @14,RANGELN(,R4)                                    0133 00316000
         AH    @14,@CH00154                                        0133 00317000
         LR    R4,@14                                              0133 00318000
*                RFY VSPHYEXT BASED(R4);                           0134 00319000
*                DO R3 = INCR1 TO R2;   /* PROCESS ALL EXTENTS      */  00320000
         LA    R3,1                                                0135 00321000
         B     @DE00135                                            0135 00322000
@DL00135 DS    0H                                                  0136 00323000
*                  DS1EXTX(R3) = VSCOMEXT(R3);/* SET EXTENT INFO    */  00324000
         LR    @14,R3                                              0136 00325000
         MH    @14,@CH00223                                        0136 00326000
         LA    @12,109                                             0136 00327000
         ALR   @12,RWKAPTR                                         0136 00328000
         ST    @14,@TF00001                                        0136 00329000
         ALR   @14,@12                                             0136 00330000
         AL    @14,@CF01134                                        0136 00331000
         LR    @08,R3                                              0136 00332000
         MH    @08,@CH00261                                        0136 00333000
         ALR   @08,R4                                              0136 00334000
         AL    @08,@CF01135                                        0136 00335000
         MVC   DS1EXTX(10,@14),VSCOMEXT(@08)                       0136 00336000
*                  DS1EXTSQ(R3) = R3;   /* SET EXTENT SEQUENCE NO.  */  00337000
         L     @14,@TF00001                                        0137 00338000
         AL    @14,@CF01136                                        0137 00339000
         STC   R3,DS1EXTSQ-1(@14,@12)                              0137 00340000
*                  DS1EXTID(R3) = INCR1;/* SET EXTENT TYPE INFO     */  00341000
         LA    @14,1                                               0138 00342000
         L     @08,@TF00001                                        0138 00343000
         AL    @12,@CF01134                                        0138 00344000
         STC   @14,DS1EXTID(@08,@12)                               0138 00345000
*                END;                                              0139 00346000
         AH    R3,@CH00038                                         0139 00347000
@DE00135 CR    R3,R2                                               0139 00348000
         BNH   @DL00135                                            0139 00349000
*                RFY (R4) UNRSTD;                                  0140 00350000
*              END;                     /*                    YM5916*/  00351000
*            ELSE;                      /*                    YM5916*/  00352000
@RF00124 DS    0H                                                  0143 00353000
*                /* INITIALIZE THE REMAINDER OF THE DSCB DATA       */  00354000
*                DS1DSIND = '00110000'B;/* INDICATE AS PROTECTED AND*/  00355000
         LA    @14,4                                               0143 00356000
         ALR   @14,RWKAPTR                                         0143 00357000
         MVI   DS1DSIND(@14),B'00110000'                           0143 00358000
*                                       /*   BLOCK LENGTH MULT OF 8 */  00359000
*                DS1DSORG = '0000000000001000'B;/* VSAM DSORG VALUE */  00360000
         MVC   DS1DSORG(2,@14),@CB01097                            0144 00361000
*                DS1FMTID = 'F1'X;      /* SET FORMAT 1 DSCB ID     */  00362000
         MVI   DS1FMTID(@14),X'F1'                                 0145 00363000
*                DS1DSSN = OBTVOLPT -> VOLID;  /* VOLUME SERIAL NBR */  00364000
         L     @12,OBTVOLPT(,RPLPTR)                               0146 00365000
         MVC   DS1DSSN(6,@14),VOLID(@12)                           0146 00366000
*                /* MOVE THE DSCB INFORMATION INTO THE CALLERS AREA */  00367000
*                RFY (R1) RSTD;                                    0147 00368000
*                GEN REFS (RB,TCB,R1,R2);                          0148 00369000
         L     R1,TCBADDR               LOAD THE TCB ADDRESS     Y02078 00370000
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 00371000
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLERS KEY  Y02078 00372000
         DROP  R1                                                Y02078 00373000
*                RFY (R1) UNRSTD;                                  0149 00374000
*                R2 = OBTWKAPT;         /* USER WORK AREA ADDRESS   */  00375000
         L     R2,OBTWKAPT(,RPLPTR)                                0150 00376000
*                R3 = ADDR(VSDSCBDT);   /* FORMATTED DSCB DATA ADDR */  00377000
         LA    R3,VSDSCBDT(,RWKAPTR)                               0151 00378000
*                R2->DS1DATA = R3->DS1DATA;/* MOVE DSCB INTO WORK A */  00379000
         MVC   DS1DATA(96,R2),DS1DATA(R3)                          0152 00380000
*                R2 = R2 + LENGTH(DS1DATA);/* CCHHR LOCATION        */  00381000
         AH    R2,@CH01003                                         0153 00382000
*                RFY DSCBVTAD BASED(R2);                           0154 00383000
*                DSCBVTAD = DSCBVTAD && DSCBVTAD;/* CLEAR CCHHR DATA*/  00384000
         XC    DSCBVTAD(5,R2),DSCBVTAD(R2)                         0155 00385000
*                RETCDREG = CLEAR;      /* CLEAR RETURN CODE REG    */  00386000
         SLR   RETCDREG,RETCDREG                                   0156 00387000
*                GEN (MODESET EXTKEY=SUPR);                        0157 00388000
         MODESET EXTKEY=SUPR                                            00389000
*          END;                                                    0158 00390000
*        ELSE                           /* LOCATE FAILED            */  00391000
*          RETCDREG = NODSCB;           /* SET DATA SET NOT FOUND   */  00392000
         B     @RC00096                                            0159 00393000
@RF00096 LA    RETCDREG,8                                          0159 00394000
*        /***********************************************************/  00395000
*        /* FREE THE OBTAIN WORK AREA STORAGE                      */   00396000
*        /***********************************************************/  00397000
*        RFY (R0,R1,R4,R5,R6,R7,RERRSAVE,R12,R14) RSTD;            0160 00398000
@RC00096 DS    0H                                                  0160 00399000
@RC00094 DS    0H                                                  0161 00400000
*        RERRSAVE=RETCDREG;             /* SAVE RETURN CODE         */  00401000
         LR    RERRSAVE,RETCDREG                                   0161 00402000
*        GEN (IECRES FREE,PREFIX=FIRST,A=(RWKAREA))                0162 00403000
*        REFS (CVT,RWKAREA);            /* FREE WORK AREAS          */  00404000
         IECRES FREE,PREFIX=FIRST,A=(RWKAREA)                           00405000
*        RETCDREG=RERRSAVE;             /* RESTORE RETURN CODE      */  00406000
         LR    RETCDREG,RERRSAVE                                   0163 00407000
*        RFY (R0,R1,R4,R5,R6,R7,RERRSAVE,R12) UNRSTD;              0164 00408000
*        /************************************************************/ 00409000
*        /* RETURN TO THE CALLER                                     */ 00410000
*        /************************************************************/ 00411000
* EXIT:                                                            0165 00412000
*        R14=CVTEXPRO;                  /* LOAD EXIT PROLOG ADDRESS  */ 00413000
EXIT     L     @12,CVTPTR                                          0165 00414000
         L     R14,CVTEXPRO(,@12)                                  0165 00415000
*        GOTO R14;                      /* RETURN TO CALLER          */ 00416000
         BR    R14                                                 0166 00417000
* FPLBUILD:                                                        0167 00418000
*        PROC OPTIONS(NOSAVEAREA,NOSAVE);                          0167 00419000
FPLBUILD DS    0H                                                  0168 00420000
*        /***********************************************************/  00421000
*        /*                                                         */  00422000
*        /* FPLBUILD - THIS INTERNAL PROCEDURE CONSTRUCTS THE FPLS  */  00423000
*        /*   THAT ARE USED TO LOCATE SPECIFIC DATA FIELDS IN AN    */  00424000
*        /*   ENTRY, IF IT EXISTS IN THE VSAM CATALOG               */  00425000
*        /*                                                         */  00426000
*        /***********************************************************/  00427000
*        RFY (R2,R3,R14) RSTD;                                     0168 00428000
*        RFY CTGFL BASED(R3);                                      0169 00429000
*        CTGFL = CTGFL && CTGFL;        /* CLEAR THE FPL STORAGE    */  00430000
         XC    CTGFL(16,R3),CTGFL(R3)                              0170 00431000
*        CTGFLDNM = ADDR(VSFPLFNM(R2)); /* FIELD NAME LOCATION      */  00432000
         LR    @12,R2                                              0171 00433000
         SLA   @12,5                                               0171 00434000
         LA    @12,VSFPLFNM-32(@12,RWKAPTR)                        0171 00435000
         ST    @12,CTGFLDNM(,R3)                                   0171 00436000
*        CTGFLDNO = INCR1;              /* NO. OF LNG/DATA POINTERS */  00437000
         MVI   CTGFLDNO(R3),X'01'                                  0172 00438000
*        CTGFLPT(1) = CLEAR;            /* CLEAR DATA ADDR POINTER  */  00439000
         SLR   @12,@12                                             0173 00440000
         ST    @12,CTGFLPT(,R3)                                    0173 00441000
*        CTGFLNG(1) = CLEAR;            /* CLEAR DATA LENGTH FIELD  */  00442000
         ST    @12,CTGFLNG(,R3)                                    0174 00443000
*        END FPLBUILD;                                             0175 00444000
@EL00002 DS    0H                                                  0175 00445000
@EF00002 DS    0H                                                  0175 00446000
@ER00002 BR    @14                                                 0175 00447000
*        GEN (EJECT);                                              0176 00448000
         EJECT                                                          00449000
*        /***********************************************************/  00450000
*        /* END OF MODULE DELIMITER AND PATCH AREA                  */  00451000
*        /***********************************************************/  00452000
*        GEN DATA;                                                 0177 00453000
*        END                                                       0178 00454000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      * 00455000
*/*%INCLUDE SYSLIB  (IEZCTGPL)                                        * 00456000
*/*%INCLUDE SYSLIB  (IEZCTGFL)                                        * 00457000
*/*%INCLUDE SYSLIB  (IECSDSL1)                                        * 00458000
*/*%INCLUDE SYSLIB  (IGGMGVO )                                        * 00459000
*/*%INCLUDE SYSLIB  (IDAAMDSB)                                        * 00460000
*/*%INCLUDE SYSLIB  (CVT     )                                        * 00461000
*;                                                                 0178 00462000
@EL00001 DS    0H                                                  0178 00463000
@EF00001 DS    0H                                                  0178 00464000
@ER00001 BR    @14                                                 0178 00465000
@DATA    DS    0H                                                       00466000
@CH00038 DC    H'1'                                                     00467000
@CH00154 DC    H'4'                                                     00468000
@CH00036 DC    H'8'                                                     00469000
@CH00223 DC    H'10'                                                    00470000
@CH00261 DC    H'20'                                                    00471000
@CH00996 DC    H'40'                                                    00472000
@CH01003 DC    H'96'                                                    00473000
@CH01109 DC    H'352'                                                   00474000
@DATD    DSECT                                                          00475000
         DS    0F                                                       00476000
@TF00001 DS    F                                                        00477000
@ZTEMPS  DS    C                                                        00478000
@ZTEMPND EQU   *                                                        00479000
@ZLEN    EQU   @ZTEMPND-@ZTEMPS                                         00480000
IGC0102G CSECT                                                          00481000
         DS    0F                                                       00482000
@CF00077 DC    F'2'                                                     00483000
@CF00200 DC    F'6'                                                     00484000
@CH00200 EQU   @CF00200+2                                               00485000
@CF01135 DC    F'-20'                                                   00486000
@CF01134 DC    F'-10'                                                   00487000
@CF01136 DC    F'-9'                                                    00488000
@CF01113 DC    F'-1'                                                    00489000
@DATD    DSECT                                                          00490000
         DS    0D                                                       00491000
IGC0102G CSECT                                                          00492000
         DS    0F                                                       00493000
@SIZDATD DC    AL1(0)                                                   00494000
         DC    AL3(@ENDDATD-@DATD)                                      00495000
         DS    0D                                                       00496000
@CB01097 DC    B'0000000000001000'                                      00497000
TBLFPLNM DC    CL8'DSETCRDT'                                            00498000
         DC    CL8'DSETEXDT'                                            00499000
         DC    CL8'LRECL   '                                            00500000
         DC    CL8'AMDSBCAT'                                            00501000
         DC    CL8'ENTYPE  '                                            00502000
         DC    CL8'ENTVOL  '                                            00503000
         DC    CL8'VOLSER  '                                            00504000
         DC    CL8'CNTREPNO'                                            00505000
@DATD    DSECT                                                          00506000
IGC0102G CSECT                                                   Y02080 00507000
         XCTLTABL SVC=027,LENGTH=,BRT=YES                        Y02080 00508000
         SPACE 2                                                 Y02078 00509000
         IECDSECS RB,TCB,EXPAND=YES     RB AND TCB DSECTS        Y02078 00510000
WORKAREA IECOBTWA EP                    OBTAIN WORK AREA         Y02080 00511000
@DATD    DSECT                                                          00512000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                00513000
@ENDDATD EQU   *                                                        00514000
IGC0102G CSECT                                                          00515000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00516000
@01      EQU   01                                                       00517000
@02      EQU   02                                                       00518000
@03      EQU   03                                                       00519000
@04      EQU   04                                                       00520000
@05      EQU   05                                                       00521000
@06      EQU   06                                                       00522000
@07      EQU   07                                                       00523000
@08      EQU   08                                                       00524000
@09      EQU   09                                                       00525000
@10      EQU   10                                                       00526000
@11      EQU   11                                                       00527000
@12      EQU   12                                                       00528000
@13      EQU   13                                                       00529000
@14      EQU   14                                                       00530000
@15      EQU   15                                                       00531000
R0       EQU   @00                                                      00532000
R1       EQU   @01                                                      00533000
R2       EQU   @02                                                      00534000
R3       EQU   @03                                                      00535000
R4       EQU   @04                                                      00536000
R5       EQU   @05                                                      00537000
R6       EQU   @06                                                      00538000
R7       EQU   @07                                                      00539000
RERRSAVE EQU   @08                                                      00540000
RWKAPTR  EQU   @09                                                      00541000
RPLPTR   EQU   @10                                                      00542000
RBASE    EQU   @11                                                      00543000
R12      EQU   @12                                                      00544000
RWKAREA  EQU   @13                                                      00545000
R14      EQU   @14                                                      00546000
RETCDREG EQU   @15                                                      00547000
CVTPTR   EQU   16                                                       00548000
CTGPL    EQU   0                                                        00549000
CTGOPTN1 EQU   CTGPL                                                    00550000
CTGBYPSS EQU   CTGOPTN1                                                 00551000
CTGNAME  EQU   CTGOPTN1                                                 00552000
CTGOPTN2 EQU   CTGPL+1                                                  00553000
CTGEXT   EQU   CTGOPTN2                                                 00554000
CTGERASE EQU   CTGOPTN2                                                 00555000
CTGSMF   EQU   CTGERASE                                                 00556000
CTGREL   EQU   CTGSMF                                                   00557000
CTGPURG  EQU   CTGOPTN2                                                 00558000
CTGVMNT  EQU   CTGPURG                                                  00559000
CTGOPTN3 EQU   CTGPL+2                                                  00560000
CTGFUNC  EQU   CTGOPTN3                                                 00561000
CTGAM0   EQU   CTGOPTN3                                                 00562000
CTGOPTN4 EQU   CTGPL+3                                                  00563000
CTGTIOT  EQU   CTGOPTN4                                                 00564000
CTGENT   EQU   CTGPL+4                                                  00565000
CTGCAT   EQU   CTGPL+8                                                  00566000
CTGWKA   EQU   CTGPL+12                                                 00567000
CTGDSORG EQU   CTGPL+16                                                 00568000
CTGNOFLD EQU   CTGPL+19                                                 00569000
CTGDDNM  EQU   CTGPL+20                                                 00570000
CTGNEWNM EQU   CTGDDNM                                                  00571000
CTGFBFLG EQU   CTGNEWNM+2                                               00572000
CTGJSCB  EQU   CTGPL+24                                                 00573000
CTGFIELD EQU   CTGPL+28                                                 00574000
CTGFL    EQU   0                                                        00575000
CTGFLDNO EQU   CTGFL                                                    00576000
CTGFLDCD EQU   CTGFL+1                                                  00577000
CTGFLDGC EQU   CTGFL+2                                                  00578000
CTGFLDRE EQU   CTGFL+3                                                  00579000
CTGFLDNM EQU   CTGFL+8                                                  00580000
CTGFLCHN EQU   CTGFL+12                                                 00581000
CTGFLDAT EQU   CTGFL+16                                                 00582000
CTGFLNG  EQU   CTGFLDAT                                                 00583000
CTGFLPT  EQU   CTGFLDAT+4                                               00584000
IECSDSF1 EQU   0                                                        00585000
IECSDSL1 EQU   0                                                        00586000
DS1DSNAM EQU   IECSDSL1                                                 00587000
DS1FMTID EQU   IECSDSL1+44                                              00588000
DS1DSSN  EQU   IECSDSL1+45                                              00589000
DS1CREDT EQU   IECSDSL1+53                                              00590000
DS1EXPDT EQU   IECSDSL1+56                                              00591000
DS1NOEPV EQU   IECSDSL1+59                                              00592000
DS1DSORG EQU   IECSDSL1+82                                              00593000
DS1BLKL  EQU   IECSDSL1+86                                              00594000
DS1LRECL EQU   IECSDSL1+88                                              00595000
DS1KEYL  EQU   IECSDSL1+90                                              00596000
DS1RKP   EQU   IECSDSL1+91                                              00597000
DS1DSIND EQU   IECSDSL1+93                                              00598000
DS1EXT1  EQU   IECSDSL1+105                                             00599000
GVO      EQU   0                                                        00600000
CMFLVLFL EQU   GVO+12                                                   00601000
CMFLNOEX EQU   GVO+13                                                   00602000
CMFLITEX EQU   GVO+34                                                   00603000
CMFOVERL EQU   GVO+37                                                   00604000
CMFOVLAY EQU   0                                                        00605000
CMFLLKLN EQU   CMFOVLAY+8                                               00606000
CMFLHKLN EQU   CMFOVLAY+10                                              00607000
CMFLEXLN EQU   CMFOVLAY+12                                              00608000
CMFXECTS EQU   0                                                        00609000
CMFXEXST EQU   CMFXECTS+2                                               00610000
CMFXSTA  EQU   CMFXEXST                                                 00611000
CMFXEXED EQU   CMFXECTS+6                                               00612000
CMFXEDA  EQU   CMFXEXED                                                 00613000
IDAAMDSB EQU   0                                                        00614000
AMDATTR  EQU   IDAAMDSB+1                                               00615000
AMDNEST  EQU   IDAAMDSB+4                                               00616000
AMDRKP   EQU   IDAAMDSB+6                                               00617000
AMDKEYLN EQU   IDAAMDSB+8                                               00618000
AMDLRECL EQU   IDAAMDSB+24                                              00619000
AMDHLRBA EQU   IDAAMDSB+28                                              00620000
AMDSSRBA EQU   IDAAMDSB+32                                              00621000
AMDATTR3 EQU   IDAAMDSB+40                                              00622000
AMDSTAT  EQU   IDAAMDSB+48                                              00623000
CVTMAP   EQU   0                                                        00624000
CVT      EQU   CVTMAP                                                   00625000
CVTDAR   EQU   CVTMAP+72                                                00626000
CVTFLGS1 EQU   CVTDAR                                                   00627000
CVTDCB   EQU   CVTMAP+116                                               00628000
CVTIOQET EQU   CVTMAP+120                                               00629000
CVTIERLC EQU   CVTMAP+144                                               00630000
CVTHEAD  EQU   CVTMAP+160                                               00631000
CVTSV76C EQU   CVTHEAD                                                  00632000
CVTOPTA  EQU   CVTMAP+182                                               00633000
CVTOPTB  EQU   CVTMAP+183                                               00634000
CVTGTF   EQU   CVTMAP+236                                               00635000
CVTGTFST EQU   CVTGTF                                                   00636000
CVTGTFS  EQU   CVTGTFST                                                 00637000
CVTSTATE EQU   CVTGTFST                                                 00638000
CVTTMODE EQU   CVTGTFST                                                 00639000
CVTFORM  EQU   CVTGTFST                                                 00640000
CVTAQAVT EQU   CVTMAP+240                                               00641000
CVTTCMFG EQU   CVTAQAVT                                                 00642000
CVTVOLM2 EQU   CVTMAP+244                                               00643000
CVTTATA  EQU   CVTVOLM2                                                 00644000
CVTTSKS  EQU   CVTTATA                                                  00645000
CVTVOLF2 EQU   CVTTSKS                                                  00646000
CVTTAT   EQU   CVTTATA+1                                                00647000
CVTATER  EQU   CVTMAP+248                                               00648000
CVTEXT1  EQU   CVTMAP+252                                               00649000
CVTPURG  EQU   CVTMAP+260                                               00650000
CVTQMSG  EQU   CVTMAP+268                                               00651000
CVTDMSR  EQU   CVTMAP+272                                               00652000
CVTRSV37 EQU   CVTDMSR                                                  00653000
CVTDMSRF EQU   CVTRSV37                                                 00654000
CVTERPV  EQU   CVTMAP+316                                               00655000
CVTINTLA EQU   CVTMAP+320                                               00656000
CVTAPF   EQU   CVTMAP+324                                               00657000
CVTEXT2  EQU   CVTMAP+328                                               00658000
CVTHJES  EQU   CVTMAP+332                                               00659000
CVTPGSIA EQU   CVTMAP+348                                               00660000
CVTA1F1  EQU   CVTMAP+356                                               00661000
CVTSYSK  EQU   CVTMAP+357                                               00662000
CVTVOLM1 EQU   CVTMAP+380                                               00663000
CVTVOLF1 EQU   CVTVOLM1                                                 00664000
CVTATMCT EQU   CVTMAP+388                                               00665000
CVTXTNT1 EQU   0                                                        00666000
CVTXTNT2 EQU   0                                                        00667000
CVTDSSV  EQU   CVTXTNT2                                                 00668000
CVTFLGBT EQU   CVTXTNT2+5                                               00669000
CVTQID   EQU   CVTXTNT2+24                                              00670000
CVTRV400 EQU   CVTXTNT2+52                                              00671000
CVTRV409 EQU   CVTXTNT2+53                                              00672000
CVTATCVT EQU   CVTXTNT2+64                                              00673000
CVTRV429 EQU   CVTXTNT2+84                                              00674000
CVTRV438 EQU   CVTXTNT2+85                                              00675000
CVTRV457 EQU   CVTXTNT2+112                                             00676000
CVTRV466 EQU   CVTXTNT2+113                                             00677000
CVTFIX   EQU   0                                                        00678000
CVTRELNO EQU   CVTFIX+252                                               00679000
ENTYPE   EQU   0                                                        00680000
DS1DATA  EQU   0                                                        00681000
DSCBVTAD EQU   0                                                        00682000
DSXBLKL  EQU   0                                                        00683000
DSXKEYL  EQU   0                                                        00684000
DSXLRECL EQU   0                                                        00685000
DSXNOEPV EQU   0                                                        00686000
DSXRKP   EQU   0                                                        00687000
RANGELN  EQU   0                                                        00688000
VOLID    EQU   0                                                        00689000
DS1EXTX  EQU   0                                                        00690000
DS1EXTID EQU   DS1EXTX                                                  00691000
DS1EXTSQ EQU   DS1EXTX+1                                                00692000
VSPHYEXT EQU   0                                                        00693000
VSCOMEXT EQU   VSPHYEXT                                                 00694000
VSAMOBWA EQU   0                                                        00695000
VSOBDSCB EQU   VSAMOBWA+4                                               00696000
VSDSCBDT EQU   VSOBDSCB+44                                              00697000
VSLOCCPL EQU   VSAMOBWA+144                                             00698000
VSCPLFLD EQU   VSAMOBWA+172                                             00699000
VSFPLS   EQU   VSAMOBWA+196                                             00700000
VSFPLFNM EQU   VSFPLS+24                                                00701000
VSVOLTST EQU   VSAMOBWA+452                                             00702000
VSCNTTST EQU   VSAMOBWA+458                                             00703000
VSLOCWKA EQU   VSAMOBWA+460                                             00704000
VSCREDAT EQU   VSAMOBWA+464                                             00705000
VSEXPDAT EQU   VSAMOBWA+467                                             00706000
VSLRECL  EQU   VSAMOBWA+470                                             00707000
VSAMDSB  EQU   VSAMOBWA+474                                             00708000
VSVOLLOC EQU   VSAMOBWA+573                                             00709000
ENDWKA   EQU   VSAMOBWA+812                                             00710000
USERWKA  EQU   0                                                        00711000
WKALEN1  EQU   USERWKA                                                  00712000
WKALEN2  EQU   USERWKA+2                                                00713000
OBTINPL  EQU   0                                                        00714000
OBTOPTCD EQU   OBTINPL                                                  00715000
OBTTENQ  EQU   OBTOPTCD+2                                               00716000
OBTDSNPT EQU   OBTINPL+4                                                00717000
OBTVOLPT EQU   OBTINPL+8                                                00718000
OBTWKAPT EQU   OBTINPL+12                                               00719000
USERDSCB EQU   0                                                        00720000
@NM00006 EQU   CTGDDNM                                                  00721000
CTGPROB  EQU   @NM00006                                                 00722000
CTGREASN EQU   CTGPROB+2                                                00723000
CVTS01   EQU   CVTPGSIA                                                 00724000
CVTLPDIA EQU   CVTS01+12                                                00725000
CVTDIRST EQU   CVTLPDIA                                                 00726000
CVTSLIDA EQU   CVTS01+24                                                00727000
CVTCTLFG EQU   CVTS01+50                                                00728000
CVTEXPRO EQU   CVTS01+260                                               00729000
CVTRV210 EQU   CVTS01+424                                               00730000
CVTRV219 EQU   CVTS01+425                                               00731000
CVTRV228 EQU   CVTS01+426                                               00732000
CVTRV237 EQU   CVTS01+427                                               00733000
CVTMFRTR EQU   CVTS01+452                                               00734000
CVTRV262 EQU   CVTS01+468                                               00735000
CVTRV271 EQU   CVTS01+469                                               00736000
CVTRV280 EQU   CVTS01+470                                               00737000
CVTRV289 EQU   CVTS01+471                                               00738000
CVTGSDA  EQU   CVTS01+600                                               00739000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    00740000
CVTRV628 EQU   CVTS01+728                                               00741000
CVTRV627 EQU   CVTS01+724                                               00742000
CVTRV626 EQU   CVTS01+720                                               00743000
CVTRV625 EQU   CVTS01+716                                               00744000
CVTRV624 EQU   CVTS01+712                                               00745000
CVTRV623 EQU   CVTS01+708                                               00746000
CVTRV622 EQU   CVTS01+704                                               00747000
CVTRV621 EQU   CVTS01+700                                               00748000
CVTIHASU EQU   CVTS01+696                                               00749000
CVTRV619 EQU   CVTS01+692                                               00750000
CVTRV618 EQU   CVTS01+688                                               00751000
CVTRV617 EQU   CVTS01+684                                               00752000
CVTRV616 EQU   CVTS01+680                                               00753000
CVTRV615 EQU   CVTS01+676                                               00754000
CVTRV614 EQU   CVTS01+672                                               00755000
CVTRV613 EQU   CVTS01+668                                               00756000
CVTTCASP EQU   CVTS01+664                                               00757000
CVT0PT03 EQU   CVTS01+660                                               00758000
CVT0PT0E EQU   CVTS01+656                                               00759000
CVTRV609 EQU   CVTS01+652                                               00760000
CVTCGK   EQU   CVTS01+648                                               00761000
CVTRAC   EQU   CVTS01+644                                               00762000
CVTRV606 EQU   CVTS01+640                                               00763000
CVTRV605 EQU   CVTS01+636                                               00764000
CVTRV604 EQU   CVTS01+632                                               00765000
CVTEFF02 EQU   CVTS01+628                                               00766000
CVTCBBR  EQU   CVTS01+624                                               00767000
CVTSSCR  EQU   CVTS01+620                                               00768000
CVTEVENT EQU   CVTS01+616                                               00769000
CVTCRCA  EQU   CVTS01+612                                               00770000
CVTTPIO  EQU   CVTS01+608                                               00771000
CVTADV   EQU   CVTS01+604                                               00772000
CVTGSDAB EQU   CVTGSDA                                                  00773000
CVTQV3   EQU   CVTS01+596                                               00774000
CVTQV2   EQU   CVTS01+592                                               00775000
CVTQV1   EQU   CVTS01+588                                               00776000
CVTRPT   EQU   CVTS01+584                                               00777000
CVTSSRB  EQU   CVTS01+580                                               00778000
CVTCSDRL EQU   CVTS01+576                                               00779000
CVTEXP1  EQU   CVTS01+572                                               00780000
CVTRMPMT EQU   CVTS01+568                                               00781000
CVTRMPTT EQU   CVTS01+564                                               00782000
CVTVPSA  EQU   CVTS01+560                                               00783000
CVTVSTOP EQU   CVTS01+556                                               00784000
CVTGTFR8 EQU   CVTS01+552                                               00785000
CVTQUIT  EQU   CVTS01+548                                               00786000
CVTVACR  EQU   CVTS01+544                                               00787000
CVTWTCB  EQU   CVTS01+540                                               00788000
CVTSTPRS EQU   CVTS01+536                                               00789000
CVT0PT02 EQU   CVTS01+532                                               00790000
CVTDARCM EQU   CVTS01+528                                               00791000
CVTIRECM EQU   CVTS01+524                                               00792000
CVTJRECM EQU   CVTS01+520                                               00793000
CVTVEMS0 EQU   CVTS01+516                                               00794000
CVTSPFRR EQU   CVTS01+512                                               00795000
CVTRLSTG EQU   CVTS01+508                                               00796000
CVT0TC0A EQU   CVTS01+504                                               00797000
CVTGMBR  EQU   CVTS01+500                                               00798000
CVTLFRM  EQU   CVTS01+496                                               00799000
CVTRMBR  EQU   CVTS01+492                                               00800000
CVTVIOP  EQU   CVTS01+488                                               00801000
CVTRV307 EQU   CVTS01+486                                               00802000
CVTRV306 EQU   CVTS01+484                                               00803000
CVTRV305 EQU   CVTS01+482                                               00804000
CVTRV304 EQU   CVTS01+480                                               00805000
CVTRV303 EQU   CVTS01+478                                               00806000
CVTRV302 EQU   CVTS01+476                                               00807000
CVTTRCA  EQU   CVTS01+472                                               00808000
CVTRV297 EQU   CVTRV289                                                 00809000
CVTRV296 EQU   CVTRV289                                                 00810000
CVTRV295 EQU   CVTRV289                                                 00811000
CVTRV294 EQU   CVTRV289                                                 00812000
CVTRV293 EQU   CVTRV289                                                 00813000
CVTRV292 EQU   CVTRV289                                                 00814000
CVTRV291 EQU   CVTRV289                                                 00815000
CVTRV290 EQU   CVTRV289                                                 00816000
CVTRV288 EQU   CVTRV280                                                 00817000
CVTRV287 EQU   CVTRV280                                                 00818000
CVTRV286 EQU   CVTRV280                                                 00819000
CVTRV285 EQU   CVTRV280                                                 00820000
CVTRV284 EQU   CVTRV280                                                 00821000
CVTRV283 EQU   CVTRV280                                                 00822000
CVTRV282 EQU   CVTRV280                                                 00823000
CVTRV281 EQU   CVTRV280                                                 00824000
CVTRV279 EQU   CVTRV271                                                 00825000
CVTRV278 EQU   CVTRV271                                                 00826000
CVTRV277 EQU   CVTRV271                                                 00827000
CVTRV276 EQU   CVTRV271                                                 00828000
CVTRV275 EQU   CVTRV271                                                 00829000
CVTRV274 EQU   CVTRV271                                                 00830000
CVTRV273 EQU   CVTRV271                                                 00831000
CVTRV272 EQU   CVTRV271                                                 00832000
CVTRV270 EQU   CVTRV262                                                 00833000
CVTRV269 EQU   CVTRV262                                                 00834000
CVTRV268 EQU   CVTRV262                                                 00835000
CVTRV267 EQU   CVTRV262                                                 00836000
CVTRV266 EQU   CVTRV262                                                 00837000
CVTRV265 EQU   CVTRV262                                                 00838000
CVTRV264 EQU   CVTRV262                                                 00839000
CVTRV263 EQU   CVTRV262                                                 00840000
CVTVFP   EQU   CVTS01+464                                               00841000
CVTVSI   EQU   CVTS01+460                                               00842000
CVTVPSIB EQU   CVTS01+456                                               00843000
CVTMFACT EQU   CVTMFRTR                                                 00844000
CVTMFCTL EQU   CVTS01+448                                               00845000
CVTPVBP  EQU   CVTS01+444                                               00846000
CVTPWI   EQU   CVTS01+440                                               00847000
CVTRV254 EQU   CVTS01+438                                               00848000
CVTRV253 EQU   CVTS01+436                                               00849000
CVTRV252 EQU   CVTS01+434                                               00850000
CVTRV251 EQU   CVTS01+433                                               00851000
CVTRV250 EQU   CVTS01+432                                               00852000
CVTRV249 EQU   CVTS01+431                                               00853000
CVTRV248 EQU   CVTS01+430                                               00854000
CVTRV247 EQU   CVTS01+429                                               00855000
CVTRV246 EQU   CVTS01+428                                               00856000
CVTRV245 EQU   CVTRV237                                                 00857000
CVTRV244 EQU   CVTRV237                                                 00858000
CVTRV243 EQU   CVTRV237                                                 00859000
CVTRV242 EQU   CVTRV237                                                 00860000
CVTRV241 EQU   CVTRV237                                                 00861000
CVTRV240 EQU   CVTRV237                                                 00862000
CVTRV239 EQU   CVTRV237                                                 00863000
CVTRV238 EQU   CVTRV237                                                 00864000
CVTRV236 EQU   CVTRV228                                                 00865000
CVTRV235 EQU   CVTRV228                                                 00866000
CVTRV234 EQU   CVTRV228                                                 00867000
CVTRV233 EQU   CVTRV228                                                 00868000
CVTRV232 EQU   CVTRV228                                                 00869000
CVTRV231 EQU   CVTRV228                                                 00870000
CVTRV230 EQU   CVTRV228                                                 00871000
CVTRV229 EQU   CVTRV228                                                 00872000
CVTRV227 EQU   CVTRV219                                                 00873000
CVTRV226 EQU   CVTRV219                                                 00874000
CVTRV225 EQU   CVTRV219                                                 00875000
CVTRV224 EQU   CVTRV219                                                 00876000
CVTRV223 EQU   CVTRV219                                                 00877000
CVTRV222 EQU   CVTRV219                                                 00878000
CVTRV221 EQU   CVTRV219                                                 00879000
CVTRV220 EQU   CVTRV219                                                 00880000
CVTRV218 EQU   CVTRV210                                                 00881000
CVTRV217 EQU   CVTRV210                                                 00882000
CVTRV216 EQU   CVTRV210                                                 00883000
CVTRV215 EQU   CVTRV210                                                 00884000
CVTRV214 EQU   CVTRV210                                                 00885000
CVTRV213 EQU   CVTRV210                                                 00886000
CVTRV212 EQU   CVTRV210                                                 00887000
CVTRV211 EQU   CVTRV210                                                 00888000
CVTLCCAT EQU   CVTS01+420                                               00889000
CVTPCCAT EQU   CVTS01+416                                               00890000
CVTIPCRP EQU   CVTS01+412                                               00891000
CVTIPCRI EQU   CVTS01+408                                               00892000
CVTIPCDS EQU   CVTS01+404                                               00893000
CVTAIDVT EQU   CVTS01+400                                               00894000
CVTSSAP  EQU   CVTS01+396                                               00895000
CVTEHCIR EQU   CVTS01+392                                               00896000
CVTEHDEF EQU   CVTS01+388                                               00897000
CVTDAIR  EQU   CVTS01+384                                               00898000
CVTPERFM EQU   CVTS01+380                                               00899000
CVT044R2 EQU   CVTS01+376                                               00900000
CVTFETCH EQU   CVTS01+372                                               00901000
CVTRSTWD EQU   CVTS01+368                                               00902000
CVTSPOST EQU   CVTS01+364                                               00903000
CVTIOBP  EQU   CVTS01+360                                               00904000
CVTASMVT EQU   CVTS01+356                                               00905000
CVTRECRQ EQU   CVTS01+352                                               00906000
CVTWSAC  EQU   CVTS01+348                                               00907000
CVTRV149 EQU   CVTS01+344                                               00908000
CVTWSAL  EQU   CVTS01+340                                               00909000
CVTSPSA  EQU   CVTS01+336                                               00910000
CVTGLMN  EQU   CVTS01+332                                               00911000
CVTVEAC0 EQU   CVTS01+328                                               00912000
CVT062R1 EQU   CVTS01+324                                               00913000
CVTRPOST EQU   CVTS01+320                                               00914000
CVTDQIQE EQU   CVTS01+316                                               00915000
CVTCSD   EQU   CVTS01+312                                               00916000
CVTLKRMA EQU   CVTS01+308                                               00917000
CVTRSPIE EQU   CVTS01+304                                               00918000
CVTRENQ  EQU   CVTS01+300                                               00919000
CVTLQCB  EQU   CVTS01+296                                               00920000
CVTFQCB  EQU   CVTS01+292                                               00921000
CVTQCS01 EQU   CVTS01+288                                               00922000
CVTAPFT  EQU   CVTS01+284                                               00923000
CVTPARRL EQU   CVTS01+280                                               00924000
CVTVWAIT EQU   CVTS01+276                                               00925000
CVTGSPL  EQU   CVTS01+272                                               00926000
CVTLSMQ  EQU   CVTS01+268                                               00927000
CVTGSMQ  EQU   CVTS01+264                                               00928000
CVTOPCTP EQU   CVTS01+256                                               00929000
CVTSIC   EQU   CVTS01+252                                               00930000
CVTTPIOS EQU   CVTS01+248                                               00931000
CVTRTMS  EQU   CVTS01+244                                               00932000
CVTSDBF  EQU   CVTS01+240                                               00933000
CVTSCBP  EQU   CVTS01+236                                               00934000
CVTSDMP  EQU   CVTS01+232                                               00935000
CVTSV60  EQU   CVTS01+228                                               00936000
CVTRTMCT EQU   CVTS01+224                                               00937000
CVTASCBL EQU   CVTS01+220                                               00938000
CVTASCBH EQU   CVTS01+216                                               00939000
CVTGDA   EQU   CVTS01+212                                               00940000
CVTASVT  EQU   CVTS01+208                                               00941000
CVTVVMDI EQU   CVTS01+204                                               00942000
CVTAQTOP EQU   CVTS01+200                                               00943000
CVTIOSCS EQU   CVTS01+196                                               00944000
CVTSDRM  EQU   CVTS01+192                                               00945000
CVTOPTE  EQU   CVTS01+188                                               00946000
CVTSTXU  EQU   CVTS01+184                                               00947000
CVTQUIS  EQU   CVTS01+180                                               00948000
CVTPARS  EQU   CVTS01+176                                               00949000
CVTS1EE  EQU   CVTS01+172                                               00950000
CVTFRAS  EQU   CVTS01+168                                               00951000
CVTQSAS  EQU   CVTS01+164                                               00952000
CVTCRAS  EQU   CVTS01+160                                               00953000
CVTCRMN  EQU   CVTS01+156                                               00954000
CVTDELCP EQU   CVTS01+152                                               00955000
CVTFRECL EQU   CVTS01+148                                               00956000
CVTGETCL EQU   CVTS01+144                                               00957000
CVTBLDCP EQU   CVTS01+140                                               00958000
CVTAUTHL EQU   CVTS01+136                                               00959000
CVTSCAN  EQU   CVTS01+132                                               00960000
CVTRV144 EQU   CVTS01+130                                               00961000
CVTMAXMP EQU   CVTS01+128                                               00962000
CVTSTCK  EQU   CVTS01+124                                               00963000
CVTRV139 EQU   CVTS01+123                                               00964000
CVTDSSAC EQU   CVTS01+122                                               00965000
CVTRV513 EQU   CVTS01+121                                               00966000
CVTIOSPL EQU   CVTS01+120                                               00967000
CVTPTGT  EQU   CVTS01+116                                               00968000
CVTCSPIE EQU   CVTS01+112                                               00969000
CVTSMFEX EQU   CVTS01+108                                               00970000
CVTOLT0A EQU   CVTS01+104                                               00971000
CVTSRBRT EQU   CVTS01+100                                               00972000
CVTPUTL  EQU   CVTS01+96                                                00973000
CVTASCRL EQU   CVTS01+92                                                00974000
CVTASCRF EQU   CVTS01+88                                                00975000
CVTRV326 EQU   CVTS01+84                                                00976000
CVTRV325 EQU   CVTS01+80                                                00977000
CVTRV324 EQU   CVTS01+76                                                00978000
CVT0VL01 EQU   CVTS01+72                                                00979000
CVTSHRVM EQU   CVTS01+68                                                00980000
CVTRV332 EQU   CVTS01+64                                                00981000
CVTTAS   EQU   CVTS01+60                                                00982000
CVTRSCN  EQU   CVTS01+56                                                00983000
CVTTRAC2 EQU   CVTS01+54                                                00984000
CVTTRACE EQU   CVTS01+52                                                00985000
CVTAPG   EQU   CVTS01+51                                                00986000
CVTSDTRC EQU   CVTCTLFG                                                 00987000
CVTGTRCE EQU   CVTCTLFG                                                 00988000
CVTNOMP  EQU   CVTCTLFG                                                 00989000
CVTRSV79 EQU   CVTCTLFG                                                 00990000
CVTDSTAT EQU   CVTCTLFG                                                 00991000
CVTRSV78 EQU   CVTCTLFG                                                 00992000
CVTRV333 EQU   CVTCTLFG                                                 00993000
CVTRV323 EQU   CVTCTLFG                                                 00994000
CVTSPVLK EQU   CVTS01+49                                                00995000
CVTRSV77 EQU   CVTS01+48                                                00996000
CVTRV331 EQU   CVTS01+44                                                00997000
CVTRV330 EQU   CVTS01+40                                                00998000
CVTRV329 EQU   CVTS01+36                                                00999000
CVTRV328 EQU   CVTS01+32                                                01000000
CVTRV322 EQU   CVTS01+28                                                01001000
CVTSLID  EQU   CVTSLIDA+1                                               01002000
CVTSYLK  EQU   CVTSLIDA                                                 01003000
CVTRV321 EQU   CVTS01+20                                                01004000
CVTRV320 EQU   CVTS01+16                                                01005000
CVTLPDIR EQU   CVTLPDIA+1                                               01006000
CVTRSV69 EQU   CVTDIRST                                                 01007000
CVTRSV68 EQU   CVTDIRST                                                 01008000
CVTRSV67 EQU   CVTDIRST                                                 01009000
CVTRSV66 EQU   CVTDIRST                                                 01010000
CVTRSV65 EQU   CVTDIRST                                                 01011000
CVTRSV64 EQU   CVTDIRST                                                 01012000
CVTRSV63 EQU   CVTDIRST                                                 01013000
CVTDICOM EQU   CVTDIRST                                                 01014000
CVTPVTP  EQU   CVTS01+8                                                 01015000
CVTLPDSR EQU   CVTS01+4                                                 01016000
CVTGETL  EQU   CVTS01                                                   01017000
CTGREAS2 EQU   CTGREASN+1                                               01018000
CTGREAS1 EQU   CTGREASN                                                 01019000
CTGMODID EQU   CTGPROB                                                  01020000
DSCBADDR EQU   USERDSCB+96                                              01021000
DSCBDATA EQU   USERDSCB                                                 01022000
@NM00020 EQU   OBTOPTCD                                                 01023000
VSEXTNTS EQU   VSAMOBWA+752                                             01024000
VSMAXKYS EQU   VSAMOBWA+624                                             01025000
VSVLRLRP EQU   VSAMOBWA+571                                             01026000
VSENTYPE EQU   VSAMOBWA+570                                             01027000
VSNEDLNG EQU   VSLOCWKA+2                                               01028000
VSPASLNG EQU   VSLOCWKA                                                 01029000
VSFPLDAT EQU   VSFPLS+16                                                01030000
VSLOCFPL EQU   VSFPLS                                                   01031000
@NM00019 EQU   VSOBDSCB                                                 01032000
VSPLSTMP EQU   VSAMOBWA                                                 01033000
@NM00018 EQU   VSPHYEXT+10                                              01034000
DS1EXRNG EQU   DS1EXTX+2                                                01035000
CVTLEVL  EQU   CVTRELNO+2                                               01036000
CVTNUMB  EQU   CVTRELNO                                                 01037000
CVTMDL   EQU   CVTFIX+250                                               01038000
@NM00017 EQU   CVTFIX+248                                               01039000
@NM00016 EQU   CVTFIX                                                   01040000
CVTRV482 EQU   CVTXTNT2+128                                             01041000
CVTRV481 EQU   CVTXTNT2+124                                             01042000
CVTRV480 EQU   CVTXTNT2+120                                             01043000
CVTRV479 EQU   CVTXTNT2+118                                             01044000
CVTRV478 EQU   CVTXTNT2+117                                             01045000
CVTRV477 EQU   CVTXTNT2+116                                             01046000
CVTRV476 EQU   CVTXTNT2+115                                             01047000
CVTRV475 EQU   CVTXTNT2+114                                             01048000
CVTRV474 EQU   CVTRV466                                                 01049000
CVTRV473 EQU   CVTRV466                                                 01050000
CVTRV472 EQU   CVTRV466                                                 01051000
CVTRV471 EQU   CVTRV466                                                 01052000
CVTRV470 EQU   CVTRV466                                                 01053000
CVTRV469 EQU   CVTRV466                                                 01054000
CVTRV468 EQU   CVTRV466                                                 01055000
CVTRV467 EQU   CVTRV466                                                 01056000
CVTRV465 EQU   CVTRV457                                                 01057000
CVTRV464 EQU   CVTRV457                                                 01058000
CVTRV463 EQU   CVTRV457                                                 01059000
CVTRV462 EQU   CVTRV457                                                 01060000
CVTRV461 EQU   CVTRV457                                                 01061000
CVTRV460 EQU   CVTRV457                                                 01062000
CVTRV459 EQU   CVTRV457                                                 01063000
CVTRV458 EQU   CVTRV457                                                 01064000
CVTRV456 EQU   CVTXTNT2+108                                             01065000
CVTRV455 EQU   CVTXTNT2+104                                             01066000
CVTRV454 EQU   CVTXTNT2+100                                             01067000
CVTRV453 EQU   CVTXTNT2+96                                              01068000
CVTRV452 EQU   CVTXTNT2+94                                              01069000
CVTRV451 EQU   CVTXTNT2+92                                              01070000
CVTRV450 EQU   CVTXTNT2+90                                              01071000
CVTRV449 EQU   CVTXTNT2+88                                              01072000
CVTRV448 EQU   CVTXTNT2+87                                              01073000
CVTRV447 EQU   CVTXTNT2+86                                              01074000
CVTRV446 EQU   CVTRV438                                                 01075000
CVTRV445 EQU   CVTRV438                                                 01076000
CVTRV444 EQU   CVTRV438                                                 01077000
CVTRV443 EQU   CVTRV438                                                 01078000
CVTRV442 EQU   CVTRV438                                                 01079000
CVTRV441 EQU   CVTRV438                                                 01080000
CVTRV440 EQU   CVTRV438                                                 01081000
CVTRV439 EQU   CVTRV438                                                 01082000
CVTRV437 EQU   CVTRV429                                                 01083000
CVTRV436 EQU   CVTRV429                                                 01084000
CVTRV435 EQU   CVTRV429                                                 01085000
CVTRV434 EQU   CVTRV429                                                 01086000
CVTRV433 EQU   CVTRV429                                                 01087000
CVTRV432 EQU   CVTRV429                                                 01088000
CVTRV431 EQU   CVTRV429                                                 01089000
CVTRV430 EQU   CVTRV429                                                 01090000
CVTRV428 EQU   CVTXTNT2+80                                              01091000
CVTRV427 EQU   CVTXTNT2+76                                              01092000
CVTRV426 EQU   CVTXTNT2+72                                              01093000
CVTRV425 EQU   CVTXTNT2+68                                              01094000
CVTATACT EQU   CVTATCVT                                                 01095000
CVTRV423 EQU   CVTXTNT2+62                                              01096000
CVTRV422 EQU   CVTXTNT2+60                                              01097000
CVTRV421 EQU   CVTXTNT2+58                                              01098000
CVTRV420 EQU   CVTXTNT2+56                                              01099000
CVTRV419 EQU   CVTXTNT2+55                                              01100000
CVTRV418 EQU   CVTXTNT2+54                                              01101000
CVTRV417 EQU   CVTRV409                                                 01102000
CVTRV416 EQU   CVTRV409                                                 01103000
CVTRV415 EQU   CVTRV409                                                 01104000
CVTRV414 EQU   CVTRV409                                                 01105000
CVTRV413 EQU   CVTRV409                                                 01106000
CVTRV412 EQU   CVTRV409                                                 01107000
CVTRV411 EQU   CVTRV409                                                 01108000
CVTRV410 EQU   CVTRV409                                                 01109000
CVTRV408 EQU   CVTRV400                                                 01110000
CVTRV407 EQU   CVTRV400                                                 01111000
CVTRV406 EQU   CVTRV400                                                 01112000
CVTRV405 EQU   CVTRV400                                                 01113000
CVTRV404 EQU   CVTRV400                                                 01114000
CVTRV403 EQU   CVTRV400                                                 01115000
CVTRV402 EQU   CVTRV400                                                 01116000
CVTRV401 EQU   CVTRV400                                                 01117000
CVTICB   EQU   CVTXTNT2+48                                              01118000
CVTSKTA  EQU   CVTXTNT2+44                                              01119000
CVTRSV99 EQU   CVTXTNT2+40                                              01120000
CVTRSV98 EQU   CVTXTNT2+36                                              01121000
CVTRSV97 EQU   CVTXTNT2+34                                              01122000
CVTRSV96 EQU   CVTXTNT2+32                                              01123000
CVTOLTEP EQU   CVTXTNT2+28                                              01124000
CVTQIDA  EQU   CVTQID+1                                                 01125000
CVTRSV95 EQU   CVTQID                                                   01126000
CVTRSV94 EQU   CVTXTNT2+20                                              01127000
CVTRSV93 EQU   CVTXTNT2+16                                              01128000
CVTRSV92 EQU   CVTXTNT2+12                                              01129000
CVTDEBVR EQU   CVTXTNT2+8                                               01130000
CVTRSV91 EQU   CVTXTNT2+6                                               01131000
CVTRSV9H EQU   CVTFLGBT                                                 01132000
CVTRSV9G EQU   CVTFLGBT                                                 01133000
CVTRSV9F EQU   CVTFLGBT                                                 01134000
CVTRSV9E EQU   CVTFLGBT                                                 01135000
CVTRSV9D EQU   CVTFLGBT                                                 01136000
CVTRSV9C EQU   CVTFLGBT                                                 01137000
CVTVME   EQU   CVTFLGBT                                                 01138000
CVTNPE   EQU   CVTFLGBT                                                 01139000
CVTNUCLS EQU   CVTXTNT2+4                                               01140000
CVTDSSVA EQU   CVTDSSV+1                                                01141000
CVTRSV89 EQU   CVTDSSV                                                  01142000
CVTRSV88 EQU   CVTXTNT1+8                                               01143000
CVTRSV87 EQU   CVTXTNT1+4                                               01144000
CVTFACHN EQU   CVTXTNT1                                                 01145000
CVTRV488 EQU   CVTMAP+412                                               01146000
CVTRV487 EQU   CVTMAP+408                                               01147000
CVTRV486 EQU   CVTMAP+404                                               01148000
CVTRV485 EQU   CVTMAP+400                                               01149000
CVTACTAP EQU   CVTMAP+396                                               01150000
CVTAUTH  EQU   CVTMAP+392                                               01151000
CVTATMCA EQU   CVTATMCT+1                                               01152000
CVTATMST EQU   CVTATMCT                                                 01153000
CVTRSV61 EQU   CVTMAP+384                                               01154000
CVTVOLT1 EQU   CVTVOLM1+1                                               01155000
CVTVOLI1 EQU   CVTVOLF1                                                 01156000
CVTSTOA  EQU   CVTMAP+376                                               01157000
CVTRSV58 EQU   CVTMAP+374                                               01158000
CVTRSV57 EQU   CVTMAP+372                                               01159000
CVTDDCE  EQU   CVTMAP+368                                               01160000
CVTPNWFR EQU   CVTMAP+364                                               01161000
CVTSMF   EQU   CVTMAP+360                                               01162000
CVTSULK  EQU   CVTMAP+358                                               01163000
CVTSLKO  EQU   CVTSYSK                                                  01164000
CVTSLKP  EQU   CVTSYSK                                                  01165000
CVTSLKQ  EQU   CVTSYSK                                                  01166000
CVTSLKR  EQU   CVTSYSK                                                  01167000
CVTRSV56 EQU   CVTSYSK                                                  01168000
CVTRSV55 EQU   CVTSYSK                                                  01169000
CVTRSV54 EQU   CVTSYSK                                                  01170000
CVTRSV53 EQU   CVTSYSK                                                  01171000
CVTRSV52 EQU   CVTA1F1                                                  01172000
CVTRSV51 EQU   CVTA1F1                                                  01173000
CVTRSV50 EQU   CVTA1F1                                                  01174000
CVTRSV49 EQU   CVTA1F1                                                  01175000
CVTRSV48 EQU   CVTA1F1                                                  01176000
CVTRSV47 EQU   CVTA1F1                                                  01177000
CVTSRSW  EQU   CVTA1F1                                                  01178000
CVTPFSW  EQU   CVTA1F1                                                  01179000
CVTPCVT  EQU   CVTMAP+352                                               01180000
CVTRSV46 EQU   CVTMAP+344                                               01181000
CVTRSV45 EQU   CVTMAP+340                                               01182000
CVTRSV44 EQU   CVTMAP+338                                               01183000
CVTRSV43 EQU   CVTMAP+336                                               01184000
CVTHJESA EQU   CVTHJES+1                                                01185000
CVTRSV42 EQU   CVTHJES                                                  01186000
CVTEXT2A EQU   CVTEXT2+1                                                01187000
CVTRSV41 EQU   CVTEXT2                                                  01188000
CVTAPFA  EQU   CVTAPF+1                                                 01189000
CVTRSV40 EQU   CVTAPF                                                   01190000
CVTRV518 EQU   CVTINTLA                                                 01191000
CVTRV517 EQU   CVTERPV                                                  01192000
CVTEORM  EQU   CVTMAP+312                                               01193000
CVTMCHPR EQU   CVTMAP+308                                               01194000
CVTTZ    EQU   CVTMAP+304                                               01195000
CVTJEPS  EQU   CVTMAP+300                                               01196000
CVTJESCT EQU   CVTMAP+296                                               01197000
CVTMODE  EQU   CVTMAP+292                                               01198000
CVTPTRV  EQU   CVTMAP+288                                               01199000
CVTREAL  EQU   CVTMAP+284                                               01200000
CVTRSV39 EQU   CVTMAP+280                                               01201000
CVTRSV38 EQU   CVTMAP+276                                               01202000
CVTDMSRA EQU   CVTDMSR+1                                                01203000
CVTRV634 EQU   CVTDMSRF                                                 01204000
CVTRV633 EQU   CVTDMSRF                                                 01205000
CVTRV632 EQU   CVTDMSRF                                                 01206000
CVTRV631 EQU   CVTDMSRF                                                 01207000
CVTRV630 EQU   CVTDMSRF                                                 01208000
CVTRV629 EQU   CVTDMSRF                                                 01209000
CVTUDUMP EQU   CVTDMSRF                                                 01210000
CVTSDUMP EQU   CVTDMSRF                                                 01211000
CVTQMSGA EQU   CVTQMSG+1                                                01212000
CVTRSV36 EQU   CVTQMSG                                                  01213000
CVTAMFF  EQU   CVTMAP+264                                               01214000
CVTPURGA EQU   CVTPURG+1                                                01215000
CVTRSV35 EQU   CVTPURG                                                  01216000
CVTCBSP  EQU   CVTMAP+256                                               01217000
CVTATERA EQU   CVTATER+1                                                01218000
CVTSYST  EQU   CVTATER                                                  01219000
CVTVOLT2 EQU   CVTTAT                                                   01220000
CVTVOLI2 EQU   CVTVOLF2                                                 01221000
CVTAQAVB EQU   CVTAQAVT+1                                               01222000
CVTRSV34 EQU   CVTTCMFG                                                 01223000
CVTRSV33 EQU   CVTTCMFG                                                 01224000
CVTRSV32 EQU   CVTTCMFG                                                 01225000
CVTRSV31 EQU   CVTTCMFG                                                 01226000
CVTRSV30 EQU   CVTTCMFG                                                 01227000
CVTRSV29 EQU   CVTTCMFG                                                 01228000
CVTRSV28 EQU   CVTTCMFG                                                 01229000
CVTTCRDY EQU   CVTTCMFG                                                 01230000
CVTGTFA  EQU   CVTGTF+1                                                 01231000
CVTRSV27 EQU   CVTGTFST                                                 01232000
CVTRNIO  EQU   CVTGTFST                                                 01233000
CVTUSR   EQU   CVTGTFST                                                 01234000
CVTRV318 EQU   CVTFORM                                                  01235000
CVTRV317 EQU   CVTTMODE                                                 01236000
CVTRV316 EQU   CVTSTATE                                                 01237000
CVTRV315 EQU   CVTGTFS                                                  01238000
CVTGTFAV EQU   CVTGTFS                                                  01239000
CVT0SCR1 EQU   CVTMAP+232                                               01240000
CVTRV515 EQU   CVTMAP+228                                               01241000
CVTRMS   EQU   CVTMAP+224                                               01242000
CVTPATCH EQU   CVTMAP+220                                               01243000
CVTTSCE  EQU   CVTMAP+216                                               01244000
CVTLNKSC EQU   CVTMAP+214                                               01245000
CVTQABST EQU   CVTMAP+212                                               01246000
CVTMDLDS EQU   CVTMAP+208                                               01247000
CVTUSER  EQU   CVTMAP+204                                               01248000
CVTABEND EQU   CVTMAP+200                                               01249000
CVTSMCA  EQU   CVTMAP+196                                               01250000
CVTRSV18 EQU   CVTMAP+192                                               01251000
CVTQLPAQ EQU   CVTMAP+188                                               01252000
CVTQCDSR EQU   CVTMAP+184                                               01253000
CVTRSV17 EQU   CVTOPTB                                                  01254000
CVTRSV16 EQU   CVTOPTB                                                  01255000
CVTFP    EQU   CVTOPTB                                                  01256000
CVTAPTHR EQU   CVTOPTB                                                  01257000
CVTNLOG  EQU   CVTOPTB                                                  01258000
CVTTOD   EQU   CVTOPTB                                                  01259000
CVTCTIMS EQU   CVTOPTB                                                  01260000
CVTPROT  EQU   CVTOPTB                                                  01261000
CVTXPFP  EQU   CVTOPTA                                                  01262000
CVTASCII EQU   CVTOPTA                                                  01263000
CVTRSV13 EQU   CVTOPTA                                                  01264000
CVTRSV12 EQU   CVTOPTA                                                  01265000
CVTNIP   EQU   CVTOPTA                                                  01266000
CVTDDR   EQU   CVTOPTA                                                  01267000
CVTAPR   EQU   CVTOPTA                                                  01268000
CVTCCH   EQU   CVTOPTA                                                  01269000
CVTSNCTR EQU   CVTMAP+180                                               01270000
CVTQMWR  EQU   CVTMAP+176                                               01271000
CVTQOCR  EQU   CVTMAP+172                                               01272000
CVT1EF00 EQU   CVTMAP+168                                               01273000
CVTMZ00  EQU   CVTMAP+164                                               01274000
CVTSV76Q EQU   CVTSV76C                                                 01275000
CVTRSV11 EQU   CVTMAP+156                                               01276000
CVT0PT01 EQU   CVTMAP+152                                               01277000
CVTMSER  EQU   CVTMAP+148                                               01278000
CVTRV516 EQU   CVTIERLC                                                 01279000
CVTILCH  EQU   CVTMAP+140                                               01280000
CVT0DS   EQU   CVTMAP+136                                               01281000
CVTFBOSV EQU   CVTMAP+132                                               01282000
CVTNUCB  EQU   CVTMAP+128                                               01283000
CVTIXAVL EQU   CVTMAP+124                                               01284000
CVTSV76M EQU   CVTIOQET                                                 01285000
CVTDCBA  EQU   CVTMAP+117                                               01286000
CVTMVS2  EQU   CVTDCB                                                   01287000
CVT6DAT  EQU   CVTDCB                                                   01288000
CVT4MPS  EQU   CVTDCB                                                   01289000
CVTRSV09 EQU   CVTDCB                                                   01290000
CVT4MS1  EQU   CVTDCB                                                   01291000
CVT2SPS  EQU   CVTDCB                                                   01292000
CVT1SSS  EQU   CVTDCB                                                   01293000
CVTRSV08 EQU   CVTDCB                                                   01294000
CVTSTB   EQU   CVTMAP+112                                               01295000
CVTQTD00 EQU   CVTMAP+108                                               01296000
CVTQTE00 EQU   CVTMAP+104                                               01297000
CVTCUCB  EQU   CVTMAP+100                                               01298000
CVTSJQ   EQU   CVTMAP+96                                                01299000
CVTPBLDL EQU   CVTMAP+92                                                01300000
CVTTPC   EQU   CVTMAP+88                                                01301000
CVTSVDCB EQU   CVTMAP+84                                                01302000
CVTBRET  EQU   CVTMAP+82                                                01303000
CVTEXIT  EQU   CVTMAP+80                                                01304000
CVT0FN00 EQU   CVTMAP+76                                                01305000
CVTDARA  EQU   CVTDAR+1                                                 01306000
CVTRSV07 EQU   CVTFLGS1                                                 01307000
CVTRSV06 EQU   CVTFLGS1                                                 01308000
CVTRSV05 EQU   CVTFLGS1                                                 01309000
CVTRSV04 EQU   CVTFLGS1                                                 01310000
CVTRSV03 EQU   CVTFLGS1                                                 01311000
CVTRSV02 EQU   CVTFLGS1                                                 01312000
CVTRSV01 EQU   CVTFLGS1                                                 01313000
CVTDMPLK EQU   CVTFLGS1                                                 01314000
CVTXITP  EQU   CVTMAP+68                                                01315000
CVTZDTAB EQU   CVTMAP+64                                                01316000
CVTMSLT  EQU   CVTMAP+60                                                01317000
CVTDATE  EQU   CVTMAP+56                                                01318000
CVTBTERM EQU   CVTMAP+52                                                01319000
CVTSYSAD EQU   CVTMAP+48                                                01320000
CVTXTLER EQU   CVTMAP+44                                                01321000
CVTILK2  EQU   CVTMAP+40                                                01322000
CVTILK1  EQU   CVTMAP+36                                                01323000
CVTPRLTV EQU   CVTMAP+32                                                01324000
CVTPCNVT EQU   CVTMAP+28                                                01325000
CVT0VL00 EQU   CVTMAP+24                                                01326000
CVTXAPG  EQU   CVTMAP+20                                                01327000
CVTBUF   EQU   CVTMAP+16                                                01328000
CVTJOB   EQU   CVTMAP+12                                                01329000
CVTLINK  EQU   CVTMAP+8                                                 01330000
CVT0EF00 EQU   CVTMAP+4                                                 01331000
CVTTCBP  EQU   CVTMAP                                                   01332000
AMDEXCP  EQU   AMDSTAT+44                                               01333000
AMDNCAS  EQU   AMDSTAT+40                                               01334000
AMDNCIS  EQU   AMDSTAT+36                                               01335000
AMDASPA  EQU   AMDSTAT+32                                               01336000
AMDRETR  EQU   AMDSTAT+28                                               01337000
AMDUPR   EQU   AMDSTAT+24                                               01338000
AMDIREC  EQU   AMDSTAT+20                                               01339000
AMDDELR  EQU   AMDSTAT+16                                               01340000
AMDNLR   EQU   AMDSTAT+12                                               01341000
AMDNEXT  EQU   AMDSTAT+10                                               01342000
AMDNIL   EQU   AMDSTAT+8                                                01343000
AMDSTSP  EQU   AMDSTAT                                                  01344000
@NM00015 EQU   IDAAMDSB+41                                              01345000
@NM00014 EQU   AMDATTR3                                                 01346000
AMDLM    EQU   AMDATTR3                                                 01347000
AMDWAIT  EQU   AMDATTR3                                                 01348000
AMDBIND  EQU   AMDATTR3                                                 01349000
AMDFAULT EQU   AMDATTR3                                                 01350000
AMDUNQ   EQU   AMDATTR3                                                 01351000
AMDPARDB EQU   IDAAMDSB+36                                              01352000
AMDMAXRR EQU   AMDSSRBA                                                 01353000
AMDNSLOT EQU   AMDHLRBA                                                 01354000
AMDCINV  EQU   IDAAMDSB+20                                              01355000
AMDFSCI  EQU   IDAAMDSB+16                                              01356000
AMDFSCA  EQU   IDAAMDSB+14                                              01357000
AMDCIPCA EQU   IDAAMDSB+12                                              01358000
AMDPCTCI EQU   IDAAMDSB+11                                              01359000
AMDPCTCA EQU   IDAAMDSB+10                                              01360000
AMDAXRKP EQU   AMDNEST                                                  01361000
AMDLEN   EQU   IDAAMDSB+2                                               01362000
AMDSPAN  EQU   AMDATTR                                                  01363000
AMDRRDS  EQU   AMDATTR                                                  01364000
AMDRANGE EQU   AMDATTR                                                  01365000
AMDORDER EQU   AMDATTR                                                  01366000
AMDREPL  EQU   AMDATTR                                                  01367000
AMDSDT   EQU   AMDATTR                                                  01368000
AMDWCK   EQU   AMDATTR                                                  01369000
AMDDST   EQU   AMDATTR                                                  01370000
AMDSBID  EQU   IDAAMDSB                                                 01371000
CMFXHRBA EQU   CMFXECTS+16                                              01372000
CMFXLRBA EQU   CMFXECTS+12                                              01373000
CMFXNOTT EQU   CMFXECTS+10                                              01374000
CMFXEDHH EQU   CMFXEDA+2                                                01375000
CMFXEDCC EQU   CMFXEDA                                                  01376000
CMFXSTHH EQU   CMFXSTA+2                                                01377000
CMFXSTCC EQU   CMFXSTA                                                  01378000
CMFXEXSS EQU   CMFXECTS                                                 01379000
CMFLEND  EQU   CMFOVLAY+14                                              01380000
CMFBYTAU EQU   CMFOVLAY+4                                               01381000
CMFBYTRK EQU   CMFOVLAY                                                 01382000
CMFLSSDS EQU   GVO+35                                                   01383000
@NM00013 EQU   CMFLITEX                                                 01384000
CMFLNOPF EQU   CMFLITEX                                                 01385000
CMFLSSDT EQU   CMFLITEX                                                 01386000
CMFLNTKA EQU   GVO+32                                                   01387000
CMFLNBTK EQU   GVO+30                                                   01388000
CMFLPHYB EQU   GVO+26                                                   01389000
CMFLHABA EQU   GVO+22                                                   01390000
CMFLHUBA EQU   GVO+18                                                   01391000
CMFLHKBA EQU   GVO+14                                                   01392000
@NM00012 EQU   CMFLVLFL                                                 01393000
CMFLVLOV EQU   CMFLVLFL                                                 01394000
CMFLVLCN EQU   CMFLVLFL                                                 01395000
CMFLVLPR EQU   CMFLVLFL                                                 01396000
CMFLFLSQ EQU   GVO+10                                                   01397000
CMFLVOL  EQU   GVO+4                                                    01398000
CMFLDEVT EQU   GVO                                                      01399000
DS1END   EQU   IECSDSL1+140                                             01400000
DS1PTRDS EQU   IECSDSL1+135                                             01401000
DS1EXT3  EQU   IECSDSL1+125                                             01402000
DS1EXT2  EQU   IECSDSL1+115                                             01403000
@NM00011 EQU   IECSDSL1+103                                             01404000
DS1TRBAL EQU   IECSDSL1+101                                             01405000
DS1LSTAR EQU   IECSDSL1+98                                              01406000
DS1SCALO EQU   IECSDSL1+94                                              01407000
DS1OPTCD EQU   IECSDSL1+85                                              01408000
DS1RECFM EQU   IECSDSL1+84                                              01409000
@NM00010 EQU   IECSDSL1+75                                              01410000
DS1SYSCD EQU   IECSDSL1+62                                              01411000
@NM00009 EQU   IECSDSL1+61                                              01412000
DS1NOBDB EQU   IECSDSL1+60                                              01413000
DS1VOLSQ EQU   IECSDSL1+51                                              01414000
@NM00008 EQU   IECSDSF1                                                 01415000
CTGFLDWA EQU   CTGFL+4                                                  01416000
CTGFLDTS EQU   CTGFLDRE                                                 01417000
@NM00007 EQU   CTGFLDRE                                                 01418000
CTGPSWD  EQU   CTGJSCB                                                  01419000
@NM00005 EQU   CTGFBFLG                                                 01420000
CTGNGDSN EQU   CTGFBFLG                                                 01421000
CTGGDGB  EQU   CTGFBFLG                                                 01422000
CTGKEEP  EQU   CTGFBFLG                                                 01423000
CTGPAR   EQU   CTGFBFLG                                                 01424000
CTGFDBK  EQU   CTGNEWNM                                                 01425000
CTGTYPE  EQU   CTGPL+18                                                 01426000
@NM00004 EQU   CTGDSORG                                                 01427000
CTGOPTNS EQU   CTGDSORG                                                 01428000
CTGCVOL  EQU   CTGCAT                                                   01429000
CTGFVT   EQU   CTGENT                                                   01430000
@NM00003 EQU   CTGOPTN4                                                 01431000
CTGBYPMT EQU   CTGOPTN4                                                 01432000
CTGCOIN  EQU   CTGOPTN4                                                 01433000
@NM00002 EQU   CTGOPTN4                                                 01434000
CTGDOCAT EQU   CTGOPTN4                                                 01435000
CTGLBASE EQU   CTGOPTN4                                                 01436000
CTGNUM   EQU   CTGOPTN3                                                 01437000
CTGSRH   EQU   CTGOPTN3                                                 01438000
CTGGDGL  EQU   CTGOPTN3                                                 01439000
CTGSUPLT EQU   CTGOPTN3                                                 01440000
@NM00001 EQU   CTGOPTN2                                                 01441000
CTGSCR   EQU   CTGOPTN2                                                 01442000
CTGOVRID EQU   CTGOPTN2                                                 01443000
CTGDISC  EQU   CTGOPTN2                                                 01444000
CTGGTNXT EQU   CTGOPTN2                                                 01445000
CTGRCATN EQU   CTGVMNT                                                  01446000
CTGGTALL EQU   CTGREL                                                   01447000
CTGNSVS  EQU   CTGEXT                                                   01448000
CTGGENLD EQU   CTGOPTN1                                                 01449000
CTGCNAME EQU   CTGOPTN1                                                 01450000
CTGREAD  EQU   CTGOPTN1                                                 01451000
CTGUPD   EQU   CTGOPTN1                                                 01452000
CTGCI    EQU   CTGOPTN1                                                 01453000
CTGMAST  EQU   CTGOPTN1                                                 01454000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      01455000
@ENDDATA EQU   *                                                        01456000
         END   IGC0102G,(C'PLS0435',0701,77175)                         01457000
./  ADD  SSI=80550091,NAME=IGC0107H
         TITLE     'IGC0107H  -  DADSM  -  LSPACE 2ND LOAD'             00200019
IGC0107H CSECT                                                          00400019
*          RELEASE 20 DELETIONS                                         00600019
*0364                                                            A35588 00700020
*0364012000-022000                                               20201  00750020
*          RELEASE 21 DELETIONS                                         00800019
*1195                                                            A38860 00810021
*1195032000-044000,060000-064000,108000,284000,456000,474000-    A40793 00820021
*1195478000,624000                                               A40793 00840021
*1195120000,214500-222000,520000,524000,532000,584200-585600,    A42182 00860021
*1195618000,650000-652000,656000,720000-726000,742000-748000     A42182 00920021
*0000572000                                                     SA49351 00970021
*          RELEASE 22 DELETIONS                                         01000019
*          VS2 RELEASE 02 DELETIONS/CHANGES                             01100002
*0000002100-002800,041000-042000,082000-084000,090000-094000,    Y02080 01100102
*0000106000,113000,134000,152000,162000,184000,198000,204000,    Y02080 01100202
*0000210100-210800,211200,211400-211500,242000,246000,280100-    Y02080 01100302
*0000281500,288000,358000,364000-366000,376400-377200,379200,    Y02080 01100402
*0000571200-572000,576000,580000,604000-608000,620000-622000,    Y02080 01100502
*0000626000,638000-666000,698000-760000,764000-774000            Y02080 01100602
*0000                                                            Y02130 01100702
*0000035000-037000,210850-210860,378200-379000,379400            Y02145 01100802
*0000142000-144000,556000,564000,582000                          Y02078 01100902
*0000                                                            Y02144 01101002
*          VS2 RELEASE 037 CHANGES                                      02400037
*A210847-210861,379200-379900,456000-4576400                   @ZA16899 02400237
*C457200                                                       @ZA16899 02400437
*0000210861,379500                                             @ZA30235 02401037
* MODULE NAME - IGC0107H                                                02402002
*                                                                       02403002
* DESCRIPTIVE NAME -  DADSM  -  LSPACE 2ND LOAD                         02404002
*                                                                       02405002
* COPYRIGHT - NONE                                                      02406002
*                                                                       02407002
* CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD          02408002
*                                                                       02409002
* STATUS CHANGE LEVEL 003                                               02600021
*                                                                       02800019
* FUNCTION/OPERATION                                                    03000019
*    IGC0107H READS IN THE FORMAT 4 DSCB AND THE FIRST FORMAT 5         03100021
*    DSCB. AS IT READS IN ANY CHAINED FORMAT 5 DSCB'S, IT TOTALS        03200021
*    THE AVAILABLE SPACE LISTED IN THEM AND SAVES THE LARGEST EXTENT.   03300021
*    IF SMF HAS BEEN SPECIFIED, THE MODULE IDENTIFICATION IS SENSED     03400021
*    AND THE VOLUME LABEL IS READ.  IGC0107H THEN BUILDS AN SMF RECORD  03500002
*    TYPE 19 AND RECORDS IT ON THE SMF DATA SET.  IF 'DISPLAY SPACE'    03700002
*    INFORMATION IS REQUIRED, THE SPACE INFORMATION COLLLECTED          03800021
*    FROM THE FORMAT 5 DSCB(S) IS CONVERTED TO EBCDIC AND PLACED        03900021
*    IN THE CALLER'S MESSAGE AREA. AFTER DEQ'ING THE VTOC AND           04000021
*    FREEING THE WORK AREA, THIS MODULE RETURNS TO THE CALLER.          04100002
*                                                                       04600019
* ENTRY POINT                                                           04800019
*    IGC0107H - THIS MODULE IS THE SECOND LOAD OF THE LSPACE      19028 05000019
*               ROUTINE (SVC 78) AND IS ENTERED FROM MODULE       19028 05200019
*               IGC0007H.                                         19028 05400019
*                                                                       05600019
* INPUT ON ENTRY TO THIS MODULE                                         05800019
*    REGISTER 7 POINTS TO THE UCB.                                      06000021
*    REGISTER 9 POINTS TO THE 'DISPLAY SPACE' MESSAGE AREA.             06200021
*    REGISTER 13 POINTS TO THE WORKAREA.                                06400021
*                                                                       06600019
* OUTPUT                                                                06800019
*    IF THE SPACE INFORMATION WAS REQUESTED, REGISTER ONE WILL    19028 07000019
*    CONTAIN THE POINTER TO THE CALLER'S MESSAGE AREA AND THE     19028 07200019
*    MESSAGE AREA WILL CONTAIN THE INFORMATION IN EBCDIC.         19028 07400019
*    REGISTER FIFTEEN WILL CONTAIN A RETURN CODE.                 19028 07600019
*                                                                       07800019
* EXTERNAL ROUTINES                                                     08000019
*    CVTEXPRO      - EXIT PROLOG ADDRESS                                08200002
*    IECRES        - FREE THE WORK AREA                                 08400002
*    EXCP (0)      - READ FROM DIRECT ACCESS DEVICE                     08600019
*    WAIT (1)      - WAIT ON EVENT CONTROL BLOCK                        08800019
*    DEQ (48)      - DEQUEUE THE VTOC                                   09600019
*    TIME (11)     - GET TIME OF DAY AND DATE                     19028 09800019
*    SMFWTM (83)   - WRITE TO THE SMF DATA SET                    19028 10000019
*    IEC0SCR1      - RPS SECTOR CONVERT ROUTINE                         10100002
*                                                                       10200019
* EXITS                                                                 10400019
*    RETURN IS MADE TO THE CALLER VIA IN BOTH NORMAL AND                10600002
*    ERROR EXITS. REGISTER 15 WILL CONTAIN A RETURN CODE. IF AN         10700021
*    ERROR OCCURS AND THE CALLER IS 'DISPLAY SPACE', AN ERROR           10800021
*    MESSAGE IS PLACED IN THE CALLER'S MESSAGE AREA.                    10900021
*                                                                       11000019
* RETURN CODES THAT CAN BE ISSUED BY LSPACE.                            11200019
*    00 - SUCCESSFUL PROCESSING                                         11400019
*    04 - PERMANENT I/O ERROR                                           11600019
*    08 - NON-STANDARD OS VOLUME                                        11800019
*    0C - INVALID UCB POINTER OR NOT A DIRECT ACCESS VOLUME OR          11900021
*         UCB NOT READY                                                 12000021
*    10 - UNSUCCESSFUL VALIDITY CHECK ON CALLER'S MESSAGE         19028 12200019
*         POINTER OR INVALID SMF INDICATOR                        19028 12400019
*                                                                       12600019
* TABLES/WORK AREAS                                                     12800019
*    LSPACE WORK AREA DESCRIBED BY MACRO IECLSPWA                       13000002
*                                                                       13200019
* ATTRIBUTES  REENTRANT                                                 13400002
*                                                                       13600019
* OTHER MACROS USED                                                     13800019
*    IECLSPWA - DEFINE THE LSPACE WORK AREA                             13900002
*    IECSDSL1 - BUILD DSCB'S                                            14000019
*    IECDSECS - EXPANDS THE CVT, RB, TCB, AND UCB DSECTS                14200002
*    IEFSMCA  - BUILD THE SYSTEM MANAGEMENT CONTROL AREA          19028 14600019
*    IFASMFR  - BUILD AN SMF RECORD                               19028 14800019
*                                                                       15000019
*                                                                       15400019
*                                                                       15600019
         BALR  BASEREG,0                                                15800019
         USING BEGIN,BASEREG                                            16000019
         USING LSPACWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 16200002
         USING UCB,RUCBPTRL                                             16400019
         USING CVT,RCVT                                                 16600019
*                                                                       16800019
REGZERO  EQU   0                                                        17000019
REGONE   EQU   1                                                        17200019
RSMCA    EQU   1                                                        17400019
REGTWO   EQU   2                                                        17600019
REGTHREE EQU   3                                                        17800019
REGFOUR  EQU   4                                                        18000019
REGFIVE  EQU   5                                                        18200019
REGSIX   EQU   6                                                        18600019
REGSEVEN EQU   7                                                        18800019
RUCBPTRL EQU   7                        UCB POINTER                     19000019
REGEIGHT EQU   8                                                        19200019
REGNINE  EQU   9                                                        19400019
REGTEN   EQU   10                                                       19600019
BASEREG  EQU   12                       BASE REGISTER                   20000019
RWKAREA  EQU   13                       WORK AREA POINTER               20200019
RBAK     EQU   14                                                       20600019
RCVT     EQU   15                                                       20800019
RERRPASS EQU   15                       ERROR PASS REGISTER             21000019
*                                                                       21081021
* OTHER EQUATES                                                         21082021
*                                                                       21083021
ZERO     EQU   X'00'                    ONE BYTE OF ZERO         A40793 21084021
DA2314   EQU   X'08'                    2314 UCBTYP4           @ZA16899 21084737
DA3330   EQU   X'09'                    3330 UCBTYP4           @ZA16899 21085437
DA3330B  EQU   X'0D'                    3330-11 UCBTYP4        @ZA30235 21086137
REMOVE01 EQU   X'3F'                    REMOVE BITS 0 AND 1      A40793 21087021
CHAINING EQU   X'40'                    COMMAND CHAINING         A40793 21088021
C1       EQU   1                        ONE CHARACTER            20201  21090020
FW       EQU   4                        BYTES IN A  FULL WORD    20201  21100020
C7       EQU   7                        DISP OF SEVEN            20201  21110020
K12      EQU   12                       CONSTANT OF 12           Y02080 21121002
CCWSTART EQU   16                       IOB CCW START ADR OFFSET Y02080 21122002
RECORD3  EQU   X'03'                    RECORD THREE             Y02080 21123002
MSGL     EQU   30                       MESSAGE LENGTH OF 30     Y02078 21124002
RPSMSK   EQU   X'10'                    TESTS RPS BIT IN UCB     20201  21130020
*                                                                       21200019
BEGIN    EQU   *                                                        21400019
*                                                                       22400019
* THIS SECTION LINKS TO IOS FOR ALL I/O OPERATIONS                      22600019
*                                                                       22800019
EXECUTET EXCP  IOB                                                      23000019
         WAIT  1,ECB=ECB                                                23200019
         TM    ECB,X'20'                CHECK FOR PERMANENT I/O ERROR   23400019
         BO    WHERETO                  BRANCH IF NO ERROR              23600019
         OI    SWITCH,X'04'             SET ERROR CODE                  23800019
         B     SETDEQ                                                   24000019
WHERETO  EQU   *                        WHAT ARE WE DOING        Y02080 24050002
         TM    SWITCH,RDVOLABL          WAS READ FOR VOL LABEL   Y02080 24200002
         BO    BLDSMF                   BRANCH IF YES             19028 24400019
         TM    SWITCH,RD2NDF5           IS THIS THE FIRST F4&F5  Y02080 24600002
         BC    1,ADDIN                  BRANCH IF NOT                   24800019
*                                                                       25000019
* THIS SECTION TESTS FOR VTOC NOT IN EXPECTED FORM                      25200019
*                                                                       25400019
         TM    DS4VTOCI,X'80'           IS THIS BOS CONTAMINATED        25600019
         BC    8,SETNXT                 BRANCH IF NOT                   25800019
         OI    SWITCH,X'08'             SET ERROR CODE                  26000019
         BC    15,SETDEQ                GO TO ERROR EXIT                26200019
*                                                                       26400019
* THIS SECTION RELOCATES THE CHANNEL PROGRAM TO READ IN SUBSEQUENT      26600019
* FORMAT 5 DSCB'S.                                                      26800019
*                                                                       27000019
SETNXT   LM    REGZERO,REGFIVE,CHANPROG LOAD NEXT THREE CCW'S           27200019
         ALR   REGZERO,RWKAREA                                          27400019
         ALR   REGTWO,RWKAREA                                           27600019
         ALR   REGFOUR,RWKAREA                                          27800019
         STM   REGZERO,REGFIVE,CCW1     STORE THREE CCW'S               28000019
*                                                                       28200019
* TOTAL UP THE AVAILABLE SPACE GIVEN IN THE FORMAT 5 DSCB.              28400021
*                                                                       28600019
ADDIN    EQU   *                        TOTAL UP THE SPACE       Y02080 28700002
         MVC   DS5FMTID(90),DS5FMTID+1  TAKE OUT 1 BYTE FORMAT ID       29000019
         LA    REGONE,26                SET UP ENTRY COUNTER            29200019
         LA    REGTWO,DS5AVEXT          SET UP ENTRY POINTER            29400019
         LM    REGTHREE,REGFIVE,SAVETOT LOAD PREVIOUS TOTALS            29600019
ADDIN1   OC    0(5,REGTWO),0(REGTWO)                                    29800019
         BE    CHECKOUT                                                 30000019
         CLC   2(3,REGTWO),TEMPCTG      COMPARE EXTENT SIZE             30200019
         BC    12,ADDIN2                BRANCH IF SMALLER               30400019
         MVC   TEMPCTG(3),2(REGTWO)     SAVE THIS ONE IF LARGER         30600019
ADDIN2   SR    REGSIX,REGSIX                                            30800019
         IC    REGSIX,4(REGTWO)         ADD NUMBER OF TRACKS            31000019
         AR    REGFOUR,REGSIX           IN THIS EXTENT TO TOTAL         31200019
         IC    REGSIX,2(REGTWO)                                         31400019
         SLL   REGSIX,8                                                 31600019
         IC    REGSIX,3(REGTWO)                                         31800019
         AR    REGTHREE,REGSIX          TO TOTAL                        32000019
         LA    REGFIVE,1(REGFIVE)       BUMP NUMBER OF AREAS BY ONE     32200019
         LA    REGTWO,5(REGTWO)                                         32400019
         BCT   REGONE,ADDIN1                                            32600019
CHECKOUT STM   REGTHREE,REGFIVE,SAVETOT SAVE THIS F5'S TOTALS           32800019
         OC    DS5PTRDS(5),DS5PTRDS     CHECK CHAIN ADDRESS OF F5 DSCB  33000019
         BZ    TESTSMF                                            19028 33200019
         OI    SWITCH,RD2NDF5           INDICATE READING 2ND F5  Y02080 33300002
         MVC   SEEK+3(5),DS5PTRDS       UPDATE SEEK ADDRESS             33400019
         TM    UCBTBYT2,RPSMSK          DOES DEVICE HAVE RPS     Y02080 33410002
         BZ    EXECUTET                 NO, CONTINUE AS NORMAL   Y02080 33420002
         LA    REGTWO,THETA             GET THETA ADDRESS        Y02080 33430002
         XC    CCW2+FW(FW),CCW2+FW      CLEAR WORK WORD          Y02080 33440002
         MVC   CCW2+FW(C1),UCBTBYT4     GET DEVICE CODE          Y02080 33450002
         O     REGTWO,CCW2+FW           PUT IN HIGH BYTE         Y02080 33460002
         L     REGZERO,PARM0            PREPARE PARAMETERS       Y02080 33470002
         IC    REGZERO,SEEK+C7          GET RECORD NUMBER        Y02080 33480002
         L     RCVT,CVTPTR              GET CVT ADDR             Y02080 33490002
         L     RCVT,CVT0SCR1            GET SECTOR CNVT RTN ADDR Y02080 33500002
         STM   REGNINE,RWKAREA,REGSAVEA  SAVE REGISTERS          Y02080 33510002
         LR    REGTHREE,RWKAREA         SAVE WORK AREA ADDRESS   Y02080 33520002
         BALR  RBAK,RCVT                GET SECTOR VALUE         Y02080 33530002
         LM    REGNINE,RWKAREA,REGSAVEA-FIRST(REGTHREE)  RESTORE Y02080 33540002
         BC    15,EXECUTET                                              33600019
*                                                                       33650021
* THIS SECTION CONVERTS BINARY TO EBCDIC.                               33700021
*                                                                       33750021
CONVERT  L     REGFOUR,0(REGTWO)                                        33800019
         CVD  REGFOUR,CVTAREA                                           34000019
         UNPK  CVTAREA(4),CVTAREA+4(4)                                  34200019
         OI    CVTAREA+3,X'F0'                                          34400019
         MVC   0(4,REGTWO),CVTAREA                                      34600019
         LA    REGTWO,4(REGTWO)                                         34800019
         BCT   REGONE,CONVERT                                           35000019
         BR    REGTHREE                                                 35200019
TESTSMF  TM    SMFFLAG,X'C0'            TEST FOR SMF FUNCTIONS    19028 35400019
         BZ    INITCVT                  BRANCH IF NOT REQUIRED    19028 35600019
*                                                                       35650021
* THIS SECTION BUILDS THE CCW'S TO READ THE VOLUME LABEL.               35700021
*                                                                       35750021
         OI    SWITCH,RDVOLABL          SET BIT TO READ LABEL    Y02080 35800002
         LM    REGZERO,REGSEVEN,CCWPLBL GET CCWS TO READ THE      19028 36000019
*                                       VOLUME LABEL              19028 36200019
         XC    SEEK,SEEK                ZERO THE IOB SEEK FIELD  Y02080 36300002
         MVI   SEEK+C7,RECORD3          SET R TO 3 FOR LABEL     Y02080 36600002
         ALR   REGZERO,RWKAREA          SET ADDRESS PORTION OF    19028 36800019
         ALR   REGTWO,RWKAREA           THE CCWS                  19028 37000019
         ALR   REGFOUR,RWKAREA                                    19028 37200019
         ALR   REGSIX,RWKAREA                                     19028 37400019
         STM   REGZERO,REGSEVEN,CCW1    PUT CCWS IN WORKAREA      19028 37600019
         LA    REGONE,CCW1              POINT TO CCW1            Y02080 37740002
         ST    REGONE,IOB+CCWSTART      BEGIN CHAN PROG AT CCW1  Y02080 37744002
         MVI   SMF19IND+1,ZERO          ZERO SENSE AREA          A40793 37760021
         L     RUCBPTRL,DEB+32          RESTORE UCB POINTER       19028 37800019
         CLI   UCBTYP+3,DA2314          TEST DEVICE TYPE       @ZA16899 37920037
         BE    SENSE                    BRANCH IF 2314         @ZA16899 37930037
         CLI   UCBTYP+3,DA3330B         TEST DEVICE TYPE       @ZA16899 37940037
         BE    SENSE                    BRANCH IF 3330-11      @ZA30235 37950037
         CLI   UCBTYP+3,DA3330          TEST DEVICE TYPE       @ZA16899 37960037
         BNE   NOSENSE                  BRANCH IF NOT 3330     @ZA16899 37970037
SENSE    MVI   CCW3+FW,CHAINING         SET COMMAND CHAINING   @ZA16899 37980037
NOSENSE  B     EXECUTET                                        @ZA16899 37990037
*                                                                       38050021
* THIS SECTION BUILDS AND RECORDS AN SMF RECORD TYPE 19.                38100021
*                                                                       38150021
BLDSMF   MVC   SMF19HDR(6),SMFHDR       SMF RECORD HEADER         19028 38200019
         MVC   SMF19DSR(2),DS4DSREC     NUMBER OF FMT 0 DSCB'S   M4920  38300019
         L     RCVT,CVTPTR              SET CVT BASE              19028 38400019
         L     RSMCA,CVTSMCA            GET PTR FOR SMCA          19028 38600019
         USING SMCABASE,RSMCA                                     19028 38800019
         MVC   SMF19SID(4),SMCASID      MOVE SYSTEM ID TO RECORD  19028 39000019
         DROP  RSMCA                                              19028 39200019
         TIME  BIN                      GET THE TIME AND DATE     19028 39400019
         STM   REGZERO,REGONE,TEMPAREA                            19028 39600019
         MVC   SMF19TME(8),TEMPAREA                               19028 39800019
         MVC   TEMPAREA(8),DS4VTOCE+2   CALCULATE THE NUMBER OF   19028 40000019
         LH    REGZERO,TEMPAREA         DETERMINE THE NUMBER OF   19028 40200019
         MH    REGZERO,DS4DEVSZ+2       TRACKS IN THE VTOC        19028 40400019
         AH    REGZERO,TEMPAREA+2       AND COMPUTE THE NUMBER    19028 40600019
         LH    REGONE,TEMPAREA+4        OF DSCB'S THAT WILL FIT   19028 40800019
         MH    REGONE,DS4DEVSZ+2        IN THE VTOC.              19028 41000019
         AH    REGONE,TEMPAREA+6                                  19028 41200019
         SR    REGONE,REGZERO                                     19028 41400019
         LA    REGONE,1(REGONE)                                   19028 41600019
         XR    REGZERO,REGZERO                                    19028 41800019
         IC    REGZERO,DS4DEVDT                                   19028 42000019
         MR    REGZERO,REGZERO                                    19028 42200019
         ST    REGONE,TEMPAREA                                    19028 42400019
         XC    SMF19RV1(2),SMF19RV1     ZERO RESERVED AREA        19028 42600019
         MVC   SMF19VOL(6),VOLSERNO     VOLUME SERIAL NUMBER      19028 42800019
         MVC   SMF19OID(10),VOLOWNER    VOLUME OWNER IDENT        19028 43000019
         MVC   SMF19DEV(4),UCBTYP       DEVICE TYPE               19028 43200019
         MVC   SMF19VTC(5),VOLVTOC      VOLUME VTOC ADDRESS       19028 43400019
         MVC   SMF19VTI(1),DS4VTOCI     VTOC INDICATORS           19028 43600019
         MVC   SMF19NDS(2),TEMPAREA+2   NUMBER OF DSCB'S          19028 43800019
         MVC   SMF19NAT(2),DS4NOATK     NUMBER OF ALT TRACKS      19028 44200019
         MVC   SMF19SPC(2),SAVETOT+2    UNUSED SPACE (CCTT)       19028 44400019
         MVC   SMF19SPC+2(2),SAVETOT+6                            19028 44600019
         MVC   SMF19LEX(2),TEMPCTG      SIZE OF LARGEST FREE      19028 44800019
         MVI   SMF19LEX+2,X'00'         EXTENT (CC0T)             19028 45000019
         MVC   SMF19LEX+3(1),TEMPCTG+2                            19028 45200019
         MVC   SMF19NUE(2),SAVETOT+10   NUMBER OF FREE EXTENTS    19028 45400019
         XC    SMF19RV2(5),SMF19RV2     ZERO RESERVED AREA       A40793 45500021
         CLI   UCBTYP+3,DA2314          CHECK DEVICE TYPE      @ZA16899 45600037
         BNZ   NORESET                  DO NOT RESET           @ZA16899 45640037
         NI    SMF19IND+1,REMOVE01      REMOVE UNWANTED BITS     A40793 45680037
NORESET  MVC   SMF19CUU(2),UCBCHA                              @ZA16899 45720037
         LA    REGONE,SMFRCD19                                    19028 45800019
         SVC   83                       WRITE SMF RECORD TYPE 19  19028 46000019
         LA    REGONE,0(REGNINE)        SHOULD MSG BE RETURNED    19028 46200019
         LTR   REGONE,REGONE                                      19028 46400019
         BZ    SETDEQ                   BRANCH IF NO MSG          19028 46600019
*                                                                       46640021
* THIS SECTION CONVERTS THE SPACE INFORMATION AND MOVES IT              46680021
* TO THE CALLER'S MESSAGE AREA.                                         46720021
*                                                                       46760021
INITCVT  LA    REGONE,3                 COUNT FOR CYLTRK AREA           46800019
         LA    REGTWO,SAVETOT           POINT TO CYLTRK AREA            47000019
         BAL   REGTHREE,CONVERT         CONVERT THEM FOR PRINTING       47200019
         L     REGONE,TCBADDR           LOAD TCB ADDRESS         Y02078 47300002
         USING TCB,REGONE               TCB ADDRESSABILITY       Y02078 47400002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 47500002
OUT      MVC   0(6,REGNINE),SPACEMSG                                    48000019
         MVC   6(4,REGNINE),SAVETOT                                     48200019
         MVI   10(REGNINE),C','                                         48400019
         MVC   11(4,REGNINE),SAVETOT+4                                  48600019
         MVI   15(REGNINE),C','                                         48800019
         MVC   16(4,REGNINE),SAVETOT+8                                  49000019
         MVI   20(REGNINE),C'/'                                         49200019
         MVI   25(REGNINE),C','                                         49400019
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY    Y02078 49500002
         LA    REGONE,2                                                 49600019
         LA    REGTWO,SAVETOT                                           49800019
         XC    SAVETOT(8),SAVETOT       ZERO AREA BEFORE INITIALIZING   50000019
         MVC   SAVETOT+2(2),TEMPCTG     PUT NUMBER OF CYL IN AREA       50200019
         MVC   SAVETOT+7(1),TEMPCTG+2   PUT NO. OF TRKS IN LARGEST XTNT 50400019
         BAL   REGTHREE,CONVERT                                         50600019
         L     REGONE,TCBADDR           LOAD TCB ADDRESS         Y02078 50650002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 50700002
         MVC   21(4,REGNINE),SAVETOT    CYLINDERS IN LARGEST EXTENT     50800019
         MVC   26(4,REGNINE),SAVETOT+4  TRACKS IN LARGEST EXTENT        51000019
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY    Y02078 51050002
         DROP  REGONE                                            Y02078 51100002
*                                                                       51200019
* SET UP FOR DEQ                                                        51400019
*                                                                       51600019
SETDEQ   MVC   MJELNAME(8),VTOCNAME                                     51800019
         MVI   ENQAREA,X'FF'            SET LAST ENTRY           A42182 52000021
         SR    REGONE,REGONE                                            52200019
         STH   REGONE,ENQAREA+2                                  A42182 52400021
*                                                                       52600019
* LINK TO DEQ ROUTINE TO DEQ THE VTOC                                   52800019
*                                                                       53000019
         DEQ   (MJELNAME,MIELNAME,6,SYSTEMS),MF=(E,ENQAREA)      A42182 53200021
*                                                                       53250002
         NI    DSMADTB2,X'FF'-DSMVTOCR  RESET VTOC ENQ'ED SWITCH Y02144 53300002
*                                                                       53400019
* RESTORE POINTER TO CALLER'S INFORMATION AREA, SET RETURN CODE IN      53600019
* REGISTER 15, MOVE MESSAGE TO THE INFORMATION AREA AND RETURN TO       53800019
* THE CALLER.                                                           54000019
*                                                                       54200019
         SR    REGTHREE,REGTHREE        GET RETURN CODE                 54400019
         NI    SWITCH,X'0F'             USE AS TABLE INDEX FOR          54600019
         IC    REGTHREE,SWITCH          GETTING APPROPRIATE MESSAGE     54800019
         BC    15,TABLE(REGTHREE)                                       55000019
TABLE    BC    15,FREE                                                  55200019
         BC    15,ERREXIT1                                              55400019
ERREXIT2 EQU   *                        ERRMSG2                  Y02078 55500002
         LA    REGFOUR,ERRMSG2          POINT TO ERROR MESSAGE   Y02078 55600002
EXIT     LA    REGONE,0(REGNINE)        SHOULD MSG BE RETURNED    19028 55800019
         LTR   REGONE,REGONE                                      19028 56000019
         BZ    FREE                     BRANCH IF NO              19028 56200019
         L     REGONE,TCBADDR           LOAD TCB ADDRESS         Y02078 56250002
         USING TCB,REGONE               TCB ADDRESSABILITY       Y02078 56300002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 56350002
         MVC   0(MSGL,REGNINE),0(REGFOUR)  MOVE ERROR MESSAGE    Y02078 56400002
*                                       TO CALLER'S AREA         Y02078 56450002
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY    Y02078 56500002
         DROP  REGONE                                            Y02078 56550002
*                                                                       56600019
* FREE THE WORK AREA                                                    56800019
*                                                                       57000019
FREE     EQU   *                                                SA49351 57060021
         LR    REGEIGHT,REGTHREE        SAVE RETURN CODE         Y02080 57160002
         IECRES FREE,PREFIX=FIRST,A=(RWKAREA)  FREE WORK AREA    Y02080 57260002
*                                                                       57400019
         MODESET EXTKEY=SUPR            RETURN TO SUPERVISOR KEY Y02082 57700002
         LR    REGONE,REGNINE                                           57800019
         USING CVT,RCVT                 CVT ADDRESSABILITY       Y02080 57900002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02080 58000002
         L     RBAK,CVTEXPRO            LOAD EXIT PROLOG ADDRESS Y02080 58100002
         LR    RERRPASS,REGEIGHT        LOAD RETURN CODE         Y02080 58120002
         RETURN ,                       RETURN TO CALLER         Y02080 58140002
*                                                                       58160002
ERREXIT1 EQU   *                        ERRMSG1                  Y02078 58200002
         LA    REGFOUR,ERRMSG1          POINT TO ERROR MESSAGE   Y02078 58300002
         BC    15,EXIT                                                  58400019
*                                                                       58600019
* CHANNEL PROGRAM FOR READING SUBSEQUENT FORMAT 5 DSCB'S                58800019
*                                                                       59000019
CHANPROG CCW   X'31',DSCBF5+135-FIRST,X'40',5 SEARCH EQUAL ID FOR DSCB5 59200019
         CCW   X'08',CCW1-FIRST,X'00',0      TIC BACK TO SEARCH         59400019
         CCW   X'8E',DSCBF5-FIRST,X'00',140   READ IN KEY/DATA          59600019
*                                                                 19028 59800019
* CHANNEL PROGRAM TO READ THE VOLUME LABEL                        19028 60000019
*                                                                 19028 60200019
CCWPLBL  EQU   *                        CCW TO READ VOL LBL      Y02080 60400002
         CCW   X'31',SEEK+3-FIRST,X'40',5  SEARCH                Y02080 60600002
         CCW   X'08',CCW1-FIRST,X'00',0  TIC BACK TO SEARCH      Y02080 60800002
         CCW   X'06',VOLLABEL-FIRST,X'00',80                      19028 61000019
         CCW   X'04',SMF19RV2+1-FIRST,X'20',5  SENSE CCW         A40793 61100021
*                                                                       61200019
* CONSTANTS AND MESSAGES                                                61400019
*                                                                       61600019
PARM0    DS    0F                       AREA TO BUILD PARAMETERS 20201  61840020
DD       DC    X'0060'                  DATA LENGTH              20201  61880020
K        DC    X'2C'                    KEY  LENGTH              20201  61920020
R        DC    X'0'                     RECORD NUMBER            20201  61960020
SMFHDR   DC    XL6'004400000013'        SMF RECORD HEADER        A40793 62400021
VTOCNAME DC    CL8'SYSVTOC'                                             62800019
*                                                                       63000019
SPACEMSG DC    C'SPACE='                                                63200019
ERRMSG1  DC    C'LSPACE-PERMANENT I/O ERROR    '                        63400019
ERRMSG2  DC    C'LSPACE-NON-STANDARD OS VOLUME '                        63600019
*                                                                       63700002
* EMPTY TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                   63800002
*                                                                       63900002
         XCTLTABL SVC=078,LENGTH=,BRT=YES                        Y02080 63920002
         EJECT                                                   Y02080 63940002
WORKAREA IECLSPWA EP,F4,D1=(5),ADT=YES  LSPACE WORK AREA         Y02144 64600002
REGSAVEA EQU   IECREGSV+K12             REGISTER SAVE AREA       Y02080 64620002
TEMPAREA EQU   CVTAREA                  WORK AREA                Y02080 64640002
         SPACE 1                                                 Y02080 64700002
         ORG   DSCBF5                                             19028 66800019
VOLLABEL DS    CL80                                               19028 67000019
         ORG   VOLLABEL                                           19028 67200019
VOLLABI  DS    CL3                                                19028 67400019
VOLNO    DS    CL1                                                19028 67600019
VOLSERNO DS    CL6                                                19028 67800019
         DS    CL1                                                19028 68000019
VOLVTOC  DS    CL5                                                19028 68200019
         DS    CL5                                                19028 68400019
         DS    CL20                                               19028 68600019
VOLOWNER DS    CL10                                               19028 68800019
         DS    CL29                                               19028 69000019
         EJECT                                                   Y02080 69100002
         ORG   VOLLABEL+60                                        19028 69200019
SMFRCD19 EQU   *                                                  19028 69400019
         IFASMFR   (19)                                           19028 69600019
SMF19END EQU   *                        SMF RECORD TYPE 19 END   Y02080 69700002
         SPACE 2                                                 Y02080 69800002
         IECDSECS CVT,RB,TCB,UCB,EXPAND=YES  VARIOUS DSECTS      Y02078 69900002
         IEESMCA                                                  19028 76200019
         END                                                            77600019
./  ADD  SSI=62030708,NAME=IGG0CLF2
         TITLE 'IGG0CLF2 - BPAM DIRECTORY FORMATTER'             Y02080 00050002
IGG0CLF2 CSECT                                                   Y02080 00060002
*                                                                       00066002
*01*  MODULE NAME = IGG0CLF2                                            00068002
*                                                                       00070002
*01*  DESCRIPTIVE NAME = BPAM DIRECTORY FORMATTER                       00072002
*                                                                       00074002
*01*  COPYRIGHT = NONE                                                  00076002
*                                                                       00078002
*01*  CHANGE ACTIVITY = SEE BELOW                                       00078402
*                                                                       00078802
*        VS2 RELEASE 02 DELETIONS/CHANGES                               00080002
*0000002800                                                      Y02132 00080102
*0000000500,003500-008500,010500-011000,013000,014500-016000,    Y02080 00080202
*0000017000-018000,019500-024000,026500-027000,031000,033000-    Y02080 00080302
*0000035000,036000,037000-037500,038500-041000,049500,052000,    Y02080 00080402
*0000054000-054000,060000,062000,065000-102500,103500,105000-    Y02080 00080502
*0000106000,108000-109000,111000,112000-126361,128500-129500,    Y02080 00080602
*0000130500,133500,137000,138000,145500-146000,147500-149000,    Y02080 00080702
*0000150000-150500,151500,155500-156500,157500,160500,161500,    Y02080 00080802
*0000166000,167000,168000-171400,176500,177500,178500,180000-    Y02080 00080902
*0000181500,183000-183500,184500,185500-188500,206500,209500-    Y02080 00081002
*0000212500,214500-219000,237100-237500,245500-246500,248000-    Y02080 00081102
*0000248500,249500-429500                                        Y02080 00081202
*0000                                                            Y02144 00081302
*0000106500-107500,164000,182000                                 YM3048 00081502
*0000103500,109500-109600                                        YM3997 00083502
*              VS2 RELEASE 030 CHANGES                                  00090037
*0000                                                          @ZA09979 00170037
*0000                                                          @ZA12203 00210037
*01*  STATUS = 00                                                       00250001
*                                                                       00300002
*01*  FUNCTION = THIS ROUTINE FORMATS A BPAM DIRECTORY.                 00400002
*       256 BYTE RECORDS WITH 8 BYTE BINARY ZERO KEYS ARE WRITTEN.      00500001
*       THE FIRST BLOCK WILL BE INITIALIZED AS AN EMPTY DIRECTORY.      00650002
*       IF THE BPAM DATA SET WAS ALLOCATED BY VIO ALLOCATE, AFTER       00860002
*       FORMATTING THE DIRECTORIES, A WICLOSE IS ISSUED TO FREE         00870002
*       ITS ASSOCIATED CONTROL BLOCKS.                                  00880002
*01*  NOTES = EXCP IS THE ONLY ACCESS METHOD USED IN THIS MODULE.       00900001
*       ALL EXCP IS DONE AT THE LABEL IO.                               00950001
*02*    DEPENDENCIES = CHARACTER CODE CHANGE REQUIRES REASSEMBLY.       01000001
*02*    RESTRICTIONS = NONE                                             01050002
*02*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES.                    01150001
*         REGISTER 12 IS USED AS THE BASE REGISTER FOR THE CSECT.       01160002
*         REGISTER 13 POINTS TO THE ALLOCATE WORK AREA.                 01170002
*01*  MODULE-TYPE = MODULE                                              01200001
*02*    PROCESSOR = ASSEMBLER                                           01250001
*02*    MODULE-SIZE = LESS THAN 1024 BYTES                              01300002
*02*    ATTRIBUTES = REENTERABLE, READ ONLY, ENABLED, SUPERVISORY MODE  01350001
*01*  ENTRY = IGG0CLF2                                                  01400001
*02*    PURPOSE = SEE FUNCTION.                                         01450002
*02*    LINKAGE = BRANCH FROM ALLOCATE MODULES IGG0325H OR IGG0325I.    01500002
*02*    INPUT = THE CYLINDER AND TRACK START ADDRESS FIELDS IN THE DEB  01550002
*       IN THE ALLOCATE WORK AREA CONTAIN THE STARTING CCHH OF THE BPAM 01600002
*       DATA SET'S FIRST EXTENT.  THE FOLLOWING REGISTERS ARE PASSED:   01610002
*        REGISTER                      CONTENT                          01650001
*        1     NUMBER OF BLOCKS TO BE WRITTEN IN BPAM DIRECTORY.        01700002
*        2     NUMBER OF BLOCKS PER TRACK FOR DEVICE WHICH              01850001
*              CONTAINS THE DATA SET.                                   01900001
*       13     ADDRESS OF THE ALLOCATE WORK AREA.                       01950002
*02*    OUTPUT = THIS ROUTINE FORMATS A BPAM DIRECTORY.                 02200002
*02*    EXIT-NORMAL = RETURN                                            02450001
*02*    EXIT-ERROR = RETURN.  REG 15 = 12 IF AN IO ERROR                02500001
*01*  EXTERNAL-REFERENCES = AS FOLLOWS                                  02550001
*02*    ROUTINES = IECPRLTV                                             02600001
*02*    DATA-SETS = NONE                                                02650002
*02*    DATA-AREA = DCB, DEB, IOB, AND ECB IN THE ALLOCATE WORK AREA    02700002
*01*  TABLES = CVT                                                      02750001
*01*  MACROS = EXCP, WAIT, IECDSECS, IECALLWA, IECRES, WICLOSE          02800002
*                                                                       02850001
**** END OF SPECIFICATIONS ***/                                         02900001
         EJECT                                                          02950001
*********************************************************************** 03000001
*                                                                       03050001
         BALR  RGBASE,0                SET BASE REGISTER.               03150001
         USING *,RGBASE                SET CSECT ADDRESSABILITY.        03200001
         USING ALLOCWKA,RGAREA         WORK AREA ADDRESSABILITY  Y02080 03210002
*                                                                       03220002
* THIS SECTION SAVES THE INPUT PARAMETERS IN REGISTERS 1 AND 2.         03230002
*                                                                       03240002
IEINIT   EQU   *                                                        03250001
         STM   R1,R2,SVBLKS            SAVE INPUT PARAMETERS     Y02080 03400002
         LR    RGDQTY,R1               SAVE NUMBER OF BLOCKS     Y02080 03500002
*                                                                       03550001
* THIS SECTION INITIALIZES THE IOB.                                     03600002
*                                                                       03650001
         LA    R5,CHPGA                CHAN PROG PTR                    03800001
         ST    R5,IOB+CHNPGADR         POINT TO CHANNEL PROGRAM  Y02080 03950002
*                                                                       04150001
* THE FOLLOWING CODE FORMATS A BPAM DATA SET.                           04200001
*                                                                       04250001
* FIRST FORMAT A BPAM DIRECTORY                                         04300001
*                                                                       04350001
         SR    RGTTR,RGTTR             INIT TTR0 START                  04400001
         LA    RGDQTY,ONE(RGDQTY)      ACCOUNT FOR EOD MARK             04450001
         ST    RGDQTY,SVBLKS                                            04500001
BPLOOP1  BAL   RGRET,CNVT              CONVERT TTR                      04550001
         LR    RGA,RGDQTY              IN CASE LAST TRACK               04600001
         C     RGDQTY,SVBLPTK                                           04650001
         BNH   BPLOOP2                 BRANCH IF LAST TRACK             04700001
         L     RGA,SVBLPTK             INIT FOR THIS TRACK              04750001
BPLOOP2  BAL   RGRET,RELOC             SET UP CHAN PROG                 04800001
         C     RGDQTY,SVBLKS           SEE IF FIRST TRACK               04850001
         BNE   BPNFRST                 BRANCH IF NOT FIRST TRACK        04900001
         CLI   SEEK+RECNO,ZEROA        SEE IF 1ST RECORD ON TRK  Y02080 04950002
         BNE   BPNFRST                 BRANCH IF NOT FIRST RECORD       05000001
*                                                                       05050001
* MODIFY FIRST CCW TO WRITE HIGH ENTRY BLOCK                            05100001
*                                                                       05150001
         MVC   BPDCNT,COUNTS           MOVE IN COUNT             Y02080 05200002
         MVC   BPDHIK,HIKEY            MOVE HI KEY.                     05250001
         MVC   BPDBPB(L'BPDBPB+L'BPDHIE),EMPTYBLK  MOVE BYTES    Y02080 05300002
*                                      PER BLOCK AND HIGH ENTRY  Y02080 05350002
         LA    RGB,BPAMDIR-COUNTS      ADJUSTMENT VALUE          Y02080 05400002
         L     RGC,CHPGA3              FIRST WRITE CCW.                 05450001
         AR    RGC,RGB                 ADJUST ADDR                      05500001
         ST    RGC,CHPGA3              FIRST WRITE CCW.                 05550001
         MVI   CHPGA3+7,B26            ADJUST COUNT.                    05600001
BPNFRST  C     RGDQTY,SVBLPTK          SEE IF LAST TRACK                05650001
         BH    BPNLST                  BRANCH IF NOT LAST               05700001
         LTR   RGA,RGA                 SEE IF END OF LAST TRACK         05750001
         BP    BPNLST                  BR IF NOT YET AT END             05800001
*                                                                       05850001
* ZERO KL AND DL IN COUNT FIELD TO FORCE AN EOD TO BE WRITTEN           05900001
*                                                                       05950001
         XC    KEY(THREE,RGH),KEY(RGH)  ZERO KL AND DL           Y02080 06000002
         MVI   CHPGB-CHPGA(RGG),X12    CHANGE LAST CCW TO RD COUNT      06050001
         MVC   CHPGB-CHPGA+6(TWO,RGG),CCWWR+6 SET COUNT FLD TO 8        06100001
BPNLST   BAL   RGRET,IO                EXCP, WAIT, CHECK                06150001
         MVC   SEEK+RECNO(ONE),HICOUNT+FOUR  INCREMENT RECORD NO Y02080 06200002
         LTR   RGA,RGA                 SEE IF TRACK FINISHED            06250001
         BP    BPLOOP2                 NO, WRITE REST OF TRACK          06300001
         A     RGTTR,X10000            GO TO NEXT TRK                   06350001
         S     RGDQTY,SVBLPTK          DECREASE DIR QTY                 06400001
         BP    BPLOOP1                 BRANCH IF ANOTHER TRACK          06450001
*********************************************************************** 06500002
*                                                                       06600002
* IF THE BPAM DATA SET WAS ALLOCATED BY VIO ALLOCATE, THEN THIS         06700002
* SECTION ISSUES A WICLOSE TO FREE ITS ASSOCIATED CONTROL BLOCKS.       06800002
*                                                                       06900002
*********************************************************************** 07000002
         L     R8,DEB+K32               GET VDSUCB ADDRESS       Y02132 07100002
         TM    K0(R8),UCBVRDEV          TEST IF VIO BPAM DATASET Y02132 07200002
         BZ    NOVIOPDS                 BRANCH IF NOT            Y02132 07300002
*                                                                       07400002
         STM   R11,R14,IECREGSV+B12     SAVE SETLOCK REGISTERS   Y02132 07500002
         LR    R7,RGAREA                SAVE WORK AREA ADDRESS   Y02132 07600002
GETLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02132X07700002
               RELATED=(LOCAL,IGG0CLF2(RLSELOCK))  OBTAIN LOCK   Y02132 07800002
         LM    R11,R14,IECREGSV+B12-ALLOCWKA(R7)  RESTORE REGS   Y02132 07900002
*                                                                       08000002
         WICLOSE VDSCB=(R8)             ISSUE WICLOSE MACRO      Y02132x08100002
                                        REGISTER 13 POINTS TO    Y02132X08200002
                                        THE 18 WORD SAVE AREA    Y02132 08300002
*                                                                       08400002
         STM   R11,R14,IECREGSV+B12     SAVE SETLOCK REGISTERS   Y02132 08500002
         LR    R7,RGAREA                SAVE WORK AREA ADDRESS   Y02132 08600002
RLSELOCK SETLOCK RELEASE,TYPE=LOCAL,                             Y02132X08700002
               RELATED=(LOCAL,IGG0CLF2(GETLOCK))  RELEASE LOCK   Y02132 08800002
         LM    R11,R14,IECREGSV+B12-ALLOCWKA(R7)  RESTORE REGS   Y02132 08900002
*                                                                       09000002
NOVIOPDS EQU   *                        BRANCH LABEL             Y02132 09100002
         SR    RERRPASS,RERRPASS        SET ZERO ERROR CODE      Y02080 10250002
         EJECT                                                          10260002
*                                                                       10300001
* IF AN RPS WORK AREA EXISTS, THEN RESTORE THE DEB AVT POINTER.         10350002
*                                                                       10400001
RETURN   EQU   *                                                        10450001
         TM    DSMADTB1,DSMRPSAP        TEST IF RPS APPENDAGE    YM3048X10500002
                                        IGG019EK WAS LOADED      YM3048 10510002
         BNO   CONTINUE                 BRANCH IF NOT            YM3048 10550002
         L     R3,DEB+DEBAPDS           GET APPENDAGE TABLE ADDR Y02080 10600002
         MVC   DEB+DEBAPDS(FOUR),AVTSV(R3)  RESTORE DEB AVT PTR  Y02080 10800002
         NI    DSMADTB1,X'FF'-DSMRPSAP  RESET RPS APP LOADED SW  Y02144 10970002
*                                                                       10980002
CONTINUE EQU   *                                                        11000001
*                                                                       11050001
* THIS SECTION FREES THE WORK AREA(S) AND RETURNS.                      11100002
*                                                                       11150001
         IECRES FREE,PREFIX=FIRST,A=(RGAREA)  FREE WORK AREAS    Y02080 11200002
         USING CVT,R15                  CVT ADDRESSABILITY       Y02080 11250002
         L     R15,CVTPTR               LOAD POINTER TO CVT      Y02080 11300002
         L     R14,CVTEXPRO             LOAD EXIT PROLOG ADDRESS Y02080 11350002
         LR    R15,RERRPASS             SET ERROR CODE           Y02080 11400002
         RETURN ,                       RETURN                   Y02080 11450002
         EJECT                                                          11460001
*                                                                       12650001
* CONVERT TTR IN RGTTR TO MBBCCHHR                                      12700001
*                                                                       12750001
CNVT     LR    R0,RGTTR                                                 12800001
         LA    R1,DEB                  DEB ADDRESS               Y02080 12900002
         LA    R2,SEEK                 POINT TO RESULT AREA      Y02080 12950002
         LR    R3,RGAREA               SAVE AREA ADR                    13000001
         STM   R9,R14,IECREGSV+B12     SAVE VOLATILE REGISTERS   Y02080 13050002
         USING CVT,R15                                                  13100001
         L     R15,CVTPTR              GET ADR OF CVT                   13150001
         L     R15,CVTPCNVT            GET ADR OF CONVERT ROUTINE       13200001
         DROP  R15                                                      13250001
         BALR  R14,R15                 GO TO CONVERT ROUTINE.           13300001
         LM    R9,R14,IECREGSV+B12-ALLOCWKA(R3)  RESTORE REGS    Y02080 13350002
         BR    RGRET                   RETURN TO CALLING CODE.          13400001
         EJECT                                                          13450001
*                                                                       13500001
* BUILD CHANNEL PROGRAM OF 1 THRU 15 WRITE CCW'S FOLLOWED BY AN EQUAL   13550001
*        NUMBER OF WRITE CHECK CCW'S.                                   13600001
* ENTER NUMBER OF CCW'S TO BE WRITTEN ON GIVEN TRACK IN RGA.            13650001
* 'SEEK' INDICATES PROPER TRACK AND ONE LESS THAN R OF FIRST RECORD.    13700002
* UPON RETURN, RGA CONTAINS EXCESS OF ORIGINAL VALUE OVER 15, AND       13750001
*        RGG POINTS TO LAST WRITE CCW.  RGH POINTS TO THE LAST COUNT.   13800002
*                                                                       13850001
RELOC    LR    RGB,RGA                 NUMBER OF CCW'S                  13900001
         XC    ADSCBF4(96),ADSCBF4     CLEAR WKAREA            @ZA09979 13920037
         LA    RGC,B15                 MAXIMUM NO.  OF CCW'S            13950001
         SR    RGA,RGC                                                  14000001
         BC    12,LTMAX                BRANCH IF LESS THAN MAX VALUE    14050001
         LA    RGB,B15                 SET TO MAX                       14100001
LTMAX    LM    RGC,RGF,CCWSID          RELOCATE SID, TIC CCW'S          14150001
         AR    RGC,RGAREA                                               14200001
         LA    RGG,CHPGA               DEVELOP TIC ADDR                 14250001
         AR    RGE,RGG                                                  14300001
         STM   RGC,RGF,CHPGA           STORE SID, TIC                   14350001
         LA    RGG,CHPGB-CHPGA         DEVELOP SECOND TIC ADDR          14400001
         AR    RGE,RGG                                                  14450001
         STM   RGC,RGF,CHPGB           SECOND SID, TIC                  14500001
         LM    RGE,RGF,SEEK            DEVELOP COUNT FIELD       Y02080 14600002
         SLDL  RGE,B24                 DROP MBB                         14650001
         A     RGF,X080100             SET KL AND DL                    14700001
         LA    RGG,CHPGA3-EIGHT        INIT. WRITE CCW POINTER   Y02080 14710002
         LA    RGH,COUNTS-EIGHT        INIT. COUNT FIELD PTR     Y02080 14720002
         LA    RGI,CHPGB3-EIGHT        INIT. WRITE CHK CCW PTR   Y02080 14730002
RELOOP1  EQU   *                       BRANCH LABEL              Y02080 14740002
         LA    RGG,EIGHT(RGG)          INCREMENT WRITE CCW PTR   Y02080 14750002
         LA    RGH,EIGHT(RGH)          INCREMENT COUNT POINTER   Y02080 14760002
         LA    RGI,EIGHT(RGI)          INCREMENT WRITE CHK PTR   Y02080 14770002
         LM    RGC,RGD,CCWWR           LOAD WRITE CKD CCW        Y02080 14780002
         AR    RGC,RGH                 POINT TO COUNT FIELD      Y02080 14800002
         STM   RGC,RGD,0(RGG)          MOVE IN WRITE CKD CCW     Y02080 14850002
         MVC   0(EIGHT,RGI),CCWRCH     MOVE IN WRITE CHECK CCW   Y02080 14900002
         A     RGF,X1000000            INCREMENT R                      14950001
         STM   RGE,RGF,0(RGH)          STORE COUNT FIELD         Y02080 15000002
         BCT   RGB,RELOOP1             BRANCH IF ANOTHER CCW            15100001
         NI    FLAGS(RGI),X'FF'-CC     TURN OFF CMD CHAIN BIT    Y02080 15150002
         LTR   RGA,RGA                 SEE IF ALL CCW'S FILLED          15200001
         BCR   10,RGRET                BR IF ALL FILLED                 15250001
         MVC   EIGHT(EIGHT,RGG),CHPGB2  MOVE TIC                        15300001
         BR    RGRET                   RETURN TO CALLING CODE.          15350001
         EJECT                                                          15360001
*                                                                       15400001
* EXCP, WAIT, AND I/O ERROR CHECK                                       15450001
*                                                                       15500001
IO       EQU   *                       BRANCH LABEL              Y02080 15510002
         EXCP  IOB                     EXECUTE CHANNEL PROGRAM   Y02080 15550002
         TM    ECB,CC                  TEST IMMED POSTING      @ZA12203 15620037
         BO    ERRTST                  GO TO ERROR CHECK       @ZA12203 15640037
         WAIT  1,ECB=ECB               WAIT FOR COMPLETION       Y02080 15660037
ERRTST   TM    ECB,X20                 CHECK FOR I/O ERROR     @ZA12203 15680037
         BCR   1,RGRET                 Q. NO ERROR                      15700001
IOERRCD  EQU   *                       BRANCH LABEL              Y02132 15710002
         LA    RERRPASS,B12            SET I/O ERROR CODE        Y02080 15750002
         B     RETURN                  RETURN TO CALLER                 15800001
 EJECT                                                                  15850001
*                                                                       15900001
* CONSTANTS AND CHANNEL COMMAND WORDS                                   15950001
*                                                                       16000001
EMPTYBLK DC    H'14'                   NUMBER OF BYTES PER BLOCK Y02080 16050002
HIKEY    DC    X'FFFFFFFFFFFFFFFF'     HIGHEST POSSIBLE KEY.            16100001
         DS    0F                      FILLER.                          16200001
X10000   DC    X'00010000'             TTR STEP CONSTANT.               16250001
X080100  DC    X'00080100'             KEY AND DATA LENGTH CONSTANT.    16300001
X1000000 DC    X'01000000'             R INCREMENT VALUE.               16350001
*                                                                       16450001
* PATTERN CHANNEL COMMAND WORDS.                                        16500001
*                                                                       16550001
CCWSID   CCW   X'31',SEEK+3-ALLOCWKA,X'40',5  SEARCH ID          Y02080 16600002
         DC    X'0800000000000000'     TIC                              16650001
CCWWR    CCW   X'1D',0,X'60',8         WRITE CKD, SLI            Y02080 16700002
CCWRCH   CCW   X'1E',0,X'50',272       READ CKD, SKIP                   16750001
         EJECT                                                          17150001
*                                                                       17200001
* MISCELLANEOUS EQUATES USED .                                          17250001
*                                                                       17300001
K0       EQU   0                       CONSTANT OF ZERO          Y02132 17310002
ZEROA    EQU   0                       A ZERO CONSTANT.                 17350001
ONE      EQU   1                       A ONE CONSTANT.                  17400001
TWO      EQU   2                       A TWO CONSTANT.                  17450001
THREE    EQU   3                       A THREE CONSTANT.                17500001
FOUR     EQU   4                       A FOUR CONSTANT.                 17550001
FLAGS    EQU   4                       OFFSET TO CCW FLAGS       Y02080 17560002
KEY      EQU   5                       OFFSET TO KEY IN COUNT    Y02080 17570002
RECNO    EQU   7                       OFFSET TO RECORD NUMBER   Y02080 17580002
EIGHT    EQU   8                       AN EIGHT CONSTANT.               17600001
B12      EQU   12                      BINARY 12                        17700001
B15      EQU   15                      BINARY 15.                       17800001
B24      EQU   24                      BINARY 24                        17900001
B26      EQU   26                      BINARY 26                        17950001
X00      EQU   X'00'                   HEX 00                           18250001
X12      EQU   X'12'                   HEX 12                           18400001
X20      EQU   X'20'                   HEX 20                           18500001
CC       EQU   X'40'                   COMMAND CHAINING BIT      Y02080 18550002
AVTSV    EQU   120                     DISP TO AVT PTR IN RPSWA.        18900001
DEBAPDS  EQU   28                      APPNDG. PTR DISP. IN DEB.        18950001
CHNPGADR EQU   16                      DISP. TO CHANNEL PROGRAM  Y02080 18960002
*                                      START ADDRESS IN IOB      Y02080 18970002
K32      EQU   32                      CONSTANT OF 32            Y02132 18980002
         EJECT                                                          19000001
*                                                                       19050001
* THE FOLLOWING ARE REGISTER EQUATES USED IN THIS PROGRAM.              19100001
*                                                                       19150001
R0       EQU   0                       REGISTER 0                       19200001
R1       EQU   1                       REGISTER 1                       19250001
R2       EQU   2                       REGISTER 2                       19300001
R3       EQU   3                       REGISTER 3                       19350001
R4       EQU   4                       REGISTER 4                       19400001
R5       EQU   5                       REGISTER 5                       19450001
R6       EQU   6                       REGISTER 6                       19500001
R7       EQU   7                       REGISTER 7                       19550001
R8       EQU   8                       REGISTER 8                       19600001
R9       EQU   9                       REGISTER 9                       19650001
R10      EQU   10                      REGISTER 10                      19700001
R11      EQU   11                      REGISTER 11                      19750001
R12      EQU   12                      REGISTER 12                      19800001
R13      EQU   13                      REGISTER 13                      19850001
R14      EQU   14                      REGISTER 14                      19900001
R15      EQU   15                      REGISTER 15                      19950001
RGI      EQU   1                       WORK REGISTER             Y02080 19960002
RGA      EQU   2                       REGISTER 2                       20000001
RGB      EQU   3                       REGISTER 3                       20050001
RGC      EQU   4                       REGISTER 4                       20100001
RGD      EQU   5                       REGISTER 5                       20150001
RGE      EQU   6                       REGISTER 6                       20200001
RGF      EQU   7                       REGISTER 7                       20250001
RGG      EQU   8                       REGISTER 8                       20300001
RERRPASS EQU   8                       RETURN CODE REGISTER      Y02080 20310002
RGH      EQU   9                       REGISTER 9                       20350001
RGDQTY   EQU   10                      DIRECTORY QUANTITY               20400001
RGTTR    EQU   11                      RELATIVE TRACK COUNTER           20450001
RGBASE   EQU   12                      BASE REGISTER                    20500001
RGAREA   EQU   13                      WORK AREA ADDRESS                20550001
RGRET    EQU   14                      RETURN REGISTER                  20600001
         EJECT                                                   Y02080 20650002
*                                                                       20700001
**********************************************************************  20750001
*                                                                       20800001
* END OF THE IGG0CLF2 CSECT.                                            20850001
*                                                                       20900001
**********************************************************************  21150001
         XCTLTABL SVC=000,BRT=YES,LENGTH=                        Y02080 21160002
         SPACE 2                                                 Y02080 21200002
         IECDSECS CVT,PSA,UCB,EXPAND=YES                         Y02080 21250002
*                                                                       21300001
* THIS DSECT DEFINES THE WORK AREA PASSED TO THE FORMAT ROUTINE.        21350001
*                                                                       21400001
DSCBWKAR IECALLWA EP,ADT=YES           ALLOCATE WORK AREA        Y02144 21600002
         EJECT                                                   Y02144 21800002
         ORG   ADSCBF4                 CCW'S BEGIN AT ADSCBF4    Y02080 21900002
CHPGA    DS    0D                      WRITE CHANNEL PROGRAM            21950001
CHPGA1   DS    D                       CCW 1.                           22000001
CHPGA2   DS    D                       CCW 2.                           22050001
CHPGA3   DS    D                       CCW 3.                           22100001
CHPGA4   DS    D                       CCW 4.                           22150001
CHPGA5   DS    D                       CCW 5.                           22200001
CHPGA6   DS    D                       CCW 6.                           22250001
CHPGA7   DS    D                       CCW 7.                           22300001
CHPGA8   DS    D                       CCW 8.                           22350001
CHPGA9   DS    D                       CCW 9.                           22400001
CHPGA10  DS    D                       CCW 10.                          22450001
CHPGA11  DS    D                       CCW 11.                          22500001
CHPGA12  DS    D                       CCW 12.                          22550001
CHPGA13  DS    D                       CCW 13.                          22600001
CHPGA14  DS    D                       CCW 14.                          22650001
CHPGA15  DS    D                       CCW 15.                          22700001
CHPGA16  DS    D                       CCW 16.                          22750001
CHPGA17  DS    D                       CCW 17.                          22800001
CHPGB    DS    0D                      READ CHANNEL PROGRAM             22850001
CHPGB1   DS    D                       CCW 1.                           22900001
CHPGB2   DS    D                       CCW 2.                           22950001
CHPGB3   DS    D                       CCW 3.                           23000001
CHPGB4   DS    D                       CCW 4.                           23050001
CHPGB5   DS    D                       CCW 5.                           23100001
CHPGB6   DS    D                       CCW 6.                           23150001
CHPGB7   DS    D                       CCW 7.                           23200001
CHPGB8   DS    D                       CCW 8.                           23250001
CHPGB9   DS    D                       CCW 9.                           23300001
CHPGB10  DS    D                       CCW 10.                          23350001
CHPGB11  DS    D                       CCW 11.                          23400001
CHPGB12  DS    D                       CCW 12.                          23450001
CHPGB13  DS    D                       CCW 13.                          23500001
CHPGB14  DS    D                       CCW 14.                          23550001
CHPGB15  DS    D                       CCW 15.                          23600001
CHPGB16  DS    D                       CCW 16.                          23650001
CHPGB17  DS    D                       CCW 17.                          23700001
         EJECT                                                          23702001
         ORG   CCW1                    SAVE AREA & COUNT FIELDS  Y02080 23704002
SVBLKS   DS    F                       NBR OF DIRECTORY BLOCKS   Y02080 23706002
SVBLPTK  DS    F                       NUMBER OF BLOCKS/TRACK    Y02080 23708002
         SPACE 1                                                 Y02080 23710002
COUNTS   DS    0D                      15 COUNT FIELDS           Y02080 23750002
CTKEY    DS    CL8                     KEY OF DIR BLOCK.                23800001
CTCOUNT  DS    CL2                     COUNT OF DIRECTORY BLOCK.        23850001
CTDIR    DS    CL7                     FILLER.                          23900001
CTLBK    DS    CL1                     LOW ORDER OF NAME.               23950001
         DS    CL2                     FILLER.                          24000001
CTTTRC   DS    CL2                     TTRC                             24050001
CTHITT   DS    CL2                     HI TT.                           24100001
CTHIR    DS    CL1                     HI R.                            24150001
         DS    CL3                     FILLER.                          24200001
CTNABTR  DS    CL1                     NEXT AVAILABLE BLOCK TTR.        24250001
         DS    CL2                     FILLER.                          24300001
CTNBLB   DS    CL1                     BYTES IN LAST BLOCK.             24350001
CTHIENT  DS    CL8                     HI ENTRY.                        24400001
         DS    CL72                    FILLER.                          24450001
HICOUNT  DS    D                       LAST RELATIVE TRACK              24500001
BPAMDIR  DS    0X                      BDAM DIRECTORY                   24700001
BPDCNT   DS    CL8                     BPAM DIR COUNT.                  24750001
BPDHIK   DS    XL8                     BPAM DIRECTORY HIGH KEY   Y02080 24800002
BPDBPB   DS    XL2                     BPAM DIR BYTES PER BLOCK  Y02080 24850002
BPDHIE   DS    CL8                     BPAM DIR HI ENTRY.               24900001
         END                                                            43000001
./  ADD  SSI=40390022,NAME=IGG019EK
         TITLE 'IGG019EK - RPS SIO, PGFX, CE, AND XE APPENDAGES' Y02080 00400002
IGG019EK CSECT                                                          00600020
*0000216000,258000,582000                                        M5885  00650020
*0000426000                                                      M4741  00700020
*0000336000                                                      M6287  00750020
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00760002
*0000000600-004000,272000,278400,279200-281000,340200,341200,    Y02080 00760102
*0000634090,634450-634540,634990,635530-635620,635710-635800,    Y02080 00760202
*0000635890,644000-656000,692000-716000,762000-786000            Y02080 00760302
*0000278800-282000,286000,340400-341000,634020-635920            YM3048 00760502
*0000                                                           YA03681 00761002
*                                                                       00800020
*********************************************************************** 01000020
*                                                                     * 01200020
*                                                                     * 01400020
*                  - - - APPENDAGES - - -                             * 01600020
*                                                                     * 01800020
* MODULE NAME     - IGG019EK                                          * 01820002
*                                                                     * 01840002
* DESCRIPTIVE NAME- RPS SIO, CE, AND XE APPENDAGES                    * 01860002
*                                                                     * 01880002
* COPYRIGHT       - NONE                                              * 01900002
*                                                                     * 01920002
* CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING THE CSECT CARD.   * 01940002
*                                                                     * 02000020
* ATTRIBUTES      - REENTRANT, REFRESHABLE, DISABLED, SUPERVISORY     * 02200020
*                                                                     * 02400020
* ENTRY POINTS    - IGG019EK: RPS SIO APPENDAGE                       * 02600020
*                 - IGG019EK+8: RPS CHANNEL END APPENDAGE             * 02800020
*                 - IGG019EK+12: RPS ABNORMAL END APPENDAGE           * 03000020
*                                                                     * 03200020
* NORMAL EXITS    - RETURN TO IOS VIA A BR 14 INSTRUCTION             * 03400020
*                                                                     * 03600020
* ERROR EXITS     - NONE                                              * 03800020
*                                                                     * 04000020
* SVCS ISSUED     - NONE                                              * 04200020
*                                                                     * 04400020
* INPUT PARAMETERS- THE REGISTER SETTINGS WILL BE AS SPECIFIED IN     * 04600020
*                   THE SYSTEM PROGRAMMER'S GUIDE (FORM C28-6550)     * 04800020
*                   UNDER THE HEADING OF 'APPENDAGES'. THE ADDRESS    * 05000020
*                   OF THE USER'S CHANNEL PROGRAM WILL BE OBTAIN-     * 05200020
*                   ED BY REFERENCING THE IOBSTART FIELD OF THE       * 05400020
*                   IOB ADDRESSED BY REGISTER 2. THE RPS WORK         * 05600020
*                   AREA WILL BE LOCATED BY REFERENCING THE DEB-      * 05800020
*                   APPAD FIELD OF THE DEB ADDRESSED BY REGISTER      * 06000020
*                   3. THE UCB WILL BE ADDRESSED USING THE CON-       * 06200020
*                   TENTS OF REGISTER 7.                              * 06400020
*                                                                     * 06600020
* FUNCTIONS       -                                                   * 06800020
*                                                                     * 07000020
*        RPS SIO APPENDAGE:                                           * 07200020
*                                                                     * 07400020
*        1. IS ENTERED FROM IOS JUST PRIOR TO ISSUING THE SIO IN-     * 07600020
*        STRUCTION,                                                   * 07800020
*        2. EFFECTIVELY INSERTS SET SECTOR CCWS AT THE START OF,      * 08000020
*        AND AT APPROPRIATE POINTS WITHIN THE USER'S CHANNEL PRO-     * 08200020
*        GRAM,                                                        * 08400020
*        3. INTERFACES WITH A RESIDENT 'R-TO-THETA CONVERT ROU-       * 08600020
*        TINE' TO OBTAIN APPROPRIATE THETA VALUES,                    * 08800020
*        4. PLACES POINTERS TO THE RPS CHANNEL END AND ABNORMAL       * 09000020
*        END APPENDAGES IN THE AVT IN RPS'S WORK AREA TO SCHEDULE     * 09200020
*        THESE ROUTINES FOR EXECUTION AFTER I/O HAS BEEN PERFORMED.   * 09400020
*                                                                     * 09600020
*        RPS ABNORMAL END APPENDAGE:                                  * 09800020
*                                                                     * 10000020
*        1. IS ENTERED FROM IOS A) BEFORE ATTEMPTING ERROR CORREC-    * 10200020
*        TION WHEN AN I/O ERROR IS DETECTED OR B) AFTER A PERMA-      * 10400020
*        NENT I/O ERROR IS ENCOUNTERED,                               * 10600020
*        2. TESTS THE ECB POINTED TO BY THE IOB TO DETERMINE IF       * 10800020
*        THE ENTRY WAS DUE TO CASE A OR B,                            * 11000020
*        3. IF CASE A (CC=X'7F') RETURNS IMMEDIATELY TO IOS,          * 11200020
*        4. IF CASE B (CC=X'4X') FALLS THROUGH TO THE RPS CHANNEL     * 11400020
*        END APPENDAGE.                                               * 11600020
*                                                                     * 11800020
*        RPS CHANNEL END APPENDAGE:                                   * 12000020
*                                                                     * 12200020
*        1. IS ENTERED A) FROM IOS UPON NORMAL COMPLETION OF AN I/O   * 12400020
*        OPERATION OR B) FROM THE RPS ABNORMAL END APPENDAGE,         * 12600020
*        2. RESTORES THE USERS CHANNEL PROGRAM TO ITS STATE PRIOR     * 12800020
*        TO RPS START I/O APPENDAGE EXECUTION,                        * 13000020
*        3. PLACES POINTERS TO A BR 14 INSTRUCTION IN THE AVT IN      * 13200020
*        RPS'S WORK AREA SO THAT THE RPS CHANNEL END AND ABNORMAL     * 13400020
*        END APPENDAGES WILL NOT BE REEXECUTED UNTIL AFTER THE        * 13600020
*        RPS SIO APPENDAGE HAS PERFORMED ITS FUNCTION.                * 13800020
*                                                                     * 14000020
*********************************************************************** 14200020
*                                                                       14400020
*********************************************************************** 14600020
*    REGISTER AND OTHER EQUATES                                       * 14800020
**********************************************************************  15000020
*                                                                       15200020
FGMR1    EQU   0                        USED IN FREE-& GETMAINS         15400020
REG02    EQU   2                        NOT USED                        15600020
REG09    EQU   9                        NOT USED                        15800020
REG10    EQU   10                       NOT USED                        16000020
REG11    EQU   11                       NOT USED                        16200020
REG12    EQU   12                       NOT USED                        16400020
RETRG    EQU   14                       RETURN REGISTER                 16600020
BASER    EQU   15                       BASE REG. FOR THIS MODULE       16800020
C0       EQU   0                        CONSTANT NUMBER                 17000020
C4       EQU   4                        CONSTANT NUMBER                 17200020
C8       EQU   8                        CONSTANT NUMBER                 17400020
REG13    EQU   13                       CE APPG. WORK REG.              17600020
OAVT     EQU   120                      DISP. TO PTR TO OLD AVT IN W.A. 17800020
RSADS    EQU   96                       DISP. TO REG SAVE AREA          18000020
REG06    EQU   6                        WORK REG FOR SIO                18200020
PARM0    EQU   0                        PARAMETER REGISTER              18400020
PARM2    EQU   2                        PARAMETER REG. FOR CONVERT      18600020
IOBAD    EQU   2                        POINTER TO IOB                  18800020
DEBAD    EQU   3                        POINTER TO DEB                  19000020
HITIC    EQU   5                        ADDR OF HIGHEST TIC             19200020
USRCCW   EQU   7                        USER CHAN.PGM.PTR               19400020
UCBAD    EQU   7                        POINTER TO UCB                  19600020
CVTPTR   EQU   16                       ADDR OF POINTER TO CVT          19800020
RPCCW    EQU   13                       RPS CHAN.PGM. PTR               20000020
REG14    EQU   14                       WORK REG.                       20200020
REG15    EQU   15                       WORK REG.                       20400020
ECBDIS   EQU   4                        DISP. OF ECB IN IOB             20600020
FW       EQU   4                        BYTES IN 1 FULL WORD            20800020
RDS      EQU   4                        DISP TO R IN CCHHR              21000020
LGTH     EQU   22                       DISP TO BYTE COUNT              21200020
DW       EQU   8                        BYTES IN ONE DOUBLE WD.         21400020
DCCHN    EQU   X'C0'                    DATA AND COMMAND CHAIN   M5885  21500020
*                                       BITS                     M5885  21600020
TFW      EQU   12                       BYTES IN 3 FULL WORDS           21800020
SAVWD1   EQU   12                       2ND WORD OF 1ST TIC             22000020
TDW      EQU   16                       BYTES IN 2 DOUBLE WORDS         22200020
IOBST    EQU   16                       DISP. OF IOBSTART FIELD         22400020
D17      EQU   17                       DISPLACEMENT OF 17              22600020
D18      EQU   18                       DISPLACEMENT OF 18              22800020
D19      EQU   19                       DISPLACEMENT OF 19              23000020
SAVWD2   EQU   20                       2ND WORD OF 2ND TIC             23200020
TH1DS    EQU   20                       DISP TO 1ST THETA               23400020
DAMSK    EQU   X'20'                    MASK FOR D.A. BIT IN UCB        23600020
SSCODE   EQU   X'23'                    SET SECTOR COMMAND CODE         23800020
CHPGMDS  EQU   24                       DISP TO CH. PGM. IN RPSWA       24000020
SHFT3    EQU   24                       BITS FOR THREE-BYTE SHIFT       24200020
SIDECD   EQU   X'31'                    SIDE COMMAND CODE               24400020
COMP     EQU   X'7F'                    ECB COMPLETION CODE             24600020
SCRDS    EQU   232                      DISP TO CONVERT ADDR            24800020
BIT256   EQU   X'01'                    BIT WITH VALUE OF 256           25000020
ADRMSK   EQU   X'03'                    MASK FOR LOW TWO BITS           25200020
TICCW    EQU   X'08'                    COMMAND CODE OF TIC             25400020
RPSMSK   EQU   X'10'                    MASK FOR RPS BIT IN UCB         25600020
SECSA    EQU   RSADS+12                 S. A. FOR SECOND 3 REG.S        26000020
*                                                                       26200020
*********************************************************************** 26400020
* THIS SECTION TESTS ENTRY CONDITIONS AND INITIALIZES REGISTERS       * 26600020
*********************************************************************** 26800020
*                                                                       27000020
         USING DEB,DEBAD                                                27400020
         USING IGG019EK,BASER                                           27600020
         B     SIO                      BRANCH AROUND I.D.              27800020
         USING IGG019EK+C4,BASER        CE ADDRESSABILITY        YM3048 28200002
         B     CE                       BRANCH TO CHAN END APPG         28400020
         USING IGG019EK+C8,BASER        XE ADDRESSABILITY        YM3048 28600002
XE       EQU   *                                                        28800002
*                                                                       29000020
*********************************************************************** 29200020
*        ABNORMAL END APPENDAGE                                       * 29400020
*********************************************************************** 29600020
*                                                                       29800020
         TM    ECBDIS(IOBAD),COMP       TEST COMPLETION CODE            30000020
         BO    C0(RETRG)                7F, RETURN TO IOS               30200020
*                                                                       30400020
*********************************************************************** 30600020
*        CHANNEL END APPENDAGE                                        * 30800020
*********************************************************************** 31000020
*                                                                       31200020
CE       EQU   *                                                        31400020
         BALR  BASER,FGMR1              RE ESTABLISH BASE REG           31600020
         USING *,BASER                  USING FOR HERE                  31800020
         L     REG10,IOBST(IOBAD)       GET START OF USER CCW'S         32000020
         LA    REG10,C0(REG10)          CLEAR HIGH ORDER BYTE           32200020
NOADD    EQU   *                                                        32400020
         CLI   C0(REG10),TICCW          IS CCW A 'TIC'                  32600020
         BE    IFTIC                    YES,INCREMENT HITIC             32800020
         CLI   C0(REG10),SSCODE         IS CCW A 'SET SECTOR'           33000020
         BE    IFSS                     YES, MUST BE REMOVED            33200020
         TM    C4(REG10),DCCHN          DATA/COMMAND CHN. BITS ON       33400020
         BZ    ENDCE                    BRANCH NO                M6287  33600020
         AH    REG10,ONEDW              STEP TO NEXT CCW                33800020
         B     NOADD                    SKIP INCREMENT                  34000020
IFTIC    EQU   *                                                        34200020
         L     REG12,C0(REG10)          GET ADDRESS IN TIC              34400020
         LA    REG12,C0(REG12)          CLEAR COMMAND CODE              34600020
         CR    REG12,REG10              IS IT A TIC *-8                 34800020
         BH    FOLLOW                   NO, GO FOLLOW THIS TIC          35000020
         AH    REG10,ONEDW              STEP TO NEXT CCW                35200020
         B     NOADD                    GO ON TO NEXT CCW TEST          35400020
FOLLOW   EQU   *                                                        35600020
         L     REG10,C0(REG10)          LOOK AT NEXT CCW                35800020
         B     NOADD                    GO ON TO NEXT CCW TEST          36000020
IFSS     EQU   *                                                        36200020
         L     REG11,C8(REG10)          TIC POINTS TO ORIG. CCW         36400020
         MVC   C0(C8,REG10),C0(REG11)      ORIGINAL CCW RESTORED        36600020
         ST    REG10,C8(REG10)          YES, POINT TIC TO TIC-8         36800020
         MVI   C8(REG10),TICCW          INSERT COMMAND CODE             37000020
         AH    REG10,TWODW              INCREMENT THRU USER CCWS        37200020
         AH    REG11,DCTDWDW            INCREMENT THRU RPS  CCWS        37400020
         B     NOADD                    GO ON TO NEXT CCW               37600020
ENDCE    EQU   *                                                        37800020
         L     REG10,DEBAPPAD           GET PTR TO RPSWA                38000020
         L     REG13,OAVT(REG10)        GET ADDR OF OLD AVT             38200020
         MVC   TFW(C4,REG10),TFW(REG13) RESTORE OLD CE PTR              38400020
         MVC   TDW(C4,REG10),TDW(REG13) RESTORE OLD XE PTR              38600020
         BR    RETRG                    RETURN TO IOS                   38800020
*                                                                       39000020
*********************************************************************** 39200020
*        START I/O APPENDAGE                                          * 39400020
*********************************************************************** 39600020
*                                                                       39800020
SIO      EQU   *                                                        40000020
         USING IGG019EK,BASER                                           40200020
         TM    D18(UCBAD),DAMSK                                         40400020
         BZ    C0(RETRG)                NO, RETURN TO IOS               40600020
         TM    D17(UCBAD),RPSMSK                                        40800020
         BZ    C0(RETRG)                NO, RETURN TO IOS               41000020
         L     RPCCW,DEBAPPAD           POINTER TO RPS WORK AREA        41200020
         STM   PARM0,REG02,RSADS(RPCCW) SAVE REGISTERS                  41400020
         STM   HITIC,UCBAD,SECSA(RPCCW) SAVE REGISTERS                  41600020
         IC    REG06,D19(UCBAD)                                         41800020
         SLL   REG06,SHFT3              PUT IN HIGH ORDER BYTE          42000020
         L     USRCCW,IOBST(IOBAD)      GET START OF USER'S CCWS        42200020
         LA    USRCCW,0(USRCCW)         CLEAR THE HIGH BYTE     YA03681 42250002
         CLI   C0(USRCCW),SSCODE        1ST CCW A SET SECTOR            42400020
         BE    RPSEND                   YES,RETURN TO IOS        M4741  42600020
         LA    PARM2,TH1DS(RPCCW)       POINTER TO FIRST THETA          42800020
         OR    PARM2,REG06              PUT DEV. CODE IN PARM.REG.      43000020
         LA    RPCCW,CHPGMDS(RPCCW)     POINTER TO RPS CCW CHAIN        43200020
         O     RPCCW,TICCW2             PUT X'08' INTO HIGH BYTE        43400020
         XR    HITIC,HITIC              CLEAR HIGH TIC ADDR REG.        43600020
*                                                                       43800020
*********************************************************************** 44000020
* MODIFY THE CCW CHAINS                                               * 44200020
*********************************************************************** 44400020
*                                                                       44600020
         CLI   C0(USRCCW),SIDECD        1ST CCW A SEARCH ON I.D.        44800020
         BNE   INCREMNT                 NO, SKIP THETA CONVERT          45000020
MODIFY   EQU   *                                                        45200020
         MVC   C0(TDW,RPCCW),C0(USRCCW) MOVE 2 CCWS TO RPS CHAIN        45400020
         L     REG06,C0(USRCCW)         GET SIDE'S DATA ADDRESS         45600020
SCRPREP  EQU   *                                                        45800020
*                                                                       46000020
* THE FOLLOWING INSTRUCTION TESTS THE BYTE COUNT OF THE CCW FOLLOWING   46200020
* THE SIDE AND TIC IN ORDER TO DETERMINE THE KEY AND DATA LENGTH TO     46400020
* BE PASSED TO THE SECTOR CONVERT ROUTINE. CATALOG'S VOLUME CONTROL     46600020
* BLOCKS AND INDICES HAVE DATA LENGTHS OF 256, ALL OTHER I/O OPERATIONS 46800020
* IN CATALOG AND DADSM ARE PERFORMED ON DSCB'S HAVING A MAXIMUM I/O     47000020
* BYTE COUNT OF 148 (96 BYTES DATA, 44 BYTES KEY, AND 8 BYTES COUNT)    47200020
*                                                                       47400020
         TM    LGTH(USRCCW),BIT256      BYTE COUNT = 256 OR MORE        47600020
         BO    LONGBLK                  YES, PASS INDEX/VCB DD&K        47800020
         L     PARM0,DSCBCT             NO, PASS DSCB'S DD & K          48000020
         B     GETR                     SKIP LONGBLK                    48200020
LONGBLK  EQU   *                                                        48400020
         L     PARM0,IVCBCT             INDEX & VOL.CONT.BLK DD&K       48600020
GETR     EQU   *                                                        48800020
         IC    PARM0,RDS(REG06)         PUT R INTO PARAMETER REG.       49000020
         ST    RETRG,SAVWD1(RPCCW)      SAVE RETURN AND BASE AD-        49200020
         ST    BASER,SAVWD2(RPCCW)      *DRESSES IN TICS                49400020
         L     REG15,CVTPTR             CVT ADDRESS                     49600020
         L     REG15,SCRDS(REG15)       SECTOR CONVERT RTN ADDR         49800020
         BALR  REG14,REG15              CONVERT R TO THETA              50000020
         L     RETRG,SAVWD1(RPCCW)      RESTORE                         50200020
         L     BASER,SAVWD2(RPCCW)      REGISTERS                       50400020
         ST    PARM2,C0(USRCCW)         POINT SET SECTOR TO THETA       50600020
         MVI   C0(USRCCW),SSCODE        SET SECTOR COMMAND CODE         50800020
         MVC   FW(FW,USRCCW),SSFLGL     SET FLGS & LENGTH FOR SS        51000020
         ST    RPCCW,DW(USRCCW)         BUILD TIC TO RPS CHAIN          51200020
         CLI   DW(RPCCW),TICCW          IS NEXT RPCCW A TIC             51400020
         BNE   NEXTTIC                  NO, SKIP WORK ON THIS TIC       51600020
         O     USRCCW,TICCW2            PUT X'08' IN HI BYTE            51800020
         ST    RPCCW,DW(RPCCW)          POINT RPCCW+8 TO RPCCW          52000020
NEXTTIC  EQU   *                                                        52200020
         AH    USRCCW,TWODW             POINT TO CCW AFTER TIC          52400020
         ST    USRCCW,TDW(RPCCW)        BUILD TIC TO USER'S CHPGM       52600020
         CLI   C0(USRCCW),TICCW         IS NEXT CCW A TIC               52800020
         BNE   INCREMNT                 NO, SKIP TIC ADJUSTMENT         53000020
         MVC   TDW(C4,RPCCW),C0(USRCCW) POINT RPS TIC TO NEW ADDR       53200020
INCREMNT EQU   *                                                        53400020
         STC   PARM2,TFW(RPCCW)         GET LOW BYTE OF THETA ADR       53600020
         TM    TFW(RPCCW),ADRMSK        HAVE 3 THETA'S BEEN USED        53800020
         BO    FINISH                   YES, FINISH OFF & RETURN        54000020
         AH    RPCCW,DCTDWDW            STEP RPS CCW POINTER            54200020
         AH    PARM2,ONE                STEP THETA'S POINTER            54400020
         TM    FW(USRCCW),DCCHN         MORE CCWS                M6287  54460020
         BZ    FINISH                   BRANCH NO                M6287  54520020
USRSTEP  EQU   *                                                        54600020
         AH    USRCCW,ONEDW             STEP USER CCW POINTER           54800020
*                                                                       55000020
*********************************************************************** 55200020
* MAKE TESTS TO DECIDE NEXT ACTION: MODIFY CHANNEL PROGRAM AT THIS    * 55400020
* POINT, LOOK AT NEXT CCW, OR RETURN ?                                * 55600020
*********************************************************************** 55800020
*                                                                       56000020
         CLI   C0(USRCCW),TICCW         IS CCW A TIC                    56200020
         BNE   NOTTIC                   NO, SKIP TIC WORK               56400020
         L     REG06,C0(USRCCW)         GET TIC DATA ADDRESS            56600020
         CR    HITIC,REG06              ADDR GREATER THAN HITIC         56800020
         BH    USRSTEP                  NO, LOOK AT NEXT CCW            57000020
         LR    HITIC,REG06              UPDATE HITIC                    57200020
         B     USRSTEP                  NOW LOOK AT NEXT CCW            57400020
NOTTIC   EQU   *                                                        57600020
         CLI   C0(USRCCW),SIDECD        IS CCW A SEARCH ON I.D. ?       57800020
         BE    MODIFY                   YES, MODIFY CHANNEL PGM.        58000020
         TM    FW(USRCCW),DCCHN         CMD. OR DATA CHAIN ON    M5885  58200020
         BNZ   USRSTEP                  YES, LOOK AT NEXT CCW           58400020
FINISH   EQU   *                                                        58600020
         L     REG10,DEBAPPAD           GET ADDR OF RPSWA               58800020
         LM    PARM0,REG02,RSADS(REG10) LOAD REGISTERS                  59000020
         LM    HITIC,UCBAD,SECSA(REG10) LOAD REGISTERS                  59200020
         XR    REG09,REG09              ZERO REG .                      59400020
         L     REG11,FW(REG10)          GET ADDR OF THIS APPENDAGE      59600020
         LA    REG11,FW(REG11)          GET ADDR OF CE APPENDAGE YM3048 59800002
         ST    REG11,TFW(REG10)         PUT INTO NEW AVT                60000020
         LA    REG11,FW(REG11)          GET ADDR OF XE APPENDAGE        60200020
         ST    REG11,TDW(REG10)         PUT INTO NEW AVT                60400020
         BR    RETRG                    RETURN TO IOS            M4741  60460020
RPSEND   LM    HITIC,UCBAD,SECSA(RPCCW) LOAD REGISTERS           M4741  60520020
         BR    RETRG                    RETURN TO IOS                   60600020
*                                                                       60800020
*********************************************************************** 61000020
*        CONSTANTS                                                    * 61200020
*********************************************************************** 61400020
*                                                                       61600020
         DS    0F                                                       61800020
TICCW2   DC    X'08000000'              COMMAND CODE OF TIC             62000020
SSFLGL   DC    X'60000001'              FLAG & LENGTH FOR SET SECT.     62200020
DSCBCT   DC    X'00602C00'              DSCB DD & K                     62400020
IVCBCT   DC    X'01000800'              INDEX & VCB DD & K              62600020
ONE      DC    H'1'                     ONE                             62800020
ONEDW    DC    H'8'                     EIGHT                           63000020
TWODW    DC    H'16'                    SIXTEEN                         63200020
DCTDWDW  DC    H'24'                    TWENTY-FOUR                     63400020
*                                                                       63420002
*********************************************************************** 63440002
*        END OF APPENDAGES DELIMITER                                  * 63460002
*********************************************************************** 63480002
*                                                                       63500002
         XCTLTABL BRT=YES,PATCH=0,LENGTH=                        Y02080 63520002
         EJECT                                                   Y02080 63540002
*                                                                       63600020
*        WORK AREA'S DEFINITIONS                                      * 63800020
*********************************************************************** 64000020
*                                                                       64200020
*** DEB AREA DEFINITION                                                 64400002
         DSECT                                                   Y02080 64600002
DEB      DS    0F                       START OF DEB                    65800020
DEBTCBAD DS    F                        TCB ADDRESS                     66000020
DEBAMIND DS    0X                       AM INDICATOR                    66200020
DEBDEBAD DS    F                        NEXT DEB ADDRESS                66400020
         DS    2F                       IRB AND SYS PURGE CHAIN         66600020
DEBNMEXT DS    0X                       NO. OF EXTENTS                  66800020
         DS    2F                       USER PURGE & PURGE ECB ADDR     67000020
DEBDCBAD DS    F                        DCB ADDRESS                     67200020
DEBAPPAD DS    F                        APPENDAGE ADDRESS               67400020
DEBDVMOD DS    0X                       DEVICE MODIFIER MASK            67600020
DEBUCBAD DS    F                        UCB ADDRESS                     67800020
DEBBINUM DS    H                        BIN NUMBER                      68000020
DEBSTRCC DS    H                        START CYLINDER                  68200020
DEBSTRHH DS    H                        START HEAD                      68400020
DEBENDCC DS    H                        END CYLINDER                    68600020
DEBENDHH DS    H                        END HEAD                        68800020
DEBNMTRK DS    H                        NUMBER OF TRACKS                69000020
*                                                                       71800020
*** RPS WORK AREA DEFINITION                                            71900002
RPSWA    DSECT                                                          72000020
RPSWAST  DS    0D                       START OF WORK AREA              72200020
RPEOEPTR DS    F                        EOE APG. POINTER                72400020
RPSIOPTR DS    F                        SIO APG. POINTER                72600020
RPPCIPTR DS    F                        PCI APG. POINTER                72800020
RPCEPTR  DS    F                        CE APG. POINTER                 73000020
RPXEPTR  DS    F                        XE  APG. POINTER                73200020
THETA1   DS    CL1                      THETA VALUE 1                   73400020
THETA2   DS    CL1                      THETA VALUE 2                   73600020
THETA3   DS    CL1                      THETA VALUE 3                   73800020
RPSWASIZ DS    CL1                      SIZE/8 OF RPS WORK AREA         74000020
RPCCW1   DS    D                        1ST USER CCW                    74200020
RPCCW2   DS    D                        2ND USER CCW                    74400020
RPCCW3   DS    D                        TIC BACK TO USER'S C.P.         74600020
RPCCW4   DS    D                        1ST EMBEDDED USER SIDE          74800020
RPCCW5   DS    D                        USER CCW FOLLOWING SIDE         75000020
RPCCW6   DS    D                        TIC BACK TO USER'S C.P.         75200020
RPCCW7   DS    D                        2ND EMBEDDED USER SIDE          75400020
RPCCW8   DS    D                        USER CCW FOLLOWING SIDE         75600020
RPCCW9   DS    D                        TIC BACK TO USER'S C.P.         75800020
REGSVAR  DS    4D                       SAVE AREA FOR SIO REGS          76000020
RPSWAEND EQU   *                        END OF RPS WORK AREA     Y02080 76200002
*                                                                       76400002
         END                                                            78800020
./  ADD  SSI=31740390,NAME=IGG020D0
         TITLE 'IGG020D0 - PARTIAL RELEASE - WRITE BACK FORMAT 1 DSCB'  00060002
IGG020D0 CSECT                                                          00062002
*                                                                       00064002
*        CHANGES/DELETIONS FOR RELEASE 21.7                             00064402
*0000037000-037500,064000-065500,065800-065900,066500-066600,    SM5456 00064502
*0000067500,068800-070000,077500-078000,088500-095000,095300-    SM5456 00064602
*0000095500,097600-097700,099000-102020,122520,125000-130000,    SM5456 00064702
*0000158100-158400,168500-171000                                 SM5456 00064802
*        VS2 RELEASE 02 DELETIONS/CHANGES                               00066002
*0000016000,019000,024000,024440,029200,035000,036000,041000,    Y02080 00066102
*0000070600-070700,072500,081000-085000,086000,139000-139500,    Y02080 00066202
*0000141000-143500,175500-176000,176540,176600,182000-200000     Y02080 00066302
*0000000500,103200                                               Y02078 00066402
*0000                                                            Y02082 00066602
*                                                                       00090002
*********************************************************************** 00110002
*                                                                     * 00120002
* MODULE NAME = IGG020D0                                              * 00150002
*                                                                     * 00200002
* DESCRIPTIVE NAME = PARTIAL RELEASE - WRITE BACK FORMAT 1 DSCB       * 00250002
*                                                                     * 00300002
* COPYRIGHT = NONE                                                    * 00350002
*                                                                     * 00400002
* STATUS = CHANGE LEVEL 000                                           * 00450002
*                                                                     * 00500002
* FUNCTION = THIS MODULE WRITES BACK THE UPDATED FORMAT 1 DSCB.       * 00550002
*            IT READS THE FIRST FORMAT 5 DSCB INTO THE RELEASE        * 00600002
*            WORK AREA AND SORTS THE DADSM EXTENT TABLE INTO          * 00650002
*            ASCENDING ORDER. IT ALSO INITIALIZES THE CHANNEL         * 00700002
*            PROGRAM FOR THE NEXT LOAD OF PARTIAL RELEASE.            * 00750002
*            IF THE DOS BIT OR DIRF BIT IS SET IN THE FORMAT 4 DSCB,  * 00760002
*            RELEASED SPACE IS NOT RETURNED TO THE FORMAT 5 DSCB(S).  * 00770002
*                                                                     * 00800002
* NOTES = THIS MODULE WAS CREATED IN OS RELEASE 21.7 AS A SPLIT       * 00850002
*         OF MODULE IGG020P2 DUE TO FIX FOR OS APAR 54549.            * 00900002
*                                                                     * 00950002
*    DEPENDENCIES = NONE                                              * 01000002
*                                                                     * 01050002
*    RESTRICTIONS = NONE                                              * 01100002
*                                                                     * 01150002
*    REGISTER-CONVENTIONS = REGISTER 9 POINTS TO THE DCB.             * 01200002
*                           REGISTER 11 POINTS TO PARTIAL RELEASE     * 01210002
*                           WORK AREA.                                * 01250002
*                           REGISTER 13 POINTS TO I/O SUPPORT         * 01300002
*                           WORK AREA.                                * 01350002
*                           REFER TO 'REGISTER USAGE' IN THE MAIN     * 01400002
*                           CODE FOR THE LIST OF SYMBOLS USED TO      * 01450002
*                           REPRESENT THE REGISTERS IN THIS MODULE.   * 01500002
*                                                                     * 01550002
*    PATCH AREA = IHB0006D                                            * 01600002
*                                                                     * 01650002
* MODULE TYPE = CONTROL                                               * 01700002
*                                                                     * 01750002
*    PROCESSOR = ASSEMBLER                                            * 01800002
*                                                                     * 01850002
*    MODULE SIZE = LESS THAN 1024 DECIMAL BYTES                       * 01900002
*                                                                     * 01950002
*    ATTRIBUTES = REENTRANT, TRANSIENT                                * 02000002
*                                                                     * 02050002
* ENTRY POINT = IGG020D0                                              * 02100002
*                                                                     * 02150002
*    PURPOSE = SEE FUNCTION                                           * 02200002
*                                                                     * 02250002
*    LINKAGE = ENTRY FROM 1ST LOAD OF PARTIAL RELEASE -               * 02300002
*              MODULE IGG020P1 - AND 2ND LOAD OF PARTIAL RELEASE -    * 02350002
*              MODULE IGG020P2 - VIA A BRANCH.                        * 02400002
*                                                                     * 02410002
*    INPUT = IF AN ERROR CONDITION OTHER THAN AN I/O                  * 02430002
*            WAS DETECTED IN EITHER IGG020P1 OR IGG020P2, CONTROL     * 02440002
*            IS PASSED DIRECTLY TO IGG020D0 TO WRITE BACK             * 02442002
*            THE FORMAT 1 DSCB AND IMMEDIATELY BRANCH TO              * 02444002
*            THE LAST LOAD OF PARTIAL RELEASE.  REGISTER 2            * 02446002
*            WILL CONTAIN ONE OF THE FOLLOWING TO INDICATE THIS:      * 02448002
*            ALL ZEROS = NO SPACE RELEASED - NO ERROR CODE RETURNED   * 02448402
*            X'02' = UNABLE TO FIND EXTENT IN FORMAT 1 -              * 02449702
*                    RETURN ERROR CODE                                * 02449802
*            X'04' = UNABLE TO FIND EXTENT IN FORMAT 3 -              * 02449902
*                    RETURN ERROR CODE                                * 02455402
*            X'08' = ANOTHER DCB IS OPEN TO THE DATA SET -            * 02457002
*                    RETURN ERROR CODE                                * 02460002
*            X'20' = NO ROOM IN THE VTOC - RETURN ERROR CODE          * 02461102
*            IF REGISTER 2 CONTAINS A NEGATIVE VALUE ON ENTRY, IT     * 02476602
*            INDICATES NO ERROR HAS OCCURRED, SO CONTINUE PROCESSING. * 02478602
*            REGISTER 11 POINTS TO THE RELEASE WORK AREA WHICH        * 02483302
*            CONTAINS A POINTER TO THE DCB, THE DATA PORTION OF       * 02500002
*            THE FORMAT 4 DSCB, THE ADDRESSES OF THE FORMAT 4 AND     * 02550002
*            THE FORMAT 5 DSCB'S, AND THE DADSM EXTENT TABLE,         * 02600002
*            WHOSE ENTRIES REPRESENT ALL THE SPACE BEING RELEASED     * 02650002
*            IN THE FORMAT 1 DSCB AND POSSIBLY THE FORMAT 3 DSCB.     * 02700002
*            REGISTER 13 POINTS TO THE I/O SUPPORT WORK AREA          * 02750002
*            WHICH CONTAINS THE UPDATED FORMAT 1 DSCB.                * 02800002
*                                                                     * 02850002
*    OUTPUT = THE UPDATED FORMAT 1 DSCB IS WRITTEN TO THE VTOC.       * 02900002
*             REGISTER 9 INDICATES NUMBER OF EXTENTS TO BE            * 02910002
*             RELEASED WHEN MODULE BRANCHES TO IGG020D1.              * 02920002
*             REGISTER 11 POINTS TO THE RELEASE WORK AREA WHICH       * 02950002
*             CONTAINS THE FORMAT 4 DSCB, THE FIRST FORMAT 5          * 03000002
*             DSCB AND THE DADSM EXTENT TABLE WHOSE ENTRIES HAVE      * 03050002
*             BEEN SORTED INTO ASCENDING ORDER. ITS ENTRIES           * 03100002
*             REPRESENT ALL THE SPACE BEING RELEASED FROM THE         * 03150002
*             FORMAT 1 DSCB AND POSSIBLY THE FORMAT 3 DSCB.           * 03200002
*             REGISTER 13 POINTS TO THE I/O SUPPORT WORK AREA         * 03250002
*             WHICH CONTAINS THE UPDATED FORMAT 1 DSCB AND THE        * 03300002
*             CHANNEL PROGRAM SET UP FOR THE NEXT LOAD OF             * 03350002
*             PARTIAL RELEASE.                                        * 03400002
*                                                                     * 03450002
*    EXIT-NORMAL = BRANCH TO IGG020D1                                 * 03500002
*                                                                     * 03550002
*    EXIT-ERROR = BRANCH TO IGG020P3 WITH ONE OF THE FOLLOWING        * 03600002
*                 ERROR CODES IN REGISTER 2:                          * 03650002
*                 X'10' - PERMANENT I/O ERROR                         * 03800002
*                 OR ONE OF THE ERROR CODES NOTED UNDER 'INPUT'.      * 03810002
*                                                                     * 03850002
* EXTERNAL REFERENCES = NONE                                          * 03900002
*                                                                     * 03950002
*    ROUTINES = EXCP (SVC 0) READ/WRITE DISK                          * 04000002
*               WAIT (SVC 1) WAIT FOR COMPLETION OF I/O               * 04050002
*               IECRES       TRANSFER CONTROL TO NEXT LOAD            * 04100002
*                                                                     * 04150002
*    DATA AREAS = NONE                                                * 04200002
*                                                                     * 04250002
*    CONTROL BLOCKS = JFCB, DEB, DCB                                  * 04300002
*                                                                     * 04350002
* TABLES = SEE DESCRIPTION OF THE PARTIAL RELEASE WORK AREA AND       * 04400002
*          I/O SUPPORT WORK AREAS AT THE END OF THE MODULE.           * 04450002
*                                                                     * 04500002
* MACROS = IECDSECT - TO DEFINE THE I/O SUPPORT WORK AREA.            * 04550002
*          (THIS MACRO INCLUDES IEFJFCBN TO DEFINE THE JFCB).         * 04600002
*          IECSDSL1 - TO DEFINE DSCB'S.                               * 04610002
*          IECPRLWA - TO DEFINE THE PARTIAL RELEASE WORK AREA.        * 04620002
*                                                                     * 04650002
* CHANGE ACTIVITY =                                                   * 04700002
*        SEE 'CHANGES/DELETIONS' SECTION JUST AFTER CSECT CARD.       * 04750002
*                                                                     * 04800002
*                                                                     * 04850002
*********************************************************************** 04900002
*                                                                       04950002
*** REGISTER USAGE                                                      05000002
*                                                                       05050002
R0       EQU   0                        WORK REGISTER                   05100002
INDEX1   EQU   1                        CONTAINS ADDRESS OF ENTRY       05150002
*                                       IN DADSM TABLE                  05152002
R1       EQU   1                        WORK REGISTER                   05160002
R2       EQU   2                        WORK REGISTER                   05170002
INDEX2   EQU   2                        CONTAINS ADDRESS OF ENTRY       05200002
*                                       IN DADSM TABLE                  05210002
ERRETREG EQU   2                        ERROR RETURN CODE REGISTER      05250002
INDEX3   EQU   3                        CONTAINS NUMBER OF PASSES       05300002
*                                       THRU DADSM TABLE                05350002
R3       EQU   3                        WORK REGISTER                   05450002
R4       EQU   4                        WORK REGISTER                   05500002
EXTCTR   EQU   5                        CONTAINS NUMBER OF              05550002
*                                       EXTENTS IN DADSM TABLE          05560002
R5       EQU   5                        WORK REGISTER                   05600002
R6       EQU   6                        WORK REGISTER                   05650002
R7       EQU   7                        WORK REGISTER                   05700002
R8       EQU   8                        WORK REGISTER                   05750002
RDEB     EQU   8                        POINTS TO DEB PREFIX    SA54549 05760002
R9       EQU   9                        WORK REGISTER                   05800002
RXUSRDCB EQU   9                        BASE FOR USERS DCB              05850002
RXUCB    EQU   10                       POINTER TO THE UCB              05900002
RXWKA    EQU   11                       BASE FOR WORK AREA              05950002
RXBASE   EQU   12                       BASE FOR MAIN PROGRAM           06000002
RXCLOWKA EQU   13                       BASE FOR CLOSE'S WORK AREA      06050002
RLINK    EQU   14                       SUBROUTINE LINK REGISTER        06100002
R15      EQU   15                       WORK REGISTER                   06150002
*                                                                       06250002
*** OTHER EQUATES                                                       06300002
*                                                                       06350002
IOERROR  EQU   X'10'                    PERMANENT I/O ERROR      A37199 06560002
*                                                                       06570002
SKIP     EQU   X'10'                    USED TO TURN SKIP ON    SA54549 06572002
READATA  EQU   X'06'                    READ DATA COMMAND       SA54549 06600002
SUPXFER  EQU   X'10'                    SUPPRESS TRANSFER       SA54549 06700002
DOS      EQU   X'80'                    TEST FOR DOS PACK       SA54549 06750402
DIRFBIT  EQU   X'04'                    DIRF BIT IN DS4VTOCI     Y02078 06750802
*                                                                       06752002
K0       EQU   0                        CONSTANT OF ZERO         Y02082 06754002
K1       EQU   1                        1 BYTE                  SA54549 06760002
K3       EQU   3                        3 BYTES                 SA54549 06860002
K4       EQU   4                        4 BYTES                 SA54549 06862002
K5       EQU   5                        5 BYTES                 SA54549 06870002
DATAL    EQU   96                       DATA LENGTH             SA54549 07050002
*                                                                       07100002
         BALR  RXBASE,0                 LOAD BASE REGISTER              07150002
         USING *,RXBASE                 BASE FOR MODULE         SA54549 07200002
         USING PRLSEWKA,RXWKA           WORK AREA ADDRESSABILITY Y02080 07250002
         USING IHADCB,RXUSRDCB          ESTABLISH BASE FOR USERS DCB    07300002
         USING CLOSEWKA,RXCLOWKA        ESTABLISH BASE FOR              07350002
*                                       CLOSE WORK AREA                 07400002
*                                                                       07450002
*** THIS SECTION BUILDS THE CHANNEL PROGRAM TO WRITE BACK THE           07500002
*   FORMAT 1 DSCB.                                                      07550002
*   THE FORMAT OF THE CHANNEL PROGRAM IS AS FOLLOWS:                    07600002
*   SEARCH ID EQ                                                        07650002
*   TIC *-8                                                             07700002
*   WRITE DATA (F1 DSCB) (NO CHAIN / CHAIN, 96 BYTES)                   07850002
*   SEARCH ID EQ                                                        07900002
*   TIC *-8                                                             07950002
*   READ DATA (F1 DSCB) (SUPPRESS TRANSFER, 96 BYTES)                   08000002
*                                                                       08050002
BEGINA   EQU   *                                                        08060002
         LR    R4,ERRETREG              SAVE ERROR CODE         SA54549 08070002
         L     R9,DCBSAVE               RELOAD USER'S DCB PNTR  SA54549 08510002
         L     RDEB,DCBDEBAD            GET DEB ADDRESS         SA54549 08550002
         LA    RDEB,K0(RDEB)            CLEAR HIGH-ORDER BYTE    Y02082 08600002
         SH    RDEB,SIXTEEN             GET DEB PREFIX ADDR     SA54549 08650002
         MVC   DXDAADDR+K3(K5),K3(RDEB) MOVE IN FORMAT 1 CCHHR  SA54549 08700002
         LA    R0,DXCCW1                MODIFY CCW PTR IN IOB   SA54549 08750002
         ST    R0,IOBSIOCC                                      SA54549 08800002
         LM    R0,R1,WRITECCW           PICK UP CCW ADDRESS      SM5456 08900002
         ALR   R0,RXCLOWKA              ADD DISPLACEMENT FOR     SM5456 09000002
*                                       I/O WORK AREA            SM5456 09100002
         STM   R0,R1,DXCCW3             STORE IN CCW             SM5456 09200002
         LA    R0,OUTDSCB               PICK UP ADDRESS OF      SA54549 09510002
*                                       WHERE TO READ IN DSCB   SA54549 09520002
         ST    R0,DXCCW6                STORE IN CCW             SM5456 09530002
         MVI   DXCCW6,READATA           MOVE IN READ DATA        SM5456 09550002
*                                       COMMAND                 SA54549 09600002
         LA    R0,DATAL                 GET DATA LENGTH         SA54549 09750002
         ST    R0,DXCCW6+K4             MOVE IN LENGTH           SM5456 09760002
         MVI   DXCCW6+K4,SUPXFER        MOVE IN SUPPRESS         SM5456 09770002
*                                       TRANSFER COMMAND        SA54549 09780002
         BAL   RLINK,EXECIO             WRITE BACK FORMAT 1     SA54549 09800002
*                                       DSCB                    SA54549 09850002
         LTR   R4,R4                    DID A PREVIOUS MODULE   SA54549 10210002
*                                       RETURN AN ERROR CODE    SA54549 10220002
         BNM   PRELEAVE                 BRANCH IF YES           SA54549 10230002
*                                                                       10310002
*** THIS SECTION CHECKS IF THE DOS BIT OR DIRF BIT IS SET AND IF THERE  10320002
*   IS ANY SPACE TO BE RELEASED                                         10330002
*                                                                       10340002
DOSCHECK EQU   *                                                SA54549 10342002
         SR    ERRETREG,ERRETREG        CLEAR ERROR CODE        SA54549 10344002
         TM    DS4VTOCI,DIRFBIT         TEST IF THE DIRF BIT WAS Y02078 10344402
*                                       PREVIOUSLY SET           Y02078 10344802
         BNO   LEAVE                    BRANCH IF PREVIOUSLY SET Y02078 10345202
         TM    DS4VTOCI,DOS             IS THIS A DOS PACK      SA54549 10346002
         BO    LEAVE                    BRANCH IF YES           SA54549 10348002
         SR    EXTCTR,EXTCTR            CLEAR EXTENT COUNTER    SA54549 10348402
         IC    EXTCTR,EXTNUM            GET NUMBER OF           SA54549 10348802
*                                       DADSMTBL ENTRIES        SA54549 10348902
         LTR   R9,EXTCTR                ANY ENTRIES IN DADSMTBL SA54549 10349202
*                                       (REGISTER 9 IS PASSED   SA54549 10349302
*                                       TO NEXT LOAD OF PARTIAL SA54549 10349402
*                                       RELEASE WITH NUMBER OF  SA54549 10349502
*                                       ENTRIES IN DADSM TABLE) SA54549 10362102
         BZ    LEAVE                    BRANCH IF NO            SA54549 10374802
*                                                                       10387402
*** THIS SECTION SORTS THE DADSM TABLE INTO ASCENDING RTA'S             10400002
*                                                                       10450002
NEWPASS  LA    INDEX1,ENTRIES           GET ADDRESS 1ST ENTRY           10500002
         LA    INDEX2,4(INDEX1)         GET ADDRESS 2ND ENTRY           10550002
         LA    INDEX3,K1                LOAD PASS COUNTER       SA54549 10650002
         BCT   EXTCTR,NEWPAIR           BRANCH IF MORE EXTENTS          10700002
         B     RELOCATE                 CHECK IF IT IS DOS PACK SA54549 10750002
NEWPAIR  CLC   0(2,INDEX1),0(INDEX2)    COMPARE 2 DADSM ENTRIES         10800002
         BH    EXCHANGE                 EXCHANGE IF 1ST IS HIGH         10850002
SHIFT    LR    INDEX1,INDEX2            IF LOW -POINT INDEX1 TO         10900002
*                                       HIGHER OF 2 ENTRIES             10950002
         LA    INDEX2,4(INDEX2)         POINT INDEX2 TO NEXT ENTRY      11000002
         CLR   INDEX3,EXTCTR            IS THIS THE END OF A PASS       11050002
         BE    NEWPASS                  YES- HIGHEST ENTRY IS THE       11100002
*                                       TOP OF THE TABLE-GET NEXT       11150002
*                                       ENTRY AND REPEAT PROCESS        11200002
         LA    INDEX3,1(INDEX3)         NO-INCREMENT PASS COUNTER       11250002
         B     NEWPAIR                  COMPARE HIGH TO NEXT ENTRY      11300002
EXCHANGE MVC   HOLDEXTS(4),0(INDEX1)    SAVE HIGH ENTRY                 11350002
         MVC   0(4,INDEX1),0(INDEX2)    EXCHANGE HIGH AND LOW ENTRIES   11400002
         MVC   0(4,INDEX2),HOLDEXTS                                     11450002
         B     SHIFT                    POINT INDEX1 TO HIGH ENTRY      11500002
*                                                                       12100002
*** THIS SECTION RELOCATES THE CHANNEL PROGRAM FOR THE NEXT LOAD        12150002
*                                                                       12200002
RELOCATE EQU   *                                                        12250002
         LM    R0,R7,CCWX1              PICK UP FIRST 4 CCWS    SA54549 12260002
         ALR   R2,RXWKA                 MODIFY READ COUNT ADDR   A39292 12300002
         ALR   R4,RXCLOWKA                                              12350002
         ALR   R6,RXCLOWKA                                              12400002
         STM   R0,R7,DXCCW1             RELOCATE FIRST 4 CCWS   SA54549 12450002
         LM    R0,R7,CCWX5              PICK UP NEXT 4 CCWS      SM5456 12500002
         ALR   R2,RXWKA                 RESOLVE CCW ADDRESSES    SM5456 12550002
         ALR   R4,RXCLOWKA                                       SM5456 12600002
         ALR   R6,RXWKA                 WRITE FROM OUTDSCB       SM5456 12650002
         STM   R0,R7,DXCCW5             RELOCATE NEXT 4 CCWS     SM5456 12700002
         LR    R0,R2                    PICK UP 9TH CCW          SM5456 12750002
         LR    R1,R3                                             SM5456 12800002
         LM    R2,R5,CCWX10             PICK UP LAST 2 CCWS      SM5456 12850002
         ALR   R2,RXCLOWKA              RESOLVE CCW ADDRESSES    SM5456 12900002
         ALR   R4,RXWKA                                          SM5456 12950002
         STM   R0,R5,DXCCW9             RELOCATE LAST 3 CCWS     SM5456 13000002
*                                                                       13050002
*** THIS SECTION READS THE FORMAT 5 DSCB INTO WORKING STORAGE           13100002
*                                                                       13150002
         MVC   OUTCCHHR(K5),DADSMADR                            SA54549 13200002
         MVC   DXDAADDR+K3(K5),DADSMADR SET SEEK ADDRRESS       SA54549 13250002
*                                       TO READ FORMAT 5        SA54549 13252002
         LA    R0,DXCCW9                MODIFY CCW POINTER      SA54549 13260002
*                                       IN IOB                  SA54549 13270002
         ST    R0,IOBSIOCC                                              13280002
         BAL   RLINK,EXECIO             READ IN FORMAT 5        SA54549 13290002
         OI    DXCCW11+K4,SKIP          TURN ON SKIP BIT        SA54549 13292002
*                                                                       13300002
*** THIS SECTION PREPARES FOR EXIT TO NEXT LOAD OF PARTIAL RELEASE      13350002
*                                                                       13400002
RELSPACE EQU   *                                                        13450002
         LA    R3,NEXTXCTL              FETCH NEXT LOAD PNTR     O19117 13500002
         B     XCTL                                              O19117 13550002
*                                                                       13600002
*** THIS SECTION PREPARES FOR EXIT TO LAST LOAD OF PARTIAL RELEASE      13650002
*                                                                       13700002
PRELEAVE EQU   *                                                SA54549 13702002
         LR    ERRETREG,R4              RELOAD ERROR CODE REG   SA54549 13704002
LEAVE    EQU   *                                                 O19117 13710002
         LA    R3,PRECLOSE              POINT TO LAST LOAD ID    O19117 13720002
*                                                                       13850002
*** THIS SECTION BRANCHES TO ANOTHER LOAD OF PARTIAL RELEASE.           13900002
*                                                                       14000002
XCTL     EQU   *                                                 O19117 14050002
         IECRES LOAD,EXTPR=(RXWKA),MODID=(R3),BRANCH=DIRECT      Y02080 14100002
*                                                                       14400002
*** THIS SECTION INITIATES THE CHANNEL PROGRAM.                         14450002
*                                                                       14500002
EXECIO   MVI   DXECB,0                  TURN OFF ECB FLAGS              14550002
         EXCP  DXIOB                    READ DSCB                       14600002
         WAIT  ECB=DXECB                WAIT FOR COMPLETION             14650002
         TM    DXECB,X'20'              TEST FOR PERM I/O ERR           14700002
         BCR   5,RLINK                  RETURN IF NO I/O ERR.           14750002
         LA    ERRETREG,IOERROR         LOAD ERROR CODE          A37199 14800002
         B     LEAVE                    GO XCTL TO THE LAST LOAD A37199 14850002
*                                                                       14900002
*** CHANNEL PROGRAM                                                     14950002
*                                                                       15000002
CHANPRG  DS    0F                                                       15050002
CCWX1    DC    X'1A'                    READ HOME ADDRESS.              15100002
         DC    AL3(0)                   AREA ADDRESS                    15150002
         DC    X'5000'                  CCW FLAGS                       15200002
         DC    H'5'                     COUNT                           15250002
CCWX2    DC    X'92'                    READ COUNT                      15300002
         DC    AL3(DS3PTRDS-FIRST)                               A39292 15350002
         DC    X'6000'                  CCW FLAGS                       15400002
         DC    H'5'                     BYTE COUNT                      15450002
CCWX3    DC    X'29'                    SEARCH KEY EQUAL                15500002
         DC    AL3(4+DXCCW4-CLOSEWKA)                                   15550002
         DC    X'6000'                  CCW FLAGS                       15600002
         DC    H'4'                     BYTE COUNT                      15650002
CCWX4    DC    X'08'                    TIC TO CCW2                     15700002
         DC    AL3(DXCCW2-CLOSEWKA)                                     15750002
         DC    F'0'                                                     15800002
CCWX5    DC    X'03'                    NOP                      SM5456 15810002
         DC    XL3'00'                                           SM5456 15820002
         DC    X'2000'                  SLI FLAG                 SM5456 15830002
         DC    H'1'                     BYTE COUNT               SM5456 15840002
CCWX6    DC    X'31'                    SEARCH ID EQUAL                 15850002
         DC    AL3(OUTCCHHR-FIRST)                                      15900002
         DC    X'4000'                  CCW FLAGS                       15950002
         DC    H'5'                     BYTE COUNT                      16000002
CCWX7    DC    X'08'                    TIC TO CCW6                     16050002
         DC    AL3(DXCCW6-CLOSEWKA)                                     16100002
         DC    F'0'                                                     16150002
CCWX8    DC    X'0D'                    WRITE KEY AND DATA              16200002
         DC    AL3(OUTDSCB-FIRST)                                A39292 16250002
         DC    X'4000'                  CCW FLAGS                       16300002
         DC    H'140'                   BYTE COUNT                      16350002
*CCWX9                                  SAME AS CCW6                    16400002
CCWX10   DC    X'08'                    TIC TO CCW8                     16500002
         DC    AL3(DXCCW9-CLOSEWKA)                                     16550002
         DC    F'0'                                                     16600002
CCWX11   DC    X'0E'                    READ KEY AND DATA-MAY BE        16650002
         DC    AL3(INDSCB-FIRST)        USED AS A WRITE CHECK           16700002
         DC    X'0000'                  CCW FLAGS               SA54549 16750002
         DC    H'140'                   BYTE COUNT                      16800002
WRITECCW EQU   *                        BEGINING OF WRITE CCW   SA54549 17110002
         DC    X'05'                    WRITE DATA              SA54549 17150002
         DC    AL3(DXDSCB-CLOSEWKA)     ADDRESS FORMAT 1 DSCB   SA54549 17200002
         DC    X'4000'                  CHAIN                   SA54549 17250002
         DC    H'96'                    BYTE COUNT              SA54549 17300002
*                                                                       17350002
*** CONSTANTS                                                           17400002
*                                                                       17450002
TEN      DC    H'10'                                             A37199 17500002
SIXTEEN  DC    H'16'                    OFFSET INTO DEB PREFIX  SA54549 17650002
*                                                                       17652002
*** TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                       17654002
*                                                                       17656002
         XCTLTABL ID=(NEXTXCTL,D1,PRECLOSE,P3),SVC=020,          Y02080X17660002
               LENGTH=,BRT=YES                                   Y02080 17710002
         EJECT                                                          17900002
*                                                                       17950002
*** RELEASE WORK AREA                                                   18100002
*                                                                       18150002
WORKAREA IECPRLWA EP,F4,D2=(3)          RELEASE WORK AREA        Y02080 18200002
         EJECT                                                   Y02080 18250002
CVT      DSECT                          CVT DSECT                Y02080 18300002
         CVT                                                     Y02080 18350002
         EJECT                                                          20050002
*                                                                       20100002
*** I/O SUPPORT WORK AREA                                               20150002
*                                                                       20200002
CLOSEWKA DSECT                                                          20250002
         IECDSECT                                                       20300002
         EJECT                                                          20350002
         DCBD  DSORG=(PS)                                               20400002
*                                                                       20450002
         END                                                            20500002
./  ADD  SSI=32681086,NAME=IGG020D1
 TITLE 'IGG020D1 - PARTIAL RELEASE - DADSM UPDATE'                      00020000
IGG020D1 CSECT                                                          00028021
*          RELEASE 16 DELETIONS                                         00036000
*3001090600                                                        AAAA 00040016
*          RELEASE 17 DELETIONS                                         00044000
*0762001100,045000,083000                                         DM0D  00048000
*0762064200                                                       20055 00050000
*          RELEASE 18 DELETIONS                                         00052000
*3462                                                             22500 00056018
*3462                                                             MCS   00058018
*          RELEASE 19 DELETIONS                                         00060000
*0945039600-044800,072400,076800                                 O19117 00064019
*          RELEASE 20 DELETIONS                                         00068000
*3043                                                            A35327 00072020
*          RELEASE 21 DELETIONS                                         00076000
*0980005400,006400-006600,007000-008600,009800,011000,036800,    A37199 00077021
*0980045400,056000-056200,076600,082800,084000,084400,087600,    A37199 00078021
*0980090800-091000                                               A37199 00079021
*0980000280,007600,015800-016000,089400-090000,090400            A39292 00080021
*          RELEASE 21.7 DELETIONS                                       00081002
*0000003200,016200-016400,017800-018400,072600,075700,083050-   SA54549 00082002
*0000083150,084800,086000-086800                                SA54549 00082402
*0000000840-001000,018600,019000,027000,028400,031000-          SA56400 00084002
*0000032400,050400,075600                                       SA56400 00084202
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00085002
*0000000030-000150,000850,001200,003400-003600,004800-005200,    Y02080 00085102
*0000007100-007200,007500-007600,015730-015740,016800,041600,    Y02080 00085202
*0000043000-045280,083000,083040,083050,083400,083600-088800     Y02080 00085302
*0000026630-026640,037600                                       XA01999 00085402
*0000                                                           YA02385 00085502
*          VS1 RELEASE 02 DELETIONS/CHANGES                             00095002
*0000028410-028430                                               XM0835 00095102
*                                                                       00105002
* MODULE NAME - IGG020D1                                                00105202
*                                                                       00105402
* DESCRIPTIVE NAME - PARTIAL RELEASE / DADSM UPDATE                     00105602
*                                                                       00105802
* COPYRIGHT - NONE                                                      00106002
*                                                                       00106202
* CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING THE CSECT CARD      00106402
*                                                                       00106602
*STATUS CHANGE LEVEL 010                                                00110021
*ATTRIBUTES - REENTRANT                                                 00120002
*                                                                       00140000
*FUNCTION - THIS MODULE UPDATES THE EXTENTS IN THE FORMAT 5 DSCB        00160000
*           RECORDS. THE NEW EXTENTS ARE PASSED TO THIS MODULE IN       00180000
*           A TABLE IN THE WORK AREA. WHEN AN EXTENT FROM THE TABLE     00200000
*           IS CONTIGUOUS WITH ONE OR TWO OF THE EXTENTS IN A FORMAT    00220000
*           5 DSCB RECORD, THE EXTENTS IN THAT RECORD ARE REPLACED      00240000
*           WITH ONE EXTENT THAT DESCRIBES THE ENTIRE AREA.             00260000
*                                                                       00280000
*ENTRIES-THE ONLY ENTRY POINT TO THIS MODULE IS IGG020D1. ENTRY         00300000
*        IS MADE FROM IGG020D0.                                         00320002
*                                                                       00380000
*SUPERVISOR CALLS AND MACROS. THE FOLLOWING ARE SUPERVISOR CALLS        00400000
*          ISSUED IN THE MACRO EXPANSIONS:                              00420000
*                    EXCP(0) READ FROM OR WRITE TO DIRECT ACCESS DEVICE 00440000
*                    WAIT(1) WAIT ON EVENT CONTROL BLOCK                00460000
*                                                                       00560000
*OTHER MACROS USED                                                      00580000
*                    IECPRLWA - DEFINES THE PARTIAL RELEASE WORK AREA   00590002
*                    IECSDSL1 - ENABLES SYMBOLIC ADDRESSING OF DSCBS    00600000
*                    IECDSECT - DEFINES THE CLOSE WORK AREA             00610002
*                                                                       00620000
*INPUT - AT ENTRY TO THIS MODULE, REGISTER 11 POINTS TO THE RELEASE     00630021
*        WORK AREA, WHICH CONTAINS THE FORMAT 4 DSCB, THE FIRST         00640021
*        FORMAT 5 DSCB, AND THE DADSM EXTENT TABLE. REGISTER 13         00650021
*        POINTS TO THE I/O SUPPORT WORK AREA, WHICH CONTAINS THE        00660021
*        UPDATED FORMAT 1 DSCB.                                         00670021
*        REGISTER 9 REFLECTS THE NUMBER OF EXTENTS IN THE               00672002
*        DADSM TABLE.                                                   00674002
*                                                                       00680000
*OUTPUT - UPDATED FORMAT 5 DSCB'S.                                      00690021
*                                                                       00700021
*STORAGE - PROGRAM CODE CSECT    = LESS THAN 2048 BYTES                 00710002
*          RELEASE WORK AREA     = 620 BYTES                            00720002
*          RPS WORK AREA         = 128 BYTES                            00722002
*          I/O SUPPORT WORK AREA                                        00724002
*                                                                       00730021
*EXITS -                                                                00740021
*        NORMAL - BRANCH TO IGG020P3 WITH ZERO IN REGISTER 2            00750002
*        ERROR  - BRANCH TO IGG020P3 WITH THE FOLLOWING ERROR           00760002
*                 CODE IN REGISTER 2:                                   00770021
*                                                                       00780021
*        X'10' - PERMANENT I/O ERROR                                    00790021
*                                                                       00800021
*                                                                       00880000
*REGISTER USAGE                                                         00900000
R0       EQU   0                                                        00920000
TEMP     EQU   0                                                        00940000
R1       EQU   1                                                        00960000
ERRETREG EQU   2                                                        01000000
R2       EQU   2                                                        01020000
R3       EQU   3                                                        01040000
R4       EQU   4                                                        01060000
R5       EQU   5                                                        01080000
COUNT    EQU   5                                                        01120000
R6       EQU   6                                                        01140000
INDEX3   EQU   6                                                        01160000
WORKREG1 EQU   7                                                        01180000
COUNT1   EQU   7                                                        01200000
INDEX2   EQU   8                                                        01220000
RTKK     EQU   8                                                        01240000
EXTCTR   EQU   9                                                        01260000
RINSCAN  EQU   9                                                        01280000
R10      EQU   10                                                       01300000
INDEX1   EQU   10                                                       01320000
ROUTSCAN EQU   10                                                       01340000
WRKAREA  EQU   11                                                       01360000
RXBASE   EQU   12                                                       01380000
R13      EQU   13                                                       01400000
RXCLOWKA EQU   13                                                       01420000
BRANCH   EQU   14                                                       01440000
RINEND   EQU   15                                                       01460000
R15      EQU   15                                                       01480000
WORKREG  EQU   15                                                       01500000
WORKREG2 EQU   15                                                       01520000
RX       EQU   15                                                       01540000
*                                                                       01548021
*** OTHER EQUATES                                                       01556021
*                                                                       01564021
IOERROR  EQU   X'10'                    I/O ERROR CODE           A37199 01572002
K0       EQU   0                        ZERO DISPLACEMENT       SA56400 01575002
TWO      EQU   2                        DISPLACEMENT OF TWO     SA56400 01576002
K2       EQU   2                        LENGTH OF TWO           SA56400 01577002
K4       EQU   4                        DISPLACEMENT OF FOUR    SA56400 01578002
K6       EQU   6                        DISPLACEMENT IS SIX     SA56400 01579002
*                                                                       01580021
         BALR  RXBASE,0                 LOAD BASE REGISTER      SA54549 01620002
         USING *,RXBASE                 BASE FOR MODULE         SA54549 01640002
         USING CLOSEWKA,RXCLOWKA                                        01660000
         USING PRLSEWKA,WRKAREA         WORK AREA ADDRESSABILITY Y02080 01680002
         USING CVT,R15                                                  01700000
*                                                                       01720000
*** THIS SECTION INITIALIZES DSCB CCHHR'S AND COUNTERS.                 01740000
*                                                                       01760000
SETICCHH EQU   *                                                        01880000
         MVC   INCCHHR(5),DS5PTRDS           SET NEXT FORMAT 5 CCHHR    01920000
*                                            FOR NEXT DADSM INPUT.      01940000
SETNCCHH EQU   *                                                        01960000
         MVC   NEXTDADS(5),INCCHHR          INITIALIZE NEXT DADSM PTR   01980000
*                                            DADSM.                     02000000
         LA    INDEX1,ENTRIES                SET INDEX FOR DADSMTBL     02020000
*                                            ENTRIES.                   02040000
         BAL   BRANCH,CVTORTA0               BRANCH TO CONVERT EXTENTS  02060000
*                                            OF INPUT FORMAT 5 FROM     02080000
*                                            XXYYZ TO RTA-RTA+1.        02100000
         LA    COUNT1,26                     LOAD TRANSFER DADSM COUNT  02120000
*                                            TO OUTPUT FOR 26 EXTENTS.  02140000
         EX    R0,SETOUT                    CLEAR OUTPUT DADSM AREA.    02160000
         LA    INDEX3,OUTDSCB+36             SET INDEX FOR OUTPUT AREA. 02180000
         LTR   COUNT,COUNT             ALL SPACE ALLOCATED              02200000
         BZ    OUTPUT4                 YES                              02220000
*                                                                       02240000
*** THIS SECTION MERGES ENTRIES FROM THE DADSM EXTENT TABLE WITH        02260000
*   ENTRIES FROM INPUT FORMAT 5 DSCB.                                   02280000
*                                                                       02300000
MERGE1   CLC   2(2,INDEX1),0(INDEX2)         COMPARE FOR CONTIGUOUS     02320000
*                                            EXTENTS BETWEEN RTA+1 OF   02340000
*                                            ENTRY AND RTA OF EXTENT.   02360000
         BH    MERGE3                        THE RTA OF THE ENTRY IS    02380000
*                                            GREATER THAN THE RTA OF    02400000
*                                            THE EXTENT.                02420000
         BL    MERGE8                        ENTRY GOES BEFORE 1ST      02440000
*                                            EXTENT.                    02460000
         MVC   0(2,INDEX2),0(INDEX1)         ENTRY AND DADSM ARE        02480000
*                                            CONTIGUOUS SET RTA+1 OF    02500000
*                                            EXTENT=RTA OF ENTRY.       02520000
MERGE2   LA    INDEX1,4(INDEX1)              INCREMENT DADSMTBL INDEX   02540000
*                                            FOR NEXT ENTRY.            02560000
         BCT   EXTCTR,MERGE3                 DECREMENT THE NUMBER OF    02580000
*                                            ENTRIES IN DADSMTBL AND    02600000
*                                            BRANCH IF MORE ENTRIES     02620000
*                                            TO CHECK FOR CONTIGUOUS    02640000
*                                            EXTENTS.                   02660000
MERGE6   EQU   *                                                        02661002
         MVC   K0(K4,INDEX3),K0(INDEX2) XFER INPUT TO           SA56400 02661202
*                                       OUTPUT                  SA56400 02662002
         LTR   COUNT,COUNT              ALL SPACE ALLOCATED     XA01999 02663002
         BZ    OUTPUT3                  BRANCH IF YES           XA01999 02664002
MERGE6A  LA    INDEX2,K4(INDEX2)        INCREMENT INPUT INDEX   SA56400 02665002
         BCT   COUNT,MERGE10            REDUCE EXTENT COUNT     SA56400 02666002
         BCTR  COUNT1,R0                REDUCE XFER COUNT       SA56400 02667002
         B     OUTPUT2                                          SA56400 02668002
MERGE3   CLC   0(2,INDEX1),2(INDEX2)         COMPARE FOR CONTIGUOUS     02720000
*                                            EXTENTS BETWEEN RTA+1 OF   02740000
*                                            EXTENT AND RTA OF ENTRY.   02760000
         BH    MERGE6                        ENTRY GREATER THAN EXTENT  02780002
         BL    OVERLAP                  BRANCH IF EXTENT        SA56400 02781002
*                                       IN ENTRIES OVERLAPS     SA56400 02782002
*                                       EXTENT IN F5            SA56400 02783002
         CLC   2(2,INDEX1),4(INDEX2)         COMPARE FOR A COLLAPSE     02800000
*                                            BETWEEN ENTRY AND EXTENTS. 02820000
         BL    MERGE5                   NO COLLAPSE             SA56400 02840002
         BH    CHECK                    CHECK IF OVERLAPPING     XM0835 02841002
*                                       EXTENTS WERE FOUND       XM0835 02843002
MERGE4   MVC   4(2,INDEX2),0(INDEX2)         DADSM COLLAPSE-MOVE RTA    02860000
*                                            OF EXTENT TO RTA OF NEXT   02880000
*                                            EXTENT.                    02900000
         LA    INDEX2,4(INDEX2)              INCREMENT INPUT FORMAT 5   02920000
*                                            INDEX FOR NEXT EXTENT.     02940000
         BCT   COUNT,MERGE2                  REDUCE NUMBER OF EXTENTS   02960000
*                                            AND CHECK NEXT ENTRY.      02980000
         LA    COUNT,1                       LAST EXTENT.               03000000
MERGE5   MVC   2(2,INDEX2),2(INDEX1)         RTA+1 OF EXTENT=RTA OF     03020000
*                                            ENTRY MOVE RTA OF ENTRY    03040000
         B     MERGE2                  CHECK FOR CONTIGUOUS             03060000
*                                      DADSMTBL ENTRIES                 03080000
MERGE8   LA    R1,4                    SET                              03260000
         SR    INDEX2,R1               ENTRY INDEX.                     03280000
         MVC   0(4,INDEX2),0(INDEX1)   MOVE ENTRY BEFORE EXTENT.        03300000
         LA    COUNT,1(COUNT)          INCREMENT EXTENT COUNT           03320000
         B     MERGE2                  CHECK FOR CONTIG DADSMTBL        03340000
CHECK    EQU   *                                                 XM0835 03340202
         NC    K4(K4,INDEX2),K4(INDEX2) IS NEXT EXTENT IN F5     XM0835 03340402
*                                       ALL ZEROES               XM0835 03340602
         BZ    MERGE5                   IF YES, NO OVERLAPPING   XM0835 03340802
*                                       EXTENTS WERE FOUND       XM0835 03341002
         LTR   COUNT,COUNT              ALL SPACE ALLOCATED     XA01999 03341102
         BZ    MERGE5                   BRANCH IF YES           XA01999 03341502
*                                                                       03342102
*** THIS SECTION MERGES ENTRIES FROM THE DADSM EXTENT TABLE             03342202
*   WITH ENTRIES FROM INPUT FORMAT 5 DSCB WHEN OVERLAPPING              03342302
*   EXTENTS HAVE BEEN DETECTED AND SETS A SWITCH SO THAT THE DIRF       03342402
*   BIT WILL REMAIN ON AT EXIT FROM PARTIAL RELEASE                     03342502
*                                                                       03342602
OVERLAP  EQU   *                                                        03342702
         OI    DADSMTBL,ERXTENT         INDICATE OVERLAPPING    SA56400 03342802
*                                       EXTENTS                 SA56400 03342902
         CLC   K0(TWO,INDEX1),K0(INDEX2) IS RTA IN ENTRIES      SA56400 03343002
*                                       LOWER THAN RTA IN F5    SA56400 03343202
         BNL   NEXTRTA                  BR IF ENTRIES RTA IS    SA56400 03344002
*                                       HIGH OF EQUAL           SA56400 03344202
         MVC   K0(TWO,INDEX2),K0(INDEX1)  MOVE ENTRIES RTA      SA56400 03345002
*                                       OVER FORMAT 5 RTA       SA56400 03345202
NEXTRTA  EQU   *                                                SA56400 03347002
         CLC   K2(TWO,INDEX1),K2(INDEX2)  IS RTA+1 IN ENTRIES   SA56400 03348002
*                                       HIGHER THAN RTA+1 IN F5 SA56400 03348202
         BNH   MERGE2                   IF HI OR EQAL, BRANCH   SA56400 03349002
         MVC   K2(TWO,INDEX2),K2(INDEX1)  MOVE ENTRIES RTA+1    SA56400 03350002
*                                       OVER F5 RTA+1           SA56400 03350202
         NC    K4(K4,INDEX2),K4(INDEX2) IS IT END OF INPUT F5   SA56400 03352202
         BZ    MERGE6                   BRANCH IF YES           SA56400 03352602
         CLC   K2(TWO,INDEX2),K4(INDEX2)  SHOULD EXTENTS        SA56400 03353002
*                                       BE COLLAPSED            SA56400 03353202
         BL    MERGE2                   BRANCH IF NO            SA56400 03354002
         CLC   K2(TWO,INDEX2),K6(INDEX2)  DOES CURRENT EXTENT   SA56400 03354202
*                                       IN FORMAT 5 ENGULF NEXT SA56400 03354402
*                                       EXTENT IN FORMAT 5      SA56400 03354602
         BNH   MERGE4                   BRANCH IF NO                    03354802
         MVC   K6(TWO,INDEX2),K2(INDEX2)  MOVE ENDING ADDRESS   SA56400 03354902
*                                       INTO NEXT EXTENT        SA56400 03355902
         B     MERGE4                                           SA54600 03356902
MERGE10  BCT   COUNT1,OUTPUT7                REDUCE OUTPUT XFER COUNT   03360000
*                                            AND BRANCH TO OUTPUT CHECK 03380000
*                                                                       03400000
*** THIS SECTION DETERMINES WHEN AND WHAT TYPE OF DSCB (FORMAT 0,       03420000
*   FORMAT 4 OR FORMAT 5) SHOULD BE WRITTEN.                            03440000
*                                                                       03460000
OUTPUT1  LTR   COUNT,COUNT                   CHECK NUMBER EXTENTS.      03480000
         BP    COLLAPSE                      EXTENTS LEFT.              03500000
OUTPUT2  CLI   INCCHHR+4,X'00'               ANY MORE FORMAT 5 DSCBS.   03520000
         BNE   DADSMIN                       YES.                       03540000
OUTPUT3  LA    INDEX3,4(INDEX3)        INCREMENT OUTPUT INDEX.          03560000
         LTR   EXTCTR,EXTCTR           ANY MORE ENTRIES                 03580000
         BZ    OUTPUT5                      NO                          03600000
         LTR   COUNT1,COUNT1                ARE 26 EXTENTS IN OUTPUT    03620000
         BP    OUTPUT4                      NO                          03640000
         BAL   BRANCH,DADSMOUT              OUTPUT DADSM                03660000
         SR    COUNT,COUNT                                       A37199 03680021
OUTPUT4  EQU   *                                                        03700000
         BCTR  COUNT1,0                      DECREMENT XFER COUNT       03720000
         LR    INDEX2,INDEX1           SET INDEX FOR XFER ENTRY.        03740000
         B     MERGE2                                                   03780000
OUTPUT5  EQU   *                                                        03800000
         BAL   BRANCH,DADSMOUT              WRITE FORMAT 5.             03820000
         TM    DXCCW7+7,1                   IS FORMAT 0 PENDING.        03840000
         BZ    WRTVTOC                      BRANCH IF NO                03860000
         LH    WORKREG2,HOLENUM             INCREMENT HOLE COUNT        03880000
         LA    WORKREG2,1(WORKREG2)           IN DADSM TABLE.           03900000
         STH   WORKREG2,HOLENUM                                         03920000
         BAL   WORKREG1,SETSEEK             OUTPUT  FORMAT 0.           03940000
WRTVTOC  EQU   *                                                 O19117 04030019
         SR    ERRETREG,ERRETREG        ZERO ERROR CODE          O19117 04120019
*                                                                       04140021
*** THIS SECTION BRANCHES TO THE LAST LOAD OF PARTIAL RELEASE.          04160002
*                                                                       04180021
XCTL     EQU   *                                                 O19117 04210019
        IECRES LOAD,EXTPR=(WRKAREA),MODID=PRECLOSE,BRANCH=DIRECT Y02080 04300002
*                                                                       04536021
*** THIS SECTION TESTS IF A FORMAT 5 DSCB MUST BE WRITTEN TO THE VTOC.  04544021
*                                                                       04552021
OUTPUT6  EQU   *                                                        04560000
         LTR   COUNT,COUNT        ANY MORE EXTENTS                22500 04566018
         BZ    OUTPUT2            NO,BRANCH                       22500 04572018
         LA    BRANCH,BYINDEX               SET RETURN FROM DADSMOUT.   04580000
         LTR   COUNT1,COUNT1                26 EXTS XFERED TO OUTPUT.   04600000
         BZ    DADSMOUT                     YES-WRITE DADSM RECORD.     04620000
OUTPUT7  EQU   *                                                        04640000
         LA    INDEX3,4(INDEX3)             NO-INCREMENT OUTPUT INDEX.  04660000
BYINDEX  EQU   *                                                        04680000
         LTR   EXTCTR,EXTCTR           ANY MORE ENTRIES                 04700000
         BZ    MERGE6                        XFER EXTENTS TO OUTPUT.    04720000
         B     MERGE1                        CHECK EXTENTS AND ENTRIES. 04740000
*                                                                       04760000
*** THIS MODIFIES THE CHANNEL PROGRAM TO READ IN A FORMAT 5 DSCB.       04780000
*                                                                       04800000
DADSMIN  LA    WORKREG2,INCCHHR              MODIFY SEARCH ID EQUAL     04820000
         ST    WORKREG,DXCCW9               CHANNEL PROGRAM FOR         04840000
         MVI   DXCCW9,X'31'                 READING IN FMT 5 DSCB.      04860000
         NI    DXCCW11+4,X'EF'              TURN OFF SKIP FLAG IN       04880000
         MVC   DXDAADDR+3(5),INCCHHR        CCHHR OF NEXT FMT 5 IN      04900000
*                                            SEEK ADDRESS.              04920000
         LA    WORKREG,DXCCW9               GET STARTING CCW ADDRESS.   04940000
         BAL   BRANCH,EXECUTIO               READ IN NEXT FORMAT5.      04960000
         BAL   BRANCH,CVTORTA0               CONVERT FORMAT5 EXTENTS    04980000
*                                            TO RTA-RTA+1.              05000000
         CLC   2(2,INDEX3),0(INDEX2)        ARE EXTS CONTIGUOUS.        05020000
         BL    NEXTOUT                  BRANCH IF NOT CONTIG    SA56400 05040002
         EX    R0,COLLAPS3                  MERGE CONTIGUOUS EXTENTS.   05060000
         LA    INDEX2,4(INDEX2)             INCREMENT INPUT INDEX.      05080000
         BCTR  COUNT,0                      DECREMENT INPUT EXTS CTR.   05100000
NEXTOUT  EQU   *                                                        05120000
         EX    R0,SETNCCHH             SET NEXT OUTPUT FORMAT 5.        05140000
         EX    R0,SETICCHH             SET NEXT INPUT  FORMAT 5.        05160000
         MVC   DXCCW9(4),DXCCW6             RESET CHANNEL PROGRAM ADDR. 05180000
*                                                                       05200000
*** THIS SECTION CREATES A SINGLE EXTENT FOR EACH SET OF CONTIGUOUS     05220000
*   EXTENTS.                                                            05240000
*                                                                       05260000
COLLAPSE LTR   EXTCTR,EXTCTR                 ANY MORE ENTRIES.          05280000
         BZ    OUTPUT6                       NO.                        05300000
COLLAPS1 CLC   0(2,INDEX1),2(INDEX3)         COMPARE FOR DADSM COLLAPSE 05320000
         BNE   OUTPUT6                       NO                         05340000
         EX    R0,MERGE1                    COMPARE ENTRY AND EXTENT.   05360000
         BNE   OUTPUT6                       NO                         05380000
COLLAPS3 EQU   *                                                        05400000
         MVC   2(2,INDEX3),2(INDEX2)         YES                        05420000
         LA    INDEX1,4(INDEX1)              INCREMENT DADSMTBL INDEX.  05440000
         LA    INDEX2,4(INDEX2)              INCREMENT INPUT INDEX.     05460000
         BCT   EXTCTR,COLLAPS2                                          05480000
         BCT   COUNT,OUTPUT6                 NO MORE ENTRIES-OUTPUT     05500000
         B     OUTPUT2                                                  05520000
COLLAPS2 BCT   COUNT,COLLAPS1                CHECK FOR ANOTHER COLLAPSE 05540000
         B     OUTPUT2                                                  05560000
*                                                                       05580000
*** THIS SECTION CONVERTS THE FORMAT 5 DSCB FROM RTA/RTA+1 FORMAT       05600021
*   TO ITS FINAL XXYYZ FORMAT AND WRITES IT TO THE VTOC.                05620021
*                                                                       05640000
DADSMOUT LR    WORKREG1,BRANCH               SAVE BRANCH ADDRESS        05660000
         STM   R6,R10,SAVEREGS                                          05680000
         OI    DXCCW11+4,X'10'              TURN ON SKIP FLAG.          05700000
         LA    RINEND,26                     SET COUNT INDEX            05720000
         LA    ROUTSCAN,OUTDSCB+5            SET OUTPUT INDEX           05740000
         LA    RINSCAN,OUTDSCB+36            SET INPUT INDEX            05760000
NEXTEXT  LH    RTKK,DS4DEVSZ+2               LOAD TRACKS PER CYLINDER   05780000
         LH    R1,0(RINSCAN)                 R1= RTA                    05800000
         LH    R3,2(RINSCAN)                 R3= RTA+1                  05820000
         SR    R0,R0                         ZERO                       05840000
         LR    R2,R0                         DIVIDE REGS.               05860000
         LR    R4,R3                                                    05880000
         SR    R4,R1                         R4=RTA+1-RTA               05900000
         CLR   R4,RTKK                                                  05920000
         BNL   MORETH1                       MORE THAN ONE CYL POSSIBLE 05940000
         MVC   2(2,ROUTSCAN),ZERO            ZERO YY.                   05960000
         STC   R4,4(ROUTSCAN)                SET Z.                     05980000
         B     MOVEXTA                                                  06000000
MORETH1  DR    R0,RTKK                       RTA  /RTKK                 06020000
         DR    R2,RTKK                       RTA+1/RTKK                 06040000
         SR    R3,R1                                                    06060000
         LTR   R0,R0                         EXCESS TRACKS              06080000
         BP    NOTCYL                        YES                        06100000
         STC   R2,4(ROUTSCAN)                SET Z                      06120000
         B     STORECYL                                                 06140000
NOTCYL   SR    RTKK,R0                                                  06160000
         LTR   R3,R3                                                    06180000
         BZ    ADD2                                                     06200000
         BCTR  R3,0                                                     06220000
ADD2     AR    RTKK,R2                                                  06240000
         STC   RTKK,4(ROUTSCAN)              SET Z                      06260000
STORECYL STH   R3,HOLD                                                  06280000
         MVC   2(2,ROUTSCAN),HOLD            SET YY.                    06300000
MOVEXTA  MVC   0(2,ROUTSCAN),0(RINSCAN)      SET XX                     06320000
         LA    ROUTSCAN,5(ROUTSCAN)          INCREMENT OUTPUT INDEX     06340000
         LA    RINSCAN,4(RINSCAN)            INCREMENT INPUT INDEX      06360000
         BCT   RINEND,NEXTEXT                BACK FOR NEXT EXTENT       06380000
         LM    R6,R10,SAVEREGS               RESET REGISTERS            06400000
         OC    OUTDSCB+5(130),OUTDSCB+5  OUTPUT AREA ZERO         20055 06420000
         BE    ZEROUT                        YES                        06440000
         MVC   OUTDSCB(4),FIVE               SET UP FORMAT 5            06460000
         MVC   OUTDSCB+4(40),OUTDSCB+5       MOVE OVER ID BYTE          06480000
         MVI   OUTDSCB+44,X'F5'              INSERT ID BYTE.            06500000
ZEROUT   EQU   *                                                        06520000
         MVC   OUTDSCB+135(5),NEXTDADS      SET DADSM POINTER.          06540000
         EX    R0,COMPOUT               IS THIS A VALID CHAIN ADDR.     06560000
         BNE   SKIPFLAG                 YES-DONT MODIFY CHAIN.          06580000
         EX    R0,ZEROPTR               NO-POINT TO NEXT F5 DSCB.       06600000
SKIPFLAG EQU   *                                                        06620000
         OI    DXCCW11+4,X'10'              TURN ON SKIP FLAG.          06640000
         CLI   INCCHHR+4,X'00'               ANY MORE FORMAT 5          06660000
         BE    FINDHOLE                     FIND HOLE                   06680000
SETSEEK  MVC   DXDAADDR+3(5),OUTCCHHR       SET UP SEEK ADDRESS.        06700000
         LA    WORKREG,DXCCW6               SET CHANNEL PROGRAM START.  06720000
         BAL   BRANCH,EXECUTIO               WRITE OUT UPDATED DADSM.   06740000
COMPOUT  EQU   *                                                        06760000
         CLC   OUTCCHHR(5),NEXTDADS          NEXT OUTPUT EQU THIS OUT   06780000
         BE    NXTOUTIN                                                 06800000
SETNEXT  MVC   OUTCCHHR(5),NEXTDADS         SET NEXT DADSM POINTER.     06820000
         B     TESTZERO                     TEST FOR FORMAT 0 PENDING   06840000
NXTOUTIN MVC   OUTCCHHR(5),INCCHHR           SET NEXT OUTPUT            06860000
TESTZERO TM    OUTDSCB+139,X'FF'            TEST FOR END OF OUTPUT.     06880000
         BNE   SETOUT                       BRANCH IF NO.               06900000
         TM    OUTCCHHR+4,X'FF'             TEST FOR END OF INPUT.      06920000
         BZ    SETOUT                       BRANCH IF YES.              06940000
         OI    DXCCW7+7,1                   INDICATE FORMAT 0 NEEDED.   06960000
SETOUT   XC    OUTDSCB(140),OUTDSCB          ZERO OUTPUT AREA           06980000
         LA    INDEX3,OUTDSCB+36             SET OUTPUT INDEX.          07000000
         LR    BRANCH,WORKREG1               RESET BRANCH REG.          07020000
         LA    COUNT1,26                     SET INDEX FOR OUTPUT XFER. 07040000
         BR    BRANCH                        EXIT FROM SUBROUTINE.      07060000
FINDHOLE LR    TEMP,COUNT                   ANY EXTENTS                 07080000
         ALR   TEMP,EXTCTR                  OR ENTRIES LEFT             07100000
         BZ    ZEROPTR                      NO                          07120000
         EX    R0,COMPOUT              NEED  A HOLE.                    07140000
         BE    SEARCHOL                 BRANCH IF EQUAL                 07160000
         CLI   NEXTDADS+4,0             IS CHAIN ADDRESS ZERO           07180000
         BNE   SETSEEK                  BRANCH IF NO.                   07200000
SEARCHOL EQU   *                                                        07220000
         MVC   DXDAADDR+3(4),VTOCADR    INSERT VTOC ADR INTO IOB O19117 07240019
         LA    WORKREG,DXCCW1               SET UP CHANNEL PROGRM STRT. 07280000
         BAL   BRANCH,EXECUTIO               FIND HOLE FOR NEXT OUTPUT  07300000
*                                            AND OUTPUT DADSM.          07320000
         MVC   DXDAADDR+3(L'OUTCCHHR),OUTCCHHR  UPDATE IOB SEEK YA02385 07321002
         LA    WORKREG,DXCCW6           SET UP TO READ          SA54549 07330002
         BAL   BRANCH,EXECUTIO          IN FORMAT ZERO          SA54549 07332002
         LH    WORKREG,HOLENUM          GET NO OF F0'S CREATED.         07340000
         BCTR  WORKREG,0                                                07360000
         STH   WORKREG,HOLENUM          SAVE NO IN DADSM TABLE.         07380000
         MVC   NEXTDADS(5),OUTDSCB+135       SET NEXT OUTPUT            07400000
         B     SETNEXT                                                  07420000
ZEROPTR  MVC   OUTDSCB+135(5),INCCHHR        ZERO POINTER               07440000
         B     SETSEEK                                                  07460000
*                                                                       07480000
*** THIS IS THE CHANNEL PROGRAM INITIATING SECTION.                     07500000
*                                                                       07520000
EXECUTIO ST    WORKREG,IOBSIOCC             SET CCW PTR INTO IOB.       07540000
         EXCP  DXIOB                                                    07580000
         WAIT  ECB=DXECB                                                07600000
         TM    DXECB,X'20'                  TEST FOR PERM I/O ERROR.    07620000
         BCR   5,BRANCH                     RETURN IF NO I/O ERROR      07640000
         LA    ERRETREG,IOERROR         LOAD I/O ERROR CODE      A37199 07660021
         B     XCTL                     ADVANCE TO NEXT LOAD     O19117 07680019
*                                                                       07700000
*** THIS SECTION CONVERTS THE FORMAT 5 DSCB FROM ITS VTOC FMT (XXYYZ)   07720000
*   TO A WORKABLE FMT (STARTING RTA-ENDING RTA+1).                      07740000
*                                                                       07760000
CVTORTA0 STM   R6,R10,SAVEREGS               SAVE REGS.                 07780000
         SR    R2,R2                         ZERO R2.                   07800000
         SR    COUNT,COUNT                   AND COUNT.                 07820000
         MVC   INDSCB+44(90),INDSCB+45       MOVE INPUT OVER ID BYTE.   07840000
         LA    RINSCAN,INDSCB+4             SET INPUT INDEX             07860000
         LR    ROUTSCAN,RINSCAN             SET OUTPUT INDEX.           07880000
         LA    RX,26                         SET CONVERT COUNT.         07900000
TEST0    CLC   0(2,RINSCAN),ZERO             EXTENT ZERO.               07920000
         BE    INCRIN                        YES.                       07940000
         MVC   HOLD(5),0(RINSCAN)            HOLD XXYYZ.                07960000
         LH    R1,HOLD+2                     R1=YY.                     07980000
         MH    R1,DS4DEVSZ+2                 MULT BY TRACKS PER CYL.    08000000
         IC    R2,HOLD+4                     R2=Z.                      08020000
         ALR   R1,R2                         R1= TRACKS+Z.              08040000
         AH    R1,HOLD                       R1=RTA+1.                  08060000
         STH   R1,2(ROUTSCAN)                SET RTA+1 IN OUTPUT.       08080000
         MVC   0(2,ROUTSCAN),HOLD            SET RTA IN OUTPUT.         08100000
         LA    ROUTSCAN,4(ROUTSCAN)          INCREMENT OUTPUT INDEX.    08120000
         LA    COUNT,1(COUNT)                INCREMENT CONVERT COUNT.   08140000
INCRIN   LA    RINSCAN,5(RINSCAN)            INCREMENT INPUT INDEX.     08160000
         BCT   RX,TEST0                      BACK FOR NEXT CONVERT      08180000
         ST    RX,0(ROUTSCAN)           CLEAR NEXT ENTRY         O19117 08190019
         LM    R6,R10,SAVEREGS               RESET REGS.                08200000
         LA    INDEX2,INDSCB+4         SET EXTENT INPUT INDEX.          08220000
         BR    BRANCH                        BRANCH OUT.                08240000
*                                                                       08245021
*** CONSTANTS                                                           08250021
*                                                                       08255021
FIVE     DC    X'05050505'                                              08260000
*                                                                       08302002
*** TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                       08304002
*                                                                       08304402
         XCTLTABL ID=(PRECLOSE,P3),SVC=020,LENGTH=,BRT=YES       Y02080 08305002
         EJECT                                                  SA54549 08315002
*                                                                       08316021
*** CVT DSECT                                                           08317021
*                                                                       08318021
CVT      DSECT                                                          08320000
         CVT                            CVT DSECT                Y02080 08340002
         EJECT                                                  SA54549 08342002
*                                                                       08345021
*** RELEASE WORK AREA                                                   08350021
*                                                                       08355021
WORKAREA IECPRLWA EP,F4,D1=(5)          RELEASE WORK AREA        Y02080 08360002
SAVEREGS EQU   IECREGSV+12              REGISTER SAVE AREA       Y02080 08380002
         EJECT                                                  SA54549 08882002
*                                                                       08885021
*** I/O SUPPORT WORK AREA                                               08890021
*                                                                       08895021
CLOSEWKA DSECT                                                          08900000
         IECDSECT                                                       08920000
ZERO     EQU   DXCCW4+4                                                 09020000
         END                                                            09120000
./  ADD  SSI=71890377,NAME=IGG020P1
 TITLE 'IGG020P1 - PARTIAL RELEASE - ENTRY POINT'                       00020000
IGG020P1 CSECT                                                          00026021
*          RELEASE 16 DELETIONS                                         00032000
*1463                                                             5M03B 00033016
*1463077400,077600                                                 AAAA 00035016
*1463                                                             17305 00036016
*          RELEASE 17 DELETIONS                                         00038000
*6039000900,001600-002200,060000,069400.                           DM0D 00041000
*6039029200                                                       18924 00042000
*6039019000                                                       19689 00043000
*          RELEASE 18 DELETIONS                                         00044000
*3479                                                             MCS   00047018
*          RELEASE 19 DELETIONS                                         00050000
*0946019400,029000,037300,048600-050600,057800-060200            O19117 00053019
*0946041200,043320                                               A25991 00054019
*          RELEASE 20 DELETIONS                                         00056000
*          RELEASE 21 DELETIONS                                         00062000
*0980001000-001200,001500-003000,004800-005000,005400-005800,    A37199 00062121
*0980006200-006400,006800-007600,008400,009000,009800-010200,    A37199 00062221
*0980010800,011400,011800,012200-012400,013000,014200,014600-    A37199 00062321
*0980015000,017400-017600,018200,019200,020000,024800-025200,    A37199 00062421
*0980028000,031200,034800-035000,037160-037240,042200-043000,    A37199 00062521
*0980048300,050800,064200-064400,069800,070800,071200,074400,    A37199 00062621
*0980075520                                                      A37199 00062721
*0980000260,006400,015600-015800,018900-019000,021200,029400,    A39292 00063021
*0980036200,044600,053600,054000,054600-054800,056200,057400,    A39292 00064021
*0980066400,069600-069800,076200-077000                          A39292 00065021
*          RELEASE 21.7 DELETIONS                                       00065402
*0000002400,005300-005600,006900-007400,016400,024200-024400,   SA54549 00067002
*0000025280,027000,028200,029360,029460,037000,037320-037480,   SA54549 00067402
*0000045000,046400-048400,063200,064200,068800,069480-069640,   SA54549 00067802
*0000071600,073000-073600                                       SA54549 00071002
*0000018200,022400-023800,050200-050400,063000,067400-067600    SA53147 00071102
*0000069100                                                     SA53147 00071202
*          RELEASE 22 DELETIONS                                         00072502
*          VS2 RELEASE 01 DELETIONS                                     00072602
*0000                                                            YM2930 00072702
*0000026500,026660-026708                                        YM4398 00072802
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00074502
*0000000280,000304-000308,000740-000800,003200-003400,004400,    Y02080 00074602
*0000005820,006200-006400,006800-006900,007100,015300,015630-    Y02080 00074702
*0000015650,016600,017600,018100-018200,018450-018550,019300-    Y02080 00074802
*0000019700,025320,025360-025680,025800,026100,026480,026720,    Y02080 00074902
*0000029300,036350,036450,036550,039400,048800,049800-050800,    Y02080 00075002
*0000066400,067600,068000,069200-069416,069440,069480,070200,    Y02080 00075102
*0000070400-075600                                               Y02080 00075202
*0000017200,019900-020080,026140,069580-070220,077900-078200     Y02144 00075402
*0000000030-000150,005820,019860,019900,020100,026480,026660-    Y02082 00075502
*0000026740,028600-028800,029100-031000,066200,066600            Y02082 00075602
*0000027000-027100                                               YM3912 00075702
*0000029240-029250,029830-029840,069060,069100                   YM2880 00075902
*0000                                                            YM2887 00076202
*0000                                                            YM5371 00076602
*0000030710-030730,030770-030790                                 YM5709 00077002
*0000026130,026148-026156                                        YM6546 00077402
*0000020020,026100-026110,069500                                 YM3997 00077702
*0000029980,030130,030820                                        YM4653 00078002
*0000004700,018800,029320,029880-029890,029940,029960-029970,    YM8507 00078502
*0000030000,030030-030050,030110-030130,030210,030910-030920,    YM8507 00078602
*0000078400                                                      YM8507 00078702
*                                                                       00085002
*                                                                       00089002
*STATUS CHANGE LEVEL 010                                                00090021
*                                                                       00095002
*MODULE NAME - IGG020P1                                                 00100002
*                                                                       00105002
*DESCRIPTIVE NAME - PARTIAL RELEASE - ENTRY POINT                       00110002
*                                                                       00115002
*COPYRIGHT - NONE                                                       00120002
*                                                                       00125002
*CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD           00130002
*                                                                       00140000
*FUNCTION - THIS MODULE RELEASES ANY UNUSED SPACE THAT WAS              00160021
*        ALLOCATED IN THE DATA SET'S FORMAT 1 DSCB.                     00180021
*                                                                       00182002
*DEPENDENCIES - REGISTER 7 ON ENTRY FROM RESTART MUST POINT TO   YM8507 00184002
*        THE RESTART WORKAREA MAPPED BY IEEVRSWA, DSECT NAME     YM8507 00186002
*        RSTWA. LABEL RSINT POINTS TO THE FIRST OF ALL THE DEBS  YM8507 00188002
*        BEING REESTABLISHED FOR THE TASK.                       YM8507 00190002
*                                                                       00200021
*ENTRIES - THE ENTRY POINT TO THIS MODULE IS IGG020P1. ENTRY IS         00220021
*        MADE FROM CLOSE MODULE IFG0202E OR FROM THE REPOSITION I/O     00240002
*        FUNCTION OF CHECKPOINT/RESTART.                                00260021
*                                                                       00360000
*SUPERVISOR CALLS                                                       00380000
*        SVC   EXCP (0)  READ/WRITE DISK                                00400000
*        SVC   WAIT (1)  WAIT FOR COMPLETION OF I/O                     00420000
*                                                                       00460000
*INPUT - REGISTER 2 POINTS TO THE USER'S DCB FOR RESTART, AND    YM8507 00470002
*        TO THE COPY DCB FOR CLOSE. REGISTER 4 POINTS TO         YM8507 00472002
*        THE I/O SUPPORT WORK AREA WHICH CONTAINS THE DATA PORTION      00480021
*        OF THE FORMAT 1 DSCB. REGISTER 10 POINTS TO THE UCB.           00490021
*        REGISTER 7 POINTS TO RESTART WORKAREA IF FROM RESTART.  YM8507 00492002
*                                                                       00520000
*OUTPUT - REGISTER 11 POINTS TO THE RELEASE WORK AREA WHICH CONTAINS    00530002
*        THE DATA PORTION OF THE FORMAT 4 DSCB, AND THE DADSM           00540002
*        EXTENT TABLE, WHOSE ENTRIES REPRESENT THE SPACE BEING          00550002
*        RELEASED FROM THE FORMAT 1 DSCB.                               00560002
*        REGISTER 13 POINTS TO THE I/O SUPPORT WORK AREA, WHICH         00570021
*        CONTAINS THE PARTIALLY UPDATED FORMAT 1 DSCB.                  00580002
*        IF THIS MODULE IS BRANCHING TO IGG020P2, REGISTER 5 WILL       00582002
*        CONTAIN THE NUMBER OF ENTRIES IN THE DADSM TABLE.              00590002
*                                                                       00600000
*STORAGE - PROGRAM CODE CSECT    = LESS THAN 2048 BYTES                 00620002
*          RELEASE WORK AREA     = 620 BYTES                            00630002
*          RPS WORK AREA         = 128 BYTES                            00640002
*          I/O SUPPORT WORK AREA                                        00650002
*                                                                       00660000
*EXITS -                                                                00670021
*        NORMAL - BRANCH TO IGG020P2                                    00680002
*        ERROR  - IF AN I/O ERROR OCCURRED, BRANCH TO IGG020P3          00690002
*                 WITH X'10' ERROR CODE IN REGISTER 2.                  00700002
*                 BRANCH TO IGG020D0 TO WRITE BACK THE FORMAT 1         00710002
*                 WITH ONE OF THE FOLLOWING CODES IN REGISTER 2:        00720002
*                 X'00' - NO EXTENTS BEING RELEASED                     00722002
*                 X'02' - UNABLE TO FIND EXTENT IN THE FORMAT 1 DSCB    00730002
*                 X'08' - ANOTHER DCB IS OPEN TO THE DATA SET           00732002
*                 X'20' - NO ROOM IN THE VTOC                           00740002
*                                                                       00780000
*REGISTER USAGE                                                         00800000
R0       EQU   0                                                        00820000
RX1      EQU   1                       WORK                             00860000
R1       EQU   1                                                        00880000
ERRETREG EQU   2                                                        00920000
R2       EQU   2                                                        00940000
RX2      EQU   2                       WORK                             00960000
R3       EQU   3                                                        01040000
RX4      EQU   4                       WORK                             01060000
R4       EQU   4                                                        01100000
R5       EQU   5                                                        01120000
R6       EQU   6                                                        01160000
R7       EQU   7                                                        01200000
R8       EQU   8                                                        01260000
R9       EQU   9                                                        01280000
RXUSRDCB EQU   9                       BASE FOR USERS DCB               01320000
RXUCB    EQU   10                      POINTER TO THE UCB               01340000
RXWKA    EQU   11                      BASE FOR WORK AREA               01360000
RXBASE   EQU   12                      BASE FOR MAIN PROGRAM            01380000
RXCLOWKA EQU   13                      BASE FOR CLOSE'S WORK AREA       01400000
RLINK    EQU   14                      SUBROUTINE LINK REGISTER         01440000
R15      EQU   15                                                       01520000
*                                                                       01522021
*** OTHER EQUATES                                                       01524021
*                                                                       01526021
K0       EQU   0                        CONSTANT OF 0            Y02082 01526202
K1       EQU   1                        CONSTANT OF 1            Y02082 01526402
K2       EQU   2                        CONSTANT OF 2            Y02080 01527002
K3       EQU   3                        CONSTANT OF 3            Y02082 01527502
K4       EQU   4                        4 BYTES                 SA54549 01528002
K5       EQU   5                        CONSTANT OF 5            Y02082 01528202
K6       EQU   6                        6 BYTES                 SA54549 01528402
K12      EQU   12                       CONSTANT OF 12           Y02082 01529002
SVRBEXSA EQU   96                       SVRB EXTENDED SAVEAREA   YM8507 01529402
RTNCODE8 EQU   8                        ERROR RETURN CODE OF 8   Y02082 01530002
DS1EXTUL EQU   X'40'                    USER LABEL EXTENT        Y02082 01531002
ALLBITS  EQU   X'FF'                    MASK OF ALL ONES         Y02082 01532002
BLANK    EQU   C' '                     EBCDIC BLANK             YM2880 01533002
DEBDADEV EQU   X'04'                    DEB EXTENT SCALE FOR DA  Y02082 01534002
DIRFBIT  EQU   X'04'                    VTOC INTERRUPT BIT       O19117 01540019
NOTINF1  EQU   X'02'                    EXTENT NOT FOUND ERROR   A37199 01547021
OPENDS   EQU   X'08'                    OPEN DATA SET ERROR      Y02082 01548002
IOERROR  EQU   X'10'                    I/O ERROR CODE           A37199 01554021
NOROOM   EQU   X'20'                    NO ROOM IN VTOC ERROR    A37199 01561021
*                                                                       01570021
         BALR  RXBASE,0                      LOAD BASE REGISTER         01600000
         USING *,RXBASE                 BASE FOR MODULE         SA54549 01610002
         USING CVT,R15                      CVT BASE REGISTER.          01620000
         USING PRLSEWKA,RXWKA           WORK AREA ADDRESSABILITY Y02080 01660002
         USING IHADCB,RXUSRDCB         ESTABLISH BASE FOR USERS DCB     01680000
         USING CLOSEWKA,RXCLOWKA       ESTABLISH BASE FOR CLOS WKAREA   01700000
         USING UCB,RXUCB                UCB ADDRESSABILITY       Y02144 01720002
*                                                                       01740021
*** THIS SECTION OBTAINS CORE FOR THE PARTIAL RELEASE WORK AREA.        01760002
*                                                                       01780000
BEGINA   LA    RXCLOWKA,0(RX4)              GET PTR TO CLOSE WORKAREA.  01800000
         IECRES GET,PREFIX=FIRST,LV=PWALNGTH,ID=PRWA,            Y02080X01810002
               STM=(RX2,RXCLOWKA,DXCCW1)  OBTAIN WORK AREA       Y02080 01820002
         LR    RXWKA,RX1                     LOAD GETMAIN AREA BASE REG 01840000
         MVC   WTGMODNM,FIRSTLD         MOVE IN MODULE NAME      YM5371 01842002
*                                                                       01844002
         MODESET EXTKEY=ZERO            SWITCH TO KEY 0 BEFORE   Y02082X01845002
                                        SAVING REGISTERS IN SVRB Y02082 01850002
         BAL   RLINK,FINDSVRB               GET POINTER TO SVRB.        01860000
         STM   RX2,RXUCB,SVRBEXSA(R15)  SAVE REGISTERS FOR CLOSE YM8507 01880002
         LR    RXUSRDCB,RX2                  LOAD USERS DCB ADR.IN BASE 01980000
         ST    RXUSRDCB,DCBSAVE         SAVE USER'S DCB POINTER SA54549 01980402
         LTR   R4,R4                    ENTERED FROM            SA54549 01982002
*                                       CHECKPOINT/RESTART      SA54549 01984002
         BP    SETKEY5                  BRANCH IF NO             Y02082 01986002
         OI    DADSMTBL,FROMCR          TURN INDICATOR ON       SA54549 01988002
*                                                                       01989002
         IECRES LOAD,MODNM=FIRSTLD,EXTPR=(RXWKA),BRANCH=NO       Y02080X01990002
                                        LET OPTIONAL TRACE PRINT Y02080X01991002
                                        THIS MODULE'S NAME       Y02080 01992002
         B     SETFNCTN                 INITIALIZE THE RECOVERY  Y02144 01993002
*                                       ROUTINE PARAMETER LIST   Y02144 01994002
SETKEY5  EQU   *                        RETURN TO DATAMGT KEY    Y02082 01995002
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY IF Y02082X01996002
                                        ENTERED FROM CLOSE       Y02082 01997002
*                                                                       01998002
*** THIS SECTION INITIALIZES THE RECOVERY ROUTINE PARAMETER LIST.       01999002
*                                                                       02000002
SETFNCTN EQU   *                        INITIALIZE LIST          Y02144 02001002
         L     RX1,IECRRPRM             RECOVERY RTN LIST ADDR   Y02144 02003002
         USING RRPLIST,RX1              PARM LIST ADDRESSABILITY Y02144 02004002
         OI    RRFUNCTN,RRFPRLSE        SET RELEASE FUNCTION BIT Y02144 02005002
         ST    RXUCB,RRUCBPTR           SAVE UCB ADDRESS         Y02144 02006002
         DROP  RX1                                               Y02144 02007002
*                                                                       02008002
*** THIS SECTION INITIALIZES THE CHANNEL PROGRAM.                       02009002
*                                                                       02010002
CHANPROG EQU   *                                                SA54549 02012002
         XC    DXDAADDR(2),DXDAADDR         CLEAR FIRST TWO BYTES OF SK 02020000
         LM    R0,R5,CCWX1                  PICK UP FIRST 3 CCWS.       02040000
         ALR   R0,RXCLOWKA                  MODIFY ADDR OF CCWS IN      02060000
*                                           CLOSE WORK AREA.            02080000
         ALR   R2,RXCLOWKA                  CLOSE AREA HAS CCW'S.       02100000
         ALR   R4,RXWKA                 WRITE FROM OUTDSCB       A39292 02120021
         STM   R0,R5,DXCCW1                 STORE FIRST 6 CCW'S.        02140000
         LA    R2,DXCCW4                    MODIFY TIC ADDRESS.         02160000
         ST    R2,IOBSIOCC                  INSERT STARTING CCW IN IOB. 02180000
         STM   R0,R5,DXCCW4                 STORE LAST 3 OF 6 CCW'S.    02200000
         MVI   DXCCW5,X'08'                 INSERT TIC OP CODE.         02220000
*   BUILD CCW6 AND CCW7 TO READ F4 DSCB AND COUNT OF FIRST F5 DSCB      02230002
         LM    R0,R3,CCWX6              LOAD CCWS 6-7           SA53147 02240002
         ALR   R0,RXWKA                 RELOCATE READ AREA ADDR SA53147 02260002
         ALR   R2,RXWKA                 RELOCATE READ IN AREA   SA53147 02280002
*                                       FOR READ COUNT          SA53147 02300002
         STM   R0,R3,DXCCW6             STORE CCW6 AND CCW7     SA53147 02320002
         LA    R2,DXDAADDR                  PICK UP PTR TO SAVE AREA.   02400000
*                                                                       02460000
*** THIS SECTION GETS THE TTR OF THE VTOC FROM THE UCB AND CONVERTS     02470021
*   IT TO AN MBBCCHHR. AFTER ENQ'ING ON THE VTOC, IT READS THE          02480021
*   FORMAT 4 DSCB AND DETERMINES IF THERE IS AN UNUSED DSCB IN THE      02490021
*   VTOC (IN CASE ONE IS NEEDED FOR AN ADDITIONAL FORMAT 5 DSCB).       02500021
*                                                                       02524013
         LA    R0,SRTEVOLI             R0 = POINTER TO VOLUME LABELAAAA 02534016
         ST    R0,DXCCW12              SET RNAME POINTER IN ENQ LISAAAA 02574016
         L     R0,SRTEFSCT              LOAD TTR OF F4 CCHHR     Y02080 02580002
         MVC   DXDEBSCC(K4),CCWX2+K4    MOVE BEGINNING CCHH     SA54549 02590002
*                                       INTO DEB                SA54549 02592002
         MVC   DXDEBECC(K6),ECCHHTRK    MOVE ENDING CCHH AND    SA54549 02594002
*                                       NUMBER OF TRACKS INTO   SA54549 02596002
*                                       DEB                     SA54549 02598002
         BAL   RLINK,CCHHCVT            *** CONVERT TTR0 TO MBBCCHHR.   02600000
         TM    UCBTBYT2,UCB2OPT3        TEST FOR RPS DEVICE     SA53147 02602002
         BNO   SKIPRPS                  BRANCH IF NOT RPS       SA53147 02604002
         LA    R3,DXDEB                 PTR TO DEB IN CLOSE     SA53147 02606002
*                                       WORK AREA               SA53147 02608002
         IECRPS RDEB=R3,WKREG1=R6,EXTPR=RXWKA  INITIALIZE FOR    YM3997X02610002
                                        RPS PROCESSING           YM3997 02611002
*                                                                       02612002
         MVC   WTGMODNM,FIRSTLD         RESTORE MODULE NAME      YM5371 02612402
*                                                                       02614002
         TM    DADSMTBL,FROMCR          TEST IF ENTRY FROM C/R   Y02082 02614402
         BO    SKIPRPS                  BRANCH IF C/R            YM6546 02614802
         MODESET EXTKEY=DATAMGT         RETURN TO KEY 5 IF CLOSE YM6546 02615202
*                                                                       02615602
SKIPRPS  EQU   *                                                SA53147 02616002
         MVC   MJNAME,VTOCNAME         INSERT MAJOR Q N AME             02620000
         SR    R1,R1                    ZERO REGISTER            Y02080 02624002
         STH   R1,ENQAREA+K2            CLEAR FOR RESERVE MACRO  Y02080 02628002
         MVI   ENQAREA,255             INDICATE LAST Q AREA             02640000
        RESERVE (MJNAME,,E,6,SYSTEMS),SMC=STEP,MF=(E,ENQAREA),   YM3022X02656002
               UCB=DXDEB+32                                             02664016
*                                                                       02665002
         OI    DSMADTB2,DSMVTOCR+DSMSMCE  SET VTOC ENQ'ED SMC    Y02144 02666002
*                                                                       02667002
         DROP  RXUCB                                             Y02082 02677002
         USING CVT,R15                                                  02680013
         BAL   RLINK,RDDSCBT            *** READ VTOC DSCB              02720000
         LH    R6,DS4DSREC                  GET VTOC HOLE COUNTER.      02740000
         LTR   R6,R6                        IS THERE A HOLE IN VTOC.    02760000
         BP    SETVTOC                      YES-GO TO SAVE VTOC ADDR.   02780000
         LA    ERRETREG,NOROOM          NO, SET ERROR CODE       A37199 02800021
         B     WRITF1                   EXIT TO WRITE           SA54549 02820002
*                                       BACK FORMAT 1           SA54549 02830002
*                                                                       02840000
*** THIS SECTION WRITES BACK THE FORMAT 4 DSCB WITH THE DIRF BIT SET.   02860002
*                                                                       02880002
SETVTOC  EQU   *                                                 O19117 02882019
         MVC   VTOCADR(5),DXDAADDR+3    SAVE VTOC DSCB ADDRESS   O19117 02884019
         XI    DS4VTOCI,DIRFBIT         SET/RESET DIRF BIT       O19117 02886019
         TM    DS4VTOCI,DIRFBIT         TEST RESULTS             O19117 02888019
         BZ    SKPWRT                   BR IF PREVIOUS INTERRUPT O19117 02890019
         MVI   DXCCW6,X'05'             SET UP DATA CMMD         O19117 02892019
         MVI   DXCCW6+4,X'00'           RESET CMMD CHAIN         O19117 02894019
         BAL   RLINK,RDDSCBT            GO WRITE BACK F4         O19117 02896019
*                                                                       02897002
*** THIS SECTION VERIFIES THAT NO OTHER JOB IS OPEN TO THE DATA SET     02898002
*   AND THAT THE CURRENT JOB HAS NO OTHER DCB OPEN TO THE DATA SET.     02899002
*                                                                       02899502
SKPWRT   EQU   *                                                 O19117 02900019
         SR    ERRETREG,ERRETREG        ZERO RETURN CODE REG     Y02082 02901002
         CLI   DSCNOEXT,K0              CHECK NUMBER OF EXTENTS  Y02082 02902002
         BE    WRITF1                   BRANCH IF MODEL DSCB     Y02082 02903002
         L     R15,CVTPTR               LOAD CVT ADDRESS         Y02082 02904002
         L     R15,CVTTCBP              LOAD TCB/ASCB POINTERS   Y02082 02905002
         L     RX2,K4(,R15)             LOAD CURRENT TCB ADDRESS Y02082 02906002
         USING TCB,RX2                  TCB ADDRESSABILITY       Y02082 02907002
         TM    PTYPEFLG,FROMCR          TEST IF ENTRY FROM C/R   Y02082 02908002
         BNO   TIOTENQ                  BRANCH IF FROM CLOSE     Y02082 02909002
*                                                                       02910002
*** FOR ENTRY FROM CHKPT/RESTART, THIS SECTION ISSUES AN EXCLUSIVE      02911002
*   ENQ DIRECTED TO THE INITIATOR'S TCB WITH A MAJOR RESOURCE NAME OF   02912002
*   SYSDSN AND THE DATA SET NAME AS THE MINOR RESOURCE NAME.  IF THE    02913002
*   RETURN CODE INDICATES THAT THE TASK PREVIOUSLY HAD CONTROL OF THE   02914002
*   RESOURCE, THEN THE ENQ IS REISSUED IN A SUCCEEDING SECTION OF CODE. 02915002
*                                                                       02916002
DSNENQ1  EQU   *                        ENQ DSNAME               Y02082 02917002
         LA    RX4,JFCBDSNM             POINT TO DATA SET NAME   Y02082 02918002
         L     R3,TCBJSCB               LOAD JSCB ADDRESS        Y02082 02919002
         USING IEZJSCB,R3               JSCB ADDRESSABILITY      Y02082 02920002
         L     R3,JSCBACT               GET ACTIVE JSCB ADDRESS  YM2887 02920502
         L     R3,JSCBTCBP              INITIATOR'S TCB ADDRESS  Y02082 02921002
         DROP  R3                                                Y02082 02921502
         MVC   MJNAME(L'SYSDSN),SYSDSN  MAJOR RESOURCE NAME      Y02082 02922002
         MVC   ENQAREA(ENQLTH1),ENQLIST1  MOVE IN ENQ PARM LIST  Y02082 02923002
         LA    R5,JFCBDSNM+L'JFCBDSNM-K1  LAST BYTE OF DSNAME    YM2880 02923402
TESTDSN1 EQU   *                        SEARCH FOR NON-BLANK     YM2880 02923802
         CLI   K0(R5),BLANK             IS THIS ONE A BLANK      YM2880 02924202
         BNE   GETLNTH1                 BRANCH IF NO TO COMPUTE  YM2880X02924602
                                        LENGTH OF NAME FOR ENQ   YM2880 02925002
         BCT   R5,TESTDSN1              TRY NEXT BYTE            YM2880 02925402
GETLNTH1 EQU   *                        CALCULATE LENGTH         YM2880 02925802
         LA    R6,JFCBDSNM-K1           BYTE PRECEDING DSNAME    YM2880 02926202
         SR    R5,R6                    R5 HAS LENGTH FOR ENQ    YM2880 02926602
         ENQ   (MJNAME,(RX4),,(R5)),TCB=(R3),RET=USE,            YM2880X02926702
               MF=(E,ENQAREA)           ENQ EXCLUSIVELY ON DSN   YM2880 02926802
*                                                                       02926902
         LTR   R15,R15                  TEST RETURN CODE         Y02082 02927002
         BNZ   ERRTEST                  BRANCH IF NOT SUCCESSFUL Y02082 02928002
*                                                                       02929002
         OI    DSMADTB2,DSMDSNE         SET DSN ENQ'ED SWITCH    Y02082 02930002
         ST    RX4,DSMADTW3             SAVE POINTER TO DSNAME   Y02082 02931002
         B     DEBSRCH                  SEARCH DEB CHAIN         YM8507 02932002
ERRTEST  EQU   *                        ERROR TEST               Y02082 02933002
         CLI   ENQAREA+K3,RTNCODE8      TEST IF TASK ALREADY     Y02082 02934002
*                                       ENQ'ED ON SYSDSN         Y02082 02935002
         BE    DSNENQ2                  BRANCH IF YES            Y02082 02936002
OPENERR  EQU   *                        OPEN DATA SET ERROR      Y02082 02937002
         LA    ERRETREG,OPENDS          OPEN DATA SET ERROR      Y02082 02938002
         B     WRITF1                   GO REWRITE THE F1 DSCB   Y02082 02939002
*                                                                       02940002
*** FOR ENTRY FROM CLOSE, THIS SECTION ISSUES AN ENQ RET=CHNG WITH A    02941002
*   MAJOR NAME OF SYSZTIOT AND A MINOR NAME COMPOSED OF THE ASID/DSAB   02942002
*   QDB ADDRESS.  IT THEN READS THE KEY OF THE FORMAT 1 DSCB, SINCE     02943002
*   JFCBDSNM MAY NOT CONTAIN THE DATA SET NAME.                         02944002
*                                                                       02945002
TIOTENQ  EQU   *                        ENQ TIOT                 Y02082 02946002
         L     RX1,K12(,R15)            LOAD CURRENT ASCB ADDR   Y02082 02947002
         USING ASCB,RX1                 ASCB ADDRESSABILITY      Y02082 02948002
         MVC   MINAME(L'ASCBASID),ASCBASID  ASID TO MINOR NAME   Y02082 02949002
         DROP  RX1                                               Y02082 02950002
         L     RX1,TCBJSCB              LOAD JSCB ADDRESS        Y02082 02951002
         USING IEZJSCB,RX1              JSCB ADDRESSABILITY      Y02082 02952002
         L     RX1,JSCBACT              ACTIVE JSCB ADDRESS      Y02082 02953002
         MVC   MINAME+K2(L'JSCDSABQ),JSCDSABQ  DSAB QDB ADDRESS  Y02082 02954002
         DROP  RX1                                               Y02082 02955002
         MVC   MJNAME(L'SYSZTIOT),SYSZTIOT  MAJOR RESOURCE NAME  Y02082 02956002
         MVC   ENQAREA(ENQLTH),ENQLIST  MOVE IN ENQ PARM LIST    Y02082 02957002
         ENQ   (MJNAME,MINAME),MF=(E,ENQAREA),RET=CHNG           Y02082X02958002
                                        ENQ EXCLUSIVELY ON TIOT  Y02082 02959002
*                                                                       02960002
         LTR   R15,R15                  TEST RETURN CODE         Y02082 02961002
         BNZ   OPENERR                  BRANCH IF NOT SUCCESSFUL Y02082 02962002
         L     RX1,DCBDEBAD             LOAD DEB ADDRESS         Y02082 02963002
         LA    RX1,K0(RX1)              CLEAR HIGH-ORDER BYTE    Y02082 02964002
         SH    RX1,SIXTEEN              GET DEB PREFIX ADDRESS   Y02082 02965002
         MVC   DXDAADDR+K3(K5),K3(RX1)  MOVE IN FORMAT 1 CCHHR   Y02082 02966002
         LA    R0,DXCCW1                                         Y02082 02967002
         ST    R0,IOBSIOCC              MODIFY CCW PTR IN IOB    Y02082 02968002
         BAL   RLINK,RDDSCBT            GO READ F1 KEY AND DATA  Y02082 02969002
         LA    R5,DS1DSNAM+L'DS1DSNAM-K1  LAST BYTE OF DSNAME    YM2880 02969402
TESTDSN2 EQU   *                        SEARCH FOR NON-BLANK     YM2880 02969802
         CLI   K0(R5),BLANK             IS THIS ONE A BLANK      YM2880 02970202
         BNE   GETLNTH2                 BRANCH IF NO TO COMPUTE  YM2880X02970602
                                        LENGTH OF NAME FOR ENQ   YM2880 02971002
         BCT   R5,TESTDSN2              TRY NEXT BYTE            YM2880 02971402
GETLNTH2 EQU   *                        CALCULATE LENGTH         YM2880 02971802
         LA    R6,DS1DSNAM-K1           BYTE PRECEDING DSNAME    YM2880 02971902
         SR    R5,R6                    R5 HAS LENGTH FOR ENQ    YM2880 02972202
         LA    RX4,DS1DSNAM             POINT TO DATA SET NAME   Y02082 02972602
         L     R3,TCBJSCB               LOAD JSCB ADDRESS        Y02082 02972702
         USING IEZJSCB,R3               JSCB ADDRESSABILITY      Y02082 02973002
         L     R3,JSCBACT               GET ACTIVE JSCB ADDRESS  YM2887 02973402
         L     R3,JSCBTCBP              INITIATOR'S TCB ADDRESS  Y02082 02974002
         DROP  R3                                                Y02082 02975002
*                                                                       02976002
*** THIS SECTION ISSUES AN ENQ RET=CHNG ON SYSDSN.  REGISTER 4 POINTS   02977002
*   TO THE DSN, AND REGISTER 3 CONTAINS THE INITIATOR'S TCB ADDRESS.    02978002
*                                                                       02979002
DSNENQ2  EQU   *                        ENQ EXCLUSIVELY ON DSN   Y02082 02980002
         MVC   MJNAME(L'SYSDSN),SYSDSN  MAJOR RESOURCE NAME      Y02082 02981002
         MVC   ENQAREA(ENQLTH2),ENQLIST2  MOVE IN ENQ PARM LIST  Y02082 02982002
         ENQ   (MJNAME,(RX4),,(R5)),TCB=(R3),RET=CHNG,           YM2880X02983002
               MF=(E,ENQAREA)           ENQ EXCLUSIVELY ON DSN   YM2880 02984002
*                                                                       02985002
         LTR   R15,R15                  TEST RETURN CODE         Y02082 02986002
         BNZ   OPENERR                  BRANCH IF NOT SUCCESSFUL Y02082 02987002
*                                       SEARCH THE DEBS IF C/R   Y02082 02990002
*                                                                       02991002
*** THIS SECTION SEARCHES THE JOB'S DEBS TO ENSURE THAT THE CURRENT     02992002
*   JOB HAS NO OTHER DCB OPEN TO THE DATA SET.                          02993002
*                                                                       02993102
*        IF CALLED FROM CLOSE, WE WILL INSPECT EACH DEB IN       YM8507 02993202
*        THE JOB STEP'S DEB TABLE.                               YM8507 02993402
*        IF CALLED FROM EITHER CLOSE OR RESTART THE DEB CHAIN    YM8507 02993602
*        WILL BE SEARCHED (TCB DEB CHAIN FOR CLOSE, RESTART'S    YM8507 02993802
*        DEB CHAIN IF RESTART).                                  YM8507 02994002
*                                                                       02994202
DEBSRCH  EQU   *                        SEARCH DEBS              Y02082 02995002
         MODESET EXTKEY=ZERO            SWITCH TO KEY ZERO       Y02082 02995502
*                                                                       02998502
         STM   RXWKA,RLINK,IECREGSV+K12  SAVE SETLOCK REGISTERS  Y02082 02999002
         LR    R3,RXWKA                 SAVE WORK AREA BASE      YM8507 03000002
GETLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,  PREVENT DEBCHK  Y02082*03001002
               RELATED=(DEBTBL,IGG020P1(FREELOCK))               Y02082 03002002
         LM    RXWKA,RLINK,IECREGSV+K12-PRLSEWKA(R3)  RESTORE    YM8507 03003002
*                                                                       03003202
         TM    PTYPEFLG,FROMCR          TEST FOR RESTART         YM8507 03003402
         BZ    DTBLSRCH                 BR IF NO-SEARCH DEBTABLE YM8507 03003602
         L     R15,SVRBPTR              GET SVRB ADDRESS         YM8507 03003802
         L     R15,SVRBEXSA+(R7-R2)*K4(R15) GET RESTART'S R7     YM8507 03004002
         USING RSTWA,R15                RESTART WORKAREA         YM8507 03004202
         LA    R1,RSINT-K4              ADDR-4 OF FIRST DEB      YM8507 03004402
         DROP  R15                                               YM8507 03004602
         OI    PTYPEFLG,DCHNSRCH        SET CHAIN SEARCH ACTIVE  YM8507 03004802
         B     DEBCHAIN                 SEARCH CHAIN             YM8507 03005002
DTBLSRCH EQU   *                        SEARCH DEB TABLE         YM8507 03005202
         L     R1,TCBJSCB               LOAD JSCB ADDRESS        YM8507 03005402
         USING IEZJSCB,R1               JSCB ADDRESSABILITY      YM8507 03005602
         L     R1,JSCBDBTB              ADDR OF DEB TABLE        YM8507 03005802
         LTR   R1,R1                    IS ADDR ZERO             Y02082 03006002
         BZ    NOPENDS                  BRANCH IF YES            Y02082 03007002
         LH    R2,K0(,R1)               LAST ENTRY OFFSET        Y02082 03008002
         AR    R2,R1                    ADDRESS OF LAST ENTRY    Y02082 03009002
NXTDEB   EQU   *                        NEXT DEB                 Y02082 03010002
         TM    PTYPEFLG,DCHNSRCH        IS CHAIN SEARCH ACTIVE   YM8507 03010202
         BZ    NXTABLE                  BRANCH IF NO             YM8507 03010402
DEBCHAIN EQU   *                        NEXT DEB IN CHAIN        YM8507 03010602
         USING DEBBASIC,R3                                       YM8507 03010702
         ICM   R3,B'0111',DEBDEBAD-DEBBASIC+K1(R1) GET NEXT DEB  YM8507 03010802
         BZ    NOPENDS2                 NO MORE DEBS             YM8507 03010902
         LR    R1,R3                    SAVE DEB ADDRESS         YM8507 03011002
         TM    PTYPEFLG,FROMCR          TEST TO SEE IF, IN FACT, YM8507 03011202
*                                       RESTART CALLED US        YM8507 03011302
         BO    CRDCBDEB                 CHECK FOR CURRENT DEB    YM8507 03011402
         L     RXUSRDCB,DCBSAVE         COPIED DCB FROM CLOSE    YM8507 03011602
         CLM   R3,B'0111',DCBDEBAD+K1   CURRENT DEB              YM8507 03011802
         BE    DEBCHAIN                 BR IF YES-GET NEXT DEB   YM8507 03012002
         B     CHKDEB                   BR IF NO-CHECK DEB       YM8507 03012202
CRDCBDEB EQU   *                        RESTART DCB IS USER'S    YM8507 03012402
         CLC   DEBDCBAD+K1(K3),DCBSAVE+K1 CURRENT DEB            YM8507 03012602
         BE    DEBCHAIN                 BR IF YES-GET NEXT DEB   YM8507 03012802
         B     CHKDEB                   CHECK THE DEB            YM8507 03013002
NXTABLE  EQU   *                        NEXT DEB IN TABLE        YM8507 03013202
         LA    R1,K4(,R1)               POINT TO NEXT ENTRY      YM8507 03013402
         CR    R1,R2                    END OF DEB TABLE         YM8507 03013602
         BE    NOPENDS                  BRANCH IF YES            YM8507 03013802
         OC    K0(K4,R1),K0(R1)         EMPTY ENTRY              Y02082 03014002
         BZ    NOPENDS                  BRANCH IF YES            Y02082 03015002
         TM    K3(R1),ALLBITS           DELETED ENTRY            Y02082 03016002
         BO    NXTDEB                   BRANCH IF YES            Y02082 03017002
*                                       R1 POINTS TO A FULLWORD  Y02082 03018002
*                                       CONTAINING A DEB POINTER Y02082 03019002
         L     R3,K0(,R1)               LOAD DEB ADDRESS         Y02082 03020002
CHKDEB   EQU   *                        CHECK THE DEB            YM8507 03021202
         LA    R4,DEBBASIC-DEBAMTYP     OFFSET BACK TO DEBAMTYP  Y02082 03022002
         LCR   R4,R4                    MAKE OFFSET NEGATIVE     Y02082 03023002
         AR    R4,R3                    R4 POINTS TO DEBAMTYP    Y02082 03024002
         USING DEBAMTYP,R4                                       Y02082 03025002
         CLI   DEBAMTYP,K0              AMTYP ABSENT             Y02082 03026002
         BE    AMVALID                  BRANCH IF YES--VALID     Y02082 03027002
         CLC   DEBAMTYP,AMBPAM          BPAM DEB                 Y02082 03028002
         BE    AMVALID                  BRANCH IF YES--VALID     Y02082 03029002
         CLC   DEBAMTYP,AMBDAM          BDAM DEB                 Y02082 03030002
         BE    AMVALID                  BRANCH IF YES            Y02082 03031002
         CLC   DEBAMTYP,AMSAM           SAM DEB                  Y02082 03032002
         BE    AMVALID                  BRANCH IF YES            Y02082 03033002
         CLC   DEBAMTYP,AMEXCP          EXCP DEB                 Y02082 03034002
         BE    AMVALID                  BRANCH IF YES            Y02082 03035002
         CLC   DEBAMTYP,AMISAM          ISAM DEB                 Y02082 03036002
         BNE   NXTDEB                   BRANCH IF NO-THIS DEB    Y02082 03037002
*                                       NEED NOT BE CHECKED      Y02082 03038002
         CLI   DEBNMEXT,K1              0 OR ONE EXTENT IN ISAM  Y02082 03039002
*                                       DEB                      Y02082 03040002
         BNH   NXTDEB                   INVALID ISAM DEB         Y02082 03041002
         DROP  R4                                                Y02082 03042002
         SR    R4,R4                    ZERO FOR IC              Y02082 03043002
         IC    R4,DEBNMEXT              INSERT NUMBER OF EXTENTS Y02082 03044002
         BCTR  R4,K0                    REDUCE BY ONE            Y02082 03045002
         LA    R3,DEBNMTRK-DEBUCBAD+L'DEBNMTRK(,R3)  SKIP FIRST  Y02082 03046002
*                                       EXTENT FOR ISAM          Y02082 03047002
         B     CHKEXTNT                 GO TO CHECK EACH EXTENT  Y02082 03048002
AMVALID  EQU   *                        VALID AM TYPE            Y02082 03049002
         CLI   DEBNMEXT,K0              ARE THERE ANY EXTENTS    Y02082 03050002
         BZ    NXTDEB                   BRANCH IF NO             Y02082 03051002
         CLI   DEBEXSCL,DEBDADEV        IS EXTENT SCALE 4 FOR DA Y02082 03052002
         BNE   NXTDEB                   BRANCH IF NO             Y02082 03053002
         L     R4,DEBSUCBA              GET UCB ADDRESS          Y02082 03054002
         USING UCBOB,R4                                          Y02082 03055002
         LA    R4,K0(,R4)               CLEAR HIGH BYTE          Y02082 03056002
         LTR   R4,R4                    IS THERE A UCB           Y02082 03057002
         BZ    NXTDEB                   BRANCH IF NO             Y02082 03058002
         TM    UCBTBYT3,UCB3DACC        IS IT DIRECT ACCESS      Y02082 03059002
         BZ    NXTDEB                   BRANCH IF NO             Y02082 03060002
         DROP  R4                                                Y02082 03061002
         SR    R4,R4                    ZERO FOR IC              Y02082 03062002
         IC    R4,DEBNMEXT              NUMBER OF EXTENTS        Y02082 03063002
CHKEXTNT EQU   *                        CHECK EXTENT             Y02082 03064002
         LA    R3,DEBBASND              INCREMENT PAST BASIC     Y02082 03065002
*                                       SECTION OF DEB           Y02082 03066002
         USING DEBDASD,R3                                        Y02082 03067002
CMPREXTS EQU   *                        CHECK CCHH               Y02082 03068002
         CLC   DEBUCBA,DXDEBUCB+K1      TEST IF SAME UCB         YM4653 03068402
         BNE   NEXTXTNT                 BRANCH IF NOT            YM4653 03068802
         CLI   DSCEXTYP,DS1EXTUL        IS FIRST EXTENT USER LBL Y02082 03069002
         BNE   NOTUL                    BRANCH IF NOT            Y02082 03070002
         CLC   DEBSTRCC(L'DEBSTRCC+L'DEBSTRHH),DSCEXT1+K2  IS    YM5709X03071002
                                        THE DEB'S STARTING CCHH  YM5709X03072002
                                        EQUAL TO THE DSCB'S      YM5709 03073002
         BE    NOPRLSE                  BRANCH IF YES            Y02082 03074002
         B     NEXTXTNT                 GET NEXT EXTENT          Y02082 03075002
NOTUL    EQU   *                        NOT USER LBL EXTENT      Y02082 03076002
         CLC   DEBSTRCC(L'DEBSTRCC+L'DEBSTRHH),DSCLOWLM  IS      YM5709X03077002
                                        THE DEB'S STARTING CCHH  YM5709X03078002
                                        EQUAL TO THE DSCB'S      YM5709 03079002
         BE    NOPRLSE                  BRANCH IF YES            Y02082 03080002
NEXTXTNT EQU   *                        NEXT EXTENT              Y02082 03081002
         LA    R3,DEBNMTRK+L'DEBNMTRK   INCREMENT TO NEXT EXTENT YM4653 03082002
         BCT   R4,CMPREXTS              TRY NEXT EXTENT          Y02082 03083002
         B     NXTDEB                   NO MORE EXTENTS          Y02082 03084002
NOPRLSE  EQU   *                        OPEN DATA SET ERROR      Y02082 03085002
         LA    R3,OPENERR               SET UP BRANCH ADDRESS AS Y02082 03086002
*                                       THE DATA SET IS OPEN AND Y02082 03087002
*                                       CANNOT BE RELEASED       Y02082 03088002
         B     FREELOCK                 FREE THE LOCAL LOCK      Y02082 03089002
NOPENDS  EQU   *                        GET BRANCH ADDR          Y02082 03090002
         TM    PTYPEFLG,DCHNSRCH        DEB CHAIN SEARCH ACTIVE  YM8507 03090202
         BO    NOPENDS2                 BR IF YES-SEARCHING DONE YM8507 03090402
         L     R3,CVTPTR                CVT ADDR                 YM8507 03090602
         L     R3,CVTTCBP-CVT(,R3)      TCB POINTERS             YM8507 03090802
         L     R3,K4(,R3)               TCB ADDRESS              YM8507 03091002
         LA    R1,TCBDEB-TCB-K4(,R3)    ADDRESS-4 OF FIRST DEB   YM8507 03091202
         OI    PTYPEFLG,DCHNSRCH        SET CHAIN SEARCH ACTIVE  YM8507 03091402
         B     DEBCHAIN                 START DEB CHAIN SEARCH   YM8507 03091602
NOPENDS2 EQU   *                        ABSOLUTELY NO OPEN D.S.  YM8507 03091802
         LA    R3,GETFDAD               SET UP BRANCH ADDRESS    YM8507 03092002
*                                                                       03092202
FREELOCK EQU   *                        RELEASE LOCAL LOCK       YM8507 03092402
         NI    PTYPEFLG,ALLBITS-DCHNSRCH CHAIN SEARCH INACTIVE   YM8507 03092602
         LR    R1,RXWKA                 SAVE WORK AREA BASE      Y02082 03093002
         STM   RXWKA,RLINK,IECREGSV+K12  SAVE SETLOCK REGISTERS  Y02082 03094002
         SETLOCK RELEASE,TYPE=LOCAL,    RELEASE LOCAL LOCK       Y02082*03095002
               RELATED=(DEBTBL,IGG020P1(GETLOCK))                Y02082 03096002
         LM    RXWKA,RLINK,IECREGSV+K12-PRLSEWKA(R1)  RESTORE    Y02082 03098002
         TM    PTYPEFLG,FROMCR          TEST IF ENTRY FROM C/R   YM8507 03098102
         BOR   R3                       BRANCH IF C/R-STAY KEY 0 YM8507 03098202
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY    Y02082 03098502
         BR    R3                       RETURN                   Y02082 03099002
*                                                                       03099502
GETFDAD  MVC   MBBCCHHR+K3(K4),DCBFDAD+K3  INSERT NEW CCHH       Y02082 03100002
         MVC   USEXTNUM,DCBFDAD         SAVE M OF USER'S DCBFDAD Y02082 03101002
         LA    R6,ENTRIES                                        Y02082 03102002
         SR    R5,R5                    CLEAR COUNT REGISTER     Y02082 03103002
         TM    JFCBCTRI,JFCBCYL         TEST IF A CYLINDER REQ   Y02082 03104002
         BO    ROUNDCYL                 BRANCH IF A CYL REQUEST  Y02082 03105002
         TM    JFCBCTRI,JFCBAVR+JFCROUND  TEST IF A ROUNDED      Y02082 03106002
*                                       RECORD REQUEST           Y02082 03106502
         BNO   SAVEFMT3                 BRANCH IF NOT            Y02082 03107002
*                                                                       03108002
*** THIS SECTION CHECKS TO SEE IF THE LAST TRACK WRITTEN WAS CYLINDER   03109002
*   ALIGNED. IF NOT, IT ROUNDS THE EXTENT TO BE RELEASED TO THE         03110021
*   NEXT CYLINDER.                                                      03120021
*                                                                       03140000
ROUNDCYL LA    R4,1                         YES-SET CONVERSION COUNT.   03160000
         MVC   HOLD(4),DCBFDAD+3            GET LAST ACTIVE TRACK.      03180000
         BAL   RLINK,RTACVT             *** CONVERT CCHH TO RTA         03200000
         LH    R9,ENTRIES                   PICK UP LAST ACTIVE TRK RTA 03220000
         SR    R8,R8                        CLEAR REG FOR DIVISION.     03240000
         LH    R0,DS4DEVSZ+2                PICK UP NO OF TRKS/CYL.     03260000
         DR    R8,R0                        DETERMINE CYL ALIGNMENT     03280000
         BCTR  R0,0                         SET R0 TO LAST TRACK OF CYL 03300000
         CLR   R0,R8                        IS REMAINDER EQ TO LAST TRK 03320000
         BE    SAVEFMT3                     YES-EXTENT IS CYL ALIGNED.  03340000
         OI    DADSMTBL,X'01'               TURN ON ROUND BIT.          03360000
         MH    R9,DS4DEVSZ+2                CONVERT CYL'S TO TRKS.      03380000
         AR    R0,R9                        ROUND RTA TO CYL ALGNMENT   03400000
         SLL   R0,16                        POSITION TT00.              03420000
         LA    R2,MBBCCHHR                  GET POINTER TO SAVE AREA.   03440000
*                                                                       03460000
*** THIS SECTION DETERMINES WHETHER THE EXTENT THAT CONTAINS THE        03480021
*   LAST TRACK WRITTEN IS LOCATED IN THE FORMAT 1 OR FORMAT 3 DSCB.     03500021
*                                                                       03520000
         BAL   RLINK,CCHHCVT                CONVERT ROUNDED EXT TO CCHH 03540000
SAVEFMT3 MVC   DXDAADDR+3(5),DSCNEXT        SAVE                        03560000
         MVC   OUTCCHHR(5),DSCNEXT           CHAIN ADDRESS              03580000
         LA    R6,ENTRIES                   RESTORE DADSMTBL PTR.       03600000
         L     R9,DCBSAVE               RESTORE USER'S DCB PTR   A39292 03610021
         CLI   DSCEXTYP,X'40'           TEST FOR USER LABEL.            03625013
         BNE   NOLABEL                  BR-IF NO USER LABEL EXTENT.     03630013
         IC    R8,USEXTNUM              GET M OF DCBFDAD         Y02080 03635002
         LA    R8,1(R8)                 ACCOUNT FOR USER LABEL EXTENT.  03640013
         STC   R8,USEXTNUM              SAVE UPDATED M           Y02080 03645002
NOLABEL  EQU   *                                                        03650013
         CLI   USEXTNUM,K2              IS EXTENT IN F1 OR F3    Y02080 03655002
         BNH   F1RUTINE                     ENTRY IS IN F1-PROCESS IT.  03660000
         CLI   DSCNEXT+4,X'00'              OTHERWISE TEST FOR F3.      03680000
         BNE   OUT                      GO READ F3 IF PRESENT   SA54549 03700002
F1EXNOER EQU   *                                                 O19117 03708019
         LA    ERRETREG,NOTINF1         SET ERROR CODE           A37199 03718021
WRITF1   EQU   *                                                SA54549 03728002
         LA    R3,D0                    PREPARE TO XCTL TO      SA54549 03730002
*                                       IGG020D0 TO WRITE       SA54549 03730402
*                                       BACK FORMAT 1           SA54549 03730802
         B     XCTL                                             SA54549 03731202
*                                                                       03760000
***  THIS LOCATES THE PROPER EXTENT IN THE FORMAT 1 DSCB CONTAINING THE 03780000
*    LAST TRACK WRITTEN,AND THEN TESTS FOR CYLINDER TYPE ALLOCATION.    03800000
*                                                                       03820000
F1RUTINE XC    DSCNEXT(5),DSCNEXT           CLEAR CHAIN ADDR OF F1.     03840000
         MVI   INCCHHR+4,X'FF'              INDICATE EXTENT IS IN F1.   03860000
         LA    R7,DSCEXTYP                                              03880000
         LA    R8,DSCEXT2+10                SET UP END OF EXTNTS PTR.   03900000
         SR    R3,R3                        CLEAR REGISTER.             03920000
         IC    R3,USEXTNUM              GET M OF DCBFDAD         Y02080 03940002
         MH    R3,TEN                                                   03960000
         AR    R7,R3                        LOCATE PROPER EXT IN F1.    03980000
         TM    JFCBCTRI,X'C0'           WAS THIS A CYLINDER       17305 03990016
*                                       REQUEST                   17305 04000016
         BO    CYLREQ                       BRANCH IF CYLINDER.         04020000
         TM    JFCBCTRI,X'41'           WAS ROUNDED RECORD        17305 04030016
*                                       REQUESTED                 17305 04040016
         BO    CYLREQ                       BR-IF REC ROUNDED REQ.      04060000
         MVI   0(R7),X'01'                  NO-TURN OFF CYL ALGNMNT BIT 04080000
CYLREQ   CLC   6(4,R7),MBBCCHHR+3           CHECK FOR LAST TRK OF EXT.  04100000
UPDATE   LA    R7,10(R7)      UPDATE SCAN REG TO NEXT EXTENT     A25991 04120019
         BE    CHECKLST                     CHECK FOR LAST TRK IF LAST  04140000
         SH    R7,TEN                       DECREMENT SCAN REG IF NOT   04160000
*                                           LAST TRACK OF EXTENT.       04180000
         CLC   MBBCCHHR+3(4),2(R7)      IS CCHH IN THIS EXTENT.   17305 04190016
         BL    F1EXNOER                 BR TO ERROR IF NOT.             04200013
         MVC   HOLD+4(4),6(R7)              SAVE PREVIOUS CCHH.         04320000
         EX    0,CYLREQ        CCHH WITHIN EXTENT                 18924 04323000
         BH    WITHIN          YES,CONTINUE                       18924 04326000
         EX    0,GETFDAD  FALL BACK TO LAST TRK ACT USED          18924 04329000
         EX    0,CYLREQ       IS CCHH OF LAST TRK WITHIN EXTENT  A25991 04330019
         BL    F1EXNOER       NO, IT IS BEYOND END-OF-EXTENT     A25991 04331019
         B     UPDATE         BRANCH TO TRY AGAIN                A25991 04333019
*                                                                       04333321
*** THIS SECTION SETS UP THE CCHH PARAMETERS TO BE CONVERTED TO         04333621
*   STARTING RTA AND ENDING RTA+1. IT THEN PLACES THESE RTA'S IN        04333921
*   THE EXTENT TABLE.                                                   04334221
*                                                                       04334521
WITHIN   EQU   *                                                  18924 04335000
         MVC   6(4,R7),MBBCCHHR+3           INSERT NEW CCHH.            04340000
         MVC   HOLD(4),MBBCCHHR+3           SAVE NEW CCHH OF EXT USED.  04360000
         BAL   RLINK,CVTORTA                CONVERT RELSED CCHH TO RTA. 04380000
         LH    R9,ENTRIES                                               04400000
         LA    R9,1(R9)                     INCREMENT FIRST ENTRY       04420000
         STH   R9,ENTRIES                   FOR AVAIL INDICATION.       04440000
         L     R9,DCBSAVE               RESTORE USER'S DCB PTR   A39292 04460021
CHECKLST CLR   R7,R8                        IS THIS THE LAST EXTENT     04480000
         BE    OUT                      YES - GO TO NEXT LOAD   SA54549 04500002
*                                       OF PARTIAL RELEASE      SA54549 04510002
         CLI   0(R7),0                      NO-IS THIS EXTNT ZERO       04520000
         BE    OUT                          YES-XCTL TO NEXT LOAD       04540000
         MVC   HOLD(8),2(R7)                GET EXT FOR DADSM UPDATE.   04560000
         XC    0(10,R7),0(R7)               CLEAR F1 RELEASED EXTENT.   04580000
         BAL   RLINK,CVTORTA                CONVERT EXTEXT TO RTA FOR   04600000
         B     CHECKLST                     CHECK FOR LAST EXTENT.      04620000
*                                                                       04860019
* * THIS SECTION BRANCHES TO ANOTHER LOAD OF PARTIAL RELEASE.           04880002
*                                                                       04900019
OUT      EQU   *                                                 O19117 04920019
         LA    R3,NEXTXCTL              FETCH NEXT LOAD PNTR     O19117 04940019
XCTL     EQU   *                                                 O19117 04960019
         IECRES LOAD,EXTPR=(RXWKA),MODNM=(R3),BRANCH=DIRECT      Y02080 05000002
*                                                                       05100000
*** THIS SECTION SETS UP LINKAGE TO THE CVT ROUTINE.                    05120000
*                                                                       05140000
CCHHCVT  L     R15,CVTPTR                                               05160000
         USING CVT,R15                                           YM8507 05162002
         L     R15,CVTPCNVT                 SET UP BASE AND ENTRY-CVT   05180000
         LA    R4,1                         INSERT LOOP COUNT.          05200000
         LA    R6,ENTRIES                   PICK UP DADSM TABLE PTR.    05220000
         B     CCHHLINK                     GO TO CONVERT RTA TO CCHH.  05240000
CVTORTA  LA    R4,2                         INSERT COUNT                05260000
RTACVT   L     R15,CVTPTR                                               05280000
         L     R15,CVTPRLTV                 SET UP BASE  FOR CVT ROUT.  05300000
         MVC   MBBCCHHR+3(4),HOLD           MOVE CCHH TO BE CONVERTED.  05320000
         LA    R2,MBBCCHHR                  POINT TO CCHH AREA.         05340000
CCHHLINK EQU   *                                                 A39292 05350021
         STM   R9,R15,SAVEREGS          SAVE REGISTERS           A39292 05360021
         NI    CONVCON+1,X'00'         ZERO RTA INCREMENT               05380000
         LR    R3,RXWKA                 SAVE WORKAREA REGISTER   A39292 05400021
         LA    R1,DXDEB                     PICK UP DEB PTR.            05420000
CVTLINK1 BALR  RLINK,R15                    CONVERT CCHH TO RTA.        05440000
         LM    RXWKA,RXBASE,8+SAVEREGS-FIRST(R3)  RESTORE RLSE   A39292 05460021
*                                       WORKAREA AND BASE REGS   A39292 05480021
         SRL   R0,16                                                    05500000
         AH    R0,CONVCON                                               05520000
         STH   R0,0(R6)                     STORE RTA INTO DADSNTBL.    05540000
         LA    R6,2(R6)                     INCREMENT DADSMTBL PTR.     05560000
         XI    CONVCON+1,1                  FLIPFLOP RTA INCREMENT.     05580000
         BCT   R4,FLIPFLOP                  CONTINUE IF COUNT NOT ZERO. 05600000
         LM    R9,R15,SAVEREGS-FIRST(R3)  RESTORE VOLATILE REGS  A39292 05620021
         BR    RLINK                        RETURN.                     05640000
FLIPFLOP EQU   *                                                        05660000
         MVC   MBBCCHHR+3(4),HOLD+4         PICK UP NEXT EXTENT.        05680000
         LA    R5,1(R5)                     INCREMENT ENTRY NO IN TBL.  05700000
         LA    R7,10(R7)                    UPDATE F1 EXTENT PTR.       05720000
         L     R15,24+SAVEREGS-FIRST(R3)  RESTORE CVT POINTER    A39292 05740021
         B     CVTLINK1                     LOOP TO CONVERT NEXT EXTNT  05760000
*                                                                       06040000
*** THIS LOCATES THE SUPERVISOR REQUEST BLOCK OF WHICH ITS EXTENSION    06060000
*   IS USED AS A REGISTER SAVE AREA.                                    06080000
*                                                                       06100000
FINDSVRB L     R15,CVTPTR                   PICK UP CVT POINTER.        06120000
         L     R15,CVTTCBP                  GET POINTER TO TCB ADDR.    06140000
         L     R15,4(R15)                   GET POINTER TO CURRENT TCB. 06160000
         L     R15,0(R15)                   PICK UP SVRB ADDR.          06180000
         ST    R15,SVRBPTR                  SAVE POINTER TO SVRB.       06200000
         BR    RLINK                        SAVE VOL REGS IN SVRB.      06220000
*                                                                       06240000
*** THIS SECTION INITIATES THE CHANNEL PROGRAM.                         06260000
*                                                                       06280000
RDDSCBT  EQU   *                                                SA53147 06300002
         EXCP  DXIOB                        READ DSCB                   06340000
         WAIT  ECB=DXECB                    WAIT FOR COMPLETION.        06360000
         TM    DXECB,X'20'                  TEST FOR PERM I/O ERR.      06380000
         BCR   5,RLINK                      RETURN IF NO I/O ERR.       06400000
         LA    ERRETREG,IOERROR         LOAD I/O ERROR CODE      A37199 06410021
LEAVE    EQU   *                                                SA54549 06420002
         LA    R3,PRECLOSE              PREP FOR LAST LOAD      SA54549 06422002
         B     XCTL                                             SA54549 06424002
*                                                                       06430021
*** CHANNEL PROGRAM                                                     06440021
*                                                                       06450021
         DS    0F                                                       06460000
CCWX1    DC    X'31'                                                    06480000
         DC    AL3(DXDAADDR+3-CLOSEWKA)                                 06500000
         DC    X'4000'                                                  06520000
         DC    H'5'                                                     06540000
CCWX2    DC    X'08'                                                    06560000
         DC    AL3(DXCCW1-CLOSEWKA)                                     06580000
         DC    F'0'                                                     06600000
CCWX3    DC    X'0E'                    READ F1 KEY AND DATA     Y02082 06620002
         DC    AL3(OUTDSCB-PRLSEWKA)    DATA ADDR                Y02080 06640002
         DC    H'0'                     NO COMMAND CHAINING      Y02082 06660002
         DC    H'140'                                                   06680000
*CCWX4                                      SAME AS CCWX1.              06700000
*CCWX5                                      TIC TO CCW4                 06720000
CCWX6    DC    X'06'                    READ DATA COMMAND       SA53147 06740002
         DC    AL3(IECSDSL4-PRLSEWKA)   ADDR OF READ AREA        Y02080 06760002
         DC    X'4000'                  COMMAND CHAINING        SA53147 06764002
         DC    H'96'                    LENGTH OF 96 BYTES      SA53147 06768002
CCWX7    DC    X'92'                        READ COUNT FOR F5 DSCB.     06780000
         DC    AL3(DADSMADR-PRLSEWKA)   ADDRESS OF F5 CCHHR      Y02080 06800002
         DC    X'2000'                                                  06820000
         DC    H'5'                                                     06840000
*                                                                       06845021
*** CONSTANTS                                                           06850021
*                                                                       06855021
TEN      DC    H'10'                                                    06860000
SIXTEEN  DC    H'16'                    SIXTEEN BYTES            Y02082 06865002
ECCHHTRK DC    4X'FF'                   ENDING CCHH MOVED INTO  SA54549 06870002
*                                       DEB ALONG WITH NEXT TWO SA54549 06872002
*                                       CONSTANTS               SA54549 06874002
         DC    X'7F'                    1ST BYTE OF TRACKS TO   SA54549 06876002
*                                       BE MOVED INTO DEB       SA54549 06878002
ENABLE   DC    X'FF'                    ENABLE INTERRUPTS PLUS  SA54549 06880002
*                                       USED AS LAST BYTE OF    SA54549 06890002
*                                       TRACKS MOVED INTO DEB   SA54549 06892002
SYSZTIOT DC    CL8'SYSZTIOT'            TIOT MAJOR RESOURCE NAME Y02082 06894002
SYSDSN   DC    CL8'SYSDSN'              DSN MAJOR RESOURCE NAME  Y02082 06896002
VTOCNAME DC    CL8'SYSVTOC '                                            06900000
ENQLIST  ENQ   (,,E,6,SYSTEM),RET=CHNG,MF=L  TIOT ENQ PARM LIST  Y02082 06902002
ENQLTH   EQU   *-ENQLIST                LENGTH OF ENQ PARM LIST  Y02082 06904002
ENQLIST1 ENQ   (,,E,,SYSTEM),RET=USE,MF=L  FIRST DSN ENQ LIST    YM2880 06906002
ENQLTH1  EQU   *-ENQLIST1               LENGTH OF ENQ PARM LIST  Y02082 06908002
ENQLIST2 ENQ   (,,E,,SYSTEM),RET=CHNG,MF=L  2ND DSN ENQ LIST     YM2880 06910002
ENQLTH2  EQU   *-ENQLIST2               LENGTH OF ENQ PARM LIST  Y02082 06912002
*                                                                       06920002
*        DEB ACCESS METHOD TYPE VALUES                                  06922002
*                                                                       06924002
AMBPAM   DEBCHK AM=BPAM,MF=L            BPAM AMTYPE              Y02082 06926002
AMBDAM   DEBCHK AM=BDAM,MF=L            BDAM AMTYPE              Y02082 06928002
AMSAM    DEBCHK AM=SAM,MF=L             SAM AMTYPE               Y02082 06930002
AMEXCP   DEBCHK AM=EXCP,MF=L            EXCP AMTYPE              Y02082 06932002
AMISAM   DEBCHK AM=ISAM,MF=L            ISAM AMTYPE              Y02082 06934002
*                                                                       06942002
*** TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                     06944002
*                                                                       06946002
         XCTLTABL ID=(FIRSTLD,IGG020P1,NEXTXCTL,IGG020P2,        Y02080X06948002
               D0,IGG020D0,PRECLOSE,IGG020P3,RPS19EK,IGG019EK),  YM3997X06950002
               SVC=020,LENGTH=,BRT=YES                           Y02080 06970002
         SPACE 2                                                 Y02144 06980002
         IECDSECS ASCB,CVT,IEZDEB,JSCB,PSA,TCB,RRPL,UCB,         Y02082X07000002
               EXPAND=YES                                        Y02082 07010002
*                                                                       07025021
*** RELEASE WORK AREA                                                   07030021
*                                                                       07035021
WORKAREA IECPRLWA EP,F4,D2=(1),ADT=YES  RELEASE WORK AREA        Y02144 07040002
SAVEREGS EQU   IECREGSV+12              REGISTER SAVE AREA       Y02080 07550002
         EJECT                                                  SA54549 07562002
*                                                                       07565021
*** I/O SUPPORT WORK AREA                                               07570021
*                                                                       07575021
CLOSEWKA DSECT                                                          07580000
         IECDSECT                                                       07600000
MINAME   EQU   DXCCW8+K2                ENQ MINOR NAME           Y02082 07700002
MJNAME   EQU   DXCCW9                   ENQ MAJOR NAME           Y02082 07720002
ENQAREA  EQU   DXCCW11                                             AAAA 07750016
         EJECT                                                          07760002
         DCBD  DSORG=(PS)                                               07780000
         EJECT                                                          07840002
         IEEVRSWA VER=3                 RESTART WORKAREA         YM8507 07840202
         END                                                            07860000
./  ADD  SSI=62230023,NAME=IGG020P2
 TITLE 'IGG020P2 - PARTIAL RELEASE - UPDATE F1,F3'                      00020000
IGG020P2 CSECT                                                          00021021
*          RELEASE 19 DELETIONS                                       * 00021321
*1023029100-029200,038200,038600,056000-061400                   O19117 00021621
*1023024000,024720                                               A25991 00021921
*1023                                                            S19028 00022221
*1023045024                                                      M4896  00022521
*          RELEASE 20 DELETIONS                                       * 00022821
*0224045096,045132                                               A34973 00023121
*0224067200                                                      A35327 00023421
*          RELEASE 21 DELETIONS                                       * 00023721
*0980000210,006000,016600-016800,031800,032200,032800-033000,    A39292 00024021
*0980034400,035600,044200,051200,052800,065200,069600,078600-    A39292 00024321
*0980079400                                                      A39292 00024621
*0980000600-002600,004400-007000,007800,008800,009200-009600,    A37199 00025221
*0980010000-010600,011000,011400,012000,012400,012800-013200,    A37199 00025821
*0980015000,015400-015800,016200,018600-019000,021680-021920,    A37199 00026421
*0980022200,023400,029630,045102,045400,046800,050200-050600,    A37199 00027021
*0980060600,063200-063800,073200,073600,076800,077920,079600-    A37199 00027621
*0980079900                                                      A37199 00028221
*          RELEASE 21.7 DELETIONS                                       00028302
*0000004300-004600,005300-005700,006300-006800,008000-008200,   SA54549 00028402
*0000008600,011600,016000,016300,017400,018200,018500,019400,   SA54549 00028502
*0000020060-020120,028500-028600,029070,029420-029560,029700-   SA54549 00028702
*0000029840,041600-044000,045048,045066,045084,045186-055800,   SA54549 00029402
*0000062500,063200-071840,072000,072250-072350,073200-073400,   SA54549 00029502
*0000007400,075400-076000,080400-080800                         SA54549 00029802
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00030002
*0000000300,002400-003000,004000,005900-006000,006300-006400,    Y02080 00030102
*0000006590,017600,020000,021000,044200,044600,045730,057020-    Y02080 00030202
*0000057022,057600-060800,072000-072200,072242,072250-072360,    Y02080 00030302
*0000072600,072800-078000                                        Y02080 00030402
*0000000030-000150                                               Y02082 00030502
*0000                                                            YM4670 00030602
*          VS2 RELEASE 03 ADDITIONS                                     00032437
*0000                                                          @ZA07622 00032537
*0000                                                          @ZA12266 00032637
*MODULE NAME - IGG020P2                                                 00032737
*                                                                       00032802
*DESCRIPTIVE NAME - PARTIAL RELEASE - UPDATE F1,F3                      00033002
*                                                                       00033202
*COPYRIGHT - NONE                                                       00033402
*                                                                       00033602
*CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD           00033802
*                                                                       00034902
*STATUS CHANGE LEVEL 011                                                00035021
*                                                                       00040000
*FUNCTION - THIS MODULE RELEASES ANY UNUSED SPACE THAT WAS              00080021
*        ALLOCATED IN THE DATA SET'S FORMAT 3 DSCB.                     00120021
*                                                                       00160021
*ENTRIES - THE ENTRY POINT TO THIS MODULE IS IGG020P2. ENTRY IS         00200021
*        MADE FROM IGG020P1 VIA A BRANCH.                               00240002
*                                                                       00320000
*SUPERVISOR CALLS                                                       00340000
*        SVC   EXCP (0) READ/WRITE DISK                                 00360000
*        SVC   WAIT (1) WAIT FOR COMPLETION OF I/O                      00380000
*                                                                       00420000
*INPUT - REGISTER 5 CONTAINS THE NUMBER OF EXTENTS IN THE DADSM TABLE.  00421002
*        REGISTER 11 POINTS TO THE RELEASE WORK AREA WHICH CONTAINS     00430002
*        THE DATA PORTION OF THE FORMAT 4 DSCB, AND THE DADSM EXTENT    00440002
*        TABLE, WHOSE ENTRIES REPRESENT THE SPACE BEING RELEASED        00450002
*        FROM THE FORMAT 1 DSCB.                                        00460002
*        REGISTER 13 POINTS TO THE I/O SUPPORT WORK AREA, WHICH         00470021
*        CONTAINS THE UPDATED FORMAT 1 DSCB.                            00480021
*                                                                       00490021
*OUTPUT - THE UPDATED FORMAT 3 IS WRITTEN TO THE VTOC. IF ALL THE       00500021
*        EXTENTS IN THE FORMAT 3 WERE RELEASED, A FORMAT 0 DSCB IS      00510021
*        WRITTEN OVER THE FORMAT 3 DSCB. REGISTER 11 POINTS TO THE      00520021
*        RELEASE WORK AREA WHICH CONTAINS THE DADSM EXTENT TABLE,       00530002
*        WHOSE ENTRIES REPRESENT ALL THE SPACE BEING RELEASED           00540002
*        FROM THE FORMAT 1 AND FORMAT 3 DSCB'S. REGISTER 13 POINTS      00550002
*        TO THE I/O SUPPORT WORK AREA, WHICH CONTAINS THE               00560002
*        UPDATED FORMAT 1 DSCB.                                         00570002
*                                                                       00580021
*STORAGE - PROGRAM CODE CSECT    = LESS THAN 1024 BYTES                 00590002
*          RELEASE WORK AREA     = 620 BYTES                            00595002
*          RPS WORK AREA         = 128 BYTES                            00600002
*          I/O SUPPORT WORK AREA                                        00605002
*                                                                       00610021
*EXITS -                                                                00620021
*        NORMAL - BRANCH TO IGG020D0 WITH NEGATIVE VALUE IN REGISTER 2. 00630002
*        ERROR  - IF AN I/O ERROR OCCURRED, BRANCH TO IGG020P3          00640002
*                 WITH X'10' ERROR CODE IN REGISTER 2.                  00650002
*                 BRANCH TO IGG020D0 TO WRITE BACK THE FORMAT 1         00659002
*                 WITH ONE OF THE FOLLOWING CODES IN REGISTER 2:        00659302
*                 X'04' - UNABLE TO FIND EXTENT IN THE FORMAT 3 DSCB    00670002
*                 ALL ZEROS - NO SPACE TO BE RELEASED FROM FORMAT 1     00679002
*                         AND/OR FORMAT 3                               00688002
*                                                                       00720000
*REGISTER USAGE                                                         00740000
R0       EQU   0                                                        00760000
ERRETREG EQU   2                                                        00840000
R1       EQU   1                                                        00900000
R2       EQU   2                                                        00980000
R3       EQU   3                                                        01080000
R4       EQU   4                                                        01120000
R5       EQU   5                                                        01180000
R6       EQU   6                                                        01220000
R7       EQU   7                                                        01260000
R8       EQU   8                                                        01340000
R9       EQU   9                                                        01360000
RXUSRDCB EQU   9                       BASE FOR USERS DCB               01380000
RXUCB    EQU   10                      POINTER TO THE UCB               01400000
RXWKA    EQU   11                      BASE FOR WORK AREA               01420000
RXBASE   EQU   12                      BASE FOR MAIN PROGRAM            01440000
RXCLOWKA EQU   13                      BASE FOR CLOSE'S WORK AREA       01460000
RLINK    EQU   14                      SUBROUTINE LINK REGISTER         01480000
R15      EQU   15                                                       01520000
*                                                                       01610021
*** OTHER EQUATES                                                       01620021
*                                                                       01621002
NOTINF3  EQU   X'04'                    EXTENT NOT FOUND ERROR   A37199 01640021
IOERROR  EQU   X'10'                    I/O ERROR CODE           A37199 01650021
CC       EQU   X'40'                    CCW COMMAND CHAINING     YM4670 01652002
WRITEKD  EQU   X'0D'                    WRITE KEY AND DATA       YM4670 01660002
KEYDATA  EQU   X'0E'                    READ KEY AND DATA       SA54549 01661002
*                                       COMMAND                 SA54549 01662002
F3IND    EQU   X'FF'                    TEST FOR FORMAT 3       SA54549 01662302
*                                                                       01663002
K4       EQU   4                        OFFSET INTO FIELD       SA54549 01664002
K7       EQU   7                        OFFSET INTO FIELD       SA54549 01665002
*                                                                       01666002
         BALR  RXBASE,0                LOAD BASE REGISTER               01700000
         USING *,RXBASE                 BASE FOR MODULE         SA54549 01709002
         USING CVT,R15                      CVT BASE REGISTER.          01720000
         USING PRLSEWKA,RXWKA           WORK AREA ADDRESSABILITY Y02080 01760002
         USING IHADCB,RXUSRDCB         ESTABLISH BASE FOR USERS DCB     01780000
         USING CLOSEWKA,RXCLOWKA       ESTABLISH BASE FOR CLOS WKAREA   01800000
*                                                                       01840000
*                                                                       01840202
*** THIS SECTION CHECKS IF THERE IS A FORMAT 3 TO BE READ IN            01840402
*                                                                       01840602
CHECKF3  EQU   *                                                SA54549 01841002
         MVI   DXCCW3,WRITEKD           PREPARE TO WRITE A F3    YM4670 01841402
         MVI   DXCCW3+K4,CC             CHAIN THE WRITE CCW'S TO YM4670X01841802
                                        THE WRITE CHECK CCW'S    YM4670 01842202
         TM    OUTCCHHR+K4,F3IND        IS THERE A FORMAT 3     SA54549 01842802
         BZ    FIEXT02                  NO, BRANCH TO TEST      SA54549X01843802
                                        IF EXTENTS RELEASED     SA54549 01844802
*                                                                       01845202
*** THIS SECTION MODIFIES THE CHANNEL PROGRAM TO READ THE FORMAT 3 DSCB 01845602
*                                                                       01846002
READFMT3 EQU   *                                                        01846402
         LA    R0,DXCCW4                MODIFY CCW PTR IN IOB   SA54549 01846802
         ST    R0,IOBSIOCC                                      SA54549 01847202
         LA    R0,OUTDSCB               PICK UP ADDRESS OF      SA54549 01847602
*                                       WHERE TO READ IN DSCB   SA54549 01847902
         ST    R0,DXCCW6                MODIFY READ CCW         SA54549 01848002
         MVI   DXCCW6,KEYDATA           READ KEY AND DATA       SA54549 01848402
*                                       COMMAND                 SA54549 01848802
         LH    R0,DSCBLNTH              MOVE IN LENGTH          SA54549 01849202
         ST    R0,DXCCW6+K4             MODIFY FLAGS AND COUNT  SA54549 01849602
         BAL   RLINK,EXECIO             READ FMT 3 DSCB         SA54549 01850002
*                                                                       01851802
*** THIS SECTION DETERMINES WHETHER THE EXTENT THAT CONTAINS THE LAST   01852802
*   TRACK WRITTEN IS LOCATED IN THE FORMAT 1 OR FORMAT 3 DSCB. IF THE   01860021
*   LAST TRACK IS IN THE FORMAT 3 DSCB, IT LOCATES THE PROPER EXTENT.   01870021
*                                                                       01880021
BEGINA   SR    R3,R3                        CLEAR DEB EXT REG.          01920000
         LA    R7,OUTDSCB-26                SET UP FMT 3 DSCB SCAN REG. 01960000
         LA    R8,OUTDSCB+135               SET UP FMT 3 END PTR.       01980000
         IC    R3,USEXTNUM              PICK UP M OF MBBCCHHR    Y02080 02000002
         CLI   INCCHHR+4,X'FF'              WAS EXTNT IN FMT 1 DSCB.    02020000
         BE    F1EXTGO                      YES                         02040000
         MH    R3,TEN                                                   02060000
         AR    R7,R3                        LOCATE PROPER EXT IN F1.    02080000
         CLI   USEXTNUM,K7              IS EXTENT IN KEY OF F3   Y02080 02100002
         BL    INKEY                        YES                         02120000
         LA    R7,1(R7)                     NO- INCL IDENTIFIER BIT.    02140000
INKEY    MVI   0(R7),X'81'                  TURN ON CYL ALGNMENT BIT.   02160000
         TM    JFCBCTRI,X'C0'           CYLINDER REQUEST?        A37199 02180021
         BO    ALIGNED                      BR-IF CYLINDER REQ.         02200000
         TM    JFCBCTRI,X'41'           RECORD ROUNDED REQUEST?  A37199 02220021
         BO    ALIGNED                      BR-IF REC ROUNDED REQ.      02240000
         MVI   0(R7),X'01'                  TURN OFF CYL ALGNMENT BIT.  02260000
GETFDAD  MVC   MBBCCHHR+3(4),DCBFDAD+3      INSERT NEW CCHH       18924 02280000
ALIGNED  LA    R8,OUTDSCB+135               RESET FMT 3 END PTR.        02300000
*                                                                       02320000
*** THIS SECTION RELEASES ALL UNUSED EXTENTS FROM THE FORMAT 3 DSCB.    02340021
*                                                                       02360000
LSTRACK  CLC   6(4,R7),MBBCCHHR+3           IS THIS END OF EXTENT.      02380000
UPDATE   LA    R7,10(R7)                UPDATE SCAN REGISTER     A25991 02400019
         BE    CHECKID                      YES-CHECK FOR IDENTIFIER.   02420000
         SH    R7,TEN                       RESET SCAN REG.             02440000
         CLC   MBBCCHHR+3(4),2(R7)      IS CCHH IN THIS EXTENT.   17305 02446016
         BL    NOEXTNT                  BRANCH IF NOT-TO ERROR.         02452013
         MVC   HOLD+4(4),6(R7)              SAVE PREVIOUS CCHH.         02460000
         EX    0,LSTRACK       CCHH WITHIN EXTENT                 18924 02463000
         BH    WITHIN          YES,CONTINUE                       18924 02466000
         EX    0,GETFDAD  FALL BACK TO LAST TRK ACT USED          18924 02469000
         EX    0,LSTRACK        IS CCHH OF LAST TRK WITHIN       A25991 02469719
*                                       EXTENT                   A25991 02470419
         BL    NOEXTNT          NO, IT IS BEYOND END OF EXTENT   A25991 02471119
         B     UPDATE           BR TO PERFORM ADDITIONAL TESTS   A25991 02472119
WITHIN   EQU   *                                                  18924 02475000
         MVC   HOLD(4),MBBCCHHR+3           SAVE NEW CCHH OF EXT USED.  02480000
         MVC   6(4,R7),MBBCCHHR+3           INSERT NEW CCHH.            02500000
* THIS CODE WILL SET EXTENT INDICATOR FOR PROPER BOUNDS                 02520037
         CLI   5(R7),0                      EXT START ON CYL   @ZA12266 02521037
         BNZ   RESETIND                     RESET IND          @ZA12266 02522037
         LH    R4,DS4DEVSZ+2                GET TRK/CYL        @ZA12266 02523037
         LH    RLINK,8(,R7)                 GET END HH         @ZA12266 02524037
         BCTR  R4,0                         SET TO LAST TRK    @ZA12266 02525037
         CR    R4,RLINK                     END ON CYL         @ZA12266 02526037
         BZ    GO                           CONVERT            @ZA12266 02527037
RESETIND MVI   0(R7),X'01'                  RESETIND           @ZA12266 02528037
GO       BAL   RLINK,CVTORTA                CONVERT RELSED CCHH TO RTA. 02529037
*                                                              @ZA12266 02530037
         LH    RLINK,ENTRIES                                      12693 02540015
         LA    RLINK,1(RLINK)          INCREMENT FIRST ENTRY      12693 02560015
         STH   RLINK,ENTRIES           FOR AVAIL SPACE INDICATION 12693 02580015
         B     CHECKID                      CHECK FOR IDENTIFIER FIELD. 02600000
CHECKLST CLR   R7,R8                        IS THIS THE LAST EXTENT     02620000
         BE    TSTWRITE                     YES-TEST FOR ALTERED FMT 3. 02640000
TESTZERO CLI   0(R7),0                      NO-IS NEXT EXTNT ZERO       02660000
         BE    TSTWRITE                     YES-TEST FOR ALTERED FMT 3. 02680000
         MVC   HOLD(8),2(R7)                GET EXT FOR DADSM UPDATE.   02700000
         XC    0(10,R7),0(R7)               CLEAR F1 RELEASED EXTENT.   02720000
         BAL   RLINK,CVTORTA                CONVERT EXTEXT TO RTA FOR   02740000
CHECKID  CLI   0(R7),X'F3'                  IS THIS IDENTIFIER FLD.     02760000
         BNE   CHECKLST                     NO-CHECK FOR LAST EXT.      02780000
         LA    R7,1(R7)                     YES-SKIP IDENTIFIER FLD.    02800000
         B     CHECKLST                     CHECK FOR LAST EXTENT.      02820000
F1EXTGO  EQU   *                                                        02840000
         MVC   DXDAADDR+3(5),OUTCCHHR  SET SEARCH ID TO FORMAT 3  14634 02870016
         LA    R7,30(R7)               SET SCAN REG TO FIRST EXT  14634 02880016
         B     TESTZERO                                           14634 02890016
FIEXT02  LTR   R5,R5                   ANY EXTENTS RELEASED       14634 02900016
         BNZ   UPDATEF1                 YES, BR TO UPDATE FMT 1 SA54549 02907002
         SR    ERRETREG,ERRETREG        CLEAR ERROR CODE        SA54549 02908802
         B     WRITF1                   PREPARE TO XCTL TO      SA54549 02910602
*                                       IGG020D0                SA54549 02912402
*                                                                       02914019
* * PREPARE FOR ERROR EXIT                                              02921019
*                                                                       02928019
NOEXTNT  EQU   *                                                 O19117 02935019
         LA    ERRETREG,NOTINF3         LOAD ERROR CODE          A37199 02963021
         B     WRITF1                                           SA54549 02964802
*                                                                       03000000
*** THIS SECTION SETS UP LINKAGE TO THE CVT ROUTINE,WHICH CONVERTS      03020000
*   EXTENTS FROM CCHH TO RTA.                                           03040000
*                                                                       03060000
CVTORTA  LA    R4,2                         INSERT COUNT                03080000
RTACVT   L     R15,CVTPTR                                               03100000
         L     R15,CVTPRLTV                 SET UP BASE  FOR CVT ROUT.  03120000
         MVC   MBBCCHHR+3(4),HOLD           MOVE CCHH TO BE CONVERTED.  03140000
         LA    R2,MBBCCHHR                  POINT TO CCHH AREA.         03160000
CCHHLINK EQU   *                                                 A39292 03170021
         STM   R9,R15,SAVEREGS          SAVE VOLATILE REGISTERS  A39292 03180021
         NI    CONVCON+1,0              CLEAR CONSTANT FOR FLOP.        03200000
         LR    R3,RXWKA                 SAVE WORKAREA REGISTER   A39292 03220021
         LA    R1,DXDEB                     PICK UP DEB PTR.            03240000
CVTLINK1 BALR  RLINK,R15                    CONVERT CCHH TO RTA.        03260000
         LM    RXWKA,RXBASE,8+SAVEREGS-FIRST(R3)  RESTORE RLSE   A39292 03280021
*                                       WORKAREA AND BASE REGS   A39292 03300021
         SRL   R0,16                                                    03320000
         AH    R0,CONVCON                                               03340000
         STH   R0,0(R6)                     STORE RTA INTO DADSNTBL.    03360000
         LA    R6,2(R6)                     INCREMENT DADSMTBL PTR.     03380000
         XI    CONVCON+1,1                  FLIPFLOP RTA INCREMENT.     03400000
         BCT   R4,FLIPFLOP                  CONTINUE IF COUNT NOT ZERO. 03420000
         LM    R9,R15,SAVEREGS-FIRST(R3)  RESTORE VOLATILE REGS  A39292 03440021
         BR    RLINK                        RETURN.                     03460000
FLIPFLOP EQU   *                                                        03480000
         MVC   MBBCCHHR+3(4),HOLD+4         PICK UP NEXT EXTENT.        03500000
         LA    R5,1(R5)                     INCREMENT ENTRY NO IN TBL.  03520000
         LA    R7,10(R7)                    UPDATE F1 EXTENT PTR.       03540000
         L     R15,24+SAVEREGS-FIRST(R3)  RESTORE CVT POINTER    A39292 03560021
         B     CVTLINK1                     LOOP TO CONVERT NEXT EXTNT  03580000
*                                                                       03600000
*** THIS SECTION MODIFIES THE CHANNEL PROGRAM TO WRITE A ZERO RECORD    03620000
*   WHENEVER ALL EXTENTS ARE RELEASED FROM THE FORMAT 3 DSCB.           03640000
*                                                                       03660000
WRITEZRO TM    OUTCCHHR+4,X'FF'  IS THERE A FMT 3 DSCB            22833 03680018
         BZ    TESTCHGE  NO-TEST FOR ALTERED F1                   22833 03700018
         LA    R0,DXCCW2+4                  YES-SET UP CHNL PRG WRT 0.  03720000
         ST    R0,DXCCW3                    MODIFY WRITE AREA ADDR.     03740000
         MVI   DXCCW3,X'0D'                 AND OP CODE.                03760000
         MVI   DXCCW3+4,X'60'               TURN ON S.I.L.I. FLAG.      03780000
         MVI   DXCCW3+7,X'04'               MODIFY COUNT.               03800000
         LH    R1,HOLENUM               FETCH HOLE COUNT         O19117 03820019
         LA    R1,1(R1)                                                 03840000
         STH   R1,HOLENUM               STORE UPDATED HOLE COUNT O19117 03860019
*                                           TO REFLECT THE DELETION     03880000
*                                           OF A FORMAT 3 DSCB.         03900000
         B     WRTDSCB                      WRITE FMT 0 OVER FMT 3 DSC  03920000
TSTWRITE CLI   INCCHHR+4,X'FF'              WAS LAST EXT USED IN FMT 1. 03940000
         BE    WRITEZRO                     CLEAR FMT 3 DSCB AREA .     03960000
TESTCHGE LTR   R5,R5                        WAS EXTNT FOUND.            03980000
         BZ    NOEXTNT                      NO-ERROR.                   04000000
WRTDSCB  LA    R0,DXCCW1                    MODIFY CCW PTR IN IOB.      04020000
         ST    R0,IOBSIOCC                                              04040000
         MVI   DXCCW6+4,X'10'               TURN ON SKIP FLAG.          04060000
         BAL   RLINK,EXECIO             *** WRITE DSCB.                 04080000
         MVI   DXCCW3+4,X'40'               RESTORE CMND CHN.           04100000
         MVI   DXCCW3+7,X'8C'               RESTORE COUNT.              04120000
*                                                                       04140000
*** THIS SECTION UPDATES THE FORMAT 1 DSCB WITH THE NUMBER OF           04160002
*   EXTENTS REMAINING ON THE VOLUME FOR THIS DATA SET.                  04180002
*                                                                       04220000
UPDATEF1 EQU   *                        UPDATE FORMAT 1 DSCB    SA54549 04221002
         L     R9,DCBSAVE               RESTORE USER'S DCB PTR   Y02080 04420002
         STC   R5,EXTNUM                    SAVE EXT NO IN DADSMTBL.    04440000
         XR    R1,R1                                             S19028 04445019
         XR    R3,R3                                             S19028 04450019
         IC    R1,DSCNOEXT              GET NUM OF EXTENTS       S19028 04455019
         IC    R3,USEXTNUM              PICK UP M OF MBBCCHHR    Y02080 04460002
         CLI   DSCEXTYP,X'40'      TEST,BR IF THERE IS A          22833 04466018
         BE    ULABELS             USER LABEL EXTENT              22833 04472018
         LA    R3,1(R3)                     GET NO OF EXT LEFT IN DSCB  04480000
ULABELS  EQU   *                                                  22833 04490018
         STC   R3,DSCNOEXT                  INSERT NEW NUMBER OF EXTS.  04500000
*                                                                       04534002
*** THIS SECTION CHECKS IF SMF IS SPECIFIED                             04535002
*                                                                       04536002
         SR    R1,R3                    NUM OF EXTNTS RELEASED   S19028 04537002
         SLL   R1,24                    FOR SMF                  S19028 04538002
         L     R2,CVTPTR                GET CVT ADDR             S19028 04539002
         L     R2,0(,R2)                GET ADDR OF TCB ADDR     M4896  04540002
         L     R2,4(R2)                 GET TCB ADDR             S19028 04541002
         L     R2,164(R2)               GET TCT ADDR             S19028 04542002
         LA    R2,0(R2)                 CLEAR HI-ORD           @ZA07622 04542537
         LTR   R2,R2                    TEST FOR SMF SYSTEM      S19028 04543002
         BZ    NEXTLOAD                 BRANCH IF NOT SMF       SA54549 04544002
         L     R2,12(R2)                GET TCTIOT ADDR          S19028 04545002
         LTR   R3,R2                    TEST FOR TCTIOT          S19028 04546002
         BZ    NEXTLOAD                 BRANCH IF NOT TCTIOT    SA54549 04547002
         LA    R3,8(R3)                 ADDR OF TCTIOT LOOKUP    S19028 04548002
         TM    PTYPEFLG,FROMCR          TEST IF ENTRY FROM C/R   Y02082 04548202
         BO    NXTEXT                   BRANCH IF FROM CHKPT/RST Y02082 04548402
         MODESET EXTKEY=ZERO            SWITCH TO KEY ZERO       Y02082 04548602
NXTEXT   OC    0(4,R3),0(R3)            TEST FOR TABLE END       S19028 04549002
         BZ    NEXTLOAD                 BRANCH IF END           SA54549 04550002
         CLC   0(2,R3),DCBTIOT          CHECK FOR CORRECT ENTRY  S19028 04551002
         BE    CORRECT                  IF CORRECT ENTRY,        A34973 04552002
*                                       CONTINUE                 A34973 04553002
         LA    R3,4(R3)                 IF NOT POINT TO NEXT     A34973 04554002
*                                       ENTRY                    A34973 04555002
         B     NXTEXT                   B TO TEST NEXT ENTRY     A34973 04556002
CORRECT  EQU   *                                                 A34973 04557002
         LH    R3,2(R3)                 GET TCTIOT DISPLACEMENT  S19028 04558002
         AR    R2,R3                    GET ENTRY ADDR           S19028 04559002
         XR    R3,R3                                             S19028 04560002
         IC    R3,2(R2)                 GET NUM OF UCB ENTRIES   S19028 04561002
         SLL   R3,3                     MULT BY ENTRY SIZE OF 8  A34973 04562002
         LA    R2,4(R2,R3)              GET ADDR OF SPACE RLSD   S19028 04563002
*                                       FIELD IN THE TCTIOT             04564002
         LA    R3,ENTRIES               PTR TO FIRST DADSM ENTRY S19028 04565002
NEXTRTA  AH    R1,2(R3)                 ADD RTA+1                S19028 04566002
         SH    R1,0(R3)                 SUBTRACT RTA             S19028 04567002
         LA    R3,4(R3)                 INCREMENT DADSM PTR      S19028 04568002
         BCT   R5,NEXTRTA               TEST FOR LAST EXTENT     S19028 04569002
         ST    R1,0(R2)                 STORE DATA IN TCTIOT     S19028 04570002
         TM    PTYPEFLG,FROMCR          TEST IF ENTRY FROM C/R   Y02082 04570402
         BO    NEXTLOAD                 BRANCH IF FROM CHKPT/RST Y02082 04570802
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY    Y02082 04571202
*                                                                       04572002
*** THIS SECTION SETS UP TO BRANCH TO NEXT LOAD OF PARTIAL RELEASE.     04573002
*                                                                       04574002
NEXTLOAD EQU   *                                                        04575002
         LNR   ERRETREG,RXBASE          LOAD NEGATIVE VALUE     SA54549 04576002
WRITF1   EQU   *                                                SA54549 04576302
         LA    R3,NEXTXCTL              FETCH NEXT LOAD POINTER  O19117 04577002
*                                                                       05701002
*** THIS SECTION BRANCHES TO ANOTHER LOAD OF PARTIAL RELEASE.           05702002
*                                                                       05703002
XCTL     EQU   *                                                 O19117 05704002
         IECRES LOAD,EXTPR=(RXWKA),MODID=(R3),BRANCH=DIRECT      Y02080 05760002
*                                                                       06160000
*** THIS SECTION INITIATES THE CHANNEL PROGRAM.                         06180000
*                                                                       06200000
EXECIO   MVI   DXECB,0                      TURN OFF ECB FLAGS.         06220000
         EXCP  DXIOB                        READ DSCB                   06240000
         WAIT  ECB=DXECB                    WAIT FOR COMPLETION.        06260000
         TM    DXECB,X'20'                  TEST FOR PERM I/O ERR.      06280000
         BCR   5,RLINK                      RETURN IF NO I/O ERR.       06300000
         LA    ERRETREG,IOERROR         LOAD ERROR CODE          A37199 06310021
LEAVE    EQU   *                                                SA54549 06319002
         LA    R3,PRECLOSE              POINT TO LAST LOAD ID   SA54549 06328002
         B     XCTL                                             SA54549 06337002
*                                                                       06342002
*** CONSTANTS                                                           07188021
*                                                                       07192021
TEN      DC    H'10'                                             A37199 07196021
DSCBLNTH DC    H'140'                   LENGTH FOR READ KEY AND SA54549 07221002
*                                       DATA COMMAND            SA54549 07222002
*                                                                       07224002
*** TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                       07224202
*                                                                       07224402
         XCTLTABL ID=(NEXTXCTL,D0,PRECLOSE,P3),SVC=020,          Y02080X07225002
               LENGTH=,BRT=YES                                   Y02080 07236002
         EJECT                                                  SA54549 07236202
*                                                                       07236402
*** CVT DSECT                                                           07237021
*                                                                       07238021
CVT      DSECT                                                          07240000
         CVT                            CVT DSECT                Y02080 07260002
         EJECT                                                  SA54549 07261002
*                                                                       07265021
*** RELEASE WORK AREA                                                   07270021
*                                                                       07275021
WORKAREA IECPRLWA EP,F4                 RELEASE WORK AREA        Y02080 07280002
SAVEREGS EQU   IECREGSV+12              REGISTER SAVE AREA       Y02080 07790002
         EJECT                                                  SA54549 07801002
*                                                                       07805021
*** I/O SUPPORT WORK AREA                                               07810021
*                                                                       07815021
CLOSEWKA DSECT                                                          07820000
         IECDSECT                                                       07840000
         EJECT                                                  SA54549 07841002
         DCBD  DSORG=(PS)                                               08020000
         END                                                            08100000
./  ADD  SSI=33190046,NAME=IGG020P3
         TITLE 'IGG020P3 - PARTIAL RELEASE PRECLOSE MODULE'             00400000
IGG020P3 CSECT                                                          00700021
*                                                                       01100019
*          VS2 RELEASE 02 DELETIONS/CHANGES                             01101002
*0000118000,158000,266000,296000-298000,405000,417800-417880,    Y02080 01101102
*0000424000,483400,492200-492600,492900-492950,493020,493055-    Y02080 01101202
*0000493062,493064-493065,493090-493100,493111,493154-493530,    Y02080 01101302
*0000497000-581000,598000,616000-644000,658000-665000,693000,    Y02080 01101402
*0000706040,706100,714000,721000-882000                          Y02080 01101502
*0000000600-003000,706200-714100                                 Y02078 01101602
*0000                                                            Y02144 01101702
*0000922600                                                      Y02082 01101802
*0000492950                                                      YM2880 01101902
*0000700400                                                      YM2887 01102202
*0000420000-421000,496600-496900,700100                          YM3048 01103802
*0000493300-493600,494100,495300                                 YM3912 01103902
*0000496300,497100-497120,499220-499240                          YM3997 01104002
*          RELEASE 21 DELETIONS/CHANGES                                 01110002
*0980105000-196000,298000,378000-385000,434000-462000,493000,    A37199 01120021
*0980493800-494000,504000-553000,595000-602000,742000,756000,    A37199 01140021
*0980840000,920500                                               A37199 01160021
*0980008000,315000,350000,494200,495200,917700-919800,921900     A39292 01200021
*          RELEASE 21.7 DELETIONS/CHANGES                               01202802
*0000118000-138000,224000,241000,287000,493600-494000,693000,   SA54549 01210002
*0000706100-706600,770000,812000                                SA54549 01282002
*0000485600,487200-488200                                       SA56400 01300002
*0000230480-230624                                               SM5456 01310002
*          RELEASE 20 DELETIONS/CHANGES                                 01400019
*0960                                                            S20201 01500020
*          RELEASE 19 DELETIONS/CHANGES                                 01700019
*0950154000-168000,210000-224000,238000-245000,399000-420000,    O19117 02300019
*0950490000                                                      O19117 02500019
*0950014000-021000,028000-070000,658000                          M3660  02600019
*          RELEASE 18 DELETIONS/CHANGES                                 03600019
*                                                                MCS    04600019
*                                                                       04601002
* MODULE NAME - IGG020P3                                                04602002
*                                                                       04603002
* DESCRIPTIVE NAME - PARTIAL RELEASE PRECLOSE MODULE                    04604002
*                                                                       04605002
* COPYRIGHT - NONE                                                      04606002
*                                                                       04607002
* CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD          04608002
*                                                                       04609002
*STATUS CHANGE LEVEL 005                                                05600021
*                                                                       08400000
*********************************************************************** 09100000
*                                                                       09800000
*FUNCTION/OPERATION - THIS MODULE REWRITES THE MODIFIED FORMAT 4 DSCB,  10800021
*        IF NECESSARY. IT DEQUEUES THE VTOC AND FREES THE WORK AREA     11800002
*        BEFORE RETURNING TO EITHER CLOSE OR CHECKPOINT/RESTART. IF AN  12800002
*        RPS WORK AREA EXISTS, IT IS FREED BEFORE CONTROL IS RETURNED.  13800002
*        IF AN I/O ERROR HAS OCCURRED IN A PARTIAL RELEASE MODULE,      13900002
*        THIS MODULE ISSUES MESSAGE IEC603I WITH THE CODE=0.  IF        14000002
*        OVERLAPPING EXTENTS WERE FOUND IN THE FORMAT 5 DSCB AND        14100002
*        THE DIRF BIT WAS NOT PREVIOUSLY SET IN THE FORMAT 4 DSCB,      14200002
*        THIS MODULE ISSUES MESSAGE IEC603I WITH THE CODE=4 AND         14300002
*        REWRITES THE FORMAT 4 DSCB WITH THE DIRF BIT SET.              14400002
*                                                                       14800021
*ENTRIES - THE ONLY ENTRY POINT IS IGG020P3. ENTRY IS MADE VIA BRANCH   15800002
*        FROM IGG020D1 UNDER NORMAL CONDITIONS AND FROM ALL LOADS OF    16800021
*        PARTIAL RELEASE UNDER ERROR CONDITIONS.                        17800021
*                                                                       20300000
*INPUT - AT ENTRY TO THIS MODULE REGISTER 11 CONTAINS A POINTER TO      21000019
*        RELEASE'S WORKAREA AND REGISTER 13 A POINTER TO THE CALLER'S   21700019
*        WORKAREA. REGISTER 2 IS USED TO PASS ERROR CODES FROM ALL      22400002
*        OTHER MODULES OF PARTIAL RELEASE TO IGG020P3.                  22760002
*        THE RETURN CODES ARE:                                          22832002
*        X'02' - UNABLE TO FIND EXTENT IN FORMAT 1 DSCB.                22904002
*        X'04' - UNABLE TO FIND EXTENT IN FORMAT 3 DSCB.                22976002
*        X'08' - ANOTHER DCB IS OPEN TO THE DATA SET                    23000002
*        X'10' - PERMANENT I/O ERROR.                                   23076802
*        X'20' - NO ROOM IN THE VTOC.                                   23091202
*        IF REGISTER 2 IS ZERO, NO ERROR OCCURRED.                      23100002
*                                                                       23460002
*OUTPUT - AN UPDATED FORMAT 4 DSCB IF REQUIRED. THE VTOC IS DEQUEUED.   24100002
*                                                                       25200000
*EXTERNAL ROUTINES                                                      25900000
*         EXCP(0) - EXECUTE A CHANNEL PROGRAM                           25920002
*         WAIT(1) - WAIT ON EVENT CONTROL BLOCK                         25940002
*         XCTL(7) - TRANSFER CONTROL TO CHECKPOINT/RESTART              25960002
*         WTO(35) - WRITE A MESSAGE TO THE OPERATOR                     25980002
*         IECRES  - FREE WORK AREA(S), LOAD AND BRANCH TO CLOSE         26600002
*                                                                       27300000
*EXITS -  IGC0R05B (D.A. DISPOSITION MODULE OF REPI/O)                  28000000
*         IFG0202E (D.A. MODULE OF CLOSE)                               28700002
*                                                                       29400000
*STORAGE - PROGRAM CODE CSECT    - LESS THAN 1024 BYTES                 29600002
*          RELEASE WORK AREA     - 620 BYTES                            29700002
*          RPS WORK AREA         - 128 BYTES                            29800002
*          I/O SUPPORT WORK AREA                                        29900002
*                                                                       30100000
*TABLES/WORKAREAS-                                                      30800000
*         THE FORMAT AND CONTENTS OF THE WORKAREA USED ARE DESCRIBED    32200000
*         BY THE DSECTS AT THE END OF THE LISTING.                      32900000
*                                                                       33600000
*ATTRIBUTES-                                                            34300000
*    REENTRANT, ENABLED, PRIVILEGED                                     35700000
*                                                                       36400000
*                                                                       37100000
*REGISTER USAGE                                                         38100021
*                                                                       39200000
R0       EQU   0                                                 O19117 39300019
R1       EQU   1                                                 O19117 39400019
R2       EQU   2                                                 O19117 39500019
ERRETREG EQU   2                        ERROR CODE REG           O19117 39600019
R3       EQU   3                                                 O19117 39700019
R4       EQU   4                                                 O19117 39800019
RX4      EQU   4                        CONTAINS WHERE FROM SW   O19117 39900019
R5       EQU   5                                                 O19117 40000019
R6       EQU   6                                                 O19117 40100019
R7       EQU   7                                                 O19117 40200019
R8       EQU   8                                                 O19117 40300019
R9       EQU   9                                                 O19117 40400019
R10      EQU   10                                                O19117 40600019
RXUCB    EQU   10                       PNTR TO UCB              O19117 40700019
R11      EQU   11                                                O19117 40800019
RXWKA    EQU   11                       BASE FOR WORKAREA        O19117 40900019
R12      EQU   12                                                O19117 41000019
RXBASE   EQU   12                       BASE FOR PROGRAM         O19117 41100019
R13      EQU   13                                                O19117 41200019
RXCLOWKA EQU   13                       BASE FOR CLOSE WORKAREA  O19117 41300019
R14      EQU   14                                                O19117 41400019
RLINK    EQU   14                       SUBROUTINE LINK REG      O19117 41500019
R15      EQU   15                                                O19117 41600019
*                                                                       41640021
*** OTHER EQUATES                                                       41680021
*                                                                       41720021
K0       EQU   0                        CONSTANT OF 0            YM2880 41730002
K1       EQU   1                        CONSTANT OF 1            YM2880 41740002
K2       EQU   2                        CONSTANT OF 2            YM3912 41750002
DIRFBIT  EQU   X'04'                    VTOC INTERRUPT BIT       A37199 41760021
C4       EQU   4                        FOUR CHARACTERS          S20201 41800020
AVTDS    EQU   120                      DISP. TO AVT PTR IN W.A. S20201 42200020
UUU      EQU   37                       DISP. TO UUU IN MESSAGE  Y02078 42220002
VOLSER   EQU   41                       DISP. TO VOLSER IN MSG   Y02078 42240002
CODE     EQU   48                       DISP. TO CODE IN MESSAGE Y02078 42260002
CODE4    EQU   C'4'                     CODE 4 IN MESSAGE        Y02078 42280002
BLANK    EQU   C' '                     EBCDIC BLANK             YM2880 42290002
*                                                                       42700000
*                                                                       46900000
         BALR  RXBASE,0            LOAD BASE REGISTER                   47600000
         USING CVT,R15                                                  48300000
         USING *,RXBASE                 ESTABLISH PROGRAM BASE   O19117 48320019
         USING PRLSEWKA,RXWKA           WORK AREA ADDRESSABILITY Y02080 48340002
         USING CLOSEWKA,RXCLOWKA        ESTABLISH CLOSE WORKAREA O19117 48360019
*                                       BASE                            48380019
*                                                                       48400019
* * DETERMINE IF THE FORMAT 4 DSCB MUST BE REWRITTEN                    48420019
*                                                                       48440019
BEGIN    EQU   *                                                SA54549 48454402
         LTR   ERRETREG,ERRETREG        Q - ERROR ENTRY          O19117 48460019
         BZ    NOERROR                  IF NOT, BR               O19117 48480019
         CH    ERRETREG,IOCODE          TEST ERROR CODE          O19117 48500019
         BNL   NOWRT                    BR IF IT IS AN I/O ERROR O19117 48520019
*                                       OR THERE IS NO FORMAT 0         48540019
*                                       DSCB AVAILABLE IN VTOC          48560019
TESTDIRF EQU   *                                                SA56400 48580002
         XI    DS4VTOCI,DIRFBIT         RESET/SET DIRF BIT      SA56400 48584002
         TM    DS4VTOCI,DIRFBIT         TEST RESULTS            SA56400 48588002
         BO    NOWRT                    IF PAST INTERRUPTION,   SA56400 48592002
*                                       BRANCH                  SA56400 48592802
         TM    DADSMTBL,ERXTENT         TEST IF OVERLAPPING     SA56400 48596002
*                                       EXTENTS FOUND           SA56400 48596802
         BO    NOWRT                    BRANCH IF YES           SA56400 48597602
         B     WRTF4                    IF NO, WRITE BACK F4    SA56400 48598402
NOERROR  EQU   *                                                 O19117 48600019
         CLI   HOLENUM+1,X'00'          Q - HOLE COUNT CHANGE    O19117 48620019
         BE    TESTDIRF                 IF NOT, BR               O19117 48640019
         LH    R15,DS4DSREC             UPDATE HOLE              O19117 48660019
         AH    R15,HOLENUM                COUNT IN               O19117 48680019
         STH   R15,DS4DSREC                 FORMAT 4             O19117 48700019
*                                                                       48840019
*** THIS SECTION TESTS IF OVERLAPPING EXTENTS WERE FOUND BETWEEN        48890002
*   SPACE BEING RELEASED AND SPACE ALREADY EXISTING IN THE              48892002
*   FORMAT 5. IT ALSO RELOCATES THE CHANNEL PROGRAM AND WRITES          48894002
*   BACK THE FORMAT 4.                                                  48896002
*                                                                       48898002
XTENTEST EQU   *                                                SA56400 48898402
         TM    DADSMTBL,ERXTENT         WERE OVERLAPPING        SA56400 48898802
*                                       EXTENTS FOUND           SA56400 48899202
         BNO   OFFDIRF                  IF NO BRANCH TO         SA56400 48899602
*                                       SET/RESET DIRF BIT      SA56400 48909002
         OI    DS4VTOCI,DIRFBIT         TURN ON DIRF BIT        SA56400 48920602
         B     WRTF4                    BRANCH TO WRITE BACK    SA56400 48924602
*                                       THE F4 WITH DIRF BIT ON SA56400 48928602
OFFDIRF  XI    DS4VTOCI,DIRFBIT         SET/RESET DIRF BIT      SA56400 48930002
WRTF4    EQU   *                                                 O19117 48939402
         LM    R3,R8,CHANPROG           PICK UP CCS'S            O19117 48948802
         ALR   R3,RXWKA                 RESOLVE                  O19117 48958202
         ALR   R5,RXCLOWKA                CCW                    O19117 48967602
         ALR   R7,RXWKA                     ADDRESSES            O19117 48980019
         STM   R3,R8,DXCCW1             STORE UPDATED CCW'S      O19117 49000019
         MVC   DXDAADDR+3(5),VTOCADR    INSERT VTOC ADDR INTO    O19117 49020019
*                                       DEB                      O19117 49040019
         LA    R15,DXCCW1               SET CCW POINTER          O19117 49060019
         ST    R15,IOBSIOCC               INTO IOB               O19117 49080019
         EXCP  DXIOB                                             O19117 49100019
         WAIT  ECB=DXECB                                         O19117 49120019
         TM    DXECB,X'20'              Q - I/O SUCCESSFUL       O19117 49140019
         BO    IOSUC                    IF YES, BR               O19117 49160019
         LA    ERRETREG,X'10'           SET PERM I/O ERROR CODE  O19117 49180019
IOSUC    EQU   *                                                 O19117 49200019
*                                                                       49205002
* * THIS SECTION DEQ'S FROM SYSDSN (FOR CHKPT/RESTART ONLY).            49210002
*                                                                       49215002
NOWRT    EQU   *                                                 O19117 49220002
         LA    R1,DXCCW1                RESTORE CCW PNTR IN IOB  O19117 49225002
         ST    R1,IOBSIOCC                FOR CALLER             O19117 49230002
         TM    DSMADTB2,DSMDSNE         TEST IF ENQ'ED ON DSN    Y02082 49235002
         BNO   DEQVTOC                  BRANCH IF NOT            Y02082 49240002
         L     R15,CVTPTR               LOAD CVT ADDRESS         Y02082 49245002
         L     R15,CVTTCBP              LOAD TCB DW ADDRESS      Y02082 49250002
         L     R3,C4(,R15)              LOAD CURRENT TCB ADDRESS Y02082 49255002
         USING TCB,R3                   TCB ADDRESSABILITY       Y02082 49260002
         L     R3,TCBJSCB               LOAD JSCB ADDRESS        Y02082 49265002
         USING IEZJSCB,R3               JSCB ADDRESSABILITY      Y02082 49270002
         L     R3,JSCBACT               GET ACTIVE JSCB ADDRESS  YM2887 49272002
         L     R3,JSCBTCBP              INITIATOR'S TCB ADDRESS  Y02082 49275002
         DROP  R3                                                Y02082 49280002
         MVC   MJNAME(L'SYSDSN),SYSDSN  MAJOR RESOURCE NAME      Y02082 49285002
         MVC   ENQAREA(DEQLTH),DEQLIST  MOVE IN DEQ PARM LIST    Y02082 49290002
         LA    R5,JFCBDSNM+L'JFCBDSNM-K1  LAST BYTE OF DSNAME    YM2880 49291002
TESTDSN  EQU   *                        SEARCH FOR NON-BLANK     YM2880 49292002
         CLI   K0(R5),BLANK             IS THIS ONE A BLANK      YM2880 49293002
         BNE   GETLNGTH                 BRANCH IF NO TO COMPUTE  YM2880X49294002
                                        LENGTH OF NAME FOR DEQ   YM2880 49295002
         BCT   R5,TESTDSN               TRY NEXT BYTE            YM2880 49296002
GETLNGTH EQU   *                        CALCULATE LENGTH         YM2880 49297002
         LA    R6,JFCBDSNM-K1           BYTE PRECEDING DSNAME    YM2880 49298002
         SR    R5,R6                    R5 HAS LENGTH FOR DEQ    YM2880 49299002
         DEQ   (MJNAME,JFCBDSNM,(R5)),TCB=(R3),MF=(E,ENQAREA)    Y02082 49300002
*                                                                       49301002
         NI    DSMADTB2,X'FF'-DSMDSNE   RESET DSN ENQ'ED SWITCH  Y02082 49305002
*                                                                       49310002
* * THIS SECTION DEQ'S THE VTOC.                                        49315002
*                                                                       49320002
DEQVTOC  EQU   *                        DEQ VTOC                 Y02082 49325002
         USING UCB,RXUCB                UCB ADDRESSABILITY       YM3912 49330002
         L     RXUCB,DXDEBUCB           LOAD UCB ADDRESS         YM3912 49332002
         LA    R3,SRTEVOLI              POINT TO VOLSER          YM3912 49335002
         MVC   MJNAME(L'VTOCNAME),VTOCNAME  MAJOR RESOURCE NAME  YM3912 49340002
         MVI   ENQAREA,X'FF'            SET LAST ENTRY INDICATOR YM3912 49345002
         SR    R1,R1                    ZERO REGISTER            YM3912 49350002
         STH   R1,ENQAREA+K2            CLEAR FOR DEQ MACRO      YM3912 49355002
         DEQ   (MJNAME,(R3),6,SYSTEMS),RMC=STEP,MF=(E,ENQAREA)   YM3912 49360002
*                                                                       49362002
         NI    DSMADTB2,X'FF'-DSMVTOCR-DSMSMCE  RESET VTOC       Y02144 49364002
*                                       ENQ'ED SMC SWITCHES      Y02144 49366002
*                                                                       49370002
* * THIS SECTION ISSUES MESSAGE IEC603I WITH CODE=0 OR CODE=4.          49380002
*                                                                       49390002
MSGTEST  EQU   *                        ISSUE MESSAGE            Y02078 49400002
         CH    ERRETREG,IOCODE          TEST IF I/O ERROR ON VOL Y02078 49420002
         BNE   TSTOVLAP                 BRANCH IF NO I/O ERROR   Y02078 49430002
         LA    RLINK,ISSUEMSG           SET UP RETURN REGISTER   Y02078 49440002
         B     BUILDMSG                 GO BUILD MESSAGE IEC603I Y02078 49450002
TSTOVLAP EQU   *                        TEST DIRF                Y02078 49460002
         TM    DADSMTBL,ERXTENT         TEST IF DIRF BIT SET DUE Y02078 49470002
*                                       TO OVERLAPPING EXTENTS   Y02078 49480002
         BNO   RPSTEST                  BRANCH IF NOT            Y02078 49490002
         LA    RLINK,SETCODE            SET UP RETURN REGISTER   Y02078 49500002
BUILDMSG EQU   *                        BUILD MESSAGE            Y02078 49510002
         MVC   INDSCB(MSGEND-ERRMSG),ERRMSG  MOVE IN MESSAGE     Y02078 49520002
         MVC   INDSCB+UUU(L'UCBNAME),UCBNAME  MOVE IN EBCDIC UCB Y02078 49540002
*                                       CHANNEL/UNIT ADDRESS     Y02078 49550002
         MVC   INDSCB+VOLSER(L'SRTEVOLI),SRTEVOLI  MOVE IN VOLID Y02078 49560002
         BR    RLINK                    CONTINUE                 Y02078 49570002
SETCODE  EQU   *                        CODE=4                   Y02078 49580002
         MVI   INDSCB+CODE,CODE4        SET CODE=4               Y02078 49590002
ISSUEMSG EQU   *                        ISSUE MESSAGE            Y02078 49600002
         WTO   MF=(E,INDSCB)            ISSUE MESSAGE IEC603I    Y02078 49610002
*                                                                       49620002
* * THIS SECTION RESTORES THE DEB AVT PTR IF AN RPS WORK AREA EXISTS.   49630002
*                                                                       49640002
RPSTEST  EQU   *                        RPS TEST                 Y02078 49650002
         TM    DSMADTB1,DSMRPSAP        TEST IF RPS APPENDAGE    YM3048X49660002
                                        WAS LOADED               YM3048 49670002
         BNO   CONTINUE                 BRANCH IF NOT            YM3048 49680002
         L     R1,DXDEBAPP              GET PTR TO RPS WORK AREA YM3048 49690002
         MVC   DXDEBAPP(C4),AVTDS(R1)   RESTORE DEB AVT POINTER  S20201 49700002
         NI    DSMADTB1,X'FF'-DSMRPSAP  RESET RPS APP LOADED BIT Y02144 49714002
*                                                                       49720002
* * THIS SECTION PREPARES TO RETURN TO CLOSE BY LOADING THE ENTRY       49730002
*   POINT ADDRESS.                                                      49740002
*                                                                       49750002
CONTINUE EQU   *                                                 S20201 49760002
         TM    DADSMTBL,FROMCR          TEST IF ENTRY FROM C/R   Y02080 49770002
         BO    RELOADRG                 BRANCH IF YES            Y02080 49780002
         IECRES LOAD,EXTPR=(RXWKA),MODNM=CLOSE,BRANCH=NO         Y02080 49790002
         L     R14,WTGMODEP             LOAD ENTRY POINT ADDRESS Y02080 49800002
*                                                                       49810002
* * THIS SECTION FREES THE PARTIAL RELEASE WORK AREA (AND THE           49820002
*   RPS WORK AREA) AND RESTORES THE CALLER'S REGISTERS.  IF             49830002
*   REGISTER 4 CONTAINS A NEGATIVE VALUE, PARTIAL RELEASE WAS           49840002
*   ENTERED FROM THE 'REPI/O' FUNCTION OF CHECKPOINT/RESTART.           49850002
*                                                                       49860002
RELOADRG EQU   *                        LOAD REG                 Y02080 49870002
         L     R8,SVRBPTR               LOAD SVRB ADDRESS        Y02080 49880002
         LR    R9,RXCLOWKA              SAVE CLOSE W/A ADDRESS   Y02080 49890002
         STM   ERRETREG,R14,DXCCW1      SAVE REGISTERS 2-14      Y02080 49900002
         IECRES FREE,PREFIX=FIRST,A=(RXWKA)  FREE RELEASE WKAREA Y02080 49910002
         LM    ERRETREG,R14,DXCCW1-DXLBL(R9)  RESTORE REGISTERS  Y02080 49920002
         LR    R1,ERRETREG              CALLER EXPECTS ERROR    SA54549 49930002
*                                       CODE IN REGISTER 1              49940002
         LM    R2,R10,96(R8)            RESTORE REGS FROM CALLER A39292 49950002
         LTR   RX4,RX4             IS REGISTER 4 NEGATIVE               49960002
         BM    XCTL                BRANCH IF YES(ENTERED FROM REPDCB)   56700000
*                                                                       57400000
         IECRES BRANCH,EPA=(R14)        BRANCH TO CLOSE          Y02080 58100002
*                                                                       58800000
* * THIS SECTION XCTL'S TO CHECKPOINT/RESTART.                          59800002
*                                                                       60900000
XCTL     EQU   *                                                 M3660  61200019
         XC    DXCCW1,DXCCW1            ZERO XCTL PARAMETER LIST Y02080 61600002
         LA    R15,DXCCW2               POINT TO MODULE NAME     Y02080 62300002
         ST    R15,DXCCW1               XCTL NAME ADDRESS        Y02080 63000002
         MVC   DXCCW2,REPDCB            MOVE IN C/R MODULE NAME  Y02080 63700002
*                                                                       65100000
         XCTL  MF=(E,(1)),SF=(E,DXCCW1)  XCTL TO CHKPT/RESTART   Y02080 65800002
*                                                                       67200000
*                             CONSTANTS                                 67900000
*                                                                       68600000
REPDCB   DC    C'IGC0R05B'         REPI/O NAME                          70000000
SYSDSN   DC    CL8'SYSDSN'              MAJOR RESOURCE NAME      Y02082 70020002
VTOCNAME DC    CL8'SYSVTOC'             MAJOR QUEUE NAME         O19117 70030019
DEQLIST  DEQ   (,,,SYSTEM),TCB=0,MF=L   SYSDSN DEQ LIST          YM2887 70040002
DEQLTH   EQU   *-DEQLIST                LENGTH OF DEQ LIST       Y02082 70050002
IOCODE   DC    H'16'                    I/O ERROR CODE           O19117 70060019
ERRMSG   WTO   'IEC603I VTOC ERRORS MAY EXIST ON UUU,VOLSER,0',  Y02078X70062002
               ROUTCDE=(4,10),DESC=4,MF=L                        Y02078 70064002
MSGEND   EQU   *                        END OF MSG               Y02078 70066002
*                                                                       70090019
* * CHANNEL PROGRAM TO WRITE BACK FORMAT 4 DSCB                         70120019
*                                                                       70150019
CHANPROG DS    0F                                                O19117 70180019
*CCW1 - SEARCH ID EQ                                                    70210019
         DC    X'31'                                             O19117 70240019
         DC    AL3(VTOCADR-FIRST)                                O19117 70270019
         DC    X'4000'                                           O19117 70300019
         DC    H'5'                                              O19117 70330019
*CCW2 - TIC                                                             70360019
         DC    X'08'                                             O19117 70390019
         DC    AL3(DXCCW1-CLOSEWKA)                              O19117 70420019
         DC    F'0'                                              O19117 70450019
*CCW3 - WRITE DATA                                                      70480019
         DC    X'05'                                             O19117 70510019
         DC    AL3(VTOCDSCB-FIRST)                               O19117 70540019
         DC    H'0'                                              O19117 70570019
         DC    H'96'                                             O19117 70600019
*                                                                       70602002
*** TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                     70604002
*                                                                       70606002
         XCTLTABL ID=(CLOSE,IFG0202E),SVC=020,LENGTH=,BRT=YES    Y02080 70610002
         SPACE 2                                                 Y02078 70620002
         IECDSECS CVT,JSCB,TCB,UCB,EXPAND=YES                    Y02082 70700002
*                                                                       71500021
*** RELEASE WORK AREA                                                   71600021
*                                                                       71700021
WORKAREA IECPRLWA EP,F4,ADT=YES         RELEASE WORK AREA        Y02144 72100002
         EJECT                                                  SA54549 88210002
*                                                                       88900021
*** I/O SUPPORT WORK AREA                                               89600021
*                                                                       90300021
CLOSEWKA DSECT                                                          91000000
         IECDSECT                                                       91700000
ZERO     EQU   DXCCW4+4                                          O19117 92120019
MJNAME   EQU   DXCCW9                   MAJOR RESOURCE NAME      Y02082 92260002
ENQAREA  EQU   DXCCW11                                           O19117 92330019
         END                                                            92400000
./  ADD  SSI=72590408,NAME=IGG029DU
 TITLE 'IGG029DU - DADSM SCRATCH - DUMMY MODULE ENTRY POINT'            00050060
IGG029DU CSECT                                                          00100060
**********************************************************************  00150060
*                                                                    *  00200060
*MODULE NAME - IGG029DU                                              *  00250060
*                                                                    *  00300060
*DESCRIPTIVE NAME - DADSM SCRATCH - ENTRY POINT DUMMY MODULE         *  00350060
*                                                                    *  00400060
*COPYRIGHT - NONE                                                    *  00450060
*                                                                    *  00500060
*CHANGE ACTIVITY -                                                   *  00550060
*                                                                    *  00600060
*                  MODULE NEW FOR VS2-3.7  SU60                @G60ASBJ 00650060
*                                                                    *  00700060
*STATUS CHANGE LEVEL 000                                             *  00750060
*                                                                    *  00800060
*ATTRIBUTES - REENTRANT                                              *  00850060
*                                                                    *  00900060
*FUNCTION - THIS MODULE IS THE ENTRY POINT TO SCRATCH (SVC 29).      *  00950060
*          IT IS A DUMMY CSECT WHICH IMMEDIATELY PASSES CONTROL TO   *  01000060
*          SCRATCH MODULE IGC0002I WITHOUT CHANGING ANY REGISTERS    *  01050060
*          EXCEPT REGISTER 15.                                       *  01100060
*                                                                    *  01150060
*          THIS CSECT MAY BE REPLACED BY A USER WRITTEN ROUTINE      *  01200060
*          IF DESIRED TO PERFORM PROCESSING BEFORE OR AFTER THE      *  01250060
*          SYSTEM SCRATCH ROUTINES RECEIVE CONTROL.                  *  01300060
*                                                                    *  01350060
*          ANY USER WRITTEN ROUTINE WHICH REPLACES THIS CSECT MUST   *  01400060
*          BE RE-ENTRANT AND PASS CONTROL TO THE FIRST SCRATCH       *  01450060
*          MODULE IGC0002I WITH THE REGISTER CONTENTS CONFORMING     *  01500060
*          TO STANDARD SVC ROUTINE CONVENTIONS. REGISTER 1 MUST      *  01550060
*          CONTAIN THE ADDRESS OF THE SCRATCH PARAMETER LIST WITH    *  01600060
*          THE SAME FORMAT AS DESCRIBED BELOW UNDER INPUT.           *  01650060
*                                                                    *  01700060
*          IF THE USER WRITTEN ROUTINE NEEDS TO SAVE REGISTERS,      *  01750060
*          IT MUST PROVIDE A RE-ENTRANT SAVE AREA TO SAVE AND        *  01800060
*          RESTORE ITS REGISTERS.  THE SVRB SAVE AREA SHOULD NOT     *  01850060
*          BE USED SINCE IT IS USED BY THE SCRATCH ROUTINES.         *  01900060
*                                                                    *  01950060
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG029DU. ENTRY IS *  02000060
*          MADE BY SVC 29.                                           *  02050060
*                                                                    *  02100060
*SUPERVISOR CALLS AND EXTERNAL ROUTINES USED BY THIS MODULE - NONE   *  02150060
*                                                                    *  02200060
*OTHER MACROS ISSUED - NONE                                          *  02250060
*                                                                    *  02300060
*INPUT -   AT ENTRY TO THIS MODULE REGISTER 1 POINTS TO THE PARAMETER*  02350060
*          LIST.  REGISTER 0 MAY POINT TO A UCB, OR IT MAY CONTAIN NO*  02400060
*          ADDRESS. THE PARAMETER LIST CONSISTS OF 4 WORDS:          *  02450060
*                                                                    *  02500060
*          WORD 1 - CHECK PURGE DATE = X'41004000'                   *  02550060
*                 - OVERRIDE PURGE DATE = X'41005000'                *  02600060
*                   BIT 0 OF THE 2ND OPTION BYTE IS SET BY DYNAMIC   *  02650060
*                   UNALLOCATION AND BY JOB AND STEP TERMINATION     *  02700060
*                   TO INDICATE NOT TO INVOKE DYNAMIC ALLOCATION.    *  02750060
*                                                                    *  02800060
*                   IF THE SECOND WORD OF THE SECOND BYTE IS         *  02850060
*                   SET TO 1, AND IF (1) THE CALLER IS               *  02900060
*                   AUTHORIZED AND (2) RACF IS ACTIVE IN THE         *  02950060
*                   SYSTEM AND (3) THE JSCBPASS BIT IN THE           *  03000060
*                   JSCB IS SET TO 1, THEN THE RACDEF PROFILE        *  03050060
*                   DELETE IN SCRATCH MODULE IGG0299A WILL BE        *  03100060
*                   BYPASSED.                                        *  03150060
*                                                                    *  03200060
*                   BIT 0 OF THE THIRD OPTION BYTE IS SET BY         *  03250060
*                   DYNAMIC UNALLOCATION TO INDICATE THAT THE        *  03300060
*                   TIOT HAS ALREADY BEEN ENQ'ED.                    *  03350060
*                                                                    *  03400060
*          WORD 2 - ADDRESS OF THE DATA SET NAME                     *  03450060
*                   IF BIT 0 IS SET, ENTRY IS FROM JOB TERMINATION   *  03500060
*                   OR FROM STEP TERMINATION.  IF BIT 1 IS SET, ENTRY*  03550060
*                   IS FROM THE READER OR WRITER.                    *  03600060
*                                                                    *  03650060
*          WORD 3 - NOT USED                                         *  03700060
*                                                                    *  03750060
*          WORD 4 - ADDRESS OF THE VOLUME LIST                       *  03800060
*                                                                    *  03850060
*          THE VOLUME LIST IS VARIABLE IN LENGTH. THE FIRST TWO BYTES*  03900060
*          INDICATE THE NUMBER OF 12 BYTE VOLUME ID FIELDS WHICH     *  03950060
*          FOLLOW. A 12 BYTE VOLUME ID FIELD CONTAINS A FOUR BYTE    *  04000060
*          DEVICE CODE, SIX BYTE VOLUME SERIAL NUMBER, ONE BYTE SPARE*  04050060
*          AND ONE BYTE USED FOR RETURNING THE STATUS OF THE DATA SET*  04100060
*          ON THAT VOLUME AS FOLLOWS:                                *  04150060
*                                                                    *  04200060
*                    BINARY 0 - SUCCESSFUL SCRATCH                   *  04250060
*                    BINARY 1 - DSCB NOT FOUND IN VTOC               *  04300060
*                    BINARY 2 - PASSWORD DIFFICULITY                 *  04350060
*                    BINARY 3 - UNEXPIRED PURGE DATE                 *  04400060
*                    BINARY 4 - PERMANENT I/O ERROR                  *  04450060
*                    BINARY 5 - APPROPRIATE UCB UNAVAILABLE          *  04500060
*                    BINARY 6 - OPERATOR UNABLE TO MOUNT VOLUME      *  04550060
*                    BINARY 7 - DATA SET IS OPEN                     *  04600060
*                    BINARY 8 - THE DSCB INDICATES THAT THE DATA SET *  04650060
*                               IS DEFINED TO RACF BUT EITHER THE    *  04700060
*                               ACCESSOR IS NOT AUTHORIZED TO THE    *  04750060
*                               DATA SET OR TO THE VOLUME OR THE     *  04800060
*                               DATA SET IS A VSAM DATA SPACE OR THE *  04850060
*                               DATA SET IS NOT ACTUALLY DEFINED TO  *  04900060
*                               RACF.                                *  04950060
*                                                                    *  05000060
*                                                                    *  05050060
*OUTPUT -  REGISTER 15 CONTAINS THE ENTRY POINT ADDRESS OF THE NEXT  *  05100060
*          LOAD OF SCRATCH (IGC0002I). REGISTERS 0 - 14 CONTAIN THE  *  05150060
*          SAME VALUES AS THEY DID UPON ENTRY TO IGG029DU.           *  05200060
*                                                                    *  05250060
*ERROR CONDITIONS - NONE                                             *  05300060
*                                                                    *  05350060
*STORAGE - PROGRAM CODE = 12 BYTES.                                  *  05400060
*                                                                    *  05450060
*ERROR CONDITIONS IN THIS MODULE - NONE                              *  05500060
*                                                                    *  05550060
**********************************************************************  05600060
*REGISTER USAGE:                                                        05650060
R0       EQU   0                        REGISTER 0 - NOT CHANGED        05700060
R15      EQU   15                       BASE REGISTER - ENTRY ADDRESS   05720060
         SPACE 3                                                        05740060
         BALR  R15,R0                   LOAD REGISTER 15                05760060
         USING *,R15                    ESTABLISH BASE REGISTER         05780060
         L     R15,IGC0002I             GET IGC0002I ENTRY ADDRESS      05850060
         BR    R15                      TRANSFER CONTROL TO IGC0002I    05900060
IGC0002I DC    V(IGC0002I)              ADDRESS OF IGC0002I             05950060
         END                                                            06000060
./  ADD  SSI=80160430,NAME=IGG0290A
         TITLE 'IGG0290A - DADSM SCRATCH - SEARCH FOR DSCB(S)'   S21040 00010021
IGG0290A CSECT                                                          00020021
*                                                                       00030021
*          RELEASE 18 DELETIONS                                       * 00042018
*1666000600                                                       22833 00044018
*          RELEASE 19 DELETIONS                                       * 00046018
*1021031200,036800,058200,061400,069800                          O19117 00047019
*1021                                                            M4917  00047519
*1021043200-044400                                               M4504  00047719
*1021027900,059200-060400                                        M3097  00047819
*          RELEASE 20 DELETIONS                                       * 00048018
*1331050600,051000,051400,052000,052400-053400,054000,054400-    A31333 00048620
*1331055000,055800,056800                                        A31333 00049220
*1331076200                                                      A34916 00049620
*          RELEASE 21 DELETIONS                                       * 00050018
*1198002100,003400,006800,008000,009400,084700,093600            A37199 00050221
*1198000000-000400,002000-002800,003200-003400,005600,007200-    S21040 00050421
*1198007600,008000,010800,011200,011600,012000-012200,012600,    S21040 00050821
*1198014500-015000,031600,034400-057000,060800,072200-079000,    S21040 00051221
*1198079200-079400,080800                                        S21040 00051621
*          RELEASE 21.7 DELETIONS                                       00053702
*0000000520-000620,075000-080800,089000-090200                  SA56400 00053802
*0000021400,067600                                              SA48172 00054002
*0000                                                           SA53691 00054202
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00056002
*0000001000,003800,005200-005400,007000-007400,008000-008200,    Y02080 00056102
*0000015600-016000,021600,024480,026700-027600,027900,038200-    Y02080 00056202
*0000042200,060630-060750,061600,073000,080800-093700,094000     Y02080 00056302
*0000006400,022800,023800-024400,057200,057600,059200,059800,    Y02078 00056402
*0000060200,093720-094000                                        Y02078 00056502
*0000001400-002700,003400-006200,006900-007400,008000-008200,    Y02082 00056602
*0000014700-014850,024440-025200,025600                          Y02082 00056702
*0000025800                                                      Y02134 00056802
*0000020000-020200,026000,068600                                 YM1337 00056902
*0000023950,024100,024790                                        YM4653 00057002
*0000                                                            YM7039 00059002
*                                                                       00064018
*         VS2 RELEASE 03  SU32                                 @G32DSPD 00064532
* DELETIONS - 071988                                           @G32DSPD 00064632
* CHANGES   - 025378,025403-025424,071880,071988-071946        @G32DSPD 00064832
* ADD                                                          @ZA25881 00064932
*                                                                       00065002
*MODULE NAME - IGG0290A                                                 00066002
*                                                                       00067002
*DESCRIPTIVE NAME - DADSM SCRATCH - SEARCH FOR DSCB(S)                  00068002
*                                                                       00069002
*COPYRIGHT - NONE                                                       00070002
*                                                                       00071002
*CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD           00071202
*                                                                       00071402
*STATUS CHANGE LEVEL 006                                                00072021
*                                                                       00080000
*ATTRIBUTES - REENTRANT                                                 00100002
*                                                                       00120000
*FUNCTION - THIS MODULE READS IN THE FORMAT 4 DSCB AND SEARCHES FOR     00140002
*          THE FORMAT 1 DSCB TO BE SCRATCHED.  IF THE ENQ (ISSUED IN    00160002
*          MODULE IGC0002I) INDICATED THAT SOMEONE COULD BE OPEN TO     00180002
*          THE DATA SET, THIS MODULE THEN SEARCHES THE JOB'S DEBS TO    00200002
*          ENSURE THAT NO ONE IS CURRENTLY OPEN TO THE DATA SET.        00220002
*          IF THE DATA SET IS PASSWORD PROTECTED, CONTROL IS GIVEN      00240002
*          TO MODULE SECLOADA.  THE EXPIRATION DATA IS TESTED IF THE    00260002
*          PURGE DATE OVERRIDE OPTION IS NOT SET IN THE SCRATCH         00280002
*          PARAMETER LIST.  IF NO ONE IS OPEN TO THE DATA SET, AND      00284002
*          EITHER THE EXPIRATION DATE IS PAST OR THE OVERRIDE OPTION    00288002
*          WAS SPECIFIED, CONTROL IS GIVEN TO MODULE IGG0299A.          00292002
*          OTHERWISE, THIS MODULE GIVES CONTROL TO IGG0290D.            00296002
*          IF A DATA SET IS RAC PROTECTED, VERIFY THE USER     @Z40RSGD 00298032
*          AUTHORIZATION TO SCRATCH THE DATA SET (RACHECK).    @Z40RSGD 00298432
*                                                                       00300000
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG0290A.  ENTRY IS   00320021
*          MADE FROM THE SECOND LOAD OF SCRATCH (IGG0290E) AND FROM     00340002
*          THE PASSWORD PROTECTION MODULE (SECLOADA).                   00360002
*                                                                       00380002
*SUPERVISOR CALLS AND EXTERNAL ROUTINES USED BY THIS MODULE -           00400002
*          EXCP(0)  - READS FROM A DIRECT ACCESS DEVICE                 00420002
*          WAIT(1)  - WAITS ON AN EVENT CONTROL BLOCK                   00440002
*          SETLOCK  - OBTAINS/RELEASES THE LOCAL MEMORY LOCK            00460002
*          MODESET  - SWITCHES TO THE CALLER'S KEY                      00480002
*          IECRES   - LOADS/BRANCHES TO ANOTHER MODULE                  00500002
*                                                                       00520002
*OTHER MACROS USED -                                                    00540002
*          IECDSECS - EXPANDS THE CVT, RB, TCB, JSCB, IEZDEB, UCB,      00560002
*                     AND PSA DSECTS                                    00580002
*          IECSDSL1 - ENABLES SYMBOLIC ADDRESSING OF DSCB'S             00600002
*          IECSCRWA - EXPANDS THE SCRATCH WORK AREA                     00620002
*          XCTLTABL - BUILDS A LIST OF MODULE NAMES AND ADDRESSES       00640002
*                                                                       00660000
*INPUT -   AT ENTRY TO THIS MODULE, REGISTER 13 POINTS TO THE WORK      00665002
*          AREA.  REGISTER 8 POINTS TO THE CURRENT ENTRY IN THE         00670002
*          VOLUME LIST.  REGISTER 10 POINTS TO THE PARAMETER LIST.      00675002
*          IF REENTRY FROM SECLOADA, REGISTER 10 CONTAINS ONE OF        00680002
*          THE FOLLOWING RETURN CODES:                                  00685002
*          X'00000000' - SUCCESSFUL PASSWORD CHECKING                   00690002
*          X'01000000' - UNSUCCESSFUL PASSWORD CHECKING                 00695002
*          X'02000000' - I/O ERROR OR NO PASSWORD DATA SET ON SYSRES    00700002
*                                                                       00705002
*OUTPUT -  REGISTER 8 AND 13 ARE AS AT ENTRY TO THE MODULE.  THE        00710002
*          DATA PORTIONS OF THE FORMAT 1 AND FORMAT 4 DSCB'S HAVE       00715002
*          BEEN READ INTO THE WORK AREA.                                00720002
*          THE FOLLOWING ADDITIONAL INFORMATION IS PASSED TO SECLOADA:  00725002
*          REGISTER 1 CONTAINS THE DSAB ADDRESS.                        00730002
*          REGISTER 4 POINTS TO THE DATA PORTION OF THE FORMAT 1 DSCB.  00735002
*          REGISTER 5 POINTS TO THE IOB.                                00740002
*          REGISTER 10 CONTAINS THE VALUE X'03000000'.                  00745002
*          REGISTER 11 POINTS TO THE DATA SET NAME.                     00750002
*          REGISTER 13 POINTS TO THE EXTENDED PREFIX OF THE WORK AREA.  00755002
*                                                                       00780000
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    00800002
*          WORK AREA = 896 BYTES                                        00820002
*          RPS WORK AREA = 128 BYTES                                    00830002
*                                                                       00840000
*ERROR CONDITIONS - DSCB NOT FOUND IN VTOC                              00860000
*                   PURGE DATE NOT PAST AND OVER RIDE OPTION OFF        00880000
*                   IMPROPER PASSWORD PRESENTED                         00900000
*                   DATA SET IS OPEN                                    00910002
*                   PERMANENT I/O ERROR                                 00920000
*                   USER NOT AUTHORIZED TO SCRATCH RAC DEFINED @Z40RSGD 00922032
*                   DATA SET.                                  @Z40RSGD 00924032
*                                                                       00930021
*                                                                       00960000
*NOTES - THIS MODULE WAS SPLIT IN RELEASE 21.  THE SECOND HALF IS       00965021
*        MODULE IGG0299A.                                               00970021
*                                                                       00975021
*REGISTER USAGE                                                         00980000
R0       EQU   0                                                        01000000
R1       EQU   1                                                        01020000
R2       EQU   2                                                        01040000
R3       EQU   3                                                        01060000
R4       EQU   4                                                        01100000
R5       EQU   5                                                        01140000
VOLCTR   EQU   R5                       COUNT OF REMAINING VOLS  Y02082 01160002
R6       EQU   6                                                        01180000
R7       EQU   7                                                        01240000
VOLISTX  EQU   8                                                        01280000
RCVTT    EQU   9                                               @ZA25881 01300032
PL       EQU   10                                                       01320000
R10      EQU   10                                                       01340000
R11      EQU   11                                                       01360000
RBASE    EQU   12                                                       01380000
RWKAREA  EQU   13                                                       01400000
RETURN   EQU   14                                                       01420000
WORKREG  EQU   15                                                       01440000
*                                                                       01442021
* OTHER EQUATES                                                         01444021
*                                                                       01446021
ZERO     EQU   0                        CONSTANT OF ZERO         Y02082 01447002
K1       EQU   1                        CONSTANT OF 1            Y02078 01448002
K3       EQU   3                        CONSTANT OF 3            Y02082 01449002
D2       EQU   2                        DISPLACEMENT OF 2        S21040 01450021
D4       EQU   4                        DISPLACEMENT OF 4        S21040 01460021
K4       EQU   4                        CONSTANT OF 4            Y02078 01461002
K5       EQU   5                        CONSTANT OF 5            Y02080 01462002
K6       EQU   6                        CONSTANT OF 6            Y02078 01463002
K12      EQU   12                       CONSTANT OF 12           Y02082 01464002
SEEKCYL  EQU   3                        OFFSET TO CCHHR IN SEEK  Y02080 01465002
RTNCODE8 EQU   8                        ERROR RETURN CODE OF 8   Y02082 01466002
STATUS   EQU   11                       DISP. TO VOLIST STATUS   Y02078 01467002
ENTRYL   EQU   12                       VOL LIST ENTRY LENGTH    Y02082 01468002
ALLBITS  EQU   X'FF'                    MASK OF ALL ONES         Y02082 01469002
DEBDADEV EQU   X'04'                    DEB EXTENT SCALE FOR DA  Y02082 01470002
NOF1     EQU   X'01'                    NO F1 DSCB ERROR CODE    Y02078 01471002
PSWDERR  EQU   X'02'                    PASSWORD ERROR CODE      Y02078 01472002
PURGERR  EQU   X'03'                    PURGE DATE ERROR CODE    Y02078 01473002
IOERR    EQU   X'04'                    I/O ERROR CODE           Y02078 01474002
OPENDS   EQU   X'07'                    OPEN/SCRATCH ERROR CODE  Y02082 01475002
DOSBIT   EQU   X'80'                    DOS BIT IN DS4VTOCI      Y02078 01476002
DIRFBIT  EQU   X'04'                    DIRF BIT IN DS4VTOCI     Y02078 01477002
DS1EXTUL EQU   X'40'                    USER LABEL BIT IN EXTENT Y02082 01478002
PSWDDS   EQU   X'10'                    PASSWORD-PROTECTED D/S   Y02082 01479002
CC       EQU   X'40'                    COMMAND CHAINING BIT     Y02082 01480002
CSWAD    EQU   8                        CSW OFFSET IN IOB       SA53691 01481002
UCBADDR  EQU   32                       DISP. TO UCB ADDR IN DEB YM4653 01482002
SKIP     EQU   X'10'                    CCW SKIP FLAG           SA48172 01492002
SLI      EQU   X'20'                    CCW SUPPRESS LENGTH     SA48172 01494002
*                                       INDICATOR               SA48172 01496002
RACERROR EQU   X'08'                    SCRATCH FAILED DUE TO  @Z40RSGD 01498032
*                                       ERROR IN RAC FUNCTION  @Z40RSGD 01498432
DS1RACDF EQU   X'40'                    DS1DSIND-DATA SET IS   @Z40RSGD 01498832
*                                       RAC DEFINED            @Z40RSGD 01499232
VSAMDSSP EQU   X'08'                    VSAM DATA SPACE        @Z40RSGD 01499632
*                                                                       01500021
         BALR  RBASE,R0                                                 01520000
         USING BEGIN,RBASE                                              01540000
         USING SCRTHWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 01560002
*                                                                       01605021
* THIS SECTION RELOCATES AND EXECUTES THE CHANNEL PROGRAM.              01610021
*                                                                       01615021
BEGIN    EQU   *                                                        01620000
         LTR   PL,PL                    IF PASSWORD ENTRY IS IT OKAY.   01640000
         BZ    PASSOKAY                 BRANCH IF YES.                  01660000
         ST    PL,FIELD1                SAVE PARAMETER LIST POINTER.    01680000
         TM    FIELD1,3                 IS THIS A PASSWORD ERROR.       01700000
         BNE   PSWDEXIT                 BRANCH IF YES.                  01720000
         LM    R0,R7,CHANPROG           LOAD CCW1 TO CCW4 CONSTANTS.    01740000
         AR    R0,RWKAREA               RESOLVE ADDR IN CCW1            01760000
         AR    R2,RWKAREA               RESOLVE ADDR IN CCW2            01780000
         AR    R4,RWKAREA               RESOLVE ADDR IN CCW3            01800000
         AR    R6,RWKAREA               RESOLVE ADDR IN CCW4            01820000
         STM   R0,R7,CCW1               STORE CCW1 TO CCW4              01840000
         LA    WORKREG,CCW9-CCW1                                        01860000
         AR    R2,WORKREG               RESOLVE ADDR IN CCW5            01880000
         STM   R2,R3,CCW5               STORE CCW5                      01900000
         LA    WORKREG,CCW11-CCW9                                       01920000
         AR    R2,WORKREG               RESOLVE ADDR IN CCW8            01940000
         STM   R2,R3,CCW8               STORE CCW8                      01960000
         LM    R0,R7,CHANPROG+32        LOAD CCW9 TO CCW12 CONSTANTS    01980000
         AR    R0,RWKAREA               RESOLVE ADDR IN CCW9     YM1337 02020002
         AR    R2,RWKAREA               RESOLVE ADDR IN CCW10           02040000
         AR    R4,RWKAREA               RESOLVE ADDR IN CCW11           02060000
         AR    R6,RWKAREA               RESOLVE ADDR IN CCW12           02080000
         STM   R0,R7,CCW9               STORE CCW9 TO CCW12             02100000
         STM   R0,R1,CCW6               STORE CCW6                      02120000
         STM   R4,R5,CCW7               STORE CCW7              SA48172 02140002
         MVI   CCW7+4,SLI+SKIP          SET SLI AND SKIP BITS   SA48172 02152002
         MVI   DS1FMTID,X'00'           ZERO FORMAT ID OF INPUT AREA    02180000
EXECUTE  EQU   *                                                        02200000
         BAL   RETURN,EXCPIO            SEARCH FOR CORRECT DSCB.        02220000
         L     R2,IOB+CSWAD             GET CSW COMMAND ADDRESS SA56391 02222002
         LA    R2,0(R2)                 CLEAR HIGH BYTE         SA56391 02224002
         LA    R3,CCW8                  GET CCW8 ADDRESS        SA56391 02226002
         CLR   R2,R3                    DOES CSW POINT TO CCW8  SA56391 02228002
         BE    NOTFOUND                 YES, DATA SET NOT FOUND SA56391 02230002
         CLI   DS1FMTID,X'F1'           TEST FOR FMT 1 DSCB IN CORE     02240000
         BE    NEWDSCB                                                  02260000
         B     PERMERR                  BAD VTOC - I/O ERR CODE SA56391 02265002
NOTFOUND EQU   *                                                SA56391 02270002
         TM    DS4VTOCI,DOSBIT+DIRFBIT  TEST IF DOS OR DIRF SET  Y02078 02280002
         BZ    NODSCB                                                   02300000
         TM    ERCODE,X'80'             TEST FOR SECOND PASS            02320000
         BO    NODSCB                                                   02340000
         OI    ERCODE,X'80'             TURN ON FIRST PASS INDICATOR    02360000
         CLC   DS4HPCHR(K4),DS4VTOCE+K6  TEST IF CCHH OF 'HIGH   Y02078 02362002
*                                       WATER' MARK IS THE LAST  Y02078 02364002
*                                       TRACK IN THE VTOC        Y02078 02366002
         BNE   NEWHIGH                  BRANCH IF NOT            Y02078 02368002
         CLC   DS4HPCHR+D4(K1),DS4DEVDT  TEST IF R OF THE 'HIGH  Y02078 02370002
*                                       WATER' MARK IS THE LAST  Y02078 02372002
*                                       RECORD ON THE TRACK      Y02078 02374002
         BE    NODSCB                   BRANCH IF YES            Y02078 02376002
NEWHIGH  EQU   *                        SET NEW CCHHR            Y02078 02378002
         MVC   DS4HPCHR(K4),DS4VTOCE+K6  MOVE IN NEW CCHH        Y02078 02380002
         MVC   DS4HPCHR+D4(K1),DS4DEVDT  MOVE IN NEW R           Y02078 02381002
         MVI   CCW3+K4,CC+SKIP          DO NOT REREAD THE F4     Y02078 02382002
         B     EXECUTE                  SEARCH FOR THE F1 AGAIN  Y02078 02383002
*                                                                       02384002
* THIS SECTION SEARCHES THE JOB'S DEBS IF NECESSARY IN ORDER TO         02385002
* ENSURE THAT NO ONE IS OPEN TO THE DATA SET BEING SCRATCHED.           02386002
*                                                                       02387002
NEWDSCB  EQU   *                        DEB SEARCH               Y02082 02388002
         TM    SISW1,DEBSRCH            IS A DEB SEARCH NEEDED   Y02082 02389002
         BZ    PSWDCHK                  BRANCH IF NOT            Y02082 02390002
         L     R1,TCBADDR               CURRENT TCB ADDRESS      Y02082 02391002
         USING TCB,R1                                            Y02082 02392002
         L     R1,TCBJSCB               JSCB ADDRESS             Y02082 02393002
         USING IEZJSCB,R1                                        Y02082 02394002
         STM   R11,RETURN,IECREGSV+K12  SAVE SETLOCK REGISTERS   Y02082 02396002
         LR    R2,RWKAREA               SAVE WORKAREA BASE       Y02082 02397002
GETLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,  PREVENT DEBCHK  Y02082*02398002
               RELATED=(DEBTBL,IGG0290A(FREELOCK))               Y02082 02399002
         LR    RWKAREA,R2               RESTORE WORKAREA BASE    Y02082 02400002
         LM    R11,RETURN,IECREGSV+K12  RESTORE SETLOCK REGS     Y02082 02401002
         L     R1,JSCBDBTB              ADDR OF DEB TABLE        Y02082 02402002
         LTR   R1,R1                    IS ADDR ZERO             Y02082 02403002
         BZ    NOPENDS                  BRANCH IF YES            Y02082 02404002
         LH    R2,ZERO(,R1)             LAST ENTRY OFFSET        Y02082 02405002
         AR    R2,R1                    ADDRESS OF LAST ENTRY    Y02082 02406002
NXTDEB   EQU   *                        NEXT DEB                 Y02082 02407002
         LA    R1,K4(,R1)               POINT TO NEXT ENTRY      Y02082 02408002
         CR    R1,R2                    END OF DEB TABLE         Y02082 02409002
         BE    NOPENDS                  BRANCH IF YES            YM4653 02410002
         OC    ZERO(K4,R1),ZERO(R1)     EMPTY ENTRY              Y02082 02411002
         BZ    NOPENDS                  BRANCH IF YES            Y02082 02412002
         TM    K3(R1),ALLBITS           DELETED ENTRY            Y02082 02413002
         BO    NXTDEB                   BRANCH IF YES            Y02082 02414002
*                                       R1 POINTS TO A FULLWORD  Y02082 02415002
*                                       CONTAINING A DEB POINTER Y02082 02416002
         L     R3,ZERO(,R1)             LOAD DEB ADDRESS         Y02082 02417002
         USING DEBBASIC,R3                                       Y02082 02418002
         LA    R4,DEBBASIC-DEBAMTYP     OFFSET BACK TO DEBAMTYP  Y02082 02419002
         LCR   R4,R4                    MAKE OFFSET NEGATIVE     Y02082 02420002
         AR    R4,R3                    R4 POINTS TO DEBAMTYP    Y02082 02421002
         USING DEBAMTYP,R4                                       Y02082 02422002
         CLI   DEBAMTYP,ZERO            AMTYP ABSENT             Y02082 02423002
         BE    AMVALID                  BRANCH IF YES--VALID     Y02082 02424002
         CLC   DEBAMTYP,AMBPAM          BPAM DEB                 Y02082 02425002
         BE    AMVALID                  BRANCH IF YES--VALID     Y02082 02426002
         CLC   DEBAMTYP,AMBDAM          BDAM DEB                 Y02082 02427002
         BE    AMVALID                  BRANCH IF YES            Y02082 02428002
         CLC   DEBAMTYP,AMSAM           SAM DEB                  Y02082 02429002
         BE    AMVALID                  BRANCH IF YES            Y02082 02430002
         CLC   DEBAMTYP,AMEXCP          EXCP DEB                 Y02082 02431002
         BE    AMVALID                  BRANCH IF YES            Y02082 02432002
         CLC   DEBAMTYP,AMISAM          ISAM DEB                 Y02082 02433002
         BNE   NXTDEB                   BRANCH IF NO-THIS DEB    Y02082 02434002
*                                       NEED NOT BE CHECKED      Y02082 02435002
         CLI   DEBNMEXT,K1              0 OR ONE EXTENT IN ISAM  Y02082 02436002
*                                       DEB                      Y02082 02437002
         BNH   NXTDEB                   INVALID ISAM DEB         Y02082 02438002
         DROP  R4                                                Y02082 02439002
         SR    R4,R4                    ZERO FOR IC              Y02082 02440002
         IC    R4,DEBNMEXT              INSERT NUMBER OF EXTENTS Y02082 02441002
         BCTR  R4,ZERO                  REDUCE BY ONE            Y02082 02442002
         LA    R3,DEBNMTRK-DEBUCBAD+L'DEBNMTRK(,R3)  SKIP FIRST  Y02082 02443002
*                                       EXTENT FOR ISAM          Y02082 02444002
         B     CHKEXTNT                 GO TO CHECK EACH EXTENT  Y02082 02445002
AMVALID  EQU   *                        VALID AM TYPE            Y02082 02446002
         CLI   DEBNMEXT,ZERO            ARE THERE ANY EXTENTS    Y02082 02447002
         BZ    NXTDEB                   BRANCH IF NO             Y02082 02448002
         CLI   DEBEXSCL,DEBDADEV        IS EXTENT SCALE 4 FOR DA Y02082 02449002
         BNE   NXTDEB                   BRANCH IF NO             Y02082 02450002
         L     R4,DEBSUCBA              GET UCB ADDRESS          Y02082 02451002
         USING UCBOB,R4                                          Y02082 02452002
         LA    R4,ZERO(,R4)             CLEAR HIGH BYTE          Y02082 02453002
         LTR   R4,R4                    IS THERE A UCB           Y02082 02454002
         BZ    NXTDEB                   BRANCH IF NO             Y02082 02455002
         TM    UCBTBYT3,UCB3DACC        IS IT DIRECT ACCESS      Y02082 02456002
         BZ    NXTDEB                   BRANCH IF NO             Y02082 02457002
         DROP  R4                                                Y02082 02458002
         SR    R4,R4                    ZERO FOR IC              Y02082 02459002
         IC    R4,DEBNMEXT              NUMBER OF EXTENTS        Y02082 02460002
CHKEXTNT EQU   *                        CHECK EXTENT             Y02082 02461002
         LA    R3,DEBBASND              INCREMENT PAST BASIC     Y02082 02462002
*                                       SECTION OF DEB           Y02082 02463002
         USING DEBDASD,R3                                        Y02082 02464002
CMPREXTS EQU   *                        CHK FOR USER LBL EXTENT  Y02082 02465002
         CLC   DEBUCBA,WKADEB+UCBADDR+K1  TEST IF SAME UCB       YM4653 02465202
         BNE   NEXTXTNT                 BRANCH IF NOT            YM4653 02465402
         TM    DS1EXT1,DS1EXTUL         IS FIRST EXTENT USER LBL Y02082 02466002
         BZ    NOTUL                    BRANCH IF NOT            Y02082 02467002
         CLC   DEBSTRCC(L'DEBSTRCC+L'DEBSTRHH),DS1EXT2+D2 IS THE Y02082 02468002
*                                       DEB'S STARTING CCHH      Y02082 02469002
*                                       EQUAL TO THE DSCB'S      Y02082 02470002
         BE    NOSCRTCH                 BRANCH IF YES            Y02082 02471002
         B     NEXTXTNT                 GET NEXT EXTENT          Y02082 02472002
NOTUL    EQU   *                        NOT USER LBL EXTENT      Y02082 02473002
         CLC   DEBSTRCC(L'DEBSTRCC+L'DEBSTRHH),DS1EXT1+D2  IS    Y02082 02474002
*                                       THE DEB'S STARTING CCHH  Y02082 02475002
*                                       EQUAL TO THE DSCB'S      Y02082 02476002
         BE    NOSCRTCH                 BRANCH IF YES            Y02082 02477002
NEXTXTNT EQU   *                        NEXT EXTENT              Y02082 02478002
         LA    R3,DEBNMTRK+L'DEBNMTRK   INCREMENT TO NEXT EXTENT YM4653 02479002
         BCT   R4,CMPREXTS              TRY NEXT EXTENT          Y02082 02480002
         B     NXTDEB                   NO MORE EXTENTS          Y02082 02481002
NOSCRTCH EQU   *                        CANNOT BE SCRATCHED      Y02082 02482002
         LA    R3,OPENERR               SET UP BRANCH ADDRESS AS Y02082 02483002
*                                       THE DATA SET IS OPEN AND Y02082 02484002
*                                       CANNOT BE SCRATCHED      Y02082 02485002
         B     FREELOCK                 FREE THE LOCAL LOCK      Y02082 02486002
NOPENDS  EQU   *                        GET ADDRESS              Y02082 02487002
         LA    R3,PSWDCHK               SET UP BRANCH ADDRESS    Y02082 02488002
FREELOCK EQU   *                        SAVE BASE                Y02082 02489002
         LR    R1,RWKAREA               SAVE WORKAREA BASE       Y02082 02490002
         STM   R11,RETURN,IECREGSV+K12  SAVE SETLOCK REGISTERS   Y02082 02491002
         SETLOCK RELEASE,TYPE=LOCAL,    RELEASE LOCAL LOCK       Y02082*02492002
               RELATED=(DEBTBL,IGG0290A(GETLOCK))                Y02082 02493002
         LR    RWKAREA,R1               RESTORE WORKAREA BASE    Y02082 02494002
         LM    R11,RETURN,IECREGSV+K12  RESTORE SETLOCK REGS     Y02082 02495002
         BR    R3                       RETURN                   Y02082 02496002
*                                                                       02497002
* A DEB HAS BEEN FOUND OPEN TO THE DATA SET BEING SCRATCHED.            02498002
* THE CURRENT AND ALL SUBSEQUENT VOLUME ENTRIES WILL HAVE THEIR         02499002
* ERROR CODES SET TO X'07'.                                             02500002
*                                                                       02501002
OPENERR  EQU   *                        DATA SET OPEN            Y02082 02502002
         LH    VOLCTR,VOLNUM            NUMBER OF VOLS REMAINING Y02082 02503002
*                                       NOT COUNTING CURRENT ONE Y02082 02504002
         LA    VOLCTR,K1(,VOLCTR)       COUNT INCLUDING CURRENT  Y02082 02505002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02082 02506002
         USING TCB,R1                                            Y02082 02507002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02082 02508002
SETERRCD EQU   *                        SET ERROR CODE           Y02082 02509002
         MVI   STATUS(VOLISTX),OPENDS   SET ERROR CODE           Y02082 02510002
         LA    VOLISTX,ENTRYL(,VOLISTX)  INCREMENT TO NEXT ENTRY Y02082 02511002
         BCT   VOLCTR,SETERRCD          BRANCH TO CONTINUE       Y02082 02512002
         MODESET EXTKEY=ZERO            RETURN TO KEY 0          Y02082 02513002
         LA    WORKREG,ENTRYL           VOL LIST ENTRY LENGTH    Y02082 02514002
         SR    VOLISTX,WORKREG          POINT TO LAST ENTRY      Y02082 02515002
         OI    STYPEFLG,EXITBIT         SET EXIT BIT             Y02082 02516002
         B     ERREXIT                  EXIT TO IGG0290D         Y02082 02517002
*                                                                       02518002
* SECLOADA IS GIVEN CONTROL IF THE DATA SET IS PASSWORD PROTECTED.      02519002
*                                                                       02520002
PSWDCHK  EQU   *                        PASSWORD CHECK           Y02082 02521002
*                                                              @Z40RSGD 02521432
* IF THE DATA SET IS RAC PROTECTED VERIFY USER AUTHORIZATION   @Z40RSGD 02521832
* TO SCRATCH IT VIA RAC INSTEAD OF PASSWORD CHECKING.          @Z40RSGD 02521932
*                                                              @Z40RSGD 02525532
         TM    DS1DSIND,DS1RACDF        IS THE DATA SET RAC    @Z40RSGD 02527532
*                                       DEFINED                @Z40RSGD 02527932
         BZ    NORACHCK                 NO-CONTINUE            @Z40RSGD 02528332
         L     R1,TCBADDR               LOCATE TCB             @Z40RSGD 02528732
         USING TCB,R1                                          @Z40RSGD 02529132
         L     R1,TCBJSCB               LOCATE JSCB            @Z40RSGD 02532532
         USING IEZJSCB,R1                                      @Z40RSGD 02534532
         L     R1,JSCBACT               PICK ACTIVE JSCB       @G32DSPD 02534732
         TM    JSCBSWT1,JSCBPASS        IS RAC PROCESSING TO   @Z40RSGD 02534932
*                                       BE BYPASSED            @Z40RSGD 02535032
         BO    NORACHCK                                        @Z40RSGD 02535132
         DROP  R1                       NOT NEEEDED            @Z40RSGD 02535232
         CLI   DS1DSORG+1,VSAMDSSP      IS IT A VSAM DATA      @Z40RSGD 02535332
*                                       SPACE                  @Z40RSGD 02535732
         BE    ERRX08                   YES-ERROR-RAC DEFINED  @Z40RSGD 02536132
*                                       VSAM DATA SPACES NOT   @Z40RSGD 02536232
*                                       LEGAL                  @Z40RSGD 02536332
         MVC   RACHECK(LRACHECK),MRACHECK BUILD RACHECK        @Z40RSGD 02537232
*                                       PARAMETER LIST         @Z40RSGD 02538732
         NI    SISW1,255-VOLRACHK      INIT VOLRACF SW         @G32DSPD 02538832
* CHECK RAC AUTHORIZATION TO SCRATCH DATA SET.                 @Z40RSGD 02538932
         RACHECK ENTITY=PDSNAME,                               @Z40RSGDX02539032
               VOLSER=PVOLSER,                                 @Z40RSGDX02539132
               MF=(E,RACHECK)                                  @Z40RSGD 02539632
         LTR   WORKREG,WORKREG          DOES RAC AUTHORIZE     @Z40RSGD 02539732
*                                       SCRATCH                @Z40RSGD 02539832
         BZ    NAMEOKAY                 YES-BYPASS PASSWORD    @Z40RSGD 02539932
*                                       CHECKING               @Z40RSGD 02540032
***                                                                     02540332
***                                                                     02540432
         L     R1,CVTPTR                LOAD CVT ADDRESSS      @ZA25881 02540532
         USING CVT,R1                   CVT ADDRESSABILITY     @ZA25881 02540632
         L     R1,CVTRAC                LOAD RACF CVT ADDRESS  @ZA25881 02540732
         LTR   R1,R1                    IS RACF INSTALLED      @ZA25881 02540832
         BZ    ERRX08                   NO -ERROR-NO RACHECKS  @ZA25881 02540932
*                                       WITHOUT RACF           @ZA25881 02541032
         USING RCVT,R1                  ADDRESS RACF CVT       @ZA25881 02541132
         TM    RCVTSTA1,RCVTDASD        TEST FOR DASDVOL       @ZA25881 02541232
*                                       PROTECTION OPTION      @ZA25881 02541332
         BNO   ERRX08                   BRANCH IF NOT                   02541432
***                                                                     02541532
***                                                                     02541632
*                                                              @G32DSPD 02541732
* ALLOW USER TO SCRATCH IF HE HAS ALTER ACCESS TO THE VOLUME   @G32DSPD 02541832
         MVC   RACHECK(LVRACHEK),VRACHECK BUILD RACHECK        @G32DSPD 02541932
         RACHECK ENTITY=PVOLSER,                               @G32DSPD*02542032
               MF=(E,RACHECK)                                  @G32DSPD 02542132
         LTR   WORKREG,WORKREG          USER AUTHORIZED ?      @G32DSPD 02542232
         BNZ   ERRX08                   NO,NOT AUTHORIZED      @G32DSPD 02542332
         OI    SISW1,VOLRACHK           YES,VOLUME AUTHORIZED  @G32DSPD 02542432
         B     NAMEOKAY                 OKAY TO GO SCRATCH     @G32DSPD 02542532
ERRX08   EQU   *                        RAC ERROR              @Z40RSGD 02544532
         MVI   STATUS(VOLISTX),RACERROR POST RAC ERROR         @Z40RSGD 02544632
         B     ERREXIT                  ERROR-TERMINATE        @Z40RSGD 02545032
*                                       SCRATCH                @Z40RSGD 02545432
NORACHCK EQU   *                        RACHECK WAS NOT        @Z40RSGD 02545832
         TM    STYPEFLG,PSWDCHKD        WAS PASSWORD CHECKED     Y02082 02546632
         BO    NAMEOKAY                 BRANCH IF YES            Y02082 02548432
         TM    DS1DSIND,PSWDDS          TEST IF PASSWORD PROTECT Y02082 02551332
         BZ    NAMEOKAY                 BRANCH IF NO.                   02554232
         OI    STYPEFLG,PSWDCHKD        SET PASSWORD CHECKED BIT Y02082 02557132
         L     R1,DSABADDR              DSAB ADDR IN REGISTER 1  Y02082 02560002
         LA    R4,DS1FMTID              POINTER TO F1 DSCB       Y02134 02580002
         LA    R11,PDSNAME              POINT TO DATA SET NAME.  YM1337 02600002
         LA    R10,3                    INDICATE TO READPSWD THAT IT    02620000
         SLL   R10,24                   WAS CALLED BY SCRATCH.          02640000
         LA    R5,IOB                   POINT TO IOB.                   02660000
         LA    R2,SECLOAD               POINT TO SECLOADA        Y02080 02680002
         SR    RETURN,RETURN            SET ENTRY OFFSET         Y02134 02685002
         B     XCTLEXIT                 GO BRANCH TO SECLOADA    Y02080 02700002
*                                                                       02765021
* THIS SECTION TESTS IF THE PURGE DATE IS PAST.                         02770021
*                                                                       02775021
PASSOKAY EQU   *                                                        02780000
         XC    SEEK,SEEK                ZERO SEEK ADDRESS        Y02080 02785002
         MVC   SEEK+SEEKCYL(K5),VTOCADR  RESTORE SEEK ADDRESS    Y02080 02790002
         L     PL,OLDPLPTR              PICK UP PARAMETER LIST POINTER  02800000
         LA    R6,CCW1                  RESTORE CCW POINTER IN IOB.     02820000
         ST    R6,IOB+16                                                02840000
NAMEOKAY EQU   *                                                        02860000
         TM    DS4VTOCI,X'80'           IS THIS A BOS PACK              02880000
         BZ    STOREPTR                                                 02900000
         OI    DADSMTBL,2              SET BOS BIT.                     02920000
STOREPTR MVC   OUTCCHHR(5),OUTDSCB+135  STORE FMT 1 DSCB CCHHR          02940000
         SR    WORKREG,WORKREG          ZERO REG                        02960000
         STC   WORKREG,ERCODE           TURN OFF FIRST PASS INDICATOR   02980000
         IC    WORKREG,OUTCCHHR+4       PICK UP R OF NEXT RECORD        03000000
         BCTR  WORKREG,R0               DECREMENT R BY ONE              03020000
         LTR   WORKREG,WORKREG          TEST FOR LAST RECORD            03040000
         BNE   NOTLAST                                                  03060000
         IC    WORKREG,DS4DEVDT         PICK UP R OF LAST RECORD        03080000
NOTLAST  STC   WORKREG,OUTCCHHR+4       STORE R                         03100000
         TM    2(PL),X'10'              TEST FOR PURGE DATE OVERRIDE    03140000
         BO    EXITMOD                  IF YES, GO PREPARE       S21040 03150021
*                                       TO XCTL                         03160021
         USING CVT,RCVTT                CVT ADDRESSABILITY     @ZA25881 03165032
         L     RCVTT,CVTPTR             RELOAD CVT ADDRESS     @ZA25881 03170032
         L     R2,CVTDATE               LOAD CURRENT DATE IN PACKED DEC 03180000
         XC    FIELD1(6),FIELD1         ZERO DOUBLE WORD FIELD          03200000
         STH   R2,FIELD1+6              STORE DDDZ IN DOUBLE WORD FIELD 03220000
         SRDL  R2,4                     SHIFT Z TO REG 3                03240000
         SRL   R2,12                    SHIFT DDD OUT OF REG 2          03260000
         SLDL  R2,4                     SHIFT Z TO REG 2                03280000
         CVB   R3,FIELD1                CONVERT DDDZ TO BINARY          03300000
         STH   R2,FIELD1+6              STORE 0YYZ IN DOUBLE WORD FIELD 03320000
         CVB   R2,FIELD1                CONVERT 0YYZ TO BINARY          03340000
         STH   R3,FIELD1+6              STORE BINARY DD (DAY OF YEAR)   03360000
         STC   R2,FIELD1+5              STORE BINARY Y  (YEAR)          03380000
         CLC   DS1EXPDT(3),FIELD1+5     COMPARE PURGE DATE AND DATE     03400000
         BH    NOPURGE                                                  03420000
EXITMOD  EQU   *                        EXIT                     Y02080 03820002
         LA    R2,LOAD3                 MODULE ID OF IGG0299A    S21040 04620021
         B     XCTLEXIT                 GO XCTL TO IGG0299A      S21040 05020021
NOPURGE  EQU   *                        PURGE DATE ERROR         Y02078 05720002
         LA    R3,PURGERR               SET PURGE DATE ERROR     Y02078 05730002
         B     SETCODE                                                  05740000
NODSCB   EQU   *                        NO F1 DSCB               Y02078 05760002
         LA    R3,NOF1                  SET NO F1 DSCB ERROR     Y02078 05770002
         B     SETCODE                                                  05780000
*                                                                       05785021
* THIS ROUTINE EXECUTES A CHANNEL PROGRAM.                              05790021
*                                                                       05795021
EXCPIO   EQU   *                                                        05800000
         EXCP  IOB                      EXECUTE CHANNEL PROGRAM.        05840000
         WAIT  ECB=ECB                  WAIT FOR COMPLETION.            05860000
         TM    ECB,X'20'                TEST FOR I/O ERROR.             05880000
         BCR   7,RETURN                 RETURN IF OKAY.                 05900000
PERMERR  EQU   *                                                SA56391 05910002
         LA    R3,IOERR                 SET I/O ERROR            Y02078 05920002
         B     SETCODE                                           M3097  05940019
PSWDEXIT EQU   *                                                 M3097  05960019
         OI    STYPEFLG,EXITBIT         SET EXIT BIT             YM7039 05970002
         LA    R3,PSWDERR               SET PASSWORD ERROR       Y02078 05980002
SETCODE  EQU   *                                                 M3097  06000019
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 06005002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 06010002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 06015002
         STC   R3,STATUS(VOLISTX)       PUT ERROR CODE IN VOLIST Y02078 06020002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 06025002
         DROP  R1                                                Y02078 06030002
ERREXIT  EQU   *                        ERROR EXIT               Y02082 06035002
         LA    WORKREG,RTNCODE8         SET ERROR CODE OF 8      Y02082 06040002
         STH   WORKREG,ERCODE           SAVE CALLER'S ERROR CODE Y02082 06045002
         LA    R2,LOAD4                 POINT TO PROPER ID.             06060000
XCTLEXIT EQU   *                        EXIT                     Y02080 06065002
         IECRES LOAD,EXTPR=(RWKAREA),MODNM=(R2),BRANCH=DIRECT    Y02080 06070002
*                                                                       06085021
*** PROGRAM CONSTANTS                                                   06100000
*                                                                       06120000
*                                                                       06125002
*        DEB ACCESS METHOD TYPE VALUES                                  06130002
*                                                                       06135002
AMBPAM   DEBCHK AM=BPAM,MF=L            BPAM AMTYPE              Y02082 06140002
AMBDAM   DEBCHK AM=BDAM,MF=L            BDAM AMTYPE              Y02082 06145002
AMSAM    DEBCHK AM=SAM,MF=L             SAM AMTYPE               Y02082 06150002
AMEXCP   DEBCHK AM=EXCP,MF=L            EXCP AMTYPE              Y02082 06155002
AMISAM   DEBCHK AM=ISAM,MF=L            ISAM AMTYPE              Y02082 06160002
*                                                                       06180000
*** THE FOLLOWING CHANNEL PROGRAM SEARCHES THE VTOC FOR THE NAMED DSCB. 06200000
*** THE VTOC DSCB AND THE NAMED DSCB ARE READ INTO THE INPUT AREAS.     06220000
*                                                                       06240000
CHANPROG DS    0F                                                       06260000
*CCW1                                                                   06280000
         DC    X'31'                    SEARCH EQUAL ID (INCCHHR)       06300000
         DC    AL3(0+INCCHHR-FIRST)                                     06320000
         DC    X'4000'                                                  06340000
         DC    H'5'                                                     06360000
*CCW2                                                                   06380000
         DC    X'08'                    TIC TO CCW1                     06400000
         DC    AL3(0+CCW1-FIRST)                                        06420000
         DC    F'0'                                                     06440000
*CCW3                                                                   06460000
         DC    X'06'                    READ DATA (VTOC DSCB)           06480000
         DC    AL3(0+VTOCDSCB-FIRST)                                    06500000
         DC    X'4000'                                                  06520000
         DC    H'96'                                                    06540000
*CCW4                                                                   06560000
         DC    X'F1'                    SERACH HI-EQ ID (LAST FMT 1)    06580000
         DC    AL3(0+DS4HPCHR-FIRST)                                    06600000
         DC    X'4000'                                                  06620000
         DC    H'5'                                                     06640000
*CCW5                                   TO BE CONSTRUCTED               06660000
*                                       TIC TO CCW9                     06680000
*CCW6                                   TO BE CONSTRUCTED               06700000
*                                       SEARCH EQUAL KEY (DS NAME)      06720000
*CCW7                                   TO BE CONSTRUCTED               06740000
*                                       READ DATA OF THE LAST   SA48172 06750002
*                                       FORMAT 1 WITH THE SKIP  SA48172 06752002
*                                       BIT SET IN ORDER TO END SA48172 06754002
*                                       THE CHANNEL PROGRAM     SA48172 06756002
*CCW8                                   TO BE CONSTRUCTED               06780000
*                                       TIC TO CCW11                    06800000
*CCW9                                                                   06820000
         DC    X'29'                    SEARCH EQUAL KEY (DS NAME)      06840000
         DC    AL3(PDSNAME-FIRST)                                YM1337 06860002
         DC    X'6000'                                                  06880000
         DC    H'44'                                                    06900000
*CCW10                                                                  06920000
         DC    X'08'                    TIC TO CCW4                     06940000
         DC    AL3(0+CCW4-FIRST)                                        06960000
         DC    H'0'                                              O19117 06970019
THREE    DC    H'3'                                              O19117 06980019
*CCW11                                                                  07000000
         DC    X'06'                    READ DATA (INDSCB+44)           07020000
         DC    AL3(44+INDSCB-FIRST)                                     07040000
         DC    X'4000'                                                  07060000
         DC    H'96'                                                    07080000
*CCW12                                                                  07100000
         DC    X'12'                    READ COUNT (INTO OUTDSCB+136)   07120000
         DC    AL3(135+OUTDSCB-FIRST)                                   07140000
         DC    X'2000'                                                  07160000
         DC    H'5'                                                     07180000
RCUNAUTH DC    X'08'                    UNAUTH RETURN CODE     @Z40RSRB 07187032
MRACHECK RACHECK CLASS='DATASET',       MASTER RACHECK         @G32DSPDX07188032
               DSTYPE=N,                PARAMETER LIST         @Z40RSGDX07192032
               ATTR=ALTER,                                     @Z40RSGDX07194032
               MF=L                                            @Z40RSGD 07196032
LRACHECK EQU   *-MRACHECK               LENGTH RACHECK         @Z40RSGD 07198032
*                                       PARAMETER LIST         @Z40RSGD 07198432
* MASTER RACF PARAMETER LIST FOR VOLUME RACHECKS               @G32DSPD 07198832
VRACHECK RACHECK CLASS='DASDVOL',                              @G32DSPD*07199032
               ATTR=ALTER,                                     @G32DSPD*07199232
               MF=L                                            @G32DSPD 07199432
LVRACHEK EQU   *-VRACHECK               PARAMETER LIST LENGTH  @G32DSPD 07199632
*                                                                       07200000
*** TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                     07300002
*                                                                       08072002
         XCTLTABL ID=(LOAD3,IGG0299A,LOAD4,IGG0290D,             Y02080X08080002
               SECLOAD,SECLOADA),SVC=029,LENGTH=,BRT=YES         Y02080 08085002
         SPACE 2                                                 Y02082 08090002
         IECDSECS CVT,RB,TCB,JSCB,IEZDEB,UCB,PSA,EXPAND=YES      Y02082 08095002
WORKAREA IECSCRWA EP,F4,D1=(1)          SCRATCH WORK AREA        Y02080 08100002
RACHECK  EQU   SCRTHWKA                 RACHECK PARAMETER LIST @Z40RSGD 08150032
         ICHPRCVT                       RACF CVT               @ZA25881 09420032
         END                                                            09470032
./  ADD  SSI=53470392,NAME=IGG0290B
         TITLE 'IGG0290B - DADSM SCRATCH - UPDATE FORMAT 6 DSCB' A36312 00018021
IGG0290B CSECT                                                          00021021
*TITLE   DADSM SCRATCH  UPDATE FORMAT 6 DSCB                            00026018
*          RELEASE 17 DELETIONS                                         00032018
*          RELEASE 18 DELETIONS                                         00038018
*0095031800,033800,034800,035800-041200,043200                    20344 00041018
*0095028600,029000                                                20873 00044018
*          RELEASE 19 DELETIONS                                         00050018
*          RELEASE 20 DELETIONS                                         00056018
*1021025200,057400,059000                                        A31333 00059020
*          RELEASE 21 DELETIONS                                         00062018
*1198000200,001800-002200,002600-002800,003600-005000,005400-    A36312 00063021
*1198005600,010800-011200,025420-025500,026000,029400,031400,    A36312 00064021
*1198034660,035000-035200,036400-036700,037300-038700,041600,    A36312 00065021
*1198071400                                                      A36312 00066021
*          RELEASE 21.7 DELETIONS                                       00066402
*0000000680-000860,006200,057300-059000,066600-068000           SA56400 00066802
*          VS1 RELEASE 2 DELETIONS                                      00068802
*0000                                                           XM1038  00070802
*                                                                       00076802
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00080002
*0000000030-000150,001000,003200,004600,011800-012000,035800,    Y02080 00080102
*0000036000,047860,048600-049600,057240,059050-070600,071000-    Y02080 00080202
*0000071200                                                      Y02080 00080302
*0000002240,011040,016400-016600                                 Y02078 00080402
*0000                                                            Y02082 00080502
*                 VS2 RELEASE 030 CHANGES                               00083503
*0000                                                          @ZA07591 00086503
*                                                                       00090002
*                                                                       00091002
* MODULE NAME - IGG0290B                                                00092002
*                                                                       00092202
* DESCRIPTIVE NAME - DADSM SCRATCH - UPDATE FORMAT 6 DSCB               00092402
*                                                                       00092602
* COPYRIGHT - NONE                                                      00092802
*                                                                       00092902
* CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD          00093902
*                                                                       00094102
* STATUS CHANGE LEVEL 003                                               00094902
*ATTRIBUTES - REENTRANT                                                 00100002
*                                                                       00120000
*FUNCTION - THIS MODULE UPDATES THE EXTENTS IN THE FORMAT 6 DSCB        00140000
*          RECORDS. THE NEW EXTENTS ARE PASSED TO THIS MODULE IN        00160000
*          A TABLE IN THE WORK AREA. FOR EACH SPLIT CYLINDER DATA SET   00168021
*          ENTRY IN THIS DADSM TABLE, THE CORRESPONDING EXTENT IS       00176021
*          FOUND IN A FORMAT 6 DSCB, AND ITS DATA SET COUNT IS          00184021
*          DECREMENTED BY ONE. IF THIS BYTE BECOMES ZERO, THE SPACE     00192021
*          DESCRIBED BY THE FORMAT 6 EXTENT IS FREED, AND ITS           00200021
*          RTA/RTA+1 IS PLACED IN THE DADSM TABLE SO THAT A LATER       00208021
*          LOAD OF SCRATCH CAN ADD THIS AVAILABLE SPACE TO A            00216021
*          FORMAT 5 DSCB. IF THE DOS BIT OR DIRF BIT IS SET IN THE      00224002
*          FORMAT 4 DSCB, THE EXTENTS WILL NOT BE RETURNED TO THE       00226002
*          FORMAT 5 DSCB, AND CONTROL IS PASSED DIRECTLY TO THE         00228002
*          LAST LOAD OF SCRATCH.                                        00230002
*                                                                       00240000
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG0290B. ENTRY       00260021
*          IS MADE FROM IGG0299A.                                       00280021
*                                                                       00300000
*                                                                       00340000
*SUPERVISOR CALLS ISSUED:                                               00370021
*          EXCP(0)  READ FROM OR WRITE TO A DIRECT ACCESS DEVICE        00400021
*          WAIT(1)  WAIT ON AN EVENT CONTROL BLOCK                      00430021
*                                                                       00520000
*MACROS USED:                                                           00540021
*          IECDSECS - EXPANDS THE CVT, RB, AND TCB DSECTS               00550002
*          IECSDSL1 - ENABLES SYMBOLIC ADDRESSING OF DSCBS              00560021
*          IECSCRWA - SCRATCH WORK AREA EXPANSION                       00570002
*                                                                       00580000
*INPUT - AT ENTRY TO THIS MODULE REGISTER 13 POINTS TO THE WORK AREA.   00600000
*                                                                       00610021
*OUTPUT - UPDATED FORMAT 6 DSCB. REGISTER 9 INDICATES NUMBER OF         00620002
*         EXTENTS IN DADSM TABLE.                                       00630002
*                                                                       00640000
*ERROR CONDITION - THE ONLY ERROR INDICATED IS PERMANENT I/O ERROR.     00660000
*                                                                       00662002
*NOTES - UNLIKE THE ALLOCATE, EXTEND, AND PARTIAL RELEASE FUNCTIONS     00664002
*        OF DADSM, IF THE DIRF BIT IS SET IN THE FORMAT 4 DSCB IN       00666002
*        THE SCRATCH WORK AREA, THIS INDICATES THAT THE DIRF BIT        00668002
*        WAS PREVIOUSLY SET IN THE FORMAT 4 DSCB.                       00670002
*                                                                       00680000
*REGISTER USAGE                                                         00700000
R0       EQU   0                                                        00720000
R1       EQU   1                                                        00740000
R2       EQU   2                                                        00760000
INDEX2   EQU   2                                                        00780000
R3       EQU   3                                                        00800000
INDEX3   EQU   3                                                        00820000
INDEX4   EQU   4                                                        00840000
COUNT1   EQU   5                                                        00860000
EXTCTR   EQU   6                                                        00880000
COUNT3   EQU   7                                                        00900000
VOLISTX  EQU   8                                                        00920000
COUNT4   EQU   9                                                        00940000
INDEX1   EQU   10                                                       00960000
RTA      EQU   11                                                       00980000
RBASE    EQU   12                                                       01000000
RWKAREA  EQU   13                                                       01020000
RETURN   EQU   14                                                       01040000
WORKREG  EQU   15                                                       01060000
*                                                                       01070021
* OTHER EQUATES                                                         01080021
*                                                                       01090021
ONE      EQU   1                        VALUE ONE                A36312 01100021
K5       EQU   5                        CONSTANT OF FIVE        SA56400 01102002
DOSBIT   EQU   X'80'                    TEST FOR DOS VOLUME      Y02078 01104002
DIRFBIT  EQU   X'04'                    TEST FOR DIRF BIT        Y02078 01106002
*                                                                       01110021
         BALR  RBASE,R0                                                 01140000
         USING BEGIN,RBASE                                              01160000
         USING SCRTHWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 01180002
*                                                                       01204021
* THIS SECTION MODIFIES THE CHANNEL PROGRAM TO READ AND WRITE           01208021
* FORMAT 6 DSCB'S.                                                      01212021
*                                                                       01216021
BEGIN    MVC   CCW5(8),CCW7            STORE CCW5                       01220000
         LM    R0,R1,CCW2              PICK UP TIC CONSTANT             01240000
         LA    WORKREG,CCW2-CCW1                                        01260000
         AR    R0,WORKREG              RESOLVE ADDR IN CCW4             01280000
         STM   R0,R1,CCW4              STORE CCW4                       01300000
         LA    WORKREG,CCW6-CCW2                                        01320000
         AR    R0,WORKREG              RESOLVE ADDR IN CCW7             01340000
         STM   R0,R1,CCW7              STORE CCW7                       01360000
         MVC   CCW2(8),CCW12           SET UP CCW2                      01380000
         MVI   CCW2,X'92'                                               01400000
         MVI   CCW2+4,X'60'            STORE CCW2                       01420000
*                                       RETAIN CCW10                    01440000
*                                       RETAIN CCW11                    01460000
         MVC   CCW6(8),CCW1            STORE CCW6                       01480000
         MVC   CCW9(8),CCW1            STORE CCW9                       01500000
         MVC   CCW1(8),CCW8            STORE CCW1                       01520000
         LM    R0,R3,CHALPROG          LOAD CCW CONSTANTS               01540000
         AR    R0,RWKAREA              RESOLVE ADDR IN CCW3             01560000
         AR    R2,RWKAREA              RESOLVE ADDR IN CCW8             01580000
         STM   R0,R1,CCW3              STORE CCW3                       01600000
         STM   R2,R3,CCW8              STORE CCW8                       01620000
         TM    DS4VTOCI,DOSBIT+DIRFBIT  TEST IF DOS AND/OR DIRF  Y02078 01640002
*                                      BIT IS SET IN THE F4 DSCB Y02078 01650002
         BNZ   LEAVE                   IF EITHER IS SET, DO NOT  Y02078 01660002
*                                      RETURN EXTENTS TO THE F5  Y02078 01670002
         SR    R0,R0                   ZERO REG                         01680000
         LR    EXTCTR,R0               ZERO EXTENT COUNTER              01700000
         IC    EXTCTR,EXTNUM           PICK UP NUMBER OF ENTRIES        01720000
         LTR   EXTCTR,EXTCTR           TEST FOR NO ENTRIES              01740000
         BZ    LEAVE                   BR IF NONE               SA56400 01760002
*                                                                       01765021
* THIS SECTION SORTS THE DADSM TABLE ENTRIES INTO ASCENDING ORDER.      01770021
*                                                                       01775021
NEWPASS  LA    INDEX1,ENTRIES          POINT INDEX1 TO FIRST ENTRY      01780000
         LA    INDEX2,4(INDEX1)        POINT INDEX2 TO SECOND ENTRY     01800000
         LA    INDEX3,1                INITIALIZE COMPARE COUNTER       01820000
         BCT   EXTCTR,NEWPAIR          DECREMENT EXTENT COUNTER         01840000
         B     TESTCYLS                BRANCH WHEN NUM OF EXTS = 1      01860000
*                                                                       01880000
SHIFT    LR    INDEX1,INDEX2           POINT INDEX1 TO ITS NEXT ENTRY   01900000
         LA    INDEX2,4(INDEX2)        POINT INDEX2 TO ITS NEXT ENTRY   01920000
         CLR   INDEX3,EXTCTR           IS NUM COMPARES = NUM OF EXTS-1  01940000
         BE    NEWPASS                 BR IF YES                        01960000
         LA    INDEX3,1(INDEX3)        INCREMENT COMPARE COUNTER        01980000
NEWPAIR  CLC   0(2,INDEX1),0(INDEX2)   COMPARE ON LOW RTA               02000000
         BNH   SHIFT                   BR IF PROPER ORDER               02020000
EXCHANGE MVC   FIELD1(4),0(INDEX1)     TEMP STORE THE INDEX1 ENTRY      02040000
         MVC   0(4,INDEX1),0(INDEX2)   MOVE INDEX2 ENTRY TO INDEX1      02060000
         MVC   0(4,INDEX2),FIELD1      MOVE INDEX1 ENTRY TO INDEX2      02080000
         B     SHIFT                                                    02100000
*                                                                       02120000
* THIS SECTION INITIALIZES THE EXTENT POINTERS AND EXTENT COUNTERS FOR  02125021
* THE FORMAT 6 INPUT DSCB, FORMAT 6 OUTPUT DSCB, AND DADSMTBL ENTRIES.  02130021
*                                                                       02135021
TESTCYLS TM    DADSMTBL,X'08'          TEST FOR SHARED CYLINDERS        02140000
         BZ    FINISH                                                   02160000
         IC    EXTCTR,EXTNUM           PICK UP NUMBER OF ENTRIES        02180000
         MVC   INDSCB+44(90),INDSCB+45 OVERLAY FORMAT BYTE              02200000
         MVI   INDSCB+134,X'00'                                   20344 02210018
         XC    OUTDSCB(140),OUTDSCB    ZERO OUTPUT DSCB                 02220000
         LA    INDEX2,ENTRIES          POINT TO FIRST ENTRY IN TABLE    02240000
         LA    COUNT1,26               PICK UP NUMBER OF EXTENTS (IN)   02260000
         LA    INDEX1,INDSCB+4         POINT TO EXTENTS IN INPUT DSCB   02280000
         LR    COUNT3,COUNT1           PICK UP NUMBER OF EXTENTS (OUT)  02300000
         LA    INDEX3,OUTDSCB+5        POINT TO EXTENTS IN OUTPUT DSCB  02320000
         LR    INDEX4,INDEX2           POINT TO ENTRIES IN TABLE        02340000
         LR    COUNT4,R0               ZERO REG                         02360000
         LR    RTA,R0                  ZERO REG                         02380000
         MVC   OUTCCHHR(5),INCCHHR     PICK UP OUTPUT CCHHR             02400000
         MVC   NEXTDADS(5),INCCHHR     HOLD OUTPUT CCHHR                02420000
         MVC   INCCHHR(5),DS5PTRDS     PICK UP CONT POINTER             02440000
*                                                                       02445021
* THIS SECTION COMPARES THE DADSMTBL ENTRY TO A FORMAT 6 INPUT EXTENT.  02450021
*                                                                       02455021
COMPARE  CLI   2(INDEX2),X'FF'         CHECK EXTENT TYPE                02460000
         BNE   NOTSPLIT                BR IF NOT SPLIT CYL              02480000
         CLC   0(2,INDEX2),0(INDEX1)   CHECK RTA OF ENTRY WITH F6       02500000
         BL    PERMERR                 BR IF PAST RIGHT ONE             02540000
         BE    DECRMENT                 BRANCH IF EQUAL          A31333 02541020
         CLC   0(4,INDEX2),FAKEXT       IS THIS A DUMMY EXTENT?  A36312 02541921
         BE    MOVEEXT                  BRANCH IF YES            A36312 02542821
         BAL   RETURN,WITHINF6          CALCULATE RTA+1 OF F6    A36312 02543721
*                                       EXTENT                   A36312 02544621
         CH    R1,0(INDEX2)             TEST IF ENTRY LIES       A36312 02545521
*                                       WITHIN THE F6 EXTENT     A36312 02546421
         BNH   MOVEEXT                  BRANCH IF NO             A36312 02547321
*                                                                       02548221
* THIS SECTION DECREMENTS THE DATA SET COUNT BYTE IN THE F6 EXTENT.     02549121
*                                                                       02550021
DECRMENT EQU   *                                                 A31333 02551020
         SR    WORKREG,WORKREG         ZERO REG                         02560000
         IC    WORKREG,4(INDEX1)       PICK UP Z (NUM OF DATA SETS)     02580000
         BCT   WORKREG,LOOKAHED         DECREMENT DATA SET CTR   A36312 02586021
*                                       BRANCH IF GREATER THAN 0 A36312 02592021
*                                                                       02598021
* THIS SECTION MOVES THE RTA/RTA+1 OF THE F6 EXTENT TO THE DADSMTBL.    02604021
*                                                                       02610021
         MVC   0(4,INDEX4),0(INDEX1)   MOVE XXYY TO DADSMTBL            02620000
         LH    RTA,2(INDEX4)           PICKUP NO. OF CYLS (YY)          02640000
         MH    RTA,DS4DEVSZ+2          MULT BY TKS PER CYL              02660000
         AH    RTA,0(INDEX4)           ADD BEGIN RTA                    02680000
         STH   RTA,2(INDEX4)           STORE END RTA+1 IN DADSM TABLE   02700000
INCINDX  EQU   *                                                        02720000
         LA    COUNT4,1(COUNT4)        INCREMENT ENTRY COUNTER          02740000
         LA    COUNT3,1(COUNT3)         INCREMENT OUTPUT COUNTER  20344 02750018
         LA    INDEX4,4(INDEX4)        INCREMENT ENTRY POINTER (NEW)    02760000
         BCT   EXTCTR,NXTENTRY         DECREMENT ENTRY COUNTER          02780000
         B     ENDENTRY                                                 02800000
*                                                                       02820000
* THIS SECTION INCREMENTS THE DADSMTBL POINTERS AND COUNTER.            02826021
*                                                                       02832021
NOTSPLIT EQU   *                                                        02840000
         MVC   0(4,INDEX4),0(INDEX2)    COMPACT DADSM TABLE.            02880000
         LA    COUNT4,1(COUNT4)         INCREMENT ENTRY COUNTER   20873 02886018
         LA    INDEX4,4(INDEX4)         INCREMENT ENTRY PTR(NEW)  20873 02892018
         LA    INDEX2,4(INDEX2)                                   20873 02898018
         BCT   EXTCTR,COMPARE                                     20873 02904018
         MVC   0(5,INDEX3),0(INDEX1)   MOVE XXYYZ TO OUT DSCB  @ZA07591 02907003
         B     ENDENTRY                                           20873 02910018
*                                                                       02920000
* THIS SECTION TESTS IF THE NEXT ENTRY LIES WITHIN THE SAME F6 EXTENT.  02922021
* IF NOT, IT MOVES THE XXYY OF THE F6 EXTENT AND THE NEW Z INTO THE     02924021
* OUTPUT F6 DSCB.                                                       02926021
*                                                                       02928021
LOOKAHED EQU   *                                                 A36312 02930021
         CH    EXTCTR,ONEENTRY          IS THIS THE LAST ENTRY   A36312 02932021
         BE    MOVEXXYY                 BRANCH IF LAST ENTRY     A36312 02934021
         BAL   RETURN,WITHINF6          CALCULATE RTA+1 OF F6    A36312 02936021
*                                       EXTENT                   A36312 02938021
         CH    R1,4(INDEX2)             DOES NEXT ENTRY LIE      A36312 02940021
*                                       WITHIN SAME F6 EXTENT    A36312 02942021
         BH    SAVENEWZ                 BRANCH IF YES            A36312 02944021
MOVEXXYY EQU   *                                                 A36312 02946021
         MVC   0(4,INDEX3),0(INDEX1)    MOVE XXYY TO OUTPUT DSCB A36312 02948021
         STC   WORKREG,4(INDEX3)       STORE NEW Z IN OUTPUT DSCB       02960000
         BCT   EXTCTR,NXTENTRY         DECREMENT ENTRY COUNTER          02980000
*                                                                       02990021
ENDENTRY LA    INDEX2,FAKEXT           POINT TO PSEUDO ENTRY            03000000
         B     CHECKIN                                                  03020000
*                                                                       03040000
NXTENTRY LA    INDEX2,4(INDEX2)        INCREMENT ENTRY POINTER (OLD)    03060000
         B     CHECKIN                                                  03080000
*                                                                       03100000
SAVENEWZ EQU   *                                                 A36312 03102021
         STC   WORKREG,4(INDEX1)        STORE NEW DATA SET COUNT A36312 03104021
         BCTR  EXTCTR,0                 DECREMENT NO OF ENTRIES  A36312 03106021
         LA    INDEX2,4(INDEX2)         POINT TO NEXT ENTRY      A36312 03108021
         B     COMPARE                  GO COMPARE               A36312 03110021
*                                                                       03112021
* THIS SECTION CHECKS TO SEE IF THERE ARE ANY MORE EXTENTS IN THE F6    03114021
* INPUT DSCB. IF NOT, IT READS THE NEXT F6 IN THE CHAIN.                03116021
*                                                                       03118021
MOVEEXT  MVC   0(5,INDEX3),0(INDEX1)   MOVE XXYYZ TO OUTPUT DSCB        03120000
CHECKIN  EQU   *                                                 A36312 03130021
         BCT   COUNT1,MOREIN            DECREMENT INPUT EXTENT   A36312 03140021
*                                       COUNTER                  A36312 03150021
         TM    INCCHHR+4,X'FF'         TEST FOR CONT POINTER            03160000
         BZ    LASTEXT1                                           20344 03180018
         LA    WORKREG,INCCHHR         SET UP NEW CCW9                  03200000
         ST    WORKREG,CCW9                                             03220000
         MVI   CCW9,X'31'              STORE CCW9                       03240000
         LA    WORKREG,CCW9                                             03260000
         NI    CCW11+4,X'EF'           TURN OFF SKIP FLAG               03280000
         MVC   SEEK+3(5),INCCHHR       SET UP IOS SEEK                  03300000
         BAL   RETURN,EXECUTIO         READ NEXT DSCB                   03320000
         MVC   CCW9(4),CCW6            RESTORE CCW9                     03340000
         MVC   NEXTDADS(5),INCCHHR     HOLD CCHHR                       03360000
         MVC   INDSCB+44(90),INDSCB+45 OVERLAY FORMAT BYTE              03400000
         MVI   INDSCB+134,X'00'                                   20344 03410018
         LA    COUNT1,26               PICK UP NUMBER OF EXTENTS (IN)   03420000
         LA    INDEX1,INDSCB+4         POINT TO EXTENTS IN INPUT DSCB   03440000
         B     CHECKOUT                                                 03460000
LASTEXT1 EQU   *                                                  20344 03462018
         CLC   OUTDSCB+5(4),ZERO        ANY EXTENTS               20344 03464018
         BE    LASTEXT3                 BRANCH IF NO EXTENTS     A36312 03466021
         LA    RETURN,ENDUPD2                                     20344 03468018
*                                                                       03468521
* THIS SECTION WRITES FORMAT 6 AND FORMAT 0 DSCBS.                      03469021
*                                                                       03469521
WRTFMT6  EQU   *                                                  20344 03470018
         MVC   OUTDSCB(4),SIX           MOVE IN 06060606          20344 03472018
         MVC   OUTDSCB+4(40),OUTDSCB+5  SHIFT KEY PORTION         20344 03474018
         MVI   OUTDSCB+44,X'F6'         INSERT FMT6 ID            20344 03476018
WRTFMT62 EQU   *                                                  20344 03478018
         MVC   SEEK+3(5),OUTCCHHR       SET UP IOS SEEK           20344 03480018
         LA    WORKREG,CCW6             PICK UP START CCW,S       20344 03482018
         OI    CCW11+4,X'10'            TURN ON SKIP FLAG         20344 03484018
         B     EXECUTIO                 EXCP                      20344 03486018
*                                                                       03489021
* THIS SECTION TESTS IF THERE ARE ANY MORE EXTENTS IN THE OUTPUT DSCB.  03492021
* IF NOT, IT WRITES OUT THE OUTPUT FORMAT 6 DSCB.                       03495021
*                                                                       03498021
MOREIN   EQU   *                                                 A36312 03501021
         LA    INDEX1,5(INDEX1)         INCREMENT INPUT EXTENT   A36312 03504021
*                                       POINTER                  A36312 03507021
CHECKOUT EQU   *                                                 A36312 03510021
         BCT   COUNT3,MOREOUT           DECREMENT EXTENT CTR     A36312 03513021
*                                       BRANCH IF MORE EXTENTS   A36312 03516021
*                                                                       03519021
* THIS SECTION TESTS IF THE FORMAT 6 POINTER IN THE FORMAT 4 DSCB       03522021
* NEEDS TO BE ZEROED.                                                   03525021
*                                                                       03528021
LASTEXT2 CLC   OUTDSCB+5(4),ZERO       TEST FOR NO EXTENTS              03540000
         BNE   DADSOUT1                BR IF AN EXTENT                  03560000
LASTEXT3 EQU   *                                                  20344 03570018
         CLC   OUTCCHHR,DS4F6PTR        TEST IF FIRST F6 DSCB    Y02080 03580002
         BNE   ENDUPDAT                                           20344 03590018
         XC    DS4F6PTR,DS4F6PTR        ZERO F6 PTR IN F4 DSCB   Y02080 03600002
         B     ENDUPDAT                                           20344 03610018
*                                                                       03611021
* THIS SECTION TESTS IF THE CHAINING POINTER OF THE FORMAT 6 DSCB       03612021
* NEEDS TO BE FILLED IN. IF THERE IS ONLY ONE ENTRY LEFT IN THE         03613021
* DADSMTBL, THIS LAST ENTRY IS A SPLIT CYLINDER ENTRY, THERE IS         03614021
* ONLY ONE EXTENT LEFT IN THE INPUT FORMAT 6 DSCB, ITS DATA SET         03615021
* COUNT IS ONE, AND THE RTA/RTA+1 OF THE ENTRY IS CONTAINED IN          03616021
* THE RTA/RTA+1 OF THE INPUT FORMAT 6 EXTENT, THEN THE CHAINING         03617021
* POINTER IN THE OUTPUT FORMAT 6 IS ZERO.                               03618021
*                                                                       03619021
DADSOUT1 EQU   *                                                  20344 03620018
         TM    4(INDEX1),X'FF'          ANY ENTRIES LEFT          20344 03630018
         BZ    DADSOUT2                 BRANCH IF NOT            A36312 03631021
         LTR   EXTCTR,EXTCTR            ANY ENTRIES LEFT         A36312 03632021
         BZ    NEWF6                    BRANCH IF NOT            A36312 03633021
         TM    9(INDEX1),X'FF'          IS THERE A SECOND EXTENT A36312 03634021
*                                       IN THE INPUT AREA        A36312 03635021
         BC    7,NEWF6                  BRANCH IF YES            A36312 03636021
         CLI   4(INDEX1),ONE            IS THE DATA SET COUNT 1  A36312 03637021
         BNE   NEWF6                    BRANCH IF NOT            A36312 03638021
         CLI   2(INDEX2),X'FF'          IS IT A SPLIT CYLINDER   A36312 03639021
*                                       ENTRY?                   A36312 03640021
         BNE   NEWF6                    BRANCH IF NOT            A36312 03641021
         CLC   0(2,INDEX2),0(INDEX1)    COMPARE RTA TO F6 EXTENT A36312 03642021
         BE    WRITEF6                  BRANCH WITHOUT PLACING   A36312 03643021
*                                       CHAINING PTR IN DSCB     A36312 03644021
         BAL   RETURN,WITHINF6          CALCULATE RTA+1 OF F6    A36312 03645021
*                                       EXTENT                   A36312 03646021
         CH    R1,0(INDEX2)             TEST IF ENTRY LIES       A36312 03647021
*                                       WITHIN THE F6 EXTENT     A36312 03648021
         BH    WRITEF6                  BRANCH IF YES WITHOUT    A36312 03649021
*                                       PLACING CHAINING PTR     A36312 03650021
NEWF6    EQU   *                                                 A36312 03651021
         MVC   OUTDSCB+135(5),NEXTDADS  MOVE IN CHAIN POINTER    A36312 03652021
WRITEF6  EQU   *                                                 A36312 03653021
         BAL   RETURN,WRTFMT6           WRITE FORMAT 6           A36312 03654021
         MVC   OUTCCHHR(5),INCCHHR      UPDATE POINTERS          A36312 03655021
         MVC   INCCHHR(5),DS5PTRDS                                20344 03680018
         XC    OUTDSCB(140),OUTDSCB     ZERO OUTPUT AREA          20344 03690018
         LA    COUNT3,26                NO. OF OUTPUT EXTENDS     20344 03700018
         LA    INDEX3,OUTDSCB+5         POINT TO OUTPUT EXTEND    20344 03710018
         B     COMPARE                                            20344 03720018
*                                                                       04140000
* THIS SECTION TESTS IF ANY EXTENT HAS BEEN MOVED TO THE OUTPUT DSCB.   04148021
*                                                                       04156021
MOREOUT  EQU   *                                                 A36312 04164021
         LTR   RTA,RTA                  ANY MOVE TO OUTPUT DSCB? A36312 04172021
         BZ    NEXTEXT                 BR IF YES                        04180000
         SR    RTA,RTA                 ZERO REG                         04200000
         B     COMPARE                                                  04220000
*                                                                       04240000
NEXTEXT  LA    INDEX3,5(INDEX3)        INCREMENT OUTPUT EXTENT POINTER  04260000
         B     COMPARE                                                  04280000
*                                                                       04300000
* THIS SECTION WRITES OUT THE LAST FORMAT 6 DSCB.                       04301021
*                                                                       04302021
DADSOUT2 EQU   *                                                  20344 04303018
         BAL   RETURN,WRTFMT6           WRITE FMT 6               20344 04306018
         MVC   OUTCCHHR(5),INCCHHR      UPDATE PTR                20344 04309018
ENDUPDAT EQU   *                                                  20344 04312018
         LH    WORKREG,HOLENUM          LOAD NO OF HOLES          20344 04315018
         LA    WORKREG,1(WORKREG)       ADD 1                     20344 04318018
         STH   WORKREG,HOLENUM          RESTORE                   20344 04321018
         XC    OUTDSCB(140),OUTDSCB     ZERO OUTPUT AREA          20344 04324018
         BAL   RETURN,WRTFMT62          WRITE FMT 0               20344 04327018
ENDUPD2  EQU   *                                                  20344 04330018
         STC   COUNT4,EXTNUM            STORE NO. OF ENTRIES      20344 04333018
         MVC   INCCHHR(5),DADSMADR      INSERT FMT 5 CCHHR.             04340000
         LA    WORKREG,INCCHHR         SET UP NEW CCW9                  04360000
         ST    WORKREG,CCW9                                             04380000
         MVI   CCW9,X'31'              STORE CCW9                       04400000
         LA    WORKREG,CCW9                                             04420000
         NI    CCW11+4,X'EF'           TURN OFF SKIP FLAG               04440000
         MVC   SEEK+3(5),INCCHHR       SET UP IOS SEEK                  04460000
         BAL   RETURN,EXECUTIO         READ FIRST F5 DSCB               04480000
         MVC   CCW9(4),CCW6            RESTORE CCW9                     04500000
FINISH   EQU   *                                                        04502002
         SR    COUNT4,COUNT4           ZERO ENTRIES COUNTER     SA56400 04510002
         IC    COUNT4,EXTNUM           SET ENTRIES COUNTER TO   SA56400 04512002
*                                      THE NUMBER OF ENTRIES IN SA56400 04514002
*                                      DADSMTBL                 SA56400 04516002
         LTR   COUNT4,COUNT4           CHECK NUMBER OF ENTRIES  SA56400 04518002
         BZ    LEAVE                   NO ENTRIES EXIT          SA56400 04518402
         MVC   OUTCCHHR(K5),DADSMADR   OUTCCHHR = 1ST FORMAT    SA56400 04532002
*                                      5 DSCB                   SA56400 04532402
         MVC   INCCHHR(K5),DS5PTRDS    SET NEXT FORMAT 5 CCHHR  SA56400 04534002
*                                      FOR NEXT DADSM INPUT     SA56400 04536002
         MVC   NEXTDADS(K5),INCCHHR    INIT NEXT DADSM PTR      SA56400 04538002
         LA    R2,LOAD4                 POINT TO PROPER ID.             04540000
         B     XCTLEXIT                                                 04560000
*                                                                       04565021
* THIS ROUTINE EXECUTES A CHANNEL PROGRAM.                              04570021
*                                                                       04575021
EXECUTIO ST    WORKREG,IOB+16          SET UP CCW PTR IN IOB            04580000
         MVI   ECB,0                    CLEAR ECB FLAGS.                04600000
         EXCP  IOB                                                      04620000
         WAIT  1,ECB=ECB                                                04640000
         TM    ECB,X'20'               TEST FOR PERMANENT I/O ERROR     04660000
         BCR   5,RETURN                 RETURN IF NO I/O ERROR.         04680000
*                                                                       04700000
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 04704002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 04708002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 04712002
PERMERR  MVI   11(VOLISTX),X'04'       STORE ERROR CODE IN VOL LIST     04720000
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 04724002
         DROP  R1                                                Y02078 04728002
         LA    WORKREG,8                                                04740000
         STH   WORKREG,ERCODE          STORE ERROR CODE IN WORK AREA    04760000
*                                                                       04780000
* THIS SECTION BRANCHES TO IGG0290C OR IGG0290D.                        04786002
*                                                                       04792021
LEAVE    EQU   *                                                        04800000
         LA    R2,LOAD5                 POINT TO PROPER ID.             04820000
XCTLEXIT EQU   *                                                        04840000
         IECRES LOAD,EXTPR=(RWKAREA),MODID=(R2),BRANCH=DIRECT    Y02080 04900002
*                                                                       04961021
* THIS ROUTINE CALCULATES THE RTA+1 OF THE FORMAT 6 EXTENT.             04962021
*                                                                       04963021
WITHINF6 EQU   *                                                 A36312 04964021
         MVC   FIELD1(2),2(INDEX1)      GET NO. OF SHARED CYLS   A36312 04965021
         LH    R1,FIELD1                                         A36312 04966021
         MH    R1,DS4DEVSZ+2            FIND NO. OF SHARED TRKS  A36312 04967021
         MVC   FIELD1(2),0(INDEX1)      GET BEGINNING TRACK ADDR A36312 04968021
         AH    R1,FIELD1                R1 CONTAINS RTA+1        A36312 04969021
         BR    RETURN                   RETURN                   A36312 04970021
*                                                                       04980000
*** PROGRAM CONSTANTS                                                   05000000
*                                                                       05020000
FAKEXT   DC    X'FFFFFFFF'                                              05040000
SIX      DC    X'06060606'                                              05060000
ONEENTRY DC    H'1'                     VALUE ONE                A36312 05070021
*                                                                       05080000
*** THE FOLLOWING CHANNEL PROGRAM SEARCHES FOR A FORMAT 0 DSCB RECORD   05100000
*** AND WRITES OR READS A DADSM DSCB.                                   05120000
*                                                                       05140000
CHALPROG DS    0F                                                       05160000
*CCW1                                   TO BE CONSTRUCTED               05180000
*                                       READ HOME ADDRESS               05200000
*CCW2                                   TO BE CONSTRUCTED               05220000
*                                       READ COUNT (INTO OUTDSCB+136)   05240000
*CCW3                                                                   05260000
         DC    X'29'                   SEARCH EQUAL KEY (FMT 0 DSCB)    05280000
         DC    AL3(4+CCW4-FIRST)                                        05300000
         DC    X'6000'                                                  05320000
         DC    H'4'                                                     05340000
*CCW4                                   TO BE CONSTRUCTED               05360000
*                                       TIC TO CCW2                     05380000
*CCW5                                   TO BE CONSTRUCTED               05400000
*                                       CONTROL SEEK                    05420000
*CCW6                                   TO BE CONSTRUCTED               05440000
*                                       SEARCH EQUAL ID (OUTCCHHR)      05460000
*CCW7                                   TO BE CONSTRUCTED               05480000
*                                       TIC TO CCW6                     05500000
*CCW8                                                                   05520000
         DC    X'0D'                   WRITE KEY AND DATA (OUTDSCB)     05540000
         DC    AL3(0+OUTDSCB-FIRST)                                     05560000
         DC    X'4000'                                                  05580000
         DC    H'140'                                                   05600000
*CCW9                                   TO BE CONSTRUCTED               05620000
*                                       SEARCH EQUAL ID (OUTCCHHR)      05640000
*CCW10                                  TO BE CONSTRUCTED               05660000
*                                       TIC TO CCW9                     05680000
*CCW11                                  TO BE CONSTRUCTED               05700000
*                                       READ KEY DATA (INDSCB)          05720000
*                                                                       05722021
*** TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                       05724002
*                                                                       05726021
         XCTLTABL ID=(LOAD4,0C,LOAD5,0D),SVC=029,LENGTH=,BRT=YES Y02080 05730002
         SPACE 2                                                 Y02078 05750002
         IECDSECS CVT,RB,TCB,EXPAND=YES  CVT, RB, AND TCB DSECTS Y02078 05760002
WORKAREA IECSCRWA EP,F4,D1=(5)          SCRATCH WORK AREA        Y02080 05770002
ZERO     EQU   CCW4+4                                                   07080000
         END   IGG0290B                                          A36312 47120021
./  ADD  SSI=41510134,NAME=IGG0290C
         TITLE 'IGG0290C - DADSM - SCRATCH UPDATE DADSM.'               00020000
IGG0290C CSECT                                                          00022021
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00023002
*0000000030-000150,001000,003400,004800-005000,007400-007600,    Y02080 00023102
*0000014515-014520,015400-015600,038100,038400-039600,065200,    Y02080 00023202
*0000072720,072880,073980-086200,086600-086800                   Y02080 00023302
*0000009600                                                      Y02078 00023402
*0000                                                            Y02082 00023502
*0000023860-023880,034000                                       XA01999 00023602
*          RELEASE 17 DELETIONS                                       * 00025000
*3144000400-000600,056800                                         20055 00030000
*          RELEASE 18 DELETIONS                                       * 00035000
*          RELEASE 19 DELETIONS                                       * 00040000
*          RELEASE 20 DELETIONS                                       * 00045000
*          RELEASE 21 DELETIONS                                       * 00050000
*1198002800-003000,005200,006600-007000,007400,008400,014200-    A37199 00051021
*1198014800,072800,074000,087000                                 A37199 00052021
*          RELEASE 21.7 DELETIONS                                       00054002
*0000000550-000700,015800-018000,024000-024200,025600,028200-   SA56400 00054402
*0000029600,036800,044400,072840-073920,081600-083000           SA56400 00074402
*          VS1-2 DELETIONS                                              00074502
*0000025700-025720                                               XM0835 00074602
*                                                                       00074702
* MODULE NAME - IGG0290C                                                00074802
*                                                                       00074902
* DESCRIPTIVE NAME - DADSM - SCRATCH UPDATE DADSM                       00075002
*                                                                       00075102
* COPYRIGHT - NONE                                                      00075202
*                                                                       00075302
* CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD          00075402
*                                                                       00075502
* STATUS CHANGE LEVEL 004                                               00075602
*                                                                       00080000
*ATTRIBUTES - REENTRANT                                                 00100002
*                                                                       00120000
*FUNCTION - THIS MODULE UPDATES THE EXTENTS IN THE FORMAT 5 DSCB        00140000
*           RECORDS. THE NEW EXTENTS ARE PASSED TO THIS MODULE IN       00160000
*           A TABLE IN THE WORK AREA. WHEN AN EXTENT FROM THE TABLE     00180000
*           IS CONTIGUOUS WITH ONE OR TWO OF THE EXTENTS IN A FORMAT    00200000
*           5 DSCB RECORD, THE EXTENTS IN THAT RECORD ARE REPLACED      00220000
*           WITH ONE EXTENT THAT DESCRIBES THE ENTIRE AREA.             00240000
*                                                                       00260000
*ENTRIES - THE ONLY ENTRY POINT IS IGG0290C. ENTRY IS MADE FROM         00280021
*          MODULE IGG0290B.                                             00300021
*                                                                       00320000
*                                                                       00360000
*SUPERVISOR CALLS AND MACROS. THE FOLLOWING ARE SUPERVISOR CALLS        00380000
*          ISSUED IN THE MACRO EXPANSIONS:                              00400000
*                    EXCP(0) READ FROM OR WRITE TO DIRECT ACCESS DEVICE 00420000
*                    WAIT(1) WAIT ON EVENT CONTROL BLOCK                00440000
*                                                                       00460000
*                                                                       00540000
*OTHER MACROS USED                                                      00560000
*                    IECSCRWA - SCRATCH WORK AREA EXPANSION             00570002
*                    IECSDSL1 - ENABLES SYMBOLIC ADDRESSING OF DSCBS    00580000
*                    IECDSECS - EXPANDS THE CVT, RB, AND TCB DSECTS     00590002
*                                                                       00600000
*INPUT - AT ENTRY TO THIS MODULE REGISTER 13 POINTS TO THE WORK AREA    00620000
*                                                                       00640000
*OUTPUT - UPDATED FORMAT 5 DSCB'S.                                      00680021
*                                                                       00720000
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    00740002
*          WORK AREA = 896 BYTES                                        00760002
*          RPS WORK AREA = 128 BYTES                                    00770002
*                                                                       00780000
*ERROR CONDITIONS - PERMANENT I/O ERROR                                 00800000
*                                                                       00820000
*NOTES - UNLIKE THE ALLOCATE, EXTEND, AND PARTIAL RELEASE FUNCTIONS     00822002
*        OF DADSM, IF THE DIRF BIT IS SET IN THE FORMAT 4 DSCB IN       00824002
*        THE SCRATCH WORK AREA, THIS INDICATES THAT THE DIRF BIT        00826002
*        WAS PREVIOUSLY SET IN THE FORMAT 4 DSCB.                       00828002
*                                                                       00860000
*REGISTER USAGE                                                         00880000
TEMP     EQU   0                                                        00900000
R0       EQU   0                                                        00920000
R1       EQU   1                                                        00940000
R2       EQU   2                                                        00980000
R3       EQU   3                                                        01000000
R4       EQU   4                                                        01020000
HOLE     EQU   5                                                        01040000
COUNT    EQU   5                                                        01060000
R6       EQU   6                                                        01080000
COUNT1   EQU   6                                                        01100000
WORKREG1 EQU   6                                                        01120000
INDEX3   EQU   7                                                        01140000
RTKK     EQU   7                                                        01160000
VOLISTX  EQU   8                                                        01180000
EXTCTR   EQU   9                                                        01200000
RINSCAN  EQU   9                                                        01220000
INDEX1   EQU   10                                                       01240000
ROUTSCAN EQU   10                                                       01260000
INDEX2   EQU   11                                                       01280000
RINEND   EQU   11                                                       01300000
RX       EQU   11                                                       01320000
R11      EQU   11                                                       01340000
WRKAREA  EQU   13                                                       01360000
BRANCH   EQU   14                                                       01380000
WORKREG2 EQU   15                                                       01400000
*                                                                       01450021
*** OTHER EQUATES                                                       01450502
*                                                                       01451002
K0       EQU   0                        ZERO DISPLACEMENT       SA56400 01452502
TWO      EQU   2                        DISPLACEMENT OF TWO     SA56400 01453002
K2       EQU   2                        LENGTH OF TWO           SA56400 01453502
K4       EQU   4                        DISPLACEMENT OF FOUR    SA56400 01454002
K6       EQU   6                        DISPLACEMENT OF SIX     SA56400 01454102
*                                                                       01454502
         BALR  12,0                                                     01500000
         USING BEGUN,12                                                 01520000
         USING SCRTHWKA,WRKAREA         WORK AREA ADDRESSABILITY Y02080 01540002
*                                                                       01564021
* THIS SECTION INITIALIZES POINTERS NECESSARY FOR MERGING THE EXTENTS   01568021
* IN THE DADSM TABLE WITH THE EXTENTS IN THE FORMAT 5 DSCB(S).          01572021
*                                                                       01576021
BEGUN    EQU   *                                                        01578002
         LA    INDEX1,ENTRIES                SET INDEX FOR DADSMTBL     01820000
*                                            ENTRIES.                   01840000
         BAL   BRANCH,CVTORTA0               BRANCH TO CONVERT EXTENTS  01860000
*                                            OF INPUT FORMAT 5 FROM     01880000
*                                            XXYYZ TO RTA-RTA+1.        01900000
         LA    COUNT1,26                     LOAD TRANSFER DADSM COUNT  01920000
*                                            TO OUTPUT FOR 26 EXTENTS.  01940000
         EX    R0,SETOUT                ZERO OUTPUT AREA.               01960000
         LA    INDEX3,OUTDSCB+36             SET INDEX FOR OUTPUT AREA. 01980000
         LTR   COUNT,COUNT             ALL SPACE ALLOCATED              02000000
         BZ    OUTPUT4                 YES                              02020000
*                                                                       02023021
* THIS SECTION COMPARES THE RTA/RTA+1 OF THE DADSM TABLE ENTRIES WITH   02026021
* THE RTA/RTA+1 OF THE FORMAT 5 EXTENTS TO DETERMINE WHERE TO MERGE     02029021
* THE DADSM TABLE ENTRIES.                                              02032021
*                                                                       02035021
MERGE1   CLC   2(2,INDEX1),0(INDEX2)         COMPARE FOR CONTIGUOUS     02040000
*                                            EXTENTS BETWEEN RTA+1 OF   02060000
*                                            ENTRY AND RTA OF EXTENT.   02080000
         BH    MERGE3                       THE RTA+1 OF ENTRY IS       02100000
*                                            GREATER THAN THE RTA OF    02120000
*                                            THE EXTENT.                02140000
         BL    MERGE8                        ENTRY GOES BEFORE 1ST      02160000
*                                            EXTENT.                    02180000
         MVC   0(2,INDEX2),0(INDEX1)         ENTRY AND DADSM ARE        02200000
*                                            CONTIGUOUS SET RTA+1 OF    02220000
*                                            EXTENT=RTA OF ENTRY.       02240000
MERGE2   LA    INDEX1,4(INDEX1)             INCREMENT DADSMTBL INDEX    02260000
*                                            FOR NEXT ENTRY.            02280000
         BCT   EXTCTR,MERGE3                 DECREMENT THE NUMBER OF    02300000
*                                            ENTRIES IN DADSMTBL AND    02320000
*                                            BRANCH IF MORE ENTRIES     02340000
*                                            TO CHECK FOR CONTIGUOUS    02360000
*                                            EXTENTS.                   02380000
MERGE6   MVC   K0(K4,INDEX3),K0(INDEX2) TRANSFER INPUT          SA56400 02382002
*                                       EXTENT TO OUTPUT        SA56400 02384002
         LTR   COUNT,COUNT              ALL SPACE ALLOCATED     XA01999 02386002
         BZ    OUTPUT3                  BRANCH IF YES           XA01999 02388002
MERGE6A  LA    INDEX2,K4(INDEX2)        INCREMENT INPUT INDEX   SA56400 02390002
         BCT   COUNT,MERGE10            REDUCE EXTENT COUNT     SA56400 02392002
         BCTR  COUNT1,R0                REDUCE TRANSFER COUNT   SA56400 02394002
         B     OUTPUT2                  TEST FOR MORE F5'S      SA56400 02396002
MERGE3   CLC   0(2,INDEX1),2(INDEX2)         COMPARE FOR CONTIGUOUS     02440000
*                                            EXTENTS BETWEEN RTA+1 OF   02460000
*                                            EXTENT AND RTA OF ENTRY.   02480000
         BH    MERGE6                        ENTRY GREATER THAN EXTENT  02500000
         BL    OVERLAP                  BRANCH IF EXTENT        SA56400 02510002
*                                       IN ENTRIES OVERLAPS     SA56400 02512002
*                                       EXTENT IN F5            SA56400 02514002
         CLC   2(2,INDEX1),4(INDEX2)         COMPARE FOR A COLLAPSE     02520000
*                                            BETWEEN ENTRY AND EXTENTS. 02540000
         BL    MERGE5                   NO COLLAPSE             SA56400 02560002
         BH    CHECK                    CHECK IF OVERLAPPING     XM0835 02570002
*                                       EXTENTS WERE FOUND       XM0835 02572002
MERGE4   MVC   4(2,INDEX2),0(INDEX2)         DADSM COLLAPSE-MOVE RTA    02580000
*                                            OF EXTENT TO RTA OF NEXT   02600000
*                                            EXTENT.                    02620000
         LA    INDEX2,4(INDEX2)              INCREMENT INPUT FORMAT 5   02640000
*                                            INDEX FOR NEXT EXTENT.     02660000
         BCT   COUNT,MERGE2                  REDUCE NUMBER OF EXTENTS   02680000
*                                            AND CHECK NEXT ENTRY.      02700000
         LA    COUNT,1                       LAST EXTENT.               02720000
MERGE5   MVC   2(2,INDEX2),2(INDEX1)         RTA+1 OF EXTENT=RTA OF     02740000
*                                            ENTRY MOVE RTA OF ENTRY    02760000
         B     MERGE2                  CHECK FOR CONTIGUOUS             02780000
*                                      DADSMTBL ENTRIES                 02800000
MERGE8   LA    R1,4                    SET                              02980000
         SR    INDEX2,R1               ENTRY INDEX.                     03000000
         MVC   0(4,INDEX2),0(INDEX1)   MOVE INTRY BEFORE EXTENT.        03020000
         LA    COUNT,1(COUNT)          INCREMENT EXTENT COUNT.          03040000
         B     MERGE2                  CHECK FOR CONTIG DADSMTBL        03060000
CHECK    EQU   *                                                 XM0835 03060302
         NC    K4(K4,INDEX2),K4(INDEX2) IS NEXT EXTENT IN F5     XM0835 03060602
*                                       ALL ZEROES               XM0835 03060902
         BZ    MERGE5                   IF YES, NO OVERLAPPING   XM0835 03061202
*                                       EXTENTS WERE FOUND       XM0835 03061502
         LTR   COUNT,COUNT              ALL SPACE ALLOCATED     XA01999 03061602
         BZ    MERGE5                   BRANCH IF YES           XA01999 03061702
*                                                                       03061802
*** THIS SECTION MERGES ENTRIES FROM THE DADSM EXTENT TABLE             03062102
*   WITH ENTRIES FROM INPUT FORMAT 5 DSCB WHEN OVERLAPPING              03062402
*   EXTENTS HAVE BEEN DETECTED AND SETS A SWITCH SO THAT THE DIRF       03062702
*   BIT WILL REMAIN ON AT EXIT FROM SCRATCH                             03063002
*                                                                       03063302
OVERLAP  EQU   *                                                SA56400 03063502
         OI    DADSMTBL,ERXTENT         INDICATE OVERLAPPING    SA56400 03064002
*                                       EXTENTS EXIST           SA56400 03064502
         CLC   K0(TWO,INDEX1),K0(INDEX2)  IS RTA IN ENTRIES     SA56400 03065002
*                                       LOWER THAN RTA IN F5    SA56400 03065502
         BNL   NEXTRTA                  BR IF ENTRIES RTA IS    SA56400 03066002
*                                       HIGH OR EQUAL           SA56400 03066502
         MVC   K0(TWO,INDEX2),K0(INDEX1)  MOVE ENTRIES RTA      SA56400 03067002
*                                       OVER FORMAT 5 RTA       SA56400 03067502
NEXTRTA  EQU   *                                                SA56400 03068002
         CLC   K2(TWO,INDEX1),K2(INDEX2)  IS RTA+1 IN ENTRIES   SA56400 03068502
*                                       HIGHER THAN RTA+1 IN F5 SA56400 03069002
         BNH   MERGE2                   IF HI OR EQUAL, BRANCH  SA56400 03069502
         MVC   K2(TWO,INDEX2),K2(INDEX1)  MOVE ENTRIES RTA+1    SA56400 03070002
*                                       OVER F5 RTA+1           SA56400 03070502
         NC    K4(K4,INDEX2),K4(INDEX2) IS IT END OF INPUT F5   SA56400 03071002
         BZ    MERGE6                   BRANCH IF YES           SA56400 03071502
         CLC   K2(TWO,INDEX2),K4(INDEX2)  SHOULD EXTENTS        SA56400 03072002
*                                       BE COLLAPSED            SA56400 03072502
         BL    MERGE2                   BRANCH IF NO            SA56400 03073002
         CLC   K2(TWO,INDEX2),K6(INDEX2)  DOES CURRENT EXTENT   SA56400 03073102
*                                       IN FORMAT 5 ENGULF NEXT SA56400 03073202
*                                       EXTENT IN FORMAT 5      SA56400 03073302
         BNH   MERGE4                   BRANCH IF NO            SA56400 03073402
         MVC   K6(TWO,INDEX2),K2(INDEX2)  MOVE ENDING ADDRESS   SA56400 03073902
*                                       INTO NEXT EXTENT        SA56400 03074002
         B     MERGE4                                           SA56400 03074402
*                                                                       03076402
* THIS SECTION DETERMINES WHEN A FORMAT 5 DSCB NEEDS TO BE WRITTEN      03078402
* TO THE VTOC AND WHEN A NEW FORMAT 5 MUST BE READ.                     03078802
*                                                                       03079202
MERGE10  BCT   COUNT1,OUTPUT7                REDUCE OUTPUT XFER COUNT   03080000
*                                            AND BRANCH TO OUTPUT CHECK 03100000
OUTPUT1  LTR   COUNT,COUNT                   CHECK NUMBER EXTENTS.      03120000
         BP    COLLAPSE                      EXTENTS LEFT.              03140000
OUTPUT2  CLI   INCCHHR+4,X'00'               ANY MORE FORMAT 5 DSCBS.   03160000
         BNE   DADSMIN                       YES.                       03180000
OUTPUT3  LA    INDEX3,4(INDEX3)        INCREMENT OUTPUT INDEX.          03200000
         LTR   EXTCTR,EXTCTR           ANY MORE ENTRIES.                03220000
         BZ    OUTPUT5                      NO                          03240000
         LTR   COUNT1,COUNT1                ARE 26 EXTENTS IN OUTPUT    03260000
         BP    OUTPUT4                      NO                          03280000
         BAL   BRANCH,DADSMOUT              OUTPUT DADSM                03300000
         SR    HOLE,HOLE                                                03320000
OUTPUT4  EQU   *                                                        03340000
         BCTR  COUNT1,0                      DECREMENT XFER COUNT       03360000
         LR    INDEX2,INDEX1           SET INDEX FOR XFER ENTRY.        03380000
*                                                                     $ 03420000
         B     MERGE2                   CHK FOR CONTIG DADSM ENTRIES    03440000
OUTPUT5  EQU   *                                                        03460000
         BAL   BRANCH,DADSMOUT              WRITE FORMAT 5.             03480000
         TM    CCW7+7,1                     IS FORMAT 0 PENDING         03500000
         BZ    FINISH                   BRANCH IF NO                    03520000
         LH    WORKREG2,HOLENUM             INCREMENT HOLE COUNT        03540000
         LA    WORKREG2,1(WORKREG2)           IN DADSM TABLE.           03560000
         STH   WORKREG2,HOLENUM                                         03580000
         LA    WORKREG1,FINISH          SET RETURN ADDRESS.             03600000
         B     SETSEEK                                                  03620000
*                                                                       03625021
* THIS ROUTINE EXECUTES A CHANNEL PROGRAM.                              03630021
*                                                                       03635021
EXECUTIO EQU   *                                                        03640000
         ST    WORKREG2,IOB+16              SET CCW POINTER IN IOB.     03660000
         EXCP  IOB                                                      03700000
         WAIT  ECB=ECB                                                  03720000
         TM    ECB,X'20'                    TEST FOR I/O ERROR.         03740000
         BCR   5,BRANCH                     BRANCH IF NO ERROR.         03760000
         MVI   ERCODE+1,8                   SET ECRODE                  03780000
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 03784002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 03788002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 03792002
         MVI   11(VOLISTX),4            SET ERROR CODE IN VOLIST.       03800000
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 03802002
         DROP  R1                                                Y02078 03804002
*                                                                       03805021
* THIS SECTION BRANCHES TO THE LAST LOAD OF SCRATCH - IGG0290D.         03810002
*                                                                       03815021
FINISH   EQU   *                                                        03820000
         IECRES LOAD,EXTPR=(WRKAREA),MODID=LOAD5,BRANCH=DIRECT   Y02080 03880002
*                                                                       03960002
OUTPUT6  EQU   *                                                        03980000
         LTR   COUNT,COUNT                  ANY MORE EXTENTS       8105 04000000
         BZ    OUTPUT2                      NO, BRANCH             8105 04020000
         LA    BRANCH,BYINDEX               SET RETURN FROM DADSMOUT.   04040000
         LTR   COUNT1,COUNT1                26 EXTS XFERED TO OUTPUT.   04060000
         BZ    DADSMOUT                     YES-WRITE DADSM RECORD.     04080000
OUTPUT7  EQU   *                                                        04100000
         LA    INDEX3,4(INDEX3)             NO-INCREMENT OUTPUT INDEX.  04120000
BYINDEX  EQU   *                                                        04140000
         LTR   EXTCTR,EXTCTR           ANY MORE ENTRIES.                04160000
         BZ    MERGE6                        XFER EXTENTS TO OUTPUT.    04180000
         B     MERGE1                       CHECK EXTENTS AND ENTRIES   04200000
*                                                                       04205021
* THIS SECTION READS IN THE SECOND AND SUBSEQUENT FORMAT 5 DSCB'S.      04210021
*                                                                       04215021
DADSMIN  LA    WORKREG2,INCCHHR              MODIFY SEARCH ID EQUAL     04220000
         ST    WORKREG2,CCW9                 CHANNEL PROGRAM FOR        04240000
         MVI   CCW9,X'31'                    READING IN FORMAT 5.       04260000
         LA    WORKREG2,CCW9                READ KEY AND DATA ADDR.     04280000
         NI    CCW11+4,X'EF'                 TURN OFF SKIP FLAG ON      04300000
*                                            READ WRITE CHECK.          04320000
         MVC   SEEK+3(5),INCCHHR             CCHHR OF NEXT FORMAT5 IN   04340000
*                                            SEEK ADDRESS.              04360000
         BAL   BRANCH,EXECUTIO               READ IN NEXT FORMAT5.      04380000
         BAL   BRANCH,CVTORTA0               CONVERT FORMAT5 EXTENTS    04400000
         CLC   0(2,INDEX2),2(INDEX3)    ARE EXTENTS CONTIGUOUS.         04420000
         BH    NEXTOUT                  BRANCH IF NOT           SA56400 04440002
*                                       CONTIGUOUS              SA56400 04440502
         EX    R0,COLLAPS3                                              04460000
         LA    INDEX2,4(INDEX2)         UPDATE INPUT DSCB INDEX.        04480000
         BCTR  COUNT,0                                                  04500000
NEXTOUT  EQU   *                                                        04520000
*                                            TO RTA-RTA+1.              04540000
         MVC   NEXTDADS(5),INCCHHR           SET NEXT OUTPUT FORMAT5.   04560000
         MVC   INCCHHR(5),DS5PTRDS           SET NEXT INPUT FORMAT5.    04580000
         MVC   CCW9(4),CCW6                  RESET CHANNEL PROGRAM ADR. 04600000
*                                                                       04604021
* THIS SECTION DETERMINES WHETHER TWO FORMAT 5 OUTPUT EXTENTS ARE       04608021
* CONTIGUOUS AND, IF SO, COMBINES THEM INTO A SINGLE EXTENT.            04612021
*                                                                       04616021
COLLAPSE LTR   EXTCTR,EXTCTR                 ANY MORE ENTRIES.          04620000
         BZ    OUTPUT6                       NO.                        04640000
COLLAPS1 CLC   0(2,INDEX1),2(INDEX3)         COMPARE FOR DADSM COLLAPSE 04660000
         BNE   OUTPUT6                       NO                         04680000
         CLC   2(2,INDEX1),0(INDEX2)        COLLAPSE                    04700000
         BNE   OUTPUT6                       NO                         04720000
COLLAPS3 EQU   *                                                        04740000
         MVC   2(2,INDEX3),2(INDEX2)         YES                        04760000
         LA    INDEX1,4(INDEX1)              INCREMENT DADSMTBL INDEX.  04780000
         LA    INDEX2,4(INDEX2)              INCREMENT INPUT INDEX.     04800000
         BCT   EXTCTR,COLLAPS2                                          04820000
         BCT   COUNT,OUTPUT6                 NO MORE ENTRIES-OUTPUT     04840000
         B     OUTPUT2                                                  04860000
COLLAPS2 BCT   COUNT,COLLAPS1               CHECK FOR ANOTHER COLLAPSE  04880000
         B     OUTPUT2                                                  04900000
*                                                                       04904021
* THIS ROUTINE CONVERTS THE FORMAT 5 OUTPUT EXTENTS FROM RTA/RTA+1      04908021
* TO XXYYZ FORMAT AND WRITES THE FORMAT 5 DSCB TO THE VTOC.             04912021
*                                                                       04916021
DADSMOUT LR    WORKREG1,BRANCH               SAVE BRANCH ADDRESS        04920000
         STM   R6,R11,SAVEREGS          SAVE VOLATILE REGS.             04940000
         OI    CCW11+4,X'10'                 TURN ON SKIP FLAG.         04960000
         LA    RINEND,26                     SET COUNT INDEX            04980000
         LA    ROUTSCAN,OUTDSCB+5            SET OUTPUT INDEX           05000000
         LA    RINSCAN,OUTDSCB+36            SET INPUT INDEX            05020000
NEXTEXT  LH    RTKK,DS4DEVSZ+2               LOAD TRACKS PER CYLINDER   05040000
         LH    R1,0(RINSCAN)                 R1= RTA                    05060000
         LH    R3,2(RINSCAN)                 R3= RTA+1                  05080000
         SR    R0,R0                         ZERO                       05100000
         LR    R2,R0                         DIVIDE REGS.               05120000
         LR    R4,R3                                                    05140000
         SR    R4,R1                         R4=RTA+1-RTA               05160000
         CLR   R4,RTKK                                                  05180000
         BNL   MORETH1                       MORE THAN ONE CYL POSSIBLE 05200000
         MVC   2(2,ROUTSCAN),ZERO            ZERO YY.                   05220000
         STC   R4,4(ROUTSCAN)                SET Z.                     05240000
         B     MOVEXTA                                                  05260000
MORETH1  DR    R0,RTKK                       RTA  /RTKK                 05280000
         DR    R2,RTKK                       RTA+1/RTKK                 05300000
         SR    R3,R1                                                    05320000
         LTR   R0,R0                         EXCESS TRACKS              05340000
         BP    NOTCYL                        YES                        05360000
         STC   R2,4(ROUTSCAN)                SET Z                      05380000
         B     STORECYL                                                 05400000
NOTCYL   SR    RTKK,R0                                                  05420000
         LTR   R3,R3                                                    05440000
         BZ    ADD2                                                     05460000
         BCTR  R3,0                                                     05480000
ADD2     AR    RTKK,R2                                                  05500000
         STC   RTKK,4(ROUTSCAN)              SET Z                      05520000
STORECYL STH   R3,HOLD                                                  05540000
         MVC   2(2,ROUTSCAN),HOLD            SET YY.                    05560000
MOVEXTA  MVC   0(2,ROUTSCAN),0(RINSCAN)      SET XX                     05580000
         LA    ROUTSCAN,5(ROUTSCAN)          INCREMENT OUTPUT INDEX     05600000
         LA    RINSCAN,4(RINSCAN)            INCREMENT INPUT INDEX      05620000
         BCT   RINEND,NEXTEXT                BACK FOR NEXT EXTENT       05640000
         LM    R6,R11,SAVEREGS               RESET REGISTERS            05660000
         OC    OUTDSCB+5(130),OUTDSCB+5  OUTPUT AREA ZERO         20055 05680000
         BE    ZEROUT                        YES                        05700000
         MVC   OUTDSCB(4),FIVE               SET UP FORMAT 5            05720000
         MVC   OUTDSCB+4(40),OUTDSCB+5       MOVE OVER ID BYTE          05740000
         MVI   OUTDSCB+44,X'F5'              INSERT ID BYTE.            05760000
ZEROUT   EQU   *                                                        05780000
         MVC   OUTDSCB+135(5),NEXTDADS      SET DADSM POINTER.          05800000
         EX    R0,COMPNEXT              IS THIS CHAIN ADDR VALID.       05820000
         BNE   SKIPFLAG                 YES-DON'T MODIFY CHAIN.         05840000
         EX    R0,ZEROPTR               NO-INSERT CORRECT CHAIN.        05860000
SKIPFLAG EQU   *                                                        05880000
         OI    CCW11+4,X'10'            TURN ON SKIP FLAG.              05900000
         CLI   INCCHHR+4,X'00'              ANY MORE FORMAT 5           05920000
         BE    FINDHOLE                     FIND HOLE                   05940000
SETSEEK  MVC   SEEK+3(5),OUTCCHHR            SET SEEK ADDRESS.          05960000
         LA    WORKREG2,CCW6                 SET CCW ADDRESS FOR WRITE. 05980000
         BAL   BRANCH,EXECUTIO               WRITE OUT UPDATED DADSM.   06000000
COMPNEXT EQU   *                                                        06020000
         CLC   OUTCCHHR(5),NEXTDADS          NEXT OUTPUT EQU THIS OUT   06040000
         BE    NXTOUTIN                                                 06060000
SETNXT   MVC   OUTCCHHR(5),NEXTDADS     SET NEXT DADSM CCHHR.           06080000
         B     TESTZERO                     TEST FOR FORMAT 0 PENDING   06100000
NXTOUTIN MVC   OUTCCHHR(5),INCCHHR           SET NEXT OUTPUT            06120000
TESTZERO TM    OUTDSCB+139,X'FF'            TEST FOR END OF OUTPUT.     06140000
         BNE   SETOUT                       BRANCH IF NO.               06160000
         TM    OUTCCHHR+4,X'FF'             TEST FOR END OF INPUT.      06180000
         BZ    SETOUT                       BRANCH IF YES.              06200000
         OI    CCW7+7,1                     INDICATE FORMAT 0 PENDING.  06220000
SETOUT   XC    OUTDSCB(140),OUTDSCB          ZERO OUTPUT AREA           06240000
         LA    INDEX3,OUTDSCB+36             SET OUTPUT INDEX.          06260000
         LR    BRANCH,WORKREG1               RESET BRANCH REG.          06280000
         LA    COUNT1,26                     SET INDEX FOR OUTPUT XFER. 06300000
         BR    BRANCH                        EXIT FROM SUBROUTINE.      06320000
*                                                                       06325021
* THIS ROUTINE SEARCHES FOR AN UNUSED DSCB IN THE VTOC.                 06330021
*                                                                       06335021
FINDHOLE LR    TEMP,COUNT                   ANY EXTENTS                 06340000
         ALR   TEMP,EXTCTR                  OR ENTRIES LEFT             06360000
         BZ    ZEROPTR                      NO                          06380000
         CLC   OUTCCHHR(5),NEXTDADS         NEED HOLE                   06400000
         BE    SEARCHOL                 YES-SEARCH FOR A HOLE.          06420000
         CLI   NEXTDADS+4,0             IS THERE ANOTHER F5 DSCB.       06440000
         BNE   SETSEEK                  YES-NO HOLE IS NEEDED.          06460000
SEARCHOL EQU   *                                                        06480000
         MVC   SEEK+3(5),VTOCADR            YES SET SEEK ADDRESS        06500000
         MVC   INLINESK+K2(K4),OUTCCHHR  INSERT OLD F5 CCHHR     Y02080 06520002
         LA    WORKREG2,CCW1                 SET UP CHANNEL PROG.ADD.   06540000
         BAL   BRANCH,EXECUTIO               FIND HOLE FOR NEXT OUTPUT  06560000
*                                            AND OUTPUT DADSM.          06580000
         LH    WORKREG2,HOLENUM                                         06600000
         BCTR  WORKREG2,0                                               06620000
         STH   WORKREG2,HOLENUM         SAVE NO OF AVAIL HOLES.         06640000
         MVC   NEXTDADS(5),OUTDSCB+135       SET NEXT OUTPUT            06660000
         B     SETNXT                                                   06680000
ZEROPTR  MVC   OUTDSCB+135(5),INCCHHR        ZERO POINTER               06700000
         B     SETSEEK                                                  06720000
*                                                                       06724021
* THIS ROUTINE CONVERTS THE FORMAT 5 DSCB EXTENTS FROM XXYYZ TO         06728021
* RTA/RTA+1 FORMAT.                                                     06732021
*                                                                       06736021
CVTORTA0 STM   R6,R11,SAVEREGS               SAVE REGS.                 06740000
         SR    R2,R2                         ZERO R2.                   06760000
         SR    COUNT,COUNT                   AND COUNT.                 06780000
         MVC   INDSCB+44(90),INDSCB+45       MOVE INPUT OVER ID BYTE.   06800000
         LA    RINSCAN,INDSCB+4             SET INPUT INDEX             06820000
         LA    ROUTSCAN,INDSCB+4       SET OUTPUT INDEX.                06840000
         LA    RX,26                         SET CONVERT COUNT.         06860000
TEST0    CLC   0(2,RINSCAN),ZERO             EXTENT ZERO.               06880000
         BE    INCRIN                        YES.                       06900000
         MVC   HOLD(5),0(RINSCAN)            HOLD XXYYZ.                06920000
         LH    R1,HOLD+2                     R1=YY.                     06940000
         MH    R1,DS4DEVSZ+2                 MULT BY TRACKS PER CYL.    06960000
         IC    R2,HOLD+4                     R2=Z.                      06980000
         ALR   R1,R2                         R1= TRACKS+Z.              07000000
         AH    R1,HOLD                       R1=RTA+1.                  07020000
         STH   R1,2(ROUTSCAN)                SET RTA+1 IN OUTPUT.       07040000
         MVC   0(2,ROUTSCAN),HOLD            SET RTA IN OUTPUT.         07060000
         LA    ROUTSCAN,4(ROUTSCAN)          INCREMENT OUTPUT INDEX.    07080000
         LA    COUNT,1(COUNT)                INCREMENT CONVERT COUNT.   07100000
INCRIN   LA    RINSCAN,5(RINSCAN)            INCREMENT INPUT INDEX.     07120000
         BCT   RX,TEST0                      BACK FOR NEXT CONVERT      07140000
         ST    RX,0(ROUTSCAN)           CLEAR NEXT ENTRY.               07160000
         LM    R6,R11,SAVEREGS               RESET REGS.                07180000
         LA    INDEX2,INDSCB+4         SET INPUT INDEX.                 07200000
         BR    BRANCH                        BRANCH OUT.                07220000
*                                                                       07225021
*** CONSTANTS                                                           07230021
*                                                                       07235021
         DS    0F                                                       07240000
FIVE     DC    X'05050505'                                              07260000
*                                                                       07266021
*** TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                       07272002
*                                                                       07278021
         XCTLTABL ID=(LOAD5,0D),SVC=029,LENGTH=,BRT=YES          Y02080 07288002
         SPACE 2                                                 Y02078 07298002
         IECDSECS CVT,RB,TCB,EXPAND=YES  CVT, RB, AND TCB DSECTS Y02078 07300002
WORKAREA IECSCRWA EP,F4,D1=(5)          SCRATCH WORK AREA        Y02080 07420002
SAVEREGS EQU   IECREGSV+12              REGISTER SAVE AREA       Y02080 08580002
ZERO     EQU   CCW4+4                                                   08640000
         END   IGG0290C                                          A37199 48680021
./  ADD  SSI=72590409,NAME=IGG0290D
         TITLE 'IGG0290D - ERROR EXITS AND DEQUE ROUTINE.'              00020000
IGG0290D CSECT                                                          00025021
*          RELEASE 16 DELETIONS                                         00030000
*1465                                                             5M51R 00031016
*1465                                                              AAAA 00032016
*          RELEASE 17 DELETIONS                                         00035000
*          RELEASE 18 DELETIONS                                       * 00041000
*          RELEASE 19 DELETIONS                                       * 00043000
*1184008000                                                      A25777 00043519
*1184002200,014400                                               S19028 00044019
* 018120-018126                                                  M4916  00044519
*1184013600-013800                                               M3097  00044719
*          RELEASE 20 DELETIONS                                       * 00045000
*1331                                                            S20201 00046020
*          RELEASE 21 DELETIONS                                       * 00047000
*1198000250,000778-000790,001600-001800,002100,006000-006200,    A43551 00047521
*1198018054-018060,018064-018066,018098,018104-018106,018176-    A43551 00048021
*1198018178,018186,019800,021000,031800                          A43551 00048521
*0000018210,018310,018600                                       SA49351 00048921
*          RELEASE 21.7 DELETIONS                                       00051702
*0000000490-000530,015600,019880-020860,028400                  SA56400 00053702
*          VS1 RELEASE 2 DELETIONS                                      00054102
*0000                                                           XM1038  00054502
*                                                                       00054602
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00057002
*0000000030-000150,000800-001000,002000-002240,002400,005650,    Y02080 00057102
*0000005900,006020-006040,006200-006300,006800-007060,009000,    Y02080 00057202
*0000012010-012100,012120,012600-012900,013100-013200,013840-    Y02080 00057302
*0000013920,014500-014600,015000-016200,018064,018070,018076,    Y02080 00057402
*0000018090-018102,018164,018170,018174,018176-018188,018194,    Y02080 00057502
*0000018235-018242,018244-018245,018270-018280,018294,018400-    Y02080 00057602
*0000019000,019820,020350,020980-030860,031000-031774            Y02080 00057702
*0000001900,001960,007120,017630,019200                          Y02078 00057802
*0000000754-431790                                               Y02082 00057902
*0000                                                            Y02134 00058002
*0000                                                            Y02144 00058102
*0000                                                            Y02132 00058202
*0000175000,179000-179100,210500,211500,212500,233500            YM1337 00058302
*0000063500,067000,248000-249000,259000                          YM3048 00060302
*0000018000,246000,250000-250100                                 YM3997 00060702
*0000179000,179100,260500,261500                                 YM2880 00060902
*0000178000                                                      YM2887 00061102
*          VS2 RELEASE 03 DELETIONS/CHANGES                    @ZM30032 00061503
*0000                                                          @Y30LSTG 00062003
*0000                                                          @ZA04736 00062137
*0000    EXTENDED MVS CVOL SUPPORT                             @Z40CSRC 00064137
*                                                                       00065137
*                                                              @G60ASBJ 00065660
*        SU60 DELETIONS/CHANGES                                @G60ASBJ 00066160
*A 253000,253600                                               @G60ASBJ 00066660
*D 253500,25A000                                               @G60ASBJ 00067160
*                                                              @G60ASBJ 00067660
* MODULE NAME - IGG0290D                                                00068137
*                                                                       00071137
* DESCRIPTIVE NAME - ERROR EXITS AND DEQUE ROUTINE                      00074137
*                                                                       00077137
* COPYRIGHT - NONE                                                      00080137
*                                                                       00083137
*                                                                       00085237
* CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD          00086137
*STATUS CHANGE LEVEL 004                                                00087737
*                                                                       00089137
*STATUS CHANGE LEVEL 004                                                00092137
*                                                                       00100002
*FUNCTION - IF NO ERROR HAS OCCURRED WHEN PROCESSING THE CURRENT ENTRY  00150002
*          IN THE VOLUME LIST, THIS MODULE UPDATES THE HOLE COUNT IN    00200002
*          THE FORMAT 4 DSCB AND WRITES IT BACK TO THE VTOC.  IF THE    00250002
*          VTOC WAS ENQ'ED, THIS MODULE ISSUES A DEQ WITH THE RELEASE-  00300002
*          MUST-COMPLETE OPTION.  IF AN I/O ERROR OCCURRED WHILE        00350002
*          PROCESSING THE CURRENT ENTRY, THIS MODULE ISSUES MESSAGE     00400002
*          IEC603I WITH THE CODE = 0.  IF OVERLAPPING EXTENTS WERE      00450002
*          FOUND IN THE FORMAT 5 DSCB AND THE DIRF BIT WAS NOT SET      00500002
*          PREVIOUSLY IN THE FORMAT 4 DSCB, THIS MODULE ISSUES MESSAGE  00550002
*          IEC603I WITH THE CODE = 4 AND REWRITES THE FORMAT 4 DSCB     00600002
*          WITH THE DIRF BIT SET.                                       00650002
*          IF THE UNIT WAS DYNAMICALLY ALLOCATED, DYNAMIC ALLOCATION    00700002
*          IS CALLED TO DEALLOCATE THE UNIT.  IF THERE ARE MORE         00750002
*          VOLUMES TO BE PROCESSED, CONTROL IS RETURNED TO IGG0290E.    00800002
*          AFTER ALL THE VOLUMES HAVE BEEN PROCESSED, THIS MODULE       00850002
*          TESTS IF A VOLUME WAS ENQ'ED AND MOUNTED BY IGG0290F.        00900002
*          IF YES, CONTROL IS GIVEN TO IGG0290F TO DEMOUNT AND DEQ      00950002
*          THE VOLUME.  IF SCRATCH ENQ'ED ON THE DATA SET NAME OR       01000002
*          THE TIOT, CORRESPONDING DEQ'S ARE ISSUED.  IF DATA SET       01050002
*          RECORDING FOR SMF IS REQUIRED, THIS MODULE BUILDS AN SMF     01100002
*          RECORD TYPE 17.  IF THE RPS SIO APPENDAGE IGG019EK WAS       01150002
*          LOADED, IT DELETES IT.  IT THEN FREES THE WORK AREA(S)       01200002
*          AND RETURNS TO THE CALLER.                                   01250002
*          IN ADDITION, IF THE DATA SET BEING SCRATCHED RESIDES@Y30LSTG 01260003
*          ON VIRTUAL MSS  DASD, THE PARAMETER LIST BUILT IN   @Y30LSTG 01270003
*          IGG0299A IS USED TO RELINQUISH REAL DASD SPACE THAT @Y30LSTG 01280003
*          WAS ACQUIRED FOR THE DATA SET.                      @Y30LSTG 01290003
*                                                                       01300002
*ATTRIBUTES - REENTRANT                                                 01350002
*                                                                       01400002
*ENTRIES - THE ONLY ENTRY TO THIS MODULE IS IGG0290D. ENTRY IS MADE     01450002
*          FROM ANY OF THE PRECEDING MODULES - IGC0002I, IGG0290E,      01500002
*          IGG0290A, IGG0299A, IGG0290B, OR IGG0290C.                   01550002
*                                                                       01600002
*SUPERVISOR CALLS AND EXTERNAL ROUTINES IN THIS MODULE -                01650002
*          EXCP(0)  - WRITES TO A DIRECT ACCESS DEVICE                  01700002
*          WAIT(1)  - WAITS ON AN EVENT CONTROL BLOCK                   01750002
*          TIME(11) - OBTAINS THE CURRENT TIME AND DATE                 01850002
*          WTO(35)  - WRITES A MESSAGE TO THE OPERATOR                  01900002
*          DEQ(48)  - DEQ'S FROM SYSVTOC, SYSZTIOT, AND/OR SYSDSN       01950002
*          SMFWTM   - WRITES AN SMF RECORD (SVC 83)                     02000002
*          DYNALLOC - DYNAMICALLY DEALLOCATES THE UNIT (SVC 99)         02050002
*          MODESET  - SWITCHES TO THE CALLER'S KEY                      02100002
*          IECRES   - BRANCHES TO ANOTHER MODULE                        02150002
*                   - OBTAINS/FREES WORK AREA(S)                        02200002
*          ICBACREL - RELINQUISHES DASD SPACE FOR MSS          @Y30LSTG 02210003
*                                                                       02250002
*OTHER MACROS ISSUED -                                                  02300002
*          IECDSECS - EXPANDS THE CVT, DSAB, JMR, JSCB, QDB, RB, SMF,   02350002
*                     SMFTCT, TCB, TIOT, AND UCB DSECTS                 02400002
*          IECSDSL1 - ENABLES SYMBOLIC ADDRESSING OF DSCBS              02450002
*          IECSCRWA - SCRATCH WORK AREA EXPANSION                       02500002
*          IEFJFCBN - ENABLES SYMBOLIC ADDRESSING OF THE JFCB           02550002
*          IEFZB4D0 - EXPANDS THE DYNAMIC ALLOCATION REQUEST BLOCK      02600002
*          IEFZB4D2 - EXPANDS THE DYNAMIC ALLOCATION TEXT UNIT KEYS     02650002
*          IFASMFR  - BUILDS AN SMF RECORD TYPE 17                      02700002
*          XCTLTABL - BUILDS A LIST OF MODULE ID'S AND ADDRESSES        02750002
*                                                                       02800002
*INPUT -   AT ENTRY TO THIS MODULE REGISTER 13 POINTS TO THE WORK AREA. 02850002
*          REGISTER 8 POINTS TO THE CURRENT ENTRY IN THE VOLUME LIST.   02900002
*                                                                       02950002
*OUTPUT -  THE UPDATED FORMAT 4 DSCB IS WRITTEN OUT.  IF THE SCRATCH    03000002
*          FUNCTION IS COMPLETE FOR ALL VOLUMES IN THE VOLUME LIST,     03050002
*          CONTROL IS RETURNED TO THE CALLER WITH AN ERROR CODE IN      03100002
*          REGISTER 15.  IF THE DATA SET MUST STILL BE SCRATCHED        03150002
*          FROM ANOTHER VOLUME, CONTROL IS PASSED TO MODULE IGG0290E.   03200002
*          REGISTER 9 POINTS TO THE CVT, AND  REGISTER 10 POINTS TO     03250002
*          THE INPUT PARAMETER LIST.  REGISTER 13 STILL POINTS TO THE   03300002
*          SCRATCH WORK AREA, IN WHICH 'VOLNUM' CONTAINS THE NUMBER     03350002
*          OF VOLUMES REMAINING TO BE SCRATCHED AND 'VOLPTR' CONTAINS   03400002
*          THE ADDRESS OF THE NEXT ENTRY IN THE VOLUME LIST.            03450002
*          THE FOLLOWING INFORMATION IS PASSED TO IGG0290F:             03500002
*          REGISTER 2 POINTS TO THE DEB.                                03550002
*          REGISTER 3 POINTS TO THE VOLUME SERIAL NUMBER.               03600002
*          REGISTER 4 CONTAINS THE CHARACTERS '290D'.                   03650002
*          REGISTER 8 POINTS TO THE CURRENT VOLUME LIST ENTRY.          03700002
*          REGISTER 11 CONTAINS THE PRIMARY (DEMOUNTABLE) UCB ADDRESS.  03750002
*                                                                       03850002
*ERROR CONDITION - THE ONLY ERROR INDICATED IS PERMANENT I/O ERROR.     03900002
*                                                                       03950002
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    04000002
*          WORK AREA = 900 BYTES                               @Y30LSTG 04050003
*          RPS WORK AREA = 128 BYTES                                    04100002
*                                                                       04150002
*NOTES -   UNLIKE THE ALLOCATE, EXTEND, AND PARTIAL RELEASE FUNCTIONS   04200002
*          OF DADSM, IF THE DIRF BIT IS SET IN THE FORMAT 4 DSCB IN     04250002
*          THE SCRATCH WORK AREA, THIS INDICATES THAT THE DIRF BIT      04300002
*          WAS PREVIOUSLY SET IN THE FORMAT 4 DSCB.                     04350002
*                                                                       04400002
* REGISTER EQUATES                                                      04450002
*                                                                       04500002
R0       EQU   0                        REGISTER 0               Y02080 04550002
R1       EQU   1                                                        04600002
RPARM    EQU   2                        PARAMETER LIST POINTER   Y02082 04650002
R2       EQU   2                                                        04700002
RDSAB    EQU   2                        POINTER TO THE DSAB      Y02082 04750002
RWRK     EQU   3                        WORK REGISTER            Y02082 04800002
RTIOT    EQU   3                        POINTER TO THE TIOT      Y02082 04850002
R3       EQU   3                                                        04900002
RTEXT    EQU   4                        POINTER TO TEXT UNIT     Y02082 04950002
R4       EQU   4                                                        05000002
VOLCTR   EQU   5                        NUMBER OF VOLUMES        Y02082 05050002
R6       EQU   6                                                        05100002
R7       EQU   7                                                        05150002
R8       EQU   8                                                        05200002
VOLISTX  EQU   8                        PTR TO VOLIST ENTRY      Y02082 05250002
R9       EQU   9                                                        05300002
RCVT     EQU   9                                                 S19028 05350002
RA       EQU   10                                                       05400002
RUCB     EQU   11                       UCB POINTER              Y02078 05450002
RBASE    EQU   12                                                       05500002
RWKAREA  EQU   13                                                       05550002
RETURN   EQU   14                                                       05600002
R15      EQU   15                                                       05650002
WORKREG2 EQU   15                                                       05700002
*                                                                       05750002
* OTHER EQUATES                                                         05800002
*                                                                       05850002
K0       EQU   0                        CONSTANT OF ZERO         Y02082 05900002
K1       EQU   1                        CONSTANT OF 1            Y02082 05950002
K2       EQU   2                        CONSTANT OF 2            Y02080 06000002
K3       EQU   3                        CONSTANT OF 3            Y02082 06050002
K4       EQU   4                        CONSTANT OF 4            Y02082 06100002
K6       EQU   6                        CONSTANT OF 6          @Y30LSTG 06110003
K8       EQU   8                        CONSTANT OF 8            Y02082 06150002
K12      EQU   12                       CONSTANT OF 12           Y02080 06200002
K16      EQU   16                       CONSTANT OF 16           YM1337 06210002
D3       EQU   3                        DISPLACEMENT OF THREE  @Y30LSTG 06220003
X00      EQU   X'00'                    ONE BYTE OF BINARY ZEROS Y02082 06250002
FW       EQU   4                        LENGTH OF A FULLWORD     Y02082 06300002
APDIS    EQU   28                       DISP. TO APPGS IN W.A.   S20201 06400002
APSVA    EQU   120                      DISP.TO AVT PTR IN W.A.  S20201 06450002
SMFREC17 EQU   17                       SMF RECORD TYPE 17       Y02082 06500002
CHNPGADR EQU   16                       OFFSET TO CCW STARTING   Y02082 06550002
*                                       ADDRESS IN THE IOB       Y02082 06600002
UCBADDR  EQU   32                       DISP. TO UCB ADDR IN DEB Y02080 06650002
UUU      EQU   37                       DISP. TO UUU IN MESSAGE  Y02078 06750002
VOLID    EQU   41                       DISP. TO VOLSER IN MSG   Y02078 06800002
CODE     EQU   48                       DISP. TO CODE IN MESSAGE Y02078 06850002
VOLSER   EQU   4                        OFFSET TO THE VOL SER IN Y02082 06900002
*                                       A VOLUME LIST ENTRY      Y02082 06950002
STATUS   EQU   11                       OFFSET TO VOLIST STATUS  Y02078 07000002
ENTRYL   EQU   12                       LENGTH OF VOLIST ENTRY   Y02078 07050002
RETCODE8 EQU   8                        RETURN CODE OF 8 TO USER Y02082 07100002
PSWDERR  EQU   X'02'                    PASSWORD ERROR           Y02082 07150002
IOERR    EQU   X'04'                    I/O ERROR IN VOLUME LIST Y02078 07200002
OPENDS   EQU   X'07'                    OPEN DATA SET ERROR      Y02082 07250002
CODE4    EQU   C'4'                     CODE 4 IN MESSAGE        Y02078 07300002
PERIOD   EQU   C'.'                     EBCDIC PERIOD            A43551 07350002
DIRFBIT  EQU   X'04'                    TURN DIRF BIT ON        SA56400 07400002
WRDATA   EQU   X'05'                    WRITE DATA COMMAND CODE  Y02082 07450002
GOODIO   EQU   X'20'                    TEST VALUE FOR GOOD I/O  Y02082 07500002
BLANK    EQU   C' '                     EBCDIC BLANK             YM2880 07501002
ACQPLN   EQU   96                       ACQUIRE LIST LENGHT    @Y30LSTG 07511003
RELINQ   EQU   X'04'                    RELINQUISH OP CODE     @Y30LSTG 07521003
INHIBDST EQU   X'20'                    INHIBIT DESTAGING      @Y30LSTG 07531003
OFF      EQU   X'FF'                    SWITCH RESETTING MASK  @Z40CSRC 07541037
*                                                                       07550002
         BALR  RBASE,0                                                  07600002
         USING BEGIN,RBASE                                              07650002
         USING SCRTHWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 07700002
         USING UCB,RUCB                 UCB ADDRESSABILITY       Y02078 07750002
         USING CVT,RCVT                                          S19028 07800002
*                                                                       07850002
* THIS SECTION UPDATES THE FORMAT 4 DSCB AND WRITES IT BACK.            07900002
*                                                                       07950002
BEGIN    EQU   *                                                        08000002
         TM    SISW2,DEMNTSW            TEST IF ENTERED FROM     Y02134 08050002
*                                       IGG0290F AFTER DEMOUNT   Y02134 08100002
         BO    RETURNPT                 BRANCH IF YES            Y02134 08150002
         TM    STYPEFLG,VIOBIT          TEST IF A VIO DATA SET   Y02132 08200002
         BO    DEQTEST1                 BRANCH IF YES            Y02132 08250002
         TM    STYPEFLG,VTOCENQ         TEST IF VTOC ENQ'ED      Y02082 08300002
         BNO   TSTALLOC                 BRANCH IF NOT            Y02082 08350002
         CLI   STATUS(VOLISTX),X00      TEST IF ERROR ON VOLUME  Y02082 08400002
         BNE   TESTEXIT                 BRANCH IF YES            Y02082 08450002
         NI    SISW1,X'FF'-NOSMFRCD     RESET NO SMF RCD SWITCH  Y02082 08500002
*                                       SINCE AT LEAST ONE       Y02082 08550002
*                                       SCRATCH WAS SUCCESSFUL   Y02082 08600002
         TM    STYPEFLG,ERXTENT         WERE OVERLAPPING         Y02078 08650002
*                                       EXTENTS FOUND           SA56400 08700002
         BZ    NOERROR                  BRANCH IF NO            SA56400 08750002
         OI    DS4VTOCI,DIRFBIT         TURN ON DIRF BIT        SA56400 09000002
NOERROR  EQU   *                                                SA56400 09050002
         LH    WORKREG2,DS4DSREC                                 Y02082 09100002
         AH    WORKREG2,HOLENUM                                  Y02082 09150002
         STH   WORKREG2,DS4DSREC        UPDATE VTOC HOLE COUNT   Y02082 09200002
         MVC   OUTDSCB(L'VTOCDSCB),VTOCDSCB                      Y02082 09250002
         LA    WORKREG2,L'VTOCDSCB      WRITE 96 BYTES OF DATA   Y02082 09300002
         ST    WORKREG2,CCW8+K4         SET COUNT FIELD          Y02082 09350002
         MVI   CCW8,WRDATA              WRITE DATA COMMAND CODE  Y02082 09400002
         MVC   OUTCCHHR,VTOCADR         SET UP SEARCH ID ADDRESS Y02082 09450002
         MVC   SEEK+K3(L'VTOCADR),VTOCADR                        Y02082 09500002
         LA    WORKREG2,CCW6            MODIFY CCW PTR IN IOB    Y02082 09550002
         ST    WORKREG2,IOB+CHNPGADR                             Y02082 09600002
         MVI   ECB,X00                  CLEAR THE ECB            Y02082 09650002
         EXCP  IOB                                                      09700002
         WAIT  ECB=ECB                  WAIT FOR COMPLETION             09750002
         TM    ECB,GOODIO               TEST FOR AN I/O ERROR    Y02082 09800002
         BO    TESTEXIT                 BRANCH IF NO I/O ERROR          09850002
         MVI   ERCODE+K1,RETCODE8       SET RETURN CODE          Y02082 09900002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 09950002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 10000002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 10050002
         MVI   STATUS(VOLISTX),IOERR    SET ERROR CODE IN VOLIST Y02078 10100002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 10150002
         DROP  R1                                                Y02078 10200002
*                                                                       10250002
* THIS SECTION DEQ'S THE VTOC.                                          10300002
*                                                                       10350002
TESTEXIT EQU   *                                                        10400002
         L     RUCB,WKADEB+UCBADDR      LOAD UCB ADDRESS         Y02078 10450002
         MVC   MINAME(L'SRTEVOLI),SRTEVOLI  MINOR RESOURCE NAME  Y02082 10500002
         MVC   MJNAME(L'VTOCNAME),VTOCNAME  MAJOR RESOURCE NAME  Y02082 10550002
         MVI   ENQAREA,X'FF'            SET LAST ENTRY INDICATOR Y02082 10600002
         SR    R1,R1                    ZERO REGISTER            Y02080 10650002
         STH   R1,ENQAREA+K2            CLEAR FOR DEQ MACRO      Y02080 10700002
         DEQ   (MJNAME,MINAME,6,SYSTEMS),RMC=STEP,MF=(E,ENQAREA)        10750002
*                                                                       10760002
         NI    DSMADTB2,X'FF'-DSMVTOCR-DSMSMCE  RESET VTOC       Y02144 10770002
*                                       ENQ'ED SMC SWITCHES      Y02144 10780002
         NI    STYPEFLG,X'FF'-VTOCENQ   RESET VTOC ENQ'ED SWITCH Y02082 10800002
*                                                                       10850002
         CLI   STATUS(VOLISTX),PSWDERR  TEST IF PASSWORD ERROR   Y02082 10900002
         BE    PASSERR                  IF YES, BRANCH           M3097  10950002
*                                                                       11300002
* THIS SECTION ISSUES MESSAGE IEC603I WITH CODE=0 OR CODE=4.            11350002
*                                                                       11400002
TSTIOERR EQU   *                        TEST IF I/O ERROR        Y02078 11450002
         CLI   STATUS(VOLISTX),IOERR    TEST IF I/O ERROR ON VOL Y02078 11500002
         BNE   TSTOVLAP                 BRANCH IF NO I/O ERROR   Y02078 11550002
         LA    RETURN,ISSUEMSG          SET UP RETURN REGISTER   Y02078 11600002
         B     BUILDMSG                 GO BUILD MESSAGE IEC603I Y02078 11650002
TSTOVLAP EQU   *                        TEST DIRF BIT            Y02078 11700002
         TM    STYPEFLG,ERXTENT         TEST IF DIRF BIT SET DUE Y02078 11750002
*                                       TO OVERLAPPING EXTENTS   Y02078 11800002
         BO    SETREC                   BRANCH IF NOT          @Y30LSTG 11850003
*                                                              @Y30LSTG 11853003
* IF NO ERRORS, THIS ROUTINE RELINQUISHES VIRTUAL DASD SPACE   @Y30LSTG 11856003
*                                                              @Y30LSTG 11859003
         L     R1,RELQADR               POINT TO PARM LIST     @Y30LSTG 11862003
         LTR   R1,R1                    IS THERE ONE           @Y30LSTG 11865003
         BZ    TSTALLOC                 NO, RELINQ. UNNEEDED   @ZM30032 11868003
         CLI   K4(R1),RELINQ            VALID PARM LIST        @Y30LSTG 11871003
         BNE   TSTALLOC                 NO, AGAIN NOTHING TO DO@Y30LSTG 11874003
         MVC   K8(K6,R1),SRTEVOLI       MOVE IN VOLID          @Y30LSTG 11877003
         OI    K6(R1),INHIBDST          SET NO DESTAGING       @Y30LSTG 11880003
         MVI   K0(R1),X00               1ST BYTE NEEDS ZEROING @Y30LSTG 11882003
         MVI   D3(R1),ACQPLN            PUT LENGTH IN MSS MSG  @Y30LSTG 11882403
         ICBACREL TYPE=REL,MF=(E,(1))   RELINQUISH THE SPACE   @Y30LSTG 11883003
         B     TSTALLOC                 CONTINUE               @Y30LSTG 11889003
*   ERROR RETURNS ARE IGNORED AS THE POSTING OF THE INHIBIT    @Y30LSTG 11892003
*   SWITCH IS THE VALID OPERATION REQUIRED                     @Y30LSTG 11895003
SETREC   EQU   *                                               @Y30LSTG 11898003
         LA    RETURN,SETCODE           SET UP RETURN REGISTER   Y02078 11900002
BUILDMSG EQU   *                        BUILD ERROR MSG          Y02078 11950002
         MVC   INDSCB(MSGEND-ERRMSG),ERRMSG  MOVE IN MESSAGE     Y02078 12000002
         MVC   INDSCB+UUU(L'UCBNAME),UCBNAME  MOVE IN EBCDIC UCB Y02078 12050002
*                                       CHANNEL/UNIT ADDRESS     Y02078 12100002
         MVC   INDSCB+VOLID(L'SRTEVOLI),SRTEVOLI  MOVE IN VOLID  Y02078 12150002
         BR    RETURN                   CONTINUE                 Y02078 12200002
SETCODE  EQU   *                        SET CODE                 Y02078 12250002
         MVI   INDSCB+CODE,CODE4        SET CODE=4 IN MESSAGE    Y02078 12300002
ISSUEMSG EQU   *                        ISSUE MESSAGE            Y02078 12350002
         WTO   MF=(E,INDSCB)            ISSUE MESSAGE IEC603I    Y02078 12400002
*                                                                       12450002
* IF THE UNIT WAS DYNAMICALLY ALLOCATED, THIS SECTION BUILDS THE        12500002
* REQUEST BLOCK TO INTERFACE WITH DYNAMIC ALLOCATION (SVC 99) TO        12550002
* UNALLOCATE THE UNIT.                                                  12600002
*                                                                       12650002
TSTALLOC EQU   *                        DYNAMIC ALLOCATN TEST    Y02082 12700002
         TM    SISW1,UCBALLOC           TEST IF UCB ALLOCATED    Y02082 12750002
*                                       BY DYNAMIC ALLOCATION    Y02082 12800002
         BNO   TESTLAST                 BRANCH IF NOT            Y02082 12850002
         LA    RPARM,VTOCDSCB           PARAMETER LIST BASE      Y02082 12900002
         USING S99RBP,RPARM                                      Y02082 12950002
         LA    RWRK,K4(,RPARM)          INCREMENT BY FOUR        Y02082 13000002
         ST    RWRK,S99RBPTR            SET UP REQUEST BLOCK PTR Y02082 13050002
         OI    S99RBPTR,S99RBPND        TURN ON HIGH ORDER BIT   Y02082 13100002
         LR    RPARM,RWRK               ADDRESS OF REQUEST BLOCK Y02082 13150002
         USING S99RB,RPARM              REQ BLOCK ADDRESSABILITY Y02082 13200002
         XC    S99RB(S99RBEND-S99RB),S99RB  ZERO REQ BLOCK CORE  Y02082 13250002
         MVI   S99RBLN,S99RBEND-S99RB   LENGTH OF REQUEST BLOCK  Y02082 13300002
         MVI   S99VERB,S99VRBUN         INDICATE UNALLOCATION    Y02082 13350002
         LA    RWRK,S99RBEND            ADDR OF TEXT POINTERS    Y02082 13400002
         ST    RWRK,S99TXTPP            PLACE IN REQUEST BLOCK   Y02082 13450002
         OI    S99FLG21,S99TIONQ        INDICATE TIOT ENQ'ED     Y02082 13500002
         LR    RPARM,RWRK               ADDRESS OF TEXT PTRS     Y02082 13550002
         USING S99TUPL,RPARM            TEXT PTRS ADDRESSABILITY Y02082 13600002
         LA    RTEXT,FW(,RPARM)         ADDRESS OF TEXT UNIT     Y02082 13650002
         ST    RTEXT,S99TUPTR           POINTER TO TEXT UNIT     Y02082 13700002
         OI    S99TUPTR,S99TUPLN        INDICATE LAST TEXT PTR   Y02082 13750002
         USING S99TUNIT,RTEXT           TEXT UNIT ADDRESSABILITY Y02082 13800002
         LH    RWRK,DDNAMEKY                                     Y02082 13850002
         STH   RWRK,S99TUKEY            DDNAME SPECIFIED         Y02082 13900002
         LA    RWRK,K1                                           Y02082 13950002
         STH   RWRK,S99TUNUM            INDICATE 1 DDNAME ENTRY  Y02082 14000002
         LA    RWRK,L'TIOEDDNM                                   Y02082 14050002
         STH   RWRK,S99TULNG            LENGTH OF TEXT PARM      Y02082 14100002
         L     RDSAB,DSABADDR           GET DSAB ADDRESS         Y02082 14150002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02082 14200002
         L     RTIOT,DSABTIOT           LOAD TIOT ADDRESS        Y02082 14250002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02082 14300002
         MVC   S99TUPAR(L'TIOEDDNM),TIOEDDNM  COPY TIOT'S DDNAME Y02082 14350002
         LA    R1,VTOCDSCB              POINT TO REQUEST BLK PTR Y02082 14400002
         DYNALLOC                                                Y02082 14450002
*                                                                       14460002
         NI    DSMADTB1,X'FF'-DSMUCBAL  RESET UCB ALLOCATED BIT  Y02144 14470002
         NI    SISW1,X'FF'-UCBALLOC     RESET ALLOCATED BIT      Y02082 14500002
*                                                                       14550002
* THIS SECTION BRANCHES BACK TO IGG0290E IF THE DATA SET MUST BE        14600002
* SCRATCHED FROM ANOTHER VOLUME.                                        14650002
*                                                                       14700002
TESTLAST EQU   *                        TEST EXIT BIT            Y02082 14750002
         TM    STYPEFLG,EXITBIT         IS EXIT BIT SET          Y02082 14800002
         BO    DEQTEST1                 BRANCH IF SET            Y02082 14850002
         NI    STYPEFLG,X'FF'-ERXTENT-DOSPACK  TURN OFF OVERLAP  Y02080 14900002
*                                       INDICATOR AND DOS PACK   XM1038 14950002
*                                       INDICATOR                XM1038 15000002
         LA    R7,LOAD2                 POINT TO ID OF IGG0290E  Y02134 15050002
         L     R1,RELQADR               POINT TO PARM LIST     @Y30LSTG 15060003
         LTR   R1,R1                    IS THERE ONE           @Y30LSTG 15070003
         BZ    LOADEXIT                 NO. GO TO EXIT         @ZM30032 15080003
         XC    K0(ACQPLN,R1),K0(R1)     ZERO IT OUT IF IT EXIST@Y30LSTG 15090003
*                                                                       15100002
* THIS SECTION BRANCHES TO ANOTHER LOAD OF SCRATCH.                     15150002
*                                                                       15200002
LOADEXIT EQU   *                        EXIT TO NEXT LOAD        Y02134 15250002
         L     RA,OLDPLPTR              GET PARAMETER LIST POINTER      15300002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02080 15350002
         IECRES LOAD,EXTPR=(RWKAREA),MODID=(R7),BRANCH=DIRECT    Y02134 15400002
*                                                                       15450002
* THIS SECTION STORES THE PASSWORD ERROR CODE IN THE REMAINING VOLUME   15500002
* LIST ENTRIES.                                                         15550002
*                                                                       15600002
PASSERR  EQU   *                                                        15650002
         LH    VOLCTR,VOLNUM            NUMBER OF REMAINING VOLS Y02082 15700002
         LA    VOLCTR,K1(VOLCTR)        INCREMENT BY ONE         Y02082 15750002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 15800002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 15850002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 15900002
ERRLOOP  EQU   *                                                        15950002
         MVI   STATUS(VOLISTX),PSWDERR  SET PASSWORD ERROR       Y02078 16000002
         LA    VOLISTX,ENTRYL(VOLISTX)  POINT TO NEXT ENTRY      Y02078 16050002
         BCT   VOLCTR,ERRLOOP           BRANCH IF MORE VOLUMES   Y02082 16100002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 16150002
         DROP  R1                                                Y02078 16200002
         MVI   ERCODE+K1,RETCODE8       SET RETURN CODE          Y02082 16250002
         B     TSTALLOC                 GO TEST IF ALLOCATED     Y02082 16300002
*                                                                       16350002
* IF A VOLUME WAS ENQ'ED AND MOUNTED BY IGG0290F, THIS SECTION          16400002
* BRANCHES TO IGG0290F TO DEMOUNT AND DEQ THE VOLUME.                   16450002
*                                                                       16500002
DEQTEST1 EQU   *                        DEQ VPL TEST             Y02082 16550002
         TM    SISW1,VOLDEQ             TEST IF VOL TO BE DEQ'ED Y02082 16600002
         BNO   DEQTEST2                 BRANCH IF NOT            Y02082 16650002
         OI    SISW2,DEMNTSW            SET DEMOUNT SWITCH       Y02134 16700002
         LA    R2,WKADEB                DEB ADDRESS IN REG 2     Y02134 16750002
         L     RUCB,PRUCBPTR            UCB ADDRESS IN REG 11    Y02134 16800002
         LA    R3,SRTEVOLI              VOLSER ADDR IN REG 3     Y02134 16850002
         L     R4,RETNAME               RETURN MODULE NAME       Y02134 16900002
         LA    R7,MNTLOAD               POINT TO ID OF IGG0290F  Y02134 16950002
         B     LOADEXIT                 GO BRANCH TO IGG0290F    Y02134 17000002
RETURNPT EQU   *                        RETURN HERE              Y02134 17050002
         NI    SISW2,X'FF'-DEMNTSW      RESET DEMOUNT SWITCH     Y02134 17100002
*                                                                       17150002
* IF SCRATCH ENQ'ED ON THE DSNAME, THIS SECTION ISSUES A DEQ            17200002
* DIRECTED TO THE INITIATOR'S TCB.                                      17250002
*                                                                       17300002
DEQTEST2 EQU   *                        DEQ SYSDSN TEST          Y02082 17350002
         TM    SISW2,DSNENQCV           IS CVOL SYSDSN ENQ'D   @Z40CSRC 17360037
         BO    STRIPBLK                 YES, GO STRIP BLANKS   @Z40CSRC 17370037
DSNQTST  EQU   *                        REGULAR SYSDSN ENQ TST @Z40CSRC 17380037
         TM    SISW1,DSNENQ             TEST IF ENQ'ED ON SYSDSN Y02082 17400002
         BNO   DEQTEST3                 BRANCH IF NOT            Y02082 17450002
STRIPBLK EQU   *                        STRIP TRAILING BLANKS  @Z40CSRC 17450237
         LA    R4,PDSNAME+L'PDSNAME-K1  LAST BYTE OF DSNAME      YM2880 17451002
TESTDSN  EQU   *                        SEARCH FOR NON-BLANK     YM2880 17452002
         CLI   K0(R4),BLANK             IS THIS ONE A BLANK      YM2880 17453002
         BNE   GETLNGTH                 BRANCH IF NO TO COMPUTE  YM2880X17454002
                                        LENGTH OF NAME FOR DEQ   YM2880 17455002
         BCT   R4,TESTDSN               TRY NEXT BYTE            YM2880 17456002
GETLNGTH EQU   *                        CALCULATE LENGTH         YM2880 17457002
*                                                                       17457237
* IF DSNENQCV IS ON INDICATING AN ENQ WAS DONE ON THE NAME              17457437
* SYSCTLG.VXXXXXX (WHERE XXXXXX IS THE VOLSER), ADD THE                 17457637
* SUFFIX QUALIFIER TO THE SIMPLE NAME SYSCTLG.                          17457837
*                                                                       17457937
         TM    SISW2,DSNENQCV           SYSCTLG.VXXXXXX ENQ'D? @Z40CSRC 17458137
         BNO   PASTCVOL                 NO, SKIP CVOL CODE     @Z40CSRC 17458237
         MVC   K1(L'CDOTV,R4),CDOTV     MOVE IN '.V'           @Z40CSRC 17458437
         MVC   K3(L'UCBVOLI,R4),VOLSER(VOLISTX) MV IN VOLSER   @Z40CSRC 17458637
         LA    R4,KDOTVVL(,R4)          ADJUST FOR LONGER NAME @Z40CSRC 17458837
PASTCVOL EQU   *                        BEYOND CVOL SUFFIXING  @Z40CSRC 17459037
         LA    R2,PDSNAME-K1            BYTE PRECEDING DSNAME    YM2880 17459237
         SR    R4,R2                    R4 HAS LENGTH FOR DEQ    YM2880 17459437
         L     R2,TCBADDR               LOAD TCB ADDRESS         Y02082 17550002
         USING TCB,R2                   TCB ADDRESSABILITY       Y02082 17600002
         L     R2,TCBJSCB               LOAD JSCB ADDRESS        Y02082 17650002
         USING IEZJSCB,R2               JSCB ADDRESSABILITY      Y02082 17700002
         L     R2,JSCBACT               GET ACTIVE JSCB ADDRESS  YM2887 17701002
         L     R2,JSCBTCBP              ADDR OF INITIATOR'S TCB  Y02082 17750002
         MVC   ENQAREA(DEQLTH1),DEQLIST1 MOVE IN DEQ PARM LIST   Y02082 17800002
         MVC   MJNAME(L'DSNMJR),DSNMJR  MAJOR RESOURCE NAME      Y02082 17850002
         DEQ   (MJNAME,PDSNAME,(R4)),TCB=(R2),MF=(E,ENQAREA)     YM2880 17900002
*                                       ISSUE DEQ                YM2880 17910002
         TM    SISW2,DSNENQCV           IS DSNAME SUFFIXED     @Z40CSRC 17911037
         BNO   NOSUFFIX                 NO, SKIP BLANKING      @Z40CSRC 17911237
         NI    SISW2,OFF-DSNENQCV       RESET SUFFIX FLAG      @Z40CSRC 17912037
         LA    R4,PDSNAME-KDOTVVL(R4)   POINT AT '.VXXXXXX'    @Z40CSRC 17913037
         MVC   K0(KDOTVVL,R4),KDOTVVL(R4)  BLANK OUT SUFFIX    @Z40CSRC 17914037
         B     DSNQTST                  GO CHECK FOR REG. ENQ  @Z40CSRC 17915037
NOSUFFIX EQU   *                        NO SUFFIX TO BLANK     @Z40CSRC 17916037
         NI    DSMADTB2,X'FF'-DSMDSNE   RESET DSN ENQ'ED SWITCH  Y02144 17920002
*                                                                       17950002
* IF SCRATCH ENQ'ED ON THE TIOT, THIS SECTION ISSUES A DEQ.             18000002
*                                                                       18050002
DEQTEST3 EQU   *                        DEQ TIOT TEST            Y02082 18100002
         TM    SISW1,TIOTENQ            TEST IF ENQ'ED ON TIOT   Y02082 18150002
         BNO   TESTSMF                  BRANCH IF NOT            Y02082 18200002
         MVC   ENQAREA(DEQLTH2),DEQLIST2  MOVE IN DEQ PARM LIST  Y02082 18250002
         MVC   MJNAME(L'TIOTMJR),TIOTMJR  MAJOR RESOURCE NAME    Y02082 18300002
         DEQ   (MJNAME,TIOTMNR),MF=(E,ENQAREA)  DEQ FROM TIOT    Y02082 18350002
*                                                                       18360002
         NI    DSMADTB2,X'FF'-DSMTIOTE  RESET TIOT ENQ'ED SWITCH Y02144 18370002
*                                                                       18400002
* THIS SECTION DETERMINES IF AN SMF RECORD TYPE 17 MUST BE BUILT.       18450002
*                                                                       18500002
TESTSMF  EQU   *                                                 S19028 18550002
         TM    SISW1,NOSMFRCD           TEST IF SCRATCH TOTALLY  Y02082 18600002
*                                       OR PARTIALLY SUCCESSFUL  Y02082 18650002
         BO    EXIT                     BRANCH IF NOT            Y02082 18700002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02082 18750002
         L     R2,TCBADDR               LOAD TCB ADDRESS         Y02082 18800002
         USING TCB,R2                   TCB ADDRESSABILITY       Y02082 18850002
         L     R2,TCBTCT                POINTER TO TCB           Y02082 18900002
         LA    R2,0(R2)                 CLEAR HI-ORDER         @ZA04736 18920037
         LTR   R2,R2                    TEST FOR TCT             M4916  18950002
         BZ    EXIT                     BRANCH IF NO TCT         M4916  19000002
         USING SMFTCT,R2                TCT ADDRESSABILITY       Y02082 19050002
         L     R2,TCTJMR                LOAD JMR ADDRESS         Y02082 19100002
         LTR   R2,R2                    IS THERE A JMR           Y02082 19150002
         BZ    EXIT                     BRANCH IF NOT            Y02082 19200002
         USING JMRJOB,R2                JMR ADDRESSABILITY       Y02082 19250002
         L     RA,CVTSMCA                                        S19028 19300002
         LTR   RA,RA                    IS THIS AN SMF SYSTEM    S19028 19350002
         BZ    EXIT                     BRANCH IF NO             S19028 19400002
         USING SMCABASE,RA                                       S19028 19450002
         TM    SMCAOPT,SMCADSA          IS DS RECORDING DESIRED  S19028 19500002
         BNO   EXIT                     BRANCH IF NO             S19028 19550002
         L     R6,OLDPLPTR              GET PARM LIST POINTER    S19028 19600002
         L     R7,4(R6)                 DSNAME PTR WITH IND BYTE S19028 19650002
         L     VOLISTX,K12(R6)          VOLUME LIST POINTER      Y02082 19700002
*                                                                       19750002
* THE FOLLOWING SECTION TESTS IF SMF TYPE 17 RECORDS MUST BE BUILT      19800002
* FOR TEMPORARY DATA SETS.  THE CALLER MUST BE IN SUPERVISOR STATE,     19850002
* IN KEY 0, OR AUTHORIZED TO TEST THE SYSIN/SYSOUT BIT IN THE JFCB.     19900002
*                                                                       19950002
         STM   RETURN,R3,IECREGSV+K12   SAVE TESTAUTH REGISTERS  Y02082 20000002
         TESTAUTH STATE=YES,KEY=YES,FCTN=1,BRANCH=YES  TEST IF   Y02082X20050002
                                        CALLER IS IN KEY 0 OR    Y02082X20100002
                                        IN SUPERVISOR STATE      Y02082 20150002
         LR    R4,R15                   SAVE RETURN CODE         Y02082 20200002
         LM    RETURN,R3,IECREGSV+K12   RESTORE REGISTERS        Y02082 20250002
         LTR   R4,R4                    TEST IF ANY CASE TRUE    Y02082 20300002
         BNZ   TESTNAME                 BRANCH IF NOT            Y02082 20350002
         TM    4(R6),X'40'              WAS ENTRY FROM A RDR OR  S19028 20400002
*                                       A WTR                    S19028 20450002
         BO    EXIT                     BRANCH IF YES            S19028 20500002
         TM    4(R6),X'80'              WAS ENTRY FROM STEP TERM S19028 20550002
*                                       OR JOB TERM? IF SO, THE  S19028 20600002
*                                       DSNAME PTR POINTS TO THE S19028 20650002
*                                       JFCBDSNM                 S19028 20700002
         BNO   TESTNAME                 BRANCH IF NO             Y02082 20750002
         USING INFMJFCB,R7                                       S19028 20800002
         TM    JFCBTSDM,JFCSDS          IS THIS A SYSIN/SYSOUT   S19028 20850002
*                                       DATA SET                 S19028 20900002
         BO    EXIT                     BRANCH IF YES            S19028 20950002
         DROP  R7                                                YM1337 20960002
TESTNAME EQU   *                        TEST NAME                Y02082 21000002
         CLC   SYSTEMDS,PDSNAME         SYSTEM GENERATED NAME?   YM1337 21050002
         BNE   BUILDSMF                 BRANCH IF NOT            A43551 21100002
         CLC   SYSTIME,PDSNAME+K8       TEST FOR CHARACTERS '.T' YM1337 21150002
         BNE   BUILDSMF                 BRANCH IF NOT            A43551 21200002
         CLI   PDSNAME+K16,PERIOD       TEST IF A TEMPORARY DS   YM1337 21250002
         BNE   BUILDSMF                 BRANCH IF NOT            A43551 21300002
         TM    SMCAOPT,SMCATDS          TEST IF RCD 17 DESIRED   A43551 21350002
*                                       FOR TEMPORARY DATA SETS  A43551 21400002
         BNO   EXIT                     BRANCH IF NO             S19028 21450002
*                                                                       21500002
* THIS SECTION CALCULATES IF ANOTHER WORK AREA MUST BE OBTAINED         21550002
* TO BUILD THE SMF RECORD TYPE 17.                                      21600002
*                                                                       21650002
BUILDSMF EQU   *                                                 A43551 21700002
         LH    VOLCTR,K0(VOLISTX)       GET THE NUMBER OF VOLS   Y02082 21750002
         LA    VOLISTX,K2(VOLISTX)      POINT TO FIRST ENTRY     Y02082 21800002
         LA    R4,WKADEB-SMF17RV2       DETERMINE HOW MANY VOLS  Y02082 21850002
         SRL   R4,3                     WILL FIT IN THE WKAREA   Y02082 21900002
         LA    R3,SMF17HDR              POINT TO SMF RECORD      Y02080 21950002
         CR    R4,VOLCTR                WILL ALL VOLS FIT IN     Y02082 22000002
*                                       THE SCRATCH WORK AREA    Y02082 22050002
         BNL   COREOK                   BRANCH IF YES            S19028 22100002
         LR    R4,VOLCTR                CALCULATE CORE NEEDED    Y02082 22150002
         SLL   R4,K3                    VOL COUNT TIMES 8        Y02082 22200002
         LA    R4,SMF17RV2-SMF17HDR(R4)  SET UP TO GET CORE      Y02082 22250002
         IECRES GET,EXTPR=(RWKAREA),ID=SCWA,LV=(R4),             Y02082X22300002
               STM=(R2,RETURN,IECREGSV+K12)                      Y02080 22350002
         LR    R3,R1                    GET WORK AREA ADDRESS    Y02082 22400002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO AFTER Y02082X22450002
                                        ISSUING THE IECRES GET   Y02082 22500002
         USING SMF17HDR,R3              ADDRESSABILITY           Y02082 22550002
*                                                                       22600002
* THIS SECTION BUILDS AN SMF RECORD TYPE 17.                            22650002
*                                                                       22700002
COREOK   EQU   *                                                 A43551 22750002
         XC    SMF17HDR(6),SMF17HDR     ZERO RECORD HEADER       A43551 22800002
         MVI   SMF17RTY,SMFREC17        SET RECORD TYPE          Y02082 22850002
         TIME  BIN                                               S19028 22900002
         STM   R0,R1,SMF17TME+2         TIME OF RECORD           S19028 22950002
         MVC   SMF17TME(8),SMF17TME+2                            S19028 23000002
         MVC   SMF17SID(4),SMCASID                               S19028 23050002
         DROP  RA                                                S19028 23100002
         MVC   SMF17JBN(SMF17UID-SMF17JBN),JMRJOB  JOB NAME      Y02082 23150002
         MVC   SMF17UID,JMRUSEID        USER ID FIELD            Y02082 23200002
         DROP  R2                                                Y02082 23250002
         XC    SMF17RIN,SMF17RIN        ZERO RECORD INDICATORS   Y02082 23300002
         MVC   SMF17DSN,PDSNAME         NAME OF SCRATCHED DS     YM1337 23350002
         XC    SMF17RV1,SMF17RV1        ZERO RESERVED AREA       Y02082 23400002
         XR    R7,R7                                             S19028 23450002
         LA    R2,SMF17RV2                                       Y02082 23500002
         USING SMF17RV2,R2                                       Y02082 23550002
TESTVOL  EQU   *                        WAS SCRATCH SUCCESSFUL   Y02082 23600002
         CLI   STATUS(VOLISTX),X00      WAS SCRATCH SUCCESSFUL   Y02082 23650002
         BNE   NEXTVOL                  BRANCH IF NOT            Y02082 23700002
         XC    SMF17RV2,SMF17RV2                                 Y02082 23750002
         MVC   SMF17FVL,VOLSER(VOLISTX)  MOVE VOL SER TO RECORD  Y02082 23800002
         LA    R7,1(R7)                 INCREMENT VOLUME COUNT   S19028 23850002
         LA    R2,SMF17LNV(R2)          INCREMENT RECORD PTR     Y02082 23900002
NEXTVOL  EQU   *                        NEXT VOLUME              Y02082 23950002
         LA    VOLISTX,ENTRYL(VOLISTX)  INCREMENT VOL LIST PTR   Y02082 24000002
         BCT   VOLCTR,TESTVOL           BRANCH IF MORE VOLUMES   Y02082 24050002
         LTR   R7,R7                    IS VOLUME COUNT ZERO     S19028 24100002
         BZ    EXIT                     BRANCH IF YES            S19028 24150002
         STC   R7,SMF17NVL              NUMBER OF SCRATCHED VOLS S19028 24200002
         DROP  R2                                                Y02082 24250002
         SR    R2,R3                    GET RECORD LENGTH AND    Y02082 24300002
         STH   R2,SMF17LEN              STORE IN RECORD          Y02082 24350002
         DROP  R3                                                Y02082 24400002
         LR    R1,R3                    POINT TO SMF RECORD      Y02082 24450002
         SMFWTM (1)                     WRITE SMF RECORD TYPE 17 A43551 24500002
*                                                                       24550002
* THIS SECTION RESTORES THE DEB AVT POINTER IF AN RPS WORK AREA EXISTS. 24600002
*                                                                       24650002
EXIT     EQU   *                                                        24700002
         TM    DSMADTB1,DSMRPSAP        TEST IF RPS APPENDAGE    YM3048X24710002
                                        IGG019EK WAS LOADED      YM3048 24720002
         BNO   CONTINUE                 BRANCH IF NOT            YM3048 24730002
         L     R1,WKADEB+APDIS          POINT TO APPENDAGE TABLE Y02082 24750002
         MVC   WKADEB+APDIS(K4),APSVA(R1)  RESTORE DEB AVT PTR   Y02082 24950002
         NI    DSMADTB1,X'FF'-DSMRPSAP  RESET RPS APP LOADED BIT Y02144 25020002
*                                                                       25050002
* THIS SECTION FREES ALL WORK AREAS AND RETURNS TO THE CALLER.          25100002
*                                                                       25150002
CONTINUE EQU   *                                                 S20201 25200002
         LH    R8,ERCODE                PICK UP ERROR CODE       Y02080 25250002
         L     RA,SCRSAVE               SAVE R14 IN R10        @G60ASBJ 25300060
         IECRES FREE,PREFIX=FIRST,A=(RWKAREA)                    Y02080 25330060
         LR    RETURN,RA                RESTORE R14            @G60ASBJ 25360060
         LR    R15,R8                   LOAD ERROR CODE          Y02080 25450002
         RETURN ,                                                Y02080 25500002
*                                                                       25550002
*** CONSTANTS                                                           25600002
*                                                                       25650002
ERRMSG   WTO   'IEC603I VTOC ERRORS MAY EXIST ON UUU,VOLSER,0',  Y02078X25700002
               ROUTCDE=(4,10),DESC=4,MF=L                        Y02078 25750002
MSGEND   EQU   *                        END OF MSG               Y02078 25800002
VTOCNAME DC    CL8'SYSVTOC '                                            25850002
SYSTEMDS DC    C'SYS'                   EBCDIC CHARACTERS 'SYS'  A43551 25950002
SYSTIME  DC    C'.T'                    EBCDIC CHARACTERS '.T'   A43551 26000002
CDOTV    DC    C'.V'                    CVOL SUFFIX CONSTAN    @Z40CSRC 26010037
DEQLIST1 DEQ   (,,,SYSTEM),TCB=0,MF=L   SYSDSN DEQ LIST          YM2880 26050002
DEQLTH1  EQU   *-DEQLIST1               LENGTH OF DEQ LIST       Y02082 26100002
DEQLIST2 DEQ   (,,6,SYSTEM),MF=L        SYSZTIOT DEQ LIST        YM2880 26150002
DEQLTH2  EQU   *-DEQLIST2               LENGTH OF DEQ LIST       Y02082 26200002
         DS    0F                       FULLWORD BOUNDARY        Y02134 26250002
RETNAME  DC    CL4'290D'                RETURN NAME FOR IGG0290F Y02134 26300002
TIOTMJR  DC    CL8'SYSZTIOT'            TIOT MAJOR RESOURCE NAME Y02082 26350002
DSNMJR   DC    CL8'SYSDSN'              DSN MAJOR RESOURCE NAME  Y02082 26400002
DDNAMEKY DC    AL2(DUNDDNAM)            DDNAME UNALLOCATION KEY  Y02082 26450002
*                                                                       26500002
*** TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                       26550002
*                                                                       26600002
         XCTLTABL ID=(LOAD2,0E,MNTLOAD,0F),SVC=029,LENGTH=,      Y02134X26650002
               BRT=YES                                           Y02134 26700002
         SPACE 2                                                 Y02082 26750002
         IECDSECS CVT,DSAB,JMR,JSCB,QDB,RB,SMF,SMFTCT,TCB,TIOT,  Y02082X26800002
               UCB,EXPAND=YES                                    Y02082 26850002
JFCB     DSECT                                                 , S19028 26900002
         IEFJFCBN                                              , S19028 26950002
         EJECT                                                          27000002
WORKAREA IECSCRWA EP,F4,ADT=YES         SCRATCH WORK AREA        Y02144 27050002
         SPACE 2                                                 Y02080 27100002
         ORG   VTOCDSCB                                          Y02080 27150002
         IFASMFR   (17)                                          S19028 27200002
         EJECT                                                   Y02082 27250002
*                                                                       27300002
* DSECTS FOR INVOCATING DYNAMIC ALLOCATION (SVC 99)                     27350002
*                                                                       27400002
         IEFZB4D0                       DYNAMIC ALLOCATION DSECT Y02082 27450002
         EJECT                                                   Y02082 27500002
         IEFZB4D2                       DYNAMIC ALLOCATION KEYS  Y02082 27550002
KDOTVVL  EQU   L'CDOTV+L'UCBVOLI        CVOL SUFFIX LENGTH     @Z40CSRC 27560037
         END   IGG0290D                                          A43551 30000002
./  ADD  SSI=51960085,NAME=IGG0290E
   TITLE 'IGG0290E - DADSM SCRATCH - LOCATE VOLUME TO BE PROCESSED'     00100002
IGG0290E CSECT                                                     DM0Q 00270018
*          RELEASE 16 DELETIONS                                         00340000
*1665                                                              AAAA 00370016
*          RELEASE 17 DELETIONS                                         00410000
*          RELEASE 18 DELETIONS                                         00480000
*0762284000-286000,322000,406000-418000                           8M603 00482018
*    002700,204000-206000,286000,356000,396000,400000,669000-670000DM0Q 00485018
*0762670000                                                       21488 00490018
*0762                                                             21421 00510018
*0762228000                                                       25512 00530018
*          RELEASE 19 DELETIONS                                         00550000
*2175                                                            A27090 00555019
*2175002000,267200-279200,288000-306000,324000-346000,384000-    S19028 00560019
*2175524000,530000-534000,540000-644000,652000,710000-718000,    S19028 00570019
*2175726000,870000                                               S19028 00580019
*2175276500,324000                                               M4900  00600019
*2175                                                            A28896 00605019
* 276300                                                          M3041 00610019
*2175                                                            A29244 00615019
*          RELEASE 20 DELETIONS                                         00620000
*0792232000,242000                                               S20201 00650020
*          RELEASE 21 DELETIONS                                         00690000
*1198148000,277700-278600,294000                                 A41439 00700021
*1198014000-046000,082000-098000,128000-144000,148000,158000,    A38841 00710021
*1198271400-271700,711000,726000,846000-852000                   A38841 00730021
*          RELEASE 21.7 DELETIONS                                       00760002
*0000007600-009000,532000,712000-725200,802000-814000           SA56400 00810002
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00830002
*0000000100-000500,010000,050000,058000-072000,090000-095000,    Y02080 00830102
*0000136000-138000,148000-150000,186000,212000-214000,220000-    Y02080 00830202
*0000221000,271130-271160,271500-275000,278900,280000-282000,    Y02080 00830302
*0000294000-324000,350000-354900,355500-356500,360000,364000,    Y02080 00830402
*0000526000,526400,528000-538000,710000,712000,725800-838000,    Y02080 00830502
*0000842000-854000,860000-866000,869000                          Y02080 00830602
*0000                                                            Y02078 00830702
*0000014000-034000,052000-136600,148000-150000,154000-156000,    Y02082 00830802
*0000172000,176000,182000,197000,219800-221000,229200-230000,    Y02082 00830902
*0000246000-248000,266900-268400,275600,276400-276800,278100-    Y02082 00831002
*0000528000,656000-708000,712000-712500,725800-870000            Y02082 00831102
*0000                                                            Y02134 00831202
*0000                                                            Y02144 00831302
*0000266600,267690,275300,282200,302000,303200,328700            YM1337 00831402
*0000062000,294200-294500,712000-713000                          YM3997 00831502
*0000267660,275600                                               YM1063 00831602
*0000292700-293600                                               YM5371 00832002
*0000268260,350300                                               YM7036 00834002
*0000275600-275650                                               YM7377 00836002
*0000268460                                                      YM7515 00837002
*0000294600-294800                                               YM6546 00842002
*          VS2 RELEASE 03 DELETIONS/CHANGES                             00852002
*0000                                                           ZA00119 00854002
*0000269000                                                    @ZA01347 00855003
*                                                                       00860002
*          VS2 RELEASE 04 DELETIONS/CHANGES                             00860203
*0000269300-269600                                              ZA05225 00860403
*                                                                       00861002
*MODULE NAME - IGG0290E                                                 00862002
*                                                                       00863002
*DESCRIPTIVE NAME - DADSM SCRATCH - LOCATE VOLUME TO BE PROCESSED       00864002
*                                                                       00865002
*COPYRIGHT - NONE                                                       00866002
*                                                                       00867002
*CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD           00868002
*                                                                       00869002
*STATUS CHANGE LEVEL 005                                                00950021
*                                                                       01000002
*ATTRIBUTES - REENTRANT                                                 01200002
*                                                                       01300002
*FUNCTION - AFTER BUILDING THE DEB/DCB AND THE IOB, THIS MODULE         01400002
*          SEARCHES THE TIOT TO SEE IF THE CURRENT VOLUME IN THE        01500002
*          VOLUME LIST IS MOUNTED ON A UNIT ALLOCATED TO THE JOB.       01600002
*          IF THE VOLUME IS NOT MOUNTED ON AN ALLOCATED UNIT, IT        01700002
*          SEARCHES THE UCB LOOKUP TABLE TO DETERMINE IF THE VOLUME     01800002
*          IS MOUNTED ANYWHERE.  IF IT IS MOUNTED, DYNAMIC ALLOCATION   01900002
*          IS CALLED TO TRY TO ALLOCATE THE UNIT.  IF THE VOLUME IS     02000002
*          NOT MOUNTED ANYWHERE OR IF THE UNIT CANNOT BE DYNAMICALLY    02100002
*          ALLOCATED, AND THERE IS A PRIMARY UCB, CONTROL IS GIVEN TO   02200002
*          THE SCRATCH/RENAME DEMOUNT/MOUNT/VERIFY ROUTINE TO MOUNT     02300002
*          THE VOLUME.  IF THERE IS NO PRIMARY UCB OR IF THE VOLUME     02400002
*          CANNOT BE MOUNTED, THE NEXT VOLUME IN THE VOLUME LIST IS     02500002
*          PROCESSED.  IF THE VOLUME WAS FOUND TO BE MOUNTED ON AN      02600002
*          ALLOCATED UNIT, BUT THE UNIT IS NOT READY AND THE    ZA00119 02750002
*          MOUNT BIT IS ON, THE VOLUME CAN NOT BE MOUNTED.      ZA00119 02770002
*          IF THE VOLUME WAS FOUND TO BE MOUNTED ON AN ALLOCATEDZA00119 02772002
*          UNIT AFTER THE UNIT CONTAINING THE VOLUME IS         ZA00119 02780002
*          DYNAMICALLY ALLOCATED, OR AFTER THE VOLUME IS MOUNTED ON     02800002
*          THE PRIMARY UCB, THIS MODULE INITIALIZES FOR RPS PROCESSING  02900002
*          IF THE DEVICE HAS THE RPS FEATURE.  IT THEN ENQ'S ON THE     03000002
*          VTOC BEFORE GIVING CONTROL TO THE NEXT LOAD OF SCRATCH.      03100002
*          IF ALL THE VOLUME LIST ENTRIES HAVE BEEN PROCESSED, CONTROL  03200002
*          IS GIVEN TO THE LAST LOAD OF SCRATCH.                        03300002
*                                                                       03600021
*ENTRIES - THE ONLY ENTRY POINT IS IGG0290E. ENTRY IS MADE FROM         03800021
*          IGC0002I, IGG0290F, OR IGG0290D.                             04000021
*                                                                       04800013
*SUPERVISOR CALLS AND EXTERNAL ROUTINES -                               05000002
*          RESERVE  - ENQ'S ON THE VTOC (SVC 56)                        05200002
*          DYNALLOC - DYNAMICALLY ALLOCATES THE UNIT (SVC 99)           05400002
*          MODESET  - SWITCHES TO THE CALLER'S KEY                      05600002
*          IECRES   - BRANCHES TO OTHER SCRATCH MODULES                 05800002
*          IECRPS   - USES IECRES TO OBTAIN THE RPS WORK AREA           06000002
*                   - LOCATES THE RPS SIO APPENDAGE IGG019EK            06200002
*                                                                       06400002
*OTHER MACROS ISSUED -                                                  06600002
*          IECDSECS - EXPANDS THE CVT, DSAB, QDB, RB, RRPL, TCB,        06800002
*                     TIOT, AND UCB DSECTS                              07000002
*          IECSCRWA - EXPANDS THE SCRATCH WORK AREA                     07200002
*          IEFZB4D0 - EXPANDS THE DYNAMIC ALLOCATION REQUEST BLOCK      07400002
*          IEFZB4D2 - EXPANDS THE DYNAMIC ALLOCATION TEST UNIT KEYS     07600002
*          XCTLTABL - BUILDS A LIST OF MODULE ID'S AND ADDRESSES        07800002
*                                                                       08000002
*INPUT -   AT ENTRY TO THIS MODULE REGISTER 9 POINTS TO THE CVT.        08200002
*          REGISTER 10 POINTS TO THE PARAMETER LIST.  REGISTER 13       08400002
*          POINTS TO THE WORK AREA, IN WHICH 'VOLNUM' CONTAINS THE      08600002
*          NUMBER OF VOLUMES REMAINING TO BE SCRATCHED, AND 'VOLPTR'    08800002
*          CONTAINS THE ADDRESS OF THE CURRENT ENTRY IN THE VOLUME      09000002
*          LIST.                                                        09200002
*          IF REENTRY FROM IGG0290F, REGISTER 14 CONTAINS ONE OF        09400002
*          THE FOLLOWING RETURN CODES:                                  09600002
*          00 - VOLUME WAS SUCCESSFULLY MOUNTED AND/OR VERIFIED         09800002
*          04 - VOLUME COUND NOT BE DEMOUNTED                           10000002
*          08 - VOLUME COULD NOT BE MOUNTED                             10200002
*          0C - I/O ERROR OCCURRED WHEN READING THE VOLUME LABEL        10400002
*          ALSO, REGISTER 5 CONTAINS THE NUMBER OF VOLUMES REMAINING    10600002
*          TO BE SCRATCHED, AND REGISTER 8 POINTS TO THE CURRENT ENTRY  10800002
*          IN THE VOLUME LIST.                                          11000002
*                                                                       11200002
*OUTPUT - REGISTER 8 POINTS TO THE CURRENT ENTRY IN THE VOLUME LIST.    11400002
*         REGISTER 9 POINTS TO THE CVT, AND REGISTER 10 POINTS TO       11600002
*         THE PARAMETER LIST.  REGISTER 13 POINTS TO THE WORK AREA,     11800002
*         IN WHICH THE DEB CONTAINS THE UCB ADDRESS OF THE VOLUME       12000002
*         WHOSE DATA SET IS TO BE SCRATCHED.                            12200002
*         THE FOLLOWING ADDITIONAL INFORMATION IS PASSED TO IGG0290F:   12400002
*         REGISTER 2 POINTS TO THE DEB.                                 12600002
*         REGISTER 3 POINTS TO THE VOLUME SERIAL NUMBER.                12800002
*         REGISTER 4 CONTAINS THE CHARACTERS '290E'.                    13000002
*         REGISTER 11 CONTAINS THE PRIMARY (DEMOUNTABLE) UCB ADDRESS.   13200002
*                                                                       14600013
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    14800002
*          WORK AREA = 896 BYTES                                        15000002
*          RPS WORK AREA = 128 BYTES                                    15100002
*                                                                       15200013
*ERROR CONDITIONS - NO DEVICE AVAILABLE FOR MOUNTING THE VOLUME         15400002
*                                                                       16000013
*REGISTER USAGE:                                                        16200013
R0       EQU   0                                                        16400013
R1       EQU   1                                                        16600013
RPARM    EQU   2                        PTR TO SVC 99 PARM LIST  Y02082 16700002
R2       EQU   2                                                        16800013
RDSAB    EQU   2                        POINTER TO DSAB          Y02082 16900002
R3       EQU   3                                                        17000013
RWRK     EQU   3                        WORK REGISTER            Y02082 17100002
RTIOT    EQU   3                        POINTER TO TIOT          Y02082 17200002
RTEXT    EQU   4                        POINTER TO TEXT UNIT     Y02082 17300002
R4       EQU   4                                                        17400013
REND     EQU   4                        POINTER TO END OF ENTRY  Y02082 17600002
R5       EQU   5                                                        17800013
VOLCTR   EQU   5                                                        18000013
R6       EQU   6                        WORK REGISTER            Y02082 18200002
R7       EQU   7                                                 S19028 18300019
VOLISTX  EQU   8                                                        18400013
RCVT     EQU   9                                                        18800013
PL       EQU   10                                                       19000013
RUCB     EQU   11                                                       19200013
RBASE    EQU   12                                                       19400013
RWKAREA  EQU   13                                                       19600013
RETURN   EQU   14                                                       19800013
RTNCODE  EQU   15                       RETURN CODE REGISTER     Y02082 19900002
WORKREG  EQU   15                                                       20000013
*                                                                       20100002
         BALR  RBASE,R0                                                 20800013
         USING BLDBLKS,RBASE                                            21000013
         USING SCRTHWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 21400002
         USING UCB,RUCB                                                 21600013
         USING CVT,RCVT                                                 21800013
*                                                                       21850021
*** OTHER EQUATES                                                       21900021
*                                                                       21950021
K3       EQU   3                        CONSTANT OF 3           SA56400 21960002
K4       EQU   4                        CONSTANT OF 4            Y02080 21970002
K0       EQU   0                        CONSTANT OF 0            Y02082 21972002
K1       EQU   1                        CONSTANT OF 1            Y02082 21974002
K2       EQU   2                        CONSTANT OF 2            Y02082 21976002
K6       EQU   6                        CONSTANT OF 6            Y02082 21978002
K7       EQU   7                        CONSTANT OF 7            Y02082 21980002
K8       EQU   8                        CONSTANT OF 8            Y02082 21982002
K12      EQU   12                       CONSTANT OF 12           Y02082 21984002
FW4      EQU   16                       LENGTH OF 4 FW'S         Y02082 21988002
STATEXTL EQU   8                        STATUS TEXT UNIT LENGTH  Y02082 21990002
UNITEXTL EQU   10                       UNIT TEXT UNIT LENGTH    Y02082 21992002
VOLTEXTL EQU   12                       VOLSER TEXT UNIT LENGTH  Y02082 21994002
RTNCODE4 EQU   4                        ERROR RETURN CODE OF 4   Y02082 21996002
RTNCODE8 EQU   8                        ERROR RETURN CODE OF 8   Y02082 21998002
SIODISP  EQU   4                        DISP: TO SIO APPENDAGE   Y02082 22000002
AVTDISP  EQU   28                       DISP: TO AVT IN DEB      Y02082 22002002
RPSIDLOC EQU   62                       RPS ID DISPLACEMENT      Y02082 22004002
VOLSER   EQU   4                        OFFSET TO VOLSER IN A    Y02082 22006002
*                                       VOLUME LIST ENTRY        Y02082 22008002
STATUS   EQU   11                       OFFSET TO STATUS BYTE    Y02082 22010002
ENTRYL   EQU   12                       VOL LIST ENTRY LENGTH    Y02082 22012002
UCBADDR  EQU   32                       DISP. TO UCB ADDR IN DEB Y02082 22014002
DEVMOD   EQU   X'C0'                    DEB DEVICE MODIFIER      Y02082 22016002
IOERR    EQU   X'04'                    I/O ERROR IN VOL LIST    Y02082 22018002
NODEVERR EQU   X'05'                    NO DEVICE ERROR          Y02082 22020002
NOMNTERR EQU   X'06'                    VOLUME NOT MOUNTED ERROR Y02082 22022002
STATOLD  EQU   X'01'                    DISP=OLD INDICATOR       Y02082 22024002
DYNUNALL EQU   X'80'                    DO NOT ISSUE SVC 99 BIT  YM1063 22026002
*                                                                       22200013
*** BUILD CONTROL BLOCKS                                                22400013
*                                                                       22600013
BLDBLKS  EQU   *                                                  25512 22680018
         TM    SISW2,DEMNTSW+MOUNTSW+VERIFYSW  TEST IF RETURN    Y02134 22690002
*                                       FROM DEMOUNT, MOUNT,     Y02134 22700002
*                                       AND/OR VERIFY FUNCTION   Y02134 22710002
         BNZ   RETURNPT                 BRANCH IF YES            Y02134 22720002
         XC    HOLENUM,HOLENUM          INITIALIZE HOLE COUNT FOR 25512 22760018
*                                       OTHER THAN 1ST VOLUME           22840018
         LA    R1,WKADEB                BUILD THE WORK AREA DEB  Y02082 22920002
         MVI   16(R1),X'01'                  NUM OF EXTS = 1            23400013
         LA    R2,DCB                                                   23600013
         ST    R2,24(R1)                     INSERT DCB ADDR            23800013
         MVI   24(R1),X'0F'                  INSERT DEB ID              24000013
         MVI   28(R1),X'04'                  INSERT EXT SCALE           24400013
         MVC   42(6,R1),EXTCONST             INSERT EXTS AND TK COUNT   25000013
         ST    R1,DEBPTR                BUILD DCB                       25200013
         LA    WORKREG,ECB              BUILD IOB                       25400013
         ST    WORKREG,IOB+4                 INSERT ECB ADDR            25600013
         LA    RETURN,CCW1              GET CCW POINTER FOR IOB.        25800013
         LA    WORKREG,DCB                                              26000013
         STM   RETURN,WORKREG,IOB+16    STORE DCB AND CCW PTR INTO IOB. 26200013
         OI    IOB,X'02'               SET UNRELATED BIT IN IOB  A29244 26300019
NEXTVOL  EQU   *                        NEXT VOLUME              Y02134 26350002
         LH    VOLCTR,VOLNUM            LOAD NUMBER OF VOLUMES LEFT     26400013
         L     VOLISTX,VOLPTR           LOAD VOLUME LIST INDEX          26600013
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 26605002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 26610002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 26615002
         MVI   11(VOLISTX),X'00'        CLEAR THIS VOL'S RET     A27090 26620019
*                                       CODE                     A27090 26640019
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 26645002
         DROP  R1                                                Y02078 26650002
         MVC   PVOLSER,VOLSER(VOLISTX)  SAVE VOLSER IN WRK AREA  YM1337 26655002
         OC    PVOLSER,PVOLSER          TEST FOR VALID VOLSER    YM1337 26660002
         BZ    NODEVICE                 NO UNIT IF ZERO          Y02082 26670002
*                                                                       26673002
* THE FOLLOWING SECTIONS TRY TO FIND THE UCB ADDRESS OF THE CURRENT     26676002
* VOLUME IN THE VOLUME LIST. FIRST, IT SEARCHES THE TIOT TO SEE IF      26679002
* THE VOLUME IS MOUNTED ON A UNIT ALLOCATED TO THE JOB. IF NOT, IT      26682002
* SEARCHES THE UCB LOOKUP TABLE TO DETERMINE IF THE VOLUME IS MOUNTED   26685002
* ANYWHERE. IF IT IS MOUNTED, DYNAMIC ALLOCATION IS CALLED TO TRY TO    26688002
* ALLOCATE THE UNIT. IF THE VOLUME IS NOT MOUNTED ANYWHERE OR IF IT     26691002
* CANNOT BE DYNAMICALLY ALLOCATED, THE VOLUME WILL BE MOUNTED ON THE    26694002
* PRIMARY UCB, IF ONE EXITS.                                            26697002
*                                                                       26700002
FINDUCB  EQU   *                        FIND UCB                 Y02082 26703002
         L     RDSAB,DSABQDB            LOAD DSAB QDB ADDRESS    Y02082 26706002
         USING QDB,RDSAB                QDB ADDRESSABILITY       Y02082 26709002
         L     RDSAB,QDBFELMP           GET FIRST DSAB ADDRESS   Y02082 26712002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02082 26715002
DSABTEST EQU   *                        IS THERE ANOTHER DSAB    Y02082 26718002
         LTR   RDSAB,RDSAB              IS THERE ANOTHER DSAB    Y02082 26721002
         BZ    TABLSRCH                 BRANCH IF NOT            Y02082 26724002
         L     RTIOT,DSABTIOT           GET TIOT POINTER         Y02082 26727002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02082 26730002
         SR    REND,REND                ZERO REGISTER FOR IC     Y02082 26733002
         IC    REND,TIOELNGH            LENGTH OF TIOT ENTRY     Y02082 26736002
         AR    REND,RTIOT               ADDRESS OF FIRST BYTE    Y02082 26739002
*                                       PAST THE TIOT ENTRY      Y02082 26742002
         LA    RTIOT,TIOEFSRT-K1        ADDR OF FIRST UCB ADDR   Y02082 26745002
UCBTEST  EQU   *                        TEST IF AT END           Y02082 26748002
         CR    RTIOT,REND               TEST IF AT END OF ENTRY  Y02082 26751002
         BNL   NEXTDSAB                 BRANCH IF YES            Y02082 26754002
         L     RUCB,K0(,RTIOT)          GET UCB ADDRESS          Y02082 26757002
         LA    RUCB,K0(RUCB)            CLEAR HIGH BYTE          Y02082 26760002
         LTR   RUCB,RUCB                IS THERE A UCB ADDRESS   Y02082 26763002
         BZ    NXTENTRY                 BRANCH IF NOT            YM1063 26766002
         CLC   SRTEVOLI,PVOLSER         COMPARE VOL SER NUMBERS  YM1337 26769002
         BNE   NXTENTRY                 BRANCH IF NOT EQUAL      Y02082 26772002
         CLC   UCBTBYT3(K2),K2(VOLISTX)  COMPARE DEVICE TYPES    Y02082 26775002
         BNE   NXTENTRY                 BRANCH IF NOT EQUAL      Y02082 26778002
         TM    UCBTBYT3,UCB3DACC        TEST IF DIRECT ACCESS    Y02082 26781002
         BZ    NXTENTRY                 BRANCH IF NOT            Y02082 26784002
         TM    SRTESTAT,SRTEONLI        TEST IF ONLINE           Y02082 26787002
         BO    FOUNDUCB                 BRANCH IF ONLINE         Y02082 26790002
NXTENTRY EQU   *                        NEXT UCB ADDRESS IN TIOT Y02082 26793002
         LA    RTIOT,L'TIOESTTB+L'TIOEFSRT(,RTIOT)  INCREMENT TO Y02082 26796002
*                                       NEXT UCB ADDRESS IN TIOT Y02082 26799002
         B     UCBTEST                  GO TEST NEXT UCB ADDRESS Y02082 26802002
NEXTDSAB EQU   *                        NEXT DSAB                Y02082 26805002
         L     RDSAB,DSABFCHN           GET NEXT DSAB ADDRESS    Y02082 26808002
         B     DSABTEST                 GO TEST IT               Y02082 26811002
FOUNDUCB EQU   *                        FOUND IT                 Y02082 26814002
         ST    RDSAB,DSABADDR           SAVE DSAB ADDRESS        Y02082 26817002
         ST    RUCB,WKADEB+UCBADDR      SAVE UCB ADDRESS IN DEB  Y02082 26820002
         MVI   WKADEB+UCBADDR,DEVMOD    INSERT DEVICE MODIFIER   Y02082 26823002
         L     RETURN,DSABTIOT          LOAD TIOT ENTRY ADDRESS  YM7036 26823402
         LA    RETURN,TIOEJFCB-TIOENTRY(,RETURN)  POINT TO JFCB  YM7036X26823502
                                        PREFIX ADDRESS           YM7036 26824002
         IECRES LOCJFCB,(RETURN)        LOCATE THE JFCB          YM7036 26824502
         CLC   PDSNAME,JFCBDSNM-INFMJFCB(RETURN)  CHECK IF       YM7036X26825002
                                        THIS IS THE RIGHT TIOT   YM7036X26825502
                                        ENTRY FOR THIS DSNAME    YM7036 26826002
         BE    MOUNTED                  BRANCH IF CORRECT        YM7036 26826502
         OI    SISW2,UCBFNDSW           SET THE UCB FOUND SWITCH YM7036 26827002
         B     NXTENTRY                 GO TRY NEXT TIOT ENTRY   YM7036 26827502
*                                                                Y02082 26829002
* THIS SECTION SEARCHES THE UCB LOOKUP TABLE TO DETERMINE IF THE Y02082 26832002
* VOLUME IS MOUNTED ANYWHERE.                                    Y02082 26838002
*                                                                Y02082 26841002
TABLSRCH EQU   *                        UCB TABLE SEARCH         Y02082 26844002
         TM    SISW2,UCBFNDSW           TEST IF A UCB WAS FOUND  YM7036 26845002
         BNO   LDLOOKUP                 BRANCH IF NOT            YM7515 26845402
         L     RUCB,WKADEB+UCBADDR      LOAD FOUND UCB ADDRESS   YM7515 26845802
         LA    RUCB,K0(RUCB)            CLEAR HIGH BYTE          YM7515 26846202
         B     MOUNTED                  GO TEST IF VERIFIED      YM7515 26846602
LDLOOKUP EQU   *                        LOAD UCB LOOKUP TABL ADR YM7515 26846802
         L     R2,CVTILK2               UCB LOOKUP TABLE ADDRESS Y02082 26847002
UCBLOOP  EQU   *                                                 S19028 26870019
         SR    RUCB,RUCB                CLEAR REG              @ZA01347 26880003
         ICM   RUCB,K3,K0(R2)           GET UCB ADDR           @ZA01347 26890003
         CLM   RUCB,K3,EXTCONST         IS THIS THE END OF     @ZA05225 26930003
*                                       TABLE.                 @ZA05225 26960003
         BE    ENDADDR                                           S19028 26990019
         LTR   RUCB,RUCB                UCB TABLE MAY HAVE HOLES S19028 27020019
         BZ    NEXTADDR                                          S19028 27050019
         TM    UCBTBYT3,UCB3DACC        TEST FOR DIRECT ACCESS   S19028 27080019
         BZ    NEXTADDR                                          S19028 27110019
         TM    SRTESTAT,SRTEONLI        TEST FOR ONLINE DEVICE   A28896 27120019
         BZ    NEXTADDR                 BRANCH IF NOT ONLINE     A28896 27130019
         CLC   SRTEVOLI,PVOLSER         COMPARE VOL SER NUMBERS  YM1337 27530002
         BNE   NEXTADDR                 BRANCH IF NOT EQUAL      Y02082 27540002
         CLC   UCBTBYT3(K2),K2(VOLISTX)  COMPARE DEVICE TYPES    Y02082 27550002
         BNE   NEXTADDR                 BRANCH IF NOT EQUAL      YM1063 27555002
         TM    UCBSTAB,UCBBSVL          TEST IF NONSHAREABLE     YM7377 27560002
         BZ    ALLOCVOL                 BRANCH IF SHAREABLE TO   YM7377X27565002
                                        TRY TO ALLOCATE THE UNIT YM1063 27570002
         B     ENDADDR                  DON'T TRY TO DYNAMICALLY YM1063 27575002
*                                       ALLOCATE IF NONSHAREABLE YM1063 27580002
NEXTADDR LA    R2,2(R2)            TRY NEXT ADDR IN UCB TABLE    S19028 27590019
         B     UCBLOOP                                           S19028 27620019
*                                                                       27700002
ENDADDR  L     RUCB,PRUCBPTR            LOAD UCB POINTER         S19028 27710019
         LTR   RUCB,RUCB                TEST FOR PRIMARY UCB     S19028 27740019
         BZ    NODEVICE                 BRANCH IF NO PRIMARY UCB Y02082 27770002
         CLC   UCBTBYT3(K2),K2(VOLISTX)  COMPARE DEVICE TYPES    Y02082 27800002
         BNE   NODEVICE                 BRANCH IF NOT EQUAL      Y02082 27830002
*                                                                Y02082 27860002
* THIS SECTION PREPARES TO BRANCH TO IGG0290F TO DEMOUNT (IF REQUIRED)  27890002
* AND MOUNT AND/OR VERIFY THE NEXT VOLUME.                              27920002
*                                                                       27950002
MOUNTVOL EQU   *                        MOUNT VOLUME             Y02134 27980002
         ST    RUCB,WKADEB+UCBADDR      MODIFY UCB ADDR IN DEB   Y02134 28010002
         MVI   WKADEB+UCBADDR,DEVMOD    INSERT DEVICE MODIFIER   Y02134 28040002
         OI    SISW2,DEMNTSW+MOUNTSW    SET DEMOUNT & MOUNT SW   Y02134 28070002
         MVC   DSABADDR,PRDSABAD        INITIALIZE DSAB ADDRESS  Y02134 28100002
VERIFY   EQU   *                        SET ADDRESSES            Y02134 28130002
         LA    R2,WKADEB                DEB ADDR IN REGISTER 2   Y02134 28190002
         LA    R3,PVOLSER               VOLSER ADDR IN REG 3     YM1337 28220002
         L     R4,RETNAME               RETURN NAME IN REG 4     Y02134 28280002
         LA    R7,MNTLOAD               POINT TO ID OF IGG0290F  Y02134 28310002
         B     LOADEXIT                 GO BRANCH TO IGG0290F    Y02134 28340002
*                                                                Y02134 28370002
* THIS SECTION TESTS THE RETURN CODE FROM THE DEMOUNT/MOUNT ROUTINE.    28400002
*                                                                       28430002
RETURNPT EQU   *                        TEST RETURN CODE         Y02134 28460002
         NI    SISW2,X'FF'-DEMNTSW-MOUNTSW-VERIFYSW  RESET SW    Y02134 28490002
         B     TESTERR(RETURN)          RETURN CODE BRANCH TABLE Y02134 28520002
TESTERR  EQU   *                        VOLUME MOUNTED/VERIFIED  Y02134 28550002
         B     MOUNTED                  VOLUME MOUNTED/VERIFIED  Y02134 28580002
         B     NODEVICE                 UNSUCCESSFUL DEMOUNT     Y02134 28610002
         B     NOMOUNT                  MOUNT/VERIFY FAILED      Y02134 28640002
         B     PERMERR                  I/O ERROR OCCURRED       Y02134 28670002
*                                                                       28700002
* THIS SECTION INITIALIZES FOR RPS PROCESSING IF THE DEVICE HAS THE     28730002
* RPS FEATURE.                                                          28760002
*                                                                       28790002
MOUNTED  EQU   *                        TEST MOUNT BIT           Y02134 28820002
         NI    SISW2,X'FF'-UCBFNDSW     TURN OFF UCB FOUND SWTCH YM7036 28830002
         TM    UCBDMCT,UCBMOUNT         TEST MOUNT BIT           Y02134 28850002
         BNO   VERIFIED                 BRANCH IF VERIFIED       Y02134 28880002
         TM    UCBFL1,UCBNOTRD          IS UNIT NOT-READY       ZA00119 28882002
         BO    NODEVICE                 BRANCH IF NOT-READY     ZA00119 28884002
         OI    SISW2,VERIFYSW           SET VERIFY SWITCH        Y02134 28890002
         B     VERIFY                   GO VERIFY THE VOLUME     Y02134 28900002
VERIFIED EQU   *                        VERIFIED                 Y02134 28910002
         NI    STYPEFLG,X'FF'-NOMNTDEV  RESET THE 'NO DEVICE FOR Y02082 28940002
*                                       MOUNTING' SWITCH AS AT   Y02082 28970002
*                                       LEAST ONE VOL IS MOUNTED Y02082 29000002
         BCT   VOLCTR,MOREVOLS          TEST FOR LAST VOLUME     Y02134 29030002
         OI    STYPEFLG,EXITBIT         SET EXIT BIT IF LAST VOL Y02134 29060002
MOREVOLS EQU   *                        MOER VOLS TO PROCESS     Y02134 29090002
         LA    R1,ENTRYL(VOLISTX)       NEXT VOL LIST ENTRY ADDR Y02134 29120002
         ST    R1,VOLPTR                SAVE NEXT ENTRY ADDRESS  Y02134 29150002
         STH   VOLCTR,VOLNUM            SAVE UPDATED VOL COUNT   Y02134 29180002
         TM    UCBTBYT2,UCB2OPT3        TEST FOR RPS DEVICE      Y02134 29210002
         BZ    LOADTTR0                 BRANCH IF NOT            Y02134 29240002
         TM    DSMADTB1,DSMRPSAP        TEST IF IGG019EK LOADED  YM5371 29300002
         BO    LOADTTR0                 BRANCH IF YES            YM5371 29360002
         LA    R3,WKADEB                POINTER TO DEB           Y02134 29390002
         IECRPS RDEB=R3,WKREG1=R4,EXTPR=RWKAREA  INITIALIZE      YM3997X29420002
                                        FOR RPS PROCESSING       YM3997 29450002
         MVC   WTGMODNM,THISLOAD        RESTORE MODULE NAME      YM5371 29490002
*                                                                       29500002
* THIS SECTION INITIALIZES THE CCHHR'S OF THE FORMAT 4 AND 5 DSCB'S.    29510002
*                                                                       29540002
LOADTTR0 EQU   *                        INITIALIZE THE CCHHR'S   Y02134 29570002
         L     R0,SRTEFSCT              LOAD TTR0 OF F4 FROM UCB Y02134 29600002
         LA    R1,WKADEB                POINTER TO DEB           Y02134 29630002
         LA    R2,SEEK                  MBBCCHHR ADDRESS         Y02134 29660002
         LR    R3,RWKAREA               SAVE WORK AREA ADDRESS   Y02134 29690002
         STM   RCVT,RETURN,IECREGSV+K12 SAVE REGISTERS 9-14      Y02134 29720002
         L     WORKREG,CVTPCNVT         ADDRESS OF CONVERT RTN   Y02134 29750002
         BALR  RETURN,WORKREG           LINK TO CONVERT ROUTINE  Y02134 29780002
         LM    RCVT,RETURN,IECREGSV+K12-SCRTHWKA(R3)  RESTORE    Y02134 29810002
         MVC   VTOCADR,SEEK+K3          SET UP FORMAT 4 CCHHR    Y02134 29840002
         MVC   INCCHHR,VTOCADR          SET UP SEARCH ID CCHHR   Y02134 29870002
         MVC   DADSMADR,VTOCADR         SET UP FORMAT 5 CCHHR    Y02134 29900002
         SR    WORKREG,WORKREG          ZERO REGISTER            Y02134 29930002
         IC    WORKREG,DADSMADR+K4      LOAD F4 RECORD NUMBER    Y02134 29960002
         LA    WORKREG,K1(WORKREG)      INCREMENT BY ONE         Y02134 29990002
         STC   WORKREG,DADSMADR+K4      SAVE F5 RECORD NUMBER    Y02134 30020002
*                                                                       30050002
* THIS SECTION ENQ'S ON THE VTOC WITH THE SET-MUST-COMPLETE OPTION.     30080002
*                                                                       30110002
ISSUENQ  EQU   *                        ENQ ON THE VTOC          Y02134 30140002
         MVC   MJNAME(L'VTOCNAME),VTOCNAME  MAJOR RESOURCE NAME  Y02134 30170002
         MVI   ENQAREA,X'FF'            INDICATE LAST ENQ AREA   Y02134 30230002
         SR    R1,R1                    ZERO REGISTER            Y02134 30260002
         STH   R1,ENQAREA+K2            CLEAR FOR RESERVE MACRO  Y02134 30290002
         RESERVE (MJNAME,PVOLSER,E,6,SYSTEMS),SMC=STEP,          YM3022X30320002
               MF=(E,ENQAREA),UCB=WKADEB+32  ENQ ON SYSVTOC      Y02134 30350002
*                                                                       30360002
         OI    STYPEFLG,VTOCENQ         SET VTOC ENQ'ED SWITCH   Y02134 30370002
         OI    DSMADTB2,DSMVTOCR+DSMSMCE  SET VTOC ENQ'ED SMC    Y02144 30380002
         L     R1,IECRRPRM              RECOVERY RTN LIST ADDR   Y02144 30390002
         USING RRPLIST,R1               PARM LIST ADDRESSABILITY Y02144 30400002
         ST    RUCB,RRUCBPTR            SAVE THE UCB ADDRESS     Y02144 30410002
         DROP  R1                                                Y02144 30420002
*                                                                       30430002
         LA    R7,NEXTLOAD              POINT TO ID OF IGG0290A  Y02134 30440002
*                                                                       30460002
* THIS SECTION BRANCHES TO ANOTHER LOAD OF SCRATCH.                     30470002
*                                                                       30500002
LOADEXIT EQU   *                        EXIT TO NEXT LOAD        Y02134 30530002
         IECRES LOAD,EXTPR=(RWKAREA),MODID=(R7),BRANCH=DIRECT    Y02134 30560002
*                                                                       30590002
* THIS SECTION SETS AN APPROPRIATE ERROR CODE IN THE STATUS BYTE        30620002
* OF THE CURRENT VOLUME LIST ENTRY. IF THE LAST VOLUME HAS BEEN         30650002
* PROCESSED, CONTROL IS PASSED TO THE LAST LOAD OF SCRATCH. IF NOT,     30680002
* THE NEXT VOLUME LIST ENTRY IS PROCESSED.                              30710002
*                                                                       30740002
PERMERR  EQU   *                        I/O ERROR                Y02134 30770002
         LA    R3,IOERR                 I/O ERROR                Y02134 30800002
         B     SETCODE                  BRANCH TO SET ERROR CODE Y02134 30830002
NODEVICE EQU   *                        NO UNIT FOR MOUNTING     Y02134 30860002
         LA    R3,NODEVERR              NO UNIT FOR MOUNTING ERR Y02134 30890002
         B     SETCODE                  BRANCH TO SET ERROR CODE Y02134 30920002
NOMOUNT  EQU   *                        VOLUME NOT MOUNTED       Y02134 30950002
         LA    R3,NOMNTERR              VOLUME NOT MOUNTED ERROR Y02134 30980002
SETCODE  EQU   *                        SET CODE                 Y02134 31010002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 31040002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 31070002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 31100002
         DROP  R1                                                Y02078 31130002
         STC   R3,STATUS(VOLISTX)       PUT ERROR CODE IN VOLIST Y02078 31160002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 31190002
         BCT   VOLCTR,NOTLAST           TEST IF LAST VOLUME      Y02134 31220002
         OI    STYPEFLG,EXITBIT         SET EXIT BIT IF LAST VOL Y02134 31250002
NOTLAST  EQU   *                        NOT LAST VOL             Y02134 31280002
         LA    R1,ENTRYL(VOLISTX)       NEXT VOL LIST ENTRY ADDR Y02134 31310002
         ST    R1,VOLPTR                SAVE NEXT ENTRY ADDR     Y02134 31340002
         STH   VOLCTR,VOLNUM            SAVE UPDATED VOL COUNT   Y02134 31370002
         LA    RTNCODE,RTNCODE8         NORMAL ERROR RETURN CODE Y02134 31400002
         STH   RTNCODE,ERCODE           SAVE ERROR RETURN CODE   Y02134 31430002
         TM    STYPEFLG,EXITBIT         TEST IF LAST VOLUME      Y02134 31460002
         BZ    NEXTVOL                  BRANCH IF NOT TO PROCESS Y02134 31490002
*                                       THE NEXT VOLUME          Y02134 31520002
         TM    STYPEFLG,NOMNTDEV        TEST IF AN ERROR CODE OF Y02134 31550002
*                                       4 MUST BE RETURNED TO    Y02134 31580002
*                                       CALLER IN REGISTER 15    Y02134 31610002
         BZ    LEAVE                    BRANCH IF NOT            Y02134 31640002
         MVI   ERCODE+K1,RTNCODE4       SET RETURN CODE TO 4     Y02134 31670002
LEAVE    EQU   *                        GO TO IGG0290D           Y02134 31700002
         LA    R7,LASTLOAD              POINT TO ID OF IGG0290D  Y02134 31730002
         B     LOADEXIT                 GO BRANCH TO IGG0290D    Y02134 31760002
*                                                                       31770002
* THIS SECTION BUILDS THE REQUEST BLOCK TO INTERFACE WITH DYNAMIC       31780002
* ALLOCATION (SVC 99) TO TRY TO ALLOCATE THE UNIT ON WHICH THE          31790002
* CURRENT VOLUME IN THE VOLUME LIST IS MOUNTED, UNLESS SCRATCH HAS      31800002
* BEEN CALLED BY DYNAMIC UNALLOCATION OR JOB OR STEP TERMINATION        31810002
* (IF THE CALLER IS IN KEY ZERO AND BIT 0 OF THE SECOND OPTION BYTE     31820002
* IN THE FIRST WORD OF THE PARAMETER LIST IS SET).                      31830002
*                                                                       31840002
ALLOCVOL EQU   *                        TRY TO ALLOCATE THE UNIT Y02082 31850002
         TESTAUTH FCTN=1,KEY=YES,BRANCH=YES  TEST IF CALLER IS   YM1063X31860002
                                        AUTHORIZED OR KEY ZERO   YM1063 31870002
*                                                                YM1063 31880002
         LTR   RTNCODE,RTNCODE          TEST IF EITHER TRUE      YM1063 31890002
         BNZ   BUILDRB                  BRANCH IF NOT            YM1063 31900002
         TM    K1(PL),DYNUNALL          TEST IF ENTERED FROM     YM1063X31910002
                                        DYNAMIC UNALLOCATION OR  YM1063X31920002
                                        JOB OR STEP TERMINATION  YM1063 31930002
         BO    ENDADDR                  BRANCH IF YES            YM1063 31940002
*                                                                YM1063 31950002
BUILDRB  EQU   *                        BUILD THE REQUEST BLOCK  YM1063 31960002
         LA    RPARM,VTOCDSCB           PARAMETER LIST BASE      Y02082 31970002
         USING S99RBP,RPARM                                      Y02082 32000002
         LA    RWRK,K4(,RPARM)          INCREMENT BY FOUR        Y02082 32030002
         ST    RWRK,S99RBPTR            SET UP REQUEST BLOCK PTR Y02082 32060002
         OI    S99RBPTR,S99RBPND        TURN ON HIGH ORDER BIT   Y02082 32090002
         LR    RPARM,RWRK               ADDRESS OF REQUEST BLOCK Y02082 32120002
         USING S99RB,RPARM              REQ BLOCK ADDRESSABILITY Y02082 32150002
         XC    S99RB(S99RBEND-S99RB),S99RB  ZERO REQ BLOCK CORE  Y02082 32180002
         MVI   S99RBLN,S99RBEND-S99RB   LENGTH OF REQUEST BLOCK  Y02082 32210002
         MVI   S99VERB,S99VRBAL         INDICATE ALLOCATION      Y02082 32240002
         LA    RWRK,S99RBEND            ADDR OF TEXT POINTERS    Y02082 32270002
         ST    RWRK,S99TXTPP            PLACE IN REQUEST BLOCK   Y02082 32300002
         OI    S99FLG11,S99NOMNT        INDICATE THAT VOL MUST   Y02082 32330002
*                                       BE MOUNTED IF ALLOCATED  Y02082 32360002
         OI    S99FLG21,S99TIONQ+S99NORES  INDICATE TIOT ENQ'ED  Y02082 32390002
*                                       AND NO D/S RESERVATION   Y02082 32420002
         LR    RPARM,RWRK               ADDRESS OF TEXT POINTERS Y02082 32450002
         USING S99TUPL,RPARM            TEXT PTR ADDRESSABILITY  Y02082 32480002
*                                                                       32510002
* THIS SECTION BUILDS THE VOLSER TEXT UNIT.                             32540002
*                                                                       32570002
         LA    RTEXT,FW4(,RPARM)        BASE FOR TEXT UNIT       Y02082 32600002
         ST    RTEXT,S99TUPTR           PTR TO VOLSER TEXT UNIT  Y02082 32630002
         USING S99TUNIT,RTEXT           TEXT UNIT ADDRESSABILITY Y02082 32660002
         LH    RWRK,VOLSERKY            INDICATE VOLSER TEXT     Y02082 32690002
         STH   RWRK,S99TUKEY                                     Y02082 32720002
         LA    RWRK,K1                  ONE TEXT PARM            Y02082 32750002
         STH   RWRK,S99TUNUM                                     Y02082 32780002
         LA    RWRK,L'SRTEVOLI          LENGTH OF VOLSER         Y02082 32810002
         STH   RWRK,S99TULNG                                     Y02082 32840002
         MVC   S99TUPAR(L'SRTEVOLI),PVOLSER  GET VOLSER          YM1337 32870002
*                                                                       32900002
* THIS SECTION BUILDS THE UNIT TEXT UNIT.                               32930002
*                                                                       32960002
         LA    RTEXT,VOLTEXTL(,RTEXT)   INCREMENT BASE           Y02082 32990002
         ST    RTEXT,S99TUPTR+K4        POINT TO UNIT TEXT UNIT  Y02082 33020002
         LH    RWRK,UNITKEY             INDICATE UNIT SPECIFIED  Y02082 33050002
         STH   RWRK,S99TUKEY                                     Y02082 33080002
         LA    RWRK,K1                  ONE TEXT PARM            Y02082 33110002
         STH   RWRK,S99TUNUM                                     Y02082 33140002
         LA    RWRK,L'UCBNAME           LENGTH OF UCBNAME        Y02082 33170002
         STH   RWRK,S99TULNG                                     Y02082 33200002
         MVC   S99TUPAR(L'UCBNAME),UCBNAME  GET UNIT NUMBER      Y02082 33230002
*                                                                       33260002
* THIS SECTION BUILDS THE STATUS TEXT UNIT.                             33290002
*                                                                       33320002
         LA    RTEXT,UNITEXTL(,RTEXT)   UPDATE TEXT UNIT BASE    Y02082 33350002
         ST    RTEXT,S99TUPTR+K8        PTR TO STATUS TEXT UNIT  Y02082 33380002
         LH    RWRK,STATUSKY                                     Y02082 33410002
         STH   RWRK,S99TUKEY            INDICATE STATUS TEXT     Y02082 33440002
         LA    RWRK,K1                                           Y02082 33470002
         STH   RWRK,S99TUNUM            ONE TEXT PARM            Y02082 33500002
         STH   RWRK,S99TULNG            LENGTH OF TEXT PARM      Y02082 33530002
         MVI   S99TUPAR,STATOLD         INDICATE DISP=OLD        Y02082 33560002
*                                                                       33590002
* THIS SECTION BUILDS THE RETURN DDNAME TEXT UNIT.                      33620002
*                                                                       33650002
         LA    RTEXT,STATEXTL(,RTEXT)   INCREMENT TEXT UNIT BASE Y02082 33680002
         ST    RTEXT,S99TUPTR+K12       PTR TO DDNAME TEXT UNIT  Y02082 33710002
         LH    RWRK,RTNDDKEY            INDICATE RETURN DDNAME   Y02082 33740002
         STH   RWRK,S99TUKEY            SPECIFICATION            Y02082 33770002
         LA    RWRK,K1                  ONE TEXT PARM            Y02082 33800002
         STH   RWRK,S99TUNUM                                     Y02082 33830002
         LA    RWRK,L'TIOEDDNM                                   Y02082 33860002
         STH   RWRK,S99TULNG            LENGTH OF DDNAME         Y02082 33890002
         XC    S99TUPAR(L'TIOEDDNM),S99TUPAR  CLEAR FOR DDNAME   Y02082 33920002
         OI    S99TUPTR+K12,S99TUPLN    INDICATE END OF LIST     Y02082 33950002
         LA    R1,VTOCDSCB              POINT TO REQ BLOCK PTR   Y02082 33980002
         DYNALLOC                       ISSUE DYNAMIC ALLOCATION Y02082 34010002
         LTR   RTNCODE,RTNCODE          TEST IF SUCCESSFUL       Y02082 34040002
         BNZ   ENDADDR                  BRANCH IF NOT            Y02082 34070002
*                                                                       34340002
* THIS SECTION SEARCHES THE DSAB CHAIN TO FIND THE ADDRESS OF THE DSAB  34370002
* WHICH POINTS TO THE TIOT ENTRY CONTAINING THE DYNAMICALLY ALLOCATED   34400002
* DDNAME. RTEXT STILL POINTS TO THE DDNAME TEXT UNIT.                   34430002
*                                                                       34460002
         L     RDSAB,DSABQDB            LOAD DSAB QDB ADDRESS    Y02082 34490002
         USING QDB,RDSAB                QDB ADDRESSABILITY       Y02082 34520002
         L     RDSAB,QDBFELMP           GET FIRST DSAB ADDRESS   Y02082 34550002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02082 34580002
FINDDSAB EQU   *                        IS THERE ANOTHER DSAB    Y02082 34610002
         LTR   RDSAB,RDSAB              IS THERE ANOTHER DSAB    Y02082 34640002
         BZ    ENDADDR                  BRANCH IF NOT            Y02082 34670002
         L     RTIOT,DSABTIOT           GET TIOT POINTER         Y02082 34700002
         USING TIOENTRY,RTIOT           TEST IF CORRECT DSAB     Y02082 34730002
         CLC   TIOEDDNM,S99TUPAR        TEST IF CORRECT DSAB     Y02082 34760002
         BE    FOUNDSAB                 BRANCH IF YES            Y02082 34790002
         L     RDSAB,DSABFCHN           GET NEXT DSAB ADDRESS    Y02082 34820002
         B     FINDDSAB                 CONTINUE SEARCH          Y02082 34850002
FOUNDSAB EQU   *                        FOUND IT                 Y02082 34880002
         OI    SISW1,UCBALLOC           SET UCB ALLOCATED BIT    Y02082 34910002
*                                                                       34940002
         OI    DSMADTB1,DSMUCBAL        SET UCB ALLOCATED BIT    Y02144 34970002
         ST    RDSAB,DSMADTW4           SAVE DSAB ADDRESS        Y02144 35000002
         ST    RDSAB,DSABADDR           SAVE DSAB ADDRESS        YM7036 35010002
         ST    RUCB,WKADEB+UCBADDR      SAVE UCB ADDRESS IN DEB  YM7036 35020002
         MVI   WKADEB+UCBADDR,DEVMOD    INSERT DEVICE MODIFIER   YM7036 35030002
         B     MOUNTED                  CONTINUE WITH SCRATCH    YM7036 35040002
*                                                                       64600013
*** PROGRAM CONSTANTS                                                   64800002
*                                                                       65000002
EXTCONST DC    X'FFFFFFFF7FFF'          LAST CCHH AND NBR OF TRACKS     65400002
         DS    0F                       FULLWORD BOUNDARY        Y02134 65500002
RETNAME  DC    CL4'290E'                RETURN NAME FOR IGG0290F Y02134 65600002
RPSID    DC    CL4'RPSA'                RPS APPENDAGE ID         Y02134 65700002
VTOCNAME DC    CL8'SYSVTOC'             SYSVTOC MAJOR ENQ NAME   Y02134 65900002
VOLSERKY DC    AL2(DALVLSER)            VOLSER TEXT UNIT KEY     Y02082 66000002
UNITKEY  DC    AL2(DALUNIT)             UNIT TEXT UNIT KEY       Y02082 66100002
STATUSKY DC    AL2(DALSTATS)            STATUS TEXT UNIT KEY     Y02082 66200002
RTNDDKEY DC    AL2(DALRTDDN)            RETURN DDNAME KEY        Y02082 66300002
*                                                                       70900021
*** TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                       71000002
*                                                                       71100021
         XCTLTABL ID=(NEXTLOAD,0A,LASTLOAD,0D,MNTLOAD,0F,        YM3997X71200002
               THISLOAD,IGG0290E,                                YM5371X71250002
               RPS19EK,IGG019EK),SVC=029,LENGTH=,BRT=YES         YM3997 71300002
         SPACE 2                                                        71400002
         IECDSECS CVT,DSAB,QDB,RB,RRPL,TCB,TIOT,UCB,EXPAND=YES   Y02144 71500002
WORKAREA IECSCRWA EP,ADT=YES            SCRATCH WORK AREA        Y02144 71600002
         EJECT                                                   Y02082 71700002
*                                                                       71800002
* DSECTS FOR INVOCATING DYNAMIC ALLOCATION (SVC 99)                     71900002
*                                                                       72000002
         IEFZB4D0                       DYNAMIC ALLOCATION DSECT Y02082 72100002
         EJECT                                                   Y02082 72200002
         IEFZB4D2                       DYNAMIC ALLOCATION KEYS  Y02082 72300002
         EJECT                                                   YM7036 72310002
         IEFJFCBN                       JFCB DSECT               YM7036 72320002
         END                                                            87200013
./  ADD  SSI=81460283,NAME=IGG0290F
         TITLE 'IGG0290F - SCRATCH AND RENAME - VOLUME MOUNTING' Y02134 00200002
IGG0290F CSECT                                                          00400019
         ENTRY IGG0300F                                          Y02134 00420002
IGG0300F EQU   IGG0290F                 ALIAS                    Y02134 00440002
*          VS2 SU24  CHANGES/DELETIONS                         @G24LSFS 00460037
*789955                                                        @G24LSFS 00480037
*          VS2 RELEASE 01 DELETIONS                                     00500000
*0000                                                            YM2930 00550000
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00560002
*0000004500,005600-005700,030000,070000-072000,082000-084000,    Y02080 00560102
*0000088000-092000,132000-140000,164000,168000-170000,174000,    Y02080 00560202
*0000198600-199200,222800,228000-230000,252000,272000-298000,    Y02080 00560302
*0000306000,306840,312000,316000,342500-354000,356600-357200,    Y02080 00560402
*0000378000-380000,398000-406000,412000,424000,442000-454000,    Y02080 00560502
*0000464000,468000,537200,537900-557800,558400-670000,676000-    Y02080 00560602
*0000687000,694000-700000,704000                                 Y02080 00560702
*0000000300-002000,026000-706000                                 Y02134 00560802
*0000058000,157000-158000,177000,406000,926000,929000,932000-    YM1238 00561002
*0000933000                                                      YM1238 00561202
*0000724000,914000                                               YM2887 00561302
*0000702000-705000,795000-796000,800000-801000                   Y02146 00561402
*0000798000                                                      YM5390 00561502
*0000955000                                                      YM6554 00561602
*0000226000,596000-624000,803000-804000,826000,831000-832000     YM7307 00562002
*0000                                                            YM7890 00564002
*0000                                                            YM8501 00570002
*          VS2 RELEASE 03 DELETIONS/CHANGES                    @ZM30032 00580003
*0000                                                          @Y301STG 00590003
*0000415450,653200                                             @ZA04505 00592037
*0000387000                                                    @ZA05596 00594037
*                                                                       00595037
*                                                                       00596037
*          VS2 RELEASE 037 CHANGES                                      00596237
*          VS2 RELEASE 03.818 DELETIONS/CHANGES                         00596437
*A544667-544668                                                @ZA20579 00596637
*0000                                                          @G18MSBS 00596837
*                                                                       00597037
*                                                                       00598037
*          RELEASE 20 DELETIONS                                         00600019
*0343308000                                                      S20016 00700020
*0343306980,307750,535200-535500                                 TS1611 00750020
*          RELEASE 21 DELETIONS                                         00800019
*1194034000-066000,102000-144000,168000,178000,236000,538000,    A41439 00860021
*1194558000,686000-688000                                        A41439 00920021
*0000344000                                                     SA52595 00970002
*          RELEASE 21.7 DELETIONS                                       00980002
*0000010000-024000,634000-646000                                SA56400 00990002
*0000052000,426000-428000,438000-440000,446000-450000,500000-   SA53147 00991002
*0000506000,522000-526000,538400-557200                         SA53147 00992002
*                                                                       02400019
*********************************************************************** 02500002
*                                                                       02600002
* MODULE NAME = IGG0290F (ALIAS IGG0300F)                               02700002
*                                                                       02800002
* DESCRIPTIVE MODULE NAME = SCRATCH AND RENAME VOLUME MOUNTING ROUTINE  02900002
*                                                                       03000002
* COPYRIGHT = NONE                                                      03100002
*                                                                       03200002
* STATUS CHANGE LEVEL = 004                                             03300002
*                                                                       03400002
* FUNCTION =                                                            03500002
*                                                                       03600002
*      THIS MODULE HAS THREE FUNCTIONS - DEMOUNTING, MOUNTING, AND      03700002
*      VERIFYING A VOLUME - AS INDICATED BY THE SETTING OF THREE        03800002
*      BITS (DEMNTSW, MOUNTSW, AND VERIFYSW) IN BYTE SISW2 IN THE       03900002
*      SCRATCH OR RENAME WORK AREA.  VALID COMBINATIONS OF THESE        04000002
*      BITS ARE:  DEMOUNTSW ALONE, DEMOUNTSW AND MOUNTSW BOTH SET,      04100002
*      AND VERIFYSW ALONE.                                              04200002
*                                                                       04300002
*      IF DEMOUNTSW IS SET, THIS MODULE FIRST TESTS THAT THE UNIT       04400002
*      IS ELIGIBLE FOR DEMOUNTING.  IF NOT, ERROR CODE X'04' IS         04500002
*      RETURNED TO THE MODULE WHICH PASSED CONTROL TO IGG0290F.         04600002
*                                                                       04700002
*      IF BOTH DEMOUNTSW AND MOUNTSW ARE SET, IT ISSUES AN EXCLUSIVE    04800002
*      ENQ ON SYSZVOLS.  IF THE RETURN CODE INDICATES THAT THE TASK     04900002
*      PREVIOUSLY HAD CONTROL OF THE RESOURCE, THE ENQ IS REISSUED      05000002
*      TO OBTAIN EXCLUSIVE CONTROL.  IF THE RETURN CODE FROM EITHER     05100002
*      ENQ INDICATES THAT THE RESOURCE IS UNAVAILABLE FOR EXCLUSIVE     05200002
*      CONTROL, ERROR CODE X'08' IS RETURNED TO THE MODULE WHICH        05300002
*      PASSED CONTROL TO IGG0290F (BEFORE ATTEMPTING TO DEMOUNT THE     05400002
*      CURRENT VOLUME.)                                                 05500002
*                                                                       05600002
*      IF DEMNTSW IS SET, THIS MODULE THEN ISSUES DEMOUNT MESSAGE       05700002
*      IEC502E FOR THE OPERATOR TO DEMOUNT THE CURRENT VOLUME.          05800002
*      IF THE CURRENT VOLUME IS A VIRTUAL MSS  VOLUME, THE              05810037
*      MESSAGE TO THE OPERATOR IS BYPASSED AND AN ICBMNTDE MACRO        05820037
*      (SVC 126) MESSAGE IS SENT TO THE MSS  SUB SYSTEM INSTEAD.        05830037
*      THE MSS  SUB SYSTEM WILL THEN DEMOUNT THE VIRTUAL PACK.          05840037
*      (SVC 126) MESSAGE IS SENT TO THE MSS  SUB SYSTEM INSTEAD.        05850037
*      THE MSS  SUB SYSTEM WILL THEN DEMOUNT THE VIRTUAL PACK.          05860037
*      IF THE MONITOR SPACE COMMAND IS ACTIVE AND/OR SMF VOLUME         05900002
*      ACCOUNTING INFORMATION IS REQUESTED, IT CALLS LSPACE (SVC 78)    06000002
*      TO ADD SPACE INFORMATION TO THE MESSAGE AND/OR TO WRITE AN       06100002
*      SMF RECORD TYPE 19.  IT ALSO CALLS VOLSTAT (SVC 91) TO WRITE     06200002
*      A VOLUME STATISTICS RECORD TO SYS1.LOGREC.  IF BIT VOLDEQ IS     06300002
*      SET IN BYTE SISW1, IT ALSO DEQ'S THE VOLUME FROM THE SYSZVOLS    06400002
*      RESOURCE.                                                        06500002
*                                                                       06600002
*      IF MOUNTSW IS SET, THIS MODULE THEN SETS BIT UCBMOUNT IN         06700002
*      THE UCB AND ISSUES MOUNT MESSAGE IEC601D.  IF THE CALLER OF      06800002
*      SCRATCH OR RENAME IS A TSO TASK, MESSAGE IEC108I IS ISSUED       06900002
*      TO HIS TERMINAL.  THE OPERATOR CAN REPLY EITHER 'U' (TO USE      07000002
*      THE VOLUME) OR 'M' (TO SKIP MOUNTING THIS VOLUME) TO MESSAGE     07100002
*      IEC601D.  IF THE OPERATOR CHOOSES TO SKIP THE VOLUME, THIS       07200002
*      MODULE RESETS BIT UCBMOUNT AND RETURNS ERROR CODE X'08' TO       07300002
*      THE MODULE WHICH PASSED CONTROL TO IGG0290F.                     07400002
*                                                                       07500002
*      IF THE MOUNTSW IS SET, BUT THE DEVICE IS FOUND TO BE             07510037
*      AN MSS  SUBSYSTEM PACK  THEN THE ACTION IN THE PRECEDING         07520037
*      PARAGRAPH IS BYPASSED.  INSTEAD A REQUEST IS ISSUED TO           07530037
*      JES3(IF THE UCB INDICATES A JES3 MANAGED UNIT) FOR VOLUME        07540037
*      AWARENESS.  THEN AN ICBMNTDE MACRO(SVC126) IS ISSUED TO          07550037
*      THE SYBSYSTEM AND THE VIRTUAL VOLUME REQUESTED WILL BE           07560037
*      MOUNTED BY THE SUBSYSTEM.                                        07570037
*                                                                       07580037
*      IF THE OPERATOR REPLIES 'U' OR IF JUST VERIFYSW IS SET,          07600002
*      SYSEVENT DONTSWAP IS INVOKED TO PREVENT MEMORY SWAPOUT           07650002
*      WHILE WAITING TO READ THE VOLUME LABEL (THIS PREVENTS            07660002
*      WAIT IF THE OPERATOR DECIDES TO CANCEL THE JOB), THIS            07680002
*      MODULE THEN RESETS BIT UCBMOUNT, AND                             07700002
*      VERIFIES THAT THE CORRECT VOLUME HAS BEEN MOUNTED.  IT THEN      07800002
*      CONVERTS THE CCHHR OF THE FORMAT 4 DSCB TO A TTR0 AND STORES     07900002
*      IT AND THE VOLSER IN THE UCB.  IT THEN RETURNS CONTROL TO THE    08000002
*      APPROPRIATE SCRATCH OR RENAME MODULE WITH A RETURN CODE OF 0.    08100002
*                                                                       08200002
* NOTES = (SEE BELOW)                                                   08300002
*                                                                       08400002
*      DEPENDENCIES =                                                   08500002
*                                                                       08600002
*           THE FIRST 364 BYTES OF THE SCRATCH AND RENAME WORK AREAS    08700002
*           (ADDRESSED RESPECTIVELY BY MAPPING MACROS IECSCRWA AND      08800002
*           IECRENWA) ARE MAPPED IDENTICALLY - 8 WORD PREFIX,20 WORD    08900002
*           EXTENDED PREFIX, 4 WORD DADSM WTG TABLE, 96 BYTE DSCB       09000002
*           AREA, AND 140 BYTE DSCB AREA.  THE 294 BYTES FROM LABELS    09100002
*           'WKADEB' THROUGH 'PDSNAME' ARE ALSO MAPPED IDENTICALLY.     09200002
*                                                                       09300002
*      RESTRICTIONS = NONE                                              09400002
*                                                                       09500002
*      REGISTER CONVENTIONS =                                           09600002
*                                                                       09700002
*           REGISTER 2 POINTS TO THE DEB.                               09800002
*           REGISTER 3 POINTS TO THE VOLUME SERIAL NUMBER.              09900002
*           REGISTER 4 CONTAINS THE LAST FOUR CHARACTERS OF THE         10000002
*           RETURN MODULE NAME.                                         10100002
*           REGISTER 5 CONTAINS THE NUMBER OF VOLUMES REMAINING         10200002
*           TO BE SCRATCHED OR RENAMED.                                 10300002
*           REGISTER 8 POINTS TO THE CURRENT ENTRY IN THE VOLUME LIST.  10400002
*           REGISTER 9 POINTS TO THE CVT.                               10500002
*           REGISTER 11 POINTS TO THE UCB.                              10600002
*           REGISTER 12 IS THE BASE REGISTER.                           10700002
*           REGISTER 13 POINTS TO THE EXTENDED PREFIX PORTION OF THE    10800002
*           SCRATCH OR RENAME WORK AREA.                                10900002
*                                                                       11000002
*      PATCH LABEL = IHB0028D                                           11100002
*                                                                       11200002
* MODULE TYPE = CONTROL                                                 11300002
*                                                                       11400002
*      PROCESSOR = ASSEMBLER                                            11500002
*                                                                       11600002
*      MODULE SIZE = LESS THAN 4096 BYTES                               11700002
*                                                                       11800002
*      ATTRIBUTES = REENTRANT, REFRESHABLE, ENABLED, PRIVILEGED         11900002
*                                                                       12000002
* ENTRY POINT =                                                         12100002
*                                                                       12200002
*      IGG0290F - ENTERED FROM A SCRATCH MODULE                         12300002
*      IGG0300F - ENTERED FROM A RENAME MODULE                          12400002
*                                                                       12500002
*      PURPOSE = SEE FUNCTION                                           12600002
*                                                                       12700002
*      LINKAGE =                                                        12800002
*                                                                       12900002
*           THIS MODULE IS BRANCHED TO BY USE OF THE IECRES MACRO       13000002
*           FROM MODULES IGG0290D, IGG0290E, IGG03001, AND IGG03002.    13100002
*                                                                       13200002
* INPUT =                                                               13300002
*                                                                       13400002
*      REGISTER 2 POINTS TO THE DEB IN THE SCRATCH OR RENAME WORK AREA. 13500002
*      REGISTER 3 POINTS TO THE VOLSER OF THE VOLUME TO BE MOUNTED (IF  13600002
*      A VOLUME IS TO BE MOUNTED AND/OR VERIFIED) OR TO THE VOLSER OF   13700002
*      THE VOLUME CURRENTLY MOUNTED (IF A VOLUME IS TO BE DEMOUNTED     13800002
*      AND DEQ'ED ONLY).                                                13900002
*      REGISTER 4 CONTAINS THE LAST FOUR CHARACTERS OF THE RETURN       14000002
*      MODULE NAME.                                                     14100002
*      REGISTER 5 CONTAINS THE NUMBER OF VOLUMES REMAINING TO BE        14200002
*      SCRATCHED OR RENAMED.                                            14300002
*      REGISTER 8 POINTS TO THE CURRENT ENTRY IN THE VOLUME LIST.       14400002
*      REGISTER 9 POINTS TO THE CVT.                                    14500002
*      REGISTER 10 POINTS TO THE SCRATCH OR RENAME PARAMETER LIST.      14600002
*      REGISTER 11 POINTS TO THE UCB.                                   14700002
*      REGISTER 13 POINTS TO THE EXTENDED PREFIX PORTION OF THE         14800002
*      SCRATCH OR RENAME WORK AREA.                                     14900002
*                                                                       15000002
* OUTPUT =                                                              15100002
*                                                                       15200002
*      THE FOLLOWING MESSAGES MAY BE ISSUED:                            15300002
*                                                                       15400002
*      TO DEMOUNT A VOLUME IF THE MONITOR SPACE COMMAND IS ACTIVE -     15500002
*                                                                       15600002
*           IEC502E XX UUU,VOLSER,SPACE=CCCC,TTTT,AAAA/YYYY,ZZZZ        15700002
*           IEC502E JOBNAME,STEPNAME                                    15800002
*                                                                       15900002
*      WHERE XX CAN BE EITHER K (KEEP) OR RK (RETAIN KEEP) FOR A        16000002
*           PRIVATE VOLUME OR EITHER D (DELETE) OR RD (RETAIN DELETE)   16100002
*           FOR A PUBLIC VOLUME.                                        16200002
*           UUU IS THE CHANNEL/UNIT ADDRESS.                            16300002
*           VOLSER IS THE VOLUME SERIAL NUMBER.                         16400002
*           CCCC IS THE TOTAL NUMBER OF FREE CYLINDERS ON THE VOLUME.   16500002
*           TTTT IS THE TOTAL NUMBER OF UNALLOCATED TRACKS IN ADDITION  16600002
*           TO THE FREE CYLINDERS.                                      16700002
*           AAAA IS THE NUMBER OF EXTENTS IN THE FORMAT 5 DSCB(S).      16800002
*           YYYY IS THE NUMBER OF CYLINDERS IN THE LARGEST EXTENT OF    16900002
*           UNALLOCATED SPACE ON THE VOLUME.                            17000002
*           ZZZZ IS THE NUMBER OF TRACKS IN ADDITION TO THE CYLINDERS   17100002
*           IN THE LARGEST EXTENT OF UNALLOCATED SPACE.                 17200002
*                                                                       17300002
*      TO DEMOUNT A VOLUME IF THE MONITOR SPACE COMMAND IS NOT ACTIVE   17400002
*      OR TO REJECT A VOLUME -                                          17500002
*                                                                       17600002
*           IEC502E XX UUU,VOLSER,JOBNAME,STEPNAME                      17700002
*                                                                       17800002
*      WHERE XX CAN BE K, RK, D, RD, OR R (REJECT).                     17900002
*                                                                       18000002
*      TO MOUNT A VOLUME -                                              18100002
*                                                                       18200002
*           IEC601D M UUU,VOLSER,JOBNAME,STEPNAME - REPLY U OR M.       18300002
*                                                                       18400002
*      THE OPERATOR CAN REPLY EITHER U (TO MOUNT AND USE THE VOLUME)    18500002
*      OR M (TO SKIP MOUNTING THIS VOLUME).                             18600002
*                                                                       18700002
*      TO TELL A TERMINAL THAT A VOLUME MUST BE MOUNTED -               18800002
*                                                                       18900002
*           IEC108I OPERATOR ACTION HAS BEEN REQUESTED FOR YOUR         19000002
*           DATA SET.                                                   19100002
*                                                                       19200002
* NOTE: NO MOUNT OR DEMOUNT MESSAGES ARE ISSUED TO THE OPERATOR         19210037
*      IF THE MOUNT OR DEMOUNT IS FOR AN MSS  SUBSYSTEM VIRTUAL         19218037
*      DEVICE.  IN THIS CASE, MESSAGES TO A TSO TEMINAL WILL            19226037
*      ALSO BE BYPASSED.                                                19234037
*                                                                       19242037
*        -IF AN ERROR REASON CODE IS RETURNED FROM THE MSS              19250037
*         (DIS) MOUNT THE REASON CODE IS PRINTED IN MSG                 19258037
*         IEC666I JJJJJJJJ,VOLSER,DDD MSS FAILURE IN (DIS)-             19266037
*         MOUNT. CODE=HHH -WHERE HHH EQUALS THE REASON CODE             19274037
*                                                                       19282037
*                                                                       19300002
*      THE FOLLOWING REGISTERS ARE RETURNED TO THE CALLING MODULE -     19400002
*                                                                       19500002
*      REGISTER 5 CONTAINS THE NUMBER OF VOLUMES REMAINING TO BE        19600002
*      SCRATCHED OR RENAMED.                                            19700002
*      REGISTER 8 POINTS TO THE CURRENT ENTRY IN THE VOLUME LIST.       19800002
*      REGISTER 9 POINTS TO THE CVT.                                    19900002
*      REGISTER 10 POINTS TO THE SCRATCH OR RENAME PARAMETER LIST.      20000002
*      REGISTER 11 POINTS TO THE UCB.                                   20100002
*      REGISTER 13 POINTS TO THE EXTENDED PREFIX PORTION OF THE         20200002
*      SCRATCH OR RENAME WORK AREA.                                     20300002
*      REGISTER 14 CONTAINS ONE OF THE FOLLOWING RETURN CODES:          20400002
*      00 - VOLUME SUCCESSFULLY DEMOUNTED, MOUNTED, AND/OR VERIFIED     20500002
*      04 - VOLUME COULD NOT BE DEMOUNTED                               20600002
*      08 - VOLUME COULD NOT BE MOUNTED                                 20700002
*      0C - I/O ERROR OCCURRED WHEN READING THE VOLUME LABEL            20800002
*                                                                       20900002
* EXITS - NORMAL = BRANCH VIA IFG019RA (THE OPEN/CLOSE/EOV/DADSM        21000002
*      RESIDENT ROUTINE) WITH A RETURN CODE OF ZERO TO THE MODULE       21100002
*      THAT PASSED CONTROL TO IGG0190F.                                 21200002
*                                                                       21300002
* EXITS - ERROR = BRANCH VIA IFG019RA WITH AN ERROR RETURN CODE (AS     21400002
*      DESCRIBED UNDER 'OUTPUT') TO THE MODULE THAT PASSED CONTROL TO   21500002
*      IGG0290F.                                                        21600002
*                                                                       21700002
* EXTERNAL REFERENCES = (SEE BELOW)                                     21800002
*                                                                       21900002
*      ROUTINES = EXCP    - EXECUTES A CHANNEL PROGRAM (SVC 0)          22000002
*                 WAIT    - WAITS ON AN EVENT CONTROL BLCOK (SVC 1)     22100002
*                 DEQ     - DEQ'S FROM SYSZVOLS (SVC 48)                22200002
*                 ENQ     - ENQ'S ON SYSZVOLS (SVC 56)                  22300002
*                 WTO     - WRITES A MESSAGE TO THE OPERATOR (SVC 35)   22400002
*                 WTOR    - WRITES A MESSAGE WITH REPLY (SVC 35)        22500002
*                 LSPACE  - BUILDS AN SMF RECORD 19 AND/OR ADDS SPACE   22700002
*                           INFORMATION TO A DEMOUNT MESSAGE (SVC 78)   22800002
*                 VOLSTAT - WRITES A VOLUME STATISTICS RECORD TO        22900002
*                           SYS1.LOGREC (SVC 91)                        23000002
*                 TPUT    - ISSUES A MESSAGE TO A TERMINAL (SVC 93)     23100002
*                 IECRES  - LOADS/BRANCHES TO ANOTHER MODULE            23200002
*                 IOSGEN  - SETS THE NOT READY BIT IN THE UCB           23300002
*                 IEFSSREQ- ISSUES A REQUEST TO JES3 FOR VOLUME         23310037
*                           AWARENESS FOR VIRTUAL VOLUMES.              23316037
*                 ICBMNTDE- TO MOUNT OR DEMOUNT A VIRTUAL VOLUME.       23322037
*                           AWARENESS FOR VIRTUAL VOLUMES.              23328037
*                 ICBMNTDE- TO MOUNT OR DEMOUNT A VIRTUAL VOLUME.       23334037
*                 SYSEVENT- PREVENTS/ENABLES MEMORY SWAPOUT             23350002
*                                                                       23400002
*      DATA AREAS = SCRATCH OR RENAME VOLUME LIST                       23500002
*                                                                       23600002
*      CONTROL BLOCKS = ASCB                                            23700002
*                       BASE                                            23800002
*                       CVT                                             23900002
*                       DSAB                                            24000002
*                       JSCB                                            24100002
*                       PSA                                             24200002
*                       PSCB                                            24300002
*                       SMCA                                            24400002
*                       TCB                                             24500002
*                       TIOT                                            24600002
*                       UPT                                             24700002
*                       UCB                                             24800002
*                       JCT                                             24810037
*                       JESCT                                           24820037
*                       SCT                                             24830037
*                       JCT                                             24840037
*                       JESCT                                           24850037
*                       SCT                                             24860037
*                                                                       24900002
* TABLES = SCRATCH OR RENAME WORK AREA                                  25000002
*                                                                       25100002
* MACROS = IECDSECS - EXPANDS THE ASCB, BASE, CVT, DSAB, JSCB, PSA,     25200002
*                     PSCB, SMF, TCB, TIOT, UPT, AND UCB DSECTS         25300002
*          IECDIOCM - EXPANDS THE IOS COMMUNICATIONS AREA               25400002
*          IECRENWA - EXPANDS THE RENAME WORK AREA                      25500002
*          IECPDSCT - EXPANDS PROBLEM DETERMINATION MSG DSECT           25500537
*          IECRES   - LOADS AND BRANCHES TO THE CALLING MODULE          25520537
*          IEFAJCTB - EXPANDS THE JOB CONTROL TABLE                     25540537
*          IEFASCTB - EXPANDS THE STEP CONTROL TABLE                    25560537
*          IEFJESCT - EXPANDS THE JES CONTROL TABLE                     25580537
*          IEFJESCT - EXPANDS THE JES CONTROL TABLE                     25600537
*          XCTLTABL - BUILDS A LIST OF MODULE NAMES AND ADDRESSES       25700002
*                                                                       25800002
* CHANGE ACTIVITY =                                                     25900002
*                                                                       25950002
*      SEE THE 'CHANGES/DELETIONS' SECTION FOLLOWING THE CSECT.         26000002
*                                                                       26100002
*********************************************************************** 26200002
         EJECT                                                   Y02134 26300002
*********************************************************************** 26400002
*                                                                       26500002
* REGISTER EQUATES -                                                    26600002
*                                                                       26700002
R0       EQU   0                        EQUATE FOR REGISTER 0    Y02134 26800002
R1       EQU   1                        EQUATE FOR REGISTER 1    Y02134 26900002
R2       EQU   2                        EQUATE FOR REGISTER 2    Y02134 27000002
RDEB     EQU   2                        POINTER TO WKADEB        Y02134 27100002
R3       EQU   3                        EQUATE FOR REGISTER 3    Y02134 27200002
RVOLSER  EQU   3                        POINTER TO VOL SER       Y02134 27300002
R4       EQU   4                        EQUATE FOR REGISTER 4    Y02134 27400002
RNAME    EQU   4                        CONTAINS RETURN MOD NAME Y02134 27500002
VOLCTR   EQU   5                        NUMBER OF REMAINING VOLS Y02134 27600002
R6       EQU   6                        EQUATE FOR REGISTER 6    Y02134 27700002
RDSAB    EQU   6                        POINTER TO THE DSAB      Y02134 27800002
RTCB     EQU   6                        POINTER TO THE TCB       Y02134 27900002
R7       EQU   7                        EQUATE FOR REGISTER 7    Y02134 28000002
RTIOT    EQU   7                        POINTER TO THE TIOT      Y02134 28100002
VOLISTX  EQU   8                        CURRENT VOLIST ENTRY PTR Y02134 28200002
R9       EQU   9                        EQUATE FOR REGISTER 9    Y02134 28300002
RCVT     EQU   9                        POINTER TO THE CVT       Y02134 28400002
RCODE    EQU   10                       RETURN CODE REGISTER     Y02134 28500002
PL       EQU   10                       PARAMETER LIST POINTER   Y02134 28600002
RSAVE    EQU   10                       POINTER TO SAVED REGS  @G18MSBS 28650037
RUCB     EQU   11                       UCB POINTER              Y02134 28700002
RBASE    EQU   12                       BASE REGISTER            Y02134 28800002
RWKAREA  EQU   13                       WORK AREA ADDRESS        Y02134 28900002
RETURN   EQU   14                       RETURN CODE REGISTER     Y02134 29000002
R14      EQU   14                       EQUATE FOR REGISTER 14   Y02134 29100002
RET      EQU   14                       EQUATE FOR REGISTER 14 @G18MSBS 29200037
R15      EQU   15                       EQUATE FOR REGISTER 15   Y02134 29220037
RF       EQU   15                       EQUATE FOR REGISTER 15 @G18MSBS 29240037
         SPACE 1                                                 Y02134 29300002
*                                                                       29400002
* OTHER EQUATES -                                                       29500002
*                                                                       29600002
K0       EQU   0                        CONSTANT OF ZERO         Y02134 29700002
K1       EQU   1                        CONSTANT OF 1            Y02134 29800002
K2       EQU   2                        CONSTANT OF 2            Y02134 29900002
K3       EQU   3                        CONSTANT OF 3            Y02134 30000002
K4       EQU   4                        CONSTANT OF 4            Y02134 30100002
K5       EQU   5                        CONSTANT OF 5            Y02134 30200002
K6       EQU   6                        CONSTANT OF 6            Y02134 30300002
K7       EQU   7                        CONSTANT OF 7            Y02134 30400002
K8       EQU   8                        CONSTANT OF 8            Y02134 30500002
K9       EQU   9                        CONSTANT OF 9            Y02134 30600002
K12      EQU   12                       CONSTANT OF 12           Y02134 30700002
K24      EQU   24                       CONSTANT OF 24           YM7890 30750002
RTNCODE4 EQU   4                        RETURN CODE OF 4         Y02134 30800002
RTNCODE8 EQU   8                        RETURN CODE OF 8         Y02134 30900002
RTNCODEC EQU   12                       RETURN CODE OF 12        Y02134 31000002
LSPACE   EQU   78                       LSPACE SVC               Y02134 31100002
VOLSTAT  EQU   91                       VOLSTAT SVC              Y02134 31200002
DEMNTUUU EQU   15                       OFFSET TO UUU IN DEMOUNT Y02134 31300002
*                                       MESSAGE                  Y02134 31400002
MOUNTUUU EQU   22                       OFFSET TO UUU IN MOUNT   Y02134 31500002
*                                       MESSAGE                  Y02134 31600002
SPACELN  EQU   29                       LENGTH-1 OF LSPACE INFO  Y02134 31700002
REJECTJN EQU   25                       OFFSET TO JOB NAME IN    Y02134 31800002
*                                       REJECT MESSAGE           Y02134 31900002
DEMNTJN1 EQU   26                       OFFSET TO JOB NAME IN    Y02134 32000002
*                                       ONE LINE DEMOUNT MESSAGE Y02134 32100002
DEMNTJN2 EQU   76                       OFFSET TO JOB NAME IN    Y02134 32200002
*                                       TWO LINE DEMOUNT MESSAGE Y02134 32300002
HIORDER  EQU   X'80'                    HI-ORDER BIT OF A BYTE @G18MSBS 32330037
SWAPREFX EQU   16                       PREFIX OF QUEUE ELEMENT@G18MSBS 32360037
MOUNTJN  EQU   33                       OFFSET TO JOB NAME IN    Y02134 32400002
*                                       MOUNT MESSAGE            Y02134 32500002
SMFFLAG  EQU   X'80'                    SMF FLAG FOR LSPACE      Y02134 32600002
LASTNTRY EQU   X'80'                    LAST ENTRY INDICATOR     Y02134 32700002
GOODIO   EQU   X'20'                    TEST FOR SUCCESSFUL I/O  Y02134 32800002
BLANK    EQU   X'40'                    EBCDIC BLANK             Y02134 32900002
CHARD    EQU   C'D'                     EBCDIC CHARACTER D       Y02134 33000002
CHARK    EQU   C'K'                     EBCDIC CHARACTER K       Y02134 33100002
CHARR    EQU   C'R'                     EBCDIC CHARACTER R       Y02134 33200002
REPLYM   EQU   C'M'                     REPLY OF M TO MOUNT MSG  Y02134 33300002
REPLYU   EQU   C'U'                     REPLY OF U TO MOUNT MSG  Y02134 33400002
*                                                                       33500002
D0       EQU   0                        DISPLACEMENT OF ZERO   @Y30LSTG 33506003
D2       EQU   2                        DISPLACEMENT OF ONE    @Y30LSTG 33507003
D3       EQU   3                        DISPLACEMENT OF THREE  @Y30LSTG 33508003
D4       EQU   4                        DISPLACEMENT OF FOUR   @Y30LSTG 33509003
D6       EQU   6                        DISPLACEMENT OF SIX    @Y30LSTG 33509203
D8       EQU   8                        DISPLACEMENT OF EIGHT  @Y30LSTG 33509403
D11      EQU   11                       DISPLACEMENT OF ELEVEN @Y30LSTG 33509603
D14      EQU   14                       DISPLACEMENT OF FOURTEN@Y30LSTG 33509803
D17      EQU   17                       DISPLA OF SEVENTEEN    @Y30LSTG 33509903
D24      EQU   24                       LENGTH OF TWENTY-FOUR  @Y30LSTG 33511603
D43      EQU   43                       DISP OF FORTY-THREE    @Y30LSTG 33512603
D46      EQU   46                       DISP OF FORTY-SIX      @Y30LSTG 33512803
D58      EQU   58                       DISP OF FIFTY-EIGHT    @Y30LSTG 33513003
D60      EQU   60                       DISP OF SIXTY          @Y30LSTG 33513203
D72      EQU   72                       SEVENTY-TWO            @Y30LSTG 33513803
L2       EQU   2                        LENGTH OF TWO          @Y30LSTG 33514003
L3       EQU   3                        LENGTH OF THREE        @Y30LSTG 33514203
L6       EQU   6                        LENGTH OF SIX          @Y30LSTG 33514303
L8       EQU   8                        LENGTH OF EIGHT        @Y30LSTG 33515703
L18      EQU   18                       LENGTH OF EIGHTEEN     @Y30LSTG 33516703
L19      EQU   19                       LENGTH OF NINETEEN     @Y30LSTG 33516903
L28      EQU   28                       LENGTH OF TWENTY-EIGHT @ZM33363 33517103
TWO40    EQU   240                      VALUE OF 2-HUNDRED 40  @Y30LSTG 33517603
DECZR0   EQU   X'F0'                    DECIMAL ZERO           @Y30LSTG 33517803
*********************************************************************** 33600002
         SPACE 1                                                 Y02134 33700002
         BALR  RBASE,K0                 ESTABLISH ADDRESSABILITY Y02134 33800002
         USING MNT00100,RBASE           CSECT ADDRESSABILITY     Y02134 33900002
         USING RENAMWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02134 34000002
         USING WKADEB,RDEB              IOB & CCW ADDRESSABILITY Y02134 34100002
         USING UCB,RUCB                 UCB ADDRESSABILITY       Y02134 34200002
         USING CVT,RCVT                 CVT ADDRESSABILITY       Y02134 34300002
         EJECT                                                   Y02134 34600002
*                                                                       34700002
* THIS SECTION DETERMINES IF THE UCB IS ELIGIBLE FOR DEMOUNTING.        34800002
*                                                                       34900002
MNT00100 EQU   *                        TEST IF DEMOUNTABLE      Y02134 35000002
         TM    SISW2,VERIFYSW           TEST IF THE VOLUME IS TO Y02134 35100002
*                                       BE MERELY VERIFIED       Y02134 35200002
         BO    MNT04000                 BRANCH IF YES            Y02134 35300002
         TM    UCBDMCT,UCBDMC           CHECK FOR ANY USERS      Y02134 35400002
         BNZ   MNT01550                 BRANCH IF YES - VOLUME   Y02134 35500002
*                                       CANNOT BE DEMOUNTED      Y02134 35600002
         TM    UCBSTAT,UCBSYSR+UCBRESV+UCBPRES  TEST IF SYSRES,  Y02134 35700002
*                                       RESERVED, OR PERMANENT   Y02134 35800002
         BNZ   MNT01550                 BRANCH IF ANY OR ALL -   Y02134 35900002
*                                       VOL CANNOT BE DEMOUNTED  Y02134 36000002
         TM    UCBSTAB,UCBBSVL          TEST IF SHARED VOLUME    Y02134 36100002
         BZ    MNT01550                 BRANCH IF YES - VOLUME   Y02134 36200002
*                                       CANNOT BE DEMOUNTED      Y02134 36300002
         TM    UCBSTAT,UCBONLI          TEST IF ONLINE           Y02134 36400002
         BZ    MNT01550                 BRANCH IF NOT - VOLUME   Y02134 36500002
*                                       CANNOT BE DEMOUNTED      Y02134 36600002
*                                                                       36700002
* IF A VOLUME IS TO BE MOUNTED, THIS SECTION ISSUES AN EXCLUSIVE ENQ    36800002
* DIRECTED TO THE INITIATOR'S TCB WITH A MAJOR RESOURCE NAME OF         36900002
* SYSZVOLS AND THE VOLUME SERIAL NUMBER AS THE MINOR RESOURCE NAME.     37000002
* IF THE RETURN CODE INDICATES THAT THE TASK PREVIOUSLY HAD CONTROL     37100002
* OF THE RESOURCE, THE ENQ IS REISSUED TO OBTAIN EXCLUSIVE CONTROL.     37200002
*                                                                       37300002
MNT00200 EQU   *                        ISSUE ENQ RET=USE        Y02134 37400002
         TM    SISW2,MOUNTSW            SEE IF VOL TO BE MOUNTED Y02134 37500002
         BNO   MNT00400                 BRANCH IF NOT            Y02134 37600002
         MVC   ENQAREA(ENQLTH1),ENQLIST1  MOVE IN PARAMETER LIST Y02134 37700002
         MVC   MJNAME(L'SYSZVOLS),SYSZVOLS  MAJOR RESOURCE NAME  Y02134 37800002
         L     RTCB,TCBADDR             LOAD TCB ADDRESS         Y02134 37900002
         USING TCB,RTCB                 TCB ADDRESSABILITY       Y02134 37950002
         L     RTCB,TCBJSCB             LOAD JSCB ADDRESS        Y02134 38000002
         USING IEZJSCB,RTCB             JSCB ADDRESSABILITY      Y02134 38100002
         L     RTCB,JSCBACT             GET ACTIVE JSCB ADDRESS  YM2887 38101002
         L     RTCB,JSCBTCBP            INITIATOR TCB ADDRESS    Y02134 38200002
         ENQ   (MJNAME,(RVOLSER)),TCB=(RTCB),RET=USE,            Y02134X38300002
               MF=(E,ENQAREA)           ISSUE ENQ ON SYSZVOLS    Y02134 38400002
         LTR   R15,R15                  TEST RETURN CODE         Y02134 38500002
         BNZ   MNT00250                 BRANCH IF ENQ FAILED     Y02134 38600002
         OI    SISW1,VOLENQ             SET SYSZVOLS ENQ SWTCH @ZA05596 38700037
         B     MNT00300                 GO TEST IF MOUNT PENDING Y02134 38800002
*                                                                Y02134 38900002
MNT00250 EQU   *                        ISSUE ENQ RET=CHNG       Y02134 39000002
         CLI   ENQAREA+K3,RTNCODE8      TEST IF TASK ALREADY     Y02134 39100002
*                                       ENQ'ED ON THIS VOL SER   Y02134 39200002
         BNE   MNT01650                 BRANCH IF NOT            Y02134 39300002
         MVC   ENQAREA(ENQLTH2),ENQLIST2  MOVE IN PARAMETER LIST Y02134 39400002
         ENQ   (MJNAME,(RVOLSER)),TCB=(RTCB),RET=CHNG,           Y02134X39500002
               MF=(E,ENQAREA)           REISSUE THE ENQ          Y02134 39600002
         LTR   R15,R15                  TEST RETURN CODE         Y02134 39700002
         BNZ   MNT01650                 BRANCH IF NOT SUCCESSFUL Y02134 39800002
*                                                                Y02134 39900002
MNT00300 EQU   *                        TEST IF MOUNT PENDING    Y02134 40000002
         TM    UCBDMCT,UCBMOUNT         TEST IF MOUNT PENDING    Y02134 40100002
         BO    MNT04000                 BRANCH IF YES TO VERIFY  Y02134 40200002
*                                       THE VOLUME               Y02134 40300002
*                                                                       40400002
* IF A VOLUME IS CURRENTLY MOUNTED, THIS SECTION ISSUES DEMOUNT         40500002
* MESSAGE IEC502E.                                                      40600002
*                                                                       40700002
MNT00400 EQU   *                        TEST FOR NOTHING MOUNTED Y02134 40800002
         CLC   UCBVOLI,ZEROS            TEST FOR NO VOL SER      Y02134 40900002
         BE    MNT01000                 BRANCH, NOTHING MOUNTED  Y02134 41000002
         CLC   UCBVOLI,BLANKS           TEST FOR BLANK VOL SER   Y02134 41100002
         BE    MNT01000                 BRANCH, NOTHING MOUNTED  Y02134 41200002
         BAL   RETURN,MNT11000          LINK TO MOVE IN DEMOUNT  Y02134 41300002
*                                       MESSAGE AND ISSUE SVC 78 Y02134 41400002
*                                       (LSPACE) AND SVC 91      Y02134 41500002
* IF THE VOLUME IS ON A VIRTUAL MSS  SYSTEM, THE DEMOUNT       @Y30LSTG 41505003
* IS INTERCEPTED AND A MSG SENT TO MSS  INSTEAD.               @Y30LSTG 41510003
*                                                              @Y30LSTG 41515003
         TM    UCBTBYT2,UCBRVDEV        IS IT A VIRTUAL DEVICE @Y30LSTG 41520037
         BNO   MNT00420                 NO, DO ORDINARY DEMOUNT@Y30LSTG 41525003
         BAL   RETURN,MNT11230          GO SETUP DEMOUNT MSG   @Y30LSTG 41530003
         BAL   RETURN,MNT11260          GO ASK FOR A DEMOUNT   @Y30LSTG 41550003
         BAL   RETURN,MNT11300          GO CLEAR OUT UCB       @ZA04505 41552037
         B     MNT01000                 SKIP NORMAL MSG        @Y30LSTG 41555003
MNT00420 EQU   *                        BRANCH TO LABEL          Y02134 41600003
         MVC   MSGINDIC(K2),BLANKS      CLEAR XX FIELD           Y02134 41700002
         TM    UCBJBNR,UCBMONT          TEST FOR DISP=PASS       Y02134 41800002
         BNO   MNT00430                 BRANCH IF NOT            Y02134 41900002
         MVI   MSGINDIC,CHARR           MOVE IN PASS INDICATOR   Y02134 42000002
*                                                                Y02134 42100002
MNT00430 EQU   *                        TEST FOR PRIVATE         Y02134 42200002
         TM    UCBSTAB,UCBBPRV          TEST FOR PRIVATE         Y02134 42300002
         BNO   MNT00440                 BRANCH IF NOT            Y02134 42400002
         MVI   MSGINDIC+K1,CHARK        MOVE IN KEEP INDICATOR   Y02134 42500002
         B     MNT00470                 GO COMPLETE THE MESSAGE  Y02134 42600002
*                                                                Y02134 42700002
MNT00440 EQU   *                        TEST FOR PUBLIC          Y02134 42800002
         TM    UCBSTAB,UCBBPUB          TEST FOR PUBLIC          Y02134 42900002
         BNO   MNT00450                 BRANCH IF NOT            Y02134 43000002
         MVI   MSGINDIC+K1,CHARD        MOVE IN DELETE INDICATOR Y02134 43100002
         B     MNT00470                 GO COMPLETE THE MESSAGE  Y02134 43200002
*                                                                Y02134 43300002
MNT00450 EQU   *                        TEST IF DISP SPECIFIED   Y02134 43400002
         CLI   MSGINDIC+K1,BLANK        TEST IF DISP SPECIFIED   Y02134 43500002
         BNE   MNT00470                 BRANCH IF SPECIFIED      Y02134 43600002
         CLI   MSGINDIC,CHARR           CHECK FOR PASS           Y02134 43700002
         BNE   MNT00460                 BRANCH - MUST BE REJECT  Y02134 43800002
         MVI   MSGINDIC+K1,CHARD        SET INDICATOR TO RD      Y02134 43900002
         B     MNT00470                 BRANCH TO FINISH MESSAGE Y02134 44000002
*                                                                Y02134 44100002
MNT00460 EQU   *                        SET INDICATOR TO REJECT  Y02134 44200002
         MVI   MSGINDIC,CHARR           SET INDICATOR TO REJECT  Y02134 44300002
*                                                                Y02134 44400002
MNT00470 EQU   *                        MOVE IN UUU AND VOLSER   Y02134 44500002
         LA    R1,F1DSCB+DEMNTUUU       POINT TO UUU AND VOLSER  Y02134 44600002
         BAL   RETURN,MNT11200          LINK TO GET UUU & VOLSER Y02134 44700002
*                                                                Y02134 44800002
         BAL   RETURN,MNT11300          LINK TO CLEAR UCB        Y02134 44900002
*                                                                Y02134 45000002
         LA    R1,F1DSCB+DEMNTJN1       POINT TO JOB NAME FOR    Y02134 45100002
*                                       ONE LINE DEMOUNT MSG     Y02134 45200002
         CLC   F1DSCB(K4),DMNTMSG2      TEST IF TWO LINE MSG     Y02134 45300002
         BNE   MNT00480                 BRANCH IF NOT            Y02134 45400002
         LA    R1,F1DSCB+DEMNTJN2       POINT TO JOB NAME FOR    Y02134 45500002
*                                       TWO LINE DEMOUNT MSG     Y02134 45600002
*                                                                Y02134 45700002
MNT00480 EQU   *                        MOVE IN JOB & STEP NAMES Y02134 45800002
         BAL   RETURN,MNT11400          LINK TO GET JOB NAME AND Y02134 45900002
*                                       STEP NAME FOR MESSAGE    Y02134 46000002
*                                                                Y02134 46100002
         BAL   RETURN,MNT11500          LINK TO ISSUE WTO        Y02134 46200002
*                                                                Y02134 46300002
*                                                                       46400002
* THIS SECTION LINKS TO A SUBROUTINE THAT ISSUES A DEQ FROM SYSZVOLS    46500002
* IF THE VOLUME BEING DEMOUNTED MUST BE DEQ'ED.                         46600002
*                                                                       46700002
MNT01000 EQU   *                        LINK TO DEQ TEST         Y02134 46800002
         BAL   RETURN,MNT10000          LINK TO TEST IF VOLUME   Y02134 46900002
*                                       MUST BE DEQ'ED           Y02134 47000002
*                                                                       47100002
* IF THE RETURN CODE FROM THE ENQ ON SYSZVOLS INDICATED THAT THE        47200002
* TASK DID NOT PREVIOUSLY HAVE CONTROL OF THE RESOURCE, THIS SECTION    47300002
* INITIALIZES VARIOUS FIELDS FOR A SUBSEQUENT DEQ.                      47400002
*                                                                       47500002
MNT01400 EQU   *                        SEE IF VOL TO BE MOUNTED Y02134 47600002
         TM    SISW2,MOUNTSW            SEE IF VOL TO BE MOUNTED Y02134 47700002
         BNO   MNT01500                 BRANCH IF NOT            Y02134 47800002
         TM    SISW1,VOLENQ             TEST IF VOLUME ENQ'ED    Y02134 47900002
*                                       BY FIRST ENQ             Y02134 48000002
         BNO   MNT03000                 BRANCH IF NOT            Y02134 48100002
         OI    SISW1,VOLDEQ             SET VOL TO BE DEQ'ED SW  Y02134 48200002
         NI    SISW1,X'FF'-VOLENQ       RESET VOL ENQ'ED SWITCH  Y02134 48300002
         MVC   VOLMINOR,K0(RVOLSER)     SAVE VOL SER FOR DEQ     Y02134 48400002
         B     MNT03000                 GO MOUNT THE VOLUME      Y02134 48500002
*                                                                       48600002
* THIS SECTION LOADS THE APPROPRIATE RETURN CODE.  AFTER LINKING TO     48700002
* A SUBROUTINE THAT ISSUES A DEQ FROM SYSZVOLS IF NECESSARY, THIS       48800002
* SECTION RETURNS TO THE CALLING MODULE.                                48900002
*                                                                       49000002
MNT01500 EQU   *                        NO ERROR                 Y02134 49100002
         XR    RCODE,RCODE              RETURN CODE OF ZERO      Y02134 49200002
         B     MNT02000                 GO RETURN                Y02134 49300002
*                                                                Y02134 49400002
MNT01550 EQU   *                        UNABLE TO DEMOUNT VOLUME Y02134 49500002
         LA    RCODE,RTNCODE4           RETURN CODE OF FOUR      Y02134 49600002
         TM    SISW2,MOUNTSW+VERIFYSW   SEE IF VOL TO BE MOUNTED Y02134 49700002
*                                       AND/OR VERIFIED          Y02134 49800002
         BNZ   MNT02000                 YES, GO RETURN           Y02134 49900002
         B     MNT01800                 NO, DEMOUNT ONLY - GO    Y02134 50000002
*                                       TEST IF VOL TO BE DEQ'ED Y02134 50100002
*                                                                Y02134 50200002
MNT01600 EQU   *                        OPERATOR CAN'T MOUNT VOL Y02134 50300002
         BAL   RETURN,MNT10000          TEST IF VOL TO BE DEQ'ED Y02134 50400002
*                                                                Y02134 50500002
MNT01650 EQU   *                        UNABLE TO MOUNT VOLUME   Y02134 50600002
         LA    RCODE,RTNCODE8           RETURN CODE OF EIGHT     Y02134 50700002
         B     MNT02000                 GO RETURN                Y02134 50800002
*                                                                Y02134 50900002
MNT01700 EQU   *                        I/O ERROR                Y02134 51000002
         LA    RCODE,RTNCODEC           RETURN CODE OF TWELVE    Y02134 51100002
         TM    SISW2,VERIFYSW           TEST IF VERIFY ONLY      Y02134 51200002
         BO    MNT02000                 YES, GO RETURN           Y02134 51300002
*                                                                Y02134 51400002
MNT01800 EQU   *                        LINK TO DEQ TEST         Y02134 51500002
         BAL   RETURN,MNT10000          LINK TO DEQ TEST         Y02134 51600002
*                                                                Y02134 51700002
MNT02000 EQU   *                        SET UP RETURN NAME       Y02134 51800002
         LA    R7,SCRATCH1              POINT TO NAME IGG0290D   Y02134 51900002
         CL    RNAME,SCRATCH1+K4        TEST IF RETURN NAME      Y02134 52000002
         BE    MNT02100                 BRANCH IF YES            Y02134 52100002
*                                                                Y02134 52200002
         LA    R7,SCRATCH2              POINT TO NAME IGG0290E   Y02134 52300002
         CL    RNAME,SCRATCH2+K4        TEST IF RETURN NAME      Y02134 52400002
         BE    MNT02100                 BRANCH IF YES            Y02134 52500002
*                                                                Y02134 52600002
         LA    R7,RENAME1               POINT TO NAME IGG03001   Y02134 52700002
         CL    RNAME,RENAME1+K4         TEST IF RETURN NAME      Y02134 52800002
         BE    MNT02100                 BRANCH IF YES            Y02134 52900002
*                                                                Y02134 53000002
         LA    R7,RENAME2               POINT TO NAME IGG03002   Y02134 53100002
*                                                                Y02134 53200002
MNT02100 EQU   *                        RETURN TO SCRATCH/RENAME Y02134 53300002
         NI    SISW2,X'FF'-VIRTMNT      TURN OFF VIRT MNT BIT  @Y30LSTG 53305003
         LR    RETURN,RCODE             RETURN CODE IN REG 14    Y02134 53400002
         L     RCVT,CVTPTR              RELOAD CVT ADDRESS       Y02134 53500002
         L     PL,OLDPLPTR              RELOAD PARM LIST ADDRESS Y02134 53600002
         IECRES LOAD,EXTPR=(RWKAREA),MODNM=(R7),BRANCH=DIRECT    Y02134 53700002
         EJECT                                                          53800037
         SPACE 3                                                        53810037
*********************************************************************** 53820037
*                                                                       53830037
* THIS SECTION ISSUES MOUNT MESSAGE IEC601D UNLESS THE DEVICE  @Y30LSTG 53840037
* IS AN MSS  SUBSYSTEM PACK.  IF IT IS A VIRTUAL VOLUME, ISSUE @G18MSBS 53850037
* A REQUEST TO JES3( IF THE UCB INDICATES A JES3 MANAGED UNIT) @G18MSBS 53860037
* FOR VOLUME AWARENESS.  AND THEN ISSUE THE ICBMNTDE MACRO     @G18MSBS 53870037
* (SVC 126) WHICH WILL INTERFACE WITH THE SUBSYSTEM TO MOUNT   @G18MSBS 53880037
* THE VIRTUAL VOLUME.                                          @G18MSBS 53890037
*                                                                       53900037
*********************************************************************** 53910037
*                                                                       54000002
MNT03000 EQU   *                        ISSUE IEC601D            Y02134 54100002
         BAL   RETURN,MNT11600          LINK TO SET MOUNT BIT    Y02134 54200002
*                                       AND TO PUT VOLSER IN UCB Y02134 54300002
*                                                                Y02134 54400002
         TM    UCBTBYT2,UCBRVDEV        IS IT A VIRTUAL DEVICE @Y30LSTG 54405037
         BNO   MNT03010                 NO, ALL SHOULD WORK    @ZM30032 54405337
         SPACE 1                                               @G18MSBS 54405637
         TM    UCBJBNR,UCBJES3          DOES JES3 MANAGE UNIT? @G18MSBS 54405937
         BNO   MNT03005                 NO, BYPASS JES3 ROUTINE@G18MSBS 54406237
         EJECT                                                          54406537
*                                                              @G18MSBS 54406837
***************************************************************@G18MSBS 54407137
*                                                              @G18MSBS 54407437
*      **************************                              @G18MSBS 54407737
*      * JES3 INTERFACE ROUTINE *                              @G18MSBS 54408037
*      **************************                              @G18MSBS 54408337
*                                                              @G18MSBS 54408637
*        ON ENTRY -                                            @G18MSBS 54408937
*                                                              @G18MSBS 54409237
*        THIS ROUTINE WILL BUILD THE SSOB HEADER AND EXTENSION @G18MSBS 54409537
*        PARAMETER LIST AND PASS IT TO JES3 VIA THE MACRO:     @G18MSBS 54409837
*        'IEFSSREQ', OFFERING THE VOLUME CHOICE TO JES3 FOR    @G18MSBS 54410137
*        APPROVAL.  UPON RETURN FROM JES3 THE 'SSOBRETN' FIELD @G18MSBS 54410437
*        IS TESTED FOR ZERO.  ZERO ALLOWS SCRATCH/RENAME TO    @G18MSBS 54410737
*        CONTINUE AND A NON-ZERO INDICATES JES3 DETERMINED     @G18MSBS 54411037
*        THAT VOLUME COULD NOT BE USED BY THIS JOB NOW. THE    @G18MSBS 54411337
*        RETURN CODE WILL BE SET TO EIGHT AND RETURN BACK TO   @G18MSBS 54411637
*        THE CALLER OF SCRATCH/RENAME.                         @G18MSBS 54411937
***************************************************************@G18MSBS 54412237
*                                                              @G18MSBS 54412537
        SPACE                                                           54412837
         STM   R0,RET,RENAMWKA          SAVE REGISTERS         @G18MSBS 54413137
         LR    RSAVE,RWKAREA            SAVE SAVEAREA PTR      @G18MSBS 54413437
         LA    R1,VTOCDSCB              GET THE WORK AREA      @G18MSBS 54413737
         USING SSOB,R1                  ESTAB ADDRESSABILITY   @G18MSBS 54414037
         XC    SSOB(SSOBSIZE),SSOB      CLEAR OUT WORK AREA    @G18MSBS 54414337
         ST    R1,DASSOBAD              SAVE PARM POINTER      @G18MSBS 54414637
*                                       SET HI-ORDER BIT TO    @G18MSBS 54414937
         OI    DASSOBAD,HIORDER         REQUEST THE SSOB MACRO @G18MSBS 54415237
         MVC   SSOBID,DASSOBID          ID OF SSOB             @G18MSBS 54415537
         MVI   SSOBLEN+K1,SSOBHSIZ      LENGTH OF SSOBHEADER   @G18MSBS 54415837
         MVI   SSOBFUNC+K1,SSOBOEOV     SET FUNCTION ID        @G18MSBS 54416137
*                                       INDICATE FINAL REQUEST @G18MSBS 54416437
         OI    SSMOFLG1,SSMOFINL+SSMOSCR FROM DADSM SCRATCH    @G18MSBS 54416737
        SPACE                                                           54417037
         LA    RF,SSMOBGN               GET FUNCTION DEPENDENT @G18MSBS 54417337
         ST    RF,SSOBINDV              AREA PTR AND SAVE IT   @G18MSBS 54417637
         MVI   SSMOLEN+K1,SSMOSIZE      LENGTH OF EXTENSION    @G18MSBS 54417937
         L     RTCB,TCBADDR             LOAD TCB ADDRESS       @G18MSBS 54418237
         USING TCB,RTCB                 TCB ADDRESSABILITY     @G18MSBS 54418537
         L     RTCB,TCBJSCB             LOAD JSCB ADDRESS      @G18MSBS 54418837
         USING IEZJSCB,RTCB             JSCB ADDRESSABILITY    @G18MSBS 54419137
         L     RTCB,JSCBACT             GET ACTIVE JSCB ADDRESS@G18MSBS 54419437
         L     RF,JSCBJCT               GET JCT PTR FROM JSCB  @G18MSBS 54419737
         LA    RF,SWAPREFX+JCTJNAME-JCTABLE(,RF) GET PTR OF    @G18MSBS 54420037
*                                       JOB NAME               @G18MSBS 54420337
         ST    RF,SSMOPNAM              AND SAVE IT FOR SSOB   @G18MSBS 54420637
         L     RF,JSCSCT                GET SCT PTR FROM JSCB  @G18MSBS 54420937
         LA    RF,SWAPREFX+SCTSNUMB-SCTABLE(,RF) GET PTR OF    @G18MSBS 54421237
*                                       STEP NUMBER            @G18MSBS 54421537
         ST    RF,SSMOPSTN              AND SAVE IT FOR SSOB   @G18MSBS 54421837
         LA    RF,UCBNAME               GET PTR OF UNIT ADDRESS@G18MSBS 54422137
         ST    RF,SSMOPUAD              AND SAVE IT FOR SSOB   @G18MSBS 54422437
         LA    RF,UCBVOLI               GET PTR OF VOLSER      @G18MSBS 54422737
         ST    RF,SSMOPVOL              AND SAVE IT FOR SSOB   @G18MSBS 54423037
         LA    RWKAREA,SSOBSAVE         GET SAVE AREA FOR SSOB @G18MSBS 54423337
         LA    R1,DASSOBAD              GET ADDR OF PARM PTR   @G18MSBS 54423637
         DROP  R1,RTCB                                         @G18MSBS 54423937
        EJECT                                                           54424237
*                                                              @G18MSBS 54424537
***************************************************************@G18MSBS 54424837
*                                                              @G18MSBS 54425137
**       PREPARE TO ISSUE MACRO: 'IEFSSREQ'                    @G18MSBS 54425437
*                                                              @G18MSBS 54425737
**       ON ENTRY:                                             @G18MSBS 54426037
*                                                              @G18MSBS 54426337
**       REGISTER  1 = POINTER TO SSOB PARAMETER LIST POINTER  @G18MSBS 54426637
**       REGISTER 10 = POINTER TO MY SAVE AREA TO RESTORE REGS @G18MSBS 54426937
**       REGISTER 13 = SAVE AREA TO BE USED BY JES3            @G18MSBS 54427237
*                                                              @G18MSBS 54427537
**       ON RETURN:                                            @G18MSBS 54427837
*                                                              @G18MSBS 54428137
**       REGISTER  0 = VOLATILE                                @G18MSBS 54428437
**       REGISTER  1 = POINTER TO SSOB PARAMETER LIST          @G18MSBS 54428737
**       REGISTER 10 = POINTER TO MY SAVE AREA TO RESTORE REGS @G18MSBS 54429037
**       REGISTER 15 = JES SSOB RETURN CODE(IGNORED-SEE BELOW) @G18MSBS 54429337
**       'SSOBRETN' CONTAINS A RETURN CODE:                    @G18MSBS 54429637
**                  0 = THIS VOLUME IS AVAILABLE FOR MOUNTING. @G18MSBS 54429937
**                  4 = JES3 HAS SOME OTHER USE FOR THAT VOL.  @G18MSBS 54430237
*                                                              @G18MSBS 54430537
***************************************************************@G18MSBS 54430837
*                                                              @G18MSBS 54431137
         IEFSSREQ                       ISSUE MACRO            @G18MSBS 54431437
        SPACE                                                           54431737
         USING SSOB,R1                  ESTAB ADDRESSABILITY   @G18MSBS 54432037
         L     RF,SSOBRETN              GET JES3 FUNCT RET CODE@G18MSBS 54432337
         DROP  R1                                              @G18MSBS 54432637
         SPACE                                                          54432937
         LM    R0,RET,K0(RSAVE)         RESTORE REGISTERS      @G18MSBS 54433237
         LTR   RF,RF                    TEST RET FROM IEFSSREQ @G18MSBS 54433537
         BNZ   MNT01600                 JES3 WON'T ALLOW THIS  @G18MSBS 54433837
*                                       VOLUME TO BE MOUNTED   @G18MSBS 54434137
         EJECT                                                          54434437
MNT03005 EQU   *                        MSS MOUNT ROUTINE      @G18MSBS 54434737
         XC    VTOCDSCB(L28),VTOCDSCB   CLEAR OUT WORK AREA    @G18MSBS 54435037
         MVC   VTOCDSCB+D8(L6),UCBVOLI  MOVE IN VOLID          @G18MSBS 54435337
         MVC   VTOCDSCB+D14(L2),UCBCHA  MOVE IN CHAN AND UNIT  @G18MSBS 54435637
         LA    R1,VTOCDSCB              POINT TO THE AREA      @Y30LSTG 54440003
         ICBMNTDE TYPE=MNT,MF=(E,(1))   ISSUE THE MOUNT        @Y30LSTG 54445003
         LTR   R15,R15                  ANY ERRORS             @ZM30032 54450003
         BNZ   MSSERR                   YES, GO ISSUE MESSAGE  @ZM30032 54455003
         OI    SISW2,VIRTMNT            INDICATE VIRT.MNT      @Y30LSTG 54456003
         B     MNT04000                 BRANCH OUT             @ZM30032 54460003
MSSERR   LA    R7,VTOCDSCB+L28          BASE MSG REGISTER      @ZM33363 54460503
         USING PDDSECT,R7               BASE MESSAGE AREA      @Y30SLTG 54461003
         LR    R15,R4                   SAVE REG FOUR          @Y30LSTG 54461503
         LA    R1,VTOCDSCB              BASE REG ONE           @Y30LSTG 54462003
         L     RCVT,CVTPTR              INIT BASE              @Y30LSTG 54462503
         L     R4,CVTTCBP               LOCATE TCB PTRS        @Y30LSTG 54463003
         L     R4,D4(,R4)               GET CURRENT TCB        @Y30LSTG 54463503
         L     R4,TCBTIO-TCB(,R4)       GET TIOT START         @Y30LSTG 54464003
         MVC   PDMSGLNG(MSSMSGL),MSSMSG  PUT IN MSG            @Y30LSTG 54464503
         MVC   PDMSG+D8(L8),TIOCNJOB-TIOT(R4) ST JOBNAME       @Y30LSTG 54464603
         MVC   PDMSG+D24(L3),UCBNAME    SET DDD IN MSG         @Y30LSTG 54464703
         MVC   PDMSG+D17(L6),D8(R1)     SET VOLSER IN MSG      @Y30LSTG 54464803
         SLL   R0,D4                    SHIFT FOUR BITS        @Y30LSTG 54464903
         STH   R0,D8(R1)                RESET REASON CODE      @Y30LSTG 54465403
         UNPK  PDMSG+D58(L3),D8(L2,R1)  UNPACK REASON CODE     @Y30LSTG 54465503
         OI    PDMSG+D60,DECZR0         MAKE DIGIT VALID       @Y30LSTG 54465603
         TR    PDMSG+D58(L3),NUMTBLE    MAKE IT PRINTABLE      @Y30LSTG 54465703
         MVC   PDMSG+D43(L18),PDMSG+D46 OVERLAY DIS IN MSG     @Y30LSTG 54466403
         LR    R4,R15                   RESTORE REG FOUR       @Y30LSTG 54466503
         WTO   MF=(E,PDMSGLNG)          ISSUE WTO              @Y30LSTG 54466603
         XC    UCBVOLI,UCBVOLI          CLEAR UCB VOL SERIAL   @ZA20579 54466737
         BAL   RETURN,MNT11800          RESET MOUNT PENDING    @ZA20579 54466837
         B     MNT01600                 POST ERROR             @Y30LSTG 54467137
         DROP  R7                       DROP                   @Y30LSTG 54467203
MNT03010 EQU   *                                               @Y30LSTG 54467703
*                                                              @Y30LSTG 54470003
         BAL   RETURN,MNT11700          LINK TO TELL TERMINAL    Y02134 54500002
*                                                                Y02134 54600002
         MVC   VTOCDSCB(IEC601DL),IEC601D  MOVE IN MOUNT MESSAGE Y02134 54700002
         LA    R1,VTOCDSCB+MOUNTUUU     POINT TO UUU AND VOLSER  Y02134 54800002
         BAL   RETURN,MNT11200          LINK TO GET UUU & VOLSER Y02134 54900002
*                                                                Y02134 55000002
         LA    R1,VTOCDSCB+MOUNTJN      POINT TO JOB NAME FIELD  Y02134 55100002
         BAL   RETURN,MNT11400          LINK TO GET JOBNAME AND  Y02134 55200002
*                                       STEPNAME FOR MESSAGE     Y02134 55300002
*                                                                Y02134 55400002
MNT03020 EQU   *                        ISSUE WTOR               Y02134 55500002
         XC    ECB,ECB                  CLEAR THE ECB            Y02134 55600002
         MVI   FIELD1,K0                CLEAR THE REPLY AREA     Y02134 55700002
*                                                                Y02134 55800002
         WTOR  ,FIELD1,1,ECB,MF=(E,VTOCDSCB)  ISSUE WTOR         Y02134 55900002
*                                                                Y02134 56000002
         WAIT  ECB=ECB                  WAIT FOR COMPLETION      Y02134 56100002
*                                                                Y02134 56200002
         CLI   FIELD1,REPLYU            TEST IF MOUNTING VOLUME  Y02134 56300002
         BE    MNT04000                 BRANCH IF YES            Y02134 56400002
         CLI   FIELD1,REPLYM            TEST IF SKIPPING VOLUME  Y02134 56500002
         BNE   MNT03020                 BRANCH IF NOT            Y02134 56600002
*                                                                Y02134 56700002
MNT03040 EQU   *                        RESET MOUNT BIT          Y02134 56800002
         XC    UCBVOLI,UCBVOLI          CLEAR THE VOL SERIAL NBR Y02134 56900002
         BAL   RETURN,MNT11800          LINK TO RESET MOUNT BIT  Y02134 57000002
*                                                                Y02134 57100002
         B     MNT01600                 GO SET THE RETURN CODE   Y02134 57200002
*                                                                       57300002
* THIS SECTION BUILDS AND EXECUTES THE CHANNEL PROGRAM TO READ          57400002
* THE VOLUME LABEL FROM RECORD 3 OF TRACK 0.                            57500002
*                                                                       57600002
MNT04000 EQU   *                        BUILD CHANNEL PROGRAM    Y02134 57700002
         XC    SEEK,SEEK                CLEAR IOB SEEK ADDRESS   Y02134 57800002
         MVI   SEEK+K7,K3               RECORD 3                 Y02134 57900002
         XC    CCW1(CCW4-CCW1),CCW1     CLEAR CCW AREA           Y02134 58000002
         LA    R15,SEEK+K3              SEARCH ID ADDRESS        Y02134 58100002
         ST    R15,CCW1                                          Y02134 58200002
         LA    R15,CCW1                 TIC ADDRESS              Y02134 58300002
         ST    R15,CCW2                                          Y02134 58400002
         LA    R15,VOLLABEL             READ AREA ADDRESS        Y02134 58500002
         ST    R15,CCW3                                          Y02134 58600002
         OC    CCW1(CCW4-CCW1),CHANPRG  OR IN CODES AND FLAGS    Y02134 58700002
         XC    VOLLABEL,VOLLABEL        CLEAR READ AREA          Y02134 58800002
*                                                                YM7890 58803002
*****************************************************************YM7890 58806002
*                                                                YM7890 58809002
*        IF MOUNT PENDING AND UNIT NOT READY MEMORY MAY          YM7890 58812002
*        NOT BE SWAPPED OUT, BECAUSE IF OPERATOR CANCELS         YM7890 58815002
*        THE JOB, THE JOB WILL NOT TERMINATE UNTIL THE           YM7890 58818002
*        MOUNT IS SATISFIED.                                     YM7890 58821002
*                                                                YM7890 58824002
*****************************************************************YM7890 58827002
*                                                                YM7890 58830002
         TM    UCBFL1,UCBNOTRD          TEST IF READY            YM7890 58833002
         BZ    MNT04050                 BR READY- BYPASS NOSWAP  YM7890 58836002
*                                                                YM7890 58839002
         SYSEVENT DONTSWAP              IN CASE OPERATOR CANCEL  YM7890 58842002
*                                                                YM7890 58845002
         SLL   R1,K24                   CLEAR HI 3 BYTES         YM7890 58848002
         LTR   R1,R1                    CHECK FOR ERROR          YM7890 58851002
         BNZ   MNT04050                 BRANCH IF ERROR          YM7890 58854002
*                                                                YM7890 58857002
         L     R15,IECRRPRM             GET PTR TO RECOVERY      YM8511 58858002
         SH    R15,SIXWORDS             BACK UP BY SIX WORDS     YM8511 58858202
         USING DSMADTW1,R15             R15 PTS TO RECOVERY WDS  YM8511 58858402
         OI    DSMADTB1,DSMASWAP        SET RECOVERY INDICATOR   YM8511 58859002
         DROP  R15                                               YM8511 58860002
*                                                                YM8511 58861002
         EXCP  IOB                      READ VOLUME LABEL        YM7890 58863002
*                                                                YM7890 58866002
         WAIT  ECB=ECB                  WAIT FOR I/O TO FINISH   YM7890 58869002
*                                                                YM8511 58870002
         L     R15,IECRRPRM             GET PTR TO RECOVERY      YM8511 58870202
         SH    R15,SIXWORDS             BACK UP BY SIX WORDS     YM8511 58870402
         USING DSMADTW1,R15             R15 PTS TO RECOVERY WDS  YM8511 58870602
         NI    DSMADTB1,X'FF'-DSMASWAP  RESET RECOVERY INDICATOR YM8511 58871002
         DROP  R15                                               YM8511 58871402
*                                                                YM7890 58872002
         SYSEVENT OKSWAP                ALLOW SWAPOUT-UNIT READY YM7890 58875002
*                                                                YM7890 58878002
         B     MNT04100                 BRANCH TO RESET MOUNT    YM7890 58881002
*                                                                YM7890 58884002
MNT04050 EQU   *                        READ LABEL - UNIT READY  YM7890 58887002
*                                                                Y02134 58900002
         EXCP  IOB                      READ VOLUME LABEL        Y02134 59000002
*                                                                Y02134 59100002
         WAIT  ECB=ECB                  WAIT FOR COMPLETION      Y02134 59200002
*                                                                Y02134 59300002
MNT04100 EQU   *                        RESET MOUNT PENDING      YM7890 59330002
*                                                                YM7890 59360002
         BAL   RETURN,MNT11800          LINK TO RESET MOUNT BIT  Y02134 59400002
*                                                                       59500002
MNT04160 EQU   *                        CHECK FOR I/O ERROR      Y02134 62500002
         TM    ECB,GOODIO               CHECK FOR I/O ERROR      Y02134 62600002
         BZ    MNT01700                 BRANCH IF I/O ERROR      Y02134 62700002
*                                                                Y02134 62800002
MNT04180 EQU   *                        TEST IF VOLUME MOUNTED   Y02134 62900002
         CLC   VOLSERNO,K0(RVOLSER)     TEST IF THE CORRECT      Y02134 63000002
*                                       VOLUME IS MOUNTED        Y02134 63100002
         BE    MNT05000                 BRANCH IF CORRECT        Y02134 63200002
         TM    SISW2,VIRTMNT            IS IT VIRTUAL MOUNT    @Y30LSTG 63205003
         BO    MNT01600                 YES CANT REISSUE MOUNT @ZM30032 63210003
*                                                                       63300002
* IF THE WRONG VOLUME WAS MOUNTED, THIS SECTION ISSUES A DEMOUNT        63400002
* MESSAGE IF THE UNIT IS DEMOUNTABLE.  IF THE VOLUME IS AN MSS @Y30LSTG 63500003
* SUBSYSTEM PACK, AND ICBMNTDE (SVC 126) MACRO IS SENT TO THE  @Y30LSTG 63510003
* MSS  SYSTEM AND THE PACK WILL BE DEMOUNTED.                  @Y30LSTG 63520003
*                                                                       63600002
MNT04200 EQU   *                        TEST IF DEMOUNTABLE      Y02134 63700002
         TM    SISW2,VERIFYSW           TEST IF VOLUME WAS TO BE Y02134 63800002
*                                       VERIFIED ONLY            Y02134 63900002
         BNO   MNT04300                 BRANCH IF VOLUME WAS TO@Y30LSTG 64000003
*                                       BE MNTED AND VERIFIED  @Y30LSTG 64100003
         TM    UCBDMCT,UCBDMC           CHECK FOR ANY USERS      Y02134 64200002
         BNZ   MNT01550                 BRANCH IF YES - VOLUME   Y02134 64300002
*                                       CANNOT BE DEMOUNTED      Y02134 64400002
         TM    UCBSTAT,UCBSYSR+UCBRESV+UCBPRES  TEST IF SYSRES   Y02134 64500002
*                                       RESERVED, OR PERMANENT   Y02134 64600002
         BNZ   MNT01550                 BRANCH IF ANY OR ALL -   Y02134 64700002
*                                       VOL CANNOT BE DEMOUNTED  Y02134 64800002
         TM    UCBSTAB,UCBBSVL          TEST IF SHARED VOLUME    Y02134 64900002
         BZ    MNT01550                 BRANCH IF YES - VOLUME   Y02134 65000002
*                                       CANNOT BE DEMOUNTED      Y02134 65100002
*                                                                Y02134 65200002
MNT04300 EQU   *                        MOVE IN REJECT MESSAGE   Y02134 65300002
*                                                              @Y30LSTG 65301003
* THIS CODE IS FOR THE MSS  DEMOUNT.                           @Y30LSTG 65302003
*                                                              @Y30LSTG 65303003
         TM    UCBTBYT2,UCBRVDEV        VIRT DASD REJECT       @Y30LSTG 65305037
         BNO   MNT04600                 NO, GO ON AS USUAL     @ZM30032 65310003
         BAL   RETURN,MNT11230          GO MAKE PARM LIST      @Y30LSTG 65315003
         MVC   F1DSCB+D8(L6),VOLSERNO   DO IT RIGHT            @Y30LSTG 65316003
         BAL   RETURN,MNT11260          GO ISSUE DMNT TO MSS   @Y30LSTG 65325003
         BAL   RETURN,MNT11300          GO CLEAR OUT UCB       @ZA04505 65327037
         B     MNT03000                 NO GO ISSUE MOUNT      @Y30LSTG 65330003
MNT04600 EQU   *                                               @Y30LSTG 65335003
         MVC   F1DSCB(REJECTL),RJECTMSG  MOVE IN REJECT MESSAGE  Y02134 65400002
         MVC   MSGINDIC+K2(L'UCBNAME),UCBNAME  MOVE CHANNEL/UNIT Y02134 65500002
*                                       ADDRESS INTO MESSAGE     Y02134 65600002
         MVC   MSGINDIC+K6(L'UCBVOLI),VOLSERNO  MOVE IN VOL SER  Y02134 65700002
*                                       OF VOLUME BEING REJECTED Y02134 65800002
         OC    MSGINDIC+K6(L'UCBVOLI),BLANKS  ENSURE UPPERCASE   Y02134 65900002
*                                                                Y02134 66000002
         BAL   RETURN,MNT11300          LINK TO CLEAR UCB        Y02134 66100002
*                                                                Y02134 66200002
         LA    R1,F1DSCB+REJECTJN       POINT TO JOB NAME FIELD  Y02134 66300002
         BAL   RETURN,MNT11400          LINK TO GET JOB NAME AND Y02134 66400002
*                                       STEP NAME FOR MESSAGE    Y02134 66500002
*                                                                Y02134 66600002
         BAL   RETURN,MNT11500          LINK TO ISSUE WTO        Y02134 66700002
*                                                                Y02134 66800002
         B     MNT03000                 GO ISSUE MOUNT MESSAGE   Y02134 66900002
*                                                                       67000002
* THIS SECTION CONVERTS THE CCHHR OF THE VTOC TO A TTR0 AND STORES      67100002
* IT AND THE VOLUME SERIAL NUMBER IN THE UCB.                           67200002
*                                                                       67300002
MNT05000 EQU   *                        CONVERT VTOC CCHHR       Y02134 67400002
         NI    SISW2,X'FF'-VIRTMNT      TURN OFF MOUNT SW      @Y30LSTG 67405003
         MVC   SEEK+K3(K5),VOLVTOC      CCHHR OF THE VTOC        Y02134 67500002
         BAL   RETURN,MNT11900          LINK TO CONVERT ROUTINE  Y02134 67600002
*                                                                Y02134 67700002
         ST    R0,UCBVTOC               STORE VTOC TTR0 IN UCB   Y02134 67800002
         MVC   UCBVOLI,VOLSERNO         MOVE VOL SER INTO UCB    Y02134 67900002
*                                                                       68000002
* THIS SECTION UPDATES THE UCB VOLUME DISPOSITION.                      68100002
*                                                                       68200002
MNT05100 EQU   *                        TEST FOR PASSED DATA     Y02134 68300002
         NI    UCBJBNR,X'FF'-UCBMONT    SET PASS TO ZERO         Y02134 68400002
         NI    UCBSTAB,X'FF'-UCBBPRV-UCBBPUB  SET PRIVATE AND    Y02134 68500002
*                                       PUBLIC TO ZERO           Y02134 68600002
         OI    UCBSTAT,UCBDADI          INDICATE SL VOLUME       Y02134 68700002
*                                                                Y02134 68800002
         L     RDSAB,DSABADDR           LOAD DSAB ADDRESS        Y02134 68900002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02134 69000002
         TM    DSABFLG3,DSABPASS        TEST FOR PASSED DATA     Y02134 69100002
         BNO   MNT05120                 BRANCH IF NOT PASSED     Y02134 69200002
*                                                                Y02134 69300002
         OI    UCBJBNR,UCBMONT          SET PASS INDICATOR       Y02134 69400002
*                                                                Y02134 69500002
MNT05120 EQU   *                        TEST FOR PRIVATE DATA    Y02134 69600002
         L     RTIOT,DSABTIOT           LOAD TIOT ADDRESS        Y02134 69700002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02134 69750002
         TM    TIOESTTA,TIOSDSP1        TEST FOR PRIVATE DATA    Y02134 69800002
         BNO   MNT05140                 BRANCH IF NOT PRIVATE    Y02134 69900002
         OI    UCBSTAB,UCBBPRV          SET PRIVATE INDICATOR    Y02134 70000002
*                                                                Y02134 70100002
         L     R1,UCBEXTPT              LOAD UCB EXTENSION ADDR  Y02146 70200002
         OI    UCBFLP1-UCBCMEXT(R1),UCBNSRCH SET TO NON-SCRTH VOLY02146 70400002
*                                                                Y02134 70600002
MNT05140 EQU   *                        TEST FOR PUBLIC DATA     Y02134 70700002
         TM    TIOESTTA,TIOSDSP2        TEST FOR PUBLIC DATA     Y02134 70800002
         BNO   MNT01500                 BRANCH IF NOT PUBLIC     Y02134 70900002
         OI    UCBSTAB,UCBBPUB          SET PUBLIC INDICATOR     Y02134 71000002
         B     MNT01500                 GO RETURN                Y02134 71100002
         EJECT                                                   Y02134 71200002
*                                                                       71300002
* IF THIS MODULE ENQ'ED ON THE VOLUME SERIAL OF THE VOLUME BEING        71400002
* DEMOUNTED, THIS ROUTINE ISSUES A DEQ DIRECTED TO THE INITIATOR'S TCB. 71500002
*                                                                       71600002
MNT10000 EQU   *                        ISSUE DEQ                Y02134 71700002
         TM    SISW1,VOLDEQ             TEST IF VOL TO BE DEQ'ED Y02134 71800002
         BCR   14,RETURN                RETURN IF NOT            Y02134 71900002
         L     RTCB,TCBADDR             LOAD TCB ADDRESS         Y02134 72000002
         USING TCB,RTCB                 TCB ADDRESSABILITY       Y02134 72050002
         L     RTCB,TCBJSCB             LOAD JSCB ADDRESS        Y02134 72100002
         USING IEZJSCB,RTCB             JSCB ADDRESSABILITY      Y02134 72200002
         L     RTCB,JSCBACT             GET ACTIVE JSCB ADDRESS  YM2887 72201002
         L     RTCB,JSCBTCBP            INITIATOR TCB ADDRESS    Y02134 72300002
         MVC   ENQAREA(DEQLTH1),DEQLIST1  MOVE IN DEQ PARM LIST  Y02134 72400002
         MVC   MJNAME(L'SYSZVOLS),SYSZVOLS  MAJOR RESOURCE NAME  Y02134 72500002
         LR    R7,RETURN                SAVE RETURN ADDRESS      YM8501 72550002
*                                                                YM8501 72560002
         DEQ   (MJNAME,VOLMINOR),TCB=(RTCB),MF=(E,ENQAREA)  DEQ  Y02134 72600002
*                                                                YM8501 72650002
         LR    RETURN,R7                RESTORE RETURN ADDRESS   YM8501 72660002
         NI    SISW1,X'FF'-VOLDEQ       RESET VOL DEQ SWITCH     Y02134 72700002
         XC    VOLMINOR,VOLMINOR        ZERO MINOR RESOURCE NAME Y02134 72800002
         BR    RETURN                   RETURN                   Y02134 72900002
         EJECT                                                   Y02134 73000002
*                                                                       73100002
* THIS ROUTINE MOVES THE APPROPRIATE DEMOUNT MESSAGE INTO THE WORK      73200002
* AREA.  IF THE MONITOR SPACE COMMAND IS ACTIVE AND/OR IF AN SMF        73300002
* RECORD TYPE 19 MUST BE BUILT, IT ISSUES SVC 78 (LSPACE).  IT THEN     73400002
* ISSUES SVC 91 (VOLSTAT) TO RECORD THE VOLUME STATUS ON SYS1.LOGREC.   73500002
*                                                                       73600002
MNT11000 EQU   *                        MONITOR SPACE ACTIVE     Y02134 73700002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02134 73800002
         L     R15,CVTMSLT              MASTER SCHED LINK TABLE  Y02134 73900002
         TM    BAMONITR-BASE(R15),BASPACE  MONITOR SPACE ACTIVE  Y02134 74000002
         BNO   MNT11020                 BRANCH IF NOT            Y02134 74100002
         MVC   F1DSCB(DMNTLN2),DMNTMSG2  MOVE IN THE TWO LINE    Y02134 74200002
*                                       DEMOUNT MESSAGE          Y02134 74300002
         MVI   SPACEMSG,BLANK           SET UP TO BLANK SPACE    Y02134 74400002
*                                       INFORMATION FIELD        Y02134 74500002
         MVC   SPACEMSG+K1(SPACELN),SPACEMSG  PROPAGATE BLANKS   Y02134 74600002
         LA    R1,SPACEMSG              POINT TO SPACE INFO      Y02134 74700002
         B     MNT11040                 GO TEST FOR SMF          Y02134 74800002
*                                                                Y02134 74900002
MNT11020 EQU   *                        PREPARE FOR LSPACE       Y02134 75000002
         MVC   F1DSCB(DMNTLN1),DMNTMSG1  MOVE IN DEMOUNT MESSAGE Y02134 75100002
         XR    R1,R1                    CLEAR REG FOR LSPACE     Y02134 75200002
*                                                                Y02134 75300002
MNT11040 EQU   *                        TEST FOR SMF SYSTEM      Y02134 75400002
         L     R15,CVTSMCA              GET SMCA ADDRESS         Y02134 75500002
         LTR   R15,R15                  TEST FOR SMF SYSTEM      Y02134 75600002
         BZ    MNT11060                 BRANCH IF NOT            Y02134 75700002
         USING SMCABASE,R15             SMCA ADDRESSABILITY      Y02134 75800002
         TM    SMCAOPT,SMCAVOL          IS VOL INFO REQUESTED    Y02134 75900002
         BZ    MNT11060                 BRANCH IF NOT            Y02134 76000002
*                                                                Y02134 76100002
         LA    R15,SMFFLAG              SET UP LSPACE SMF FLAG   Y02134 76200002
         SLL   R15,24                   MOVE FLAG TO BIT 0       Y02134 76300002
         OR    R1,R15                   PUT FLAG IN PARM REG     Y02134 76400002
*                                                                Y02134 76500002
MNT11060 EQU   *                        ISSUE LSPACE SVC         Y02134 76600002
         LTR   R1,R1                    IS LSPACE SVC REQUIRED   Y02134 76700002
         BZ    MNT11080                 BRANCH IF NOT            Y02134 76800002
*                                                                Y02134 76900002
         LR    R0,RUCB                  UCB ADDRESS IN REG 0     Y02134 77000002
         SVC   LSPACE                   ISSUE LSPACE SVC         Y02134 77100002
*                                                                Y02134 77200002
MNT11080 EQU   *                        ISSUE VOLSTAT SVC        Y02134 77300002
         LNR   R0,RUCB                  INDICATE A DA UCB        Y02134 77400002
         SVC   VOLSTAT                  ISSUE VOLSTAT SVC        Y02134 77500002
*                                                                Y02134 77600002
         BR    RETURN                   RETURN                   Y02134 77700002
         EJECT                                                   Y02134 77800002
*                                                                       77900002
* THIS ROUTINE FILLS IN THE UUU AND VOLSER FIELDS OF THE DEMOUNT        78000002
* AND MOUNT MESSAGES.  REGISTER 1 POINTS TO THE FIRST BYTE OF THE       78100002
* UUU (CHANNEL/UNIT ADDRESS) FIELD.                                     78200002
*                                                                       78300002
MNT11200 EQU   *                        FILL IN UUU AND VOLSER   Y02134 78400002
         MVC   K0(L'UCBNAME,R1),UCBNAME  MOVE CHANNEL/UNIT       Y02134 78500002
*                                       ADDRESS INTO MESSAGE     Y02134 78600002
         MVC   K4(L'UCBVOLI,R1),UCBVOLI  MOVE IN VOLUME SERIAL   Y02134 78700002
         OC    K4(L'UCBVOLI,R1),BLANKS  ENSURE UPPER CASE        Y02134 78800002
         BR    RETURN                   RETURN                   Y02134 78900002
*                                                              @Y30LSTG 78905003
* THIS ROUTINE CREATES AND FILLS IN THE DEMOUNT PARAMETER LIST @Y30LSTG 78910003
* IF A DEMOUNT MESSAGE IS TO BE ISSUED TO MSS .                @Y30LSTG 78915003
*                                                              @Y30LSTG 78920003
MNT11230 EQU   *                                               @Y30LSTG 78925003
         XC    F1DSCB(L28),F1DSCB       ZERO DEMNT MSG AREA    @ZM33363 78930003
         MVC   F1DSCB+D8(L6),UCBVOLI    MOVE IN THE VOLID      @Y30LSTG 78935003
         BR    RETURN                   GO BACK TO CALLER      @Y30LSTG 78955003
         SPACE 1                                               @Y30LSTG 78960003
*                                                              @Y30LSTG 78965003
* THIS ROUTINE ISSUES A DEMOUNT MESSAGE TO REMOVE A VIRTUAL    @Y30LSTG 78970003
* PACK FROM A VIRTUAL DRIVE.                                   @ZM30032 78975003
*                                                              @Y30LSTG 78980003
MNT11260 EQU   *                                               @Y30LSTG 78985003
         LA    R1,F1DSCB                POINT TO PARM LIST     @Y30LSTG 78990003
         ICBMNTDE TYPE=DMNT,VUA=UCBCHA, DEMOUNT THE PACK       @G24LSFS*78995037
               MF=(E,(1))                                               78995337
         LTR   R15,R15                  ANY ERRORS             @Y30LSTG 78996003
         BNZ   MSSERR2                  YES, GO ISSSUE MESG    @Y30LSTG 78997003
         BR    RETURN                   RETURN NORMAL          @ZM30032 78998003
MSSERR2  LA    R7,F1DSCB+L28            BASE MSG REGISTER      @ZM33363 78998503
         USING PDDSECT,R7               BASE MESSAGE AREA      @Y30SLTG 78999003
         LR    R15,R4                   SAVE REG FOUR          @Y30LSTG 78999503
         LA    R1,F1DSCB                BASE REG ONE           @Y30LSTG 78999603
         L     RCVT,CVTPTR              INIT BASE              @Y30LSTG 78999703
         L     R4,CVTTCBP               LOCATE TCB PTRS        @Y30LSTG 78999803
         L     R4,D4(,R4)               GET CURRENT TCB        @Y30LSTG 78999903
         L     R4,TCBTIO-TCB(,R4)       GET TIOT START         @Y30LSTG 79000403
         MVC   PDMSGLNG(MSSMSGL),MSSMSG  PUT IN MSG            @Y30LSTG 79000503
         MVC   PDMSG+D8(L8),TIOCNJOB-TIOT(R4) ST JOBNAME       @Y30LSTG 79000603
         MVC   PDMSG+D24(L3),UCBNAME    SET DDD IN MSG         @Y30LSTG 79000703
         MVC   PDMSG+D17(L6),D8(R1)     SET VOLSER IN MSG      @Y30LSTG 79000803
         SLL   R0,D4                    SHIFT FOUR BITS        @Y30LSTG 79001303
         STH   R0,D8(R1)                RESET REASON CODE      @Y30LSTG 79001403
         UNPK  PDMSG+D58(L3),D8(L2,R1)  UNPACK REASON CODE     @Y30LSTG 79001503
         OI    PDMSG+D60,DECZR0         MAKE DIGIT VALID       @Y30LSTG 79001603
         TR    PDMSG+D58(L3),NUMTBLE    MAKE IT PRINTABLE      @Y30LSTG 79001703
         LR    R4,R15                   RESTORE REG FOUR       @Y30LSTG 79002503
         WTO   MF=(E,PDMSGLNG)          ISSUE WTO              @Y30LSTG 79002603
         B     MNT01550                 POST ERROR             @Y30LSTG 79003103
         DROP  R7                       DROP                   @Y30LSTG 79003203
         EJECT                                                   Y02134 79003603
*                                                                       79100002
* THIS ROUTINE SETS THE NOT READY BIT IN THE UCB AND THEN               79200002
* CLEARS THE UCB BEFORE DEMOUNTING A VOLUME.                            79250002
*                                                                       79300002
MNT11300 EQU   *                        SET NOT READY            Y02134 79400002
*                                                                Y02134 79700002
         IOSGEN UCBFLG,UCB=(RUCB),VAR=ON,TABLE=UCBNRY  NOT READY YM5390 79800002
*                                                                Y02134 79900002
         L     R1,UCBEXTPT              LOAD UCB EXTENSION ADDR  Y02146 80000002
         NI    UCBFLP1-UCBCMEXT(R1),X'FF'-UCBNSRCH NON-SCRTH OFF Y02146 80100002
         XC    UCBVOLI,UCBVOLI          CLEAR VOL SER NUMBER     Y02134 80200002
         XC    UCBFSCT,UCBFSCT          CLEAR FILE COUNTERS      Y02134 80500002
         XC    UCBFSEQ,UCBFSEQ          CLEAR FILE SEQ COUNTERS  Y02134 80600002
         NI    UCBJBNR,X'FF'-UCBMONT    SET PASS TO ZERO         Y02134 80700002
         NI    UCBSTAB,X'FF'-UCBBPRV-UCBBPUB  SET PRIVATE AND    Y02134 80800002
*                                       PUBLIC TO ZERO           Y02134 80900002
         NI    UCBSTAT,X'FF'-UCBDADI    SET SL VOLUME TO ZERO    Y02134 81000002
         BR    RETURN                   RETURN                   Y02134 81100002
         EJECT                                                   Y02134 81200002
*                                                                       81300002
* THIS ROUTINE FILLS IN THE JOB NAME AND STEP NAME FIELDS OF THE        81400002
* DEMOUNT AND MOUNT MESSAGES.  REGISTER 1 POINTS TO THE FIRST BYTE      81500002
* OF THE JOB NAME FIELD.                                                81600002
*                                                                       81700002
MNT11400 EQU   *                        JOB AND STEP NAMES       Y02134 81800002
         L     RTCB,TCBADDR             LOAD CURRENT TCB ADDRESS Y02134 81900002
         USING TCB,RTCB                 TCB ADDRESSABILITY       Y02134 81950002
         L     RTIOT,TCBTIO             LOAD TIOT ADDRESS        Y02134 82000002
         MVC   K0(L'TIOCNJOB,R1),TIOCNJOB-TIOT(RTIOT)  JOB NAME  Y02134 82100002
         MVC   K9(K8,R1),TIOCSTEP-TIOT(RTIOT)  STEP NAME         Y02134 82200002
         BR    RETURN                   RETURN                   Y02134 82300002
         SPACE 1                                                 Y02134 82400002
*                                                                       82500002
* THIS ROUTINE ISSUES A WTO.                                            82600002
*                                                                       82700002
MNT11500 EQU   *                        ISSUE WTO SVC            Y02134 82800002
         XR    R0,R0                    CLEAR FOR MULTI-LINE WTO Y02134 82850002
         WTO   MF=(E,F1DSCB)            ISSUE WTO SVC            Y02134 82900002
*                                                                Y02134 83000002
         BR    RETURN                   RETURN                   Y02134 83300002
         SPACE 1                                                 Y02134 83400002
*                                                                       83500002
* THIS ROUTINE SETS THE MOUNT BIT IN THE UCB AND PUTS THE VOLUME        83600002
* SERIAL NUMBER OF THE VOLUME BEING MOUNTED IN THE UCB.                 83700002
*                                                                       83800002
MNT11600 EQU   *                        SET THE MOUNT BIT        Y02134 83900002
         OI    UCBDMCT,UCBMOUNT         SET THE MOUNT BIT        Y02134 84000002
         MVC   UCBVOLI,K0(RVOLSER)      MOVE VOL SER INTO UCB    Y02134 84100002
         BR    RETURN                   RETURN                   Y02134 84200002
         EJECT                                                   Y02134 84300002
*                                                                       84400002
* THIS ROUTINE ISSUES A TPUT FOR MESSAGE IEC108I FOR A TSO TASK.        84500002
*                                                                       84600002
MNT11700 EQU   *                        SET UP MESSAGE IEC108I   Y02134 84700002
         L     R15,PSAAOLD-PSA          LOAD ASCB OLD POINTER    Y02134 84800002
         L     R15,ASCBTSB-ASCB(R15)    LOAD TSB ADDRESS         Y02134 84900002
         LTR   R15,R15                  TEST IF TSO TASK         Y02134 85000002
         BZ    MNT11740                 BRANCH IF NOT            Y02134 85100002
*                                                                Y02134 85200002
         MVC   VTOCDSCB(L'IEC108I),IEC108I  MOVE MSG TO BUFFER   Y02134 85300002
         LA    R0,L'IEC108I             LENGTH OF TSO MESSAGE    Y02134 85400002
         LA    R1,VTOCDSCB              POINT TO TSO MESSAGE     Y02134 85500002
         L     RTCB,TCBADDR             LOAD CURRENT TCB ADDRESS Y02134 85600002
         USING TCB,RTCB                 TCB ADDRESSABILITY       Y02134 85650002
         L     RTCB,TCBJSCB             LOAD JSCB ADDRESS        Y02134 85700002
         USING IEZJSCB,RTCB             JSCB ADDRESSABILITY      Y02134 85800002
         LH    R15,JSCBTJID             LOAD TJID                Y02134 85900002
         L     RTCB,JSCBPSCB            LOAD PSCB ADDRESS        Y02134 86000002
         USING PSCB,RTCB                PSCB ADDRESSABILITY      Y02134 86100002
         L     RTCB,PSCBUPT             LOAD UPT ADDRESS         Y02134 86200002
         USING UPT,RTCB                 UPT ADDRESSABILITY       Y02134 86300002
         TM    UPTSWS,UPTMID            TEST IF MSG ID REQUIRED  Y02134 86400002
         BO    MNT11720                 BRANCH IF YES            Y02134 86500002
         LA    R1,K8(R1)                ADJUST TSO MESSAGE PTR   Y02134 86600002
         SH    R0,IDLENGTH              ADJUST TSO MSG LENGTH    Y02134 86700002
*                                                                Y02134 86800002
MNT11720 EQU   *                        ISSUE TPUT SVC           Y02134 86900002
         SLL   R15,16                   SHIFT TJID TO HI ORDER   Y02134 87000002
         OR    R0,R15                   PUT TJID IN MSG LENGTH   Y02134 87100002
         TPUT  (1),(0),R                SEND MESSAGE TO TERMINAL Y02134 87200002
*                                                                Y02134 87300002
MNT11740 EQU   *                        RETURN LABEL             Y02134 87400002
         BR    RETURN                   RETURN                   Y02134 87500002
         EJECT                                                   Y02134 87600002
*                                                                       87700002
* THIS ROUTINE RESETS THE MOUNT BIT IN THE UCB.                         87800002
*                                                                       87900002
MNT11800 EQU   *                        RESET THE MOUNT BIT      Y02134 88000002
         NI    UCBDMCT,X'FF'-UCBMOUNT   RESET THE MOUNT BIT      Y02134 88100002
         BR    RETURN                   RETURN                   Y02134 88200002
         SPACE 1                                                 Y02134 88300002
*                                                                       88400002
* THIS ROUTINE LINKS TO THE RESIDENT CONVERT ROUTINE TO CONVERT         88500002
* AN MBBCCHHR TO A TTR0, WHICH IS RETURNED IN REGISTER 0.               88600002
*                                                                       88700002
MNT11900 EQU   *                        LINK TO CONVERT ROUTINE  Y02134 88800002
         LA    R1,WKADEB                WORK AREA DEB ADDRESS    Y02134 88900002
         DROP  RDEB                                              Y02134 89000002
         USING WKADEB,R1                WORK AREA ADDRESSABILITY Y02134 89100002
         LA    R2,SEEK                  POINTER TO MBBCCHHR      Y02134 89200002
         LR    R7,RWKAREA               SAVE EXTENDED PREFIX ADR Y02134 89300002
         STM   R9,RETURN,IECREGSV+K12   SAVE REGISTERS 9 - 14    Y02134 89400002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02134 89500002
         L     R15,CVTPRLTV             LOAD CONVERT ROUTINE ADR Y02134 89600002
         BALR  RETURN,R15               LINK TO CONVERT ROUTINE  Y02134 89700002
         LM    R9,RETURN,IECREGSV+K12-RENAMWKA(R7)  RESTORE REGS Y02134 89800002
         LA    RDEB,WKADEB              RESTORE WORK AREA ADDR   Y02134 89900002
         USING WKADEB,RDEB              WORK AREA ADDRESSABILITY Y02134 90000002
         BR    RETURN                   RETURN                   Y02134 90100002
         EJECT                                                   Y02134 90200002
*                                                                       90300002
*********************************************************************** 90400002
*                                                                       90500002
* PROGRAM CONSTANTS                                                     90600002
*                                                                       90700002
*********************************************************************** 90800002
*                                                                       90900002
ENQLIST1 ENQ   (,,E,6,SYSTEM),RET=USE,MF=L  SYSZVOLS ENQ LIST    Y02134 91000002
ENQLTH1  EQU   *-ENQLIST1               LENGTH OF ENQ PARM LIST  Y02134 91100002
ENQLIST2 ENQ   (,,E,6,SYSTEM),RET=CHNG,MF=L  SYSZVOLS ENQ LIST   Y02134 91200002
ENQLTH2  EQU   *-ENQLIST2               LENGTH OF ENQ PARM LIST  Y02134 91300002
DEQLIST1 DEQ   (,,6,SYSTEM),TCB=0,MF=L  SYSZVOLS DEQ LIST        YM2887 91400002
DEQLTH1  EQU   *-DEQLIST1               LENGTH OF DEQ PARM LIST  Y02134 91500002
SYSZVOLS DC    CL8'SYSZVOLS'            SYSZVOLS MAJOR NAME      Y02134 91600002
ZEROS    DC    XL6'00'                  SIX BYTES OF ZEROS       Y02134 91700002
BLANKS   DC    CL6' '                   SIX BYTES OF BLANKS      Y02134 91800002
SIXWORDS DC    AL2(6*4)                 SIX FULLWORDS            YM8511 91801002
DASSOBID DC    CL4'SSOB'                SSOB HEADER ID         @G18MSBS 91841037
         SPACE 1                                                 Y02134 91900002
*                                                                       92000002
* MESSAGES ISSUED BY THIS MODULE                                        92100002
*                                                                       92200002
IEC108I  DC    C'IEC108I OPERATOR ACTION HAS BEEN REQUESTED FOR YOUR DAX92300002
               TA SET'                                           Y02134 92400002
IDLENGTH DC    H'8'                     LENGTH OF MSG ID         Y02134 92500002
RJECTMSG WTO   'IEC502E R UUU,VOLSER,JOBNAME ,STEPNAME',         YM1238X92600002
               DESC=2,ROUTCDE=4,MF=L                             Y02134 92700002
REJECTL  EQU   *-RJECTMSG               LENGTH OF REJECT MESSAGE Y02134 92800002
DMNTMSG1 WTO   'IEC502E XX UUU,VOLSER,JOBNAME ,STEPNAME',        YM1238X92900002
               DESC=2,ROUTCDE=4,MF=L                             Y02134 93000002
DMNTLN1  EQU   *-DMNTMSG1               LENGTH OF DEMOUNT MSG    Y02134 93100002
DMNTMSG2 WTO   ('IEC502E XX UUU,VOLSER,SPACE=CCCC,TTTT,AAAA/YYYY,ZZZZ',X93200002
               D),('IEC502E JOBNAME ,STEPNAME',DE),              YM1238X93300002
               DESC=2,ROUTCDE=4,MF=L                             Y02134 93400002
DMNTLN2  EQU   *-DMNTMSG2               LENGTH OF DEMOUNT MSG    Y02134 93500002
IEC601D  WTOR  'IEC601D M UUU,VOLSER,JOBNAME ,STEPNAME - REPLY U OR M',X93600002
               ,1,,DESC=2,ROUTCDE=4,MF=L                         Y02134 93700002
IEC601DL EQU   *-IEC601D                LENGTH OF MOUNT MESSAGE  Y02134 93800002
NUMTBLE  EQU   *-TWO40                  TRANSLATE TABLE        @Y30LSTG 93800503
         DC    C'0123456789ABCDEF'      REA CODE FOR VIRT DASD @Y30LSTG 93801003
MSSMSG   WTO   'IEC666I JJJJJJJJ,VOLSER,DDD MSS FAILURE IN DISMOUNT. COX93801503
               DE=HHH   ',MF=L,DESC=4,ROUTCDE=(2,11)           @Y30LSTG 93802003
MSSMSGL  EQU   *-MSSMSG                 LENGTH OF MSG          @Y30LSTG 93802503
         SPACE 1                                                 Y02134 93900002
*                                                                       94000002
* CCW'S TO READ THE VOLUME LABEL                                        94100002
*                                                                       94200002
CHANPRG  DC    X'3100000040000005'      SEARCH ID EQUAL          Y02134 94300002
         DC    X'0800000000000000'      TIC *-8                  Y02134 94400002
         DC    X'0600000000000050'      READ 80 BYTES OF DATA    Y02134 94500002
         SPACE 1                                                 Y02134 94600002
*                                                                       94700002
* TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                       94800002
*                                                                       94900002
         XCTLTABL ID=(SCRATCH1,IGG0290D,SCRATCH2,IGG0290E,       Y02134X95000002
               RENAME1,IGG03001,RENAME2,IGG03002),LENGTH=,       Y02134X95100002
               BRT=YES                                           Y02134 95200002
         SPACE 2                                                 Y02134 95300002
         IECPDSCT                                              @Y30LSTG 95300503
         SPACE 2                                                 Y02134 95301003
         IECDSECS ASCB,BASE,CVT,DSAB,JSCB,PSA,PSCB,SMF,TCB,      Y02134X95400002
               TIOT,UPT,UCB,EXPAND=YES                           YM6554 95500002
*                                                                       95600002
* THIS MACRO DESCRIBES THE COMMUNICATION AREA OF THE I/O SUPERVISOR.    95700002
*                                                                       95800002
         IECDIOCM                                                Y02134 95900002
         EJECT                                                   Y02134 96000002
*                                                                       96100002
* THIS MACRO EXPANDS THE RENAME WORK AREA, WHICH CAN ALSO BE USED       96200002
* TO ADDRESS PORTIONS OF THE SCRATCH WORK AREA.                         96300002
*                                                                       96400002
WORKAREA IECRENWA EP,ADT=YES            RENAME WORK AREA         YM8511 96500002
MSGINDIC EQU   F1DSCB+12                OFFSET TO MSG INDICATOR  Y02134 96600002
SPACEMSG EQU   F1DSCB+26                OFFSET TO LSPACE INFO    Y02134 96700002
         SPACE 1                                                 Y02134 96800002
         ORG   VTOCDSCB                                          Y02134 96900002
VOLLABEL DS    0CL80                    VOLUME LABEL             Y02134 97000002
VOLLABI  DS    CL3                      LABEL IDENTIFIER         Y02134 97100002
VOLNO    DS    CL1                      VOLUME LABEL NUMBER      Y02134 97200002
VOLSERNO DS    CL6                      VOLUME SERIAL NUMBER     Y02134 97300002
VOLSEC   DS    CL1                      VOLUME SECURITY FLAG     Y02134 97400002
VOLVTOC  DS    CL5                      CCHHR OF THE VTOC        Y02134 97500002
         DS    CL5                      RESERVED                 Y02134 97600002
         DS    CL20                     RESERVED                 Y02134 97700002
VOLOWNER DS    CL10                     OWNER NAME AND ADDR CODE Y02134 97800002
         DS    CL29                     RESERVED                 Y02134 97900002
         EJECT                                                          98000037
         IEFJSSOB MO,CONTIG=YES                                @G18MSBS 98050037
DASSOBAD DS    A                                               @G18MSBS 98100037
SSOBSAVE DS    10D                                             @G18MSBS 98150037
SSOBSIZE EQU   *-SSOB                                          @G18MSBS 98200037
         EJECT                                                          98250037
         IEFJESCT                                              @G18MSBS 98300037
         EJECT                                                          98350037
JCTABLE  DSECT                                                 @G18MSBS 98400037
         IEFAJCTB                                              @G18MSBS 98450037
         EJECT                                                          98500037
SCTABLE  DSECT                                                 @G18MSBS 98550037
         IEFASCTB                                              @G18MSBS 98600037
         EJECT                                                          98650037
         END   IGG0290F                                          Y02134 98700037
./  ADD  SSI=72760292,NAME=IGG0299A
         TITLE 'IGG0299A - DADSM SCRATCH - REMOVE DSCB(S)'              00010021
IGG0299A CSECT                                                          00020021
*                                                                     * 00030021
*0000003400,007200-007600,008000,009400,036600,084700,093200-    A37199 00037021
*0000093600                                                      A37199 00044021
*          RELEASE 21.7 DELETIONS                                       00046002
*0000000520-000620,079240-080800,089000,090200                 SA56400  00048002
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00049002
*0000001000,003800,005200-005400,006800,008000-008200,009700,    Y02080 00049102
*0000014570,014780,015600,016000,022200,041200,041720,042000,    Y02080 00049202
*0000045200-046000,048200,049800,050600,051200,051500,051900,    Y02080 00049302
*0000054200,055800,076400,079120,080700-093400,094000            Y02080 00049402
*0000006400,008600-009200,043400,057600-057800,093500-094000     Y02078 00049502
*0000050800                                                      Y02082 00049602
*          VS2 RELEASE 03 DELETIONS/CHANGES                    @ZM30032 00050003
*0000                                                          @Y30LSTG 00055003
*          VS2 SU32 DELETIONS/CHANGES                          @G32DSFS 00058037
*D028188-028196,                                               @G32DSFS 00061037
*          VS2 RELEASE 037 CHANGES                                      00064037
*A015183,A036300-036310,C036315                                @ZA16029 00064537
*                                                              @G60ASBJ 00065060
*          VS2 SU60 DELETIONS/CHANGES                          @G60ASBJ 00065160
*                                                              @G60ASBJ 00065260
*A 006520,015121-015122,021200-021830,022240-022560            @G60ASBJ 00065360
*C 022040                                                      @G60ASBJ 00065460
*                                                              @G60ASBJ 00065560
* MODULE NAME - IGG0299A                                                00066002
*                                                                       00067002
* DESCRIPTIVE NAME - DADSM SCRATCH - REMOVE DSCB(S)                     00068002
*                                                                       00069002
* COPYRIGHT - NONE                                                      00070002
*                                                                       00071002
* CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD          00071202
*                                                                       00071402
* STATUS CHANGE LEVEL 001                                               00072021
*                                                                       00080021
*ATTRIBUTES - REENTRANT                                                 00100002
*                                                                       00120021
*FUNCTION - THE MODULE EXTRACTS THE EXTENTS FROM THE FORMAT 1 OR 3 DSCB 00150021
*           RECORDS.  THESE EXTENTS ARE THEN CONVERTED FROM CCHHCCHH TO 00180021
*           BEGINNING RTA AND ENDING RTA+1, AND ARE STORED IN A TABLE   00210021
*           IN THE WORKAREA.  THE FORMAT 1, 2, AND 3 DSCB RECORDS IN    00240021
*           THE VTOC ARE ZEROED OUT.  IF THE DATA SET TO BE    @Y30LSTG 00270003
*           SCRATCHED RESIDES ON A VIRTUAL MSS  VOLUME, THIS   @Y30LSTG 00275003
*           MODULE WILL SET UP THE PARAMETER LIST WHICH WILL   @Y30LSTG 00280003
*           LATER BE USED IN IGG0290D TO RELINQUISH THE DASD   @Y30LSTG 00285003
*           SPACE.                                             @Y30LSTG 00290003
*           THE RAC DEFINITIONS ARE DELETED FOR RAC DEFINED    @Z40RSGD 00297537
*           DATA SETS (RACDEF).                                @Z40RSGD 00305037
*                                                                       00312537
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG0299A.  ENTRY IS   00320021
*          MADE FROM THE FOURTH LOAD OF SCRATCH - IGG0290A.             00340021
*                                                                       00360021
*                                                                       00400021
*SUPERVISOR CALLS AND MACROS. THE FOLLOWING ARE SUPERVISOR CALLS        00420021
*          ISSUED IN THE MACRO EXPANSIONS:                              00440021
*                    EXCP(0) READ FROM OR WRITE TO DIRECT ACCESS DEVICE 00460021
*                    WAIT(1) WAIT ON EVENT CONTROL BLOCK                00480021
*                                                                       00500021
*                                                                       00580021
*OTHER MACROS USED                                                      00600021
*                    IECSDSL1 - ENABLES SYMBOLIC ADDRESSING OF DSCBS    00620021
*                    IECSCRWA - SCRATCH WORK AREA EXPANSION             00630002
*                    IECDSECS - EXPANDS THE CVT, RB, AND TCB DSECTS     00640002
*                    IECRES - GET CORE FOR RIDDING DASD SPACE  @Y30LSTG 00645003
*                                                                       00660021
*INPUT - AT ENTRY TO THIS MODULE REGISTER 13 POINTS TO THE WORKAREA     00670021
*        AND REGISTER 9 POINTS TO THE CVT.                              00680002
*                                                                       00700021
*OUTPUT - THE FORMAT 1, 2, AND 3 DSCB'S FOR THE DATA SET ARE ZEROED     00710021
*          OUT. WHEN CONTROL IS TRANSFERRED TO THE NEXT LOAD, MODULE    00720021
*          IGG0290B, REGISTER 13 POINTS TO THE WORK AREA. THE DADSM     00730021
*          TABLE IN THE WORK AREA CONTAINS THE EXTENTS OF THE DATA SET. 00740021
*                                                                       00780021
*STORAGE - PROGRAM CODE CSECT = LESS THAN 1024 BYTES                    00800002
*          WORK AREA = 900 BYTES                               @Y30LSTG 00820003
*          RPS WORK AREA = 128 BYTES                                    00830002
*                                                                       00840021
*ERROR CONDITIONS - PERMANENT I/O ERROR                                 00860002
*         - ERROR IN RACDEF                                   @Z40RSGD  00910037
*                                                                       00930021
*                                                                       00960021
*NOTES - THIS MODULE WAS SPLIT IN RELEASE 21.  THE FIRST HALF IS        00965021
*        MODULE IGG0290A.  AFTER THE REWRITE OF THE FORMAT 4 DSCB       00970002
*        (UNLIKE THE ALLOCATE, EXTEND, AND PARTIAL RELEASE FUNCTIONS    00971002
*        OF DADSM), IF THE DIRF BIT IS SET IN THE FORMAT 4 DSCB IN      00972002
*        THE SCRATCH WORK AREA, THIS INDICATES THAT THE DIRF BIT        00973002
*        WAS PREVIOUSLY SET IN THE FORMAT 4 DSCB.                       00974002
*                                                                       00975021
*REGISTER USAGE                                                         00980021
R0       EQU   0                                                        01000021
R1       EQU   1                                                        01020021
R2       EQU   2                                                        01040021
R3       EQU   3                                                        01060021
EXTCTR   EQU   4                                                        01120021
R5       EQU   5                                                        01140021
R6       EQU   6                                                        01180021
INDEX1   EQU   6                                                        01200021
INDEX2   EQU   7                                                        01220021
R7       EQU   7                                                        01240021
R8       EQU   8                                                        01260021
VOLISTX  EQU   8                                                        01280021
RCVT     EQU   9                                                        01300021
R10      EQU   10                                                       01340021
R11      EQU   11                                                       01360021
RBASE    EQU   12                                                       01380021
RWKAREA  EQU   13                                                       01400021
RETURN   EQU   14                                                       01420021
WORKREG  EQU   15                                                       01440021
*                                                                       01442021
* OTHER EQUATES                                                         01444021
*                                                                       01446021
DIRFBIT  EQU   X'04'                    VTOC INTERRUPT BIT       O19117 01450021
DOSBIT   EQU   X'80'                    DOS BIT IN F4                   01464021
NOCC     EQU   X'00'                    SUPPRESS COMMAND CHAIN.         01471021
WRITE    EQU   X'05'                    WRITE DATA COMMAND              01485021
D4       EQU   4                        DISPLACEMENT OF 4               01492021
K16      EQU   16                       CONSTANT                        01499021
L90      EQU   90                       LENGTH OF 90                    01506021
K2       EQU   2                        CONSTANT OF 2            Y02080 01508002
K3       EQU   3                        CONSTANT OF 3            Y02080 01509002
CCHHL    EQU   4                        LENGTH OF CCHH           Y02080 01510002
K6       EQU   6                        CONSTANT OF 6            Y02080 01511002
K12      EQU   12                       CONSTANT OF 12           Y02080 01512002
RACPASS  EQU   X'40'                    BYPASS RACDEF -        @G60ASBJX01512160
                                        CAMLST SWITCH          @G60ASBJ 01512260
DS1RACDF EQU   X'40'                    DS1DSIND-RAC DEFINED   @Z40RSGD 01512437
RACERR08 EQU   8                        NOT-RAC DEFINED        @Z40RSGD 01512837
RACERR09 EQU   9                        DATA SET ASSOCIATED    @Z40RSGD 01512937
*                                       WITH OTHER RAC         @Z40RSGD 01513037
*                                       ENTITIES               @Z40RSGD 01513237
ZERO     EQU   0                        QUANTITY OF ZERO       @Y30LSTG 01515637
D0       EQU   0                        DISPLACEMENT OF ZERO   @Y30LSTG 01515837
D1       EQU   1                        DISPLACEMENT OF ONE    @Y30LSTG 01516037
D2       EQU   2                        DISPLACEMENT OF TWO    @Y30LSTG 01516237
D3       EQU   3                        DISPLACEMENT OF THREE  @Y30LSTG 01516437
D6       EQU   6                        DISPLACEMENT OF SIX    @Y30LSTG 01516637
D7       EQU   7                        DISPLACEMENT OF SEVEN  @Y30LSTG 01516837
D8       EQU   8                        DISPLACEMENT OF EIGHT  @Y30LSTG 01517037
D10      EQU   10                       DISPLACEMENT OF TEN    @Y30LSTG 01517237
D28      EQU   28                       TWENTY-EIGHT           @Y30LSTG 01517437
L1       EQU   1                        LENGTH OF ONE          @Y30LSTG 01517637
L2       EQU   2                        LENGTH OF TWO          @Y30LSTG 01517837
LABELS   EQU   X'40'                    MASK FOR USER LABELS   @Y30LSTG 01518037
VIRTDASD EQU   X'08'                    MASK FOR VIRTUAL DASD  @Y30LSTG 01518237
RECROUND EQU   X'41'                    RECORD ROUND OPTION    @ZA16029 01518337
CYL      EQU   X'C0'                    CYL ALLOC COMPARATOR   @Y30LSTG 01518437
RELINQ   EQU   X'04'                    RELINQUISH OP CODE     @Y30LSTG 01518637
ISAMDS   EQU   X'80'                    ISAM INDICATOR         @Y30LSTG 01518837
SPLTCYL  EQU   X'80'                    SPLIT CYLINDERS IND    @Y30LSTG 01519037
ACQPLN   EQU   96                       LENGTH OF PARM LIST    @Y30LSTG 01519237
UCBPTR   EQU   32                       POINTER TO UCB IN DEB  @Y30LSTG 01519437
*                                                              @Y30LSTG 01519637
*                                                                       01526637
STATUS   EQU   11                       OFFSET TO ERROR FLAG   @Z40RSGD 01528637
         BALR  RBASE,R0                                                 01533337
         USING BEGIN,RBASE                                              01540021
         USING SCRTHWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 01560002
         USING CVT,RCVT                                                 01580021
*                                                                       01604021
* THIS SECTION SETS UP TO ADD THE EXTENTS IN THE FORMAT 1 DSCB          01608021
* TO THE DADSM TABLE.                                                   01612021
*                                                                       01616021
BEGIN    EQU   *                                                        01620021
* IF DATASET IS RAC-DEFINED DELETE DEFINITION BEFORE           @Z40RSGD 01670037
* UPDATING DSCBS.                                              @Z40RSGD 01720037
*                                                              @Z40RSGD 01770037
         TM    DS1DSIND,DS1RACDF        IS IT RAC DEFINED      @Z40RSGD 01820037
         BZ    BEGIN2                   NO-CONTINUE            @Z40RSGD 01870037
         L     R1,TCBADDR               LOCATE TCB             @Z40RSGD 01920037
         USING TCB,R1                                          @Z40RSGD 01970037
         L     R1,TCBJSCB               LOCATE JSCB            @Z40RSGD 02020037
         USING IEZJSCB,R1                                      @Z40RSGD 02070037
         L     R1,JSCBACT               GET ACTIVE JSCB        @G32DSPD 02090037
*************************************************************  @G60ASBJ 02120060
*                                                           *  @G60ASBJ 02127060
*  THE RACDEF WILL BE BYPASSED IF THE FOLLOWING CONDITIONS  *  @G60ASBJ 02134060
*  ARE MET:                                                 *  @G60ASBJ 02141060
*           (1) THE CALLER IS AUTHORIZED.                   *  @G60ASBJ 02148060
*           (2) JSCBPASS BIT IS SET TO 1.                   *  @G60ASBJ 02155060
*           (3) THE SECOND BIT OF THE SECOND BYTE OF THE    *  @G60ASBJ 02162060
*               SCRATCH (CAMLST) PARAMETER LIST IS 1.       *  @G60ASBJ 02169060
*                                                           *  @G60ASBJ 02176060
*************************************************************  @G60ASBJ 02183060
         TM    JSCBSWT1,JSCBPASS        IS RAC PROCESSING TO   @Z40RSGD 02190060
*                                       BE BYPASSED            @Z40RSGD 02197060
         BNO   BEGIN1                   NO - DON'T BYPASS      @G60ASBJ 02204060
*                                                              @G60ASBJ 02224060
* TEST CAMLST PARAMETER LIST BYTE 1 BIT 1.                     @G60ASBJ 02228060
* IF SET TO 1, BYPASS THE RACDEF.                              @G60ASBJ 02232060
*                                                              @G60ASBJ 02236060
         L     R1,OLDPLPTR              GET PARAMETER LIST     @G60ASBJX02240060
                                        POINTER                @G60ASBJ 02244060
         TM    D1(R1),RACPASS           BYPASS RACDEF ?        @G60ASBJ 02248060
         BO    BEGIN2                   YES, BYPASS RACDEF     @G60ASBJ 02252060
BEGIN1   DS    0H                       CONTINUE WITH DELETE   @G60ASBJ 02256060
* DELETE DEFINITION                                            @Z40RSGD 02270037
         MVC   RACDEF(LRACDEF),MRACDEF  SET UP PARM LIST       @Z40RSGD 02320037
         RACDEF ENTITY=PDSNAME,                                @Z40RSGDX02370037
               VOLSER=PVOLSER,                                 @Z40RSGDX02420037
               DSTYPE=N,                                       @Z40RSGDX02470037
               MF=(E,RACDEF)                                   @Z40RSGD 02520037
         LTR   WORKREG,WORKREG          TEST RACDEF COMPLETION @Z40RSGD 02810037
         BZ    BEGIN2 STATUS            OK-CONTINUE            @Z40RSGD 02812037
* PROFILE DELETE FAILED,BUT SCRATCH ANYWAY IF USER HAS ALTER   @G32DSPD 02812237
* AUTHORIZATION FOR THE VOLUME                                 @G32DSPD 02812437
         TM    SISW1,VOLRACHK           USER HAS VOLUME ACCESS @G32DSPD 02812637
         BO    BEGIN2                   YES,OK-CONTINUE        @G32DSPD 02813237
         L     R1,TCBADDR               TCB ADDRESSABILITY     @Z40RSGD 02814037
         USING TCB,R1                                          @Z40RSGD 02816037
         MODESET EXTKEY=RBT234,WORKREG=2  RESET KEY            @Z40RSGD 02818037
         DROP  R1                                              @Z40RSGD 02818137
         MVI   11(VOLISTX),RACERR08     ASSUME RETURN CODE 4   @Z40RSGD 02818437
         B     SETCODE2                 ERROR-TERMINATE        @Z40RSGD 02819737
BEGIN2   EQU   *                        CONTINUE               @Z40RSGD 02819837
         TM    DADSMTBL,DOSPACK         TEST FOR DOS PACK               02820021
         BO    MOVECCW                 BR IF YES.                       03460021
BLDTAB   MVC   INDSCB+4(30),DS1EXT1     SET UP BOUNDARIES               03480021
         LA    INDEX2,ENTRIES           LOAD DADSM TABLE INDEX          03500021
         SR    EXTCTR,EXTCTR                                            03520021
         IC    EXTCTR,DS1NOEPV         PICK UP NO. OF EXTENTS.          03540021
         CH    EXTCTR,SIXTEEN           MORE THAN 16 EXTENTS            03540421
         BNH   GOON                     IF NO, CONTINUE                 03540821
         OI    DS4VTOCI,DOSBIT          IF YES, SET DOS BIT, F4         03541221
         LA    EXTCTR,K16               16 TO NO. OF EXTS CNTR          03541621
         MVI   CCW3,WRITE               SET CCW TO WRITE F4             03542021
         MVI   CCW3+D4,NOCC             SUPPRESS COMMAND CHAIN.         03542421
         BAL   RETURN,EXCPIO            GO WT F4 WITH DOS BIT ON        03542821
GOON     EQU   *                                                        03543221
         CLI   DS1EXT1,X'40'   USER LABELS                        22833 03544021
         BNE   NOUSER           NO,                               22833 03548021
         LA    EXTCTR,1(EXTCTR) YES, INCR EXT CNT+1 FOR INTRNL USE22833 03552021
NOUSER   EQU   *                                                  22833 03556021
         STC   EXTCTR,EXTNUM           SAVE FOR LATER.                  03560021
         CLI   EXTNUM,3                CHECK THEIR NUMBER.              03580021
         BNH   ONLYF1                  BRIF ONLY F1 DSCB.               03600021
         LA    EXTCTR,3                SET LIMIT FOR EXT CONVERT.       03620021
ONLYF1   EQU   *                                               @Y30LSTG 03621003
*                                                              @Y30LSTG 03622003
* THIS SECTION GETS CORE FOR A PARAMETER LIST, ASSUMING ONE    @Y30LSTG 03623003
* DOESN'T ALREADY EXIST, TO BE USED LATER BY THE ICBACREL MACRO@Y30LSTG 03624003
* THIS IS DONE ONLY IF THE DATA SET TO BE SCRATCHED IS ON MSS  @Y30LSTG 03625003
* VIRTUAL DASD.                                                @Y30LSTG 03625203
*                                                              @Y30LSTG 03625403
         L     R1,WKADEB+UCBPTR        POINT TO UCB            @Y30LSTG 03626003
         USING UCB,R1                  ESTABLISH ADDRESSABILITY@Y30LSTG 03627003
         TM    UCBTBYT2,VIRTDASD       VIRTUAL DASD            @Y30LSTG 03628003
         BNO   NOVIRTD                 NO, DONT DO ANYTHING    @ZM30032 03629003
         TM    DS1SCALO,CYL            CYL ALLOCATIONS         @Y30LSTG 03629503
         BO    TEST2                   YES,GO TO NEXT CHECK    @ZA16029 03630037
         TM    DS1SCALO,RECROUND       RECORD ROUND OPTION?    @ZA16029 03630537
         BNO   NOVIRTD                 NO,DON'T RELINQUISH     @ZA16029 03631037
TEST2    CLI   DS1EXT1,SPLTCYL         SPLIT CYLINDERS?        @Y30LSTG 03631537
         BE    NOVIRTD                 YES, DONT DO ANYTHING   @Y30LSTG 03632103
         CLI   DS1NOEPV,ZERO           ANY EXTENTS             @Y30LSTG 03635003
         BE    NOVIRTD                 NO, BRANCH OUT          @ZM30032 03636703
         TM    DS1DSORG,ISAMDS         IS IT ISAM DATA SET     @Y30LSTG 03638403
         BO    NOVIRTD                 YES, DON'T REQINQUISH   @Y30LSTG 03640103
         L     R1,RELQADR              GET ADDR OF PARM LIST   @Y30LSTG 03641803
         LTR   R1,R1                   FROM PREV. VOL.         @Y30LSTG 03643503
         BNZ   VIRTD                   YES, DONT NEED ANOTHER  @ZM30032 03645203
         IECRES GET,EXTPR=(RWKAREA),ID=SCWA,LV=ACQPLN,         @Y30LSTG.03646903
               STM=(R2,RETURN,IECREGSV+K12)                    @Y30LSTG 03648603
         ST    R1,RELQADR              SAVE ADDRESS OF AREA    @Y30LSTG 03650303
         MODESET EXTKEY=ZERO            RE-ESTABLISH KEY ZERO  @Y30LSTG 03652003
*                                                              @Y30LSTG 03653703
* THIS SECTION FILLS THE PARM LIST FROM THE FORMAT 1 DSCB      @Y30LSTG 03655403
* WHEN THE DATA SET RESIDES ON MSS  VIRTUAL DASD.              @Y30LSTG 03657103
*                                                              @Y30LSTG 03658803
VIRTD    EQU   *                                               @Y30LSTG 03660503
         MVC   D7(L1,R1),DS1NOEPV      PUT IN # OF EXTENTS     @Y30LSTG 03662203
         MVI   D4(R1),RELINQ           MOVE IN OP CODE         @Y30LSTG 03663903
         MVI   D3(R1),ACQPLN           MOVE IN LENGTH          @Y30LSTG 03665603
         LA    R10,D28(,R1)            POINT TO START OF EXTS. @Y30LSTG 03667303
         LA    R6,INDSCB+D4            POINT TO 1ST DSCB EXT   @Y30LSTG 03669003
         LR    R5,EXTCTR               GET # EXTENTS IN DSCB   @Y30LSTG 03670703
         CLI   DS1EXT1,LABELS          ARE THERE USER LABELS   @Y30LSTG 03672403
         BNE   NOLABELS                NO, EVERYTHING ALL SET  @Y30LSTG 03674103
         BCTR  R5,R0                   YES, CANNOT FREE IT     @Y30LSTG 03675803
         LA    R6,D10(,R6)             SKIP OVER LABEL EXTENT  @Y30LSTG 03677503
NOLABELS EQU   *                                               @Y30LSTG 03679203
         STC   R5,D0(,R1)              SAVE NUM EXTS -THIS DSCB@Y30LSTG 03680903
         BAL   RETURN,EXTBUILD         GO FILL THE EXTENTS     @Y30LSTG 03682603
NOVIRTD  EQU   *                                               @Y30LSTG 03684303
*                                                              @Y30LSTG 03686003
         BAL   RETURN,CVTEXTS          CONVERT CCHH'S TO RTA'S.         03687703
*                                                                       03689403
* THIS SECTION WRITES BACK THE FORMAT 4 DSCB, IF NECESSARY.             03691103
*                                                                       03692803
MOVECCW  EQU   *                                                 O19117 03694503
         XI    DS4VTOCI,DIRFBIT         SET/RESET DIRF BIT       O19117 03696203
         TM    DS4VTOCI,DIRFBIT         TEST RESULTS             O19117 03697903
         BZ    SKPWR                    BR IF PREVIOUS INTERRUPT O19117 03699603
         MVI   CCW3,X'05'               SET WR DATA CMMD         O19117 03701303
         MVI   CCW3+4,X'00'             RESET CMMD CHAIN         O19117 03703003
         BAL   RETURN,EXCPIO            GO WRITE BACK F4         O19117 03704703
*                                                                       03706403
* THIS SECTION MODIFIES THE CHANNEL PROGRAM TO READ AND WRITE DSCB'S.   03708103
*                                                                       03709803
SKPWR    EQU   *                                                 O19117 03711503
         XI    DS4VTOCI,DIRFBIT         RESET/SET DIRF BIT       O19117 03713203
         EX    0,ISAMDSCB               STORE CONT PNTR          O19117 03714903
         MVC   CCW9(8),CCW1             STORE CCW9               O19117 03716603
         MVC   CCW5(8),CCW10       STORE CCW5                           03718303
         L     R1,CCW10                                                 03720021
         LA    WORKREG,CCW9-CCW4                                        03740021
         AR    R1,WORKREG               RESOLVE ADDR IN CCW10           03760021
         ST    R1,CCW10            STORE CCW10                          03780021
         L     R1,CCW1                                                  03800021
         LA    WORKREG,5                                                03820021
         AR    R1,WORKREG               RESOLVE ADDR IN CCW1            03840021
         ST    R1,CCW1             STORE CCW1                           03860021
         MVC   CCW4(8),CCW1        STORE CCW4                           03880021
         LM    R0,R5,CHANLPRG      LOAD CCW CONSTANTS                   03900021
         AR    R0,RWKAREA          RESOLVE ADDR IN CCW6                 03920021
         AR    R2,RWKAREA          RESOLVE ADDR IN CCW7                 03940021
         STM   R0,R5,CCW6               STORE CCW6 TO CCW8              03960021
         STM   R0,R1,CCW11              SET UP CCW11                    03980021
         MVI   CCW11+4,X'00'            STORE CCW11                     04000021
         LA    R0,SEEK                 M OF SEEK ADDR MUST BE ZERO.     04020021
         LA    R1,1                                                     04040021
         STM   R0,R1,CCW3               SET UP CCW3                     04060021
         MVI   CCW3,X'0D'                                               04080021
         MVI   CCW3+4,X'60'             STORE CCW3                      04100021
*                                                                       04110037
TESTPTR  TM    INCCHHR+4,X'FF'          TEST  CONT POINTER              04163237
         BZ    LASTDSCB                                                 04167837
*                                                                       04172437
* THIS SECTION WRITES A FORMAT 0 DSCB OVER A FORMAT 1, FORMAT 2,        04177037
* OR FORMAT 3 DSCB OR READS THE FIRST FORMAT 5 OR FORMAT 6 DSCB         04181637
* BEFORE BRANCHING TO THE NEXT LOAD OF SCRATCH - IGG0290B.              04186237
*                                                                       04190837
ZEROUT   MVI   OUTDSCB,X'00'            ZERO FIRST BYTE OF OUTPUT DSCB  04195437
         MVC   INLINESK+K2(CCHHL),INCCHHR  SET UP SEEK ADDRESS   Y02080 04200002
         MVC   SEEK+3(5),OUTCCHHR      SET UP SEEK FOR IOS.             04220021
         BAL   RETURN,EXCPIO            ZERO DSCB.                      04240021
         LH    WORKREG,DADSMTBL+2       LOAD COUNT OF DSCBS             04260021
         LA    WORKREG,1(WORKREG)       INCREMENT DSCB COUNTER          04280021
         STH   WORKREG,DADSMTBL+2       STORE COUNT OF DSCBS            04300021
         CLI   DS3FMTID,X'F2'           TEST FOR F2 DSCB OR LESS M4504  04320021
         BL    IOERROR                  BRANCH IF LESS THAN F2   Y02078 04340002
         MVC   OUTCCHHR(5),INCCHHR      STORE INPUT DSCB CCHHR   M4504  04360021
         BE    ISAMDSCB                 BR IF F2                 M4504  04380021
         CLI   DS3FMTID,X'F3'           TEST FOR F3 DSCB         M4504  04400021
         BE    MOREXTS                  BR IF F3                 M4504  04420021
FINISH   EQU   *                                                        04460021
         NI    DADSMTBL,X'EF'           TURN OFF NO VOLUME MOUNTED BIT  04480021
         LA    R2,LOAD3                 POINT TO PROPER ID.             04500021
XCTLEXIT EQU   *                        EXIT TO NEXT LOAD        Y02080 04520002
         IECRES LOAD,EXTPR=(RWKAREA),MODID=(R2),BRANCH=DIRECT    Y02080 04540002
*                                                                       04608021
* THIS SECTION SETS UP TO ADD THE EXTENTS IN THE FORMAT 3 DSCB          04616021
* TO THE DADSM TABLE.  IF THE DATA SET RESIDES ON MSS  VIRTUAL @Y30LSTG 04624003
* DASD, THIS ROUTINE ALSO COMPLETES THE PARAMETER LIST FOR     @Y30LSTG 04629003
* RELINQUISHING THE REAL DASD SPACE.                           @Y30LSTG 04630003
*                                                                       04632021
MOREXTS  MVC   DS3FMTID(L90),DS3ADEXT   SET UP BOUNDARIES               04640021
*                                                              @Y30LSTG 04641003
         L     R1,RELQADR               GET ADDR OF PARAM LIST @Y30LSTG 04642003
         LTR   R1,R1                    IS THERE ONE           @Y30LSTG 04643003
         BZ    SETCTRS                  NO, BRANCH OUT         @ZM30032 04644003
         CLI   D4(R1),RELINQ            VALID PARM LIST        @Y30LSTG 04645003
         BNE   SETCTRS                  NO, BRANCH OUT         @ZM30032 04646003
         SR    R6,R6                    ZERO A WORK REG        @Y30LSTG 04647003
         LR    R5,R6                    ZERO ANOTHER           @Y30LSTG 04648003
         IC    R6,D0(,R1)               GET # EXT IN F1        @Y30LSTG 04649003
         IC    R5,D7(,R1)               GET TOTAL # EXTENTS    @Y30LSTG 04651003
         SR    R5,R6                    GET # EXTS IN F3       @Y30LSTG 04652003
         LA    R6,INDSCB+D4             POINT TO DSCB ENTRIES  @Y30LSTG 04653003
         L     R10,D8(,R1)              POINT TO WHERE LEFT OFF@Y30LSTG 04654003
         LA    RETURN,SETCTRS           SET UP RETURN REG      @Y30LSTG 04655003
*                                                              @Y30LSTG 04656003
* THIS SECTION FILLS IN THE EXTENT ENTRIES FROM F1 AND F3 DSCBS@Y30LSTG 04657003
* INTO THE RELINQUISH PARAMETER LIST TO BE USED IN IGG0290D.   @Y30LSTG 04657203
*                                                              @Y30LSTG 04658003
EXTBUILD EQU   *                                               @Y30LSTG 04659003
         MVC   D0(L2,R10),D2(R6)        MOVE IN LOW CC         @Y30LSTG 04660003
         MVC   D2(L2,R10),D6(R6)        MOVE IN HIGH CC        @Y30LSTG 04661003
         LA    R10,D4(R10)              INCR TO NEXT PARM ENTRY@Y30LSTG 04662003
         LA    R6,D10(R6)               TO NEXT DSCB ENTRY     @Y30LSTG 04663003
         BCT   R5,EXTBUILD              GO BACK FOR MORE EXTS  @Y30LSTG 04664003
         ST    R10,D8(R1)               SAVE PTR TO NEXT       @Y30LSTG 04665003
         BR    RETURN                   RETURN TO CALLING RTINE@Y30LSTG 04665503
SETCTRS  EQU   *                                               @Y30LSTG 04666003
*                                                              @Y30LSTG 04667003
         LA    INDEX2,ENTRIES+12        LOAD DADSM TABLE INDEX          04680021
         SR    EXTCTR,EXTCTR                                            04700021
         IC    EXTCTR,EXTNUM           GET TOTAL NO. OF EXTENTS.        04720021
         SH    EXTCTR,THREE            NUMBER OF EXTENTS IN F3 DSCB.    04740021
         BAL   RETURN,CVTEXTS                                           04760021
         B     ISAMDSCB                 THIS BR WAS INSERTED TO         04764021
*                                        FACILITATE SCRATCHING A DATA   04768021
*                                        SET OF MORE THAN 16 EXTENTS.   04772021
*                                        IT CAUSES A RETURN TO READ AND 04776021
*                                        PROCESS THE NEXT FMT 3 DSCB.   04780021
*                                                                       04780821
* THIS SECTION INITIALIZES THE POINTERS NEEDED TO READ THE FIRST        04781621
* FORMAT 5 OR FORMAT 6 DSCB.                                            04782421
*                                                                       04783221
LASTDSCB TM    DS4VTOCI,DOSBIT          TEST FOR SPECIAL SUPPORT        04784021
         BO    NOSHRCYL                 PACK AND BRANCH IF YES          04788021
         TM    DADSMTBL,SHRCYL          TEST FOR SHARED CYLS            04792021
         BZ    NOSHRCYL                                                 04800021
         MVC   INCCHHR,DS4F6PTR         SET UP ADDR OF F6 DSCB   Y02080 04820002
         B     ZEROUT                                                   04840021
ISAMDSCB MVC   INCCHHR(5),DS3PTRDS      STORE CONT POINTER              04860021
         B     TESTPTR                                                  04880021
NOSHRCYL EQU   *                                                        04900021
         MVC   INCCHHR(5),DADSMADR      GET DADSM CCHHR.                04920021
         B     ZEROUT                                                   04940021
*                                                                       04944021
* THIS SECTION CONVERTS THE EXTENTS TO RTA/RTA+1 FORMAT AND ADDS        04948021
* THEM TO THE DADSM TABLE.                                              04952021
*                                                                       04956021
CVTEXTS  LA    INDEX1,INDSCB+4          LOAD EXTENTS INDEX              04960021
         XC    FIELD1,FIELD1            CLEAR CONVERSION AREA    Y02080 04980002
         LTR   EXTCTR,EXTCTR           TEST EXTENT COUNTER.             05000021
         BCR   13,RETURN               BR IF NO EXTENTS.                05020021
         LR    R5,RWKAREA               SAVE WORK AREA POINTER.         05040021
         STM   RCVT,R3,IECREGSV+K12     SAVE REGISTERS 9 - 3     Y02080 05060002
         LA    R1,WKADEB                POINTER TO DEB           Y02082 05080002
         LA    R2,FIELD1                POINT TO CONVERSION AREA Y02080 05120002
FIRSTCVT EQU   *                                                 A31333 05130021
         LA    R3,2                     SET LOOP CONTROL         A31333 05140021
         MVC   FIELD1+K3(CCHHL),K2(R6)  INSERT CCHH TO CONVERT   Y02080 05150002
CVTLOOP  L     WORKREG,CVTPRLTV        GET ENTRY TO THE CONVERT RTNE.   05160021
         BALR  RETURN,WORKREG           CONVERT CCHH TO TTR0.           05180021
         LM    RCVT,RWKAREA,IECREGSV+K12-SCRTHWKA(R5)  RESTORE   Y02080 05190002
*                                       REGS                     A31333 05200021
         SRA   R3,1                     DECREMENT LOOP COUNTER   A31333 05210021
         SRL   R0,16                    GET TT. TT = RTA.               05220021
         CLI   0(R6),X'80'             IS THIS A SHARED CYLINDER EXT.   05360021
         BE    SHAREXTS                 BRANCHIF SHARED CYLINDER        05380021
         LTR   R3,R3                    WAS UPPER CCHH CONVERTED A31333 05390021
         BZ    CONT                     BRANCH IF YES            A31333 05400021
         STH   R0,0(INDEX2)             STORE LOWER RTA          A31333 05410021
         MVC   FIELD1+K3(CCHHL),K6(R6)  PICK UP HIGH CCHH        Y02080 05420002
         B     CVTLOOP                  GO CONVERT UPPER CCHH    A31333 05430021
CONT     EQU   *                                                 A31333 05440021
         LA    R11,1                                             A31333 05450021
         AR    R0,R11                   ADD 1 TO RTA             A31333 05460021
         STH   R0,2(INDEX2)             STORE UPPER RTA+1        A31333 05470021
INCRINDX LA    R6,10(R6)                UPDATE CCHH INDEX.              05520021
         LA    R7,4(R7)                 UPDATE RTA INDEX.               05540021
         BCT   EXTCTR,FIRSTCVT          BR IF ANOTHER EXTENT.           05560021
         LM    RCVT,R3,IECREGSV+K12     RESTORE REGISTERS 9 - 3  Y02080 05580002
         BR    RETURN                   RETURM.                         05600021
*                                                                       05620021
SHAREXTS OI    DADSMTBL,8              INDICATE SHARED CYL'S.           05640021
         MVI   2(INDEX2),X'FF'         INDICATE SHARED CYL EXTENTS.     05660021
         STH   R0,0(INDEX2)             STORE RTA                A31333 05680021
         B     INCRINDX                INCREMENT INDICES.               05700021
*                                                                       05785021
* THIS ROUTINE EXECUTES A CHANNEL PROGRAM.                              05790021
*                                                                       05795021
EXCPIO   EQU   *                                                        05800021
         EXCP  IOB                      EXECUTE CHANNEL PROGRAM.        05840021
         WAIT  ECB=ECB                  WAIT FOR COMPLETION.            05860021
         TM    ECB,X'20'                TEST FOR I/O ERROR.             05880021
         BCR   7,RETURN                 RETURN IF OKAY.                 05900021
IOERROR  EQU   *                        I/O ERROR                Y02078 05904002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 05908002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 05912002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 05916002
         MVI   11(VOLISTX),X'04'        SET I/O ERR IN VOL LST   M3097  05920021
SETCODE2 EQU   *                        RESET KEY              @Z40RSGD 05922037
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 05930002
         DROP  R1                                                Y02078 05940002
SETCODE  EQU   *                                                 M3097  06000021
         MVI   ERCODE+1,X'08'           SET ERROR INDICATION     M3097  06020021
         LA    R2,LOAD4                 POINT TO PROPER ID.             06060021
         B     XCTLEXIT                                                 06080021
*                                                                       06090021
*** PROGRAM CONSTANTS                                                   06100021
*                                                                       06120021
THREE    DC    H'3'                     NUMBER OF EXTENTS IN F1         06420021
SIXTEEN  DC    H'16'                    MAX NO. OF EXTENTS IF OS        06720021
RET04    DC    H'4'                     USED TO TEST RETURN    @Z40RSGD 06770037
*                                       CODE FROM RACDEF       @Z40RSGD 06820037
*                                                                       06920021
*** THE FOLLOWING CHANNEL PROGRAM WRITES A FORMAT 0 DSCB RECORD.        07220021
*** THE FIRST DADSM DSCB IS READ INTO THE INPUT AREA.                   07240021
*                                                                       07260021
CHANLPRG DS    0F                                                       07280021
*CCW1                                   TO BE CONSTRUCTED               07300021
*                                       SEARCH EQUAL ID (OUTCCHHR)      07320021
*CCW2                                   TO BE CONSTRUCTED               07340021
*                                       TIC TO CCW1                     07360021
*CCW3                                   TO BE CONSTRUCTED               07380021
*                                       WRITE KEY AND DATA (OUTDSCB)    07400021
*CCW4                                   TO BE CONSTRUCTED               07420021
*                                       SEARCH EQUAL ID (OUTCCHHR)      07440021
*CCW5                                   TO BE CONSTRUCTED               07460021
*                                       TIC TO CCW4                     07480021
*CCW6                                                                   07500021
         DC    X'0E'                   READ KEY AND DATA (INDSCB)       07520021
         DC    AL3(0+INDSCB-FIRST)                                      07540021
         DC    X'5000'                                                  07560021
         DC    H'140'                                                   07580021
*CCW7                                                                   07600021
         DC    X'07'                    SEEK                     A34916 07620021
         DC    AL3(INLINESK-FIRST)      SEEK ADDR                Y02080 07640002
         DC    X'4000'                                                  07660021
         DC    H'6'                                                     07680021
*CCW8                                                                   07700021
         DC    X'1A'                    READ HOME ADDRESS               07720021
         DC    AL3(0)                                                   07740021
         DC    X'5000'                                                  07760021
         DC    H'5'                                                     07780021
*CCW9                                   TO BE CONSTRUCTED               07800021
*                                       SEARCH EQUAL ID                 07820021
*CCW10                                  TO BE CONSTRUCTED               07840021
*                                       TIC TO CCW9                     07860021
*CCW11                                  TO BE CONSTRUCTED               07880021
*                                       READ KEY AND DATA               07900021
MRACDEF  RACDEF TYPE=DELETE,            RACDEF MASTER PARM     @Z40RSGDX07902037
               DSTYPE=N,                LIST                   @Z40RSGDX07904037
               MF=L                                            @Z40RSGD 07904437
LRACDEF  EQU   *-MRACDEF                LENGTH PARM LIST       @Z40RSGD 07904837
*                                                                       07906021
*** TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                       07912002
*                                                                       07918021
         XCTLTABL ID=(LOAD3,0B,LOAD4,0D),SVC=029,LENGTH=,BRT=YES Y02080 08070002
         SPACE 2                                                 Y02078 08080002
         IECDSECS CVT,RB,TCB,JSCB,UCB,EXPAND=YES CVT, RB, JSCB @Z40RSGD 08082037
*                                       AND TCB                @Z40RSGD 08082437
*                                       UCB DSECTS.            @Y30LSTG 08085503
WORKAREA IECSCRWA EP,F4,D1=(1,3)        SCRATCH WORK AREA        Y02080 08090002
RACDEF   EQU   SCRTHWKA                 RACDEF PARAMETER LIST  @Z40RSGD 08140037
         END                                                            09420021
./  ADD  SSI=72590415,NAME=IGG030DU
         TITLE 'IGG030DU - DADSM RENAME DUMMY MODULE ENTRY POINT'       00050060
IGG030DU CSECT                                                          00100060
**********************************************************************  00150060
*                                                                    *  00200060
* STATUS CHANGE LEVEL 000                                            *  00250060
*                                                                    *  00300060
*MODULE NAME - IGG030DU                                              *  00350060
*                                                                    *  00400060
*DESCRIPTIVE NAME - DADSM RENAME DUMMY MODULE.                       *  00450060
*                                                                    *  00500060
*COPYRIGHT - NONE                                                    *  00550060
*                                                                    *  00600060
*CHANGE ACTIVITY -                                                   *  00650060
*          VS2-3.7  MODULE NEW FOR SU60                        @G60ASBJ 00700060
*                                                                    *  00750060
*ATTRIBUTES - REENTRANT                                              *  00800060
*                                                                    *  00850060
*FUNCTION - THIS MODULE IS THE ENTRY POINT TO RENAME  (SVC 30).      *  00900060
*          IT IS A DUMMY CSECT WHICH IMMEDIATELY PASSES CONTROL TO   *  00950060
*          RENAME MODULE IGC00030 WITHOUT CHANGING ANY REGISTERS     *  01000060
*          EXCEPT REGISTER 15.                                       *  01050060
*                                                                    *  01100060
*          THIS CSECT MAY BE REPLACED BY A USER WRITTEN ROUTINE      *  01150060
*          IF DESIRED TO PERFORM PROCESSING BEFORE OR AFTER THE      *  01200060
*          SYSTEM RENAME ROUTINES RECEIVE CONTROL.                   *  01250060
*                                                                    *  01300060
*          ANY USER WRITTEN ROUTINE WHICH REPLACES THIS CSECT MUST   *  01350060
*          BE RE-ENTRANT AND PASS CONTROL TO THE FIRST RENAME        *  01400060
*          MODULE IGC00030 WITH THE REGISTER CONTENTS CONFORMING     *  01450060
*          TO STANDARD SVC ROUTINE CONVENTIONS. REGISTER 1 MUST      *  01500060
*          CONTAIN THE ADDRESS OF A RENAME PARAMETER LIST WITH THE   *  01550060
*          SAVE FORMAT AS SHOWN BELOW UNDER INPUT.                   *  01600060
*                                                                    *  01650060
*          IF THE USER WRITTEN ROUTINE NEEDS TO SAVE REGISTERS,      *  01700060
*          IT MUST PROVIDE A RE-ENTRANT SAVE AREA TO SAVE AND        *  01750060
*          RESTORE ITS REGISTERS.  THE SVRB SAVE AREA SHOULD NOT     *  01800060
*          BE USED SINCE IT IS USED BY THE RENAME ROUTINES.          *  01850060
*                                                                    *  01900060
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG030DU. ENTRY IS *  01950060
*          MADE BY ISSUING AN SVC 30.                                *  02000060
*                                                                    *  02050060
*SUPERVISOR CALLS AND EXTERNAL ROUTINES USED BY THIS MODULE - NONE   *  02100060
*                                                                    *  02150060
*OTHER MACROS USED: NONE                                             *  02200060
*                                                                    *  02250060
*INPUT -   AT ENTRY TO THIS MODULE, REGISTER 1 POINTS TO THE         *  02300060
*          PARAMETER LIST. REGISTER 0 MAY OR MAY NOT CONTAIN A UCB   *  02350060
*          ADDRESS. THE PARAMETER LIST CONSISTS OF FOUR WORDS:       *  02400060
*                                                                    *  02450060
*                    WORD 1 - RENAME = X'41002000'                   *  02500060
*                                                                    *  02550060
*                             IF THE SECOND BIT OF THE SECOND BYTE   *  02600060
*                             IS SET TO 1 AND IF (1) THE CALLER IS   *  02650060
*                             AUTHORIZED AND (2) RACF IS ACTIVE IN   *  02700060
*                             THE SYSTEM AND (3) THE JSCBPASS BIT    *  02750060
*                             IN THE JSCB IS SET TO ONE, THEN THE    *  02800060
*                             RACDEF IN RENAME MODULE IGG03001 WILL  *  02850060
*                             WILL BE BYPASSED.                      *  02900060
*                                                                    *  02950060
*                    WORD 2 - ADDR OF OLD DATA SET NAME              *  03000060
*                                                                    *  03050060
*                    WORD 3 - ADDR OF NEW DATA SET NAME              *  03100060
*                                                                    *  03150060
*                    WORD 4 - ADDR OF VOLUME LIST                    *  03200060
*                                                                    *  03250060
*          THE VOLUME LIST IS VARIABLE IN LENGTH. THE FIRST TWO BYTES*  03300060
*          INDICATE THE NUMBER OF 12 BYTE VOLUME ID FIELDS WHICH     *  03350060
*          FOLLOW. A 12 BYTE VOLUME ID FIELD CONTAINS A FOUR BYTE    *  03400060
*          DEVICE CODE, SIX BYTE VOLUME SERIAL NUMBER, ONE BYTE SPARE*  03450060
*          AND ONE BYTE USED FOR RETURNING THE STATUS OF THE DATA SET*  03500060
*          ON THAT VOLUME AS FOLLOWS:                                *  03550060
*                                                                    *  03600060
*                    BINARY 0 - SUCCESSFUL RENAME                    *  03650060
*                    BINARY 1 - DSCB NOT FOUND IN VTOC               *  03700060
*                    BINARY 2 - PASSWORD DIFFICULITY                 *  03750060
*                    BINARY 3 - DUPLICATE NAME EXISTS                *  03800060
*                    BINARY 4 - PERMANENT I/O ERROR                  *  03850060
*                    BINARY 5 - APPROPRIATE UCB UNAVAILABLE          *  03900060
*                    BINARY 6 - OPERATOR UNABLE TO MOUNT VOLUME      *  03950060
*                    BINARY 7 - DATA SET IS OPEN                     *  04000060
*                    BINARY 8 - THE DATA SET IS DEFINED TO RACF BUT  *  04050060
*                               EITHER THE ACCESSOR IS NOT ALTER     *  04100060
*                               AUTHORIZED TO THE DATA SET OR THE    *  04150060
*                               DATA SET IS DEFINED TO RACF ON       *  04200060
*                               MULTIPLE VOLUMES.                    *  04250060
*                                                                    *  04300060
*OUTPUT -  REGISTER 15 CONTAINS THE ENTRY POINT ADDRESS OF THE FIRST *  04350060
*          RENAME MODULE IGC00030. REGISTERS 0 - 14 CONTAIN THE SAME *  04400060
*          VALUES AS UPON ENTRY TO IGG030DU.                         *  04450060
*                                                                    *  04500060
*ERROR CONDITONS - NONE                                              *  04550060
*                                                                    *  04600060
*STORAGE - PROGRAM CODE CSECT = 12 BYTES                             *  04650060
*                                                                    *  04700060
**********************************************************************  04750060
*REGISTER USAGE:                                                        04800060
R0       EQU   0                        REGISTER 0 - NOT USED           04850060
R15      EQU   15                       BASE REGISTER                   04870060
         SPACE 3                                                        04890060
         BALR  R15,R0                   LOAD REGISTER 15                04910060
         USING *,R15                    ESTABLISH BASE REGISTER         04930060
         L     R15,IGC00030             GET ADDRESS OF IGC00030         05000060
         BR    R15                      TRANSFER CONTROL TO IGC00030    05050060
IGC00030 DC    V(IGC00030)              ADDRESS OF IGC00030             05100060
         END                                                            05150060
./  ADD  SSI=72760296,NAME=IGG03001
         TITLE 'IGG03001 - RENAME - LOAD 3 - RENAME DSCB'        A38860 00019021
IGG03001 CSECT                                                          00023021
*          VS2 RELEASE 01 DELETIONS                                     00025400
*0000                                                            YM2930 00025800
*          RELEASE 21 DELETIONS                                         00027021
*0000000200-000280,002600,007600,012600-012800,014780,025800,    A38860 00031002
*0000030862-030942,031800-032000,036400,036600-036800,037200,    A38860 00035002
*0000039200-039500,040160,074800,076400-077000                   A38860 00039002
*0980014992-014994,035640                                        A43188 00048021
*0000031200                                                     SA49351 00058021
*0000026600-027200                                               A52462 00060421
*          RELEASE 21.7 DELETIONS/CHANGES                               00061002
*0000019600-019800,023400                                       SA56390 00061402
*0000000310-000390,002060-002120,012250-012550,031010-031120,   SA53147 00061602
*0000040130                                                     SA53147 00061802
*0000019000,045800                                              SA48172 00062021
*          RELEASE 20 DELETIONS                                         00068000
*3451025000                                                      M0013  00072020
*3451000360-000640,000760-001000,030824-030952                   S20201 00074020
*          RELEASE 19 DELETIONS                                         00083020
*1056013800,035800,079800                                        S19028 00092020
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00101002
*0000000250,000266,001010,001200,003000-003200,004400-005000,    Y02080 00101102
*0000006500-006550,012650-012750,013400,014700-014800,014900,    Y02080 00101202
*0000014940,014990,014992,015044,015055,019200,019600,021850,    Y02080 00101302
*0000023200,024000,024400,024800,026000,026500,028200,030720,    Y02080 00101402
*0000030872,031000,031160,031195-031600,035416,035600-035680,    Y02080 00101502
*0000036200,036400,037000-037200,040000,040150,043200,048400-    Y02080 00101602
*0000048600,052200,054020-054060,054200-076800,078800            Y02080 00101702
*0000010900,020000,021000,076800-083800                          Y02078 00101802
*0000000030-000150,001600-006400,006500-006550,008600,009000,    Y02082 00101902
*0000009400,009800,010200,010640,013770-013840,014830-014840,    Y02082 00102002
*0000014870,014982-015171,015900-016000,021800-021950,023600-    Y02082 00102102
*0000024800,026000-026200,030660-037000,039100,039900,040100,    Y02082 00102202
*0000054010-054300                                               Y02082 00102302
*0000015140                                                      Y02144 00102402
*0000025000                                                      Y02134 00102502
*0000015020,015100,022200,025200,033460,033620,034420,035040     YM1337 00102602
*0000033620                                                      YM2880 00102702
*0000039050,039150                                               YM2887 00102802
*0000023530,023680,024370                                        YM4653 00104902
*                                                                       00107002
*            VS2 RELEASE 808 CHANGES                                    00108037
*C033550,033560                                                @ZA17061 00109037
*                                                              @G60ASBJ 00109160
*            SU60 CHANGES/DELETIONS                            @G60ASBJ 00109260
*                                                              @G60ASBJ 00109360
*A 012819-012822,024806-024824,035640-035650,035670-035680     @G60ASBJ 00109460
*C 024611,024621,024631,024805,024825,033540                   @G60ASBJ 00109560
*D 035660-035680                                               @G60ASBJ 00109660
*                                                              @G60ASBJ 00109760
* STATUS CHANGE LEVEL 008                                               00110021
*                                                                       00111002
*MODULE NAME - IGG03001                                                 00112002
*                                                                       00113002
*DESCRIPTIVE NAME - RENAME - LOAD 3 - RENAME DSCB                       00114002
*                                                                       00115002
*COPYRIGHT - NONE                                                       00116002
*                                                                       00117002
*CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD           00118002
*                                                                       00119002
*ATTRIBUTES - REENTRANT                                                 00120002
*                                                                       00140000
*FUNCTION - THIS MODULE READS THE DATA PORTION OF THE FORMAT 1          00145002
*          DSCB TO BE RENAMED.  IF THE ENQ ON THE DATA SET NAME         00150002
*          (ISSUED IN MODULE IGC00030) INDICATED THAT SOMEONE COULD     00155002
*          BE OPEN TO THE DATA SET, THIS MODULE THEN SEARCHES THE       00160002
*          JOB'S DEBS TO ENSURE THAT NO ONE IS CURRENTLY OPEN TO        00165002
*          THE DATA SET.  IF THE DATA SET IS PASSWORD PROTECTED,        00170002
*          CONTROL IS GIVEN TO MODULE SECLOADA.  IF NO ONE IS OPEN      00175002
*          TO THE DATA SET, THIS MODULE THEN WRITES THE DSCB BACK       00180002
*          TO THE VTOC WITH THE NEW NAME IN ITS KEY.                    00185002
*          AFTER THE DSCB HAS BEEN WRITTEN BACK, THE VTOC IS DEQ'ED.    00190002
*          IF THE UNIT WAS DYNAMICALLY ALLOCATED, DYNAMIC ALLOCATION    00195002
*          IS CALLED TO DEALLOCATE THE UNIT.  IF THERE ARE MORE         00200002
*          VOLUMES TO BE PROCESSED, CONTROL IS RETURNED TO IGG03002.    00205002
*          AFTER ALL THE VOLUMES HAVE BEEN PROCESSED, THIS MODULE       00210002
*          TESTS IF A VOLUME WAS ENQ'ED AND MOUNTED BY IGG0300F.        00215002
*          IF YES, CONTROL IS GIVEN TO IGG0300F TO DEMOUNT AND DEQ      00220002
*          THE VOLUME.  IF RENAME ENQ'ED ON THE DATA SET NAME OR        00225002
*          THE TIOT, CORRESPONDING DEQ'S ARE ISSUED.  IF DATA SET       00230002
*          RECORDING FOR SMF IS REQUIRED, THIS MODULE BUILDS AN         00235002
*          SMF RECORD TYPE 18.  IT THEN FREES THE WORK AREA AND         00240002
*          RETURNS TO THE CALLER.                                       00245002
*          RENAMES PROFILES OF RAC DEFINED DATASETS.           @Z40RSGD 00245437
*          RENAME OF MULTIVOLUME RAC DEFINED DATA SETS IS NOT  @Z40RSGD 00247037
*          ALLOWED.                                            @Z40RSGD 00247437
*                                                                       00250002
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG03001.  ENTRY      00255002
*          IS MADE FROM THE SECOND LOAD OF RENAME (IGG03002), FROM      00260002
*          SECLOADA, OR FROM IGG0300F.                                  00265002
*                                                                       00270002
*SUPERVISOR CALLS AND EXTERNAL ROUTINES IN THIS MODULE -                00275002
*          EXCP(0)  - READS FROM OR WRITES TO A DIRECT ACCESS DEVICE    00280002
*          WAIT(1)  - WAITS ON AN EVENT CONTROL BLOCK                   00285002
*          TIME(11) - OBTAINS THE CURRENT TIME AND DATE                 00290002
*          DEQ(48)  - DEQ'S FROM SYSVTOC, SYSZTIOT, AND/OR SYSDSN       00295002
*          RESERVE  - ENQ'S ON THE VTOC (SVC 56)                        00300002
*          SMFWTM   - WRITES AN SMF RECORD (SVC 83)                     00305002
*          DYNALLOC - DYNAMICALLY DEALLOCATES THE UNIT (SVC 99)         00310002
*          SETLOCK  - OBTAINS/RELEASES THE LOCAL MEMORY LOCK            00315002
*          MODESET  - SWITCHES TO THE CALLER'S KEY                      00320002
*          IECRES   - LOADS/BRANCHES TO ANOTHER MODULE                  00325002
*                   - OBTAINS/FREES WORK AREA(S)                        00330002
*                                                                       00335002
*OTHER MACROS ISSUED -                                                  00340002
*          IECDSECS - EXPANDS THE CVT, DSAB, IEZDEB, JMR, JSCB,         00345002
*                     PSA, QDB, RB, RRPL, SMF, SMFTCT, TCB, TIOT,       00348002
*                     AND UCB DSECTS                                    00350002
*          IECSDSL1 - ENABLES SYMBOLIC ADDRESSING OF DSCB'S             00355002
*          IECRENWA - EXPANDS THE RENAME WORK AREA                      00360002
*          IEFZB4D0 - EXPANDS THE DYNAMIC ALLOCATION REQUEST BLOCK      00365002
*          IEFZB4D2 - EXPANDS THE DYNAMIC ALLOCATION TEST UNIT KEYS     00370002
*          IFASMFR  - BUILDS AN SMF RECORD TYPE 18                      00375002
*          XCTLTABL - BUILDS A LIST OF MODULE NAMES AND ADDRESSES       00380002
*                                                                       00385002
*INPUT -   AT ENTRY TO THIS MODULE REGISTER 13 POINTS TO THE WORK       00390002
*          AREA.  REGISTER 8 POINTS TO THE CURRENT ENTRY IN THE         00395002
*          VOLUME LIST.  REGISTER 10 POINTS TO THE PARAMETER LIST.      00400002
*          IF REENTRY FROM SECLOADA, REGISTER 10 CONTAINS ONE OF        00405002
*          THE FOLLOWING RETURN CODES:                                  00410002
*          X'00000000' - SUCCESSFUL PASSWORD CHECKING                   00415002
*          X'01000000' - UNSUCCESSFUL PASSWORD CHECKING                 00420002
*          X'02000000' - I/O ERROR OR NO PASSWORD DATA SET ON SYSRES    00425002
*                                                                       00430002
*OUTPUT -  THE RENAMED FORMAT 1 DSCB IS WRITTEN TO THE VTOC.            00435002
*          THE FOLLOWING INFORMATION IS PASSED TO MODULE IGG03002:      00440002
*          REGISTER 10 POINTS TO THE PARAMETER LIST, AND REGISTER       00445002
*          13 POINTS TO THE WORK AREA, IN WHICH 'VOLNUM' CONTAINS       00450002
*          THE NUMBER OF VOLUME LIST ENTRIES REMAINING TO BE RENAMED,   00455002
*          AND 'VOLPTR' CONTAINS THE ADDRESS OF THE NEXT ENTRY.         00460002
*          THE FOLLOWING INFORMATION IS PASSED TO SECLOADA:             00465002
*          REGISTER 1 CONTAINS THE DSAB ADDRESS.                        00470002
*          REGISTER 4 POINTS TO THE DATA PORTION OF THE FORMAT 1 DSCB.  00475002
*          REGISTER 5 POINTS TO THE IOB.                                00480002
*          REGISTER 10 CONTAINS THE VALUE X'02000000'.                  00485002
*          REGISTER 11 POINTS TO THE DATA SET NAME.                     00490002
*          REGISTER 13 POINTS TO THE EXTENDED PREFIX OF THE WORK AREA.  00495002
*          THE FOLLOWING INFORMATION IS PASSED TO IGG0300F:             00500002
*          REGISTER 2 POINTS TO THE DEB.                                00505002
*          REGISTER 3 POINTS TO THE VOLUME SERIAL NUMBER.               00510002
*          REGISTER 4 CONTAINS THE CHARACTERS '3001'.                   00515002
*          REGISTER 8 POINTS TO THE CURRENT VOLUME LIST ENTRY.          00520002
*          REGISTER 11 CONTAINS THE PRIMARY (DEMOUNTABLE) UCB ADDRESS.  00525002
*                                                                       00645021
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    00650002
*          WORK AREA = 676 BYTES                                        00655002
*                                                                       00660000
*ERROR CONDITIONS - OLD NAME DSCB NOT FOUND IN VTOC                     00680000
*                   NEW NAME DSCB ALREADY EXISTS IN VTOC                00700000
*                   IMPROPER PASSWORD PRESENTED                         00720000
*                   PERMANENT I/O ERROR                                 00740000
*                   DATA SET IS OPEN                                    00760002
*                   RENAME OF RAC DEFINED MULTI-VOLUME DATA    @Z40RSGD 00770037
*                                                                       00780000
*REGISTER USAGE                                                         00800000
R0       EQU   0                                                        00820000
R1       EQU   1                                                        00840000
RPARM    EQU   2                        PARAMETER LIST POINTER   Y02082 00868002
R2       EQU   2                                                        00880000
RDSAB    EQU   2                        POINTER TO THE DSAB      Y02082 00890002
RWRK     EQU   3                        WORK REGISTER            Y02082 00900002
RTIOT    EQU   3                        POINTER TO THE TIOT      Y02082 00910002
R3       EQU   3                                                        00920000
VOLCTR   EQU   5                        NUMBER OF VOLUMES        Y02082 00930002
R4       EQU   4                                                        00960000
RTEXT    EQU   4                        POINTER TO TEXT UNIT     Y02082 00970002
R5       EQU   5                                                        01000000
R6       EQU   6                                                        01040000
R7       EQU   7                                                        01060000
VOLISTX  EQU   8                                                        01080000
RERRSAVE EQU   8                        ERROR CODE REGISTER      Y02080 01090002
RCVT     EQU   9                                                        01100000
R9       EQU   9                                                        01110013
PL       EQU   10                                                       01120000
RA       EQU   10                                                S19028 01130019
R11      EQU   11                                                       01140000
RUCB     EQU   11                                                       01150013
RBASE    EQU   12                                                       01160000
RWKAREA  EQU   13                                                       01180000
RETURN   EQU   14                                                       01200000
WORKREG  EQU   15                                                       01220000
*                                                                       01221021
* OTHER EQUATES                                                         01222021
*                                                                       01223021
K0       EQU   0                        CONSTANT OF ZERO         Y02082 01223202
K1       EQU   1                        CONSTANT OF 1            Y02078 01223402
K2       EQU   2                        CONSTANT OF 2            Y02082 01223602
K3       EQU   3                        CONSTANT OF 3            Y02082 01223802
K4       EQU   4                        CONSTANT OF 4            Y02078 01224002
K6       EQU   6                        CONSTANT OF 6            Y02078 01224202
K8       EQU   8                        CONSTANT OF 8            Y02082 01224402
K12      EQU   12                       CONSTANT OF 12           Y02080 01224602
FW       EQU   4                        LENGTH OF A FULLWORD     Y02082 01224802
X00      EQU   X'00'                    ONE BYTE OF BINARY ZEROS Y02080 01225002
DOSBIT   EQU   X'80'                    DOS BIT IN DS4VTOCI      Y02078 01225202
DIRFBIT  EQU   X'04'                    DIRF BIT IN DS4VTOCI     Y02078 01225402
RTNCODE8 EQU   8                        RETURN CODE OF 8         Y02082 01225802
F1       EQU   C'1'                     FORMAT 1 DSCB ID         Y02080 01226002
PSWDDS   EQU   X'10'                    PASSWORD-PROTECTED D/S   Y02080 01226202
SMFREC18 EQU   18                       SMF RECORD TYPE 18       Y02082 01226402
UCBADDR  EQU   32                       DISP. TO UCB ADDR IN DEB Y02082 01226602
VOLSER   EQU   4                        OFFSET TO THE VOL SER IN Y02082 01226802
*                                       A VOLUME LIST ENTRY      Y02082 01227002
STATUS   EQU   11                       DISP. TO VOLIST STATUS   Y02078 01227202
ENTRYL   EQU   12                       VOL LIST ENTRY LENGTH    Y02082 01227402
NOF1     EQU   X'01'                    F1 DSCB NOT FOUND ERROR  Y02078 01227802
PSWDERR  EQU   X'02'                    PASSWORD ERROR           Y02082 01228002
DUPNAME  EQU   X'03'                    DUPLICATE NAME ERROR     Y02078 01228202
IOERR    EQU   X'04'                    I/O ERROR CODE           Y02078 01228402
OPENDS   EQU   X'07'                    OPEN DATA SET ERROR      Y02082 01228602
CSWAD    EQU   8                        CSW OFFSET IN IOB       SA56390 01229002
ALLBITS  EQU   X'FF'                    MASK OF ALL ONES         Y02082 01230002
BLANK    EQU   C' '                     EBCDIC BLANK             YM2880 01230202
DEBDADEV EQU   X'04'                    DEB EXTENT SCALE FOR DA  Y02082 01231002
DS1EXTUL EQU   X'40'                    USER LABEL BIT IN EXTENT Y02082 01232002
SKIP     EQU   X'10'                    CCW SKIP FLAG           SA48172 01279021
SLI      EQU   X'20'                    CCW SUPPRESS LENGTH     SA48172 01281021
*                                       INDICATOR               SA48172 01281660
RACPASS  EQU   X'40'                    BYPASS RACDEF CAMLST   @G60ASBJ 01281960
*                                       BIT                    @G60ASBJ 01282260
DS1RACDF EQU   X'40'                    DS1DSIND-DATA SET IS   @Z40RSGD 01283137
*                                       RAC DEFINED            @Z40RSGD 01283437
RACERROR EQU   X'08'                    ERROR CODE RENAME NOT  @Z40RSGD 01283837
*                                       ALLOWED                @Z40RSGD 01284237
*                                                                       01285021
         BALR  RBASE,R0                                                 01300000
         USING BEGIN,RBASE                                              01320000
         USING RENAMWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 01340002
         USING CVT,RCVT                                                 01360000
         USING UCB,RUCB                                                 01370013
*                                                                       01371002
BEGIN    EQU   *                        START HERE               Y02134 01373002
         TM    SISW2,DEMNTSW            TEST IF ENTERED FROM     Y02134 01375002
*                                       IGG0300F AFTER DEMOUNT   Y02134 01377002
         BO    RETURNPT                 BRANCH IF YES            Y02134 01379002
         CLI   STATUS(VOLISTX),X00      TEST IF ERROR ENTRY FROM Y02082 01381002
*                                       IGG03002                 Y02082 01383002
         BNE   TSTALLOC                 BRANCH IF YES            Y02082 01385002
         LTR   PL,PL                    TEST FOR PASSWORD        S19028 01391019
         BZ    PSWDOKAY                 BR IF RETURN WITH PROPER PSWD   01400000
         ST    PL,FIELD1                                                01420000
         TM    FIELD1,X'03'             WAS THIS AN ERROR RETURN PSWD   01440000
         BM    PSWDEXIT                 BR IF PSWD PROBLEM TO EXIT      01460000
*                                                                       01462013
* IF THIS SECTION IS ENTERED ENTRY WAS MADE FROM THE SECOND LOAD        01464013
*                                                                       01466013
         L     WORKREG,CVTPCNVT         LOAD CONVT ROUTINE ADDRESS      01468013
NOSUBUCB L     R0,SRTEFSCT              LOAD TTRO FROM UCB              01482013
         LA    R1,WKADEB                LOAD DEB ADDRESS         Y02082 01484002
         LA    R2,SEEK                  PUT MBBCCHHR IN SEEK FIELD      01486013
         LR    R3,RWKAREA               SAVE WORK AREA POINTER          01488013
         STM   R9,RWKAREA,IECREGSV+K12  SAVE VOLATILE REGS       Y02080 01490002
         BALR  RETURN,WORKREG           CONVERT TTRO TO MBBCCHHR        01492013
         LM    R9,RWKAREA,IECREGSV+K12-RENAMWKA(R3)  RESTORE     Y02080 01494002
         MVC   VTOCADR(5),SEEK+3        STORE VTOC ADDRESS              01496013
         MVC   INCCHHR(5),VTOCADR       SET UP SEARCH I.D. ADDRESS      01498013
         MVC   MJNAME(L'VTOCNAME),VTOCNAME  MAJOR RESOURCE NAME  Y02082 01500002
         MVI   ENQAREA,X'FF'            SET LAST ENTRY INDICATOR Y02082 01504002
         SR    R1,R1                    ZERO REGISTER            Y02082 01506002
         STH   R1,ENQAREA+K2            CLEAR FOR RESERVE MACRO  Y02082 01508002
         RESERVE (MJNAME,PVOLSER,E,6,SYSTEMS),                   YM3022X01510002
               MF=(E,ENQAREA),UCB=WKADEB+32  ISSUE ENQ ON VTOC   Y02082 01511002
*                                                                       01512002
         OI    DSMADTB2,DSMVTOCR        SET VTOC ENQ'ED BIT      Y02144 01512502
         L     R1,IECRRPRM              RECOVERY RTN LIST ADDR   Y02144 01513002
         USING RRPLIST,R1               PARM LIST ADDRESSABILITY Y02144 01513502
         ST    RUCB,RRUCBPTR            SAVE THE UCB ADDRESS     Y02144 01514002
         DROP  R1                                                Y02144 01514502
*                                                                       01515002
* THIS SECTION RELOCATES THE CHANNEL PROGRAM.                           01515502
*                                                                       01516002
         LM    R0,R7,CHANPROG           LOAD CCW1 TO CCW4 CONSTANTS     01518002
         AR    R0,RWKAREA              RESOLVE ADDR IN CCW1             01520000
         AR    R2,RWKAREA              RESOLVE ADDR IN CCW2             01540000
         AR    R4,RWKAREA              RESOLVE ADDR IN CCW3             01560000
         AR    R6,RWKAREA              RESOLVE ADDR IN CCW4             01580000
         STM   R0,R7,CCW1               STORE CCW1 - CCW4        Y02082 01588002
         LA    WORKREG,CCW9-CCW1                                        01620000
         AR    R2,WORKREG              RESOLVE ADDR IN CCW5             01640000
         STM   R2,R3,CCW5              STORE CCW5                       01660000
         LA    WORKREG,CCW11-CCW9                                       01680000
         AR    R2,WORKREG              RESOLVE ADDR IN CCW8             01700000
         STM   R2,R3,CCW8              STORE CCW8                       01720000
         LM    R0,R7,CHANPROG+32       LOAD CCW9 TO CCW12 CONSTANTS     01740000
         L     WORKREG,8(0,PL)         LOAD ADDR OF NEW DATA SET NAME   01760000
         AR    R0,WORKREG              RESOLVE ADDR IN CCW9             01780000
         AR    R2,RWKAREA              RESOLVE ADDR IN CCW10            01800000
         AR    R4,RWKAREA              RESOLVE ADDR IN CCW11            01820000
         AR    R6,RWKAREA              RESOLVE ADDR IN CCW12            01840000
         STM   R0,R7,CCW9              STORE CCW9 TO CCW12              01860000
         STM   R0,R1,CCW6              STORE CCW6                       01880000
         STM   R4,R5,CCW7              STORE CCW7               SA48172 01900021
         MVI   CCW7+4,SLI+SKIP         SET SLI, SKIP BITS       SA48172 01912021
         MVI   DS1FMTID,X00            ZERO FORMAT ID            Y02080 01920002
*                                                                       01925021
* THIS SECTION SEARCHES FOR A DUPLICATE NAME DSCB.                      01930021
*                                                                       01935021
EXECUTE1 BAL   RETURN,EXECIO           SEARCH FOR DUPLICATE NAME DSCB   01940000
         L     R2,IOB+CSWAD            GET CCW COMMAND ADDRESS  SA56390 01945002
         LA    R2,0(R2)                CLEAR HIGH BYTE          SA56390 01950002
         LA    R3,CCW8                 GET CCW8 ADDRESS         SA56390 01955002
         CLR   R2,R3                   DOES CSW POINT TO CCW8   SA56390 01960002
         BE    NODSNAME                BRANCH IF YES            SA56390 01965002
         CLI   DS1FMTID,F1             TEST FOR DUP NAME DSCB   SA56390 01970002
         BE    SAMENAME                YES, DUP NAME ERROR      SA56390 01975002
         B     PERMERR                 BAD VTOC - I/O ERR CODE  SA56390 01980002
NODSNAME EQU   *                                                SA56390 01985002
         TM    DS4VTOCI,DOSBIT+DIRFBIT  TEST IF DOS OR DIRF SET  Y02078 02000002
         BZ    NAMEOKAY                BR IF NOT                        02020000
         TM    ERCODE,X'80'            TEST FOR SECOND PASS             02040000
         BO    NAMEOKAY                BR IF YES                        02060000
         OI    ERCODE,X'80'            TURN ON FIRST PASS INDICATOR     02080000
         CLC   DS4HPCHR(K4),DS4VTOCE+K6  TEST IF CCHH OF 'HIGH   Y02078 02082002
*                                       WATER' MARK IS THE LAST  Y02078 02084002
*                                       TRACK IN THE VTOC        Y02078 02086002
         BNE   NEWHIGH                  BRANCH IF NOT            Y02078 02088002
         CLC   DS4HPCHR+K4(K1),DS4DEVDT  TEST IF R OF THE 'HIGH  Y02078 02090002
*                                       WATER' MARK IS THE LAST  Y02078 02092002
*                                       RECORD ON THE TRACK      Y02078 02094002
         BE    NAMEOKAY                 BRANCH IF YES            Y02078 02096002
NEWHIGH  EQU   *                       NEW CCHHR                 Y02078 02098002
         MVC   DS4HPCHR(K4),DS4VTOCE+K6  MOVE IN NEW CCHH        Y02078 02100002
         MVC   DS4HPCHR+4(1),DS4DEVDT  PICK UP NEW R                    02120000
         MVI   CCW3+4,X'50'            STORE NEW CCW3                   02140000
         B     EXECUTE1                                                 02160000
*                                                                       02170002
* THIS SECTION READS THE DATA PORTION OF THE OLD DSCB.                  02180002
*                                                                       02190002
NAMEOKAY L     R0,CHANPROG+32          LOAD CCW9                        02200000
         LA    WORKREG,PDSNAME         LOAD ADDR OF OLD DSNAME   YM1337 02220002
         AR    R0,WORKREG              RESOLVE ADDR IN CCW9             02240000
         ST    R0,CCW9                 STORE CCW9                       02260000
         ST    R0,CCW6                 STORE CCW6                       02280000
EXECUTE2 BAL   RETURN,EXECIO           SEARCH FOR AND READ OLD DSCB     02300000
         L     R2,IOB+CSWAD            GET CCW COMMAND ADDRESS  SA56390 02302002
         LA    R2,0(R2)                CLEAR HIGH BYTE          SA56390 02304002
         LA    R3,CCW8                 GET CCW8 ADDRESS         SA56390 02306002
         CLR   R2,R3                   DOES CSW POINT TO CCW8   SA56390 02308002
         BE    NODSCB                  YES, NO DSCB FOUND       SA56390 02310002
         CLI   DS1FMTID,F1             TEST FOR F1 DSCB IN CORE  Y02080 02320002
         BNE   PERMERR                 BAD VTOC - I/O ERR CODE  SA56390 02340002
         MVI   ERCODE,X00              RESET 1ST PASS INDICATOR  Y02082 02341002
*                                                                       02342002
* THIS SECTION SEARCHES THE JOB'S DEBS IF NECESSARY IN ORDER TO         02343002
* ENSURE THAT NO ONE IS OPEN TO THE DATA SET BEING RENAMED.             02344002
*                                                                       02345002
F1FOUND  EQU   *                        F1 DSCB FOUND            Y02082 02346002
         TM    SISW1,DEBSRCH            IS A DEB SEARCH NEEDED   Y02082 02347002
         BZ    PSWDCHK                  BRANCH IF NOT            Y02082 02348002
         L     R1,TCBADDR               CURRENT TCB ADDRESS      Y02082 02349002
         USING TCB,R1                                            Y02082 02350002
         L     R1,TCBJSCB               JSCB ADDRESS             Y02082 02351002
         USING IEZJSCB,R1                                        Y02082 02352002
         STM   R11,RETURN,IECREGSV+K12  SAVE SETLOCK REGISTERS   Y02082 02354002
         LR    R2,RWKAREA               SAVE WORKAREA BASE       Y02082 02355002
GETLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,  PREVENT DEBCHK  Y02082*02356002
               RELATED=(DEBTBL,IGG03001(FREELOCK))               Y02082 02357002
         LR    RWKAREA,R2               RESTORE WORKAREA BASE    Y02082 02358002
         LM    R11,RETURN,IECREGSV+K12  RESTORE SETLOCK REGS     Y02082 02359002
*                                                                       02359502
         L     R1,JSCBDBTB              ADDR OF DEB TABLE        Y02082 02360002
         LTR   R1,R1                    IS ADDR ZERO             Y02082 02361002
         BZ    NOPENDS                  BRANCH IF YES            Y02082 02362002
         LH    R2,K0(,R1)               LAST ENTRY OFFSET        Y02082 02363002
         AR    R2,R1                    ADDRESS OF LAST ENTRY    Y02082 02364002
NXTDEB   EQU   *                        NEXT DEB                 Y02082 02365002
         LA    R1,K4(,R1)               POINT TO NEXT ENTRY      Y02082 02366002
         CR    R1,R2                    END OF DEB TABLE         Y02082 02367002
         BE    NOPENDS                  BRANCH IF YES            YM4653 02368002
         OC    K0(K4,R1),K0(R1)         EMPTY ENTRY              Y02082 02369002
         BZ    NOPENDS                  BRANCH IF YES            Y02082 02370002
         TM    K3(R1),ALLBITS           DELETED ENTRY            Y02082 02371002
         BO    NXTDEB                   BRANCH IF YES            Y02082 02372002
*                                       R1 POINTS TO A FULLWORD  Y02082 02373002
*                                       CONTAINING A DEB POINTER Y02082 02374002
         L     R3,K0(,R1)               LOAD DEB ADDRESS         Y02082 02375002
         USING DEBBASIC,R3                                       Y02082 02376002
         LA    R4,DEBBASIC-DEBAMTYP     OFFSET BACK TO DEBAMTYP  Y02082 02377002
         LCR   R4,R4                    MAKE OFFSET NEGATIVE     Y02082 02378002
         AR    R4,R3                    R4 POINTS TO DEBAMTYP    Y02082 02379002
         USING DEBAMTYP,R4                                       Y02082 02380002
         CLI   DEBAMTYP,K0              AMTYP ABSENT             Y02082 02381002
         BE    AMVALID                  BRANCH IF YES--VALID     Y02082 02382002
         CLC   DEBAMTYP,AMBPAM          BPAM DEB                 Y02082 02383002
         BE    AMVALID                  BRANCH IF YES--VALID     Y02082 02384002
         CLC   DEBAMTYP,AMBDAM          BDAM DEB                 Y02082 02385002
         BE    AMVALID                  BRANCH IF YES            Y02082 02386002
         CLC   DEBAMTYP,AMSAM           SAM DEB                  Y02082 02387002
         BE    AMVALID                  BRANCH IF YES            Y02082 02388002
         CLC   DEBAMTYP,AMEXCP          EXCP DEB                 Y02082 02389002
         BE    AMVALID                  BRANCH IF YES            Y02082 02390002
         CLC   DEBAMTYP,AMISAM          ISAM DEB                 Y02082 02391002
         BNE   NXTDEB                   BRANCH IF NO-THIS DEB    Y02082 02392002
*                                       NEED NOT BE CHECKED      Y02082 02393002
         CLI   DEBNMEXT,K1              0 OR ONE EXTENT IN ISAM  Y02082 02394002
*                                       DEB                      Y02082 02395002
         BNH   NXTDEB                   INVALID ISAM DEB         Y02082 02396002
         DROP  R4                                                Y02082 02397002
         SR    R4,R4                    ZERO FOR IC              Y02082 02398002
         IC    R4,DEBNMEXT              INSERT NUMBER OF EXTENTS Y02082 02399002
         BCTR  R4,K0                    REDUCE BY ONE            Y02082 02400002
         LA    R3,DEBNMTRK-DEBUCBAD+L'DEBNMTRK(,R3)  SKIP FIRST  Y02082 02401002
*                                       EXTENT FOR ISAM          Y02082 02402002
         B     CHKEXTNT                 GO TO CHECK EACH EXTENT  Y02082 02403002
AMVALID  EQU   *                        VALID AM TYPE            Y02082 02404002
         CLI   DEBNMEXT,K0              ARE THERE ANY EXTENTS    Y02082 02405002
         BZ    NXTDEB                   BRANCH IF NO             Y02082 02406002
         CLI   DEBEXSCL,DEBDADEV        IS EXTENT SCALE 4 FOR DA Y02082 02407002
         BNE   NXTDEB                   BRANCH IF NO             Y02082 02408002
         L     R4,DEBSUCBA              GET UCB ADDRESS          Y02082 02409002
         USING UCBOB,R4                                          Y02082 02410002
         LA    R4,K0(,R4)               CLEAR HIGH BYTE          Y02082 02411002
         LTR   R4,R4                    IS THERE A UCB           Y02082 02412002
         BZ    NXTDEB                   BRANCH IF NO             Y02082 02413002
         TM    UCBTBYT3,UCB3DACC        IS IT DIRECT ACCESS      Y02082 02414002
         BZ    NXTDEB                   BRANCH IF NO             Y02082 02415002
         DROP  R4                                                Y02082 02416002
         SR    R4,R4                    ZERO FOR IC              Y02082 02417002
         IC    R4,DEBNMEXT              NUMBER OF EXTENTS        Y02082 02418002
CHKEXTNT EQU   *                        CHECK EXTENT             Y02082 02419002
         LA    R3,DEBBASND              INCREMENT PAST BASIC     Y02082 02420002
*                                       SECTION OF DEB           Y02082 02421002
         USING DEBDASD,R3                                        Y02082 02422002
CMPREXTS EQU   *                        CHECK CCHH               Y02082 02423002
         CLC   DEBUCBA,WKADEB+UCBADDR+K1  TEST IF SAME UCB       YM4653 02423402
         BNE   NEXTXTNT                 BRANCH IF NOT            YM4653 02423802
         TM    DS1EXT1,DS1EXTUL         IS FIRST EXTENT USER LBL Y02082 02424002
         BZ    NOTUL                    BRANCH IF NOT            Y02082 02425002
         CLC   DEBSTRCC(L'DEBSTRCC+L'DEBSTRHH),DS1EXT2+K2 IS THE Y02082 02426002
*                                       DEB'S STARTING CCHH      Y02082 02427002
*                                       EQUAL TO THE DSCBS       Y02082 02428002
         BE    NORENAME                 BRANCH IF YES            Y02082 02429002
         B     NEXTXTNT                 GET NEXT EXTENT          Y02082 02430002
NOTUL    EQU   *                        NOT USER LBL EXTENT      Y02082 02431002
         CLC   DEBSTRCC(L'DEBSTRCC+L'DEBSTRHH),DS1EXT1+K2  IS    Y02082 02432002
*                                       THE DEB'S STARTING CCHH  Y02082 02433002
*                                       EQUAL TO THE DSCB'S      Y02082 02434002
         BE    NORENAME                 BRANCH IF YES            Y02082 02435002
NEXTXTNT EQU   *                        NEXT EXTENT              Y02082 02436002
         LA    R3,DEBNMTRK+L'DEBNMTRK   INCREMENT TO NEXT EXTENT YM4653 02437002
         BCT   R4,CMPREXTS              TRY NEXT EXTENT          Y02082 02438002
         B     NXTDEB                   NO MORE EXTENTS          Y02082 02439002
NORENAME EQU   *                        OPEN DATA SET ERROR      Y02082 02440002
         LA    R3,OPENERR               SET UP BRANCH ADDRESS AS Y02082 02441002
*                                       THE DATA SET IS OPEN AND Y02082 02442002
*                                       CANNOT BE RENAMED        Y02082 02443002
         B     FREELOCK                 FREE THE LOCAL LOCK      Y02082 02444002
NOPENDS  EQU   *                        GET BRANCH ADDR          Y02082 02445002
         LA    R3,PSWDCHK               SET UP BRANCH ADDRESS    Y02082 02446002
*                                                                       02446502
FREELOCK EQU   *                        RELEASE LOCAL LOCK       Y02082 02447002
         LR    R1,RWKAREA               SAVE WORKAREA BASE       Y02082 02448002
         STM   R11,RETURN,IECREGSV+K12  SAVE SETLOCK REGISTERS   Y02082 02449002
         SETLOCK RELEASE,TYPE=LOCAL,    RELEASE LOCAL LOCK       Y02082*02450002
               RELATED=(DEBTBL,IGG03001(GETLOCK))                Y02082 02451002
         LR    RWKAREA,R1               RESTORE WORKAREA BASE    Y02082 02452002
         LM    R11,RETURN,IECREGSV+K12  RESTORE SETLOCK REGS     Y02082 02453002
         BR    R3                       RETURN                   Y02082 02454002
*                                                                       02455002
* SECLOADA IS GIVEN CONTROL IF THE DATA SET IS PASSWORD PROTECTED.      02456002
*                                                                       02457002
PSWDCHK  EQU   *                        PASSWORD CHECK           Y02082 02458002
         TM    DS1DSIND,DS1RACDF+PSWDDS IS DATA SET RAC        @Z40RSGD 02459037
*                                       DEFINED OR PASSWORD    @Z40RSGD 02459437
*                                       PROTECTED              @Z40RSGD 02459837
         BZ    SKIPPSWD                 BRANCH IF NOT            Y02082 02460002
         TM    DS1DSIND,DS1RACDF        RAC DEFINED            @Z40RSGD 02460437
         BZ    CHECKPSW                 NO- PASSWORD           @Z40RSGD 02460837
* BYPASS RACHECK IF JCSBPASS = SET                             @Z40RSGD 02460937
         L     WORKREG,TCBADDR         TCB ADDRESSABILITY      @Z40RSGD 02461037
         L     RWRK,TCBJSCB-TCB(WORKREG) JSCB ADDR             @G60ASBJ 02461160
         USING IEZJSCB,RWRK                                    @G60ASBJ 02462160
         L     RWRK,JSCBACT            JSCB ACTIVE             @G60ASBJ 02463160
         TM    JSCBSWT1,JSCBPASS       SKIP RACHECK            @Z40RSGD 02468760
         BO    NORACHK                 YES                     @Z40RSGD 02469760
*   CHECK AUTHORIZATION TO RENAME.                             @Z40RSGD 02470737
         MVC   RACHECK(LRACHECK),MRACHECK SET UP PARM LIST     @Z40RSGD 02471137
         RACHECK ENTITY=PDSNAME,        DATASET NAME           @Z40RSGDX02471237
               VOLSER=PVOLSER,          VOLUME SERIAL NUMBER   @Z40RSGDX02471637
               MF=(E,RACHECK)                                  @Z40RSGD 02472037
         LTR   WORKREG,WORKREG          IS HE AUTHORIZED       @Z40RSGD 02472437
         BNZ   RACERR                   NO - REJECT RENAME     @Z40RSGD 02472537
NORACHK  EQU   *                       RENAME PROFILE          @Z40RSGD 02472637
*   RENAME RAC PROFILE                                         @Z40RSGD 02472737
         MVC   RACDEF(LRACDEF),MRACDEF SET UP PARM LIST        @Z40RSGD 02478537
         L     PL,OLDPLPTR              POINTER TO NEWNAME     @G60ASBJ 02480560
************************************************************** @G60ASBJ 02480660
*                                                            * @G60ASBJ 02480760
*  THE RACDEF RENAME WILL BE BYPASSED IF THE FOLLOWING       * @G60ASBJ 02480860
*  CONDITIONS ARE MET:                                       * @G60ASBJ 02480960
*                      (1) THE CALLER IS AUTHORIZED.         * @G60ASBJ 02481060
*                      (2) THE JSCBPASS BIT IS SET TO 1.     * @G60ASBJ 02481160
*                      (3) THE SECOND BIT OF THE SECOND      * @G60ASBJ 02481260
*                          BYTE OF THE RENAME (CAMLST)       * @G60ASBJ 02481360
*                          PARAMETER LIST IS SET TO 1.       * @G60ASBJ 02481460
*                                                            * @G60ASBJ 02481560
************************************************************** @G60ASBJ 02481660
         TM    JSCBSWT1,JSCBPASS        SKIP RACDEF (JFCBPASS) @G60ASBJ 02481760
         BNO   RACDEF1                  NO - ISSUE RACDEF      @G60ASBJ 02481860
         TM    K1(PL),RACPASS           BYPASS RACDEF ?        @G60ASBJ 02481960
         BO    SKIPPSWD                 YES, BYPASS RACDEF     @G60ASBJ 02482060
RACDEF1  DS    0H                       ISSUE RACDEF           @G60ASBJ 02482460
         L     WORKREG,8(PL)            GET VOL SER ADDRESS    @G60ASBJ 02482560
         RACDEF ENTITY=PDSNAME,         DATASET NAME           @Z40RSGDX02482660
               VOLSER=PVOLSER,          VOLUME SERIAL NUMBER   @Z40RSGDX02484537
               NEWNAME=(WORKREG),       NEW DATASET NAME       @Z40RSGDX02486437
               MF=(E,RACDEF)                                   @Z40RSGD 02488437
         LTR   WORKREG,WORKREG          WAS DEFINITION OK      @Z40RSGD 02488837
         BNZ   RACERR                   NO - REJECT RENAME     @Z40RSGD 02489237
         B     SKIPPSWD                 AUTH-BYPASS PASSWORD   @Z40RSGD 02489637
CHECKPSW EQU   *                        CONTINUE PASSWORD      @Z40RSGD 02490337
*                                       CHECKING               @Z40RSGD 02492237
         TM    RTYPEFLG,PSWDCHKD        TEST IF ALREADY CHECKED  Y02082 02496437
         BO    SKIPPSWD                 BRANCH IF NOT 1ST VOLUME Y02082 02502337
         OI    RTYPEFLG,PSWDCHKD        SET PASSWORD CHECKED BIT Y02082 02508237
         LA    R4,DS1FMTID              ADDRESS OF THE F1 DSCB   Y02134 02514137
         LA    R11,PDSNAME              ADDRESS OF DATA SET NAME YM1337 02520002
         L     PL,SECCODE               SET RENAME CODE FOR SECURITY    02540000
         LA    R5,IOB                   IOB ADDRESS                     02560000
         L     R1,DSABADDR              DSAB ADDR IN REGISTER 1  Y02082 02580002
         LA    R7,SECLOAD               POINT TO SECLOADA        Y02082 02600002
         SR    RETURN,RETURN            SET ENTRY OFFSET         Y02134 02610002
         B     LOADEXIT                 GO BRANCH TO SECLOADA    Y02082 02620002
*                                                                       02625021
* THIS SECTION WRITES THE NEW DSCB OVER THE OLD ONE.                    02630021
*                                                                       02635021
PSWDOKAY L     PL,OLDPLPTR             RESTORE POINTER                  02640000
SKIPPSWD EQU   *                                                 A52462 02652021
         SR    WORKREG,WORKREG         ZERO OUT REGISTER         A52462 02654021
         IC    WORKREG,NEWCCHHR+4      PICK UP R OF NEXT RECORD  A52462 02660002
         BCT   WORKREG,NOTLAST         BRANCH IF NOT LAST ON     A52462 02720021
*                                      TRACK                     A52462 02730021
         IC    WORKREG,DS4DEVDT        SET R TO LAST DSCB ON THE TRACK  02740000
NOTLAST  STC   WORKREG,NEWCCHHR+4      STORE R OF DSCB READ INTO CORE   02760000
         MVC   SEEK+3(5),NEWCCHHR                                       02780000
         L     WORKREG,8(0,PL)         LOAD ADDR OF NEW DATA SET NAME   02800000
         MVC   DS1DSNAM,0(WORKREG)     MOVE IN NEW NAME          Y02080 02820002
         LA    WORKREG,F1DSCB           POINT TO OUTPUT AREA     Y02080 02825002
         ST    WORKREG,CCW3             WRITE FROM F1DSCB        Y02080 02830002
         MVI   CCW3+7,X'8C'            SET UP CCW3                      02840000
         MVI   CCW3,X'0D'              STORE CCW3                       02860000
         MVC   CCW4(8),CCW1            STORE CCW4                       02880000
         LA    WORKREG,CCW4             SET UP CCW5 FOR TIC             02900000
         ST    WORKREG,CCW5                                             02920000
         MVI   CCW5,X'08'                                               02940000
         XC    CCW5+4(4),CCW5                                           02960000
         MVC   CCW6(8),CHALPROG        STORE CCW6                       02980000
         LA    WORKREG,CCW1             SET STARTING ADDRESS IN IOB     03000000
         ST    WORKREG,IOB+16                                           03020000
         BAL   RETURN,EXECIO           WRITE NEW NAME DSCB OVER OLD     03040000
         NI    SISW1,X'FF'-NOSMFRCD     RESET NO SMF RCD SWITCH  Y02082 03045002
*                                       SINCE AT LEAST ONE       Y02082 03050002
*                                       RENAME IS SUCCESSFUL     Y02082 03055002
         B     FINISH                                                   03060000
*                                                                       03062002
* WHEN A DEB HAS BEEN FOUND OPEN TO THE DATA SET BEING RENAMED,         03064002
* THIS SECTION STORES AN ERROR CODE OF X'07' IN THE CURRENT AND         03066002
* ALL SUBSEQUENT VOLUME LIST ENTRIES. IF A PASSWORD ERROR OCCURS,       03068002
* X'02' IS STORED IN THE CURRENT AND ALL SUBSEQUENT ENTRIES.            03070002
*                                                                       03072002
* FOR OTHER ERROR CONDITIONS, THIS SECTION STORES THE APPROPRIATE       03074002
* ERROR CODE IN THE STATUS BYTE OF THE CURRENT VOLUME LIST ENTRY.       03076002
*                                                                       03078002
OPENERR  EQU   *                        OPEN DATA SET ERROR      Y02082 03080002
         LA    R3,OPENDS                OPEN DATA SET ERROR      Y02082 03082002
         B     SETEXIT                  GO STORE THE ERROR CODE  Y02082 03084002
PSWDEXIT EQU   *                        PASSWORD ERROR           Y02082 03086002
         LA    R3,PSWDERR               PASSWORD ERROR           Y02082 03088002
SETEXIT  EQU   *                        SET EXIT BIT             Y02082 03090002
         OI    RTYPEFLG,EXITBIT         SET EXIT BIT             Y02082 03092002
         LH    VOLCTR,VOLNUM            LOAD NBR OF VOLUMES LEFT Y02082 03094002
         LA    VOLCTR,K1(,VOLCTR)       INCREMENT BY ONE         Y02082 03096002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 03098002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 03100002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 03102002
ERRLOOP  EQU   *                        ERROR LOOP               Y02082 03104002
         STC   R3,STATUS(VOLISTX)       STORE CODE IN VOLIST     Y02082 03106002
         LA    VOLISTX,ENTRYL(VOLISTX)  POINT TO NEXT ENTRY      Y02082 03108002
         BCT   VOLCTR,ERRLOOP           BRANCH IF MORE VOLUMES   Y02082 03110002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 03112002
         LA    WORKREG,ENTRYL           VOL LIST ENTRY LENGTH    Y02082 03114002
         SR    VOLISTX,WORKREG          POINT TO LAST ENTRY      Y02082 03116002
         B     SETCODE                  GO SET CALLER'S ERR CODE Y02082 03118002
         SPACE 2                                               @Z40RSGD 03118137
RACERR   EQU   *                        UNABLE TO RENAME PROF  @Z40RSGD 03118237
         LA    R3,RACERROR              UNAUTHORIZED RENAME    @Z40RSGD 03118437
         B     SETERROR                 BRANCH TO SET ERROR    @Z40RSGD 03119237
*                                                                       03120002
SAMENAME EQU   *                        DUPLICATE NAME           Y02078 03122002
         LA    R3,DUPNAME               DUPLICATE NAME ERROR     Y02078 03124002
         B     SETERROR                 BRANCH TO SET ERROR CODE Y02078 03126002
*                                                                       03128002
NODSCB   EQU   *                        NO F1 DSCB               Y02078 03130002
         LA    R3,NOF1                  NO F1 DSCB ERROR         Y02078 03132002
         B     SETERROR                 BRANCH TO SET ERROR CODE Y02078 03134002
*                                                                       03136002
PERMERR  EQU   *                        I/O ERROR                Y02078 03138002
         LA    R3,IOERR                 I/O ERROR                Y02078 03140002
*                                                                       03142002
SETERROR EQU   *                        SET ERROR CODE           Y02078 03144002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 03146002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 03148002
         STC   R3,STATUS(VOLISTX)       STORE CODE IN VOL LIST   Y02078 03150002
         DROP  R1                                                Y02078 03152002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02078 03154002
SETCODE  EQU   *                        SET ERROR CODE           Y02082 03156002
         LA    WORKREG,RTNCODE8         SET ERROR CODE OF 8      Y02082 03158002
         STH   WORKREG,ERCODE           SAVE CALLER'S ERROR CODE Y02082 03160002
*                                                                       03162002
* THIS SECTION DEQ'S THE VTOC.                                          03164002
*                                                                       03166002
FINISH   EQU   *                        DEQ VTOC                 Y02082 03168002
         MVC   MJNAME(L'VTOCNAME),VTOCNAME  MAJOR RESOURCE NAME  Y02082 03170002
         L     RUCB,WKADEB+UCBADDR      LOAD UCB ADDR FROM DEB   Y02082 03172002
         USING UCB,RUCB                 UCB ADDRESSABILITY       Y02082 03174002
         MVC   MINAME(L'SRTEVOLI),SRTEVOLI  MINOR RESOURCE NAME  Y02082 03176002
         MVI   ENQAREA,X'FF'            SET LAST ENTRY INDICATOR Y02082 03178002
         SR    R1,R1                    ZERO REGISTER                   03180002
         STH   R1,ENQAREA+K2            CLEAR FOR DEQ MACRO      Y02082 03182002
         DEQ   (MJNAME,MINAME,6,SYSTEMS),MF=(E,ENQAREA)          Y02082 03184002
*                                                                       03185002
         NI    DSMADTB2,X'FF'-DSMVTOCR  RESET VTOC ENQ'ED SWITCH Y02144 03186002
*                                                                Y02144 03187002
* IF THE UNIT WAS DYNAMICALLY ALLOCATED, THIS SECTION BUILDS THE        03188002
* REQUEST BLOCK TO INTERFACE WITH DYNAMIC ALLOCATION (SVC 99) TO        03190002
* UNALLOCATE THE UNIT.                                                  03192002
*                                                                       03194002
TSTALLOC EQU   *                        TEST ALLOCATION          Y02082 03196002
         TM    SISW1,UCBALLOC           TEST IF UCB ALLOCATED    Y02082 03198002
*                                       BY DYNAMIC ALLOCATION    Y02082 03200002
         BNO   TESTLAST                 BRANCH IF NOT            Y02082 03202002
         LA    RPARM,VTOCDSCB           PARAMETER LIST BASE      Y02082 03204002
         USING S99RBP,RPARM                                      Y02082 03206002
         LA    RWRK,K4(,RPARM)          INCREMENT BY FOUR        Y02082 03208002
         ST    RWRK,S99RBPTR            SET UP REQUEST BLOCK PTR Y02082 03210002
         OI    S99RBPTR,S99RBPND        TURN ON HIGH ORDER BIT   Y02082 03212002
         LR    RPARM,RWRK               ADDRESS OF REQUEST BLOCK Y02082 03214002
         USING S99RB,RPARM              REQ BLOCK ADDRESSABILITY Y02082 03216002
         XC    S99RB(S99RBEND-S99RB),S99RB  ZERO REQ BLOCK CORE  Y02082 03218002
         MVI   S99RBLN,S99RBEND-S99RB   LENGTH OF REQUEST BLOCK  Y02082 03220002
         MVI   S99VERB,S99VRBUN         INDICATE UNALLOCATION    Y02082 03222002
         LA    RWRK,S99RBEND            ADDR OF TEXT POINTERS    Y02082 03224002
         ST    RWRK,S99TXTPP            PLACE IN REQUEST BLOCK   Y02082 03226002
         OI    S99FLG21,S99TIONQ        INDICATE TIOT ENQ'ED     Y02082 03228002
         LR    RPARM,RWRK               ADDRESS OF TEXT PTRS     Y02082 03230002
         USING S99TUPL,RPARM            TEXT PTRS ADDRESSABILITY Y02082 03232002
         LA    RTEXT,FW(,RPARM)         ADDRESS OF TEXT UNIT     Y02082 03234002
         ST    RTEXT,S99TUPTR           POINTER TO TEXT UNIT     Y02082 03236002
         OI    S99TUPTR,S99TUPLN        INDICATE LAST TEXT PTR   Y02082 03238002
         USING S99TUNIT,RTEXT           TEXT UNIT ADDRESSABILITY Y02082 03240002
         LH    RWRK,DDNAMEKY                                     Y02082 03242002
         STH   RWRK,S99TUKEY            INDICATE DDNAME SPEC     Y02082 03244002
         LA    RWRK,K1                                           Y02082 03246002
         STH   RWRK,S99TUNUM            INDICATE 1 DDNAME ENTRY  Y02082 03248002
         LA    RWRK,L'TIOEDDNM                                   Y02082 03250002
         STH   RWRK,S99TULNG            LENGTH OF TEXT PARM      Y02082 03252002
         L     RDSAB,DSABADDR           GET DSAB ADDRESS         Y02082 03254002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02082 03256002
         L     RTIOT,DSABTIOT           LOAD TIOT ADDRESS        Y02082 03258002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02082 03260002
         MVC   S99TUPAR(L'TIOEDDNM),TIOEDDNM  COPY TIOT'S DDNAME Y02082 03262002
         LA    R1,VTOCDSCB              POINT TO REQUEST BLK PTR Y02082 03264002
         DYNALLOC                                                Y02082 03266002
*                                                                       03267002
         NI    SISW1,X'FF'-UCBALLOC     RESET ALLOCATED BIT      Y02082 03268002
         NI    DSMADTB1,X'FF'-DSMUCBAL  RESET UCB ALLOCATED BIT  Y02144 03269002
*                                                                       03270002
* THIS SECTION BRANCHES BACK TO IGG03002 IF THE DATA SET MUST BE        03272002
* RENAMED ON ANOTHER VOLUME.                                            03274002
*                                                                       03276002
TESTLAST EQU   *                        LAST VOL                 Y02082 03278002
         TM    RTYPEFLG,EXITBIT         IS EXIT BIT SET          Y02082 03280002
         BO    DEQTEST1                 BRANCH IF SET            Y02082 03282002
         L     PL,OLDPLPTR              RELOAD PARM LIST ADDR    Y02082 03286002
         LA    R7,LOAD2                 POINT TO IGG03002        Y02082 03288002
*                                                                       03290002
* THIS SECTION LOADS AND/OR BRANCHES TO ANOTHER MODULE.                 03292002
*                                                                       03294002
LOADEXIT EQU   *                        EXIT                     Y02082 03296002
         IECRES LOAD,EXTPR=(RWKAREA),MODNM=(R7),BRANCH=DIRECT    Y02082 03298002
*                                                                       03300002
* IF A VOLUME WAS ENQ'ED AND MOUNTED BY IGG0300F, THIS SECTION          03302002
* BRANCHES TO IGG0300F TO DEMOUNT AND DEQ THE VOLUME.                   03304002
*                                                                       03306002
DEQTEST1 EQU   *                        DEQ VOL TEST             Y02082 03308002
         TM    SISW1,VOLDEQ             TEST IF VOL TO BE DEQ'ED Y02082 03310002
         BNO   DEQTEST2                 BRANCH IF NOT            Y02082 03312002
         OI    SISW2,DEMNTSW            SET DEMOUNT SWITCH       Y02134 03314002
         LA    R2,WKADEB                DEB ADDRESS IN REG 2     Y02134 03316002
         L     RUCB,PRUCBPTR            UCB ADDRESS IN REG 11    Y02134 03318002
         LA    R3,SRTEVOLI              VOLSER ADDR IN REG 3     Y02134 03320002
         L     R4,RETNAME               RETURN MODULE NAME       Y02134 03322002
         LA    R7,MNTLOAD               POINT TO ID OF IGG0300F  Y02134 03324002
         B     LOADEXIT                 GO BRANCH TO IGG0300F    Y02134 03326002
RETURNPT EQU   *                        RETURN HERE              Y02134 03328002
         NI    SISW2,X'FF'-DEMNTSW      RESET DEMOUNT SWITCH     Y02134 03330002
*                                                                       03332002
* IF RENAME ENQ'ED ON THE DSNAME, THIS SECTION ISSUES A DEQ             03334002
* DIRECTED TO THE INITIATOR'S TCB.                                      03336002
*                                                                       03338002
DEQTEST2 EQU   *                        DEQ SYSDSN TEST          Y02082 03340002
         TM    SISW1,DSNENQ             TEST IF ENQ'ED ON SYSDSN Y02082 03342002
         BNO   DEQTEST3                 BRANCH IF NOT            Y02082 03344002
         LA    R4,PDSNAME+L'PDSNAME-K1  LAST BYTE OF DSNAME      YM2880 03344402
TESTDSN  EQU   *                        SEARCH FOR NON-BLANK     YM2880 03344802
         CLI   K0(R4),BLANK             IS THIS ONE A BLANK      YM2880 03345202
         BNE   GETLNGTH                 BRANCH IF NO TO COMPUTE  YM2880X03345602
                                        LENGTH OF NAME FOR DEQ   YM2880 03346002
         BCT   R4,TESTDSN               TRY NEXT BYTE            YM2880 03346402
GETLNGTH EQU   *                        CALCULATE LENGTH         YM2880 03346802
         LA    R2,PDSNAME-K1            BYTE PRECEDING DSNAME    YM2880 03347202
         SR    R4,R2                    R4 HAS LENGTH FOR DEQ    YM2880 03347602
         L     R2,TCBADDR               LOAD TCB ADDRESS         Y02082 03348002
         USING TCB,R2                   TCB ADDRESSABILITY       Y02082 03350002
         L     R2,TCBJSCB               LOAD JSCB ADDRESS        Y02082 03352002
         DROP  RWRK                                            @G60ASBJ 03354060
         USING IEZJSCB,R2               JSCB ADDRESSABILITY      Y02082 03355037
         L     R2,JSCBACT              GET ACTIVE JSCB ADDRESS @ZA17061 03356037
         L     R2,JSCBTCBP             ADDR OF INITIATOR'S TCB @ZA17061 03357037
         MVC   ENQAREA(DEQLTH1),DEQLIST1  MOVE IN DEQ PARM LIST  Y02082 03358002
         MVC   MJNAME(L'DSNMJR),DSNMJR  MAJOR RESOURCE NAME      Y02082 03360002
         DEQ   (MJNAME,PDSNAME,(R4)),TCB=(R2),MF=(E,ENQAREA)     YM2880X03362002
                                        ISSUE DEQ                YM1337 03363002
         NI    DSMADTB2,X'FF'-DSMDSNE   RESET DSN ENQ'ED SWITCH  Y02144 03364002
*                                                                       03365002
* IF RENAME ENQ'ED ON THE TIOT, THIS SECTION ISSUES A DEQ.              03366002
*                                                                       03368002
DEQTEST3 EQU   *                        DEQ TIOT TEST            Y02082 03370002
         TM    SISW1,TIOTENQ            TEST IF ENQ'ED ON TIOT   Y02082 03372002
         BNO   TESTSMF                  BRANCH IF NOT            Y02082 03374002
         MVC   ENQAREA(DEQLTH2),DEQLIST2  MOVE IN DEQ PARM LIST  Y02082 03376002
         MVC   MJNAME(L'TIOTMJR),TIOTMJR  MAJOR RESOURCE NAME    Y02082 03378002
         DEQ   (MJNAME,TIOTMNR),MF=(E,ENQAREA)  DEQ FROM TIOT    Y02082 03380002
*                                                                       03381002
         NI    DSMADTB2,X'FF'-DSMTIOTE  RESET TIOT ENQ'ED SWITCH Y02144 03382002
*                                                                       03383002
* THIS SECTION DETERMINES IF AN SMF RECORD TYPE 18 MUST BE BUILT.       03384002
*                                                                       03386002
TESTSMF  EQU   *                        IS SMF RECORD NEEDED     Y02082 03388002
         TM    SISW1,NOSMFRCD           TEST IF RENAME TOTALLY   Y02082 03390002
*                                       OR PARTIALLY SUCCESSFUL  Y02082 03392002
         BO    EXIT                     BRANCH IF NOT            Y02082 03394002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02082 03396002
         L     R2,TCBADDR               LOAD TCB ADDRESS         Y02082 03398002
         USING TCB,R2                   TCB ADDRESSABILITY       Y02082 03400002
         L     R2,TCBTCT                LOAD TCT ADDRESS         Y02082 03402002
         LTR   R2,R2                    IS THERE A TCT           Y02082 03404002
         BZ    EXIT                     BRANCH IF NOT            Y02082 03406002
         USING SMFTCT,R2                TCT ADDRESSABILITY       Y02082 03408002
         L     R2,TCTJMR                LOAD JMR ADDRESS         Y02082 03410002
         LTR   R2,R2                    IS THERE A JMR           Y02082 03412002
         BZ    EXIT                     BRANCH IF NOT            Y02082 03414002
         USING JMRJOB,R2                JMR ADDRESSABILITY       Y02082 03416002
         L     RA,CVTSMCA               LOAD SMCA ADDRESS        Y02082 03418002
         LTR   RA,RA                    IS THIS AN SMF SYSTEM    Y02082 03420002
         BZ    EXIT                     BRANCH IF NOT            Y02082 03422002
         USING SMCABASE,RA                                       Y02082 03424002
         TM    SMCAOPT,SMCADSA          IS DS RECORDING REQUIRED Y02082 03426002
         BNO   EXIT                     BRANCH IF NOT            Y02082 03428002
*                                                                       03430002
* THIS SECTION CALCULATES IF ANOTHER WORK AREA MUST BE OBTAINED         03432002
* TO BUILD THE SMF RECORD TYPE 18.                                      03434002
*                                                                       03436002
BUILDSMF EQU   *                        WORK AREA TEST           Y02082 03438002
         L     R6,OLDPLPTR                                       S19028 03440002
         LM    R7,VOLISTX,K8(R6)        GET PARM POINTERS        YM1337 03442002
         LH    VOLCTR,K0(VOLISTX)       GET THE NBR OF VOLUMES   Y02082 03444002
         LA    VOLISTX,K2(VOLISTX)      POINT TO FIRST ENTRY     Y02082 03446002
         LA    R4,WKADEB-SMF18RV2       TEST IF ALL VOLUMES      Y02080 03448002
         SRL   R4,3                     WILL FIT IN WORK AREA    Y02080 03450002
         LA    R3,SMF18HDR              POINT TO SMF RECORD      Y02080 03452002
         CR    R4,VOLCTR                WILL ALL VOLS FIT IN THE Y02082 03454002
*                                       RENAME WORK AREA         Y02082 03456002
         BNL   COREOK                   BRANCH IF YES            S19028 03458002
         LR    R4,VOLCTR                CALCULATE CORE NEEDED    Y02082 03460002
         SLL   R4,3                     8 BYTES PER VOLIST ENTRY Y02082 03462002
         LA    R4,SMF18RV2-SMF18HDR(R4)  SET UP TO GET CORE      S19028 03464002
         IECRES GET,EXTPR=(RWKAREA),ID=REWA,LV=(R4),             Y02080X03466002
               STM=(R2,RETURN,IECREGSV+K12)                      Y02080 03468002
         LR    R3,R1                    GET SMF RECORD ADDRESS   Y02080 03470002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO AFTER Y02082X03471002
                                        ISSUING THE IECRES GET   Y02082 03472002
         USING SMF18HDR,R3              ADDRESSABILITY           Y02080 03473002
*                                                                       03474002
* THIS SECTION BUILDS THE TYPE 18 SMF RECORD.                           03476002
*                                                                       03478002
COREOK   EQU   *                                                 A38860 03480002
         XC    SMF18HDR(6),SMF18HDR     ZERO RECORD HEADER       A38860 03482002
         MVI   SMF18RTY,SMFREC18        SET RECORD TYPE          A38860 03484002
         TIME  BIN                                               S19028 03486002
         STM   R0,R1,SMF18TME+2         TIME OF RECORD           S19028 03488002
         MVC   SMF18TME(8),SMF18TME+2                            S19028 03490002
         MVC   SMF18SID(4),SMCASID                               S19028 03492002
         DROP  RA                                                S19028 03494002
         MVC   SMF18JBN(SMF18UID-SMF18JBN),JMRJOB  JOB NAME      Y02082 03496002
         MVC   SMF18UID,JMRUSEID        USER ID FIELD            Y02082 03498002
         DROP  R2                                                Y02082 03500002
         XC    SMF18RIN,SMF18RIN        ZERO RECORD INDICATORS   Y02082 03502002
         MVC   SMF18ODS,PDSNAME         OLD DS NAME              YM1337 03504002
         MVC   SMF18NDS,0(R7)           NEW DS NAME              Y02082 03506002
         XC    SMF18RV1,SMF18RV1        ZERO RESERVED AREA       Y02082 03508002
         XR    R7,R7                    ZERO VOL COUNTER         S19028 03510002
         LA    R2,SMF18RV2                                       S19028 03512002
         USING SMF18RV2,R2                                       S19028 03514002
TESTVOL  EQU   *                        WAS RENAME SUCCESSFUL    Y02082 03516002
         CLI   STATUS(VOLISTX),X00      WAS RENAME SUCCESSFUL    Y02082 03518002
         BNE   NEXTVOL                  BRANCH IF NOT            Y02082 03520002
         XC    SMF18RV2,SMF18RV2                                 Y02082 03522002
         MVC   SMF18FVL,VOLSER(VOLISTX)  MOVE VOL SER TO RECORD  Y02082 03524002
         LA    R7,1(R7)                 INCREMENT VOLUME COUNT   S19028 03526002
         LA    R2,SMF18LNV(R2)          INCREMENT RECORD PTR     S19028 03528002
NEXTVOL  EQU   *                        NEXT VOL                 Y02082 03530002
         LA    VOLISTX,ENTRYL(VOLISTX)  INCREMENT VOLIST PTR     Y02082 03532002
         BCT   VOLCTR,TESTVOL           BRANCH IF MORE VOLUMES   Y02082 03534002
         LTR   R7,R7                    IS VOLUME COUNT ZERO     S19028 03536002
         BZ    EXIT                     BRANCH IF YES            Y02082 03538002
         STC   R7,SMF18NVL              NUMBER OF RENAMED VOLS   S19028 03540002
         DROP  R2                                                S19028 03542002
         SR    R2,R3                    GET RECORD LENGTH        Y02080 03544002
         STH   R2,SMF18LEN                                       S19028 03546002
         DROP  R3                                                Y02080 03548002
         LR    R1,R3                    POINT TO SMF RECORD      Y02080 03550002
         SMFWTM (1)                     WRITE SMF RECORD TYPE 18 A38860 03552002
*                                                                       03554002
* THIS SECTION FREES ALL WORK AREAS AND RETURNS TO THE CALLER.          03556002
*                                                                       03558002
EXIT     EQU   *                        RETURN TO CALLER         Y02082 03560002
         LH    RERRSAVE,ERCODE          SAVE RETURN CODE         Y02082 03562002
         L     R9,RENSAVE               RESTORE ORIGINAL R14   @G60ASBJX03564060
                                        TO R9                  @G60ASBJ 03565060
         IECRES FREE,PREFIX=FIRST,A=(RWKAREA)  FREE WORK AREA    Y02082 03566060
         LR    RETURN,R9                RESTORE R14 WITH       @G60ASBJX03567060
                                        ORIGINAL R14           @G60ASBJ 03568060
         LR    WORKREG,RERRSAVE         RESTORE RETURN CODE      Y02082 03570002
         RETURN ,                       RETURN TO CALLER         Y02082 03572002
*                                                                       03740000
* THIS SECTION EXECUTES A CHANNEL PROGRAM.                              03746021
*                                                                       03752021
EXECIO   EXCP  IOB                                                      03760000
         WAIT  1,ECB=ECB                                                03780000
         TM    ECB,X'20'               TEST ECB FOR PERMANENT ERROR     03800000
         BZ    PERMERR                 BR IF ERROR                      03820000
         BR    RETURN                                                   03840000
*                                                                       03860000
*** PROGRAM CONSTANTS                                                   03880000
*                                                                       03900000
DEQLIST1 DEQ   (,,,SYSTEM),TCB=0,MF=L   SYSDSN DEQ LIST          YM2887 03905002
DEQLTH1  EQU   *-DEQLIST1               LENGTH OF DEQ LIST       Y02082 03910002
DEQLIST2 DEQ   (,,6,SYSTEM),MF=L        SYSZTIOT DEQ LIST        YM2887 03915002
DEQLTH2  EQU   *-DEQLIST2               LENGTH OF DEQ LIST       Y02082 03920002
TIOTMJR  DC    CL8'SYSZTIOT'            TIOT MAJOR RESOURCE NAME Y02082 03925002
DSNMJR   DC    CL8'SYSDSN'              DSN MINOR RESOURCE NAME  Y02082 03930002
VTOCNAME DC    CL8'SYSVTOC'             VTOC MAJOR RESOURCE NAME Y02082 03935002
         DS    0F                                                A38860 03940021
RETNAME  DC    CL4'3001'                RETURN NAME FOR IGG0300F Y02134 03960002
SECCODE  DC    X'02000000'              CODE FOR SECURITY LOAD          03980000
DDNAMEKY DC    AL2(DUNDDNAM)            DDNAME UNALLOCATION KEY  Y02082 03990002
*                                                                       03996002
*        DEB ACCESS METHOD TYPE VALUES                                  03998002
*                                                                       04000002
AMBPAM   DEBCHK AM=BPAM,MF=L            BPAM AMTYPE              Y02082 04002002
AMBDAM   DEBCHK AM=BDAM,MF=L            BDAM AMTYPE              Y02082 04004002
AMSAM    DEBCHK AM=SAM,MF=L             SAM AMTYPE               Y02082 04006002
AMEXCP   DEBCHK AM=EXCP,MF=L            EXCP AMTYPE              Y02082 04008002
AMISAM   DEBCHK AM=ISAM,MF=L            ISAM AMTYPE              Y02082 04010002
*                                                                       04017021
*** THE FOLLOWING CHANNEL PROGRAM SEARCHES THE VTOC FOR THE NAMED DSCB. 04020000
*** THE VTOC DSCB AND THE NAMED DSCB ARE READ INTO THE INPUT AREAS.     04040000
*                                                                       04060000
CHANPROG DS    0F                                                       04080000
*CCW1                                                                   04100000
         DC    X'31'                   SEARCH EQUAL ID (SEEK+3)         04120000
         DC    AL3(3+SEEK-FIRST)                                        04140000
         DC    X'4000'                                                  04160000
         DC    H'5'                                                     04180000
*CCW2                                                                   04200000
         DC    X'08'                   TIC TO CCW1                      04220000
         DC    AL3(0+CCW1-FIRST)                                        04240000
         DC    F'0'                                                     04260000
*CCW3                                                                   04280000
         DC    X'06'                   READ DATA (VTOC DSCB)            04300000
         DC    AL3(VTOCDSCB-FIRST)     DATA ADDR                 Y02080 04320002
         DC    X'4000'                                                  04340000
         DC    H'96'                                                    04360000
*CCW4                                                                   04380000
         DC    X'B1'                   SEARCH EQUAL ID (LAST FMT 1)     04400000
         DC    AL3(0+DS4HPCHR-FIRST)                                    04420002
         DC    X'4000'                                                  04440000
         DC    H'5'                                                     04460000
*CCW5                                   TO BE CONSTRUCTED               04480000
*                                       TIC TO CCW9                     04500000
*CCW6                                   TO BE CONSTRUCTED               04520000
*                                       SEARCH EQUAL KEY (DS NAME)      04540000
*CCW7                                   TO BE CONSTRUCTED               04560000
*                                       READ DATA OF THE LAST   SA48172 04570021
*                                       FORMAT 1 WITH THE SKIP  SA48172 04580021
*                                       BIT SET IN ORDER TO END SA48172 04590021
*                                       THE CHANNEL PROGRAM     SA48172 04590421
*CCW8                                   TO BE CONSTRUCTED               04600000
*                                       TIC TO CCW11                    04620000
*CCW9                                                                   04640000
         DC    X'29'                   SEARCH EQUAL KEY (DS NAME)       04660000
         DC    AL3(0)                                                   04680000
         DC    X'6000'                                                  04700000
         DC    H'44'                                                    04720000
*CCW10                                                                  04740000
         DC    X'08'                   TIC TO CCW4                      04760000
         DC    AL3(0+CCW4-FIRST)                                        04780000
         DC    F'0'                                                     04800000
*CCW11                                                                  04820000
         DC    X'06'                   READ DATA INTO F1DSCB+44  Y02080 04840002
         DC    AL3(DS1FMTID-FIRST)     DATA ADDR                 Y02080 04860002
         DC    X'4000'                                                  04880000
         DC    H'96'                                                    04900000
*CCW12                                                                  04920000
         DC    X'12'                   READ COUNT (NEWCCHHR)            04940000
         DC    AL3(0+NEWCCHHR-FIRST)                                    04960000
         DC    X'2000'                                                  04980000
         DC    H'5'                                                     05000000
*                                                                       05020000
*** THE FOLLOWING CHANNEL PROGRAM WRITES THE NEW NAME DSCB OVER THE     05040000
*** OLD NAME DSCB IN THE VTOC ON THE DIRECT ACCESS DEVICE.              05060000
*                                                                       05080000
CHALPROG DS    0F                                                       05100000
*CCW1                                   TO BE CONSTRUCTED               05120000
*                                       SEARCH EQUAL ID (SEEK+3)        05140000
*CCW2                                   TO BE CONSTRUCTED               05160000
*                                       TIC TO CCW1                     05180000
*CCW3                                   TO BE CONSTRUCTED               05200000
*                                       WRITE KEY AND DATA FROM F1DSCB  05220002
*CCW4                                   TO BE CONSTRUCTED               05240000
*                                       SEARCH EQUAL ID (SEEK+3)        05260000
*CCW5                                   TO BE CONSTRUCTED               05280000
*                                       TIC TO CCW4                     05300000
*CCW6                                                                   05320000
         DC    X'0E'                   READ KEY AND DATA (WRITE CHECK)  05340000
         DC    AL3(0)                                                   05360000
         DC    X'1000'                                                  05380000
         DC    H'140'                                                   05400000
*   RACHECK PARAMETER LIST MASTER                                       05410037
MRACHECK RACHECK ATTR=ALTER,            ALTER AUTHORIZATION    @Z40RSGDX05412037
               CLASS=CDATASET,          DATASET CLASS          @Z40RSGDX05414037
               DSTYPE=N,                NONVSAM DATASET        @Z40RSGDX05416037
               MF=L                                            @Z40RSGD 05418037
LRACHECK EQU   *-MRACHECK               LENGTH OF PARM LIST    @Z40RSGD 05418437
CDATASET DC    AL1(7),C'DATASET'        CLASS FOR RACHECK      @Z40RSGD 05418837
*   RACDEF PARAMETER LIST MASTER                                        05419237
MRACDEF  RACDEF DSTYPE=N,               DASD DATASET           @Z40RSGDX05419637
               TYPE=DEFINE,             DEFINE A NEWNAME       @Z40RSGDX05419737
               MF=L                                            @Z40RSGD 05419837
LRACDEF  EQU   *-MRACDEF                LENGTH OF PARM LIST    @Z40RSGD 05419937
*                                                                       05433337
* TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                       05440002
*                                                                       05460002
         XCTLTABL ID=(LOAD2,IGG03002,MNTLOAD,IGG0300F,           Y02134*05480002
               SECLOAD,SECLOADA),SVC=030,LENGTH=,BRT=YES         Y02134 05500002
         SPACE 2                                                 Y02082 05520002
         IECDSECS CVT,DSAB,JMR,QDB,RB,SMF,SMFTCT,TCB,TIOT,UCB,   Y02082*05540002
               IEZDEB,JSCB,PSA,RRPL,EXPAND=YES                   Y02144 05560002
WORKAREA IECRENWA EP,F4,D1=(1),ADT=YES  RENAME WORK AREA         Y02082 05580002
         SPACE 2                                                 Y02082 05600002
RACHECK  EQU   IECREGSV                 RACHECK PARAMETER LIST @Z40RSGD 05610037
RACDEF   EQU   IECREGSV                 RACDEF PARAMETER LIST  @Z40RSGD 05612037
         SPACE 2                                                        05614037
         ORG   VTOCDSCB                                          Y02082 05620002
         IFASMFR (18)                                            Y02082 05640002
         EJECT                                                   Y02082 05660002
*                                                                       05680002
* DSECTS FOR INVOCATING DYNAMIC ALLOCATION (SVC 99)                     05700002
*                                                                       05720002
         IEFZB4D0                       DYNAMIC ALLOCATION DSECT Y02082 05740002
         EJECT                                                   Y02082 05760002
         IEFZB4D2                       DYNAMIC ALLOCATION KEYS  Y02082 05780002
*                   SETS FAILED                                @Z40RSGD 07000037
         END                                                            08580000
./  ADD  SSI=51960087,NAME=IGG03002
 TITLE 'IGG03002 - RENAME - LOAD 2 - LOCATE VOLUME TO BE PROCESSED'     00300002
IGG03002 CSECT                                                          00330021
*                                                                       00360021
*          RELEASE 17 DELETIONS                                       * 00390000
*1675006000,012000                                                19894 00480000
*        RELEASE 18 DELETIONS                                         * 00570018
*3476192000-198000,330000,342000,396000,402000,708000-711000       DM0Q 00630018
*3476005700,447000-450000,591000,603000                           20326 00660018
*3476                                                             21488 00700018
*          RELEASE 19 DELETIONS                                       * 00750000
*1291318000,447000,645000-663000,924000                          S19028 00790019
*          RELEASE 20 DELETIONS                                       * 00840000
*3450390000                                                      S20016 00880020
*3450388200,389300,770000-770500                                 TS1611 00900020
*3450234000,249000,325200-325300,660000                          S20201 00910020
*          RELEASE 21 DELETIONS                                       * 00930000
*1195006000,033000,090000-099000,111000,195000,540000-543000,    A38860 00933021
*1195549000-552000,681000-684000,769000-769500,902000            A38860 00936021
*1195267000-270000,276000,679000,768500                          A37199 00940021
*1195                                                            A44427 00950021
*1195                                                            A36775 00970021
*0000665400                                                     SA49351 00980021
*          RELEASE 21.7 DELETIONS                                       00993302
*0000192300-193800,658200-664800,688000                         SA53147 01006702
*          RELEASE 22 DELETIONS                                       * 01020000
*0000063000-066000,072000-081000,102000-105000,110000-112000,    Y02080 01110202
*0000117000,194100,207000,216000,259000,294000,315000-324000,    Y02080 01110302
*0000325200-325500,330000-340500,342500,348000,354000-357000,    Y02080 01110402
*0000375000,387000,396000,402000,468000,474000-489000,499400,    Y02080 01110502
*0000510000-516000,546000-548000,579000-606000,657900-669000,    Y02080 01110602
*0000682000,768300-768900,771000-897000,901000-903000,912000-    Y02080 01110702
*0000918000,923000                                               Y02080 01110802
*0000                                                            Y02078 01110902
*0000021000-108000,112000,117000,166000,169000,191200-192000,    Y02082 01111002
*0000229000-231000,285000-669000,687500-926600                   Y02082 01111102
*0000                                                            Y02134 01111202
*0000                                                            Y02144 01111302
*0000290000-291000,325000,361000,388000,501000                   YM1337 01111402
*0000324000,364000-366000                                        YM1063 01111602
*0000364500-365000                                               YM7377 01111702
*0000349400                                                      YM7515 01111802
*0000344000,573000                                               YM7036 01112002
*                                                                       01290002
*          VS2 RELEASE 03 DELETIONS/CHANGES                           * 01290203
*0000352000                                                    @ZA01347 01290403
*                                                                       01291002
*          VS2 RELEASE 04 DELETIONS/CHANGES                           * 01291203
*0000353000                                                    @ZA05225 01291403
*                                                                       01291603
*MODULE NAME - IGG03002                                                 01292002
*                                                                       01293002
*DESCRIPTIVE NAME - RENAME - LOAD 2 - LOCATE VOLUME TO BE PROCESSED     01294002
*                                                                       01295002
*COPYRIGHT - NONE                                                       01296002
*                                                                       01297002
*CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD           01298002
*                                                                       01299002
* STATUS CHANGE LEVEL 004                                               01390021
*                                                                       01440002
*ATTRIBUTES - REENTRANT                                                 01500002
*                                                                       01800013
*FUNCTION - AFTER BUILDING THE DEB/DCB AND THE IOB, THIS MODULE         01900002
*          SEARCHES THE TIOT TO SEE IF THE CURRENT VOLUME IN THE        02000002
*          VOLUME LIST IS MOUNTED ON A UNIT ALLOCATED TO THE JOB.       02100002
*          IF THE VOLUME IS NOT MOUNTED ON AN ALLOCATED UNIT, IT        02200002
*          SEARCHES THE UCB LOOKUP TABLE TO DETERMINE IF THE VOLUME     02300002
*          IS MOUNTED ANYWHERE.  IF IT IS MOUNTED, DYNAMIC ALLOCATION   02400002
*          IS CALLED TO TRY TO ALLOCATE THE UNIT.  IF THE VOLUME IS     02500002
*          NOT MOUNTED ANYWHERE OR IF THE UNIT CANNOT BE DYNAMICALLY    02600002
*          ALLOCATED, AND THERE IS A PRIMARY UCB, CONTROL IS GIVEN TO   02700002
*          THE SCRATCH/RENAME DEMOUNT/MOUNT/VERIFY ROUTINE TO MOUNT     02800002
*          THE VOLUME.  IF THERE IS NO PRIMARY UCB OR IF THE VOLUME     02900002
*          CANNOT BE MOUNTED, THE NEXT VOLUME IN THE VOLUME LIST IS     03000002
*          PROCESSED.  IF THE VOLUME WAS FOUND TO BE MOUNTED ON AN      03100002
*          ALLOCATED UNIT, AFTER THE UNIT CONTAINING THE VOLUME IS      03200002
*          DYNAMICALLY ALLOCATED, AFTER THE VOLUME IS MOUNTED ON THE    03300002
*          PRIMARY UCB, OR AFTER ALL THE VOLUME LIST ENTRIES HAVE BEEN  03400002
*          PROCESSED, CONTROL IS GIVEN TO THE THIRD LOAD OF RENAME.     03500002
*                                                                       03600002
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG03002.  ENTRY IS   03700002
*          MADE FROM IGC00030, IGG03001, OR IGG0300F.                   03800002
*                                                                       03900002
*SUPERVISOR CALLS AND EXTERNAL ROUTINES -                               04000002
*          DYNALLOC - DYNAMICALLY ALLOCATES THE UNIT (SVC 99)           04100002
*          MODESET  - SWITCHES TO THE CALLER'S KEY                      04200002
*          IECRES   - BRANCHES TO OTHER RENAME MODULES                  04300002
*                                                                       04400002
*OTHER MACROS ISSUED -                                                  04500002
*          IECDSECS - EXPANDS THE CVT, DSAB, QDB, RB, TCB, TIOT,        04600002
*                     AND UCB DSECTS                                    04700002
*          IECRENQA - EXPANDS THE RENAME WORK AREA                      04800002
*          IEFZB4D0 - EXPANDS THE DYNAMIC ALLOCATION REQUEST BLOCK      04900002
*          IEFZB4D2 - EXPANDS THE DYNAMIC ALLOCATION TEST UNIT KEYS     05000002
*          XCTLTABL - BUILDS A LIST OF MODULE IDS AND ADDRESSES         05100002
*                                                                       05200002
*INPUT -   AT ENTRY TO THIS MODULE REGISTER 9 POINTS TO THE CVT.        05300002
*          REGISTER 10 POINTS TO THE PARAMETER LIST.  REGISTER 13       05400002
*          POINTS TO THE WORK AREA, IN WHICH 'VOLNUM' CONTAINS THE      05500002
*          NUMBER OF VOLUMES REMAINING TO BE RENAMED, AND 'VOLPTR'      05600002
*          CONTAINS THE ADDRESS OF THE CURRENT ENTRY IN THE VOLUME      05700002
*          LIST.                                                        05800002
*          IF REENTRY FROM IGG0300F, REGISTER 14 CONTAINS ONE OF        05900002
*          THE FOLLOWING RETURN CODES:                                  06000002
*          00 - VOLUME WAS SUCCESSFULLY MOUNTED AND/OR VERIFIED         06100002
*          04 - VOLUME COULD NOT BE DEMOUNTED                           06200002
*          08 - VOLUME COULD NOT BE MOUNTED                             06300002
*          0C - I/O ERROR OCCURRED WHEN READING THE VOLUME LABEL        06400002
*          ALSO, REGISTER 5 CONTAINS THE NUMBER OF VOLUMES REMAINING    06500002
*          TO BE RENAMED, AND REGISTER 8 POINTS TO THE CURRENT ENTRY    06600002
*          IN THE VOLUME LIST.                                          06700002
*                                                                       06800002
*OUTPUT -  REGISTER 8 POINTS TO THE CURRENT ENTRY IN THE VOLUME LIST.   06900002
*          REGISTER 9 POINTS TO THE CVT, AND REGISTER 10 POINTS TO      07000002
*          THE PARAMETER LIST.  REGISTER 13 POINTS TO THE WORK AREA,    07100002
*          IN WHICH THE DEB CONTAINS THE UCB ADDRESS OF THE VOLUME      07200002
*          WHOSE DATA SET IS TO BE RENAMED.                             07300002
*          THE FOLLOWING ADDITIONAL INFORMATION IS PASSED TO IGG0300F:  07400002
*          REGISTER 2 POINTS TO THE DEB.                                07500002
*          REGISTER 3 POINTS TO THE VOLUME SERIAL NUMBER.               07600002
*          REGISTER 4 CONTAINS THE CHARACTERS '3002'.                   07700002
*          REGISTER 11 CONTAINS THE PRIMARY (DEMOUNTABLE) UCB ADDRESS.  07800002
*                                                                       07900002
*STORAGE - PROGRAM CODE CSECT = LESS THAN 1024 BYTES                    11000002
*          WORK AREA = 676 BYTES                                        11200002
*                                                                       11400013
*ERROR CONDITIONS - NO DEVICE AVAILABLE FOR MOUNTING THE VOLUME         11700002
*                                                                       12000013
*RESTRICTIONS - NONE                                                    12300013
*                                                                       12600013
*REGISTER USAGE:                                                        12900013
R0       EQU   0                                                        13200013
R1       EQU   1                                                        13500013
R2       EQU   2                                                        13800013
RPARM    EQU   2                        PTR TO SVC 99 PARM LIST  Y02082 13900002
RDSAB    EQU   2                        POINTER TO THE DSAB      Y02082 14000002
R3       EQU   3                                                        14100013
P1       EQU   3                                                        14400013
RWRK     EQU   3                        WORK REGISTER            Y02082 14500002
RTIOT    EQU   3                        POINTER TO THE TIOT      Y02082 14600002
R4       EQU   4                                                        14700013
RTEXT    EQU   4                        POINTER TO TEXT UNIT     Y02082 14800002
REND     EQU   4                        POINTER TO END OF ENTRY  Y02082 14900002
P2       EQU   4                                                        15000013
R5       EQU   5                                                        15300013
R6       EQU   6                                                 S20016 15400020
VOLCTR   EQU   5                                                        15600013
P4       EQU   6                                                        15900013
R7       EQU   7                                                        16200013
VOLISTX  EQU   8                                                        16500013
R9       EQU   9                                                        16800013
RCVT     EQU   9                                                        17100013
PL       EQU   10                                                       17400013
RUCB     EQU   11                                                       17700013
RBASE    EQU   12                                                       18000013
RWKAREA  EQU   13                                                       18300013
RETURN   EQU   14                                                       18600013
WORKREG  EQU   15                                                       18900013
RTNCODE  EQU   15                       RETURN CODE REGISTER     Y02082 18920002
*                                                                       18970021
* OTHER EQUATES                                                         19040021
*                                                                       19110021
K0       EQU   0                        CONSTANT OF ZERO         Y02082 19112002
K1       EQU   1                        CONSTANT OF 1            Y02082 19114002
K2       EQU   2                        CONSTANT OF 2            Y02082 19116002
K3       EQU   3                        CONSTANT OF 3            Y02082 19118002
K4       EQU   4                        CONSTANT OF 4            Y02080 19120002
K6       EQU   6                        CONSTANT OF 6            Y02082 19122002
K7       EQU   7                        CONSTANT OF 7            Y02082 19124002
K8       EQU   8                        CONSTANT OF 8            Y02082 19126002
K12      EQU   12                       CONSTANT OF 12           Y02082 19128002
FW4      EQU   16                       LENGTH OF 4 FW'S         Y02082 19132002
STATEXTL EQU   8                        STATUS TEXT UNIT LENGTH  Y02082 19134002
UNITEXTL EQU   10                       UNIT TEXT UNIT LENGTH    Y02082 19136002
VOLTEXTL EQU   12                       VOLSER TEXT UNIT LENGTH  Y02082 19138002
RTNCODE4 EQU   4                        ERROR RETURN CODE OF 4   Y02082 19140002
RTNCODE8 EQU   8                        ERROR RETURN CODE OF 8   Y02082 19142002
VOLSER   EQU   4                        OFFSET TO VOLUME SERIAL  Y02082 19144002
*                                       IN A VOLUME LIST ENTRY   Y02082 19146002
STATUS   EQU   11                       OFFSET TO STATUS BYTE    Y02082 19148002
ENTRYL   EQU   12                       VOL LIST ENTRY LENGTH    Y02082 19150002
UCBADDR  EQU   32                       DISP. TO UCB ADDR IN DEB Y02082 19152002
DEVMOD   EQU   X'C0'                    DEB DEVICE MODIFIER      Y02082 19154002
IOERR    EQU   X'04'                    I/O ERROR IN VOL LIST    Y02082 19156002
NODEVERR EQU   X'05'                    NO DEVICE ERROR          Y02082 19158002
NOMNTERR EQU   X'06'                    VOLUME NOT MOUNTED ERROR Y02082 19160002
STATOLD  EQU   X'01'                    DISP=OLD INDICATOR       Y02082 19162002
AVTDISP  EQU   29                       DISPLACEMENT TO THE AVT SA53147 19210002
*                                       ADDRESS IN THE DEB      SA53147 19220002
DEBSIZE  EQU   48                       SIZE OF THE DEB         SA53147 19230002
UNRELATD EQU   X'02'                    UNRELATED FLAG IN IOB    A37199 19450021
*                                                                       19750021
         BALR  RBASE,R0                                                 20100013
         USING BEGIN,RBASE                                              20400013
         USING RENAMWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 20700002
         USING UCB,RUCB                                                 21000013
         USING CVT,RCVT                                                 21300013
*                                                                       21700002
BEGIN    L     RCVT,CVTPTR                                              21900013
         TM    SISW2,DEMNTSW+MOUNTSW+VERIFYSW  TEST IF RETURN    Y02134 21950002
*                                       FROM DEMOUNT, MOUNT,     Y02134 22000002
*                                       AND/OR VERIFY FUNCTION   Y02134 22050002
         BNZ   RETURNPT                 BRANCH IF YES            Y02134 22100002
*                                                                       22200013
*** BUILD CONTROL BLOCKS                                                22500013
*                                                                       22800013
         XC    WKADEB(DEBSIZE),WKADEB   ZERO THE DEB             Y02082 22900002
         MVC   WKADEB+AVTDISP(K3),CVTXAPG+K1  INSERT IOS AVT ADR Y02082 23000002
         LA    R1,WKADEB                BUILD THE DEB            Y02082 23100002
         MVI   16(R1),X'01'                  NUM OF EXTS = 1            23700013
         LA    R2,DCB                                                   24000013
         ST    R2,24(R1)                     INSERT DCB ADDR            24300013
         MVI   24(R1),X'0F'                  INSERT DEB ID              24600013
         MVI   28(R1),X'04'                  INSERT EXT SCALE           25200013
         MVC   42(6,R1),EXTCONST             INSERT EXTS AND TK COUNT   25500013
         ST    R1,DEBPTR                BUILD DCB                       25800013
         OI    IOB,UNRELATD             SET UNRELATED BIT IN IOB A37199 26000021
         LA    WORKREG,ECB              BUILD IOB                       26100013
         ST    WORKREG,IOB+4                 INSERT ECB ADDR            26400013
         LA    RETURN,CCW1                                       A37199 26800021
         LA    WORKREG,DCB                                              27300013
         STM   RETURN,WORKREG,IOB+16    CCW AND DCB ADDRESSES    A37199 27600021
NEXTVOL  EQU   *                        NEXT VOLUME              Y02082 27700002
         LH    VOLCTR,VOLNUM            LOAD NUMBER OF VOLUMES LEFT     27900013
         L     VOLISTX,VOLPTR           LOAD VOLUME LIST INDEX          28200013
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 28300002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 28400002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 28500002
         MVI   STATUS(VOLISTX),K0       CLEAR STATUS BYTE IN     Y02082 28600002
*                                       THIS VOLUME LIST ENTRY   Y02082 28700002
         DROP  R1                                                Y02082 28800002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 28900002
         MVC   PVOLSER,VOLSER(VOLISTX)  SAVE VOLSER IN WRK AREA  YM1337 29000002
         OC    PVOLSER,PVOLSER          TEST FOR VALID VOLSER    YM1337 29100002
         BZ    NODEVICE                 NO UNIT IF ZERO          Y02082 29200002
*                                                                       29300002
* THE FOLLOWING SECTIONS TRY TO FIND THE UCB ADDRESS OF THE CURRENT     29400002
* VOLUME IN THE VOLUME LIST. FIRST, IT SEARCHES THE TIOT TO SEE IF      29500002
* THE VOLUME IS MOUNTED ON A UNIT ALLOCATED TO THE JOB. IF NOT, IT      29600002
* SEARCHES THE UCB LOOKUP TABLE TO DETERMINE IF THE VOLUME IS MOUNTED   29700002
* ANYWHERE. IF IT IS MOUNTED, DYNAMIC ALLOCATION IS CALLED TO TRY TO    29800002
* ALLOCATE THE UNIT. IF THE VOLUME IS NOT MOUNTED ANYWHERE OR IF IT     29900002
* CANNOT BE DYNAMICALLY ALLOCATED, THE VOLUME WILL BE MOUNTED ON THE    30000002
* PRIMARY UCB, IF ONE EXITS.                                            30100002
*                                                                       30200002
FINDUCB  EQU   *                        FIND UCB                 Y02082 30300002
         L     RDSAB,DSABQDB            LOAD DSAB QDB ADDRESS    Y02082 30400002
         USING QDB,RDSAB                QDB ADDRESSABILITY       Y02082 30500002
         L     RDSAB,QDBFELMP           GET FIRST DSAB ADDRESS   Y02082 30600002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02082 30700002
DSABTEST EQU   *                        DSAB TEST                Y02082 30800002
         LTR   RDSAB,RDSAB              IS THERE ANOTHER DSAB    Y02082 30900002
         BZ    TABLSRCH                 BRANCH IF NOT            Y02082 31000002
         L     RTIOT,DSABTIOT           GET TIOT POINTER         Y02082 31100002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02082 31200002
         SR    REND,REND                ZERO REGISTER FOR IC     Y02082 31300002
         IC    REND,TIOELNGH            LENGTH OF TIOT ENTRY     Y02082 31400002
         AR    REND,RTIOT               ADDRESS OF FIRST BYTE    Y02082 31500002
*                                       PAST THE TIOT ENTRY      Y02082 31600002
         LA    RTIOT,TIOEFSRT-K1        ADDR OF FIRST UCB ADDR   Y02082 31700002
UCBTEST  EQU   *                        UCB TEST                 Y02082 31800002
         CR    RTIOT,REND               TEST IF AT END OF ENTRY  Y02082 31900002
         BNL   NEXTDSAB                 BRANCH IF YES            Y02082 32000002
         L     RUCB,K0(,RTIOT)          GET UCB ADDRESS          Y02082 32100002
         LA    RUCB,K0(RUCB)            CLEAR HIGH BYTE          Y02082 32200002
         LTR   RUCB,RUCB                IS THERE A UCB ADDRESS   Y02082 32300002
         BZ    NXTENTRY                 BRANCH IF NOT            YM1063 32400002
         CLC   SRTEVOLI,PVOLSER         COMPARE VOL SER NUMBERS  YM1337 32500002
         BNE   NXTENTRY                 BRANCH IF NOT EQUAL      Y02082 32600002
         CLC   UCBTBYT3(K2),K2(VOLISTX)  COMPARE DEVICE TYPES    Y02082 32700002
         BNE   NXTENTRY                 BRANCH IF NOT EQUAL      Y02082 32800002
         TM    UCBTBYT3,UCB3DACC        TEST IF DIRECT ACCESS    Y02082 32900002
         BZ    NXTENTRY                 BRANCH IF NOT            Y02082 33000002
         TM    SRTESTAT,SRTEONLI        TEST IF ONLINE           Y02082 33100002
         BO    FOUNDUCB                 BRANCH IF ONLINE         Y02082 33200002
NXTENTRY EQU   *                        NEXT UCB                 Y02082 33300002
         LA    RTIOT,L'TIOESTTB+L'TIOEFSRT(,RTIOT)  INCREMENT TO Y02082 33400002
*                                       NEXT UCB ADDRESS IN TIOT Y02082 33500002
         B     UCBTEST                  GO TEST NEXT UCB ADDRESS Y02082 33600002
NEXTDSAB EQU   *                        NEXT DSAB                Y02082 33700002
         L     RDSAB,DSABFCHN           GET NEXT DSAB ADDRESS    Y02082 33800002
         B     DSABTEST                 GO TEST IT               Y02082 33900002
FOUNDUCB EQU   *                        FOUND IT                 Y02082 34000002
         ST    RDSAB,DSABADDR           SAVE DSAB ADDRESS        Y02082 34100002
         ST    RUCB,WKADEB+UCBADDR      SAVE UCB ADDRESS IN DEB  Y02082 34200002
         MVI   WKADEB+UCBADDR,DEVMOD    INSERT DEVICE MODIFIER   Y02082 34300002
         L     RETURN,DSABTIOT          LOAD TIOT ENTRY ADDRESS  YM7036 34310002
         LA    RETURN,TIOEJFCB-TIOENTRY(,RETURN)  POINT TO JFCB  YM7036X34320002
                                        PREFIX ADDRESS           YM7036 34340002
         IECRES LOCJFCB,(RETURN)        LOCATE THE JFCB          YM7036 34360002
         CLC   PDSNAME,JFCBDSNM-INFMJFCB(RETURN)  CHECK IF       YM7036X34380002
                                        THIS IS THE RIGHT TIOT   YM7036X34400002
                                        ENTRY FOR THIS DSNAME    YM7036 34420002
         BE    MOUNTED                  BRANCH IF CORRECT        YM7036 34440002
         OI    SISW2,UCBFNDSW           SET THE UCB FOUND SWITCH YM7036 34460002
         B     NXTENTRY                 GO TRY NEXT TIOT ENTRY   YM7036 34480002
*                                                                       34500002
* THIS SECTION SEARCHES THE UCB LOOKUP TABLE TO DETERMINE IF THE        34600002
* VOLUME IS MOUNTED ANYWHERE.                                           34700002
*                                                                       34800002
TABLSRCH EQU   *                        UCB LOOKUP TABLE SEARCH  Y02082 34900002
         TM    SISW2,UCBFNDSW           TEST IF A UNIT WAS FOUND YM7036 34920002
         BNO   LDLOOKUP                 BRANCH IF NOT            YM7515 34930002
         L     RUCB,WKADEB+UCBADDR      LOAD FOUND UCB ADDRESS   YM7515 34940002
         LA    RUCB,K0(RUCB)            CLEAR HIGH BYTE          YM7515 34950002
         B     MOUNTED                  GO TEST IF VERIFIED      YM7515 34960002
LDLOOKUP EQU   *                        LOAD UCB LOOKUP TABL ADR YM7515 34970002
         L     R2,CVTILK2               GET LOOKUP TABLE ADDRESS Y02082 35000002
UCBLOOP  EQU   *                        NEXT                     Y02082 35100002
         SR    RUCB,RUCB                CLEAR REG              @ZA01347 35150003
         ICM   RUCB,K3,K0(R2)           GET UCB ADDR           @ZA01347 35200003
         CLM   RUCB,K3,EXTCONST         TEST IF AT END OF TBL  @ZA05225 35300003
         BE    ENDADDR                  BRANCH IF YES            Y02082 35400002
         LTR   RUCB,RUCB                UCB TABLE MAY HAVE HOLES Y02082 35500002
         BZ    NEXTADDR                 BRANCH IF NO ADDRESS     Y02082 35600002
         TM    UCBTBYT3,UCB3DACC        TEST IF DIRECT ACCESS    Y02082 35700002
         BZ    NEXTADDR                 BRANCH IF NOT            Y02082 35800002
         TM    SRTESTAT,SRTEONLI        TEST IF ONLINE           Y02082 35900002
         BZ    NEXTADDR                 BRANCH IF NOT ONLINE     Y02082 36000002
         CLC   SRTEVOLI,PVOLSER         COMPARE VOL SER NUMBERS  YM1337 36100002
         BNE   NEXTADDR                 BRANCH IF NOT EQUAL      Y02082 36200002
         CLC   UCBTBYT3(K2),K2(VOLISTX)  COMPARE DEVICE TYPES    Y02082 36300002
         BNE   NEXTADDR                 BRANCH IF NOT EQUAL      YM1063 36400002
         TM    UCBSTAB,UCBBSVL          TEST IF NONSHAREABLE     YM7377 36450002
         BZ    ALLOCVOL                 BRANCH IF SHAREABLE TO   YM7377X36500002
                                        TRY TO ALLOCATE THE UNIT YM1063 36550002
         B     ENDADDR                  DON'T TRY TO DYNAMICALLY YM1063 36600002
*                                       ALLOCATE IF NONSHAREABLE YM1063 36650002
NEXTADDR EQU   *                        GET NEXT ADDR            Y02082 36700002
         LA    R2,K2(R2)                PT TO NEXT ADDR IN TABLE Y02082 36800002
         B     UCBLOOP                  GO TRY NEXT UCB ADDRESS  Y02082 36900002
*                                                                       36950002
ENDADDR  EQU   *                        NO MORE                  Y02082 37000002
         L     RUCB,PRUCBPTR            LOAD PRIMARY UCB ADDRESS Y02082 37100002
         LTR   RUCB,RUCB                IS THERE A PRIMARY UCB   Y02082 37200002
         BZ    NODEVICE                 BRANCH IF NO PRIMARY UCB Y02082 37300002
         CLC   UCBTBYT3(K2),K2(VOLISTX)  COMPARE DEVICE TYPES    Y02082 37400002
         BNE   NODEVICE                 BRANCH IF NOT EQUAL      Y02082 37500002
*                                                                       37600002
* THIS SECTION PREPARES TO BRANCH TO IGG0300F TO DEMOUNT (IF REQUIRED)  37700002
* AND MOUNT AND/OR VERIFY THE NEXT VOLUME.                              37800002
*                                                                       37900002
MOUNTVOL EQU   *                        MOUNT A VOLUME           Y02134 38000002
         ST    RUCB,WKADEB+UCBADDR      MODIFY UCB ADDR IN DEB   Y02134 38100002
         MVI   WKADEB+UCBADDR,DEVMOD    INSERT DEVICE MODIFIER   Y02134 38200002
         OI    SISW2,DEMNTSW+MOUNTSW    SET DEMOUNT & MOUNT SW   Y02134 38300002
         MVC   DSABADDR,PRDSABAD        INITIALIZE DSAB ADDRESS  Y02134 38400002
VERIFY   EQU   *                        VERIFY A VOLUME          Y02134 38500002
         LA    R2,WKADEB                DEB ADDR IN REGISTER 2   Y02134 38700002
         LA    R3,PVOLSER               VOLSER ADDR IN REG 3     YM1337 38800002
         L     R4,RETNAME               RETURN NAME IN REG 4     Y02134 39000002
         LA    R7,MNTLOAD               POINT TO ID OF IGG0300F  Y02134 39100002
         B     LOADEXIT                 GO BRANCH TO IGG0300F    Y02134 39200002
*                                                                       39300002
* THIS SECTION TESTS THE RETURN CODE FROM THE DEMOUNT/MOUNT ROUTINE.    39400002
*                                                                       39500002
RETURNPT EQU   *                        RETURN HERE              Y02134 39600002
         NI    SISW2,X'FF'-DEMNTSW-MOUNTSW-VERIFYSW  RESET SW    Y02134 39700002
         B     TESTERR(RETURN)          RETURN CODE BRANCH TABLE Y02134 39800002
TESTERR  EQU   *                        TEST FOR ERROR           Y02134 39900002
         B     MOUNTED                  VOLUME MOUNTED/VERIFIED  Y02134 40000002
         B     NODEVICE                 UNSUCCESSFUL DEMOUNT     Y02134 40100002
         B     NOMOUNT                  MOUNT/VERIFY FAILED      Y02134 40200002
         B     PERMERR                  I/O ERROR OCCURRED       Y02134 40300002
*                                                                       40400002
* THIS SECTION PREPARES TO BRANCH TO THE NEXT LOAD OF RENAME.           40500002
*                                                                       40600002
MOUNTED  EQU   *                        VOLUME MOUNTED           Y02134 40700002
         NI    SISW2,X'FF'-UCBFNDSW     TURN OFF UCB FOUND SWTCH YM7036 40750002
         TM    UCBDMCT,UCBMOUNT         TEST MOUNT BIT           Y02134 40800002
         BNO   VERIFIED                 BRANCH IF VERIFIED       Y02134 40900002
         OI    SISW2,VERIFYSW           SET VERIFY SWITCH        Y02134 40920002
         B     VERIFY                   BRANCH TO VERIFY         Y02134 41000002
VERIFIED EQU   *                        VOLUME VERIFIED          Y02134 41020002
         NI    RTYPEFLG,X'FF'-NOMNTDEV  RESET THE 'NO DEVICE FOR Y02134 41100002
*                                       MOUNTING' SWITCH AS AT   Y02134 41200002
*                                       LEAST ONE VOL IS MOUNTED Y02134 41300002
         BCT   VOLCTR,MOREVOLS          TEST FOR LAST VOLUME     Y02082 41400002
         OI    RTYPEFLG,EXITBIT         SET EXIT BIT IF LAST VOL Y02082 41500002
MOREVOLS EQU   *                        MORE VOLUMES             Y02082 41600002
         LA    R1,ENTRYL(VOLISTX)       NEXT VOL LIST ENTRY ADDR Y02082 41700002
         ST    R1,VOLPTR                SAVE NEXT ENTRY ADDRESS  Y02082 41800002
         STH   VOLCTR,VOLNUM            SAVE UPDATED VOL COUNT   Y02082 41900002
NEXTLOAD EQU   *                        SET FOR NEXT LOAD        Y02082 42000002
         LA    R7,LOAD3                 POINT TO ID OF IGG03001  Y02082 42100002
*                                                                       42200002
* THIS SECTION BRANCHES TO ANOTHER LOAD OF RENAME.                      42300002
*                                                                       42400002
LOADEXIT EQU   *                        EXIT TO NEXT LOAD        Y02082 42500002
         IECRES LOAD,EXTPR=(RWKAREA),MODID=(R7),BRANCH=DIRECT    Y02082 42600002
*                                                                       42700002
* THIS SECTION SETS AN APPROPRIATE ERROR CODE IN THE STATUS BYTE        42800002
* OF THE CURRENT VOLUME LIST ENTRY. IF THE LAST VOLUME HAS BEEN         42900002
* PROCESSED, CONTROL IS PASSED TO THE NEXT LOAD OF RENAME. IF NOT,      43000002
* THE NEXT VOLUME LIST ENTRY IS PROCESSED.                              43100002
*                                                                       43200002
PERMERR  EQU   *                        I/O ERROR                Y02082 43300002
         LA    R3,IOERR                 I/O ERROR                Y02082 43400002
         B     SETCODE                  BRANCH TO SET ERROR CODE Y02082 43500002
NODEVICE EQU   *                        NO UNIT FOR MOUNTING     Y02082 43600002
         LA    R3,NODEVERR              NO UNIT FOR MOUNTING ERR Y02082 43700002
         B     SETCODE                  BRANCH TO SET ERROR CODE Y02082 43800002
NOMOUNT  EQU   *                        VOLUME NOT MOUNTED       Y02082 43900002
         LA    R3,NOMNTERR              VOLUME NOT MOUNTED ERROR Y02082 44000002
SETCODE  EQU   *                        SET ERROR CODE           Y02082 44100002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 44200002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 44300002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 44400002
         DROP  R1                                                Y02078 44500002
         STC   R3,STATUS(VOLISTX)       PUT ERROR CODE IN VOLIST Y02078 44600002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 44700002
         BCT   VOLCTR,NOTLAST           TEST IF LAST VOLUME      Y02082 44800002
         OI    RTYPEFLG,EXITBIT         SET EXIT BIT IF LAST VOL Y02082 44900002
NOTLAST  EQU   *                        NOT LAST                 Y02082 45000002
         LA    R1,ENTRYL(VOLISTX)       NEXT VOL LIST ENTRY ADDR Y02082 45100002
         ST    R1,VOLPTR                SAVE NEXT ENTRY ADDR     Y02082 45200002
         STH   VOLCTR,VOLNUM            SAVE UPDATED VOL COUNT   Y02082 45300002
         LA    RTNCODE,RTNCODE8         NORMAL ERROR RETURN CODE Y02082 45400002
         STH   RTNCODE,ERCODE           SAVE ERROR RETURN CODE   Y02082 45500002
         TM    RTYPEFLG,EXITBIT         TEST IF LAST VOLUME      Y02082 45600002
         BZ    NEXTVOL                  BRANCH IF NOT TO PROCESS Y02082 45700002
*                                       THE NEXT VOLUME          Y02082 45800002
         TM    RTYPEFLG,NOMNTDEV        TEST IF AN ERROR CODE OF Y02082 45900002
*                                       4 MUST BE RETURNED TO    Y02082 46000002
*                                       CALLER IN REGISTER 15    Y02082 46100002
         BZ    NEXTLOAD                 BRANCH IF NOT            Y02082 46200002
         MVI   ERCODE+K1,RTNCODE4       SET RETURN CODE TO 4     Y02082 46300002
         B     NEXTLOAD                 GO BRANCH TO IGG03001    Y02082 46400002
*                                                                       46500002
* THIS SECTION BUILDS THE REQUEST BLOCK TO INTERFACE WITH DYNAMIC       46600002
* ALLOCATION (SVC 99) TO TRY TO ALLOCATE THE UNIT ON WHICH THE          46700002
* CURRENT VOLUME IN THE VOLUME LIST IS MOUNTED.                         46800002
*                                                                       46900002
ALLOCVOL EQU   *                        TRY TO ALLOCATE THE UNIT Y02082 47000002
         LA    RPARM,VTOCDSCB           PARAMETER LIST BASE      Y02082 47100002
         USING S99RBP,RPARM                                      Y02082 47200002
         LA    RWRK,K4(,RPARM)          INCREMENT BY FOUR        Y02082 47300002
         ST    RWRK,S99RBPTR            SET UP REQUEST BLOCK PTR Y02082 47400002
         OI    S99RBPTR,S99RBPND        TURN ON HIGH ORDER BIT   Y02082 47500002
         LR    RPARM,RWRK               ADDRESS OF REQUEST BLOCK Y02082 47600002
         USING S99RB,RPARM              REQ BLOCK ADDRESSABILITY Y02082 47700002
         XC    S99RB(S99RBEND-S99RB),S99RB  ZERO REQ BLOCK CORE  Y02082 47800002
         MVI   S99RBLN,S99RBEND-S99RB   LENGTH OF REQUEST BLOCK  Y02082 47900002
         MVI   S99VERB,S99VRBAL         INDICATE ALLOCATION      Y02082 48000002
         LA    RWRK,S99RBEND            ADDR OF TEXT POINTERS    Y02082 48100002
         ST    RWRK,S99TXTPP            PLACE IN REQUEST BLOCK   Y02082 48200002
         OI    S99FLG11,S99NOMNT        INDICATE THAT VOL MUST   Y02082 48300002
*                                       BE MOUNTED IF ALLOCATED  Y02082 48400002
         OI    S99FLG21,S99TIONQ+S99NORES  INDICATE TIOT ENQ'ED  Y02082 48500002
*                                       AND NO D/S RESERVATION   Y02082 48600002
         LR    RPARM,RWRK               ADDRESS OF TEXT POINTERS Y02082 48700002
         USING S99TUPL,RPARM            TEXT PTR ADDRESSABILITY  Y02082 48800002
*                                                                       48900002
* THIS SECTION BUILDS THE VOLSER TEXT UNIT.                             49000002
*                                                                       49100002
         LA    RTEXT,FW4(,RPARM)        BASE FOR TEXT UNIT       Y02082 49200002
         ST    RTEXT,S99TUPTR           PTR TO VOLSER TEXT UNIT  Y02082 49300002
         USING S99TUNIT,RTEXT           TEXT UNIT ADDRESSABILITY Y02082 49400002
         LH    RWRK,VOLSERKY            INDICATE VOLSER TEXT     Y02082 49500002
         STH   RWRK,S99TUKEY                                     Y02082 49600002
         LA    RWRK,K1                  ONE TEXT PARM            Y02082 49700002
         STH   RWRK,S99TUNUM                                     Y02082 49800002
         LA    RWRK,L'SRTEVOLI          LENGTH OF VOLSER         Y02082 49900002
         STH   RWRK,S99TULNG                                     Y02082 50000002
         MVC   S99TUPAR(L'SRTEVOLI),PVOLSER  GET VOLSER          YM1337 50100002
*                                                                       50200002
* THIS SECTION BUILDS THE UNIT TEXT UNIT.                               50300002
*                                                                       50400002
         LA    RTEXT,VOLTEXTL(,RTEXT)   INCREMENT BASE           Y02082 50500002
         ST    RTEXT,S99TUPTR+K4        POINT TO UNIT TEXT UNIT  Y02082 50600002
         LH    RWRK,UNITKEY             INDICATE UNIT SPECIFIED  Y02082 50700002
         STH   RWRK,S99TUKEY                                     Y02082 50800002
         LA    RWRK,K1                  ONE TEXT PARM            Y02082 50900002
         STH   RWRK,S99TUNUM                                     Y02082 51000002
         LA    RWRK,L'UCBNAME           LENGTH OF UCBNAME        Y02082 51100002
         STH   RWRK,S99TULNG                                     Y02082 51200002
         MVC   S99TUPAR(L'UCBNAME),UCBNAME  GET UNIT NUMBER      Y02082 51300002
*                                                                       51400002
* THIS SECTION BUILDS THE STATUS TEXT UNIT.                             51500002
*                                                                       51600002
         LA    RTEXT,UNITEXTL(,RTEXT)   UPDATE TEXT UNIT BASE    Y02082 51700002
         ST    RTEXT,S99TUPTR+K8        PTR TO STATUS TEXT UNIT  Y02082 51800002
         LH    RWRK,STATUSKY                                     Y02082 51900002
         STH   RWRK,S99TUKEY            INDICATE STATUS TEXT     Y02082 52000002
         LA    RWRK,K1                                           Y02082 52100002
         STH   RWRK,S99TUNUM            ONE TEXT PARM            Y02082 52200002
         STH   RWRK,S99TULNG            LENGTH OF TEXT PARM      Y02082 52300002
         MVI   S99TUPAR,STATOLD         INDICATE DISP=OLD        Y02082 52400002
*                                                                       52500002
* THIS SECTION BUILDS THE RETURN DDNAME TEXT UNIT.                      52600002
*                                                                       52700002
         LA    RTEXT,STATEXTL(,RTEXT)   INCREMENT TEXT UNIT BASE Y02082 52800002
         ST    RTEXT,S99TUPTR+K12       PTR TO DDNAME TEXT UNIT  Y02082 52900002
         LH    RWRK,RTNDDKEY            INDICATE RETURN DDNAME   Y02082 53000002
         STH   RWRK,S99TUKEY            SPECIFICATION            Y02082 53100002
         LA    RWRK,K1                  ONE TEXT PARM            Y02082 53200002
         STH   RWRK,S99TUNUM                                     Y02082 53300002
         LA    RWRK,L'TIOEDDNM                                   Y02082 53400002
         STH   RWRK,S99TULNG            LENGTH OF DDNAME         Y02082 53500002
         XC    S99TUPAR(L'TIOEDDNM),S99TUPAR  CLEAR FOR DDNAME   Y02082 53600002
         OI    S99TUPTR+K12,S99TUPLN    INDICATE END OF LIST     Y02082 53700002
         LA    R1,VTOCDSCB              POINT TO REQ BLOCK PTR   Y02082 53800002
         DYNALLOC                       ISSUE DYNAMIC ALLOCATION Y02082 53900002
         LTR   RTNCODE,RTNCODE          TEST IF SUCCESSFUL       Y02082 54000002
         BNZ   ENDADDR                  BRANCH IF NOT            Y02082 54100002
*                                                                       55000002
* THIS SECTION SEARCHES THE DSAB CHAIN TO FIND THE ADDRESS OF THE DSAB  55100002
* WHICH POINTS TO THE TIOT ENTRY CONTAINING THE DYNAMICALLY ALLOCATED   55200002
* DDNAME. RTEXT STILL POINTS TO THE DDNAME TEXT UNIT.                   55300002
*                                                                       55400002
         L     RDSAB,DSABQDB            LOAD DSAB QDB ADDRESS    Y02082 55500002
         USING QDB,RDSAB                QDB ADDRESSABILITY       Y02082 55600002
         L     RDSAB,QDBFELMP           GET FIRST DSAB ADDRESS   Y02082 55700002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02082 55800002
FINDDSAB EQU   *                        DSAB TEST                Y02082 55900002
         LTR   RDSAB,RDSAB              IS THERE ANOTHER DSAB    Y02082 56000002
         BZ    ENDADDR                  BRANCH IF NOT            Y02082 56100002
         L     RTIOT,DSABTIOT           GET TIOT POINTER         Y02082 56200002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02082 56300002
         CLC   TIOEDDNM,S99TUPAR        TEST IF CORRECT DSAB     Y02082 56400002
         BE    FOUNDSAB                 BRANCH IF YES            Y02082 56500002
         L     RDSAB,DSABFCHN           GET NEXT DSAB ADDRESS    Y02082 56600002
         B     FINDDSAB                 CONTINUE SEARCH          Y02082 56700002
FOUNDSAB EQU   *                        GOT ONE                  Y02082 56800002
         OI    SISW1,UCBALLOC           SET UCB ALLOCATED BIT    Y02082 56900002
*                                                                       57000002
         OI    DSMADTB1,DSMUCBAL        SET UCB ALLOCATED BIT    Y02144 57100002
         ST    RDSAB,DSMADTW4           SAVE DSAB ADDRESS        Y02144 57200002
         ST    RDSAB,DSABADDR           SAVE DSAB ADDRESS        YM7036 57250002
         ST    RUCB,WKADEB+UCBADDR      SAVE UCB ADDRESS IN DEB  YM7036 57300002
         MVI   WKADEB+UCBADDR,DEVMOD    INSERT DEVICE MODIFIER   YM7036 57350002
         B     MOUNTED                  CONTINUE WITH RENAME     YM7036 57400002
*                                                                       67200013
*** PROGRAM CONSTANTS                                                   67500013
*                                                                       67800013
EXTCONST DC    X'FFFFFFFF7FFF'         LAST CCHH AND NUM OF TKS         68700013
         DS    0F                       FULLWORD BOUNDARY        Y02134 68800002
RETNAME  DC    CL4'3002'                RETURN NAME FOR IGG0300F Y02134 68900002
VOLSERKY DC    AL2(DALVLSER)            VOLSER TEXT UNIT KEY     Y02082 69000002
UNITKEY  DC    AL2(DALUNIT)             UNIT TEXT UNIT KEY       Y02082 69100002
STATUSKY DC    AL2(DALSTATS)            STATUS TEXT UNIT KEY     Y02082 69200002
RTNDDKEY DC    AL2(DALRTDDN)            RETURN DDNAME KEY        Y02082 69300002
*                                                                       69600002
*** TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                       69900002
*                                                                       70200002
         XCTLTABL ID=(LOAD3,01,MNTLOAD,0F),SVC=030,LENGTH=,      Y02082*70500002
               BRT=YES                                           Y02082 70800002
         SPACE 2                                                 Y02082 71100002
         IECDSECS CVT,DSAB,QDB,RB,TCB,TIOT,UCB,EXPAND=YES        Y02082 71400002
WORKAREA IECRENWA EP,ADT=YES            RENAME WORK AREA         Y02144 71700002
         EJECT                                                   Y02082 72000002
*                                                                       72300002
* DSECTS FOR INVOCATING DYNAMIC ALLOCATION (SVC 99)                     72600002
*                                                                       72900002
         IEFZB4D0                       DYNAMIC ALLOCATION DSECT Y02082 73200002
         EJECT                                                   Y02082 73500002
         IEFZB4D2                       DYNAMIC ALLOCATION KEYS  Y02082 73800002
         EJECT                                                   YM7036 73850002
         IEFJFCBN                       JFCB DSECT               YM7036 73900002
         END                                                            92700013
./  ADD  SSI=50160075,NAME=IGG032I1
 TITLE 'IGG032I1 - ISAM ALLOCATE - VALIDITY CHECK'                      00020000
IGG032I1 CSECT                                                          00030021
*                                                                       00040002
*MODULE NAME = IGG032I1                                                 00042002
*                                                                       00044002
*DESCRIPTIVE NAME = ISAM ALLOCATE - VALIDITY CHECK                      00044402
*                                                                       00044802
*COPYRIGHT = NONE                                                       00045202
*                                                                       00045602
*CHANGE ACTIVITY = SEE BELOW                                            00045702
*                                                                       00045802
*          RELEASE 16 DELETIONS                                         00046000
*0000038600                                                       15708 00049016
*          RELEASE 17 DELETIONS                                         00052000
*1715001000,089680,089740                                         19342 00055000
*          RELEASE 18 DELETIONS                                         00058000
*3126038200,060600-060800,063400-063600,070200-070400,070800-     23312 00058118
*3126071000,077660,078400-078600,079200-079400,097600,103200,     23312 00058218
*3126104200-105200                                                23312 00058318
*3126                                                             23428 00058518
*3126093600                                                       23475 00059018
*3126033200                                                       22224 00061018
*          RELEASE 19 DELETIONS                                         00064000
*1776083800-090200                                               O19113 00067019
*1776069460                                                      A28380 00068019
*          RELEASE 20 DELETIONS                                         00070000
*          RELEASE 21 DELETIONS                                         00076000
*0000064400-064800                                               M1273  00076402
*1194012950,034730-034820                                        M0705  00076521
*1194003400-007000,007600-008800,011800-015000,024200,031800-    S21016 00077021
*1194032000,033400-035000,038000,038620,058600-058800,059200,    S21016 00078021
*1194064000-064200,066800-067000,068200,068800,071200-071400,    S21016 00079021
*1194072200-072400,073000-073400,080200-080400,081200-081400,    S21016 00080021
*1194083600,092200-092600                                        S21016 00081021
*1194003500,003800-004000,005300,005500-005700,009600,025200-    A38860 00081102
*1194025400,037400,038580,038680-039200,039800,041400,042800,    A38860 00081202
*1194043800-044200,050200-050400,051400,052000,052400-052600,    A38860 00081302
*1194053600-053800,054600-055400,056600,057000,059000,059800,    A38860 00081402
*1194061800,062800,066200,067600,068400,069200,069430,069600,    A38860 00081502
*1194070980,071040,071200,071320,071600,073800,074800,075600,    A38860 00081602
*1194079300,080600,081600,083400,090400,091000,093000,103300-    A38860 00081702
*1194104000,105000,115600,117800-118000                          A38860 00081802
*          RELEASE 22 DELETIONS                                         00082000
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00088002
*0000000030-000150,000880-000940,007600,007900-008000,010600,    Y02080 00088102
*0000011200,011600-011690,015600,024800,025100-025200,025400-    Y02080 00088202
*0000025800,032600,035200,035320,038200,074600-075000,078020,    Y02080 00088302
*0000078100,099200-103000,103200-103400,104200,105000-105600,    Y02080 00088402
*0000106000,106400-117720                                        Y02080 00088502
*0000009400-009600,011200,033002,032016,032020,035230-035400,    Y02134 00088602
*0000038580,039400-039600,041600-041800,042600-043000,044600-    Y02134 00088702
*0000044800,051200-052200,069000-070000,077640-077650,106600,    Y02134 00088802
*0000107000-118120                                               Y02134 00088902
*0000077630-077660                                               Y02130 00089002
*0000                                                           YA03038 00090002
*0000                                                            YM4707 00091002
*0000                                                            YM7213 00091402
*0000068000,068800                                               YM7212 00092002
*          VS1 RELEASE 2 DELETIONS/CHANGES                              00096802
*0000065320-065340                                               XM1207 00096902
*          VS2 RELEASE 1 DELETIONS/CHANGES                              00097202
*0000                                                           OY00240 00098002
*          VS2 RELEASE 3 DELETIONS/CHANGES                              00098202
*0000                                                          @ZM30492 00098402
*                                                                       00100002
*STATUS CHANGE LEVEL 008                                                00103021
*                                                                       00112000
*FUNCTION - THIS MODULE CHECKS FOR A DUPLICATE NAME DSCB FORMAT 1       00120000
*           AND IF ONE EXISTS ITS LEGITIMACY IS EXAMINED. IF ILLEGITI-  00140000
*           MATE AN ERROR CODE IS SET AND A TRANSFER OF CONTROL IS      00160000
*           MADE TO MODULE IGG032I7 WHERE CODES ARE GOING TO BE         00180000
*           EXAMINED.   A CHECK IS MADE TO SEE IF THERE IS ENOUGH ROOM  00200000
*           IN THE VTOC.  ALSO THE ABSOLUTE TRACK AND QUANTITIES GIVEN  00220000
*           IN AN ABSOLUTE TRACK REQUEST ARE CHECKED FOR CYLINDER       00240000
*           BOUNDARIES.  CHECKS ARE MADE TO INSURE THAT THE TYPE OF     00260000
*           ALLOCATION IS THE SAME ACROSS DD CARDS AND THAT TWO         00280000
*           REQUESTS FOR THE SAME TYPE OF AREA ARE NOT MADE.            00300000
*                                                                       00320000
*           IF MORE THAN ONE DD STATEMENT IS USED IN REQUESTING         00330021
*           SPACE, THE SEVEN LOW-ORDER BYTES OF THE DDNAME FIELD        00340021
*           IN ALL BUT THE FIRST ISAM DD ENTRY ARE USED TO CREATE       00350021
*           THE FOLLOWING SPECIAL ISAM ALLOCATE INTERFACE:              00360021
*                                                                       00370021
*              BYTE 1                                                   00390021
*                   BITS 0 AND 1   00 - ABSOLUTE TRACK REQUEST          00410021
*                                  01 - BLANK SPACE REQUEST             00420021
*                                  11 - CONTIGUOUS SPACE REQUEST        00430021
*                                                                       00440021
*                   BIT 2          THIS IS THE SECOND DD CARD.          00450021
*                                                                       00460021
*                   BIT 5          OVFLOW HAS BEEN ALLOCATED.           00470021
*                                                                       00480021
*                   BIT 6          PRIME HAS BEEN ALLOCATED.            00490021
*                                                                       00500021
*                   BIT 7          INDEX HAS BEEN ALLOCATED.            00510021
*                                                                       00520021
*              BYTES 2 - 3         CURRENT VOLUME SEQUENCE NUMBER       00526021
*                                  FOR SECOND OR THIRD DD ENTRY         00532021
*                                                                       00540021
*              BYTES 4 - 7         POINTER TO THE FIRST TIOT ENTRY      00560021
*                                  FOR THIS REQUEST                     00580021
*                                                                       00720000
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG032I1.  ENTRY IS   00740000
*          MADE FROM THE SECOND LOAD OF ALLOCATE (MODULE IGG0325A)      00750021
*          OR FROM THE LAST LOAD OF ISAM ALLOCATE VIA A BRANCH.         00760002
*                                                                       00770021
*INPUT -  AT ENTRY TO THIS MODULE, REGISTER 11 POINTS TO A JFCB AND     00780021
*         REGISTER 13 POINTS TO THE ALLOCATE WORK AREA. THIS WORK AREA  00790002
*         CONTAINS A POINTER TO THE VARIABLE LENGTH DSAB LIST FOR THIS  00800002
*         REQUEST, THE ADDRESS OF THE FORMAT 4 DSCB, THE ADDRESS OF THE 00810021
*         FIRST FORMAT 5 DSCB, AND THE ADDRESS OF THE FORMAT 1 DSCB, IF 00820021
*         ONE EXISTS. THE FIRST FORMAT 5 DSCB IS ALSO IN THE WORK AREA. 00830021
*         THE VARIABLE LENGTH DSAB LIST HAS THE FOLLOWING FORMAT:       00835002
*         THE FIRST FULLWORD POINTS TO THE DSAB BEING ALLOCATED.        00840002
*         THE SECOND FULLWORD POINTS TO THE DSAB REPRESENTING THE       00845002
*         FIRST DD CARD.  THE THIRD IS ZERO IF THERE IS ONLY ONE        00850002
*         DD CARD, OR A POINTER TO THE DSAB FOR THE SECOND DD CARD.     00855002
*         THE FOURTH WORD IS ZERO IF THERE IS NO THIRD DD CARD, OR      00860002
*         A POINTER TO THE DSAB FOR THE THIRD DD CARD, OR ABSENT IF     00865002
*         THERE IS NO SECOND DD CARD.  THE FIFTH WORD IS ZERO IF        00870002
*         THERE ARE THREE CONCATENATED DD CARDS, OR ABSENT OTHERWISE.   00875002
*                                                                       00900000
*OUTPUT - UPON TRANSFERRING TO THE NEXT MODULE, IGG032I2, THE WORK AREA 00920000
*         CONTAINS THE PRIMARY AND DIRECTORY QUANTITIES, THE ABSOLUTE   00940002
*         TRACK ADDRESS, AND THE AMOUNT REQUESTED IN A MULTI-VOLUME     00980000
*         ABSOLUTE TRACK REQUEST.                                       01000000
*                                                                       01020000
*EXTERNAL ROUTINES -                                                    01040000
*   SVCS ISSUED - NONE                                                  01060002
*   MACROS USED - IEFJFCBN - BUILDS JFCB                                01080000
*                 IECALLWA - ALLOCATE WORK AREA EXPANSION               01090002
*                 IECSDSL1 - BUILDS DSCBS                               01100000
*                 IECDSECS - EXPANDS THE CVT, UCB, AND DSAB DSECTS      01120002
*                                                                       01140000
*EXITS - NORMAL - BRANCH TO MODULE IGG032I2                             01160002
*        - ERROR - BRANCH TO MODULE IGG032I7 WITH A CODE IN REGISTER 5  01169002
*                                                                       01178021
*        THE FOLLOWING ERROR CODES CAN BE ISSUED BY IGG032I1:           01187021
*                                                                       01196021
*        04 - DUPLICATE NAME DSCB EXISTS                                01205021
*                                                                       01214021
*        1C - WRONG DSORG OR DISP                                       01223021
*                                                                       01232021
*        20 - NO PRIME AREA REQUESTED                                   01241021
*                                                                       01250021
*        24 - PRIME AREA MUST BE REQUESTED BEFORE OVFLOW                01259021
*                                                                       01268021
*        2C - DSNAME ELEMENT DUPLICATION                                01277021
*                                                                       01286021
*        4C - NO SPACE PARAMETER GIVEN FOR A NEW DATA SET OR            01292021
*             ZERO SPACE REQUESTED AT ABSOLUTE TRACK ZERO               01298021
*                                                                       01304021
*        50 - INVALID REQUEST FOR EMBEDDED INDEX                        01313021
*                                                                       01322021
*        54 - MULTIVOLUME INDEX NOT ALLOWED                             01331021
*                                                                       01340021
*        58 - DSNAME ELEMENT INVALID                                    01349021
*                                                                       01358021
*        5C - MULTIVOLUME OVFLOW NOT ALLOWED                            01367021
*                                                                       01376021
*        60 - ABSTR AND CYL REQUESTS CONFLICT                           01385021
*                                                                       01394021
*        64 - CYL AND CONTIG REQUESTS CONFLICT                          01403021
*                                                                       01412021
*        68 - INVALID SPACE SUBPARAMETER                                01421021
*                                                                       01430021
*        70 - INDEX REQUEST DUPLICATION                                 01439021
*                                                                       01448021
*        84 - SPACE REQUEST MUST BE ABSTR FOR A DOS VOLUME              01457021
*                                                                       01466021
*        8C - INDEX MUST BE REQUESTED BEFORE PRIME AREA                 01475021
*                                                                       01484021
*        90 - INVALID THIRD DD CARD FOR ISAM ALLOCATION                 01493021
*                                                                       01520000
*                                                                       01540000
*TABLES/WORK AREAS - DADSM WORK AREA DESCRIBED BY MACRO 'IECALLWA'      01560002
*                                                                       01580000
*              ***************************************                  01600000
*              *             DADSM TABLE             *                  01620000
*              ***************************************                  01640000
*                                                                       01660000
*              ***************************************                  01680000
*              *        *         *                  *                  01700000
*              *  TYPE  *  NO OF  *     USED HOLE    *                  01720000
*              *  FLAG  * ENTRIES *      COUNTER     *                  01740000
*              *        *         *                  *                  01760000
*              ***************************************                  01780000
*              *                  *                  *                  01800000
*              *       RTA        *      RTA+1       *                  01820000
*              *                  *                  *                  01840000
*              ***************************************                  01860000
*              *                  *                  *                  01880000
*              *       RTA        *      RTA+1       *                  01900000
*              *                  *                  *                  01920000
*              ***************************************                  01940000
*              *                  *                  *                  01960000
*              *       RTA        *      RTA+1       *                  01980000
*              *                  *                  *                  02000000
*              ***************************************                  02020000
*              *                  *                  *                  02040000
*              *       RTA        *      RTA+1       *                  02060000
*              *                  *                  *                  02080000
*              ***************************************                  02100000
*              *                  *                  *                  02120000
*              *       RTA        *      RTA+1       *                  02140000
*              *                  *                  *                  02160000
*              ***************************************                  02180000
*                                                                       02200000
*                                                                       02220000
*              TYPE FLAG = 02 - BPAM DIRECTORIES REQUESTED.             02240000
*                                                                       02260000
*                        = 40 - USER LABELS REQUESTED                   02264021
*                                                                       02268021
*                        = 80 - SET MUST COMPLETE IS ACTIVE             02272021
*                                                                       02276021
*                                                                       02280000
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.    02300000
*                                                                       02320000
*                                                                       02340000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.        02360000
*                                                                       02380000
*                                                                       02400000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT. 02420021
*                                                                       02440000
*                                                                       02460000
*ATTRIBUTES - REENTRANT                                                 02480002
*                                                                       02500000
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    02510002
*          WORK AREA = AS DEFINED IN THE IECALLWA MACRO                 02520002
*          RPS WORK AREA = AS DEFINED IN THE IECRPS MACRO               02522002
*                                                                       02530021
*                                                                       02600000
*REGISTER USAGE                                                         02620000
*              REGISTERS 0-9 WORK REGISTERS                             02640000
*              REGISTER 10 - TIOT SET UP TABLE POINTER                  02660000
*              REGISTER 11 - JFCB POINTER                               02680000
*              REGISTER 12 - BASE REGISTER                              02700000
*              REGISTER 13 - WORK AREA POINTER                          02720000
*              REGISTER 14 SUBROUTINE LINKAGE AND WORK REGISTER         02740000
*              REGISTER 15 WORK REGISTER                                02760000
*                                                                       02780000
***** REGISTER NAMES *****                                              02800000
RZERO    EQU   0                                                        02820000
RONE     EQU   1                                                        02840000
RTWO     EQU   2                                                        02860000
RTHREE   EQU   3                                                        02880000
RFOUR    EQU   4                                                        02900000
RFIVE    EQU   5                                                        02920000
RSIX     EQU   6                                                        02940000
RSEVEN   EQU   7                                                        02960000
REIGHT   EQU   8                                                        02980000
RNINE    EQU   9                                                        03000000
RTEN     EQU   10                                                       03020000
RJFCB    EQU   11                                                       03040000
RBASE    EQU   12                                                       03060000
RWORK    EQU   13                                                       03080000
RETURN   EQU   14                                                       03100000
RFTEN    EQU   15                                                       03120000
*                                                                       03140000
*                                                                       03160000
* OTHER EQUATES                                                         03162021
*                                                                       03164021
*                                                                       03166021
ZERO     EQU   0                   CONSTANT OF ZERO              Y02134 03166202
K1       EQU   1                   CONSTANT OF ONE               Y02080 03166502
K2       EQU   2                   CONSTANT OF TWO               Y02080 03167002
K3       EQU   3                   CONSTANT OF THREE             Y02080 03167502
FOUR     EQU   4                   CONSTANT OF FOUR              Y02134 03167702
DUPLCATE EQU   X'04'               DUPLICATE NAME ERROR CODE     S21016 03168021
BADDSORG EQU   X'1C'               WRONG DSORG OR DISP ERROR     S21016 03170021
NOPRIME  EQU   X'20'               NO PRIME AREA REQUESTED       S21016 03172021
PRIME1ST EQU   X'24'               PRIME BEFORE OVFLOW ERROR     S21016 03174021
DUPELMNT EQU   X'2C'               DSNAME ELEMENT DUPLICATION    S21016 03176021
NOSPACE  EQU   X'4C'               NO SPACE PARAMETER ERROR      S21016 03178021
INVALIND EQU   X'50'               INVALID EMBEDDED INDEX ERROR  S21016 03180021
MVINDEX  EQU   X'54'               MULTIVOLUME INDEX ERROR CODE  S21016 03182021
INVALELM EQU   X'58'               INVALID DSNAME ELEMENT ERROR  S21016 03184021
MVOVFLOW EQU   X'5C'               MULTIVOLUME OVFLOW ERROR      S21016 03186021
NOTCYL   EQU   X'60'               ABSTR AND CYL CONFLICT        S21016 03188021
NOCONTIG EQU   X'64'               CYL AND CONTIG CONFLICT       S21016 03190021
SPACERR  EQU   X'68'               INVALID SPACE SUBPARAMETER    S21016 03192021
DUPINDEX EQU   X'70'               INDEX REQUEST DUPLICATION     S21016 03194021
ABSTRREQ EQU   X'84'               SPACE REQUEST NOT ABSTR       S21016 03196021
INVINDEX EQU   X'8C'               PRIME BEFORE INDEX ERROR      S21016 03198021
INVDDCRD EQU   X'90'               INVALID THIRD DD CARD         S21016 03200021
TIOEVOLS EQU   2                   OFFSET TO NUMBER OF DEVICES   A38860 03200421
TIOEDDNM EQU   4                   OFFSET TO DDNAME              A38860 03200621
ISAMSTAT EQU   5                   OFFSET TO ALLOCATION STATUS   A38860 03200821
VOLSQCTR EQU   6                   OFFSET TO DS1VOLSQ COUNTER    A38860 03201021
TIOTPTR  EQU   8                   PTR TO 1ST ISAM TIOT ENTRY    A38860 03201221
UCBENTRY EQU   16                  OFFSET TO FIRST UCB ENTRY     A38860 03201421
BLANK    EQU   X'40'               EBCDIC BLANK                  A38860 03201821
CURRDSAB EQU   0                   CURRENT DSAB OFFSET           Y02134 03202002
FRSTDSAB EQU   4                   FIRST DSAB OFFSET             Y02134 03202202
SCNDDSAB EQU   8                   SECOND DSAB OFFSET            Y02134 03202402
THRDDSAB EQU   12                  THIRD DSAB OFFSET             Y02134 03202602
ONE16    EQU   116                 116 CYLINDERS                 Y02130 03202802
DA3340   EQU   X'0A'               3340 DEVICE TYPE              Y02130 03203002
K12      EQU   12                  CONSTANT OF TWLEVE            Y02130 03203202
*                                                                       03210002
         BALR  RBASE,0                                                  03220000
         USING ALPHA,RBASE                                              03240000
         USING ALLOCWKA,RWORK           WORK AREA ADDRESSABILITY Y02080 03260002
         USING JFCBKEN,RJFCB                                            03280000
*                                                                       03290021
ALPHA    TM    DS4VTOCI,X'80'          CHECK FOR BOS PACK               03300000
         BC    8,NOTBOS                 IF NOT BOS, BRANCH        22224 03320018
         TM    JFCBCTRI,X'DF'      CHECK IF ABSTR WITH DOS PACK  S21016 03329021
         BZ    CHECK               BRANCH IF ABSOLUTE TRACK      S21016 03338021
         LA    RFIVE,ABSTRREQ      SPACE REQUEST MUST BE ABSTR   S21016 03347021
         B     ERRORXCT                                          S21016 03356021
NOTBOS   EQU   *                                                 S21016 03365021
         TM    JFCBCTRI,X'C0'      IS IT A CYL OR ABSTR REQUEST  S21016 03374021
         BC    9,CHECK             BRANCH IF CYL OR ABSTR        S21016 03383021
         LA    RFIVE,SPACERR       INVALID SPACE REQUEST ERROR   S21016 03392021
         B     ERRORXCT                                          S21016 03401021
CHECK    EQU   *                                                 S21016 03410021
         CLI   CTR,X'00'           CHECK IF ENTRY FROM SECOND    S21016 03419021
*                                  LOAD OF ALLOCATE OR LAST LOAD S21016 03428021
*                                  OF ISAM ALLOCATE              S21016 03437021
         BNE   REJOIN              BRANCH IF FROM LAST LOAD      S21016 03446021
         TM    JFCBCTRI,X'DF'      CHECK REQUEST TYPE FIELD      S21016 03455021
         BC    5,GETTIOT           BRANCH IF CYLINDERS           S21016 03464021
*                                                                       03466021
* THIS SECTION TESTS IF ANY SPACE WAS REQUESTED. IF NOT, THE ABSOLUTE   03468021
* TRACK ADDRESS IS TESTED FOR ZERO TO DETERMINE IF A SPACE PARAMETER    03470021
* WAS GIVEN FOR THIS DATA SET.                                          03472021
*                                                                       03474021
         OC    JFCBPQTY,JFCBPQTY        ANY SPACE REQUESTED      M0705  03476021
         BNZ   GETTIOT                  BRANCH IF YES            M0705  03478021
         OC    JFCBABST(2),JFCBABST     IS ABSOLUTE TRACK ZERO   M0705  03480021
         BNZ   GETTIOT                  BRANCH IF NOT ZERO       M0705  03482021
         LA    RFIVE,NOSPACE       NO SPACE PARAMETER ERROR      S21016 03491021
         B     ERRORXCT                                          S21016 03500021
GETTIOT  EQU   *                                                 S21016 03509021
         L     RTEN,ADSABLST            PICK UP PTR TO DSAB LIST Y02080 03520002
         L     RTEN,CURRDSAB(RTEN)      GET CURRENT DSAB ADDR    Y02134 03523002
         USING DSAB,RTEN                                         Y02134 03533002
         L     RTEN,DSABTIOT            GET CURRENT TIOT ADDR    Y02134 03543002
         DROP  RTEN                                              Y02134 03553002
* THIS SECTION CHECKS FOR LEGITIMACY OF DUPLICATE NAME F1 IF ONE EXISTS 03560000
         XC    SAVEADR(5),SAVEADR       CLEAR FORMAT 1 ADDRESS          03580000
         CLI   DS1FMTID,X'F1'           TEST FOR A DUPLICATE NAME DSCB  03600000
*                                          BY CHECKING THE FORMAT       03620000
*                                          IDENTIFIER TO SEE IF THE 1ST 03640000
*                                          LOAD OF ALLOCATE READ IN A   03660000
*                                          FORMAT 1 DSCB                03680000
         BNE   AROUND                   BRANCH IF NO DUPLICATE NAME     03700000
*                                          DSCB                         03720000
         CLI   TIOEDDNM(RTEN),BLANK     CHECK FOR DDNAME IN TIOT A38860 03740021
         BE    MORETHAN                 BRANCH IF THERE IS NO DDNAME-   03760000
*                                          NOT FIRST TIOT ENTRY         03780000
DUPNAME  EQU   *                                                 S21016 03790021
         LA    RFIVE,DUPLCATE      DUPLICATE NAME ERROR CODE     S21016 03800021
ERRORXCT EQU   *                                                  23312 03810018
         LA    RTHREE,LASTLOAD          SET 7TH LOAD ID          Y02080 03820002
         B     XCT                                                      03840000
*                                                                 15708 03842016
*              NO DDNAME IMPLIES CONCATENATION WITH A             15708 03844016
*              PREVIOUS DD CARD.  A BLANK TIOT POINTER ENTRY      15708 03846016
*              INDICATES THAT AN INVALID CONDITION EXISTS,        15708 03848016
*              DSORG=IS WAS NOT SPECIFIED FOR THE PRECEEDING      15708 03850016
*              DD CARD.                                           15708 03852016
*                                                                 15708 03854016
MORETHAN EQU   *                                                  15708 03856016
         CLC   TIOTPTR(FOUR,RTEN),BLANKS  CHECK TIOT POINTER     Y02134 03858002
         BC    7,CONTINUE         BRANCH IF NOT EQUAL TO BLANKS   15708 03860016
DSDISP   EQU   *                                                OY00240 03860402
         LA    RFIVE,BADDSORG      WRONG DSORG ERROR CODE        S21016 03862021
         B     ERRORXCT                                           15708 03864016
CONTINUE EQU   *                                                  15708 03866016
         L     RNINE,TIOTPTR(,RTEN)     PTR TO 1ST TIOT ENTRY    A38860 03886021
         L     RSIX,UCBENTRY(,RTEN)     SET PTR TO 1ST UCB ENTRY A38860 03906021
         LA    RSIX,ZERO(,RSIX)         TIOT ENTRY HAS UCB ADDR  Y02134 03940002
         TM    ISAMSTAT(RTEN),X'20'     CHECK STATUS BYTE IN THE A38860 03980021
*                                          NEXT TIOT ENTRY FOR THE FLAG 04000000
*                                          SET TO INDICATE THIS ENTRY   04020000
*                                          AS THE SECOND ENTRY          04040000
         BC    1,PICKUP                 BRANCH IF THIS ENTRY IS THE     04060000
*                                          SECOND ENTRY                 04080000
* THIS SECTION CHECKS TO SEE IF THE UCB IN THIS ENTRY IS THE SAME AS    04100000
* THE UCB IN THE FIRST TIOT ENTRY                                       04120000
*                                                                       04130021
         L     RSEVEN,UCBENTRY(,RNINE)  POINT TO ONLY UCB ENTRY  A38860 04140021
         LA    RSEVEN,ZERO(,RSEVEN)     CLEAR HIGH BYTE          Y02134 04160002
         CR    RSIX,RSEVEN              CHECK THE 12 BIT UCB POINTERS   04200000
         BE    LEGITIMT                 BRANCH IF THE UCB POINTERS ARE  04220000
*                                          EQUAL                        04240000
         L     RNINE,ADSABLST           GET ADDR OF DSAB LIST    Y02134 04250002
         L     RNINE,SCNDDSAB(,RNINE)   GET ADDR OF 2ND DSAB     Y02134 04260002
         USING DSAB,RNINE                                        Y02134 04270002
         L     RNINE,DSABTIOT           GET SECOND TIOT ENTRY    Y02134 04280002
         DROP  RNINE                                             Y02134 04290002
*                                                                       04300002
* THIS SECTION COMPARES THE FIRST UCB ENTRY IN THE SECOND OR THIRD      04320000
* TIOT ENTRY TO ALL OF THE UCB'S IN THE PRECEEDING TIOT ENTRY           04340000
*                                                                       04350002
PICKUP   SR    REIGHT,REIGHT                                            04360000
         IC    REIGHT,TIOEVOLS(,RNINE)  GET NUMBER OF UCB'S IN   A38860 04380021
*                                       THE PRECEDING TIOT ENTRY A38860 04400021
         LA    RNINE,UCBENTRY(,RNINE)   POINT TO 1ST UCB ENTRY   A38860 04420021
COMPARE  L     RSEVEN,0(RNINE)                                          04440000
         LA    RSEVEN,ZERO(,RSEVEN)     CLEAR HIGH BYTE          Y02134 04460002
         CR    RSIX,RSEVEN              CHECK UCB POINTERS              04500000
         BE    LEGITIMT                 BRANCH IF UCB POINTERS ARE      04520000
*                                          EQUAL                        04540000
         BCTR  REIGHT,0                 REDUCE NUMBER OF UCB'S IN       04560000
*                                          PREVIOUS TIOT ENTRY          04580000
         LTR   REIGHT,REIGHT            CHECK FOR LAST UCB ENTRY        04600000
         BZ    DUPNAME                  BRANCH IF LAST UCB ENTRY - THE  04620000
*                                          DUPLICATE NAME DSCB FORMAT 1 04640000
*                                          IS ILLEGAL                   04660000
         LA    RNINE,4(RNINE)           UPDATE POINTER                  04680000
         B     COMPARE                                                  04700000
* THIS SECTION TAKES THE CCHHR OF THE RECORD BEYOND THE DUPLICATE NAME  04720000
* DSCB FORMAT 1 AND CALCULATES THE ADDRESS OF THIS FORMAT 1.            04740000
LEGITIMT SR    RETURN,RETURN            REDUCE THE RECORD NUMBER BY ONE 04760000
         IC    RETURN,COUNT+4                                           04780000
         BCT   RETURN,ADJUST            CHECK FOR RECORD NUMBER ZERO -  04800000
*                                          BACKING OVER A TRACK BOUND-  04820000
*                                          ARY                          04840000
*                                       BRANCH IF RECORD NUMBER NOT     04860000
*                                          ZERO                         04880000
         IC    RETURN,DS4DEVDT          SET RECORD NUMBER TO MAXIMUM    04900000
*                                       NUMBER OF DCB'S PER TRACK       04920000
ADJUST   STC   RETURN,COUNT+4                                           04940000
         MVC   SAVEADR(5),COUNT         SAVE THE ADDRESS OF THE FORMAT1 04960000
* THIS SECTION CHECKS THE VALIDITY OF THE REQUEST AND SETS UP THE       04980000
* WORK AREA FOR THIS PASS THROUGH ISAM ALLOCATE                         05000000
AROUND   EQU   *                                                 A38860 05020021
         CLI   TIOEDDNM(RTEN),BLANK     DDNAME FOR THIS ENTRY?   A38860 05040021
         BE    NONAME                   BRANCH IF NO DDNAME             05060000
         MVI   F2,X'80'                 HAVE A DDNAME-NEED A DSCB F2 -  05080000
*                                          SET F2 FLAG                  05100000
*                                                                       05110002
* SINCE THE CURRENT TIOT ENTRY HAS A DDNAME, THIS SECTION OBTAINS       05120002
* THE SECOND DSAB POINTER TO GET THE SECOND TIOT ENTRY ADDRESS.         05130002
*                                                                       05140002
         L     REIGHT,ADSABLST          GET PTR TO DSAB LIST     Y02134 05150002
         L     REIGHT,SCNDDSAB(,REIGHT) GET SECOND DSAB PTR      Y02134 05160002
         LTR   REIGHT,REIGHT            TEST IF A SECOND EXISTS  Y02134 05170002
         BZ    THISIT                   BRANCH IF NOT            Y02134 05180002
         USING DSAB,REIGHT                                       Y02134 05190002
         L     REIGHT,DSABTIOT          GET 2ND TIOT ENTRY       Y02134 05200002
         DROP  REIGHT                                            Y02134 05210002
         CLI   TIOEDDNM(REIGHT),BLANK   CHECK FOR A DDNAME FOR   A38860 05240021
*                                       THE NEXT TIOT ENTRY      A38860 05260021
         BNE   THISIT                   BRANCH IF THERE IS NOT ANOTHER  05280000
*                                          TIOT ENTRY FOR THIS REQUEST  05300000
* THIS SECTION FILLS IN THE DDNAME FIELD OF THE NEXT TIOT ENTRY WITH    05320000
* INFORMATION ABOUT THIS TIOT ENTRY                                     05340000
         ST    RTEN,TIOTPTR(,REIGHT)    MOVE INTO NEXT ENTRY'S   A38860 05370021
*                                          DDNAME FIELD THE ADDRESS OF  05400000
*                                          THE FIRST TIOT ENTRY         05420000
         SR    RSIX,RSIX                                                05440000
         IC    RSIX,TIOEVOLS(,RTEN)     PICK UP NBR OF VOLUMES   A38860 05460021
         STC   RSIX,VOLSQCTR+1(,REIGHT) MOVE IN INITIAL VOL SEQ  A38860 05480021
         MVI   VOLSQCTR(REIGHT),X'00'                            A38860 05500021
         OI    ISAMSTAT(REIGHT),X'20'   TURN ON 2ND ENTRY BIT    A38860 05520021
         NI    ISAMSTAT(REIGHT),X'3F'   TURN OFF 2 BITS 0 AND 1  A38860 05540021
         TM    JFCBCTRI,X'DF'           CHECK REQUEST TYPE FIELD        05560000
         BC    8,AREADIAG               BRANCH IF AN ABSOLUTE TRACK     05580000
*                                          REQUEST                      05600000
CYLREQ   TM    JFCBCTRI,X'08'           CHECK FOR CYLINDER TYPE         05620000
         BC    1,CONTIGS                BRANCH IF CONTIGUOUS REQUESTED  05640000
         OI    ISAMSTAT(REIGHT),X'40'   SET BIT 1 - BLANK OPTION A38860 05660021
         B     AREADIAG                                                 05680000
CONTIGS  EQU   *                                                 A38860 05690021
         OI    ISAMSTAT(REIGHT),X'C0'   SET BITS 0 & 1 - CONTIG  A38860 05700021
*                                                                       05720000
AREADIAG CLC   JFCBELNM(8),INDEX        CHECK FOR THE ELEMENT NAME      05740000
*                                          ATTACHED TO THE DSNAME       05760000
INDEXTST EQU   AREADIAG                                          S21016 05770021
         BNE   NEXT1                    BRANCH IF NOT AN INDEX REQUEST  05780000
         OC    JFCBDQTY(3),JFCBDQTY     CHECK DIRECTORY QUANTITY FIELD  05800000
*                                          FOR EMBEDDED INDEX REQUEST   05820000
         BZ    CHEKMULT                 BRANCH IF NO EMBEDDING          05840000
ERROUT   EQU   *                                                 S21016 05850021
         LA    RFIVE,INVALIND      INVALID INDEX REQUEST ERROR   S21016 05860021
         B     ERRORXCT                                          S21016 05870021
CHEKMULT EQU   *                                                 A38860 05880021
         CLI   TIOEVOLS(RTEN),X'01'     TEST FOR MULTI-VOL INDEX A38860 05890021
         BE    SETTYPE             BRANCH IF NOT MULTI-VOLUME    S21016 05906021
MULTIVOL EQU   *                                                 S21016 05912021
         LA    RFIVE,MVINDEX       MULTI-VOLUME INDEX ERROR      S21016 05918021
         B     ERRORXCT                                          S21016 05924021
SETTYPE  EQU   *                                                 S21016 05930021
         MVI   TYPE,X'04'               SET TYPE FIELD TO INDICATE AN   05940000
*                                          INDEX REQUEST                05960000
         OI    ISAMSTAT(REIGHT),X'01'   SET BIT IN NEXT ENTRY    A38860 05980021
*                                          TO INDICATE AN  INDEX AREA   06000000
*                                          HAS BEEN REQUESTED           06020000
         B     MOVEFLDS                                                 06040000
* THIS SECTION JUST SETS UP A DUMMY POINTER FOR THE ONE DD ENTRY CASE   06050021
THISIT   LA    REIGHT,DADSMTBL          SET UP DUMMY POINTER     M1273  06052021
NEXT1    EQU   *                                                  23312 06060018
         EX    0,PRIMETST               CHECK DSN ELEMENT         23312 06080018
         BNE   NEXT2                    BRANCH IF PRIME NOT ELEMENT     06100000
*                                          NAME                         06120000
ALLGOOD  MVI   TYPE,X'01'               SET TYPE FIELD TO INDICATE A    06140000
*                                          PRIME REQUEST                06160000
         OI    ISAMSTAT(REIGHT),X'02'   SET BIT IN NEXT ENTRY    A38860 06180021
*                                          TO INDICATE A PRIME AREA     06200000
*                                          HAS BEEN REQUESTED           06220000
         OC    JFCBDQTY(3),JFCBDQTY     CHECK FOR EMBEDDED INDEX        06240000
         BZ    MOVEFLDS                 BRANCH IF NO EMBEDDED INDEX     06260000
         CLI   TIOEVOLS(RTEN),X'01'     TEST FOR MULTI-VOL PRIME A38860 06280021
         BE    MOVEFLDS                 BRANCH IF SINGLE VOLUME         06300000
         B     ERROUT                                                   06320000
NEXT2    EQU   *                                                  23312 06340018
         EX    0,BLANKTST               CHECK DSN ELEMENT         23312 06360018
         BE    ALLGOOD                  BRANCH IF BLANK ELEMENT NAME    06380000
         EX    0,OVFLWTST               CHECK DSN ELEMENT        M1273  06382021
         BE    INVOVFL                  BRANCH IF OVFLOW         M1273  06384021
*                                       ELEMENT NAME             M1273  06386021
         EX    0,INDEXTST               TEST IF INDEX REQUESTED  YM7213 06386402
         BE    INVNAME                  BRANCH IF YES - NO PRIME YM7213X06386602
                                        AREA WAS REQUESTED       YM7213 06386802
         CLI   TIOEDDNM(RTEN),BLANK     TEST IF 1ST DD CARD      YM4707 06387002
         BNE   INVELMNT                 IF YES, BR - INVALID     YM4707X06388002
                                        DATA SET ELEMENT NAME    YM4707 06389002
INVNAME  EQU   *                                                 S21016 06390021
         LA    RFIVE,NOPRIME       NO PRIME AREA REQUESTED       S21016 06400021
         B     ERRORXCT                                          S21016 06410021
* THIS SECTION CHECKS THE VALIDITY OF THIS DD CARD AS IT IS NOT THE     06500000
* FIRST FOR AN ISAM ALLOCATE                                            06520000
NONAME   EQU   *                                                OY00240 06530002
         CLC   TIOTPTR(4,RTEN),BLANKS   CHECK TIOT POINTER       XM1207 06532002
         BE    DSDISP                   BRANCH IF NOT PRESENT    XM1207 06534002
*                                       TO ISSUE X'1C' RETURN    XM1207 06536002
*                                       CODE WHICH WILL CAUSE    XM1207 06538402
*                                       MESSAGE IEF260I TO BE    XM1207 06538802
*                                       ISSUED                   XM1207 06539202
         MVI   F2,X'00'                 SET F2 FIELD TO         OY00240 06540002
*                               INDICATE THAT NO FORMAT 2 DSCB BE BUILT 06560002
         TM    JFCBCTRI,X'DF'           CHECK REQUEST TYPE FIELD        06580000
         BC    5,CYLREQTD               BRANCH IF REQUEST FOR CYLINDERS 06600000
         TM    ISAMSTAT(RTEN),X'C0'     CHECK PREVIOUS ISAM      A38860 06620021
*                                          DD ENTRY'S REQUEST TYPE      06640000
         BC    8,CHEKLAST               BRANCH IF TYPES AGREE           06660000
INVSPACE EQU   *                                                 S21016 06670021
         LA    RFIVE,NOTCYL        ABSTR AND CYL CONFLICT ERROR  S21016 06680021
         B     ERRORXCT                                          S21016 06690021
CYLREQTD TM    JFCBCTRI,X'08'           CHECK CYLINDER REQUEST FIELD    06720000
         BC    1,CONTIGUO               BRANCH IF CONTIGUOUS REQUESTED  06740000
         TM    ISAMSTAT(RTEN),X'C0'     CHECK PREVIOUS ISAM      A38860 06760021
*                                          DD ENTRY'S REQUEST TYPE      06780000
         BM    CHEKLAST                 BRANCH IF BOTH SPECIFY   YM7212X06790002
                                        CYL WITHOUT CONTIG       YM7212 06795002
         BZ    INVSPACE                 BRANCH IF PREVIOUS WAS   YM7212X06800002
                                        ABSTR BUT CURRENT IS CYL YM7212 06805002
CONTGERR EQU   *                                                 S21016 06810021
         LA    RFIVE,NOCONTIG      CYL AND CONTIG CONFLICT       S21016 06820021
         B     ERRORXCT                                          S21016 06830021
CONTIGUO EQU   *                                                 A38860 06840021
         TM    ISAMSTAT(RTEN),X'C0'     CHECK PREVIOUS ISAM      A38860 06850021
*                                          DD ENTRY'S REQUEST TYPE      06860000
         BZ    INVSPACE                 BRANCH IF PREVIOUS WAS   YM7212X06865002
                                        ABSTR BUT CURRENT IS     YM7212X06870002
                                        BOTH CYL AND CONTIG      YM7212 06875002
         BM    CONTGERR                 BRANCH IF PREVIOUS WAS   YM7212X06880002
                                        CYL BUT NOT CONTIG       YM7212 06881002
*                                                                       06885002
* THIS SECTION TESTS IF THERE ARE ANY MORE CONCATENATED DD CARDS.       06890002
* IF THE CURRENT DSAB IS THE THIRD DSAB ENTRY, THERE ARE NO MORE.       06895002
*                                                                       06900002
CHEKLAST EQU   *                        BRANCH LABEL             Y02134 06910002
         L     REIGHT,ADSABLST          GET DSAB LIST ADDR       Y02134 06920002
         CLC   THRDDSAB(FOUR,REIGHT),CURRDSAB(REIGHT) TEST IF    Y02134 06930002
*                                       CURRENT IS THE THIRD     Y02134 06940002
         BE    THISLAST                 BRANCH IF YES            Y02134 06950002
         L     REIGHT,THRDDSAB(,REIGHT) GET THIRD DSAB           Y02134 06960002
         LTR   REIGHT,REIGHT            TEST IF A THIRD EXISTS   Y02134 06970002
         BZ    THISLAST                 BRANCH IF NO             Y02134 06980002
         USING DSAB,REIGHT                                       Y02134 06990002
         L     REIGHT,DSABTIOT          GET TIOT ENTRY FOR 3RD   Y02134 07000002
         DROP  REIGHT                                            Y02134 07010002
         EX    0,PRIMETST               CHECK DSN ELEMENT         23312 07030018
         BE    CHEKSET                  BRANCH IF ELEMENT NAME IS PRIME 07060000
         EX    0,BLANKTST               CHECK DSN ELEMENT         23312 07090018
         BE    CHEKSET                  BRANCH IF BLANK          S21016 07092021
         EX    0,INDEXTST               CHECK DSN ELEMENT        S21016 07094021
         BNE   NOTINDEX                 BRANCH IF NOT INDEX      S21016 07096021
         TM    ISAMSTAT(RTEN),X'01'     TEST IF INDEX PREVIOUSLY A38860 07098021
*                                       REQUESTED BY 1ST DD CARD S21016 07100021
         BO    DUPLINDX                 BRANCH IF YES            S21016 07102021
         TM    ISAMSTAT(RTEN),X'02'     TEST IF PRIME PREVIOUSLY A38860 07104021
*                                       REQUESTED BY 1ST DD CARD S21016 07106021
         BNO   INVNAME                  NO PRIME REQUESTED ERROR S21016 07108021
INDEXPRE EQU   *                        INDEX BEFORE PRIME ERR  YA03038 07109002
         LA    RFIVE,INVINDEX           INDEX MUST PRECEDE PRIME S21016 07110021
         B     ERRORXCT                                          S21016 07112021
NOTINDEX EQU   *                                                 S21016 07114021
         EX    0,OVFLWTST               CHECK DSN ELEMENT        S21016 07116021
         BNE   INVELMNT                 BRANCH IF NOT OVFLOW     S21016 07118021
         TM    ISAMSTAT(RTEN),X'02'     TEST IF PRIME PREVIOUSLY A38860 07120021
*                                       REQUESTED BY 1ST DD CARD S21016 07122021
         BNO   LASTTEST                 BRANCH IF NOT            S21016 07124021
         LA    RFIVE,INVDDCRD           INVALID THIRD DD CARD    S21016 07126021
         B     ERRORXCT                                          S21016 07128021
LASTTEST EQU   *                                                 S21016 07130021
         TM    ISAMSTAT(RTEN),X'01'     TEST IF INDEX PREVIOUSLY A38860 07132021
*                                       REQUESTED BY 1ST DD CARD S21016 07134021
         BO    INVOVFL                  INVALID OVFLOW REQUEST   S21016 07136021
         B     INVNAME                  NO PRIME REQUESTED ERROR S21016 07138021
CHEKSET  EQU   *                                                 A38860 07148021
         TM    ISAMSTAT(RTEN),X'02'     CHECK TYPE PREVIOUSLY    A38860 07158021
*                                          REQUESTED IN THE DDNAME      07180000
         BC    8,CHEKAGN                BRANCH IF NOT REQUESTED TWICE   07200000
INVAREA  EQU   *                                                 S21016 07210021
         LA    RFIVE,DUPELMNT      DUPLICATE AREAS REQUESTED     S21016 07220021
         B     ERRORXCT                                          S21016 07230021
CHEKAGN OC     JFCBDQTY(3),JFCBDQTY     CHECK FOR EMBEDDED INDEX        07260000
*                                          REQUESTED                    07280000
         BZ    SETPRIME            BRANCH IF NO ERROR            S21016 07290021
DUPLINDX EQU   *                                                 S21016 07300021
         LA    RFIVE,DUPINDEX      DUPLICATE INDEX REQUEST ERROR S21016 07310021
         B     ERRORXCT                                          S21016 07320021
SETPRIME EQU   *                                                 S21016 07330021
* THIS SECTION UPDATES THE INFORMATION IN THE DD ENTRY IN THE TIOT      07360000
         OI    ISAMSTAT(REIGHT),X'02'   TURN ON PRIME BIT        A38860 07380021
         MVI   TYPE,X'01'               SET TYPE TO PRIME               07400000
* THIS SECTION SETS UP THE WORK AREA FOR THIS PASS THROUGH ISAM         07420000
* ALLOCATE                                                              07440000
MOVEFLDS EQU   *                        BRANCH LABEL             Y02080 07460002
         ST    RTEN,ATIOTPTR           SAVE THE DD ENTRY POINTER Y02080 07480002
         MVC   HOWMUCH+K1(K3),JFCBPQTY  SAVE PRIMARY QUANTITY    Y02080 07500002
         MVC   DIRQTY(2),JFCBDQTY+1    PICK UP EMBEDDED INDEX QUANTITY  07520000
         MVC   ABSTR(2),JFCBABST       PICK UP ABSOLUTE TRACK ADDRESS   07540000
         CLI   TIOEVOLS(RTEN),X'01'     MULTI-VOLUME REQUEST?    A38860 07560021
         BE    MOVEPRI                 BRANCH IF REQUEST FOR ONE        07580000
*                                         VOLUME                        07600000
         TM    JFCBCTRI,X'DF'          CHECK FOR A CYLINDER REQUEST     07620000
         BC    5,MOVEPRI                BRANCH IF CYLINDERS REQUESTED   07640000
         LH    RSIX,DS4DEVSZ                                            07660000
         MH    RSIX,DS4DEVSZ+2         MULTIPLY TIMES THE NUMBER OF     07740000
*                                         TRACKS PER CYLINDER           07760000
         SR    RTWO,RTWO                CLEAR REG                 23312 07761018
         L     RTHREE,DEB+32            FETCH UCB PNTR            23312 07762018
         USING UCB,RTHREE               UCB ADDRESSABILITY       Y02130 07762202
         CLI   UCBTBYT4,DA3340          TEST IF 3340             Y02130 07762402
         BNE   NOT3340                  BRANCH IF NOT            Y02130 07762602
         SR    RTWO,RTWO                CLEAR FOR DIVIDE         Y02130 07764002
         LH    RTHREE,DS4DEVSZ          NBR OF CYLS ON VOLUME    Y02130 07764202
         LA    RFOUR,ONE16              4 ALTERNATE TRACKS       Y02130 07764402
         DR    RTWO,RFOUR               FOR EVERY 116 CYLINDERS  Y02130 07764602
*                                       SO DIVIDE CYL BY 116,    Y02130 07764702
         SLL   RTHREE,K2                MULTIPLY QUOTIENT BY 4   Y02130 07764802
*                                       EQUALS TOTAL ALTERNATES  Y02130 07764902
SUBTALT  EQU   *                        BRANCH LABEL             Y02130 07765002
         SR    RSIX,RTHREE              REDUCE TOTAL BY NUMBER   Y02130 07765202
*                                       OF ALTERNATE TRACKS      Y02130 07765402
         B     CONT                     CONTINUE CALCULATION     Y02130 07765602
NOT3340  EQU   *                        BRANCH LABEL             Y02130 07765802
         IC    RTWO,UCBTBYT4            FETCH UNIT TYPE          Y02130 07766002
         DROP  RTHREE                                            Y02130 07766202
         L     RTHREE,CVTPTR            LOAD CVT ADDRESS         Y02134 07766402
         L     RTHREE,CVTZDTAB-CVT(RTHREE)  DEVICE TABLE POINTER Y02134 07766602
         IC    RTWO,0(RTWO,RTHREE)      FETCH DEVICE ENTRY OFFSET 23312 07766802
         SH    RSIX,12(RTWO,RTHREE)     REDUCE TOTAL TRKS BY NR   23312 07767018
*                                       OF ALTERNATE TRACKS             07772013
CONT     EQU   *                        BRANCH LABEL             Y02130 07774002
         SH    RSIX,ABSTR              CALCULATE QUANTITY TO BE         07780000
         STH   RSIX,PRIQTY                OBTAINED ON THIS VOLUME       07800000
         CLC   HOWMUCH+K2(K2),PRIQTY    COMPARE AMOUNT NEEDED    Y02080 07802002
*                                       WITH SPACE AVAILABLE            07804018
         BH    REJOIN                   ALL OF AVAILABLE SPACE    23475 07806018
*                                       IS NEEDED                       07808018
MOVEPRI  EQU   *                        BRANCH LABEL             Y02080 07808402
         MVC   PRIQTY,HOWMUCH+K2        AMOUNT WANTED IS LESS    Y02080 07810002
*                                       THEN WHATS AVAILABLE,           07812018
*                                       ONLY GET WHATS NEEDED           07814018
         B     REJOIN                                                   07820000
THISLAST EQU   *                                                  23312 07840018
PRIMETST CLC   JFCBELNM(8),PRIME        CHECK DSN ELEMENT         23312 07860018
         BE    ANOTHER                  BRANCH IF A PRIME AREA IS       07880000
*                                          REQUESTED                    07900000
BLANKTST EQU   *                                                 A38860 07920021
         CLC   JFCBELNM(8),BLANKS       CHECK DSN ELEMENT        A38860 07940021
         BE    ANOTHER                  BRANCH IF ELEMENT NAME IS BLANK 07960000
OVFLWTST EQU   *                                                 S21016 07970021
         CLC   JFCBELNM(8),OVFLOW       CHECK ELEMENT NAME ATTACHED TO  07980000
*                                          THE DS NAME                  08000000
         BE    CHEKPREV            BRANCH IF ELEMENT IS OVFLOW   S21016 08010021
         CLC   JFCBELNM,INDEX           CHECK DSN ELEMENT       YA03038 08012002
         BE    INDEXPRE                 BR IF INDEX             YA03038 08014002
INVELMNT EQU   *                                                 S21016 08020021
         LA    RFIVE,INVALELM      ELEMENT NAME IS NOT OVFLOW    S21016 08030021
         B     ERRORXCT                                          S21016 08040021
CHEKPREV EQU   *                                                 S21016 08050021
         TM    ISAMSTAT(RTEN),X'02'     CHECK TYPES PREVIOUSLY   A38860 08060021
*                                          ALLOCATED (IN DDNAME FIELD)  08080000
         BC    1,TEST                   BRANCH IF PRIME PROCEEDS        08100000
         B     INVNAME                  NO PRIME REQUEST       @ZM30492 08100202
INVOVFL  EQU   *                                                 S21016 08110021
         LA    RFIVE,PRIME1ST      INVALID OVFLOW REQUEST ERROR  S21016 08120021
         B     ERRORXCT                                          S21016 08130021
TEST     EQU   *                                                 A38860 08140021
         TM    ISAMSTAT(RTEN),X'04'     CHECK TYPES PREVIOUSLY   A38860 08150021
*                                          ALLOCATED (IN DDNAME FIELD)  08180000
         BC    1,INVAREA                BRANCH IF OVERFLOW HAS ALREADY  08200000
*                                          BEEN REQUESTED               08220000
         OC    JFCBDQTY(3),JFCBDQTY     CHECK FOR EMBEDDED INDEX BEING  08240000
*                                          REQUESTED                    08260000
         BC    7,ERROUT                 BRANCH IF EMBEDDED INDEX BEING  08280000
*                                          REQUESTED WITH REQUEST FOR   08300000
*                                          OVERFLOW                     08320000
         CLI   TIOEVOLS(RTEN),X'01'     MULTI-VOLUME OVFLOW?     A38860 08380021
         BE    SETOVFLW            BRANCH IF NOT MULTI-VOLUME    S21016 08440021
         LA    RFIVE,MVOVFLOW      MULTI-VOLUME OVFLOW ERROR     S21016 08540021
         B     ERRORXCT                                          S21016 08640021
SETOVFLW EQU   *                                                 S21016 08740021
         OI    ISAMSTAT(RTEN),X'04'     TURN ON OVERFLOW BIT     A38860 08840021
         MVI   TYPE,X'02'               SET TYPE FOR OVFLOW             09060000
         B     MOVEFLDS                                                 09080000
ANOTHER  EQU   *                                                 A38860 09090021
         TM    ISAMSTAT(RTEN),X'02'     CHECK AREA TYPES THAT    A38860 09100021
*                                          HAVE BEEN ALLOCATED          09120000
         BC    1,INVAREA                BRANCH IF PRIME AREA PREVIOUSLY 09140000
*                                          REQUESTED                    09160000
         OC    JFCBDQTY(3),JFCBDQTY     CHECK FOR AN EMBEDDED INDEX     09180000
*                                          REQUEST                      09200000
         BNZ   DUPLINDX            DUPLICATE INDEX REQUEST ERROR S21016 09240021
         MVI   TYPE,X'01'               TURN ON TYPE FOR PRIME          09280000
         OI    ISAMSTAT(RTEN),X'02'     TURN ON PRIME BIT        A38860 09300021
         B     MOVEFLDS                                                 09320000
REJOIN   EQU   *                                                  23312 09620018
         LA    RTHREE,NEXTLOAD          SET 2ND LOAD ID          Y02080 09920002
*                                                                       09970002
* BRANCH TO ANOTHER LOAD OF ISAM ALLOCATE                               10300002
*                                                                       10302002
XCT      EQU   *                                                  23312 10310018
         IECRES LOAD,EXTPR=(RWORK),MODID=(RTHREE),BRANCH=DIRECT  Y02080 10340002
*                                                                       10360021
* CONSTANTS                                                             10380021
*                                                                       10400021
INDEX    DC    C'INDEX   '                                        23312 10440018
OVFLOW   DC    C'OVFLOW  '                                        23312 10460018
PRIME    DC    C'PRIME'                                           23312 10480018
BLANKS   DC    CL8' '                                            A38860 10490021
*                                                                       10500002
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         10510002
*                                                                       10520002
         XCTLTABL ID=(NEXTLOAD,I2,LASTLOAD,I7),SVC=032,BRT=YES,  Y02080X10530002
               LENGTH=                                           Y02080 10532002
         EJECT                                                   Y02080 10540002
JFCBKEN  DSECT                                                          10580000
         IEFJFCBN                                                       10620000
         SPACE 3                                                 Y02080 10640002
         IECDSECS CVT,UCB,DSAB,EXPAND=YES                        Y02134 10660002
DSCBWKAR IECALLWA EP,F4,D1=(1)          ALLOCATE WORK AREA       Y02080 10680002
         END                                                            11820000
./  ADD  SSI=32510319,NAME=IGG032I2
 TITLE 'IGG032I2 - ISAM ALLOCATE - FORMAT 5 SEARCH'                     00020000
IGG032I2 CSECT                                                          00030021
*                                                                       00040002
*MODULE NAME = IGG032I2                                                 00050002
*                                                                       00052002
*DESCRIPTIVE NAME = ISAM ALLOCATE - FORMAT 5 SEARCH                     00054002
*                                                                       00056002
*COPYRIGHT = NONE                                                       00058002
*                                                                       00058402
*CHANGE ACTIVITY = SEE BELOW                                            00058802
*                                                                       00060000
*          RELEASE 18 DELETIONS                                       * 00061018
*2272                                                             24988 00062018
*          RELEASE 19 DELETIONS                                       * 00063018
*1774089400                                                      A27089 00063219
*1774089400                                                      A27089 00063519
*          RELEASE 20 DELETIONS                                       * 00064018
*3537                                                            A36850 00064520
*          RELEASE 21 DELETIONS                                       * 00065018
*1203000400,017000,024500-024600,025456-025463,025477-025505,    S21016 00065321
*1203025528-025530,025624,040400,041600-041800,042800,048200     S21016 00065621
*1203003200,018000-018400,028800-029000,042000-042200,052800-    A38860 00065721
*1203053800,089800-090000,100800                                 A38860 00065821
*          RELEASE 22 DELETIONS                                       * 00066018
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00067002
*0000000030-000150,000670-000710,002400,003200,005800,006600,    Y02080 00067102
*0000008600,017600,018000-018200,024060-024200,025200,025512,    Y02080 00067202
*0000027200,028400,040000,042200,052400,053000,053400-053600,    Y02080 00067302
*0000054400-054800,055400,060600,064800-065000,066400,069700,    Y02080 00067402
*0000070300,087400,089880-090400,090800,091200-103000            Y02080 00067502
*                                                                       00077002
*STATUS CHANGE LEVEL 006                                                00081021
*                                                                       00100000
*FUNCTION - THE REQUEST IS EXAMINED AND THE FORMAT 5 IS SEARCHED        00120000
*           ACCORDING TO ABSOLUTE TRACK, OR AVAILABLE CYLINDERS         00140000
*           DEPENDING UPON THIS REQUEST.  A DADSM TABLE IS BUILT        00160000
*           ACCORDING TO ASCENDING RTA'S.                               00180000
*                                                                       00200000
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG032I2. ENTRY IS    00220000
*          MADE FROM THE FIRST LOAD OF ISAM ALLOCATE VIA A BRANCH.      00240002
*                                                                       00260000
*                                                                       00280000
*INPUT - AT ENTRY TO THIS MODULE REGISTER 11 POINTS TO A JFCB, REGISTER 00300000
*        13 POINTS TO THE ALLOCATE WORK AREA WHICH CONTAINS THE ADDRESS 00320002
*        OF A FORMAT 1 IF ONE EXISTS, VTOCADR, AND DADSMADR.            00340000
*        REGISTER 9 CONTAINS THE QUANTITY TO BE ALLOCATED,  THE FIRST   00360000
*        FORMAT 5 IS IN THE WORK AREA.                                  00380000
*                                                                       00400000
*OUTPUT - UPON TRANSFERRING TO THE NEXT MODULE, IGG032I3, THE WORK AREA 00420000
*         WILL CONTAIN A SORTED DADSM TABLE, THE VTOCADR, AND DADSMADR. 00440000
*                                                                       00460000
*                                                                       00480000
*EXTERNAL ROUTINES - THE FOLLOWING ARE SUPERVISOR CALLS ISSUED IN THE   00500000
*   MACRO EXPANSIONS                                                    00520000
*   EXCP(0) READ FROM OR WRITE TO DIRECT ACCESS DEVICE                  00540000
*   WAIT(1) WAIT ON EVENT CONTROL BLOCK                                 00560000
*   OTHER MACROS ISSUED - IEFJFCBN - BUILDS JFCB                        00600000
*                         IECALLWA - ALLOCATE WORK AREA EXPANSION       00610002
*                         IECSDSL1 - BUILDS DSCBS                       00620000
*                         CVT - BUILD CVT                               00630002
*                                                                       00640000
*EXITS - NORMAL - BRANCH TO MODULE IGG032I3                             00660002
*      - ERROR - ERROR CODES RETURNED TO MODULE IGG032I7 IN REG 5       00680000
*                                                                       00700000
*              0C   PERMANENT I/O ERROR                                 00720000
*                                                                       00740000
*              10   ABSOLUTE TRACK NOT AVAILABLE                        00760000
*                                                                       00780000
*              14   SPACE REQUESTED NOT AVAILABLE                       00800000
*                                                                       00820000
*              28   SPACE MUST BE ON CYLINDER BOUNDARY                  00825021
*                                                                       00830021
*              6C   PRIMARY SPACE REQUEST IS ZERO                       00835021
*                                                                       00840000
*TABLES/WORK AREAS - DADSM WORK AREA DESCRIBED BY MACRO IECALLWA        00860002
*              ***************************************                  00880000
*              *             DADSM TABLE             *                  00900000
*              ***************************************                  00920000
*                                                                       00940000
*              ***************************************                  00960000
*              *        *         *                  *                  00980000
*              *  TYPE  *  NO OF  *     USED HOLE    *                  01000000
*              *  FLAG  * ENTRIES *      COUNTER     *                  01020000
*              *        *         *                  *                  01040000
*              ***************************************                  01060000
*              *                  *                  *                  01080000
*              *       RTA        *      RTA+1       *                  01100000
*              *                  *                  *                  01120000
*              ***************************************                  01140000
*              *                  *                  *                  01160000
*              *       RTA        *      RTA+1       *                  01180000
*              *                  *                  *                  01200000
*              ***************************************                  01220000
*              *                  *                  *                  01240000
*              *       RTA        *      RTA+1       *                  01260000
*              *                  *                  *                  01280000
*              ***************************************                  01300000
*              *                  *                  *                  01320000
*              *       RTA        *      RTA+1       *                  01340000
*              *                  *                  *                  01360000
*              ***************************************                  01380000
*              *                  *                  *                  01400000
*              *       RTA        *      RTA+1       *                  01420000
*              *                  *                  *                  01440000
*              ***************************************                  01460000
*                                                                       01480000
*                                                                       01500000
*              TYPE FLAG = 02 - BPAM DIRECTORIES REQUESTED.             01520000
*                                                                       01540000
*                        = 40 - USER LABELS REQUESTED                   01544021
*                                                                       01548021
*                        = 80 - SET MUST COMPLETE IS ACTIVE             01552021
*                                                                       01556021
*                                                                       01560000
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.    01580000
*                                                                       01600000
*                                                                       01620000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.        01640000
*                                                                       01660000
*                                                                       01680000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT. 01700021
*                                                                       01720000
*                                                                       01740000
*ATTRIBUTES - REENTRANT                                                 01760002
*                                                                       01780000
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    01800002
*          WORK AREA = AS DEFINED IN THE IECALLWA MACRO                 01820002
*          RPS WORK AREA = AS DEFINED IN THE IECRPS MACRO               01830002
*                                                                       01840021
*                                                                       01860000
*REGISTER USAGE                                                         01880000
*              REGISTERS 0-9 WORK REGISTERS                             01900000
*              REGISTER 10 - TIOT SET UP TABLE POINTER                  01920000
*              REGISTER 11 - JFCB POINTER                               01940000
*              REGISTER 12 - BASE REGISTER                              01960000
*              REGISTER 13 - WORK AREA POINTER                          01980000
*              REGISTER 14 SUBROUTINE LINKAGE AND WORK REGISTER         02000000
*              REGISTER 15 WORK REGISTER                                02020000
*                                                                       02040000
***** REGISTER NAMES *****                                              02060000
RZERO    EQU   0                                                        02080000
RONE     EQU   1                                                        02100000
RTWO     EQU   2                                                        02120000
RTHREE   EQU   3                                                        02140000
RFOUR    EQU   4                                                        02160000
RFIVE    EQU   5                                                        02180000
RSIX     EQU   6                                                        02200000
RSEVEN   EQU   7                                                        02220000
REIGHT   EQU   8                                                        02240000
RNINE    EQU   9                                                        02260000
RTEN     EQU   10                                                       02280000
RJFCB    EQU   11                                                       02300000
RBASE    EQU   12                                                       02320000
RWORK    EQU   13                                                       02340000
RETURN   EQU   14                                                       02360000
RFTEN    EQU   15                                                       02380000
*                                                                       02386021
* OTHER EQUATES                                                         02392021
*                                                                       02400000
ZERO     EQU   0                   CONSTANT OF ZERO              Y02080 02402002
THREE    EQU   3                   CONSTANT OF THREE             Y02080 02404002
FIVE     EQU   5                   CONSTANT OF FIVE              Y02080 02406002
HELDQTY  EQU   X'FF'               HELD QUANTITY INDICATOR       Y02080 02408002
NODSCBS  EQU   X'08'               NO UNUSED DSCB'S AVAILABLE    S21016 02422021
IOERRCDE EQU   X'0C'               I/O ERROR CODE                S21016 02424021
NOTAVAIL EQU   X'10'               ABSOLUTE TRACK NOT AVAILABLE  S21016 02426021
NOTENUFF EQU   X'14'               SPACE REQUESTED NOT AVAILABLE S21016 02428021
BOUNDERR EQU   X'28'               BOUNDARY ERROR CODE           S21016 02430021
ZEROSPCE EQU   X'6C'               PRIMARY SPACE REQUEST IS ZERO S21016 02432021
*                                                                       02440000
         BALR  RBASE,0                                                  02480000
         USING ALPA,RBASE                                               02500000
         USING ALLOCWKA,RWORK           WORK AREA ADDRESSABILITY Y02080 02520002
         USING JFCBKEN,RJFCB                                            02540000
*                                                                       02540713
* THIS SECTION CHECKS FOR ENOUGH ROOM IN THE VTOC                       02541413
*                                                                       02542113
ALPA     LA    RTHREE,4                 COMPARE THE NUMBER OF HOLES     02542813
         CH    RTHREE,DS4DSREC             AVAILABLE WITH 4             02543513
         BNH   FINE                     BRANCH IF 4 OR MORE HOLES ARE   02544213
*                                       AVAILABLE                       02544913
         LA    RFIVE,NODSCBS            LOAD ERROR CODE          S21016 02545921
         B     FREEUP                                                   02547013
FINE     EQU   *                        BRANCH LABEL             Y02080 02549002
         XC    PDLIST,PDLIST            CLEAR PUSHDOWN LIST      Y02080 02551002
         XC    DADSMTBL,DADSMTBL        CLEAR DADSM EXTENT TABLE Y02080 02551202
         SR    REIGHT,REIGHT                                            02551913
         LH    RNINE,PRIQTY             PICK UP PRIMARY QUANTITY        02552613
         LTR   RNINE,RNINE              ZERO QUANTITY REQUEST?   S21016 02552721
         BP    GETINDEX                 BRANCH IF NOT            S21016 02552821
         LA    RFIVE,ZEROSPCE           LOAD ERROR CODE          S21016 02552921
         B     FREEUP                                            S21016 02553021
GETINDEX EQU   *                                                 S21016 02553121
         LR    RSIX,REIGHT                                              02553313
         LH    RSEVEN,DIRQTY            PICK UP EMBEDDED INDEX          02554013
         TM    JFCBCTRI,X'DF'           CHECK THE REQUEST TYPE FIELD    02554713
         BC    5,NOTHERE                BRANCH IF REQUEST FOR CYLINDERS 02555413
*                                                                       02556113
* THIS SECTION CHECKS FOR ABSOLUTE TRACK REQUEST BEING ONE OF AN        02556813
* INTEGRAL NUMBER OF CYLINDERS                                          02557513
*                                                                       02558213
         LH    RFIVE,DS4DEVSZ+2         DIVIDE THE PRIMARY QTY BY THE   02558913
         DR    REIGHT,RFIVE                NUMBER OF TRACKS/CYLINDERS   02559613
         LTR   REIGHT,REIGHT            TEST REMAINDER FOR ZERO         02560313
         BZ    NONEHERE                 BRANCH IF AN INTEGRAL NUMBER OF 02561013
*                                          CYLINDERS                    02561713
INVSPACE EQU   *                                                 S21016 02561921
         LA    RFIVE,BOUNDERR           NOT ON CYLINDER          S21016 02562121
*                                       BOUNDARIES               S21016 02562321
         B     FREEUP                                            S21016 02562521
NONEHERE LR    RTWO,RNINE                                               02563113
         LH    RNINE,ABSTR              TEST FOR CYLINDER ALLIGNMENT    02563813
         DR    REIGHT,RFIVE             DIVIDE ABSOLUTE TRACK REQUESTED 02564513
*                                          BY TRACKS/CYLINDER           02565213
         LTR   REIGHT,REIGHT            TEST REMAINDER FOR ZERO         02565913
         BC    7,INVSPACE               BRANCH IF NOT AN INTEGRAL       02566613
*                                          NUMBER OF CYLINDERS          02567313
         LR    RNINE,RTWO                                               02568013
         LTR   RSEVEN,RSEVEN            CHECK FOR PRESENCE OF EMBEDDED  02568713
*                                          INDEX QUANTITY               02569413
         BZ    NOTHERE                  BRANCH IF THERE IS NO EMBEDDED  02570113
*                                          INDEX QUANTITY               02570813
         DR    RSIX,RFIVE               DIVIDE EMBEDDED INDEX QUANTITY  02571513
*                                          BY TRACKS/CYLINDER           02572213
         LTR   RSIX,RSIX                CHECK REMAINDER FOR ZERO        02572913
         BC    7,INVSPACE               BRANCH IF NOT AN INTEGRAL       02573613
*                                          NUMBER OF CYLINDERS          02574313
NOTHERE  AR    RNINE,RSEVEN             ADD TO PRIMARY QUANTITY THE     02575013
*                                          EMBEDDED INDEX QUANTITY      02575713
         TM    DS4VTOCI,X'80'           THE FORMAT 4 IS CHECKED FOR AN  02576413
*                                          INDICATION THAT THE VTOC IS  02580000
*                                          NOT IN THE EXPECTED FORM.    02600000
*                                          (SUCH AS A VOLUME INITIAL-   02620000
*                                           IZED BY BOS)                02640000
         BC    1,GOODQTY                BRANCH IF VTOC NOT IN THE       02660000
*                                          EXPECTED CONDITION           02680000
*                                                                       02690002
* THIS SECTION RELOCATES THE CHANNEL PROGRAM TO READ IN THE F5          02700000
*                                                                       02710002
GOREAD   EQU   *                        BRANCH LABEL             Y02080 02720002
         MVC   COUNT,DADSMADR           MOVE IN FIRST F5 CCHHR   Y02080 02730002
         LM    RZERO,RFIVE,CHANPROG    PICK UP FIRST 3 CCW'S            02740000
         ALR   RZERO,RWORK                                              02760000
         ALR   RTWO,RWORK                                               02780000
         ALR   RFOUR,RWORK                                              02800000
         STM   RZERO,RFIVE,CCW1        STORE FIRST 3 CCW'S              02820000
         MVC   SEEK+THREE(FIVE),COUNT   MOVE CCHHR TO IOB SEEK   Y02080 02840002
         LA    RFOUR,CCW1               UPDATE IOB TO POINT TO THE      02860000
         ST    RFOUR,IOB+16             FIRST CCW TO BE EXECUTED A38860 02890021
* THIS SECTION SETS UP FOR THE SEARCH FOR AVAILABLE EXTENTS             02920000
SUCCIO   MVC   DS5FMTID(90),DS5FMTID+1  TAKE OUT 1 BYTE FORMAT ID       02940000
         LA    RONE,26                  SET UP ENTRY COUNTER            02960000
         LA    RTWO,DS5AVEXT            SET UP ENTRY POINTER            02980000
         XC    PDLIST(4),PDLIST                                         03000000
         TM    JFCBCTRI,X'DF'           TEST FOR ABSOLUTE TRACK OR      03020000
*                                          CYLINDER REQUEST             03040000
         BC    4,CYLREQ                 BRANCH IF REQUEST FOR CYLINDERS 03060000
COMPRTA  CLC   ABSTR(2),0(RTWO)         CHECK FOR AN RTA HIGHER THAN    03080000
*                                          SEARCH RTA                   03100000
         BNH   STOPHERE                 BRANCH IF THIS RTA IS HIGHER OR 03120000
*                                          EQUAL TO THE REQUEST         03140000
         OC    5(5,RTWO),5(RTWO)        CHECK FOR THE LAST ENTRY IN THE 03160000
*                                          FORMAT 5                     03180000
         BE    CHECKOUT                 BRANCH IF THIS THE LAST F5      03200000
*                                          ENTRY                        03220000
         BCTR  RONE,0                   DECREMENT ENTRY POINTER         03240000
         LTR   RONE,RONE                TEST THE ENTRY NUMBER FOR THE   03260000
*                                          LAST OF 26 F5 ENTRIES        03280000
         BZ    CHECKOUT                 BRANCH IF LAST FORMAT 5 ENTRY   03300000
         LA    RTWO,5(RTWO)             INCREMENT ENTRY POINTER         03320000
         B     COMPRTA                                                  03340000
* THIS SECTION CHECKS FOR THE LAST EXTENT BEING THE DESIRED ONE         03360000
CHECKOUT MVC   PDLIST(5),0(RTWO)        CHECK FOR END RTA GREATER THAN  03380000
         LH    RFIVE,PDLIST+2              RTA LOOKING FOR              03400000
         MH    RFIVE,DS4DEVSZ+2         MULTIPLY THE NUMBER OF          03420000
*                                          CYLINDERS BY TRACKS PER      03440000
*                                          CYLINDER                     03460000
         SR    RFOUR,RFOUR                                              03480000
         IC    RFOUR,PDLIST+4                                           03500000
         AR    RFOUR,RFIVE              ADD IN THE NUMBER OF EXCESS     03520000
*                                          TRACKS                       03540000
         LH    RFIVE,PDLIST                                             03560000
         AR    RFOUR,RFIVE                                              03580000
         CH    RFOUR,ABSTR              CHECK ENDING RTA                03600000
         BNH   GOCHECK                  BRANCH IF THIS RTA IS NOT       03620000
*                                          HIGHER THAN THE REQUEST      03640000
         SH    RFOUR,ABSTR              CALCULATE DIFFERENCE BETWEEN    03660000
         LR    RFIVE,RFOUR                 RTA'S IN CYLINDERS           03680000
         SR    RFOUR,RFOUR                                              03700000
         LH    RSIX,DS4DEVSZ+2                                          03720000
         DR    RFOUR,RSIX               DIVIDE DIFFERENCE BY NUMBER OF  03740000
*                                          TRACKS PER CYLINDER          03760000
         CR    RFIVE,RNINE              COMPARE AVAILABLE QUANTITY TO   03780000
*                                          THAT REQUESTED               03800000
         BNL   GOODQTY                  BRANCH IF QUANTITY AVAILABLE IS 03820000
*                                          SUFFICIENT                   03840000
         B     QTYNOTAV                 QUANTITY AVAILABLE IS NOT AS    03860000
*                                          NUCH AS IS NEEDED            03880000
GOCHECK  OC    DS5PTRDS(5),DS5PTRDS     CHECK THE CHAIN ADDRESS FIELD   03900000
*                                          OF THE FORMAT 5 DSCB         03920000
         BZ    RTANOT                   BRANCH IF THIS THE LAST F5      03940000
* THIS SECTION UPDATES THE SEARCH ADDRESS OF THE F5                     03960000
UPDATESK MVC   SEEK+3(5),DS5PTRDS       UPDATE SEEK ADDRESS             03980000
         MVC   COUNT,DS5PTRDS           UPDATE F5 SEARCH ADDRESS Y02080 04000002
* EXECUTE THE CHANNEL PROGRAM TO READ IN A DSCB FORMAT 5                04020000
         MVI   ECB,X'00'                ZERO FIRST BYTE OF ECB   S21016 04040021
         EXCP  IOB                                                      04060000
         WAIT  1,ECB=ECB                                                04080000
         TM    ECB,X'20'               CHECK THE ECB FOR SUCCESSFUL     04100000
*                                         COMPLETION                    04120000
         BC    1,SUCCIO                 BRANCH IF SUCCESSFUL COMPLETION 04140000
IOERROR  EQU   *                                                 S21016 04160021
         LA    RFIVE,IOERRCDE           SET I/O ERROR CODE       S21016 04180021
FREEUP   EQU   *                                                 A38860 04200021
         LA    RTWO,ERRORLD             POINT TO ID OF IGG032I7  Y02080 04220002
         B     XCTLSKIP                                                 04240000
* THIS SECTION SETS THE ERROR CODE FOR REQUESTED RTA NOT AVAILABLE      04260000
RTANOT   EQU   *                                                 S21016 04270021
         LA    RFIVE,NOTAVAIL           RTA NOT AVAILABLE ERROR  S21016 04280021
         B     FREEUP                                                   04300000
* THIS SECTION CHECKS FOR THIS EXTENT HAVING QUANTITY AND RTA DESIRED   04320000
STOPHERE BE    CHECKQTY                 BRANCH IF RTA IS EQUAL TO THE   04340000
*                                          REQUESTED RTA                04360000
         LA    RZERO,DS5AVEXT           PICK UP ADDRESS OF 1ST ENTRY    04380000
*                                          IN F5                        04400000
         CR    RZERO,RTWO               CHECK FOR FIRST F5 ENTRY        04420000
         BE    RTANOT                   BRANCH IF THIS THE FIRST F5     04440000
*                                          ENTRY - RTA NOT AVAILABLE    04460000
         LA    RTHREE,5                 BACK UP ONE ENTRY               04480000
         SR    RTWO,RTHREE                                              04500000
*    THIS IS THE FORMULA FOR THE FOLLOWING CALCULATIONS            1227 04520014
*                  YY - ( ABSTR - XX ) / DS4DEVSZ                  1227 04540014
         MVC   PDLIST(5),0(RTWO)   PICK UP NEXT ENTRY              1227 04560014
         LH    RFIVE,PDLIST        GET STARTING TT                 1227 04580014
         LH    RSEVEN,ABSTR        GET ABSTR REQUESTED             1227 04600014
         SR    RSEVEN,RFIVE        OBTAIN DIFFERENCE               1227 04620014
         SR    RSIX,RSIX           ZERO REGISTER                   1227 04640014
         LH    REIGHT,DS4DEVSZ+2   PICK UP = TRACKS/CYL            1227 04660014
         DR    RSIX,REIGHT                                         1227 04680014
         LH    RSIX,PDLIST+2                                            04700000
         SR    RSIX,RSEVEN                                              04720000
         LTR   RSIX,RSIX           TEST FOR RTA NOT AVAILABLE    A36850 04726020
         BNP   RTANOT              BRANCH IF RTA NOT AVAILABLE   A36850 04732020
         CR    RSIX,RNINE               CHECK FOR ENOUGH QUANTITY       04740000
         BNL   GOODQTY                  BRANCH IF QUANTITY AVAILABLE    04760000
*                                          IS SUFFICIENT                04780000
* THIS SECTION SETS THE ERROR CODE FOR QUANTITY REQUESTED NOT AVAILABLE 04800000
QTYNOTAV EQU   *                                                 S21016 04810021
         LA    RFIVE,NOTENUFF           QUANTITY NOT AVAILABLE   S21016 04820021
         B     FREEUP                                                   04840000
CHECKQTY MVC   PDLIST(5),0(RTWO)       CHECK FOR ENOUGH CYLINDERS       04860000
         LH    RFIVE,PDLIST+2                                           04880000
         CR    RNINE,RFIVE             COMPARE THE NUMBER OF CYLINDERS  04900000
*                                         REQUESTED TO THE NUMBER       04920000
*                                         AVAILABLE                     04940000
         BH    QTYNOTAV                BRANCH IF QUANTITY AVAILABLE IS  04960000
*                                         NOT SUFFICIENT                04980000
* THIS SECTION BUILDS A ONE ENTRY DADSM TABLE                           05000000
GOODQTY  LH    RTWO,ABSTR               USE RTA REQUESTED AS THE        05020000
         STH   RTWO,ENTRIES                BEGINNING RTA                05040000
         MH    RNINE,DS4DEVSZ+2         MULTIPLY THE NUMBER OF          05060000
*                                          CYLINDERS REQUESTED BY THE   05080000
*                                          NUMBER OF TRACKS PER         05100000
*                                          CYLINDER - -                 05120000
         AR    RTWO,RNINE               ADD TO BEGINNING RTA TO GET     05140000
         STH   RTWO,ENTRIES+2              ENDING RTA                   05160000
MOVEONE  MVI   ENTRYNUM,X'01'           SET NUMBER OF ENTRIES IN DADSM  05180000
*                                          TABLE                        05200000
         MVI   ENTRIES+4,X'00'                                          05220000
* THIS SECTION SETS UP THE WTG TABLE TO TRANSFER CONTROL TO ANOTHER     05240002
* LOAD MODULE                                                           05260000
XCTLHERE EQU   *                                                 A38860 05280021
         LA    RTWO,NEXTLOAD            POINT TO ID OF IGG032I3  Y02080 05300002
XCTLSKIP EQU   *                                                 A38860 05320021
         MVI   ASWITCH,ZERO             ZERO THE ALLOCATE SWITCH Y02080 05340002
         IECRES LOAD,EXTPR=(RWORK),MODID=(RTWO),BRANCH=DIRECT    Y02080 05360002
*                                                                       05400000
* FOR A CONTIGUOUS REQUEST, THIS SECTION FINDS THE SMALLEST             05410002
* FORMAT 5 EXTENT ON THE VOLUME THAT FILLS THE REQUEST.                 05412002
*                                                                       05420000
CHEKHELD EQU   *                        BRANCH LABEL             Y02080 05430002
         CLI   ASWITCH,HELDQTY          CHECK FOR HELD QUANTITY  Y02080 05440002
         BE    HAVEHELD                 BRANCH IF THERE IS A HELD       05500000
*                                          QUANTITY                     05520000
         MVI   ASWITCH,HELDQTY          SET ON HELD FLAG         Y02080 05540002
THERE    MVC   PDLIST+20(5),0(RTWO)     MOVE IN F5 ENTRY                05560000
MORENTS  BCTR  RONE,0                  CHECK FOR MORE EXTENTS IN F5     05580000
         LTR   RONE,RONE               CHECK IF AT 26TH F5 ENTRY        05600000
         BZ    CHECKIT                 BRANCH IF AT THE 26TH ENTRY      05620000
         LA    RTWO,5(RTWO)            UPDATE F5 ENTRY POINT            05640000
CYLREQ   MVC   ENTRIES(5),0(RTWO)                                       05660000
         TM    JFCBCTRI,X'08'          CHECK REQUEST TYPE FIELD         05680000
         BC    8,BLANK                 BRANCH IF NO OPTION CHOSEN       05700000
         CH    RNINE,ENTRIES+2         COMPARE QUANTITY REQUESTED TO    05720000
*                                         THAT AVAILABLE                05740000
         BH    MORENTS                 BRANDH IF QUANTITY TOO SMALL     05760000
CONTIG   BL     CHEKHELD               BRANCH IF QUANTITY BIGGER THAN   05780000
*                                         THAT REQUESTED                05800000
         MVC   PDLIST+20(5),ENTRIES    PICK UP F5 ENTRY IF EQUAL TO     05820000
*                                         REQUEST IN QUANTITY           05840000
         B     BUILDDAD                                                 05860000
* THIS SECTION CHECKS FOR NEW QUANTITY SMALLER THAN HELD QUANTITY       05880000
HAVEHELD CLC   PDLIST+22(2),ENTRIES+2   COMPARE NEW QUANTITY TO HELD    05900000
         BNH   MORENTS                  BRANCH IF NEW QUANTITY IS NOT   05920000
*                                          SMALLER THAN HELD QUANTITY   05940000
         B     THERE                                                    05960000
*                                                                       05980000
CHECKIT  OC    DS5PTRDS(5),DS5PTRDS     CHECK CHAIN ADDRESS FIELD FOR   06000000
*                                          ANOTHER F5                   06020000
         BC    7,UPDATESK               BRANCH IF ANOTHER F5 EXISTS     06040000
NONE     EQU   *                        BRANCH LABEL             Y02080 06050002
         CLI   ASWITCH,HELDQTY          CHECK FOR A HELD QTY- AN Y02080 06060002
*                                          ENTRY WITH QUANTITY GREATER  06080000
*                                          THAN REQUEST                 06100000
         BNE   BLAKCONT                 BRANCH IF NO HELD QUANTITY      06120000
*                                          EXISTS                       06140000
* THIS SECTION BUILDS A DADSM TABLE OF UP TO FIVE ENTRIES               06160000
BUILDDAD SR    RFOUR,RFOUR             CHECK TO SEE IF HELD QUANTITY    06180000
         LH    RFIVE,PDLIST+20             IS ON A CYLINDER BOUNDARY    06200000
         LH    RSIX,DS4DEVSZ+2             AND IF NOT ROUND UP TO THE   06220000
         DR    RFOUR,RSIX                  NEXT FULL CYLINDER           06240000
         LTR   RFOUR,RFOUR              CHECK REMAINDER- ON CYLINDER    06260000
*                                          BOUNDARY                     06280000
         BZ    NOUPDTE                  BRANCH IF ON CYLINDER BOUNDARY  06300000
         LA    RFIVE,1(RFIVE)           INCREMENT NUMBER OF CYLINDERS   06320000
NOUPDTE  MH    RFIVE,DS4DEVSZ+2         MULTIPLY NUMBER OF CYLINDERS BY 06340000
*                                          TRACKS PER CYLINDER          06360000
         STH   RFIVE,ENTRIES                                            06380000
         MH    RNINE,DS4DEVSZ+2         CONVERT THE REQUEST INTO RTA    06400000
         AR    RFIVE,RNINE                 AND RTA+1 AND BUILD A        06420000
         STH   RFIVE,ENTRIES+2             DADSM TABLE WITH ONLY ONE    06440000
*                                          ENTRY                        06460000
         MVI   ASWITCH,ZERO              INDICATE NO HELD QTY    Y02080 06480002
         B     MOVEONE                                                  06520000
* THIS SECTION IS FOR BLANK REQUESTS                                    06540000
BLANK    CH    RNINE,ENTRIES+2          CHECK QUANTITY AVAILABLE TO SEE 06560000
*                                          IF ENOUGH                    06580000
         BNH   CONTIG                   BRANCH IF QUANTITY AVAILABLE IS 06600000
*                                          SUFFICIENT                   06620000
         CLI   ASWITCH,HELDQTY          TEST FOR A HELD QUANTITY Y02080 06640002
         BE    MORENTS                 BRANCH IF THERE IS A HELD        06660000
*                                         QUANTITY                      06680000
* THIS SECTION BUILDS A SORTED PUSH DOWN LIST                           06700000
BUILDPDL CLC   PDLIST+2,ENTRIES+2       COMPARE THE NEW QUANTITY TO THE 06720000
*                                          SMALLEST IN THE PUSH DOWN    06740000
*                                          LIST                         06760000
         BNL   MORENTS                  BRANCH IF NEW QUANTITY IS NOT   06780000
*                                          LARGER                       06800000
         MVC   PDLIST(5),ENTRIES        MOVE IN NEW QUANTITY AND DO A   06820000
         LA    REIGHT,PDLIST+5             SORT OF THE PUSH DOWN LIST   06840000
         LA    RSEVEN,4                 SET UP PD LIST PTR AND CTR      06860000
         LA    RSIX,PDLIST                                              06880000
LOOPFOR  CLC   2(2,RSIX),2(REIGHT)      COMPARE TWO ENTRIES IN PUSH     06900000
*                                          DOWN LIST                    06920000
         BNH   ENDTEST                  BRANCH IF NO NEED TO            06940000
*                                         EXCHANGE THEM                 06960000
EXCHANGE EQU   *                        BRANCH LABEL             Y02080 06970002
         MVC   SAVEREGB+3(5),0(REIGHT)  EXCHANGE TWO PDLIST ENTRIES     06980013
         MVC   0(5,REIGHT),0(RSIX)                                      07000000
         MVC   0(5,RSIX),SAVEREGB+3                                     07020000
* CHECK FOR LAST ENTRY                                                  07040000
ENDTEST  BCTR  RSEVEN,0                 REDUCE ENTRY COUNTER            07060000
         LTR   RSEVEN,RSEVEN            TEST FOR THE LAST PUSH DOWN     07080000
*                                          LIST ENTRY                   07100000
         BZ    MORENTS                  BRANCH IF THIS IS THE LAST OF   07120000
*                                          THE PUSH DOWN LIST ENTRIES   07140000
         LA    RSIX,5(RSIX)             UPDATE PTRS TO PD LIST ENTRIES  07160000
         LA    REIGHT,5(REIGHT)                                         07180000
         B     LOOPFOR                                                  07200000
*                                                                       07220000
BLAKCONT TM    JFCBCTRI,X'08'          CHECK FOR TYPE OF CYLINDER       07240000
*                                          REQUEST                      07260000
         BC    1,QTYNOTAV               BRANCH IF THE CONTIGUOUS OPTION 07280000
*                                          - NOT SUFFICIENT SPACE       07300000
* THIS SECTION PICKS FROM PUSH DOWN LIST DESIRED QUANTITY IF AVAILABLE  07320000
PICKLIST SR    RZERO,RZERO              SET TOTAL REGISTER TO ZERO      07340000
         LA    RONE,PDLIST+20           SET UP PDLIST POINTER           07360000
         LA    RSEVEN,ENTRIES           SET UP DADSM TABLE POINTER      07380000
         LA    RTWO,5                   SET UP ADDRESS DECREMENT        07400000
         LR    RTHREE,RTWO              SET UP ENTRY COUNTER            07420000
MOVELOOP MVC   TTRLL(5),0(RONE)         MOVE ENTRY TO FULL WORD  BOUND  07440000
         LH    RFIVE,TTRLL              DETERMINE WHETHER OR NOT THE    07460000
         SR    RFOUR,RFOUR                 RTA IS ON A CYLINDER BOUND   07480000
         LH    RSIX,DS4DEVSZ+2             AND IF NOT ROUND UP TO A     07500000
         DR    RFOUR,RSIX                  CYLINDER BOUNDARY            07520000
         LTR   RFOUR,RFOUR              CHECK FOR INTEGRAL NUMBER OF    07540000
*                                          CYLINDERS                    07560000
         BZ    NOSTEPUP                 BRANCH IF ON A CYLINDER BOUND   07580000
         LA    RFIVE,1(RFIVE)           INCREMENT NUMBER OF CYLINDERS   07600000
NOSTEPUP MH    RFIVE,DS4DEVSZ+2                                         07620000
         STH   RFIVE,0(RSEVEN)          CALCULATE RTA AND RTA+1 FOR     07640000
         LH    RFOUR,TTRLL+2               DADSM TABLE ENTRY            07660000
         AR    RZERO,RFOUR                                              07680000
         MH    RFOUR,DS4DEVSZ+2                                         07700000
         CR    RZERO,RNINE              CHECK FOR QUANTITY AVAILABLE    07720000
*                                          BEING SUFFICIENT             07740000
         BNL   TAKEOUT                  BRANCH IF THE LAST PUSH DOWN    07760000
*                                          LIST ENTRY NEEDED            07780000
         AR    RFIVE,RFOUR              CALCULATE THE ENDIND RTA FOR    07800000
         STH   RFIVE,2(RSEVEN)             THIS ENTRY                   07820000
         BCT   RTHREE,UPPTRS            BRANCH IF NOT AT THE END OF THE 07840000
*                                          PUSH DOWN LIST               07860000
         B     QTYNOTAV                 QUANTITY NOT AVAILABLE          07880000
UPPTRS   SR    RONE,RTWO                UPDATE POINTERS                 07900000
         LA    RSEVEN,4(RSEVEN)                                         07920000
         B     MOVELOOP                                                 07940000
TAKEOUT  BNH   TAKE                    BRANCH IS ALL OF THE LAST ENTRY  07960000
*                                         OF THE PUSHDOWN LIST IS       07980000
*                                         NEEDED                        08000000
REDUCE   SR    RZERO,RNINE             REDUCE THE AMOUNT AVAILABLE TO   08020000
*                                         EQUAL THE AMOUNT REQUESTED    08040000
         MH    RZERO,DS4DEVSZ+2                                         08060000
         SR    RFOUR,RZERO             REDUCE AMOUNT AVAILABLE IN THE   08080000
*                                         ENTRY                         08100000
TAKE     AR    RFIVE,RFOUR              ADD IN ALL OF THE LAST ENTRY IN 08120000
*                                          THE PUSH DOWN LIST           08140000
         STH   RFIVE,2(RSEVEN)                                          08160000
         BCTR  RTHREE,0                                                 08180000
         SR    RTWO,RTHREE              SET UP NUMBER OF DADSM TABLE    08200000
         STC   RTWO,ENTRYNUM               ENTRIES                      08220000
* THIS SECTION SORTS THE DADSM TABLE                                    08240000
SORTDAD  SR    RFOUR,RFOUR                                              08260000
         IC    RFOUR,ENTRYNUM           PICK UP NUMBER OF ENTRIES       08280000
         BCTR  RFOUR,0                  REDUCE BY ONE                   08300000
SCANSTRT LR    RTHREE,RFOUR                                             08320000
         LA    RTWO,ENTRIES             SET UP POINTERS                 08340000
         LA    RFIVE,ENTRIES+4                                          08360000
COMPARE  CLC   2(2,RTWO),2(RFIVE)       CHECK FOR ENTRIES IN THE DADSM  08380000
*                                          TABLE FOR RTA SEQUENCE       08400000
         BH    CHANGTHM                 BRANCH IF ENTRIES ARE OUT OF    08420000
*                                          SEQUENCE                     08440000
REDUCT   BCT   RTHREE,UPTHEM            CHECK FOR END OF SCAN           08460000
         BCT   RFOUR,SCANSTRT           CHECK FOR END OF ENTIRE SORT    08480000
         B     XCTLHERE                                                 08500000
UPTHEM   LA    RTWO,4(RTWO)             UPDATE POINTERS                 08520000
         LA    RFIVE,4(RFIVE)                                           08540000
         B     COMPARE                                                  08560000
CHANGTHM L     RSEVEN,0(RTWO)           EXCHANGE THE ENTRIES IN THE     08580000
         MVC   0(4,RTWO),0(RFIVE)          DADSM TABLE                  08600000
         ST    RSEVEN,0(RFIVE)                                          08620000
         B     REDUCT                                                   08640000
*                                                                       08646021
* CHANNEL PROGRAM                                                       08652021
*                                                                       08660000
CHANPROG DS    0D                                                       08680000
*CCW1                                                                   08700000
         DC    X'31'                   SEARCH EQUAL ID FOR DSCB F5      08720000
         DC    AL3(0+COUNT-FIRST)       SID ON COUNT             Y02080 08740002
         DC    X'4000'                                                  08760000
         DC    H'5'                                                     08780000
*CCW2                                                                   08800000
         DC    X'08'                   TIC BACK TO SEARCH               08820000
         DC    AL3(0+CCW1-FIRST)                                        08840000
ZEROFLD  DC    F'0'                                                     08860000
*CCW3                                                                   08880000
         DC    X'0E'                                                    08900000
         DC    AL3(0+F5IN-FIRST)                                        08920000
         DC    X'0000'                                           A27089 08940019
         DC    H'140'                                                   08960000
*                                                                       08967021
* CONSTANTS                                                             08974021
*                                                                       08981021
*                                                                       08988002
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         08995002
*                                                                       08997002
         XCTLTABL ID=(NEXTLOAD,I3,ERRORLD,I7),SVC=032,LENGTH=,   Y02080X09002002
               BRT=YES                                           Y02080 09004002
         EJECT                                                   Y02080 09009002
JFCBKEN  DSECT                                                          09060000
         IEFJFCBN                                                       09100000
         EJECT                                                   Y02080 09120002
DSCBWKAR IECALLWA EP,F4,D2=(5)          ALLOCATE WORK AREA       Y02080 09140002
ENTRYNUM EQU   AENTRYNM                 EQUATE FOR AENTRYNM      Y02080 09160002
ENTRIES  EQU   AENTRIES                 EQUATE FOR AENTRIES      Y02080 09180002
SAVEREGB EQU   CCW12                    SAVE AREA                Y02080 09200002
         EJECT                                                   Y02080 09220002
CVT      DSECT                          CVT DSECT                Y02080 09240002
         CVT                                                     Y02080 09260002
         END                                                            10320000
./  ADD  SSI=63270603,NAME=IGG032I3
 TITLE 'IGG032I3 - ISAM ALLOCATE - BUILDS F1,F2,F3 DSCBS'               00020000
IGG032I3 CSECT                                                          00028000
*                                                                       00030002
*MODULE NAME = IGG032I3                                                 00032002
*                                                                       00034002
*DESCRIPTIVE NAME = ISAM ALLOCATE - BUILDS F1, F2, AND F3 DSCB'S        00034402
*                                                                       00034802
*COPYRIGHT = NONE                                                       00035202
*                                                                       00035602
*CHANGE ACTIVITY = SEE BELOW                                            00035702
*                                                                       00035802
*          RELEASE 16 DELETIONS                                         00036000
*1462098200                                                        AAAA 00040016
*1462029200,058200-058400                                         13559 00041016
*1462                                                             15708 00042016
*          RELEASE 17 DELETIONS                                         00044000
*          RELEASE 18 DELETIONS                                         00052000
*1662031200,031400,048200                                         23475 00056018
*          RELEASE 19 DELETIONS                                         00060000
*          RELEASE 20 DELETIONS                                         00068000
*1291033400,041700-041800,047200-047600,053200-055600            S20016 00072020
*          RELEASE 21 DELETIONS                                         00076000
*0000003400,017200,018200-018800,020800,026200-026400,           A38860 00077021
*0000026800-027000,034800-035000,037000-038400,038480,           A38860 00078021
*0000038600-039600,043220-043340,066600,069000-069200,           A38860 00079021
*0000070000-070600,070800,100600                                 A38860 00080021
*0000030800,031100-031800,034400-034600,036200,087700            M0184  00081021
*          RELEASE 22 DELETIONS                                         00084000
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00092002
*0000000030-000150,000920-001000,002800,003400,005600,006000,    Y02080 00092102
*0000017800,018300-018600,025600,029400,030200,040800,041650-    Y02080 00092202
*0000042800,043360,043600,045000,048000,056600,061200,061900,    Y02080 00092302
*0000064400,069400-069800,070700-070800,088100,088650-088800,    Y02080 00092402
*0000089200,089600-103600                                        Y02080 00092502
*0000005200,008400,024640,024710,038480,039320-041400,088000     Y02134 00092602
*0000                                                            Y02144 00092702
*0000                                                            Y02082 00092802
*0000006200,060800-062200,089720-088600,089500,097800-098000     YM3995 00093002
*                                                                     * 00093402
*          VS2 RELEASE 03.0 DELETIONS/CHANGES                         * 00095002
*0000087900                                                     ZA00704 00097002
*          VS2 RELEASE 03.7 CHANGES/SU8                                 00098008
*A038045-038051                                                @ZA15055 00099008
*                                                                       00100002
*STATUS CHANGE LEVEL 005                                                00110020
*FUNCTION - THIS MODULE CHECKS FOR EMBEDDED INDEX AND AN EXISTING DSCB  00120000
*           FORMAT1 AND MAKES THE APPROPRIATE TRANSFER OF CONTROL. IF   00140000
*           NEITHER IS THE CASE IT BUILDS A DSCB FORMAT1 AND IF NECES-  00160000
*           SARY A DSCB FORMAT2 AND/OR FORMAT 3. THE DSCB'S CREATED ARE 00180000
*           WRITTEN OUT AND A TRANSFER OF CONTROL TO THE MODULE         00200000
*           IGG032I6 IS MADE.                                           00220000
*                                                                       00240000
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG032I3. ENTRY IS    00260000
*           MADE FROM THE SECOND LOAD OF ISAM ALLOCATE VIA A BRANCH.    00280002
*                                                                       00300000
*INPUT - AT ENTRY TO THIS MODULE REG 11 POINTS TO A JFCB. REGISTER      00320000
*        13 POINTS TO THE ALLOCATE WORK AREA CONTAINING THE VTOCADR,    00340002
*        THE DADSMADR, AND A FORMAT 1 DSCB IF ONE EXISTS. A SORTED      00360000
*        DADSM TABLE WILL BE IN THE WORK AREA.                          00380000
*                                                                       00380721
*        IF MORE THAN ONE DD STATEMENT IS USED IN REQUESTING SPACE,     00381421
*        THE SEVEN LOW-ORDER BYTES OF THE DDNAME FIELD IN ALL BUT THE   00382121
*        FIRST ISAM DD ENTRY ARE USED TO CREATE THE FOLLOWING SPECIAL   00382821
*        ISAM ALLOCATE INTERFACE:                                       00383521
*                                                                       00384221
*              BYTE 1                                                   00384921
*                   BITS 0 AND 1   00 - ABSOLUTE TRACK REQUEST          00385621
*                                  01 - BLANK SPACE REQUEST             00386321
*                                  11 - CONTIGUOUS SPACE REQUEST        00387021
*                                                                       00387721
*                   BIT 2          THIS IS THE SECOND DD CARD.          00388421
*                                                                       00389121
*                   BIT 5          OVFLOW HAS BEEN ALLOCATED.           00389821
*                                                                       00390521
*                   BIT 6          PRIME HAS BEEN ALLOCATED.            00391221
*                                                                       00391921
*                   BIT 7          INDEX HAS BEEN ALLOCATED.            00392621
*                                                                       00393321
*              BYTES 2 - 3         CURRENT VOLUME SEQUENCE NUMBER       00394021
*                                  FOR SECOND OR THIRD DD ENTRY         00394721
*                                                                       00395421
*              BYTES 4 - 7         POINTER TO THE FIRST TIOT ENTRY      00396121
*                                  FOR THIS REQUEST                     00396821
*                                                                       00397521
*                                                                       00400000
*OUTPUT - UPON TRANSFERRING TO THE NEXT MODULE IGG032I6,THE  WORK AREA  00420000
*         WILL CONTAIN A SORTED DADSM TABLE, THE VTOCADR AND DADSMADR.  00440000
*                                                                       00460000
*EXTERNAL ROUTINES - THE FOLLOWING ARE SUPERVISOR CALLS ISSUED IN THE   00480000
*   MACRO EXPANSIONS                                                    00500000
*   EXCP(0) READ FROM OR WRITE TO DIRECT ACCESS DEVICE                  00520002
*   WAIT(1) WAIT ON EVENT CONTROL BLOCK                                 00540000
*                                                                       00570002
*   OTHER MACROS ISSUED - IEFJFCBN - BUILDS JFCB                        00580000
*                         IECALLWA - ALLOCATE WORK AREA EXPANSION       00590002
*                         IECSDSL1 - BUILDS DSCBS                       00600002
*                         IECDSECS - EXPANDS CVT, PSA, SCVT, UCB DSECTS 00620002
*                                                                       00640000
*                                                                       00660000
*EXITS - NORMAL - TO IGG032I4 WHEN F1,F2,F3 ALREADY EXIST               00680000
*               - TO IGG032I5 FOR EMBEDDED INDEX                        00700000
*               - TO IGG032I6 WHEN F1,F2,F3 ARE BUILT                   00720000
*      - ERROR - TO IGG032I7 WITH ERROR CODE IN REG5                    00740000
*                                                                       00760000
*              0C   PERMANENT I/O ERROR                                 00780000
*                                                                       00800000
*              1C - WRONG DSORG OR DISP                                 00806021
*                                                                       00812021
*                                                                       00820000
*TABLES/WORK AREAS - DADSM WORK AREA DESCRIBED BY MACRO IECALLWA        00840002
*                                                                       00860000
*                                                                       00880000
*              ***************************************                  00900000
*              *             DADSM TABLE             *                  00920000
*              ***************************************                  00940000
*                                                                       00960000
*              ***************************************                  00980000
*              *        *         *                  *                  01000000
*              *  TYPE  *  NO OF  *     USED HOLE    *                  01020000
*              *  FLAG  * ENTRIES *      COUNTER     *                  01040000
*              *        *         *                  *                  01060000
*              ***************************************                  01080000
*              *                  *                  *                  01100000
*              *       RTA        *      RTA+1       *                  01120000
*              *                  *                  *                  01140000
*              ***************************************                  01160000
*              *                  *                  *                  01180000
*              *       RTA        *      RTA+1       *                  01200000
*              *                  *                  *                  01220000
*              ***************************************                  01240000
*              *                  *                  *                  01260000
*              *       RTA        *      RTA+1       *                  01280000
*              *                  *                  *                  01300000
*              ***************************************                  01320000
*              *                  *                  *                  01340000
*              *       RTA        *      RTA+1       *                  01360000
*              *                  *                  *                  01380000
*              ***************************************                  01400000
*              *                  *                  *                  01420000
*              *       RTA        *      RTA+1       *                  01440000
*              *                  *                  *                  01460000
*              ***************************************                  01480000
*                                                                       01500000
*                                                                       01520000
*              TYPE FLAG = 02 - BPAM DIRECTORIES REQUESTED.             01540000
*                                                                       01560000
*                        = 40 - USER LABELS REQUESTED                   01564021
*                                                                       01568021
*                        = 80 - SET MUST COMPLETE IS ACTIVE             01572021
*                                                                       01576021
*                                                                       01580000
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.    01600000
*                                                                       01620000
*                                                                       01640000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.        01660000
*                                                                       01680000
*                                                                       01700000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT. 01720021
*                                                                       01740000
*                                                                       01760000
*ATTRIBUTES - REENTRANT                                                 01780002
*                                                                       01800000
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    01830002
*          WORK AREA = AS DEFINED IN THE IECALLWA MACRO                 01860002
*          RPS WORK AREA = AS DEFINED IN THE IECRPS MACRO               01870002
*                                                                       01900000
*                                                                       01920000
*REGISTER USAGE                                                         01940000
*              REGISTERS 0-9 WORK REGISTERS                             01960000
*              REGISTER 10 - TIOT SET UP TABLE POINTER                  01980000
*              REGISTER 11 - JFCB POINTER                               02000000
*              REGISTER 12 - BASE REGISTER                              02020000
*              REGISTER 13 - WORK AREA POINTER                          02040000
*              REGISTER 14 SUBROUTINE LINKAGE AND WORK REGISTER         02060000
*              REGISTER 15 WORK REGISTER                                02080021
***** REGISTER NAMES *****                                              02100000
RZERO    EQU   0                                                        02120000
RONE     EQU   1                                                        02140000
RTWO     EQU   2                                                        02160000
RTHREE   EQU   3                                                        02180000
RFOUR    EQU   4                                                        02200000
RFIVE    EQU   5                                                        02220000
RSIX     EQU   6                                                        02240000
RSEVEN   EQU   7                                                        02260000
REIGHT   EQU   8                                                        02280000
RNINE    EQU   9                                                        02300000
DRBAK   EQU   9                                                         02320000
RTEN     EQU   10                                                       02340000
RJFCB    EQU   11                                                       02360000
RBASE    EQU   12                                                       02380000
RWORK    EQU   13                                                       02400000
RETURN   EQU   14                                                       02420000
RFTEN    EQU   15                                                       02440000
*                                                                       02460000
* OTHER EQUATES                                                         02461021
*                                                                       02462021
ZERO     EQU   0                        CONSTANT OF 0            Y02134 02462402
K1       EQU   1                        CONSTANT OF 1            Y02082 02462602
F1ID     EQU   C'1'                     FORMAT ONE IDENTIFIER    M0184  02463002
STEPMC   EQU   1                        STATUS STEP MC INDICATOR YM3995 02463402
K12      EQU   12                       CONSTANT OF 12           YM3995 02463802
TIOEVOLS EQU   2                        DISP TO NBR OF DEVICES   A38860 02465002
TIOEDDNM EQU   4                        OFFSET TO DDNAME         A38860 02466002
ISAMSTAT EQU   5                        DISP TO ALLOCAT'N STATUS A38860 02467002
VOLSQCTR EQU   6                        OFFSET TO DS1VOLSQ CTR   A38860 02468002
TIOTPTR  EQU   8                        PTR TO 1ST TIOT ENTRY    A38860 02469002
UCBENTRY EQU   16                       OFFSET TO 1ST UCB ENTRY  A38860 02470002
BLANK    EQU   X'40'                    EBCDIC BLANK             A38860 02472002
RDWOPSWD EQU   X'04'                    READ-W/O-PASSWORD SWITCH Y02080 02474002
TWO      EQU   2                        CONSTANT OF TWO          Y02080 02476002
FOUR     EQU   4                        CONSTANT OF FOUR         Y02134 02477002
FIVE     EQU   5                        CONSTANT OF FIVE         Y02080 02479002
RESBITS  EQU   X'13'                    DSORG RESERVE BITS       Y02080 02479402
DS1RACDF EQU   X'40'                    DS1DSIND-DATA SET IS   @Z40RSGD 02479508
*                                       RAC DEFINED            @Z40RSGD 02479608
F2NEEDED EQU   X'80'                    FORMAT 2 NOT WRITTEN   @Z40RSGD 02479708
RACERR   EQU   X'A4'                    RAC ERROR CODE BASE    @Z40RSGD 02479808
TIOEFSRT EQU   X'10'                    OFFSET TO UCB          @Z40RSGD 02479908
*                                                                       02480000
         BALR  RBASE,0                                                  02520000
         USING BETA,RBASE                                               02540000
         USING ALLOCWKA,RWORK           WORK AREA ADDRESSABILITY Y02080 02560002
         USING JFCBKEN,RJFCB                                            02580000
*                                                                       02600000
* THIS SECTION RELOCATES THE CHANNEL PROGRAM TO BE USED BY IGG032I3,    02610021
* IGG032I4, AND IGG032I5. THIS CHANNEL PROGRAM WILL BE USED TO SEARCH   02620021
* FOR HOLES IN THE VTOC AND TO WRITE OUT OR READ IN FORMAT 1, 2, AND 3  02630021
* DSCB'S.                                                               02640021
*                                                                       02650021
BETA     LM    RZERO,RNINE,CHANNPR      RELOCATE CHANNEL PROGRAM        02660000
         ALR   RZERO,RWORK                                              02720000
         ALR   RFOUR,RWORK                                              02740000
         ALR   RSIX,RWORK                                               02760000
         STM   RZERO,RNINE,CCW1                                         02780000
         LM    RZERO,RNINE,CHANNPR+40    PICK UP 5 CCW'S                02800000
         ALR   RTWO,RWORK                                               02820000
         ALR   REIGHT,RWORK                                             02840000
         STM   RZERO,RNINE,CCW6                                         02860000
         LM    RZERO,RONE,CHANNPR+80                                    02880000
         STM   RZERO,RONE,CCW11                                         02900000
FINE     CLI   DS1FMTID,X'F1'           CHECK FOR EXISTENCE OF LEGAL    02960000
*                                          DUPLICATE NAME FORMAT 1 DSCB 02980000
         BNE   FROMJFCB                 BRANCH IF THERE IS NO F 1       03000000
         LA    RTWO,MOD32I4             POINT TO ID OF IGG032I4  Y02080 03010002
         B     XCT                                                      03040000
* THIS SECTION BUILDS ALL BUT THE EXTENT FIELDS OF A FORMAT 1 DSCB      03060000
FROMJFCB EQU   *                                                 M0184  03070021
         XC    DS1FMTID(DS1END-DS1FMTID),DS1FMTID  CLEAR F1 DSCB M0184  03080021
*                                                              @Z40RSGD 03081108
*   SET RAC DEFINED BIT IN FORMAT 1 DSCB IF AUTOMATIC DATA SET @Z40RSGD 03082208
*   PROTECTION REQUESTED IN JFCB.                              @Z40RSGD 03083308
*                                                              @Z40RSGD 03084408
         USING CVT,RFTEN                                       @ZA15055 03084508
         L     RFTEN,CVTPTR             GET ADDRESS OF CVT     @ZA15055 03084608
         L     RFTEN,CVTRAC             LOAD ACCESS CNTL ADDR  @ZA15055 03084708
         LA    RFTEN,0(,RFTEN)          CLEAR HI-ORD           @ZA15055 03084808
         LTR   RFTEN,RFTEN              RAC ACTIVE?            @ZA15055 03084908
         DROP  RFTEN                                           @ZA15055 03085008
         BZ    NORACBIT                 NO-CONTINUE            @ZA15055 03085108
         TM    JFCFLGS1,JFCBADSP        AUTO DATA SET PROTECT  @Z40RSGD 03085508
         BZ    NORACBIT                 NO-CONTINUE            @Z40RSGD 03086608
         OI    DS1DSIND,DS1RACDF        YES-SET RAC PROTECTED  @Z40RSGD 03087708
*                                       INDICATOR              @Z40RSGD 03088808
NORACBIT EQU   *                                               @Z40RSGD 03089908
         MVI   DS1FMTID,F1ID            MOVE IN F1 IDENTIFIER    M0184  03090021
         MVC   DS1CREDT(6),JFCBCRDT     CREATION AND EXPIRATION DATES   03100000
         MVC   DS1SYSCD(13),SYSCODE     MOVE IN SYSTEM CODE      M0184  03150021
         MVC   DS1DSORG(8),JFCDSORG     SET UP DATA SET ORGANIZATION    03200000
*                                       RECORD FORMAT                   03220000
*                                       OPTION CODE                     03240000
*                                       BLOCK LENGTH                    03260000
*                                       RECORD LENGTH                   03280000
         NI    DS1DSORG+K1,X'FF'-RESBITS CLEAR THE RESERVED BITS Y02082 03285002
         MVC   DS1KEYL(1),JFCKEYLE      RELATIVE KEY FIELD              03300000
         MVC   DS1RKP(2),JFCRKP         FLAG FIELD AND SECONDARY QTY    03320000
         TM    JFCBIND2,JFCBSCTY        DOES JFCB SPEC SECURITY  S20016 03340020
         BZ    NOSECTY                  BRANCH IF NO                    03360000
         OI    DS1DSIND,X'10'           SET SECURITY BIT IN DSCB F1     03380000
         TM    JFCBIND2,JFCBRWPW        DOES JFCB SPEC RWPW OPTN S20016 03385020
         BNO   NOSECTY                  BRANCH IF NO             S20016 03390020
         OI    DS1DSIND,RDWOPSWD        IND SECTY IS FOR WR ONLY S20016 03395020
NOSECTY  MVC   DS1SCALO(4),JFCBCTRI     SET REQUEST TYPE AND SECONDARY  03400000
*                                          QUANTITY                     03420000
         CLI   TIOEDDNM(RTEN),BLANK     CHECK FOR DDNAME FOR     A38860 03450021
*                                       THIS ENTRY IN THE TIOT   A38860 03480021
         BE    NOTFIRST                 BRANCH IF THIS NOT THE FIRST    03520000
         MVC   DS1DSSN(6),JFCBVOLS      MOVE IN DATA SET VOL SEQ NUM    03540000
         IC    RSIX,CTR                 PICK UP NUMBER OF VOLUMES       03560000
         LA    RSIX,1(RSIX)                COUNTER                      03580000
         STC   RSIX,DS1VOLSQ+1          SET VOLUME SEQUENCE NUMBER      03600000
         B     FILLEXTS                                                 03640000
* THIS SECTION CALCULATES THE VOLUME SEQUENCE NUMBER AND PICKS UP THE   03660000
* DATA SET SERIAL NUMBER FOR THE SECOND OR THIRD DD ENTRY               03680000
NOTFIRST EQU   *                                                 A38860 03700021
         LH    RSIX,VOLSQCTR(,RTEN)     GET NUMBER OF DEVICES    A38860 03720021
         LA    RSIX,1(RSIX)             INCREMENT THIS NUMBER    A38860 03740021
         STH   RSIX,VOLSQCTR(,RTEN)                              A38860 03760021
         MVC   DS1VOLSQ(2),VOLSQCTR(RTEN)  MOVE IN VOL SEQ NBR   A38860 03780021
*                                                                 15708 03841016
*              NO DDNAME IMPLIES CONCATENATION WITH A             15708 03842016
*              PREVIOUS DD CARD.  A BLANK TIOT POINTER ENTRY      15708 03843016
*              INDICATES THAT AN INVALID CONDITION EXISTS,        15708 03844016
*              DSORG=IS WAS NOT SPECIFIED FOR THE PRECEEDING      15708 03845016
*              DD CARD.                                           15708 03846016
*                                                                 15708 03847016
         CLC   TIOTPTR(FOUR,RTEN),BLANKS  CHECK PTR FOR BLANKS   Y02134 03848002
         BC    7,CONTINUE         BRANCH IF NOT EQUAL TO BLANKS   15708 03849016
         LA    RFIVE,28           INVALID REQUEST                 15708 03850016
         B     ERRORXCT                                           15708 03851016
CONTINUE EQU   *                                                  15708 03852016
         L     RSIX,TIOTPTR(,RTEN)      PTR TO 1ST TIOT ENTRY    A38860 03892021
         L     RTWO,UCBENTRY(,RSIX)     GET 1ST UCB ADDRESS      Y02134 03980002
         LA    RTWO,ZERO(,RTWO)         CLEAR HIGH BYTE          Y02134 04000002
         USING UCB,RTWO                                                 04160000
         MVC   DS1DSSN(6),SRTEVOLI      PICK UP VOLUME SERIAL    S20016 04161020
*                                       NO.                      S20016 04162020
FILLEXTS EQU   *                        BRANCH LABEL             Y02080 04212002
         LA    RTWO,AENTRIES            PICK UP DADSMTBL POINTER Y02080 04280002
         LA    RTHREE,DS1EXT1           PICK UP F1 EXTENT POINTER       04300000
         LA    RFOUR,3                  SET UP EXTENT COUNTER           04320000
         MVC   DS1NOEPV,AENTRYNM        STORE NUMBER OF EXTENTS  Y02080 04336002
         SR    RNINE,RNINE                                              04340000
         IC    RNINE,AENTRYNM           LOAD THE NBR OF ENTRIES  Y02080 04360002
*                                          IN THE DADSM TABLE           04380000
*                                                                       04400000
TEST1    OC    DIRQTY(2),DIRQTY         CHECK FOR EMBEDDED INDEX        04420000
*                                          QUANTITY                     04440000
         BZ    GOOD                     BRANCH IF NO EMBEDDED INDEX     04460000
*                                          QUANTITY REQUESTED           04480000
         LA    RTWO,MOD32I5             POINT TO ID OF IGG032I5  Y02080 04490002
         B     XCT                                                      04520000
GOOD     SR    RFIVE,RFIVE              SET EXTENT SEQUENCE NUMBER      04540000
         XC    F5IN+135(5),F5IN+135     CLEAR CHAIN FIELD               04560000
* THIS SECTION FILLS IN THE EXTENT FIELDS OF THE FORMAT 1               04580000
LOOP1    BAL   RETURN,LOOP                                              04600000
         BCTR  RNINE,0                  REDUCE NUMBER OF ENTRIES        04620000
         LTR   RNINE,RNINE              CHECK FOR THE LAST ENTRY        04640000
         BZ    ENTERED                  BRANCH IF ON LAST ENTRY         04660000
         BCTR  RFOUR,0                  REDUCE NUMBER OF SPACES IN F1   04680000
         LTR   RFOUR,RFOUR              CHECK FOR THE LAST F1 ENTRY     04700000
         BNZ   LOOP1                    BRANCH IF F1 NOT FULL    S20016 04703020
         SPACE 1                                                 S20016 04706020
* THIS SECTION BUILDS A DSCB FORMAT 3                                   04709020
         SPACE 1                                                 S20016 04712020
         MVI   IECSDSL3,X'03'           BUILD A DSCB F3          S20016 04715020
         MVC   IECSDSL3+1(3),IECSDSL3                            S20016 04718020
         XC    IECSDSL3+4(131),IECSDSL3+4                        S20016 04721020
         MVI   DS3FMTID,X'F3'           MOVE IN FORMAT           S20016 04724020
*                                       IDENTIFIER               S20016 04727020
         LA    RTHREE,DS3EXTNT                                   S20016 04730020
         SPACE 1                                                 S20016 04733020
* THIS SECTION FILLS IN THE EXTENT FIELDS OF THE FORMAT 3               04736020
         SPACE 1                                                 S20016 04739020
LOOP2    EQU   *                                                 S20016 04742020
         BAL   RETURN,LOOP              CALCULATE F3 EXTENTS     S20016 04745020
         BCTR  RNINE,RZERO              DECREMENT ENTRY COUNT    S20016 04748020
         LTR   RNINE,RNINE              CHECK FOR LAST ENTRY     S20016 04751020
         BNZ   LOOP2                    BRANCH IF NOT LAST DADSM S20016 04754020
*                                       TABLE ENTRY                     04757020
         BAL   DRBAK,WRITEF3            WRITE OUT DSCB F3        S20016 04760020
         MVC   F5IN+135(5),SAVEADR+5    SET UP F3 ADDRESS               04780000
         MVC   DS1PTRDS,SAVEADR+FIVE                             Y02080 04800002
NOSPACE  EQU   *                                                  23475 04810018
ENTERED  EQU   *                                                  23475 04820018
         TM    F2,X'80'                 TEST F2 BYTE FOR NEED     23475 04830018
*                                          A FORMAT 2 DSCB              04840000
         BC    8,ONEONLY                BRANCH IF NO FORMAT 2 DSCB      04860000
*                                          NEEDED                       04880000
* THIS SECTION BUILDS A DSCB FORMAT 2.                                  04900000
BUILDF2  MVI   F5IN,X'02'               BUILD A DSCB FORMAT 2           04920000
         XC    F5IN+1(134),F5IN+1                                       04940000
         MVC   DS2NOTRK(1),JFCNTM       PICK UP NUMBER OF TRACKS FOR    04960000
*                                          HIGHEST LEVEL INDEX          04980000
         MVC   DS2CYLOV(1),JFCCYLOF     PICK UP NUMBER OF TRACKS FOR    05000000
*                                          CYLINDER OVERFLOW            05020000
         MVI   DS2FMTID,X'F2'           SET FORMAT IDENTIFIER           05040000
        BAL   DRBAK,WRITEF2            WRITE OUT DSCB F2                05060000
         MVC   DS1PTRDS(5),TTRLL        MOVE F2 POINTER INTO F1         05080000
ONEONLY  EQU   *                        NEXT DSCB              @Z40RSGD 05100008
*                                                              @Z40RSGD 05106208
*   DEFINE CURRENT VOLUME OF THIS DATA SET TO RAC IF DATA SET  @Z40RSGD 05112408
*   IS TO BE RAC PROTECTED.                                    @Z40RSGD 05118608
*                                                              @Z40RSGD 05119808
         TM    DS1DSIND,DS1RACDF        IS IT RAC DEFINED      @Z40RSGD 05119908
         BZ    RACDEFOK                 NO-CONTINUE            @Z40RSGD 05126108
         L     RTHREE,DEB+32            CURRENT UCB            @Z40RSGD 05128908
         MVC   RACDEF(LRACDEF),MRACDEF  SETUP RACDEF PARM LIST @Z40RSGD 05132208
*   CHECK FOR FIRST VOLUME                                     @Z40RSGD 05134808
         CLI   F2,F2NEEDED              FIRST                  @Z40RSGD 05136008
         BNE   RACNEXTD                 NO-PROCESS SUBSEQUENT  @Z40RSGD 05137208
         RACDEF TYPE=DEFINE,                                   @Z40RSGDX05137308
               ENTITY=JFCBDSNM,                                @Z40RSGDX05138208
               VOLSER=UCBVOLI-UCB(RTHREE),                     @Z40RSGDX05138408
               MF=(E,RACDEF)                                   @Z40RSGD 05138608
         B     RACCHKIT                 CHECK RESULTS          @Z40RSGD 05138808
RACNEXTD EQU   *                        PROCESS NON-FIRST VOL  @Z40RSGD 05139008
*   LOCATE FIRST UCB FOR FIRST DD                              @Z40RSGD 05144708
         L     RTWO,ADSABLST            DSAB LIST              @Z40RSGD 05145208
         L     RTWO,FIRSDSAB-DSABLIST(RTWO) FIRST DSAB         @Z40RSGD 05145308
         L     RTWO,DSABTIOT-DSAB(RTWO) TIOT ENTRY             @Z40RSGD 05146208
         L     RTWO,TIOEFSRT(RTWO)      UCB POINTER            @Z40RSGD 05147908
         RACDEF TYPE=ADDVOL,                                   @Z40RSGDX05148308
               ENTITY=JFCBDSNM,                                @Z40RSGDX05149208
               VOLSER=UCBVOLI-UCB(RTHREE),                     @Z40RSGDX05150108
               OLDVOL=UCBVOLI-UCB(RTWO),                       @Z40RSGDX05151008
               MF=(E,RACDEF)                                   @Z40RSGD 05151908
RACCHKIT LTR   RFTEN,RFTEN                                     @Z40RSGD 05152808
         BZ    RACDEFOK                                        @Z40RSGD 05153708
         LA    RFIVE,RACERR(RFTEN)      SET ERROR CODE         @Z40RSGD 05154608
         B     ERRORXCT                 GO TO ERROR EXIT 32I7  @Z40RSGD 05155508
RACDEFOK EQU   *                        RACDEF COMPLETE        @Z40RSGD 05156408
         BAL   DRBAK,WRITEF1            WRITE OUT DSCB F1      @Z40RSGD 05157308
         TM    DS4VTOCI,X'80'           CHECK FOR THE VTOC BEING IN AN  05158208
*                                          UNEXPECTED CONDITION         05159108
         BC    1,XCTLDADS               BRANCH IF VTOC NOT IN THE       05160000
*                                          EXPECTED CONDITION           05180000
         CLC   SAVEADR(5),DS4HPCHR      CHECK FOR NEED TO UPDATE THE    05200000
*                                          POINTER IN F4 TO THE LAST F1 05220000
         BNH   XCTLDADS                 BRANCH IF POINTER DOESN'T NEED  05240000
*                                          UPDATING                     05260000
         MVC   DS4HPCHR(5),SAVEADR      MOVE IN POINTER TO LAST FORMAT1 05280000
         B     XCTLDADS                                                 05300000
* THIS SECTION SETS UP THE CHANNEL PROGRAM FOR WRITING OUT DSCB FORMAT  05580000
* 1,2, AND 3.                                                           05600000
WRITEF1  LA    RFOUR,SAVEADR            PICK UP POINTER TO ADDRESS FOR  05620000
*                                          FORMAT 1                     05640000
         LA    RTHREE,DS1DSNAM          ADDRESS TO WRITE FROM    Y02080 05660002
         MVC   DS1DSNAM(44),JFCBDSNM   RESET DSNAME PORTION OF F1 AFTER 05680000
*                                         USING IT FOR THE CONVERT RTN  05700000
CHANGE2  LA    RTWO,CCW1                START PROGRAM TO SEARCH FOR A   05720000
*                                          HOLE IN THE VTOC             05740000
         IC    RONE,UHOLECTR+1          PICK UP NUMBER OF DSCB'S        05760000
         LA    RONE,1(RONE)                WRITTEN AND UPDATE IT        05780000
         STC   RONE,UHOLECTR+1                                          05800000
         ST    RTWO,IOB+16             SET ENTRY TO CHNL PGM      13559 05830016
         ST    RFOUR,CCW2              SET ADDR TO SEARCH ON IN   13559 05850016
*                                          THE FOLLOWING CCW'S          05880000
         MVI   CCW2,X'92'              RESTORE COMMAND CODE       13559 05900016
         MVC   CCW6+1(FOUR),CCW2+1                                13559 05920002
         MVC   CCW9+1(FOUR),CCW2+1                                13559 05940002
         ST    RTHREE,PDLIST                                            05960000
         MVC   CCW5+1(3),PDLIST+1      MOVE IN READ INTO AND WRITE OUT  05980000
         MVC   CCW8+1(3),PDLIST+1          OF AREA ADDRESS              06000000
         MVC   CCW11+1(3),PDLIST+1                                      06020000
         MVC   SEEK+3(4),VTOCADR       START SEARCH AT VTOC ADR   13559 06022016
         ST    DRBAK,CCW7+4            SAVE RETURN ADDRESS        13559 06024016
         BAL   DRBAK,CHKSMC            SEARCH FOR F0              13559 06026016
         L     DRBAK,CCW7+4            RESTORE RETURN ADDRESS     13559 06028016
         MVC   SEEK+3(4),0(RFOUR)      SEEK TO FOUND F0           13559 06030016
         LA    RZERO,CCW6              START CHANNEL PROGRAM ...  13559 06032016
         ST    RZERO,IOB+16                 AT   CCW6             13559 06034016
CHKSMC   EQU   *                                                  13559 06036016
         TM    TYPEFLG,SMCDONE          IS SET MUST COMPLETE ON         06040000
         BO    CLRECB                   BRANCH IF YES                   06060000
*                                                                       06065002
* LINK TO THE STATUS ROUTINE TO PERFORM A STEP MUST COMPLETE            06070002
*                                                                       06075002
         STM   RJFCB,RETURN,IECREGSV+K12  SAVE REGISTERS 11-14   YM3995 06080002
         LR    RTHREE,RWORK             SAVE WORK AREA ADDRESS   YM3995 06085002
GETLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  YM3995X06090002
               RELATED=(LOCAL,IGG032I3(RLSELOCK))  OBTAIN LOCK   YM3995 06095002
         LM    RJFCB,RETURN,IECREGSV+K12-ALLOCWKA(RTHREE)        YM3995 06100002
*                                                                       06105002
         USING CVT,RFTEN                CVT ADDRESSABILITY       YM3995 06110002
         L     RFTEN,CVTPTR             LOAD CVT ADDRESS         YM3995 06115002
         L     RFTEN,CVTABEND           LOAD SECONDARY CVT PTR   YM3995 06120002
         USING SCVTSECT,RFTEN           2NDRY CVT ADDRESSABILITY YM3995 06125002
         L     RFTEN,SCVTSTAT           LOAD STATUS EP ADDRESS   YM3995 06130002
         DROP  RFTEN                                             YM3995 06135002
         LA    RZERO,STEPMC             INDICATE STEP MC         YM3995 06140002
         XR    RONE,RONE                INDICATE STATUS SET      YM3995 06145002
*                                                                       06150002
         BALR  RETURN,RFTEN             LINK TO STATUS ROUTINE   YM3995 06155002
*                                                                       06160002
RLSELOCK EQU   *                        RELEASE THE LOCK         YM3395 06165002
         STM   RJFCB,RETURN,IECREGSV+K12  SAVE REGISTERS 11-14   YM3995 06170002
         LR    RTHREE,RWORK             SAVE WORK AREA ADDRESS   YM3995 06175002
         SETLOCK RELEASE,TYPE=LOCAL,                             YM3995X06180002
               RELATED=(LOCAL,IGG032I3(GETLOCK))  RELEASE LOCK   YM3995 06185002
         LM    RJFCB,RETURN,IECREGSV+K12-ALLOCWKA(RTHREE)        YM3995 06190002
*                                                                       06240000
         OI    DSMADTB2,DSMSMCE         SET ENQ'ED SMC SWITCH    Y02144 06250002
         OI    TYPEFLG,SMCDONE          TURN ON SMC INDICATOR           06260000
CLRECB   EQU   *                                                  15708 06280016
         EXCP  IOB                                                      06300000
         WAIT  1,ECB=ECB                                                06320000
         TM    ECB,X'20'                TEST FOR A PERMANENT I/O ERROR  06340000
        BCR   7,DRBAK                  BRANCH IF NO PERMANENT           06360000
*                                          ERROR                        06380000
         LA    RFIVE,12                 SET ERROR CODE FOR PERMANENT    06400000
*                                          I/O ERROR                    06420000
ERRORXCT EQU   *                                                  15708 06430016
         LA    RTWO,ERRORLD             POINT TO ID OF IGG032I7  Y02080 06440002
         B     XCT                                                      06460000
WRITEF2  LA    RFOUR,TTRLL              PICK UP POINTER TO ADDRESS FOR  06480000
*                                          FORMAT 2                     06500000
WRITE    LA    RTHREE,F5IN              PICK UP ADDRESS TO WRITE FROM   06520000
         B     CHANGE2                                                  06540000
WRITEF3  LA    RFOUR,SAVEADR+5          PICK UP POINTER TO ADDRESS FOR  06560000
*                                          FORMAT 3                     06580000
         B     WRITE                                                    06600000
*                                                                       06620000
* THIS SECTION RELOCATES THE CHANNEL PROGRAM FOR THE FORMAT 5 UPDATING  06640000
* OF IGG032I6.                                                          06650021
*                                                                       06660021
XCTLDADS LA    RTWO,TTRLL               PICK UP POINTER TO ADDRESS FOR  06680000
         ST    RTWO,PDLIST                 FORMAT 5                     06700000
         MVC   CCW1+1(3),PDLIST+1                                       06720000
         MVC   CCW2+1(3),PDLIST+1                                       06740000
         MVC   CCW6+1(3),PDLIST+1                                       06760000
         MVC   CCW9+1(3),PDLIST+1                                       06780000
         LA    RTWO,DS1DSNAM            PICK UP ADDRESS TO READ INTO    06800000
         ST    RTWO,PDLIST                                              06820000
         MVC   CCW5+1(3),PDLIST+1                                       06840000
         MVC   CCW8+1(3),PDLIST+1                                       06860000
         LA    RTWO,140(RTWO)           PICK UP ADDRESS TO WRITE FROM   06880000
         ST    RTWO,CCW11                                        A38860 06900021
         MVI   CCW11,X'0E'              RESTORE RD COMMAND CODE  A38860 06920021
*                                                                       06930002
* THIS SECTION BRANCHES TO ANOTHER MODULE.                              06940002
*                                                                       06960002
         LA    RTWO,F5LOAD              POINT TO ID OF IGG032I6  Y02080 07010002
XCT      EQU   *                                                 A38860 07020021
         IECRES LOAD,EXTPR=(RWORK),MODID=(RTWO),BRANCH=DIRECT    Y02080 07070002
*                                                                       07080002
*THIS SECTION SET UP AND BRANCHES TO CONVERT ROUTINE TO CONVERT FROM    07100000
*RTA TO CCHH                                                            07120000
LOOP     MVC   0(1,RTHREE),TYPE        SET EXTENT TYPE                  07140000
         STC   RFIVE,1(RTHREE)         SET EXTENT SEQUENCE NUMBER       07160000
         LA    RFIVE,1(RFIVE)                                           07180000
         L     RSIX,CVTPTR             PICK UP CVT POINTER              07200000
         USING CVT,RSIX                                                 07220000
         STM   RZERO,RTWO,DS1DSNAM      SAVE REGISTERS ZERO THRU TWO    07240000
         STM   RNINE,RETURN,DS1DSNAM+12   AND NINE THRU 15 BEFORE       07260000
*                                         BRANCHING TO THE CONVERT RTN  07280000
         L     RFTEN,CVTPCNVT          CONVERT ROUTINE ADDRESS          07300000
         LA    RONE,DEB                R1=DEB ADDRESS                   07320000
         LH    RZERO,0(RTWO)           R0=RTN TO BE CONVERTED           07340000
         SLL   RZERO,16                                                 07360000
         LA    RTWO,DS1DSNAM+36        R2=ADDRESS OF 8 BYTE RESULT AREA 07380000
         LR    REIGHT,RWORK            SAVE AREA ADDRESS                07400000
         BALR  RETURN,RFTEN                                             07420000
         MVC   2(4,RTHREE),39+DS1DSNAM-FIRST(REIGHT)                    07440000
         L     RSEVEN,8+DS1DSNAM-FIRST(REIGHT) CONVERT RTA+1 IN THE     07460000
         LH    RZERO,2(RSEVEN)            SAME MANNER AS RTA            07480000
         BCTR  RZERO,0                                                  07500000
         SLL   RZERO,16                                                 07520000
         L     RFTEN,CVTPCNVT           PICK UP CONVERT ROUTINE ADDRESS 07540000
         BALR  RETURN,RFTEN                                             07560000
         MVC   6(4,RTHREE),39+DS1DSNAM-FIRST(REIGHT)                    07580000
         LM    RZERO,RTWO,DS1DSNAM-FIRST(REIGHT)                        07600000
         LM    RNINE,RETURN,DS1DSNAM+12-FIRST(REIGHT)                   07620000
         LA    RTHREE,10(RTHREE)       UPDATE DSCB POINTER              07640000
         LA    RTWO,4(RTWO)            UPDATE EXTENT POINTER            07660000
         BR    RETURN                                                   07680000
         EJECT                                                 @Z40RSGD 07680508
*                                                              @Z40RSGD 07680808
*   MASTER RACDEF PARAMETER LIST                               @Z40RSGD 07681608
*                                                              @Z40RSGD 07682408
MRACDEF  RACDEF DSTYPE=N,                                      @Z40RSGDX07683208
               MF=L                                            @Z40RSGD 07684008
LRACDEF  EQU   *-MRACDEF                LENGTH RACDEF PARMLIST @Z40RSGD 07684808
*                                                                       07685021
* CHANNEL PROGRAM                                                       07690021
*                                                                       07695021
         DS    0D                                                       07700000
CHANNPR  EQU   *                                                        07720000
*CCW1                                                                   07740000
         DC    X'16'                   READ RECORD ZERO           13559 07760016
         DC    AL3(0+F5IN-FIRST)                                        07780000
         DC    X'7000'                                                  07800000
         DC    H'4'                                                     07820000
*CCW2                                                                   07840000
         DC    X'92'                    READ COUNT                      07860000
         DC    AL3(000000)                                              07880000
         DC    X'6000'                                                  07900000
         DC    H'5'                                                     07920000
*CCW3                                                                   07940000
         DC    X'A9'                    SEARCH EQUAL KEY                07960000
         DC    AL3(4+CCW4-FIRST)                                        07980000
         DC    X'6000'                                                  08000000
         DC    H'4'                                                     08020000
*CCW4                                                                   08040000
         DC    X'08'                    TIC                             08060000
         DC    AL3(0+CCW2-FIRST)                                        08080000
ZEROS    DC    F'0'                                                     08100000
*CCW5                                                                   08120000
         DC    X'06'                    READ DATA                       08140000
         DC    AL3(000000)                                              08160000
         DC    X'3000'                 BREAK CHANNEL PROGRAM HERE 13559 08180016
         DC    H'8'                                                     08200000
*CCW6                                                                   08220000
         DC    X'31'                    SEARCH EQUAL ID                 08240000
         DC    AL3(000000)                                              08260000
         DC    X'4000'                                                  08280000
         DC    H'5'                                                     08300000
*CCW7                                                                   08320000
         DC    X'08'                    TIC                             08340000
         DC    AL3(0+CCW6-FIRST)                                        08360000
         DC    F'0'                                                     08380000
*CCW8                                                                   08400000
         DC    X'0D'                    WRITE KEY AND DATA              08420000
         DC    AL3(000000)                                              08440000
         DC    X'4000'                                                  08460000
         DC    H'140'                                                   08480000
*CCW9                                                                   08500000
         DC    X'31'                    SEARCH EQUAL ID                 08520000
         DC    AL3(000000)                                              08540000
         DC    X'4000'                                                  08560000
         DC    H'5'                                                     08580000
*CCW10                                                                  08600000
         DC    X'08'                    TIC                             08620000
         DC    AL3(0+CCW9-FIRST)                                        08640000
         DC    F'0'                                                     08660000
*CCW11                                                                  08680000
         DC    X'0E'                    READ KEY AND DATA               08700000
         DC    AL3(000000)                                              08720000
         DC    X'1000'                                                  08740000
         DC    H'140'                                                   08760000
*                                                                       08768021
* CONSTANTS                                                             08776021
*                                                                       08784021
SYSCODE  DC    CL13'IBMOSVS2'           SYSTEM CODE             ZA00704 08790002
BLANKS   DC    CL4' '                   FOUR BLANKS              YM3995 08800002
*                                                                       08865002
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         08870002
*                                                                       08875002
         XCTLTABL ID=(MOD32I4,I4,MOD32I5,I5,F5LOAD,I6,           Y02080X08880002
               ERRORLD,I7),SVC=032,LENGTH=,BRT=YES               Y02080 08885002
DSABLIST DSECT ,                                               @Z40RSGD 08886608
CURRDSAB DS    A                        CURRENT DSAB           @Z40RSGD 08888208
FIRSDSAB DS    A                        FIRST DSAB             @Z40RSGD 08889808
         EJECT                                                   Y02080 08890002
JFCBKEN  DSECT                                                          08900000
         IEFJFCBN                                                       08940000
         SPACE 2                                                 Y02080 08945002
         IECDSECS CVT,PSA,SCVT,UCB,DSAB,EXPAND=YES             @Z40RSGD 08950008
DSCBWKAR IECALLWA EP,F4,D1=(1),D2=(2,3),ADT=YES  WORK AREA       Y02144 08960002
RACDEF   EQU   IECREGSV                 RACDEF PARM LIST       @Z40RSGD 08974208
         END                                                            10380000
./  ADD  SSI=33000024,NAME=IGG032I4
 TITLE 'IGG032I4 - ISAM ALLOCATE - UPDATES AND BUILDS F1,F2,F3'         00020000
IGG032I4 CSECT                                                          00030000
*                                                                       00032002
*MODULE NAME = IGG032I4                                                 00034002
*                                                                       00036002
*DESCRIPTIVE NAME = ISAM ALLOCATE - UPDATES AND BUILDS F1, F2, AND F3   00038002
*                                                                       00038402
*COPYRIGHT = NONE                                                       00038802
*                                                                       00039202
*CHANGE ACTIVITY = SEE BELOW                                            00039602
*                                                                       00039702
*          RELEASE 16 DELETIONS                                         00040000
*1492092800                                                        AAAA 00045016
*1492                                                             13559 00047016
*          RELEASE 17 DELETIONS                                         00050000
*          RELEASE 18 DELETIONS                                         00060000
*          RELEASE 19 DELETIONS                                         00070000
*          RELEASE 20 DELETIONS                                         00080000
*          RELEASE 21 DELETIONS                                         00090000
*1194042600-043000,043400-043600,044000-044200,046200-046400,    A42162 00092021
*1194047000,047400-047600,048000-048200,058800,061200-061400,    A42162 00094021
*1194071400-071600,081580-081600                                 A42162 00096021
*1194003600,004000,016600,017600-018200,034000-034600,041800-    A38860 00097021
*1194042000,062000,062600-063400,076400,077200-077600,081800-    A38860 00098021
*1194083000,095200                                               A38860 00099021
*          RELEASE 22 DELETIONS                                         00100000
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00110002
*0000000030-000150,001100-001200,002800,003600,006000,006600-    Y02080 00110102
*0000007000,008000,017200,017700-018000,024200-024320,025200,    Y02080 00110202
*0000025600,062000-062400,063000-063300,070200,074800,077300,    Y02080 00110302
*0000082520,083250-083400,083800,084200-097400,097800            Y02080 00110402
*0000                                                            Y02144 00110502
*0000006600,074400-075800,081920-083200,092400-092600,093200-    YM3995 00111002
*0000097800                                                      YM3995 00111502
*                                                                       00120002
*STATUS CHANGE LEVEL 005                                                00130021
*FUNCTION - THIS MODULE UPDATES AN EXISTING FORMAT 1 DSCB AND IF        00140000
*           NECESSARY UPDATES A FORMAT 2 DSCB AND BUILDS A DSCB FORMAT  00160000
*           3 OR UPDATES A FORMAT 3 DSCB. THE DSCB'S CREATED OR UPDATED 00180000
*           ARE WRITTEN OUT AND CONTROL IS TRANSFERED TO MODULE         00200000
*           IGG032I6.                                                   00220000
*                                                                       00240000
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG032I4. ENTRY IS    00260000
*          MADE FROM THE THIRD LOAD OF ISAM ALLOCATE VIA A BRANCH.      00280002
*                                                                       00300000
*                                                                       00320000
*INPUT - AT ENTRY TO THIS MODULE REG 11 POINTS TO A JFCB, REGISTER 13   00340000
*        POINTS TO THE ALLOCATE WORK AREA WHICH CONTAINS A PTR TO THE   00360002
*        ENTRY IN THE TIOT FOR THIS ALLOCATE AND THE ADDRESS OF THE     00380000
*        FORMAT 1 DSCB, THE VTOCADR, AND DADSMADR.                      00400021
*                                                                       00420000
*OUTPUT - UPON TRANSFERRING TO THE NEXT MODULE IGG032I6, THE WORK AREA  00440000
*         WILL CONTAIN A SORTED DADSM TABLE, THE VTOCADR AND DADSMADR   00460000
*                                                                       00480000
*                                                                       00500000
*EXTERNALLY REFERENCED ROUTINES - THE FOLLOWING ARE SUPERVISOR CALLS    00520000
*   ISSUED IN MACRO EXPANSIONS                                          00540000
*   EXCP(0) READ FROM OR WRITE TO DIRECT ACCESS DEVICE                  00560000
*   WAIT(1) WAIT ON EVENT CONTROL BLOCK                                 00580000
*   OTHER MACROS ISSUED - IEFJFCBN - BUILDS JFCB                        00620000
*                         IECALLWA - ALLOCATE WORK AREA EXPANSION       00630002
*                         IECSDSL1 - BUILDS DSCBS                       00640000
*                         IECDSECS - EXPANDS CVT, PSA, SCVT DSECTS      00660002
*                                                                       00670002
*EXITS - NORMAL - BRANCH TO IGG032I6                                    00680002
*        ERROR  - BRANCH TO IGG032I7 WITH ERROR CODE IN REGISTER 5      00700002
*                                                                       00720000
*              0C   PERMANENT I/O ERROR                                 00740000
*                                                                       00760000
*                                                                       00780000
*TABLES/WORK AREAS = DADSM WORK AREA DESCRIBED BY MACRO IECALLWA        00800002
*                                                                       00820000
*              ***************************************                  00840000
*              *             DADSM TABLE             *                  00860000
*              ***************************************                  00880000
*                                                                       00900000
*              ***************************************                  00920000
*              *        *         *                  *                  00940000
*              *  TYPE  *  NO OF  *     USED HOLE    *                  00960000
*              *  FLAG  * ENTRIES *      COUNTER     *                  00980000
*              *        *         *                  *                  01000000
*              ***************************************                  01020000
*              *                  *                  *                  01040000
*              *       RTA        *      RTA+1       *                  01060000
*              *                  *                  *                  01080000
*              ***************************************                  01100000
*              *                  *                  *                  01120000
*              *       RTA        *      RTA+1       *                  01140000
*              *                  *                  *                  01160000
*              ***************************************                  01180000
*              *                  *                  *                  01200000
*              *       RTA        *      RTA+1       *                  01220000
*              *                  *                  *                  01240000
*              ***************************************                  01260000
*              *                  *                  *                  01280000
*              *       RTA        *      RTA+1       *                  01300000
*              *                  *                  *                  01320000
*              ***************************************                  01340000
*              *                  *                  *                  01360000
*              *       RTA        *      RTA+1       *                  01380000
*              *                  *                  *                  01400000
*              ***************************************                  01420000
*                                                                       01440000
*                                                                       01460000
*              TYPE FLAG = 02 - BPAM DIRECTORIES REQUESTED.             01480000
*                                                                       01500000
*                        = 40 - USER LABELS REQUESTED                   01504021
*                                                                       01508021
*                        = 80 - SET MUST COMPLETE IS ACTIVE             01512021
*                                                                       01516021
*                                                                       01520000
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.    01540000
*                                                                       01560000
*                                                                       01580000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.        01600000
*                                                                       01620000
*                                                                       01640000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT. 01660021
*                                                                       01680000
*                                                                       01700000
*ATTRIBUTES - REENTRANT                                                 01720002
*                                                                       01740000
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    01770002
*          WORK AREA = AS DEFINED IN THE IECALLWA MACRO                 01800002
*          RPS WORK AREA = AS DEFINED IN THE IECRPS MACRO               01810002
*                                                                       01840000
*                                                                       01860000
*REGISTER USAGE                                                         01880000
*              REGISTERS 0-9 WORK REGISTERS                             01900000
*              REGISTER 10 I TIOT SET UP TABLE POINTER                  01920000
*              REGISTER 11 - JFCB POINTER                               01940000
*              REGISTER 12 - BASE REGISTER                              01960000
*              REGISTER 13 - WORK AREA POINTER                          01980000
*              REGISTER 14 SUBROUTINE LINKAGE AND WORK REGISTER         02000000
*              REGISTER 15 WORK REGISTER                                02020000
***** REGISTER NAMES *****                                              02040000
RZERO    EQU   0                                                        02060000
RONE     EQU   1                                                        02080000
RTWO     EQU   2                                                        02100000
RTHREE   EQU   3                                                        02120000
RFOUR    EQU   4                                                        02140000
RFIVE    EQU   5                                                        02160000
RSIX     EQU   6                                                        02180000
RSEVEN   EQU   7                                                        02200000
REIGHT   EQU   8                                                        02220000
RNINE    EQU   9                                                        02240000
DRBAK   EQU   9                                                         02260000
RTEN     EQU   10                                                       02280000
RJFCB    EQU   11                                                       02300000
RBASE    EQU   12                                                       02320000
RWORK    EQU   13                                                       02340000
RETURN   EQU   14                                                       02360000
RFTEN    EQU   15                                                       02380000
*                                                                       02400000
* OTHER EQUATES                                                         02406021
*                                                                       02412021
TWO      EQU   2                        CONSTANT OF TWO          Y02080 02414002
STEPMC   EQU   1                        STATUS STEP MC INDICATOR YM3995 02416002
K12      EQU   12                       CONSTANT OF 12           YM3995 02418002
*                                                                       02440000
         BALR  RBASE,0                                                  02480000
         USING GAMMA,RBASE                                              02500000
         USING ALLOCWKA,RWORK           WORK AREA ADDRESSABILITY Y02080 02520002
         USING JFCBKEN,RJFCB                                            02540000
*                                                                       02550021
GAMMA    EQU   *                        BRANCH LABEL             Y02080 02552002
         MVC   DS1DSNAM,JFCBDSNM        MOVE IN DATA SET NAME    Y02080 02560002
* THIS SECTION DETERMINES THE NUMBER OF EXISTING EXTENTS                02580000
F1EXISTS SR    RTWO,RTWO                CHECK NUMBER OF EXISTING        02600000
         IC    RTWO,DS1NOEPV               EXTENTS IN DSCB FORMAT 1     02620000
         LA    RONE,3                                                   02640000
         LR    RFIVE,RTWO               DETERMINE THE NEXT EXTENT       02660000
*                                          SEQUENCE NUMBER TO BE USED   02680000
         CR    RTWO,RONE                CHECK NUMBER OF EXISTING        02700000
*                                          EXTENTS                      02720000
         BH    F3EXISTS                 BRANCH IF MORE THAN 3 EXTENTS - 02740000
*                                          DSCB FORMAT 3 EXISTS         02760000
         BE    F3BUILD                  BRANCH IF 3 EXTENTS - DSCB F 3  02780000
*                                          MUST BE BUILT                02800000
* THIS SECTION DETERMINES HOW MUCH ROOM EXISTS IN FORMAT.               02820000
DETPOSIT SR    RSIX,RSIX                ADD TO NUMBER OF ENTRIES THE    02840000
         IC    RSIX,ENTRYNUM               NUMBER OF NEW ENTRIES        02860000
         LR    RFOUR,RTWO                                               02880000
         LR    RONE,RSIX                                                02900000
         AR    RSIX,RTWO                                                02920000
         STC   RSIX,DS1NOEPV            UPDATE NUMBER OF EXTENTS        02940000
         LA    RTWO,ENTRIES             SET POINTER TO DADSM TABLE      02960000
         LA    RSIX,2                                                   02980000
         CR    RSIX,RFOUR               CHECK TO SEE IF ONE OR  MORE    03000000
*                                          EXTENTS EXIST IN F1          03020000
         BH    TWOSPACE                 BRANCH IF ROOM FOR TWO EXTENTS  03040000
         LA    RTHREE,DS1EXT3           SET POINTER TO LAST F1 EXTENT   03060000
         LA    RNINE,1                  SET UP EXTENT COUNTER           03080000
         B     STRTLOOP                                                 03100000
TWOSPACE LA    RTHREE,DS1EXT2           SET POINTER TO THE 2ND F1       03120000
*                                          EXTENT                       03140000
         LA    RNINE,2                  SET UP EXTENT COUNTER           03160000
* THIS SECTION FILLS IN THE EXTENTS IN THE FORMAT 1                     03180000
STRTLOOP BAL   RETURN,LOOP                                              03200000
         BCTR  RONE,0                  REDUCE NUMBER OF NEW EXTENTS     03220000
         LTR   RONE,RONE                CHECK FOR LAST DADSM TABLE      03240000
*                                          ENTRY                        03260000
         BZ    ENTER                    BRANCH IF LAST ENTRY            03280000
         BCTR  RNINE,0                  REDUCE NUMBER OF AVAILABLE      03300000
*                                          HOLES                        03320000
         LTR   RNINE,RNINE              CHECK FOR LAST F1 EXTENT        03340000
         BZ    LABEL                    BRANCH IF LAST F1 EXTENT        03360000
         B     STRTLOOP                                                 03380000
* THIS SECTION DETERMINES THE TYPE OF REQUEST                           03480000
F3BUILD  LA    RTWO,ENTRIES             SET UP POINTER TO DADSM TABLE   03500000
         SR    RONE,RONE                                                03520000
         LR    RNINE,RONE              ADD TO THE NUMBER OF EXISTING    03540000
         IC    RONE,ENTRYNUM              ENTRIES THE NUMBER OF NEW     03560000
         IC    RNINE,DS1NOEPV              EXTENTS                      03580000
         AR    RNINE,RONE                                               03600000
         STC   RNINE,DS1NOEPV           UPDATE NUMBER OF ENTRIES        03620000
LABEL    LA    RTHREE,DS3EXTNT         SET UP POINTER TO F3 EXTENT      03640000
         XC    SAVEADR+5(5),SAVEADR+5  ZERO OUT THE F3 POINTER AREA IF  03660000
*                                         NO F3 HAS PREVIOUSLY EXISTED  03680000
         XC    F5IN(140),F5IN           CLEAR OUT F3 AREA               03700000
* THIS SECTION FILLS IN THE FORMAT 3 EXTENTS                            03720000
BUILDF3  BAL   RETURN,LOOP                                              03740000
         BCTR  RONE,0                   REDUCE NUMBER OF NEW EXTENTS    03760000
         LTR   RONE,RONE                CHECK FOR LAST EXTENT           03780000
         BZ    DONE                     BRANCH IF LAST DADSM TABLE      03800000
*                                          ENTRY                        03820000
         LA    RSIX,DS3FMTID            PICK UP FORMAT IDENTIFIER       03840000
*                                          ADDRESS                      03860000
         CR    RSIX,RTHREE              CHECK FOR F3 POINTER AT FORMAT  03880000
*                                          IDENTIFIER                   03900000
         BNE   BUILDF3                  BRANCH IF NOT AT FORMAT IDEN-   03920000
*                                          TIFIER                       03940000
         LA    RTHREE,1(RTHREE)         HOP OVER FORMAT IDENTIFIER      03960000
         B     BUILDF3                                                  03980000
* THIS SECTION BUILDS A FORMAT 3                                        04000000
DONE     MVI   DS3FMTID,X'F3'           SET UP FORMAT IDENTIFIERS       04020000
         MVI   IECSDSL3,X'03'                                           04040000
         MVC   IECSDSL3+1(3),IECSDSL3                                   04060000
        BAL   DRBAK,WRITEF3            WRITE OUT DSCB F3                04080000
         OC    DS1PTRDS(5),DS1PTRDS     CHECK F1 CHAIN FIELD FOR        04100000
*                                          POINTER TO ANOTHER DSCB      04120000
         BC    7,UPDATF2               BRANCH IF THERE IS A FORMAT 2    04140000
         MVC   DS1PTRDS(5),SAVEADR+5    PUT POINTER TO F3 IN F1         04160000
ENTER    EQU   *                                                 A38860 04170021
         BAL   DRBAK,WRITEF1            WRITE OUT THE F1 DSCB    A38860 04180021
         B     XCTLDADS                 XCTL TO IGG032I6         A38860 04190021
* THIS SECTION READS IN A FORMAT 2 DSCB                                 04220000
UPDATF2  LA    RTWO,CCW9                                                04240000
         ST    RTWO,IOB+16              START CHANNEL PROGRAM AT A42162 04260021
*                                       CCW9                     A42162 04280021
         MVI   CCW11+4,X'00'                                     A42162 04300021
         LA    RTWO,DS1PTRDS            PICK UP POINTER TO ADDRESS OF   04320000
         ST    RTWO,CCW9                FORMAT 2 TO SEARCH ON    A42162 04340021
         MVI   CCW9,X'31'               RESTORE SID CODE         A42162 04360021
         LA    RTWO,F5IN                PICK UP ADDRESS OF AREA IN      04380000
         ST    RTWO,CCW11               WHICH F2 IS TO BE READ   A42162 04400021
         MVI   CCW11,X'0E'              READ COMMAND CODE        A42162 04420021
         MVC   SEEK+3(5),DS1PTRDS       UPDATE THE SEEK ADDRESS         04440000
        BAL   DRBAK,EXEC                                                04460000
         MVC   DS2PTRDS(5),SAVEADR+5    SET F2 CHAIN ADDRESS TO F3      04480000
*                                          ADDRESS                      04500000
         MVC   TTRLL(5),DS1PTRDS        SET UP F2 ADDRESS               04520000
        BAL   DRBAK,WRITEF2            WRITE OUT DSCB F2                04540000
         B     ENTER                                                    04560000
* THIS SECTION MODIFIES THE CHANNEL PROGRAM FOR A READ OF A F2 OR F3    04580000
F3EXISTS LA    RTWO,F5IN                PICK UP ADDRESS OF AREA TO BE   04600000
         ST    RTWO,CCW11               WRITTEN INTO             A42162 04610021
         MVI   CCW11,X'0E'              READ COMMAND CODE        A42162 04620021
         MVI   CCW11+4,X'00'                                     A42162 04630021
         MVC   SAVEADR+5(5),DS1PTRDS    PICK UP ADDRESS IN F1 CHAIN     04660000
         LA    RTWO,DS1PTRDS               FIELD                        04680000
MODCHAN  EQU   *                                                 A42162 04700021
         MVC   SEEK+3(5),0(RTWO)           MODIFY SEEK FIELD            04720000
         ST    RTWO,CCW9                SEARCH ADDR FOR F2 OR F3 A42162 04740021
         MVI   CCW9,X'31'               RESTORE SID CODE         A42162 04760021
         LA    RTWO,CCW9                                                04780000
         ST    RTWO,IOB+16              START CHANNEL PROGRAM AT A42162 04800021
*                                       CCW 9                    A42162 04820021
        BAL   DRBAK,EXEC                                                04840000
         CLI   DS2FMTID,X'F3'           CHECK FOR A DSCB FORMAT 3       04860000
         BE    ISAF3                    BRANCH IF THIS A FORMAT 3       04880000
         LA    RTWO,DS2PTRDS            PICK UP CHAIN ADDRESS FROM F2   04900000
         MVC   SAVEADR+5(5),DS2PTRDS    PICK UP NEW ADDRESS FOR SEEK    04920000
         B     MODCHAN                                                  04940000
* THIS SECTION LOCATES THE FIRST AVAILABLE F3 EXTENT                    04960000
ISAF3    SR    RSEVEN,RSEVEN                                            04980000
         LR    RSIX,RSEVEN                                              05000000
         IC    RSEVEN,DS1NOEPV          PICK UP NUMBER OF EXISTING      05020000
         BCTR  RSEVEN,0                    EXTENTS AND DETERMINE        05040000
*                                          POSITION IN F3               05060000
         BCTR  RSEVEN,0                 REDUCE BY 3 FOR THOSE EXTENTS   05080000
         BCTR  RSEVEN,0                    IN THE FORMAT 1              05100000
         LA    RONE,10                                                  05120000
         MR    RSIX,RONE                                                05140000
         LA    RTHREE,DS3EXTNT          LOCATE NEXT ENTRY IN DSCB       05160000
         AR    RTHREE,RSEVEN               FORMAT 3                     05180000
         CLI   DS1NOEPV,X'07'           CHECK FOR THE SEVENTH EXTENT -  05200000
*                                          AT FORMAT IDENTIFIER         05220000
         BL    OKAY                     NOT TO FORMAT IDENTIFIER YET    05240000
         LA    RTHREE,1(RTHREE)         INCREMENT TO ADJUST FOR FORMAT  05260000
*                                          IDENTIFIER                   05280000
*                                                                       05300000
OKAY     LA    RTWO,ENTRIES             SET UP DADSM TABLE POINTER      05320000
         SR    RFOUR,RFOUR                                              05340000
         IC    RFOUR,ENTRYNUM           PICK UP NUMBER OF NEW ENTRIES   05360000
* THIS SECTION FILLS IN F3 EXTENTS                                      05380000
ENTRLOOP BAL   RETURN,LOOP                                              05400000
         BCTR  RFOUR,0                  REDUCE NUMBER OF DADSM TABLE    05420000
*                                          ENTRIES                      05440000
         LTR   RFOUR,RFOUR              CHECK FOR LAST ENTRY            05460000
         BZ    THRU                     BRANCH IF LAST ENTRY            05480000
         LA    RSIX,DS3FMTID            PICK UP FORMAT IDENTIFIER       05500000
*                                          ADDRESS                      05520000
         CR    RTHREE,RSIX              CHECK FOR F3 POINTER AT FORMAT  05540000
*                                          IDENTIFIER                   05560000
         BNE   ENTRLOOP                 BRANCH IF NOT AT FORMAT IDEN-   05580000
         LA    RTHREE,1(RTHREE)         HOP OVER FORMAT IDENTIFIER      05600000
         B     ENTRLOOP                                                 05620000
*                                                                       05640000
THRU    BAL   DRBAK,WRITEF3            WRITE OUT DSCB F3                05660000
         SR    RFOUR,RFOUR              UPDATE F1 NUMBER OF EXTENTS     05680000
         LR    RFIVE,RFOUR                 FIELD                        05700000
         IC    RFOUR,ENTRYNUM           PICK UP NUMBER OF NEW EXTENTS   05720000
         IC    RFIVE,DS1NOEPV           PICK UP NUMBER OF OLD EXTENTS   05740000
         AR    RFIVE,RFOUR                                              05760000
         STC   RFIVE,DS1NOEPV           UPDATE NUMBER OF EXTENTS ON     05780000
*                                          THIS VOLUME                  05800000
        BAL   DRBAK,WRITEF1            WRITE OUT DSCB F1                05820000
*                                                                       05840000
* THIS SECTION RELOCATES THE CHANNEL PROGRAM FOR THE FORMAT 5 UPDATING  05860000
* OF IGG032I6.                                                          05870021
*                                                                       05880021
XCTLDADS LA    RTWO,TTRLL               PICK UP ADDRESS OF FIELD TO     05900000
         ST    RTWO,PDLIST                 SEARCH ON                    05920000
         MVC   CCW1+1(3),PDLIST+1                                       05940000
         MVC   CCW2+1(3),PDLIST+1                                       05960000
         MVC   CCW6+1(3),PDLIST+1                                       05980000
         MVC   CCW9+1(3),PDLIST+1                                       06000000
         LA    RTWO,DS1DSNAM            PICK UP ADDRESS OF AREA TO      06020000
         ST    RTWO,PDLIST                 WRITE INTO                   06040000
         MVC   CCW5+1(3),PDLIST+1                                       06060000
         MVC   CCW8+1(3),PDLIST+1                                       06080000
         LA    RTWO,140(RTWO)           PICK UP ADDRESS OF AREA  FROM   06100000
         ST    RTWO,CCW11               WHICH TO WRITE           A42162 06120021
         MVI   CCW11,X'0E'              READ COMMAND CODE        A42162 06140021
         MVC   SEEK+3(5),DADSMADR       UPDATE THE SEEK ADDRESS TO      06160000
*                                          POINT TO THE FIRST F5        06180000
         LA    RTWO,NEXTLOAD            BRANCH TO IGG032I6       Y02080 06200002
*                                                                       06210002
* THIS SECTION BRANCHES TO ANOTHER MODULE.                              06220002
*                                                                       06240002
XCT      EQU   *                                                 A38860 06270021
         IECRES LOAD,EXTPR=(RWORK),MODID=(RTWO),BRANCH=DIRECT    Y02080 06300002
*                                                                       06330002
*THIS SECTION SET UP AND BRANCHES TO CONVERT ROUTINE TO CONVERT FROM    06360000
*RTA TO CCHH                                                            06380000
LOOP     MVC   0(1,RTHREE),TYPE        SET EXTENT TYPE                  06400000
         STC   RFIVE,1(RTHREE)         SET EXTENT SEQUENCE NUMBER       06420000
         LA    RFIVE,1(RFIVE)                                           06440000
         L     RSIX,CVTPTR             PICK UP CVT POINTER              06460000
         USING CVT,RSIX                                                 06480000
         STM   RZERO,RTWO,DS1DSNAM      SAVE REGISTERS ZERO THRU TWO    06500000
         STM   RNINE,RETURN,DS1DSNAM+12   AND NINE THRU 15 BEFORE       06520000
*                                         BRANCHING TO THE CONVERT RTN  06540000
         L     RFTEN,CVTPCNVT          CONVERT ROUTINE ADDRESS          06560000
         LA    RONE,DEB                R1=DEB ADDRESS                   06580000
         LH    RZERO,0(RTWO)           R0=RTN TO BE CONVERTED           06600000
         SLL   RZERO,16                                                 06620000
         LA    RTWO,DS1DSNAM+36        R2=ADDRESS OF 8 BYTE RESULT AREA 06640000
         LR    REIGHT,RWORK            SAVE AREA ADDRESS                06660000
         BALR  RETURN,RFTEN                                             06680000
         MVC   2(4,RTHREE),39+DS1DSNAM-FIRST(REIGHT)                    06700000
         L     RSEVEN,8+DS1DSNAM-FIRST(REIGHT) CONVERT RTA+1 IN THE     06720000
         LH    RZERO,2(RSEVEN)            SAME MANNER AS RTA            06740000
         BCTR  RZERO,0                                                  06760000
         SLL   RZERO,16                                                 06780000
         L     RFTEN,CVTPCNVT           PICK UP CONVERT ROUTINE ADDRESS 06800000
         BALR  RETURN,RFTEN                                             06820000
         MVC   6(4,RTHREE),39+DS1DSNAM-FIRST(REIGHT)                    06840000
         LM    RZERO,RTWO,DS1DSNAM-FIRST(REIGHT)                        06860000
         LM    RNINE,RETURN,DS1DSNAM+12-FIRST(REIGHT)                   06880000
         LA    RTHREE,10(RTHREE)       UPDATE DSCB POINTER              06900000
         LA    RTWO,4(RTWO)            UPDATE EXTENT POINTER            06920000
         BR    RETURN                                                   06940000
* THIS SECTION SETS UP THE CHANNEL PROGRAM                              06960000
WRITEF1  LA    RFOUR,SAVEADR            PICK UP ADDRESS OF SEARCH       06980000
*                                          ADDRESS FOR FORMAT 1         07000000
         LA    RTHREE,DS1DSNAM          PICK UP ADDRESS OF F1    Y02080 07020002
         MVC   SEEK+3(5),SAVEADR       UPDATE THE SEEK ADDRESS          07040000
         MVC   DS1DSNAM(44),JFCBDSNM   RESET DSNAME PORTION OF F1 AFTER 07060000
*                                      USING IT FOR THE CONVERT RTN     07080000
GOTID1   LA    RTWO,CCW6                UPDATE STARTING ADDRESS OF      07100000
*                                          CHANNEL PROGRAM              07120000
         ST    RTWO,IOB+16              START OF CHANNEL PROGRAM A42162 07150021
         ST    RFOUR,PDLIST             STORE ADDRESS OF SEARCH ADDRESS 07180000
         MVC   CCW2+1(3),PDLIST+1                                       07200000
         MVC   CCW6+1(3),PDLIST+1                                       07220000
         MVC   CCW9+1(3),PDLIST+1                                       07240000
         ST    RTHREE,PDLIST            STORE ADDRESS OF AREA TO BE     07260000
*                                          WRITTEN FROM                 07280000
         MVC   CCW5+1(3),PDLIST+1                                       07300000
         MVC   CCW8+1(3),PDLIST+1                                       07320000
         MVC   CCW11+1(3),PDLIST+1                                      07340000
         MVI   CCW11+4,X'10'            SET SUPPRESS DATA XFER   A42162 07350021
* THIS SECTION INITIATES THE CHANNEL PROGRAM TO SEARCH FOR HOLES IN THE 07360000
* VTOC AND WRITE OUT THE DSCB'S                                         07380000
EXEC     TM    TYPEFLG,SMCDONE          IS SET MUST COMPLETE ON         07400000
         BO    CLRECB                   BRANCH IF YES                   07420000
*                                                                       07425002
* LINK TO THE STATUS ROUTINE TO PERFORM A STEP MUST COMPLETE            07430002
*                                                                       07435002
         STM   RJFCB,RETURN,IECREGSV+K12  SAVE REGISTERS 11-14   YM3995 07440002
         LR    RTWO,RWORK               SAVE WORK AREA ADDRESS   YM3995 07445002
GETLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  YM3995X07450002
               RELATED=(LOCAL,IGG032I4(RLSELOCK))  OBTAIN LOCK   YM3995 07455002
         LM    RJFCB,RETURN,IECREGSV+K12-ALLOCWKA(RTWO)          YM3995 07460002
*                                                                       07465002
         USING CVT,RFTEN                CVT ADDRESSABILITY       YM3995 07470002
         L     RFTEN,CVTPTR             LOAD CVT ADDRESS         YM3995 07475002
         L     RFTEN,CVTABEND           LOAD SECONDARY CVT PTR   YM3995 07480002
         USING SCVTSECT,RFTEN           2NDRY CVT ADDRESSABILITY YM3995 07485002
         L     RFTEN,SCVTSTAT           LOAD STATUS EP ADDRESS   YM3995 07490002
         DROP  RFTEN                                             YM3995 07495002
         LA    RZERO,STEPMC             INDICATE STEP MC         YM3995 07500002
         XR    RONE,RONE                INDICATE STATUS SET      YM3995 07505002
*                                                                       07510002
         BALR  RETURN,RFTEN             LINK TO STATUS ROUTINE   YM3995 07515002
*                                                                       07520002
RLSELOCK EQU   *                        RELEASE THE LOCK         YM3395 07525002
         STM   RJFCB,RETURN,IECREGSV+K12  SAVE REGISTERS 11-14   YM3995 07530002
         LR    RTWO,RWORK               SAVE WORK AREA ADDRESS   YM3995 07535002
         SETLOCK RELEASE,TYPE=LOCAL,                             YM3995X07540002
               RELATED=(LOCAL,IGG032I4(GETLOCK))  RELEASE LOCK   YM3995 07545002
         LM    RJFCB,RETURN,IECREGSV+K12-ALLOCWKA(RTWO)          YM3995 07550002
*                                                                       07600000
         OI    DSMADTB2,DSMSMCE         SET ENQ'ED SMC SWITCH    Y02144 07610002
         OI    TYPEFLG,SMCDONE          TURN ON SMC INDICATOR           07620000
CLRECB   EQU   *                                                 A38860 07630021
         MVI   ECB,X'00'                CLEAR ECB                A38860 07640021
         EXCP  IOB                                                      07660000
         WAIT  1,ECB=ECB                                                07680000
         TM    ECB,X'20'                TEST FOR A PERMANENT I/O ERROR  07700000
         BCR   7,DRBAK                  RETURN IF OK             A38860 07710021
         LA    RFIVE,12                                          A38860 07720021
         LA    RTWO,ERROR               BRANCH TO IGG032I7       Y02080 07730002
         B     XCT                                               A38860 07740021
*                                                                       07750021
* THIS SECTION SETS UP TO WRITE F2 AND F3 DSCB'S AND TO FIND F0 DSCB'S. 07760021
*                                                                       07770021
WRITEF2  LA    RFOUR,TTRLL              PICK UP ADDRESS OF SEARCH       07780000
*                                          ADDRESS FOR FORMAT 2         07800000
         LA    RTHREE,F5IN              PICK UP ADDRESS OF AREA FOR F2  07820000
         MVC   SEEK+3(5),TTRLL          UPDATE THE SEEK ADDRESS         07840000
         B     GOTID1                                                   07860000
WRITEF3  LA    RFOUR,SAVEADR+5          PICK UP ADDRESS OF SEARCH       07880000
*                                          ADDRESS FOR FORMAT 3         07900000
         LA    RTHREE,F5IN              PICK UP ADDRESS OF AREA FOR F3  07920000
         OC    SAVEADR+5(5),SAVEADR+5   CHECK FOR THE EXISTENCE OF A    07940000
*                                          DSCB FORMAT 3                07960000
         BZ    CHANGE2                  BRANCH IF THERE IS NO FORMAT 3  07980000
         MVC   SEEK+3(5),SAVEADR+5      UPDATE THE SEEK ADDRESS         08000000
         B     GOTID1                                                   08020000
CHANGE2  LA    RTWO,CCW1                PICK UP STARTING POINT FOR      08040000
*                                          CHANNEL PROGRAM              08060000
         IC    RONE,UHOLECTR+1                                          08080000
         LA    RONE,1(RONE)                                             08100000
         STC   RONE,UHOLECTR+1          UPDATE THE NUMBER OF DSCB'S     08120000
*                                          CREATED                      08140000
         MVC   SEEK+3(4),VTOCADR       SEEK TO START OF VTOC      13559 08142016
         ST    DRBAK,CCW7+4            SAVE RETURN ADDRESS        13559 08144016
         ST    RTWO,IOB+16             START SEARCH AT CCW1       13559 08146016
         ST    RFOUR,CCW2              SET UP SEARCH ADDRESS      13559 08148016
         MVI   CCW2,X'92'              RESTORE COMMAND CODE       13559 08150016
         BAL   DRBAK,EXEC              SEARCH FOR FORMAT 0        13559 08152016
         L     DRBAK,CCW7+4            RESTORE RETURN ADDRESS     13559 08154016
         MVC   SEEK+3(4),SAVEADR+5     SEEK TO FOUND FORMAT 0     13559 08156016
         B     GOTID1                   CHANNEL PROGRAM WILL     A42162 08164021
*                                       START AT CCW6            A42162 08172021
*                                                                       08325002
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         08330002
*                                                                       08335002
         XCTLTABL ID=(NEXTLOAD,I6,ERROR,I7),SVC=032,LENGTH=,     Y02080X08340002
               BRT=YES                                           Y02080 08345002
         SPACE 2                                                 Y02080 08350002
         IECDSECS CVT,PSA,SCVT,EXPAND=YES                        YM3995 08355002
JFCBKEN  DSECT                                                          08360000
         IEFJFCBN                                                       08400000
         EJECT                                                   Y02080 08420002
DSCBWKAR IECALLWA EP,F4,D1=(1),D2=(2,3),ADT=YES  WORK AREA       Y02144 08440002
ENTRYNUM EQU   AENTRYNM                 AENTRYNM EQUATE          Y02080 09280002
ENTRIES  EQU   AENTRIES                 AENTRIES EQUATE          Y02080 09300002
         END                                                            09800000
./  ADD  SSI=62510171,NAME=IGG032I5
 TITLE 'IGG032I5 - ISAM ALLOCATE - EMBEDDED INDEX'                      00020000
IGG032I5 CSECT                                                          00030000
*                                                                       00032002
*MODULE NAME = IGG032I5                                                 00034002
*                                                                       00036002
*DESCRIPTIVE NAME = ISAM ALLOCATE - EMBEDDED INDEX                      00038002
*                                                                       00038402
*COPYRIGHT = NONE                                                       00038802
*                                                                       00039202
*CHANGE ACTIVITY = SEE BELOW                                            00039602
*                                                                       00039702
*          RELEASE 16 DELETIONS                                         00040000
*1463097800                                                        AAAA 00045016
*1463064600,065800,070800-071000,071400,072400                    13559 00047016
*          RELEASE 17 DELETIONS                                         00050000
*          RELEASE 18 DELETIONS                                         00060000
*          RELEASE 19 DELETIONS                                         00070000
*          RELEASE 20 DELETIONS                                         00080000
*1682027400-027600                                               M0227  00085020
*                                                                S20201 00087020
*          RELEASE 21 DELETIONS                                         00090000
*1194001400,003400,004000,016800,017800-018400,065600-066000,    A38860 00092021
*1194066400-067000,067400-068200,075400-075600,077000,087800-    A38860 00094021
*1194088000,100200                                               A38860 00096021
*          RELEASE 22 DELETIONS                                         00100000
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00110002
*0000000030-000150,001100-001200,002600,003400,006000,006600,    Y02080 00110102
*0000007000-007200,017400,017900-018200,021200,025330-025360,    Y02080 00110202
*0000025600,030200,066800-067200,067800-068100,069000,073800,    Y02080 00110302
*0000074500,077000,088000,088250-088400,088800,089200-102400,    Y02080 00110402
*0000102800                                                      Y02080 00110502
*0000                                                            Y02144 00110602
*0000006600,073400-074800,087700-088200,097400-102800            YM3995 00111002
*           VS2 RELEASE 037 CHANGES                                     00114008
*0000                                                          @ZA12697 00117008
*                                                                       00120002
*STATUS CHANGE LEVEL 004                                                00130020
*                                                                       00140021
*FUNCTION - THIS MODULE BUILDS FORMAT 1 AND FORMAT 2 DSCB'S AND IF      00150021
*           NECESSARY A FORMAT 3.  IT DIVIDES THE ENTRIES IN THE DADSM  00160000
*           TABLE INTO PRIME AND INDEX EXTENTS. THE INDEX EXTENTS ARE   00180000
*           THE FIRST TO BE PUT IN THE DSCB FORMAT 1.                   00200000
*           THE DATA SET WILL BE RAC DEFINED USING A RACDEF    @Z40RSGD 00205008
*           IF IGG032I3 SET THE RAC PROTECTED BIT IN THE       @Z40RSGD 00210008
*           FORMAT 1.                                          @Z40RSGD 00215008
*                                                                       00220000
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG032I5.  ENTRY IS   00240000
*          MADE FROM THE THIRD LOAD OF ISAM ALLOCATE VIA A BRANCH.      00260002
*                                                                       00280000
*                                                                       00300000
*INPUT - AT ENTRY TO THIS MODULE REGISTER 11 POINTS TO A JFCB.  REG 13  00320000
*        POINTS TO THE ALLOCATE WORK AREA WHICH CONTAINS A PTR TO THE   00340002
*        ENTRY IN THE TIOT FOR THIS ALLOCATE AND ALL BUT THE EXTENT     00360000
*        FIELDS OF THE FORMAT 1 DSCB, VTOCADR, AND DADSMADR.            00380000
*                                                                       00420000
*OUTPUT - UPON TRANSFERRING TO THE NEXT MODULE IGG032I6, THE WORK AREA  00440000
*         WILL CONTAIN A SORTED DADSM TABLE.                            00460000
*                                                                       00480000
*                                                                       00500000
*EXTERNAL ROUTINES - THE FOLLOWING ARE SUPERVISOR CALLS ISSUED IN THE   00520000
*   MACRO EXPANSIONS                                                    00540000
*   EXCP(0) READ FROM OR WRITE TO DIRECT ACCESS DEVICES                 00560000
*   WAIT(1) WAIT ON EVENT CONTROL BLOCK                                 00580000
*   RACDEF DEFINE DATA SET TO RAC.                             @Z40RSGD 00600008
*   OTHER MACROS USED - IEFJFCBN BUILDS JFCB                            00620000
*                       IECALLWA - ALLOCATE WORK AREA EXPANSION         00630002
*                       IECSDSL1 BUILDS DSCBS                           00640000
*                       IECDSECS - EXPANDS CVT, PSA,SCVT DSECTS         00660002
*                                                                       00680000
*EXITS NORMAL - BRANCH TO IGG032I6                                      00700002
*      ERROR - BRANCH TO IGG032I7 WITH ERROR CODE IN REGISTER 5         00720002
*                                                                       00740000
*              0C   PERMANENT I/O ERROR                                 00760000
*                                                                       00780000
*                                                                       00800000
*TABLES/WORK AREAS - DADSM WORK AREA DESCRIBED BY DSECT DSCBWKAR        00820000
*                                                                       00840000
*              ***************************************                  00860000
*              *             DADSM TABLE             *                  00880000
*              ***************************************                  00900000
*                                                                       00920000
*              ***************************************                  00940000
*              *        *         *                  *                  00960000
*              *  TYPE  *  NO OF  *     USED HOLE    *                  00980000
*              *  FLAG  * ENTRIES *      COUNTER     *                  01000000
*              *        *         *                  *                  01020000
*              ***************************************                  01040000
*              *                  *                  *                  01060000
*              *       RTA        *      RTA+1       *                  01080000
*              *                  *                  *                  01100000
*              ***************************************                  01120000
*              *                  *                  *                  01140000
*              *       RTA        *      RTA+1       *                  01160000
*              *                  *                  *                  01180000
*              ***************************************                  01200000
*              *                  *                  *                  01220000
*              *       RTA        *      RTA+1       *                  01240000
*              *                  *                  *                  01260000
*              ***************************************                  01280000
*              *                  *                  *                  01300000
*              *       RTA        *      RTA+1       *                  01320000
*              *                  *                  *                  01340000
*              ***************************************                  01360000
*              *                  *                  *                  01380000
*              *       RTA        *      RTA+1       *                  01400000
*              *                  *                  *                  01420000
*              ***************************************                  01440000
*                                                                       01460000
*                                                                       01480000
*              TYPE FLAG = 02 - BPAM DIRECTORIES REQUESTED.             01500000
*                                                                       01520000
*                        = 40 - USER LABELS REQUESTED                   01524021
*                                                                       01528021
*                        = 80 - SET MUST COMPLETE IS ACTIVE             01532021
*                                                                       01536021
*                                                                       01540000
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.    01560000
*                                                                       01580000
*                                                                       01600000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.        01620000
*                                                                       01640000
*                                                                       01660000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT. 01680021
*                                                                       01700000
*                                                                       01720000
*ATTRIBUTES - REENTRANT                                                 01740002
*                                                                       01760000
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    01790002
*          WORK AREA = AS DEFINED IN THE IECALLWA MACRO                 01820002
*          RPS WORK AREA = AS DEFINED IN THE IECRPS MACRO               01830002
*                                                                       01860000
*                                                                       01880000
*REGISTER USAGE                                                         01900000
*              REGISTER 0-9 WORK REGISTERS                              01920000
*              REGISTER 10 - TIOT SET UP TABLE                          01940000
*              REGISTER 11 - JFCB POINTER                               01960000
*              REGISTER 12 - BASE REGISTER                              01980000
*              REGISTER 13 - WORK AREA POINTER                          02000000
*              REGISTER 14 SUBROUTINE LINKAGE AND WORK REGISTER         02020000
*              REGISTER 15 WORK REGISTER                                02040000
         BALR  RBASE,0                                                  02080000
         USING OMEGA,RBASE                                              02100000
         USING ALLOCWKA,RWORK           WORK AREA ADDRESSABILITY Y02080 02120002
         USING JFCBKEN,RJFCB                                            02140000
***** REGISTER NAMES *****                                              02160000
RZERO    EQU   0                                                        02180000
RONE     EQU   1                                                        02200000
RTWO     EQU   2                                                        02220000
RTHREE   EQU   3                                                        02240000
RFOUR    EQU   4                                                        02260000
RFIVE    EQU   5                                                        02280000
RSIX     EQU   6                                                        02300000
RSEVEN   EQU   7                                                        02320000
REIGHT   EQU   8                                                        02340000
RNINE    EQU   9                                                        02360000
DRBAK   EQU   9                                                         02380000
RTEN     EQU   10                                                       02400000
RJFCB    EQU   11                                                       02420000
RBASE    EQU   12                                                       02440000
RWORK    EQU   13                                                       02460000
RETURN   EQU   14                                                       02480000
REVEN    EQU   14                  EVEN REGISTER FOR DIVIDE      M0227  02490020
RFTEN    EQU   15                                                       02500000
*                                                                       02520000
* OTHER EQUATES                                                         02523021
*                                                                       02526021
TWO      EQU   2                        CONSTANT OF TWO          Y02080 02528002
DIVISOR  EQU   2                        DIVIDE BY 2              M0227  02530002
STEPMC   EQU   1                        STATUS STEP MC INDICATOR YM3995 02532002
K12      EQU   12                       CONSTANT OF 12           YM3995 02534002
DS1RACDF EQU   X'40'                    DS1DSIND-DATA SET IS   @Z40RSGD 02535508
*                                       RAC DEFINED            @Z40RSGD 02537008
RACERR   EQU   X'A4'                    CONSTANT FOR BUILDING  @Z40RSGD 02538508
*                                       RAC ERROR CODES        @Z40RSGD 02538808
*                                                                       02540000
OMEGA    EQU   *                        BRANCH LABEL             Y02080 02560002
         LH    RFTEN,PRIQTY             PICK UP PRIMARY QUANTITY        02580000
         LH    RONE,DIRQTY              PICK UP INDEX QUANTITY          02600000
         TM    JFCBCTRI,X'DF'           CHECK REQUEST TYPE FIELD        02620000
         BC    8,NEXTA                  BRANCH IF THIS IS AN ABSOLUTE   02640000
*                                          TRACK REQUEST                02660000
         MH    RONE,DS4DEVSZ+2          CONVERT CYLINDERS TO TRACKS     02680000
         MH    RFTEN,DS4DEVSZ+2                                         02700000
* THIS SECTION SETS UP POINTERS FOR SEARCHING THE DADSM TABLE           02720000
NEXTA    EQU   *                                                 M0227  02730020
         SR    REVEN,REVEN         CLEAR EVEN REG FOR DIVIDE     M0227  02740020
         LA    RTWO,DIVISOR        DIVISOR OF 2                  M0227  02750020
         DR    REVEN,RTWO          DIVIDE TRACKS BY 2            M0227  02760020
          SR   RZERO,RZERO              INITIALIZE TOTAL TRACKS TO      02780000
*                                          THIS POINT                   02800000
         LR    RSIX,RZERO                                               02820000
         LR    RSEVEN,RFTEN             SET UP EVEN ODD PAIR FOR DIVIDE 02840000
         LH    RFIVE,DS4DEVSZ+2        PICK UP NUMBER OF TRACKS PER     02860000
*                                      CYLINDER                         02880000
         DR    RSIX,RFIVE                                               02900000
         AR    RFTEN,RSIX               FORCE TO CYLINDER BOUNDARY      02920000
         AR    RFTEN,REVEN         ADD ANY REMAINDER FROM        M0227  02926020
*                                  FIRST DIVISION                       02932020
ZEROOUT  LR    RFIVE,RZERO             INITIALIZE PRIME EXTENT          02940000
*                                          COUNTER                      02960000
          LR   RSIX,RZERO               INITIALIZE INDEX EXTENT         02980000
*                                          COUNTER                      03000000
         LA    RTWO,AENTRIES            POINT TO DADSM TABLE     Y02080 03020002
         LA    RTHREE,PDLIST            SET UP LOCATION POINTERS FOR    03040000
         LA    RFOUR,DS3ADEXT+1        PRIME AND INDEX EXTENTS          03060000
* THIS SECTION CHECKS FOR MID WAY                                       03080000
HOOP     LH    RSEVEN,2(RTWO)           PICK UP RTA+1                   03100000
         SH    RSEVEN,0(RTWO)           SUBTRACT RTA FROM IT            03120000
         AR    RZERO,RSEVEN                                             03140000
         CR    RZERO,RFTEN              CHECK FOR MIDWAY                03160000
         BNL   HERETIS                  BRANCH IF AT OR BEYOND THE      03180000
*                                          MIDWAY POINT                 03200000
         MVC   0(4,RTHREE),0(RTWO)      MOVE IN PRIME EXTENT            03220000
         BAL   RETURN,UP235             UPDATE POINTERS AND COUNTERS    03240000
         B     HOOP                                                     03260000
*                                                                       03280000
HERETIS  BH    CHEEK                    BRANCH IF BEYOND THE HALF WAY   03300000
*                                          MARK                         03320000
         MVC   0(4,RTHREE),0(RTWO)      CONSIDER AS A PRIME EXTENT      03340000
         BAL   RETURN,UP235             UPDATE POINTERS AND COUNTERS    03360000
* THIS SECTION PICKS UP NEXT EXTENT AND CHECKS TO SEE HOW MUCH OF IT    03380000
* IS NEEDED FOR INDEX.                                                  03400000
ICK      LH    RSEVEN,2(RTWO)           NEED MORE EXTENTS FOR INDEX     03420000
         SH    RSEVEN,0(RTWO)                                           03440000
          CR   RSEVEN,RONE              CHECK FOR ENOUGH QUANTITY FOR   03460000
*                                          INDEX                        03480000
          BNL  THISIT                   BRANCH IF THERE IS ENOUGH       03500000
*                                          QUANTITY                     03520000
         MVC   0(4,RFOUR),0(RTWO)       STILL NEED ANOTHER EXTENT       03540000
          SR   RONE,RSEVEN              SUBTRACT AMOUNT AVAILABLE FROM  03560000
*                                          AMOUNT NEEDED                03580000
         BAL   RETURN,UP246             UPDATE POINTERS AND COUNTERS    03600000
         B     ICK                                                      03620000
* THIS SECTION CHECKS LAST EXTENT FOR INDEX TO SEE IF ANOTHER PRIME     03640000
* EXTENT IS LEFT                                                        03660000
THISIT    BH   REDUCE                   BRANCH IF AMOUNT AVAILABLE IS   03680000
*                                          LARGER THAN AMOUNT NEEDED    03700000
         MVC   0(4,RFOUR),0(RTWO)       JUST NEED THIS ENTIRE EXTENT TO 03720000
*                                          FULFILL REMAINING INDEX      03740000
*                                          REQUEST                      03760000
* THIS SECTION CONVERTS THE REST OF THE DADSM TABLE ENTRIES INTO        03780000
* PRIME EXTENTS                                                         03800000
GETTHEM  BAL   RETURN,UP246             UPDATE POINTERS AND COUNTERS    03820000
         LA    RNINE,PDLIST5           SET TO END OF TABLE     @ZA12697 03840008
GETTHEMM OC    0(4,RTWO),0(RTWO)       ANY MORE ENTRIES        @ZA12697 03848008
         BZ    OUTPULL                 NO GET OUT              @ZA12697 03856008
         CR    RTWO,RNINE              AT END OF THE TABLE     @ZA12697 03864008
         BZ    OUTPULL                GET OUT                  @ZA12697 03872008
         MVC   0(4,RTHREE),0(RTWO)        LIST OF PRIME EXTENTS         03880000
         BAL   RETURN,UP235             UPDATE POINTERS AND COUNTERS    03900000
         B     GETTHEMM                                                 03920000
* ONLY PART OF THE EXTENT IS NEEDED FOR INDEX                           03940000
REDUCE   MVC   0(2,RFOUR),0(RTWO)       ONLY NEED PART OF THIS EXTENT   03960000
         LH    RSEVEN,0(RTWO)                                           03980000
         AR    RSEVEN,RONE                                              04000000
          STH  RSEVEN,2(RFOUR)          CALCULATE LAST PART OF INDEX    04020000
*                                          EXTENT                       04040000
         MVC   0(2,RTHREE),2(RFOUR)     REST OF EXTENT WILL BE A PRIME  04060000
         MVC   2(2,RTHREE),2(RTWO)         EXTENT                       04080000
         B     UPTHEM                                                   04100000
* ONE EXTENT IS SPLIT INTO AT LEAST TWO PARTS THAT IS BOTH PRIME AND    04120000
* INDEX IN THE SAME EXTENT                                              04140000
CHEEK    LR    REIGHT,RZERO             MORE THAN ONE TRACK FOR INDEX   04160000
         SR    REIGHT,RFTEN                EXTISTS IN THIS EXTENT       04180000
         LH    RSEVEN,2(RTWO)                                           04200000
         SR    RSEVEN,REIGHT                                            04220000
          STH  RSEVEN,2(RTHREE)         BUILD LAST PART OF PRIME EXTENT 04240000
         STH   RSEVEN,0(RFOUR)          SET UP INDEX BEGINNING          04260000
         MVC   0(2,RTHREE),0(RTWO)                                      04280000
          CR   REIGHT,RONE              CHECK FOR AVAILABLE SPACE BEING 04300000
*                                          ENOUGH TO FULFILL REQUEST    04320000
          BL   MORETHAN                 BRANCH IF NOT ENOUGH QUANTITY   04340000
          BH   SPLIT                    BRANCH IF QUANTITY MORE THAN    04360000
*                                          THAT REQUESTED               04380000
          MVC  2(2,RFOUR),2(RTWO)       BUILD LAST PART OF INDEX EXTENT 04400000
*                                                                       04420000
UPTHEM   BAL   RETURN,UP35              UPDATE POINTERS AND COUNTERS    04440000
         B     GETTHEM                                                  04460000
* ONE EXTENT IS SPLIT INTO THREE EXTENTS PRIME,INDEX,PRIME              04480000
SPLIT    LH    RSEVEN,2(RTHREE)         NEED TO TAKE THE INDEX OUT OF   04500000
         AR    RSEVEN,RONE                 THE MIDDLE OF AN EXTENT      04520000
         STH   RSEVEN,2(RFOUR)                                          04540000
         BAL   RETURN,UP35              UPDATE POINTERS AND COUNTERS    04560000
          MVC  0(2,RTHREE),2(RFOUR)     BUILD THE BEGINNING AND ENDING  04580000
          MVC  2(2,RTHREE),2(RTWO)         RTA'S FOR THIS PRIME EXTENT  04600000
         B     UPTHEM                                                   04620000
* NEED MORE THAN JUST THE END OF AN EXTENT                              04640000
MORETHAN SR    RONE,REIGHT              NEED THE END OF THIS EXTENT AND 04660000
         MVC   2(2,RFOUR),2(RTWO)          MORE FOR THE INDEX           04680000
         BAL   RETURN,UP246             UPDATE POINTERS AND COUNTERS    04700000
         BAL   RETURN,UP35              UPDATE POINTERS AND COUNTERS    04720000
         B     ICK                                                      04740000
* THIS SECTION SETS UP POINTERS TO START BUILDING F1 WITH INDEX EXTENTS 04760000
OUTPULL  LA    RTWO,DS3ADEXT+1         GET INDEX ENTRIES SET UP TO BE   04780000
         LA    RTHREE,DS1EXT1              CONVERTED AND PLUGGED INTO   04800000
         LA    RFOUR,3                     THEIR PLACES IN THE FORMAT 1 04820000
         LR    RNINE,RSIX                                               04840000
         LR    RZERO,RFIVE                                              04860000
         AR    RSIX,RFIVE               COLLECT TOTAL NUMBER OF EXTENTS 04880000
         STC   RSIX,DS1NOEPV               AND PUT IN FORMAT 1 DSCB     04900000
         SR    RFIVE,RFIVE              INITIALIZE SEQUENCE NUMBER      04920000
         MVI   TYPE,X'04'               INITIALIZE EXTENT TYPE          04940000
* THIS SECTION CONVERTS INDEX ENTRIES FOR F1                            04960000
LIMP     BAL   RETURN,LOOP                                              04980000
         BCTR  RNINE,0                  REDUCE NUMBER OF INDEX EXTENTS  05000000
         LTR   RNINE,RNINE              CHECK FOR LAST EXTENT           05020000
         BZ    GETPRIME                 BRANCH IF LAST INDEX EXTENT     05040000
         BCTR  RFOUR,0                  REDUCE NUMBER OF EXTENTS IN     05060000
*                                          FORMAT 1 THAT ARE AVAILABLE  05080000
         LTR   RFOUR,RFOUR              CHECK FOR ROOM IN FORMAT 1      05100000
         BC    7,LIMP                  BRANCH IF MORE ROOM IN F1        05120000
NOROOM   BAL   RETURN,ROUTINE                                           05140000
* THIS SECTION CONVERTS INDEX EXTENTS FOR F3                            05160000
LIMPED   BAL   RETURN,LOOP                                              05180000
         BCTR  RNINE,0                  REDUCE NUMBER OF INDEX EXTENTS  05200000
         LTR   RNINE,RNINE              CHECK FOR THE LAST INDEX EXTENT 05220000
         BC    7,LIMPED                BRANCH IF NOT LAST INDEX EXTENT  05240000
PRIMEGET LA    RTWO,PDLIST             SET UP TO FINISH FILLING IN THE  05260000
         LR    RNINE,RZERO                DSCB FORMAT 3                 05280000
         MVI   TYPE,X'01'                                               05300000
LAMP     B     LUMPED                                                   05320000
*                                                                       05340000
* SET UP TO PLUG OUT PRIME ENTRIES FOR DSCB FORMAT 1                    05360000
GETPRIME LR    RNINE,RZERO                                              05380000
         LA    RTWO,PDLIST                                              05400000
         MVI   TYPE,X'01'              INITIALIZE ESTENT TYPE           05420000
         BCTR  RFOUR,0                  REDUCE NUMBER OF EXTENTS        05440000
*                                          AVAILABLE IN THE FORMAT 1    05460000
         LTR   RFOUR,RFOUR             BRANCH IF NO MORE ROOM IN F1     05480000
         BC    7,LUMP                                                   05500000
         B     ROOMNONE                                                 05520000
* THIS SECTION CONVERTS PRIME EXTENTS FOR F1                            05540000
LUMP     BAL   RETURN,LOOP                                              05560000
         XC    DS2PTRDS(5),DS2PTRDS                                     05580000
         BCTR  RNINE,0                  REDUCE NUMBER OF PRIME EXTENTS  05600000
         LTR   RNINE,RNINE              CHECK FOR END OF PRIME EXTENTS  05620000
         BZ    BUILDF2                  BRANCH IF LAST PRIME EXTENT -   05640000
*                                          GO TO BUILD A DSCB FORMAT 2  05660000
         BCTR  RFOUR,0                  REDUCE FORMAT 1 EXTENT COUNT    05680000
         LTR   RFOUR,RFOUR              CHECK FOR LAST AVAILABLE F1     05700000
*                                          EXTENT                       05720000
         BC    7,LUMP                  BRANCH IF FORMAT 1 IS NOT FULL   05740000
ROOMNONE BAL   RETURN,ROUTINE                                           05760000
* THIS SECTION CONVERTS PRIME FOR F3                                    05780000
LUMPED   BAL   RETURN,LOOP                                              05800000
         BCTR  RNINE,0                  REDUCE NUMBER OF PRIME EXTENTS  05820000
         LTR   RNINE,RNINE              CHECK FOR LAST PRIME EXTENT     05840000
         BC    7,LUMPED                BRANCH IF STILL MORE PRIME       05860000
*                                         EXTENTS                       05880000
ENT     BAL   DRBAK,WRITEF3            WRITE OUT DSCB F3                05900000
         MVC   DS2PTRDS(5),SAVEADR+5    PUT POINTER TO F3 IN F2         05920000
* THIS SECTION BUILDS A F2                                              05940000
BUILDF2  MVI   F5IN,X'02'               PUT INDICATOR IN KEY            05960000
         XC    F5IN+1(134),F5IN+1       CLEAR OUT FORMAT 2 AREA         05980000
         MVC   DS2NOTRK(1),JFCNTM       MOVE IN NUMBER OF TRACKS FOR    06000000
*                                          HIGHEST LEVEL INDEX          06020000
         MVC   DS2CYLOV(1),JFCCYLOF     MOVE IN NUMBER OF TRACKS FOR    06040000
*                                          CYLINDER OVERFLOW AREA       06060000
         MVI   DS2FMTID,X'F2'           PUT IN FORMAT IDENTIFIER        06080000
*                                                              @Z40RSGD 06081508
*   DEFINE DATA SET TO RAC IF REQUESTED.                       @Z40RSGD 06083008
*                                                              @Z40RSGD 06084508
         TM    DS1DSIND,DS1RACDF        IS A RACDEF NEEDED     @Z40RSGD 06086008
         BZ    RACDEFOK                 NO-CONTINUE            @Z40RSGD 06087508
         MVC   RACDEF(LRACDEF),MRACDEF  SETUP RACDEF PARM LIST @Z40RSGD 06089008
         RACDEF ENTITY=JFCBDSNM,        RAC DEFINE DATA SET    @Z40RSGDX06090508
               VOLSER=DS1DSSN,                                 @Z40RSGDX06092008
               MF=(E,RACDEF)                                   @Z40RSGD 06093508
         LTR   RFTEN,RFTEN              SUCCESSFUL             @Z40RSGD 06095008
         BZ    RACDEFOK                 YES-CONTINUE           @Z40RSGD 06096508
         LA    RFIVE,RACERR(RFTEN)      SET ERROR CODE         @Z40RSGD 06098008
         B     EXIT32I7                 ERROR EXIT             @Z40RSGD 06099508
RACDEFOK EQU   *                        RAC PROCESSING OK      @Z40RSGD 06099808
         BAL   DRBAK,WRITEF2            WRITE OUT DSCB F2               06100008
         MVC   DS1PTRDS(5),TTRLL        PUT POINTER TO F2 IN F1         06120000
* THIS SECTION WRITES OUT A F1                                          06140000
ONEONLY BAL   DRBAK,WRITEF1            WRITE OUT DSCB F1                06160000
         TM    DS4VTOCI,X'80'           CHECK THE CONDITION OF THE      06180000
*                                          VOLUME - BOS                 06200000
         BC    1,XCTLDADS               BRANCH IF VTOC NOT IN CONDITION 06220000
*                                          EXPECTED                     06240000
         CLC   SAVEADR(5),DS4HPCHR      CHECK FOR NEED TO UPDATE        06260000
*                                          POINTER IN F4 TO LAST F1     06280000
         BNH   XCTLDADS                 BRANCH IF POINTER DOESN'T NEED  06300000
*                                          TO BE CHANGED                06320000
         MVC   DS4HPCHR(5),SAVEADR      REPLACE POINTER IN F4 TO LAST   06340000
*                                          F1                           06360000
* THIS SECTION RELOCATES THE CHANNEL PROGRAM FOR FORMAT 5 UPDATING      06380000
* OF IGG032I5                                                           06400000
XCTLDADS LA    RTWO,TTRLL              PICK UP THE ADDRESS TO SEARCH ON 06420000
         ST    RTWO,PDLIST                                              06440000
         MVC   CCW2+1(3),PDLIST+1                                       06480000
         MVC   CCW6+1(3),PDLIST+1                                       06500000
         MVC   CCW9+1(3),PDLIST+1                                       06520000
         LA    RTWO,DS1DSNAM           PICK UP ADDRESS OF AREA TO READ  06540000
         ST    RTWO,CCW8                INTO                     A38860 06560021
         MVI   CCW8,X'0D'               RESTORE WR COMMAND CODE  A38860 06580021
         LA    RTWO,140(RTWO)          PICK UP ADDRESS OF AREA TO       06620000
         ST    RTWO,CCW11               WRITE FROM               A38860 06640021
         MVI   CCW11,X'0E'              RESTORE RD COMMAND CODE  A38860 06660021
         LA    RTWO,NEXTLOAD            BRANCH TO IGG032I6       Y02080 06680002
* THIS SECTION BRANCHES TO ANOTHER MODULE.                              06720002
XCT      EQU   *                                                 A38860 06750021
         IECRES LOAD,EXTPR=(RWORK),MODID=(RTWO),BRANCH=DIRECT    Y02080 06780002
*                                                                       06830002
* THIS SECTION RELOCATES THE CHANNEL PROGRAM FOR WRITING F1,F2,F3       06840000
WRITEF1  LA    RFOUR,SAVEADR            PICK UP ADDRESS OF ADDRESS TO   06860000
*                                          SEARCH ON                    06880000
         LA    RTHREE,DS1DSNAM          PICK UP ADDR OF AREA TO  Y02080 06900002
*                                          WRITE FROM                   06920000
         MVC   DS1DSNAM(44),JFCBDSNM   RESET DSNAME PORTION OF F1 AFTER 06940000
*                                      USING IT FOR THE CONVERT RTN     06960000
CHANGE2  LA    RTWO,CCW1                PICK UP ADDRESS OF FIRST CCW    06980000
*                                          TO BE EXECUTED               07000000
         IC    RONE,UHOLECTR+1          UPDATE NUMBER OF DSCB'S BUILT   07020000
         LA    RONE,1(RONE)                                             07040000
         STC   RONE,UHOLECTR+1                                          07060000
         ST    RTWO,IOB+16                                        13559 07090016
         ST    RFOUR,PDLIST            STORE ID AREA ADDRESS      13559 07120016
         MVC   CCW2+1(3),PDLIST+1                                       07160000
         MVC   CCW6+1(3),PDLIST+1                                       07180000
         MVC   CCW9+1(3),PDLIST+1                                       07200000
         ST    RTHREE,PDLIST            STORE ADDRESS OF WRITE OUT AREA 07220000
         MVC   CCW8+1(3),PDLIST+1                                       07260000
         MVC   CCW11+1(3),PDLIST+1                                      07280000
         MVC   SEEK+3(4),VTOCADR       START SEARCH AT VTOC ADDR  13559 07282016
         ST    DRBAK,CCW7+4            SAVE RETURN ADDRESS        13559 07284016
         BAL   DRBAK,SEARCHF0          SEARCH FOR FORMAT 0        13559 07286016
         L     DRBAK,CCW7+4            RESTORE RETURN ADDRESS     13559 07288016
         MVC   SEEK+3(4),0(RFOUR)      SEEK TO FOUND FORMAT 0     13559 07290016
         LA    RZERO,CCW6              START CHANNEL PROGRAM ...  13559 07292016
         ST    RZERO,IOB+16               AT CCW6                 13559 07294016
SEARCHF0 EQU   *                                                  13559 07296016
         TM    TYPEFLG,SMCDONE          IS SET MUST COMPLETE ON         07300000
         BO    CLRECB                   BRANCH IF YES                   07320000
*                                                                       07325002
* LINK TO THE STATUS ROUTINE TO PERFORM A STEP MUST COMPLETE            07330002
*                                                                       07335002
         STM   RJFCB,RETURN,IECREGSV+K12  SAVE REGISTERS 11-14   YM3995 07340002
         LR    RTHREE,RWORK             SAVE WORK AREA ADDRESS   YM3995 07345002
GETLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  YM3995X07350002
               RELATED=(LOCAL,IGG032I5(RLSELOCK))  OBTAIN LOCK   YM3995 07355002
         LM    RJFCB,RETURN,IECREGSV+K12-ALLOCWKA(RTHREE)        YM3995 07360002
*                                                                       07365002
         USING CVT,RFTEN                CVT ADDRESSABILITY       YM3995 07370002
         L     RFTEN,CVTPTR             LOAD CVT ADDRESS         YM3995 07375002
         L     RFTEN,CVTABEND           LOAD SECONDARY CVT PTR   YM3995 07380002
         USING SCVTSECT,RFTEN           2NDRY CVT ADDRESSABILITY YM3995 07385002
         L     RFTEN,SCVTSTAT           LOAD STATUS EP ADDRESS   YM3995 07390002
         DROP  RFTEN                                             YM3995 07395002
         LA    RZERO,STEPMC             INDICATE STEP MC         YM3995 07400002
         XR    RONE,RONE                INDICATE STATUS SET      YM3995 07405002
*                                                                       07410002
         BALR  RETURN,RFTEN             LINK TO STATUS ROUTINE   YM3995 07415002
*                                                                       07420002
RLSELOCK EQU   *                        RELEASE THE LOCK         YM3395 07425002
         STM   RJFCB,RETURN,IECREGSV+K12  SAVE REGISTERS 11-14   YM3995 07430002
         LR    RTHREE,RWORK             SAVE WORK AREA ADDRESS   YM3995 07435002
         SETLOCK RELEASE,TYPE=LOCAL,                             YM3995X07440002
               RELATED=(LOCAL,IGG032I5(GETLOCK))  RELEASE LOCK   YM3995 07445002
         LM    RJFCB,RETURN,IECREGSV+K12-ALLOCWKA(RTHREE)        YM3995 07450002
*                                                                       07500000
         OI    DSMADTB2,DSMSMCE         SET ENQ'ED SMC SWITCH    Y02144 07510002
         OI    TYPEFLG,SMCDONE          TURN ON SMC INDICATOR           07520000
*                                                                       07530021
* THIS SECTION EXECUTES THE CHANNEL PROGRAMS.                           07540021
*                                                                       07550021
CLRECB   EQU   *                                                 A38860 07560021
         MVI   ECB,X'00'                CLEAR THE ECB            A38860 07570021
         EXCP  IOB                                                      07580000
         WAIT  1,ECB=ECB                                                07600000
         TM    ECB,X'20'                TEST FOR A PERMANENT I/O ERROR  07620000
        BCR   7,DRBAK                  BRANCH IF NO PERMANENT I/O ERR   07640000
         LA    RFIVE,12                 SET ERROR CODE FOR PERMANENT    07660000
*                                          I/O ERROR                    07680000
EXIT32I7 EQU   *                        EXIT TO IGG032I7       @Z40RSGD 07688008
         LA    RTWO,ERROR               BRANCH TO IGG032I7       Y02080 07700002
         B     XCT                                                      07720000
*                                                                       07725021
* THIS SECTION SETS UP TO WRITE FORMAT 2 AND FORMAT 3 DSCB'S.           07730021
*                                                                       07735021
WRITEF2  LA    RFOUR,TTRLL              PICK UP ADDRESS FOR F2          07740000
WRITE    LA    RTHREE,F5IN              PICK UP ADDRESS TO WRITE FROM   07760000
         B     CHANGE2                                                  07780000
WRITEF3  LA    RFOUR,SAVEADR+5          PICK UP ADDRESS FOR F3          07800000
         XC    DS3ADEXT(95),DS3ADEXT                                    07820000
         B     WRITE                                                    07840000
*                                                                       07860000
*THIS SECTION SET UP AND BRANCHES TO CONVERT ROUTINE TO CONVERT FROM    07880000
*RTA TO CCHH                                                            07900000
LOOP     MVC   0(1,RTHREE),TYPE        SET EXTENT TYPE                  07920000
         STC   RFIVE,1(RTHREE)         SET EXTENT SEQUENCE NUMBER       07940000
         LA    RFIVE,1(RFIVE)                                           07960000
         L     RSIX,CVTPTR             PICK UP CVT POINTER              07980000
         USING CVT,RSIX                                                 08000000
         STM   RZERO,RTWO,DS1DSNAM      SAVE REGISTERS ZERO THRU TWO    08020000
         STM   RNINE,RETURN,DS1DSNAM+12   AND NINE THRU 15 BEFORE       08040000
*                                         BRANCHING TO THE CONVERT RTN  08060000
         L     RFTEN,CVTPCNVT          CONVERT ROUTINE ADDRESS          08080000
         LA    RONE,DEB                R1=DEB ADDRESS                   08100000
         LH    RZERO,0(RTWO)           R0=RTN TO BE CONVERTED           08120000
         SLL   RZERO,16                                                 08140000
         LA    RTWO,DS1DSNAM+36        R2=ADDRESS OF 8 BYTE RESULT AREA 08160000
         LR    REIGHT,RWORK            SAVE AREA ADDRESS                08180000
         BALR  RETURN,RFTEN                                             08200000
         MVC   2(4,RTHREE),39+DS1DSNAM-FIRST(REIGHT)                    08220000
         L     RSEVEN,8+DS1DSNAM-FIRST(REIGHT) CONVERT RTA+1 IN THE     08240000
         LH    RZERO,2(RSEVEN)            SAME MANNER AS RTA            08260000
         BCTR  RZERO,0                                                  08280000
         SLL   RZERO,16                                                 08300000
         L     RFTEN,CVTPCNVT           PICK UP CONVERT ROUTINE ADDRESS 08320000
         BALR  RETURN,RFTEN                                             08340000
         MVC   6(4,RTHREE),39+DS1DSNAM-FIRST(REIGHT)                    08360000
         LM    RZERO,RTWO,DS1DSNAM-FIRST(REIGHT)                        08380000
         LM    RNINE,RETURN,DS1DSNAM+12-FIRST(REIGHT)                   08400000
         LA    RTHREE,10(RTHREE)       UPDATE DSCB POINTER              08420000
         LA    RTWO,4(RTWO)            UPDATE EXTENT POINTER            08440000
         BR    RETURN                                                   08460000
* THIS SECTION BUILDS A FORMAT 3 DSCB                                   08480000
ROUTINE  LA    RTHREE,DS3EXTNT          SET UP TO FILL IN DSCB FORMAT3  08500000
         MVI   IECSDSL3,X'03'                                           08520000
         MVC   IECSDSL3+1(3),IECSDSL3                                   08540000
         XC    IECSDSL3+4(40),IECSDSL3+4   CLEAR OUT FORMAT 3 AREA      08560000
         MVI   DS3FMTID,X'F3'           SET FORMAT IDENTIFIER           08580000
         BR    RETURN                                                   08600000
*                                                                       08605021
* THIS SECTION UPDATES VARIOUS POINTERS.                                08610021
*                                                                       08615021
UP235    LA    RTWO,4(RTWO)             UPDATE DADSM TABLE POINTER      08620000
UP35     LA    RTHREE,4(RTHREE)         UPDATE PRIME EXTENT POINTER     08640000
         LA    RFIVE,1(RFIVE)           UPDATE PRIME EXTENT POINTER     08660000
         BR    RETURN                                                   08680000
UP246    LA    RTWO,4(RTWO)             UPDATE DADSM TABLE POINTER      08700000
         LA    RFOUR,4(RFOUR)           UPDATE INDEX EXTENT POINTER     08720000
         LA    RSIX,1(RSIX)             UPDATE INDEX EXTENT POINTER     08740000
         BR    RETURN                                                   08760000
*                                                              @Z40RSGD 08768008
*   MASTER RACDEF PARAMETER LIST.                              @Z40RSGD 08776008
*                                                              @Z40RSGD 08784008
MRACDEF  RACDEF TYPE=DEFINE,                                   @Z40RSGDX08792008
               DSTYPE=N,                                       @Z40RSGDX08800008
               MF=L                                            @Z40RSGD 08808008
LRACDEF  EQU   *-MRACDEF                LENGTH RACDEF          @Z40RSGD 08816008
*                                                                       08830002
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         08840002
*                                                                       08850002
         XCTLTABL ID=(NEXTLOAD,I6,ERROR,I7),SVC=032,LENGTH=,     Y02080X08852002
               BRT=YES                                           Y02080 08854002
         SPACE 2                                                 Y02080 08856002
         IECDSECS CVT,PSA,SCVT,EXPAND=YES                        YM3995 08858002
JFCBKEN  DSECT                                                          08860000
         IEFJFCBN                                                       08900000
         EJECT                                                   Y02080 08910002
DSCBWKAR IECALLWA EP,F4,D1=(1),D2=(2,3),ADT=YES  WORK AREA       Y02144 08920002
RACDEF   EQU   IECREGSV                 RACDEF PARAMETER LIST  @Z40RSGD 08921508
         END                                                            10300000
./  ADD  SSI=32510322,NAME=IGG032I6
 TITLE ' IGG032I6 - ISAM ALLOCATE - UPDATE DADSM'                       00020000
IGG032I6 CSECT                                                          00030021
*                                                                       00032002
*MODULE NAME = IGG032I6                                                 00034002
*                                                                       00034402
*DESCRIPTIVE NAME = ISAM ALLOCATE - UPDATE DADSM                        00034802
*                                                                       00034902
*COPYRIGHT = NONE                                                       00041102
*                                                                       00043102
*CHANGE ACTIVITY = SEE BELOW                                            00045102
*                                                                       00047102
*1231000800-001000,002800-003200,032800-033600,074800,076600     A38860 00047602
*                                                                       00053802
*          RELEASE 16 DELETIONS                                         00061000
*1463036400,038000,062600                                         16787 00061516
*          RELEASE 17 DELETIONS                                         00062000
*2136000740,036800                                                18916 00062500
*          RELEASE 18 DELETIONS                                         00063000
*3123024200,029800-030000,031400-031600,038200,043400             23214 00063518
*          RELEASE 19 DELETIONS                                         00064000
*          RELEASE 20 DELETIONS                                         00065000
*          RELEASE 21 DELETIONS                                         00066000
*1231000400,001400-001600,015400,022000,022400,023200            S21042 00066121
*1231000400,015400,022000,023800,028000,029000,029400,029800,    A42208 00066221
*1231030200,030800,031300,031660-031800,033800,034200,035000,    A42208 00066421
*1231036000,036600-038400,042600-043400,044400,047800,048200,    A42208 00066621
*1231048600,056200-056400,057200,062400-062700                   A42208 00066821
*          RELEASE 22 DELETIONS                                         00067000
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00068002
*0000000030-000150,000680-000690,002000,002700,004600,005000,    Y02080 00068102
*0000005600-005800,006450-006500,006800,016000,021880-022080,    Y02080 00068202
*0000022600,022806-022807,022809,022812,022817,022819,022840-    Y02080 00068302
*0000022920,023200-023600,024400,024800,030680,032000,032530,    Y02080 00068402
*0000032600-033100,034600,035400,047400,047680-047720,049000,    Y02080 00068502
*0000054400,054900,056300,057200,063600-063800,064800-065000,    Y02080 00068602
*0000066600-066760,067040-076740,076780                          Y02080 00068702
*0000022821,023000                                               Y02082 00068802
*0000006500-006520,032250-032510,050800                          XM2969 00070802
*                                                                       00073002
*STATUS CHANGE LEVEL 006                                                00074021
*                                                                       00120000
*FUNCTION - THIS MODULE REDUCES THE FORMAT 5 DSCB(S) BY THE SPACE THAT  00130021
*           WAS JUST ALLOCATED. IT ALSO CONVERTS THE CCHHR OF THE       00140021
*           FORMAT 1 DSCB (FOR THE FIRST VOLUME ONLY) TO A TTR AND      00150021
*           STORES IT IN THE JFCB.                                      00160021
*                                                                       00180000
*ENTRIES - ENTRY POINT IGG032I6 - ENTRY IS MADE VIA A BRANCH FROM       00200002
*          IGG032I3,IGG032I4, IGG032I5.                                 00220000
*                                                                       00240000
*                                                                       00260000
*INPUT - AT ENTRY TO THIS MODULE REGISTER 13 POINTS TO THE ALLOCATE     00270002
*        WORKAREA WHICH CONTAINS THE FORMAT 4 DSCB, THE VTOCADR,        00280021
*        THE DADSMADR, AND A SORTED DADSM TABLE CONTAINING THE          00290021
*        EXTENTS THAT WERE ACTUALLY ALLOCATED.                          00300021
*                                                                       00340000
*OUTPUT - UPDATED FORMAT 5 DSCB'S                                       00360000
*                                                                       00380000
*                                                                       00400000
*EXTERNAL ROUTINES                                                      00420000
*   SVCS  ISSUED IN MACRO EXPANSIONS                                    00440000
*   EXCP(0) READ FROM OR WRITE TO DIRECT ACCESS DEVICE                  00460002
*   WAIT(1) WAIT FOR EVENT CONTROL BLOCK                                00480000
*                                                                       00520000
*                                                                       00540000
*EXIT - NORMAL - BRANCH TO IGG032I7                                     00560002
*     - ERROR - BRANCH TO IGG032I7 WITH ERROR CODE IN REGISTER 5        00580002
*                                                                       00600000
*              0C   PERMANENT I/O ERROR                                 00620000
*                                                                       00640000
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    00645002
*          WORK AREA = AS DEFINED IN THE IECALLWA MACRO          XM2969 00650002
*          RPS WORK AREA = AS DEFINED IN THE IECRPS MACRO        XM2969 00652002
*                                                                       00655021
*                                                                       00660000
*TABLES/WORK AREAS - DADSM WORK AREA DESCRIBED BY MACRO IECALLWA        00680002
*                                                                       00700000
*              ***************************************                  00720000
*              *             DADSM TABLE             *                  00740000
*              ***************************************                  00760000
*                                                                       00780000
*              ***************************************                  00800000
*              *        *         *                  *                  00820000
*              *  TYPE  *  NO OF  *     USED HOLE    *                  00840000
*              *  FLAG  * ENTRIES *      COUNTER     *                  00860000
*              *        *         *                  *                  00880000
*              ***************************************                  00900000
*              *                  *                  *                  00920000
*              *       RTA        *      RTA+1       *                  00940000
*              *                  *                  *                  00960000
*              ***************************************                  00980000
*              *                  *                  *                  01000000
*              *       RTA        *      RTA+1       *                  01020000
*              *                  *                  *                  01040000
*              ***************************************                  01060000
*              *                  *                  *                  01080000
*              *       RTA        *      RTA+1       *                  01100000
*              *                  *                  *                  01120000
*              ***************************************                  01140000
*              *                  *                  *                  01160000
*              *       RTA        *      RTA+1       *                  01180000
*              *                  *                  *                  01200000
*              ***************************************                  01220000
*              *                  *                  *                  01240000
*              *       RTA        *      RTA+1       *                  01260000
*              *                  *                  *                  01280000
*              ***************************************                  01300000
*                                                                       01320000
*                                                                       01340000
*              TYPE FLAG = 02 - BPAM DIRECTORIES REQUESTED.             01360000
*                                                                       01380000
*                        = 40 - USER LABELS REQUESTED                   01384021
*                                                                       01388021
*                        = 80 - SET MUST COMPLETE IS ACTIVE             01392021
*                                                                       01396021
*                                                                       01400000
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.    01420000
*                                                                       01440000
*                                                                       01460000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.        01480000
*                                                                       01500000
*                                                                       01520000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT. 01540021
*                                                                       01560000
*                                                                       01580000
*ATTRIBUTES - REENTRANT                                                 01600002
*                                                                       01620000
*                                                                       01640000
*REGISTER USAGE:                                                        01660000
R0       EQU   0                                                        01680000
R1       EQU   1                                                        01700000
R2       EQU   2                                                        01720000
R3       EQU   3                                                        01740000
R4       EQU   4                                                        01760000
R5       EQU   5                                                        01780000
R6       EQU   6                                                        01800000
R7       EQU   7                                                        01820000
R8       EQU   8                                                        01840000
ALTRWKA  EQU   8                  ALTERNATE WORKAREA PTR         S21042 01850021
R9       EQU   9                                                        01860000
RA       EQU   10                                                       01880000
RB       EQU   11                                                       01900000
RJFCB    EQU   11                 POINTER TO JFCB                S21042 01910021
RC       EQU   12                                                       01920000
RWKA     EQU   13                 WORK AREA POINTER.                    01940000
RBAK     EQU   14                 RETURN REGISTER                       01960000
RWRK     EQU   15                 WORK REGISTER                         01980000
RF       EQU   15                                                       02000000
RERR     EQU   15                 ERROR CODE REGISTER                   02020000
RCVT     EQU   15                 POINTER TO CVT                 S21042 02030021
RMSGL    EQU   11                 ERROR MESSAGE LENGTH REGISTER.        02040000
RMA      EQU   10                 ERROR MESSAGE ADDRESS REGISTER        02060000
RBASE    EQU   12                 BASE REGISTER.                        02080000
RCNT     EQU   1                  COUNT REGISTER                        02100000
RTAB     EQU   2                  DADSM ENTRY POINTER                   02120000
RIN      EQU   3                  INPUT EXTENT POINTER                  02140000
ROUT     EQU   4                  OUTPUT HOLE POINTER                   02160000
ROEND    EQU   5                  OUTPUT END POINTER                    02180000
*                                                                       02182021
* OTHER EQUATES                                                         02184021
*                                                                       02186021
FIVE     EQU   5                   CONSTANT OF FIVE              Y02080 02196002
K12      EQU   12                  CONSTANT OF TWELVE            Y02080 02206002
CHAINED  EQU   X'FF'               CHAINING POINTER MASK         A42208 02210021
*                                                                       02212002
         BALR  RBASE,0                                                  02220000
         USING CONVERT,RBASE                                     S21042 02230021
         USING CVT,RCVT                                          S21042 02240021
         USING JFCBKEN,RJFCB                                     S21042 02250021
         USING ALLOCWKA,RWKA            WORK AREA ADDRESSABILITY Y02080 02260002
*                                                                       02280000
CONVERT  EQU   *                                                 S21042 02280121
         CLI   CTR,X'00'                IS THIS THE FIRST VOLUME S21042 02280221
         BNE   DADSMSTR                 BRANCH IF NOT            S21042 02280321
         LA    R1,DEB                   POINTER TO DEB           S21042 02280421
         LA    R2,MBBCCHHR              POINTER TO MBBCCHHR      S21042 02280521
         XC    MBBCCHHR,MBBCCHHR        CLEAR CONVERT AREA       Y02080 02280602
         MVC   MBBCCHHR+3(5),SAVEADR    MOVE IN CCHHR OF F1      S21042 02280821
         STM   R8,RWKA,IECREGSV+K12     SAVE VOLATILE REGISTERS  Y02080 02280902
         LR    ALTRWKA,RWKA             GET POINTER TO WORKAREA  S21042 02281021
         DROP  RWKA                                              S21042 02281121
         USING ALLOCWKA,ALTRWKA         WORK AREA ADDRESSABILITY Y02080 02281202
         L     RCVT,CVTPTR              LOAD CVT BASE            S21042 02281321
         L     RCVT,CVTPRLTV            LOAD CONVERT ROUTINE     S21042 02281421
*                                       BASE                     S21042 02281521
         BALR  RBAK,RCVT                CONVERT CCHHR            S21042 02281621
         LM    R8,RWKA,IECREGSV+K12     RESTORE VOLATILE REGS    Y02080 02281702
         DROP  ALTRWKA                                           S21042 02281821
         USING ALLOCWKA,RWKA            WORK AREA ADDRESSABILITY Y02080 02281902
         ST    R0,PDLIST                                         S21042 02282021
         MVC   JFCBDSCB,PDLIST          MOVE TTR TO JFCB         Y02082 02282202
*                                                                       02282502
* THIS SECTION INITIALIZES THE FORMAT 5 DSCB OUTPUT RECORD,             02284002
* THE FORMAT 5 INPUT AND OUTPUT ADDRESSES, PLUS VARIOUS POINTERS        02288002
* AND SWITCHES.                                                         02292002
*                                                                       02296021
DADSMSTR EQU   *                        BRANCH LABEL             Y02082 02300002
         MODESET EXTKEY=DATAMGT         SWITCH TO DATAMGT KEY    Y02082 02310002
         MVC   DS1DSNAM(L'DS5KEYID),FIVES  MOVE IN F5 KEY ID     Y02082 02320002
         XC    CCHHRSAV,CCHHRSAV        CLEAR CCHHR AREA         Y02080 02360002
         MVI   SWITCH,OUTBYP+FRSTF5     SET THE FIRST F5 AND     A42208 02370021
*                                       READ/WRITE SWITCH        A42208 02380021
         SR    RCNT,RCNT                                                02400000
         IC    RCNT,AENTRYNM           NBR OF DADSMTBL ENTRIES   Y02080 02440002
         LA    ROEND,F5OUT+108    PICK END OF OUTPUT POINTER.           02460000
         LA    RTAB,AENTRIES           PTR TO FIRST ENTRY        Y02080 02480002
RESTOUT  LA    ROUT,F5OUT+4       GET POINTER TO START OF OUTPUT AREA   02500000
RESTORE  XC    IECSDSL1+4(136),IECSDSL1+4        CLEAR INDICATED BYTES  02520000
         MVC   TTRLL(5),DADSMADR   INSERT CCHHR FOR FIRST DADSM RECORD  02540000
         MVC   SAVEADR(5),TTRLL                                         02560000
         MVC   SAVEADR+5(5),TTRLL                                       02580000
FSTRD    BAL   RBAK,READF5                                              02600000
*                                                                       02604021
* THIS SECTION DETERMINES WHEN THE DADSM TABLE EXTENTS SHOULD BE        02608021
* MERGED INTO THE OUTPUT FORMAT 5 DSCB.                                 02612021
*                                                                       02616021
DUELOOP  CLR   ROEND,ROUT         IS OUTPUT AREA FULL.                  02620000
         BNH   TEST1                                                    02640000
COMZE    CLC   0(4,RIN),ZEROS                                           02660000
         BE    CHEND                                                    02680000
         LTR   RCNT,RCNT          IS TABLE EMPTY                        02700000
         BZ    MOVEOUT            YES MOVE INPUT TO OUTPUT              02720000
         CLC   2(2,RTAB),2(RIN)   IS THIS SPACE ALLOCATED.              02740000
         BL    ALTEREX            CHECK FOR MIDDLE OR FRONT ALL.IF LOW. 02760000
         BE    TOTALL             CHECK FOR TOTAL OR REAR  ALL. IF EQ.  02780000
*                                                                       02786021
* THIS SECTION MOVES FORMAT 5 DSCB EXTENTS TO THE OUTPUT AREA.          02792021
*                                                                       02798021
MOVEOUT  EQU   *                                                 A42208 02804021
         TM    SWITCH,DADBYP            IS A F5 WRITE PENDING?   A42208 02810021
         BO    CHEXTRTN                 BRANCH IF YES                   02820000
         MVC   0(4,ROUT),0(RIN)         INSERT INPUT INTO OUTPUT        02840000
INPUT    BCT   RWRK,UPDATEPT      UPDATE POINTER IF NOT EMPTY           02860000
         LA    ROUT,4(ROUT)                                             02880000
         OI    SWITCH,PRCNTL            SET PROCESS CNTRL SWITCH A42208 02890021
*                                                                       02900021
* THIS SECTION TESTS FOR MULTIPLE FORMAT 5 DSCB'S.                      02910021
*                                                                       02920000
CHECHAIN TM    DS5PTRDS+4,CHAINED       IS INPUT F5 CHAINED?     A42208 02940021
         BZ    CHECALT            NO-CHECK TO SEE IF RECORD WAS ALTERED 02960000
         MVC   ALLCCHHR,TTRLL           SAVE CCHHR OF F5         XM2969 02970002
         TM    SWITCH,RCDALT            WAS THE F5 ALTERED?      A42208 02980021
         BO    BRTORDF5                 IF YES, BRANCH            23214 03000018
         XI    SWITCH,OUTBYP            FLIP/FLOP RD/WR SWITCH   A42208 03005021
*                                                                       03010021
* THIS SECTION IS EXECUTED IF THE OUTPUT F5 IS THE SAME AS THE          03015021
* INPUT F5 RECORD. THE WRITING OF THE OUTPUT F5 IS BYPASSED, AND        03020021
* THE OUTPUT AREA IS CLEARED.                                           03025021
*                                                                       03030021
AROUND   EX    0,RESTORE                                                03040000
         LA    ROUT,F5OUT+4                                             03060000
         NI    SWITCH,X'FF'-PRCNTL      CLEAR PROCESS CONTROL    Y02080 03068002
*                                                                       03076021
* THIS SECTION LINKS TO READ THE NEXT FORMAT 5 DSCB.                    03084021
*                                                                       03092021
BRTORDF5 BAL   RBAK,SAVEID                                              03100000
         B     DUELOOP                                                  03120000
*                                                                       03122021
* THIS SECTION TESTS IF THE LAST FORMAT 5 OUTPUT RECORD WAS ALTERED.    03124021
* IF IT WAS ALTERED, THE FORMAT 5 IS WRITTEN. IF NOT, THE WRITING       03126021
* OF THE F5 IS BYPASSED.                                                03128021
*                                                                       03130021
CHECALT  EQU   *                                                 A42208 03132021
         TM    SWITCH,RCDALT            WAS THE F5 ALTERED?      A42208 03134021
         BZ    EXIT1                    IF NOT, BRANCH            23214 03140018
WRITEFNL EQU   *                                                 A42208 03160021
         OI    SWITCH,WRTFNL            SET WRITE LAST F5 SWITCH A42208 03180021
         XC    CCHHRSAV,CCHHRSAV        CLEAR CHAIN ADDR BEFORE  Y02080 03200002
         BAL   RBAK,WRITEF5            WRITING FINAL RECORD.            03220000
*                                                                       03252021
* THIS SECTION BRANCHES TO THE NEXT LOAD OF ISAM ALLOCATE.              03253002
*                                                                       03254021
EXIT1    EQU   *                        BRANCH LABEL             XM2969 03256002
         OI    ACNVSW,AI7CNTRL          SET BIT TO INDICATE      XM2969 03258002
*                                       NORMAL ENTRY TO IGG032I7 XM2969 03258402
*                                       FROM IGG032I6            XM2969 03258802
XCT      EQU   *                        BRANCH LABEL             Y02080 03260002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 03280002
         IECRES LOAD,EXTPR=(RWKA),MODID=LASTLOAD,BRANCH=DIRECT   Y02080 03310002
*                                                                       03365021
* THIS SECTION TESTS IF ANY FORMAT 5 OTHER THAN THE FIRST HAS           03370021
* BEEN READ IN.                                                         03375021
*                                                                       03380021
TEST1    EQU   *                                                 A42208 03385021
         TM    SWITCH,PRCNTL            IS PROCESS CONTROL       A42208 03390021
*                                       SWITCH ON?               A42208 03395021
         BZ    TSTCH                                                    03400000
         TM    SWITCH,OUTBYP            IS THE NUMBER OF WRITES  A42208 03410021
*                                       EQUAL TO THE NBR OF RDS? A42208 03420021
         BZ    TSTCH                    BRANCH IF READ BEFORE WRITE     03440000
         MVC   CCHHRSAV,SAVEADR+FIVE    MOVE IN CHAIN ADDRESS    Y02080 03460002
         B     BRTOWR5                                                  03480000
*                                                                       03486021
* THIS SECTION TESTS IF THERE IS ANOTHER F5 IN THE CHAIN.               03492021
*                                                                       03498021
TSTCH    EQU   *                                                 A42208 03504021
         TM    DS5PTRDS+4,CHAINED       IS THE INPUT F5 CHAINED? A42208 03510021
         BZ    CHEXT              NO-CHECK TO SEE IF NEXT EXTENT ZERO.  03520000
WRITE1   EQU   *                        BRANCH LABEL             Y02080 03530002
         MVC   CCHHRSAV,DS5PTRDS        INSERT CHAIN ADDRESS     Y02080 03540002
BRTOWR5  BAL   RBAK,WRITEF5                                             03560000
         B     DUELOOP                                                  03580000
*                                                                       03585021
* THIS SECTION TESTS IF THERE HAVE BEEN MORE INPUT F5 DSCB'S THAN       03590021
* OUTPUT F5 DSCB'S. IF SO, IT SETS UP TO WRITE A FORMAT 0 DSCB          03595021
* OVER THE LAST INPUT F5.                                               03600021
*                                                                       03605021
CHEND    EQU   *                                                 A42208 03610021
         TM    SWITCH,FRSTF5            IS THE FIRST F5 IN CORE? A42208 03615021
         BO    WRITEFNL                                                 03620000
         TM    SWITCH,OUTBYP            IS THE NUMBER OF WRITES  A42208 03630021
*                                       EQUAL TO THE NBR OF RDS? A42208 03640021
         BO    WRITEZER                 BRANCH IF NO             A42208 03650021
LASTADDR EQU   *                                                 A42208 03660021
         MVC   TTRLL(5),SAVEADR+5       SET UP SEARCH ID ADDR    A42208 03670021
         B     WRITEFNL                 GO WRITE THE LAST F5     A42208 03680021
WRITEZER EQU   *                                                 A42208 03690021
         TM    SWITCH,NEWF5             TEST IF NEW F5 CREATED   A42208 03700021
         BO    LASTADDR                 BRANCH IF YES            A42208 03710021
         OI    SWITCH,WRZERO            SET WRITE F0 SWITCH      A42208 03720021
         B     WRITEFNL                 GO WRITE LAST F5         A42208 03730021
*                                                                       03740021
* THIS SECTION MERGES A DADSM TABLE ENTRY THAT IS ALLOCATED SPACE       03750021
* FROM THE BEGINNING OR THE MIDDLE OF THE INPUT F5 EXTENT.              03760021
*                                                                       03770021
ALTEREX  EQU   *                                                 A42208 03780021
         OI    SWITCH,RCDALT            SET F5 ALTERED SWITCH    A42208 03790021
         TM    SWITCH,DADBYP            IS THE F5 WRITE BYPASS   A42208 03800021
*                                       SWITCH ON?               A42208 03810021
         BO    CHEXTRTN                 BRANCH IF ON                    03860000
         CLC   0(2,RTAB),0(RIN)   TEST FOR MIDDLE OR FRONT ALLOCATION   03880000
         BNE   MIDDLE             LOW NOT EQUAL MIDDLE ALLOCATION       03900000
FRONT    MVC   0(2,ROUT),2(RTAB)  FRONT ALLOCATE INSERT NEW  LOW RTA    03920000
         MVC   2(2,ROUT),2(RIN)   KEEP OLD UPPER RTA                    03940000
DECRMNT  BCTR  RCNT,0             DECREMENT TABLE ENTRY COUNTER         03960000
         LA    RTAB,4(RTAB)       UPDATE POINTER TO NEXT TABLE ENTRY    03980000
         B     INPUT                                                    04000000
UPDATEPT LA    ROUT,4(ROUT)                                             04020000
UPDATIN  LA    RIN,4(RIN)                    UPDATE INPUT POINTER       04040000
         B     DUELOOP                                                  04060000
MIDDLE   MVC   0(2,ROUT),0(RIN)   MIDDLE ALLOCATE INSERT LOW OLD RTA    04080000
         MVC   2(2,ROUT),0(RTAB)  INSERT NEW UPPER RTA                  04100000
         LA    ROUT,4(ROUT)       UPDATE OUTPUT AREA POINTER            04120000
         CLR   ROEND,ROUT         IS OUTPUT AREA FULL                   04140000
         BH    FRONT              NO - INSERT NEXT EXTENT               04160000
         MVC   0(2,RIN),2(RTAB)                                         04180000
         LA    RTAB,4(RTAB)                                             04200000
         BCTR  RCNT,0                                                   04220000
         B     TEST1                                                    04240000
*                                                                       04250021
* THIS SECTION MERGES A DADSM TABLE ENTRY THAT IS ALLOCATED SPACE       04260021
* FROM THE ENTIRE INPUT F5 EXTENT OR FROM THE END OF THIS EXTENT.       04270021
*                                                                       04280021
TOTALL   EQU   *                                                 A42208 04290021
         OI    SWITCH,RCDALT            SET F5 ALTERED SWITCH    A42208 04300021
         CLC   0(2,RIN),0(RTAB)   IS ENTIRE EXTENT ALLOCATED.           04360000
         BNE   NOTALL              NO-GO ND INSERT LOW OLD RTA          04380000
         SH    ROUT,FOUR                                                04400000
         B     DECRMNT                                                  04420000
NOTALL   EQU   *                                                 A42208 04430021
         TM    SWITCH,DADBYP            IS A F5 WRITE PENDING?   A42208 04440021
         BO    CHEXTRTN                 BRANCH IF ON                    04460000
         MVC   0(2,ROUT),0(RIN)         INSERT LOW OLD RTA              04480000
         MVC   2(2,ROUT),0(RTAB)  INSERT NEW UPPER RTA                  04500000
         B     DECRMNT                                                  04520000
*                                                                       04525021
* THIS SECTION SEARCHES FOR A HOLE IN THE VTOC TO WRITE THE NEW F5.     04530021
*                                                                       04535021
CHEXT    CLC   0(4,RIN),ZEROS                                           04540000
         BE    WRITEFNL           WRITE LAST DADSM                      04560000
SEARCH   MVC   SAVEADR(5),TTRLL         SAVE PREVIOUS DADSM CCHHR       04580000
         MVC   TTRLL(5),VTOCADR                                         04600000
         LA    R0,CCW1                                                  04620000
         MVI   CCW5+4,X'30'                                             04640000
         BAL   RB,CHANNLGO        SEARCH FOR HOLE                       04660000
         LA    R0,1                                                     04680000
         AH    R0,UHOLECTR                                              04700000
         STH   R0,UHOLECTR        UPDATE USED HOLE COUNTER              04720000
         MVC   CCHHRSAV,TTRLL                                    Y02080 04740002
         MVC   TTRLL(5),SAVEADR        INSERT ID OF THIS DADSM          04760000
         BAL   RBAK,WRITEF5             WRITE THE NEW F5         A42208 04764021
         MVC   TTRLL,CCHHRSAV                                    Y02080 04768002
         MVC   SAVEADR+FIVE(FIVE),CCHHRSAV  INIT OUTPUT F5 ADDR  Y02080 04772002
         OI    SWITCH,NEWF5             SET NEW F5 CREATED BIT   A42208 04776021
         B     DUELOOP                                           A42208 04780021
*                                                                       04784021
* THIS SECTION CONVERTS DADSM ENTRIES FROM RTA/RTA+1 BACK TO XXYYZ      04788021
* BEFORE WRITING THE FORMAT 5 DSCB.                                     04792021
*                                                                       04796021
WRITEF5  LA    ROUT,F5OUT+4             LOAD POINTER TO OUTPUT AREA     04800000
         TM    SWITCH,WRTFNL            IS WRITE FINAL RECORD    A42208 04810021
*                                       SWITCH ON?               A42208 04820021
         BO    CHEXTRTN                 BRANCH IF YES                   04840000
         OI    SWITCH,DADBYP            SET DADSM WRITE PENDING  A42208 04860021
         B     DUELOOP                  GO PROCESS DADSM                04880000
CHEXTRTN EQU   *                        BRANCH LABEL             Y02080 04890002
         ST    R4,FULLWORD              SAVE OUTPUT POINTER      Y02080 04900002
         LA    R5,DS1DSNAM+5            LOAD POINTER TO CONVERTED AREA  04920000
         LA    RA,26                    SET TO MAXIMUN NBR OF EXTENTS   04940000
         LH    R0,DS4DEVSZ+2            GET NBR OF TRKS/CYL             04960000
NEXTEXT  SR    R6,R6                    CLEAR HIGH DIVIDEND REGISTERS   04980000
         SR    R8,R8                                                    05000000
         SR    R9,R9                    CLEAR FULL CYLINDER REGISTER    05020000
         LH    R7,0(ROUT)               GET EXTENT RTA                  05040000
         LTR   R7,R7                    IS THIS EXTENT ZERO             05060000
         BNZ   CVNT                     BRANCH, EXTENT NOT ZERO  XM2969 05070002
         CH    RA,H26                   IF R10 = 26, THEN ALL    XM2969 05080002
*                                       EXTENTS ARE ZERO         XM2969 05090002
         BNZ   STORE                    BRANCH IF NOT 26         XM2969 05092002
         OI    ACNVSW,AF5ZERO           SET BIT TO INDICATE F5   XM2969 05094002
*                                       WITH ALL ZERO EXTENTS    XM2969 05096002
         B     STORE                    CONTINUE                 XM2969 05098002
CVNT     EQU   *                        BRANCH LABEL             XM2969 05098402
         LH    R9,2(ROUT)               GET EXTENT RTA+1                05100000
         DR    R6,R0                    CONVERT RTA TO CYL/TRK          05120000
         DR    R8,R0                    CONVERT RTA+1 TO CYL/TRKS       05140000
         SR    R9,R7                    CALCULATE CYL DIFFERENCE        05160000
         SR    R8,R6                    CALCULATE TRK DIFFERENCE        05180000
         LTR   R9,R9                    IS CYL DIFFERENCE ZERO          05200000
         BZ    STORE                    BRANCH IF YES                   05220000
         LTR   R6,R6                    IS RTA TRK REMAINDER ZERO       05240000
         BZ    STORE                    BRANCH IF YES                   05260000
         AR    R8,R0                    ADD TRK CONSTANT TO TRK DIFF    05280000
         BCTR  R9,0                     DECREMENT NBR OF CYLS           05300000
STORE    STH   R9,2(ROUT)               STORE NBR OF FULL CYLINDERS     05320000
         MVC   0(4,R5),0(ROUT)          MOVE RTA AND CYLS TO OUTPUT     05340000
         STC   R8,4(R5)                 STORE NBR OF EXCESS TRKS        05360000
         LA    R5,5(R5)                 STEP CONVERTED AREA POINTER     05380000
         LA    ROUT,4(ROUT)             STEP OUTPUT POINTER             05400000
         BCT   RA,NEXTEXT               BRANCH IF MORE OUTPUT TO PROC   05420000
         MVC   DS1PTRDS,CCHHRSAV        INSERT CHAIN ADDRESS     Y02080 05440002
INSERTF5 MVC   DS1DSNAM+4(40),DS1DSNAM+5  OPEN F5 HOLE                  05460000
         MVI   DS1FMTID,X'F5'           INSERT FORMAT ID                05480000
         L     R4,FULLWORD              RESTORE OUTPUT POINTER   Y02080 05490002
         LA    ROEND,F5OUT+108          RELOAD END OF OUTPUT POINTER    05500013
SKIPF5   EQU   *                                                  16787 05510016
         MVI   CCW11+4,X'10'            SET SKIP FLAG FOR WRITE CHECK   05520000
         LA    R0,CCW6                  START CHANNEL PROG AT CCW6      05540000
         BAL   RB,CHANNLGO              GO WRITE THIS DADSM RECORD      05560000
         MVC   TTRLL(5),DS1PTRDS        SET UP NEXT OUTPUT DADSM ADR    05580000
         EX    0,RESTORE                CLEAR OUTPUT AREA               05600000
         XI    SWITCH,OUTBYP            FLIP/FLOP RD/WR SWITCH   A42208 05610021
WRTRTN   EQU   *                                                 A42208 05620021
         NI    SWITCH,X'FF'-DADBYP      CLEAR F5 WRITE PENDING   Y02080 05630002
         BR    RBAK                                                     05660000
*                                                                       05664021
* THIS SECTION READS IN A FORMAT 5 DSCB AND CONVERTS THE EXTENTS        05668021
* FROM XXYYZ TO RTA/RTA+1.                                              05672021
*                                                                       05676021
SAVEID   MVC   SAVEADR(5),TTRLL                                         05680000
         MVC   SAVEADR+5(5),DS5PTRDS                                    05700000
         NI    SWITCH,X'FF'-FRSTF5      CLEAR FIRST F5 SWITCH    Y02080 05720002
         MVC   TTRLL(5),DS5PTRDS                                        05740000
READF5   LA    RIN,DS5AVEXT       RESET INPUT POINTER.                  05760000
         LR    R8,RIN             SET UP POINTER FOR CONVERTED EXTENT.  05780000
         LA    RWRK,26            INSERT MAX NUMBER OF EXTENTE.         05800000
         LA    R0,CCW9                                                  05820000
         MVI   CCW11+4,X'00'                                            05840000
         BAL   RB,CHANNLGO        READ DADSM.                           05860000
         MVC   DS5KEYID+44(90),DS5KEYID+45   REMOVE ID                  05880000
         SR    R6,R6                                                    05900000
TEST0    CLC   0(2,RIN),ZEROS     EXTENT ZERO                           05920000
         BE    INCRIN             YES  INCREMENT REGISTER               05940000
         MVC   CCW12(5),0(RIN)     ALIGN EXTENT TO FULL WORD            05960000
         LH    R7,CCW12+2         LOAD NUMBER OF CYLINDERS              05980000
         MH    R7,DS4DEVSZ+2      MULTIPLY BY TRACK CONSTANT            06000000
         IC    R6,CCW12+4         ODD TRACKS.                           06020000
         AR    R7,R6              ADD ODD TRACKS FOR TOAL TRACKS        06040000
         AH    R7,CCW12           ADD RTA                               06060000
         STH   R7,2(R8)        STORE RTA+1 INTO INPUT CONVERTED AREA.   06080000
         MVC   0(2,R8),CCW12      MOVE RTA TO CONVERTED INPUT AREA.     06100000
         LA    R8,4(R8)           UPDATE POINTER TO NEXT SPACE.         06120000
INCRIN   LA    RIN,5(RIN)         INCREMENT INPUT POINTER               06140000
         BCT   RF,TEST0           PROCESS NEXT EXTENT                   06160000
         LA    RIN,DS5AVEXT       RESET INPUT POINTER.                  06180000
         XC    0(26,R8),0(R8)      CLEAR EXCESS BITS                    06200000
         LA    RWRK,26            RESET COUNT OF EXTENTS.               06220000
         XI    SWITCH,OUTBYP            FLIP/FLOP RD/WR SWITCH   A42208 06230021
         BZ    LABEL                    BRANCH IF NBR OF READS   A42208 06240021
*                                       EQUALS NBR OF WRITES     A42208 06250021
         MVC   TTRLL(5),SAVEADR                                         06280000
LABEL    BR    RBAK                     RETURN TO CALLING ROUTINE       06300000
*                                                                       06320000
* THIS SECTION EXECUTES A CHANNEL PROGRAM.                              06326021
*                                                                       06332021
CHANNLGO MVC   SEEK+3(5),TTRLL          INSERT SEEK ADDRESS FOR IOS     06340000
         STM   RF,R1,IECREGSV+K12       SAVE REGISTERS 15 - 0    Y02080 06360002
         ST    R0,IOB+16          STORE STARTING CCW INTO IOB.          06400000
         MVI   ECB,X'00'          CLEAR STATUS BYTE OF ECB.             06420000
         EXCP  IOB                EXECUTE CHHNNEL PROGRAM.              06440000
         WAIT  ECB=ECB                                                  06460000
         LM    RF,R1,IECREGSV+K12       RESTORE REGISTERS        Y02080 06480002
         TM    ECB,X'20'          TEST FOR PERM IO ERROR                06520000
         BCR   5,RB               NO - CONTINUE PROCESSING              06540000
         LA    ROEND,12                                                 06560000
         B     XCT                                                      06580000
*                                                                       06585021
* CONSTANTS                                                             06590021
*                                                                       06595021
ZEROS    DC    F'0'                                                     06600000
FIVES    DC    X'05050505'                                              06620000
FOUR     DC    H'4'                                                     06640000
H26      DC    H'26'                    CONSTANT OF 26           XM2969 06642002
*                                                                       06645002
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         06650002
*                                                                       06655002
         XCTLTABL ID=(LASTLOAD,I7),SVC=032,LENGTH=,BRT=YES       Y02080 06660002
         EJECT                                                   Y02080 06665002
JFCBKEN  DSECT                                                          06680000
         IEFJFCBN                                                       06700000
         EJECT                                                   Y02080 06710002
DSCBWKAR IECALLWA EP,F4,D1=(1),D2=(5)   ALLOCATE WORK AREA       Y02080 06720002
SWITCH   EQU   ASWITCH                  ALLOCATE SWITCH          Y02080 07590002
         EJECT                                                   Y02080 07600002
CVT      DSECT                                                          07676021
         CVT                            CVT DSECT                Y02080 07678002
         END                                                            07680000
./  ADD  SSI=52700233,NAME=IGG032I7
         TITLE 'IGG032I7 - F4 DSCB UPDATING AND ERROR HANDLING'  Y02080 00010002
IGG032I7 CSECT                                                          00030000
*                                                                       00032002
*MODULE NAME = IGG032I7                                                 00034002
*                                                                       00036002
*DESCRIPTIVE NAME = F4 DSCB UPDATING AND ERROR HANDLING                 00038002
*                                                                       00038402
*COPYRIGHT = NONE                                                       00038802
*                                                                       00039202
*CHANGE ACTIVITY = SEE BELOW                                            00039602
*                                                                       00039702
*          RELEASE 16 DELETIONS                                         00040000
*14630590000,060400,082600-082800                                  AAAA 00042016
*1463                                                             13145 00045016
*          RELEASE 17 DELETIONS                                         00050000
*          RELEASE 18 DELETIONS                                         00060000
*          RELEASE 19 DELETIONS                                         00070000
*0732027200-027400,028200,045800-046200                          O19117 00075019
*          RELEASE 20 DELETIONS                                         00080000
*3033039260-039320                                               A31595 00085020
*3033002200,061200                                               S20201 00087020
*          RELEASE 21 DELETIONS                                         00090000
*1231004800-005000,007800-008400,017600,018800-019400,031200-    A38860 00090621
*1231031400,032800,033200,035000-035200,043000-043200,044200,    A38860 00091221
*1231049200,049600,050000-050200,051200,051600,052000,052400-    A38860 00091821
*1231052600,053000,053600-054000,054600-054800,055000,055400,    A38860 00092421
*1231055800-056000,061820-061840,061880,061940,062020,062060,    A38860 00093021
*1231062120,062812-062816,062820,062824,062828,062832-062834,    A38860 00093621
*1231080400                                                      A38860 00094221
*1231025400                                                      A40449 00095021
*0000061200-061400                                              SA49351 00097021
*          RELEASE 22 DELETIONS                                         00100000
*0000000030-000200,001100-001200,001600-002200,002600-003200,    Y02080 00110102
*0000005600,006200-006600,007200-007400,007700,009000,018400,    Y02080 00110202
*0000018900-019200,025270,025600,026800,031800-032000,032600-    Y02080 00110302
*0000033000,037400-037600,038200-038400,040200,042200,042800-    Y02080 00110402
*0000043100,043600-044000,047000-047400,057600,058900,059100,    Y02080 00110502
*0000060300,060500,060800-060820,060844-060852,060854-060855,    Y02080 00110602
*0000060870-060900,061200-061800,061840-061860,069000,069320-    Y02080 00110702
*0000069380,069800-082200,082800-083400,083800                   Y02080 00110802
*0000007200,025204,025620,039280-039300,046600,048800-056800,    Y02134 00110902
*0000061804-062836,062883,069350,082700-083800                   Y02134 00111002
*0000039260                                                      Y02130 00111102
*0000063360                                                      Y02078 00111202
*0000060600                                                      Y02144 00111302
*0000025220-025230,025280,060840-060860,069300                   YM3048 00111502
*0000060630,060910-060920                                        YM3997 00111902
*0000019200-019300,069800                                        XM2969 00113502
*          VS2 RELEASE 03.0 DELETIONS/CHANGES                           00115502
*0000                                                           ZA00009 00117502
*0000048000                                                    @ZA02216 00118503
*                                                                       00120002
*STATUS CHANGE LEVEL 007                                                00130021
*FUNCTION - THIS MODULE UPDATES THE HOLE COUNT FOR AVAILABLE DSCB       00140000
*           RECORDS AND WRITES OUT THE FORMAT 4 DSCB. IT THEN FREES     00160002
*           ANY WORK AREAS AND RETURNS TO THE SCHEDULER.  FOR ERROR     00180002
*           CONDITIONS, IT LOADS THE ERROR CODE IN REGISTER 15 BEFORE   00200002
*           RETURNING.  FOR MULTI-VOLUME PRIME REQUESTS, THIS MODULE    00210002
*           CALCULATES THE SPACE TO BE ALLOCATED ON THE NEXT VOLUME.    00220002
*           IF AN I/O ERROR HAS OCCURRED IN AN ISAM ALLOCATE MODULE,    00225002
*           THIS MODULE ISSUES MESSAGE IEC603I WITH CODE=0.             00230002
*                                                                       00240000
*ENTRIES - THE ONLY ENTRY TO THIS MODULE IS IGG032I7.  ENTRY IS         00260002
*          NORMALLY FROM IGG032I6.  ENTRY IS ALSO MADE FROM ANY         00280002
*          ISAM ALLOCATE MODULE WHEN AN ERROR IS ENCOUNTERED.           00300002
*                                                                       00340000
*                                                                       00360000
*INPUT - THE WORK AREA CONTAINS THE VTOCADR AND THE DATA PORTION OF THE 00380000
*        FORMAT 4 DSCB.  IN CASE OF AN ERROR ENTRY REGISTER FIVE WILL   00400000
*        BE SET TO THE PROPER CODE.                                     00420000
*                                                                       00420721
*        IF MORE THAN ONE DD STATEMENT IS USED IN REQUESTING SPACE,     00421421
*        THE SEVEN LOW-ORDER BYTES OF THE DDNAME FIELD IN ALL BUT THE   00422121
*        FIRST ISAM DD ENTRY ARE USED TO CREATE THE FOLLOWING SPECIAL   00422821
*        ISAM ALLOCATE INTERFACE:                                       00423521
*                                                                       00424221
*              BYTE 1                                                   00424921
*                   BITS 0 AND 1   00 - ABSOLUTE TRACK REQUEST          00425621
*                                  01 - BLANK SPACE REQUEST             00426321
*                                  11 - CONTIGUOUS SPACE REQUEST        00427021
*                                                                       00427721
*                   BIT 2          THIS IS THE SECOND DD CARD.          00428421
*                                                                       00429121
*                   BIT 5          OVFLOW HAS BEEN ALLOCATED.           00429821
*                                                                       00430521
*                   BIT 6          PRIME HAS BEEN ALLOCATED.            00431221
*                                                                       00431921
*                   BIT 7          INDEX HAS BEEN ALLOCATED.            00432621
*                                                                       00433321
*              BYTES 2 - 3         CURRENT VOLUME SEQUENCE NUMBER       00434021
*                                  FOR SECOND OR THIRD DD CARD          00434721
*                                                                       00435421
*              BYTES 4 - 7         POINTER TO THE FIRST TIOT ENTRY      00436121
*                                  FOR THIS REQUEST                     00436821
*                                                                       00437521
*                                                                       00440000
*OUTPUT - THE UPDATED FORMAT 4 DSCB IS WRITTEN OUT.                     00460000
*                                                                       00520000
*                                                                       00540000
*EXTERNAL ROUTINES - SVC'S ISSUED IN MACRO EXPANSIONS                   00560002
*   EXCP(0) READ FROM OR WRITE TO DIRECT ACCESS DEVICE                  00580000
*   WAIT(1) WAIT ON EVENT CONTROL BLOCK                                 00600000
*   WTO(35) WRITE MESSAGE TO OPERATOR                                   00610002
*                                                                       00660002
*   OTHER MACROS ISSUED - IEFJFCBN - BUILDS JFCB                        00680000
*   IECSDSL1 - BUILDS DSCBS                                             00700000
*   IECDSECS - EXPANDS THE CVT AND DSAB DSECTS                          00720002
*   IECALLWA - ALLOCATE WORK AREA EXPANSION                             00740002
*                                                                       00760000
*EXITS - NORMAL - BRANCH TO IGG032I8 IF MULTIVOLUME PRIME ALLOCATION    00770002
*               - RETURN TO SCHEDULER IF NOT MULTIVOLUME                00780021
*      - ERROR  - RETURN TO SCHEDULER WITH ERROR CODE IN REGISTER 15    00790021
*                                                                       00800021
*                 ERROR CODES THAT CAN BE ISSUED BY THIS MODULE:        00810021
*                                                                       00820021
*                 0C - PERMANENT I/O ERROR                              00830021
*                                                                       00860000
*                                                                       00880000
*TABLES/WORK AREAS - DADSM WORK AREA DESCRIBED BY MACRO IECALLWA        00900002
*                                                                       00920000
*              ***************************************                  00940000
*              *             DADSM TABLE             *                  00960000
*              ***************************************                  00980000
*                                                                       01000000
*              ***************************************                  01020000
*              *        *         *                  *                  01040000
*              *  TYPE  *  NO OF  *     USED HOLE    *                  01060000
*              *  FLAG  * ENTRIES *      COUNTER     *                  01080000
*              *        *         *                  *                  01100000
*              ***************************************                  01120000
*              *                  *                  *                  01140000
*              *       RTA        *      RTA+1       *                  01160000
*              *                  *                  *                  01180000
*              ***************************************                  01200000
*              *                  *                  *                  01220000
*              *       RTA        *      RTA+1       *                  01240000
*              *                  *                  *                  01260000
*              ***************************************                  01280000
*              *                  *                  *                  01300000
*              *       RTA        *      RTA+1       *                  01320000
*              *                  *                  *                  01340000
*              ***************************************                  01360000
*              *                  *                  *                  01380000
*              *       RTA        *      RTA+1       *                  01400000
*              *                  *                  *                  01420000
*              ***************************************                  01440000
*              *                  *                  *                  01460000
*              *       RTA        *      RTA+1       *                  01480000
*              *                  *                  *                  01500000
*              ***************************************                  01520000
*                                                                       01540000
*                                                                       01560000
*              TYPE FLAG = 02 - BPAM DIRECTORIES REQUESTED.             01580000
*                                                                       01585002
*                          40 - USER LABELS REQUESTED                   01590002
*                                                                       01595002
*                          80 - ENQ SET-MUST-COMPLETE ISSUED            01596002
*                                                                       01600000
*                                                                       01620000
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.    01640000
*                                                                       01660000
*                                                                       01680000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.        01700000
*                                                                       01720000
*                                                                       01740000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT. 01760021
*                                                                       01780000
*                                                                       01800000
*                                                                       01820000
*ATTRIBUTES - REENTRANT                                                 01840002
*                                                                       01860000
*STORAGE - PROGRAM CODE CSECT = LESS THAN 1024 BYTES                    01890002
*          WORK AREA = AS DEFINED IN THE IECALLWA MACRO          XM2969 01920002
*          RPS WORK AREA = AS DEFINED IN THE IECRPS MACRO        XM2969 01930002
*                                                                       01960000
*                                                                       01980000
*REGISTER USAGE                                                         02000000
*              REGISTERS 0-9 WORK REGISTERS                             02020000
*              REGISTER 10 - TIOT SET UP TABLE POINTER                  02040000
*              REGISTER 11 - JFCB POINTER                               02060000
*              REGISTER 12 - BASE REGISTER                              02080000
*              REGISTER 13 - WORK AREA POINTER                          02100000
*              REGISTER 14 SUBROUTINE LINKAGE AND WORK REGISTER         02120000
*              REGISTER 15 WORK REGISTER AND ERROR CODE REGISTER        02140000
*                                                                       02160000
***** REGISTER NAMES *****                                              02180000
RZERO    EQU   0                                                        02200000
RONE     EQU   1                                                        02220000
RTWO     EQU   2                                                        02240000
RTHREE   EQU   3                                                        02260000
RFOUR    EQU   4                                                        02280000
RFIVE    EQU   5                                                        02300000
RSIX     EQU   6                                                        02320000
RSEVEN   EQU   7                                                        02340000
RUCB     EQU   7                        POINTER TO UCB           Y02078 02350002
REIGHT   EQU   8                                                        02360000
RNINE    EQU   9                                                        02380000
DRBAK    EQU   9                                                        02400000
RTEN     EQU   10                                                       02420000
RJFCB    EQU   11                                                       02440000
RBASE    EQU   12                                                       02460000
RWORK    EQU   13                                                       02480000
RETURN   EQU   14                                                       02500000
RFTEN    EQU   15                                                       02520000
*                                                                       02520121
* OTHER EQUATES                                                         02520221
*                                                                       02520321
BLANK    EQU   X'40'                    EBCDIC BLANK             A40449 02520521
TWO      EQU   2                        CONSTANT OF TWO          Y02080 02520902
FOURCH   EQU   4                        CONSTANT NUMBER 4        S20201 02521020
FOUR     EQU   4                        CONSTANT OF 4            Y02134 02521402
SEVEN    EQU   7                        CONSTANT OF 7            Y02134 02521802
APDIS    EQU   28                       DISP. TO AVT ADDR IN DEB S20201 02524020
AVTDS    EQU   120                      DISP. TO AVT PTR. IN     S20201 02525020
*                                       W.A.                     S20201 02526020
DIRFBIT  EQU   X'04'                    VTOC INTERRUPT BIT       O19117 02530019
TIOEVOLS EQU   2                        OFFSET TO NBR OF DEVICES A38860 02564021
TIOEDDNM EQU   4                        OFFSET TO DDNAME         A38860 02566021
ISAMSTAT EQU   5                        OFFSET TO ALLOCATION     A38860 02568021
*                                       STATUS                   A38860 02570021
VOLSQCTR EQU   6                        OFFSET TO DS1VOLSQ CTR   A38860 02572021
TIOTPTR  EQU   8                        OFFSET TO 1ST ENTRY PTR  A38860 02574021
UCBENTRY EQU   16                       OFFSET TO 1ST UCB ENTRY  A38860 02576021
CURRDSAB EQU   0                        OFFSET TO CURRENT DSAB   Y02134 02576202
*                                       POINTER IN DSAB LIST     Y02134 02576402
FRSTDSAB EQU   4                        OFFSET TO FIRST DSAB PTR Y02134 02576602
SCNDDSAB EQU   8                        OFFSET TO 2ND DSAB PTR   Y02134 02576802
THRDDSAB EQU   12                       OFFSET TO 3RD DSAB PTR   Y02134 02577002
ONE16    EQU   116                      116 CYLINDERS            Y02130 02577202
DA3340   EQU   X'0A'                    3340 DEVICE TYPE         Y02130 02577402
K1       EQU   1                        CONSTANT OF 1            XM2969 02577502
K3       EQU   3                        CONSTANT OF 3            XM2969 02577702
K4       EQU   4                        CONSTANT OF 4            XM2969 02577802
K5       EQU   5                        CONSTANT OF 5            XM2969 02577902
K12      EQU   12                       CONSTANT OF 12           Y02080 02578202
K16      EQU   16                       CONSTANT OF 16           XM2969 02578302
K140     EQU   140                      CONSTANT OF 140          XM2969 02578402
UCBADDR  EQU   32                       DISP. TO UCB ADDR IN DEB Y02078 02578902
UUU      EQU   37                       DISP. TO UUU IN MESSAGE  Y02078 02579002
VOLSER   EQU   41                       DISP. TO VOLSER IN MSG   Y02078 02579102
SECPASS  EQU   X'20'                    SECOND ENTRY SWITCH      Y02080 02579202
WRTCCW   EQU   X'0D'                    WRITE CCW CODE           XM2969 02579302
READCCW  EQU   X'0E'                    READ CCW CODE            XM2969 02579402
ZEROFLAG EQU   X'00'                    ZERO FLAG FOR READ       XM2969 02579802
SKIPFLAG EQU   X'10'                    SKIP FLAG                XM2969 02579902
*                                                                       02580000
         BALR  RBASE,0                                                  02640000
         USING DELTA,RBASE                                              02660000
         USING ALLOCWKA,RWORK           WORK AREA ADDRESSABILITY Y02080 02680002
         USING JFCBKEN,RJFCB                                            02700000
*                                                                       02704002
DELTA    EQU   *                                                 O19117 02706019
         TM    ACNVSW,AI7CNTRL          TEST IF ENTRY FROM       XM2969 02706502
*                                       IGG032I6 TO WRITE A F0   XM2969 02707002
         BNO   DELTA1                   BRANCH IF ENTRY NOT      XM2969 02707502
*                                       FROM 32I6 TO WRITE A F0  XM2969 02708002
         NI    ACNVSW,X'FF'-AI7CNTRL    RESET PATH INDICATOR    ZA00009 02708402
*                                                                XM2969 02708502
* THIS SECTION WRITES A FORMAT 0 DSCB IF NECESSARY               XM2969 02709002
*                                                                XM2969 02709502
EXIT1    EQU   *                        TEST TO WRITE AN F0      XM2969 02710002
         SR    RFIVE,RFIVE              CLEAR ERROR REG          XM2969 02710502
         TM    ACNVSW,AF5ZERO           DOES A F5 WITH ALL ZERO  XM2969 02711002
*                                       EXTENTS EXIST            XM2969 02711502
         BNO   TESTF0                   ZERO EXTENTS DOES NOT    XM2969 02711602
*                                       EXIST                    XM2969 02711702
         NI    ACNVSW,X'FF'-AF5ZERO     RESET PATH INDICATOR    ZA00009 02713202
         TM    ASWITCH,FRSTF5           IS F5 IN CORE IND SET    XM2969 02718502
         BO    TESTF0                   BRANCH IF IND IS SET     XM2969 02720002
         MVC   TTRLL(K5),ALLCCHHR       CCHHR OF F5 TO BE READ   XM2969 02721502
         MVI   CCW11+K4,ZEROFLAG        ZERO FLAG BYTES          XM2969 02723002
         MVC   SEEK+K3(K5),TTRLL        INSERT SEEK ADDR         XM2969 02724502
         LA    RZERO,CCW9               START OF CHANNEL PGM     XM2969 02726002
         ST    RZERO,IOB+K16            STORE STARTING CCW       XM2969 02727502
         BAL   RETURN,EXECUTET          BAL TO READ F5 DSCB      XM2969 02729002
         MVC   SAVEADR+K5(K5),DS5PTRDS  SAVE CCHHR OF F5         XM2969 02730502
         XC    DS5PTRDS(K5),DS5PTRDS    ZERO CHAIN POINTER       XM2969 02732002
         MVI   CCW11,WRTCCW             CHANGE READ CCW TO WRITE XM2969 02733502
         MVC   SEEK+K3(K5),TTRLL        INSERT SEEK ADDRESS      XM2969 02735002
         LA    RZERO,CCW9               START OF CHANNEL PGM     XM2969 02736502
         ST    RZERO,IOB+K16            STORE STARTING CCW       XM2969 02738002
         BAL   RETURN,EXECUTET          BAL TO WRITE F5          XM2969 02739502
         OI    ASWITCH,WRZERO           SET WRITE F0 BIT         XM2969 02741002
         MVI   CCW11,READCCW            RESTORE READ CCW         XM2969 02742502
TESTF0   EQU   *                        TEST TO WRITE AN F0      XM2969 02744002
         TM    ASWITCH,WRZERO           MUST A F0 BE WRITTEN?    XM2969 02745502
         BZ    DELTA1                   BRANCH IF NOT            XM2969 02747002
         MVC   TTRLL(K5),SAVEADR+K5     ADDRESS OF DSCB TO BE    XM2969 02748502
*                                       ZEROED                   XM2969 02750002
         XC    DS1DSNAM(K140),DS1DSNAM  ZERO BUFFER              XM2969 02751502
         LH    RTWO,DS4DSREC            GET HOLE COUNT           XM2969 02753002
         LA    RTWO,K1(RTWO)            INCREMENT BY ONE         XM2969 02754502
         STH   RTWO,DS4DSREC            REPLACE IT               XM2969 02756002
         MVI   CCW11+K4,SKIPFLAG        SET SKIP FLAG            XM2969 02757502
         MVC   SEEK+K3(K5),TTRLL        INSERT SEEK ADDRESS      XM2969 02759002
         LA    RZERO,CCW6               START CHAN PROG AT CCW6  XM2969 02760502
         ST    RZERO,IOB+K16            STORE STARTING CCW ADDR  XM2969 02762002
         BAL   RETURN,EXECUTET          GO WRITE A FORMAT 0      XM2969 02763502
DELTA1   EQU   *                        BRANCH LABEL             XM2969 02765002
         LTR   DRBAK,RFIVE              TEST/SAVE ERROR CODE     O19117 02766502
         BZ    NOERROR                  BR IF NO ERROR           O19117 02768002
         XI    DS4VTOCI,DIRFBIT         RESET/SET DIRF BIT       O19117 02769502
         TM    DS4VTOCI,DIRFBIT         TEST RESULTS             O19117 02771002
         BO    MISTAKE                  BR IF PREVIOUS INTERRUPT O19117 02772502
         CH    RFIVE,IOCODE             TEST ERROR CODE          O19117 02774002
         BE    MISTAKE                  BR IF I/O ERROR          O19117 02775502
         B     FORCEF4                  GO FORCE WRITE F4        O19117 02777002
*                                          DETECTED                     02778502
* THIS SECTION UPDATES THE DSCB FORMAT 4, RELOCATES A WRITE CHANNEL     02780000
* PROGRAM AND WRITES OUT THE UPDATED DSCB FORMAT 4.                     02800000
NOERROR  EQU   *                                                 O19117 02810019
         XI    DS4VTOCI,DIRFBIT         RESET DIRF BIT           O19117 02820019
         LH    RTWO,DS4DSREC            UPDATE THE NUMBER OF AVAILABLE  02840000
         SH    RTWO,UHOLECTR               DSCB RECORDS                 02860000
         STH   RTWO,DS4DSREC                                            02880000
FORCEF4  EQU   *                                                 O19117 02886019
         MVC   SEEK+3(5),DADSMADR       SETUP F4 ADDR            O19117 02892019
         LM    RTWO,RSEVEN,CHANNEL      RELOCATE CHANNEL PROGRAM TO     02900000
         ALR   RTWO,RWORK                 WRITE OUT FORMAT 4 DSCB       02920000
         ALR   RFOUR,RWORK                                              02940000
         ALR   RSIX,RWORK                                               02960000
         STM   RTWO,RSEVEN,CCW1                                         02980000
         LM    RTWO,RSEVEN,CHANNEL+24  RELOCATE LAST 3 CCW'S            03000000
         ALR   RTWO,RWORK                                               03020000
         ALR   RFOUR,RWORK                                              03040000
         ALR   RSIX,RWORK                                               03060000
         STM   RTWO,RSEVEN,CCW4                                         03080000
         LA    RTWO,CCW1                SET UP IOB TO POINT TO THE      03100000
         ST    RTWO,IOB+16              FIRST CCW                A38860 03130021
         BAL   RETURN,EXECUTET                                          03160000
         LTR   RFIVE,DRBAK              TEST/RESTORE ERROR CODE  O19117 03165019
         BNZ   MISTAKE                  BR IF THIS WAS A FORCE   O19117 03170019
*                                       WR                       O19117 03175019
         L     RJFCB,AJFCBPTR           PICK UP JFCB POINTER     Y02080 03200002
* A TEST IS MADE HERE TO DETERMINE WHETHER OR NOT THE REQUEST WAS MULTI 03220000
* VOLUME                                                                03240000
         L     RTEN,ATIOTPTR            LOAD PTR TO DD ENTRY     Y02080 03300002
         CLI   TIOEVOLS(RTEN),X'01'     MULTI-VOLUME REQUEST?    A38860 03320021
         BE    ALLOUT                   BRANCH IF NOT A MULTI- VOLUME   03340000
*                                          REQUEST                      03360000
         SR    RFIVE,RFIVE                                              03380000
         IC    RFIVE,CTR                PICK UP THE UCB COUNTER         03400000
         LA    RFIVE,1(RFIVE)           CHECK THE UCB COUNTER FOR AN    03420000
*                                          EQUAL COMPARE TO THE NUMBER  03440000
*                                          OF UCB'S TO BE ALLOCATED     03460000
         STC   RFIVE,CTR                UPDATE UCB POINTER              03480000
         CLC   CTR(1),TIOEVOLS(RTEN)    CHECK FOR COMPLETION OF  A38860 03500021
*                                       MULTI-VOLUME ALLOCATION  A38860 03520021
         BE    ALLOUT                   BRANCH IF MULTI-VOLUME ALLOCA-  03540000
*                                          TION IS COMPLETE             03560000
         MVI   F2,X'00'                 SET FOR NO FORMAT 2             03580000
         TM    JFCBCTRI,X'DF'           CHECK REQUEST TYPE FIELD FOR AN 03600000
*                                          ABSOLUTE TRACK REQUEST       03620000
         BC    4,MIXED                  BRANCH IF NOT AN ABSOLUTE TRACK 03640000
*                                          REQUEST                      03660000
* THIS SECTION SUBTRACTS THE NUMBER OF TRACKS JUST ALLOCATED FROM THE   03680000
* NUMBER TO BE ALLOCATED IN A MULTI-VOLUME PRIME CASE.  THE AMOUNTS ARE 03700000
* ALSO UPDATED FOR THE NEXT ALLOCATION                                  03720000
         L     RTWO,HOWMUCH             SUBTRACT THE AMOUNT JUST Y02080 03760002
*                                       ALLOCATED FROM THE       Y02080 03772002
*                                       QUANTITY DESIRED         Y02080 03774002
         LH    RTHREE,PRIQTY                                            03780000
         SR    RTWO,RTHREE                                              03800000
         ST    RTWO,HOWMUCH             SET UP THE AMOUNT STILL  Y02080 03820002
*                                       TO BE ALLOCATED          Y02080 03830002
         LH    RSIX,DS4DEVSZ           TEST FOR REQUEST STILL LARGER    03860000
         BCTR  RSIX,0                   ACCOUNT FOR THE VTOC            03890013
         MH    RSIX,DS4DEVSZ+2                                          03920000
         SR    RFIVE,RFIVE              CLEAR REGISTER           A31595 03922020
         L     RTHREE,DEB+32            FETCH UCB PTR            A31595 03924020
         USING UCB,RTHREE               UCB ADDRESSABILITY       Y02130 03924202
         CLI   UCBTBYT4,DA3340          TEST IF 3340             Y02130 03924402
         BNE   NOT3340                  BRANCH IF NOT            Y02130 03924602
         SR    RTWO,RTWO                CLEAR FOR DIVIDE         Y02130 03926002
         LH    RTHREE,DS4DEVSZ          NBR OF CYLS ON VOLUME    Y02130 03926202
         LA    RFOUR,ONE16              4 ALTERNATE TRACKS       Y02130 03926402
         DR    RTWO,RFOUR               FOR EVERY 116 CYLINDERS  Y02130 03926602
*                                       SO DIVIDE CYL BY 116,    Y02130 03926802
         SLL   RTHREE,TWO               MULTIPLY QUOTIENT BY 4   Y02130 03927002
*                                       EQUALS TOTAL ALTERNATES  Y02130 03927202
SUBTALT  EQU   *                        BRANCH LABEL             Y02130 03927402
         SR    RSIX,RTHREE              REDUCE TOTAL BY NUMBER   Y02130 03927602
*                                       OF ALTERNATE TRACKS      Y02130 03927802
         L     RTWO,HOWMUCH             RESTORE REGISTER TWO     Y02130 03928002
         B     CONT                     CONTINUE CALCULATION     Y02130 03928202
NOT3340  EQU   *                        BRANCH LABEL             Y02130 03928402
         IC    RFIVE,UCBTBYT4           FETCH UNIT TYPE          Y02130 03928602
         DROP  RTHREE                                            Y02130 03928802
         L     RTHREE,CVTPTR            FETCH CVT POINTER        Y02134 03929002
         L     RTHREE,CVTZDTAB-CVT(RTHREE) DEVICE TABLE POINTER  Y02134 03930002
         IC    RFIVE,0(RFIVE,RTHREE)    FETCH DEVICE ENTRY       A31595 03932020
*                                       OFFSET                   A31595 03934020
         SH    RSIX,12(RFIVE,RTHREE)    REDUCE TOTAL TRACKS BY   A31595 03936020
*                                       NUMBER OF ALTERNATE TRKS        03938020
CONT     EQU   *                        BRANCH LABEL             Y02130 03938402
         CR    RTWO,RSIX                COMPARE AMOUNT TO BE ALLOCATED  03940000
*                                          TO DEVICE SIZE               03960000
         BH    MORE                     BRANCH IF AMOUNT NEEDED IS      03980000
*                                          LARGER THAN DEVICE SIZE      04000000
         MVC   PRIQTY,HOWMUCH+TWO       AMOUNT TO BE ALLOCATED   Y02080 04020002
*                                          ON NEXT VOLUME               04040000
         B     SETABSTR                                                 04060000
MORE     STH   RSIX,PRIQTY              SET AMOUNT TO BE ALLOCATED ON   04080000
*                                          THE NEXT VOLUME TO DEVICE    04100000
*                                          SIZE                         04120000
SETABSTR MVC   ABSTR(2),DS4DEVSZ+2      SET ABSOLUTE TRACK ADDRESS TO   04140000
*                                         CYLINDER ONE TRACK ZERO       04160000
MIXED    BAL   DRBAK,FINAL1             GO DEQ THIS VOLUME              04180000
*                                                                       04200000
* BRANCH TO LAST LOAD TO PERFORM A DUPLICATE NAME SEARCH ON THE NEXT    04220002
* VOLUME.                                                               04240000
*                                                                       04260000
         IECRES LOAD,EXTPR=(RWORK),MODID=MVOLMOD,BRANCH=DIRECT   Y02080 04310002
*                                                                       04340000
* THIS SECTION EXECUTES A CHANNEL PROGRAM.                              04360002
*                                                                       04380002
EXECUTET EQU   *                                                 A38860 04410021
         MVI   ECB,X'00'                CLEAR ECB                A38860 04420021
         EXCP  IOB                                                      04440000
         WAIT  1,ECB=ECB                                                04460000
         TM    ECB,X'20'                CHECK FOR SUCCESSFUL COMPLETION 04480000
         BCR   7,RETURN                BRANCH IF COMPLETION SUCCESSFUL  04500000
         LA    RFIVE,12                SET ERROR CODE FOR PERMANENT     04520000
*                                         I/O ERROR                     04540000
         B     MISTAKE                                                  04560000
*                                                                       04630002
* THIS SECTION CLEANS UP AFTER LAST PASS FOR A MULTI-VOLUME REQUEST OR  04640000
* A MULTI-DD CARD REQUEST BY RESETTING THE LAST SEVEN BYTES OF THE      04650002
* DDNAME TO BLANKS.  IT UPDATES THE ISAM ALLOCATE INTERFACE IN THE      04660002
* TIOT IF THE CURRENT ALLOCATED DATA SET IS NOT THE LAST OF THE         04670002
* CONCATENATED DD CARDS.  RTEN POINTS TO THE CURRENT TIOT ENTRY.        04672002
*                                                                       04674002
ALLOUT   SR    RFIVE,RFIVE              SET RETURN CODE- SUCCESSFUL     04680000
         L     RTWO,HOWMUCH             TOTAL QTY TO ALLOCATE    Y02080 04720002
         LH    RTHREE,PRIQTY            PICK UP QUANTITY TO BE ALLOC-   04760000
         SR    RTWO,RTHREE                 ATED ON THIS VOLUME          04780000
         BNP   ALLOUTE                  BRANCH IF ALLOC DONE   @ZA02216 04800003
         LA    RFIVE,20                 SET ERROR CODE FOR QUANTITY NOT 04820000
*                                       AVAILABLE                       04840000
         B     MISTAKE                                                  04860000
ALLOUTE  EQU   *                        BRANCH LABEL             Y02134 04870002
         L     RTHREE,ADSABLST          GET DSAB LIST ADDRESS    Y02134 04880002
         L     RTWO,SCNDDSAB(,RTHREE)   RTWO HAS 2ND DSAB ADDR   Y02134 04890002
         LTR   RTWO,RTWO                IS THERE A SECOND DD     Y02134 04900002
         BZ    FINAL                    BRANCH IF CURRENT IS 1ST Y02134 04910002
*                                       AND ONLY DD CARD         Y02134 04920002
TWODD    EQU   *                        AT LEAST TWO DD CARDS    Y02134 04930002
         L     RTHREE,THRDDSAB(,RTHREE) RTHREE HAS 3RD DSAB ADDR Y02134 04940002
         USING DSAB,RTWO                                         Y02134 04950002
         L     RTWO,DSABTIOT            LOAD 2ND TIOT ENTRY ADDR Y02134 04960002
         DROP  RTWO                                              Y02134 04970002
         LTR   RTHREE,RTHREE            TEST FOR A 3RD DD CARD   Y02134 04980002
         BZ    ONLY2DDS                 BRANCH IF NO             Y02134 04990002
THREEDD  EQU   *                        THERE ARE 3 DD CARDS     Y02134 05000002
         USING DSAB,RTHREE                                       Y02134 05010002
         L     RTHREE,DSABTIOT          LOAD 3RD TIOT ENTRY ADDR Y02134 05020002
         DROP  RTHREE                                            Y02134 05030002
         CR    RTEN,RTHREE              TEST IF CURRENT IS 3RD   Y02134 05040002
         BE    THIRDOF3                 BRANCH IF YES            Y02134 05050002
         CR    RTEN,RTWO                TEST IF CURRENT IS 2ND   Y02134 05060002
         BNE   FIRSTOF3                 BRANCH IF NO             Y02134 05070002
*                                                                       05080002
* IF THE CURRENT TIOT ENTRY IS NOT THE LAST OF THE CONCATENATED         05090002
* DD CARDS, THIS SECTION UPDATES THE ISAM ALLOCATE INTERFACE IN         05100002
* THE TIOT FOR THE REMAINING CONCATENATED DD CARD(S).                   05110002
*                                                                       05120002
SCNDOF3  EQU   *                        THE CURRENT TIOT         Y02134 05130002
*                                       ENTRY IS THE 2ND OF 3    Y02134 05132002
         MVC   VOLSQCTR(TWO,RTHREE),VOLSQCTR(RTWO) MOVE THE VOL  Y02134 05140002
*                                       SEQ COUNT INTO 3RD TIOT  Y02134 05150002
         B     FINAL                    CONTINUE                 Y02134 05160002
FIRSTOF3 EQU   *                        THE CURRENT TIOT         Y02134 05170002
*                                       ENTRY IS THE 1ST OF 3    Y02134 05172002
         MVC   ISAMSTAT(SEVEN,RTHREE),ISAMSTAT(RTWO) MOVE THE    Y02134 05180002
*                                       STATUS FROM THE SECOND   Y02134 05190002
*                                       TIOT ENTRY TO THE 3RD    Y02134 05200002
         NI    ISAMSTAT(RTHREE),X'FF'-SECPASS RESET 2ND ENTRY SW Y02134 05210002
         B     FINAL                    CONTINUE                 Y02134 05220002
*                                                                       05230002
* THIS SECTION RESETS THE LAST SEVEN BYTES OF THE DDNAME TO BLANKS.     05240002
*                                                                       05250002
ONLY2DDS EQU   *                        THERE ARE ONLY 2 DD      Y02134 05260002
*                                       CARDS FOR THE DATASET    Y02134 05262002
         CR    RTEN,RTWO                TEST IF CURRENT IS 2ND   Y02134 05270002
         BNE   FINAL                    BRANCH IF NOT            Y02134 05280002
         B     SCNDOF2                  BLANK LAST DD ENTRY      Y02134 05290002
THIRDOF3 EQU   *                        THE CURRENT TIOT         Y02134 05300002
*                                       ENTRY IS THE LAST OF 3   Y02134 05302002
         MVC   ISAMSTAT(SEVEN,RTEN),BLANKS  RESTORE LAST DDNAME  Y02134 05310002
*                                       TO BLANKS                Y02134 05320002
SCNDOF2  EQU   *                        THE CURRENT TIOT ENTRY   Y02134 05330002
*                                       IS THE LAST OF 2 OR 3    Y02134 05332002
         MVC   ISAMSTAT(SEVEN,RTWO),BLANKS  RESTORE SECOND       Y02134 05340002
*                                       DDNAME TO BLANKS         Y02134 05350002
FINAL    LA    DRBAK,FINAL2             SET UP RETURN ADDRESS           05700000
FINAL1   MVC   MJELNAME(8),VTOCNAME     MOVE QUEUE NAME TO WORK AREA    05720000
         MVI   DEQAREA,X'FF'            SET LAST ENTRY CODE             05740000
         SR    RONE,RONE                ZERO REGISTER            Y02080 05750002
         STH   RONE,DEQAREA+TWO         CLEAR FOR DEQ MACRO      Y02080 05760002
         TM    TYPEFLG,SMCDONE          IS SET MUST COMPLETE ON         05780000
         BZ    NOSMC                    BRANCH IF NO                    05800000
*                                                                       05820000
* LINK TO DEQ ROUTINE TO RELEASE MUST COMPLETE AND DEQ THE VTOC         05840000
* ON LAST VOLUME ALLOCATED.                                             05860000
*                                                                       05880000
         DEQ   (MJELNAME,MIELNAME,6,SYSTEMS),RMC=STEP,MF=(E,DEQAREA)    05900016
*                                                                       05920000
         NI    DSMADTB2,X'FF'-DSMVTOCR-DSMSMCE  RESET ENQ'ED SWS Y02144 05930002
         NI    TYPEFLG,X'7F'            CLEAR SMC INDICATOR             05940000
         BR    DRBAK                                                    05960000
*                                                                       05980000
* LINK TO DEQ ROUTINE TO DEQ THE VTOC ON LAST VOLUME ALLOCATED.         06000000
*                                                                       06020000
NOSMC    DEQ   (MJELNAME,MIELNAME,6,SYSTEMS),MF=(E,DEQAREA)             06040016
*                                                                       06050002
         NI    DSMADTB2,X'FF'-DSMVTOCR  RESET VTOC ENQ'ED SWITCH Y02144 06060002
         BR    DRBAK                    RETURN                   Y02080 06061002
*                                                                       06062002
* IF AN I/O ERROR OCCURRED, THIS SECTION ISSUES MESSAGE IEC603I.        06063002
*                                                                       06064002
FINAL2   EQU   *                        TEST FOR I/O ERROR       Y02080 06065002
         CH    RFIVE,IOCODE             TEST FOR I/O ERROR       Y02078 06066002
         BNE   RPSTEST                  BRANCH IF NO I/O ERROR   Y02078 06067002
         MVC   DSCBF1(MSGEND-ERRMSG),ERRMSG  MOVE IN MESSAGE     Y02078 06068002
         L     RUCB,DEB+UCBADDR         LOAD UCB ADDRESS         Y02078 06069002
         USING UCB,RUCB                 UCB ADDRESSABILITY       Y02078 06070002
         MVC   DSCBF1+UUU(L'UCBNAME),UCBNAME  MOVE IN EBCDIC UCB Y02078 06071002
*                                       CHANNEL/UNIT ADDRESS     Y02078 06072002
         MVC   DSCBF1+VOLSER(L'SRTEVOLI),SRTEVOLI  MOVE IN VOLID Y02078 06073002
         WTO   MF=(E,DSCBF1)            ISSUE ERROR MESSAGE      Y02078 06074002
*                                                                       06075002
RPSTEST  EQU   *                        TEST FOR RPS             Y02078 06076002
         TM    DSMADTB1,DSMRPSAP        TEST IF RPS APPENDAGE    YM3048X06078002
                                        IGG019EK WAS LOADED      YM3048 06080002
         BNO   CONTINUE                 BRANCH IF NOT            YM3048 06082002
         L     RONE,DEB+APDIS           POINT TO APPENDAGE TABLE S20201 06083020
         MVC   DEB+APDIS(FOURCH),AVTDS(RONE)  RESTORE AVT PTR    Y02080 06088002
         NI    DSMADTB1,X'FF'-DSMRPSAP  RESET RPS APP LOADED SW  Y02144 06093002
*                                                                       06099002
* THIS SECTION FREES THE WORK AREA AND RETURNS CONTROL TO SCHEDULER     06100000
*                                                                       06101002
CONTINUE EQU   *                                                 S20201 06110020
         LR    REIGHT,RFIVE             SAVE THE RETURN CODE     Y02080 06112002
         IECRES FREE,PREFIX=FIRST,A=(RWORK)  FREE WORK AREAS     Y02080 06120002
         USING CVT,RFTEN                CVT ADDRESSABILITY       Y02080 06122002
         L     RFTEN,CVTPTR             LOAD CVT ADDRESS         Y02080 06130002
         L     RETURN,CVTEXPRO          LOAD EXIT PROLOGUE ADDR  Y02080 06140002
         LR    RFTEN,REIGHT             RETURN CODE IN REG 15    Y02080 06160002
         RETURN ,                                                Y02080 06180002
*                                                                       06184002
* FOR EACH DD CARD CONCATENATED TO THE FIRST ISAM DATA SET DD CARD,     06188002
* THIS SECTION RESETS THE LAST SEVEN BYTES OF THE DDNAME TO BLANKS.     06192002
*                                                                       06196002
MISTAKE  EQU   *                        RESET INDICATORS IN TIOT Y02134 06200002
         L     RTHREE,ADSABLST          GET DSAB LIST ADDRESS    Y02134 06204002
RESETIOT EQU   *                                                 A40449 06208002
         L     RTWO,SCNDDSAB(RTHREE)    GET SECOND/THIRD DSAB    Y02134 06212002
         LTR   RTWO,RTWO                IS THERE ONE             Y02134 06216002
         BZ    FINAL                    BRANCH IF NOT            Y02134 06220002
         USING DSAB,RTWO                                         Y02134 06224002
         L     RTWO,DSABTIOT            GET TIOT ENTRY ADDRESS   Y02134 06228002
         MVC   ISAMSTAT(SEVEN,RTWO),BLANKS  BLANK OUT DDNAME     Y02134 06232002
         LA    RTHREE,FOUR(,RTHREE)     INCREMENT DSAB LIST PTR  Y02134 06236002
         B     RESETIOT                 GET THIRD DSAB           Y02134 06240002
*                                                                       06284002
* CONSTANTS                                                             06288019
*                                                                       06326000
IOCODE   DC    H'12'                    I/O ERROR CODE           O19117 06327000
NOSPACE  DC    H'20'                    NO SPACE ERROR CODE      A40449 06328000
ERRMSG   WTO   'IEC603I VTOC ERRORS MAY EXIST ON UUU,VOLSER,0',  Y02078X06331002
               ROUTCDE=(4,10),DESC=4,MF=L                        Y02078 06332002
MSGEND   EQU   *                        MSG DELIMITER            Y02078 06333002
BLANKS   DC    CL7' '                   SEVEN BLANKS             Y02134 06334002
         DS    0F                       FULLWORD BOUNDARY        Y02078 06336002
CHANNEL  EQU   *                                                        06344000
*CCW1                                                                   06352000
         DC    X'31'                         SEARCH ID EQUAL            06360000
         DC    AL3(0+VTOCADR-FIRST)                                     06380000
         DC    X'4000'                                                  06400000
         DC    H'5'                                                     06420000
*CCW2                                                                   06440000
         DC    X'08'                         TIC TO SEARCH ID EQUAL     06460000
         DC    AL3(0+CCW1-FIRST)                                        06480000
         DC    F'0'                                                     06500000
*CCW3                                                                   06520000
         DC    X'05'                         WRITE DATA                 06540000
         DC    AL3(0+IECSDSF4-FIRST)                                    06560000
         DC    X'4000'                                                  06580000
         DC    H'96'                                                    06600000
*CCW4                                                                   06620000
         DC    X'31'                         SEARCH ID EQUAL            06640000
         DC    AL3(0+VTOCADR-FIRST)                                     06660000
         DC    X'4000'                                                  06680000
         DC    H'5'                                                     06700000
*CCW5                                                                   06720000
         DC    X'08'                         TIC TO SEARCH ID RQUAL     06740000
         DC    AL3(0+CCW4-FIRST)                                        06760000
         DC    F'0'                                                     06780000
*CCW6                                                                   06800000
         DC    X'06'                         READ DATA                  06820000
         DC    AL3(0+IECSDSF4-FIRST)                                    06840000
         DC    X'1000'                                                  06860000
         DC    H'96'                                                    06880000
VTOCNAME DC    CL8'SYSVTOC '            MAJOR QUEUE NAME                06920000
*                                                                       06931002
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         06932002
*                                                                       06933002
         XCTLTABL ID=(MVOLMOD,I8),SVC=032,LENGTH=,BRT=YES        Y02080 06934002
         SPACE 2                                                 Y02134 06935002
         IECDSECS CVT,DSAB,UCB,EXPAND=YES  CVT, UCB, DSAB DSECTS Y02134 06937002
JFCBKEN  DSECT                                                          06940000
         IEFJFCBN                                                       06960000
         EJECT                                                   Y02080 06970002
DSCBWKAR IECALLWA EP,F4,D1=(1),D2=(5),ADT=YES ALLOCATE WORK AREA XM2969 06980002
DEQAREA  EQU   DS4IDFMT                 DEQ TABLE AREA                  08240000
MJELNAME EQU   DS4IDFMT+16              MAJOR RESOURCE NAME        AAAA 08260016
         END                                                            08400000
./  ADD  SSI=32510324,NAME=IGG032I8
 TITLE 'IGG032I8 - ISAM - NEW VOL DUPL NAME SEARCH'                     00020000
IGG032I8 CSECT                                                          00028000
*                                                                       00030002
*MODULE NAME = IGG032I8                                                 00030402
*                                                                       00030802
*DESCRIPTIVE NAME = ISAM - NEW VOL DUPL NAME SEARCH                     00031202
*                                                                       00031602
*COPYRIGHT = NONE                                                       00031702
*                                                                       00031802
*CHANGE ACTIVITY = SEE BELOW                                            00031902
*                                                                       00033902
*          VS2 RELEASE 01 DELETIONS                                     00038002
*0000                                                            YM2930 00040002
*                                                                       00042002
*          RELEASE 16 DELETIONS                                         00044002
*1463                                                              AAAA 00046002
*          RELEASE 17 DELETIONS                                         00048002
*          RELEASE 18 DELETIONS                                         00052000
*          RELEASE 19 DELETIONS                                         00060000
*0793041000,045600                                               O19117 00064019
*          RELEASE 20 DELETIONS                                         00068000
*          RELEASE 21 DELETIONS                                         00076000
*1231003000-003400,006000-006200,015200,016000-016600,029600-    A38860 00077021
*1231029800,036000-036200,038800,040200-040400,041140,041400,    A38860 00078021
*1231047400,048000,048800,049600-049800,050000,069800-070000,    A38860 00079021
*1231081800                                                      A38860 00080021
*          RELEASE 21.7 DELETIONS/CHANGES                               00081002
*0000040860-040880                                              SA53153 00081202
*0000064400-065000                                              SA48172 00082021
*          RELEASE 22 DELETIONS                                         00084000
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00088002
*0000000030-000150,000300,000348,000920-001000,002840,004400-    Y02080 00088102
*0000004600,005200,005800-005870,006600,016100-016400,022377-    Y02080 00088202
*0000022384,023200,025800,027400,028400,032100,033430-033820,    Y02080 00088302
*0000034200,034800,035800,036400,037080,037320,040400,040840,    Y02080 00088402
*0000040960-040980,041040,041080,041160-041200,046000-046800,    Y02080 00088502
*0000047200-047600,048000-048100,059000-059200,060800,062800,    Y02080 00088602
*0000065600,067400,069840-070080,070600-085320                   Y02080 00090002
*0000022307,022363,031000-032800,050200-050600,052000-052400     Y02134 00092002
*0000002000,004600,005200-005400,040940,041060,057200            Y02078 00094002
*0000000100,037100,037160-037308                                 Y02082 00096002
*0000                                                            Y02144 00098002
*                                                                       00100002
*STATUS CHANGE LEVEL 003                                                00110019
*FUNCTION - MULTI-VOLUME DATA SETS - THIS MODULE READS IN THE DSCB      00120000
*           FORMAT 4 DATA FIELD, THE FIRST DSCB FORMAT 5, AND PERFORMS  00140000
*           A DUPLICATE NAME SEARCH OF THE VTOC ON SUBSEQUENT VOLUMES.  00160000
*           IT ALSO READS IN THE DATA FIELD OF ANY DUPLICATE NAME       00180000
*           DSCB FOUND.  IF THE DIRF BIT IS SET IN THE FORMAT 4         00200002
*           DSCB, THIS MODULE ISSUES MESSAGE IEC602I WITH CODE=12       00205002
*           AND TERMINATES THE SPACE ALLOCATION.                        00210002
*                                                                       00220000
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG032I8.  ENTRY IS   00240000
*          FROM MODULE IGG032I7 ONLY.                                   00260000
*                                                                       00280000
*INPUT - AT ENTRY TO THIS MODULE, REGISTER 10 POINTS TO THE TIOT        00282021
*        ENTRY AND REGISTER 13 POINTS TO THE ALLOCATE WORK AREA.        00284002
*                                                                       00286021
*        IF MORE THAN ONE DD STATEMENT IS USED IN REQUESTING SPACE,     00288021
*        THE SEVEN LOW-ORDER BYTES OF THE DDNAME FIELD IN ALL BUT THE   00290021
*        FIRST ISAM DD ENTRY ARE USED TO CREATE THE FOLLOWING SPECIAL   00292021
*        ISAM ALLOCATE INTERFACE:                                       00294021
*                                                                       00296021
*              BYTE 1                                                   00298021
*                   BITS 0 AND 1   00 - ABSOLUTE TRACK REQUEST          00300021
*                                  01 - BLANK SPACE REQUEST             00302021
*                                  11 - CONTIGUOUS SPACE REQUEST        00304021
*                                                                       00306021
*                   BIT 2          THIS IS THE SECOND DD CARD.          00308021
*                                                                       00310021
*                   BIT 5          OVFLOW HAS BEEN ALLOCATED.           00312021
*                                                                       00314021
*                   BIT 6          PRIME HAS BEEN ALLOCATED.            00316021
*                                                                       00318021
*                   BIT 7          INDEX HAS BEEN ALLOCATED.            00320021
*                                                                       00322021
*              BYTES 2 - 3         CURRENT VOLUME SEQUENCE NUMBER       00324021
*                                  FOR SECOND OR THIRD DD CARD          00326021
*                                                                       00328021
*              BYTES 4 - 7         POINTER TO THE FIRST TIOT ENTRY      00330021
*                                  FOR THIS REQUEST                     00332021
*                                                                       00334021
*OUTPUT - UPON TRANSFERRING TO THE FIRST LOAD, IGG032I1, THE WORK       00336021
*         AREA WILL CONTAIN THE FORMAT 4 AND FIRST FORMAT 5 DSCB'S,     00338021
*         THE VTOCADR AND DADSMADR, AND THE ADDRESS AND DATA            00340021
*         PORTION OF ANY DUPLICATE NAME FORMAT 1 DSCB.                  00342021
*                                                                       00360000
*EXTERNAL ROUTINES - SVC'S ISSUED IN MACRO EXPANSIONS                   00380000
*   EXCP(0) READ FROM OR WRITE TO DIRECT ACCESS DEVICE                  00400000
*   WAIT(1) WAIT ON EVENT CONTROL BLOCK                                 00420000
*   OTHER SVCS ISSUED - RESERVE(56) ENQ THE VTOC                        00440002
*                     - WTO(35) WRITE MESSAGE TO OPERATOR               00460002
*                                                                       00470002
*   OTHER MACROS ISSUED - IEFJFCBN - BUILD JFCB                         00480000
*                       - IECALLWA - ALLOCATE WORK AREA                 00490002
*                       - IECSDSL1 - BUILD DSCBS                        00500000
*                       - IECDSECS - EXPAND CVT, RRPL, AND UCB DSECTS   00520002
*                                                                       00560000
*EXITS - NORMAL - BRANCH TO IGG032I1 IF MULTI-VOLUME                    00580002
*      - ERROR  - BRANCH TO IGG032I7 WITH ERROR CODE IN REGISTER 5      00587002
*                                                                       00594021
*        ERROR CODES THAT CAN BE ISSUED BY IGG032I8:                    00601021
*                                                                       00608021
*        04 - DUPLICATE NAME DSCB ON VOLUME                             00615021
*                                                                       00622021
*        0C - PERMANENT I/O ERROR                                       00629021
*                                                                       00630002
*        A0 - ISAM ALLOCATION TERMINATED DUE TO POSSIBLE VTOC ERRORS    00635002
*                                                                       00640000
*TABLES/WORK AREA - DADSM WORK AREA DESCRIBED BY MACRO IECALLWA         00660002
*                                                                       00680000
*              ***************************************                  00700000
*              *             DADSM TABLE             *                  00720000
*              ***************************************                  00740000
*                                                                       00760000
*              ***************************************                  00780000
*              *        *         *                  *                  00800000
*              *  TYPE  *  NO OF  *     USED HOLE    *                  00820000
*              *  FLAG  * ENTRIES *      COUNTER     *                  00840000
*              *        *         *                  *                  00860000
*              ***************************************                  00880000
*              *                  *                  *                  00900000
*              *       RTA        *      RTA+1       *                  00920000
*              *                  *                  *                  00940000
*              ***************************************                  00960000
*              *                  *                  *                  00980000
*              *       RTA        *      RTA+1       *                  01000000
*              *                  *                  *                  01020000
*              ***************************************                  01040000
*              *                  *                  *                  01060000
*              *       RTA        *      RTA+1       *                  01080000
*              *                  *                  *                  01100000
*              ***************************************                  01120000
*              *                  *                  *                  01140000
*              *       RTA        *      RTA+1       *                  01160000
*              *                  *                  *                  01180000
*              ***************************************                  01200000
*              *                  *                  *                  01220000
*              *       RTA        *      RTA+1       *                  01240000
*              *                  *                  *                  01260000
*              ***************************************                  01280000
*                                                                       01300000
*                                                                       01320000
*              TYPE FLAG = 02 - BPAM DIRECTORIES REQUESTED.             01340000
*                                                                       01360000
*                        = 40 - USER LABELS REQUESTED                   01364021
*                                                                       01368021
*                        = 80 - SET MUST COMPLETE IS ACTIVE             01372021
*                                                                       01376021
*                                                                       01380000
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.    01400000
*                                                                       01420000
*                                                                       01440000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.        01460000
*                                                                       01480000
*                                                                       01500000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT. 01520021
*                                                                       01540000
*ATTRIBUTES - REENTRANT, TRANSIENT                                      01560000
*                                                                       01580000
*STORAGE - PROGRAM CODE CSECT = LESS THAN 1024 BYTES                    01610002
*          WORK AREA = AS DEFINED IN THE IECALLWA MACRO                 01640002
*          RPS WORK AREA = AS DEFINED IN THE IECRPS MACRO               01650002
*                                                                       01680000
*REGISTER USAGE                                                         01700000
*              REGISTERS 0-9 WORK REGISTERS                             01720000
*              REGISTER 10 - TIOT SET UP TABLE POINTER                  01740000
*              REGISTER 11 - JFCB POINTER                               01760000
*              REGISTER 12 - BASE REGISTER                              01780000
*              REGISTER 13 - WORK AREA POINTER                          01800000
*              REGISTER 14 - SUBROUTINE LINKAGE AND WORK REGISTER       01820000
*              REGISTER 15 - WORK REGISTER AND ERROR CODE REGISTER      01840000
*                                                                       01860000
***** REGISTER NAMES *****                                              01880000
RZERO    EQU   0                                                        01900000
RONE     EQU   1                                                        01920000
RTWO     EQU   2                                                        01940000
RTHREE   EQU   3                                                        01960000
RFOUR    EQU   4                                                        01980000
RFIVE    EQU   5                                                        02000000
RSIX     EQU   6                                                        02020000
RSEVEN   EQU   7                                                        02040000
REIGHT   EQU   8                                                        02060000
RNINE    EQU   9                                                        02080000
DRBAK    EQU   9                                                        02100000
RTEN     EQU   10                                                       02120000
RJFCB    EQU   11                                                       02140000
RBASE    EQU   12                                                       02160000
RWORK    EQU   13                                                       02180000
RETURN   EQU   14                                                       02200000
RFTEN    EQU   15                                                       02220000
*                                                                       02222021
* OTHER EQUATES                                                         02224021
*                                                                       02226021
TWO      EQU   2                        CONSTANT OF TWO          Y02080 02226402
K4       EQU   4                        CONSTANT OF FOUR        SA53153 02226602
EIGHT    EQU   8                        CONSTANT OF EIGHT        Y02080 02226802
K12      EQU   12                       CONSTANT OF TWELVE       Y02080 02227002
UNCHAIN  EQU   X'00'                    NO COMMAND CHAINING      Y02080 02227502
WRDATA   EQU   X'05'                    WRITE DATA COMMAND       Y02080 02228002
RDDATA   EQU   X'06'                    READ DATA COMMAND        Y02080 02228502
SKIP     EQU   X'10'                    SUPPRESS DATA TRANSFER   Y02080 02229002
CHAIN    EQU   X'40'                    COMMAND CHAINING BIT     Y02080 02229502
DIRFBIT  EQU   X'04'                    VTOC INTERRUPT BIT       O19117 02230019
TIOEVOLS EQU   2                        OFFSET TO NBR OF DEVICES A38860 02231421
TIOEDDNM EQU   4                        OFFSET TO DDNAME         A38860 02232121
ISAMSTAT EQU   5                        OFFSET TO ALLOCATION     A38860 02232821
*                                       STATUS                   A38860 02233521
VOLSQCTR EQU   6                        OFFSET TO DS1VOLSQ CTR   A38860 02234221
TIOTPTR  EQU   8                        OFFSET TO 1ST ENTRY PTR  A38860 02234921
UCBENTRY EQU   16                       OFFSET TO 1ST UCB ENTRY  A38860 02235621
BLANK    EQU   X'40'                    EBCDIC BLANK             A38860 02237021
CSWAD    EQU   8                        CSW OFFSET IN IOB       SA53153 02237202
UCBADDR  EQU   32                       DISP. TO UCB ADDR IN DEB Y02078 02237502
UUU      EQU   34                       DISP. TO UUU IN MESSAGE  Y02078 02238002
VOLSER   EQU   38                       DISP. TO VOLSER IN MSG   Y02078 02238502
DIRFERR  EQU   X'A0'                    DIRF BIT SET ERROR CODE  Y02078 02239002
*                                                                       02240000
         BALR  RBASE,0                                                  02280000
         USING RELOCCP,RBASE                                            02300000
         USING ALLOCWKA,RWORK           WORK AREA ADDRESSABILITY Y02080 02320002
         USING JFCBKEN,RJFCB                                            02340000
*                                                                       02360000
* THIS SECTION RELOCATES THE CHANNEL PROGRAM FOR READING IN THE DSCB    02380000
* FORMAT 4, THE FIRST DSCB FORMAT 5, AND THE DUPLICATE NAME SEARCH OF   02400000
* THE VTOC ON THE NEXT VOLUME.                                          02420000
*                                                                       02440000
RELOCCP  LM    RZERO,RNINE,CHANPROG     LOAD THE FIRST FIVE CCWS        02460000
         ALR   RZERO,RWORK              ADD RELOCATION ADDRESS          02480000
         ALR   RTWO,RWORK                                               02500000
         ALR   RFOUR,RWORK                                              02520000
         ALR   RSIX,RWORK                                               02540000
         ALR   REIGHT,RWORK                                             02560000
         STM   RZERO,RNINE,CCW1         STORE THE 1ST FIVE CCWS  Y02080 02580002
         LM    RZERO,RNINE,CHANPROG+40  LOAD THE NEXT FIVE CCWS         02600000
         LA    RFTEN,0(RJFCB)                                           02620000
         ALR   RZERO,RWORK              ADD RELOCATION ADDRESS          02640000
         ALR   RTWO,RFTEN               ADD JFCB ADDRESS                02660000
         ALR   RFOUR,RWORK              ADD RELOCATION ADDRESS          02680000
         ALR   RSIX,RWORK                                               02700000
         ALR   REIGHT,RFTEN             ADD JFCB ADDRESS                02720000
         STM   RZERO,RNINE,CCW6         STORE SECOND FIVE CCWS   Y02080 02740002
         LM    RZERO,RFIVE,CHANPROG+80  LOAD LAST THREE CCWS            02760000
         ALR   RZERO,RWORK              ADD RELOCATION ADDRESS          02780000
         ALR   RTWO,RWORK                                               02800000
         ALR   RFOUR,RWORK                                              02820000
         STM   RZERO,RFIVE,CCW11        STORE LAST THREE CCWS    Y02080 02840002
*                                                                       02860000
* THIS SECTION UPDATES THE UCB POINTER IN THE DEB.                      02880000
*                                                                       02900000
         L     RSIX,CVTPTR              PICK UP THE CVT POINTER         02920000
         USING CVT,RSIX                                                 02940000
         LA    RTWO,UCBENTRY(,RTEN)     POINT TO 1ST UCB ENTRY   A38860 02970021
         SR    RFIVE,RFIVE                                              03000000
         IC    RFIVE,CTR                PICK UP UCB COUNTER AND         03020000
         SLL   RFIVE,2                     MULTIPLY TIMES FOUR TO       03040000
         AR    RTWO,RFIVE                  CALCULATE ADDRESS OF THIS    03060000
*                                          UCB ENTRY IN TIOT            03080000
         L     RTEN,0(,RTWO)            GET UCB ADDRESS          Y02134 03100002
         LA    RTEN,0(,RTEN)            CLEAR HIGH BYTE          Y02134 03150002
         USING UCB,RTEN                                                 03300000
         L     RFTEN,CVTPCNVT           CONVERT ROUTINE ADDRESS         03320000
         LA    RONE,DEB                 R1 = DEB ADDRESS                03340000
MAINUCB  ST    RTEN,DEB+32              STORE MAIN UCB PTR IN DEB       03385013
         L     RZERO,SRTEFSCT           PICK UP THE VTOC TTR0           03388013
         MVC   MIELNAME(6),SRTEVOLI     SAVE VOLUME SERIAL NUMBER  AAAA 03389016
ZEROCLR  IC    RZERO,ZEROS              CLEAR LOW ORDER BYTE            03391013
         MVI   DEB+32,X'C0'             RESTORE DEVICE MODE             03394013
         LA    RTWO,SEEK                R2 = ADDRESS OF RESULTS         03400000
         STM   RJFCB,RFTEN,IECREGSV+K12  SAVE REGISTERS          Y02080 03420002
         LR    RTHREE,RWORK             SAVE WORK AREA POINTER          03440000
         BALR  RETURN,RFTEN             GO TO THE CONVERT ROUTINE       03460000
         LM    RJFCB,RFTEN,IECREGSV+K12-FIRST(RTHREE)            Y02080 03480002
*                                       REESTABLISH WORK AREA ADDRESS   03500000
         DROP  RSIX                                                     03520000
         DROP  RTEN                                                     03540000
         MVC   VTOCADR(5),SEEK+3        PICK UP VTOC AND FIRST DADSM    03560000
         LA    RTWO,CCW1                PICK UP 1ST CCW ADDRESS  Y02080 03580002
         ST    RTWO,IOB+16              SET UP ADDR OF FIRST CCW A38860 03610021
         SR    RONE,RONE                ZERO REGISTER            Y02080 03620002
         STH   RONE,ENQAREA+TWO         CLEAR FOR RESERVE MACRO  Y02080 03630002
*                                                                       03660000
* LINK TO THE ENQ ROUTINE TO ENQ THE VTOC ON THE NEXT VOLUME.           03680000
*                                                                       03700000
       RESERVE (MJELNAME,MIELNAME,E,6,SYSTEMS),MF=(E,ENQAREA),   YM3022X03716002
               UCB=DEB+32                                               03724016
*                                                                       03726002
         OI    DSMADTB2,DSMVTOCR        SET VTOC ENQ'ED SWITCH   Y02144 03728002
         L     RONE,IECRRPRM            RECOVERY RTN LIST ADDR   Y02144 03730002
         USING RRPLIST,RONE             PARM LIST ADDRESSABILITY Y02144 03732002
         ST    RTEN,RRUCBPTR            SAVE UCB ADDRESS         Y02144 03734002
         DROP  RONE                                              Y02144 03736002
*                                                                       03740000
         XC    DSCBF1,DSCBF1            ZERO FORMAT 1 DSCB AREA  Y02080 03750002
         LA    RETURN,CHECK             SET UP RETURN ADDRESS           03760000
*                                                                       03780000
* EXECUTE THE CHANNEL PROGRAM TO READ IN THE DATA PORTION OF A FORMAT 4 03800000
* , THE FIRST FORMAT 5, TO PERFORM A DUPLICATE NAME SEARCH, AND TO      03820000
* READ IN THE DATA PORTION OF ANY DUPLICATE NAME DSCB FORMAT 1.         03840000
*                                                                       03860000
EXECUTET EQU   *                                                 A38860 03870021
         MVI   ECB,X'00'                CLEAR ECB                A38860 03880021
         EXCP  IOB                                                      03900000
         WAIT  1,ECB=ECB                                                03920000
         TM    ECB,X'20'                CHECK FOR SUCCESSFUL COMPLETION 03940000
         BCR   7,RETURN                 BRANCH IF COMPLETION SUCCESSFUL 03960000
PERMERR  EQU   *                                                SA53153 03970002
         LA    RFIVE,12                 SET ERROR CODE FOR PERMANENT    03980000
*                                          I/O ERROR                    04000000
ERRXCTL  EQU   *                                                 A38860 04020021
         LA    RTWO,ERRORLD             POINT TO ID OF IGG032I7  Y02080 04030002
         B     LEAVE                                                    04060000
*                                                                       04080000
CHECK    EQU   *                                                 O19117 04082019
         TM    CCW3+K4,CHAIN+SKIP       LAST I/O WAS FOR         Y02080 04084002
         BZ    WRDONE                   REWRITE OF F4 DSCB      SA53153 04085002
         MVC   CCW9+K4(K4),IOB+CSWAD    SAVE CSW COMMAND ADDR   SA53153 04086002
         BO    CHK2                     BRANCH IF LAST I/O WAS  SA53153 04087002
*                                       FOR DUP DUP NAME SEARCH SA53153 04088002
         XI    DS4VTOCI,DIRFBIT         SET/TEST DIRF BIT        O19117 04090019
         TM    DS4VTOCI,DIRFBIT         TEST RESULTS             O19117 04092019
         BZ    ISSUEMSG                 BRANCH IF DIRF BIT       Y02078 04094002
*                                       WAS PREVIOUSLY SET       Y02078 04095002
         MVI   CCW3,WRDATA              SET WRITE DATA CMMD      Y02080 04096002
         MVI   CCW3+K4,UNCHAIN          RESET CMMD CHAINING      Y02080 04098002
         B     EXECUTET                 GO WRITE BACK F4         O19117 04100019
WRDONE   EQU   *                                                 O19117 04102019
         MVI   CCW3,RDDATA              RESTORE READ DATA CMMD   Y02080 04104002
         MVI   CCW3+K4,CHAIN+SKIP       SET SKIP FLAG TO PREVENT Y02080 04108002
*                                       REREAD OF F4                    04110019
CHK2     EQU   *                                                 O19117 04112019
         L     RTEN,ATIOTPTR            LOAD PTR TO DD ENTRY     Y02080 04120002
         L     RTWO,CCW9+K4             GET CSW COMMAND ADDRESS SA53153 04125002
         LA    RTWO,0(RTWO)             CLEAR HIGH BYTE         SA53153 04130002
         LA    RTHREE,CCW9              GET CCW9 ADDRESS        SA53153 04135002
         XR    RONE,RONE                PREPARE TO RESTORE CCW9 SA53153 04140002
         ST    RONE,CCW9+K4             TO ITS ORIGINAL STATUS  SA53153 04145002
         CLR   RTWO,RTHREE              TEST IF DSNAME FOUND    SA53153 04150002
         BE    NODSNAME                 BRANCH IF NOT FOUND     SA53153 04155002
         CLI   F5OUT,X'F1'              CHECK FOR A FORMAT IDENTIFIER   04160000
*                                          FOR A FORMAT 1 DSCB          04180000
         BE    SAMENAME                 BRANCH IF A DUPLICATE NAME      04200000
*                                          DSCB FORMAT 1 HAS BEEN READ  04220000
         B     PERMERR                  BAD VTOC EXIT           SA53153 04230002
*                                                                       04240000
* THIS SECTION TESTS FOR BOS PACK AND SETS THE HIGH WATER MARK TO THE   04260000
* END OF THE CYLINDER FOR DUPLICATE NAME SEARCH.                        04280000
*                                                                       04300000
NODSNAME EQU   *                                                SA53153 04310002
         TM    DS4VTOCI,X'80'           CHECK FOR A SPECIAL TYPE OF     04320000
*                                          VOLUME                       04340000
         BC    8,NOTBOS                 BRANCH IF NOT A SPECIAL VOLUME  04360000
         CLC   DS4HPCHR(4),DS4VTOCE+6   CHECK HI WATER MARK BEING       04380000
*                                          UPDATED                      04400000
         BH    UPDATE                   BRANCH IF NOT UPDATED           04420000
         CLC   DS4HPCHR+4(1),DS4DEVDT   CHECK FOR HI WATER MARK BEING   04440000
*                                          COMPLETELY UPDATED           04460000
         BNH   NOTBOS                   BRANCH IF UPDATED               04480000
UPDATE   MVC   DS4HPCHR(4),DS4VTOCE+6   UPDATE HI WATER MARK TO POINT   04500000
         MVC   DS4HPCHR+4(1),DS4DEVDT      TO THE LAST RECORD,TRACK     04520000
*                                          AND CYLINDER OF THE VTOC     04540000
         B     EXECUTET                                                 04580000
NOTBOS   EQU   *                        BRANCH LABEL             Y02080 04590002
         MVC   DADSMADR,DSCBF5-EIGHT    SET UP F5 ADDRESS        Y02080 04600002
         MVC   CCW1(96),F5OUT           PICK UP F1 DATA IF SUCH AN F1   04700000
*                                       EXISTS AND REALIGN IT    Y02080 04710002
         MVC   DS1FMTID(DS1END-DS1FMTID),CCW1  REALIGN F1 DSCB   Y02080 04720002
         LA    RTWO,FIRSTLD             POINT TO ID OF IGG032I1  Y02080 04740002
*                                                                       04780000
LEAVE    EQU   *                                                 A38860 04790021
         IECRES LOAD,EXTPR=(RWORK),MODID=(RTWO),BRANCH=DIRECT    Y02080 04800002
*                                                                       04820000
* THIS SECTION EXAMINES THE LEGITMACY OF A DUPLICATE NAME FORMAT 1      04840000
*                                                                       04860000
SAMENAME EQU   *                                                 A38860 04870021
         CLI   TIOEDDNM(RTEN),BLANK     CHECK DDNAME IN TIOT     A38860 04880021
         BNE   DUPLNAME                 BRANCH IF THIS IS THE FIRST DD  04900000
*                                          ENTRY - ILLEGAL DUPLICATE    04920000
*                                          NAME DSCB FORMAT 1           04940000
         L     RNINE,TIOTPTR(,RTEN)     GET ADDR OF 1ST ENTRY    A38860 04970021
         L     RSIX,UCBENTRY(,RNINE)    PICK UP UCB ADDRESS      Y02134 05020002
         LA    RSIX,0(,RSIX)            CLEAR HIGH BYTE          Y02134 05070002
         SR    RFIVE,RFIVE                                              05080000
         IC    RFIVE,CTR                CALCULATE WHICH VOLUME DUPLI-   05100000
         SLL   RFIVE,2                     CATE NAME WAS FOUND ON       05120000
         AR    RFIVE,RTEN                                               05140000
         LA    RSEVEN,16                INCREMENT TO FIRST UCB          05160000
         AR    RFIVE,RSEVEN             PICK UP UCB ENTRY IN SECOND     05180000
         L     RSEVEN,0(,RFIVE)         GET UCB ADDRESS          Y02134 05200002
         LA    RSEVEN,0(,RSEVEN)        CLEAR HIGH BYTE          Y02134 05250002
         CR    RSIX,RSEVEN              COMPARE UCB POINTERS IN TIOT    05260000
         BNE   DUPLNAME                 BRANCH IF POINTERS AREN'T THE   05280000
*                                          SAME-ILLEGAL DUPLICATE NAME  05300000
*                                          FORMAT 1 DSCB                05320000
*                                                                       05340000
* THIS SECTION TAKES THE CCHHR OF THE RECORD BEYOND THE DUPLICATE NAME  05360000
* FORMAT 1 DSCB AND CALCULATES THE ADDRESS OF THIS FORMAT 1             05380000
*                                                                       05400000
         SR    RETURN,RETURN            REDUCE THE RECORD NUMBER BY ONE 05420000
         IC    RETURN,COUNT+4                                           05440000
         BCT   RETURN,ADJUST            CHECK FOR RECORD NUMBER ZERO -  05460000
*                                       BACKING OVER A TRACK BOUNDRY    05480000
*                                       BRANCH IF RECORD NUMBER NOT     05500000
*                                          ZERO                         05520000
         IC    RETURN,DS4DEVDT          SET RECORD NUMBER TO MAXIMUM    05540000
*                                          NUMBER OF DSCB'S PER TRACK   05560000
ADJUST   STC   RETURN,COUNT+4                                           05580000
         MVC   SAVEADR(5),COUNT         SAVE THE ADDR OF THE FORMAT 1   05600000
         B     NOTBOS                                                   05620000
DUPLNAME LA    RFIVE,4                  SET UP ERROR CODE FOR ILLEGAL   05640000
*                                          DUPLICATE NAME DSCB FORMAT 1 05660000
         B     ERRXCTL                                                  05680000
*                                                                       05681002
* IF THE DIRF BIT WAS PREVIOUSLY SET IN THE FORMAT 4 DSCB, THIS         05682002
* SECTION ISSUES MESSAGE IEC602I WITH CODE=12.                          05683002
*                                                                       05684002
ISSUEMSG EQU   *                        BRANCH LABEL             Y02078 05685002
         MVC   DSCBF1(MSGEND-ERRMSG),ERRMSG  MOVE IN MESSAGE     Y02078 05686002
         L     RTEN,DEB+UCBADDR         LOAD UCB ADDRESS         Y02078 05687002
         USING UCB,RTEN                 UCB ADDRESSABILITY       Y02078 05688002
         MVC   DSCBF1+UUU(L'UCBNAME),UCBNAME  MOVE IN EBCDIC UCB Y02078 05689002
*                                       CHANNEL/UNIT ADDRESS     Y02078 05690002
         MVC   DSCBF1+VOLSER(L'SRTEVOLI),SRTEVOLI  MOVE IN VOLID Y02078 05691002
         WTO   MF=(E,DSCBF1)            ISSUE ERROR MESSAGE      Y02078 05692002
         LA    RFIVE,DIRFERR            LOAD ERROR CODE          Y02078 05693002
         B     ERRXCTL                  GO BRANCH TO IGG032I7    Y02078 05694002
*                                                                       05700000
* CHANNEL PROGRAM                                                       05706021
*                                                                       05712021
         DS    0F                       FULLWORD BOUNDARY        Y02078 05720002
CHANPROG EQU   *                                                        05740000
*CCW1                                                                   05760000
         DC    X'31'                    SEARCH EQUAL ID FOR VTOC DSCB   05780000
         DC    AL3(0+VTOCADR-FIRST)                                     05800000
         DC    X'4000'                                                  05820000
         DC    H'5'                                                     05840000
*CCW2                                                                   05860000
         DC    X'08'                    TIC BACK TO SEARCH              05880000
         DC    AL3(0+CCW1-FIRST)        TIC TO CCW1              Y02080 05900002
ZEROS    DC    F'0'                     FULLWORD OF ZEROS        Y02080 05920002
*CCW3                                                                   05940000
         DC    X'06'                    READ DATA FOR VTOC DSCB         05960000
         DC    AL3(0+DS4IDFMT-FIRST)                                    05980000
         DC    X'4000'                                                  06000000
         DC    H'96'                                                    06020000
*CCW4                                                                   06040000
         DC    X'9E'                    READ KEY AND DATA FOR F5        06060000
         DC    AL3(DSCBF5-8-FIRST)      BUFFER ADDR              Y02080 06080002
         DC    X'4000'                                                  06100000
         DC    H'148'                                                   06120000
*CCW5                                                                   06140000
         DC    X'F1'                    SEARCH FOR LAST F1 DSCB         06160000
         DC    AL3(0+DS4HPCHR-FIRST)                                    06180000
         DC    X'4000'                                                  06200000
         DC    H'5'                                                     06220000
*CCW6                                                                   06240000
         DC    X'08'                    TIC TO SEARCH NAME EQUAL        06260000
         DC    AL3(0+CCW10-FIRST)       TIC TO CCW10             Y02080 06280002
         DC    F'0'                                                     06300000
*CCW7                                                                   06320000
         DC    X'A9'                    SEARCH NAME EQUAL ON LAST F1    06340000
         DC    AL3(000000)                 THIS ADDRESS MUST BE ALTERED 06360000
         DC    X'6000'                                                  06380000
         DC    H'44'                                                    06400000
*CCW8                                                                   06420000
         DC    X'06'                    READ DATA OF THE LAST   SA48172 06440021
         DC    AL3(0+F5OUT-FIRST)       FORMAT 1 WITH THE SKIP  SA48172 06460021
         DC    X'3000'                  BIT SET IN ORDER TO END SA48172 06480021
         DC    H'96'                    THE CHANNEL PROGRAM     SA48172 06500021
*CCW9                                                                   06520000
         DC    X'08'                    TIC TO READ DATA OF DUP NAME    06540000
         DC    AL3(0+CCW12-FIRST)       TIC TO CCW12             Y02080 06560002
         DC    F'0'                                                     06580000
*CCW10                                                                  06600000
         DC    X'A9'                    SEARCH NAME EQUAL NOT LAST F1   06620000
         DC    AL3(000000)                 THIS ADDRESS MUST BE ALTERED 06640000
         DC    X'6000'                                                  06660000
         DC    H'44'                                                    06680000
*CCW11                                                                  06700000
         DC    X'08'                    TIC BACK TO SEARCH LAST F1      06720000
         DC    AL3(0+CCW5-FIRST)        TIC TO CCW5              Y02080 06740002
         DC    F'0'                                                     06760000
*CCW12                                                                  06780000
         DC    X'06'                    READ DATA OF DUP NAME DSCB      06800000
         DC    AL3(0+F5OUT-FIRST)                                       06820000
         DC    X'4000'                                                  06840000
         DC    H'96'                                                    06860000
*CCW13                                                                  06880000
         DC    X'12'                    READ COUNT OF NEXT DSCB FOR ID  06900000
         DC    AL3(0+COUNT-FIRST)                                       06920000
         DC    X'2000'                                                  06940000
         DC    H'5'                                                     06960000
*                                                                       06966021
* CONSTANTS                                                             06972021
*                                                                       06978021
ERRMSG   WTO   'IEC602I VTOC NOT CONVERTED ON UUU,VOLSER,12',    Y02078X06978502
               ROUTCDE=(4,10),DESC=4,MF=L                        Y02078 06979002
MSGEND   EQU   *                        MSG DELIMITER            Y02078 06979502
*                                                                       06980002
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         06982002
*                                                                       06984002
         XCTLTABL ID=(FIRSTLD,I1,ERRORLD,I7),SVC=032,LENGTH=,    Y02080X06986002
               BRT=YES                                           Y02080 06988002
         SPACE 2                                                 Y02080 06990002
         IECDSECS CVT,RRPL,UCB,EXPAND=YES                        Y02144 07000002
JFCBKEN  DSECT                                                          07020000
         IEFJFCBN                                                       07040000
         EJECT                                                   Y02080 07050002
DSCBWKAR IECALLWA EP,F4,D1=(1),ADT=YES  ALLOCATE WORK AREA       Y02144 07060002
ENQAREA  EQU   ADSCBF4                  ENQ (RESERVE) PARM LIST  Y02080 07070002
MJELNAME EQU   ENQAREA+16               MAJOR ELEMENT NAME       Y02080 07080002
         END                                                            08540000
./  ADD  SSI=32510325,NAME=IGG0325A
     TITLE 'IGG0325A - DADSM - HOUSEKEEPING && DUPLICATE NAME SEARCH'   00008021
IGG0325A CSECT                                                          00016020
*                                                                       00018002
*MODULE NAME = IGG0325A                                                 00018102
*                                                                       00018202
*DESCRIPTIVE NAME = DADSM - HOUSEKEEPING & DUPLICATE NAME SEARCH        00018302
*                                                                       00019402
*COPYRIGHT = NONE                                                       00021402
*                                                                       00021802
*CHANGE ACTIVITY = SEE BELOW                                            00022202
*                                                                       00022602
*          VS2 RELEASE 01 DELETIONS                                     00023002
*0000                                                            YM2930 00024102
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00025202
*0000000180,000220,000570,009200-009400,012800-013200,013600-    Y02080 00026302
*0000013900,016320-016400,016800,025000,032000,033600-034000,    Y02080 00027402
*0000035300,036200,040200,041880,041912,041920,049400-051200,    Y02080 00028502
*0000052030-052090,052120-052400,053800,061080,061320,064442-    Y02080 00029602
*0000064450,064463-064481,064571-064580,065000,067800,072000-    Y02080 00030702
*0000073000,073400-076720,082300,082780-083200,083300-084200,    Y02080 00031802
*0000089800-090200,090600-091600,092200-096000,099000,102000-    Y02080 00032902
*0000103400,104200,104400,107600,109810-134600                   Y02080 00034002
*0000010600-010800,049400-051200                                 Y02132 00035102
*0000003300,032600-032800,064481,064487,064553-064562,064750     Y02078 00036202
*0000000010-000050,061100,061240-061304                          Y02082 00037302
*0000                                                            Y02144 00038402
*0000                                                            Y02072 00039502
*          RELEASE 20 DELETIONS                                         00040602
*                                                                S20201 00041702
*          RELEASE 21 DELETIONS                                         00042802
*1192                                                            A37199 00043902
*1192033800,038600,039000-039100,040200,065600                   A40967 00045002
*1192006500-006600,006700-006800,007200-007300,011000-011200,    A42477 00046102
*1192033200-033400,034000,074600-074800,084200,113600            A42477 00047202
*1192                                                            M0123  00048302
*0000000080,007100,011400,016100,034300,064427-064436,064448-    A46776 00049402
*0000064451,065420-065440,065580,065660,065700-065720,072200,    A46776 00050502
*0000073000-073350,077400-077700,078200,082400-082600,082720-    A46776 00051602
*0000082760,083400,085200,085600,087000-089200,103700,104300-    A46776 00052702
*0000105700,109400-109800                                        A46776 00053802
*1192003000-005600,006100-006300,007000-007100,013600-013800,    S21016 00054902
*1192014200,016200-016400,024600,025200-031800,033800,063400-    S21016 00056002
*1192064400,064445-064454,064600-064800,082400,104850-104950     S21016 00057102
*          RELEASE 21.7 DELETIONS                                       00058202
*0000099200                                                     SA48172 00059302
*0000006900,047060,052010-052020,063200-064000,064409-064437,   SA56426 00060402
*0000064457,064472,064508-064517,064582-064589                  SA56426 00061502
*0000006160-006320,007500-007600,083400-084000,102000-103000    SA53147 00062602
*0000065760-065800                                              SA53153 00063702
*          RELEASE 22 DELETIONS                                         00064802
*                                                                       00065902
*STATUS CHANGE LEVEL 002                                                00067021
*FUNCTION  THIS MODULE LINKS TO THE RESIDENT DIRECT ACCESS            * 00077420
*   CONVERSION ROUTINE TO CONVERT THE 'TTR0' OF THE VTOC TO  ABSOLUTE * 00120020
*   ADDRESS.  IT LINKS TO THE ENQ ROUTINE TO ENQUE THE VTOC ON THIS   * 00140020
*   VOLUME.  IT INITIALIZES AND RELOCATES TO THE WORK AREA A CHANNEL  * 00160020
*   PROGRAM TO PERFORM THE FOLLOWING OPERATIONS.  READ IN THE DATA    * 00180020
*   PORTION OF THE FORMAT 4 DSCB, READ IN COUNT/KEY/DATA OF THE FIRST * 00200020
*   FORMAT 5 DSCB, AND PERFORM A DUPLICATE NAME SEARCH OF THE FORMAT 1* 00220020
*   DSCB'S IN THE VTOC.  IF A DUPLICATE NAME FORMAT 1 DSCB IS FOUND   * 00240020
*   IT READS THE DATA PORTION OF THE DUPLICATE NAME FORMAT 1 DSCB AND * 00260020
*   THE COUNT OF THE NEXT RECORD.  THIS MODULE TESTS THE FORMAT 4 DSCB* 00280020
*   TO DETERMINE IF THE DOS OR DIRF BIT IS SET.  IF SO, IT BRANCHES TO* 00330002
*   IGG0325Z, THE FIRST LOAD OF THE DOS/OS VTOC CONVERSION ROUTINE,   * 00380021
*   IN ORDER TO BUILD VALID FORMAT 5 AND FORMAT 6 DSCB'S. AFTER       * 00430021
*   REENTRY FROM THE DOS/OS VTOC CONVERSION ROUTINE, THE DUPLICATE    * 00480021
*   NAME SEARCH IS REINITIATED.                                       * 00530021
*                                                                     * 00580020
*ENTRY POINTS:                                                        * 00600020
*        IGG0325A - ENTRY IS MADE FROM IGC0003B (SPACE ALLOCATION     * 00608021
*        INITIAL LOAD) OR REENTRY FROM IGG0325T (THE LAST LOAD OF     * 00616002
*        THE VTOC CONVERSION ROUTINES) TO CONTINUE ALLOCATION OF      * 00624002
*        SPACE ON A DIRECT ACCESS VOLUME.                             * 00632002
*                                                                     * 00640020
*INPUT:                                                               * 00650021
*        REGISTER 4 HAS AN ENTRY INDICATOR: IF ZERO, IT INDICATES     * 00663021
*        REENTRY FROM THE DOS/OS VTOC CONVERSION ROUTINE MODULES.     * 00666021
*        REGISTER 7 POINTS TO THE UCB, IF ENTERED FROM IGC0003B.      * 00690021
*        REGISTER 11 WILL POINT TO THE JFCB OR PARTIAL DSCB.          * 00710021
*        REGISTER 13 WILL POINT TO ALLOCATE'S WORK AREA.              * 00740020
*                                                                     * 00900020
*OUTPUT: WHEN A NON ERROR TRANSFER IS MADE TO ANOTHER MODULE,         * 00920002
*   THE WORK AREA WILL CONTAIN THE DATA PORTION OF THE FORMAT 4       * 00940002
*   DSCB, THE KEY AND DATA OF THE FIRST FORMAT 5 DSCB, AND THE        * 00960020
*   ABSOLUTE ADDRESS OF THE FORMAT 4 AND FORMAT 5 DSCB'S.  IF A       * 00980020
*   DUPLICATE NAME FORMAT 1 DSCB WAS FOUND THE WORK AREA WILL ALSO    * 01000020
*   CONTAIN THE DATA PORTION OF THE DUPLICATE NAME FORMAT 1 DSCB AND  * 01020020
*   THE COUNT OF THE NEXT RECORD.                                     * 01040020
*   REGISTER 11 WILL POINT TO THE JFCB OR PARTIAL DSCB.               * 01140021
*   REGISTER 13 WILL POINT TO THE WORK AREA.                          * 01160020
*                                                                     * 01180020
*EXTERNAL ROUTINES:                                                   * 01200020
*        CVTPCNVT - TTR CONVERSION ROUTINE                            * 01220020
*        EXCP(0) - READ FROM OR WRITE TO DIRECT ACCESS DEVICE         * 01240020
*        WAIT(1) - WAIT ON EVENT CONTROL BLOCK                        * 01260020
*        RESERVE(56) - ENQUEUE THE VTOC                               * 01320002
*                                                                     * 01340020
*EXITS:                                                               * 01350021
*   NORMAL - BRANCH TO IGG0325B FOR NON-ISAM SPACE ALLOCATION         * 01360002
*            BRANCH TO IGG0325Z FOR DOS/OS VTOC CONVERSION            * 01370002
*            BRANCH TO IGG032I1 FOR ISAM ALLOCATION                   * 01380002
*   ERROR  - BRANCH TO IGG0325H WITH CODE IN ERROR CODE PASS REGISTER * 01390002
*                                                                     * 01400020
*   ERROR CODES THAT CAN BE ISSUED BY THIS MODULE:                    * 01420021
*                                                                     * 01440020
*   04 - DSNAME OF REQUEST ALREADY EXISTS ON THIS VOLUME - INITIAL    * 01460020
*   ALLOCATION NOT POSSIBLE UNDER THE NAME GIVEN                      * 01480020
*                                                                     * 01500020
*   0C - PERMANENT I/O ERROR                                          * 01520020
*                                                                     * 01540020
*   18 - AVERAGE RECORD LENGTH SPECIFIED IN REQUEST IS GREATER THAN   * 01560020
*   65,535 BYTES IN LENGTH                                            * 01580020
*                                                                     * 01600020
*   34 - INVALID JFCB OR PARTIAL DSCB POINTER                         * 01610021
*                                                                     * 01620021
*   40 - INVALID USER LABEL REQUEST                                   * 01630021
*                                                                     * 01650021
*   A4 - ALLOCATION TERMINATED DUE TO DOS STACKED PACK FORMAT         * 01653002
*                                                                     * 01656002
*                                                                     * 01660020
*TABLES/WORK AREAS: DADSM WORK AREA DESCRIBED BY MACRO 'IECALLWA'     * 01680002
*                                                                     * 01700020
*              ***************************************                * 01720020
*              *             DADSM TABLE             *                * 01740020
*              ***************************************                * 01760020
*                                                                     * 01780020
*              ***************************************                * 01800020
*              *        *         *                  *                * 01820020
*              *  TYPE  *  NO OF  *     USED HOLE    *                * 01840020
*              *  FLAG  * ENTRIES *      COUNTER     *                * 01860020
*              *        *         *                  *                * 01880020
*              ***************************************                * 01900020
*              *                  *                  *                * 01920020
*              *       RTA        *      RTA+1       *                * 01940020
*              *                  *                  *                * 01960020
*              ***************************************                * 01980020
*              *                  *                  *                * 02000020
*              *       RTA        *      RTA+1       *                * 02020020
*              *                  *                  *                * 02040020
*              ***************************************                * 02060020
*              *                  *                  *                * 02080020
*              *       RTA        *      RTA+1       *                * 02100020
*              *                  *                  *                * 02120020
*              ***************************************                * 02140020
*              *                  *                  *                * 02160020
*              *       RTA        *      RTA+1       *                * 02180020
*              *                  *                  *                * 02200020
*              ***************************************                * 02220020
*              *                  *                  *                * 02240020
*              *       RTA        *      RTA+1       *                * 02260020
*              *                  *                  *                * 02280020
*              ***************************************                * 02300020
*                                                                     * 02320020
*              TYPEFLG  =  02 - BPAM DIRECTORIES REQUESTED.           * 02340020
*                                                                     * 02344021
*                       =  40 - USER LABELS REQUESTED                 * 02348021
*                                                                     * 02352021
*                       =  80 - SET MUST COMPLETE IS ACTIVE           * 02356021
*                                                                     * 02360020
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.  * 02380020
*                                                                     * 02400020
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.      * 02420020
*                                                                     * 02440020
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT* 02460021
*                                                                     * 02480020
*ATTRIBUTES: REENTRANT                                                * 02500002
*                                                                     * 02600002
*OTHER MACROS USED:                                                   * 03200002
*   IECALLWA - ALLOCATE WORK AREA EXPANSION                           * 03210002
*   IECSDSL1 - BUILD DSCB'S                                           * 03220020
*   IEFJFCBN - BUILD JFCB                                             * 03240020
*   IECDSECS - EXPANDS THE CVT, RRPL, AND UCB DSECTS                  * 03260002
*                                                                     * 03300020
*STORAGE: PROGRAM CODE - LESS THAN 1024 BYTES                         * 03380002
*   WORK AREA - AS DEFINED IN THE IECALLWA MACRO                      * 03400002
*   RPS WORK AREA - AS DEFINED IN THE IECRPS MACRO                    * 03410002
*                                                                     * 03420020
*NOTE: THIS MODULE IS NEW IN RELEASE 20.1.                            * 03430021
*                                                                       03440020
*REGISTER USAGE-                                                        03460020
*                                                                       03480020
         BALR  BASEREG,0                                                03580020
         USING BEGINA,BASEREG                                           03600020
         USING ALLOCWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 03620002
         USING JFCBKEN,RJFCBPTR                                         03640020
         USING UCB,RUCBPTRL                                             03660020
         USING CVT,RCVT                                                 03680020
*                                                                       03700020
REGZERO  EQU   0                                                        03720020
REGONE   EQU   1                                                        03740020
REGTWO   EQU   2                                                        03760020
FREEREGE EQU   2                        EVEN WORK REGISTER              03780020
REGTHREE EQU   3                                                        03800020
FREEREGO EQU   3                        ODD WORK REGISTER               03820020
REGFOUR  EQU   4                                                        03840020
REGFIVE  EQU   5                                                        03880020
REGSIX   EQU   6                                                        03920020
REGSEVEN EQU   7                                                        03940020
RUCBPTRL EQU   7                        UCB POINTER                     03960020
REGEIGHT EQU   8                        WORK REGISTER                   03980020
RERRPASS EQU   8                        ERROR PASS REGISTER             04000020
REGNINE  EQU   9                        WORK REGISTER                   04040020
REGTEN   EQU   10                       WORK REGISTER                   04060020
RJFCBPTR EQU   11                       JFCB POINTER                    04080020
BASEREG  EQU   12                       BASE REGISTER                   04100020
RWKAREA  EQU   13                       WORK AREA POINTER               04120020
RBAK     EQU   14                                                       04140020
RCVT     EQU   15                                                       04160020
REGFTEN  EQU   15                       WORK REGISTER                   04180020
*                                                                       04182021
* OTHER EQUATES                                                         04184021
*                                                                       04186021
ZERO     EQU   0                        CONSTANT OF 0            A46776 04188421
TWO      EQU   2                                                   UL17 04190020
THREE    EQU   3                        CONSTANT OF 3            A46776 04190421
K4       EQU   4                        CONSTANT OF 4            Y02080 04190502
FOUR     EQU   4                        CONSTANT OF 4            A46776 04190821
K12      EQU   12                       CONSTANT OF 12           Y02080 04191202
INVALPTR EQU   X'34'                    INVALID JFCB OR PARTIAL  A46776 04191621
*                                       DSCB POINTER             A46776 04191721
CHAINING EQU   X'40'                    CCW COMMAND CHAINING BIT Y02080 04192002
IOERR    EQU   X'0C'                    I/O ERROR RETURN CODE   SA53153 04192202
CSWAD    EQU   8                        CSW OFFSET IN IOB       SA53153 04192402
F1ID     EQU   C'1'                     F1 DSCB IDENTIFIER      SA53153 04192602
DSORGPO  EQU   X'02'                    DSORG = PO               A46776 04193021
DIRFBIT  EQU   X'04'                    VTOC INTERRUPT BIT       O19117 04195020
JFCBSUL  EQU   X'08'                    USER LABEL REQUEST       A42477 04197021
DOSBIT   EQU   X'80'                    DOS CONTAMINATION BIT   SA56426 04198021
DOSSTKPK EQU   X'10'                    DOS STACKED PACK BIT     Y02072 04198302
STACKERR EQU   X'A4'                    STACKED PACK RETURN CODE Y02072 04198602
READCMMD EQU   X'06'                    READ DATA COMMAND        Y02078 04199002
*                                                                       04200020
* * * * * * * * * * * * *                                               04220020
*                                                                       04240020
*                                                                       04260020
* * * * * * * * * * * * *                                               04280020
*                                                                       04300020
BEGINA   EQU   *                                                 O19117 04306020
         LTR   REGTEN,REGFOUR           ENTRY FOR DOS CONVERT           04506020
         BZ    MOVECHPG                 YES, GO BUILD CHAN PGM  SA56426 04706021
*                                                                       05140020
* THIS SECTION LINKS TO THE 'ADDRESS CONVERSION' ROUTINE TO GET THE     05160020
* VTOC ADDRESS.                                                         05180020
*                                                                       05200020
         L     REGZERO,UCBVTOC          PICK UP THE VTOC TTR0    Y02080 05209002
         MVC   MIELNAME(6),SRTEVOLI     SAVE VOLUME SERIAL NUMBER  AAAA 05210020
         IC    REGZERO,ZEROS            CLEAR THE LOW ORDER BYTE Y02080 05230002
         STM   REGNINE,RWKAREA,IECREGSV+K12  SAVE REGISTERS      Y02080 05240002
         LA    REGTWO,SEEK              LOAD POINTER TO 8 BYTE AREA     05260020
         LA    REGONE,DEB               LOAD POINTER TO THE DEB         05280020
         LR    REGTHREE,RWKAREA         SAVE WORK AREA POINTER          05300020
         L     RCVT,CVTPTR              LOAD COMM VECTOR TABLE BASE     05320020
         L     RCVT,CVTPCNVT            LOAD CONVERSION ROUTINE BASE    05340020
         BALR  RBAK,RCVT                GO TO CONVERSION ROUTINE        05360020
         LM    REGNINE,RWKAREA,IECREGSV+K12-FIRST(REGTHREE)      Y02080 05380002
SETSEEK  MVC   VTOCADR(5),SEEK+3      SAVE VTOC ADDRESS            OC58 05400020
*                                                                       05420020
* THIS SECTION RELOCATES THE CHANNEL PROGRAM TO THE WORKAREA.  IT ALSO  05440020
* INITIALIZES IT TO READ IN THE FORMAT 4 DSCB AND PERFORM A             05460021
* DUPLICATE NAME SEARCH                                                 05465021
*                                                                       05500020
*                                                                       05520020
MOVECHPG LM    REGZERO,REGNINE,CHANPROG  LOAD FIRST 5 CCW'S        OC58 05540020
         ALR   REGZERO,RWKAREA                                          05560020
         ALR   REGTWO,RWKAREA                                           05580020
         ALR   REGFOUR,RWKAREA                                          05600020
         ALR   REGSIX,RWKAREA                                           05620020
         ALR   REGEIGHT,RWKAREA                                         05640020
         STM   REGZERO,REGNINE,CCW1     STORE FIRST 5 CCW'S             05660020
         LM    REGZERO,REGSEVEN,CCWP6   LOAD CCW'S 6 THRU 9      O19117 05680020
         ALR   REGZERO,RWKAREA          RELOCATE                 O19117 05700020
         ALR   REGTWO,RJFCBPTR            CCW                    O19117 05720020
         ALR   REGFOUR,RWKAREA              DATA                 O19117 05740020
         ALR   REGSIX,RWKAREA                 ADDRESSES          O19117 05760020
         STM   REGZERO,REGSEVEN,CCW6    STORE CCW'S 6 THRU 9     O19117 05780020
         LM    REGFOUR,REGNINE,CCWP11   LOAD CCW'S 11 THRU 13    O19117 05800020
         ALR   REGFOUR,RWKAREA          RELOCATE                 O19117 05820020
         ALR   REGSIX,RWKAREA             CCW DATA               O19117 05840020
         ALR   REGEIGHT,RWKAREA             ADDRESSES            O19117 05860020
         STM   REGTWO,REGNINE,CCW10     STORE CCW'S 10 THRU 13   O19117 05880020
*                                                                       05920020
         LTR   REGTEN,REGTEN            Q - DOS CONVERT RE-ENTRY O19117 05930020
         BZ    EXECUTET                 IF YES, BR - SKIP ENQ    O19117 05940020
         L     RUCBPTRL,DEB+32          RELOAD UCB POINTER       O19117 05950020
*                                                                       05960020
* LINK TO ENQ ROUTINE TO ENQ THE VTOC ON THIS VOLUME.                   05980020
*                                                                       06000020
         MVC   MJELNAME(8),VTOCNAME     MOVE MAJOR QUE NAME TO WORKAREA 06020020
         MVI   ENQAREA,X'FF'            SET LAST ENTRY CODE             06040020
         SR    REGONE,REGONE            CLEAR CODE AND RETURN FIELDS    06060020
         STH   REGONE,ENQAREA+2                                         06080020
*                                                                       06100020
       RESERVE (MJELNAME,MIELNAME,E,6,SYSTEMS),MF=(E,ENQAREA),   YM3022X06116002
               UCB=DEB+32                                               06124020
*                                                                       06126002
         OI    DSMADTB2,DSMVTOCR        SET VTOC ENQ'ED SWITCH   Y02144 06128002
         L     REGONE,IECRRPRM          RECOVERY RTN LIST ADDR   Y02144 06130002
         USING RRPLIST,REGONE           PARM LIST ADDRESSABILITY Y02144 06132002
         LA    RUCBPTRL,ZERO(RUCBPTRL)  CLEAR HIGH ORDER BYTE    Y02144 06134002
         ST    RUCBPTRL,RRUCBPTR        SAVE THE UCB ADDRESS     Y02144 06136002
         DROP  REGONE                                            Y02144 06138002
*                                                                       06140020
* THIS SECTION LINKS TO IOS FOR ALL I/O OPERATIONS.                     06160020
*                                                                       06180020
EXECUTET EXCP  IOB                                                      06200020
         WAIT  1,ECB=ECB                                                06220020
         TM    ECB,X'20'               CHECK FOR PERMANENT I/O ERROR    06240020
         LA    RERRPASS,X'0C'           PREPARE FOR POSSIBLE     O19117 06260020
*                                       ERROR EXIT                      06280020
         BNO   ERREXIT                  BR IF I/O ERROR          O19117 06300020
         MVC   DADSMADR(5),DSCBF5-8     SAVE 1ST F5 ADDR         M4523  06440320
         MVC   FMTOUTAD(5),DADSMADR     SETUP 1ST F5 OUTPUT ADDR M4523  06440620
*                                                                       06443921
* IF THE DIRFBIT WAS NOT PREVIOUSLY SET, OR IF THIS MODULE WAS NOT      06444202
* NOT REENTERED FROM THE VTOC CONVERSION ROUTINES, THIS SECTION         06444502
* MODIFIES THE CHANNEL PROGRAM TO REWRITE THE FORMAT 4 DSCB WITH        06444802
* THE DIRFBIT SET.                                                      06445002
*                                                                       06445421
DIRFTEST EQU   *                                                SA56426 06445721
         TM    CCW3+K4,CHAINING         TEST IF LAST I/O WAS FOR Y02080 06446302
*                                       REWRITE OF FORMAT 4 DSCB Y02080 06447202
         BZ    DOSTEST                  BRANCH IF YES            Y02078 06448102
         MVC   CCW9+FOUR(FOUR),IOB+CSWAD  SAVE CSW COMMAND ADDR SA53153 06448202
         LTR   REGTEN,REGTEN            TEST IF RE-ENTRY        SA56426 06448421
*                                       FROM DOS CONVERT RTNS   SA56426 06448621
         BZ    DIRBYP3                  BRANCH IF YES            Y02078 06448702
         XI    DS4VTOCI,DIRFBIT         SET/RESET DIRF BIT       O19117 06449020
         LA    RERRPASS,STACKERR        SET STACKED PACK FLAG    Y02072 06449202
         TM    DS4VTOCI,DOSSTKPK        IS THIS A STACKED PACK?  Y02072 06449402
         BO    ERREXIT                  YES - ERROR              Y02072 06449602
         TM    DS4VTOCI,DIRFBIT         TEST RESULTS             O19117 06449920
         BZ    DIRBYP2                  BRANCH IF DIRF BIT      SA56426 06450821
*                                       PREVIOUSLY SET          SA56426 06451721
         MVI   CCW3,X'05'               SET WR DATA CMMD         O19117 06452620
         MVI   CCW3+4,X'00'             RESET CMMD CHAIN         O19117 06453520
         B     EXECUTET                 GO WRITE BACK F4         O19117 06454420
DIRBYP2  EQU   *                                                SA56426 06456521
         OI    ACNVSW,DIRFSET           INDICATE ENTRY TO VTOC   Y02078 06457502
*                                       CONVERT RTNS DUE TO DIRF Y02078 06460002
         B     GOCNVERT                 GO CONVERT THE VTOC      Y02078 06462502
*                                                                       06465021
* THIS SECTION TESTS IF THIS IS A DOS OR DOS-CONTAMINATED VOLUME.       06470021
* IF SO, IT BRANCHES TO THE DOS/OS VTOC CONVERSION ROUTINE.             06475002
*                                                                       06480021
DOSTEST  EQU   *                        BRANCH LABEL             Y02078 06482002
         MVI   CCW3,READCMMD            RESTORE READ DATA CMMD   Y02078 06484002
         TM    DS4VTOCI,DOSBIT          TEST IF DOS VOLUME      SA56426 06490021
         BZ    DIRBYP3                  NO, DO NOT CONVERT VTOC SA56426 06495021
GOCNVERT EQU   *                        BRANCH LABEL             Y02078 06495502
         OI    DS4VTOCI,DIRFBIT         SET DIRF BIT PRIOR TO   SA56426 06496021
*                                       GOING TO DOS CONVERT    SA56426 06497021
         OI    ACNVSW,ALLOCID           ENTRY TO VTOC CONVERT    Y02078 06498002
*                                       ROUTINES FROM ALLOCATE   Y02078 06499002
         LA    REGFOUR,ALLOC02          GO BRANCH TO IGG0325Z    Y02080 06500002
         B     XCTLHERE                 GO XCTL                 SA56426 06505021
*                                                                       06510021
* THIS SECTION DETERMINES IF A USER LABEL TRACK MUST BE ALLOCATED.      06515021
* IT ALSO DETERMINES IF A DUPLICATE NAME DSCB WAS FOUND.                06520021
*                                                                       06525021
DIRBYP3  EQU   *                                                SA56426 06530021
         LA    RERRPASS,X'40'           PREPARE FOR POSSIBLE     O19117 06540620
*                                       ERROR EXIT                      06541220
         LTR   RJFCBPTR,RJFCBPTR        TEST FOR PARTIAL DSCB    A46776 06542021
         BM    PARTIAL                  BRANCH IF YES            A46776 06544021
         BZ    NOJFCB                   ERROR IF POINTER IS ZERO A46776 06545021
         TM    JFCBLTYP,X'08'           USER LABELS REQUESTED      UL17 06546020
         BZ    CKFORDUP                 BRANCH IF NO               UL17 06548020
         TM    JFCDSORG,X'82'           IS THIS IS OR PARTITIONED  UL17 06550020
         BNZ   ERREXIT                  IF YES, BR               O19117 06552020
         TM    JFCDSORG+1,X'80'         IS THIS GRAPHICS           UL17 06554020
         BNZ   ERREXIT                  IF YES, BR               O19117 06556020
         CLC   JFCBDQTY(THREE),ZEROS    CHECK FOR DIRECTORY      A46776 06558021
         BE    SETUSER                  BRANCH IF NOT            A40967 06560021
         B     ERREXIT                  NO LABELS IF PARTITIONED A40967 06562021
NOJFCB   EQU   *                                                 A46776 06563021
         LA    RERRPASS,INVALPTR        INVALID JFCB POINTER     A46776 06564021
         B     ERREXIT                  GO XCTL                  A46776 06565021
PARTIAL  EQU   *                                                 A46776 06565221
         TM    PD1EXT1,USRLBL           USER LABELS REQUESTED    A46776 06566021
         BZ    CKFORDUP                 BRANCH IF NO               UL17 06568020
         TM    PD1DSORG,DSORGPO         TEST FOR PARTITIONED     A46776 06570021
         BO    ERREXIT                  BRANCH IF DSORG = PO     A46776 06572021
SETUSER  OI    TYPEFLG,USRLBL           SET USER LABEL INDICATOR   UL17 06574020
CKFORDUP EQU   *                                                SA53153 06580002
         L     REGTWO,CCW9+FOUR         GET CSW COMMAND ADDRESS SA53153 06590002
*                                       FOR FIRST EXCP          SA53153 06600002
         LA    REGTWO,0(REGTWO)         CLEAR HIGH BYTE         SA53153 06610002
         LA    REGTHREE,CCW9            GET CCW9 ADDRESS        SA53153 06620002
         SR    REGONE,REGONE            PREPARE TO RESTORE CCW9 SA53153 06630002
         ST    REGONE,CCW9+FOUR         TO ITS ORIGINAL STATUS  SA53153 06640002
         CLR   REGTWO,REGTHREE          WAS DSNAME FOUND        SA53153 06650002
         BE    NODSNAME                 BRANCH IF NOT FOUND     SA53153 06660002
         CLI   F5OUT,F1ID               WAS A DUPLICATE NAME    SA53153 06670002
*                                       DSCB FOUND              SA53153 06680002
         BE    SAMENAME                 BRANCH IF YES           SA53153 06690002
         LA    RERRPASS,IOERR           LOAD I/O ERROR CODE     SA53153 06700002
         B     ERREXIT                  BAD VTOC EXIT           SA53153 06710002
NODSNAME EQU   *                                                SA53153 06720002
         MVI   ASWITCH,FRSTF5           SET FIRST F5 IN CORE     Y02080 06780002
*                                       SWITCH                   O19117 06980020
         LTR   RJFCBPTR,RJFCBPTR        TEST FOR PARTIAL DSCB    A46776 07310021
         BM    CYLTRKRC                 BRANCH IF PARTIAL DSCB   A46776 07320021
         B     CHEKDSET                 GO TEST FOR ZERO QTY REQ Y02080 07340002
*                                                                       07680020
* IF DUPLICATE NAME IS FOUND A TEST IS MADE FOR AN ISAM DATA SET        07700020
*                                                                       07720020
SAMENAME EQU   *                                                 A46776 07730021
         LTR   RJFCBPTR,RJFCBPTR        TEST FOR PARTIAL DSCB    A46776 07740021
         BM    NOTISAM                  BRANCH IF PARTIAL DSCB   A46776 07770021
*                                                                       07800020
* NOT A UTILITY SPACE ALLOCATION REQUEST - TEST FOR ISAM IN THE JFCB    07820021
*                                                                       07840020
OKHERE   TM    JFCDSORG,X'80'                                           07860020
         BO    ISAMALLO                 IF ISAM, BR              O19117 07880020
*                                                                       07900020
* NOT ISAM - ERROR EXIT                                                 07920020
*                                                                       07940020
NOTISAM  LA    RERRPASS,X'04'           SET ERROR CODE 'DUPL NAME DSCB  07960020
         B     ERREXIT                                                  07980020
*                                                                       08000020
* THIS SECTION CHECKS FOR ZERO QUANTITY                                 08020020
*                                                                       08040020
CHEKDSET L     FREEREGE,JFCBPQTY       PICK UP PRIMARY QUANTITY         08060020
         SRL   FREEREGE,8              POSITION                         08080020
         SR    FREEREGO,FREEREGO                                        08100020
         CR    FREEREGE,FREEREGO       CHECK FOR ZERO QTY REQUEST       08120020
         BH    CHEKREC                  NOT ZERO QUANTITY               08140020
         TM    JFCDSORG,X'80'           DSORG=IS                  24988 08146020
         BO    ISAMALLO                 IF YES, BRANCH            24988 08152020
*                                                                       08160020
* TRANSFER CONTROL TO THE NEXT MODULE OF SPACE ALLOCATION               08180020
*                                                                       08200020
CYLTRKRC SR    RERRPASS,RERRPASS        CLEAR ERROR PASS REGISTER       08220020
         LA    REGFOUR,ALLOC01          POINT TO ID OF NEXT LOAD Y02080 08230002
         B     XCTLHERE                 GO XCTL                  S21016 08264021
ERREXIT  EQU   *                                                 S21016 08268021
         LA    REGFOUR,ALLOC03          BRANCH TO IGG0325H       Y02080 08278002
XCTLHERE EQU   *                                                 A46776 08325021
       IECRES LOAD,EXTPR=(RWKAREA),MODID=(REGFOUR),BRANCH=DIRECT Y02080 08375002
*                                                                       08440020
* THIS SECTION CHECKS FOR A RECORD LENGTH GREATER THAN 65,535 BYTES.    08460020
*                                                                       08480020
CHEKREC  TM    JFCBCTRI,X'C0'          IS THIS A CYLINDER REQUEST       08500020
         BO    ISAMTEST                 BRANCH IF YES            A46776 08520021
         TM    JFCBCTRI,X'40'          IS THIS AN AVERAGE RECORD REQ    08540020
         BZ    ISAMTEST                 BRANCH IF NO             A46776 08560021
         CLC   JFCBDRLH(1),ZEROS        IS THE RCD/LNGTH FIELD HIGH     08580020
*                                       BYTE EQUAL TO ZERO              08600020
         LA    RERRPASS,X'18'           PREPARE FOR POSSIBLE     O19117 08610020
*                                       ERROR EXIT                      08620020
         BNE   ERREXIT                  BR IF RCD TOO LONG       O19117 08630020
*                                                                       08640020
* TEST FOR ISAM ON DUPLICATE NAME DSCB NOT FOUND                        08660020
*                                                                       08680020
ISAMTEST EQU   *                                                 A46776 08700021
         TM    JFCDSORG,JFCORGIS        TEST FOR ISAM            A46776 08720021
         BZ    CYLTRKRC                 BRANCH IF NOT ISAM       A46776 08740021
*                                                                       09040020
* THIS SECTION RELOCATES THE FORMAT 1 DSCB FOR ISAM ALLOCATE.           09060002
*                                                                       09080002
ISAMALLO EQU   *                                                        09100002
         MVC   DSMADTW4,ADSABLST        SAVE DSAB LIST ADDRESS   Y02144 09120002
         OI    DSMADTB1,DSMISAM         SET ISAM ALLOCATE BIT    Y02144 09140002
*                                                                       09160002
         MVC   CCW1(96),F5OUT          RELOCATE THE DATA PORTION OF     09180020
         MVC   DSCBF1+44(96),CCW1         THE DUPLICATE NAME DSCB       09200020
         LA    REGFOUR,ISAMLOAD         SET UP FOR 1ST ISAM LOAD Y02080 09250002
         B     XCTLHERE                 GO BRANCH TO IGG032I1    Y02080 09300002
*                                                                       09720020
***   CHANNEL PROGRAMS FOR SEEK VTOC AND SEARCH FOR SAME NAME   ***     09740020
*                                                                       09760020
CCWP1    CCW   X'31',SEEK+3-FIRST,X'40',5  SEARCH EQUAL ID FOR VTOCOC58 09780020
CCWP2    CCW   X'08',CCW1-FIRST,0,0          TIC BACK TO SEARCH         09800020
CCWP3    CCW   X'06',DS4IDFMT-FIRST,X'40',96 READ DATA FOR VTOC DSCB    09820020
CCWP4    CCW   X'9E',DSCBF5-8-FIRST,X'40',148  READ COUNT//KEY/DATA F5. 09840020
CCWP5    CCW   X'F1',DS4HPCHR-FIRST,X'40',5  TEST FOR LAST F1 DSCB      09860020
CCWP6    CCW   X'08',CCW10-FIRST,0,0         TIC TO SEARCH NAME EQUAL   09880020
CCWP7    CCW   X'A9',0,X'60',44         SKE ON DATA SET NAME     Y02080 09900002
CCWP8    CCW   X'06',F5OUT-FIRST,X'30',96  READ DATA (SKIP BIT) SA48172 09920021
*                                       OF LAST FORMAT 1 TO END SA48172 09930021
*                                       THE CHANNEL PROGRAM     SA48172 09932021
CCWP9    CCW   X'08',CCW12-FIRST,0,0         TIC TO READ DATA DSCB F1   09940020
*CCWP10        (WILL BE DUPLICATED FROM CCWP7)                          09960020
CCWP11   CCW   X'08',CCW5-FIRST,0,0          TIC BACK TO SEARCH LAST F1 09980020
CCWP12   CCW   X'06',F5OUT-FIRST,X'40',96  READ DATA ON DUP NAME DSCB   10000020
CCWP13   CCW   X'12',COUNT-FIRST,X'20',5     READ COUNT OF NEXT DSCB F1 10020020
CHANPROG EQU   CCWP1                                                    10040020
ZEROS    EQU   CCWP11+FOUR              FOUR BYTES OF ZEROS      A46776 10050021
*                                                                       10060020
* * * * * * * * * * * * *                                               10080020
*                                                                       10100020
***   CONSTANTS                                                         10120020
*                                                                       10140020
* * * * * * * * * * * * *                                               10160020
*                                                                       10180020
VTOCNAME DC    CL8'SYSVTOC'             MAJOR QUEUE NAME                10360020
*                                                                       10400020
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         10420002
*                                                                       10430021
XCTLTABL XCTLTABL ID=(ALLOC01,5B,ALLOC02,5Z,ALLOC03,5H,          Y02080X10440002
               ISAMLOAD,I1),SVC=032,LENGTH=,BRT=YES              Y02080 10490002
         EJECT                                                   Y02080 10540002
*                                                                       10620020
* * * * * * * * * * * * *                                               10640020
*                                                                       10660020
*                                                                       10680020
* * * * * * * * * * * * *                                               10700020
*                                                                       10720020
JFCBKEN  DSECT                                                          10740020
         IEFJFCBN                                                       10780020
         EJECT                                                   Y02080 10790002
*                                                                       10800020
* * * * * * * * * * * * *                                               10820020
*                                                                       10840020
***   DSECT FOR THE PARTIAL DSCB PASSED TO ALLOCATE BY IEHMOVE   A46776 10850021
*                                                                       10860020
* * * * * * * * * * * * *                                               10880020
*                                                                       10900020
         ORG   INFMJFCB                                                 10920020
PD1DSNAM DS    CL44                DATA SET NAME                        10922021
PD1FMTID DS    CL1                 FORMAT IDENTIFIER                    10924021
PD1DSSN  DS    CL6                 DATA SET SERIAL NUMBER               10926021
PD1VOLSQ DS    XL2                 VOLUME SEQUENCE NUMBER               10928021
PD1CREDT DS    XL3                 CREATION DATE                        10930021
PD1EXPDT DS    XL3                 EXPIRATION DATE                      10932021
PD1NOEPV DS    XL1                 NUMBER OF EXTENTS ON VOLUME          10934021
PD1NOBDB DS    XL1                 NUMBER OF BYTES USED IN LAST         10936021
*                                     DIRECTORY BLOCK                   10938021
         DS    XL1                 RESERVED                             10940021
PD1SYSCD DS    CL13                SYSTEM CODE                          10942021
         DS    XL7                 RESERVED                             10944021
PD1DSORG DS    XL2                 DATA SET ORGANIZATION                10946021
PD1RECFM DS    XL1                 RECORD FORMAT                        10948021
PD1OPTCD DS    XL1                 OPTION CODE                          10950021
PD1BLKL  DS    XL2                 BLOCK LENGTH                         10952021
PD1LRECL DS    XL2                 RECORD LENGTH                        10954021
PD1KEYL  DS    XL1                 KEY LENGTH                           10956021
PD1RKP   DS    XL2                 RELATIVE KEY POSITION                10958021
PD1DSIND DS    XL1                 DATA SET INDICATORS                  10960021
PD1SCALO DS    XL4                 SECONDARY ALLOCATION                 10962021
PD1LSTAR DS    XL3                 LAST USED TRACK AND BLOCK ON TRACK   10964021
PD1TRBAL DS    XL2                 BYTES REMAINING ON LAST TRACK USED   10966021
         DS    XL2                 RESERVED                             10968021
PD1EXT1  DS    XL1                 EXTENT TYPE INDICATOR                10970021
         DS    XL2                 UNUSED                               10972021
PDPRIQTY DS    F                   PRIMARY SPACE REQUEST IN TRACKS      10974021
PDDIRQTY DS    F                   NUMBER OF DIRECTORY BLOCKS           10976021
         SPACE 2                                                 Y02080 11120002
         IECDSECS CVT,RRPL,UCB,EXPAND=YES                        Y02144 11130002
DSCBWKAR IECALLWA EP,F4,ADT=YES         ALLOCATE WORK AREA       Y02144 11140002
ENQAREA  EQU   ADSCBF4                  ENQUEUE PARAMETER LIST   Y02080 13060002
MJELNAME EQU   ADSCBF4+16               MAJOR ELEMENT NAME       Y02080 13080002
         END                                                            53460020
./  ADD  SSI=71260427,NAME=IGG0325B
 TITLE 'IGG0325B - DADSM - ALLOCATE REQUEST CALCULATION'                00020000
IGG0325B CSECT                                                          00021021
*                                                                       00021402
*MODULE NAME = IGG0325B                                                 00021802
*                                                                       00021902
*DESCRIPTIVE NAME = DADSM - ALLOCATE REQUEST CALCULATION                00022902
*                                                                       00024902
*COPYRIGHT = NONE                                                       00025102
*                                                                       00025202
*CHANGE ACTIVITY = SEE BELOW                                            00025302
*                                                                       00025402
*          RELEASE 16 DELETIONS                                         00025502
*1028                                                             13559 00026002
*1028035000                                                       14112 00027002
*          RELEASE 17 DELETIONS                                         00028002
*1684000400,117200,120200.                                         UL17 00029002
*1684053800,058000                                                16866 00030002
*          RELEASE 18 DELETIONS                                         00031002
*2412                                                             OC058 00032002
*          RELEASE 19 DELETIONS                                         00033002
*1025035430                                                      A27563 00034002
*          RELEASE 20 DELETIONS                                         00035002
*3519                                                            A33097 00036002
*3519029000,072000-072600,077800-078800,097200-098000,100400,    S20201 00037002
*3519115600                                                      S20201 00038002
*          RELEASE 21 DELETIONS                                         00039002
*1192022000-022200,022800-023000,052200,073600,127400            A37199 00040002
*1192000210,001600,002000-004000,004600-004800,009600,011400-    S21016 00041002
*1192012200,020400,022800,028900,030000-030600,032660-033200,    S21016 00042002
*1192044520,066800-067000,116200-116400,117200,120200,144000     S21016 00043002
*0000065800,117200-120200                                       SA53163 00044002
*0000000280,001000,006400,033600-033800,035500,040200,040600-    A46776 00045002
*0000041200,041600,042000,059600,061200-062200,074600,118200,    A46776 00046002
*0000123200-123600                                               A46776 00047002
*          RELEASE 21.7 DELETIONS/CHANGES                               00048002
*0000000288,087400                                              SA59784 00049002
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00050002
*0000000030-000150,000290-000300,001200,001800,004700,006200,    Y02080 00051002
*0000007000,007400-007800,008400,009200,009600-010600,011400-    Y02080 00052002
*0000011500,012600,020800,022600,022800-022900,028200,031800,    Y02080 00053002
*0000034600,042200,043600,044460,045200,049400,049610-049690,    Y02080 00054002
*0000050200-051400,052200,053000-061000,064000,067600-067800,    Y02080 00055002
*0000068200-068400,073200,073600-075200,092400-092600,100600,    Y02080 00056002
*0000105000,113300,114200,116800,117700,121400,123800-143800     Y02080 00057002
*0000                                                           SA65999 00057402
*          VS2 RELEASE 03.0 DELETIONS/CHANGES                           00057802
*0000102800,102900                                              ZA00010 00057902
*          VS2 RELEASE 03.7 CHANGES                                     00058037
*0000110800,111000                                             @ZA10233 00058337
*C102800,D102820-102900                                        @ZA16895 00058437
*                                                                       00058637
*STATUS CHANGE LEVEL 007                                                00059002
*FUNCTION/OPERATION: THIS MODULE DETERMINES THE TYPE OF REQUEST MADE  * 00060000
*   AND CALCULATES THE SPACE REQUIREMENTS IN TRACKS FOR ALL REQUESTS. * 00080000
*   IT ALSO CALCULATES THE 'TTRLL' FIELD FOR ANY BPAM DATA SETS. IT   * 00104021
*   DETERMINES TO WHICH ALLOCATE MODULE TO PASS CONTROL.  CONTROL     * 00120002
*   MAY BE PASSED TO A SUBSEQUENT MODULE OF DADSM ALLOCATE OR TO      * 00140000
*   SUBALLOCATE. A NEW CHANNEL PROGRAM IS RELOCATED TO THE WORK AREA  * 00160021
*   PRIOR TO A BRANCH TO A SUBSEQUENT DADSM ALLOCATE MODULE.          * 00180002
*                                                                     * 00420000
*ENTRY POINTS:                                                        * 00440000
*   IGG0325B - ENTRY IS MADE FROM IGG0325A VIA A BRANCH.              * 00470002
*                                                                     * 00500000
*INPUT: UPON ENTRY TO THIS MODULE THE WORK AREA WILL CONTAIN THE      * 00520000
*   DATA PORTION OF THE FORMAT 4 DSCB, THE KEY AND DATA OF THE FIRST  * 00540000
*   FORMAT 5 DSCB, AND THE ABSOLUTE ADDRESS OF THE FORMAT 4 AND       * 00560000
*   FORMAT 5 DSCB'S.                                                  * 00580000
*   THE WORK AREA WILL ALSO CONTAIN A DEB, AN IOB, AND AN ECB.        * 00600000
*   THE FIRST FORMAT 5 DSCB IN CORE SWITCH WILL BE SET.               * 00620002
*   REGISTER 11 WILL POINT TO THE JFCB OR PARTIAL DSCB.               * 00644021
*   REGISTER 13 WILL POINT TO THE WORK AREA.                          * 00660000
*                                                                     * 00680000
*OUTPUT: UPON TRANSFER OF CONTROL THE WORK AREA AND REGISTERS WILL BE * 00700002
*   AS AT INPUT WITH THE FOLLOWING ADDITIONS.  REGISTER 10 WILL       * 00720000
*   CONTAIN THE SPACE REQUESTED IN TRACKS.  FOR A DIRECTORY           * 00740002
*   REQUEST, FIELD 'TTRLL' WILL CONTAIN THE NUMBER OF TRACKS          * 00780002
*   AND RECORDS REQUIRED FOR THE DIRECTORY SPACE AND THE NUMBER       * 00800000
*   OF UNUSED BYTES REMAINING ON THE LAST DIRECTORY TRACK.  UPON      * 00820000
*   A BRANCH TO A SUBSEQUENT ALLOCATE MODULE, THE WORK AREA WILL      * 00840002
*   ALSO CONTAIN A NEW CHANNEL PROGRAM.                               * 00860000
*                                                                     * 00880000
*EXTERNAL ROUTINES:                                                   * 00900000
*        IECRES - BRANCH TO ANOTHER MODULE                            * 00920002
*                                                                     * 00940000
*EXITS:                                                               * 00950021
*   -NORMAL: BRANCH TO IGG0325C FOR ABSTR REQUESTS                    * 00960002
*   BRANCH TO IGG0325D FOR NON-ZERO QUANTITY REQUESTS.                * 00980002
*   BRANCH TO IGG0325E FOR ZERO QUANTITY REQUESTS.                    * 01020002
*   BRANCH TO IGG0325K FOR USER LABEL TRACK REQUESTS.                 * 01024002
*   -ERRORS: BRANCH TO IGG0325H WITH CODE IN ERROR CODE PASS REGISTER.* 01060002
*                                                                     * 01080000
*   ERROR CODES THAT CAN BE ISSUED BY 'ALLOCATE REQUEST CALCULATION'. * 01100000
*                                                                     * 01120000
*   08 - NO AVAILABLE DSCB'S IN THE VTOC                              * 01130021
*                                                                     * 01160021
*   38 - NOT ENOUGH SPACE ON VOLUME FOR DIRECTORY                     * 01170021
*                                                                     * 01180021
*   80 - DIRECTORY SPACE REQUESTED IS LARGER THAN PRIMARY SPACE       * 01190021
*                                                                     * 01240000
*TABLES/WORK AREAS: DADSM WORK AREA DESCRIBED BY MACRO 'IECALLWA'     * 01260002
*                                                                     * 01280000
*              ***************************************                * 01300000
*              *             DADSM TABLE             *                * 01320000
*              ***************************************                * 01340000
*                                                                     * 01360000
*              ***************************************                * 01380000
*              *        *         *                  *                * 01400000
*              *  TYPE  *  NO OF  *     USED HOLE    *                * 01420000
*              *  FLAG  * ENTRIES *      COUNTER     *                * 01440000
*              *        *         *                  *                * 01460000
*              ***************************************                * 01480000
*              *                  *                  *                * 01500000
*              *       RTA        *      RTA+1       *                * 01520000
*              *                  *                  *                * 01540000
*              ***************************************                * 01560000
*              *                  *                  *                * 01580000
*              *       RTA        *      RTA+1       *                * 01600000
*              *                  *                  *                * 01620000
*              ***************************************                * 01640000
*              *                  *                  *                * 01660000
*              *       RTA        *      RTA+1       *                * 01680000
*              *                  *                  *                * 01700000
*              ***************************************                * 01720000
*              *                  *                  *                * 01740000
*              *       RTA        *      RTA+1       *                * 01760000
*              *                  *                  *                * 01780000
*              ***************************************                * 01800000
*              *                  *                  *                * 01820000
*              *       RTA        *      RTA+1       *                * 01840000
*              *                  *                  *                * 01860000
*              ***************************************                * 01880000
*                                                                     * 01900000
*              TYPEFLG  =  02 - BPAM DIRECTORIES REQUESTED.           * 01920000
*                                                                     * 01940000
*                       =  40 - USER LABELS REQUESTED                 * 01944021
*                                                                     * 01948021
*                       =  80 - SET MUST COMPLETE IS ACTIVE           * 01952021
*                                                                     * 01956021
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.  * 01960000
*                                                                     * 01980000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.      * 02000000
*                                                                     * 02020000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT* 02040021
*                                                                     * 02060000
*ATTRIBUTES: REENTRANT                                                * 02080002
*                                                                     * 02100000
*NOTES:                                                               * 02120000
*   OTHER MACROS USED                                                 * 02140000
*   IECALLWA - ALLOCATE WORK AREA EXPANSION                           * 02150002
*   IECSDSL1 - BUILD DSCB'S                                           * 02160000
*   IEFJFCBN - BUILD JFCB                                             * 02180000
*   CVT - BUILD CVT                                                   * 02230002
*                                                                     * 02240000
*                                                                     * 02270021
*STORAGE: PROGRAM CODE - LESS THAN 1024 BYTES                         * 02280002
*   WORK AREA - AS DEFINED IN THE IECALLWA MACRO                      * 02290002
*   RPS WORK AREA - AS DEFINED IN THE IECRPS MACRO                    * 02300002
*                                                                     * 02320000
*                                                                       02340000
*REGISTER NAMES-                                                        02360000
*                                                                       02380000
R0       EQU   0                        CHANNEL PROGRAM RELOCATION      02400000
EXTRPAS1 EQU   0                        CONVERTED REGISTER              02420000
R1       EQU   1                        CHANNEL PROGRAM RELOCATION      02440000
R2       EQU   2                        CHANNEL PROGRAM RELOCATION      02460000
FREEREGE EQU   2                        EVEN WORK REGISTER              02480000
FREEREGO EQU   3                        ODD WORK REGISTER               02500000
R4       EQU   4                        CHANNEL PROGRAM RELOCATION      02520000
FREEREGA EQU   4                        WORK REGISTER                   02540000
FREEREGB EQU   5                        WORK REGISTER                   02560000
R6       EQU   6                        CHANNEL PROGRAM RELOCATION      02580000
FREEREGC EQU   6                        WORK REGISTER                   02600000
RTTRPTR  EQU   7                        PTR TO XCTL BY TTR TABLE ENTRY  02620000
R8       EQU   8                        CHANNEL PROGRAM RELOCATION      02640000
REGEIGHT EQU   8                        WORK REGISTER                   02660000
RERRPASS EQU   8                        ERROR CODE PASS REGISTER        02680000
R9       EQU   9                        CHANNEL PROGRAM RELOCATION      02700000
REGNINE  EQU   9                        WORK REGISTER                   02720000
REGTEN   EQU   10                       REQUEST PASS REGISTER           02740000
RJFCBPTR EQU   11                       JFCB POINTER                    02760000
BASEREG  EQU   12                       BASE REGISTER                   02780000
RWKA     EQU   13                       CHANNEL PROGRAM WORKAREA PTR    02800000
RETNREG  EQU   14                       RETURN REGISTER                 02840000
REGFTEN  EQU   15                       WORK REGISTER                   02860000
*                                                                       02880000
* OTHER EQUATES                                                         02882021
*                                                                       02884021
DSORGPO  EQU   X'02'                    DSORG = PO               A46776 02884821
TBOVHD   EQU   X'08'                    TWO BYTE OVERHEAD FLAG   S20201 02885020
TOOLARGE EQU   X'38'                    DIRECTORY SPACE REQUEST  S21016 02887021
*                                       IS TOO LARGE FOR VOLUME  S21016 02889021
GRTHPRIM EQU   X'80'                    DIRECTORY SPACE REQUEST  S21016 02891021
*                                       IS GREATER THAN PRIMARY  S21016 02893021
C0       EQU   0                        CONSTANT OF 0            S20201 02895020
C1       EQU   1                        CONSTANT OF 1            S20201 02900020
R5       EQU   5                        EQU FOR STM              S20201 02905020
THRE     EQU   3                        EQUATE FOR THREE         S20201 02910020
C8       EQU   8                        CONSTANT OF 8            S20201 02915020
K1       EQU   1                        CONSTANT OF 1           SA65999 02915402
K2       EQU   2                        EQUATE FOR 2            SA53163 02917021
K3       EQU   3                        CONSTANT OF 3            Y02080 02919002
K6       EQU   6                        CONSTANT OF 6            Y02080 02919402
K12      EQU   12                       CONSTANT OF 12           Y02080 02919802
*                                                                       02920000
*                                                                       02940000
* * * * * * * * * * * * *                                               02960000
*                                                                       02980000
*                                                                       03080000
*REGISTER USAGE-                                                        03100000
*                                                                       03120000
         BALR  BASEREG,0                                                03140000
         USING *,BASEREG                                           OC58 03160018
         USING ALLOCWKA,RWKA            WORK AREA ADDRESSABILITY Y02080 03180002
         USING JFCBKEN,RJFCBPTR                                         03200000
*                                                                       03220000
* INITIALIZE THE TTRLL FIELD TO RELATIVE TRACK = 0, ACTUAL RECORD = 0,  03240000
* AND BYTES REMAINING = DEVICE TRACK LENGTH.                            03260000
*                                                                       03280021
CYLTRKRC EQU   *                                                 S21016 03300021
         MVC   TTRLL+3(2),DS4DEVTK      SET LL TO TRACK LENGTH          03340000
         LTR   RJFCBPTR,RJFCBPTR        TEST FOR PARTIAL DSCB    A46776 03360021
         BM    PARTIAL                  BRANCH IF YES            A46776 03380021
         CLC   JFCBPQTY(3),ZEROS        TEST FOR ZERO QTY REQUEST       03400000
         BNE   NOTZQTY                  BRANCH IF NOT ZERO QTY          03420000
*                                                                       03440000
* ZERO QUANTITY - SET BRANCH TO BUILD FORMAT 1 DSCB.                    03460002
*                                                                       03480000
         TM    JFCBCTRI,X'C0'          CHECK IF ABSTR REQUESTED    8158 03520000
         BZ    CLEANUP                 BRANCH IF ABSTR REQUESTED   8158 03540000
DSCBTEST EQU   *                                                 A46776 03540121
         OC    DS4DSREC(2),DS4DSREC     ANY HOLES                A27563 03540619
         BNE   CONT                     YES, BRANCH              A27563 03541219
         LA    RERRPASS,X'08'           SET ERROR CODE           A27563 03541819
         B     ERREXIT                  GO XCTL                  A27563 03542419
CONT     TM    TYPEFLG,USRLBL           USER LABELS REQ.         A27563 03543419
         BO    USERZERO                 BRANCH IF YES              UL17 03546017
         LA    RTTRPTR,ALLOCA3          LOAD PTR TO F1/F3 TTR ENTRY     03560000
         B     XCTLHERE                                                 03580000
*                                                                       03600000
* A TEST OF THE FIELD JFCBDQTY IS MADE TO DETERMINE IF THE DATA SET IS  03620000
* A BPAM DATA SET                                                       03640000
*                                                                       03660000
NOTZQTY  L     FREEREGO,JFCBDQTY        GET DIRECTORY QUANTITY          03680000
         SRL   FREEREGO,8               POSITION                        03700000
         LTR   FREEREGO,FREEREGO        ARE DIRECTORIES REQUESTED       03720000
         BP    DIRCAL                   BRANCH IF YES                   03740000
*                                                                       03760000
* DATA SET IS NOT BPAM - TEST FOR PRIMARY QUANTITY IN RECORDS.          03780000
*                                                                       03800000
         L     EXTRPAS1,JFCBPQTY        GET REQ PRIMARY QUANTITY        03820000
         SRL   EXTRPAS1,8               POSITION                        03840000
         TM    JFCBCTRI,X'C0'           IS PRIMARY QTY IN CYLINDERS     03860000
         BC    1,MULT                   BRANCH IF YES                   03880000
         TM    JFCBCTRI,X'40'           IS PRIMARY QTY IN AVG RCD LGTH  03900000
         BC    1,NOCAL                  BRANCH IF YES                   03920000
         B     CLEANUP                  PRIMARY QUANTITY IS IN TRACKS   03940000
MULT     MH    EXTRPAS1,DS4DEVSZ+2      CONVERT CYLS TO TRKS            03960000
         B     CLEANUP                                                  03980000
*                                                                       04000000
* UTILITY SPACE REQUEST - TEST FOR DSORG = PO IN THE PARTIAL F1 DSCB    04020021
*                                                                       04040000
PARTIAL  EQU   *                                                 A46776 04060021
         CLC   PDPRIQTY,ZEROS           TEST IF ZERO QTY REQUEST A46776 04080021
         BE    DSCBTEST                 BRANCH IF ZERO QUANTITY  A46776 04100021
         TM    PD1DSORG,DSORGPO         TEST FOR DIRECTORIES     A46776 04120021
         BC    1,CALCDIR                BRANCH IF DIRECTORIES REQUESTED 04140000
GOOUT    EQU   *                                                 A46776 04144021
         L     REGTEN,PDPRIQTY          LOAD PRIMARY QUANTITY    A46776 04160021
         B     REGULAR                                                  04180000
CALCDIR  EQU   *                                                 A46776 04184021
         L     FREEREGO,PDDIRQTY        LOAD DIRECTORY QUANTITY  A46776 04200021
         OI    ASWITCH,PRCNTL           SET PROCESS CONTROL SW   Y02080 04220002
*                                                                       04240000
* DATA SET IS BPAM                                                      04260000
*                                                                       04280000
* THIS SECTION CALCULATES THE TOTAL NUMBER OF TRACKS AND RECORDS        04300000
* NEEDED TO FILL THE DIRECTORY QUANTITY REQUESTED.                      04320000
*                                                                       04340000
DIRCAL   EQU   *                        BRANCH LABEL             Y02080 04350002
         OI    TYPEFLG,DIRREQ           SET DIRECTORIES REQ FLAG Y02080 04360002
         SR    FREEREGE,FREEREGE        CLEAR HIGH DIVIDEND REGISTER    04380000
         SR    FREEREGA,FREEREGA                                        04400000
         IC    FREEREGA,DS4DEVDB        GET NBR OF DIR BLKS PER TRK     04420000
         DR    FREEREGE,FREEREGA        CALCULATE NBR OF TRKS REQUIRED  04440000
         CH    FREEREGO,MAXTRACK        TEST IF TOO MANY TRACKS  Y02080 04446002
         BH    TOOMANY                  BRANCH IF TOO MANY TRKS  S21016 04453021
         STH   FREEREGO,TTRLL           STORE NBR OF TRACKS             04460000
         LA    FREEREGE,1(FREEREGE)     ACCOUNT FOR EOD MARK            04480000
         STC   FREEREGE,TTRLL+2         STORE NBR OF ADDITIONAL RCDS    04500000
         TM    ASWITCH,PRCNTL           IS PROCESS CONTROL SW ON Y02080 04520002
         BO    MOVEBCK                  BRANCH IF YES                   04540000
*                                                                       04560000
* THIS SECTION CONVERTS THE PRIMARY QUANTITY TO TRACKS                  04580000
*                                                                       04600000
DIRCAL1  L     EXTRPAS1,JFCBPQTY        GET PRIMARY QUANTITY            04620000
         SRL   EXTRPAS1,8               POSITION                        04640000
         TM    JFCBCTRI,X'C0'           IS THIS A CYLINDER REQUEST      04660000
         BC    1,MULTA                  BRANCH IF YES                   04680000
         TM    JFCBCTRI,X'40'           IS THIS AN AVG RCD REQUEST      04700000
         BC    1,INRECRDS               BRANCH IF YES                   04720000
         B     MOVEBCK                  PRIMARY QUANTIRY IS IN TRACKS   04740000
MULTA    MH    EXTRPAS1,DS4DEVSZ+2      CONVERT CYL REQ TO TRACKS       04760000
*                                                                       04780000
* THIS SECTION CALCULATES IN BYTES THE LENGTH OF A DIRECTORY BLOCK.     04800000
* IT CALCULATES THE NUMBER OF BYTES REMAINING ON THE LAST DIRECTORY     04820000
* TRACK AND STORES THIS VALUE IN 'LL' OF THE TTRLL FIELD.               04840000
*                                                                       04860000
MOVEBCK  LA    FREEREGA,8               SET UP KL AND DL FOR            04880000
         LA    FREEREGB,256             DIRECTORY RECORD                04900000
         BAL   REGTEN,TTRCAL            GO CALCULATE DIR RECD LENGTH    04920000
         TM    ASWITCH,PRCNTL           IS PROCESS CONTROL SW ON Y02080 04940002
         BO    GOOUT                    BRANCH IF YES                   04960000
*                                                                       04970021
CLEANUP  LR    REGTEN,EXTRPAS1          LOAD COMMUNICATION REGISTER     04980000
*                                       WITH NUMBER OF TRACKS REQUIRED. 05000000
         TM    JFCBCTRI,X'C0'           IS THIS A CYL OF TRK REQUEST    05160000
         BC    5,REGULAR                BRANCH IF CYL OR TRK REQUEST    05180000
*                                                                       05200000
* ABSOLUTE TRACK REQUEST - SET UP BRANCH TO IGG0325C.                   05220002
*                                                                       05240000
         LA    RTTRPTR,ALLOCA1          LOAD PTR TO ABS/TRK TTR ENTRY   05260000
         B     XCTLHERE                                                 05280000
*                                                                       06240000
* TRANSFER CONTROL TO THE LAST MODULE OF SPACE ALLOCATION TO RELEASE    06260000
* THE WORK AREA,DEQ THE VTOC,PASS THE ERROR CODE,AND EXIT TO CALLER.    06280000
*                                                                       06300000
ERREXIT  LA    RTTRPTR,ALLOCD2          LOAD PTR TO LAST ALLOC ENTRY    06320000
         LR    REGFTEN,RERRPASS         HOLD ERROR CODE                 06340000
         B     XCTLH                                                    06360000
*                                                                       06380000
* THIS SECTION SETS UP A BRANCH TO MODULE IGG0325D.                     06400002
*                                                                       06420000
REGULAR  LA    RTTRPTR,ALLOCA2          LOAD PTR TO CYL/TRK TTR ENTRY   06440000
         TM    TYPEFLG,USRLBL           IS THIS USER LABEL         UL17 06445017
         BZ    XCTLHERE                 BRANCH IF NO               UL17 06450017
         LA    RTTRPTR,ALLOCA4          USER LABEL LOAD            UL17 06455017
*                                                                       06460000
* THIS SECTION DETERMINES IF THE PRIMARY QUANTITY REQUESTED IS          06480000
* SUFFICIENT TO FILL THE DIRECTORY QUANTITY REQUESTED.                  06500000
*                                                                       06520000
XCTLHERE SR    REGFTEN,REGFTEN          CLEAR ERROR HOLD REGISTER       06540000
         CH    REGTEN,TTRLL             IS PRI QTY EQ/GRTR THAN DIR QTY 06560000
         BH    XCTLH                    BRANCH IF YES           SA53163 06580021
         BL    DIRERR                   IF NOT, REQUEST IS IN   SA53163 06582021
*                                       ERROR                   SA53163 06584021
         CLI   TTRLL+2,C0               ARE THERE MORE DIR BLKS SA53163 06590021
*                                       THAN WILL FIT ON FULL   SA53163 06592021
*                                       TRACK(S) INDICATED BY   SA53163 06594021
*                                       TTRLL                   SA53163 06596021
         BE    XCTLH                    NO, CONTINUE NORMALLY   SA53163 06598021
*                                                                       06600000
* ERROR - PRIMARY QUANTITY REQUESTED IS LESS THAN THE DIRECTORY         06620000
* QUANTITY REQUESTED.                                                   06640000
*                                                                       06660000
DIRERR   EQU   *                                                 S21016 06680021
         LA    RERRPASS,GRTHPRIM        DIRECTORY ERROR CODE     S21016 06700021
         B     ERREXIT                                                  06720000
*                                                                       06722021
* ERROR - DIRECTORY SPACE REQUEST IS LARGER THAN THE AMOUNT             06724021
* AVAILABLE ON THE VOLUME.                                              06726021
*                                                                       06728021
TOOMANY  EQU   *                                                 S21016 06730021
         LA    RERRPASS,TOOLARGE        LOAD ERROR CODE          S21016 06732021
         B     ERREXIT                                           S21016 06734021
*                                                                       06740000
* SET UP THE WTG TABLE IN THE WORK AREA WITH THE ID AND ENTRY           06760002
* POINT ADDRESS OF THE NEXT CSECT.                                      06780002
*                                                                       06800000
USERZERO LA    RTTRPTR,ALLOCA4          POINTER TO USER LABEL LOAD UL17 06805017
         SR    REGFTEN,REGFTEN          CLEAR ERROR HOLD REGISTER  UL17 06810017
         SR    REGTEN,REGTEN            CLEAR QUANTITY REQUEST REG UL17 06815017
XCTLH    EQU   *                        BRANCH LABEL             Y02080 06817002
         MVC   WTGMODNM+K6(K2),0(RTTRPTR)  MOVE IN MODULE ID     Y02080 06820002
         MVC   WTGMODEP+C1(K3),K2(RTTRPTR)  MOVE IN MODULE ADDR  Y02080 06840002
*                                                                       06860000
* THIS SECTION INITIALIZES AND RELOCATED TO THE WORKAREA A NEW CHANNEL  06880000
* PROGRAM FOR SUBSEQUENT SPACE ALLOCATION MODULES.                      06900000
*                                                                       06920000
         LM    R0,R9,CCWORD1            LOAD FIRST 5 CCWS               06940000
         ALR   R0,RWKA                                                  06960000
         ALR   R2,RWKA                                                  06980000
        ALR   R4,RWKA                                                   07000000
         ALR   R6,RWKA                                                  07020000
         ALR   R8,RWKA                                                  07040000
         STM   R0,R9,CCW1               STORE FIRST 5 CCWS              07060000
         LM    R0,R9,CCWORD6            LOAD NEXT FIVE CCWS             07080000
         ALR   R0,RWKA                                                  07100000
         ALR   R2,RWKA                                                  07120000
         ALR   R4,RWKA                                                  07140000
         ALR   R6,RWKA                                                  07160000
         ALR   R8,RWKA                                                  07180000
         STM   R0,R5,CCW6               CCWS 6,7 AND 8           S20201 07200020
         STM   R0,R1,CCW9               CCW 9                    S20201 07220020
         STM   R6,R9,CCW10              CCWS 10 AND 11           S20201 07240020
         LR    RERRPASS,REGFTEN         LOAD ERROR PASS REGISTER        07280000
*                                                                       07300000
* THIS SECTION BRANCHES TO A SUBSEQUENT ALLOCATE MODULE.                07320002
*                                                                       07340000
EXITXCTL EQU   *                                                 A37199 07350021
         IECRES LOAD,EXTPR=(RWKA),BRANCH=DIRECT                  Y02080 07360002
*                                                                       07540000
* THIS AREA CHECKS FOR SPACE ON THE TRACK PARTIALLY FILLED BY THE       07560000
* DIRECTORY QUANTITY FOR ONE OR MORE DATA RECORDS.                      07580000
* A BRANCH IS MADE TO TTRCAL TO CALCULATE THE NEW TTRLL                 07600000
*                                                                       07620000
INRECRDS LA    FREEREGA,8               SET UP KL AND DL FOR            07640000
         LA    FREEREGB,256             DIRECTORY RECORD                07660000
         BAL   REGTEN,TTRCAL            GO CALCULATE AVG RCD LENGTH     07680000
*                                                                       07700000
* A BRANCH IS MADE TO RECCAL TO CALCULATE THE LENGTH IN BYTES           07720000
* OF AN AVERAGE RECORD NOT LAST AND LAST.                               07740000
*                                                                       07760000
*                                                                       07780020
         LA    RETNREG,RET1ADDR         SET UP RETURN REG        S20201 07800020
         B     RECCSET                  GO SET UP FOR CALC       S20201 07820020
*                                                                       07840020
RET1ADDR EQU   *                                                 S20201 07860020
*                                                                       07880020
         SR    FREEREGE,FREEREGE        CLEAR HIGH DIVIDEND REGISTER    07900000
         SR    FREEREGO,FREEREGO                                        07920000
         IC    FREEREGO,TTRLL+3         PICK UP NBR OF BYTES REMAINING  07940000
         SLL   FREEREGO,8               ON LAST                         07960000
         IC    FREEREGO,TTRLL+4         DIRECTORY TRACK                 07980000
         DR    FREEREGE,FREEREGA        CALCULATE THE NBR OF AVG RCDS   08000000
*                                       THAT WILL FIT ON LAST DIR TRK   08020000
         LR    RETNREG,FREEREGO         SAVE VALUE                      08040000
         LR    FREEREGO,FREEREGE        LOAD BYTES REMAINING            08060000
         SR    FREEREGE,FREEREGE        CLEAR HIGH DIVIDEND REGISTER    08080000
         DR    FREEREGE,FREEREGB        WILL AVG RCD LAST ON TRK        08100000
         LTR   FREEREGO,FREEREGO        FIT IN BYTES REMAINING          08120000
         BZ    LOADDIRT                 BRANCH IF NO                    08140000
         LA    RETNREG,1(RETNREG)       YES-INCREMENT NBR OF RCDS       08160000
LOADDIRT LA    EXTRPAS1,1               INITIALIZE NBR OF TRKS TO ONE   08180000
         AH    EXTRPAS1,TTRLL           ADD NBR OF TRKS REQUIRED        08200000
SUBTRACT L     FREEREGC,JFCBPQTY        GET PRIMARY QUANTITY            08220000
         SRL   FREEREGC,8               POSITION                        08240000
         CR    RETNREG,FREEREGC         CHECK TO SEE IF ROOM FOR PRI    08260000
*                                       QTY ON DIR TRACK                08280000
         BNL   CLEANUP                  BRANCH IF ROOM FOR ALL PRI QTY  08300000
         SR    FREEREGC,RETNREG         CALCULATE NBR OF AVG RCDS       08320000
*                                       THAT WILL NOT FIT ON DIR TRK    08340000
*                                                                       08360000
* TRKCAL ----  THIS ROUTINE CALCULATES HOW MANY RECORDS OF A GIVEN      08380000
* SIZE WILL FIT ON A TRACK.                                             08400000
* THE LENGTH IN BYTES OF AN AVERAGE RECORD AND OF A LAST RECORD ON A    08420000
* TRACK ARE TO BE IN REGISTERS 4(FREEREGA) AND 5(FREEREGB)              08440000
* RESPECTIVELY                                                          08460000
* THE NUMBER OF BYTES PER TRACK FOR THE DEVICE IS OBTAINED FROM THE     08480000
* DEVICE ENTRY OF THE FORMAT4 DSCB.                                     08500000
* RECORDS PER TRACK = 1 + (TRACK LENGTH-Y) / X                          08520000
*                                                                       08540000
* THE LENGTH OF A LAST RECORD ON A TRACK IS SUBTRACTED FROM THE TRACK   08560000
* LENGTH                                                                08580000
*                                                                       08600000
         LH    FREEREGO,DS4DEVTK        GET NBR OF BYTES PER TRACK      08620000
         SR    FREEREGO,FREEREGB        SUBTRACT Y FROM TRACK LENGTH    08640000
         BNL   SHORTREC                BRANCH IF REMAINDER IS NOT MINUS 08660000
*                                                                       08680000
* THIS SECTION SETS UP REGISTERS FOR THE AVG/RCD CALCULATION ROUTINE    08700000
* FOR AVG/RCD REQUESTS SPECIFYING AN AVG/RCD GREATER THAN A LAST RCD.   08720000
*                                                                       08721002
         SR    R1,R1                    CLEAR REGISTER          SA59784 08722002
         IC    R1,JFCKEYLE              GET KEY LENGTH          SA59784 08723002
         MVC   FULLWORD+C1(L'JFCBDRLH),JFCBDRLH  ALIGN LENGTH   SA59784 08724002
         L     FREEREGO,FULLWORD        LOAD DATA LENGTH        SA59784 08725002
         LA    FREEREGO,0(FREEREGO)     CLEAR HIGH BYTE         SA59784 08726002
         AR    FREEREGO,R1              ADD KEY AND DATA LENGTH SA59784 08727002
         IC    R1,DS4DEVI               GET OVERHEAD FOR KEYED  SA59784 08728002
*                                       NOT LAST RECORD         SA59784 08729002
         TM    DS4DEVFG,TBOVHD          TWO BYTE OVERHEAD       SA59784 08730002
         BZ    NOTTB00                  BRANCH IF NOT           SA59784 08731002
         LH    R1,DS4DEVI               GET TWO BYTE OVERHEAD   SA59784 08732002
NOTTB00  EQU   *                                                SA59784 08733002
         LH    REGEIGHT,DS4DEVTK        GET TRACK CAPACITY      SA59784 08734002
         SR    REGEIGHT,R1              SUBTRACT OVERHEAD       SA59784 08735002
         SR    FREEREGE,FREEREGE        CLEAR FOR DIVIDE        SA59784 08736002
         DR    FREEREGE,REGEIGHT        CALCULATE NUMBER OF     SA59784 08737002
*                                       TRACKS/RECORD           SA59784 08738002
         LTR   FREEREGE,FREEREGE        TEST FOR REMAINDER      SA59784 08739002
         BZ    DONTINCR                 BRANCH IF NONE          SA59784 08740002
         LA    FREEREGO,0(FREEREGO)     MAXIMUM NBR OF TRKS/RCD SA59784 08741002
DONTINCR EQU   *                                                SA59784 08742002
         MR    FREEREGE,R1              CALCULATE TOTAL OVER-   SA59784 08743002
*                                       HEAD FOR EACH RECORD    SA59784 08744002
         AR    FREEREGA,FREEREGO        ADD TO BLOCKSIZE        SA59784 08745002
         LR    FREEREGB,FREEREGA       LOAD NOT LAST RCD LENGTH         08760000
         MR    FREEREGA,FREEREGC       NBR OF RCD REQ TIMES NOT LAST    08780000
         LR    FREEREGO,FREEREGB       SET UP FOR AVG/RCD ROUTINE       08800000
         LH    FREEREGA,DS4DEVTK       GET NBR OF BYTES PER TRACK       08820000
         B     LONGREC                 REC LNGTH MORE THAN TRK/LNGTH    08840000
*                                                                       08860000
* THE RESULT IS DIVIDED BY THE LENGTH OF AN AVERAGE RECORD              08880000
*                                                                       08900000
SHORTREC SR    FREEREGE,FREEREGE       CLEAR HIGH DIVIDEND REGISTER     08920000
         DR    FREEREGE,FREEREGA        CALC NBR OF AVG RCDS PER TRK    08940000
         LR    FREEREGA,FREEREGO                                        08960000
         LA    FREEREGA,1(FREEREGA)     INCREMENT RESULT BY ONE         08980000
         LR    FREEREGO,FREEREGC        LOAD NBR OF RCDS REQUESTED      09000000
LONGREC  SR    FREEREGE,FREEREGE       CLEAR HIGH DIVIDEND REGISTER     09020000
         DR    FREEREGE,FREEREGA        DETERMINE NBR OF TRACKS NEEDED  09040000
         LTR   FREEREGE,FREEREGE        IS THERE A REMAINDER            09060000
         BZ    DONTINC                  BRANCH IF NO                    09080000
         LA    FREEREGO,1(FREEREGO)     ADD 1 IF REMAINDER EXISTS       09100000
DONTINC  AR    EXTRPAS1,FREEREGO        ADD PRI QTY TO DIR QTY          09120000
*                                                                       09140000
* A TEST IS MADE TO SEE IF THE ROUND TO CYLINDER OPTION IS SPECIFIED    09160000
*                                                                       09180000
         TM    JFCBCTRI,X'01'           IS ROUND OPTION REQUESTED       09200000
         BC    1,ROUNDUP                BRANCH IF YES                   09220000
         B     CLEANUP                                                  09280000
*                                                                       09300000
* WHEN THE ROUND TO FULL CYLINDERS OPTION IS GIVEN, THE NUMBER OF       09320000
* TRACKS IS DIVIDED BY THE NUMBER OF TRACKS PER CYLINDER TO SEE IF      09340000
* THERE ARE ANY EXCESS TRACKS, AND IF SO THE NUMBER OF CYLINDERS IS     09360000
* INCREMENTED BY ONE AND RECONVERT TO TRACKS.                           09380000
*                                                                       09400000
ROUNDUP  LR    FREEREGB,EXTRPAS1        LOAD NBR OF TRACKS REQUESTED    09420000
         SR    FREEREGA,FREEREGA        CLEAR HIGH DIVIDEND REGISTER    09440000
         LH    FREEREGE,DS4DEVSZ+2      GET THE NBR OF TRKS/CYL         09460000
         DR    FREEREGA,FREEREGE        CONVERT TRK QTY TO CYLS/TRKS    09480000
         LTR   FREEREGA,FREEREGA        IF THERE IS A TRACK REMAINDER   09500000
         BZ    DONOTINC                 BRANCH IF NO                    09520000
         LA    FREEREGB,1(FREEREGB)     INCREMENT THE NBR OF CYLS       09540000
DONOTINC MH    FREEREGB,DS4DEVSZ+2      RECONVERT CYLS TO TRKS          09560000
         LR    EXTRPAS1,FREEREGB        MOVE REQUEST TO COMM REGISTER   09580000
         B     CLEANUP                                                  09600000
*                                                                       09620000
* THIS SECTION SETS UP TO CALCULATE THE NUMBER OF BYTES REQUIRED        09640000
* FOR AN AVERAGE RECORD NOT LAST AND LAST ON A TRACK FOR NON            09660000
* DIRECTORY REQUESTS.                                                   09680000
*                                                                       09700000
*                                                                       09710020
NOCAL    EQU   *                                                 S20201 09720020
*                                                                       09730020
         LA    RETNREG,RET2ADDR         SETUP RETURN REG         S20201 09740020
         B     RECCSET                  GO SET UP FOR CALC       S20201 09750020
*                                                                       09760020
RET2ADDR EQU   *                                                 S20201 09770020
*                                                                       09780020
         SR    RETNREG,RETNREG          SET NBR OF AVG RCDS ON LAST     09820000
*                                       DIRECTORY TRK TO ZERO           09840000
         LR    EXTRPAS1,RETNREG         SET NBR OF DIR TRKS TO ZERO     09860000
         B     SUBTRACT                                                 09880000
*                                                                       09900000
* RECCAL - - - THIS SUBROUTINE CALCULATES THE LENGTH OF AN AVERAGE      09920000
* RECORD AND A RECORD TO BE LAST ON A TRACK                             09940000
* THE ROUTINE NEEDS THE KEYLENGTH AND DATA LENGTH OF A RECORD IN REGIS- 09960000
* TERS 4 (FREEREGA) AND 5 (FREEREGB) RESPECTIVELY                       09980000
* OVERHEAD CONSTANTS AND DEVICE CONSTANTS ARE ADDRESSED SYMBOLICALLY    10000000
* SO ADDRESSIBILITY MUST HAVE BEEN ESTABLISHED.                         10020000
*                                                                       10025020
RECCSET  EQU   *                                                 S20201 10030020
         SR    FREEREGA,FREEREGA        CLR REG                  S20201 10035020
         IC    FREEREGA,JFCKEYLE        PICK UP KEY LEN          S20201 10040020
         MVC   FULLWORD+C1(THRE),JFCBDRLH MOVE DATA LEN          S20201 10045020
         L     FREEREGB,FULLWORD        PUT IN REG               S20201 10050020
         LA    FREEREGB,C0(FREEREGB)    CLR HI BYTE              S20201 10055020
RECCAL   EQU   *                        BRANCH LABEL             Y02080 10057002
         STM   FREEREGE,FREEREGO,IECREGSV+K12  SAVE REGISTERS    Y02080 10060002
         SR    FREEREGO,FREEREGO        CLEAR WORK REGISTERS            10080000
         SR    REGEIGHT,REGEIGHT                                        10100000
         IC    FREEREGO,DS4DEVI         GET OVERHEAD FOR KEYED NOT LAST 10120000
         IC    REGEIGHT,DS4DEVL         GET OVERHEAD FOR KEYED LAST     10140000
         TM    DS4DEVFG,TBOVHD          TWO BYTE OVERHEAD        S20201 10142020
         BZ    NOTTB10                  BRANCH NO                S20201 10144020
         LH    FREEREGO,DS4DEVI         PICK UP TWO BYTES        S20201 10146020
         LR    REGEIGHT,FREEREGO        USE FOR LAST ALSO        S20201 10148020
NOTTB10  EQU   *                                                 S20201 10150020
*                                                                       10152020
         LTR   FREEREGA,FREEREGA        TEST FOR KEY LENGTH EQUAL TO 0  10160000
         BZ    CALOVHD                  BRANCH IF ZERO                  10180000
ADDKLDL  AR    FREEREGB,FREEREGA        ADD DATA LENGTH TO KEY LENGTH   10200000
         LR    REGNINE,FREEREGB         SAVE VALUE                      10220000
         LH    FREEREGE,DS4DEVTL        GET DEVICE TOLERANCE FACTOR     10240000
         MR    FREEREGA,FREEREGE        (KL+DL)TOL FACTOR - NOT LAST    10260000
         SRDA  FREEREGA,9               SHIFT OUT REMAINDER    @ZA16276 10280037
         AR    FREEREGB,FREEREGO        ADD IN OVERHEAD - NOT LAST      10300000
         LR    FREEREGA,FREEREGB        LOAD IN COMMUNICATION REGISTER  10320000
         B     COMPLETE                                                 10340000
CALOVHD  SR    FREEREGE,FREEREGE        CLEAR WORK REGISTER             10360000
         IC    FREEREGE,DS4DEVK         GET UNKEYED RECORD CONSTANT     10380000
         SR    FREEREGO,FREEREGE        ADJUST KEYED - NOT LAST         10400000
         SR    REGEIGHT,FREEREGE        ADJUST KEYED - LAST             10420000
         B     ADDKLDL                                                  10440000
COMPLETE AR    REGNINE,REGEIGHT         (KL+DL)  LAST RECORD            10460000
         LR    FREEREGB,REGNINE         LOAD IN COMMUNICATION REGISTER  10480000
         LM    FREEREGE,FREEREGO,IECREGSV+K12  RESTORE REGISTERS Y02080 10500002
         BR    RETNREG                                                  10520000
*                                                                       10540000
* TTRCAL ---- THIS ROUTINE UPDATES THE TTRLL OF FORMAT 1 DSCB. IT       10560000
* INCREMENTS TTR AND CALCULATES THE LL = TO THE NUMBER OF BYTES LEFT ON 10580000
* THE LAST USED TRACK.                                                  10600000
* INFORMATION IS PASSED AS FOLLOWS                                      10620000
*        1. NUMBER OF RECORDS USED ON LAST DIR TRACK - FREEREGE = 2     10640000
*        2. NUMBER OF FULL TRACKS - FREEREGO = 3                        10660000
*        3. KEYLENGTH - FREEREGA = 4                                    10680000
*        4. DATA LENGTH - FREEREGB = 5                                  10700000
* A BRANCH IS MADE TO RECCAL TO CALCULATE THE LENGTH IN BYTES OF AN     10720000
* AVERAGE RECORD AND A LAST RECORD ON A TRACK (FOR A DIRECTORY BLOCK)   10740000
*                                                                       10760000
TTRCAL   BAL   RETNREG,RECCAL           GO CALCULATE AVG RCD LENGTH     10780000
         LR    FREEREGO,FREEREGE        LOAD NBR OF RCDS USED ON        10800000
*                                       LAST DIRECTORY TRACK            10820000
*                                                                       10840000
* THE LENGTH OF AN AVERAGE RECORD IS MULTIPLIED TIMES THE NUMBER OF     10860000
* EXCESS RECORDS ON THIS PARTIALLY FILLED TRACK. THE NUMBER OF BYTES    10880000
* USED IS THEN SUBTRACTED FROM THE TOTAL TRACK LENGTH TO DETERMINE THE  10900000
* NUMBER OF AVAILABLE BYTES LEFT                                        10920000
*                                                                       10940000
         BCTR  FREEREGO,0               ACCOUNT FOR EOD                 10960000
         MR    FREEREGE,FREEREGA        MULT NBR OF RCDS BY AVG RCD     10980000
         LH    FREEREGA,DS4DEVTK        GET NBR OF BYTES PER TRACK      11000000
         SR    FREEREGA,FREEREGO        CALC NBR OF UNUSED BYTES        11020000
         SR    FREEREGO,FREEREGO                                        11040000
         IC    FREEREGO,DS4DEVI         PICK UP OVERHEAD                11060000
         TM    DS4DEVFG,TBOVHD          TWO BYTE OVERHEAD        S20201 11063020
         BZ    NOTTB40                  BRANCH NO                S20201 11066020
         LH    FREEREGO,DS4DEVI         GET TWO BYTES            S20201 11069020
*                                                                       11072020
NOTTB40  EQU   *                                                 S20201 11075020
         SR    FREEREGA,FREEREGO        ACCOUNT FOR OVERHEAD   @ZA10233 11080037
         SR    FREEREGO,FREEREGO        CLEAR WK REG           @ZA10233 11088037
         IC    FREEREGO,DS4DEVK         GET UNKEYED VALUE      @ZA10233 11096037
         AR    FREEREGA,FREEREGO        ADJUST FOR UNKEYED     @ZA10233 11104037
         BCTR  FREEREGA,0               ACCOUNT FOR EOF BYTE   @ZA10233 11112037
         STC   FREEREGA,TTRLL+4         SAVE BYTES REMAINING FOR        11120000
         SRL   FREEREGA,8               FORMAT 1 DSCB                   11140000
         STC   FREEREGA,TTRLL+3                                         11160000
         BR    REGTEN                                                   11180000
*                                                                       11200000
* * * * * * * * * * * * *                                               11220000
*                                                                       11240000
***   CONSTANTS                                                         11260000
*                                                                       11280000
* * * * * * * * * * * * *                                               11300000
*                                                                       11320000
MAXTRACK DC    H'32767'                 MAX POSITIVE NBR IN HW   Y02080 11330002
*                                                                       11340000
***   CHANNEL PROGRAM FOR SUBSEQUENT SPACE ALLOCATION MODULES.          11360000
*                                                                       11380000
CCWORD1  CCW   X'16',IDAREA-FIRST,X'70',5   READ R0                     11400000
CCWORD2  CCW   X'92',IDAREA-FIRST,X'60',5   READ COUNT           Y02080 11420002
CCWORD3  CCW   X'A9',CCW4+4-FIRST,X'60',4   SEARCH EQUAL KEY            11440000
CCWORD4  CCW   X'08',CCW2-FIRST,0,0         TIC TO READ COUNT           11460000
CCWORD5  CCW   X'03',0,X'20',1              END SEARCH WITH NOP   13559 11470016
*   BREAK CHANNEL PROGRAM TO PREVENT CREATION OF DUPLICATE DSCBS  13559 11480016
*   ON ERROR RETRIES.                                             13559 11490016
CCWORD6  CCW   X'31',IDAREA-FIRST,X'40',5   SEARCH ID EQUAL             11500000
CCWORD7  CCW   X'08',CCW6-FIRST,0,0         TIC TO SEARCH ID EQUAL      11520000
CCWORD8  CCW   X'0D',DSCBF1-FIRST,X'40',140 WRITE KEY AND DATA          11540000
CCWORD10 CCW   X'08',CCW9-FIRST,0,0         TIC TO SEARCH ID EQUAL      11580000
CCWORD11 CCW   X'0E',DSCBF5-FIRST,X'00',140 READ KEY AND DATA           11600000
ZEROS    EQU   CCWORD10+4               FOUR BYTES OF ZEROS      Y02080 11650002
*                                                                       11660000
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         11680002
*                                                                       11700000
TTRTABLE XCTLTABL ID=(ALLOCA1,5C,ALLOCA2,5D,ALLOCA3,5E,         SA53163X11720021
               ALLOCD2,5H,ALLOCA4,5K),SVC=032,LENGTH=,BRT=YES    Y02080 11770002
         EJECT                                                   Y02080 11820002
*                                                                       12040000
* * * * * * * * * * * * *                                               12060000
*                                                                       12080000
*                                                                       12100000
JFCBKEN  DSECT                                                          12120000
         IEFJFCBN                                                       12160000
         EJECT                                                   Y02080 12170002
*                                                                       12180000
* * * * * * * * * * * * *                                               12200000
*                                                                       12220000
***   DSECT FOR THE PARTIAL DSCB PASSED TO ALLOCATE BY IEHMOVE   A46776 12222021
*                                                                       12240000
* * * * * * * * * * * * *                                               12260000
*                                                                       12280000
         ORG   INFMJFCB                                                 12300000
PD1DSNAM DS    CL44                DATA SET NAME                        12302021
PD1FMTID DS    CL1                 FORMAT IDENTIFIER                    12304021
PD1DSSN  DS    CL6                 DATA SET SERIAL NUMBER               12306021
PD1VOLSQ DS    XL2                 VOLUME SEQUENCE NUMBER               12308021
PD1CREDT DS    XL3                 CREATION DATE                        12310021
PD1EXPDT DS    XL3                 EXPIRATION DATE                      12312021
PD1NOEPV DS    XL1                 NUMBER OF EXTENTS ON VOLUME          12314021
PD1NOBDB DS    XL1                 NUMBER OF BYTES USED IN LAST         12316021
*                                     DIRECTORY BLOCK                   12318021
         DS    XL1                 RESERVED                             12320021
PD1SYSCD DS    CL13                SYSTEM CODE                          12322021
         DS    XL7                 RESERVED                             12324021
PD1DSORG DS    XL2                 DATA SET ORGANIZATION                12326021
PD1RECFM DS    XL1                 RECORD FORMAT                        12328021
PD1OPTCD DS    XL1                 OPTION CODE                          12330021
PD1BLKL  DS    XL2                 BLOCK LENGTH                         12332021
PD1LRECL DS    XL2                 RECORD LENGTH                        12334021
PD1KEYL  DS    XL1                 KEY LENGTH                           12336021
PD1RKP   DS    XL2                 RELATIVE KEY POSITION                12338021
PD1DSIND DS    XL1                 DATA SET INDICATORS                  12340021
PD1SCALO DS    XL4                 SECONDARY ALLOCATION                 12342021
PD1LSTAR DS    XL3                 LAST USED TRACK AND BLOCK ON TRACK   12344021
PD1TRBAL DS    XL2                 BYTES REMAINING ON LAST TRACK USED   12346021
         DS    XL2                 RESERVED                             12348021
PD1EXT1  DS    XL1                 EXTENT TYPE INDICATOR                12350021
         DS    XL2                 UNUSED                               12352021
PDPRIQTY DS    F                   PRIMARY SPACE REQUEST IN TRACKS      12354021
PDDIRQTY DS    F                   NUMBER OF DIRECTORY BLOCKS           12356021
         EJECT                                                   Y02080 12406002
DSCBWKAR IECALLWA EP,F4                 ALLOCATE WORK AREA       Y02080 12520002
         EJECT                                                   Y02080 12570002
CVT      DSECT                          CVT DSECT                Y02080 12620002
         CVT                                                     Y02080 12670002
         END   IGG0325B                                          S21016 54380021
./  ADD  SSI=32510327,NAME=IGG0325C
 TITLE 'IGG0325C - ABSOLUTE TRACK ALLOCATION'                    Y02080 00020002
IGG0325C CSECT                                                          00022021
*                                                                       00022402
*MODULE NAME = IGG0325C                                                 00022802
*                                                                       00023202
*DESCRIPTIVE NAME = ABSOLUTE TRACK ALLOCATION                           00023602
*                                                                       00023702
*COPYRIGHT = NONE                                                       00023802
*                                                                       00023902
*CHANGE ACTIVITY = SEE BELOW                                            00025802
*                                                                       00027802
*          RELEASE 17 DELETIONS                                         00029902
*0092000400.                                                       UL17 00031802
*          RELEASE 18 DELETIONS                                         00033702
*          RELEASE 19 DELETIONS                                         00035602
*          RELEASE 20 DELETIONS                                         00038000
*          RELEASE 21 DELETIONS                                         00041000
*1192019600-019800,020400-020600,054200,068400                   A37199 00041302
*1192010060,025300,028200,028500-028700                          M0705  00043202
*1192000230,000600-002400,003000-003200,004400,018000,020400,    S21016 00045102
*1192026000-026400,028200-029400,054400-055600,062400,062800,    S21016 00047002
*1192064600,086200                                               S21016 00048902
*          RELEASE 22 DELETIONS                                         00050802
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00052702
*0000000030-000200,000470-000530,001560,003100,005400,007200,    Y02080 00054602
*0000007600-007800,008200,010200,018400,020200-020500,027600,    Y02080 00056502
*0000053000,053800-054900,060600,062400,062800-070200,070600-    Y02080 00058402
*0000084400                                                      Y02080 00060302
*                                                                       00062202
*STATUS CHANGE LEVEL 003                                                00064102
*FUNCTION/OPERATION:                                                  * 00066021
*   THIS MODULE PROCESSES ABSTR SPACE ALLOCATION REQUESTS. IT FIRST   * 00076021
*   DETERMINES IF ANY SPACE IS REQUESTED. IF SO, IT DETERMINES IF THE * 00086021
*   QUANTITY REQUESTED IS AVAILABLE AT THE TRACK ADDRESS SPECIFIED.   * 00096021
*   IF THESE CONDITIONS ARE SATISFIED, THIS MODULE CREATES APPROPRIATE* 00106021
*   ENTRIES IN THE DADSM TABLE TO BE USED BY MODULE IGG0325E TO BUILD * 00116021
*   FORMAT 1/FORMAT 3 DSCB'S AND BY MODULE IGG0325G TO UPDATE THE     * 00126021
*   FORMAT 4 AND FORMAT 5 DSCB'S. IF ANY OF THE CONDITIONS CANNOT BE  * 00136021
*   SATISFIED, AN APPROPRIATE ERROR CODE IS LOADED INTO THE ERROR CODE* 00146021
*   PASS REGISTER, AND A BRANCH IS MADE TO THE LAST LOAD OF SPACE     * 00156002
*   ALLOCATION.                                                       * 00166021
*                                                                     * 00260000
*ENTRY POINTS:                                                        * 00280000
*   IGG0325C - ENTRY IS MADE FROM IGG0325B VIA A BRANCH.              * 00310002
*                                                                     * 00340000
*INPUT: UPON ENTRY FROM IGG0325B THE WORK AREA CONTAINS THE DATA      * 00360000
*   PORTION OF THE FORMAT 4 DSCB AND ITS ADDRESS, THE FIRST DADSM     * 00380000
*   RECORD (F5) AND ITS ADDRESS, A CHANNEL PROGRAM TO READ DADSM      * 00400000
*   RECORDS, A DEB, AN IOB, AND AN ECB.                               * 00420000
*   REGISTER 10 WILL CONTAIN THE QUANTITY REQUESTED IN TRACKS.        * 00460000
*   REGISTER 11 WILL POINT TO A JFCB.                                 * 00480000
*   REGISTER 13 WILL POINT TO THE WORK AREA.                          * 00500000
*                                                                     * 00520000
*OUTPUT: UPON TRANSFER OF CONTROL THE WORK AREA AND REGISTERS WILL BE * 00540002
*   AS AT INPUT WITH THE FOLLOWING ADDITIONS.                         * 00560000
*   THE FIRST FORMAT 5 DSCB IN CORE SWITCH WILL BE OFF IF ALLOCATION  * 00580000
*   WAS NOT FROM THE FIRST DADSM RECORD.                              * 00600000
*   THE DADSM TABLE WILL CONTAIN THE EXTENT ALLOCATED.                * 00620000
*                                                                     * 00640000
*EXTERNAL ROUTINES:                                                   * 00660000
*        EXCP(0) - READ FROM OR WRITE TO DIRECT ACCESS DEVICE         * 00680000
*        WAIT(1) - WAIT ON EVENT CONTROL BLOCK                        * 00700000
*        IECRES  - BRANCH TO OTHER MODULES                            * 00720002
*                                                                     * 00740000
*EXITS-NORMAL: BRANCH TO IGG0325E 'F1F3 BUILD'                        * 00760002
*   -ERROR: BRANCH TO IGG0325H WITH CODE IN ERROR PASS REGISTER       * 00780002
*                                                                     * 00800000
*   ERROR CODES THAT CAN BE ISSUED BY MODULE IGG0325C:                * 00820002
*                                                                     * 00840000
*   08 - NO ROOM AVAILABLE IN THE VTOC                                * 00860000
*                                                                     * 00880000
*   0C - PERMANENT I/O ERROR                                          * 00900000
*                                                                     * 00920000
*   10 - REQUESTED ABSOLUTE TRACK NOT AVAILABLE                       * 00940000
*                                                                     * 00960000
*   14 - REQUESTED QUANTITY NOT AVAILABLE                             * 00980000
*                                                                     * 01000000
*   4C - NO SPACE PARAMETER GIVEN FOR A NEW DATA SET OR               * 01002021
*        ZERO SPACE REQUESTED AT ABSOLUTE TRACK ZERO                  * 01004021
*                                                                     * 01006021
*   6C - PRIMARY SPACE REQUEST FOR AN ISAM DATA SET IS ZERO OR        * 01008021
*        PRIMARY SPACE IS ZERO FOR AN ABSTR REQUEST                   * 01010021
*                                                                     * 01012021
*TABLES/WORK AREAS: DADSM WORK AREA DESCRIBED BY MACRO 'IECALLWA'     * 01020002
*                                                                     * 01040000
*              ***************************************                * 01060000
*              *             DADSM TABLE             *                * 01080000
*              ***************************************                * 01100000
*                                                                     * 01120000
*              ***************************************                * 01140000
*              *        *         *                  *                * 01160000
*              *  TYPE  *  NO OF  *     USED HOLE    *                * 01180000
*              *  FLAG  * ENTRIES *      COUNTER     *                * 01200000
*              *        *         *                  *                * 01220000
*              ***************************************                * 01240000
*              *                  *                  *                * 01260000
*              *       RTA        *      RTA+1       *                * 01280000
*              *                  *                  *                * 01300000
*              ***************************************                * 01320000
*              *                  *                  *                * 01340000
*              *       RTA        *      RTA+1       *                * 01360000
*              *                  *                  *                * 01380000
*              ***************************************                * 01400000
*              *                  *                  *                * 01420000
*              *       RTA        *      RTA+1       *                * 01440000
*              *                  *                  *                * 01460000
*              ***************************************                * 01480000
*              *                  *                  *                * 01500000
*              *       RTA        *      RTA+1       *                * 01520000
*              *                  *                  *                * 01540000
*              ***************************************                * 01560000
*              *                  *                  *                * 01580000
*              *       RTA        *      RTA+1       *                * 01600000
*              *                  *                  *                * 01620000
*              ***************************************                * 01640000
*                                                                     * 01660000
*              TYPEFLG  =  02 - BPAM DIRECTORIES REQUESTED.           * 01680000
*                                                                     * 01700000
*                       =  40 - USER LABELS REQUESTED                 * 01704021
*                                                                     * 01708021
*                       =  80 - SET MUST COMPLETE IS ACTIVE           * 01712021
*                                                                     * 01716021
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.  * 01720000
*                                                                     * 01740000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.      * 01760000
*                                                                     * 01780000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT* 01800021
*                                                                     * 01820000
*ATTRIBUTES: REENTRANT                                                * 01840002
*                                                                     * 01860000
*NOTES:                                                               * 01880000
*   OTHER MACROS USED                                                 * 01900000
*   IECALLWA - ALLOCATE WORK AREA EXPANSION                           * 01910002
*   IECSDSL1 - BUILD DSCB'S                                           * 01920000
*   IEFJFCBN - BUILD JFCB                                             * 01940000
*   CVT - BUILD CVT                                                   * 01990002
*                                                                     * 02000000
*STORAGE: PROGRAM CODE - LESS THAN 1024 BYTES                         * 02040002
*   WORK AREA - AS DEFINED IN THE IECALLWA MACRO                      * 02050002
*   RPS WORK AREA - AS DEFINED IN THE IECRPS MACRO                    * 02060002
*                                                                     * 02080000
*                                                                       02100000
*REGISTER NAMES-                                                        02120000
*                                                                       02140000
R0       EQU   0                        WORK REGISTER              UL17 02150000
R1       EQU   1                       WORK REGISTER                    02160000
R2       EQU   2                       WORK REGISTER                    02180000
RCNT     EQU   2                       DADSM PROCESS LOOP CONTROL       02200000
RIN      EQU   3                       INPUT AREA SCAN REGISTER         02220000
ROUT     EQU   4                       OUTPUT AREA SCAN REGISTER        02240000
R7       EQU   7                       WORK REGISTER                    02260000
RTTRPTR  EQU   7                        PTR TO XCTL BY TTR TABLE ENTRY  02280000
RERRPASS EQU   8                        ERROR PASS REGISTER             02300000
RA       EQU   10                      REQUESTED QUANTITY PASS REGISTER 02320000
RJFCB    EQU   11                      JFCB POINTER                     02340000
RBASE    EQU   12                      BASE REGISTER                    02360000
RWKA     EQU   13                      WORK AREA POINTER                02380000
RBAK     EQU   14                      RETURN REGISTER.                 02400000
RERR     EQU   15                      ERROR CODE REGISTER.             02420000
RWRK     EQU   15                      WORK REGISTER.                   02440000
RF       EQU   15                      CHANNEL PROGRAM START POINTER    02460000
*                                                                       02461021
*OTHER EQUATES                                                          02462021
*                                                                       02463021
NOPARAM  EQU   X'4C'                    NO SPACE PARAMETER ERROR M0705  02464021
ZEROSPCE EQU   X'6C'                    ZERO SPACE REQUEST ERROR M0705  02465021
EIGHT    EQU   8                                                   UL17 02466000
TEN      EQU   10                                                  UL17 02472000
*                                                                       02480000
* * * * * * * * * * * * *                                               02500000
*                                                                       02520000
*                                                                       02540000
* * * * * * * * * * * * *                                               02560000
*                                                                       02580000
*                                                                       02660000
*REGISTER USAGE-                                                        02680000
*                                                                       02700000
         BALR  RBASE,0                 SET UP BASE REGISTER.            02720000
         USING START,RBASE                                              02740000
         USING ALLOCWKA,RWKA            WORK AREA ADDRESSABILITY Y02080 02760002
         USING JFCBFLD,RJFCB                                            02780000
*                                                                       02800000
* THIS SECTION TESTS IF ANY SPACE WAS REQUESTED. IF SO, A CHECK         02810021
* IS MADE OF THE AVAILABLE HOLES IN THE VTOC. IF NO SPACE WAS           02815021
* REQUESTED, THE ABSOLUTE TRACK ADDRESS IS TESTED FOR ZERO TO           02820021
* DETERMINE IF A SPACE PARAMETER WAS GIVEN FOR THIS DATA SET.           02825021
*                                                                       02830021
START    EQU   *                                                 S21016 02840021
         OC    JFCBPQTY,JFCBPQTY        ANY SPACE REQUESTED      M0705  02845021
         BNZ   CHEKVTOC                 BRANCH IF YES            M0705  02850021
         LA    RERRPASS,NOPARAM         NO SPACE PARAM ERR CODE  M0705  02855021
         OC    JFCBABST(2),JFCBABST     IS ABSOLUTE TRACK ZERO   M0705  02860021
         BZ    ERREXIT                  BRANCH IF YES            M0705  02865021
         LA    RERRPASS,ZEROSPCE        NO SPACE REQUESTED ERROR M0705  02870021
         B     ERREXIT                                           S21016 02880021
CHEKVTOC EQU   *                                                 S21016 02890021
         LH    RWRK,DS4DSREC           PICK UP VTOC AVAILABLE HOLES.    02960000
         LA    R1,2                    SET TO CHECK FOR TWO HOLES       02980000
         CLR   R1,RWRK                 ARE TWO HOLES AVAILABLE          03000000
         BNH   READ1ST                 BRANCH IF 2 OR MORE HOLES AVAIL  03020000
*                                                                       03040000
* ERROR - INSUFFICIENT HOLES AVAILABLE IN THE VTOC                      03060000
*                                                                       03080000
         LA    RERRPASS,X'08'           SET ERROR CODE 'NO ROOM IN VTOC 03100000
         B     ERREXIT                                                  03120000
*                                                                       03140000
* THIS SECTION INITIALIZES IDAREA AND READS DADSM RECORDS AS REQUIRED.  03160000
*                                                                       03180000
READ1ST  MVC   IDAREA(5),DADSMADR      SET SRCH/SEEK TO 1ST F5          03200000
         EX    0,MOVEF5                REMOVE IDENTIFIER                03220000
         B     RESET                                                    03240000
PREPRD   BAL   RBAK,READF5             READ DADSM RECORD.               03260000
*                                                                       03280000
* THIS SECTION SEARCHES THE CURRENT DADSM RECORD FOR THE ABSOLUTE       03300000
* TRACK REQUESTED.  IT SEARCHES UNTIL IT FINDS AN RTA EQUAL TO OR       03320000
* GREATER THAN THE REQUESTED RTA.  IF GREATER THAN IT CHECKS THE PRIOR  03340000
* EXTENT FOR THE REQUESTED RTA AND NUMBER OF TRACKS.                    03360000
*                                                                       03380000
RESET    LA    RIN,DS5KEYID-1          SET UP POINTER TO SCAN FOR RTA.  03400000
         LA    RCNT,26                 SET TO MAX NUMBER OF EXTENTS     03420000
         LR    RWRK,RIN                SAVE BEGINNING ADDRESS OF F5.    03440000
COMPLOOP CLC   JFCBABST(2),5(RIN)      IS NEXT EXTENT RTA EQUAL TO      03460000
*                                      OR GREATER THAN REQUESTED RTA    03480000
         BL    TEST1                   YES - GO CHECK FOR 1ST ENTRY     03500000
         BE    CHKQTY1                 CHECK TO SEE IF QTY IS AVAILABLE 03520000
         CLC   5(2,RIN),ZEROS          NO - IS NEXT EXTENT ZERO         03540000
         BE    CHECKEXT                BRANCH IF YES                    03560000
         LA    RIN,5(RIN)              UPDATE PTR TO POINT TO NEXT EXT  03580000
         BCT   RCNT,COMPLOOP           IS THIS THE LAST EXT IN RECORD   03600000
*                                                                       03620000
* THIS SECTION CONVERTS THE LAST DADSM EXTENT INTO RTA AND NUMBER       03640000
* OF TRACKS.  IT CHECKS IF THE REQUESTED RTA IS IN THIS EXTENT.         03660000
* IF SO IT CHECKS IF THE REQUESTED QUANTITY CAN BE FILLED.              03680000
*                                                                       03700000
CHECKEXT MVC   CCW12+2(4),0(RIN)       ALIGN TO A HALF WORD.            03720000
         LH    R2,CCW12+4              PICK UP CYLINDERS AVAIL IN EXT   03740000
         MH    R2,DS4DEVSZ+2           CONVERT CYLINDERS TO TRACKS.     03760000
         AH    R2,CCW12+2              COMPUTE  RTA(UPPER)+1.           03780000
         SR    R7,R7                   CLEAR REGISTER.                  03800000
         IC    R7,4(RIN)               PICK UP NUMBER OF TRACKS         03820000
         AR    R2,R7                   ADD NBR OF TRACKS TO RTA         03840000
         MVC   CCW12(2),JFCBABST       GET REQUESTED RTA                03860000
         LH    R7,CCW12                PICK UP REQUESTED RTA.           03880000
         AR    R7,RA                   COMPUTE REQUESTED RTA(UPPER)+1.  03900000
         CLR   R2,R7                   IS EXTENT RTA+1 EQUAL TO OR      03920000
*                                      GREATER THAN REQUESTED RTA+1     03940000
         BNL   MORETST                 YES-CHECK FOR RTA.               03960000
         TM    DS5PTRDS+4,X'FF'        NO-IS THIS THE LAST RECORD.      03980000
         BZ    NOQTY                   YES-QTY IS NOT AVAILABLE.        04000000
         MVC   IDAREA(5),DS5PTRDS      INSERT NEW ADDRESS FOR READ F5.  04020000
         B     PREPRD                  GO READ NEXT RCD AND TEST        04040000
*                                                                       04060000
* CHECK FOR REQUESTED RTA                                               04080000
*                                                                       04100000
MORETST  CLC   CCW12+2(2),CCW12        IS RTA IN THIS EXRENT.           04120000
         BH    NORTA                   BRANCH IF NO                     04140000
         STH   R7,DADSMTBL+6           STORE UPPR RTA INTO DADSMTBL     04160000
         B     INSERTLO                GO AND INSERT LOW RTA.           04180000
*                                                                       04200000
* IF THE NEXT EXTENT IS THE FIRST DADSN RECORD EXTENT AND THE EXTENT    04220000
* RTA IS GREATER THAN THE REQUESTED RTA THEN RTA IS NOT AVAILABLE       04240000
*                                                                       04260000
TEST1    CLR   RWRK,RIN                IS THIS THE 1ST EXTENT           04280000
         BL    CHKQTY                  NO-CHECK FOR QUANTITY AVAILABLE. 04300000
*                                                                       04320000
* ERROR - REQUESTED RTA IS NOT AVAILABLE                                04340000
*                                                                       04360000
NORTA    LA    RERRPASS,X'10'           SET ERROR CODE 'RTA NOT AVAIL   04380000
         B     ERREXIT                                                  04400000
*                                                                       04420000
* ERROR - QUANTITY REQUESTED IS NOT AVAILABLE                           04440000
*                                                                       04460000
NOQTY    LA    RERRPASS,X'14'           SET ERROR CODE 'QTY NOT AVAIL   04480000
         B     ERREXIT                                                  04500000
*                                                                       04520000
* NEXT DADSM EXTENT RTA IS EQUAL TO REQUESTED RTA.  STEP INPUT SCAN     04540000
* POINTER TO ALLOCATE FROM THE NEXT EXTENT.                             04560000
*                                                                       04580000
CHKQTY1  LA    RIN,5(RIN)              STEP TO EXTENT TO BE CONVERTED.  04600000
*                                                                       04620000
* THIS SECTION CONVERTS THE DADSM EXTENT THAT CONTAINS THE REQUESTED    04640000
* RTA INTO RTA AND NUMBER OF TRACKS.  IT CHECKS IF THE SPACE IS         04660000
* SUFFICIENT TO FILL THE REQUESTED QUANTITY.  IF SO IT CHECKS IF THE    04680000
* REQUESTED QUANTITY CAN BE FILLED STARTING WITH THE REQUESTED RTA.     04700000
*                                                                       04720000
CHKQTY   LA    ROUT,F5OUT              INSERT ADDRESS FOR CONV EXTENTS  04740000
         SR    R2,R2                   CLEAR REGISTER                   04760000
         MVC   CCW12(5),0(RIN)         ALIGN EXTENT TO HALF WORD        04780000
         LH    R7,CCW12+2              LOAD NUMBER OF CYLINDERS IN EXT  04800000
         MH    R7,DS4DEVSZ+2           CONVERT TO TRACKS                04820000
         IC    R2,CCW12+4              GET NBR OF EXCESS TRACKS         04840000
         AR    R7,R2                   ADD FOR TOTAL TRACKS AVAILABLE   04860000
         STH   R7,2(ROUT)              TOTAL TRACKS TO OUTPUT AREA      04880000
         MVC   0(2,ROUT),CCW12         MOVE RTA TO OUTPUT AREA          04900000
         CH    RA,2(ROUT)              IS QUANTITY AVAILABLE.           04920000
         BH    NOQTY                   BRANCH IF NO                     04940000
         LH    RWRK,0(ROUT)            PICK UP CONVERTED EXTENT.        04960000
         AH    RWRK,2(ROUT)            COMPUTE UPPER RTA OF CONV EXT    04980000
         MVC   4(2,ROUT),JFCBABST      MOVE REQUESTED RTA TO OUTPUT     05000000
         LH    R1,4(ROUT)              PICK UP REQUEST RTA.             05020000
         CR    RWRK,R1                 EXT RTA1 EQ/LESS THAN ABSTR UL17 05026000
         BNH   NORTA                    BRANCH IF YES              UL17 05032000
         AR    R1,RA                   COMPUTE UPPER RTA FOR REQUEST    05040000
         CR    R1,RWRK                 IS QUANTITY AVAILABLE STARTING   05060000
*                                      AT THIS TRACK                    05080000
         BH    NOQTY                   BRANCH IF NO                     05100000
*                                                                       05120000
* THIS SECTION STORES THE RTA AND RTA+1 FOR THIS REQUEST IN THE         05140000
* DADSM TABLE FOR USE BY THE DADSM UPDATE MODULE.                       05160000
*                                                                       05180000
         STH   R1,DADSMTBL+6           PLACE UPPER RTA OF ALLOCATED     05200000
*                                      SPACE INTO DADSMTBL              05220000
INSERTLO MVC   DADSMTBL+4(2),JFCBABST  INSERT LOW RTA INTO DADSMTBL.    05240000
INSERTNO MVI   DADSMTBL+1,X'01'        INSERT NUMBER OF ENTRIES.        05260000
*                                                                       05280000
* SUCCESSFUL ABSOLUTE TRACK ALLOCATION EXIT.  BRANCH TO A SUBSEQUENT    05300002
* DADSM SPACE ALLOCATION MODULE TO BUILD THE FORMAT 1 DSCB.             05320000
*                                                                       05340000
         LA    RTTRPTR,ALLOCA3          LOAD XCTL PTR TO F1/F3 ENTRY    05360000
         TM    TYPEFLG,USRLBL           USER LABELS REQUESTED      UL17 05361000
         BZ    XCTLHERE                 BRANCH IF NO               UL17 05362000
         LH    R1,DADSMTBL+4            PICK UP ALLOCATED RTA      UL17 05363000
         LH    R0,DADSMTBL+6            PICK UP ALLOCATED RTA+1    UL17 05364000
         LA    R1,1(R1)                                            UL17 05365000
         CR    R1,R0                   U.L. TRKS EQ TO REQ RTA+1   UL17 05366000
         BE    XCTLHERE                 BRANCH IF EQUAL            UL17 05367000
         STH   R1,DADSMTBL+6            STORE USER LABEL RTA+1     UL17 05368000
         STH   R1,DADSMTBL+EIGHT        STORE REQUEST RTA          UL17 05369000
         STH   R0,DADSMTBL+TEN          STORE REQUEST RTA+1        UL17 05370000
         MVI   DADSMTBL+1,X'02'        SET NMBR ENTRIES TO 2       UL17 05371000
XCTLHERE EQU   *                       BRANCH LABEL              Y02080 05380002
         IECRES LOAD,EXTPR=(RWKA),MODID=(RTTRPTR),BRANCH=DIRECT  Y02080 05490002
*                                                                       05580000
* EXECUTE CHANNEL PROGRAM TO READ FORMAT 5 DSCB - DADSM                 05600000
*                                                                       05620000
READF5   LA    RF,CCW9                 START CHAN PROG AT CCW9          05640000
         ST    RF,IOB+16               PLACE START CCW INTO IOB         05660000
         MVC   SEEK+3(4),IDAREA        INSERT SEEK ADDRESS INTO IOB.    05680000
         MVI   ECB,X'00'               CLEAR STATUS BYTE.               05700000
*                                                                       05720000
* THIS SECTION LINKS TO IOS FOR ALL I/O OPERATIONS.                     05740000
*                                                                       05760000
         EXCP  IOB                     EXECUTE CHANNEL PROGRAM.         05780000
         WAIT  ECB=ECB                 WAIT FOR COMPLETION.             05800000
         TM    ECB,X'20'               WAS THERE A PERM I/O ERROR       05820000
         BC    7,MOVEF5                BRANCH IF NO ERROR               05840000
*                                                                       05860000
* ERROR - PERMANENT I/O ERROR.  FREE WORKAREA,SET ERROR CODE,AND EXIT   05880000
*                                                                       05900000
         LA    RERRPASS,X'0C'           SET ERROR CODE 'PERM I/O ERROR  05920000
ERREXIT  LA    RTTRPTR,ALLOCD2          LOAD PTR TO LAST ALLOC LOAD     05940000
         B     XCTLHERE                                                 05960000
*                                                                       05980000
* PREPARE DADSM RECORD FOR RTA SEARCH ROUTINE                           06000000
*                                                                       06020000
MOVEF5   MVC   DS5FMTID(90),DS5MAVET   REMOVE ID FROM DADSM RECORD      06040000
         NI    ASWITCH,X'FF'-FRSTF5    CLEAR 1ST F5 IN CORE SW   Y02080 06060002
         BR    RBAK                    RETURN TO CALLING SEQUENCE.      06080000
*                                                                       06100000
* * * * * * * * * * * * *                                               06120000
*                                                                       06140000
***   CONSTANTS                                                         06160000
*                                                                       06180000
* * * * * * * * * * * * *                                               06200000
*                                                                       06220000
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         06240002
*                                                                       06260000
         XCTLTABL ID=(ALLOCA3,5E,ALLOCD2,5H),SVC=032,BRT=YES,    Y02080X06270002
               LENGTH=                                           Y02080 06320002
         EJECT                                                   Y02080 06370002
DSCBWKAR IECALLWA EP,F4,D1=(1),D2=(5)   ALLOCATE WORK AREA       Y02080 06620002
ZEROS    EQU   CCW4+4                                                   07040000
         EJECT                                                   Y02080 07090002
CVT      DSECT                          CVT DSECT                Y02080 07140002
         CVT                                                     Y02080 07190002
         EJECT                                                   Y02080 07240002
*                                                                       08460000
* * * * * * * * * * * * *                                               08480000
*                                                                       08500000
*                                                                       08520000
* * * * * * * * * * * * *                                               08540000
*                                                                       08560000
JFCBFLD  DSECT                                                          08580000
         IEFJFCBN                                                       08600000
         END   IGG0325C                                          S21016 48600021
./  ADD  SSI=32510328,NAME=IGG0325D
 TITLE 'IGG0325D - DADSM - CYLINDER, TRACK, RECORD ALLOCATION'   Y02080 00020002
IGG0325D CSECT                                                          00021021
*                                                                       00021402
*MODULE NAME = IGG0325D                                                 00021802
*                                                                       00021902
*DESCRIPTIVE NAME = DADSM - CYLINDER, TRACK, RECORD ALLOCATION          00023902
*                                                                       00025902
*COPYRIGHT = NONE                                                       00027902
*                                                                       00029002
*CHANGE ACTIVITY = SEE BELOW                                            00031002
*                                                                       00031402
*          RELEASE 17 DELETIONS                                         00031702
*1462000400,001800,027600,045400-050400,060200,072400,072420-      UL17 00032802
*    072520,078000,079400,084200,086000.                           UL17 00033902
*          RELEASE 18 DELETIONS                                         00035002
*          RELEASE 19 DELETIONS                                         00036002
*          RELEASE 20 DELETIONS                                         00038002
*2410                                                            A34038 00040002
*          RELEASE 21 DELETIONS                                         00042002
*1192001600-001800,002400-002600,003800,005400,007300,017200,    A42477 00044002
*1192019000-019200,019600-019800,025200-025600,029800-030000,    A42477 00046002
*1192031200-031400,042200-042400,072320-072340,074400,083200-    A42477 00048002
*1192083400,084200,086000,089600,107400                          A42477 00050002
*0000000200,000220,000600-001700,004200,007800,028000-028200,    A46776 00052002
*0000039400,039800,040200,050600,051000,072400,077860,084200-    A46776 00054002
*0000086000,107200                                               A46776 00056002
*          RELEASE 22 DELETIONS                                         00058002
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00060002
*0000000030-000200,000220,000400-000440,001600-001700,002400-    Y02080 00062002
*0000002600,004800,006800,007200-007400,009400,017600,019400-    Y02080 00064002
*0000019700,027200,028400-029400,033600,036400,038000,038400,    Y02080 00066002
*0000039000,041800-042300,052400-052800,061400,065400,072000,    Y02080 00068002
*0000072400-073600,074000,074400,083800,084500-091400,091800-    Y02080 00070002
*0000094600,094800-105600                                        Y02080 00072002
*                                                                       00074002
* STATUS CHANGE LEVEL 004                                               00076002
*FUNCTION/OPERATION:  THIS MODULE PROCESSES CYLINDER, TRACK, AND      * 00078002
*   AVERAGE/RECORD SPACE REQUESTS WITH ANY OF THESE OPTIONS: MXIG,    * 00080021
*   ALX, CONTIG, BLANK.  IT ALSO PROCESSES IEHMOVE'S SPACE REQUESTS.  * 00100021
*   IT DETERMINES IF THE REQUESTED SPACE IS AVAILABLE ON THIS VOLUME  * 00120021
*   AND IF YES, ALLOCATES IT.  IT INSURES THAT CYLINDER REQUESTS ARE  * 00140021
*   ON CYLINDER BOUNDARIES.  IT CREATES THE DADSM TABLE ENTRIES TO    * 00150021
*   BE USED BY THE 'F1 AND F3 BUILD' AND 'DADSM UPDATE' ROUTINES.     * 00160002
*                                                                     * 00200000
*ENTRY POINTS:                                                        * 00220000
*   IGG0325D - ENTRY IS MADE FROM IGG0325B OR FROM IGG0325K.          * 00240002
*                                                                     * 00280000
*INPUT: AT ENTRY TO THIS MODULE THE WORK AREA CONTAINS THE DATA       * 00300000
*   PORTION OF THE FORMAT 4 DSCB AND ITS ADDRESS, THE FIRST DADSM     * 00320000
*   RECORD (F5) AND ITS ADDRESS, A DEB, AN IOB, AN ECB, AND A CHANNEL * 00340000
*   PROGRAM TO READ DADSM RECORDS.                                    * 00360000
*   THE FIRST FORMAT 5 DSCB IN CORE SWITCH WILL BE ON.                * 00380021
*   REGISTER 10 WILL CONTAIN THE SPACE REQUEST IN TRACKS.             * 00400000
*   REGISTER 11 WILL POINT TO A JFCB OR PARTIAL DSCB.                 * 00420021
*   REGISTER 13 WILL POINT TO THE WORK AREA.                          * 00440000
*                                                                     * 00460000
*OUTPUT: UPON TRANSFER OF CONTROL, THE WORK AREA AND REGISTERS WILL   * 00480002
*   BE AS AT INPUT WITH THE FOLLOWING ADDITIONS.                      * 00500000
*   REGISTER 10 WILL NO LONGER CONTAIN THE SPACE REQUEST.             * 00520000
*   THE FIRST FORMAT 5 DSCB IN CORE SWITCH WILL BE OFF IF ALLOCATION  * 00540021
*   WAS NOT FROM THE FIRST DADSM RECORD.                              * 00560000
*   THE DADSM TABLE WILL CONTAIN THE EXTENTS ALLOCATED.               * 00580000
*                                                                     * 00600000
*EXTERNAL ROUTINES:                                                   * 00620000
*        EXCP(0) - READ FROM OR WRITE TO DIRECT ACCESS DEVICE         * 00640000
*        WAIT(1) - WAIT ON EVENT CONTROL BLOCK                        * 00660000
*        IECRES  - BRANCH TO OTHER MODULES                            * 00680002
*                                                                     * 00700000
*EXITS-NORMAL: BRANCH TO IGG0325E TO BUILD AND WRITE OUT F1'S AND F3'S* 00720002
*   -ERROR: BRANCH TO IGG0325H WITH CODE IN ERROR CODE PASS REGISTER  * 00740002
*                                                                     * 00760000
*   ERROR CODES THAT CAN BE ISSUED BY THIS MODULE:                    * 00780021
*                                                                     * 00800000
*   08 - NO ROOM AVAILABLE IN THE VTOC                                * 00820000
*                                                                     * 00840000
*   0C - PERMANENT I/O ERROR                                          * 00860000
*                                                                     * 00880000
*   14 - REQUESTED QUANTITY NOT AVAILABLE                             * 00900000
*                                                                     * 00920000
*TABLES/WORK AREAS: DADSM WORK AREA DESCRIBED BY MACRO 'IECALLWA'     * 00940002
*                                                                     * 00960000
*              ***************************************                * 00980000
*              *             DADSM TABLE             *                * 01000000
*              ***************************************                * 01020000
*                                                                     * 01040000
*              ***************************************                * 01060000
*              *        *         *                  *                * 01080000
*              *  TYPE  *  NO OF  *     USED HOLE    *                * 01100000
*              *  FLAG  * ENTRIES *      COUNTER     *                * 01120000
*              *        *         *                  *                * 01140000
*              ***************************************                * 01160000
*              *                  *                  *                * 01180000
*              *       RTA        *      RTA+1       *                * 01200000
*              *                  *                  *                * 01220000
*              ***************************************                * 01240000
*              *                  *                  *                * 01260000
*              *       RTA        *      RTA+1       *                * 01280000
*              *                  *                  *                * 01300000
*              ***************************************                * 01320000
*              *                  *                  *                * 01340000
*              *       RTA        *      RTA+1       *                * 01360000
*              *                  *                  *                * 01380000
*              ***************************************                * 01400000
*              *                  *                  *                * 01420000
*              *       RTA        *      RTA+1       *                * 01440000
*              *                  *                  *                * 01460000
*              ***************************************                * 01480000
*              *                  *                  *                * 01500000
*              *       RTA        *      RTA+1       *                * 01520000
*              *                  *                  *                * 01540000
*              ***************************************                * 01560000
*                                                                     * 01580000
*              TYPEFLG  =  02 - BPAM DIRECTORIES REQUESTED.           * 01600000
*                                                                     * 01604021
*                       =  40 - USER LABELS REQUESTED                 * 01608021
*                                                                     * 01612021
*                       =  80 - SET MUST COMPLETE IS ACTIVE           * 01616021
*                                                                     * 01620000
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.  * 01640000
*                                                                     * 01660000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.      * 01680000
*                                                                     * 01700000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT* 01720021
*                                                                     * 01740000
*ATTRIBUTES: REENTRANT                                                * 01760002
*                                                                     * 01780000
*NOTES:                                                               * 01800000
*   OTHER MACROS USED                                                 * 01820000
*   IECALLWA - ALLOCATE WORK AREA EXPANSION                           * 01830002
*   IECSDSL1 - BUILD DSCB'S                                           * 01840000
*   IEFJFCBN - BUILD JFCB                                             * 01860000
*   CVT - BUILD CVT                                                   * 01870002
*                                                                     * 01880000
*STORAGE: PROGRAM CODE CSECT - LESS THAN 1024 BYTES                   * 01960002
*   WORK AREA - AS DEFINED IN THE IECALLWA MACRO                      * 01970002
*   RPS WORK AREA - AS DEFINED IN THE IECRPS MACRO                    * 01980002
*                                                                     * 02000000
*                                                                       02020000
*REGISTER USAGE:                                                        02040000
*                                                                       02046021
R1       EQU   1                                                 A42477 02052021
RCNT     EQU   1                        LOOP COUNTER                    02060000
ROUT     EQU   2                        OUTPUT POINTER                  02080000
RIN      EQU   3                        DADSM POINTER                   02100000
RTA1     EQU   4                        CONVERSION ROUTINE RTA+1 REG    02120000
R4       EQU   4                                                 A42477 02130021
R5       EQU   5                                                        02140000
RTA      EQU   5                       CONVERSION ROUTINE RTA REG       02160000
R6       EQU   6                                                        02180000
RHH      EQU   6                        CONVERSION ROUTINE TRK REG      02200000
R7       EQU   7                                                        02220000
RCC      EQU   7                        CONVERSION ROUTINE CYL REG      02240000
RTTRPTR  EQU   7                        PTR TO XCTL BY TTR TABLE ENTRY  02260000
R8       EQU   8                                                        02280000
RTRK     EQU   8                        CONTAINS NBR OF TRKS/CYL        02300000
RERRPASS EQU   8                        ERROR PASS REGISTER             02320000
R9       EQU   9                                                        02340000
RA       EQU   10                                                       02360000
REQ      EQU   10                 PRIMARY QUANTITY PASSED FROM CTR      02380000
RJFCB    EQU   11                       JFCB POINTER                    02400000
RBASE    EQU   12                       BASE REGISTER                   02420000
RWKA     EQU   13                       WORK AREA POINTER               02440000
RBAK     EQU   14                 RETURN REGISTER                       02460000
RF       EQU   15                                                       02480000
*                                                                       02481021
* OTHER EQUATES                                                         02482021
*                                                                       02483021
TWO      EQU   2                        CONSTANT OF TWO          Y02080 02485002
FOUR     EQU   4                                                   UL17 02486000
EIGHT    EQU   8                                                   UL17 02492000
*                                                                       02500000
*                                                                       02580000
*        THIS SECT INITIALIZES REGISTERS AND WORK AREAS,CHECKS          02600000
*        DADSM HOLES, CONVERTS THE FIRST DADSM RECORD THAT IS           02620000
*        ALREADY IN CORE, AND CALLS SUBROUTINES TO FILL THE REQUEST.    02640000
*                                                                       02660000
         BALR  RBASE,0                                                  02680000
         USING START,RBASE                                              02700000
         USING ALLOCWKA,RWKA            WORK AREA ADDRESSABILITY Y02080 02720002
         USING JFCBFLD,RJFCB                                            02740000
*                                                                       02742002
START    TM    TYPEFLG,X'40'            TEST FOR USER LABEL        UL17 02750000
         BO    CONTINUE                 BRANCH IF YES              UL17 02760000
         BAL   RBAK,NOTIOERR            CONVERT FIRST FORMAT 5     UL17 02770000
CONTINUE LA    RF,2                     INITIALIZE FOR HOLE CHECK       02780000
         LTR   RJFCB,RJFCB              TEST FOR PARTIAL DSCB    A46776 02800021
         BM    PARTIAL                  BRANCH IF YES            A46776 02820021
TSTCONT  CH    RF,DS4DSREC              CONTIG/MXIG - ARE 2 HOLES AVAIL 02960000
         BH    SETERR                   BRANCH IF NOT            A42477 02990021
TSTCONTA TM    JFCBCTRI,X'08'           IS THIS A CONTIG REQUEST        03020000
         BO    CONTIG                   BRANCH IF YES                   03040000
         TM    JFCBCTRI,X'04'           IS THIS A MXIG REQUEST          03060000
         BO    MXIG                     BRANCH IF YES                   03080000
         CH    RF,DS4DSREC              BLANK/ALX - ARE 3 HOLES AVAIL   03100000
         BNL   SETERR                   BRANCH IF NOT            A42477 03130021
TSTCONTB TM    JFCBCTRI,X'02'           IS THIS AN ALX REQUEST          03160000
         BO    ALX                      BRANCH IF YES                   03180000
         B     BLANK                    NO-GO TO BLANK OPTION           03200000
SETERR   LA    RERRPASS,X'08'           SET ERROR CODE 'INSUFFICIENT    03220000
*                                       HOLES IN THE VTOC               03240000
         B     ERROR                    GO FREE WORK AREA               03260000
*                                                                       03280000
* EXECUTE CHANNEL PROGRAM TO READ DADSM-CHECK FOR PERM I/O ERROR        03300000
*                                                                       03320000
READF5   MVC   IDAREA(5),DS5PTRDS                                       03340000
         NI    ASWITCH,X'FF'-FRSTF5     CLEAR 1ST F5 IN CORE SW  Y02080 03360002
READF5A  MVC   SEEK+3(4),IDAREA                                         03380000
         LA    RF,CCW9                                                  03400000
         ST    RF,IOB+16                                                03420000
         MVI   ECB,X'00'                                                03440000
         EXCP  IOB                                                      03460000
         WAIT  ECB=ECB                                                  03480000
         TM    ECB,X'20'          TEST FOR PERM I/O ERROR               03500000
         BC    1,NOTIOERR                                               03520000
         LA    RERRPASS,X'0C'           SET ERROR CODE 'PERM I/O ERROR  03540000
         B     ERROR                                                    03560000
NOTIOERR MVC   DS5FMTID(90),DS5MAVET    REMOVE ID FROM DADSM RECORD     03580000
*                                                                       03600000
*THIS SECTION CONVERTS DADSM FROM XXYYZ TO RTA - NO OF TRACKS. ASSURES  03620000
*THAT CYLINDER REQUESTS AND AVERAGE RECORD LENGTH REQUESTS WITH ROUND   03640002
*OPTION ARE ALIGNED ON CYLINDER BOUNDARIES                              03660000
*                                                                       03680000
CONVF5   LA    RCNT,26                 SET TO MAX NBR OF EXTENTS        03700000
         LH    RTRK,DS4DEVSZ+2         LOAD NBR OF TRKS/CYL             03720000
         LA    RIN,DS5AVEXT        SET INPUT PTR TO 1ST EXTENT          03740000
         LA    ROUT,DS1DSNAM       SET UP OUTPUT PTR FOR CONVERTED EXTS 03760000
       XC      DS1DSNAM(140),DS1DSNAM  CLEAR OUTPUT AREA                03780000
TESTO    EQU   *                       BRANCH LABEL              Y02080 03790002
         MVC   FULLWORD(FOUR),0(RIN)   ALIGN RTA AND NBR CYLS    Y02080 03800002
         SR    RTA1,RTA1               CLEAR HIGH DIVIDEND REGISTER     03820000
         LH    RTA,FULLWORD            GET RTA                   Y02080 03840002
         LTR   RTA,RTA                 IS THIS EXTENT ZERO              03860000
         BZ    INCRIN                  BRANCH IF YES                    03880000
         LH    RCC,FULLWORD+TWO        GET NUMBER OF FULL CYLS   Y02080 03900002
         MR    RHH,RTRK                CONVERT CYLS TO TRKS             03920000
         LTR   RJFCB,RJFCB             TEST FOR PARTIAL DSCB     A46776 03940021
         BP    TESTYPE                 BRANCH IF NO                     03960000
         TM    PD1SCALO,JFCBCYL        TEST FOR CYLINDER REQUEST A46776 03980021
         BC    1,CYLREQ                BRANCH IF YES                    04000000
         TM    PD1SCALO,JFCBAVR+JFCROUND  TEST IF A RECORD       A46776 04020021
*                                      ROUNDED REQUEST           A46776 04030021
         BC    1,CYLREQ                BRANCH IF YES                    04040000
ADD      IC    RHH,4(RIN)              GET EXCESS TRKS                  04060000
         AR    RCC,RHH                 CALCULATE TOTAL TRKS THIS EXT    04080000
         B     ADDA                    GO STORE RTA AND NBR TRKS        04100000
TESTYPE  TM    JFCBCTRI,X'C0'          IS THIS A CYL REQUEST            04120000
         BO    CYLREQ                  BRANCH IF YES                    04140000
         TM    JFCBCTRI,X'41'          IS THIS A RCD ROUNDED REQ        04160000
         BNO   ADD                     BRANCH IF NO              Y02080 04180002
CYLREQ   DR    RTA1,RTRK               CONVERT RTA TO CYLS AND TRKS     04260000
         LR    RHH,RTA1                SAVE TRK REMAINDER               04280000
         MR    RTA1,RTRK               RECONVERT CYLS TO TRKS           04300000
         LTR   RHH,RHH                 WAS THERE A TRK REMAINDER        04320000
         BZ    ADDA                    BRANCH IF NO                     04340000
         AR    RTA,RTRK                YES-STEP RTA UP TO NEXT CYL      04360000
ADDA     STH   RTA,0(ROUT)             STORE RTA IN OUTPUT              04380000
         STH   RCC,2(ROUT)             STORE NBR OF TRKS AVAIL          04400000
CONT     LA    ROUT,4(ROUT)            STEP OUTPUT POINTER              04420000
INCRIN   LA    RIN,5(RIN)              STEP INPUT POINTER               04440000
         BCT   RCNT,TESTO              BRANCH IF MORE EXTENTS           04460000
         LA    ROUT,DS1DSNAM           RESET OUTPUT POINTER             04480000
         BR    RBAK                                                     04500000
*                                                                       04520000
* THIS SECTION TESTS THAT THERE ARE SUFFICIENT UNUSED DSCB'S            04570021
* TO SATISFY A SPACE REQUEST FROM IEHMOVE.                              04620021
*                                                                       04670021
PARTIAL  EQU   *                                                 A46776 04720021
         CH    RF,DS4DSREC             ASSUME CONTIG - TEST FOR  A46776 05060021
*                                      TWO AVAILABLE DSCB'S      A46776 05070021
         BH    SETERR                  BRANCH IF NO                     05080000
         TM    PD1SCALO,JFCONTIG+JFCMIXG  TEST IF CONTIG OR MXIG A46776 05100021
         BNE   CONTIG                  BRANCH IF YES                    05120000
         CH    RF,DS4DSREC             PROCESS AS BLANK - ARE 3         05140000
*                                      HOLES AVAILABLE                  05160000
         BL    BLANK                   BRANCH IF YES                    05180000
         B     SETERR                  NO-GO SET ERROR CODE             05200000
*                                                                       05220000
* THIS SECTION FINDS THE EXTENT IF CONTIG WAS SPECIFIED.  IT IS         05240002
* ALSO USED FOR THE BLANK OPTION, TO FIND THE AVAILABLE EXTENT          05260002
* WHICH IS LARGER BUT CLOSEST IN SIZE TO THE REQUESTED QUANTITY.        05280002
*                                                                       05300000
CONTIG   MVI   DADSMTBL+6,X'FF'                                         05320000
COMPARE  CH    REQ,2(ROUT)        COMPARE REQUEST TO EXTENT             05340000
         BH    UPREGS             REQUEST TO HIGH GO UPDATE POINTER     05360000
TESTEQ   BE    FILLREQ                                                  05380000
         CLC   2(2,ROUT),DADSMTBL+6    LOW-COMPARE TO DADSM VALUE       05400000
         BNL   UPREGS                  TO HIGH UPDATE POINTER           05420000
BLKENTRY MVC   DADSMTBL+4(4),0(ROUT)   MOVE EXTENT TO DADSMTAB          05440000
UPREGS   LA    ROUT,4(ROUT)                                             05460000
         CLC   0(2,ROUT),ZEROS          IS THIS THE END OF EXTENTS      05480000
         BH    COMPARE            NO- GET NEXT                          05500000
         TM    DS5PTRDS+4,X'FF'   IS A CHAIN ADDRESS AVAILABLE          05520000
         BZ    FILLCONT           FILL REQUEST                          05540000
         BAL   RBAK,READF5        READ NEXT DADSM RECORD                05560000
         B     COMPARE            RETURN FOR MORE                       05580000
BLANK    CH    REQ,2(ROUT)        COMPARE REQUEST TO EXTENT             05600000
         BE    FILLREQ            GO FILL REQUEST                       05620000
         BL    BLKENTRY           REQUEST CAN BE FILLED AS CONTIGUOUS   05640000
         BAL   14,PSHDOWN         GO TO PUSHDOWN LIST                   05660000
         LA    ROUT,4(ROUT)       INCREMENT EXTENT POINTER              05680000
         CLC   0(2,ROUT),ZEROS          IS THIS THE END OF EXTENTS      05700000
         BH    BLANK              NO- GET NEXT                          05720000
         TM    DS5PTRDS+4,X'FF'   IS A CHAIN AVAILABLE                  05740000
         BZ    FINDEXT            NO-PROCESS PUSHDOWN LIST              05760000
         BAL   14,READF5          YES-READ NEW DADSM DSCB               05780000
         B     BLANK              RETURN FOR MORE                       05800000
*                                                                       05820000
* ALX OPTION SPECIFIED                                                  05840000
*                                                                       05860000
MXIG     EQU   *                                                   UL17 05870000
ALX      CH    REQ,2(ROUT)        COMPARE REQUEST TO EXTENT             05880000
         BH    HIREQ              HIGH REQUEST                          05900000
         BAL   14,PSHDOWN         GO TO PUSHDOWN LIST                   05920000
HIREQ    LA    ROUT,4(ROUT)       INCREMENT POINTER                     05940000
         CLC   0(2,ROUT),ZEROS          IS THIS THE END OF EXTENTS      05960000
         BH    ALX                NO- GET NEXT                          05980000
         TM    DS5PTRDS+4,X'FF'   IS A CHAIN AVAILABLE                  06000000
         BZ    CKETYPE                  BRANCH IF NO               UL17 06020000
         BAL   14,READF5          READ NEXT DADSM DSCB                  06040000
         B     ALX                RETURN FOR MORE                       06060000
CKETYPE  TM    JFCBCTRI,X'04'           IS THIS MXIG REQUEST       UL17 06066000
         BO    FINDEXT                  BRANCH IF YES              UL17 06072000
         TM    TYPEFLG,X'40'            TEST FOR USER LABEL      A34038 06073020
         BNO   MOVELIST                 BRANCH IF NOT            A34038 06074020
         LA    RF,4                     INITIALIZE FOR 4 ENTRIES A34038 06075020
         B     TABLEPTR                 GO POINT TO DADSM TABLE  A34038 06076020
MOVELIST LA    RF,5                                                     06080000
TABLEPTR EQU   *                                                 A34038 06090020
         LA    R8,DADSMTBL+4      START OF DADSM TABLE POINTER          06100000
         SR    R9,R9                                                    06120000
         LA    R6,PDLIST1               POINT TO PUSHDOWN LIST   Y02080 06140002
         CLC   0(4,R6),ZEROS            IS LIST BLANK                   06160000
         BE    QTYNOTAV           REQUEST CAN NOT BE FILLED             06180000
ALXMOVE  LH    R5,0(R6)           MOVE EXTENTS TO DADSM TABLE           06200000
         STH   R5,0(R8)                                                 06220000
         AH    R5,2(R6)                                                 06240000
         STH   R5,2(R8)                                                 06260000
         LA    R9,1(R9)           ADD ONE TO NUMBER OF EXTENTS          06280000
         LA    R8,4(R8)           UPDATE POINTER                        06300000
         LA    R6,4(R6)           UPDATE LIST POINTER                   06320000
         CLC   0(4,R6),ZEROS            ARE THERE MORE EXTENTS          06340000
         BE    EXTNO              GO TO ENTER NUMBER OF EXTENTS         06360000
         BCT   RF,ALXMOVE                                               06380000
         ST    RF,PDLIST5               CLEAR LAST SLOT IN PDLIST       06400000
         B     EXTNO              END OF TABLE                          06420000
*                                                                       06440000
* THIS ROUTINE BUILDS A PUSHDOWN LIST WHEN MORE THAN ONE EXTENT IS      06460000
* NEEDED TO FILL QTY REQUESTED (BLANK OR ALX OPTION)                    06480000
*                                                                       06500000
PSHDOWN  LA    R5,4                                                     06520000
         LA    R6,PDLIST1               ADDRESS OF PUSHDOWN LIST Y02080 06540002
         LA    R7,4(R6)      POINT  TO SECOND EXTENT IN LIST            06560000
FINDLOW  CLC   2(2,R6),2(R7)                                            06580000
         BNH   UPREG                                                    06600000
         LR    R6,R7                                                    06620000
UPREG    LA    R7,4(R7)                                                 06640000
         BCT   R5,FINDLOW                                               06660000
         CLC   2(2,ROUT),2(R6)    EXTENT IN LIST LOWER THAN NEW         06680000
         BNH   PSHRTRN                                                  06700000
         MVC   0(4,R6),0(ROUT)    REPLACE LOW EXTENT IN LIST            06720000
PSHRTRN  BR    RBAK               RETURN                                06740000
*                                                                       06760000
*   EXIT ROUTINES                                                       06780000
*                                                                       06800000
QTYNOTAV LA    RERRPASS,X'14'           SET ERROR CODE 'QTY NOT AVAIL   06820000
*                                                                       06840000
* TRANSFER CONTROL TO THE LAST MODULE OF SPACE ALLOCATION TO RELEASE    06860000
* THE WORK AREA,DEQ THE VTOC,PASS THE ERROR CODE,AND EXIT TO CALLER.    06880000
*                                                                       06900000
ERROR    LA    RTTRPTR,ALLOCD2          LOAD PTR TO LAST ALLOC LOAD     06920000
         B     XCTLHERE                                                 06940000
*                                                                       06960000
FILLCONT TM    DADSMTBL+6,X'FF'     IS DADSM TABLE EMPTY.               06980000
         BO    QTYNOTAV           YES QUANTITY NOT AVAILABLE            07000000
         STH   REQ,DADSMTBL+6          ENTER REQUEST                    07020000
         B     RTARTA1                 GO CHANGE FORMAT                 07040000
FILLREQ  STH   REQ,DADSMTBL+6          FILL REQUEST FROM POINTER        07060000
         MVC   DADSMTBL+4(2),0(ROUT)                                    07080000
RTARTA1  LH    R5,DADSMTBL+4      ENTER EXTENTS IN DADSMTBL FORMAT      07100000
         AH    R5,DADSMTBL+6                                            07120000
         STH   R5,DADSMTBL+6                                            07140000
         MVI   DADSMTBL+1,X'01'   ENTER ONE EXTENT                      07160000
*                                                                       07180000
* SET UP WTG TABLE TO BRANCH TO THE F1/F3 SPACE ALLOCATION MODULE.      07200002
*                                                                       07220000
EXRQFILL TM    TYPEFLG,X'40'            TEST FOR USER LABEL        UL17 07222000
         BZ    LOADPTR                  BRANCH IF NOT              UL17 07224000
         IC    R9,DADSMTBL+1            NUMBER OF ENTRIES IN TABLE UL17 07226000
         LA    R9,1(R9)                 INCREMENT FOR USER LABEL   UL17 07228000
         STC   R9,DADSMTBL+1            PLACE IN TABLE             UL17 07230000
         LM    R1,R4,DADSMTBL+4         MOVE ENTRIES             A42477 07232021
         STM   R1,R4,DADSMTBL+EIGHT       FOR USER LABEL         A42477 07234021
         MVC   DADSMTBL+4(FOUR),USERLBL                            UL17 07236000
LOADPTR  LA    RTTRPTR,ALLOCA3                                     UL17 07238000
*                                                                       07380000
* BRANCH TO A SUBSEQUENT DADSM ALLOCATE MODULE.                         07400002
*                                                                       07420000
XCTLHERE EQU   *                        BRANCH LABEL             Y02080 07430002
         IECRES LOAD,EXTPR=(RWKA),MODID=(RTTRPTR),BRANCH=DIRECT  Y02080 07440002
*                                                                       07460000
FINDEXT  LA    R8,DADSMTBL+4      DADSMTBL POINTER                      07480000
         TM    TYPEFLG,X'40'            TEST FOR USER LABEL      A34038 07483020
         BNO   INIT5ENT                 BRANCH IF NOT            A34038 07486020
         LA    RF,4                     INITIALIZE FOR 4 ENTRIES A34038 07489020
         B     ZEROREG9                 GO ZERO REGISTER 9       A34038 07492020
INIT5ENT EQU   *                                                 A34038 07495020
         LA    RF,5                                                     07500000
ZEROREG9 EQU   *                                                 A34038 07510020
         SR    R9,R9                                                    07520000
FINDMLTI LR    R5,RF                    LOAD INNER LOOP COUNTER         07540000
         LA    R6,4(R8)                 PUSHDOWN LIST POINTER           07560000
         LA    R7,4(R6)           POINTER TO NEXT VALUE                 07580000
COMPVAL  BCTR  R5,0                     DECREMENT COUNT                 07600000
         CLC   2(2,R6),2(R7)            FIND LOW ENTRY                  07620000
         BNL   UPPTR2             UPDATE POINTER TO NEXT VALUE          07640000
         LR    R6,R7              UPDATE OLD TO NEW HIGH                07660000
UPPTR2   LA    R7,4(R7)                                                 07680000
         LTR   R5,R5                    IS LOOP COMPLETED               07700000
         BNE   COMPVAL                  BRANCH IF NO                    07720000
         CLC   2(2,R6),ZEROS            TEST FOR ZERO QUANTITY          07740000
         BE    QTYNOTAV                                                 07760000
         LH    R7,2(R6)           LOAD TRACK VALUE OF HIGH EXTENT       07780000
         LTR   RJFCB,RJFCB              TEST FOR PARTIAL DSCB    A46776 07786021
         BM    BLKREQ                   BRANCH IF YES              UL17 07792000
         TM    JFCBCTRI,X'04'           TEST FOR MXIG              UL17 07798000
         BO    LASTFILL                 BRANCH TO FILL MXIG        UL17 07804000
BLKREQ   SR    REQ,R7                                              UL17 07810000
         LTR   REQ,REQ            TEST                                  07820000
         BZ    LASTFILL           ZERO LAST EXTENT FILLS REQUEST        07840000
         BM    SHAVE              EXTENT EXCEEDS REQUEST                07860000
         MVC   0(2,R8),0(R6)      MORE EXTENTS NEEDED                   07880000
         AH    R7,0(R8)                                                 07900000
         STH   R7,2(R8)           STORE RTA+1 IN DADSM TABLE            07920000
         LA    R9,1(R9)                 ADD 1 TO NUMBER TO ALLOCATEUL17 07940000
         LA    R8,4(R8)           UPDATE DADSMTBL POINTER               07960000
         MVC   0(4,R6),0(R8)            PDLIST 1ST ENTRY TO USED ENTRY  07980000
         MVC   0(4,R8),ZEROS            CLEAR NEXT DADSM ENTRY          08000000
         BCT   RF,FINDMLTI        GET NEXT EXTENT                       08020000
         B     QTYNOTAV                                                 08040000
SHAVE    AR    R7,REQ                                                   08060000
LASTFILL MVC   0(2,R8),0(R6)                                            08080000
         AH    R7,0(R8)                                                 08100000
         STH   R7,2(R8)           STORE RTA+1 IN DADSM TABLE            08120000
         LA    R9,1(R9)                                                 08140000
EXTNO    STC   R9,DADSMTBL+1      STORE NUMBER OF EXTENTS ALLOCATED     08160000
         B     EXRQFILL           GO TO EXIT                            08180000
*                                                                       08200000
* * * * * * * * * * * * *                                               08220000
*                                                                       08240000
***   CONSTANTS                                                         08260000
*                                                                       08280000
* * * * * * * * * * * * *                                               08300000
*                                                                       08360000
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         08380002
*                                                                       08400000
         XCTLTABL ID=(ALLOCA3,5E,ALLOCD2,5H),SVC=032,BRT=YES,    Y02080C08450002
               LENGTH=                                           Y02080 08500002
         EJECT                                                   Y02080 08550002
DSCBWKAR IECALLWA EP,F4,D1=(1),D2=(5)   ALLOCATE WORK AREA       Y02080 08740002
ZEROS    EQU   CCW4+4                                                   09160000
USERLBL  EQU   CCW10+4                                             UL17 09470000
         EJECT                                                   Y02080 09520002
CVT      DSECT                          CVT DSECT                Y02080 09570002
         CVT                                                     Y02080 09620002
         EJECT                                                   Y02080 09670002
*                                                                       10580000
* * * * * * * * * * * * *                                               10600000
*                                                                       10620000
* * * * * * * * * * * * *                                               10640000
*                                                                       10660000
JFCBFLD  DSECT                                                          10680000
         IEFJFCBN                                                       10700000
         EJECT                                                   Y02080 10710002
*                                                                       10750021
* * * * * * * * * * * * *                                               10800021
*                                                                       10850021
***   DSECT FOR THE PARTIAL DSCB PASSED TO ALLOCATE BY IEHMOVE   A46776 10900021
*                                                                       10950021
* * * * * * * * * * * * *                                               11000021
*                                                                       11050021
         ORG   INFMJFCB                                                 11100021
PD1DSNAM DS    CL44                DATA SET NAME                        11150021
PD1FMTID DS    CL1                 FORMAT IDENTIFIER                    11200021
PD1DSSN  DS    CL6                 DATA SET SERIAL NUMBER               11250021
PD1VOLSQ DS    XL2                 VOLUME SEQUENCE NUMBER               11300021
PD1CREDT DS    XL3                 CREATION DATE                        11350021
PD1EXPDT DS    XL3                 EXPIRATION DATE                      11400021
PD1NOEPV DS    XL1                 NUMBER OF EXTENTS ON VOLUME          11450021
PD1NOBDB DS    XL1                 NUMBER OF BYTES USED IN LAST         11500021
*                                     DIRECTORY BLOCK                   11550021
         DS    XL1                 RESERVED                             11600021
PD1SYSCD DS    CL13                SYSTEM CODE                          11650021
         DS    XL7                 RESERVED                             11700021
PD1DSORG DS    XL2                 DATA SET ORGANIZATION                11750021
PD1RECFM DS    XL1                 RECORD FORMAT                        11800021
PD1OPTCD DS    XL1                 OPTION CODE                          11850021
PD1BLKL  DS    XL2                 BLOCK LENGTH                         11900021
PD1LRECL DS    XL2                 RECORD LENGTH                        11950021
PD1KEYL  DS    XL1                 KEY LENGTH                           12000021
PD1RKP   DS    XL2                 RELATIVE KEY POSITION                12050021
PD1DSIND DS    XL1                 DATA SET INDICATORS                  12100021
PD1SCALO DS    XL4                 SECONDARY ALLOCATION                 12150021
PD1LSTAR DS    XL3                 LAST USED TRACK AND BLOCK ON TRACK   12200021
PD1TRBAL DS    XL2                 BYTES REMAINING ON LAST TRACK USED   12250021
         DS    XL2                 RESERVED                             12300021
PD1EXT1  DS    XL1                 EXTENT TYPE INDICATOR                12350021
         DS    XL2                 UNUSED                               12400021
PDPRIQTY DS    F                   PRIMARY SPACE REQUEST IN TRACKS      12450021
PDDIRQTY DS    F                   NUMBER OF DIRECTORY BLOCKS           12500021
         END   IGG0325D                                          A42477 50720021
./  ADD  SSI=71540435,NAME=IGG0325E
 TITLE 'IGG0325E - DADSM - BUILD F1/F3 ROUTINE'                         00020000
IGG0325E CSECT                                                          00020521
*                                                                       00020902
*MODULE NAME = IGG0325E                                                 00021302
*                                                                       00021402
*DESCRIPTIVE NAME = DADSM - BUILD F1/F3 ROUTINE                         00023302
*                                                                       00025302
*COPYRIGHT = NONE                                                       00025702
*                                                                       00025802
*CHANGE ACTIVITY = SEE BELOW                                            00025902
*                                                                       00026002
*          RELEASE 16 DELETIONS                                         00027802
*009206610662-0668                                                 7493 00029702
*1462086400,113200                                                 AAAA 00031602
*1462                                                             13559 00033502
*          RELEASE 17 DELETIONS                                         00035402
*1708000230,000550,009600,009800,033600,046200-046800,052200-      UL17 00037302
*    054000,054800,067400,068200-069000,070600,073800-077400,      UL17 00039202
*    090800-091000.                                                UL17 00041102
*          RELEASE 18 DELETIONS                                         00043002
*2410054680,054920,056000,059800                                  22833 00044902
*          RELEASE 19 DELETIONS                                         00046802
*          RELEASE 20 DELETIONS                                         00048702
*1027063200                                                      A36720 00050602
*1027054650-054920,064200                                        A32526 00052502
*1027062200                                                      S20016 00054402
*1027                                                            A31576 00056302
*          RELEASE 21 DELETIONS                                         00058202
* 063200                                                         M1769  00060102
*1192002600,003800-004000,021600-021800,022200-022400,066600-    A42477 00062002
*1192067400,073400,090400,092600,096800                          A42477 00063902
*1192060000                                                      M0184  00065802
*1192000210,019600,028800-029400,089400-089600,090400,092600,    S21042 00067702
*1192117200                                                      S21042 00069602
*0000001600-002000,006000,040800,054400,055400,055800,056400-    A46776 00071502
*0000058200,067000-069800,070860,071400,072200-072400,084600-    A46776 00073402
*0000084800,085800-086200,090400-092600,115200-115800            A46776 00075302
*          RELEASE 22 DELETIONS                                         00077202
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00079102
*0000000030-000150,000640-000704,004000,006600,007200,008800,    Y02080 00081002
*0000009400-010200,011800,020000,022000-022300,027544,030200,    Y02080 00082902
*0000031400,070200,072400-072600,073000,073400-073600,090000,    Y02080 00084802
*0000090300-098600,099000-114600,115896-116600,117000            Y02080 00086702
*0000                                                            Y02144 00088602
*0000                                                            Y02082 00090502
*0000009000,021200,084700,085000-086600,089200-089500,112800-    YM3995 00090902
*0000113000,116600-117000                                        YM3995 00091302
*                                                                     * 00091402
*          VS2 SU32 DELETIONS                                  @G32DSFS 00091700
*D055920-056140,055920-056040                                  @G32DSFS 00091800
*          VS2 RELEASE 03.0 DELETIONS/CHANGES                         * 00091900
*0000089500                                                     ZA00704 00092000
*          VS2 RELEASE 03.7 CHANGES/SU808                               00092100
*A064312-064330,C064333                                        @ZA15055 00092200
*                                                                       00092600
*STATUS CHANGE LEVEL 007                                                00094302
*FUNCTION/OPERATION: THIS MODULE BUILDS AND WRITES FORMAT 1 AND       * 00096202
*   FORMAT 3 DSCB'S AS REQUIRED.  IT PROCESSES THE ALLOCATED SPACE    * 00098102
*   EXTENTS IN THE DADSM TABLE TO GENERATE THE F1/F3 EXTENTS.  THIS IS* 00100000
*   ACCOMPLISHED BY LINKING TO THE 'TTR CONVERT ROUTINE' TO CONVERT   * 00120000
*   THE DADSM TABLE 'RTA' FORM EXTENTS INTO 'CCHH' FORM.  THE         * 00140000
*   OTHER APPROPRIATE FORMAT 1 DSCB FIELDS ARE FILLED WITH DATA       * 00160021
*   TAKEN FROM EITHER A JFCB OR A PARTIAL DSCB.  IF A DIRECTORY       * 00180021
*   IS REQUESTED, A CHECK IS MADE TO DETERMINE IF THE DIRECTORY       * 00200021
*   QUANTITY REQUESTED WILL FIT INTO THE LARGEST EXTENT ALLOCATED     * 00220000
*   TO THIS REQUEST.                                                  * 00240000
*   THE VTOC HAS BEEN ENQ'ED BY IGG0325A, AND AS THIS MODULE CHANGES  * 00260021
*   SPACE EXTENTS IN THE VTOC IT WILL PERFORM A 'SET MUST COMPLETE'   * 00280000
*   FUNCTION PRIOR TO THE FIRST WRITE.                                * 00300000
*   DEFINES DATA SETS TO RAC IF AUTOMATIC DATA SET PROTECTION  @Z40RSGD 00310032
*   IS INDICATED IN THE JFCB.                                  @Z40RSGD 00312032
*                                                                     * 00320000
*ENTRY POINTS:                                                        * 00340000
*        IGG0325E - ENTRY IS MADE FROM IGG0325B ON A ZERO QUANTITY    * 00360000
*   REQUEST, FROM IGG0325K FOR A ZERO QUANTITY REQUEST SPECIFYING     * 00370021
*   USER LABELS, FROM IGG0325C FOR AN ABSOLUTE TRACK REQUEST, AND     * 00380021
*   FROM IGG0325D FOR CYLINDER, TRACK, OR RECORD SPACE REQUESTS.      * 00390021
*                                                                     * 00420000
*INPUT: UPON ENTRY TO THIS MODULE THE WORK AREA CONTAINS THE DATA     * 00440000
*   PORTION OF THE FORMAT 4 DSCB AND ITS ADDRESS, THE ADDRESS OF THE  * 00460000
*   FIRST DADSM RECORD (F5), A DEB, AN IOB, AN ECB, AND A CHANNEL     * 00480000
*   PROGRAM TO SEARCH FOR HOLES AND WRITE FORMAT 1 AND FORMAT 3       * 00500000
*   DSCB'S.  IF THE FIRST DADSM RECORD IS STILL IN CORE THE 'FIRST    * 00520000
*   FORMAT 5 DSCB IN CORE SWITCH' WILL BE ON.                         * 00540000
*   THE DADSM TABLE WILL CONTAIN THE ACTUAL SPACE ALLOCATED TO THIS   * 00560000
*   REQUEST IF OTHER THAN A ZERO QUANTITY REQUEST.                    * 00580000
*   REGISTER 11 WILL POINT TO A JFCB OR A PARTIAL DSCB.               * 00600021
*   REGISTER 13 WILL POINT TO THE WORK AREA.                          * 00620000
*                                                                     * 00640000
*OUTPUT: UPON TRANSFER OF CONTROL, THE WORK AREA AND REGISTERS WILL   * 00660002
*   BE AS AT INPUT.  FORMAT 1 DSCB'S AND FORMAT 3 DSCB'S WILL BE      * 00680000
*   WRITTEN OUT ON THIS VOLUME AS REQUIRED.                           * 00700000
*   IF NOT AN ERROR EXIT THE 'SET MUST COMPLETE INDICATOR' WILL BE ON.* 00720002
*   IF DIRECTORIES WERE REQUESTED THE LOW CCHH OF THE FIRST FORMAT 1  * 00740000
*   DSCB EXTENT WILL BE SAVED IN THE WORK AREA.                       * 00760000
*                                                                     * 00780000
*EXTERNAL ROUTINES:                                                   * 00800000
*        CVTPCNVT - TTR CONVERSION ROUTINE                            * 00820000
*        EXCP(0) - READ FROM OR WRITE TO DIRECT ACCESS DEVICE         * 00840000
*        WAIT(1) - WAIT ON EVENT CONTROL BLOCK                        * 00860000
*        STATUS  - SET STEP MUST COMPLETE IN THE TCB                  * 00900002
*        IECRES  - BRANCH TO OTHER MODULES                            * 00910002
*                                                                     * 00920000
*EXITS-NORMAL: BRANCH TO IGG0325H WITH ZERO IN THE ERROR CODE PASS    * 00940002
*              REGISTER ON ZERO QUANTITY REQUESTS.  BRANCH TO         * 00960002
*              IGG0325G ON ALL OTHER REQUESTS TO UPDATE F5 DSCBS.     * 01000002
*   -ERROR: BRANCH TO IGG0325H WITH CODE IN ERROR CODE PASS REGISTER. * 01020002
*                                                                     * 01040000
*   ERROR CODES THAT CAN BE ISSUED BY 'BUILD F1/F3 ROUTINE'           * 01060000
*                                                                     * 01080000
*   0C - PERMANENT I/O ERROR                                          * 01100000
*                                                                     * 01120000
*   38 - DIRECTORY QUANTITY REQUEST ERROR                             * 01140000
*                                                              @Z40RSGD 01150032
*   A8 - RACDEF FAILED DATA SET ALREADY DEFINED.               @Z40RSGD 01152032
*                                                              @Z40RSGD 01154032
*   AC - USER NOT AUTHORIZED TO DEFINE DATA SET.               @Z40RSGD 01156032
*                                                                     * 01160000
*TABLES/WORK AREAS: DADSM WORK AREA DESCRIBED BY MACRO 'IECALLWA'     * 01180002
*                                                                     * 01200000
*              ***************************************                * 01220000
*              *             DADSM TABLE             *                * 01240000
*              ***************************************                * 01260000
*                                                                     * 01280000
*              ***************************************                * 01300000
*              *        *         *                  *                * 01320000
*              *  TYPE  *  NO OF  *     USED HOLE    *                * 01340000
*              *  FLAG  * ENTRIES *      COUNTER     *                * 01360000
*              *        *         *                  *                * 01380000
*              ***************************************                * 01400000
*              *                  *                  *                * 01420000
*              *       RTA        *      RTA+1       *                * 01440000
*              *                  *                  *                * 01460000
*              ***************************************                * 01480000
*              *                  *                  *                * 01500000
*              *       RTA        *      RTA+1       *                * 01520000
*              *                  *                  *                * 01540000
*              ***************************************                * 01560000
*              *                  *                  *                * 01580000
*              *       RTA        *      RTA+1       *                * 01600000
*              *                  *                  *                * 01620000
*              ***************************************                * 01640000
*              *                  *                  *                * 01660000
*              *       RTA        *      RTA+1       *                * 01680000
*              *                  *                  *                * 01700000
*              ***************************************                * 01720000
*              *                  *                  *                * 01740000
*              *       RTA        *      RTA+1       *                * 01760000
*              *                  *                  *                * 01780000
*              ***************************************                * 01800000
*                                                                     * 01820000
*              TYPEFLG  =  02 - BPAM DIRECTORIES REQUESTED.           * 01840000
*                                                                     * 01844021
*                       =  40 - USER LABELS REQUESTED                 * 01848021
*                                                                     * 01852021
*                       =  80 - SET MUST COMPLETE IS ACTIVE           * 01856021
*                                                                     * 01860000
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.  * 01880000
*                                                                     * 01900000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.      * 01920000
*                                                                     * 01940000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT* 01960021
*                                                                     * 01980000
*ATTRIBUTES: REENTRANT                                                * 02000002
*                                                                     * 02020000
*NOTES:                                                               * 02040000
*   OTHER MACROS USED                                                 * 02060000
*   IECALLWA - ALLOCATE WORK AREA EXPANSION                           * 02070002
*   IECSDSL1 - BUILD DSCB'S                                           * 02080000
*   IEFJFCBN - BUILD JFCB                                             * 02100000
*   IECDSECS - EXPANDS THE CVT, PSA,TCB,JFCB, AND SCVT DSECTS         * 02120032
*                                                                     * 02140000
*                                                                     * 02210021
*STORAGE: PROGRAM CODE CSECT - LESS THAN 1024 BYTES                   * 02220002
*   WORK AREA - AS DEFINED IN THE IECALLWA MACRO                      * 02230002
*   RPS WORK AREA - AS DEFINED IN THE IECRPS MACRO                    * 02240002
*                                                                     * 02260000
*                                                                       02280000
*REGISTER USAGE:                                                        02300000
*                                                                       02320000
R0       EQU   0                                                        02340000
R1       EQU   1                                                        02360000
R2       EQU   2                                                        02380000
RHH      EQU   2                        ALIGN CHECK WORK REG            02400000
R3       EQU   3                                                        02420000
RCC      EQU   3                        ALIGN CHECK WORK REG            02440000
RTABL    EQU   4                        POINTER TO DADSM TABLE          02460000
RXNUM    EQU   5                        EXTENT SEQUENCE NUMBER          02480000
RXPTR    EQU   6                        POINTER TO F1/F3 EXTENT FIELD   02500000
RCNT     EQU   7                        NUMBER OF ENTRIES IN DADSM TBL  02520000
RTTRPTR  EQU   7                        PTR TO XCTL BY TTR TABLE ENTRY  02540000
RTRK     EQU   8                        CONTAINS TRKS/CYL               02560000
RERRPASS EQU   8                        ERROR PASS REGISTER             02580000
DRBAK    EQU   9                        CHAN PROG RETURN REGISTER       02600000
RWORK    EQU   9                        WORK REGISTER          @ZM43025 02610032
RJFCBA   EQU   10                       ALTERNATE JFCB POINTER          02620000
RJFCB    EQU   11                                                       02640000
RBASE    EQU   12                 BASE REGISTER                         02660000
RWKA     EQU   13                 WORK AREA BASE                        02680000
RBAK     EQU   14                 RETURN REGISTER                       02700000
RERR     EQU   15                 ERROR CODE REGISTER                   02720000
RCVT     EQU   15                       CONVERSION ROUTINE LINK REG     02740000
*                                                                       02744020
* OTHER EQUATES                                                         02748020
*                                                                       02752020
ONEENTRY EQU   1                        ONE DADSMTBL ENTRY       A46776 02752221
K1       EQU   1                        CONSTANT OF ONE          Y02082 02752402
STEPMC   EQU   1                        STATUS STEP MC INDICATOR YM3995 02752802
TWO      EQU   2                        CONSTANT OF TWO          A46776 02753021
FOUR     EQU   4                        CONSTANT OF FOUR       @ZM43025 02754032
DSORGPO  EQU   X'02'                    DSORG = PO IN F1 DSCB    A36720 02756020
DSORGU   EQU   X'01'                    UNMOVABLE BIT IN DSORG   M1769  02758021
RDWOPSWD EQU   X'04'                    DSCB RD-W/O-PASSWORD BIT Y02080 02758402
* EQUATES FOR RACDEF SUPPORT                                   @Z40RSGD 02758532
DS1RACDF EQU   X'40'                    DS1DSIND-DATA SET IS   @Z40RSGD 02758632
*                                       RAC DEFINED            @Z40RSGD 02758732
RACERR   EQU   X'A4'                    USED TO CONSTRUCT RAC  @Z40RSGD 02764032
*                                       ERROR CODES            @Z40RSGD 02766032
RESBITS  EQU   X'13'                    DSORG RESERVE BITS       Y02080 02769432
*                                                                       02774732
* * * * * * * * * * * * *                                               02780000
*                                                                       02800000
*                                                                       02820000
* * * * * * * * * * * * *                                               02840000
*                                                                       02860000
* REGISTER USAGE                                                        02910021
*                                                                       02960000
         BALR  RBASE,0                                                  02980000
         USING BLDF1F3,RBASE                                            03000000
         USING ALLOCWKA,RWKA            WORK AREA ADDRESSABILITY Y02080 03020002
         USING CVT,RCVT                                                 03040000
         USING JFCBFLD,RJFCB                                            03060000
*                                                                       03080000
BLDF1F3  MVI   CCW11+4,X'10'            SET SKIP FLAG IN WRT CK CCW     03100000
         XC    DS1DSNAM(140),DS1DSNAM   CLEAR FORMAT 1 DSCB AREA        03120000
         NI    SWITCH,X'FF'-PRCNTL      CLEAR CONTROL SWITCH     Y02080 03140002
         LR    RJFCBA,RJFCB             INITIALIZE ALTERNATE JFCB PTR   03160000
         SR    RCNT,RCNT                                                03180000
         IC    RCNT,ENTRYNUM           GET NBR OF DADSMTBL ENTRIES      03200000
         LTR   RCNT,RCNT               IS THIS A ZERO QTY REQUEST       03220000
         BZ    BLDF1                   BRANCH IF YES                    03240000
*                                                                       03260000
* THIS SECTION CHECKS IF THE FIRST ENTRY IN THE DADSMTBL WILL FILL      03280000
* THE DIRECTORY QUANTITY REQUESTED.  BLANK AND ALX OPTION               03300000
*                                                                       03320000
         LA    R2,ENTRIES              POINT TO FIRST DADSMTBL ENTRY    03340000
       TM      TYPEFLG,X'42'            DIRECTORIES OR USER LABEL UL17  03360000
         BZ    FIRSTPAS                BRANCH IF NO                     03380000
         LA    R2,ENTRIES+4            BYPASS THE FIRST DADSMTBL ENTRY  03400000
         LH    R0,ENTRIES+2            GET 1ST ENTRY RTA+1              03420000
         SH    R0,ENTRIES              CALCULATE NBR OF TRKS            03440000
         CH    R0,TTRLL                WILL THE 1ST ENTRY FILL DIR REQ  03460000
         BNH   DIRERR                   BRANCH IF NO                    03480000
         BCT   RCNT,FIRSTPAS           DECREMENT COUNT AND GO SORT      03500000
         B     START1                  ONE ENTRY - BYPASS SORT          03520000
*                                                                       03540000
* DIRECTORY ERROR - BLANK OR ALX OPTION.  THE FIRST ENTRY IN THE        03560000
* DADSMTBL WILL NOT FILL THE DIRECTORY QUANTITY REQUESTED.              03580000
*                                                                       03600000
DIRERR   LA    RERRPASS,X'38'           SET ERROR CODE 'DIR QTY ERROR   03620000
         B     ERREXIT                                                  03640000
*                                                                       03660000
*                                                                       03680000
* ROUTINE TO SORT DADSM TABLE INTO ASCENDING RTA SEQUENCE               03700000
*                                                                       03720000
FIRSTPAS LR    RTABL,R2                SET UP DADSMTBL POINTER          03740000
         LR    R3,RCNT                 LOAD SORT LOOP COUNTER           03760000
DCOUNT   BCT   R3,NEWPAIR              ARE THERE MORE COMPARISIONS      03780000
         BCT   RCNT,FIRSTPAS           NO-ANY MORE SORT PASSES          03800000
         B     START1                  BRANCH IF NO                     03820000
NEWPAIR  CLC   0(2,RTABL),4(RTABL)     FIRST HIGHER THAN SECOND         03840000
         BL    SHIFT                   BRANCH IF NO                     03860000
         LM    R0,R1,0(RTABL)          LOAD THESE TWO ENTRIES           03880000
         ST    R0,4(RTABL)             EXCHANGE THESE                   03900000
         ST    R1,0(RTABL)                  TWO ENTRIES                 03920000
SHIFT    LA    RTABL,4(RTABL)          STEP DADSMTBL PTR TO NEXT PAIR   03940000
         B     DCOUNT                                                   03960000
*                                                                       03980000
* THIS SECTION CALCULATES CCHHCCHH OF EACH EXTENT AND STORES THEM IN    04000000
* THE F1 DSCB. THE EXTENT NUMBER IS ALSO STORED HERE.                   04020000
*                                                                       04040000
START1   TM    SWITCH,PRCNTL           IS PROCESS CONTROL SWITCH ON     04060000
         BO    EXIT6A                   BRANCH IF YES            A46776 04080021
         IC    RCNT,ENTRYNUM      PICK UP NUMBER OF ENTRIES IN TABLE    04100000
RESET1   LA    RTABL,ENTRIES-2          POINT TO 1ST ENTRY IN DADSM TBL 04120000
         LA    RXPTR,DS1EXT1-4          INITIALIZE EXTENT POINTER       04140000
         SR    RXNUM,RXNUM        CLEAR EXTENT SEQ REGISTER             04160000
         LA    R1,3               INSERT MAXIMUM EXTENTS IN F1 DSCB.    04180000
         CLR   R1,RCNT                 IS FORMAT 3 DSCB NEEDED.         04200000
         BL    BLDF3              YES- GO AND CREATE F3 DSCB.           04220000
RETURNF1 LA    DRBAK,BLDF1             INSERT RETURN ADDRESS            04240000
BIGLOOP  LA    RBAK,UPPEREXT      INSERT RETURN ADDRESS                 04260000
CALEXT   STC   RXNUM,5(RXPTR)           INSERT EXTENT NUMBER            04280000
CALOOP   LH    R0,2(RTABL)              GET LOW RTA                     04300000
GOCVT    SLL   R0,16                   POSITION RTA TO 'TT' OF TTR0     04320000
         STM   DRBAK,RWKA,REGSAVEA     SAVE REGISTERS                   04340000
         ST    RBAK,PDLIST5            SAVE RETURN REGISTER             04360000
         LA    R1,DEB                   LOAD DEB POINTER                04380000
         LA    R2,MBBCCHHR              LOAD POINTER TO 8 BYTE AREA     04400000
         L     RCVT,CVTPTR              LOAD COMM VECT TABLE BASE       04420000
         L     RCVT,CVTPCNVT            LOAD CONVERSION ROUTINE BASE    04440000
         LR    R3,RWKA                  SAVE WORKAREA POINTER           04460000
         BALR  RBAK,RCVT                GO TO CONVERSION ROUTINE        04480000
         LM    DRBAK,RWKA,REGSAVEA-FIRST(R3)  RESTORE REGISTERS         04500000
         L     RBAK,PDLIST5            RESTORE RETURN REGISTER          04520000
         MVC   6(4,RXPTR),MBBCCHHR+3    MOVE CCHH TO EXTENT             04540000
         BR    RBAK                                                     04560000
UPPEREXT LA    RTABL,2(RTABL)           UPDATE POINTER FOR UPPER RTA    04580000
         LA    RXPTR,4(RXPTR)           UPDATE POINTER FOR UPPER CCHH   04600000
NOTSPLIT LH    R0,2(RTABL)              GET UPPER RTA+1                 04700000
         BCTR  R0,0                     DECREMENT TO HIGH RTA           04720000
         BAL   RBAK,GOCVT               GO TO CONVERSION ROUTINE        04740000
*                                                                       04760000
* THIS ROUTINE TESTS WHETHER EXTENT IS CYLINDER ALIGNED AND SETS        04780000
* THE ALIGNMENT CODE IN THE EXTENT TYPE FIELD.                          04800000
*                                                                       04820000
ALIGNCHK SR    RHH,RHH                  CLEAR DIVIDION REG              04840000
         LH    RCC,0(RTABL)             GET LOW RTA                     04860000
         LH    RTRK,DS4DEVSZ+2          GET TRKS/CYL                    04880000
         DR    RHH,RTRK                 CONVERT TO CCHH                 04900000
         LTR   RHH,RHH                  IS THERE A TRK REMAINDER        04920000
         BNE   NOTALIGN                 BRANCH IF YES                   04940000
         LH    RCC,2(RTABL)             GET HIGH RTA                    04960000
         DR    RHH,RTRK                 CONVERT TO CCHH                 04980000
         LTR   RHH,RHH                  IS THERE A TRK REMAINDER        05000000
         BNE   NOTALIGN                 BRANCH IF NO                    05020000
         MVI   0(RXPTR),X'81'           SET ALIGN CODE                  05040000
         B     ALIGNRTN                                                 05060000
NOTALIGN MVI   0(RXPTR),X'01'           SET NOT ALIGN CODE              05080000
ALIGNRTN BCT   RCNT,UPDATE1                                             05100000
         BR    DRBAK                    RETURN TO CALLING ROUTINE       05120000
UPDATE1  LA    RTABL,2(RTABL)     UPDATE DADSM TABLE POINTER            05140000
         LA    RXNUM,1(RXNUM)     INCREMENT EXTENT SEQUENCE CTR         05160000
         LA    RXPTR,6(RXPTR)                                           05180000
         B     BIGLOOP            BRANCH TO CLACULATE NEXT EXTENT       05200000
*                                                                       05420000
* THIS SECTION BUILDS A FORMAT 1 DSCB FROM A PARTIAL F1 DSCB.           05440021
*                                                                       05460000
BLDF1    EQU   *                                                 A32526 05470020
         TM    TYPEFLG,SMCDONE     HAS MUST CMPLT BEEN SET        22833 05496018
         BO    BLDF1B                   BRANCH IF YES                   05500000
         BAL   DRBAK,DOSMC              GO SET MUST COMPLETE            05520000
BLDF1B   EQU   *                                                 A46776 05530021
         LTR   RJFCB,RJFCB              TEST IF PARTIAL DSCB     A46776 05540021
         BP    BLDF1A                                                   05560000
         MVC   DS1DSNAM(PD1LSTAR-PD1DSNAM),PD1DSNAM  MOVE IN     A46776 05580021
*                                       THE FORMAT 1 DSCB FIELDS A46776 05590021
         MVC   DS1LSTAR(5),TTRLL                                        05620000
         B     EXIT5A                                                   05840000
*                                                                       05860000
* BUILD FORMAT 1 DSCB ROUTINE                                           05880000
*                                                                       05900000
BLDF1A   MVI   DS1FMTID,X'F1'                                           05920000
         MVC   DS1DSSN(6),JFCBVOLS      INSERT FILE SERIAL NUMBER       05940000
         MVI   DS1VOLSQ+1,X'01'        INSERT VOLUME SEQUENCE NUMBER    05960000
         MVC   DS1SYSCD(13),SYSCODE     MOVE IN SYSTEM CODE      M0184  05990021
         MVC   DS1LSTAR(5),TTRLL       INSERT LAST TRACK USED AND       06020000
*                                      SPACE REMAINING ON LAST TRACK    06040000
         MVC   DS1SCALO(4),JFCBCTRI     MOVE IN SPACE PARAMETERS        06060000
*                                                                       06070032
* SET RAC PROTECTED INDICATOR IF REQUESTED.                    @Z40RSGD 06072032
*                                                                       06074032
         TM    JFCFLGS1,JFCBADSP        AUTO DATA SET PROTECT  @Y40RSGD 06076032
         BZ    NORACBIT                 NO-CONTINUE            @Z40RSGD 06078032
         OI    DS1DSIND,DS1RACDF        YES-SET RAC PROTECTED  @Z40RSGD 06078432
*                                       BIT                    @Z40RSGD 06078832
NORACBIT EQU   *                        RAC INDICATOR IN DSCB  @Z40RSGD 06079232
*                                       CORRECT                @Z40RSGD 06079632
         DROP  RJFCB                                                    06080000
         USING JFCBFLD,RJFCBA                                           06100000
EXIT5    MVC   DS1DSNAM(44),JFCBDSNM                                    06120000
         MVC   DS1CREDT(6),JFCBCRDT     INSERT CREATION AND EXPIRATION  06140000
         MVC   DS1DSORG(8),JFCDSORG     INSERT DSORG FIELD              06160000
*                                       RECORD FORMAT, OPTION CODE,     06180000
*                                       BLOCK AND RECORD LENGTH.        06200000
         NI    DS1DSORG+K1,X'FF'-RESBITS CLEAR THE RESERVED BITS Y02082 06205002
         TM    JFCBIND2,JFCBSCTY        DOES JFCB SPEC SECURITY  S20016 06220020
         BZ    NOSECTY                  BRANCH IF NO                    06240000
         OI    DS1DSIND,X'10'           SET SECURITY BIT IN DSCB F1     06260000
         TM    JFCBIND2,JFCBRWPW        DOES JFCB SPEC RWPW OPTN S20016 06265020
         BNO   NOSECTY                  BRANCH IF NO             S20016 06270020
         OI    DS1DSIND,RDWOPSWD        IND SECTY IS FOR WR ONLY S20016 06275020
NOSECTY  CLC   JFCBDQTY(3),ZEROS        IS THIS A DIRECTORY REQUEST     06280000
         BE    MOVEKEY                  BRANCH IF NO                    06300000
         NI    DS1DSORG,DSORGU          LEAVE UNMOVABLE BIT ON   M1769  06310021
         OI    DS1DSORG,DSORGPO         SET DSORG=PO IN F1 DSCB  M1769  06320021
MOVEKEY  MVC   DS1KEYL(1),JFCKEYLE      INSERT KEY LENGTH               06340000
         MVC   DS1RKP(2),JFCRKP         INSERT RELATIVE KEY POSITION    06360000
         DROP  RJFCBA                                                   06380000
         USING JFCBFLD,RJFCB                                            06400000
EXIT5A   EQU   *                                                 A32526 06404020
         IC    R0,ENTRYNUM              PICK UP NO. EXTENTS      A32526 06408020
         TM    TYPEFLG,X'40'            USER LABELS REQUESTED    A32526 06412020
         BZ    NOUSER                   BRANCH IF NO             A32526 06416020
         MVI   DS1EXT1,X'40'            INSERT USER LABEL IND    A32526 06420020
         BCTR  R0,0                     DO NOT COUNT U.L. EXTENT A32526 06424020
NOUSER   EQU   *                                                 A32526 06428020
         STC   R0,DS1NOEPV              PUT # EXTENTS IN DSCB  @Z40RSGD 06428432
*                                                                       06430032
* DEFINE DATA SET TO RAC IF REQUESTED                          @Z40RSGD 06430432
*                                                                       06430832
         LTR   RJFCB,RJFCB              TEST FOR PARTIAL DSCB  @G32DSFS 06430932
         BNP   RACDEFOK                 YES,SKIP RACDEF        @G32DSFS 06431032
         L     RCVT,CVTPTR              GET CVT ADDRESS        @ZA15055 06431232
         L     RCVT,CVTRAC              LOAD ACCESS CNTL       @ZA15055 06431532
         LA    RCVT,0(,RCVT)            CLEAR HI-ORD           @ZA15055 06431832
         LTR   RCVT,RCVT                RAC ACTIVE?            @ZA15055 06432132
         BNZ   TST2                     YES-GO TO NEXT TEST    @ZA15055 06432432
         NI    DS1DSIND,X'FF'-DS1RACDF  INSURE RAC PROTECT OFF @ZA15055 06432732
         B     RACDEFOK                 NO-RAC CONTINUE        @ZA15055 06433032
TST2     TM    DS1DSIND,DS1RACDF        RACDEF NECESSARY       @ZA15055 06433332
         BZ    RACDEFOK                 NO-CONTINUE            @Z40RSGD 06433632
         MVC   RACDEF(LRACDEF),MRACDEF  INITIALIZE RACDEF      @Z40RSGD 06433932
*                                       PARAMETER LIST         @Z40RSGD 06434232
         RACDEF ENTITY=DS1DSNAM,        DEFINE NEW DS TO RAC   @Z40RSGDX06435732
               VOLSER=MIELNAME,                                @Z40RSGDX06437532
               MF=(E,RACDEF)                                   @Z40RSGD 06439532
         LTR   RERR,RERR                RACDEF SUCCESSFUL      @Z40RSGD 06442032
         BZ    RACDEFOK                 YES-CONTINUE           @Z40RSGD 06442432
* RACDEF FAILED SET ERROR CODE X'A8' FOR PREVIOUSLY DEFINED    @Z40RSGD 06442832
* AND X'AC' IF USER NOT AUTHORIZED TO ISSUE RACDEF             @Z40RSGD 06442932
         LA    RERRPASS,RACERR(RERR)    SET ERROR CODE         @Z40RSGD 06443032
         B     ERREXIT                  ERROR TERMINATE ALLOC  @Z40RSGD 06443132
RACDEFOK EQU   *                        RACDEF PROCESSING      @Z40RSGD 06449232
*                                       COMPLETE               @Z40RSGD 06451232
         BAL   DRBAK,BCHNLGO            WRITE F1 DSCB            A32526 06461732
*                                                                       06467832
* THIS SECTION UPDATES THE HIGH WATER MARK AND THE HOLE COUNT IN        06473932
* THE VTOC DSCB                                                         06480000
*                                                                       06500000
         CLC   IDAREA(5),DS4HPCHR      TEST FOR HI WATER MARK           06520000
         BNH   OLDHIWAT                                                 06540000
         MVC   DS4HPCHR(5),IDAREA      MOVE IN NEW HI WATER MARK        06560000
OLDHIWAT LH    RTABL,DS4DSREC           GET NUMBER OF AVAIL HOLES       06580000
         BCTR  RTABL,0                  DECREMENT COUNT BY ONE          06600000
         STH   RTABL,DS4DSREC           RESET NUMBER OF AVAIL HOLES     06620000
         MVC   CCHHR(5),IDAREA     SAVE CCHHR OF F1 DSCB         S21042 06630021
         CLI   ENTRYNUM,X'00'           IS THIS A ZERO QTY REQUEST      06640013
         BNE   TSTDIR                   BRANCH IF NO             A46776 06700021
         SR    RERRPASS,RERRPASS        ZERO ERROR PASS REGISTER A46776 06760021
ERREXIT  EQU   *                                                 A46776 06770021
         LA    RTTRPTR,ALLOCD2          POINT TO LAST LOAD       A46776 06780021
         B     EXIT6B                   GO XCTL                  A46776 06800021
TSTDIR   EQU   *                                                 A46776 06850021
         TM    TYPEFLG,DIRREQ           IS THIS A DIRECTORY REQ  A46776 06920021
         BZ    EXIT6                    BRANCH IF NO             A46776 06940021
         MVC   SLOWCCHH,DS1EXT1+TWO     SAVE LOW CCHH            A46776 06960021
*                                                                       07000000
* THIS SECTION DETERMINES IF THE DADSMTBL MUST BE RESORTED.             07020002
*                                                                       07040000
EXIT6    TM    TYPEFLG,X'42'            DIRECTORIES OR USER LABEL UL17  07060000
         BZ    EXIT6A                  BRANCH IF NO                     07080000
         CLI   ENTRYNUM,ONEENTRY        TEST FOR ONE ENTRY       A46776 07086021
         BE    EXIT6A                   YES, DO NOT SORT EXTENTS A31576 07092020
         OI    SWITCH,PRCNTL           SET PROCESS CONTROL SWITCH       07100000
         LA    R2,ENTRIES               LOAD PTR TO DADSMTBL ENTRIES    07120000
         SR    RCNT,RCNT                                                07160000
         IC    RCNT,ENTRYNUM           GET NBR OF DADSMTBL ENTRIES      07180000
         B     FIRSTPAS                GO RE-SORT THE DADSMTBL          07200000
EXIT6A   EQU   *                                                 A46776 07210021
         LA    RTTRPTR,ALLOCD1          POINT TO UPDATE MODULE   A46776 07220021
EXIT6B   EQU   *                                                 A46776 07232021
*                                                                       07280000
* BRANCH TO A SUBSEQUENT SPACE ALLOCATION MODULE.                       07300002
*                                                                       07320000
         IECRES LOAD,EXTPR=(RWKA),MODID=(RTTRPTR),BRANCH=DIRECT  Y02080 07340002
*                                                                       07760000
* THIS ROUTINE BUILDS AND WRITES F3 DSCB                                07780000
*                                                                       07800000
BLDF3    MVC   DS1DSNAM(4),THREES INSERT FORMAT THREE KEY.              07820000
         MVI   DS1FMTID,X'F3'                                           07840000
         LA    RTABL,12(RTABL)                                          07860000
         SR    RCNT,R1            COMPUTE NUMBER OF EXTENTS REMAINING.  07880000
         LA    RXPTR,DS1DSNAM           SET PTR TO EXTENT FIELD OF F3   07900000
         LA    RXNUM,3            GET EXTENT SEQ NUMBER.                07920000
         BAL   DRBAK,BIGLOOP            CREATE F3 EXTENTS               07940000
         BAL   DRBAK,DOSMC              GO SET MUST COMPLETE            07960000
WRTF3    BAL   DRBAK,BCHNLGO            WRITE F3 DSCB                   07980000
         MVC   DS1PTRDS(5),IDAREA       MOVE CHAIN ADDRESS TO F1        08000000
         XC    DS1DSNAM+45(90),DS1DSNAM+45    ZERO DSCB.                08020000
         LA    RCNT,3             INSERT NUMBER OF EXT IN F1            08040000
         LH    RTABL,DS4DSREC           GET NUMBER OF AVAIL HOLES       08060000
         BCTR  RTABL,0                  DECREMENT COUNT BY ONE          08080000
         STH   RTABL,DS4DSREC           RESET NUMBER OF AVAIL HOLES     08100000
         B     RESET1                                                   08120000
*                                                                       08140000
* THIS SECTION LINKS WITH IOS FOR ALL I/O OPERATIONS                    08160000
*                                                                       08180000
BCHNLGO  EQU   *                                                  13559 08200016
         MVC   SEEK+3(4),VTOCADR       INSERT SEEK ADDRESS        13559 08220016
         LA    R0,CCW1                 START CHANNEL PROGRAM ...  13559 08240016
         ST    R0,IOB+16                  AT CCW1.                13559 08260016
         MVI   ECB,X'00'               CLEAR STATUS BYTE          13559 08280016
         EXCP  IOB                     SEARCH FOR F0              13559 08300016
         WAIT  ECB=ECB            WAIT FOR COMPLETION.                  08320000
         TM    ECB,X'20'               TEST FOR PERMANENT I/O ERROR.    08340000
         BZ    IOERROR                 BRANCH IF ERROR            13559 08342016
         MVC   CCW7+4(4),CCW2          SAVE CCW2                  13559 08344016
         LA    R0,CCW6                                            13559 08346016
         ST    R0,CCW2                 PREPARE TO TIC TO CCW6     13559 08348016
         MVI   CCW2,X'08'              INSERT TIC OP CODE         13559 08350016
         MVI   CCW6,X'B1'              MULTI-TRACK SEARCH         13559 08352016
         MVI   ECB,X'00'               CLEAR STATUS BYTE          13559 08354016
         EXCP  IOB                     WRITE DSCB                 13559 08356016
         WAIT  ECB=ECB                                            13559 08358016
         MVC   CCW2(4),CCW7+4          RESTORE CCW2               13559 08360016
         MVI   CCW6,X'31'              SINGLE TRACK SEARCH        13559 08362016
         TM    ECB,X'20'               TEST FOR PERM I/O ERROR    13559 08364016
         BCR   5,DRBAK                 RETURN IF NO ERROR         13559 08366016
*                                                                       08380000
* ERROR - PERMANENT I/O ERROR                                           08400000
*                                                                       08420000
IOERROR  EQU   *                                                  13559 08430016
         LA    RERRPASS,X'0C'           SET ERROR CODE 'PERM I/O ERROR  08440000
         B     ERREXIT                  GO XCTL                  A46776 08450021
*                                                                       08460021
* LINK TO THE STATUS ROUTINE TO PERFORM A STEP MUST COMPLETE            08470002
*                                                                       08480021
DOSMC    EQU   *                        SET STEP MUST COMPLETE   YM3995 08482002
         STM   RJFCB,RBAK,REGSAVEA      SAVE REGISTERS 11-14     YM3995 08490002
         LR    R3,RWKA                  SAVE WORK AREA ADDRESS   YM3995 08500002
GETLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  YM3995X08510002
               RELATED=(LOCAL,IGG0325E(RLSELOCK))  OBTAIN LOCK   YM3995 08520002
         LM    RJFCB,RBAK,REGSAVEA-ALLOCWKA(R3)  RESTORE REGS    YM3995 08530002
*                                                                       08540002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         YM3995 08550002
         L     RCVT,CVTABEND            LOAD SECONDARY CVT PTR   YM3995 08560002
         USING SCVTSECT,RCVT            2NDRY CVT ADDRESSABILITY YM3995 08570002
         L     RCVT,SCVTSTAT            LOAD STATUS EP ADDRESS   YM3995 08580002
         LA    R0,STEPMC                INDICATE STEP MC         YM3995 08590002
         XR    R1,R1                    INDICATE STATUS SET      YM3995 08600002
*                                                                       08610002
         BALR  RBAK,RCVT                LINK TO STATUS ROUTINE   YM3995 08620002
*                                                                       08630002
RLSELOCK EQU   *                        RELEASE THE LOCK         YM3395 08640002
         STM   RJFCB,RBAK,REGSAVEA      SAVE REGISTERS 11-14     YM3995 08650002
         LR    R3,RWKA                  SAVE WORK AREA ADDRESS   YM3995 08660002
         SETLOCK RELEASE,TYPE=LOCAL,                             YM3995X08670002
               RELATED=(LOCAL,IGG0325E(GETLOCK))  RELEASE LOCK   YM3995 08672002
         LM    RJFCB,RBAK,REGSAVEA-ALLOCWKA(R3)  RESTORE REGS    YM3995 08674002
*                                                                       08680000
         OI    DSMADTB2,DSMSMCE         SET ENQ'ED SMC SWITCH    Y02144 08690002
         OI    TYPEFLG,SMCDONE          TURN ON SMC SWITCH              08700000
         BR    DRBAK                                                    08720000
*                                                                       08740000
* * * * * * * * * * * * *                                               08760000
*                                                                       08780000
***   CONSTANTS                                                         08800000
*                                                                       08820000
* * * * * * * * * * * * *                                               08840000
*                                                                       08860000
FIVE     DC    H'5'                                                     08880000
THREES   DC    X'03030303'                                              08900000
SYSCODE  DC    CL13'IBMOSVS2'           SYSTEM CODE             ZA00704 08950002
MRACDEF  RACDEF DSTYPE=N,               RACDEF MASTER          @Z40RSGDX08960032
               TYPE=DEFINE,             PARAMETER LIST         @Z40RSGDX08970032
               MF=L                                            @Z40RSGD 08972032
LRACDEF  EQU   *-MRACDEF                LENGTH RACDEF          @Z40RSGD 08974032
*                                                                       08980000
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         09000002
*                                                                       09020000
         XCTLTABL ID=(ALLOCD1,5G,ALLOCD2,5H),SVC=032,BRT=YES,    Y02080X09030002
               LENGTH=                                           Y02080 09080002
*                                       PARAMETER LIST         @Z40RSGD 09122032
         SPACE 2                                                 Y02080 09130002
         IECDSECS CVT,PSA,SCVT,TCB,JSCB,EXPAND=YES               YM3995 09140032
DSCBWKAR IECALLWA EP,F4,D1=(1),D2=(5),ADT=YES  ALLOCATE WORKAREA Y02144 09180002
ZEROS    EQU   CCW4+4                                                   09880000
SWITCH   EQU   ASWITCH                  ALLOCATE SWITCH EQUATE   Y02080 09930002
ENTRYNUM EQU   AENTRYNM                 NUMBER OF ENTRIES EQUATE Y02080 09980002
ENTRIES  EQU   AENTRIES                 EQUATE FOR AENTRIES      Y02080 10030002
REGSAVEA EQU   IECREGSV+12              REGISTER SAVE AREA       Y02080 10060002
RACDEF   EQU   REGSAVEA                 RACDEF PARAMETER LIST  @Z40RSGD 10110032
         EJECT                                                   Y02080 11350002
JFCBFLD  DSECT                                                          11480000
         IEFJFCBN                                                       11500000
         EJECT                                                   Y02080 11502002
*                                                                       11510021
* * * * * * * * * * * * *                                               11520021
*                                                                       11530021
***   DSECT FOR THE PARTIAL DSCB PASSED TO ALLOCATE BY IEHMOVE   A46776 11540021
*                                                                       11550021
* * * * * * * * * * * * *                                               11552021
*                                                                       11554021
         ORG   INFMJFCB                                                 11556021
PD1DSNAM DS    CL44                DATA SET NAME                        11558021
PD1FMTID DS    CL1                 FORMAT IDENTIFIER                    11558421
PD1DSSN  DS    CL6                 DATA SET SERIAL NUMBER               11558821
PD1VOLSQ DS    XL2                 VOLUME SEQUENCE NUMBER               11559221
PD1CREDT DS    XL3                 CREATION DATE                        11559621
PD1EXPDT DS    XL3                 EXPIRATION DATE                      11559721
PD1NOEPV DS    XL1                 NUMBER OF EXTENTS ON VOLUME          11559821
PD1NOBDB DS    XL1                 NUMBER OF BYTES USED IN LAST         11559921
*                                     DIRECTORY BLOCK                   11566621
         DS    XL1                 RESERVED                             11568621
PD1SYSCD DS    CL13                SYSTEM CODE                          11570621
         DS    XL7                 RESERVED                             11572621
PD1DSORG DS    XL2                 DATA SET ORGANIZATION                11573021
PD1RECFM DS    XL1                 RECORD FORMAT                        11573121
PD1OPTCD DS    XL1                 OPTION CODE                          11573221
PD1BLKL  DS    XL2                 BLOCK LENGTH                         11575421
PD1LRECL DS    XL2                 RECORD LENGTH                        11577421
PD1KEYL  DS    XL1                 KEY LENGTH                           11577521
PD1RKP   DS    XL2                 RELATIVE KEY POSITION                11577621
PD1DSIND DS    XL1                 DATA SET INDICATORS                  11577721
PD1SCALO DS    XL4                 SECONDARY ALLOCATION                 11578421
PD1LSTAR DS    XL3                 LAST USED TRACK AND BLOCK ON TRACK   11578821
PD1TRBAL DS    XL2                 BYTES REMAINING ON LAST TRACK USED   11579221
         DS    XL2                 RESERVED                             11584421
PD1EXT1  DS    XL1                 EXTENT TYPE INDICATOR                11586421
         DS    XL2                 UNUSED                               11588421
PDPRIQTY DS    F                   PRIMARY SPACE REQUEST IN TRACKS      11588821
PDDIRQTY DS    F                   NUMBER OF DIRECTORY BLOCKS           11589221
         END   IGG0325E                                          S21042 51700021
./  ADD  SSI=32510330,NAME=IGG0325G
 TITLE ' IGG0325G - DADSM - DADSM RECORD UPDATE MODULE'                 00020000
IGG0325G CSECT                                                          00021021
*                                                                       00021402
*MODULE NAME = IGG0325G                                                 00021802
*                                                                       00022202
*DESCRIPTIVE NAME = DADSM - DADSM RECORD UPDATE MODULE                  00022602
*                                                                       00022702
*COPYRIGHT = NONE                                                       00022802
*                                                                       00022902
*CHANGE ACTIVITY = SEE BELOW                                            00025102
*                                                                       00029402
*          RELEASE 17 DELETIONS                                         00031602
*0092000400,                                                          * 00033802
*          RELEASE 18 DELETIONS                                         00036002
*          RELEASE 19 DELETIONS                                         00038202
*          RELEASE 20 DELETIONS                                         00040402
*2412044000                                                      A37231 00042602
*          RELEASE 21 DELETIONS                                         00044802
*1199017400-017600,018000-018200,044800,087600,089000,092800     A37199 00047002
*1199000230,015600,024800-025400,087200,087600,089000,110600     S21042 00049202
*          RELEASE 22 DELETIONS                                         00051402
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00053602
*0000000030-000150,000470-000530,001400-001600,004400,005600,    Y02080 00055802
*0000006000,006600,007800,016000,017000,017800-018100,026600-    Y02080 00058002
*0000026800,027400-027600,029000,029400,029800,040200,042800,    Y02080 00060202
*0000043400,044000-044040,044120-044400,044800,046400,047800,    Y02080 00062402
*0000063400,064000-064200,066800,072200,072800,074200,075800,    Y02080 00064602
*0000078200-078400,079200,079600,087200,087600-094600,095000-    Y02080 00066802
*0000110400                                                      Y02080 00069002
*0000028000                                                      Y02082 00071202
*0000018100-018200,068600                                        XM2969 00073202
*                                                                       00073402
*STATUS CHANGE LEVEL 003                                                00075602
*FUNCTION/OPERATION: TO REDUCE THE FORMAT 5 DSCB'S -DADSM - BY THE    * 00077802
*   SPACE ALLOCATED AND TO ELIMINATE ALL HOLES IN THE FORMAT 5 DSCB'S.* 00080000
*                                                                     * 00100000
*ENTRY POINTS:                                                        * 00120000
*        IGG0325G - ENTRY IS MADE FROM IGG0325E VIA A BRANCH.         * 00140002
*   ZERO QUANTITY REQUESTS DO NOT EXECUTE THIS MODULE.                * 00180000
*                                                                     * 00200000
*INPUT: UPON ENTRY TO THIS MODULE THE WORK AREA WILL CONTAIN THE DATA * 00220000
*   PORTION OF THE FORMAT 4 DSCB, AND THE ABSOLUTE ADDRESSES OF THE   * 00240000
*   FORMAT 4 DSCB AND THE FIRST FORMAT 5 DSCB.  THE DADSM TABLE WILL  * 00260000
*   CONTAIN THE NUMBER OF EXTENTS AND THE ACTUAL SPACE ALLOCATED.     * 00280000
*   THE KEY/DATA OF THE FIRST F5 MAY ALSO BE IN CORE, IF SO THE       * 00300000
*   'FIRST FORMAT 5 IN CORE SWITCH' WILL BE ON.   THE WORK AREA WILL  * 00320000
*   ALSO CONTAIN A DEB, AN IOB, AN ECB, AND A CHANNEL PROGRAM TO      * 00340000
*   SEARCH FOR HOLES AND TO READ AND WRITE DADSM RECORDS.             * 00360000
*   REGISTER 11 WILL POINT TO THE FIRST JFCB.                         * 00380000
*   REGISTER 13 WILL POINT TO THE WORK AREA.                          * 00400000
*                                                                     * 00420000
*OUTPUT: UPON TRANSFER OF CONTROL, THE WORK AREA REGISTERS WILL BE AS * 00440002
*   AT INPUT.  NEW/UPDATED FORMAT 5 DSCB'S WILL BE WRITTEN OUT.       * 00460000
*                                                                     * 00480000
*EXTERNAL ROUTINES:                                                   * 00500000
*        EXCP(0) - READ FROM OR WRITE TO DIRECT ACCESS DEVICE         * 00520000
*        WAIT(1) - WAIT ON EVENT CONTROL BLOCK                        * 00540000
*        IECRES  - BRANCH TO THE NEXT ALLOCATE MODULE                 * 00560002
*                                                                     * 00580000
*EXITS-NORMAL: BRANCH TO IGG0325H TO WRITE OUT AN UPDATED F4 DSCB     * 00600002
*   AND TO WRITE OUT A ZERO RECORD IF REQUIRED.  ERROR CODE PASS      * 00620000
*   REGISTER WILL CONTAIN A ZERO.                                     * 00640000
*   -ERROR: BRANCH TO IGG0325H WITH CODE IN ERROR CODE PASS REGISTER. * 00660002
*                                                                     * 00680000
*   ERROR CODES THAT CAN BE ISSUED BY 'DADSM RECORD UPDATE MODULE'    * 00700000
*                                                                     * 00720000
*   0C - PERMANENT I/O ERROR                                          * 00740000
*                                                                     * 00760000
*TABLES/WORK AREAS: DADSM WORK AREA DESCRIBED BY MACRO 'IECALLWA'     * 00780002
*                                                                     * 00800000
*              ***************************************                * 00820000
*              *             DADSM TABLE             *                * 00840000
*              ***************************************                * 00860000
*                                                                     * 00880000
*              ***************************************                * 00900000
*              *        *         *                  *                * 00920000
*              *  TYPE  *  NO OF  *     USED HOLE    *                * 00940000
*              *  FLAG  * ENTRIES *      COUNTER     *                * 00960000
*              *        *         *                  *                * 00980000
*              ***************************************                * 01000000
*              *                  *                  *                * 01020000
*              *       RTA        *      RTA+1       *                * 01040000
*              *                  *                  *                * 01060000
*              ***************************************                * 01080000
*              *                  *                  *                * 01100000
*              *       RTA        *      RTA+1       *                * 01120000
*              *                  *                  *                * 01140000
*              ***************************************                * 01160000
*              *                  *                  *                * 01180000
*              *       RTA        *      RTA+1       *                * 01200000
*              *                  *                  *                * 01220000
*              ***************************************                * 01240000
*              *                  *                  *                * 01260000
*              *       RTA        *      RTA+1       *                * 01280000
*              *                  *                  *                * 01300000
*              ***************************************                * 01320000
*              *                  *                  *                * 01340000
*              *       RTA        *      RTA+1       *                * 01360000
*              *                  *                  *                * 01380000
*              ***************************************                * 01400000
*                                                                     * 01420000
*              TYPEFLG  =  02 - BPAM DIRECTORIES REQUESTED.           * 01440000
*                                                                     * 01460000
*                       =  40 - USER LABELS REQUESTED                 * 01464021
*                                                                     * 01468021
*                       =  80 - SET MUST COMPLETE IS ACTIVE           * 01472021
*                                                                     * 01476021
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.  * 01480000
*                                                                     * 01500000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.      * 01520000
*                                                                     * 01540000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT* 01560021
*                                                                     * 01580000
*ATTRIBUTES: REENTRANT                                                * 01600002
*                                                                     * 01620000
*NOTES:                                                               * 01640000
*   OTHER MACROS USED                                                 * 01660000
*   IECALLWA - ALLOCATE WORK AREA EXPANSION                           * 01670002
*   IECSDSL1 - BUILD DSCB'S                                           * 01680000
*   MODESET  - ASSUME DATAMGT KEY                                     * 01690002
*   CVT - BUILD CVT                                                   * 01700002
*                                                                     * 01720000
*STORAGE: PROGRAM CODE - LESS THAN 2048 BYTES                         * 01800002
*   WORK AREA - AS DEFINED IN THE IECALLWA MACRO                 XM2969 01810002
*   RPS WORK AREA - AS DEFINED IN THE IECRPS MACRO               XM2969 01820002
*                                                                     * 01840000
*                                                                       01860000
*REGISTER NAMES-                                                        01880000
*                                                                       01900000
R0       EQU   0                        CHNL PRG START PTR AND WORK REG 01920000
R1       EQU   1                        WORK REGISTER                   01940000
RCNT     EQU   1                        DADSM ENTRY COUNT REG           01960000
RTAB     EQU   2                        DADSMTBL POINTER                01980000
RIN      EQU   3                        INPUT POINTER                   02000000
R4       EQU   4                        OUTPUT POINTER                  02020000
ROUT     EQU   4                        OUTPUT POINTER                  02040000
R5       EQU   5                        CONVERTED OUTPUT POINTER        02060000
ROEND    EQU   5                        END OF OUTPUT POINTER           02080000
R6       EQU   6                        CONVERT ROUTINE WORK REGISTER   02100000
R7       EQU   7                        CONVERT ROUTINE WORK REGISTER   02120000
R8       EQU   8                        CONVERT ROUTINE WORK REGISTER   02140000
RERRPASS EQU   8                        ERROR PASS REGISTER             02160000
R9       EQU   9                        CONVERT ROUTINE WORK REGISTER   02180000
RA       EQU   10                       CONVERT ROUTINE LOOP COUNTER    02200000
RB       EQU   11                       I/O LINK REGISTER               02220000
RJFCB    EQU   11                       JFCB POINTER                    02240000
RBASE    EQU   12                       BASE REGISTER                   02260000
RWKA     EQU   13                       WORK AREA POINTER.              02280000
RBAK     EQU   14                       RETURN REGISTER                 02300000
RWRK     EQU   15                       WORK REGISTER                   02320000
RERR     EQU   15                       ERROR CODE REGISTER             02340000
RF       EQU   15                       INPUT CONVERT LOOP COUNTER      02360000
*                                                                       02380000
* * * * * * * * * * * * *                                               02400000
*                                                                       02420000
*                                                                       02440000
* * * * * * * * * * * * *                                               02460000
*                                                                       02470002
* OTHER EQUATES                                                         02510002
*                                                                       02520002
K2       EQU   2                        CONSTANT OF 2            Y02080 02530002
K4       EQU   4                        CONSTANT OF 4            Y02080 02540002
*                                                                       02560000
*REGISTER USAGE-                                                        02580000
*                                                                       02600000
         BALR  RBASE,0                                                  02620000
         USING DADSMSTR,RBASE                                           02640000
         USING ALLOCWKA,RWKA            WORK AREA ADDRESSABILITY Y02080 02660002
*                                                                       02700000
* INITIALIZE DADSM OUTPUT RECORD, DADSM INPUT AND OUTPUT ADDRESSES,     02720000
* AND SWITCHES.  PICK UP THE NUMBER OF ENTRIES IN THE DADSM TABLE,      02740002
* AND INITIALIZE POINTERS.                                              02760002
*                                                                       02780000
DADSMSTR EQU   *                        BRANCH LABEL             Y02082 02790002
         MODESET EXTKEY=DATAMGT         ASSUME DATAMGT KEY       Y02082 02800002
         MVC   DS1DSNAM(K4),FIVES       MOVE IN F5 KEY ID        Y02082 02810002
         MVC   IDAREA(5),FMTOUTAD       SET UP SRCH/ID FOR FIRST F5     02820000
         MVC   FMTINAD(5),FMTOUTAD      SET UP CURRENT F5 ADDRESS       02840000
         NI    SWITCH,FRSTF5            CLEAR ALL BUT 1ST F5 SWITCH     02860000
         OI    SWITCH,OUTBYP            SET READ/WRITE SWITCH           02880000
         SR    RCNT,RCNT                                                02920000
         IC    RCNT,AENTRYNM            GET NUMBER OF ENTRIES    Y02080 02940002
         LA    ROEND,F5OUT+108          LOAD END OF OUTPUT POINTER.     02960000
         LA    RTAB,AENTRIES            PT TO 1ST DADSMTBL ENTRY Y02080 02980002
RESTOUT  LA    ROUT,F5OUT+4             LOAD PTR TO START OF OUTPUT     03000000
RESTORE  XC    DS1DSNAM+4(136),DS1DSNAM+4  CLEAR OUTPUT AREA            03020000
*                                                                       03040000
* TEST FOR FIRST DADSM RECORD IN CORE.  IF FIRST F5 IS IN CORE GO       03060000
* CONVERT IT TO RTA-RTA+1.  IF FIRST F5 IS NOT IN CORE GO READ          03080000
* IT IN AND CONVERT IT.                                                 03100000
*                                                                       03120000
         TM    SWITCH,FRSTF5            IS THE 1ST F5 STILL IN CORE     03140000
         BZ    SETFSTRD                 BRANCH IF 1ST F5 NOT IN CORE    03160000
         BAL   RBAK,CONVF5              GO CONVERT THIS F5              03180000
         B     DUELOOP                                                  03200000
SETFSTRD OI    SWITCH,FRSTF5            SET FIRST F5 IN CORE SWITCH     03220000
FSTRD    BAL   RBAK,READF5              GO READ AND CONVERT 1ST F5      03240000
*                                                                       03260000
* THIS SECTION DETERMINES WHEN THE DADSM TABLE EXTENTS SHOULD BE        03280000
* MERGED INTO THE OUTPUT FORMAT 5                                       03300000
*                                                                       03320000
DUELOOP  CLR   ROEND,ROUT               IS OUTPUT AREA FULL.            03340000
         BNH   TEST1                    BRANCH IF OUTPUT IS FULL        03360000
COMZE    CLC   0(4,RIN),ZEROS           IS THIS INPUT EXTENT ZERO       03380000
         BE    CHEND                    BRANCH IF YES                   03400000
         LTR   RCNT,RCNT                IS DADSMTBL EMPTY               03420000
         BZ    MOVEOUT                  BRANCH IF EMPTY                 03440000
         LH    R0,2(RTAB)               GET THIS ENTRY RTA+1       UL17 03442000
         CH    R0,4(RTAB)               IS IT EQ TO NEXT ENTRY RTA UL17 03444000
         BNE   CMPSPACE                 BRANCH IF NO               UL17 03446000
         LH    R0,0(RTAB)               GET FIRST ENTRY RTA        UL17 03448000
         STH   R0,4(RTAB)              MERGE THIS WITH NEXT ENTRY  UL17 03450000
         LA    RTAB,4(RTAB)             STEP POINTER TO NEXT ENTRY UL17 03452000
         BCTR  RCNT,0                  DECREMENT ENTRIES COUNTER   UL17 03454000
         B     DUELOOP                  REPEAT MERGE LOOP          UL17 03456000
CMPSPACE EQU   *                                                   UL17 03458000
         CLC   2(2,RTAB),2(RIN)         IS THIS SPACE ALLOCATED.        03460000
         BL    ALTEREX                  CHECK FOR MIDDLE OR FRONT       03480000
*                                       ALLOCATION IF LOW               03500000
         BE    TOTALL                   CHECK FOR TOTAL OR REAR         03520000
*                                       ALLOCATION IF EQUAL             03540000
*                                                                       03560000
* MOVE FORMAT 5 DSCB EXTENTS TO OUTPUT AREA                             03580000
*                                                                       03600000
MOVEOUT  TM    SWITCH,DADBYP            IS WRITE DADSM PENDING          03620000
         BO    CHEXTRTN                 BRANCH IF YES                   03640000
         MVC   0(4,ROUT),0(RIN)         MOVE INPUT TO OUTPUT            03660000
INPUT    BCT   RWRK,UPDATEPT            BRANCH IF INPUT NOT EMPTY       03680000
         LA    ROUT,4(ROUT)             STEP OUTPUT POINTER             03700000
         OI    SWITCH,PRCNTL            SET PROCESS CONTROL SWITCH      03720000
*                                                                       03740000
* TEST FOR MULTIPLE FORMAT 5 RECORDS                                    03760000
*                                                                       03780000
CHECHAIN TM    DS5PTRDS+4,X'FF'         IS INPUT RECORD CHAINED.        03800000
         BZ    CHECALT                  NO - CHECK IF RECORD ALTERED    03820000
         MVC   ALLCCHHR,IDAREA          SAVE F5 CCHHR            XM2969 03830002
         TM    SWITCH,RCDALT            WAS DADSM RECORD ALTERED        03840000
         BC    1,BRTORDF5               BRANCH IF YES                   03860000
         XI    SWITCH,OUTBYP            FLIP/FLOP READ/WRITE SWITCH     03880000
*                                                                       03900000
* OUTPUT DADSM RECORD IS THE SAME AS THE INPUT DADSM RECORD.  BYPASS    03920000
* WRITE DADSM AND CLEAR THE OUTPUT AREA.                                03940000
*                                                                       03960000
TSTPROC  EX    0,RESTORE                CLEAR OUTPUT AREA               03980000
         LA    ROUT,F5OUT+4             RESET OUTPUT POINTER            04000000
         NI    SWITCH,X'FF'-PRCNTL      CLEAR PROCESS CONTROL SW Y02080 04020002
*                                                                       04040000
* LINK TO READ THE NEXT FORMAT 5 DSCB.                                  04060000
*                                                                       04080000
BRTORDF5 BAL   RBAK,SAVEID              GO READ IN NEXT F5              04100000
         B     DUELOOP                                                  04120000
*                                                                       04140000
* TEST IF LAST DADSM OUTPUT RECORD WAS ALTERED.  IF ALTERED WRITE       04160000
* DADSM, IF NOT ALTERED BYPASS THE WRITE DADSM.                         04180000
*                                                                       04200000
CHECALT  TM    SWITCH,RCDALT            WAS DADSM RECORD ALTERED        04220000
         BZ    EXIT1                    BRANCH IF NOT ALTERED           04240000
WRITEFNL OI    SWITCH,WRTFNL            SET WRITE FINAL RECORD SWITCH   04260000
         XC    CCHHRSAV,CCHHRSAV        CLEAR CHAIN ADDRESS      Y02080 04280002
         BAL   RBAK,WRITEF5             WRITING FINAL RECORD.           04300000
*                                                                       04320000
* SET UP TO BRANCH TO THE NEXT LOAD.                                    04340002
*                                                                       04360000
EXIT1    SR    RERRPASS,RERRPASS        CLEAR ERROR PASS REGISTER       04380000
ERREXIT  EQU   *                                                 A37231 04384020
         TM    SWITCH,NEWF5             TEST IF NEW F5 WAS       A37231 04388020
*                                       CREATED                  A37231 04392020
         BNO   NONEWF5                  BRANCH IF NOT            A37231 04396020
         NI    SWITCH,X'FF'-WRZERO-NEWF5  CLEAR WRITE ZERO DSCB  Y02080 04400002
*                                       AND NEW F5 CREATED BITS  Y02080 04404002
NONEWF5  EQU   *                                                 A37231 04408020
         L     RJFCB,AJFCBPTR           RESTORE JFCB POINTER     Y02080 04412002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 04420002
*                                                                       04460000
         IECRES LOAD,EXTPR=(RWKA),MODID=ALLOCD2,BRANCH=DIRECT    Y02080 04480002
*                                                                       04500000
* TEST IF OTHER THAN THE FIRST DADSM RECORD HAS BEEN READ IN.           04520000
*                                                                       04540000
TEST1    TM    SWITCH,PRCNTL            IS PROCESS CONTROL SWITCH ON    04560000
         BZ    TSTCH                    BRANCH IF NO                    04580000
         TM    SWITCH,OUTBYP            IS WRITE BEFORE READ            04600000
         BZ    TSTCH                    BRANCH IF YES                   04620000
         MVC   CCHHRSAV,FMTOUTAD        OUTPUT F5 CHAIN ADDRESS  Y02080 04640002
         B     BRTOWR5                  GO TO WRITE F5 ROUTINE          04660000
*                                                                       04680000
* TEST IF ANOTHER DADSM RECORD EXISTS                                   04700000
*                                                                       04720000
TSTCH    TM    DS5PTRDS+4,X'FF'         IS INPUT DADSM RECORD CHAINED   04740000
         BZ    CHEXT                    NO-CHECK FOR ZERO INPUT EXTENT  04760000
WRITE1   EQU   *                        BRANCH LABEL             Y02080 04780002
         MVC   CCHHRSAV,DS5PTRDS        INSERT CHAIN ADDRESS     Y02080 04790002
BRTOWR5  BAL   RBAK,WRITEF5             GO WRITE OUT F5                 04800000
         B     DUELOOP                                                  04820000
*                                                                       04840000
* TEST IF THE FIRST DADSM RECORD IS STILL IN CORE.                      04860000
*                                                                       04880000
CHEND    TM    SWITCH,FRSTF5            IS THE 1ST DADSM RCD IN CORE    04900000
         BO    WRITEFNL                 BRANCH IF YES                   04920000
*                                                                       04940000
* TEST IF THERE HAS BEEN MORE INPUT DADSM RECORDS THAN OUTPUT DADSM     04960000
* RECORDS.  IF SO THEN SET UP TO ZERO OUT THE LAST INPUT DADSM RECORD.  04980000
*                                                                       05000000
TSTZERO  TM    SWITCH,OUTBYP            IS NBR OF WRTS EQUAL TO NBR RDS 05020000
         BO    WRITEZER                 BRANCH IF NO                    05040000
         MVC   IDAREA(5),FMTOUTAD       NO - SET UP SRCH/ID ADDRESS     05060000
         B     WRITEFNL                 GO WRITE LAST F5                05080000
WRITEZER OI    SWITCH,WRZERO            SET WRITE ZERO RECORD SWITCH    05100000
         MVC   FMTINAD(5),FMTOUTAD      SET UP ZERO RECORD ADDRESS      05120000
         B     WRITEFNL                 GO WRITE THE LAST F5            05140000
*                                                                       05160000
* THIS SECTION MERGES DADSM TABLE ENTRIES WITH F5 DSCB                  05180000
*                                                                       05200000
ALTEREX  OI    SWITCH,RCDALT            SET DADSM RECORD ALTERED SWITCH 05220000
*                                                                       05240000
* TEST IF A WRITE DADSM IS PENDING                                      05260000
*                                                                       05280000
         TM    SWITCH,DADBYP            IS DADSM WRITE BYPASS SWITCH ON 05300000
         BO    CHEXTRTN                 BRANCH IF YES                   05320000
         CLC   0(2,RTAB),0(RIN)         TEST FOR MIDDLE OR FRONT ALLOC  05340000
         BNE   MIDDLE                   LOW OR NOT EQUAL - MIDDLE ALLOC 05360000
FRONT    MVC   0(2,ROUT),2(RTAB)        FRONT ALLOC-INSERT NEW LOW RTA  05380000
         MVC   2(2,ROUT),2(RIN)         KEEP OLD UPPER RTA              05400000
*                                                                       05420000
* UPDATE POINTERS AND COUNTERS                                          05440000
*                                                                       05460000
DECRMNT  BCTR  RCNT,0                   DECREMENT TABLE ENTRY COUNTER   05480000
         LA    RTAB,4(RTAB)             STEP PTR TO NEXT DADSMTBL ENTRY 05500000
         B     INPUT                    GO CHECK FOR INPUT EMPTY        05520000
UPDATEPT LA    ROUT,4(ROUT)             UPDATE OUTPUT POINTER.          05540000
UPDATIN  LA    RIN,4(RIN)               UPDATE INPUT  POINTER.          05560000
         B     DUELOOP                                                  05580000
*                                                                       05600000
*                                                                       05620000
MIDDLE   MVC   0(2,ROUT),0(RIN)         MIDDLE ALLOC-INSERT OLD LOW RTA 05640000
         MVC   2(2,ROUT),0(RTAB)        INSERT NEW UPPER RTA            05660000
         LA    ROUT,4(ROUT)             UPDATE OUTPUT AREA POINTER      05680000
         CLR   ROEND,ROUT               IS OUTPUT AREA FULL             05700000
         BH    FRONT                    NO - INSERT NEXT EXTENT         05720000
         MVC   0(2,RIN),2(RTAB)         SAVE NEW LOW RTA IN INPUT       05740000
         LA    RTAB,4(RTAB)             STEP DADSMTBL POINTER           05760000
         BCTR  RCNT,0                   DECREMENT DADSMTBL ENTRY COUNT  05780000
         B     TEST1                    GO SET UP THIS DADSM WRITE      05800000
TOTALL   OI    SWITCH,RCDALT            SET DADSM RECORD ALTERED SWITCH 05820000
         CLC   0(2,RIN),0(RTAB)         IS ENTIRE EXTENT ALLOCATED.     05840000
         BNE   NOTALL                   NO - GO INSERT OLD LOW RTA      05860000
         SH    ROUT,FOUR                COMPENSATE FOR OUTPUT PTR STEP  05880000
         B     DECRMNT                  GO UPDATE POINTERS              05900000
NOTALL   TM    SWITCH,DADBYP            IS A WRITE DADSM PENDING        05920000
         BO    CHEXTRTN                 BRANCH IF YES                   05940000
         MVC   0(2,ROUT),0(RIN)          INSERT LOW OLD RTA             05960000
         MVC   2(2,ROUT),0(RTAB)        INSERT NEW UPPER RTA            05980000
         B     DECRMNT                  GO STEP POINTERS                06000000
*                                                                       06020000
* IS ALL OF DADSM PROCESSED                                             06040000
*                                                                       06060000
CHEXT    CLC   0(4,RIN),ZEROS           IS NEXT INPUT EXTENT ZERO       06080000
         BE    WRITEFNL                 BRANCH IF YES                   06100000
*                                                                       06120000
* THIS ROUTINE SEARCHES FOR HOLE IN VTOC TO WRITE NEW DSCB              06140000
*                                                                       06160000
SEARCH   MVC   FMTINAD(5),IDAREA        SAVE IDAREA                     06180000
         MVC   IDAREA(5),VTOCADR        START SEEK/SRCH AT F4 DSCB      06200000
         LA    R0,CCW1                  START CHANNEL PROG AT CCW1      06220000
         MVI   CCW5+4,X'30'             STOP CHANNEL PROG AFTER CCW5    06240000
         BAL   RB,CHANNLGO              GO SEARCH FOR A HOLE            06260000
         LH    R0,DS4DSREC              GET NUMBER OF AVAIL HOLES       06280000
         BCTR  R0,0                     DECREMENT COUNT BY ONE          06300000
         STH   R0,DS4DSREC              RESET NUMBER OF AVAIL HOLES     06320000
         MVC   CCHHRSAV,IDAREA          SAVE HOLE ADDRESS        Y02080 06340002
         MVC   IDAREA(5),FMTINAD        RESTORE IDAREA                  06360000
AFTERSRH BAL   RBAK,WRITEF5             GO WRITE THIS DADSM RECORD      06380000
         MVC   IDAREA,CCHHRSAV          SET NEXT OUTPUT F5 ADDR  Y02080 06400002
         MVC   FMTOUTAD,CCHHRSAV        SET NEXT OUTPUT F5 ADDR  Y02080 06420002
         OI    SWITCH,NEWF5             SET NEW F5 CREATED BIT   A37231 06430020
         B     DUELOOP                                                  06440000
*                                                                       06460000
* THIS CONVERTS DADSM ENTRIES FROM RTA-RTA+1 BACK TO XXYYZ BEFORE       06480000
* WRITING THE FORMAT 5 DSCB.                                            06500000
*                                                                       06520000
WRITEF5  LA    ROUT,F5OUT+4             LOAD POINTER TO OUTPUT AREA     06540000
         TM SWITCH,WRTFNL               IS WRITE FINAL RECORD SW ON     06560000
         BO    CHEXTRT                  BRANCH IF YES                   06580000
         ST    RBAK,PDLIST5             SAVE RETURN                     06600000
         OI    SWITCH,DADBYP            SET DADSM WRITE PENDING SW      06620000
         B     DUELOOP                  GO PROCESS DADSM                06640000
CHEXTRTN L     RBAK,PDLIST5             RELOAD RETURN                   06660000
CHEXTRT  EQU   *                        BRANCH LABEL             Y02080 06680002
         STM   R4,R5,CCW13              SAVE REGISTERS           Y02080 06690002
         LA    R5,DS1DSNAM+5            LOAD POINTER TO CONVERTED AREA  06700000
         LA    RA,26                    SET TO MAXIMUN NBR OF EXTENTS   06720000
         LH    R0,DS4DEVSZ+2            GET NBR OF TRKS/CYL             06740000
NEXTEXT  SR    R6,R6                    CLEAR HIGH DIVIDEND REGISTERS   06760000
         SR    R8,R8                                                    06780000
         SR    R9,R9                    CLEAR FULL CYLINDER REGISTER    06800000
         LH    R7,0(ROUT)               GET EXTENT RTA                  06820000
         LTR   R7,R7                    IS THIS EXTENT ZERO             06840000
         BNZ   NONZEROS                 BRANCH IF NOT ZERO       XM2969 06850002
         CH    RA,H26                   TEST FOR 26 EXTENTS      XM2969 06860002
         BNE   STORE                    BRANCH IF NOT EQUAL      XM2969 06870002
         OI    ACNVSW,AF5ZERO           SET BIT TO INDICATE      XM2969 06872002
*                                       26 ZERO EXTENTS          XM2969 06874002
         B     STORE                    CONTINUE                 XM2969 06876002
NONZEROS EQU   *                        BRANCH LABEL             XM2969 06878002
         LH    R9,2(ROUT)               GET EXTENT RTA+1                06880000
         DR    R6,R0                    CONVERT RTA TO CYL/TRK          06900000
         DR    R8,R0                    CONVERT RTA+1 TO CYL/TRKS       06920000
         SR    R9,R7                    CALCULATE CYL DIFFERENCE        06940000
         SR    R8,R6                    CALCULATE TRK DIFFERENCE        06960000
         LTR   R9,R9                    IS CYL DIFFERENCE ZERO          06980000
         BZ    STORE                    BRANCH IF YES                   07000000
         LTR   R6,R6                    IS RTA TRK REMAINDER ZERO       07020000
         BZ    STORE                    BRANCH IF YES                   07040000
         AR    R8,R0                    ADD TRK CONSTANT TO TRK DIFF    07060000
         BCTR  R9,0                     DECREMENT NBR OF CYLS           07080000
STORE    STH   R9,2(ROUT)               STORE NBR OF FULL CYLINDERS     07100000
         MVC   0(4,R5),0(ROUT)          MOVE RTA AND CYLS TO OUTPUT     07120000
         STC   R8,4(R5)                 STORE NBR OF EXCESS TRKS        07140000
         LA    R5,5(R5)                 STEP CONVERTED AREA POINTER     07160000
         LA    ROUT,4(ROUT)             STEP OUTPUT POINTER             07180000
         BCT   RA,NEXTEXT               BRANCH IF MORE OUTPUT TO PROC   07200000
         MVC   DS1PTRDS,CCHHRSAV        INSERT CHAIN ADDRESS     Y02080 07220002
INSERTF5 MVC   DS1DSNAM+4(40),DS1DSNAM+5  OPEN F5 HOLE                  07240000
         MVI   DS1FMTID,X'F5'           INSERT FORMAT ID                07260000
         LM    R4,R5,CCW13              RESTORE REGISTERS        Y02080 07280002
         MVI   CCW11+4,X'10'            SET SKIP FLAG FOR WRITE CHECK   07300000
         LA    R0,CCW6                  START CHANNEL PROG AT CCW6      07320000
         BAL   RB,CHANNLGO              GO WRITE THIS DADSM RECORD      07340000
         MVC   IDAREA(5),DS1PTRDS       SET UP NEXT OUTPUT DADSM ADDR   07360000
         EX    0,RESTORE                CLEAR OUTPUT AREA               07380000
         XI    SWITCH,OUTBYP            FLIP/FLOP READ/WRITE SWITCH     07400000
WRTRTN   EQU   *                        BRANCH LABEL             Y02080 07420002
         NI    SWITCH,X'FF'-DADBYP      CLEAR WRT PENDING SWITCH Y02080 07430002
         BR    RBAK                                                     07440000
*                                                                       07460000
* THIS SECTION READS IN FORMAT 5 (DADSM) DSCB AND CONERTS ENTRIES       07480000
* FROM XXYYZ TO RTA-RTA+1 FOR PROCESSING                                07500000
*                                                                       07520000
SAVEID   MVC   FMTINAD(5),IDAREA        SAVE IDAREA                     07540000
         MVC   FMTOUTAD(5),DS5PTRDS     SET UP NEXT OUTPUT DADSM ADDR   07560000
         NI    SWITCH,X'FF'-FRSTF5      CLEAR 1ST F5 IN CORE SW  Y02080 07580002
         MVC   IDAREA(5),DS5PTRDS       SET UP NEXT INPUT DADSM ADDR    07600000
READF5   LA    R0,CCW9                  START CHANNEL PROG AT CCW9      07620000
         MVI   CCW11+4,X'00'            CLEAR READ CCW FLAGS            07640000
         BAL   RB,CHANNLGO              GO READ A DADSM RECORD          07660000
         MVC   DS5KEYID+44(90),DS5KEYID+45   REMOVE FORMAT ID           07680000
CONVF5   LA    RIN,DS5AVEXT             RESET INPUT POINTER             07700000
         LR    R8,RIN                   SET UP PTR TP CONVERTED EXTENTS 07720000
         LA    RWRK,26                  SET TO MAX NUMBER OF EXTENTS    07740000
         SR    R6,R6                    CLEAR PICK UP REGISTER          07760000
TEST0    CLC   0(2,RIN),ZEROS           IS THIS EXTENT ZERO             07780000
         BE    INCRIN                   BRANCH IF YES                   07800000
         MVC   FULLWORD(K4),0(RIN)      ALIGN RTA & NBR OF CYLS  Y02080 07820002
         LH    R7,FULLWORD+K2           LOAD NBR OF CYLS         Y02080 07840002
         MH    R7,DS4DEVSZ+2            MULTIPLY BY TRACK CONSTANT      07860000
         IC    R6,4(RIN)                GET ODD TRACKS                  07880000
         AR    R7,R6                    ADD ODD TRACKS FOR TOAL TRACKS  07900000
         AH    R7,FULLWORD              ADD RTA                  Y02080 07920002
         STH   R7,2(R8)                 STORE RTA+1 IN INPUT CONV AREA  07940000
         MVC   0(K2,R8),FULLWORD        MOVE RTA TO CONV AREA    Y02080 07960002
         LA    R8,4(R8)                 UPDATE POINTER TO NEXT SPACE.   07980000
INCRIN   LA    RIN,5(RIN)               INCREMENT INPUT POINTER         08000000
         BCT   RF,TEST0                 BRANCH IF MORE EXTENTS          08020000
         LA    RIN,DS5AVEXT             RESET INPUT POINTER.            08040000
         XC    0(26,R8),0(R8)           CLEAR EXCESS BITS               08060000
         LA    RWRK,26                  RESET COUNT OF EXTENTS.         08080000
         XI    SWITCH,OUTBYP            FLIP/FLOP READ/WRITE SWITCH     08100000
         BZ    RETNBACK                 BRANCH IF READ BEFORE WRITE     08120000
         MVC   IDAREA(5),FMTINAD        SET UP NEXT OUTPUT WRT ADDR     08140000
RETNBACK BR    RBAK                                                     08160000
*                                                                       08180000
* EXECUTE CHANNEL PROGRAM TO READ OR WRITE F5                           08200000
*                                                                       08220000
CHANNLGO MVC   SEEK+3(4),IDAREA         INSERT SEEK ADDRESS FOR IOS.    08240000
         STM   RF,R1,REGSAVEA           SAVE REGISTERS                  08260000
         ST    R0,IOB+16                STORE STARTING CCW INTO IOB.    08280000
         MVI   ECB,X'00'                CLEAR STATUS BYTE OF ECB.       08300000
         EXCP  IOB                      EXECUTE CHHNNEL PROGRAM.        08320000
         WAIT  ECB=ECB                  WAIT FOR I/O COMPLETION         08340000
         LM    RF,R1,REGSAVEA           RESTORE REGISTERS               08360000
         TM    ECB,X'20'                TEST FOR PERM IO ERROR          08380000
         BCR   5,RB                     NO - CONTINUE PROCESSING        08400000
*                                                                       08420000
* ERROR - PERMANENT I/O ERROR                                           08440000
*                                                                       08460000
         LA    RERRPASS,X'0C'           SET ERROR CODE 'PERM I/O ERROR  08480000
         B     ERREXIT                                                  08500000
*                                                                       08520000
* * * * * * * * * * * * *                                               08540000
*                                                                       08560000
***   CONSTANTS                                                         08580000
*                                                                       08600000
* * * * * * * * * * * * *                                               08620000
*                                                                       08640000
FOUR     DC    H'4'                                                     08660000
FIVES    DC    X'05050505'                                              08680000
H26      DC    H'26'                    CONSTANT OF 26           XM2969 08690002
*                                                                       08700000
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         08720002
*                                                                       08740000
         XCTLTABL ID=(ALLOCD2,5H),SVC=032,LENGTH=,BRT=YES        Y02080 08790002
         EJECT                                                   Y02080 08840002
DSCBWKAR IECALLWA EP,F4,D1=(1),D2=(5)   ALLOCATE WORK AREA       Y02080 09060002
SWITCH   EQU   ASWITCH                  ALLOCATE SWITCH EQUATE   Y02080 09110002
REGSAVEA EQU   IECREGSV+12              REGISTER SAVE AREA       Y02080 09160002
ZEROS    EQU   CCW4+4                   4 BYTES OF ZEROS                09480000
         EJECT                                                   Y02080 09530002
CVT      DSECT                          CVT DSECT                Y02080 09580002
         CVT                                                     Y02080 09630002
         END   IGG0325G                                          S21042 51040021
./  ADD  SSI=80040258,NAME=IGG0325H
 TITLE 'IGG0325H - DADSM - UPDATE FORMAT 4 DSCB AND RETURN'      Y02080 00020002
IGG0325H CSECT                                                          00023021
*                                                                       00025002
*MODULE NAME = IGG0325H                                                 00025402
*                                                                       00025802
*DESCRIPTIVE NAME = DADSM - UPDATE FORMAT 4 DSCB AND RETURN             00025902
*                                                                       00027102
*COPYRIGHT = NONE                                                       00029102
*                                                                       00029502
*CHANGE ACTIVITY = SEE BELOW                                            00029902
*                                                                       00030302
*          RELEASE 16 DELETIONS                                         00030602
*1462044000,045200                                                 AAAA 00031802
*          RELEASE 17 DELETIONS                                         00033002
*          RELEASE 18 DELETIONS                                         00034202
*          RELEASE 19 DELETIONS                                         00035402
*0783027600,028600-028800,030200,031600-033400,034600,042000,    O19117 00036602
*0783044400,045600,049000,050200-054000                          O19117 00037802
*          RELEASE 20 DELETIONS                                         00039002
*3033046600                                                      S20201 00040202
*          RELEASE 21 DELETIONS                                         00041402
*1197002600,004800-005000,019600-019800,020200-020400,064200     A37199 00042602
*1197000230,000600-001800,004200,005400,006400,008400-008800,    S21042 00043802
*1197082460                                                      S21042 00045002
*1197017800,021400,022800,023200,024409-024427,025600-026200,    S21042 00046202
*1197027700,028000-028540,030000,032600,034600,037200,038200-    S21042 00047402
*1197038400,040200-040400,048000,057600,058000,058400,059800,    S21042 00048602
*1197083000                                                      S21042 00049802
*0000000950,006280-006520,027612,027741-027744,027753,033800,    A46776 00051002
*0000034800-036400,036800,037100,037800,038100,038600,054200-    A46776 00052202
*0000055000,058400-059800,061800,080100,082520-082800            A46776 00053402
*0000039200,046600,057110-057200                                SA49351 00054602
*          RELEASE 22 DELETIONS                                         00055802
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00057002
*0000000030-000200,000470-000500,001250,001550-001750,002600-    Y02080 00058202
*0000003000,004800-005200,006200,007400-007800,008400-008600,    Y02080 00059402
*0000009200,010000,018200,020000-020300,024429,024490,027000,    Y02080 00060602
*0000027648-027654,027663-027699,027693-027702,027711,027726,    Y02080 00061802
*0000027732,027900-028100,029000,033800,034600-034700,035400,    Y02080 00063002
*0000037100,037420-037580,038200,038400,038600,039200-040800,    Y02080 00064202
*0000043900,044100,045100,045300,045600-045620,045644-045652,    Y02080 00065402
*0000045654-045655,045690-045700,046580-046600,047000,056970-    Y02080 00066602
*0000057040,058000,058400-082000,082040-082160                   Y02080 00067802
*0000082020-082040                                               Y02078 00069002
*0000045400                                                      Y02144 00070202
*0000024445-024454,024467-024470,045650-045660.057410            YM3048 00070602
*0000020300-020400,059700                                        XM2969 00071002
*0000045670-045730                                               YM3997 00071102
*                                                                       00071402
*STATUS CHANGE LEVEL 005                                                00072602
*                                                                       00073237
*OZ28204  ACQUIRE DIRECTORY SPACE FOR MSS VIRTUAL VOLUMES       OZ28204 00073437
*OZ28204  ADDITIONS AND CHANGES                                 OZ28204 00073637
*008100,022500,024425,024592-024596,035860,037400-037460,       OZ28204 00073837
*038440-038720,482800-485800                                    OZ28204 00074037
*                                                                       00074237
*FUNCTION/OPERATION: THIS MODULE CONVERTS THE CCHHR OF THE FORMAT 1   * 00075021
*   DSCB TO A TTR AND STORES IT IN THE JFCB FOR TASK SCHEDULER        * 00085021
*   ALLOCATION REQUESTS OR IN THE PARTIAL DSCB FOR UTILITY SPACE      * 00095021
*   ALLOCATION REQUESTS. IT ALSO CONVERTS THE CCHHR OF A DUPLICATE    * 00105021
*   NAME DSCB FOR UTILITY SPACE ALLOCATION REQUESTS. THIS MODULE      * 00115021
*   WRITES A FORMAT 0 DSCB, IF REQUIRED, AND WRITES THE UPDATED       * 00125002
*   FORMAT 4 DSCB INTO THE VTOC. IF DIRECTORIES ARE REQUESTED, IT     * 00135021
*   SETS UP THE DEB FOR CVOL TO WRITE DIRECTORIES. OTHERWISE, IT      * 00145021
*   FREES ANY WORK AREAS AND RETURNS.  FOR ERROR CONDITIONS, IT LOADS * 00155002
*   THE ERROR CODE INTO REGISTER 15 BEFORE RETURNING.  AN RMC/DEQ OR  * 00165002
*   A DEQ IS PERFORMED BEFORE A BRANCH TO IGG0CLF2 (CVOL) OR A RETURN.* 00175002
*   IF AN I/O ERROR HAS OCCURRED IN AN ALLOCATE FUNCTION, THIS MODULE * 00185002
*   ISSUES MESSAGE IEC603I WITH CODE=0 TO THE OPERATOR.               * 00195002
*                                                                     * 00200000
*ENTRY POINTS:                                                        * 00220000
*        IGG0325H - ENTRY IS MADE FROM IGG0325E ON ZERO QUANTITY      * 00240000
*   REQUESTS, FROM IGG0325G ON ALL SPACE REQUESTS, AND ON AN ERROR    * 00260002
*   CONDITION FROM IGG0325T OR FROM ANY ALLOCATE MODULE (EXCEPT ISAM  * 00280002
*   ALLOCATE AND VIO ALLOCATE) THAT ENCOUNTERED THE ERROR.            * 00300002
*                                                                     * 00320000
*INPUT: WORK AREA USED BY PREVIOUS DADSM MODULES, THE UPDATED         * 00340000
*   FORMAT 4 DSCB IN THE WORK AREA, AND A CHANNEL PROGRAM TO WRITE    * 00360000
*   OUT THE UPDATED FORMAT 4 DSCB AND A ZERO RECORD IF REQUIRED.      * 00380000
*   ALSO ON ERROR CONDITIONS THE ERROR CODE PASS REGISTER (8) WILL    * 00400000
*   CONTAIN THE APPROPRIATE CODE FOR THE ERROR ENCOUNTERED. IF        * 00420021
*   DIRECTORIES WERE REQUESTED THE LOW CCHH FROM THE FIRST EXTENT     * 00440000
*   ALLOCATED TO THIS REQUEST WILL BE IN THE WORK AREA.               * 00460000
*   IF A DUPLICATE NAME DSCB WAS FOUND, THE WORK AREA WILL CONTAIN    * 00528021
*   THE CCHHR OF THE NEXT DSCB. ALSO, IF A FORMAT 1 DSCB WAS CREATED, * 00536021
*   THE WORK AREA WILL CONTAIN THE CCHHR OF THIS F1 DSCB. IF AN SMC   * 00544021
*   WAS PERFORMED, THE SET MUST COMPLETE INDICATOR WILL BE ON.        * 00552021
*                                                                     * 00560000
*OUTPUT: UPDATED FORMAT 4 DSCB AND A ZERO RECORD DSCB IF REQUIRED.    * 00580000
*   ON DIRECTORY REQUESTS THE WORK AREA WILL CONTAIN A DEB WITH THE   * 00600000
*   REQUIRED DATA FOR CVOL.  REGISTERS 1 AND 2 WILL ALSO CONTAIN      * 00620002
*   ADDITIONAL DATA FOR CVOL.  THE JFCB OR THE PARTIAL DSCB WILL      * 00628021
*   CONTAIN THE TTR OF THE F1 DSCB FOR BOTH SCHEDULER AND UTILITY     * 00636021
*   SPACE ALLOCATION REQUESTS AND THE TTR OF ANY DUPLICATE NAME DSCB  * 00644021
*   FOR UTILITY SPACE REQUESTS.                                       * 00652021
*                                                                     * 00660000
*EXTERNAL ROUTINES:                                                   * 00680000
*        EXCP(0) - READ FROM OR WRITE TO DIRECT ACCESS DEVICE         * 00700000
*        WAIT(1) - WAIT ON EVENT CONTROL BLOCK                        * 00720000
*        IECRES  - FREE WORK AREA(S), BRANCH TO ANOTHER MODULE        * 00740002
*        WTO(35) - WRITE MESSAGE TO OPERATOR                          * 00770002
*        DEQ(48) - RELEASE MUST COMPLETE AND DEQ THE VTOC             * 00800000
*        MSS(126)- ACQUIRE VIRTUAL VOLUME SPACE                OZ28204* 00810037
*                                                                     * 00820000
*EXITS:                                                               * 00830021
*   NORMAL - CLEAR REGISTER 15 AND RETURN TO THE EXIT PROLOG ADDRESS  * 00840002
*            BRANCH TO IGG0CLF2 (CVOL) TO BUILD REQUESTED DIRECTORIES * 00850002
*   ERROR  - PUT ERROR CODE INTO REGISTER 15 AND RETURN VIA CVTEXPRO  * 00860002
*                                                                     * 00900000
*   ERROR CODES THAT CAN BE ISSUED BY MODULE IGG0325H:                * 00920002
*                                                                     * 00940000
*   0C - PERMANENT I/O ERROR                                          * 00960000
*                                                                     * 00980000
*TABLES/WORK AREAS: ALLOCATE WORK AREA DESCRIBED BY MACRO 'IECALLWA'  * 01000002
*                                                                     * 01020000
*              ***************************************                * 01040000
*              *             DADSM TABLE             *                * 01060000
*              ***************************************                * 01080000
*                                                                     * 01100000
*              ***************************************                * 01120000
*              *        *         *                  *                * 01140000
*              *  TYPE  *  NO OF  *     USED HOLE    *                * 01160000
*              *  FLAG  * ENTRIES *      COUNTER     *                * 01180000
*              *        *         *                  *                * 01200000
*              ***************************************                * 01220000
*              *                  *                  *                * 01240000
*              *       RTA        *      RTA+1       *                * 01260000
*              *                  *                  *                * 01280000
*              ***************************************                * 01300000
*              *                  *                  *                * 01320000
*              *       RTA        *      RTA+1       *                * 01340000
*              *                  *                  *                * 01360000
*              ***************************************                * 01380000
*              *                  *                  *                * 01400000
*              *       RTA        *      RTA+1       *                * 01420000
*              *                  *                  *                * 01440000
*              ***************************************                * 01460000
*              *                  *                  *                * 01480000
*              *       RTA        *      RTA+1       *                * 01500000
*              *                  *                  *                * 01520000
*              ***************************************                * 01540000
*              *                  *                  *                * 01560000
*              *       RTA        *      RTA+1       *                * 01580000
*              *                  *                  *                * 01600000
*              ***************************************                * 01620000
*                                                                     * 01640000
*              TYPEFLG  =  02 - BPAM DIRECTORIES REQUESTED.           * 01660000
*                                                                     * 01680000
*                       =  40 - USER LABELS REQUESTED                 * 01684021
*                                                                     * 01688021
*                       =  80 - SET MUST COMPLETE IS ACTIVE           * 01692021
*                                                                     * 01696021
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.  * 01700000
*                                                                     * 01720000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.      * 01740000
*                                                                     * 01760000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT* 01780021
*                                                                     * 01800000
*ATTRIBUTES: REENTRANT                                                * 01820002
*                                                                     * 01840000
*NOTES:                                                               * 01860000
*   OTHER MACROS USED                                                 * 01880000
*   CVT - CVT MACRO EXPANSION                                         * 01890002
*   IECSDSL1 - BUILD DSCB'S                                           * 01900000
*   IECALLWA - ALLOCATE WORK AREA MACRO EXPANSION                     * 01910002
*   IEFJFCBN - BUILD JFCB                                             * 01920000
*                                                                     * 01940000
*                                                                     * 02000002
*STORAGE: PROGRAM CODE - LESS THAN 1024 BYTES                         * 02020002
*   WORK AREA - AS DEFINED IN THE IECALLWA MACRO                 XM2969 02030002
*   RPS WORK AREA - AS DEFINED IN THE IECRPS MACRO               XM2969 02040002
*                                                                     * 02060000
*                                                                       02080000
*REGISTER USAGE-                                                        02100000
*                                                                       02120000
RZERO    EQU   0                  REGISTER ZERO                  S21042 02130021
RONE     EQU   1                  REGISTER ONE                   S21042 02140021
R1       EQU   1                  XCTL TO CVOL REGISTER                 02160000
R2       EQU   2                  XCTL TO CVOL REGISTER                 02180000
RTWO     EQU   2                  REGISTER TWO                   S21042 02184021
RTTR     EQU   2                  POINTER TO TTR FIELD           S21042 02188021
ALTRWKA  EQU   3                  ALTERNATE WORKAREA POINTER     S21042 02192021
RWORK    EQU   3                  WORK REGISTER                  S21042 02196021
R3       EQU   3                  XCTL TO CVOL REGISTER                 02200000
R4       EQU   4                  XCTL TO CVOL REGISTER                 02220000
R5       EQU   5                  XCTL TO CVOL REGISTER                 02240000
DSAVREG  EQU   5                  PO DIRECTORY REQUEST SAVE REG OZ28204 02250037
R6       EQU   6                  HOLD ERROR CODE REGISTER              02260000
R7       EQU   7                        WORK REGISTER            O19117 02270019
RCHP     EQU   7                  CHANNEL PROGRAM START POINTER  S21042 02280021
RUCBPTR  EQU   7                        UCB POINTER              Y02078 02290002
RERRPASS EQU   8                        ERROR PASS REGISTER             02300000
RERRSAVE EQU   9                  ERROR CODE SAVE REGISTER       S21042 02320021
RJFCB    EQU   11                 JFCB POINTER                          02340000
RBASE    EQU   12                 BASE REGISTER                         02360000
RWKA     EQU   13                 WORK AREA POINTER.                    02380000
RBAK     EQU   14                 RETURN REGISTER                       02400000
RWRK     EQU   15                 WORK REGISTER                         02420000
RERR     EQU   15                 ERROR CODE REGISTER                   02440000
RCVT     EQU   15                 POINTER TO CVT                 S21042 02440421
*                                                                       02440921
* OTHER EQUATES                                                         02441421
*                                                                       02441921
ZERO     EQU   0                        VALUE ZERO               S21042 02442421
ONE      EQU   1                        CONSTANT OF 1           OZ28204 02442537
TWO      EQU   2                        CONSTANT OF 2            A46776 02442621
K3       EQU   3                        CONSTANT OF 3            Y02080 02442802
K4       EQU   4                        CONSTANT OF 4            XM2969 02443202
FOURCH   EQU   4                        CONSTANT NUMBER 4        S20201 02443620
K12      EQU   12                       CONSTANT OF 12           Y02080 02444002
APDIS    EQU   28                       DISP. TO AVT ADDR IN DEB S20201 02446320
DEBSCCHH EQU   38                       DISP. TO STARTING CCHH   Y02080 02446402
AVTDS    EQU   120                      DISP. TO AVT PTR. IN     S20201 02447220
*                                       W.A.                     S20201 02448120
DIRFBIT  EQU   X'04'                    VTOC INTERRUPT BIT       O19117 02450019
UCBADDR  EQU   32                       DISP. TO UCB ADDR IN DEB Y02078 02451002
UUU      EQU   37                       DISP. TO UUU IN MESSAGE  Y02078 02452002
VOLSER   EQU   41                       DISP. TO VOLSER IN MSG   Y02078 02453002
ZEROFLAG EQU   X'00'                    ZERO FLAGS FOR READ      XM2969 02455002
WRTCCW   EQU   X'0D'                    WRITE CCW CODE           XM2969 02457002
READCCW  EQU   X'0E'                    READ CCW CODE            XM2969 02459002
CYLBOUND EQU   X'C0'                    CYLINDER ALLOCATION     OZ28204 02459237
CYLROUND EQU   X'01'                    ROUND ALLOCATION        OZ28204 02459437
VIRTDASD EQU   X'08'                    VIRTUAL DASD BIT        OZ28204 02459637
*                                                                       02460000
* * * * * * * * * * * * *                                               02480000
*                                                                       02500000
*                                                                       02520000
* * * * * * * * * * * * *                                               02540000
*                                                                       02640000
         BALR  RBASE,0                                                  02660000
         USING START,RBASE                                              02680000
         USING ALLOCWKA,RWKA            WORK AREA ADDRESSABILITY Y02080 02700002
         USING JFCBFLD,RJFCB                                            02720000
         USING CVT,RCVT                                          S21042 02730021
*                                                                       02740000
START    EQU   *                                                 O19117 02750019
         XI    DS4VTOCI,DIRFBIT         RESET/SET DIRF BIT       O19117 02760019
         LR    RERRSAVE,RERRPASS        SAVE ERROR CODE          S21042 02760321
         CH    RERRPASS,DUPNAME         TEST IF DUP NAME DSCB    S21042 02760621
         BNE   NOERRTST                 BRANCH IF NOT            S21042 02760921
         LTR   RJFCB,RJFCB              TEST FOR PARTIAL DSCB    A46776 02761221
         BP    NOERRTST                 BRANCH IF NOT            S21042 02761521
         SR    RWORK,RWORK              CLEAR REGISTER           S21042 02761821
         IC    RWORK,IDAREA+4           GET RECORD NUMBER        S21042 02762121
         BCT   RWORK,SAVEREC            DECREMENT RECORD NUMBER  S21042 02762421
         IC    RWORK,DS4DEVDT           SET RECORD NUMBER TO     S21042 02762721
*                                       MAX NUMBER OF DSCB'S/TRK S21042 02763021
SAVEREC  EQU   *                                                 S21042 02763321
         STC   RWORK,IDAREA+4                                    S21042 02763621
         MVC   CCHHR(5),IDAREA          MOVE IN CCHHR            S21042 02763921
         B     CONVERT                  GO CONVERT CCHHR TO TTR  S21042 02764221
NOERRTST EQU   *                                                 S21042 02764521
         LTR   RERRPASS,RERRPASS        TEST FOR ERROR CODE OF 0 S21042 02765721
         BNZ   TESTDIRF                 BRANCH IF NOT            S21042 02766021
*                                                                       02767221
* CONVERT THE F1 DSCB CCHHR OR THE DUPLICATE NAME CCHHR TO A TTR        02767521
* USING THE RESIDENT CONVERSION ROUTINE.                                02767821
*                                                                       02768121
CONVERT  EQU   *                                                 S21042 02768421
         LA    R1,DEB                   POINTER TO DEB           S21042 02768721
         LA    R2,MBBCCHHR              POINTER TO MBBCCHHR      S21042 02769021
         XC    MBBCCHHR,MBBCCHHR        CLEAR CONVERT AREA       Y02080 02769402
         MVC   MBBCCHHR+K3(L'CCHHR),CCHHR  MOVE IN F1 CCHHR      Y02080 02769602
         STM   RERRSAVE,RWKA,IECREGSV+K12 SAVE REGISTERS         Y02080 02770202
         LR    ALTRWKA,RWKA             GET POINTER TO WORKAREA  S21042 02770521
         DROP  RWKA                                              S21042 02770821
         USING ALLOCWKA,ALTRWKA         WORK AREA ADDRESSABILITY Y02080 02771102
         L     RCVT,CVTPTR              LOAD CVT BASE            S21042 02771421
         L     RCVT,CVTPRLTV            LOAD TTR CONVERT ROUTINE S21042 02771721
*                                       BASE                     S21042 02772021
         BALR  RBAK,RCVT                CONVERT CCHHR            S21042 02772321
         LM    RERRSAVE,RWKA,IECREGSV+K12 RESTORE REGISTERS      Y02080 02772602
         DROP  ALTRWKA                                           S21042 02772921
         USING ALLOCWKA,RWKA            WORK AREA ADDRESSABILITY Y02080 02773202
         ST    RZERO,FULLWORD                                    S21042 02773521
         DROP  RCVT                                              S21042 02773821
         LTR   RJFCB,RJFCB              TEST FOR PARTIAL DSCB    A46776 02774121
         BP    NOTPDSCB                 BRANCH IF NO             A46776 02774421
         LA    RTTR,DSCBTTR             POINT TO TTR FIELD       S21042 02774721
         B     STORETTR                 GO MOVE IN TTR           S21042 02775021
NOTPDSCB EQU   *                                                 A46776 02775321
         LA    RTTR,JFCBDSCB            POINT TO TTR FIELD       S21042 02775621
STORETTR EQU   *                                                 S21042 02775921
         MVC   0(3,RTTR),FULLWORD       MOVE IN TTR              S21042 02776221
         LTR   RERRSAVE,RERRSAVE        TEST FOR ERROR CODE OF 0 S21042 02776521
         BE    TSTZERO                  BRANCH IF YES                   02780000
TESTDIRF EQU   *                                                 S21042 02820021
         TM    DS4VTOCI,DIRFBIT         TEST RESULTS             O19117 02861019
         BO    ERREXIT                  BR IF PREVIOUS INTERRUPT O19117 02868019
         CH    RERRPASS,IOCODE          Q - I/O ERROR            O19117 02875019
         BE    ERREXIT                  IF YES, BR               O19117 02882019
         B     WRITEF4                  GO WRITE F4              O19117 02889019
*                                                                       02891021
* WRITE A ZERO RECORD IF NECESSARY.                                     02893021
*                                                                       02895021
TSTZERO  EQU   *                        TEST TO WRITE AN F0      Y02080 02897002
         TM    ACNVSW,AF5ZERO           DOES F5 WITH ALL ZERO    XM2969 02899002
*                                       EXTENTS EXIST            XM2969 02899402
         BNO   READPREV                 NO, BYPASS READING       XM2969 02899802
*                                       PREVIOUS F5              XM2969 02899902
         TM    ASWITCH,FRSTF5           IS FIRST F5 IN CORE      XM2969 02906602
*                                       INDICATOR SET            XM2969 02908602
         BO    READPREV                 BRANCH IF NOT SET        XM2969 02910602
         MVC   IDAREA,ALLCCHHR          MOVE SEARCH ARGUEMENT    XM2969 02912602
         MVI   CCW11+K4,ZEROFLAG        ZERO FLAGS FOR READ      XM2969 02913002
         LA    RCHP,CCW9                ADDR OF CHAN PGM START   XM2969 02913102
         BAL   R2,CHANNLGO              BAL TO READ F5           XM2969 02913202
         MVC   FMTINAD,DS5PTRDS         SAVE CCHHR OF NEXT F5    XM2969 02919902
         XC    DS5PTRDS,DS5PTRDS        ZERO CHAIN POINTER       XM2969 02921902
         MVI   CCW11,WRTCCW             CHANGE READ CCW TO WRITE XM2969 02923902
         BAL   R2,CHANNLGO              BAL TO WRITE BACK F5     XM2969 02925902
         MVI   CCW11,READCCW            RESTORE READ CCW         XM2969 02926302
         B     SETADDR                  CONTINUE                 XM2969 02926402
READPREV EQU   *                        BRANCH LABEL             XM2969 02926502
         TM    ASWITCH,WRZERO           IS WRITE F0 DSCB PENDING Y02080 02926602
         BZ    WRITEF4                  NO - CONTINUE TESTING           02933302
SETADDR  EQU   *                        BRANCH LABEL             XM2969 02935302
         MVC   IDAREA(5),FMTINAD        SET UP ADDR OF RCD TO BE ZEROED 02940000
         XC    DS1DSNAM(140),DS1DSNAM   CLEAR OUTPUT AREA               02960000
         MVI   CCW11+4,X'10'            TURN ON SKIP FLAG               02980000
         LA    RCHP,CCW6                START CHAN PROG AT CCW6  S21042 03000021
         BAL   R2,CHANNLGO              GO WRITE AN F0           O19117 03020019
         LH    RWRK,DS4DSREC            GET NBR OF AVAIL HOLES          03040000
         LA    RWRK,1(RWRK)             INCREMENT BY ONE                03060000
         STH   RWRK,DS4DSREC            RESET HOLE COUNT                03080000
*                                                                       03100000
* THIS ROUTINE SETS UP CHANNEL PROGRAM AND WRITES F4 DSCB               03120000
*                                                                       03140000
WRITEF4  EQU   *                                                 O19117 03150019
         MVC   IDAREA(5),VTOCADR        START SEEK/SRCH ON VTOC  O19117 03160019
         LM    R2,R7,XCCW1              LOAD 1ST 3 CCW'S         O19117 03170019
         ALR   R2,RWKA                  RESOLVE                  O19117 03180019
         ALR   R4,RWKA                    CORE                   O19117 03190019
         ALR   R6,RWKA                      ADDRESSES            O19117 03200019
         STM   R2,R7,CCW1               STORE 1ST 3 CCW'S        O19117 03210019
         LM    R4,R7,XCCW5              LOAD LAST 2 CCW'S        O19117 03220019
         ALR   R4,RWKA                  RESOLVE CORE             O19117 03230019
         ALR   R6,RWKA                    ADDRESSES              O19117 03240019
         STM   R2,R7,CCW4               STORE LAST 3 CCW'S       O19117 03250019
         LA    RCHP,CCW1                START CHAN PROG AT CCW1  S21042 03260021
         BAL   R2,CHANNLGO              GO WRITE F4              O19117 03270019
*                                                                       03360000
* FOR A DIRECTORY REQUEST, THIS SECTION PREPARES TO BRANCH TO CVOL.     03380002
*                                                                       03400000
TSTDIR   TM    TYPEFLG,X'02'            ARE DIRECTORIES REQUESTED       03420000
         BZ    GOODEND                 BRANCH IF NO                     03440000
         BAL   R2,CVOLDEQ               GO DEQ VTOC BEFORE XCTL  O19117 03450019
         MVC   DEB+DEBSCCHH(FOURCH),SLOWCCHH  MOVE THE STARTING  Y02080 03540002
*                                       CCHH TO THE DEB FOR CVOL A46776 03546021
         XR    RWORK,RWORK             ZERO WORK REG            OZ28204 03586037
         LTR   RJFCB,RJFCB             TEST FOR PARTIAL DSCB     A46776 03620021
         BP    LOADDQTY                BRANCH IF NO              A46776 03640021
*                                                                       03660000
* UTILITY SPACE REQUEST - PICK UP DIRECTORY QUANTITY FROM PARTIAL DSCB  03680021
*                                                                       03700000
         L     RONE,PDDIRQTY            LOAD NUMBER OF DIRECTORY Y02080 03710002
*                                       BLOCKS REQUESTED         S21042 03720021
         IC    RWORK,PD1SCALO           LOAD ALLOCATION TYPE    OZ28204 03740037
         B     CK4MSSV                                          OZ28204 03746037
*                                                                       03760000
* NOT A UTILITY REQUEST - PICK UP DIRECTORY QUANTITY FROM THE JFCB      03780021
*                                                                       03800000
LOADDQTY EQU   *                                                 A46776 03810021
         L     RONE,JFCBDQTY            LOAD NUMBER OF DIRECTORY Y02080 03820002
*                                       BLOCKS REQUESTED         S21042 03830021
         SRL   RONE,8                   POSITION THIS NUMBER     Y02080 03840002
         IC    RWORK,JFCBCTRI           LOAD ALLOCATION TYPE    OZ28204 03844037
CK4MSSV  EQU   *                                                OZ28204 03844437
*      CHECK FOR A MSS VIRTUAL VOLUME AND ISSUE AN ACQUIRE      OZ28204 03844837
*      ORDER FOR THE DIRECTORY EXTENTS IF MSS.                  OZ28204 03845237
         L     RUCBPTR,DEB+UCBADDR      POINT TO UCB            OZ28204 03845637
         USING UCB,RUCBPTR                                      OZ28204 03846037
         TM    UCBTBYT2,VIRTDASD        MSS VIRTUAL VOLUME?     OZ28204 03846437
         BNO   LOADPTR                  NO, BY PASS ACQUIRE     OZ28204 03846837
         LR    DSAVREG,RONE             SAVE NUM OF DIRC BLKS   OZ28204 03847237
         LA    RONE,DSCBF1              POINT TO ACQUIRE LIST   OZ28204 03847637
         USING ACQLST,RONE                                      OZ28204 03848037
         XC    ACQLST(ACQLTH),ACQLST    ZERO ACQUIRE LIST       OZ28204 03848437
         MVI   ACQLST+3,ACQLTH          LENGTH OF LIST          OZ28204 03848837
         MVC   ARVOL,UCBVOLI            MOVE IN VOLSER          OZ28204 03849237
         MVI   ARNMEXTS,ONE             SET TO ONE EXTENT       OZ28204 03849637
         MVI   AROP,ACQOP               SET ACQUIRE OP CODE     OZ28204 03850037
         STC   RWORK,AREXT              PREPARE TO TEST ALLOC   OZ28204 03850437
*                                       TYPE CYL OR TRK BOUNDRY OZ28204 03850837
         TM    AREXT,CYLBOUND           CYLINDER BOUNDRY ?      OZ28204 03851237
         BO    INHIBIT                  YES, INHIBIT STAGE      OZ28204 03851637
         TM    AREXT,CYLROUND           CYLINDER BOUNDRY ?      OZ28204 03852037
         BO    INHIBIT                  YES, INHIBIT STAGE      OZ28204 03852437
         B     COMPEXT                  NO, STAGE DATA          OZ28204 03852837
INHIBIT  EQU   *                                                OZ28204 03853237
         OI    ARFLAG,INHFLG            SET INHIBIT STAGE       OZ28204 03853637
COMPEXT  EQU   *                                                OZ28204 03854037
*      COMPUTE THE CYLINDERS REQUIRED TO CONTAIN                OZ28204 03854437
*      DIRECTORY REQUEST.                                       OZ28204 03854837
         DROP  RUCBPTR                  REMOVE UCB PTR          OZ28204 03855237
         MVC   AREXT(2),SLOWCCHH        INIT BEGINING AND ENDINGOZ28204 03855637
         MVC   AREXT+2(2),SLOWCCHH      TO THE SAME CYLINDER    OZ28204 03856037
         XR    R4,R4                    ZERO WORK REG           OZ28204 03856437
         IC    R4,DS4DEVDB              R4=DIRC BLKS PER TRACK  OZ28204 03856837
         CR    DSAVREG,R4               REQUESTED DIRC BLKS GT  OZ28204 03857237
*                                       THAN DIRC BLKS PER TRK? OZ28204 03857637
         BNH   DOACQ                    NO , GO ISSUE ACQUIRE   OZ28204 03858037
*      COMPUTE TTR OF DIRECTORY                                 OZ28204 03858437
         XR    R2,R2                    ZERO WORK REG           OZ28204 03858837
         LR    R3,DSAVREG               R3=NUMBER OF DIRC REQ.  OZ28204 03859237
         DR    R2,R4                    R3=TT OF DIREC EXTENT   OZ28204 03859637
         LTR   R2,R2                    R4=REMAINDER ?          OZ28204 03860037
         BZ    STOREXT                  NO , ON TRK BOUNDRY     OZ28204 03860437
         LA    R3,1(R3)                 ROUND TO NEXT TRACK     OZ28204 03860837
STOREXT  EQU   *                                                OZ28204 03861237
*      CONVERT TTR TO MBBCCHHR                                  OZ28204 03861637
         LR    RZERO,R3                 R0=XXTT                 OZ28204 03862037
         SLL   RZERO,16                 R0=TTRN                 OZ28204 03862437
         LA    R2,AREXT+4               R2=POINTER TO MBBCCHHR  OZ28204 03862837
         LA    RONE,DEB                 R1=POINTER TO DEB       OZ28204 03863237
         STM   RERRSAVE,RWKA,IECREGSV+K12 SAVE REGS             OZ28204 03863637
         LR    ALTRWKA,RWKA             USE ALTRN WORK AREA REG OZ28204 03864037
         DROP  RWKA                                             OZ28204 03864437
         USING ALLOCWKA,ALTRWKA                                 OZ28204 03864837
         L     RCVT,CVTPTR              POINT CONVERT ROUTINE   OZ28204 03865237
         USING CVT,RCVT                                         OZ28204 03865637
         L     RCVT,CVTPCNVT                                    OZ28204 03866037
         BALR  RBAK,RCVT                GO TO CONVERT ROUTINE   OZ28204 03866437
         LM    RERRSAVE,RWKA,IECREGSV+K12 RESTORE REGS          OZ28204 03866837
         DROP  ALTRWKA                                          OZ28204 03867237
         USING ALLOCWKA,RWKA            RETURN TO WORK REG      OZ28204 03867637
         DROP  RCVT                                             OZ28204 03868037
         LA    RONE,DS1DSNAM            POINT TO ACQUIRE LIST   OZ28204 03868437
         MVC   AREXT+2(2),AREXT+7       SAVE ENDING CC IN LIST  OZ28204 03868837
         XC    AREXT+4(8),AREXT+4       ZERO WORK AREA USED     OZ28204 03869237
DOACQ    EQU   *                                                OZ28204 03869637
         ICBACREL  TYPE=ACQ,MF=(E,(1))  ISSUE ACQUIRE           OZ28204 03870037
*     NO TEST IS MADE FOR SUCCESSFUL COMPLETION.FORMATTING      OZ28204 03870437
*     OF DIRECTORY WILL CYLINDER FAULT IF UNSUCESSFUL.          OZ28204 03870837
         DROP  RONE                                             OZ28204 03871237
         LR    RONE,DSAVREG             RESTORE NUMBER OF REQ.  OZ28204 03871637
*                                       DIRECTORY BLOCKS        OZ28204 03872037
LOADPTR  EQU   *                                                 A46776 03872437
         SR    R2,R2                    GET NBR OF DIR/BLKS PER TRACK   03880000
         IC    R2,DS4DEVDB                                              03900000
         IECRES LOAD,EXTPR=(RWKA),MODNM=CVOLNAME,BRANCH=DIRECT   Y02080 04010002
*                                                                       04100000
* SUCCESSFUL ALLOCATION EXIT                                            04120000
*                                                                       04140000
GOODEND  SR    RERRPASS,RERRPASS        CLEAR ERROR HOLD REGISTER       04160000
*                                                                       04180000
ERREXIT  EQU   *                                                 O19117 04190019
         LA    R2,RETURN                RETURN REG EQUAL         O19117 04200019
*                                       FREEMAIN                 O19117 04210019
CVOLDEQ  MVC   MJELNAME(8),VTOCNAME     MOVE MAJOR QUE NAME TO WORKAREA 04220000
         MVI   DEQAREA,X'FF'            SET LAST ENTRY CODE             04240000
         SR    R1,R1                    CLEAR OPTION AND RTN FIELDS     04260000
         STH   R1,DEQAREA+2                                             04280000
         TM    TYPEFLG,SMCDONE          IS SET MUST COMP SWITCH ON      04300000
         BZ    NOSMC                    BRANCH IF NO                    04320000
*                                                                       04340000
* LINK TO THE DEQ ROUTINE TO RELEASE MUST COMPLETE AND DEQ THE VTOC     04360000
*                                                                       04380000
         DEQ   (MJELNAME,MIELNAME,6,SYSTEMS),RMC=STEP,MF=(E,DEQAREA)    04400016
*                                                                       04420000
         NI    DSMADTB2,X'FF'-DSMVTOCR-DSMSMCE  RESET ENQ'ED SWS Y02144 04430002
         BR    R2                                                O19117 04440019
*                                                                       04460000
* LINK TO THE DEQ ROUTINE TO DEQ THE VTOC                               04480000
*                                                                       04500000
NOSMC    DEQ   (MJELNAME,MIELNAME,6,SYSTEMS),MF=(E,DEQAREA)             04520016
*                                                                       04530002
         NI    DSMADTB2,X'FF'-DSMVTOCR  RESET VTOC ENQ'ED SWITCH Y02144 04540002
         BR    R2                       RETURN                   Y02080 04541002
*                                                                       04542002
* THIS SECTION ISSUES MESSAGE IEC603I IF AN I/O ERROR OCCURRED.         04543002
*                                                                       04544002
RETURN   EQU   *                        TEST FOR I/O ERROR       Y02080 04545002
         CH    RERRPASS,IOCODE          TEST FOR I/O ERROR       Y02078 04546002
         BNE   RPSTEST                  BRANCH IF NO I/O ERROR   Y02078 04547002
         MVC   DSCBF1(MSGEND-ERRMSG),ERRMSG  MOVE IN MESSAGE     Y02078 04548002
         L     RUCBPTR,DEB+UCBADDR      LOAD UCB ADDRESS         Y02078 04549002
         USING UCB,RUCBPTR              UCB ADDRESSABILITY       Y02078 04550002
         MVC   DSCBF1+UUU(L'UCBNAME),UCBNAME  MOVE IN EBCDIC     Y02078 04551002
*                                       CHANNEL/UNIT ADDRESS     Y02078 04552002
         MVC   DSCBF1+VOLSER(L'SRTEVOLI),SRTEVOLI  MOVE IN VOLID Y02078 04553002
         WTO   MF=(E,DSCBF1)            ISSUE ERROR MESSAGE      Y02078 04554002
*                                                                       04555002
RPSTEST  EQU   *                        TEST FOR RPS             Y02078 04556002
         TM    DSMADTB1,DSMRPSAP        TEST IF RPS APPENDAGE    YM3048X04558002
                                        IGG019EK WAS LOADED      YM3048 04560002
         BNO   CONTINUE                 BRANCH IF NOT            YM3048 04562002
         L     RONE,DEB+APDIS           POINT TO APPENDAGE TABLE S20201 04563020
         MVC   DEB+APDIS(FOURCH),AVTDS(RONE) RESTORE DEB AVT PTR YM3997 04567002
         NI    DSMADTB1,X'FF'-DSMRPSAP  RESET RPS APP LOADED SW  Y02144 04575002
*                                                                       04580000
* FREE WORK AREA IF SUCCESSFUL ALLOCATION OR IF UNABLE TO COMPLETE      04600000
* ALLOCATION                                                            04620000
*                                                                       04640000
CONTINUE EQU   *                                                 S20201 04650020
         IECRES FREE,PREFIX=FIRST,A=(RWKA)  FREE WORK AREAS      Y02080 04660002
         USING CVT,RCVT                 CVT ADDRESSABILITY       Y02080 04662002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02080 04670002
         L     RBAK,CVTEXPRO            LOAD EXIT PROLOG ADDRESS Y02080 04672002
         LR    RERR,RERRPASS            LOAD ERROR REGISTER             04680000
         RETURN ,                       RETURN                   Y02080 04710002
*                                                                       04720000
* THIS SECTION LINKS TO IOS FOR ALL I/O OPERATIONS                      04740000
*                                                                       04760000
CHANNLGO MVI   ECB,X'00'                                                04780000
         ST    RCHP,IOB+16              STORE START OF CHAN PROG S21042 04800021
         MVC   SEEK+3(4),IDAREA                                         04820000
         EXCP  IOB                                                      04840000
         WAIT  ECB=ECB                                                  04860000
         TM    ECB,X'20'                TEST FOR A PERMANENT I/O ERROR  04880000
         BNO   IOERR                    IF I/O ERROR, BR         O19117 04885019
         LTR   RERRPASS,RERRPASS        WAS THIS A FORCE F4      O19117 04890019
*                                       WRITE                    O19117 04895019
         BCR   8,R2                     IF NOT, BR               O19117 04900019
         B     ERREXIT                  YES, TAKE ERROR EXIT     O19117 04905019
IOERR    EQU   *                                                 O19117 04910019
*                                                                       04920000
* ERROR - PERMANENT I/O ERROR                                           04940000
*                                                                       04960000
         LA    RERRPASS,X'0C'           SET ERROR CODE 'PERM I/O ERROR  04980000
         B     ERREXIT                                                  05000000
*                                                                       05520000
* * * * * * * * * * * * *                                               05540000
*                                                                       05560000
***   CONSTANTS                                                         05580000
*                                                                       05600000
* * * * * * * * * * * * *                                               05620000
*                                                                       05690000
ERRMSG   WTO   'IEC603I VTOC ERRORS MAY EXIST ON UUU,VOLSER,0',  Y02078X05691002
               ROUTCDE=(4,10),DESC=4,MF=L                        Y02078 05692002
MSGEND   EQU   *                        MSG DELIMITER            Y02078 05693002
VTOCNAME DC    CL8'SYSVTOC'             MAJOR QUEUE NAME                05740000
IOCODE   DC    H'12'                    I/O ERROR CODE           O19117 05740719
DUPNAME  DC    H'4'                     DUP NAME ERROR CODE      S21042 05740821
*                                                                       05741419
* CHANNEL PROGRAM SKELETON                                              05742119
*                                                                       05742819
         DS    0F                                                O19117 05743519
XCCW1    DC    X'31'                    SEARCH ID EQUAL          O19117 05744219
         DC    AL3(IDAREA-FIRST)                                 O19117 05744919
         DC    X'4000'                                           O19117 05745619
         DC    H'5'                                              O19117 05746319
XCCW2    DC    X'08'                    TIC                      O19117 05747019
         DC    AL3(CCW1-FIRST)                                   O19117 05747719
         DC    F'0'                                              O19117 05748419
XCCW3    DC    X'05'                    WRITE DATA               O19117 05749119
         DC    AL3(DS4IDFMT-FIRST)                               O19117 05749819
         DC    X'4000'                                           O19117 05750519
         DC    H'96'                                             O19117 05751219
*XCCW4         (WILL BE DUPLICATED FROM XCCW1)                          05751919
XCCW5    DC    X'08'                    TIC                      O19117 05752619
         DC    AL3(CCW4-FIRST)                                   O19117 05753319
         DC    F'0'                                              O19117 05754019
XCCW6    DC    X'06'                    READ DATA/SKIP (WRITE    O19117 05754719
*                                       CK)                      O19117 05755419
         DC    AL3(DS4IDFMT-FIRST)                               O19117 05756119
         DC    X'1000'                                           O19117 05756819
         DC    H'96'                                             O19117 05757519
*                                                                       05780000
* TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                       05800002
*                                                                       05820000
         XCTLTABL ID=(CVOLNAME,IGG0CLF2),SVC=032,LENGTH=,BRT=YES Y02080 05870002
         EJECT                                                   Y02080 05920002
DSCBWKAR IECALLWA EP,F4,D1=(1),D2=(5),ADT=YES ALLOCATE WORK AREA XM2969 05970002
DEQAREA  EQU   ADSCBF4                  DEQUEUE PARAMETER LIST   Y02080 08020002
MJELNAME EQU   DEQAREA+16               MAJOR ELEMENT NAME       Y02080 08040002
         SPACE 2                                                 Y02078 08090002
         IECDSECS CVT,UCB,EXPAND=YES    CVT AND UCB DSECTS       Y02078 08140002
JFCBFLD  DSECT                                                          08220000
         IEFJFCBN                                                       08240000
         EJECT                                                   Y02080 08250002
*                                                                       08290021
* * * * * * * * * * * * *                                               08340021
*                                                                       08390021
***   DSECT FOR THE PARTIAL DSCB PASSED TO ALLOCATE BY IEHMOVE   A46776 08440021
*                                                                       08490021
* * * * * * * * * * * * *                                               08540021
*                                                                       08590021
         ORG   INFMJFCB                                                 08640021
PD1DSNAM DS    CL44                DATA SET NAME                        08690021
PD1FMTID DS    CL1                 FORMAT IDENTIFIER                    08740021
PD1DSSN  DS    CL6                 DATA SET SERIAL NUMBER               08790021
PD1VOLSQ DS    XL2                 VOLUME SEQUENCE NUMBER               08840021
PD1CREDT DS    XL3                 CREATION DATE                        08890021
PD1EXPDT DS    XL3                 EXPIRATION DATE                      08940021
PD1NOEPV DS    XL1                 NUMBER OF EXTENTS ON VOLUME          08990021
PD1NOBDB DS    XL1                 NUMBER OF BYTES USED IN LAST         09040021
*                                     DIRECTORY BLOCK                   09090021
         DS    XL1                 RESERVED                             09140021
PD1SYSCD DS    CL13                SYSTEM CODE                          09190021
         DS    XL7                 RESERVED                             09240021
PD1DSORG DS    XL2                 DATA SET ORGANIZATION                09290021
PD1RECFM DS    XL1                 RECORD FORMAT                        09340021
PD1OPTCD DS    XL1                 OPTION CODE                          09390021
PD1BLKL  DS    XL2                 BLOCK LENGTH                         09440021
PD1LRECL DS    XL2                 RECORD LENGTH                        09490021
PD1KEYL  DS    XL1                 KEY LENGTH                           09540021
PD1RKP   DS    XL2                 RELATIVE KEY POSITION                09590021
PD1DSIND DS    XL1                 DATA SET INDICATORS                  09640021
PD1SCALO DS    XL4                 SECONDARY ALLOCATION                 09690021
PD1LSTAR DS    XL3                 LAST USED TRACK AND BLOCK ON TRACK   09740021
PD1TRBAL DS    XL2                 BYTES REMAINING ON LAST TRACK USED   09790021
         DS    XL2                 RESERVED                             09840021
PD1EXT1  DS    XL1                 EXTENT TYPE INDICATOR                09890021
         DS    XL2                 UNUSED                               09940021
PDPRIQTY DS    F                   PRIMARY SPACE REQUEST IN TRACKS      09990021
PDDIRQTY DS    F                   NUMBER OF DIRECTORY BLOCKS           10040021
DSCBTTR  EQU   PD1SYSCD            TTR FIELD IN PARTIAL DSCB     A46776 10090021
         EJECT                                                  OZ28204 48280037
ACQLST   DSECT                     MSS VOLUME ACQUIRE LIST      OZ28204 48330037
ACQOP    EQU   X'02'               ACQUIRE OP CODE              OZ28204 48380037
ACQLTH   EQU   96                  LENGTH OF ACQUIRE ORDER      OZ28204 48430037
INHFLG   EQU   X'20'               INHIBIT STAGE FLAG           OZ28204 48480037
         ICBACREL  TYPE=ACQ,MF=L                                OZ28204 48530037
         END   IGG0325H                                          S21042 48580037
./  ADD  SSI=70630386,NAME=IGG0325I
         TITLE 'IGG0325I - VIO ALLOCATION                              *00001000
                        '                                               00002000
IGG0325I CSECT ,                                                   0001 00003000
@PROLOG  BALR  @12,0                                               0001 00004000
@PSTART  DS    0H                                                  0001 00005000
         USING @PSTART,@12                                         0001 00006000
JSCBDISP EQU 188                                                        00007000
JSCBAOS1 EQU  72                                                        00008000
JSCBAOS2 EQU 192                                                        00009000
K2       EQU   2                        CONSTANT OF 2            YM1110 00010000
K4       EQU   4                        CONSTANT OF 4            YM1110 00011000
K32      EQU   32                       CONSTANT OF 32                  00012000
K38      EQU   38                       CONSTANT OF 38           YM1110 00013000
SCHEDKEY EQU   1                        PROTECT KEY OF SCHEDULER        00014000
HEXZERO  EQU   X'00'                    HEX CONSTANT OF 0               00015000
         USING ALLOCWKA,RALLOCWA        ALLOCATE WORK AREA              00016000
*   /*****************************************************************/ 00017000
*   /*                                                               */ 00018000
*   /* INITIALIZATION                                                */ 00019000
*   /*                                                               */ 00020000
*   /*****************************************************************/ 00021000
*   AVJFCB = DUMYJFCB;                  /*COPY JFCB                  */ 00022000
         MVC   AVJFCB(176),DUMYJFCB(JFCBPTR)                       0097 00023000
*   AVDEVTYP = DEVICTYP;                /*COPY DEVICE TYPE FIELD     */ 00024000
         MVC   AVDEVTYP(4),DEVICTYP(R7)                            0098 00025000
*   JFCBPTR = ADDR(AVJFCB);             /*USE WORK AREA JFCB         */ 00026000
         LA    JFCBPTR,AVJFCB                                      0099 00027000
*   GEN(MODESET EXTKEY=SCHED);          /*ASSUME KEY 1 TO CONTINUE   */ 00028000
         MODESET EXTKEY=SCHED                                           00029000
*   /*****************************************************************/ 00030000
*   /*                                                               */ 00031000
*   /*  BUILD VDSCB                                                  */ 00032000
*   /*                                                               */ 00033000
*   /*****************************************************************/ 00034000
*   /*                                                               */ 00035000
*   /* GET CORE FOR VIRTUAL DSCB                                     */ 00036000
*   /*                                                               */ 00037000
*   RESPECIFY R9 RESTRICTED;                                       0101 00038000
*   RESPECIFY JSCBACTP RESTRICTED;                                 0102 00039000
*   JSCBACTP = JSCBACT;                 /*GET ADDR OF ACTIVE JSCB    */ 00040000
         L     @08,CVTPTR                                          0103 00041000
         L     @08,CVTTCBP(,@08)                                   0103 00042000
         L     @08,TCBPTR(,@08)                                    0103 00043000
         L     @08,TCBJSCB(,@08)                                   0103 00044000
         L     JSCBACTP,JSCBACT(,@08)                              0103 00045000
*   RESPECIFY IEZJSCB BASED(JSCBACTP);                             0104 00046000
*   R9 = JSCBSWSP;                      /*GET SWA SUBPOOL NUMBER     */ 00047000
         SLR   R9,R9                                               0105 00048000
         IC    R9,JSCBSWSP(,JSCBACTP)                              0105 00049000
*   RESPECIFY JSCBACTP UNRESTRICTED;                               0106 00050000
*   RESPECIFY IEZJSCB BASED(TCBJSCB);                              0107 00051000
*   RESPECIFY R1 RESTRICTED;                                       0108 00052000
*   /*GET VDSCB CORE                                                 */ 00053000
*   R1 = LENGTH(VDSCB);                                            0109 00054000
         LA    R1,205                                              0109 00055000
*   GEN REFS (R1,R9,CVT);                                          0110 00056000
         IECRES GET,LV=(R1),SP=(R9),KEY=SCHEDKEY,PREFIX=NO,            X00057000
               STM=(R2,RF,IECREGSV+12)                                  00058000
*   DEVICTYP = R1;                      /*ADDRESS OF VDSCB           */ 00059000
         ST    R1,DEVICTYP(,R7)                                    0111 00060000
*   VDSCBPTR = R1;                      /*SET UP BASE FOR VDSCB      */ 00061000
         LR    VDSCBPTR,R1                                         0112 00062000
*   DSMADTW3 = VDSCBPTR;                /*SAVE POINTER TO VDSCB      */ 00063000
         ST    VDSCBPTR,DSMADTW3                                   0113 00064000
*   GEN(OI    DSMADTB1,DSMVIO);         /*SET VIO DATA SET SWITCH    */ 00065000
         OI    DSMADTB1,DSMVIO                                          00066000
*   RESPECIFY (R1,R9) UNRESTRICTED;                                0115 00067000
*   /*                                                               */ 00068000
*   /* GO TO ROUTINE TO BUILD THE VDSCB                              */ 00069000
*   /*                                                               */ 00070000
*   CALL BLDVDSCB;                                                 0116 00071000
         BAL   @14,BLDVDSCB                                        0116 00072000
*   /*****************************************************************/ 00073000
*   /*                                                               */ 00074000
*   /* MODULE TERMINATION                                            */ 00075000
*   /*                                                               */ 00076000
*   /*****************************************************************/ 00077000
*   RFY RETCODE RSTD;                                              0117 00078000
*   RETCODE = ECNORM;                   /*RETURN CODE EQUALS ZERO    */ 00079000
         SLR   RETCODE,RETCODE                                     0118 00080000
*   RFY RETCODE UNRSTD;                                            0119 00081000
*   GEN(MODESET EXTKEY=ZERO);           /*RETURN TO KEY 0      YM3171*/ 00082000
         MODESET EXTKEY=ZERO                                            00083000
*   IF JFCBDQTY ¬= 0 THEN               /*IF PDS, GO TO IGG0CLF2     */ 00084000
         ICM   @06,7,JFCBDQTY(JFCBPTR)                             0121 00085000
         BZ    @RF00121                                            0121 00086000
*     DO;                                                          0122 00087000
*       GEN(ST    VDSCBPTR,DEB+K32);    /*PUT UCB ADDRESS IN DEB     */ 00088000
         ST    VDSCBPTR,DEB+K32                                         00089000
*       RESPECIFY (R1,R2,R8) RESTRICTED;                           0124 00090000
*       R1 = JFCBDQTY;                  /*PASS DIRECTORY QUANTITY    */ 00091000
         SLR   R1,R1                                               0125 00092000
         ICM   R1,7,JFCBDQTY(JFCBPTR)                              0125 00093000
*       R2 = AVDIRBT;                   /*PASS NO. DIR BLKS PER TRACK*/ 00094000
         LH    R2,AVDIRBT                                          0126 00095000
*                                       /*PASS D/S START CCHH  YM1110*/ 00096000
*       GEN(MVC   DEB+K38(K4),VDSDSCB+DS1EXT1+K2(VDSCBPTR)); /*YM1110*/ 00097000
         MVC   DEB+K38(K4),VDSDSCB+DS1EXT1+K2(VDSCBPTR)                 00098000
*       GEN(IECRES LOAD,EXTPR=(RALLOCWA),MODNM=AVCLF2,BRANCH=DIRECT)    00099000
*         REFS(CVT);                                               0128 00100000
         IECRES LOAD,EXTPR=(RALLOCWA),MODNM=AVCLF2,BRANCH=DIRECT        00101000
*     END;                                                         0129 00102000
*   RESPECIFY (R1,R2) UNRESTRICTED;                                0130 00103000
@RF00121 DS    0H                                                  0131 00104000
*   RFY RETCODE RSTD;                                              0131 00105000
*   R8 = RETCODE;                       /*SAVE RETURN CODE IN REG 8  */ 00106000
         LR    R8,RETCODE                                          0132 00107000
*   RFY RETCODE UNRSTD;                                            0133 00108000
*FREEDSCB:                                                         0134 00109000
*   IF R8 ¬= 0 THEN                     /*IF ERROR RETURN, FREE VDSCB*/ 00110000
FREEDSCB LTR   R8,R8                                               0134 00111000
         BZ    @RF00134                                            0134 00112000
*     DO;                                                          0135 00113000
*       RFY R2 RSTD;                                               0136 00114000
*       R2 = LENGTH(VDSCB);                                  /*YM3952*/ 00115000
         LA    R2,205                                              0137 00116000
*   RESPECIFY IEZJSCB BASED(TCBJSCB);                              0138 00117000
*   RESPECIFY (R9,JSCBACTP) RESTRICTED;                            0139 00118000
*   JSCBACTP = JSCBACT;                                            0140 00119000
         L     @03,CVTPTR                                          0140 00120000
         L     @03,CVTTCBP(,@03)                                   0140 00121000
         L     @03,TCBPTR(,@03)                                    0140 00122000
         L     @03,TCBJSCB(,@03)                                   0140 00123000
         L     JSCBACTP,JSCBACT(,@03)                              0140 00124000
*   RESPECIFY IEZJSCB BASED(JSCBACTP);                             0141 00125000
*   R9 = JSCBSWSP;                                                 0142 00126000
         SLR   R9,R9                                               0142 00127000
         IC    R9,JSCBSWSP(,JSCBACTP)                              0142 00128000
*   GEN REFS(CVT,RA,R2);                                     /*YM3952*/ 00129000
         IECRES FREE,A=(RA),LV=(R2),PREFIX=NO,               /*YM3952*/*00130000
               STM=(2,14,IECREGSV+12),SP=(R9),KEY=SCHEDKEY   /*YM3952*/ 00131000
*   RESPECIFY (R2,R9,JSCBACTP) UNRESTRICTED;                       0144 00132000
*     END;                                                         0145 00133000
*   GEN(IECRES FREE,A=(RALLOCWA),PREFIX=FIRST)                     0146 00134000
*     REFS(CVT,RALLOCWA);                                          0146 00135000
@RF00134 DS    0H                                                  0146 00136000
         IECRES FREE,A=(RALLOCWA),PREFIX=FIRST                          00137000
*   RESPECIFY RETCODE RESTRICTED;                                  0147 00138000
*   RETCODE = R8;                       /*PUT RETURN CODE IN REG 15  */ 00139000
         LR    RETCODE,R8                                          0148 00140000
*   GEN(MODESET EXTKEY=ZERO);           /*RETURN TO KEY 0      YM3905*/ 00141000
         MODESET EXTKEY=ZERO                                            00142000
*   GO TO CALLER;                       /*RETURN TO CALLER OF ALLOCAT*/ 00143000
         L     @14,CVTPTR                                          0150 00144000
         L     @14,CVTEXPRO(,@14)                                  0150 00145000
         BR    @14                                                 0150 00146000
*   RESPECIFY (R8,RETCODE) UNRESTRICTED;                           0151 00147000
*   GEN(EJECT);                                                    0152 00148000
         EJECT                                                          00149000
*BLDVDSCB:                                                         0153 00150000
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0153 00151000
         B     @PB00002                                            0153 00152000
BLDVDSCB DS    0H                                                  0154 00153000
*   /*****************************************************************/ 00154000
*   /*                                                               */ 00155000
*   /* ROUTINE TO BUILD VDSCB                                        */ 00156000
*   /*                                                               */ 00157000
*   /*****************************************************************/ 00158000
*   RFY RET RSTD;                                                  0154 00159000
*   SAV14B = RET;                       /*SAVE REGISTER 14           */ 00160000
         ST    RET,SAV14B                                          0155 00161000
*   RFY RET UNRSTD;                                                0156 00162000
*   /*                                                               */ 00163000
*   /* CALL ROUTINE TO BUILD VDSUCB                                  */ 00164000
*   /*                                                               */ 00165000
*   CALL BLDUCB;                                                   0157 00166000
         BAL   @14,BLDUCB                                          0157 00167000
*   /*                                                               */ 00168000
*   /* CALL ROUTINE TO BUILD VDSDSCB                                 */ 00169000
*   /*                                                               */ 00170000
*   CALL BLDDSCB;                                                  0158 00171000
         BAL   @14,BLDDSCB                                         0158 00172000
*   /*                                                               */ 00173000
*   /* ROUTINE TO BUILD VDSUCBEX (UCB EXTENSION)                     */ 00174000
*   /*                                                               */ 00175000
*   IF AVULABST = 0 THEN                /*CHECK IF USER LABEL TRACK  */ 00176000
         ICM   @06,3,AVULABST                                      0159 00177000
         BNZ   @RF00159                                            0159 00178000
*     DO;                               /*WAS ALLOCATED              */ 00179000
*       VDSABSTT = AVABSTRK;            /*FIRST ALLOCATED TRACK OF DS*/ 00180000
         MVC   VDSABSTT(2,VDSCBPTR),AVABSTRK                       0161 00181000
*       VDSNMTRK = AVNODSTK;            /*NUMBER OF TRACKS ALLOCATED */ 00182000
         MVC   VDSNMTRK(2,VDSCBPTR),AVNODSTK+2                     0162 00183000
*     END;                                                         0163 00184000
*   ELSE                                /*YES, USER LABEL TRK ALLOC  */ 00185000
*     DO;                                                          0164 00186000
         B     @RC00159                                            0164 00187000
@RF00159 DS    0H                                                  0165 00188000
*       VDSABSTT = AVULABST;            /*FIRST ALLOCATE TRACK OF DS */ 00189000
         MVC   VDSABSTT(2,VDSCBPTR),AVULABST                       0165 00190000
*       VDSNMTRK = AVNODSTK + 1;        /*NUMBER OF TRACKS ALLOCATED */ 00191000
         LA    @06,1                                               0166 00192000
         AL    @06,AVNODSTK                                        0166 00193000
         STH   @06,VDSNMTRK(,VDSCBPTR)                             0166 00194000
*     END;                                                         0167 00195000
*   RFY RET RSTD;                                                  0168 00196000
@RC00159 DS    0H                                                  0169 00197000
*   RET = SAV14B;                       /*RESTORE REGISTER 14        */ 00198000
         L     RET,SAV14B                                          0169 00199000
*   RFY RET UNRSTD;                                                0170 00200000
*   END BLDVDSCB;                                                  0171 00201000
@EL00002 DS    0H                                                  0171 00202000
@EF00002 DS    0H                                                  0171 00203000
@ER00002 BR    @14                                                 0171 00204000
@PB00002 DS    0H                                                  0172 00205000
*   GEN(EJECT);                                                    0172 00206000
         EJECT                                                          00207000
*BLDDSCB:                                                          0173 00208000
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0173 00209000
         B     @PB00003                                            0173 00210000
BLDDSCB  DS    0H                                                  0174 00211000
*   /*****************************************************************/ 00212000
*   /*                                                               */ 00213000
*   /* ROUTINE TO BUILD VDSDSCB                                      */ 00214000
*   /*                                                               */ 00215000
*   /*****************************************************************/ 00216000
*   RFY RET RSTD;                                                  0174 00217000
*   SAV14C = RET;                       /*SAVE REGISTER 14           */ 00218000
         ST    RET,SAV14C                                          0175 00219000
*   RFY RET UNRSTD;                                                0176 00220000
*   /*                                                               */ 00221000
*   /* CALL ROUTINE TO DETERMINE STARTING CCHH                       */ 00222000
*   /*                                                               */ 00223000
*   CALL DETSCCHH;                                                 0177 00224000
         BAL   @14,DETSCCHH                                        0177 00225000
*   /*                                                               */ 00226000
*   /* CALL ROUTINE TO INITIALIZE DS1LSTAR AND DS1TRBAL FIELDS       */ 00227000
*   /*                                                               */ 00228000
*   CALL INITLSTR;                                                 0178 00229000
         BAL   @14,INITLSTR                                        0178 00230000
*   /*                                                               */ 00231000
*   /* CALL ROUTINE TO ALLOCATE TRACKS                               */ 00232000
*   /*                                                               */ 00233000
*   CALL ALLOCTRK;                                                 0179 00234000
         BAL   @14,ALLOCTRK                                        0179 00235000
*   /*****************************************************************/ 00236000
*   /*                                                               */ 00237000
*   /* VALIDITY CHECK SPACE REQUESTED                                */ 00238000
*   /*                                                               */ 00239000
*   /*****************************************************************/ 00240000
*   IF AVLSTAR ¬= 0 THEN                /*IF PDS ALLOCATED     YM8310*/ 00241000
         LA    @06,80                                              0180 00242000
         ALR   @06,VDSCBPTR                                        0180 00243000
         ICM   @15,7,AVLSTAR(@06)                                  0180 00244000
         BZ    @RF00180                                            0180 00245000
*     IF AVTRKPRI < (AVLBPTRK + 1) THEN /*IF PDS DIRECTORY DOES NOT  */ 00246000
         LA    @15,1                                               0181 00247000
         AH    @15,AVLBPTRK(,@06)                                  0181 00248000
         C     @15,AVTRKPRI                                        0181 00249000
         BNH   @RF00181                                            0181 00250000
*       DO;                             /*FIT IN PRIMARY SPACE -ERROR*/ 00251000
*         RFY R8 RSTD;                                             0183 00252000
*         R8 = ECDIRPRI;                /*DIR SPACE > PRIMARY SPACE  */ 00253000
         LA    R8,128                                              0184 00254000
*         GO TO FREEDSCB;               /*GO PERFORM ERROR PROCESSING*/ 00255000
         B     FREEDSCB                                            0185 00256000
*       END;                                                       0186 00257000
*   AVVOLTRK = AVNUMCYL * AVNUMTRK - 1; /*TOTAL NO. TRACKS ON VOLUME */ 00258000
@RF00181 DS    0H                                                  0187 00259000
@RF00180 LH    @09,AVNUMCYL                                        0187 00260000
         MH    @09,AVNUMTRK                                        0187 00261000
         BCTR  @09,0                                               0187 00262000
         STH   @09,AVVOLTRK                                        0187 00263000
*   AVAVAILT = AVVOLTRK - AVABSTRK + 1; /*NO. OF AVAILABLE TRACKS    */ 00264000
         SH    @09,AVABSTRK                                        0188 00265000
         AH    @09,@CH00068                                        0188 00266000
         STH   @09,AVAVAILT                                        0188 00267000
*   IF AVTRKPRI > AVAVAILT THEN         /*IF NO. TRKS ALLOCATED TO DS*/ 00268000
         C     @09,AVTRKPRI                                        0189 00269000
         BNL   @RF00189                                            0189 00270000
*     DO;                               /*DOESN'T FIT ON VOLUME-ERROR*/ 00271000
*       R8 = ECNOSPAC;                  /*SPACE NOT AVAILABLE        */ 00272000
         LA    R8,20                                               0191 00273000
*       GO TO FREEDSCB;                 /*GO PERFORM ERROR PROCESSING*/ 00274000
         B     FREEDSCB                                            0192 00275000
*       RFY R8 UNRSTD;                                             0193 00276000
*     END;                                                         0194 00277000
*   IF AVNODSTK > AVAVAILT THEN         /*IF TOTAL DS SPACE > TOTAL  */ 00278000
@RF00189 LH    @06,AVAVAILT                                        0195 00279000
         C     @06,AVNODSTK                                        0195 00280000
         BNL   @RF00195                                            0195 00281000
*     AVNODSTK = AVAVAILT;              /*VOL SPACE, GIVE DS TOT VOL */ 00282000
         ST    @06,AVNODSTK                                        0196 00283000
*   /*                                                               */ 00284000
*   /* CALL ROUTINE TO ALLOCATE A USER LABEL TRACK                   */ 00285000
*   /*                                                               */ 00286000
*   CALL ALLOCULT;                                                 0197 00287000
@RF00195 BAL   @14,ALLOCULT                                        0197 00288000
*   /*****************************************************************/ 00289000
*   /*                                                               */ 00290000
*   /* BUILD USER LABEL AND DATA SET EXTENTS                         */ 00291000
*   /*                                                               */ 00292000
*   /*****************************************************************/ 00293000
*   RESPECIFY EXTPTR RESTRICTED;                                   0198 00294000
*   IF AVULABST ¬= 0 THEN               /*IF USER LABEL TRK ALLOCATED*/ 00295000
         LH    @08,AVULABST                                        0199 00296000
         LTR   @08,@08                                             0199 00297000
         BZ    @RF00199                                            0199 00298000
*     DO;                               /*BUILD USER LABEL EXTENT    */ 00299000
*       EXTPTR = ADDR(DS1EXT1);         /*POINT TO FIRST EXTENT      */ 00300000
         LA    EXTPTR,DS1EXT1+80(,VDSCBPTR)                        0201 00301000
*       VDS1EXTD = VDS1ULAB;            /*INDICATE USER LABELS       */ 00302000
         MVI   VDS1EXTD(EXTPTR),B'01000000'                        0202 00303000
*       VDS1EXTN = VDS1HEX0;            /*SET EXTENT NUMBER TO 0     */ 00304000
         MVI   VDS1EXTN(EXTPTR),X'00'                              0203 00305000
*       VDS1STCC = AVULABST / AVNUMTRK; /*STARTING CYLINDER NUMBER   */ 00306000
         LH    @06,AVNUMTRK                                        0204 00307000
         LR    @00,@08                                             0204 00308000
         SRDA  @00,32                                              0204 00309000
         DR    @00,@06                                             0204 00310000
         STH   @01,VDS1STCC(,EXTPTR)                               0204 00311000
*       VDS1STHH = AVULABST // AVNUMTRK; /*STARTING HEAD NUMBER      */ 00312000
         LR    @02,@08                                             0205 00313000
         SRDA  @02,32                                              0205 00314000
         DR    @02,@06                                             0205 00315000
         STH   @02,VDS1STHH(,EXTPTR)                               0205 00316000
*       VDS1ECC = VDS1STCC;             /*ENDING CYL = STARTING CYL  */ 00317000
         STH   @01,VDS1ECC(,EXTPTR)                                0206 00318000
*       VDS1EHH = VDS1STHH;             /*ENDING HEAD = STARTING HEAD*/ 00319000
         STH   @02,VDS1EHH(,EXTPTR)                                0207 00320000
*     END;                                                         0208 00321000
*   IF AVNODSTK ¬= 0 THEN               /*IF TRACKS WERE ALLOCATED   */ 00322000
@RF00199 ICM   @08,15,AVNODSTK                                     0209 00323000
         BZ    @RF00209                                            0209 00324000
*     CALL BLDDSEXT;                    /*GO BUILD DATA SET EXTENT   */ 00325000
         BAL   @14,BLDDSEXT                                        0210 00326000
*   ELSE                                /*NO TRACKS WERE ALLOCATED   */ 00327000
*     DS1NOEPV = 0;                     /*SET NO. EXTENTS TO 0       */ 00328000
         B     @RC00209                                            0211 00329000
@RF00209 MVI   DS1NOEPV+80(VDSCBPTR),X'00'                         0211 00330000
*   RESPECIFY EXTPTR UNRESTRICTED;                                 0212 00331000
@RC00209 DS    0H                                                  0213 00332000
*   /*                                                               */ 00333000
*   /* CALL ROUTINE TO PERFORM MERGE PROCESSING (JFCB TO DSCB)       */ 00334000
*   /*                                                               */ 00335000
*   CALL MRGJFCB;                                                  0213 00336000
         BAL   @14,MRGJFCB                                         0213 00337000
*   RFY RET RSTD;                                                  0214 00338000
*   RET = SAV14C;                       /*RESTORE REGISTER 14        */ 00339000
         L     RET,SAV14C                                          0215 00340000
*   RFY RET UNRSTD;                                                0216 00341000
*   END BLDDSCB;                                                   0217 00342000
@EL00003 DS    0H                                                  0217 00343000
@EF00003 DS    0H                                                  0217 00344000
@ER00003 BR    @14                                                 0217 00345000
@PB00003 DS    0H                                                  0218 00346000
*   GEN(EJECT);                                                    0218 00347000
         EJECT                                                          00348000
*DETSCCHH:                                                         0219 00349000
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0219 00350000
         B     @PB00004                                            0219 00351000
DETSCCHH DS    0H                                                  0220 00352000
*   /*****************************************************************/ 00353000
*   /*                                                               */ 00354000
*   /* DETERMINE THE BEGINNING CCHH FOR FIRST EXTENT                 */ 00355000
*   /*                                                               */ 00356000
*   /*****************************************************************/ 00357000
*   RFY RET RSTD;                                                  0220 00358000
*   SAV14D = RET;                       /*SAVE REGISTER 14           */ 00359000
         ST    RET,SAV14D                                          0221 00360000
*   RFY RET UNRSTD;                                                0222 00361000
*   /*                                                               */ 00362000
*   /* CHECK FOR ABSOLUTE TRACK ALLOCATION                           */ 00363000
*   /*                                                               */ 00364000
*   IF JFCBSPAC = JFCABSTR THEN                                    0223 00365000
         TM    JFCBSPAC(JFCBPTR),B'11000000'                       0223 00366000
         BNZ   @RF00223                                            0223 00367000
*     DO;                                                          0224 00368000
*      AVCYLST = JFCBABST / AVNUMTRK;   /*STARTING CYLINDER NUMBER   */ 00369000
         LH    @06,AVNUMTRK                                        0225 00370000
         LH    @15,JFCBABST(,JFCBPTR)                              0225 00371000
         LR    @00,@15                                             0225 00372000
         SRDA  @00,32                                              0225 00373000
         DR    @00,@06                                             0225 00374000
         STH   @01,AVCYLST                                         0225 00375000
*      AVHEADST = JFCBABST // AVNUMTRK; /*STARTING HEAD NUMBER       */ 00376000
         LR    @00,@15                                             0226 00377000
         SRDA  @00,32                                              0226 00378000
         DR    @00,@06                                             0226 00379000
         STH   @00,AVHEADST                                        0226 00380000
*      AVABSTRK = JFCBABST;             /*ABSOLUTE TRACK NUMBER      */ 00381000
         STH   @15,AVABSTRK                                        0227 00382000
*     END;                                                         0228 00383000
*   ELSE                                                           0229 00384000
*     /*                                                             */ 00385000
*     /* CHECK FOR TRACK ALLOCATION                                  */ 00386000
*     /*                                                             */ 00387000
*     IF JFCBSPAC = JFCTRK THEN                                    0229 00388000
         B     @RC00223                                            0229 00389000
@RF00223 TM    JFCBSPAC(JFCBPTR),B'10000000'                       0229 00390000
         BNO   @RF00229                                            0229 00391000
         TM    JFCBSPAC(JFCBPTR),B'01000000'                       0229 00392000
         BNZ   @RF00229                                            0229 00393000
*       DO;                                                        0230 00394000
*         AVCYLST = 0;                  /*STARTING CYLINDER NUMBER   */ 00395000
         SLR   @06,@06                                             0231 00396000
         STH   @06,AVCYLST                                         0231 00397000
*         AVHEADST = 1;                 /*STARTING HEAD NUMBER       */ 00398000
         LA    @06,1                                               0232 00399000
         STH   @06,AVHEADST                                        0232 00400000
*         AVABSTRK = 1;                 /*ABSOLUTE TRACK NUMBER      */ 00401000
         STH   @06,AVABSTRK                                        0233 00402000
*       END;                                                       0234 00403000
*     ELSE                                                         0235 00404000
*       /*                                                           */ 00405000
*       /* CHECK FOR CYLINDER OR AVERAGE BLOCK LENGTH                */ 00406000
*       /* WITH ROUND ALLOCATION                                     */ 00407000
*       /*                                                           */ 00408000
*       IF JFCBSPAC = JFCCYLIN |                                   0235 00409000
*          (JFCBSPAC = JFCAVBL & JFCROUND = ON) THEN               0235 00410000
         B     @RC00229                                            0235 00411000
@RF00229 TM    JFCBSPAC(JFCBPTR),B'11000000'                       0235 00412000
         BO    @RT00235                                            0235 00413000
         TM    JFCBSPAC(JFCBPTR),B'01000000'                       0235 00414000
         BNO   @RF00235                                            0235 00415000
         TM    JFCBSPAC(JFCBPTR),B'10000000'                       0235 00416000
         BNZ   @RF00235                                            0235 00417000
         TM    JFCROUND(JFCBPTR),B'00000001'                       0235 00418000
         BNO   @RF00235                                            0235 00419000
@RT00235 DS    0H                                                  0236 00420000
*         DO;                                                      0236 00421000
*           AVCYLST = 1;                /*STARTING CYLINDER NUMBER   */ 00422000
         MVC   AVCYLST(2),@CH00068                                 0237 00423000
*           AVHEADST = 0;               /*STARTING HEAD NUMBER       */ 00424000
         SLR   @06,@06                                             0238 00425000
         STH   @06,AVHEADST                                        0238 00426000
*           AVABSTRK = AVNUMTRK;        /*ABSOLUTE TRACK NUMBER      */ 00427000
         MVC   AVABSTRK(2),AVNUMTRK                                0239 00428000
*         END;                                                     0240 00429000
*       ELSE                                                       0241 00430000
*         /*                                                         */ 00431000
*         /* AVERAGE BLOCK LENGTH ALLOCATION                         */ 00432000
*         /*                                                         */ 00433000
*         DO;                                                      0241 00434000
         B     @RC00235                                            0241 00435000
@RF00235 DS    0H                                                  0242 00436000
*           AVCYLST = 0;                /*STARTING CYLINDER NUMBER   */ 00437000
         SLR   @06,@06                                             0242 00438000
         STH   @06,AVCYLST                                         0242 00439000
*           AVHEADST = 1;               /*STARTING HEAD NUMBER       */ 00440000
         LA    @06,1                                               0243 00441000
         STH   @06,AVHEADST                                        0243 00442000
*           AVABSTRK = 1;               /*ABSOLUTE TRACK NUMBER      */ 00443000
         STH   @06,AVABSTRK                                        0244 00444000
*         END;                                                     0245 00445000
*   RFY RET RSTD;                                                  0246 00446000
@RC00235 DS    0H                                                  0246 00447000
@RC00229 DS    0H                                                  0246 00448000
@RC00223 DS    0H                                                  0247 00449000
*   RET = SAV14D;                       /*RESTORE REGISTER 14        */ 00450000
         L     RET,SAV14D                                          0247 00451000
*   RFY RET UNRSTD;                                                0248 00452000
*   END DETSCCHH;                                                  0249 00453000
@EL00004 DS    0H                                                  0249 00454000
@EF00004 DS    0H                                                  0249 00455000
@ER00004 BR    @14                                                 0249 00456000
@PB00004 DS    0H                                                  0250 00457000
*   GEN(EJECT);                                                    0250 00458000
         EJECT                                                          00459000
*INITLSTR:                                                         0251 00460000
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0251 00461000
         B     @PB00005                                            0251 00462000
INITLSTR DS    0H                                                  0252 00463000
*   /*****************************************************************/ 00464000
*   /*                                                               */ 00465000
*   /* INITIALIZE DS1LSTAR AND DS1TRBAL FIELDS IN THE VDSDSCB        */ 00466000
*   /*                                                               */ 00467000
*   /*****************************************************************/ 00468000
*   RFY RET RSTD;                                                  0252 00469000
*   SAV14D = RET;                       /*SAVE REGISTER 14           */ 00470000
         ST    RET,SAV14D                                          0253 00471000
*   RFY RET UNRSTD;                                                0254 00472000
*   IF JFCBDQTY ¬= 0 THEN               /*CHECK FOR PARTITION DATASET*/ 00473000
         ICM   @06,7,JFCBDQTY(JFCBPTR)                             0255 00474000
         BZ    @RF00255                                            0255 00475000
*     DO;                                                          0256 00476000
*     /*                                                             */ 00477000
*     /* PROCESS FOR PARTITIONED DATA SET                            */ 00478000
*     /*                                                             */ 00479000
*       IF (JFCSUL = ON & JFCSL = ON) THEN /*CHECK FOR USER LABELS   */ 00480000
         TM    JFCSUL(JFCBPTR),B'00001010'                         0257 00481000
         BNO   @RF00257                                            0257 00482000
*         DO;                           /*YES, ERROR                 */ 00483000
*           RFY R8 RSTD;                                           0259 00484000
*           R8 = ECUSLAB;               /*INVALID USER LAB REQUEST   */ 00485000
         LA    R8,64                                               0260 00486000
*           GO TO FREEDSCB;             /*GO PERFORM ERROR PROCESSING*/ 00487000
         B     FREEDSCB                                            0261 00488000
*           RFY R8 UNRSTD;                                         0262 00489000
*         END;                                                     0263 00490000
*       /*                                                           */ 00491000
*       /* DETERMINE SIZE OF DIRECTORY AND INITIALIZE                */ 00492000
*       /* THE DS1LSTAR AND DS1TRBAL FIELDS IN VDSDSCB               */ 00493000
*       /*                                                           */ 00494000
*       AVLDBBYT = AVLRCDO + 264;       /*NO. BYTES - LAST DIR BLOCK */ 00495000
@RF00257 LA    @06,264                                             0264 00496000
         AH    @06,AVLRCDO                                         0264 00497000
         STH   @06,AVLDBBYT                                        0264 00498000
*       AVDBBYTS = (AVTOLER / 2);  /*NO. BYTES FOR NOT LAST @ZA17523 */ 00499000
         LH    @15,AVTOLER                                         0265 00500000
         LR    @00,@15                                             0265 00501000
         SRDA  @00,32                                              0265 00502000
         D     @00,@CF00111                                        0265 00503000
         STH   @01,AVDBBYTS                                        0265 00504000
*       AVDBBYTS = (AVTOLER / 64) + AVDBBYTS; /*DIR BLOCK   @ZA17523 */ 00505000
         LR    @02,@15                                             0266 00506000
         SRDA  @02,32                                              0266 00507000
         D     @02,@CF00842                                        0266 00508000
         ALR   @03,@01                                             0266 00509000
         STH   @03,AVDBBYTS                                        0266 00510000
*       AVDBBYTS = AVDBBYTS + AVIRCDO;        /*            @ZA17523 */ 00511000
         LH    @02,AVIRCDO                                         0267 00512000
         ALR   @03,@02                                             0267 00513000
         STH   @03,AVDBBYTS                                        0267 00514000
*       AVDIRBT = (AVTRKCAP - AVLDBBYT) / /*NUMBER OF DIRECTORY      */ 00515000
*                 AVDBBYTS + 1;         /*BLOCKS PER TRACK           */ 00516000
         LH    @15,AVTRKCAP(,VDSCBPTR)                             0268 00517000
         LR    @00,@06                                             0268 00518000
         LCR   @00,@00                                             0268 00519000
         ALR   @00,@15                                             0268 00520000
         SRDA  @00,32                                              0268 00521000
         DR    @00,@03                                             0268 00522000
         AH    @01,@CH00068                                        0268 00523000
         STH   @01,AVDIRBT                                         0268 00524000
*       AVFULTRK = JFCBDQTY / AVDIRBT;  /*NO. TRACKS NEEDED FOR DIR  */ 00525000
         SLR   @06,@06                                             0269 00526000
         ICM   @06,7,JFCBDQTY(JFCBPTR)                             0269 00527000
         LR    @05,@06                                             0269 00528000
         SLR   @04,@04                                             0269 00529000
         DR    @04,@01                                             0269 00530000
         ST    @05,AVFULTRK                                        0269 00531000
*       AVDIRNF = JFCBDQTY // AVDIRBT;  /*DIR BLOCKS NOT FIT ON TRKS */ 00532000
         LR    @08,@06                                             0270 00533000
         SRDA  @08,32                                              0270 00534000
         DR    @08,@01                                             0270 00535000
         STH   @08,AVDIRNF                                         0270 00536000
*       IF AVDIRNF = 0 THEN             /*IF ALL DIRECTORY BLOCKS    */ 00537000
         LTR   @08,@08                                             0271 00538000
         BNZ   @RF00271                                            0271 00539000
*         DO;                           /*FIT ON FULL TRACKS         */ 00540000
*           AVLBPTRK = AVFULTRK;        /*LAST BLK PTR TRACK NUMBER  */ 00541000
         LA    @06,80                                              0273 00542000
         ALR   @06,VDSCBPTR                                        0273 00543000
         STH   @05,AVLBPTRK(,@06)                                  0273 00544000
*           AVLBPRCD = 1;               /*LAST BLK PTR RECORD NUMBER */ 00545000
         MVI   AVLBPRCD(@06),X'01'                                 0274 00546000
*           DS1TRBAL = AVTRKCAP - (AVIRCDO - AVKEYCON); /*TRK BALANCE*/ 00547000
         SLR   @03,@03                                             0275 00548000
         IC    @03,AVKEYCON                                        0275 00549000
         SLR   @02,@03                                             0275 00550000
         SLR   @15,@02                                             0275 00551000
         STH   @15,DS1TRBAL(,@06)                                  0275 00552000
*         END;                                                     0276 00553000
*       ELSE                            /*DIRECTORY BLOCKS DO NOT    */ 00554000
*         DO;                           /*FIT ON FULL TRACKS         */ 00555000
         B     @RC00271                                            0277 00556000
@RF00271 DS    0H                                                  0278 00557000
*           AVLBPTRK = AVFULTRK;        /*LAST BLOCK PTR TRACK NO.   */ 00558000
         LA    @06,80                                              0278 00559000
         ALR   @06,VDSCBPTR                                        0278 00560000
         MVC   AVLBPTRK(2,@06),AVFULTRK+2                          0278 00561000
*           AVLBPRCD = AVDIRNF + 1;     /*LAST BLK PTR RECORD NUMBER */ 00562000
         LH    @15,AVDIRNF                                         0279 00563000
         LA    @14,1                                               0279 00564000
         ALR   @14,@15                                             0279 00565000
         STC   @14,AVLBPRCD(,@06)                                  0279 00566000
*           DS1TRBAL = AVTRKCAP - (AVDIRNF * AVDBBYTS +  /*TRACK BAL */ 00567000
*                      AVIRCDO - AVKEYCON);                        0280 00568000
         MH    @15,AVDBBYTS                                        0280 00569000
         AH    @15,AVIRCDO                                         0280 00570000
         SLR   @14,@14                                             0280 00571000
         IC    @14,AVKEYCON                                        0280 00572000
         SLR   @15,@14                                             0280 00573000
         LCR   @15,@15                                             0280 00574000
         AH    @15,AVTRKCAP(,VDSCBPTR)                             0280 00575000
         STH   @15,DS1TRBAL(,@06)                                  0280 00576000
*         END;                                                     0281 00577000
*     END;                                                         0282 00578000
*   ELSE                                /*NO, NOT A PARTITION DATASET*/ 00579000
*     DS1TRBAL = AVTRKCAP;              /*THEN, TRACK BAL = TRK CAPAC*/ 00580000
         B     @RC00255                                            0283 00581000
@RF00255 MVC   DS1TRBAL+80(2,VDSCBPTR),AVTRKCAP(VDSCBPTR)          0283 00582000
*   RFY RET RSTD;                                                  0284 00583000
@RC00255 DS    0H                                                  0285 00584000
*   RET = SAV14D;                       /*RESTORE REGISTER 14        */ 00585000
         L     RET,SAV14D                                          0285 00586000
*   RFY RET UNRSTD;                                                0286 00587000
*   END INITLSTR;                                                  0287 00588000
@EL00005 DS    0H                                                  0287 00589000
@EF00005 DS    0H                                                  0287 00590000
@ER00005 BR    @14                                                 0287 00591000
@PB00005 DS    0H                                                  0288 00592000
*   GEN(EJECT);                                                    0288 00593000
         EJECT                                                          00594000
*ALLOCTRK:                                                         0289 00595000
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0289 00596000
         B     @PB00006                                            0289 00597000
ALLOCTRK DS    0H                                                  0290 00598000
*   /*****************************************************************/ 00599000
*   /*                                                               */ 00600000
*   /* DETERMINE NUMBER OF TRACKS IN DATA SET AND                    */ 00601000
*   /* NUMBER OF PRIMARY TRACKS REQUESTED                            */ 00602000
*   /*                                                               */ 00603000
*   /*****************************************************************/ 00604000
*   RFY RET RSTD;                                                  0290 00605000
*   SAV14D = RET;                       /*SAVE REGISTER 14           */ 00606000
         ST    RET,SAV14D                                          0291 00607000
*   RFY RET UNRSTD;                                                0292 00608000
*   IF JFCBSPAC = JFCABSTR THEN         /*PROCESS FOR ABSOLUTE TRACK */ 00609000
         TM    JFCBSPAC(JFCBPTR),B'11000000'                       0293 00610000
         BNZ   @RF00293                                            0293 00611000
*     DO;                                                          0294 00612000
*       AVTRKPRI = JFCBPQTY;            /*GET NO. PRIMARY TRACKS     */ 00613000
         SLR   @06,@06                                             0295 00614000
         ICM   @06,7,JFCBPQTY(JFCBPTR)                             0295 00615000
         ST    @06,AVTRKPRI                                        0295 00616000
*       AVNODSTK = JFCBPQTY;            /*GET NO. DATA SET TRACKS    */ 00617000
         ST    @06,AVNODSTK                                        0296 00618000
*       IF AVTRKPRI = 0 THEN            /*IF NO. PRIMARY TRKS = 0 AND*/ 00619000
         SLR   @15,@15                                             0297 00620000
         CR    @06,@15                                             0297 00621000
         BNE   @RF00297                                            0297 00622000
*         DO;                                                      0298 00623000
*           RFY R8 RSTD;                                           0299 00624000
*           IF AVABSTRK = 0 THEN        /*FIRST ALLOCATED TRACK = 0  */ 00625000
         CH    @15,AVABSTRK                                        0300 00626000
         BNE   @RF00300                                            0300 00627000
*             R8 = ECSPCPRM;            /*NO SPACE PARM SPECIFIED    */ 00628000
         LA    R8,76                                               0301 00629000
*           ELSE                                                   0302 00630000
*             R8 = ECPRI0;              /*PRIMARY REQUEST = 0        */ 00631000
         B     @RC00300                                            0302 00632000
@RF00300 LA    R8,108                                              0302 00633000
*           GO TO FREEDSCB;             /*GO PERFORM ERROR PROCESSING*/ 00634000
         B     FREEDSCB                                            0303 00635000
*           RFY R8 UNRSTD;                                         0304 00636000
*         END;                                                     0305 00637000
*       ELSE                            /*NO. PRIMARY TRKS ¬= 0 AND  */ 00638000
*         IF AVABSTRK = 0 THEN          /*FIRST TRACK ALLOCATED = 0  */ 00639000
@RF00297 ICM   @06,3,AVABSTRK                                      0306 00640000
         BNZ   @RF00306                                            0306 00641000
*           DO;                                                    0307 00642000
*             RFY R8 RSTD;                                         0308 00643000
*             R8 = ECABTKNA;            /*ABSOLUTE TRK NOT AVAILABLE */ 00644000
         LA    R8,16                                               0309 00645000
*             GO TO FREEDSCB;           /*GO PERFORM ERROR PROCESSING*/ 00646000
         B     FREEDSCB                                            0310 00647000
*             RFY R8 UNRSTD;                                       0311 00648000
*           END;                                                   0312 00649000
*     END;                                                         0313 00650000
*   ELSE                                                           0314 00651000
*     IF JFCBSPAC = JFCCYLIN THEN       /*PROCESS FOR CYL ALLOCATION */ 00652000
         B     @RC00293                                            0314 00653000
@RF00293 TM    JFCBSPAC(JFCBPTR),B'11000000'                       0314 00654000
         BNO   @RF00314                                            0314 00655000
*       DO;                                                        0315 00656000
*         AVTRKPRI = JFCBPQTY * AVNUMTRK; /*NO. PRIMARY TRACKS       */ 00657000
         LH    @06,AVNUMTRK                                        0316 00658000
         SLR   @01,@01                                             0316 00659000
         ICM   @01,7,JFCBPQTY(JFCBPTR)                             0316 00660000
         MR    @00,@06                                             0316 00661000
         ST    @01,AVTRKPRI                                        0316 00662000
*         IF JFCMIXG = ON | JFCALX = ON THEN /*IF MXIG OR ALX SPEC   */ 00663000
         TM    JFCMIXG(JFCBPTR),B'00000110'                        0317 00664000
         BZ    @RF00317                                            0317 00665000
*           AVNODSTK = (AVNUMCYL - 1) * AVNUMTRK; /*YES, NO. DS TRKS */ 00666000
         LH    @01,AVNUMCYL                                        0318 00667000
         BCTR  @01,0                                               0318 00668000
         MR    @00,@06                                             0318 00669000
         ST    @01,AVNODSTK                                        0318 00670000
*         ELSE                                                     0319 00671000
*           AVNODSTK = (JFCBPQTY + 15 * JFCBSQTY) /*NO,NO.DS TRKS    */ 00672000
*                      * AVNUMTRK;                                 0319 00673000
         B     @RC00317                                            0319 00674000
@RF00317 SLR   @06,@06                                             0319 00675000
         ICM   @06,7,JFCBSQTY(JFCBPTR)                             0319 00676000
         MH    @06,@CH00072                                        0319 00677000
         LR    @01,@06                                             0319 00678000
         SLR   @06,@06                                             0319 00679000
         ICM   @06,7,JFCBPQTY(JFCBPTR)                             0319 00680000
         ALR   @01,@06                                             0319 00681000
         MH    @01,AVNUMTRK                                        0319 00682000
         ST    @01,AVNODSTK                                        0319 00683000
*       END;                                                       0320 00684000
*     ELSE                                                         0321 00685000
*       IF JFCBSPAC = JFCTRK THEN       /*PROCESS FOR TRK ALLOCATION */ 00686000
         B     @RC00314                                            0321 00687000
@RF00314 TM    JFCBSPAC(JFCBPTR),B'10000000'                       0321 00688000
         BNO   @RF00321                                            0321 00689000
         TM    JFCBSPAC(JFCBPTR),B'01000000'                       0321 00690000
         BNZ   @RF00321                                            0321 00691000
*         DO;                                                      0322 00692000
*           AVTRKPRI = JFCBPQTY;        /*NO. PRIMARY TRACKS         */ 00693000
         SLR   @06,@06                                             0323 00694000
         ICM   @06,7,JFCBPQTY(JFCBPTR)                             0323 00695000
         ST    @06,AVTRKPRI                                        0323 00696000
*           IF JFCMIXG = ON | JFCALX = ON THEN /*IF MXIG OR ALX SPEC */ 00697000
         TM    JFCMIXG(JFCBPTR),B'00000110'                        0324 00698000
         BZ    @RF00324                                            0324 00699000
*             AVNODSTK = AVNUMCYL * AVNUMTRK - 1; /*YES,NO. DS TRKS  */ 00700000
         LH    @06,AVNUMCYL                                        0325 00701000
         MH    @06,AVNUMTRK                                        0325 00702000
         BCTR  @06,0                                               0325 00703000
         ST    @06,AVNODSTK                                        0325 00704000
*           ELSE                                                   0326 00705000
*             AVNODSTK = JFCBPQTY + 15 * JFCBSQTY; /*NO, NO. DS TRKS */ 00706000
         B     @RC00324                                            0326 00707000
@RF00324 SLR   @06,@06                                             0326 00708000
         ICM   @06,7,JFCBSQTY(JFCBPTR)                             0326 00709000
         MH    @06,@CH00072                                        0326 00710000
         SLR   @15,@15                                             0326 00711000
         ICM   @15,7,JFCBPQTY(JFCBPTR)                             0326 00712000
         ALR   @06,@15                                             0326 00713000
         ST    @06,AVNODSTK                                        0326 00714000
*         END;                                                     0327 00715000
*       ELSE                                                       0328 00716000
*         DO;                           /*PROCESS AVG BLOCK LENGTH   */ 00717000
         B     @RC00321                                            0328 00718000
@RF00321 DS    0H                                                  0329 00719000
*           IF JFCKEYLE ¬= 0 THEN       /*IF KEY LENGTH SPECIFIED    */ 00720000
         CLI   JFCKEYLE(JFCBPTR),0                                 0329 00721000
         BE    @RF00329                                            0329 00722000
*             AVABLLRB = JFCBDRLH + AVLRCDO /*YES, NO. BYTES FOR     */ 00723000
*                        + JFCKEYLE;    /*ABL LAST RECORD            */ 00724000
         SLR   @06,@06                                             0330 00725000
         ICM   @06,7,JFCBDRLH(JFCBPTR)                             0330 00726000
         AH    @06,AVLRCDO                                         0330 00727000
         SLR   @15,@15                                             0330 00728000
         IC    @15,JFCKEYLE(,JFCBPTR)                              0330 00729000
         ALR   @06,@15                                             0330 00730000
         ST    @06,AVABLLRB                                        0330 00731000
*           ELSE                                                   0331 00732000
*             AVABLLRB = JFCBDRLH + AVLRCDO /*NO, NO. BYTES FOR ABL  */ 00733000
*                        - AVKEYCON;    /*LAST RECORD                */ 00734000
         B     @RC00329                                            0331 00735000
@RF00329 SLR   @06,@06                                             0331 00736000
         ICM   @06,7,JFCBDRLH(JFCBPTR)                             0331 00737000
         AH    @06,AVLRCDO                                         0331 00738000
         SLR   @15,@15                                             0331 00739000
         IC    @15,AVKEYCON                                        0331 00740000
         SLR   @06,@15                                             0331 00741000
         ST    @06,AVABLLRB                                        0331 00742000
*           IF AVABLLRB <= AVTRKCAP THEN /*IF ABL LAST RCD <= TRK CAP*/ 00743000
@RC00329 L     @06,AVABLLRB                                        0332 00744000
         CH    @06,AVTRKCAP(,VDSCBPTR)                             0332 00745000
         BH    @RF00332                                            0332 00746000
*             DO;                       /*CALC BYTES ABL NON LAST RCD*/ 00747000
*               AVABLRB = ((JFCBDRLH * AVTOLER) / 512) + AVIRCDO; /*    00748000
*                                       NOT-LAST CALCULATION   YM7888*/ 00749000
         LH    @01,AVTOLER                                         0334 00750000
         SLR   @06,@06                                             0334 00751000
         ICM   @06,7,JFCBDRLH(JFCBPTR)                             0334 00752000
         MR    @00,@06                                             0334 00753000
         D     @00,@CF01660                                        0334 00754000
         AH    @01,AVIRCDO                                         0334 00755000
         ST    @01,AVABLRB                                         0334 00756000
*               IF JFCKEYLE = 0 THEN    /*CHECK FOR KEY SPEC         */ 00757000
         CLI   JFCKEYLE(JFCBPTR),0                                 0335 00758000
         BNE   @RF00335                                            0335 00759000
*                 AVABLRB = AVABLRB - AVKEYCON; /*NO, SUBTRACT KEYCON*/ 00760000
         SLR   @06,@06                                             0336 00761000
         IC    @06,AVKEYCON                                        0336 00762000
         SLR   @01,@06                                             0336 00763000
         ST    @01,AVABLRB                                         0336 00764000
*               ELSE                                               0337 00765000
*                 AVABLRB = AVABLRB + ((JFCKEYLE * AVTOLER) / 512); /*  00766000
*                                       RECORDS/TRACK          YM7888*/ 00767000
         B     @RC00335                                            0337 00768000
@RF00335 LH    @01,AVTOLER                                         0337 00769000
         SLR   @06,@06                                             0337 00770000
         IC    @06,JFCKEYLE(,JFCBPTR)                              0337 00771000
         MR    @00,@06                                             0337 00772000
         D     @00,@CF01660                                        0337 00773000
         AL    @01,AVABLRB                                         0337 00774000
         ST    @01,AVABLRB                                         0337 00775000
*               AVABLRTK = (AVTRKCAP - AVABLLRB) / /*CALC RCDS / TRK */ 00776000
*                          AVABLRB + 1;                            0338 00777000
@RC00335 LH    @06,AVTRKCAP(,VDSCBPTR)                             0338 00778000
         LR    @00,@06                                             0338 00779000
         SL    @00,AVABLLRB                                        0338 00780000
         SRDA  @00,32                                              0338 00781000
         D     @00,AVABLRB                                         0338 00782000
         AH    @01,@CH00068                                        0338 00783000
         ST    @01,AVABLRTK                                        0338 00784000
*               AVABLPRT = JFCBPQTY / AVABLRTK; /*CALC PRI TRKS      */ 00785000
         SLR   @15,@15                                             0339 00786000
         ICM   @15,7,JFCBPQTY(JFCBPTR)                             0339 00787000
         LR    @03,@15                                             0339 00788000
         SLR   @02,@02                                             0339 00789000
         DR    @02,@01                                             0339 00790000
         ST    @03,AVABLPRT                                        0339 00791000
*               AVBLKSNF = JFCBPQTY // AVABLRTK; /*CALC BLKS NOT FIT */ 00792000
         LR    @04,@15                                             0340 00793000
         SRDA  @04,32                                              0340 00794000
         DR    @04,@01                                             0340 00795000
         STH   @04,AVBLKSNF                                        0340 00796000
*               IF AVBLKSNF = 0 THEN    /*CHECK IF ALL BLOCKS FIT    */ 00797000
         LTR   @04,@04                                             0341 00798000
         BNZ   @RF00341                                            0341 00799000
*                 IF AVLBPTRB = AVTRKCAP THEN /*YES, CHK IF DIRECTRY */ 00800000
         CH    @06,AVLBPTRB+80(,VDSCBPTR)                          0342 00801000
         BNE   @RF00342                                            0342 00802000
*                   AVTRKPRI = AVABLPRT; /*NO, CALC NO. PRIMARY TRKS */ 00803000
         ST    @03,AVTRKPRI                                        0343 00804000
*                 ELSE                  /*YES, PRI SPACE IS ADDED TO */ 00805000
*                   AVTRKPRI = AVABLPRT + AVLBPTRK + 1; /*DIRECT SPAC*/ 00806000
         B     @RC00342                                            0344 00807000
@RF00342 LH    @06,AVLBPTRK+80(,VDSCBPTR)                          0344 00808000
         AL    @06,AVABLPRT                                        0344 00809000
         AH    @06,@CH00068                                        0344 00810000
         ST    @06,AVTRKPRI                                        0344 00811000
*               ELSE                    /*NO, ALL BLOCKS DON'T FIT   */ 00812000
*                 IF AVLBPTRB = AVTRKCAP THEN /*CHECK FOR DIRECTRY   */ 00813000
         B     @RC00341                                            0345 00814000
@RF00341 CLC   AVLBPTRB+80(2,VDSCBPTR),AVTRKCAP(VDSCBPTR)          0345 00815000
         BNE   @RF00345                                            0345 00816000
*                   AVTRKPRI = AVABLPRT + 1; /*NO,CALC PRI TRKS      */ 00817000
         LA    @06,1                                               0346 00818000
         AL    @06,AVABLPRT                                        0346 00819000
         ST    @06,AVTRKPRI                                        0346 00820000
*                 ELSE                                             0347 00821000
*                   DO;                 /*YES, CALC RESIDUAL BYTES   */ 00822000
         B     @RC00345                                            0347 00823000
@RF00345 DS    0H                                                  0348 00824000
*                     AVNLBYTS = (AVBLKSNF - 1) *  /*FOR BLKS NOT FIT*/ 00825000
*                                AVABLRB + AVABLLRB; /*TING ON FULTRK*/ 00826000
         LH    @01,AVBLKSNF                                        0348 00827000
         BCTR  @01,0                                               0348 00828000
         M     @00,AVABLRB                                         0348 00829000
         AL    @01,AVABLLRB                                        0348 00830000
         ST    @01,AVNLBYTS                                        0348 00831000
*                     IF AVNLBYTS <= AVLBPTRB THEN /*CALC NO. PRI TRK*/ 00832000
         LA    @06,80                                              0349 00833000
         ALR   @06,VDSCBPTR                                        0349 00834000
         CH    @01,AVLBPTRB(,@06)                                  0349 00835000
         BH    @RF00349                                            0349 00836000
*                       AVTRKPRI = AVABLPRT + AVLBPTRK + 1;        0350 00837000
         LH    @06,AVLBPTRK(,@06)                                  0350 00838000
         AL    @06,AVABLPRT                                        0350 00839000
         AH    @06,@CH00068                                        0350 00840000
         ST    @06,AVTRKPRI                                        0350 00841000
*                     ELSE                                         0351 00842000
*                       AVTRKPRI = AVABLPRT + AVLBPTRK + 2;        0351 00843000
         B     @RC00349                                            0351 00844000
@RF00349 LH    @06,AVLBPTRK+80(,VDSCBPTR)                          0351 00845000
         AL    @06,AVABLPRT                                        0351 00846000
         AL    @06,@CF00111                                        0351 00847000
         ST    @06,AVTRKPRI                                        0351 00848000
*                   END;                                           0352 00849000
@RC00349 DS    0H                                                  0353 00850000
*               IF JFCMIXG = ON | JFCALX = ON THEN /*IF ALX OR MIXG  */ 00851000
@RC00345 DS    0H                                                  0353 00852000
@RC00341 TM    JFCMIXG(JFCBPTR),B'00000110'                        0353 00853000
         BZ    @RF00353                                            0353 00854000
*                 IF JFCROUND = ON THEN /*SPEC, AND ROUND THEN       */ 00855000
         TM    JFCROUND(JFCBPTR),B'00000001'                       0354 00856000
         BNO   @RF00354                                            0354 00857000
*                   AVNODSTK = (AVNUMCYL - 1) * AVNUMTRK; /*NO. TRKS */ 00858000
         LH    @01,AVNUMCYL                                        0355 00859000
         BCTR  @01,0                                               0355 00860000
         MH    @01,AVNUMTRK                                        0355 00861000
         ST    @01,AVNODSTK                                        0355 00862000
*                 ELSE                  /*ROUND NOT SPECIFIED        */ 00863000
*                   AVNODSTK = AVNUMCYL * AVNUMTRK - 1; /*NO. TRACKS */ 00864000
         B     @RC00354                                            0356 00865000
@RF00354 LH    @06,AVNUMCYL                                        0356 00866000
         MH    @06,AVNUMTRK                                        0356 00867000
         BCTR  @06,0                                               0356 00868000
         ST    @06,AVNODSTK                                        0356 00869000
*               ELSE                    /*ALX OR MIXG NOT SPECIFIED  */ 00870000
*                 DO;                                              0357 00871000
         B     @RC00353                                            0357 00872000
@RF00353 DS    0H                                                  0358 00873000
*                   IF JFCROUND = ON THEN /*CHK FOR ROUND SPECIFIED  */ 00874000
         TM    JFCROUND(JFCBPTR),B'00000001'                       0358 00875000
         BNO   @RF00358                                            0358 00876000
*                     IF (AVTRKPRI // AVNUMTRK) ¬= 0 THEN /*YES,ROUND*/ 00877000
         L     @06,AVTRKPRI                                        0359 00878000
         LH    @15,AVNUMTRK                                        0359 00879000
         LR    @00,@06                                             0359 00880000
         SRDA  @00,32                                              0359 00881000
         DR    @00,@15                                             0359 00882000
         LTR   @00,@00                                             0359 00883000
         BZ    @RF00359                                            0359 00884000
*                       AVTRKPRI = AVTRKPRI + (AVNUMTRK - /*UP TO NXT*/ 00885000
*                                  (AVTRKPRI // AVNUMTRK)); /*CYLIN  */ 00886000
         LR    @00,@06                                             0360 00887000
         SRDA  @00,32                                              0360 00888000
         DR    @00,@15                                             0360 00889000
         SLR   @15,@00                                             0360 00890000
         ALR   @06,@15                                             0360 00891000
         ST    @06,AVTRKPRI                                        0360 00892000
*                   IF JFCBSQTY = 0 THEN /*CHECK FOR SECONDARY SPACE */ 00893000
@RF00359 DS    0H                                                  0361 00894000
@RF00358 ICM   @06,7,JFCBSQTY(JFCBPTR)                             0361 00895000
         BNZ   @RF00361                                            0361 00896000
*                     AVNODSTK = AVTRKPRI; /*NO, TOTAL DS = PRIMARY  */ 00897000
         MVC   AVNODSTK(4),AVTRKPRI                                0362 00898000
*                   ELSE                /*YES, SECONDARY SPACE SPEC  */ 00899000
*                     DO;               /*CALC NO. TRKS ABL SECNDRY  */ 00900000
         B     @RC00361                                            0363 00901000
@RF00361 DS    0H                                                  0364 00902000
*                       AVABLSTK = JFCBSQTY / AVABLRTK;            0364 00903000
         L     @06,AVABLRTK                                        0364 00904000
         SLR   @15,@15                                             0364 00905000
         ICM   @15,7,JFCBSQTY(JFCBPTR)                             0364 00906000
         LR    @01,@15                                             0364 00907000
         SLR   @00,@00                                             0364 00908000
         DR    @00,@06                                             0364 00909000
         ST    @01,AVABLSTK                                        0364 00910000
*                       /*IF RECORDS LEFT OVER, ADD 1 TRACK TO SECON */ 00911000
*                       IF JFCBSQTY // AVABLRTK ¬= 0 THEN /*DARY TRKS*/ 00912000
         LR    @02,@15                                             0365 00913000
         SRDA  @02,32                                              0365 00914000
         DR    @02,@06                                             0365 00915000
         LTR   @02,@02                                             0365 00916000
         BZ    @RF00365                                            0365 00917000
*                         AVABLSTK = AVABLSTK + 1;                 0366 00918000
         AH    @01,@CH00068                                        0366 00919000
         ST    @01,AVABLSTK                                        0366 00920000
*                       IF JFCROUND = ON THEN /*IF ROUND SPECIFIED & */ 00921000
@RF00365 TM    JFCROUND(JFCBPTR),B'00000001'                       0367 00922000
         BNO   @RF00367                                            0367 00923000
*                         /*RECORDS LEFT OVER, ROUND UP TO NEXT CYLIN*/ 00924000
*                         IF AVABLSTK // AVNUMTRK ¬= 0 THEN        0368 00925000
         L     @06,AVABLSTK                                        0368 00926000
         LH    @15,AVNUMTRK                                        0368 00927000
         LR    @00,@06                                             0368 00928000
         SRDA  @00,32                                              0368 00929000
         DR    @00,@15                                             0368 00930000
         LTR   @00,@00                                             0368 00931000
         BZ    @RF00368                                            0368 00932000
*                           AVABLSTK = AVABLSTK + AVNUMTRK -       0369 00933000
*                                      (AVABLSTK // AVNUMTRK);     0369 00934000
         LR    @14,@06                                             0369 00935000
         ALR   @14,@15                                             0369 00936000
         LR    @00,@06                                             0369 00937000
         SRDA  @00,32                                              0369 00938000
         DR    @00,@15                                             0369 00939000
         SLR   @14,@00                                             0369 00940000
         ST    @14,AVABLSTK                                        0369 00941000
*                       /*DETERMINE TOTAL DATA SET SPACE             */ 00942000
*                       AVNODSTK = AVTRKPRI + 15 * AVABLSTK;       0370 00943000
@RF00368 DS    0H                                                  0370 00944000
@RF00367 L     @06,AVABLSTK                                        0370 00945000
         MH    @06,@CH00072                                        0370 00946000
         AL    @06,AVTRKPRI                                        0370 00947000
         ST    @06,AVNODSTK                                        0370 00948000
*                     END;                                         0371 00949000
*                 END;                                             0372 00950000
*             END;                                                 0373 00951000
*           ELSE                                                   0374 00952000
*             CALL BIGABL;              /*PROCESS FOR BIG AVG BLK LEN*/ 00953000
         B     @RC00332                                            0374 00954000
@RF00332 BAL   @14,BIGABL                                          0374 00955000
*         END;                                                     0375 00956000
@RC00332 DS    0H                                                  0376 00957000
*   RFY RET RSTD;                                                  0376 00958000
@RC00321 DS    0H                                                  0376 00959000
@RC00314 DS    0H                                                  0376 00960000
@RC00293 DS    0H                                                  0377 00961000
*   RET = SAV14D;                                                  0377 00962000
         L     RET,SAV14D                                          0377 00963000
*   RFY RET UNRSTD;                                                0378 00964000
*   END ALLOCTRK;                                                  0379 00965000
@EL00006 DS    0H                                                  0379 00966000
@EF00006 DS    0H                                                  0379 00967000
@ER00006 BR    @14                                                 0379 00968000
@PB00006 DS    0H                                                  0380 00969000
*   GEN(EJECT);                                                    0380 00970000
         EJECT                                                          00971000
*BIGABL:                                                           0381 00972000
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0381 00973000
         B     @PB00007                                            0381 00974000
BIGABL   DS    0H                                                  0382 00975000
*   /*****************************************************************/ 00976000
*   /*                                                               */ 00977000
*   /* CALCULATE BIG AVERAGE BLOCK LENGTH                            */ 00978000
*   /*                                                               */ 00979000
*   /*****************************************************************/ 00980000
*   RFY RET RSTD;                                                  0382 00981000
*   SAV14E = RET;                                                  0383 00982000
         ST    RET,SAV14E                                          0383 00983000
*   RFY RET UNRSTD;                                                0384 00984000
*   AVABLRB = JFCBDRLH;                 /*CALC RCD LEN         YM7888*/ 00985000
         SLR   @06,@06                                             0385 00986000
         ICM   @06,7,JFCBDRLH(JFCBPTR)                             0385 00987000
         ST    @06,AVABLRB                                         0385 00988000
*   IF JFCKEYLE = 0 THEN                /*CHECK FOR KEY SPECIFIED    */ 00989000
         CLI   JFCKEYLE(JFCBPTR),0                                 0386 00990000
         BNE   @RF00386                                            0386 00991000
*     AVABLRB = AVABLRB - AVKEYCON;     /*NO, SUBTRACT KEY CONSTANT  */ 00992000
         SLR   @15,@15                                             0387 00993000
         IC    @15,AVKEYCON                                        0387 00994000
         SLR   @06,@15                                             0387 00995000
         ST    @06,AVABLRB                                         0387 00996000
*   ELSE                                                           0388 00997000
*     AVABLRB = AVABLRB + JFCKEYLE;     /*YES, ADD KEY LENGTH  YM7888*/ 00998000
         B     @RC00386                                            0388 00999000
@RF00386 SLR   @06,@06                                             0388 01000000
         IC    @06,JFCKEYLE(,JFCBPTR)                              0388 01001000
         AL    @06,AVABLRB                                         0388 01002000
         ST    @06,AVABLRB                                         0388 01003000
*   AVABLMXT = ((AVABLRB + AVLRCDO) / (AVTRKCAP - AVLRCDO)) + 2; /*MAX- 01004000
*                                       IMUM NUMBER OF TRACKS A BIGABL  01005000
*                                       RECORD WILL SPAN       YM7888*/ 01006000
@RC00386 L     @06,AVABLRB                                         0389 01007000
         LH    @15,AVLRCDO                                         0389 01008000
         LR    @14,@06                                             0389 01009000
         ALR   @14,@15                                             0389 01010000
         LH    @09,AVTRKCAP(,VDSCBPTR)                             0389 01011000
         LR    @08,@09                                             0389 01012000
         SLR   @08,@15                                             0389 01013000
         SRDA  @14,32                                              0389 01014000
         DR    @14,@08                                             0389 01015000
         AL    @15,@CF00111                                        0389 01016000
         STH   @15,AVABLMXT                                        0389 01017000
*   AVABLRB = AVABLRB + (AVABLMXT * AVLRCDO); /* NUMBER OF BYTES   0390 01018000
*                                       PER RECORD             YM7888*/ 01019000
         LH    @14,AVLRCDO                                         0390 01020000
         MR    @14,@14                                             0390 01021000
         ALR   @06,@15                                             0390 01022000
         ST    @06,AVABLRB                                         0390 01023000
*   AVABLPRI = (JFCBPQTY // AVTRKCAP) * AVABLRB; /*CALC NUMBER YM6526*/ 01024000
         SLR   @00,@00                                             0391 01025000
         ICM   @00,7,JFCBPQTY(JFCBPTR)                             0391 01026000
         SRDA  @00,32                                              0391 01027000
         DR    @00,@09                                             0391 01028000
         LR    @03,@00                                             0391 01029000
         MR    @02,@06                                             0391 01030000
         ST    @03,AVABLPRI                                        0391 01031000
*   AVABLPRT = AVABLPRI / AVTRKCAP;     /*OF PRIMARY TRACKS    YM6526*/ 01032000
         LR    @00,@03                                             0392 01033000
         SRDA  @00,32                                              0392 01034000
         DR    @00,@09                                             0392 01035000
         ST    @01,AVABLPRT                                        0392 01036000
*   IF AVABLPRI // AVTRKCAP ¬= 0 THEN   /*IF BYTES LEFT, ADD 1 TRACK */ 01037000
         LR    @04,@03                                             0393 01038000
         SRDA  @04,32                                              0393 01039000
         DR    @04,@09                                             0393 01040000
         LTR   @04,@04                                             0393 01041000
         BZ    @RF00393                                            0393 01042000
*     AVABLPRT = AVABLPRT + 1;                                     0394 01043000
         AH    @01,@CH00068                                        0394 01044000
         ST    @01,AVABLPRT                                        0394 01045000
*   AVABLPRT = AVABLPRT + (JFCBPQTY / AVTRKCAP) * AVABLRB; /*  YM6526*/ 01046000
@RF00393 LH    @06,AVTRKCAP(,VDSCBPTR)                             0395 01047000
         SLR   @01,@01                                             0395 01048000
         ICM   @01,7,JFCBPQTY(JFCBPTR)                             0395 01049000
         SLR   @00,@00                                             0395 01050000
         DR    @00,@06                                             0395 01051000
         M     @00,AVABLRB                                         0395 01052000
         AL    @01,AVABLPRT                                        0395 01053000
         ST    @01,AVABLPRT                                        0395 01054000
*   IF AVLBPTRB = AVTRKCAP THEN         /*CHECK FOR DIRECTORIES      */ 01055000
         CH    @06,AVLBPTRB+80(,VDSCBPTR)                          0396 01056000
         BNE   @RF00396                                            0396 01057000
*     AVTRKPRI = AVABLPRT;              /*NO, CALC PRIMARY TRACKS    */ 01058000
         ST    @01,AVTRKPRI                                        0397 01059000
*   ELSE                                /*YES, ADD PRIMARY SPACE TO  */ 01060000
*     AVTRKPRI = AVLBPTRK + AVABLPRT + 1; /*DIRECTORY SPACE          */ 01061000
         B     @RC00396                                            0398 01062000
@RF00396 LH    @06,AVLBPTRK+80(,VDSCBPTR)                          0398 01063000
         AL    @06,AVABLPRT                                        0398 01064000
         AH    @06,@CH00068                                        0398 01065000
         ST    @06,AVTRKPRI                                        0398 01066000
*   IF JFCMIXG = ON | JFCALX = ON THEN  /*CHECK FOR MIXG OR ALX      */ 01067000
@RC00396 TM    JFCMIXG(JFCBPTR),B'00000110'                        0399 01068000
         BZ    @RF00399                                            0399 01069000
*     IF JFCROUND = ON THEN             /*YES, CHECK FOR ROUND SPEC  */ 01070000
         TM    JFCROUND(JFCBPTR),B'00000001'                       0400 01071000
         BNO   @RF00400                                            0400 01072000
*       AVNODSTK = (AVNUMCYL - 1) * AVNUMTRK;                      0401 01073000
         LH    @01,AVNUMCYL                                        0401 01074000
         BCTR  @01,0                                               0401 01075000
         MH    @01,AVNUMTRK                                        0401 01076000
         ST    @01,AVNODSTK                                        0401 01077000
*     ELSE                                                         0402 01078000
*       AVNODSTK = AVNUMCYL * AVNUMTRK - 1;                        0402 01079000
         B     @RC00400                                            0402 01080000
@RF00400 LH    @06,AVNUMCYL                                        0402 01081000
         MH    @06,AVNUMTRK                                        0402 01082000
         BCTR  @06,0                                               0402 01083000
         ST    @06,AVNODSTK                                        0402 01084000
*   ELSE                                /*ALX OR MIXG NOT SPECIFIED  */ 01085000
*     DO;                                                          0403 01086000
         B     @RC00399                                            0403 01087000
@RF00399 DS    0H                                                  0404 01088000
*       IF JFCROUND = ON THEN           /*CHECK FOR ROUND SPECIFIED  */ 01089000
         TM    JFCROUND(JFCBPTR),B'00000001'                       0404 01090000
         BNO   @RF00404                                            0404 01091000
*         IF AVTRKPRI // AVNUMTRK ¬= 0 THEN /*YES,ROUND UP TO NXT CYL*/ 01092000
         L     @06,AVTRKPRI                                        0405 01093000
         LH    @15,AVNUMTRK                                        0405 01094000
         LR    @00,@06                                             0405 01095000
         SRDA  @00,32                                              0405 01096000
         DR    @00,@15                                             0405 01097000
         LTR   @00,@00                                             0405 01098000
         BZ    @RF00405                                            0405 01099000
*           AVTRKPRI = AVTRKPRI + AVNUMTRK -                       0406 01100000
*                      (AVTRKPRI // AVNUMTRK);                     0406 01101000
         LR    @14,@06                                             0406 01102000
         ALR   @14,@15                                             0406 01103000
         LR    @00,@06                                             0406 01104000
         SRDA  @00,32                                              0406 01105000
         DR    @00,@15                                             0406 01106000
         SLR   @14,@00                                             0406 01107000
         ST    @14,AVTRKPRI                                        0406 01108000
*       IF JFCBSQTY = 0 THEN            /*CHECK FOR SECONDARY REQUEST*/ 01109000
@RF00405 DS    0H                                                  0407 01110000
@RF00404 ICM   @06,7,JFCBSQTY(JFCBPTR)                             0407 01111000
         BNZ   @RF00407                                            0407 01112000
*         AVNODSTK = AVTRKPRI;          /*NO, TOTAL SPACE = PRINARY  */ 01113000
         MVC   AVNODSTK(4),AVTRKPRI                                0408 01114000
*       ELSE                            /*YES, CALC SECONDRY SPACE   */ 01115000
*         DO;                                                      0409 01116000
         B     @RC00407                                            0409 01117000
@RF00407 DS    0H                                                  0410 01118000
*           AVABLSEC = (JFCBSQTY // AVTRKCAP) * AVABLRB; /*SEC QTY   */ 01119000
         LH    @06,AVTRKCAP(,VDSCBPTR)                             0410 01120000
         SLR   @00,@00                                             0410 01121000
         ICM   @00,7,JFCBSQTY(JFCBPTR)                             0410 01122000
         SRDA  @00,32                                              0410 01123000
         DR    @00,@06                                             0410 01124000
         LR    @03,@00                                             0410 01125000
         M     @02,AVABLRB                                         0410 01126000
         ST    @03,AVABLSEC                                        0410 01127000
*           AVABLSTK = AVABLSEC / AVTRKCAP; /*CALC NO. SECONDRY TRKS */ 01128000
         LR    @00,@03                                             0411 01129000
         SRDA  @00,32                                              0411 01130000
         DR    @00,@06                                             0411 01131000
         ST    @01,AVABLSTK                                        0411 01132000
*           IF AVABLSEC // AVTRKCAP ¬= 0 THEN /*IF ANY BYTES LEFT,   */ 01133000
         LR    @04,@03                                             0412 01134000
         SRDA  @04,32                                              0412 01135000
         DR    @04,@06                                             0412 01136000
         LTR   @04,@04                                             0412 01137000
         BZ    @RF00412                                            0412 01138000
*             AVABLSTK = AVABLSTK + 1;  /*ADD 1 TRACK TO SECONDARY   */ 01139000
         AH    @01,@CH00068                                        0413 01140000
         ST    @01,AVABLSTK                                        0413 01141000
*           AVABLSTK = AVABLSTK + (JFCBSQTY / AVTRKCAP) * AVABLRB; 0414 01142000
@RF00412 SLR   @01,@01                                             0414 01143000
         ICM   @01,7,JFCBSQTY(JFCBPTR)                             0414 01144000
         SLR   @00,@00                                             0414 01145000
         LH    @06,AVTRKCAP(,VDSCBPTR)                             0414 01146000
         DR    @00,@06                                             0414 01147000
         M     @00,AVABLRB                                         0414 01148000
         AL    @01,AVABLSTK                                        0414 01149000
         ST    @01,AVABLSTK                                        0414 01150000
*           IF JFCROUND = ON &          /*CHECK FOR ROUND SPECIFIED  */ 01151000
*             AVABLSTK // AVNUMTRK ¬= 0 THEN /*AND NOT CYL BDY THEN  */ 01152000
         TM    JFCROUND(JFCBPTR),B'00000001'                       0415 01153000
         BNO   @RF00415                                            0415 01154000
         LH    @06,AVNUMTRK                                        0415 01155000
         LR    @02,@01                                             0415 01156000
         SRDA  @02,32                                              0415 01157000
         DR    @02,@06                                             0415 01158000
         LTR   @02,@02                                             0415 01159000
         BZ    @RF00415                                            0415 01160000
*             AVABLSTK = AVABLSTK + AVNUMTRK - /*ROUND UP TO CYL     */ 01161000
*                        (AVABLSTK // AVNUMTRK);                   0416 01162000
         LR    @00,@01                                             0416 01163000
         ALR   @00,@06                                             0416 01164000
         LR    @02,@01                                             0416 01165000
         SRDA  @02,32                                              0416 01166000
         DR    @02,@06                                             0416 01167000
         SLR   @00,@02                                             0416 01168000
         ST    @00,AVABLSTK                                        0416 01169000
*           AVNODSTK = AVTRKPRI + 15 * AVABLSTK; /*TOTAL DS TRACKS   */ 01170000
@RF00415 L     @06,AVABLSTK                                        0417 01171000
         MH    @06,@CH00072                                        0417 01172000
         AL    @06,AVTRKPRI                                        0417 01173000
         ST    @06,AVNODSTK                                        0417 01174000
*         END;                                                     0418 01175000
*     END;                                                         0419 01176000
@RC00407 DS    0H                                                  0420 01177000
*   RFY RET RSTD;                                                  0420 01178000
@RC00399 DS    0H                                                  0421 01179000
*   RET = SAV14E;                                                  0421 01180000
         L     RET,SAV14E                                          0421 01181000
*   RFY RET UNRSTD;                                                0422 01182000
*   END BIGABL;                                                    0423 01183000
@EL00007 DS    0H                                                  0423 01184000
@EF00007 DS    0H                                                  0423 01185000
@ER00007 BR    @14                                                 0423 01186000
@PB00007 DS    0H                                                  0424 01187000
*   GEN(EJECT);                                                    0424 01188000
         EJECT                                                          01189000
*ALLOCULT:                                                         0425 01190000
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0425 01191000
         B     @PB00008                                            0425 01192000
ALLOCULT DS    0H                                                  0426 01193000
*   /*****************************************************************/ 01194000
*   /*                                                               */ 01195000
*   /* ALLOCATE USER LABEL TRACK                                     */ 01196000
*   /*                                                               */ 01197000
*   /*****************************************************************/ 01198000
*   RFY RET RSTD;                                                  0426 01199000
*   SAV14D = RET;                                                  0427 01200000
         ST    RET,SAV14D                                          0427 01201000
*   RFY RET UNRSTD;                                                0428 01202000
*   IF (JFCSUL = NOTON |                /*IF NO USER LABEL TRACK     */ 01203000
*       JFCSL = NOTON) THEN             /*WAS REQUESTED              */ 01204000
         TM    JFCSUL(JFCBPTR),B'00001010'                         0429 01205000
         BO    @RF00429                                            0429 01206000
*     AVULABST = 0;                     /*USER LABEL ABSOLUTE TRK = 0*/ 01207000
         SLR   @06,@06                                             0430 01208000
         STH   @06,AVULABST                                        0430 01209000
*   ELSE                                                           0431 01210000
*     IF JFCBSPAC = JFCCYLIN |          /*CHECK FOR CYLINDER ALLOC OR*/ 01211000
*        (JFCBSPAC = JFCAVBL &          /*AVERAGE BLOCK LENGTH WITH  */ 01212000
*        JFCROUND = ON) THEN            /*ROUND SPECIFIED            */ 01213000
         B     @RC00429                                            0431 01214000
@RF00429 TM    JFCBSPAC(JFCBPTR),B'11000000'                       0431 01215000
         BO    @RT00431                                            0431 01216000
         TM    JFCBSPAC(JFCBPTR),B'01000000'                       0431 01217000
         BNO   @RF00431                                            0431 01218000
         TM    JFCBSPAC(JFCBPTR),B'10000000'                       0431 01219000
         BNZ   @RF00431                                            0431 01220000
         TM    JFCROUND(JFCBPTR),B'00000001'                       0431 01221000
         BNO   @RF00431                                            0431 01222000
@RT00431 DS    0H                                                  0432 01223000
*       AVULABST = AVNUMTRK - 1;        /*YES, ALLOCATE UL TRACK     */ 01224000
         LH    @06,AVNUMTRK                                        0432 01225000
         BCTR  @06,0                                               0432 01226000
         STH   @06,AVULABST                                        0432 01227000
*     ELSE                                                         0433 01228000
*       DO;                                                        0433 01229000
         B     @RC00431                                            0433 01230000
@RF00431 DS    0H                                                  0434 01231000
*         IF JFCBSPAC = JFCABSTR THEN   /*CHECK FOR ABSOLUTE TRACK   */ 01232000
         TM    JFCBSPAC(JFCBPTR),B'11000000'                       0434 01233000
         BNZ   @RF00434                                            0434 01234000
*           DO;                         /*ALLOCATION                 */ 01235000
*             AVULABST = AVABSTRK;      /*YES, ALLOCATE FIRST TRACK  */ 01236000
         LH    @06,AVABSTRK                                        0436 01237000
         STH   @06,AVULABST                                        0436 01238000
*             AVABSTRK = AVABSTRK + 1;  /*INCR ABSOLUTE TRACK NO.    */ 01239000
         LA    @15,1                                               0437 01240000
         ALR   @06,@15                                             0437 01241000
         STH   @06,AVABSTRK                                        0437 01242000
*             AVNODSTK = AVNODSTK - 1;  /*DECR NO. DATA SET TRACKS   */ 01243000
         L     @06,AVNODSTK                                        0438 01244000
         BCTR  @06,0                                               0438 01245000
         ST    @06,AVNODSTK                                        0438 01246000
*             AVHEADST = AVHEADST + 1;  /*INCREMENT STARTING HEAD NO */ 01247000
         LH    @06,AVHEADST                                        0439 01248000
         ALR   @06,@15                                             0439 01249000
         STH   @06,AVHEADST                                        0439 01250000
*             IF AVHEADST = AVNUMTRK THEN /*IF TOO MANY TRKS FOR CYL */ 01251000
         CH    @06,AVNUMTRK                                        0440 01252000
         BNE   @RF00440                                            0440 01253000
*               DO;                                                0441 01254000
*                 AVHEADST = 0;         /*RESET STARTING HEAD TO 0   */ 01255000
         SLR   @06,@06                                             0442 01256000
         STH   @06,AVHEADST                                        0442 01257000
*                 AVCYLST = AVCYLST + 1; /*INCREMENT STARTING CYL NO.*/ 01258000
         AH    @15,AVCYLST                                         0443 01259000
         STH   @15,AVCYLST                                         0443 01260000
*               END;                                               0444 01261000
*           END;                                                   0445 01262000
*         ELSE                                                     0446 01263000
*           IF (JFCBSPAC = JFCTRK |     /*CHECK FOR TRACK ALLOC OR   */ 01264000
*             JFCBSPAC = JFCAVBL) THEN  /*AVG BLOCK LENGTH ALLOCATION*/ 01265000
         B     @RC00434                                            0446 01266000
@RF00434 TM    JFCBSPAC(JFCBPTR),B'10000000'                       0446 01267000
         BNO   @GL00006                                            0446 01268000
         TM    JFCBSPAC(JFCBPTR),B'01000000'                       0446 01269000
         BZ    @RT00446                                            0446 01270000
@GL00006 TM    JFCBSPAC(JFCBPTR),B'01000000'                       0446 01271000
         BNO   @RF00446                                            0446 01272000
         TM    JFCBSPAC(JFCBPTR),B'10000000'                       0446 01273000
         BNZ   @RF00446                                            0446 01274000
@RT00446 DS    0H                                                  0447 01275000
*             DO;                                                  0447 01276000
*               AVHEADST = AVHEADST + 1; /*INCREMENT STARTING HEAD   */ 01277000
         LA    @06,1                                               0448 01278000
         LH    @15,AVHEADST                                        0448 01279000
         ALR   @15,@06                                             0448 01280000
         STH   @15,AVHEADST                                        0448 01281000
*               IF AVNODSTK < AVAVAILT THEN /*CHECK AVAILABLE TRACK  */ 01282000
         L     @15,AVNODSTK                                        0449 01283000
         CH    @15,AVAVAILT                                        0449 01284000
         BNL   @RF00449                                            0449 01285000
*                 DO;                   /*YES, AVAILABLE TRACKS      */ 01286000
*                   AVULABST = 1;       /*ALLOCATE USER LABEL TRACK  */ 01287000
         STH   @06,AVULABST                                        0451 01288000
*                   AVABSTRK = AVABSTRK + 1; /*INCR ABSOLUTE TRK NO. */ 01289000
         AH    @06,AVABSTRK                                        0452 01290000
         STH   @06,AVABSTRK                                        0452 01291000
*                 END;                                             0453 01292000
*               ELSE                    /*NO AVAILABLE TRACKS        */ 01293000
*                 IF AVTRKPRI = AVAVAILT THEN /*IF PRIMARY SPACE =   */ 01294000
         B     @RC00449                                            0454 01295000
@RF00449 L     @06,AVTRKPRI                                        0454 01296000
         CH    @06,AVAVAILT                                        0454 01297000
         BNE   @RF00454                                            0454 01298000
*                   DO;                 /*AVAILABLE TRACKS           */ 01299000
*                     RFY R8 RSTD;                                 0456 01300000
*                     R8 = ECNOSPAC;    /*NO SPACE AVAILABLE         */ 01301000
         LA    R8,20                                               0457 01302000
*                     GO TO FREEDSCB;   /*GO FREE CORE FOR VDSCB     */ 01303000
         B     FREEDSCB                                            0458 01304000
*                     RFY R8 UNRSTD;                               0459 01305000
*                   END;                                           0460 01306000
*                 ELSE                                             0461 01307000
*                   IF AVTRKPRI < AVAVAILT THEN /*CHECK PRI SPACE <  */ 01308000
@RF00454 L     @06,AVTRKPRI                                        0461 01309000
         CH    @06,AVAVAILT                                        0461 01310000
         BNL   @RF00461                                            0461 01311000
*                     DO;               /*AVAILABLE SPACE, YES DO    */ 01312000
*                       AVULABST = 1;   /*ALLOCATE USER LABEL TRACK  */ 01313000
         LA    @06,1                                               0463 01314000
         STH   @06,AVULABST                                        0463 01315000
*                       AVABSTRK = AVABSTRK + 1; /*INCR NO. ABS TRKS */ 01316000
         AH    @06,AVABSTRK                                        0464 01317000
         STH   @06,AVABSTRK                                        0464 01318000
*                       AVNODSTK = AVNODSTK - 1; /*DECR NO. DS TRKS  */ 01319000
         L     @06,AVNODSTK                                        0465 01320000
         BCTR  @06,0                                               0465 01321000
         ST    @06,AVNODSTK                                        0465 01322000
*                     END;                                         0466 01323000
*             END;                                                 0467 01324000
@RF00461 DS    0H                                                  0467 01325000
@RC00449 DS    0H                                                  0468 01326000
*       END;                                                       0468 01327000
@RF00446 DS    0H                                                  0468 01328000
@RC00434 DS    0H                                                  0469 01329000
*   RFY RET RSTD;                                                  0469 01330000
@RC00431 DS    0H                                                  0469 01331000
@RC00429 DS    0H                                                  0470 01332000
*   RET = SAV14D;                                                  0470 01333000
         L     RET,SAV14D                                          0470 01334000
*   RFY RET UNRSTD;                                                0471 01335000
*   END ALLOCULT;                                                  0472 01336000
@EL00008 DS    0H                                                  0472 01337000
@EF00008 DS    0H                                                  0472 01338000
@ER00008 BR    @14                                                 0472 01339000
@PB00008 DS    0H                                                  0473 01340000
*   GEN(EJECT);                                                    0473 01341000
         EJECT                                                          01342000
*BLDUCB:                                                           0474 01343000
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0474 01344000
         B     @PB00009                                            0474 01345000
BLDUCB   DS    0H                                                  0475 01346000
*   /*****************************************************************/ 01347000
*   /*                                                               */ 01348000
*   /* INITIALIZE NON-ZERO FIELDS IN THE VDSUCB                      */ 01349000
*   /*                                                               */ 01350000
*   /*****************************************************************/ 01351000
*   RFY RET RSTD;                                                  0475 01352000
*   SAV14C = RET;                                                  0476 01353000
         ST    RET,SAV14C                                          0476 01354000
*   RFY RET UNRSTD;                                                0477 01355000
*   UCBJBNR = '80'X;                                               0478 01356000
         MVI   UCBJBNR(VDSCBPTR),X'80'                             0478 01357000
*   UCBID = ALLBITS;                                               0479 01358000
         MVI   UCBID(VDSCBPTR),B'11111111'                         0479 01359000
*   UCBONLI = ON;                       /*SET DEVICE ONLINE BIT      */ 01360000
*   UCBRESV = ON;                       /*SET VOLUME RESERVED BIT    */ 01361000
*   UCBALOC = ON;                       /*SET DEVICE ALLOCATED BIT   */ 01362000
*   UCBDADI = ON;                       /*SET SL BIT                 */ 01363000
         OI    UCBONLI(VDSCBPTR),B'10101001'                       0483 01364000
*   UCBCHA = '3F'X;                     /*CHANNEL ADDRESS FLAGS      */ 01365000
         MVI   UCBCHA(VDSCBPTR),X'3F'                              0484 01366000
*   UCBUA = ALLBITS;                    /*UNIT ADDRESS               */ 01367000
         MVI   UCBUA(VDSCBPTR),X'FF'                               0485 01368000
*   UCBNAME = 'VIO';                    /*EBCDIC UNIT NAME           */ 01369000
         MVC   UCBNAME(3,VDSCBPTR),@CC02169                        0486 01370000
*   UCBBSVL = ON;                       /*VOLUME NOT SHARABLE        */ 01371000
*   UCBBPRV = ON;                       /*VOLUME PRIVATE             */ 01372000
         OI    UCBBSVL(VDSCBPTR),B'10010000'                       0488 01373000
*   UCBTYP = AVDEVTYP;                  /*DEVICE TYPE FIELD          */ 01374000
         MVC   UCBTYP(4,VDSCBPTR),AVDEVTYP                         0489 01375000
*   UCBRVDEV = '0'B;               /* INSURE NO VIRTUAL TYPE @ZA17523*/ 01376000
         NI    UCBRVDEV(VDSCBPTR),B'11110111'                      0490 01377000
*   UCBVOLI = JFCBVOLS;                 /*6 BYTE VOLUME SERIAL NO.   */ 01378000
         MVC   UCBVOLI(6,VDSCBPTR),JFCBVOLS(JFCBPTR)               0491 01379000
*   AVDTI = (CVTZDTAB + AVDEVTYP(4)) -> OFFSET; /*DEVIC INDX   YM5908*/ 01380000
         L     @06,CVTPTR                                          0492 01381000
         L     @06,CVTZDTAB(,@06)                                  0492 01382000
         SLR   @15,@15                                             0492 01383000
         IC    @15,AVDEVTYP+3                                      0492 01384000
         ALR   @15,@06                                             0492 01385000
         SLR   @14,@14                                             0492 01386000
         IC    @14,OFFSET(,@15)                                    0492 01387000
         STC   @14,AVDTI                                           0492 01388000
*   /*                                                               */ 01389000
*   /* MOVE DEVICE CHARACTERISTICS TABLE INTO VIO WORKAREA (12 BYTES)*/ 01390000
*   /*                                                               */ 01391000
*   AVNUMCYL = SCYL;                    /*GET NUMBER OF CYLINDERS    */ 01392000
         ALR   @06,@14                                             0493 01393000
         MVC   AVNUMCYL(2),SCYL(@06)                               0493 01394000
*   AVNUMTRK = STRK;                    /*GET NO. TRACKS PER CYLINDER*/ 01395000
         MVC   AVNUMTRK(2),STRK(@06)                               0494 01396000
*   AVTRKCAP = STRKCAP;                 /*GET TRACK CAPACITY         */ 01397000
         MVC   AVTRKCAP(2,VDSCBPTR),STRKCAP(@06)                   0495 01398000
*   IF SILEQ = ON THEN                  /*IF IRCDO = LRCDO           */ 01399000
         TM    SILEQ(@06),B'00001000'                              0496 01400000
         BNO   @RF00496                                            0496 01401000
*     DO;                               /*THEN USE HALFWORD VALUE    */ 01402000
*       AVIRCDO = SRCDO;                /*GET INNER RCD OVERHEAD     */ 01403000
         LH    @06,SRCDO(,@06)                                     0498 01404000
         STH   @06,AVIRCDO                                         0498 01405000
*       AVLRCDO = SRCDO;                /*GET LAST OR ONLY RCD OVERHD*/ 01406000
         STH   @06,AVLRCDO                                         0499 01407000
*     END;                                                         0500 01408000
*   ELSE                                /*USE ONE BYTE VALUES        */ 01409000
*     DO;                                                          0501 01410000
         B     @RC00496                                            0501 01411000
@RF00496 DS    0H                                                  0502 01412000
*       AVIBT2 = SIRCDO;                /*GET INNER RCD OVERHEAD     */ 01413000
         SLR   @06,@06                                             0502 01414000
         IC    @06,AVDTI                                           0502 01415000
         L     @01,CVTPTR                                          0502 01416000
         AL    @06,CVTZDTAB(,@01)                                  0502 01417000
         MVC   AVIBT2(1),SIRCDO(@06)                               0502 01418000
*       AVLBT2 = SLRCDO;                /*GET LAST OR ONLY RCD OVERHD*/ 01419000
         MVC   AVLBT2(1),SLRCDO(@06)                               0503 01420000
*       AVIBT1 = VDS1HEX0;              /*SET HI-ORDER BYTE TO ZERO  */ 01421000
         MVI   AVIBT1,X'00'                                        0504 01422000
*       AVLBT1 = VDS1HEX0;              /*SET HI-ORDER BYTE TO ZERO  */ 01423000
         MVI   AVLBT1,X'00'                                        0505 01424000
*     END;                                                         0506 01425000
*   AVKEYCON = SKEY;                    /*GET KEY CONSTANT           */ 01426000
@RC00496 SLR   @06,@06                                             0507 01427000
         IC    @06,AVDTI                                           0507 01428000
         L     @01,CVTPTR                                          0507 01429000
         AL    @06,CVTZDTAB(,@01)                                  0507 01430000
         MVC   AVKEYCON(1),SKEY(@06)                               0507 01431000
*   AVFLAGS = SFLAG;                    /*GET FLAG BYTE              */ 01432000
         MVC   AVFLAGS(1),SFLAG(@06)                               0508 01433000
*   IF SFTOLER = ON THEN                /*IS TOLERANCE VALID   YM3818*/ 01434000
         TM    SFTOLER(@06),B'00000001'                            0509 01435000
         BNO   @RF00509                                            0509 01436000
*     AVTOLER = STOLER;                 /*IF VALID, USE IT     YM3818*/ 01437000
         MVC   AVTOLER(2),STOLER(@06)                              0510 01438000
*   ELSE                                /*OTHERWISE, USE 512   YM3818*/ 01439000
*     AVTOLER = 512;                    /*TO NULLIFY TOLERANCE YM3818*/ 01440000
         B     @RC00509                                            0511 01441000
@RF00509 MVC   AVTOLER(2),@CH01660                                 0511 01442000
*                                       /*CALCULATIONS         YM3818*/ 01443000
*   RFY RET RSTD;                                                  0512 01444000
@RC00509 DS    0H                                                  0513 01445000
*   RET = SAV14C;                                                  0513 01446000
         L     RET,SAV14C                                          0513 01447000
*   RFY RET UNRSTD;                                                0514 01448000
*   END BLDUCB;                                                    0515 01449000
@EL00009 DS    0H                                                  0515 01450000
@EF00009 DS    0H                                                  0515 01451000
@ER00009 BR    @14                                                 0515 01452000
@PB00009 DS    0H                                                  0516 01453000
*   GEN(EJECT);                                                    0516 01454000
         EJECT                                                          01455000
*BLDDSEXT:                                                         0517 01456000
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0517 01457000
         B     @PB00010                                            0517 01458000
BLDDSEXT DS    0H                                                  0518 01459000
*   /*****************************************************************/ 01460000
*   /*                                                               */ 01461000
*   /* BUILD THE DATA SET EXTENT                                     */ 01462000
*   /*                                                               */ 01463000
*   /*****************************************************************/ 01464000
*   RFY RET RSTD;                                                  0518 01465000
*   SAV14D = RET;                                                  0519 01466000
         ST    RET,SAV14D                                          0519 01467000
*   RFY RET UNRSTD;                                                0520 01468000
*   RESPECIFY EXTPTR RESTRICTED;                                   0521 01469000
*   DS1NOEPV = 1;                       /*NO. DS EXTENTS = ONE       */ 01470000
         LA    @08,80                                              0522 01471000
         ALR   @08,VDSCBPTR                                        0522 01472000
         MVI   DS1NOEPV(@08),X'01'                                 0522 01473000
*   IF AVULABST = 0 THEN                /*IF NO USER LABEL TRACK THEN*/ 01474000
         ICM   @06,3,AVULABST                                      0523 01475000
         BNZ   @RF00523                                            0523 01476000
*     DO;                               /*SET UP FOR DS1EXT1         */ 01477000
*       EXTPTR = ADDR(DS1EXT1);         /*BASE FOR VDS1EXT           */ 01478000
         LA    EXTPTR,DS1EXT1(,@08)                                0525 01479000
*       VDS1EXTN = VDSEXT1;             /*INDICATE FIRST EXTENT      */ 01480000
         MVI   VDS1EXTN(EXTPTR),X'00'                              0526 01481000
*     END;                                                         0527 01482000
*   ELSE                                /*OTHERWISE, SET UP FOR      */ 01483000
*     DO;                               /*DS1EXT2                    */ 01484000
         B     @RC00523                                            0528 01485000
@RF00523 DS    0H                                                  0529 01486000
*       EXTPTR = ADDR(DS1EXT2);         /*BASE FOR VDS1EXT           */ 01487000
         LA    EXTPTR,DS1EXT2+80(,VDSCBPTR)                        0529 01488000
*       VDS1EXTN = VDSEXT2;             /*INDICATE SECOND EXTENT     */ 01489000
         MVI   VDS1EXTN(EXTPTR),X'01'                              0530 01490000
*     END;                                                         0531 01491000
*   VDS1STCC = AVCYLST;                 /*STARTING CYLINDER NUMBER   */ 01492000
@RC00523 MVC   VDS1STCC(2,EXTPTR),AVCYLST                          0532 01493000
*   VDS1STHH = AVHEADST;                /*STARTING HEAD NUMBER       */ 01494000
         MVC   VDS1STHH(2,EXTPTR),AVHEADST                         0533 01495000
*   AVABSLTA = AVABSTRK + AVNODSTK - 1; /*CALC LAST TRACK ALLOCATED  */ 01496000
         LH    @08,AVABSTRK                                        0534 01497000
         AL    @08,AVNODSTK                                        0534 01498000
         BCTR  @08,0                                               0534 01499000
         STH   @08,AVABSLTA                                        0534 01500000
*   VDS1ECC = AVABSLTA / AVNUMTRK;      /*ENDING CYLINDER NUMBER     */ 01501000
         LH    @06,AVNUMTRK                                        0535 01502000
         LR    @00,@08                                             0535 01503000
         SRDA  @00,32                                              0535 01504000
         DR    @00,@06                                             0535 01505000
         STH   @01,VDS1ECC(,EXTPTR)                                0535 01506000
*   VDS1EHH = AVABSLTA // AVNUMTRK;     /*ENDING HEAD NUMBER         */ 01507000
         LR    @00,@08                                             0536 01508000
         SRDA  @00,32                                              0536 01509000
         DR    @00,@06                                             0536 01510000
         STH   @00,VDS1EHH(,EXTPTR)                                0536 01511000
*   IF (JFCBSPAC = JFCCYLIN) |          /*IF CYLINDER ALLOCATION OR  */ 01512000
*     (JFCBSPAC = JFCAVBL &             /*BOTH AVERAGE BLOCK LENGTH  */ 01513000
*     JFCROUND = ON) THEN               /*AND ROUND WERE SPECIFIED   */ 01514000
         TM    JFCBSPAC(JFCBPTR),B'11000000'                       0537 01515000
         BO    @RT00537                                            0537 01516000
         TM    JFCBSPAC(JFCBPTR),B'01000000'                       0537 01517000
         BNO   @RF00537                                            0537 01518000
         TM    JFCBSPAC(JFCBPTR),B'10000000'                       0537 01519000
         BNZ   @RF00537                                            0537 01520000
         TM    JFCROUND(JFCBPTR),B'00000001'                       0537 01521000
         BNO   @RF00537                                            0537 01522000
@RT00537 DS    0H                                                  0538 01523000
*     VDS1EXTD = VDSABLRC;                                         0538 01524000
         MVI   VDS1EXTD(EXTPTR),B'10000001'                        0538 01525000
*   ELSE                                                           0539 01526000
*     IF (JFCBSPAC = JFCAVBL) |         /*CHK AVERAGE BLOCK LENGTH OR*/ 01527000
*       (JFCBSPAC = JFCTRK) THEN        /*TRACK ALLOCATION           */ 01528000
         B     @RC00537                                            0539 01529000
@RF00537 TM    JFCBSPAC(JFCBPTR),B'01000000'                       0539 01530000
         BNO   @GL00009                                            0539 01531000
         TM    JFCBSPAC(JFCBPTR),B'10000000'                       0539 01532000
         BZ    @RT00539                                            0539 01533000
@GL00009 TM    JFCBSPAC(JFCBPTR),B'10000000'                       0539 01534000
         BNO   @RF00539                                            0539 01535000
         TM    JFCBSPAC(JFCBPTR),B'01000000'                       0539 01536000
         BNZ   @RF00539                                            0539 01537000
@RT00539 DS    0H                                                  0540 01538000
*       VDS1EXTD = VDSABLTK;                                       0540 01539000
         MVI   VDS1EXTD(EXTPTR),B'00000001'                        0540 01540000
*     ELSE                                                         0541 01541000
*       DO;                                                        0541 01542000
         B     @RC00539                                            0541 01543000
@RF00539 DS    0H                                                  0542 01544000
*         IF VDS1STHH = VDSSTHH0 &                                 0542 01545000
*           (VDS1EHH = AVNUMTRK - 1) THEN                          0542 01546000
         ICM   @08,3,VDS1STHH(EXTPTR)                              0542 01547000
         BNZ   @RF00542                                            0542 01548000
         LH    @08,AVNUMTRK                                        0542 01549000
         BCTR  @08,0                                               0542 01550000
         CH    @08,VDS1EHH(,EXTPTR)                                0542 01551000
         BNE   @RF00542                                            0542 01552000
*           VDS1EXTD = VDSABSHH;                                   0543 01553000
         MVI   VDS1EXTD(EXTPTR),B'10000001'                        0543 01554000
*         ELSE                                                     0544 01555000
*           VDS1EXTD = VDSABSTK;                                   0544 01556000
         B     @RC00542                                            0544 01557000
@RF00542 MVI   VDS1EXTD(EXTPTR),B'00000001'                        0544 01558000
*       END;                                                       0545 01559000
@RC00542 DS    0H                                                  0546 01560000
*   RESPECIFY EXTPTR UNRESTRICTED;                                 0546 01561000
@RC00539 DS    0H                                                  0546 01562000
@RC00537 DS    0H                                                  0547 01563000
*   RFY RET RSTD;                                                  0547 01564000
*   RET = SAV14D;                                                  0548 01565000
         L     RET,SAV14D                                          0548 01566000
*   RFY RET UNRSTD;                                                0549 01567000
*   END BLDDSEXT;                                                  0550 01568000
@EL00010 DS    0H                                                  0550 01569000
@EF00010 DS    0H                                                  0550 01570000
@ER00010 BR    @14                                                 0550 01571000
@PB00010 DS    0H                                                  0551 01572000
*   GEN(EJECT);                                                    0551 01573000
         EJECT                                                          01574000
*MRGJFCB:                                                          0552 01575000
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0552 01576000
         B     @PB00011                                            0552 01577000
MRGJFCB  DS    0H                                                  0553 01578000
*   /*****************************************************************/ 01579000
*   /*                                                               */ 01580000
*   /* MERGE JFCB FIELDS TO SELECTED VDSDSCB FIELDS                  */ 01581000
*   /*                                                               */ 01582000
*   /*****************************************************************/ 01583000
*   RFY RET RSTD;                                                  0553 01584000
*   SAV14D = RET;                       /*SAVE REGISTER 14           */ 01585000
         ST    RET,SAV14D                                          0554 01586000
*   RFY RET UNRSTD;                                                0555 01587000
*   DS1DSNAM = JFCBDSNM;                /*DATA SET NAME 44 BYTES     */ 01588000
         LA    @06,80                                              0556 01589000
         ALR   @06,VDSCBPTR                                        0556 01590000
         MVC   DS1DSNAM(44,@06),JFCBDSNM(JFCBPTR)                  0556 01591000
*   DS1FMTID = 'F1'X;                   /*FORMAT 1 ID                */ 01592000
         MVI   DS1FMTID(@06),X'F1'                                 0557 01593000
*   DS1DSSN = JFCBVOLS;                 /*VOLUME SERIAL NUMBER       */ 01594000
         MVC   DS1DSSN(6,@06),JFCBVOLS(JFCBPTR)                    0558 01595000
*   DS1VOLSQ = 1;                       /*VOLUME SEQUENCE NUMBER     */ 01596000
         MVC   DS1VOLSQ(2,@06),@CH00068                            0559 01597000
*   DS1CREDT = JFCBCRDT;                /*DATA SET CREATION DATE     */ 01598000
         MVC   DS1CREDT(3,@06),JFCBCRDT(JFCBPTR)                   0560 01599000
*   DS1EXPDT = JFCBXPDT;                /*DATA SET EXPIRATION DATE   */ 01600000
         MVC   DS1EXPDT(3,@06),JFCBXPDT(JFCBPTR)                   0561 01601000
*   DS1DSORG = JFCDSORG;                /*DATA SET ORGANIZATION      */ 01602000
         MVC   DS1DSORG(2,@06),JFCDSORG(JFCBPTR)                   0562 01603000
*   IF JFCBDQTY = 0 THEN                /*CHECK FOR PARTITIONED DS   */ 01604000
         ICM   @15,7,JFCBDQTY(JFCBPTR)                             0563 01605000
         BNZ   @RF00563                                            0563 01606000
*     DS1NOBDB = 0;                     /*NO, SET TO ZERO            */ 01607000
         MVI   DS1NOBDB(@06),X'00'                                 0564 01608000
*   ELSE                                                           0565 01609000
*     DO;                                                          0565 01610000
         B     @RC00563                                            0565 01611000
@RF00563 DS    0H                                                  0566 01612000
*       DS1NOBDB = '0E'X;               /*YES, NO. BYTES LAST PDS BLK*/ 01613000
         LA    @06,80                                              0566 01614000
         ALR   @06,VDSCBPTR                                        0566 01615000
         MVI   DS1NOBDB(@06),X'0E'                                 0566 01616000
*       DS1PDS = ON;                    /*INDICATE PO IN DSORG       */ 01617000
         OI    DS1PDS(@06),B'00000010'                             0567 01618000
*     END;                                                         0568 01619000
*   DS1SYSCD = 'IBM OS/VS 370';         /*SYSTEM CODE          YM3995*/ 01620000
@RC00563 LA    @06,80                                              0569 01621000
         ALR   @06,VDSCBPTR                                        0569 01622000
         MVC   DS1SYSCD(13,@06),@CC02178                           0569 01623000
*   DS1RECFM = JFCRECFM;                /*RECORD FORMAT              */ 01624000
         MVC   DS1RECFM(1,@06),JFCRECFM(JFCBPTR)                   0570 01625000
*   DS1OPTCD = JFCOPTCD;                /*OPTION CODES               */ 01626000
         MVC   DS1OPTCD(1,@06),JFCOPTCD(JFCBPTR)                   0571 01627000
*   DS1BLKL = JFCBLKSI;                 /*BLOCKSIZE                  */ 01628000
         MVC   DS1BLKL(2,@06),JFCBLKSI(JFCBPTR)                    0572 01629000
*   DS1LRECL = JFCLRECL;                /*LOGICAL RECORD LENGTH      */ 01630000
         MVC   DS1LRECL(2,@06),JFCLRECL(JFCBPTR)                   0573 01631000
*   DS1KEYL = JFCKEYLE;                 /*KEY LENGTH                 */ 01632000
         MVC   DS1KEYL(1,@06),JFCKEYLE(JFCBPTR)                    0574 01633000
*   DS1RKP = JFCRKP;                    /*RELATIVE KEY POSITION      */ 01634000
         MVC   DS1RKP(2,@06),JFCRKP(JFCBPTR)                       0575 01635000
*   DS1SCALO(1) = JFCBCTRI;             /*SPACE PARAMETERS           */ 01636000
         MVC   DS1SCALO(1,@06),JFCBCTRI(JFCBPTR)                   0576 01637000
*   RFY RET RSTD;                                                  0577 01638000
*   RET = SAV14D;                       /*RESTORE REGISTER 14        */ 01639000
         L     RET,SAV14D                                          0578 01640000
*   RFY RET UNRSTD;                                                0579 01641000
*   END MRGJFCB;                                                   0580 01642000
@EL00011 DS    0H                                                  0580 01643000
@EF00011 DS    0H                                                  0580 01644000
@ER00011 BR    @14                                                 0580 01645000
@PB00011 DS    0H                                                  0581 01646000
*   GEN(EJECT);                                                    0581 01647000
         EJECT                                                          01648000
*   GEN DATA;                                                      0582 01649000
*   END IGG0325I                                                   0583 01650000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      * 01651000
*/*%INCLUDE SYSLIB  (CVT     )                                        * 01652000
*/*%INCLUDE SYSLIB  (IKJTCB  )                                        * 01653000
*/*%INCLUDE SYSLIB  (IEZJSCB )                                        * 01654000
*/*%INCLUDE SYSLIB  (IEFJFCBN)                                        * 01655000
*/*%INCLUDE SYSLIB  (IDDVDSCB)                                        * 01656000
*/*%INCLUDE SYSLIB  (IEFUCBOB)                                        * 01657000
*/*%INCLUDE SYSLIB  (IECSDSL1)                                        * 01658000
*;                                                                 0583 01659000
@EL00001 L     @13,4(,@13)                                         0583 01660000
@EF00001 DS    0H                                                  0583 01661000
@ER00001 BR    @14                                                 0583 01662000
@DATA    DS    0H                                                       01663000
@CH00068 DC    H'1'                                                     01664000
@CH00072 DC    H'15'                                                    01665000
@DATD    DSECT                                                          01666000
         DS    0F                                                       01667000
@SA00001 DS    18F                                                      01668000
IGG0325I CSECT                                                          01669000
         DS    0F                                                       01670000
@CF00111 DC    F'2'                                                     01671000
@CF00842 DC    F'64'                                                    01672000
@CF01660 DC    F'512'                                                   01673000
@CH01660 EQU   @CF01660+2                                               01674000
@DATD    DSECT                                                          01675000
         DS    0D                                                       01676000
IGG0325I CSECT                                                          01677000
         DS    0F                                                       01678000
@SIZDATD DC    AL1(0)                                                   01679000
         DC    AL3(@ENDDATD-@DATD)                                      01680000
         DS    0D                                                       01681000
@CC02178 DC    C'IBM OS/VS 370'                                         01682000
@CC02169 DC    C'VIO'                                                   01683000
@DATD    DSECT                                                          01684000
IGG0325I CSECT                                                          01685000
         XCTLTABL ID=(AVCLF2,IGG0CLF2),SVC=032,BRT=YES,LENGTH=          01686000
         EJECT                                                          01687000
DSCBWKAR IECALLWA EP,ADT=YES            ALLOCATE WORK AREA              01688000
@DATD    DSECT                                                          01689000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                01690000
@ENDDATD EQU   *                                                        01691000
IGG0325I CSECT                                                          01692000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       01693000
@01      EQU   01                                                       01694000
@02      EQU   02                                                       01695000
@03      EQU   03                                                       01696000
@04      EQU   04                                                       01697000
@05      EQU   05                                                       01698000
@06      EQU   06                                                       01699000
@07      EQU   07                                                       01700000
@08      EQU   08                                                       01701000
@09      EQU   09                                                       01702000
@10      EQU   10                                                       01703000
@11      EQU   11                                                       01704000
@12      EQU   12                                                       01705000
@13      EQU   13                                                       01706000
@14      EQU   14                                                       01707000
@15      EQU   15                                                       01708000
R1       EQU   @01                                                      01709000
R2       EQU   @02                                                      01710000
JSCBACTP EQU   @06                                                      01711000
DEVTPTR  EQU   @07                                                      01712000
R7       EQU   @07                                                      01713000
R8       EQU   @08                                                      01714000
EXTPTR   EQU   @09                                                      01715000
R9       EQU   @09                                                      01716000
VDSCBPTR EQU   @10                                                      01717000
RA       EQU   @10                                                      01718000
JFCBPTR  EQU   @11                                                      01719000
R11      EQU   @11                                                      01720000
RBASE    EQU   @12                                                      01721000
R12      EQU   @12                                                      01722000
RALLOCWA EQU   @13                                                      01723000
R13      EQU   @13                                                      01724000
RET      EQU   @14                                                      01725000
RETCODE  EQU   @15                                                      01726000
RF       EQU   @15                                                      01727000
R0       EQU   @00                                                      01728000
R3       EQU   @03                                                      01729000
R4       EQU   @04                                                      01730000
R5       EQU   @05                                                      01731000
R6       EQU   @06                                                      01732000
CVTPTR   EQU   16                                                       01733000
CVTMAP   EQU   0                                                        01734000
CVT      EQU   CVTMAP                                                   01735000
CVTTCBP  EQU   CVTMAP                                                   01736000
CVTZDTAB EQU   CVTMAP+64                                                01737000
CVTDAR   EQU   CVTMAP+72                                                01738000
CVTFLGS1 EQU   CVTDAR                                                   01739000
CVTDCB   EQU   CVTMAP+116                                               01740000
CVTIERLC EQU   CVTMAP+144                                               01741000
CVTOPTA  EQU   CVTMAP+182                                               01742000
CVTOPTB  EQU   CVTMAP+183                                               01743000
CVTGTF   EQU   CVTMAP+236                                               01744000
CVTGTFST EQU   CVTGTF                                                   01745000
CVTGTFS  EQU   CVTGTFST                                                 01746000
CVTSTATE EQU   CVTGTFST                                                 01747000
CVTTMODE EQU   CVTGTFST                                                 01748000
CVTFORM  EQU   CVTGTFST                                                 01749000
CVTAQAVT EQU   CVTMAP+240                                               01750000
CVTTCMFG EQU   CVTAQAVT                                                 01751000
CVTVOLM2 EQU   CVTMAP+244                                               01752000
CVTTATA  EQU   CVTVOLM2                                                 01753000
CVTTSKS  EQU   CVTTATA                                                  01754000
CVTVOLF2 EQU   CVTTSKS                                                  01755000
CVTTAT   EQU   CVTTATA+1                                                01756000
CVTATER  EQU   CVTMAP+248                                               01757000
CVTEXT1  EQU   CVTMAP+252                                               01758000
CVTPURG  EQU   CVTMAP+260                                               01759000
CVTQMSG  EQU   CVTMAP+268                                               01760000
CVTDMSR  EQU   CVTMAP+272                                               01761000
CVTRSV37 EQU   CVTDMSR                                                  01762000
CVTDMSRF EQU   CVTRSV37                                                 01763000
CVTERPV  EQU   CVTMAP+316                                               01764000
CVTINTLA EQU   CVTMAP+320                                               01765000
CVTAPF   EQU   CVTMAP+324                                               01766000
CVTEXT2  EQU   CVTMAP+328                                               01767000
CVTHJES  EQU   CVTMAP+332                                               01768000
CVTPGSIA EQU   CVTMAP+348                                               01769000
CVTA1F1  EQU   CVTMAP+356                                               01770000
CVTSYSK  EQU   CVTMAP+357                                               01771000
CVTVOLM1 EQU   CVTMAP+380                                               01772000
CVTVOLF1 EQU   CVTVOLM1                                                 01773000
CVTATMCT EQU   CVTMAP+388                                               01774000
CVTXTNT1 EQU   0                                                        01775000
CVTXTNT2 EQU   0                                                        01776000
CVTDSSV  EQU   CVTXTNT2                                                 01777000
CVTFLGBT EQU   CVTXTNT2+5                                               01778000
CVTQID   EQU   CVTXTNT2+24                                              01779000
CVTRV400 EQU   CVTXTNT2+52                                              01780000
CVTRV409 EQU   CVTXTNT2+53                                              01781000
CVTATCVT EQU   CVTXTNT2+64                                              01782000
CVTRV429 EQU   CVTXTNT2+84                                              01783000
CVTRV438 EQU   CVTXTNT2+85                                              01784000
CVTRV457 EQU   CVTXTNT2+112                                             01785000
CVTRV466 EQU   CVTXTNT2+113                                             01786000
CVTFIX   EQU   0                                                        01787000
CVTRELNO EQU   CVTFIX+252                                               01788000
TCBPTRS  EQU   0                                                        01789000
TCBPTR   EQU   TCBPTRS+4                                                01790000
TCBFIX   EQU   0                                                        01791000
TCBFRS   EQU   TCBFIX                                                   01792000
TCB      EQU   0                                                        01793000
TCBPIE   EQU   TCB+4                                                    01794000
TCBPMASK EQU   TCBPIE                                                   01795000
TCBCMP   EQU   TCB+16                                                   01796000
TCBCMPF  EQU   TCBCMP                                                   01797000
TCBCPP   EQU   TCBCMPF                                                  01798000
TCBSTCC  EQU   TCBCMPF                                                  01799000
TCBCDBL  EQU   TCBCMPF                                                  01800000
TCBCWTO  EQU   TCBCMPF                                                  01801000
TCBCIND  EQU   TCBCMPF                                                  01802000
TCBCMSG  EQU   TCBCMPF                                                  01803000
TCBTRN   EQU   TCB+20                                                   01804000
TCBABF   EQU   TCBTRN                                                   01805000
TCBMSS   EQU   TCB+24                                                   01806000
TCBPKF   EQU   TCB+28                                                   01807000
TCBFLGS  EQU   TCB+29                                                   01808000
TCBFLGS1 EQU   TCBFLGS                                                  01809000
TCBFLGS2 EQU   TCBFLGS+1                                                01810000
TCBFLGS3 EQU   TCBFLGS+2                                                01811000
TCBFLGS4 EQU   TCBFLGS+3                                                01812000
TCBFLGS5 EQU   TCBFLGS+4                                                01813000
TCBABWF  EQU   TCBFLGS5                                                 01814000
TCBJPQ   EQU   TCB+44                                                   01815000
TCBPURGE EQU   TCBJPQ                                                   01816000
TCBGRS   EQU   TCB+48                                                   01817000
TCBFSA   EQU   TCB+112                                                  01818000
TCBTME   EQU   TCB+120                                                  01819000
TCBJSTCB EQU   TCB+124                                                  01820000
TCBTSFLG EQU   TCB+148                                                  01821000
TCBTSTSK EQU   TCBTSFLG                                                 01822000
TCBSTAB  EQU   TCB+160                                                  01823000
TCBNSTAE EQU   TCBSTAB                                                  01824000
TCBTCT   EQU   TCB+164                                                  01825000
TCBTCTGF EQU   TCBTCT                                                   01826000
TCBSCNDY EQU   TCB+172                                                  01827000
TCBNDSP  EQU   TCBSCNDY                                                 01828000
TCBNDSP1 EQU   TCBNDSP+1                                                01829000
TCBNDSP2 EQU   TCBNDSP+2                                                01830000
TCBNDSP3 EQU   TCBNDSP+3                                                01831000
TCBJSCB  EQU   TCB+180                                                  01832000
TCBRECDE EQU   TCBJSCB                                                  01833000
TCBEXT1  EQU   TCB+196                                                  01834000
TCBBITS  EQU   TCB+200                                                  01835000
TCBNDSP4 EQU   TCBBITS                                                  01836000
TCBNDSP5 EQU   TCBBITS+1                                                01837000
TCBFLGS6 EQU   TCBBITS+2                                                01838000
TCBFLGS7 EQU   TCBBITS+3                                                01839000
TCBDAR   EQU   TCB+204                                                  01840000
TCBDARC  EQU   TCBDAR                                                   01841000
TCBEXT2  EQU   TCB+208                                                  01842000
TCBFOE   EQU   TCB+244                                                  01843000
TCBESTAE EQU   TCB+264                                                  01844000
TCBESTRM EQU   TCBESTAE+1                                               01845000
TCBFBYT1 EQU   TCB+276                                                  01846000
TCBFBYT2 EQU   TCB+277                                                  01847000
TCBRV124 EQU   TCB+278                                                  01848000
TCBRV133 EQU   TCB+279                                                  01849000
TCBXTNT2 EQU   0                                                        01850000
TCBGTF   EQU   TCBXTNT2                                                 01851000
TCBTFLG  EQU   TCBGTF                                                   01852000
TCBRV146 EQU   TCBXTNT2+28                                              01853000
TCBRV155 EQU   TCBXTNT2+29                                              01854000
TCBRV164 EQU   TCBXTNT2+30                                              01855000
TCBRV173 EQU   TCBXTNT2+31                                              01856000
DEVICTYP EQU   0                                                        01857000
VDS1EXT  EQU   0                                                        01858000
VDS1EXTD EQU   VDS1EXT                                                  01859000
VDS1EXTN EQU   VDS1EXT+1                                                01860000
VDS1STCC EQU   VDS1EXT+2                                                01861000
VDS1STHH EQU   VDS1EXT+4                                                01862000
VDS1ECC  EQU   VDS1EXT+6                                                01863000
VDS1EHH  EQU   VDS1EXT+8                                                01864000
IEZJSCB  EQU   0                                                        01865000
JSCBSEC1 EQU   IEZJSCB+188                                              01866000
JSCHPCE  EQU   JSCBSEC1+4                                               01867000
JSCBDCB  EQU   JSCBSEC1+36                                              01868000
JSCBOPTS EQU   JSCBSEC1+48                                              01869000
JSCBSWT1 EQU   JSCBSEC1+55                                              01870000
JSCBWTP  EQU   JSCBSEC1+64                                              01871000
JSCBWTFG EQU   JSCBWTP                                                  01872000
JSCBEND1 EQU   IEZJSCB+260                                              01873000
INFMJFCB EQU   0                                                        01874000
JFCBDSNM EQU   INFMJFCB                                                 01875000
JFCBELNM EQU   INFMJFCB+44                                              01876000
JFCBTSDM EQU   INFMJFCB+52                                              01877000
JFCFCBID EQU   INFMJFCB+56                                              01878000
JFCBFRID EQU   JFCFCBID                                                 01879000
JFCBLTYP EQU   INFMJFCB+66                                              01880000
JFCSUL   EQU   JFCBLTYP                                                 01881000
JFCSL    EQU   JFCBLTYP                                                 01882000
JFCBOTTR EQU   INFMJFCB+67                                              01883000
JFCBUFOF EQU   JFCBOTTR                                                 01884000
JFCBFLSQ EQU   JFCBOTTR+1                                               01885000
JFCFUNC  EQU   JFCBFLSQ                                                 01886000
JFCBMASK EQU   INFMJFCB+72                                              01887000
JFCBFLG1 EQU   JFCBMASK+5                                               01888000
JFCOPEN  EQU   JFCBFLG1                                                 01889000
JFCBFLG2 EQU   JFCBMASK+6                                               01890000
JFCDEFER EQU   JFCBFLG2                                                 01891000
JFCBCRDT EQU   INFMJFCB+80                                              01892000
JFCBXPDT EQU   INFMJFCB+83                                              01893000
JFCBIND1 EQU   INFMJFCB+86                                              01894000
JFCBIND2 EQU   INFMJFCB+87                                              01895000
JFCAMPTR EQU   INFMJFCB+88                                              01896000
JFCBUFRQ EQU   JFCAMPTR                                                 01897000
JFCBUFNO EQU   JFCBUFRQ                                                 01898000
JFCBGNCP EQU   JFCAMPTR+1                                               01899000
JFCBHIAR EQU   JFCBGNCP                                                 01900000
JFCBFALN EQU   JFCBHIAR                                                 01901000
JFCBFTEK EQU   JFCBFALN                                                 01902000
JFCBBFTA EQU   JFCBFTEK                                                 01903000
JFCEROPT EQU   INFMJFCB+92                                              01904000
JFCTRTCH EQU   INFMJFCB+93                                              01905000
VDSCB    EQU   0                                                        01906000
VDSUCB   EQU   VDSCB                                                    01907000
VDSTRKSI EQU   VDSCB+68                                                 01908000
VDSABSTT EQU   VDSCB+72                                                 01909000
VDSNMTRK EQU   VDSCB+74                                                 01910000
VDSDSCB  EQU   VDSCB+80                                                 01911000
UCB      EQU   0                                                        01912000
UCBPTR   EQU   0                                                        01913000
UCBOB    EQU   0                                                        01914000
UCBJBNR  EQU   UCBOB                                                    01915000
UCBFL5   EQU   UCBOB+1                                                  01916000
UCBAF    EQU   UCBFL5                                                   01917000
UCBID    EQU   UCBOB+2                                                  01918000
UCBSTAT  EQU   UCBOB+3                                                  01919000
UCBONLI  EQU   UCBSTAT                                                  01920000
UCBRESV  EQU   UCBSTAT                                                  01921000
UCBALOC  EQU   UCBSTAT                                                  01922000
UCBDADI  EQU   UCBSTAT                                                  01923000
UCBCHAN  EQU   UCBOB+4                                                  01924000
UCBCHA   EQU   UCBCHAN                                                  01925000
UCBUA    EQU   UCBCHAN+1                                                01926000
UCBSFLS  EQU   UCBOB+6                                                  01927000
UCBFLA   EQU   UCBSFLS                                                  01928000
UCBFL1   EQU   UCBFLA                                                   01929000
UCBBSY   EQU   UCBFL1                                                   01930000
UCBNRY   EQU   UCBFL1                                                   01931000
UCBPST   EQU   UCBFL1                                                   01932000
UCBCUB   EQU   UCBFL1                                                   01933000
UCBFLB   EQU   UCBSFLS+1                                                01934000
UCBCHM   EQU   UCBOB+8                                                  01935000
UCBCHM1  EQU   UCBCHM                                                   01936000
UCBPTH0  EQU   UCBCHM1                                                  01937000
UCBPTH1  EQU   UCBCHM1                                                  01938000
UCBWGT   EQU   UCBOB+12                                                 01939000
UCBNAME  EQU   UCBOB+13                                                 01940000
UCBTYP   EQU   UCBOB+16                                                 01941000
UCBTBYT1 EQU   UCBTYP                                                   01942000
UCB1FEA5 EQU   UCBTBYT1                                                 01943000
UCB1FEA6 EQU   UCBTBYT1                                                 01944000
UCBTBYT2 EQU   UCBTYP+1                                                 01945000
UCB2OPT2 EQU   UCBTBYT2                                                 01946000
UCBDUDN1 EQU   UCB2OPT2                                                 01947000
UCB2OPT3 EQU   UCBTBYT2                                                 01948000
UCBDUDN2 EQU   UCB2OPT3                                                 01949000
UCB2OPT4 EQU   UCBTBYT2                                                 01950000
UCBRWTAU EQU   UCB2OPT4                                                 01951000
UCBRVDEV EQU   UCBRWTAU                                                 01952000
UCB2OPT6 EQU   UCBTBYT2                                                 01953000
UCB2OPT7 EQU   UCBTBYT2                                                 01954000
UCBTBYT3 EQU   UCBTYP+2                                                 01955000
UCBDVCLS EQU   UCBTBYT3                                                 01956000
UCBTBYT4 EQU   UCBTYP+3                                                 01957000
UCBEXTPT EQU   UCBOB+20                                                 01958000
UCBFLC   EQU   UCBEXTPT                                                 01959000
UCBDEV   EQU   UCBOB+24                                                 01960000
UCBCMEXT EQU   0                                                        01961000
UCBATI   EQU   UCBCMEXT+3                                               01962000
@NM00021 EQU   UCBATI                                                   01963000
UCBFLP1  EQU   UCBCMEXT+5                                               01964000
UCBMT    EQU   0                                                        01965000
UCBOCR   EQU   0                                                        01966000
UCB3540X EQU   0                                                        01967000
UCBDKBYT EQU   UCB3540X+6                                               01968000
UCB3800X EQU   0                                                        01969000
UCBOPTNS EQU   UCB3800X                                                 01970000
UCBACTIV EQU   UCB3800X+3                                               01971000
UCBMDRBF EQU   UCB3800X+36                                              01972000
UCBUCS   EQU   0                                                        01973000
UCBUCSOP EQU   UCBUCS+4                                                 01974000
UCBFCBOP EQU   UCBUCS+5                                                 01975000
IECSDSF1 EQU   0                                                        01976000
F1PTR    EQU   0                                                        01977000
IECSDSL1 EQU   0                                                        01978000
DS1DSNAM EQU   IECSDSL1                                                 01979000
DS1FMTID EQU   IECSDSL1+44                                              01980000
DS1DSSN  EQU   IECSDSL1+45                                              01981000
DS1VOLSQ EQU   IECSDSL1+51                                              01982000
DS1CREDT EQU   IECSDSL1+53                                              01983000
DS1EXPDT EQU   IECSDSL1+56                                              01984000
DS1NOEPV EQU   IECSDSL1+59                                              01985000
DS1NOBDB EQU   IECSDSL1+60                                              01986000
DS1SYSCD EQU   IECSDSL1+62                                              01987000
DS1DSORG EQU   IECSDSL1+82                                              01988000
DS1RECFM EQU   IECSDSL1+84                                              01989000
DS1OPTCD EQU   IECSDSL1+85                                              01990000
DS1BLKL  EQU   IECSDSL1+86                                              01991000
DS1LRECL EQU   IECSDSL1+88                                              01992000
DS1KEYL  EQU   IECSDSL1+90                                              01993000
DS1RKP   EQU   IECSDSL1+91                                              01994000
DS1SCALO EQU   IECSDSL1+94                                              01995000
DS1LSTAR EQU   IECSDSL1+98                                              01996000
DS1TRBAL EQU   IECSDSL1+101                                             01997000
DS1EXT1  EQU   IECSDSL1+105                                             01998000
DS1EXT2  EQU   IECSDSL1+115                                             01999000
OFFSET   EQU   0                                                        02000000
SYSDEVTB EQU   0                                                        02001000
SCYL     EQU   SYSDEVTB                                                 02002000
STRK     EQU   SYSDEVTB+2                                               02003000
STRKCAP  EQU   SYSDEVTB+4                                               02004000
SRCDO    EQU   SYSDEVTB+6                                               02005000
SIRCDO   EQU   SRCDO                                                    02006000
SLRCDO   EQU   SRCDO+1                                                  02007000
SKEY     EQU   SYSDEVTB+8                                               02008000
SFLAG    EQU   SYSDEVTB+9                                               02009000
SILEQ    EQU   SFLAG                                                    02010000
SFTOLER  EQU   SFLAG                                                    02011000
STOLER   EQU   SYSDEVTB+10                                              02012000
CALLER   EQU   0                                                        02013000
UCBBGN   EQU   0                                                        02014000
AVDSORG  EQU   DS1DSORG                                                 02015000
DS1PDS   EQU   AVDSORG                                                  02016000
AVLSTAR  EQU   DS1LSTAR                                                 02017000
AVLBPTRK EQU   AVLSTAR                                                  02018000
AVLBPRCD EQU   AVLSTAR+2                                                02019000
CVTS01   EQU   CVTPGSIA                                                 02020000
CVTLPDIA EQU   CVTS01+12                                                02021000
CVTDIRST EQU   CVTLPDIA                                                 02022000
CVTSLIDA EQU   CVTS01+24                                                02023000
CVTCTLFG EQU   CVTS01+50                                                02024000
CVTEXPRO EQU   CVTS01+260                                               02025000
CVTRV210 EQU   CVTS01+424                                               02026000
CVTRV219 EQU   CVTS01+425                                               02027000
CVTRV228 EQU   CVTS01+426                                               02028000
CVTRV237 EQU   CVTS01+427                                               02029000
CVTMFRTR EQU   CVTS01+452                                               02030000
CVTRV262 EQU   CVTS01+468                                               02031000
CVTRV271 EQU   CVTS01+469                                               02032000
CVTRV280 EQU   CVTS01+470                                               02033000
CVTRV289 EQU   CVTS01+471                                               02034000
CVTGSDA  EQU   CVTS01+600                                               02035000
AVAMWA   EQU   ADSCBF4                                                  02036000
AVJFCB   EQU   AVAMWA                                                   02037000
AVDEVTYP EQU   AVAMWA+176                                               02038000
AVDEVTBL EQU   AVAMWA+180                                               02039000
AVNUMCYL EQU   AVDEVTBL                                                 02040000
AVNUMTRK EQU   AVDEVTBL+2                                               02041000
AVIRCDO  EQU   AVDEVTBL+4                                               02042000
AVIBT1   EQU   AVIRCDO                                                  02043000
AVIBT2   EQU   AVIRCDO+1                                                02044000
AVLRCDO  EQU   AVDEVTBL+6                                               02045000
AVLBT1   EQU   AVLRCDO                                                  02046000
AVLBT2   EQU   AVLRCDO+1                                                02047000
AVKEYCON EQU   AVDEVTBL+8                                               02048000
AVFLAGS  EQU   AVDEVTBL+9                                               02049000
AVTOLER  EQU   AVDEVTBL+10                                              02050000
SAV14B   EQU   AVAMWA+192                                               02051000
SAV14C   EQU   AVAMWA+196                                               02052000
SAV14D   EQU   AVAMWA+200                                               02053000
SAV14E   EQU   AVAMWA+204                                               02054000
AVCYLST  EQU   AVAMWA+208                                               02055000
AVHEADST EQU   AVAMWA+210                                               02056000
AVABSTRK EQU   AVAMWA+212                                               02057000
AVLDBBYT EQU   AVAMWA+214                                               02058000
AVDBBYTS EQU   AVAMWA+216                                               02059000
AVFULTRK EQU   AVAMWA+220                                               02060000
AVDIRNF  EQU   AVAMWA+224                                               02061000
AVTRKPRI EQU   AVAMWA+228                                               02062000
AVNODSTK EQU   AVAMWA+232                                               02063000
AVABLLRB EQU   AVAMWA+236                                               02064000
AVABLRB  EQU   AVAMWA+240                                               02065000
AVABLRTK EQU   AVAMWA+244                                               02066000
AVABLPRT EQU   AVAMWA+248                                               02067000
AVBLKSNF EQU   AVAMWA+252                                               02068000
AVNLBYTS EQU   AVAMWA+256                                               02069000
AVVOLTRK EQU   AVAMWA+260                                               02070000
AVAVAILT EQU   AVAMWA+262                                               02071000
AVULABST EQU   AVAMWA+264                                               02072000
AVABSLTA EQU   AVAMWA+266                                               02073000
AVABLMXT EQU   AVAMWA+268                                               02074000
AVDTI    EQU   AVAMWA+270                                               02075000
AVTRKCAP EQU   VDSTRKSI                                                 02076000
AVDIRBT  EQU   AVLDBBYT                                                 02077000
TRKBALNC EQU   DS1TRBAL                                                 02078000
AVLBPTBA EQU   TRKBALNC                                                 02079000
AVLBPTRB EQU   AVLBPTBA                                                 02080000
AVABLSTK EQU   AVNLBYTS                                                 02081000
AVABLPRI EQU   AVABLLRB                                                 02082000
AVABLSEC EQU   AVABLRTK                                                 02083000
JSCBSEC2 EQU   JSCBEND1                                                 02084000
JSCBSEC3 EQU   JSCBEND1                                                 02085000
JSCBJCT  EQU   JSCBSEC3                                                 02086000
JSCBJCTA EQU   JSCBJCT+1                                                02087000
JSCBASID EQU   JSCBSEC3+8                                               02088000
JSCBFBYT EQU   JSCBSEC3+10                                              02089000
JSCBJNL  EQU   JSCBSEC3+28                                              02090000
JSCBJJSB EQU   JSCBJNL                                                  02091000
JSCBSUB  EQU   JSCBSEC3+40                                              02092000
JSCSCT   EQU   JSCBSEC3+68                                              02093000
JSCBSWSP EQU   JSCBSEC3+87                                              02094000
JSCBACT  EQU   JSCBSEC3+88                                              02095000
JSCRSV45 EQU   JSCBSEC3+112                                             02096000
JSCRSV46 EQU   JSCRSV45                                                 02097000
JSCRSV47 EQU   JSCRSV45+2                                               02098000
JFCKEYLE EQU   JFCTRTCH                                                 02099000
JFCCODE  EQU   JFCKEYLE                                                 02100000
JFCSTACK EQU   JFCTRTCH                                                 02101000
JFCMODE  EQU   JFCSTACK                                                 02102000
JFCSPPRT EQU   JFCTRTCH                                                 02103000
JFCBABFS EQU   JFCSPPRT+2                                               02104000
JFCLIMCT EQU   JFCBABFS                                                 02105000
JFCDSORG EQU   JFCSPPRT+5                                               02106000
JFCDSRG1 EQU   JFCDSORG                                                 02107000
JFCDSRG2 EQU   JFCDSORG+1                                               02108000
JFCRECFM EQU   JFCSPPRT+7                                               02109000
JFCRCFM  EQU   JFCRECFM                                                 02110000
JFCOPTCD EQU   JFCSPPRT+8                                               02111000
JFCWVCSP EQU   JFCOPTCD                                                 02112000
JFCWVCIS EQU   JFCWVCSP                                                 02113000
JFCWVCBD EQU   JFCWVCIS                                                 02114000
JFCALLOW EQU   JFCOPTCD                                                 02115000
JFCRSV17 EQU   JFCALLOW                                                 02116000
JFCOVER  EQU   JFCRSV17                                                 02117000
JFCPCIBT EQU   JFCOPTCD                                                 02118000
JFCMAST  EQU   JFCPCIBT                                                 02119000
JFCEXT   EQU   JFCMAST                                                  02120000
JFCBCKPT EQU   JFCOPTCD                                                 02121000
JFCIND   EQU   JFCBCKPT                                                 02122000
JFCRSV18 EQU   JFCOPTCD                                                 02123000
JFCCYL   EQU   JFCRSV18                                                 02124000
JFCACT   EQU   JFCCYL                                                   02125000
JFCREDUC EQU   JFCOPTCD                                                 02126000
JFCRSV19 EQU   JFCREDUC                                                 02127000
JFCRSV20 EQU   JFCRSV19                                                 02128000
JFCRSV21 EQU   JFCOPTCD                                                 02129000
JFCDEL   EQU   JFCRSV21                                                 02130000
JFCOPTJ  EQU   JFCOPTCD                                                 02131000
JFCREORG EQU   JFCOPTJ                                                  02132000
JFCBLKSI EQU   JFCSPPRT+9                                               02133000
JFCBUFSI EQU   JFCBLKSI                                                 02134000
JFCAMSYN EQU   JFCSPPRT+11                                              02135000
JFCLRECL EQU   JFCAMSYN                                                 02136000
JFCNCP   EQU   JFCAMSYN+2                                               02137000
JFCNTM   EQU   JFCAMSYN+3                                               02138000
JFCBFSEQ EQU   JFCNTM                                                   02139000
JFCPCI   EQU   JFCBFSEQ                                                 02140000
JFCRESRV EQU   JFCAMSYN+4                                               02141000
JFCRKP   EQU   JFCRESRV                                                 02142000
JFCUCSEG EQU   JFCRESRV                                                 02143000
JFCUCSOP EQU   JFCUCSEG+4                                               02144000
JFCOUTLI EQU   JFCUCSEG+5                                               02145000
JFCTHRSH EQU   JFCOUTLI                                                 02146000
JFCCPRI  EQU   JFCTHRSH                                                 02147000
JFCBVOLS EQU   JFCUCSEG+10                                              02148000
JFCBS001 EQU   JFCBVOLS                                                 02149000
JFCBPQTY EQU   JFCBS001+34                                              02150000
JFCBCTRI EQU   JFCBS001+37                                              02151000
JFCBSPAC EQU   JFCBCTRI                                                 02152000
JFCMIXG  EQU   JFCBCTRI                                                 02153000
JFCALX   EQU   JFCBCTRI                                                 02154000
JFCROUND EQU   JFCBCTRI                                                 02155000
JFCBSQTY EQU   JFCBS001+38                                              02156000
JFCFLGS1 EQU   JFCBS001+41                                              02157000
JFCBDQTY EQU   JFCBS001+42                                              02158000
JFCBABST EQU   JFCBS001+48                                              02159000
JFCBDRLH EQU   JFCBS001+53                                              02160000
UCBOBS01 EQU   UCBDEV                                                   02161000
UCBVOLI  EQU   UCBOBS01+4                                               02162000
UCBSTAB  EQU   UCBOBS01+10                                              02163000
UCBBSVL  EQU   UCBSTAB                                                  02164000
UCBPRSRS EQU   UCBSTAB                                                  02165000
UCBBPRV  EQU   UCBSTAB                                                  02166000
UCBDMCT  EQU   UCBOBS01+11                                              02167000
UCBFL4   EQU   UCBOBS01+13                                              02168000
UCBOBS02 EQU   UCBDEV                                                   02169000
UCBTFL1  EQU   UCBOBS02+19                                              02170000
UCBXTN   EQU   UCBOBS02+20                                              02171000
UCBVOPT  EQU   UCBXTN                                                   02172000
UCBOBS03 EQU   UCBDEV                                                   02173000
UCBXTADR EQU   UCBOBS03                                                 02174000
UCBOBS04 EQU   UCBDEV                                                   02175000
UCBBTA   EQU   UCBOBS04+12                                              02176000
UCBOBS06 EQU   UCBDEV                                                   02177000
UCBAOF   EQU   UCBOBS06                                                 02178000
UCBAOF1  EQU   UCBAOF                                                   02179000
UCBAOF2  EQU   UCBAOF+1                                                 02180000
@NM00020 EQU   UCBOBS06+3                                               02181000
UCBIRB   EQU   UCBOBS06+4                                               02182000
UCBGRAF  EQU   UCBIRB                                                   02183000
UCBLDNCA EQU   UCBOBS06+8                                               02184000
UCBRDYQ  EQU   UCBLDNCA                                                 02185000
UCBIRLN  EQU   UCBRDYQ                                                  02186000
UCBLDNCB EQU   UCBRDYQ+1                                                02187000
UCBCTLNK EQU   UCBOBS06+12                                              02188000
UCBOBS07 EQU   UCBDEV                                                   02189000
UCBOBS08 EQU   UCBDEV                                                   02190000
UCBCTCAD EQU   UCBOBS08                                                 02191000
UCBCTCF1 EQU   UCBOBS08+4                                               02192000
UCBOBS09 EQU   UCBDEV                                                   02193000
DUMYJFCB EQU   INFMJFCB                                                 02194000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    02195000
UCBRV066 EQU   UCBOBS09+4                                               02196000
UCBIOSBA EQU   UCBOBS09                                                 02197000
UCBRV042 EQU   UCBOBS08+5                                               02198000
UCBRV082 EQU   UCBCTCF1                                                 02199000
UCBRV081 EQU   UCBCTCF1                                                 02200000
UCBRV080 EQU   UCBCTCF1                                                 02201000
UCBRV079 EQU   UCBCTCF1                                                 02202000
UCBRV078 EQU   UCBCTCF1                                                 02203000
UCBRV077 EQU   UCBCTCF1                                                 02204000
UCBRV076 EQU   UCBCTCF1                                                 02205000
UCBCTC80 EQU   UCBCTCF1                                                 02206000
UCBCTCAL EQU   UCBCTCAD                                                 02207000
UCBICNCB EQU   UCBOBS07+4                                               02208000
UCBRV040 EQU   UCBOBS07                                                 02209000
UCBCTLNA EQU   UCBCTLNK+1                                               02210000
UCBRLN   EQU   UCBCTLNK                                                 02211000
UCBRDYQA EQU   UCBLDNCB                                                 02212000
UCBINRLN EQU   UCBIRLN                                                  02213000
UCBIRBA  EQU   UCBIRB+1                                                 02214000
UCBRV039 EQU   UCBGRAF                                                  02215000
UCBDWNR  EQU   UCBGRAF                                                  02216000
UCBRPND  EQU   UCBGRAF                                                  02217000
UCBUPM   EQU   UCBGRAF                                                  02218000
UCBBTAM  EQU   UCBGRAF                                                  02219000
UCBDRNO  EQU   UCBGRAF                                                  02220000
UCBDRO   EQU   UCBGRAF                                                  02221000
UCBOIP   EQU   UCBGRAF                                                  02222000
UCBATRCD EQU   @NM00020                                                 02223000
UCBSKPFG EQU   @NM00020                                                 02224000
UCBRIPND EQU   @NM00020                                                 02225000
UCBRTIAC EQU   @NM00020                                                 02226000
UCBRSV79 EQU   @NM00020                                                 02227000
UCBRSV78 EQU   @NM00020                                                 02228000
UCBRSV77 EQU   @NM00020                                                 02229000
UCBOLTEP EQU   @NM00020                                                 02230000
UCBATNCT EQU   UCBOBS06+2                                               02231000
UCBRSV76 EQU   UCBAOF2                                                  02232000
UCBRSV75 EQU   UCBAOF2                                                  02233000
UCBRSV74 EQU   UCBAOF2                                                  02234000
UCBRSV73 EQU   UCBAOF2                                                  02235000
UCBRSV72 EQU   UCBAOF2                                                  02236000
UCBRSV71 EQU   UCBAOF2                                                  02237000
UCBRSV70 EQU   UCBAOF2                                                  02238000
UCBRSV69 EQU   UCBAOF2                                                  02239000
UCBRSV68 EQU   UCBAOF1                                                  02240000
UCBRSV67 EQU   UCBAOF1                                                  02241000
UCBRSV66 EQU   UCBAOF1                                                  02242000
UCBRSV65 EQU   UCBAOF1                                                  02243000
UCBRSV64 EQU   UCBAOF1                                                  02244000
UCBOFNL  EQU   UCBAOF1                                                  02245000
UCBOFSP  EQU   UCBAOF1                                                  02246000
UCBOFMCR EQU   UCBAOF1                                                  02247000
UCBBTB   EQU   UCBBTA+1                                                 02248000
UCBDI    EQU   UCBBTA                                                   02249000
UCBSNS   EQU   UCBOBS04+8                                               02250000
UCBTEB   EQU   UCBOBS04+4                                               02251000
UCBGCB   EQU   UCBOBS04+3                                               02252000
UCBOPEN  EQU   UCBOBS04+2                                               02253000
UCBSTART EQU   UCBOBS04                                                 02254000
UCBXTNB  EQU   UCBXTN+1                                                 02255000
UCBRSV22 EQU   UCBVOPT                                                  02256000
UCBRSV21 EQU   UCBVOPT                                                  02257000
UCBRSV20 EQU   UCBVOPT                                                  02258000
UCBESVE  EQU   UCBVOPT                                                  02259000
UCBERPC  EQU   UCBVOPT                                                  02260000
UCBESVC  EQU   UCBVOPT                                                  02261000
UCBEVA   EQU   UCBVOPT                                                  02262000
UCBESV   EQU   UCBVOPT                                                  02263000
UCBRV009 EQU   UCBTFL1                                                  02264000
UCBRV008 EQU   UCBTFL1                                                  02265000
UCBRV007 EQU   UCBTFL1                                                  02266000
UCBRV006 EQU   UCBTFL1                                                  02267000
UCBRV005 EQU   UCBTFL1                                                  02268000
UCBRV038 EQU   UCBTFL1                                                  02269000
UCBNSLTP EQU   UCBTFL1                                                  02270000
UCBNLTP  EQU   UCBTFL1                                                  02271000
UCBRES1B EQU   UCBOBS02+18                                              02272000
UCBFSER  EQU   UCBOBS02+12                                              02273000
@NM00019 EQU   UCBOBS02+4                                               02274000
UCBFSEQ  EQU   UCBOBS02+2                                               02275000
UCBFSCT  EQU   UCBOBS02                                                 02276000
UCBNEXP  EQU   UCBOBS01+20                                              02277000
UCBBASE  EQU   UCBOBS01+16                                              02278000
UCBRES1A EQU   UCBOBS01+15                                              02279000
UCBUSER  EQU   UCBOBS01+14                                              02280000
UCBFL47  EQU   UCBFL4                                                   02281000
UCBFL46  EQU   UCBFL4                                                   02282000
UCBFL45  EQU   UCBFL4                                                   02283000
UCBRV065 EQU   UCBFL4                                                   02284000
UCBDSS   EQU   UCBFL4                                                   02285000
UCBRESVP EQU   UCBFL4                                                   02286000
UCBWDAV  EQU   UCBFL4                                                   02287000
UCBDAVV  EQU   UCBFL4                                                   02288000
UCBSQC   EQU   UCBOBS01+12                                              02289000
UCBDATP  EQU   UCBOBS01+12                                              02290000
UCBDMC   EQU   UCBDMCT                                                  02291000
UCBMOUNT EQU   UCBDMCT                                                  02292000
UCBBNUL  EQU   UCBSTAB                                                  02293000
UCBSHAR  EQU   UCBSTAB                                                  02294000
UCBBSTR  EQU   UCBSTAB                                                  02295000
UCBBPUB  EQU   UCBSTAB                                                  02296000
UCBBALB  EQU   UCBPRSRS                                                 02297000
UCBPGFL  EQU   UCBSTAB                                                  02298000
UCBDVSHR EQU   UCBBSVL                                                  02299000
UCBVTOC  EQU   UCBOBS01                                                 02300000
JFCBEND  EQU   JFCBS001+58                                              02301000
JFCBSPTN EQU   JFCBS001+57                                              02302000
JFCBVLCT EQU   JFCBS001+56                                              02303000
JFCBSBNM EQU   JFCBS001+50                                              02304000
JFCBSPNM EQU   JFCBS001+45                                              02305000
JFCBUAFF EQU   JFCFLGS1                                                 02306000
JFCRSV45 EQU   JFCFLGS1                                                 02307000
JFCVRDS  EQU   JFCFLGS1                                                 02308000
JFCBCEOV EQU   JFCFLGS1                                                 02309000
JFCRSV42 EQU   JFCFLGS1                                                 02310000
JFCBADSP EQU   JFCFLGS1                                                 02311000
JFCTOPEN EQU   JFCFLGS1                                                 02312000
JFCBDLET EQU   JFCFLGS1                                                 02313000
JFCRQID  EQU   JFCBSQTY                                                 02314000
JFCONTIG EQU   JFCBCTRI                                                 02315000
JFCRSV29 EQU   JFCBCTRI                                                 02316000
JFCBMSGP EQU   JFCBCTRI                                                 02317000
JFCRUNIT EQU   JFCBPQTY                                                 02318000
JFCBEXAD EQU   JFCBS001+31                                              02319000
JFCBEXTL EQU   JFCBS001+30                                              02320000
JFCMSVGP EQU   JFCBS001+22                                              02321000
@NM00017 EQU   JFCBS001                                                 02322000
JFCAVOLS EQU   JFCBVOLS                                                 02323000
JFCBNVOL EQU   JFCUCSEG+9                                               02324000
JFCBNTCS EQU   JFCUCSEG+8                                               02325000
JFCSOWA  EQU   JFCOUTLI+1                                               02326000
JFCSEND  EQU   JFCCPRI                                                  02327000
JFCEQUAL EQU   JFCCPRI                                                  02328000
JFCRECV  EQU   JFCCPRI                                                  02329000
JFCRSV34 EQU   JFCCPRI                                                  02330000
JFCRSV33 EQU   JFCCPRI                                                  02331000
JFCRSV55 EQU   JFCCPRI                                                  02332000
JFCRSV54 EQU   JFCCPRI                                                  02333000
JFCRSV53 EQU   JFCCPRI                                                  02334000
JFCRSV27 EQU   JFCUCSOP                                                 02335000
JFCRSV26 EQU   JFCUCSOP                                                 02336000
JFCFCBVR EQU   JFCUCSOP                                                 02337000
JFCFCBAL EQU   JFCUCSOP                                                 02338000
JFCVER   EQU   JFCUCSOP                                                 02339000
JFCRSV25 EQU   JFCUCSOP                                                 02340000
JFCFOLD  EQU   JFCUCSOP                                                 02341000
JFCBEXTP EQU   JFCUCSOP                                                 02342000
JFCUCSID EQU   JFCUCSEG                                                 02343000
JFCINTVL EQU   JFCSPPRT+19                                              02344000
JFCDBUFN EQU   JFCRESRV+3                                               02345000
JFCCYLOF EQU   JFCRESRV+2                                               02346000
JFCPCIR2 EQU   JFCPCI                                                   02347000
JFCPCIR1 EQU   JFCPCI                                                   02348000
JFCPCIN2 EQU   JFCPCI                                                   02349000
JFCPCIN1 EQU   JFCPCI                                                   02350000
JFCPCIA2 EQU   JFCPCI                                                   02351000
JFCPCIA1 EQU   JFCPCI                                                   02352000
JFCPCIX2 EQU   JFCPCI                                                   02353000
JFCPCIX1 EQU   JFCPCI                                                   02354000
JFCBUFMX EQU   JFCNCP                                                   02355000
JFCBAXBF EQU   JFCBUFSI                                                 02356000
JFCREL   EQU   JFCREORG                                                 02357000
JFCRSV22 EQU   JFCDEL                                                   02358000
JFCSRCHD EQU   JFCRSV20                                                 02359000
JFCOPTQ  EQU   JFCACT                                                   02360000
JFCFEED  EQU   JFCIND                                                   02361000
JFCCBWU  EQU   JFCEXT                                                   02362000
JFCWUMSG EQU   JFCOVER                                                  02363000
JFCSDNAM EQU   JFCWVCBD                                                 02364000
@NM00016 EQU   JFCRECFM                                                 02365000
JFCCHAR  EQU   JFCRECFM                                                 02366000
JFCRFS   EQU   JFCRECFM                                                 02367000
JFCRFB   EQU   JFCRECFM                                                 02368000
JFCRFO   EQU   JFCRCFM                                                  02369000
JFCFMREC EQU   JFCRCFM                                                  02370000
JFCRSV16 EQU   JFCDSRG2                                                 02371000
JFCRSV15 EQU   JFCDSRG2                                                 02372000
JFCORGTR EQU   JFCDSRG2                                                 02373000
JFCORGAM EQU   JFCDSRG2                                                 02374000
JFCRSV13 EQU   JFCDSRG2                                                 02375000
JFCORGTQ EQU   JFCDSRG2                                                 02376000
JFCORGTX EQU   JFCDSRG2                                                 02377000
JFCORGGS EQU   JFCDSRG2                                                 02378000
JFCORGU  EQU   JFCDSRG1                                                 02379000
JFCORGPO EQU   JFCDSRG1                                                 02380000
JFCORGMQ EQU   JFCDSRG1                                                 02381000
JFCORGCQ EQU   JFCDSRG1                                                 02382000
JFCORGCX EQU   JFCDSRG1                                                 02383000
JFCORGDA EQU   JFCDSRG1                                                 02384000
JFCORGPS EQU   JFCDSRG1                                                 02385000
JFCORGIS EQU   JFCDSRG1                                                 02386000
JFCTRKBL EQU   JFCLIMCT+1                                               02387000
@NM00015 EQU   JFCLIMCT                                                 02388000
JFCDEN   EQU   JFCSPPRT+1                                               02389000
JFCPRTSP EQU   JFCSPPRT                                                 02390000
JFCONE   EQU   JFCMODE                                                  02391000
JFCTWO   EQU   JFCMODE                                                  02392000
JFCRSV07 EQU   JFCMODE                                                  02393000
JFCRSV06 EQU   JFCMODE                                                  02394000
JFCMODER EQU   JFCMODE                                                  02395000
JFCMODEO EQU   JFCMODE                                                  02396000
JFCEBCD  EQU   JFCMODE                                                  02397000
JFCBIN   EQU   JFCMODE                                                  02398000
JFCRSV32 EQU   JFCCODE                                                  02399000
JFCTTY   EQU   JFCCODE                                                  02400000
JFCASCII EQU   JFCCODE                                                  02401000
JFCNCR   EQU   JFCCODE                                                  02402000
JFCBUR   EQU   JFCCODE                                                  02403000
JFCFRI   EQU   JFCCODE                                                  02404000
JFCBCD   EQU   JFCCODE                                                  02405000
JFCNOCON EQU   JFCCODE                                                  02406000
JSCBEND3 EQU   JSCBSEC3+120                                             02407000
JSCRSV52 EQU   JSCBSEC3+116                                             02408000
JSCRSV51 EQU   JSCRSV47+1                                               02409000
JSCRSV50 EQU   JSCRSV47                                                 02410000
JSCRSV49 EQU   JSCRSV46+1                                               02411000
JSCRSV48 EQU   JSCRSV46                                                 02412000
JSCRSV44 EQU   JSCBSEC3+108                                             02413000
JSCRSV43 EQU   JSCBSEC3+104                                             02414000
JSCRSV42 EQU   JSCBSEC3+100                                             02415000
JSCBASWA EQU   JSCBSEC3+96                                              02416000
JSCBUFPT EQU   JSCBSEC3+92                                              02417000
JSCRSV33 EQU   JSCBSEC3+86                                              02418000
JSCDDNUM EQU   JSCBSEC3+84                                              02419000
JSCRSV53 EQU   JSCBSEC3+82                                              02420000
JSCDDNNO EQU   JSCBSEC3+80                                              02421000
JSCBVATA EQU   JSCBSEC3+76                                              02422000
JSCTMCOR EQU   JSCBSEC3+72                                              02423000
JSCSCTP  EQU   JSCSCT+1                                                 02424000
JSCRSV55 EQU   JSCSCT                                                   02425000
JSCRSV54 EQU   JSCBSEC3+64                                              02426000
JSCDSABQ EQU   JSCBSEC3+60                                              02427000
JSCBSSIB EQU   JSCBSEC3+56                                              02428000
JSCBFRBA EQU   JSCBSEC3+48                                              02429000
JSCRSV28 EQU   JSCBSEC3+46                                              02430000
JSCBSONO EQU   JSCBSEC3+44                                              02431000
JSCBSUBA EQU   JSCBSUB+1                                                02432000
JSCRSV31 EQU   JSCBSUB                                                  02433000
JSCBSMLR EQU   JSCBSEC3+36                                              02434000
JSCBJNLR EQU   JSCBSEC3+32                                              02435000
JSCBJNLA EQU   JSCBJNL+1                                                02436000
JSCBJSBT EQU   JSCBJJSB                                                 02437000
JSCBJSBX EQU   JSCBJJSB                                                 02438000
JSCBJSBA EQU   JSCBJJSB                                                 02439000
JSCBJSBI EQU   JSCBJJSB                                                 02440000
@NM00013 EQU   JSCBJJSB                                                 02441000
JSCBJNLE EQU   JSCBJJSB                                                 02442000
JSCBJNLF EQU   JSCBJJSB                                                 02443000
JSCBJNLN EQU   JSCBJJSB                                                 02444000
@NM00012 EQU   JSCBSEC3+24                                              02445000
JSCBJRBA EQU   JSCBSEC3+16                                              02446000
JSCBIECB EQU   JSCBSEC3+12                                              02447000
JSCBRV08 EQU   JSCBSEC3+11                                              02448000
JSCBRV07 EQU   JSCBFBYT                                                 02449000
JSCBRV06 EQU   JSCBFBYT                                                 02450000
JSCBRV05 EQU   JSCBFBYT                                                 02451000
JSCBRV04 EQU   JSCBFBYT                                                 02452000
JSCBRV03 EQU   JSCBFBYT                                                 02453000
JSCBRV02 EQU   JSCBFBYT                                                 02454000
JSCBADSP EQU   JSCBFBYT                                                 02455000
JSCBRV01 EQU   JSCBFBYT                                                 02456000
JSCBTJID EQU   JSCBASID                                                 02457000
JSCBPSCB EQU   JSCBSEC3+4                                               02458000
JSCJCTP  EQU   JSCBJCTA                                                 02459000
JSCRSV24 EQU   JSCBJCT                                                  02460000
JSCBEND2 EQU   JSCBSEC2                                                 02461000
AVFILR   EQU   AVFLAGS                                                  02462000
@NM00009 EQU   AVFLAGS                                                  02463000
CVTRV628 EQU   CVTS01+728                                               02464000
CVTRV627 EQU   CVTS01+724                                               02465000
CVTRV626 EQU   CVTS01+720                                               02466000
CVTRV625 EQU   CVTS01+716                                               02467000
CVTRV624 EQU   CVTS01+712                                               02468000
CVTRV623 EQU   CVTS01+708                                               02469000
CVTRV622 EQU   CVTS01+704                                               02470000
CVTRV621 EQU   CVTS01+700                                               02471000
CVTIHASU EQU   CVTS01+696                                               02472000
CVTRV619 EQU   CVTS01+692                                               02473000
CVTRV618 EQU   CVTS01+688                                               02474000
CVTRV617 EQU   CVTS01+684                                               02475000
CVTRV616 EQU   CVTS01+680                                               02476000
CVTRV615 EQU   CVTS01+676                                               02477000
CVTRV614 EQU   CVTS01+672                                               02478000
CVTRV613 EQU   CVTS01+668                                               02479000
CVTTCASP EQU   CVTS01+664                                               02480000
CVT0PT03 EQU   CVTS01+660                                               02481000
CVT0PT0E EQU   CVTS01+656                                               02482000
CVTRV609 EQU   CVTS01+652                                               02483000
CVTCGK   EQU   CVTS01+648                                               02484000
CVTRAC   EQU   CVTS01+644                                               02485000
CVTRV606 EQU   CVTS01+640                                               02486000
CVTRV605 EQU   CVTS01+636                                               02487000
CVTRV604 EQU   CVTS01+632                                               02488000
CVTEFF02 EQU   CVTS01+628                                               02489000
CVTCBBR  EQU   CVTS01+624                                               02490000
CVTSSCR  EQU   CVTS01+620                                               02491000
CVTEVENT EQU   CVTS01+616                                               02492000
CVTCRCA  EQU   CVTS01+612                                               02493000
CVTTPIO  EQU   CVTS01+608                                               02494000
CVTADV   EQU   CVTS01+604                                               02495000
CVTGSDAB EQU   CVTGSDA                                                  02496000
CVTQV3   EQU   CVTS01+596                                               02497000
CVTQV2   EQU   CVTS01+592                                               02498000
CVTQV1   EQU   CVTS01+588                                               02499000
CVTRPT   EQU   CVTS01+584                                               02500000
CVTSSRB  EQU   CVTS01+580                                               02501000
CVTCSDRL EQU   CVTS01+576                                               02502000
CVTEXP1  EQU   CVTS01+572                                               02503000
CVTRMPMT EQU   CVTS01+568                                               02504000
CVTRMPTT EQU   CVTS01+564                                               02505000
CVTVPSA  EQU   CVTS01+560                                               02506000
CVTVSTOP EQU   CVTS01+556                                               02507000
CVTGTFR8 EQU   CVTS01+552                                               02508000
CVTQUIT  EQU   CVTS01+548                                               02509000
CVTVACR  EQU   CVTS01+544                                               02510000
CVTWTCB  EQU   CVTS01+540                                               02511000
CVTSTPRS EQU   CVTS01+536                                               02512000
CVT0PT02 EQU   CVTS01+532                                               02513000
CVTDARCM EQU   CVTS01+528                                               02514000
CVTIRECM EQU   CVTS01+524                                               02515000
CVTJRECM EQU   CVTS01+520                                               02516000
CVTVEMS0 EQU   CVTS01+516                                               02517000
CVTSPFRR EQU   CVTS01+512                                               02518000
CVTRLSTG EQU   CVTS01+508                                               02519000
CVT0TC0A EQU   CVTS01+504                                               02520000
CVTGMBR  EQU   CVTS01+500                                               02521000
CVTLFRM  EQU   CVTS01+496                                               02522000
CVTRMBR  EQU   CVTS01+492                                               02523000
CVTVIOP  EQU   CVTS01+488                                               02524000
CVTRV307 EQU   CVTS01+486                                               02525000
CVTRV306 EQU   CVTS01+484                                               02526000
CVTRV305 EQU   CVTS01+482                                               02527000
CVTRV304 EQU   CVTS01+480                                               02528000
CVTRV303 EQU   CVTS01+478                                               02529000
CVTRV302 EQU   CVTS01+476                                               02530000
CVTTRCA  EQU   CVTS01+472                                               02531000
CVTRV297 EQU   CVTRV289                                                 02532000
CVTRV296 EQU   CVTRV289                                                 02533000
CVTRV295 EQU   CVTRV289                                                 02534000
CVTRV294 EQU   CVTRV289                                                 02535000
CVTRV293 EQU   CVTRV289                                                 02536000
CVTRV292 EQU   CVTRV289                                                 02537000
CVTRV291 EQU   CVTRV289                                                 02538000
CVTRV290 EQU   CVTRV289                                                 02539000
CVTRV288 EQU   CVTRV280                                                 02540000
CVTRV287 EQU   CVTRV280                                                 02541000
CVTRV286 EQU   CVTRV280                                                 02542000
CVTRV285 EQU   CVTRV280                                                 02543000
CVTRV284 EQU   CVTRV280                                                 02544000
CVTRV283 EQU   CVTRV280                                                 02545000
CVTRV282 EQU   CVTRV280                                                 02546000
CVTRV281 EQU   CVTRV280                                                 02547000
CVTRV279 EQU   CVTRV271                                                 02548000
CVTRV278 EQU   CVTRV271                                                 02549000
CVTRV277 EQU   CVTRV271                                                 02550000
CVTRV276 EQU   CVTRV271                                                 02551000
CVTRV275 EQU   CVTRV271                                                 02552000
CVTRV274 EQU   CVTRV271                                                 02553000
CVTRV273 EQU   CVTRV271                                                 02554000
CVTRV272 EQU   CVTRV271                                                 02555000
CVTRV270 EQU   CVTRV262                                                 02556000
CVTRV269 EQU   CVTRV262                                                 02557000
CVTRV268 EQU   CVTRV262                                                 02558000
CVTRV267 EQU   CVTRV262                                                 02559000
CVTRV266 EQU   CVTRV262                                                 02560000
CVTRV265 EQU   CVTRV262                                                 02561000
CVTRV264 EQU   CVTRV262                                                 02562000
CVTRV263 EQU   CVTRV262                                                 02563000
CVTVFP   EQU   CVTS01+464                                               02564000
CVTVSI   EQU   CVTS01+460                                               02565000
CVTVPSIB EQU   CVTS01+456                                               02566000
CVTMFACT EQU   CVTMFRTR                                                 02567000
CVTMFCTL EQU   CVTS01+448                                               02568000
CVTPVBP  EQU   CVTS01+444                                               02569000
CVTPWI   EQU   CVTS01+440                                               02570000
CVTRV254 EQU   CVTS01+438                                               02571000
CVTRV253 EQU   CVTS01+436                                               02572000
CVTRV252 EQU   CVTS01+434                                               02573000
CVTRV251 EQU   CVTS01+433                                               02574000
CVTRV250 EQU   CVTS01+432                                               02575000
CVTRV249 EQU   CVTS01+431                                               02576000
CVTRV248 EQU   CVTS01+430                                               02577000
CVTRV247 EQU   CVTS01+429                                               02578000
CVTRV246 EQU   CVTS01+428                                               02579000
CVTRV245 EQU   CVTRV237                                                 02580000
CVTRV244 EQU   CVTRV237                                                 02581000
CVTRV243 EQU   CVTRV237                                                 02582000
CVTRV242 EQU   CVTRV237                                                 02583000
CVTRV241 EQU   CVTRV237                                                 02584000
CVTRV240 EQU   CVTRV237                                                 02585000
CVTRV239 EQU   CVTRV237                                                 02586000
CVTRV238 EQU   CVTRV237                                                 02587000
CVTRV236 EQU   CVTRV228                                                 02588000
CVTRV235 EQU   CVTRV228                                                 02589000
CVTRV234 EQU   CVTRV228                                                 02590000
CVTRV233 EQU   CVTRV228                                                 02591000
CVTRV232 EQU   CVTRV228                                                 02592000
CVTRV231 EQU   CVTRV228                                                 02593000
CVTRV230 EQU   CVTRV228                                                 02594000
CVTRV229 EQU   CVTRV228                                                 02595000
CVTRV227 EQU   CVTRV219                                                 02596000
CVTRV226 EQU   CVTRV219                                                 02597000
CVTRV225 EQU   CVTRV219                                                 02598000
CVTRV224 EQU   CVTRV219                                                 02599000
CVTRV223 EQU   CVTRV219                                                 02600000
CVTRV222 EQU   CVTRV219                                                 02601000
CVTRV221 EQU   CVTRV219                                                 02602000
CVTRV220 EQU   CVTRV219                                                 02603000
CVTRV218 EQU   CVTRV210                                                 02604000
CVTRV217 EQU   CVTRV210                                                 02605000
CVTRV216 EQU   CVTRV210                                                 02606000
CVTRV215 EQU   CVTRV210                                                 02607000
CVTRV214 EQU   CVTRV210                                                 02608000
CVTRV213 EQU   CVTRV210                                                 02609000
CVTRV212 EQU   CVTRV210                                                 02610000
CVTRV211 EQU   CVTRV210                                                 02611000
CVTLCCAT EQU   CVTS01+420                                               02612000
CVTPCCAT EQU   CVTS01+416                                               02613000
CVTIPCRP EQU   CVTS01+412                                               02614000
CVTIPCRI EQU   CVTS01+408                                               02615000
CVTIPCDS EQU   CVTS01+404                                               02616000
CVTAIDVT EQU   CVTS01+400                                               02617000
CVTSSAP  EQU   CVTS01+396                                               02618000
CVTEHCIR EQU   CVTS01+392                                               02619000
CVTEHDEF EQU   CVTS01+388                                               02620000
CVTDAIR  EQU   CVTS01+384                                               02621000
CVTPERFM EQU   CVTS01+380                                               02622000
CVT044R2 EQU   CVTS01+376                                               02623000
CVTFETCH EQU   CVTS01+372                                               02624000
CVTRSTWD EQU   CVTS01+368                                               02625000
CVTSPOST EQU   CVTS01+364                                               02626000
CVTIOBP  EQU   CVTS01+360                                               02627000
CVTASMVT EQU   CVTS01+356                                               02628000
CVTRECRQ EQU   CVTS01+352                                               02629000
CVTWSAC  EQU   CVTS01+348                                               02630000
CVTRV149 EQU   CVTS01+344                                               02631000
CVTWSAL  EQU   CVTS01+340                                               02632000
CVTSPSA  EQU   CVTS01+336                                               02633000
CVTGLMN  EQU   CVTS01+332                                               02634000
CVTVEAC0 EQU   CVTS01+328                                               02635000
CVT062R1 EQU   CVTS01+324                                               02636000
CVTRPOST EQU   CVTS01+320                                               02637000
CVTDQIQE EQU   CVTS01+316                                               02638000
CVTCSD   EQU   CVTS01+312                                               02639000
CVTLKRMA EQU   CVTS01+308                                               02640000
CVTRSPIE EQU   CVTS01+304                                               02641000
CVTRENQ  EQU   CVTS01+300                                               02642000
CVTLQCB  EQU   CVTS01+296                                               02643000
CVTFQCB  EQU   CVTS01+292                                               02644000
CVTQCS01 EQU   CVTS01+288                                               02645000
CVTAPFT  EQU   CVTS01+284                                               02646000
CVTPARRL EQU   CVTS01+280                                               02647000
CVTVWAIT EQU   CVTS01+276                                               02648000
CVTGSPL  EQU   CVTS01+272                                               02649000
CVTLSMQ  EQU   CVTS01+268                                               02650000
CVTGSMQ  EQU   CVTS01+264                                               02651000
CVTOPCTP EQU   CVTS01+256                                               02652000
CVTSIC   EQU   CVTS01+252                                               02653000
CVTTPIOS EQU   CVTS01+248                                               02654000
CVTRTMS  EQU   CVTS01+244                                               02655000
CVTSDBF  EQU   CVTS01+240                                               02656000
CVTSCBP  EQU   CVTS01+236                                               02657000
CVTSDMP  EQU   CVTS01+232                                               02658000
CVTSV60  EQU   CVTS01+228                                               02659000
CVTRTMCT EQU   CVTS01+224                                               02660000
CVTASCBL EQU   CVTS01+220                                               02661000
CVTASCBH EQU   CVTS01+216                                               02662000
CVTGDA   EQU   CVTS01+212                                               02663000
CVTASVT  EQU   CVTS01+208                                               02664000
CVTVVMDI EQU   CVTS01+204                                               02665000
CVTAQTOP EQU   CVTS01+200                                               02666000
CVTIOSCS EQU   CVTS01+196                                               02667000
CVTSDRM  EQU   CVTS01+192                                               02668000
CVTOPTE  EQU   CVTS01+188                                               02669000
CVTSTXU  EQU   CVTS01+184                                               02670000
CVTQUIS  EQU   CVTS01+180                                               02671000
CVTPARS  EQU   CVTS01+176                                               02672000
CVTS1EE  EQU   CVTS01+172                                               02673000
CVTFRAS  EQU   CVTS01+168                                               02674000
CVTQSAS  EQU   CVTS01+164                                               02675000
CVTCRAS  EQU   CVTS01+160                                               02676000
CVTCRMN  EQU   CVTS01+156                                               02677000
CVTDELCP EQU   CVTS01+152                                               02678000
CVTFRECL EQU   CVTS01+148                                               02679000
CVTGETCL EQU   CVTS01+144                                               02680000
CVTBLDCP EQU   CVTS01+140                                               02681000
CVTAUTHL EQU   CVTS01+136                                               02682000
CVTSCAN  EQU   CVTS01+132                                               02683000
CVTRV144 EQU   CVTS01+130                                               02684000
CVTMAXMP EQU   CVTS01+128                                               02685000
CVTSTCK  EQU   CVTS01+124                                               02686000
CVTRV139 EQU   CVTS01+123                                               02687000
CVTDSSAC EQU   CVTS01+122                                               02688000
CVTRV513 EQU   CVTS01+121                                               02689000
CVTIOSPL EQU   CVTS01+120                                               02690000
CVTPTGT  EQU   CVTS01+116                                               02691000
CVTCSPIE EQU   CVTS01+112                                               02692000
CVTSMFEX EQU   CVTS01+108                                               02693000
CVTOLT0A EQU   CVTS01+104                                               02694000
CVTSRBRT EQU   CVTS01+100                                               02695000
CVTPUTL  EQU   CVTS01+96                                                02696000
CVTASCRL EQU   CVTS01+92                                                02697000
CVTASCRF EQU   CVTS01+88                                                02698000
CVTRV326 EQU   CVTS01+84                                                02699000
CVTRV325 EQU   CVTS01+80                                                02700000
CVTRV324 EQU   CVTS01+76                                                02701000
CVT0VL01 EQU   CVTS01+72                                                02702000
CVTSHRVM EQU   CVTS01+68                                                02703000
CVTRV332 EQU   CVTS01+64                                                02704000
CVTTAS   EQU   CVTS01+60                                                02705000
CVTRSCN  EQU   CVTS01+56                                                02706000
CVTTRAC2 EQU   CVTS01+54                                                02707000
CVTTRACE EQU   CVTS01+52                                                02708000
CVTAPG   EQU   CVTS01+51                                                02709000
CVTSDTRC EQU   CVTCTLFG                                                 02710000
CVTGTRCE EQU   CVTCTLFG                                                 02711000
CVTNOMP  EQU   CVTCTLFG                                                 02712000
CVTRSV79 EQU   CVTCTLFG                                                 02713000
CVTDSTAT EQU   CVTCTLFG                                                 02714000
CVTRSV78 EQU   CVTCTLFG                                                 02715000
CVTRV333 EQU   CVTCTLFG                                                 02716000
CVTRV323 EQU   CVTCTLFG                                                 02717000
CVTSPVLK EQU   CVTS01+49                                                02718000
CVTRSV77 EQU   CVTS01+48                                                02719000
CVTRV331 EQU   CVTS01+44                                                02720000
CVTRV330 EQU   CVTS01+40                                                02721000
CVTRV329 EQU   CVTS01+36                                                02722000
CVTRV328 EQU   CVTS01+32                                                02723000
CVTRV322 EQU   CVTS01+28                                                02724000
CVTSLID  EQU   CVTSLIDA+1                                               02725000
CVTSYLK  EQU   CVTSLIDA                                                 02726000
CVTRV321 EQU   CVTS01+20                                                02727000
CVTRV320 EQU   CVTS01+16                                                02728000
CVTLPDIR EQU   CVTLPDIA+1                                               02729000
CVTRSV69 EQU   CVTDIRST                                                 02730000
CVTRSV68 EQU   CVTDIRST                                                 02731000
CVTRSV67 EQU   CVTDIRST                                                 02732000
CVTRSV66 EQU   CVTDIRST                                                 02733000
CVTRSV65 EQU   CVTDIRST                                                 02734000
CVTRSV64 EQU   CVTDIRST                                                 02735000
CVTRSV63 EQU   CVTDIRST                                                 02736000
CVTDICOM EQU   CVTDIRST                                                 02737000
CVTPVTP  EQU   CVTS01+8                                                 02738000
CVTLPDSR EQU   CVTS01+4                                                 02739000
CVTGETL  EQU   CVTS01                                                   02740000
@NM00001 EQU   AVDSORG                                                  02741000
@NM00027 EQU   SFLAG                                                    02742000
@NM00026 EQU   SFLAG                                                    02743000
DS1END   EQU   IECSDSL1+140                                             02744000
DS1PTRDS EQU   IECSDSL1+135                                             02745000
DS1EXT3  EQU   IECSDSL1+125                                             02746000
@NM00025 EQU   IECSDSL1+103                                             02747000
DS1DSIND EQU   IECSDSL1+93                                              02748000
@NM00024 EQU   IECSDSL1+75                                              02749000
@NM00023 EQU   IECSDSL1+61                                              02750000
@NM00022 EQU   IECSDSF1                                                 02751000
UCBERADR EQU   UCBUCS+12                                                02752000
UCBFCBID EQU   UCBUCS+8                                                 02753000
UCBERCNT EQU   UCBUCS+7                                                 02754000
UCBRSV51 EQU   UCBUCS+6                                                 02755000
UCBRSV50 EQU   UCBFCBOP                                                 02756000
UCBRSV49 EQU   UCBFCBOP                                                 02757000
UCBRSV48 EQU   UCBFCBOP                                                 02758000
UCBRSV47 EQU   UCBFCBOP                                                 02759000
UCBRSV46 EQU   UCBFCBOP                                                 02760000
UCBRSV45 EQU   UCBFCBOP                                                 02761000
UCBRSV44 EQU   UCBFCBOP                                                 02762000
UCBFCBO1 EQU   UCBFCBOP                                                 02763000
UCBUCSPE EQU   UCBUCSOP                                                 02764000
UCBRSV43 EQU   UCBUCSOP                                                 02765000
UCBRSV42 EQU   UCBUCSOP                                                 02766000
UCBRSV41 EQU   UCBUCSOP                                                 02767000
UCBRSV40 EQU   UCBUCSOP                                                 02768000
UCBRSV39 EQU   UCBUCSOP                                                 02769000
UCBUCSO2 EQU   UCBUCSOP                                                 02770000
UCBUCSO1 EQU   UCBUCSOP                                                 02771000
UCBUCSID EQU   UCBUCS                                                   02772000
UCBMDRBA EQU   UCBMDRBF+1                                               02773000
UCBRV075 EQU   UCBMDRBF                                                 02774000
UCBRV074 EQU   UCB3800X+32                                              02775000
UCBIMAGE EQU   UCB3800X+28                                              02776000
UCBFCBNM EQU   UCB3800X+24                                              02777000
UCBCHAR4 EQU   UCB3800X+20                                              02778000
UCBCHAR3 EQU   UCB3800X+16                                              02779000
UCBCHAR2 EQU   UCB3800X+12                                              02780000
UCBCHAR1 EQU   UCB3800X+8                                               02781000
UCBCGMID EQU   UCB3800X+4                                               02782000
UCBBRSTA EQU   UCBACTIV                                                 02783000
UCBRV063 EQU   UCBACTIV                                                 02784000
UCBRV062 EQU   UCBACTIV                                                 02785000
UCBRV061 EQU   UCBACTIV                                                 02786000
UCBRV060 EQU   UCBACTIV                                                 02787000
UCBRV059 EQU   UCBACTIV                                                 02788000
UCBRV058 EQU   UCBACTIV                                                 02789000
UCBRV057 EQU   UCBACTIV                                                 02790000
UCBRV050 EQU   UCB3800X+2                                               02791000
UCBCGMNO EQU   UCB3800X+1                                               02792000
UCBRV083 EQU   UCBOPTNS                                                 02793000
UCBBRSTR EQU   UCBOPTNS                                                 02794000
UCBRV056 EQU   UCBOPTNS                                                 02795000
UCBRV055 EQU   UCBOPTNS                                                 02796000
UCBRV054 EQU   UCBOPTNS                                                 02797000
UCBRV053 EQU   UCBOPTNS                                                 02798000
UCBRV052 EQU   UCBOPTNS                                                 02799000
UCBRV051 EQU   UCBOPTNS                                                 02800000
UCBRV073 EQU   UCB3540X+7                                               02801000
UCBRV072 EQU   UCBDKBYT                                                 02802000
UCBRV071 EQU   UCBDKBYT                                                 02803000
UCBRV070 EQU   UCBDKBYT                                                 02804000
UCBRV069 EQU   UCBDKBYT                                                 02805000
UCBRV068 EQU   UCBDKBYT                                                 02806000
UCBRV067 EQU   UCBDKBYT                                                 02807000
UCBVLVER EQU   UCBDKBYT                                                 02808000
UCBDKAMX EQU   UCBDKBYT                                                 02809000
UCBVLSER EQU   UCB3540X                                                 02810000
UCBRDATA EQU   UCBOCR+4                                                 02811000
UCBFRID  EQU   UCBOCR                                                   02812000
UCBCLN   EQU   UCBMT+14                                                 02813000
UCBERG   EQU   UCBMT+12                                                 02814000
UCBMS    EQU   UCBMT+11                                                 02815000
UCBNB    EQU   UCBMT+10                                                 02816000
UCBPW    EQU   UCBMT+9                                                  02817000
UCBPR    EQU   UCBMT+8                                                  02818000
UCBSIO   EQU   UCBMT+6                                                  02819000
UCBTW    EQU   UCBMT+5                                                  02820000
UCBTR    EQU   UCBMT+4                                                  02821000
UCBTWT   EQU   UCBMT+3                                                  02822000
UCBTRT   EQU   UCBMT+2                                                  02823000
UCBCTD   EQU   UCBMT                                                    02824000
UCBWTOID EQU   UCBCMEXT+17                                              02825000
UCBRV043 EQU   UCBCMEXT+16                                              02826000
UCBASID  EQU   UCBCMEXT+14                                              02827000
UCBMFCNT EQU   UCBCMEXT+12                                              02828000
UCBPMSK  EQU   UCBCMEXT+10                                              02829000
UCBCCWOF EQU   UCBCMEXT+8                                               02830000
UCBRV041 EQU   UCBCMEXT+6                                               02831000
UCBRV036 EQU   UCBFLP1                                                  02832000
UCBRV035 EQU   UCBFLP1                                                  02833000
UCBERLOG EQU   UCBFLP1                                                  02834000
UCBRV033 EQU   UCBFLP1                                                  02835000
UCBRV032 EQU   UCBFLP1                                                  02836000
UCBRV031 EQU   UCBFLP1                                                  02837000
UCBSHRUP EQU   UCBFLP1                                                  02838000
UCBNSRCH EQU   UCBFLP1                                                  02839000
UCBSNSCT EQU   UCBCMEXT+4                                               02840000
UCBHPDV  EQU   @NM00021                                                 02841000
UCBHALI  EQU   @NM00021                                                 02842000
UCBRSV09 EQU   @NM00021                                                 02843000
UCBRSV08 EQU   @NM00021                                                 02844000
UCBRSV07 EQU   @NM00021                                                 02845000
UCBRSV06 EQU   @NM00021                                                 02846000
UCBRSV05 EQU   @NM00021                                                 02847000
UCBRSV04 EQU   @NM00021                                                 02848000
UCBDTI   EQU   UCBCMEXT+2                                               02849000
UCBSTI   EQU   UCBCMEXT+1                                               02850000
UCBETI   EQU   UCBCMEXT                                                 02851000
UCBEXTP  EQU   UCBEXTPT+1                                               02852000
UCBDDRSW EQU   UCBFLC                                                   02853000
UCBTICBT EQU   UCBFLC                                                   02854000
UCBIVRR  EQU   UCBFLC                                                   02855000
UCBIVRS  EQU   UCBFLC                                                   02856000
UCBITF   EQU   UCBFLC                                                   02857000
UCBUDE   EQU   UCBFLC                                                   02858000
UCBWAA   EQU   UCBFLC                                                   02859000
UCBATTP  EQU   UCBFLC                                                   02860000
UCBUNTYP EQU   UCBTBYT4                                                 02861000
UCBRSV11 EQU   UCBDVCLS                                                 02862000
UCBRSV10 EQU   UCBDVCLS                                                 02863000
UCB3CHAR EQU   UCBDVCLS                                                 02864000
UCB3UREC EQU   UCBDVCLS                                                 02865000
UCB3DISP EQU   UCBDVCLS                                                 02866000
UCB3DACC EQU   UCBDVCLS                                                 02867000
UCB3COMM EQU   UCBDVCLS                                                 02868000
UCB3TAPE EQU   UCBDVCLS                                                 02869000
UCBDVPWR EQU   UCB2OPT7                                                 02870000
UCBVLPWR EQU   UCB2OPT6                                                 02871000
UCB2OPT5 EQU   UCBTBYT2                                                 02872000
UCBRPS   EQU   UCBDUDN2                                                 02873000
UCBRR    EQU   UCBDUDN1                                                 02874000
UCB2OPT1 EQU   UCBTBYT2                                                 02875000
UCB2OPT0 EQU   UCBTBYT2                                                 02876000
UCB1FEA7 EQU   UCBTBYT1                                                 02877000
UCBD6250 EQU   UCB1FEA6                                                 02878000
UCBD1600 EQU   UCB1FEA5                                                 02879000
UCB1FEA4 EQU   UCBTBYT1                                                 02880000
UCB1FEA3 EQU   UCBTBYT1                                                 02881000
UCB1FEA2 EQU   UCBTBYT1                                                 02882000
UCB1FEA1 EQU   UCBTBYT1                                                 02883000
UCB1FEA0 EQU   UCBTBYT1                                                 02884000
UCBRV029 EQU   UCBWGT                                                   02885000
UCBVHRSN EQU   UCBWGT                                                   02886000
UCBVORSN EQU   UCBWGT                                                   02887000
UCBMTPXP EQU   UCBWGT                                                   02888000
UCBREW   EQU   UCBWGT                                                   02889000
UCBPUB   EQU   UCBWGT                                                   02890000
UCBOUT   EQU   UCBWGT                                                   02891000
UCBIN    EQU   UCBWGT                                                   02892000
UCBCPU   EQU   UCBOB+11                                                 02893000
UCBLCI   EQU   UCBOB+10                                                 02894000
UCBCNT   EQU   UCBOB+9                                                  02895000
UCBRV017 EQU   UCBCHM1                                                  02896000
UCBRV016 EQU   UCBCHM1                                                  02897000
UCBRV015 EQU   UCBCHM1                                                  02898000
UCBRV014 EQU   UCBCHM1                                                  02899000
UCBSPB   EQU   UCBPTH1                                                  02900000
UCBPPB   EQU   UCBPTH1                                                  02901000
UCBSPA   EQU   UCBPTH0                                                  02902000
UCBPPA   EQU   UCBPTH0                                                  02903000
UCBSIGP  EQU   UCBFLB                                                   02904000
UCBVALPH EQU   UCBFLB                                                   02905000
UCBCRHSN EQU   UCBFLB                                                   02906000
UCBCRHRV EQU   UCBFLB                                                   02907000
UCBRESVH EQU   UCBFLB                                                   02908000
UCBSPST  EQU   UCBFLB                                                   02909000
UCBASNS  EQU   UCBFLB                                                   02910000
UCBIORST EQU   UCBFLB                                                   02911000
UCBQISCE EQU   UCBFL1                                                   02912000
UCBACTV  EQU   UCBFL1                                                   02913000
UCBSAP   EQU   UCBFL1                                                   02914000
UCBNOTRC EQU   UCBCUB                                                   02915000
UCBPSNS  EQU   UCBFL1                                                   02916000
UCBUSING EQU   UCBPST                                                   02917000
UCBNOTRD EQU   UCBNRY                                                   02918000
UCBBUSYD EQU   UCBBSY                                                   02919000
UCBSYSR  EQU   UCBSTAT                                                  02920000
UCBPRES  EQU   UCBSTAT                                                  02921000
UCBUNLD  EQU   UCBSTAT                                                  02922000
UCBCHGS  EQU   UCBSTAT                                                  02923000
UCBALTPH EQU   UCBFL5                                                   02924000
UCBALTCU EQU   UCBFL5                                                   02925000
UCBNALOC EQU   UCBFL5                                                   02926000
UCBENVRD EQU   UCBFL5                                                   02927000
UCBVSDR  EQU   UCBFL5                                                   02928000
UCBSASK  EQU   UCBFL5                                                   02929000
UCBAMV   EQU   UCBAF                                                    02930000
UCBDCC   EQU   UCBFL5                                                   02931000
UCBMONT  EQU   UCBJBNR                                                  02932000
UCBRV011 EQU   UCBJBNR                                                  02933000
UCBMMSGP EQU   UCBJBNR                                                  02934000
UCBOLDSM EQU   UCBJBNR                                                  02935000
UCBRV003 EQU   UCBJBNR                                                  02936000
UCBDUC   EQU   UCBJBNR                                                  02937000
UCBJES3  EQU   UCBJBNR                                                  02938000
UCBVRDEV EQU   UCBJBNR                                                  02939000
UCBCMSEG EQU   UCBOB                                                    02940000
UCBPFXND EQU   UCB+512                                                  02941000
UCBIOQ   EQU   UCB+508                                                  02942000
UCBLOCK  EQU   UCB+504                                                  02943000
UCBPXST  EQU   UCB+504                                                  02944000
@NM00018 EQU   UCB                                                      02945000
VDSRBN   EQU   VDSCB+76                                                 02946000
VDSWINSI EQU   VDSCB+70                                                 02947000
VDSWINDW EQU   VDSCB+64                                                 02948000
VDSVBPPL EQU   VDSCB+60                                                 02949000
VDSWICB  EQU   VDSCB+56                                                 02950000
VDSDSPCT EQU   VDSCB+52                                                 02951000
VDSSEEKA EQU   VDSCB+45                                                 02952000
JFCRSV05 EQU   JFCEROPT                                                 02953000
JFCRSV04 EQU   JFCEROPT                                                 02954000
JFCRSV03 EQU   JFCEROPT                                                 02955000
JFCRSV02 EQU   JFCEROPT                                                 02956000
JFCTOPT  EQU   JFCEROPT                                                 02957000
JFCABN   EQU   JFCEROPT                                                 02958000
JFCSKP   EQU   JFCEROPT                                                 02959000
JFCACC   EQU   JFCEROPT                                                 02960000
JFCBUFL  EQU   JFCAMPTR+2                                               02961000
JFCFWORD EQU   JFCBFTEK                                                 02962000
JFCDWORD EQU   JFCBFTEK                                                 02963000
JFCHIER1 EQU   JFCBFTEK                                                 02964000
JFCDYN   EQU   JFCBFTEK                                                 02965000
JFCEXC   EQU   JFCBFTEK                                                 02966000
JFCBBFTR EQU   JFCBBFTA                                                 02967000
JFCSIM   EQU   JFCBBFTA                                                 02968000
JFCHIER  EQU   JFCBFTEK                                                 02969000
JFCBFOUT EQU   JFCBUFNO                                                 02970000
JFCBUFIN EQU   JFCBUFNO                                                 02971000
JFCTEMP  EQU   JFCBIND2                                                 02972000
JFCREQ   EQU   JFCBIND2                                                 02973000
JFCENT   EQU   JFCBIND2                                                 02974000
JFCSHARE EQU   JFCBIND2                                                 02975000
JFCSECUR EQU   JFCBIND2                                                 02976000
JFCDISP  EQU   JFCBIND2                                                 02977000
JFCPDS   EQU   JFCBIND1                                                 02978000
JFCGDG   EQU   JFCBIND1                                                 02979000
JFCADDED EQU   JFCBIND1                                                 02980000
JFCLOC   EQU   JFCBIND1                                                 02981000
JFCRLSE  EQU   JFCBIND1                                                 02982000
JFCBOPS2 EQU   JFCBMASK+7                                               02983000
JFCRCTLG EQU   JFCBFLG2                                                 02984000
JFCBBUFF EQU   JFCBFLG2                                                 02985000
JFCTRACE EQU   JFCBFLG2                                                 02986000
JFCSDRPS EQU   JFCBFLG2                                                 02987000
JFCMODNW EQU   JFCBFLG2                                                 02988000
JFCNRPS  EQU   JFCDEFER                                                 02989000
JFCOUTOP EQU   JFCBFLG2                                                 02990000
JFCINOP  EQU   JFCBFLG2                                                 02991000
JFCBPWBP EQU   JFCOPEN                                                  02992000
@NM00014 EQU   JFCOPEN                                                  02993000
JFCDUAL  EQU   JFCBFLG1                                                 02994000
JFCSLDES EQU   JFCBFLG1                                                 02995000
JFCSLCRE EQU   JFCBFLG1                                                 02996000
JFCSTAND EQU   JFCBFLG1                                                 02997000
JFCBOPS1 EQU   JFCBMASK                                                 02998000
JFCBVLSQ EQU   INFMJFCB+70                                              02999000
JFCRSV31 EQU   JFCFUNC                                                  03000000
JFCFNCBT EQU   JFCFUNC                                                  03001000
JFCFNCBX EQU   JFCFUNC                                                  03002000
JFCFNCBD EQU   JFCFUNC                                                  03003000
JFCFNCBW EQU   JFCFUNC                                                  03004000
JFCFNCBP EQU   JFCFUNC                                                  03005000
JFCFNCBR EQU   JFCFUNC                                                  03006000
JFCFNCBI EQU   JFCFUNC                                                  03007000
JFCBFOFL EQU   JFCBUFOF                                                 03008000
JFCNL    EQU   JFCBLTYP                                                 03009000
JFCNSL   EQU   JFCBLTYP                                                 03010000
JFCBLP   EQU   JFCBLTYP                                                 03011000
JFCBLTM  EQU   JFCBLTYP                                                 03012000
JFCBAL   EQU   JFCBLTYP                                                 03013000
JFCRSV38 EQU   JFCBLTYP                                                 03014000
JFCVINDX EQU   INFMJFCB+64                                              03015000
JFCNLREC EQU   INFMJFCB+62                                              03016000
JFCBADBF EQU   INFMJFCB+60                                              03017000
JFCAMSTR EQU   JFCBFRID+2                                               03018000
JFCAMCRO EQU   JFCBFRID                                                 03019000
JFCBDSCB EQU   INFMJFCB+53                                              03020000
JFCPAT   EQU   JFCBTSDM                                                 03021000
JFCNDCB  EQU   JFCBTSDM                                                 03022000
JFCNDSCB EQU   JFCBTSDM                                                 03023000
JFCNWRIT EQU   JFCBTSDM                                                 03024000
JFCTTR   EQU   JFCBTSDM                                                 03025000
JFCSDS   EQU   JFCBTSDM                                                 03026000
JFCVSL   EQU   JFCBTSDM                                                 03027000
JFCCAT   EQU   JFCBTSDM                                                 03028000
JFCIPLTX EQU   JFCBELNM                                                 03029000
JFCBQNAM EQU   JFCBDSNM                                                 03030000
JSCBCSCB EQU   JSCBSEC1+68                                              03031000
JSCBPMG  EQU   JSCBWTP+2                                                03032000
JSCBWTSP EQU   JSCBWTP+1                                                03033000
JSCRSV23 EQU   JSCBWTFG                                                 03034000
JSCRSV22 EQU   JSCBWTFG                                                 03035000
JSCRSV21 EQU   JSCBWTFG                                                 03036000
JSCRSV20 EQU   JSCBWTFG                                                 03037000
JSCRSV19 EQU   JSCBWTFG                                                 03038000
JSCRSV18 EQU   JSCBWTFG                                                 03039000
JSCBRET  EQU   JSCBWTFG                                                 03040000
JSCBIOFG EQU   JSCBWTFG                                                 03041000
@NM00011 EQU   JSCBSEC1+60                                              03042000
JSCBQMPI EQU   JSCBSEC1+56                                              03043000
JSCBPMSG EQU   JSCBSWT1                                                 03044000
JSCRSV16 EQU   JSCBSWT1                                                 03045000
JSCRSV15 EQU   JSCBSWT1                                                 03046000
JSCRSV14 EQU   JSCBSWT1                                                 03047000
JSCRSV13 EQU   JSCBSWT1                                                 03048000
JSCRSV12 EQU   JSCBSWT1                                                 03049000
JSCRSV11 EQU   JSCBSWT1                                                 03050000
JSCBPASS EQU   JSCBSWT1                                                 03051000
JSCBTTTR EQU   JSCBSEC1+52                                              03052000
JSCRSV10 EQU   JSCBSEC1+49                                              03053000
JSCBAUTH EQU   JSCBOPTS                                                 03054000
JSCSIOTS EQU   JSCBOPTS                                                 03055000
JSCRSV08 EQU   JSCBOPTS                                                 03056000
JSCRSV07 EQU   JSCBOPTS                                                 03057000
JSCRSV06 EQU   JSCBOPTS                                                 03058000
JSCBLONG EQU   JSCBOPTS                                                 03059000
JSCRSV05 EQU   JSCBOPTS                                                 03060000
JSCRSV04 EQU   JSCBOPTS                                                 03061000
JSCBSECB EQU   JSCBSEC1+44                                              03062000
JSCRSV03 EQU   JSCBSEC1+41                                              03063000
JSCBSTEP EQU   JSCBSEC1+40                                              03064000
JSCBDCBA EQU   JSCBDCB+1                                                03065000
JSCRSV02 EQU   JSCBDCB                                                  03066000
JSCBID   EQU   JSCBSEC1+32                                              03067000
JSCBDBTB EQU   JSCBSEC1+28                                              03068000
JSCBIJSC EQU   JSCBSEC1+24                                              03069000
JSCBTCBP EQU   JSCBSEC1+20                                              03070000
JSCBPCC  EQU   JSCBSEC1+16                                              03071000
JSCBTCP  EQU   JSCBSEC1+12                                              03072000
JSCBSHR  EQU   JSCBSEC1+8                                               03073000
JSCHPCEA EQU   JSCHPCE+1                                                03074000
JSCRSV32 EQU   JSCHPCE                                                  03075000
JSCRSV01 EQU   JSCBSEC1                                                 03076000
@NM00010 EQU   IEZJSCB                                                  03077000
@NM00008 EQU   TCBXTNT2+32                                              03078000
TCBRV181 EQU   TCBRV173                                                 03079000
TCBRV180 EQU   TCBRV173                                                 03080000
TCBRV179 EQU   TCBRV173                                                 03081000
TCBRV178 EQU   TCBRV173                                                 03082000
TCBRV177 EQU   TCBRV173                                                 03083000
TCBRV176 EQU   TCBRV173                                                 03084000
TCBRV175 EQU   TCBRV173                                                 03085000
TCBRV174 EQU   TCBRV173                                                 03086000
TCBRV172 EQU   TCBRV164                                                 03087000
TCBRV171 EQU   TCBRV164                                                 03088000
TCBRV170 EQU   TCBRV164                                                 03089000
TCBRV169 EQU   TCBRV164                                                 03090000
TCBRV168 EQU   TCBRV164                                                 03091000
TCBRV167 EQU   TCBRV164                                                 03092000
TCBRV166 EQU   TCBRV164                                                 03093000
TCBRV165 EQU   TCBRV164                                                 03094000
TCBRV163 EQU   TCBRV155                                                 03095000
TCBRV162 EQU   TCBRV155                                                 03096000
TCBRV161 EQU   TCBRV155                                                 03097000
TCBRV160 EQU   TCBRV155                                                 03098000
TCBRV159 EQU   TCBRV155                                                 03099000
TCBRV158 EQU   TCBRV155                                                 03100000
TCBRV157 EQU   TCBRV155                                                 03101000
TCBRV156 EQU   TCBRV155                                                 03102000
TCBRV154 EQU   TCBRV146                                                 03103000
TCBRV153 EQU   TCBRV146                                                 03104000
TCBRV152 EQU   TCBRV146                                                 03105000
TCBRV151 EQU   TCBRV146                                                 03106000
TCBRV150 EQU   TCBRV146                                                 03107000
TCBRV149 EQU   TCBRV146                                                 03108000
TCBRV148 EQU   TCBRV146                                                 03109000
TCBRV147 EQU   TCBRV146                                                 03110000
TCBRV145 EQU   TCBXTNT2+26                                              03111000
TCBRV144 EQU   TCBXTNT2+24                                              03112000
TCBRV143 EQU   TCBXTNT2+20                                              03113000
TCBRV142 EQU   TCBXTNT2+16                                              03114000
TCBRSV49 EQU   TCBXTNT2+12                                              03115000
TCBEVENT EQU   TCBXTNT2+8                                               03116000
TCBRCMP  EQU   TCBXTNT2+5                                               03117000
TCBRSVAB EQU   TCBXTNT2+4                                               03118000
TCBGTFA  EQU   TCBGTF+1                                                 03119000
TCBRSV47 EQU   TCBTFLG                                                  03120000
TCBRSV46 EQU   TCBTFLG                                                  03121000
TCBRSV45 EQU   TCBTFLG                                                  03122000
TCBRSV44 EQU   TCBTFLG                                                  03123000
TCBRSV43 EQU   TCBTFLG                                                  03124000
TCBDSPIT EQU   TCBTFLG                                                  03125000
TCBERRTN EQU   TCBTFLG                                                  03126000
TCBASYNC EQU   TCBTFLG                                                  03127000
@NM00007 EQU   TCB+296                                                  03128000
TCBSVCA2 EQU   TCB+292                                                  03129000
TCBSWASA EQU   TCB+288                                                  03130000
TCBDBTB  EQU   TCB+284                                                  03131000
TCBRPT   EQU   TCB+280                                                  03132000
TCBRV141 EQU   TCBRV133                                                 03133000
TCBRV140 EQU   TCBRV133                                                 03134000
TCBRV139 EQU   TCBRV133                                                 03135000
TCBRV138 EQU   TCBRV133                                                 03136000
TCBRV137 EQU   TCBRV133                                                 03137000
TCBRV136 EQU   TCBRV133                                                 03138000
TCBRV135 EQU   TCBRV133                                                 03139000
TCBRV134 EQU   TCBRV133                                                 03140000
TCBRV132 EQU   TCBRV124                                                 03141000
TCBRV131 EQU   TCBRV124                                                 03142000
TCBRV130 EQU   TCBRV124                                                 03143000
TCBRV129 EQU   TCBRV124                                                 03144000
TCBRV128 EQU   TCBRV124                                                 03145000
TCBRV127 EQU   TCBRV124                                                 03146000
TCBRV126 EQU   TCBRV124                                                 03147000
TCBRV125 EQU   TCBRV124                                                 03148000
TCBRV123 EQU   TCBFBYT2                                                 03149000
TCBRV122 EQU   TCBFBYT2                                                 03150000
TCBECBNV EQU   TCBFBYT2                                                 03151000
TCBSSSYN EQU   TCBFBYT2                                                 03152000
TCBFPRAP EQU   TCBFBYT2                                                 03153000
TCBFDW   EQU   TCBFBYT2                                                 03154000
TCBFMW   EQU   TCBFBYT2                                                 03155000
TCBCNCB  EQU   TCBFBYT2                                                 03156000
TCBLLH   EQU   TCBFBYT1                                                 03157000
TCBRV113 EQU   TCBFBYT1                                                 03158000
TCBEOT   EQU   TCBFBYT1                                                 03159000
TCBRTM2  EQU   TCBFBYT1                                                 03160000
TCBPGNLY EQU   TCBFBYT1                                                 03161000
TCBNDIOS EQU   TCBFBYT1                                                 03162000
TCBACTIV EQU   TCBFBYT1                                                 03163000
TCBEOTFM EQU   TCBFBYT1                                                 03164000
TCBAFFN  EQU   TCB+274                                                  03165000
TCBCCPVI EQU   TCB+272                                                  03166000
TCBUKYSP EQU   TCB+268                                                  03167000
TCBMODE  EQU   TCBESTAE+3                                               03168000
TCBERTYP EQU   TCBESTAE+2                                               03169000
TCBRV314 EQU   TCBESTRM                                                 03170000
TCBRV313 EQU   TCBESTRM                                                 03171000
TCBRV312 EQU   TCBESTRM                                                 03172000
TCBRV311 EQU   TCBESTRM                                                 03173000
TCBRV310 EQU   TCBESTRM                                                 03174000
TCBRV309 EQU   TCBESTRM                                                 03175000
TCBRV308 EQU   TCBESTRM                                                 03176000
TCBETERM EQU   TCBESTRM                                                 03177000
TCBSCBKY EQU   TCBESTAE                                                 03178000
TCBRTM12 EQU   TCB+260                                                  03179000
TCBTCBID EQU   TCB+256                                                  03180000
TCBRSV96 EQU   TCB+252                                                  03181000
TCBSWA   EQU   TCB+248                                                  03182000
TCBFOEA  EQU   TCBFOE+1                                                 03183000
TCBRSV42 EQU   TCBFOE                                                   03184000
TCBRV306 EQU   TCB+240                                                  03185000
TCBRSV41 EQU   TCB+239                                                  03186000
TCBTID   EQU   TCB+238                                                  03187000
TCBRSVAA EQU   TCB+237                                                  03188000
TCBABCUR EQU   TCB+236                                                  03189000
TCBTMSAV EQU   TCB+232                                                  03190000
TCBIOTIM EQU   TCB+228                                                  03191000
TCBRTWA  EQU   TCB+224                                                  03192000
TCBBACK  EQU   TCB+220                                                  03193000
TCBTIRB  EQU   TCB+216                                                  03194000
TCBAECB  EQU   TCB+212                                                  03195000
TCBEXT2A EQU   TCBEXT2+1                                                03196000
TCBRSV39 EQU   TCBEXT2                                                  03197000
TCBSTMCT EQU   TCB+207                                                  03198000
TCBSYSCT EQU   TCB+206                                                  03199000
TCBRSV37 EQU   TCB+205                                                  03200000
TCBEXSVC EQU   TCBDAR                                                   03201000
TCBDARMS EQU   TCBDAR                                                   03202000
TCBDARWT EQU   TCBDAR                                                   03203000
TCBDARO  EQU   TCBDAR                                                   03204000
TCBDARMC EQU   TCBDARC                                                  03205000
TCBDARD  EQU   TCBDAR                                                   03206000
TCBDARS  EQU   TCBDAR                                                   03207000
TCBDARP  EQU   TCBDAR                                                   03208000
TCBGTOFM EQU   TCBFLGS7                                                 03209000
TCBADMP  EQU   TCBFLGS7                                                 03210000
TCBRSTSK EQU   TCBFLGS7                                                 03211000
TCBSVCS  EQU   TCBFLGS7                                                 03212000
TCBSTACK EQU   TCBFLGS7                                                 03213000
TCBRSV34 EQU   TCBFLGS7                                                 03214000
TCBRSV33 EQU   TCBFLGS7                                                 03215000
TCBGPECB EQU   TCBFLGS7                                                 03216000
TCBNTJS  EQU   TCBFLGS6                                                 03217000
TCBAPG   EQU   TCBFLGS6                                                 03218000
TCBMIGR  EQU   TCBFLGS6                                                 03219000
TCBRV303 EQU   TCBFLGS6                                                 03220000
TCBSPVLK EQU   TCBFLGS6                                                 03221000
TCBCPU   EQU   TCBFLGS6                                                 03222000
TCBPIE17 EQU   TCBFLGS6                                                 03223000
TCBRV    EQU   TCBFLGS6                                                 03224000
TCBRSV79 EQU   TCBNDSP5                                                 03225000
TCBRSV78 EQU   TCBNDSP5                                                 03226000
TCBRSV77 EQU   TCBNDSP5                                                 03227000
TCBRSV76 EQU   TCBNDSP5                                                 03228000
TCBRSV75 EQU   TCBNDSP5                                                 03229000
TCBRSV74 EQU   TCBNDSP5                                                 03230000
TCBRSV95 EQU   TCBNDSP5                                                 03231000
TCBRSV94 EQU   TCBNDSP5                                                 03232000
TCBRSV93 EQU   TCBNDSP4                                                 03233000
TCBRSV92 EQU   TCBNDSP4                                                 03234000
TCBRSV91 EQU   TCBNDSP4                                                 03235000
TCBRSV90 EQU   TCBNDSP4                                                 03236000
TCBRSV89 EQU   TCBNDSP4                                                 03237000
TCBRSV88 EQU   TCBNDSP4                                                 03238000
TCBRSV87 EQU   TCBNDSP4                                                 03239000
TCBRSV86 EQU   TCBNDSP4                                                 03240000
TCBEXT1A EQU   TCBEXT1+1                                                03241000
TCBRSV32 EQU   TCBEXT1                                                  03242000
TCBEXCPD EQU   TCB+192                                                  03243000
TCBIOBRC EQU   TCB+188                                                  03244000
TCBDDWTC EQU   TCB+186                                                  03245000
TCBDDEXC EQU   TCB+184                                                  03246000
TCBJSCBB EQU   TCBJSCB+1                                                03247000
@NM00006 EQU   TCBRECDE                                                 03248000
TCBREC   EQU   TCBRECDE                                                 03249000
TCBMDIDS EQU   TCB+176                                                  03250000
TCBNDINT EQU   TCBNDSP3                                                 03251000
TCBRSV27 EQU   TCBNDSP3                                                 03252000
TCBRSV26 EQU   TCBNDSP3                                                 03253000
TCBRSV25 EQU   TCBNDSP3                                                 03254000
TCBRSV24 EQU   TCBNDSP3                                                 03255000
TCBSRBND EQU   TCBNDSP3                                                 03256000
TCBRV302 EQU   TCBNDSP3                                                 03257000
TCBLJSND EQU   TCBNDSP3                                                 03258000
TCBABE   EQU   TCBNDSP2                                                 03259000
TCBDSS   EQU   TCBNDSP2                                                 03260000
TCBOWAIT EQU   TCBNDSP2                                                 03261000
TCBIWAIT EQU   TCBNDSP2                                                 03262000
TCBNDTS  EQU   TCBNDSP2                                                 03263000
TCBNDSVC EQU   TCBNDSP2                                                 03264000
TCBSTPP  EQU   TCBNDSP2                                                 03265000
TCBABD   EQU   TCBNDSP2                                                 03266000
TCBRSV22 EQU   TCBNDSP1                                                 03267000
TCBPIEND EQU   TCBNDSP1                                                 03268000
TCBTPSP  EQU   TCBNDSP1                                                 03269000
TCBDDRND EQU   TCBNDSP1                                                 03270000
TCBRSPND EQU   TCBNDSP1                                                 03271000
TCBRSTND EQU   TCBNDSP1                                                 03272000
TCBDARPN EQU   TCBNDSP1                                                 03273000
TCBDARTN EQU   TCBNDSP1                                                 03274000
TCBNDSP0 EQU   TCBNDSP                                                  03275000
TCBUSER  EQU   TCB+168                                                  03276000
TCBTCTB  EQU   TCBTCT+1                                                 03277000
TCBRSV9C EQU   TCBTCTGF                                                 03278000
TCBRSV9B EQU   TCBTCTGF                                                 03279000
TCBRSV9A EQU   TCBTCTGF                                                 03280000
TCBRSV99 EQU   TCBTCTGF                                                 03281000
TCBRSV98 EQU   TCBTCTGF                                                 03282000
TCBRSV97 EQU   TCBTCTGF                                                 03283000
TCBRSV20 EQU   TCBTCTGF                                                 03284000
TCBSMFGF EQU   TCBTCTGF                                                 03285000
TCBSTABB EQU   TCBSTAB+1                                                03286000
TCBSTCUR EQU   TCBNSTAE                                                 03287000
TCBRV301 EQU   TCBNSTAE                                                 03288000
TCBSYNCH EQU   TCBNSTAE                                                 03289000
TCBHALT  EQU   TCBNSTAE                                                 03290000
TCBPPSUP EQU   TCBNSTAE                                                 03291000
TCB33E   EQU   TCBNSTAE                                                 03292000
TCBQUIES EQU   TCBNSTAE                                                 03293000
TCBSTABE EQU   TCBNSTAE                                                 03294000
TCBAQE   EQU   TCB+156                                                  03295000
TCBPQE   EQU   TCB+152                                                  03296000
TCBTSDP  EQU   TCB+151                                                  03297000
TCBTSLP  EQU   TCB+150                                                  03298000
TCBSTPCT EQU   TCB+149                                                  03299000
TCBCPUBN EQU   TCBTSFLG                                                 03300000
TCBDYDSP EQU   TCBTSFLG                                                 03301000
TCBRSV18 EQU   TCBTSFLG                                                 03302000
TCBRSV17 EQU   TCBTSFLG                                                 03303000
TCBTIOTG EQU   TCBTSFLG                                                 03304000
TCBATT   EQU   TCBTSFLG                                                 03305000
TCBSTPPR EQU   TCBTSFLG                                                 03306000
TCBRV300 EQU   TCBTSTSK                                                 03307000
TCBECB   EQU   TCB+144                                                  03308000
TCBIQE   EQU   TCB+140                                                  03309000
TCBLTC   EQU   TCB+136                                                  03310000
TCBOTC   EQU   TCB+132                                                  03311000
TCBNTC   EQU   TCB+128                                                  03312000
TCBJSTCA EQU   TCBJSTCB+1                                               03313000
TCBRSV16 EQU   TCBJSTCB                                                 03314000
TCBTQET  EQU   TCBTME                                                   03315000
TCBTCB   EQU   TCB+116                                                  03316000
TCBFSAB  EQU   TCBFSA+1                                                 03317000
TCBQEL   EQU   TCBFSA                                                   03318000
TCBGRS15 EQU   TCBGRS+60                                                03319000
TCBGRS14 EQU   TCBGRS+56                                                03320000
TCBGRS13 EQU   TCBGRS+52                                                03321000
TCBGRS12 EQU   TCBGRS+48                                                03322000
TCBGRS11 EQU   TCBGRS+44                                                03323000
TCBGRS10 EQU   TCBGRS+40                                                03324000
TCBGRS9  EQU   TCBGRS+36                                                03325000
TCBGRS8  EQU   TCBGRS+32                                                03326000
TCBGRS7  EQU   TCBGRS+28                                                03327000
TCBGRS6  EQU   TCBGRS+24                                                03328000
TCBGRS5  EQU   TCBGRS+20                                                03329000
TCBGRS4  EQU   TCBGRS+16                                                03330000
TCBGRS3  EQU   TCBGRS+12                                                03331000
TCBGRS2  EQU   TCBGRS+8                                                 03332000
TCBGRS1  EQU   TCBGRS+4                                                 03333000
TCBGRS0  EQU   TCBGRS                                                   03334000
TCBJPQB  EQU   TCBJPQ+1                                                 03335000
TCBRSV15 EQU   TCBPURGE                                                 03336000
TCBRSV14 EQU   TCBPURGE                                                 03337000
TCBRSV13 EQU   TCBPURGE                                                 03338000
TCBRSV12 EQU   TCBPURGE                                                 03339000
TCBRSV11 EQU   TCBPURGE                                                 03340000
TCBRSV10 EQU   TCBPURGE                                                 03341000
TCBRSV09 EQU   TCBPURGE                                                 03342000
TCBJPQF  EQU   TCBPURGE                                                 03343000
TCBJLB   EQU   TCB+40                                                   03344000
TCBLLS   EQU   TCB+36                                                   03345000
TCBDSP   EQU   TCB+35                                                   03346000
TCBLMP   EQU   TCB+34                                                   03347000
TCBPNDSP EQU   TCBFLGS5                                                 03348000
TCBFCD1  EQU   TCBFLGS5                                                 03349000
TCBSTP   EQU   TCBFLGS5                                                 03350000
TCBSYS   EQU   TCBFLGS5                                                 03351000
TCBANDSP EQU   TCBFLGS5                                                 03352000
TCBPAGE  EQU   TCBFLGS5                                                 03353000
TCBUXNDF EQU   TCBABWF                                                  03354000
TCBFC    EQU   TCBFLGS5                                                 03355000
TCBONDSP EQU   TCBFLGS4                                                 03356000
TCBMPCND EQU   TCBFLGS4                                                 03357000
TCBMPCVQ EQU   TCBFLGS4                                                 03358000
TCBUXNDV EQU   TCBFLGS4                                                 03359000
TCBHNDSP EQU   TCBFLGS4                                                 03360000
TCBRQENA EQU   TCBFLGS4                                                 03361000
TCBSER   EQU   TCBFLGS4                                                 03362000
TCBNDUMP EQU   TCBFLGS4                                                 03363000
TCBDWSTA EQU   TCBFLGS3                                                 03364000
TCBRSV08 EQU   TCBFLGS3                                                 03365000
TCBRSV07 EQU   TCBFLGS3                                                 03366000
TCBRSV06 EQU   TCBFLGS3                                                 03367000
TCBABGM  EQU   TCBFLGS3                                                 03368000
TCBABTRM EQU   TCBFLGS3                                                 03369000
TCBADINP EQU   TCBFLGS3                                                 03370000
TCBFSM   EQU   TCBFLGS3                                                 03371000
TCBFTS   EQU   TCBFLGS2                                                 03372000
TCBFETXR EQU   TCBFLGS2                                                 03373000
TCBFDSOP EQU   TCBFLGS2                                                 03374000
TCBFJMC  EQU   TCBFLGS2                                                 03375000
TCBFSMC  EQU   TCBFLGS2                                                 03376000
TCBFABOP EQU   TCBFLGS2                                                 03377000
TCBFSTI  EQU   TCBFLGS2                                                 03378000
TCBFOINP EQU   TCBFLGS2                                                 03379000
TCBFX    EQU   TCBFLGS1                                                 03380000
TCBFS    EQU   TCBFLGS1                                                 03381000
TCBFT    EQU   TCBFLGS1                                                 03382000
TCBPDUMP EQU   TCBFLGS1                                                 03383000
TCBNONPR EQU   TCBFLGS1                                                 03384000
TCBFERA  EQU   TCBFLGS1                                                 03385000
TCBFE    EQU   TCBFLGS1                                                 03386000
TCBFA    EQU   TCBFLGS1                                                 03387000
TCBZERO  EQU   TCBPKF                                                   03388000
TCBFLAG  EQU   TCBPKF                                                   03389000
TCBMSSB  EQU   TCBMSS+1                                                 03390000
TCBRSV03 EQU   TCBMSS                                                   03391000
TCBTRNB  EQU   TCBTRN+1                                                 03392000
TCBRSV02 EQU   TCBABF                                                   03393000
TCBOLTEP EQU   TCBABF                                                   03394000
TCBTCP   EQU   TCBABF                                                   03395000
TCBTCPP  EQU   TCBABF                                                   03396000
TCBRSV01 EQU   TCBABF                                                   03397000
TCBGRPH  EQU   TCBABF                                                   03398000
TCBNOCHK EQU   TCBABF                                                   03399000
TCBMOD91 EQU   TCBABF                                                   03400000
TCBCMPC  EQU   TCBCMP+1                                                 03401000
TCBRV318 EQU   TCBCMSG                                                  03402000
TCBRV317 EQU   TCBCIND                                                  03403000
TCBRV316 EQU   TCBCWTO                                                  03404000
TCBCASID EQU   TCBCDBL                                                  03405000
TCBNOCC  EQU   TCBSTCC                                                  03406000
TCBDMPO  EQU   TCBCPP                                                   03407000
TCBCSTEP EQU   TCBCMPF                                                  03408000
TCBCREQ  EQU   TCBCMPF                                                  03409000
TCBTIO   EQU   TCB+12                                                   03410000
TCBDEB   EQU   TCB+8                                                    03411000
TCBPIEA  EQU   TCBPIE+1                                                 03412000
TCBPM    EQU   TCBPMASK                                                 03413000
@NM00005 EQU   TCBPMASK                                                 03414000
TCBRBP   EQU   TCB                                                      03415000
TCBFRS6  EQU   TCBFRS+24                                                03416000
TCBFRS4  EQU   TCBFRS+16                                                03417000
TCBFRS2  EQU   TCBFRS+8                                                 03418000
TCBFRS0  EQU   TCBFRS                                                   03419000
@NM00004 EQU   TCBPTRS                                                  03420000
CVTLEVL  EQU   CVTRELNO+2                                               03421000
CVTNUMB  EQU   CVTRELNO                                                 03422000
CVTMDL   EQU   CVTFIX+250                                               03423000
@NM00003 EQU   CVTFIX+248                                               03424000
@NM00002 EQU   CVTFIX                                                   03425000
CVTRV482 EQU   CVTXTNT2+128                                             03426000
CVTRV481 EQU   CVTXTNT2+124                                             03427000
CVTRV480 EQU   CVTXTNT2+120                                             03428000
CVTRV479 EQU   CVTXTNT2+118                                             03429000
CVTRV478 EQU   CVTXTNT2+117                                             03430000
CVTRV477 EQU   CVTXTNT2+116                                             03431000
CVTRV476 EQU   CVTXTNT2+115                                             03432000
CVTRV475 EQU   CVTXTNT2+114                                             03433000
CVTRV474 EQU   CVTRV466                                                 03434000
CVTRV473 EQU   CVTRV466                                                 03435000
CVTRV472 EQU   CVTRV466                                                 03436000
CVTRV471 EQU   CVTRV466                                                 03437000
CVTRV470 EQU   CVTRV466                                                 03438000
CVTRV469 EQU   CVTRV466                                                 03439000
CVTRV468 EQU   CVTRV466                                                 03440000
CVTRV467 EQU   CVTRV466                                                 03441000
CVTRV465 EQU   CVTRV457                                                 03442000
CVTRV464 EQU   CVTRV457                                                 03443000
CVTRV463 EQU   CVTRV457                                                 03444000
CVTRV462 EQU   CVTRV457                                                 03445000
CVTRV461 EQU   CVTRV457                                                 03446000
CVTRV460 EQU   CVTRV457                                                 03447000
CVTRV459 EQU   CVTRV457                                                 03448000
CVTRV458 EQU   CVTRV457                                                 03449000
CVTRV456 EQU   CVTXTNT2+108                                             03450000
CVTRV455 EQU   CVTXTNT2+104                                             03451000
CVTRV454 EQU   CVTXTNT2+100                                             03452000
CVTRV453 EQU   CVTXTNT2+96                                              03453000
CVTRV452 EQU   CVTXTNT2+94                                              03454000
CVTRV451 EQU   CVTXTNT2+92                                              03455000
CVTRV450 EQU   CVTXTNT2+90                                              03456000
CVTRV449 EQU   CVTXTNT2+88                                              03457000
CVTRV448 EQU   CVTXTNT2+87                                              03458000
CVTRV447 EQU   CVTXTNT2+86                                              03459000
CVTRV446 EQU   CVTRV438                                                 03460000
CVTRV445 EQU   CVTRV438                                                 03461000
CVTRV444 EQU   CVTRV438                                                 03462000
CVTRV443 EQU   CVTRV438                                                 03463000
CVTRV442 EQU   CVTRV438                                                 03464000
CVTRV441 EQU   CVTRV438                                                 03465000
CVTRV440 EQU   CVTRV438                                                 03466000
CVTRV439 EQU   CVTRV438                                                 03467000
CVTRV437 EQU   CVTRV429                                                 03468000
CVTRV436 EQU   CVTRV429                                                 03469000
CVTRV435 EQU   CVTRV429                                                 03470000
CVTRV434 EQU   CVTRV429                                                 03471000
CVTRV433 EQU   CVTRV429                                                 03472000
CVTRV432 EQU   CVTRV429                                                 03473000
CVTRV431 EQU   CVTRV429                                                 03474000
CVTRV430 EQU   CVTRV429                                                 03475000
CVTRV428 EQU   CVTXTNT2+80                                              03476000
CVTRV427 EQU   CVTXTNT2+76                                              03477000
CVTRV426 EQU   CVTXTNT2+72                                              03478000
CVTRV425 EQU   CVTXTNT2+68                                              03479000
CVTATACT EQU   CVTATCVT                                                 03480000
CVTRV423 EQU   CVTXTNT2+62                                              03481000
CVTRV422 EQU   CVTXTNT2+60                                              03482000
CVTRV421 EQU   CVTXTNT2+58                                              03483000
CVTRV420 EQU   CVTXTNT2+56                                              03484000
CVTRV419 EQU   CVTXTNT2+55                                              03485000
CVTRV418 EQU   CVTXTNT2+54                                              03486000
CVTRV417 EQU   CVTRV409                                                 03487000
CVTRV416 EQU   CVTRV409                                                 03488000
CVTRV415 EQU   CVTRV409                                                 03489000
CVTRV414 EQU   CVTRV409                                                 03490000
CVTRV413 EQU   CVTRV409                                                 03491000
CVTRV412 EQU   CVTRV409                                                 03492000
CVTRV411 EQU   CVTRV409                                                 03493000
CVTRV410 EQU   CVTRV409                                                 03494000
CVTRV408 EQU   CVTRV400                                                 03495000
CVTRV407 EQU   CVTRV400                                                 03496000
CVTRV406 EQU   CVTRV400                                                 03497000
CVTRV405 EQU   CVTRV400                                                 03498000
CVTRV404 EQU   CVTRV400                                                 03499000
CVTRV403 EQU   CVTRV400                                                 03500000
CVTRV402 EQU   CVTRV400                                                 03501000
CVTRV401 EQU   CVTRV400                                                 03502000
CVTICB   EQU   CVTXTNT2+48                                              03503000
CVTSKTA  EQU   CVTXTNT2+44                                              03504000
CVTRSV99 EQU   CVTXTNT2+40                                              03505000
CVTRSV98 EQU   CVTXTNT2+36                                              03506000
CVTRSV97 EQU   CVTXTNT2+34                                              03507000
CVTRSV96 EQU   CVTXTNT2+32                                              03508000
CVTOLTEP EQU   CVTXTNT2+28                                              03509000
CVTQIDA  EQU   CVTQID+1                                                 03510000
CVTRSV95 EQU   CVTQID                                                   03511000
CVTRSV94 EQU   CVTXTNT2+20                                              03512000
CVTRSV93 EQU   CVTXTNT2+16                                              03513000
CVTRSV92 EQU   CVTXTNT2+12                                              03514000
CVTDEBVR EQU   CVTXTNT2+8                                               03515000
CVTRSV91 EQU   CVTXTNT2+6                                               03516000
CVTRSV9H EQU   CVTFLGBT                                                 03517000
CVTRSV9G EQU   CVTFLGBT                                                 03518000
CVTRSV9F EQU   CVTFLGBT                                                 03519000
CVTRSV9E EQU   CVTFLGBT                                                 03520000
CVTRSV9D EQU   CVTFLGBT                                                 03521000
CVTRSV9C EQU   CVTFLGBT                                                 03522000
CVTVME   EQU   CVTFLGBT                                                 03523000
CVTNPE   EQU   CVTFLGBT                                                 03524000
CVTNUCLS EQU   CVTXTNT2+4                                               03525000
CVTDSSVA EQU   CVTDSSV+1                                                03526000
CVTRSV89 EQU   CVTDSSV                                                  03527000
CVTRSV88 EQU   CVTXTNT1+8                                               03528000
CVTRSV87 EQU   CVTXTNT1+4                                               03529000
CVTFACHN EQU   CVTXTNT1                                                 03530000
CVTRV488 EQU   CVTMAP+412                                               03531000
CVTRV487 EQU   CVTMAP+408                                               03532000
CVTRV486 EQU   CVTMAP+404                                               03533000
CVTRV485 EQU   CVTMAP+400                                               03534000
CVTACTAP EQU   CVTMAP+396                                               03535000
CVTAUTH  EQU   CVTMAP+392                                               03536000
CVTATMCA EQU   CVTATMCT+1                                               03537000
CVTATMST EQU   CVTATMCT                                                 03538000
CVTRSV61 EQU   CVTMAP+384                                               03539000
CVTVOLT1 EQU   CVTVOLM1+1                                               03540000
CVTVOLI1 EQU   CVTVOLF1                                                 03541000
CVTSTOA  EQU   CVTMAP+376                                               03542000
CVTRSV58 EQU   CVTMAP+374                                               03543000
CVTRSV57 EQU   CVTMAP+372                                               03544000
CVTDDCE  EQU   CVTMAP+368                                               03545000
CVTPNWFR EQU   CVTMAP+364                                               03546000
CVTSMF   EQU   CVTMAP+360                                               03547000
CVTSULK  EQU   CVTMAP+358                                               03548000
CVTSLKO  EQU   CVTSYSK                                                  03549000
CVTSLKP  EQU   CVTSYSK                                                  03550000
CVTSLKQ  EQU   CVTSYSK                                                  03551000
CVTSLKR  EQU   CVTSYSK                                                  03552000
CVTRSV56 EQU   CVTSYSK                                                  03553000
CVTRSV55 EQU   CVTSYSK                                                  03554000
CVTRSV54 EQU   CVTSYSK                                                  03555000
CVTRSV53 EQU   CVTSYSK                                                  03556000
CVTRSV52 EQU   CVTA1F1                                                  03557000
CVTRSV51 EQU   CVTA1F1                                                  03558000
CVTRSV50 EQU   CVTA1F1                                                  03559000
CVTRSV49 EQU   CVTA1F1                                                  03560000
CVTRSV48 EQU   CVTA1F1                                                  03561000
CVTRSV47 EQU   CVTA1F1                                                  03562000
CVTSRSW  EQU   CVTA1F1                                                  03563000
CVTPFSW  EQU   CVTA1F1                                                  03564000
CVTPCVT  EQU   CVTMAP+352                                               03565000
CVTRSV46 EQU   CVTMAP+344                                               03566000
CVTRSV45 EQU   CVTMAP+340                                               03567000
CVTRSV44 EQU   CVTMAP+338                                               03568000
CVTRSV43 EQU   CVTMAP+336                                               03569000
CVTHJESA EQU   CVTHJES+1                                                03570000
CVTRSV42 EQU   CVTHJES                                                  03571000
CVTEXT2A EQU   CVTEXT2+1                                                03572000
CVTRSV41 EQU   CVTEXT2                                                  03573000
CVTAPFA  EQU   CVTAPF+1                                                 03574000
CVTRSV40 EQU   CVTAPF                                                   03575000
CVTRV518 EQU   CVTINTLA                                                 03576000
CVTRV517 EQU   CVTERPV                                                  03577000
CVTEORM  EQU   CVTMAP+312                                               03578000
CVTMCHPR EQU   CVTMAP+308                                               03579000
CVTTZ    EQU   CVTMAP+304                                               03580000
CVTJEPS  EQU   CVTMAP+300                                               03581000
CVTJESCT EQU   CVTMAP+296                                               03582000
CVTMODE  EQU   CVTMAP+292                                               03583000
CVTPTRV  EQU   CVTMAP+288                                               03584000
CVTREAL  EQU   CVTMAP+284                                               03585000
CVTRSV39 EQU   CVTMAP+280                                               03586000
CVTRSV38 EQU   CVTMAP+276                                               03587000
CVTDMSRA EQU   CVTDMSR+1                                                03588000
CVTRV634 EQU   CVTDMSRF                                                 03589000
CVTRV633 EQU   CVTDMSRF                                                 03590000
CVTRV632 EQU   CVTDMSRF                                                 03591000
CVTRV631 EQU   CVTDMSRF                                                 03592000
CVTRV630 EQU   CVTDMSRF                                                 03593000
CVTRV629 EQU   CVTDMSRF                                                 03594000
CVTUDUMP EQU   CVTDMSRF                                                 03595000
CVTSDUMP EQU   CVTDMSRF                                                 03596000
CVTQMSGA EQU   CVTQMSG+1                                                03597000
CVTRSV36 EQU   CVTQMSG                                                  03598000
CVTAMFF  EQU   CVTMAP+264                                               03599000
CVTPURGA EQU   CVTPURG+1                                                03600000
CVTRSV35 EQU   CVTPURG                                                  03601000
CVTCBSP  EQU   CVTMAP+256                                               03602000
CVTATERA EQU   CVTATER+1                                                03603000
CVTSYST  EQU   CVTATER                                                  03604000
CVTVOLT2 EQU   CVTTAT                                                   03605000
CVTVOLI2 EQU   CVTVOLF2                                                 03606000
CVTAQAVB EQU   CVTAQAVT+1                                               03607000
CVTRSV34 EQU   CVTTCMFG                                                 03608000
CVTRSV33 EQU   CVTTCMFG                                                 03609000
CVTRSV32 EQU   CVTTCMFG                                                 03610000
CVTRSV31 EQU   CVTTCMFG                                                 03611000
CVTRSV30 EQU   CVTTCMFG                                                 03612000
CVTRSV29 EQU   CVTTCMFG                                                 03613000
CVTRSV28 EQU   CVTTCMFG                                                 03614000
CVTTCRDY EQU   CVTTCMFG                                                 03615000
CVTGTFA  EQU   CVTGTF+1                                                 03616000
CVTRSV27 EQU   CVTGTFST                                                 03617000
CVTRNIO  EQU   CVTGTFST                                                 03618000
CVTUSR   EQU   CVTGTFST                                                 03619000
CVTRV318 EQU   CVTFORM                                                  03620000
CVTRV317 EQU   CVTTMODE                                                 03621000
CVTRV316 EQU   CVTSTATE                                                 03622000
CVTRV315 EQU   CVTGTFS                                                  03623000
CVTGTFAV EQU   CVTGTFS                                                  03624000
CVT0SCR1 EQU   CVTMAP+232                                               03625000
CVTRV515 EQU   CVTMAP+228                                               03626000
CVTRMS   EQU   CVTMAP+224                                               03627000
CVTPATCH EQU   CVTMAP+220                                               03628000
CVTTSCE  EQU   CVTMAP+216                                               03629000
CVTLNKSC EQU   CVTMAP+214                                               03630000
CVTQABST EQU   CVTMAP+212                                               03631000
CVTMDLDS EQU   CVTMAP+208                                               03632000
CVTUSER  EQU   CVTMAP+204                                               03633000
CVTABEND EQU   CVTMAP+200                                               03634000
CVTSMCA  EQU   CVTMAP+196                                               03635000
CVTRSV18 EQU   CVTMAP+192                                               03636000
CVTQLPAQ EQU   CVTMAP+188                                               03637000
CVTQCDSR EQU   CVTMAP+184                                               03638000
CVTRSV17 EQU   CVTOPTB                                                  03639000
CVTRSV16 EQU   CVTOPTB                                                  03640000
CVTFP    EQU   CVTOPTB                                                  03641000
CVTAPTHR EQU   CVTOPTB                                                  03642000
CVTNLOG  EQU   CVTOPTB                                                  03643000
CVTTOD   EQU   CVTOPTB                                                  03644000
CVTCTIMS EQU   CVTOPTB                                                  03645000
CVTPROT  EQU   CVTOPTB                                                  03646000
CVTXPFP  EQU   CVTOPTA                                                  03647000
CVTASCII EQU   CVTOPTA                                                  03648000
CVTRSV13 EQU   CVTOPTA                                                  03649000
CVTRSV12 EQU   CVTOPTA                                                  03650000
CVTNIP   EQU   CVTOPTA                                                  03651000
CVTDDR   EQU   CVTOPTA                                                  03652000
CVTAPR   EQU   CVTOPTA                                                  03653000
CVTCCH   EQU   CVTOPTA                                                  03654000
CVTSNCTR EQU   CVTMAP+180                                               03655000
CVTQMWR  EQU   CVTMAP+176                                               03656000
CVTQOCR  EQU   CVTMAP+172                                               03657000
CVT1EF00 EQU   CVTMAP+168                                               03658000
CVTMZ00  EQU   CVTMAP+164                                               03659000
CVTHEAD  EQU   CVTMAP+160                                               03660000
CVTRSV11 EQU   CVTMAP+156                                               03661000
CVT0PT01 EQU   CVTMAP+152                                               03662000
CVTMSER  EQU   CVTMAP+148                                               03663000
CVTRV516 EQU   CVTIERLC                                                 03664000
CVTILCH  EQU   CVTMAP+140                                               03665000
CVT0DS   EQU   CVTMAP+136                                               03666000
CVTFBOSV EQU   CVTMAP+132                                               03667000
CVTNUCB  EQU   CVTMAP+128                                               03668000
CVTIXAVL EQU   CVTMAP+124                                               03669000
CVTIOQET EQU   CVTMAP+120                                               03670000
CVTDCBA  EQU   CVTMAP+117                                               03671000
CVTMVS2  EQU   CVTDCB                                                   03672000
CVT6DAT  EQU   CVTDCB                                                   03673000
CVT4MPS  EQU   CVTDCB                                                   03674000
CVTRSV09 EQU   CVTDCB                                                   03675000
CVT4MS1  EQU   CVTDCB                                                   03676000
CVT2SPS  EQU   CVTDCB                                                   03677000
CVT1SSS  EQU   CVTDCB                                                   03678000
CVTRSV08 EQU   CVTDCB                                                   03679000
CVTSTB   EQU   CVTMAP+112                                               03680000
CVTQTD00 EQU   CVTMAP+108                                               03681000
CVTQTE00 EQU   CVTMAP+104                                               03682000
CVTCUCB  EQU   CVTMAP+100                                               03683000
CVTSJQ   EQU   CVTMAP+96                                                03684000
CVTPBLDL EQU   CVTMAP+92                                                03685000
CVTTPC   EQU   CVTMAP+88                                                03686000
CVTSVDCB EQU   CVTMAP+84                                                03687000
CVTBRET  EQU   CVTMAP+82                                                03688000
CVTEXIT  EQU   CVTMAP+80                                                03689000
CVT0FN00 EQU   CVTMAP+76                                                03690000
CVTDARA  EQU   CVTDAR+1                                                 03691000
CVTRSV07 EQU   CVTFLGS1                                                 03692000
CVTRSV06 EQU   CVTFLGS1                                                 03693000
CVTRSV05 EQU   CVTFLGS1                                                 03694000
CVTRSV04 EQU   CVTFLGS1                                                 03695000
CVTRSV03 EQU   CVTFLGS1                                                 03696000
CVTRSV02 EQU   CVTFLGS1                                                 03697000
CVTRSV01 EQU   CVTFLGS1                                                 03698000
CVTDMPLK EQU   CVTFLGS1                                                 03699000
CVTXITP  EQU   CVTMAP+68                                                03700000
CVTMSLT  EQU   CVTMAP+60                                                03701000
CVTDATE  EQU   CVTMAP+56                                                03702000
CVTBTERM EQU   CVTMAP+52                                                03703000
CVTSYSAD EQU   CVTMAP+48                                                03704000
CVTXTLER EQU   CVTMAP+44                                                03705000
CVTILK2  EQU   CVTMAP+40                                                03706000
CVTILK1  EQU   CVTMAP+36                                                03707000
CVTPRLTV EQU   CVTMAP+32                                                03708000
CVTPCNVT EQU   CVTMAP+28                                                03709000
CVT0VL00 EQU   CVTMAP+24                                                03710000
CVTXAPG  EQU   CVTMAP+20                                                03711000
CVTBUF   EQU   CVTMAP+16                                                03712000
CVTJOB   EQU   CVTMAP+12                                                03713000
CVTLINK  EQU   CVTMAP+8                                                 03714000
CVT0EF00 EQU   CVTMAP+4                                                 03715000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      03716000
@RC00271 EQU   @RC00255                                                 03717000
@RC00300 EQU   FREEDSCB                                                 03718000
@RF00306 EQU   @RC00293                                                 03719000
@RC00317 EQU   @RC00314                                                 03720000
@RC00324 EQU   @RC00321                                                 03721000
@RC00342 EQU   @RC00341                                                 03722000
@RC00353 EQU   @RC00332                                                 03723000
@RC00361 EQU   @RC00332                                                 03724000
@RC00400 EQU   @RC00399                                                 03725000
@RF00440 EQU   @RC00434                                                 03726000
@RC00354 EQU   @RC00353                                                 03727000
@ENDDATA EQU   *                                                        03728000
         END   IGG0325I,(C'PLS0146',0701,77064)                         03729000
./  ADD  SSI=32510335,NAME=IGG0325K
 TITLE 'IGG0325K - DADSM USER LABEL SPACE'                              00200000
IGG0325K CSECT                                                          00300021
*                                                                       00350002
*MODULE NAME = IGG0325K                                                 00400002
*                                                                       00450002
*DESCRIPTIVE NAME = DADSM USER LABEL SPACE                              00500002
*                                                                       00550002
*COPYRIGHT = NONE                                                       00560002
*                                                                       00570002
*CHANGE ACTIVITY = SEE BELOW                                            00580002
*                                                                       00590002
*          RELEASE 18 DELETIONS                                         00600000
*          RELEASE 19 DELETIONS                                         00800000
*          RELEASE 20 DELETIONS                                         01000000
*          RELEASE 21 DELETIONS                                         01200000
*1196026000-044000,048000,056000,070000,102000,124000,200000-    A42477 01230021
*1196206000,212000-224000,234000,238000,266000-276000,298000-    A42477 01260021
*1196316000,342000,362000,386000,414000,428000,442000,482000,    A42477 01290021
*1196488000,496000,518000,522000-524000,562000-564000,570000,    A42477 01320021
*1196584000,592000,628000,808000                                 A42477 01350021
*0000060000,236160-236560,570000-592000,806000                   A46776 01360021
*          RELEASE 22 DELETIONS                                         01400000
*          VS2 RELEASE 02 DELETIONS/CHANGES                             01600002
*0000000300-001500,016000-022000,027000-032000,037000,066000,    Y02080 01600102
*0000080000,086000-088200,092000,108000,122000-125000,203000,    Y02080 01600202
*0000230000,233000-233500,237040-237200,237360-238800,252000,    Y02080 01600302
*0000256000,262000,302000-305000,485000,501000-504000,508000-    Y02080 01600402
*0000510000,514000,518000,566000,568500-624000,626000-646000,    Y02080 01600502
*0000650000-660000,664000-790000                                 Y02080 01600602
*                                                                       02000002
* STATUS CHANGE LEVEL 003                                               02400021
*                                                                     * 02500021
*FUNCTION/OPERATION: THIS MODULE PROCESSES USER LABEL REQUESTS FOR    * 02600021
*   ALL ALLOCATION REQUESTS EXCEPT ABSOLUTE TRACK.  IT CONVERTS THE   * 02700002
*   FORMAT 5 DSCB IN CORE FROM XXYYZ TO RTA/NUMBER OF TRACKS FORMAT.  * 02750002
*   A ONE TRACK RTA/RTA+1 WILL BE TAKEN FROM THE SMALLEST EXTENT IN   * 03300021
*   THE FIRST FORMAT 5.                                               * 03400021
*                                                                     * 03500021
*ENTRY POINTS:                                                        * 03600021
*   IGG0325K - ENTRY IS MADE FROM IGG0325B VIA A BRANCH.              * 03700002
*                                                                     * 04600000
*INPUT: AT ENTRY TO THIS MODULE, THE WORK AREA CONTAINS THE DATA      * 04800021
*   PORTION OF THE FORMAT 4 DSCB AND ITS ADDRESS, THE FIRST DADSM     * 05000000
*   RECORD (F5) AND ITS ADDRESS, A DEB, AN IOB, AN ECB, AND A CHANNEL * 05200000
*   PROGRAM TO READ DADSM RECORDS.                                    * 05400000
*   THE 'FIRST FORMAT 5 DSCB IN CORE' SWITCH WILL BE ON.              * 05600021
*   REGISTER 10 WILL CONTAIN THE SPACE REQUEST IN TRACKS.             * 05800000
*   REGISTER 11 WILL POINT TO A JFCB OR PARTIAL DSCB.                 * 06000021
*   REGISTER 13 WILL POINT TO THE WORK AREA.                          * 06200000
*                                                                     * 06400000
*OUTPUT- UPON TRANSFER OF CONTROL, THE WORK AREA AND REGISTERS WILL   * 06600002
*   BE AS AT INPUT WITH THE FOLLOWING ADDITIONS.                      * 06800000
*   THE FIRST FORMAT 5 HAS BEEN UPDATED BY TAKING OUT THE TRACK(S)    * 06900021
*   NEEDED FOR THE USER LABEL(S).                                     * 07000021
*   A USER LABEL EXTENT IS SAVED IN THE WORK AREA.                      07200000
*                                                                       07400000
*                                                                     * 07600000
*EXTERNAL ROUTINES-                                                   * 07800000
*        IECRES - BRANCH TO ANOTHER MODULE                            * 08000002
*                                                                     * 08200000
*                                                                       08400000
*EXITS- NORMAL- BRANCH TO IGG0325D TO OBTAIN PRIMARY QUANTITY         * 08600002
*               BRANCH TO IGG0325E IF A ZERO QUANTITY REQUEST         * 08800002
*       ERROR - BRANCH TO IGG0325H WITH A CODE IN THE ERROR CODE      * 08820002
*               PASS REGISTER                                         * 08840021
*                                                                     * 08860021
*       ERROR CODES THAT CAN BE ISSUED BY THE 'USER LABEL' ROUTINE:   * 08880021
*                                                                     * 08900021
*       14 - QUANTITY NOT AVAILABLE                                   * 08920021
*                                                                       09000000
*TABLES/WORK AREAS- DADSM WORK AREA DESCRIBED BY MACRO 'IECALLWA'     * 09200002
*                                                                     * 09400000
*              USER LABEL EXTENT AS FOLLOWS-                            09600000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.      * 09800000
*                                                                     * 10000000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT* 10200021
*                                                                     * 10400000
*                                                                     * 10600000
*ATTRIBUTES- REENTRANT                                                * 10800002
*                                                                     * 11000000
*NOTES-                                                               * 11200000
*   OTHER MACROS USED                                                 * 11400000
*   IECALLWA - ALLOCATE WORK AREA EXPANSION                           * 11450002
*   IECSDSL1 - BUILD DSCB'S                                           * 11600000
*   IEFJFCBN - BUILD JFCB                                             * 11800000
*   CVT - BUILD CVT                                                   * 11850002
*                                                                     * 12000000
*STORAGE: PROGRAM CODE CSECT - LESS THAN 1024 BYTES                   * 12400002
*   WORK AREA - AS DEFINED IN THE IECALLWA MACRO                      * 12500002
*   RPS WORK AREA - AS DEFINED IN THE IECRPS MACRO                    * 12550002
*                                                                     * 12600000
*                                                                       12800000
*REGISTER USAGE-                                                        13000000
RCNT     EQU   1                        LOOP COUNTER                    13200000
ROUT     EQU   2                        OUTPUT POINTER                  13400000
RIN      EQU   3                        DADSM POINTER                   13600000
RTA1     EQU   4                        CONVERSION ROUTINE RTA+1 REG    13800000
R5       EQU   5                                                        14000000
RTA      EQU   5                       CONVERSION ROUTINE RTA REG       14200000
R6       EQU   6                                                        14400000
RHH      EQU   6                        CONVERSION ROUTINE TRK REG      14600000
R7       EQU   7                                                        14800000
RCC      EQU   7                        CONVERSION ROUTINE CYL REG      15000000
RTTRPTR  EQU   7                        PTR TO XCTL BY TTR TABLE ENTRY  15200000
R8       EQU   8                                                        15400000
RTRK     EQU   8                        CONTAINS NBR OF TRKS/CYL        15600000
RERRPASS EQU   8                        ERROR PASS REGISTER             15800000
R9       EQU   9                                                        16000000
RJFCBA   EQU   9                        ALTERNATE JFCB POINTER   A42477 16100021
RA       EQU   10                                                       16200000
REQ      EQU   10                 PRIMARY QUANTITY PASSED FROM CTR      16400000
RJFCB    EQU   11                       JFCB POINTER                    16600000
RBASE    EQU   12                       BASE REGISTER                   16800000
RWKA     EQU   13                       WORK AREA POINTER               17000000
RBAK     EQU   14                 RETURN REGISTER                       17200000
RF       EQU   15                                                       17400000
*                                                                       17450021
* OTHER EQUATES                                                         17500021
*                                                                       17550021
ZERO     EQU   0                                                        17600000
ONE      EQU   1                                                        17800000
TWO      EQU   2                                                        18000000
THREE    EQU   3                                                        18200000
FOUR     EQU   4                                                        18400000
FIVE     EQU   5                                                        18600000
EGHT     EQU   8                                                        18800000
TWEL     EQU   12                                                       19000000
TWNTY    EQU   20                                                       19200000
TWNTY6   EQU   26                                                       19400000
NTY      EQU   90                                                       19600000
ONE40    EQU   140                                                      19800000
*                                                                       20800000
*                                                                       21000000
         BALR  RBASE,0                  ESTABLISH BASE REGISTERS        22600000
         USING START,RBASE                                              22800000
         USING ALLOCWKA,RWKA            WORK AREA ADDRESSABILITY Y02080 23000002
         USING JFCBFLD,RJFCB                                            23200000
*                                                                       23250021
* THIS SECTION TESTS FOR CYLINDER REQUESTS AND AVERAGE RECORD LENGTH    23300002
* REQUESTS SPECIFYING THE ROUND OPTION.                                 23350002
*                                                                       23400021
START    EQU   *                                                 A42477 23450021
         XC    DADSMTBL+2(14),DADSMTBL+2  CLEAR DADSM TABLE      A42477 23500021
         MVI   DADSMTBL+EGHT,X'7F'      INITIALIZE QUANTITY             23600000
         LTR   RJFCBA,RJFCB             INITIALIZE ALTERNATE PTR A42477 23608021
         BP    TESTYPE                  BRANCH IF NOT A PARTIAL  A46776 23616021
*                                       F1 DSCB                  A46776 23624021
         TM    PD1SCALO,JFCBCYL         TEST IF CYLINDER REQUEST A46776 23632021
         BO    ONETRACK                 BRANCH IF YES            A46776 23640021
         TM    PD1SCALO,JFCBAVR+JFCROUND  TEST IF RECORD         A46776 23642021
*                                       ROUNDED REQUEST          A46776 23650021
         BO    ONETRACK                 BRANCH IF YES            A46776 23656021
         B     CONVERT                  GO CONVERT THE F5 DSCB   A42477 23664021
TESTYPE  EQU   *                                                 A42477 23672021
         TM    JFCBCTRI,X'C0'           TEST IF CYLINDER REQUEST A42477 23680021
         BO    CYLREQ                   BRANCH IF YES            A42477 23688021
         TM    JFCBCTRI,X'41'           TEST IF RCD ROUNDED REQ  A42477 23696021
         BNO   CONVERT                  BRANCH IF NOT            Y02080 23704002
CYLREQ   EQU   *                                                 A42477 23728021
ONETRACK EQU   *                                                 A42477 23888021
         LA    RF,ONE                   ONE TRACK NECESSARY      A42477 23896021
         STH   RF,LABELREQ              NBR OF REQUESTED LABELS  A42477 23912021
*                                                                       23920021
* THIS SECTION CONVERTS THE FIRST FORMAT 5 DSCB FROM XXYYZ FORMAT       23928021
* TO RTA/NUMBER OF TRACKS.                                              23936021
*                                                                       23944021
CONVERT  EQU   *                                                 A42477 23952021
         MVC   DS5FMTID(NTY),DS5MAVET   REMOVE ID FROM FORMAT 5         24000000
         LA    RCNT,TWNTY6              SET TO MAX NBR OF EXTENTS       24200000
         LH    RTRK,DS4DEVSZ+2         LOAD NBR OF TRKS/CYL             24400000
         LA    RIN,DS5AVEXT        SET INPUT PTR TO 1ST EXTENT          24600000
         LA    ROUT,DS1DSNAM       SET UP OUTPUT PTR FOR CONVERTED EXTS 24800000
         XC    DS1DSNAM(ONE40),DS1DSNAM CLEAR OUTPUT AREA               25000000
TESTO    EQU   *                        BRANCH LABEL             Y02080 25100002
         MVC   FULLWORD(FOUR),ZERO(RIN) ALIGN RTA AND NBR CYLS   Y02080 25200002
         SR    RTA1,RTA1               CLEAR HIGH DIVIDEND REGISTER     25400000
         LH    RTA,FULLWORD             GET RTA                  Y02080 25600002
         LTR   RTA,RTA                 IS THIS EXTENT ZERO              25800000
         BZ    INCRIN                  BRANCH IF YES                    26000000
         LH    RCC,FULLWORD+TWO         GET NUMBER OF FULL CYLS  Y02080 26200002
         MR    RHH,RTRK                CONVERT CYLS TO TRKS             26400000
         TM    LABELREQ+1,X'FF'         TEST IF CYLINDER REQUEST A42477 26800021
         BC    5,TESTTRK                BRANCH IF YES            A42477 27200021
ADD      IC    RHH,FOUR(RIN)            GET EXCESS TRKS                 27800000
         AR    RCC,RHH                 CALCULATE TOTAL TRKS THIS EXT    28000000
*                                                                       28200000
* SAVE SMALL TRACK EXTENT                                               28400000
*                                                                       28600000
         CH    RCC,DADSMTBL+EGHT        LESS THAN TRACKS SAVED          28800000
         BH    ADDA                     BRANCH IF NOT                   29000000
         STH   RCC,DADSMTBL+EGHT        SAVE NUMBER OF TRACKS           29200000
         ST    ROUT,DADSMTBL+4          STORE ADDRESS OF RTA            29400000
         B     ADDA                    GO STORE RTA AND NBR TRKS        29600000
*                                                                       29900021
* THIS SECTION ASSURES THAT CYLINDER REQUESTS                           30200002
* AND AVERAGE RECORD LENGTH REQUESTS SPECIFYING THE                     30500002
* ROUND OPTION ARE ALIGNED ON CYLINDER BOUNDARIES.                      30800021
*                                                                       31100021
TESTTRK  LTR   RCC,RCC                  ARE TRACKS ZERO                 31800000
         BZ    NOCYL                    BRANCH IF YES                   32000000
         DR    RTA1,RTRK                CONVERT RTA TO CYL AND TRACKS   32200000
         LR    RHH,RTA1                 SAVE EXTRA TRACKS               32400000
         MR    RTA1,RTRK                REALIGN RTA ON CYL BOUNDARY     32600000
         LTR   RHH,RHH                  ARE TRACKS REMAINING            32800000
         BZ    SMALLEXT                 BRANCH IF NO                    33000000
         AR    RTA,RTRK                 INCREMENT RTA                   33200000
         LR    RBAK,RTRK                TRACK CONSTANT                  33400000
         SR    RBAK,RHH                 SUBTRACT REMAINDER              33600000
         CLC   DADSMTBL+TWEL(TWO),ZEROS IS RTA SAVED                    33800000
         BNE   SMALLEXT                 BRANCH IF YES                   34000000
         CH    RBAK,LABELREQ            DO EXTRA TRACKS FILL     A42477 34100021
*                                       REQUEST?                 A42477 34200021
         BL    SMALLEXT                 BRANCH IF NO                    34400000
         STH   RTA,DADSMTBL+TWEL        STORE RTA OF EXTENT - RTA+1     34600000
SMALLEXT CH    RCC,DADSMTBL+EGHT        TRACKS LESS THAN SAVED          34800000
         BH    ADDA                     BRANCH IF NO                    35000000
         STH   RCC,DADSMTBL+EGHT        STORE NUMBER OF TRACKS          35200000
         ST    ROUT,DADSMTBL+4          STORE RTA ADDRESS               35400000
         B     ADDA                     UNCONDITIONAL BRANCH            35600000
NOCYL    SR    RHH,RHH                                                  35800000
         IC    RHH,FOUR(RIN)            INSERT TRKS THIS EXTENT         36000000
         CH    RHH,LABELREQ             DOES IT FILL REQUEST?    A42477 36200021
         BL    ADDA                     BRANCH IF NO                    36400000
         CH    RHH,DADSMTBL+EGHT        LESS THAN TRACKS SAVED          36600000
         BH    ADDA                     BR IF NOT                       36800000
         STH   RHH,DADSMTBL+EGHT        SAVE NEW LOW                    37000000
         ST    ROUT,DADSMTBL+4          RTA ADDRESS                     37200000
ADDA     STH   RTA,ZERO(ROUT)           STORE RTA IN OUTPUT             37400000
         STH   RCC,TWO(ROUT)            STORE NUMBER OF TRKS AVAIL      37600000
CONT     LA    ROUT,FOUR(ROUT)          STEP OUTPUT POINTER             37800000
INCRIN   LA    RIN,FIVE(RIN)            STEP INPUT POINTER              38000000
         BCT   RCNT,TESTO              BRANCH IF MORE EXTENTS           38200000
         LA    ROUT,DS1DSNAM           RESET OUTPUT POINTER             38400000
         TM    LABELREQ+1,X'FF'         TEST IF CYLINDER REQUEST A42477 38600021
         BZ    TRKREQ                   BRANCH IF ZERO TO TRACK REQUEST 38800000
*                                                                       39000000
* CYLINDER USER LABEL REQUEST                                           39200000
* TAKE THE USER LABEL TRACK FROM A TRACK EXTENT IF ONE IS AVAILABLE.    39400000
* IF NOT USE LEFT OVER TRACKS IN FRONT OF A CYLINDER.                   39600000
*                                                                       39800000
         L     ROUT,DADSMTBL+4          LOAD RTA ADDRESS                40000000
         LTR   ROUT,ROUT                RTA ZERO                        40200000
         BZ    EXIT                     BRANCH IF YES                   40400000
         CLC   TWO(ROUT,TWO),ZEROS      NUMBER OF TRACKS ZERO           40600000
         BNE   NONTRK                   BRANCH IF YES                   40800000
         LH    RTA,ZERO(ROUT)           PICK UP RTA                     41000000
         STH   RTA,USERLBL              RTA OF USER LABEL               41200000
         AH    RTA,LABELREQ             ADD NBR OF USER LABELS   A42477 41400021
         STH   RTA,USERLBL+2            STORE RTA+1                     41600000
         B     EXIT                     UNCONDITIONAL BRANCH            41800000
NONTRK   CLC   DADSMTBL+TWEL(TWO),ZEROS EXTRA TRACKS AVAILABLE          42000000
         BE    CYLEXT                   BR IF NO                        42200000
         LH    RTA,DADSMTBL+TWEL        RTA SAVED                       42400000
         STH   RTA,USERLBL+2            RTA+1 OF USER LABEL             42600000
         SH    RTA,LABELREQ             SUBTRACT USER LABEL TRKS A42477 42800021
         STH   RTA,USERLBL              RTA OF USER LABEL               43000000
         B     EXIT                     UNCONDITIONAL BRANCH            43200000
CYLEXT   LH    RTA,ZERO(ROUT)           PICK UP RTA                     43400000
         AR    RTA,RTRK                 ADD TRKS/CYL                    43600000
         STH   RTA,ZERO(ROUT)           STORE NEW RTA                   43800000
         STH   RTA,USERLBL+2            STORE USER LABEL RTA+1          44000000
         SH    RTA,LABELREQ             SUBTRACT USER LABEL TRKS A42477 44200021
         STH   RTA,USERLBL              STORE USER LABEL RTA            44400000
         LH    RCC,TWO(ROUT)            TRACKS AVAILABLE                44600000
         SR    RCC,RTRK                 SUBR. TRKS/CYL                  44800000
         STH   RCC,TWO(ROUT)            STORE NEW TRACKS AVAILABLE      45000000
         B     EXIT                     UNCONDITIONAL BRANCH            45200000
*                                                                       45400000
* FILL USER LABEL EXTENT FOR A TRACK REQUEST FROM THE SMALL EXTENT      45600000
*                                                                       45800000
TRKREQ   L     ROUT,DADSMTBL+4          RTA ADDRESS                     46000000
         LTR   ROUT,ROUT                HAS ADDRESS BEEN SAVED          46200000
         BZ    EXIT                     BRANCH IF NOT                   46400000
         LH    RTA,ZERO(ROUT)           RTA                             46600000
         STH   RTA,USERLBL              USER LABEL RTA                  46800000
         LA    RTA,ONE(RTA)             ONE TRACK                       47000000
         STH   RTA,ZERO(ROUT)           UPDATE RTA IN FORMAT 5          47200000
         STH   RTA,USERLBL+2            USER LABEL RTA+1                47400000
         LH    RCC,TWO(ROUT)            UPDATE NUMBER OF TRACKS AVAIL.  47600000
         BCTR  RCC,0                    COUNTING                        47800000
         STH   RCC,TWO(ROUT)                                            48000000
*                                                                       48400000
* THIS SECTION DETERMINES THE 'BRANCH TO' MODULE.                       48500002
*                                                                       48600000
EXIT     EQU   *                                                 A42477 48700021
         CLC   USERLBL(TWO),ZEROS       TEST FOR A USER LABEL    A42477 48800021
         BE    NOSPACE                  BRANCH IF NOT                   49000000
         LA    ROUT,DS1DSNAM            RESTORE POINTER                 49200000
         XC    DADSMTBL+4(TWEL),DADSMTBL+4   CLEAR DADSM TABLE          49400000
         LTR   REQ,REQ                  TEST IF ZERO QUANTITY    A42477 49600021
         BZ    SETTBL                   BRANCH IF YES                   49800000
         LA    RTTRPTR,ALLOCA2          LOAD PTR TO CYL/TRK LOAD        50000000
*                                                                       50600000
XCTLHERE EQU   *                        BRANCH LABEL             Y02080 50800002
         XC    LABELREQ(2),LABELREQ     CLEAR UHOLECTR FIELD     A42477 51100021
*                                                                       51200000
* BRANCH TO A SUBSEQUENT DADSM ALLOCATE MODULE.                         51400002
*                                                                       51600000
         IECRES LOAD,EXTPR=(RWKA),MODID=(RTTRPTR),BRANCH=DIRECT  Y02080 51800002
*                                                                       52000000
* IF ZERO QUANTITY, SET UP LABEL EXTENT IN DADSMTBL AND GO TO BUILD     52300021
* FORMAT 1 LOAD                                                         52600000
*                                                                       52800000
SETTBL   MVC   DADSMTBL+4(FOUR),USERLBL SET UP USER LABEL EXTENT        53000000
         MVI   DADSMTBL+1,X'01'         ONE EXTENT IN TABLE             53200000
         LA    RTTRPTR,ALLOCA3          LOAD PTR TO F1/F3 ENTRY         53400000
         B     XCTLHERE                 UNCONDITIONAL BRANCH            53600000
*                                                                       53800000
* NO USER LABEL SPACE, EXIT TO LAST LOAD                                54000000
*                                                                       54200000
NOSPACE  LA    RTTRPTR,ALLOCD2          LOAD PTR TO LAST ALLOCATE LOAD  54400000
         LA    RERRPASS,TWNTY           SET CODE 'QUANTITY NOT AVAIL'   54600000
         B     XCTLHERE                 UNCONDITIONAL BRANCH            54800000
* * * * * * * * * * * * *                                               55000000
*                                                                       55200000
***   CONSTANTS                                                         55400000
*                                                                       55600000
* * * * * * * * * * * * *                                               55800000
*                                                                       56000000
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         56600002
*                                                                       56800000
         XCTLTABL ID=(ALLOCA2,5D,ALLOCA3,5E,ALLOCD2,5H),SVC=032, Y02080X56850002
               LENGTH=,BRT=YES                                   Y02080 56900002
         EJECT                                                   Y02080 56950002
DSCBWKAR IECALLWA EP,F4,D1=(1),D2=(5)   ALLOCATE WORK AREA       Y02080 60600002
LABELREQ EQU   UHOLECTR                 NBR OF USER LABELS       A42477 62500021
ZEROS    EQU   CCW4+4                                                   64800000
USERLBL  EQU   CCW10+4                                                  66200000
         EJECT                                                   Y02080 66250002
CVT      DSECT                          CVT DSECT                Y02080 66300002
         CVT                                                     Y02080 66350002
         EJECT                                                   Y02080 66400002
*                                                                       79200000
* * * * * * * * * * * * *                                               79400000
*                                                                       79600000
* * * * * * * * * * * * *                                               79800000
*                                                                       80000000
JFCBFLD  DSECT                                                          80200000
         IEFJFCBN                                                       80400000
         EJECT                                                   Y02080 80410002
*                                                                       80450021
* * * * * * * * * * * * *                                               80500021
*                                                                       80550021
***   DSECT FOR THE PARTIAL DSCB PASSED TO ALLOCATE BY IEHMOVE   A46776 80600021
*                                                                       80650021
* * * * * * * * * * * * *                                               80700021
*                                                                       80750021
         ORG   INFMJFCB                                                 80800021
PD1DSNAM DS    CL44                DATA SET NAME                        80850021
PD1FMTID DS    CL1                 FORMAT IDENTIFIER                    80900021
PD1DSSN  DS    CL6                 DATA SET SERIAL NUMBER               80950021
PD1VOLSQ DS    XL2                 VOLUME SEQUENCE NUMBER               81000021
PD1CREDT DS    XL3                 CREATION DATE                        81050021
PD1EXPDT DS    XL3                 EXPIRATION DATE                      81100021
PD1NOEPV DS    XL1                 NUMBER OF EXTENTS ON VOLUME          81150021
PD1NOBDB DS    XL1                 NUMBER OF BYTES USED IN LAST         81200021
*                                     DIRECTORY BLOCK                   81250021
         DS    XL1                 RESERVED                             81300021
PD1SYSCD DS    CL13                SYSTEM CODE                          81350021
         DS    XL7                 RESERVED                             81400021
PD1DSORG DS    XL2                 DATA SET ORGANIZATION                81450021
PD1RECFM DS    XL1                 RECORD FORMAT                        81500021
PD1OPTCD DS    XL1                 OPTION CODE                          81550021
PD1BLKL  DS    XL2                 BLOCK LENGTH                         81600021
PD1LRECL DS    XL2                 RECORD LENGTH                        81650021
PD1KEYL  DS    XL1                 KEY LENGTH                           81700021
PD1RKP   DS    XL2                 RELATIVE KEY POSITION                81750021
PD1DSIND DS    XL1                 DATA SET INDICATORS                  81800021
PD1SCALO DS    XL4                 SECONDARY ALLOCATION                 81850021
PD1LSTAR DS    XL3                 LAST USED TRACK AND BLOCK ON TRACK   81900021
PD1TRBAL DS    XL2                 BYTES REMAINING ON LAST TRACK USED   81950021
         DS    XL2                 RESERVED                             82000021
PD1EXT1  DS    XL1                 EXTENT TYPE INDICATOR                82050021
         DS    XL2                 UNUSED                               82100021
PDPRIQTY DS    F                   PRIMARY SPACE REQUEST IN TRACKS      82150021
PDDIRQTY DS    F                   NUMBER OF DIRECTORY BLOCKS           82200021
         END   IGG0325K                                          A42477 89600021
./  ADD  SSI=50050108,NAME=IGG0325P
 TITLE 'IGG0325P - NON-SPLIT-CYLINDER DATA SET PROCESSING'              00100021
IGG0325P CSECT                                                          00150021
*                                                                     * 00200018
* MODULE NAME = IGG0325P                                                00202002
*                                                                       00204002
* DESCRIPTIVE NAME = NON-SPLIT-CYLINDER DATA SET PROCESSING             00206002
*                                                                       00206402
* COPYRIGHT = NONE                                                      00206802
*                                                                       00206902
* CHANGE ACTIVITY = SEE BELOW                                           00208702
*                                                                       00209102
*          RELEASE 19 DELETIONS                                       * 00210602
*2754154000-164000                                               A27358 00212402
*          RELEASE 20 DELETIONS                                       * 00214202
*3361064000,096000,404000-405000                                 A31534 00216002
*3361260000-267000                                               A29936 00217802
*3361114000,244000-246000,401000-403000,413000-416000            A30794 00219602
*3361007000-013000,036000,060000-061000,066000,171000-180000,    A31333 00221402
*3361195000-196000,247000,249000,285000,302000-304000,311000,    A31333 00223202
*3361331000-336000,341000-342000,351000,352000,372000,375000,    A31333 00225002
*3361381000                                                      A31333 00226802
*3361                                                            A36311 00228602
*          RELEASE 21 DELETIONS                                       * 00230402
*1191007000-013000,016000,022000,380000,389000,395000,421000,    M0124  00232202
*1191423000-432000,434000-444000,446000,447000,449000-472000,    M0124  00234002
*1191474000-476000,482000,485000,487000-489000,497000            M0124  00235802
*1191064000,136000,392000-393000,401800-402800                   S21040 00237602
*0000001000,310000                                               A53183 00239402
*          RELEASE 22 DELETIONS                                       * 00241202
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00243002
*0000000100-000500,002350-002630,036000-037000,058000,059600-    Y02080 00244802
*0000060200,062000,064000,066400,068000,075000,082000,112000,    Y02080 00246602
*0000119000-135000,139000,151000,159600-160200,162600,175600,    Y02080 00248402
*0000187000,188040-188080,188160,188400,189000,201000,204000-    Y02080 00250202
*0000205000,209000,211000,228000,236000,236600,258000,269000-    Y02080 00252002
*0000270000,275000,277000,294000-295000,313000,315000,337000-    Y02080 00253802
*0000340000,348000,352400-355000,364000,368000,372000-372500,    Y02080 00255602
*0000376000-380000,382000-383000,391000-394000,397000-400000,    Y02080 00257402
*0000400500,400600-416200,418000-433000,446000-486000,492000-    Y02080 00259202
*0000504000,506000,509000-510000,512000-574000                   Y02080 00261002
*0000011000,013000,021000-024000,026000-032000,035000-042000,    Y02078 00262802
*0000045000-047000,050000-052000,060800-061400,063000,065200-    Y02078 00264602
*0000066200,091000,118500,135500,168200-168600,168950,236300,    Y02078 00266402
*0000366000-371000                                               Y02078 00268202
*          VS2 RELEASE 03.0 DELETIONS/CHANGES                         * 00268602
*0000                                                           ZA00008 00269002
*0000168380,168410,168440,168470,168490-168500,168520-168530,   ZA00117 00269102
*0000168550                                                     ZA00117 00269202
*                                                                     * 00270018
*STATUS CHANGE LEVEL 004                                                00277021
*                                                                     * 00284018
*                                                                     * 00300018
*  NAME IGG0325P                                                      * 00400018
*                                                                     * 00500018
* FUNCTION OPERATION  THIS MODULE READS THE DSCB'S IN THE VTOC ONE    * 00600018
*   AT A TIME. IT CONVERTS NON-SPLIT CYLINDER ALLOCATED EXTENTS TO    * 00700021
*   RTA/RTA+1 FORMAT AND SUBTRACTS THESE EXTENTS FROM THE FREE SPACE  * 00800021
*   IN THE RE-INITIALIZED FORMAT 5. AT ANY POINT IN THE PROCESSING    * 00900021
*   WHEN THE FREE SPACE EXISTS IN MORE THAN 26 EXTENTS, THE MODULE    * 01000021
*   BRANCHES TO IGG0325R TO SUBTRACT FUTURE ALLOCATED EXTENTS. THE    * 01100002
*   MODULE ALSO TESTS FOR SPLIT CYLINDER DATA SETS TO DETERMINE IF    * 01200021
*   FORMAT 6 PROCESSING MUST BE DONE.  WHENEVER IGG0325P READS A      * 01210002
*   FORMAT 5 DSCB, IT STORES ITS CCHHR IN A VTOC CONVERSION WORK      * 01220002
*   AREA EXTENSION, WHICH IS CHAINED FROM THE ALLOCATE WORK AREA.     * 01230002
*   IF MORE THAN ONE FORMAT 5 DSCB IS CREATED DURING THE PROCESS      * 01240002
*   OF SUBTRACTING THE NON-SPLIT CYLINDER DATA SET EXTENTS FROM       * 01250002
*   THE FREE SPACE, THE RE-INITIALIZED FORMAT 5 DSCB'S ARE STORED     * 01260002
*   IN A VTOC CONVERSION WORK AREA EXTENSION OR EXTENSIONS.  IF       * 01270002
*   THERE WAS ORIGINALLY ONLY ONE FORMAT 5 DSCB ON THE VOLUME,        * 01280002
*   ONLY ONE FORMAT 5 WAS REBUILT, AND THERE ARE NO SPLIT CYLINDER    * 01290002
*   DATA SET EXTENTS, THEN THE REBUILT FORMAT 5 IS IN 'DSCBF5.'       * 01300002
*   OTHERWISE, THE REBUILT FORMAT 5 DSCB(S) ARE STORED IN THE VTOC    * 01310002
*   CONVERSION WORK AREA EXTENSION(S).                                * 01320002
*                                                                     * 01400018
* ENTRY POINTS                                                        * 01500018
*        IGG0325P- FROM IGG0325Z TO BEGIN BUILDING FORMAT 5 DSCB'S    * 01600021
*                  FROM IGG0325R TO PLACE MORE ALLOCATED EXTENTS      * 01700018
*                                IN THE DADSMTABLE                    * 01800018
*                                                                     * 01900018
* INPUT  FROM IGG0325Z                                                * 02000018
*              REGISTER 13 POINTS TO THE ALLOCATE WORK AREA, WHICH    * 02100002
*              CONTAINS THE FIRST RE-INITIALIZED FORMAT 5 DSCB AND    * 02200002
*              THE FORMAT 4 DSCB. 'COUNT' CONTAINS THE CCHHR OF THE   * 02300002
*              THIRD DSCB IN THE VTOC.                                * 02400002
*                                                                     * 02500018
*        FROM  IGG0325R                                               * 02600002
*              REGISTER 13 POINTS TO THE ALLOCATE WORK AREA, WHICH    * 02700002
*              CONTAINS THE FORMAT 4 DSCB, THE LAST FORMAT 1 OR 3     * 02800002
*              DSCB READ, AND THE FIRST FORMAT 5 DSCB IN THE CHAIN.   * 02900002
*              'COUNT' CONTAINS THE CCHHR OF THE NEXT DSCB TO BE READ.* 03000002
*              REGISTER 1 IS ZERO TO INDICATE REENTRY FROM IGG0325R.  * 03100002
*                                                                     * 03300018
* OUTPUT  TO IGG0325R                                                 * 03400018
*              REGISTER 13 POINTS TO THE ALLOCATE WORK AREA, WHICH    * 03500002
*              CONTAINS THE FORMAT 4 DSCB, THE LAST FORMAT 1 OR 3     * 03600002
*              DSCB READ, AND THE FIRST FORMAT 5 DSCB.  THE SEEK      * 03700002
*              ADDRESS IN THE IOB CONTAINS THE CCHHR OF THE DSCB      * 03800002
*              BEING PROCESSED.  'CCW12' CONTAINS A TWO WORD          * 03900002
*              PARAMETER LIST CONSISTING OF THE NUMBER OF EXTENTS     * 04000002
*              IN THE DADSMTBL TO BE SUBTRACTED AND THE ADDRESS       * 04100002
*              OF THE FIRST EXTENT TO BE SUBTRACTED.                  * 04200002
*                                                                     * 04300018
* OUTPUT  TO IGG0325Q                                                 * 04400018
*              REGISTER 13 POINTS TO THE ALLOCATE WORK AREA.  THE     * 04500002
*              HIGH WATER MARK IN THE FORMAT 4 IDSCB IS NOW VALID.    * 04600002
*              'FMTOUTAD' CONTAINS THE CCHHR OF THE FIRST FORMAT 5.   * 04700002
*              THE FIRST FORMAT 5 DSCB HAS BEEN MOVED TO THE VTOC     * 04720002
*              CONVERSION WORK AREA EXTENSION.                        * 04740002
*                                                                     * 04800018
* OUTPUT TO  IGG0325T                                                 * 04900018
*              REGISTER 13 POINTS TO THE ALLOCATE WORK AREA.  IF      * 05000002
*              THERE WAS ORIGINALLY ONLY ONE FORMAT 5 DSCB ON THE     * 05050002
*              VOLUME AND ONLY ONE FORMAT 5 WAS REBUILT, THEN THE     * 05100002
*              REBUILT FORMAT 5 IS IN 'DSCBF5.'  OTHERWISE, THE       * 05150002
*              REBUILT FORMAT 5 DSCB(S) ARE LOCATED IN THE VTOC       * 05200002
*              CONVERSION WORK AREA EXTENSION(S).                     * 05250002
*                                                                     * 05300018
* EXTERNAL ROUTINES                                                   * 05400018
*        CVTPRLTV                                                     * 05500018
*        EXCP(0)                                                      * 05600018
*        WAIT(1)                                                      * 05700018
*                                                                     * 05900018
* EXITS  NORMAL  BRANCH TO IGG0325R TO BUILD 2ND...NTH F5 DSCB'S      * 05960002
*                BRANCH TO IGG0325Q TO SUBTRACT SPLIT CYLINDER        * 06020002
*                     DATA SETS FROM THE FORMAT 5 DSCB'S AND TO       * 06080002
*                     BUILD THE FIRST F6 DSCB                         * 06140002
*                BRANCH TO IGG0325T TO CONVERT F5 DSCB'S TO CORRECT   * 06200002
*                     FORMAT AND WRITE THEM TO THE VTOC AND TO WRITE  * 06260002
*                     THE UPDATED F4 DSCB TO THE VTOC                 * 06320002
*                                                                     * 06380002
*        ERROR  BRANCH TO IGG0325T                                    * 06400002
*                                                                     * 06500018
*        ERROR CODES ISSUED BY THIS MODULE -                          * 06520002
*                                                                     * 06540002
*        0C - PERMANENT I/O ERROR                                     * 06560002
*                                                                     * 06580002
*        94 - OVERLAPPING EXTENTS IN THE VTOC                         * 06600002
*                                                                     * 06620002
* TABLE/WORK AREAS - DADSM ALLOCATE WORK AREA                         * 06640002
*                                                                     * 06700018
* ATTRIBUTES REENTRANT                                                * 06800002
*                                                                     * 06900018
*                                                                     * 07000018
*                                                                     * 07100018
REGZERO  EQU   0                       WORK REGISTER                    07200018
REENTRY  EQU   1                       INDICATES ENTRY FROM IGG0325R    07300018
REGONE   EQU   1                       WORK REGISTER                    07400018
REGTWO   EQU   2                       WORK REGISTER                    07600018
DADSMCTR EQU   3                       CTR EXTENTS IN DADSMTBL          07700018
REGTHREE EQU   3                       WORK REGISTER                    07800018
FORMATCT EQU   4                       MAX ON EXTENTS IN DSCB           07900018
REGFOUR  EQU   4                       WORK REGISTER             Y02078 07950002
EXTPTR   EQU   5                       PTR TO EXTENT BEING CONVERTED    08000018
REGFIVE  EQU   5                       WORK REGISTER             Y02078 08050002
REGSIX   EQU   6                       WORK REGISTER                    08100018
LSTF5CTR EQU   6                       NBR OF EXTENTS IN LAST F5 Y02080 08200002
REGSEVEN EQU 7                         WORKREGISTER                     08300018
F5EXTCTR EQU   7                       NO OF EXTENT BEING COMPARED      08400018
REGEIGHT EQU   8                       WORK REGISTER                    08500018
DADSMPTR EQU   8                       PTR TO EXTENT IN DADSMTBL        08600018
ALLOCADR EQU   8                       PTR TO EXTENT IN DADSMTBL        08700018
RERRPASS EQU   8                        ERROR CODE REGISTER      A31534 08750020
REGNINE  EQU   9                       WORK REGISTER                    08800018
F5ADDR   EQU   9                       PTR TO EXTENT IN F5              08900018
REGTEN   EQU   10                      WORK REGISTER                    09000018
RVTOCWKA EQU   11                      VTOC CONVERSION W/A PTR   Y02078 09100002
BASEREG  EQU   12                      BASE REGISTER                    09200018
REGTHIRT EQU   13                      WORK REGISTER                    09300018
RWKAREA  EQU   13                      BASE REGISTER TO WORK AREA       09400018
RETRNREG EQU   14                      RETURN REGISTER                  09500018
REG14    EQU   14                      WORK REGISTER             Y02078 09600002
RCVT     EQU   15                      BASE REGISTER TO CVT             09700018
*                                                                     * 09720021
* OTHER EQUATES                                                       * 09740021
*                                                                     * 09760021
ZERO     EQU   0                        VALUE ZERO                      09800018
ONE      EQU   1                        VALUE ONE                       09900018
TWO      EQU   2                        VALUE TWO                       10000018
THREE    EQU   3                        VALUE THREE                     10100018
K4       EQU   4                        CONSTANT OF 4            Y02080 10150002
FOUR     EQU   4                        VALUE FOUR                      10200018
FIVE     EQU   5                        VALUE FIVE                      10300018
SIX      EQU   6                        VALUE SIX                       10400018
SEVEN    EQU   7                        VALUE SEVEN                     10500018
EIGHT    EQU   8                        VALUE EIGHT                     10600018
THIRT    EQU   13                       VALUE THIRTEEN                  10700018
SIXTEEN  EQU   16                       VALUE SIXTEEN                   10800018
TWTYSIX  EQU   26                       VALUE TWENTY-SIX                10900018
F1ID     EQU   X'F1'                    F1 DSCB INDICATOR               11000018
F2ID     EQU   X'F2'                    F2 DSCB ID               Y02078 11050002
SPEXT    EQU   X'80'                    SPLIT CYL EXTENT INDICATOR      11100018
F3ID     EQU   X'F3'                    F3 DSCB INDICATOR               11300018
F5ID     EQU   X'F5'                    F5 DSCB ID               Y02078 11400002
F5INDIC  EQU   X'05'                    F5 DSCB INDICATOR               11500018
C32      EQU   32                       VALUE THIRTY-TWO                11600018
GOODIO   EQU   X'20'                    TEST VALUE FOR SUCCESSFUL I/O   11700018
ERRCD    EQU   X'0C'                    ERROR CODE FOR UNSUCCESSFUL I/O 11800018
VTOCERR  EQU   X'94'                    OVERLAPPING XTENTS ERROR Y02078 11850002
NOCC     EQU   X'00'                    NO COMMAND CHAINING      Y02080 11900002
CC       EQU   X'40'                    COMMAND CHAINING BIT     Y02080 12300002
TEN      EQU   10                       VALUE 10                 A31333 13570020
K12      EQU   12                       VALUE OF 12              Y02080 13620002
*                                                                     * 13630021
         BALR  BASEREG,ZERO             INT. BASE REGISTER              13700018
         USING *,BASEREG                                                13800018
         USING ALLOCWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 13900002
         USING   CVT,RCVT                                               14000018
         USING IECPREFX,REGTEN          PREFIX ADDRESSABILITY    Y02078 14010002
         USING VTOCWKA,RVTOCWKA         WORK AREA ADDRESSABILITY Y02078 14020002
*                                                                       14050002
         LTR   REENTRY,REENTRY         IS THIS REENTRY                  14100018
         BZ    RETURNPT                 BRANCH IF YES                   14200018
*                                                                     * 14300018
* INITIALIZE CHANNEL PROGRAM TO READ F1 AND F3 DSCB'S                 * 14400018
*                                                                     * 14500018
         LA    DADSMCTR,FIVE            INT. CTR OF EXTENTS IN DADSMTBL 14600018
         LA    REGEIGHT,DADSMTBL                                        14700018
*                                                                     * 14800018
* TEST END OF VTOC SWITCH AND READ THE NEXT DSCB IN THE VTOC          * 14900018
*                                                                     * 15000018
TESTSW   EQU   *                        BRANCH LABEL             Y02080 15050002
         TM    ASWITCH,EOVSW            IS END OF VTOC SWITCH ON Y02080 15100002
         BO    FINISHF5                 BRANCH IF YES                   15200018
         MVC   SEEKCYL(FIVE),COUNT      MOVE CCHHR OF NEXT DSCB TO IOB  15300018
*                                                                     * 15360019
* TEST FOR END OF VTOC.  IF THE DSCB TO BE READ IS THE LAST DSCB IN   * 15420019
* THE VTOC, REMOVE THE READ COUNT CCW FROM THE CHANNEL PROGRAM TO     * 15480019
* PREVENT COMMAND REJECTS (SEEKING OFF THE VOLUME) IF THERE IS NO     * 15540019
* COUNT FIELD AFTER THE VTOC.  SET EOV SWITCH IF LAST DSCB.           * 15600019
*                                                                     * 15660019
         CLC   SEEKCYL(FOUR),DS4VTOC6   Q - LAST TRACK IN VTOC   A27358 15720019
         BNE   NOTLAST                  IF NOT, BR               A27358 15780019
         CLC   SEEKREC(ONE),DS4DEVDT    Q - LAST RCD ON TRACK    A27358 15840019
         BNE   NOTLAST                  IF NOT, BR               A27358 15900019
         OI    ASWITCH,EOVSW            SET END OF VTOC SWITCH   Y02080 15960002
         MVI   CCW6+K4,NOCC             BREAK RD COUNT FROM      Y02080 16020002
*                                       CHAIN                    A27358 16080019
NOTLAST  EQU   *                                                 A27358 16140019
         BAL   RETRNREG,EXCHANPG        READ NEXT DSCB           A27358 16200019
         MVI   CCW6+K4,CC               RESTORE READ COUNT TO    Y02080 16260002
*                                       CHAIN                    A27358 16320019
*                                                                     * 16500018
* TEST FOR FORMAT ONE OR FORMAT 3 DSCB. IF FORMAT ONE CHECK FOR SPLIT * 16600018
* CYLINDER DATA SET,UPDATE HIGH WATER MARK                            * 16700018
*                                                                     * 16800018
F1ORF3   CLI   DS1FMTID,ZERO           IS THIS A ZERO DSCB       8M3261 16810018
         BNE   NOTF0                    BRANCH IF NOT            Y02078 16811002
         CLC   DS1DSNAM(FOUR),ZEROS     TEST FOR KEY OF ZEROS    Y02078 16812002
         BE    TESTSW                   BRANCH IF TRUE F0 DSCB   Y02078 16813002
DECRMENT EQU   *                        BRANCH LABEL             Y02078 16814002
         LH    REGONE,DS4DSREC          GET HOLE COUNT           Y02078 16815002
         BCTR  REGONE,ZERO              DECREMENT HOLE COUNT     Y02078 16816002
         STH   REGONE,DS4DSREC          SAVE UPDATED COUNT       Y02078 16817002
         B     TESTSW                   GO READ NEXT DSCB        Y02078 16818002
NOTF0    EQU   *                        BRANCH LABEL             Y02078 16819002
         CLI   DS1FMTID,F2ID            TEST FOR FORMAT 2 DSCB   Y02078 16820002
         BE    DECRMENT                 BRANCH IF FORMAT 2 DSCB  Y02078 16821002
         CLI   DS1FMTID,F5ID            TEST IF FORMAT 5 DSCB    Y02078 16822002
         BH    DECRMENT                 BRANCH IF F6 OR HIGHER   Y02078 16823002
         BL    CHECK1                   BRANCH IF F1 OR F3 DSCB  Y02078 16824002
         BAL   RETRNREG,PREFXADR        GO GET PREFIX ADDRESS    Y02078 16825002
NEXTADR1 EQU   *                        PREFIX ADDRESS IN REG 10 Y02078 16827002
         CLC   IECCORPS,IECCORP2        TEST FOR ANOTHER WKAREA  Y02078 16828002
         BE    NEWKAREA                 BRANCH IF NO EXTENSION   Y02078 16829002
         L     REGTEN,IECCORP2          LOAD ADDR OF NEXT PREFIX Y02078 16830002
         CLC   IECCORID,VCWKAID         TEST IF VTOC WORK AREA   Y02078 16831002
         BNE   NEXTADR1                 BRANCH IF NOT            Y02078 16832002
         XR    REGFOUR,REGFOUR          CLEAR FOR DIVISION       Y02078 16833002
         LH    REGFIVE,F5FNDCT          GET NUMBER OF FOUND F5'S Y02078 16834002
         D     REGFOUR,FW3              3 F5'S PER WKA EXTENSION Y02078 16835002
         LTR   REGFOUR,REGFOUR          TEST FOR AN EMPTY SLOT   Y02078 16836002
*                                       IN A WORK AREA EXTENSION Y02078 16837002
         BZ    TOPSLOT                  BR IF F5 IN TOP SLOT OF ZA00117 16838002
*                                       A VCWA. CHECK IF        ZA00117 16838402
*                                       PRESENT                 ZA00117 16838602
         CL    REGFIVE,ZEROS            TEST IF ONLY 1 EXTENSION Y02078 16839002
*                                       WITH FOUND F5 IN IT     ZA00117 16839202
         BE    LOADADDR                 BRANCH IF ONLY 1         Y02078 16840002
NEXTADR2 EQU   *                        LOOP TILL LAST VCWA     ZA00117 16841002
*                                       WITH FOUND F5S IN IT    ZA00117 16841202
         L     REGTEN,IECCORP2          LOAD ADDR OF NEXT PREFIX Y02078 16842002
         BCT   REGFIVE,NEXTADR2         LOAD ADDR OF LAST PREFIX Y02078 16843002
*                                       WITH FOUND F5S IN IT    ZA00117 16843202
LOADADDR EQU   *                        GET SLOT 1, 2, OR 3     ZA00117 16844002
         L     RVTOCWKA,IECCORAD        LOAD ADDR OF LAST WKAREA Y02078 16845002
         LA    REG14,VTCCHHR1           ADDR OF 1ST CCHHR SLOT  ZA00117 16847002
         LTR   REGFOUR,REGFOUR          FIRST ENTRY IN VCWA     ZA00117 16847202
         BZ    NXTCCHHR                 BRANCH IF YES           ZA00117 16847402
         LA    REG14,VTCNXTF5(REG14)    POINT TO 2ND SLOT       ZA00117 16847602
         BCT   REGFOUR,INCRPTR          FIND ADDR OF EMPTY SLOT  Y02078 16848002
NXTCCHHR EQU   *                        PUT CCHHR IN PROPER     ZA00117 16849002
*                                       SLOT                    ZA00017 16849202
         MVC   ZERO(FIVE,REG14),SEEKCYL MOVE IN FOUND F5 CCHHR   Y02078 16850002
         B     UPF5CNT                  GO INCREMENT F5FNDCT     Y02078 16851002
INCRPTR  EQU   *                        THIRD SLOT NEEDED       ZA00117 16852002
         LA    REG14,VTCNXTF5(REG14)    POINT TO 3RD CCHHR SLOT ZA00117 16853002
         B     NXTCCHHR                 GO MOVE IN THE CCHHR     Y02078 16854002
TOPSLOT  EQU   *                        IS VCWA AVAILABLE FOR   ZA00117 16854402
*                                       NEW FORMAT 5            ZA00117 16854502
         CLC   F5FNDCT,F5BLDCT          FOUND LESS THAN BUILT   ZA00117 16854902
         BL    NEXTADR2                 BR YES-SLOT AVAILABLE   ZA00117 16856202
NEWKAREA EQU   *                        BRANCH LABEL             Y02078 16859202
         BAL   RETRNREG,GETWKA          GO GET WKAREA EXTENSION  Y02078 16860502
         CLC   F5FNDCT,ONEF5            TEST IF ONLY 1 FOUND F5  Y02078 16861802
         BNE   MOVEF5AD                 BRANCH IF MORE THAN 1    Y02078 16863102
         MVC   VTCCHHR1,FMTOUTAD        MOVE IN CCHHR OF 1ST F5  Y02078 16864402
         MVC   VTCCHHR2,SEEKCYL         MOVE IN CCHHR OF 2ND F5  Y02078 16865702
         B     UPF5CNT                  GO INCREMENT F5FNDCT     Y02078 16867002
MOVEF5AD EQU   *                        BRANCH LABEL             Y02078 16868302
         MVC   VTCCHHR1,SEEKCYL         MOVE IN CCHHR OF THIS F5 Y02078 16869602
UPF5CNT  EQU   *                        BRANCH LABEL             Y02078 16870902
         LH    REGONE,F5FNDCT           GET NBR OF FOUND F5'S    Y02078 16872202
         LA    REGONE,ONE(REGONE)       INCREMENT THIS NUMBER    Y02078 16873502
         STH   REGONE,F5FNDCT           SAVE UPDATED COUNT       Y02078 16874802
         B     TESTSW                   GO READ NEXT DSCB        Y02078 16876102
CHECK1   EQU   *                        BRANCH LABEL             Y02078 16877402
         LH    REGONE,DS4DSREC         GET HOLE COUNT            8M3261 16878702
         BCTR  REGONE,REGZERO          DECREMENT HOLE OCUNT      8M3261 16880018
         STH   REGONE,DS4DSREC         SAVE NOW HOLE COUNT       8M3261 16890018
         CLI   DS1FMTID,F1ID           IS THIS A F1 DSCB         8M3261 16900018
         BNE   CHECK3                   BRANCH IF NO                    17000018
         LA    REGONE,DS1EXT1           POINT TO FIRST EXTENT    A31333 17070020
         LA    REGTWO,DS1PTRDS          POINT TO END OF 3        A31333 17140020
*                                       EXTENTS                  A31333 17210020
TESTF1   EQU   *                                                 A31333 17280020
         CLI   ZERO(REGONE),SPEXT       TEST IF SPLIT CYL DATA   A31333 17350020
*                                       SET                      A31333 17420020
         BNE   MOVEPTR1                 BRANCH IF NOT SPLIT CYL  A31333 17490020
         OI    ASWITCH,SPCYLSW          SET SPLIT CYLINDER       Y02080 17560002
*                                       SWITCH                   A31333 17630020
MOVEPTR1 EQU   *                                                 A31333 17700020
         LA    REGONE,TEN(REGONE)       INCREMENT EXTENT POINTER A31333 17770020
         CR    REGONE,REGTWO            TEST IF 3 EXTENTS TESTED A31333 17840020
         BL    TESTF1                   BRANCH IF NOT            A31333 17910020
HIWATER  MVC   DS4HPCHR(FIVE),SEEKCYL   UPDATE HIGH WATER MARK          18100018
         LA    EXTPTR,DS1EXT1           INT PTR TO FIRST EXT            18200018
         CLI   ZERO(EXTPTR),ZERO        IS THIS A MODEL DSCB            18300018
         BE    TESTSW                   BRANCH IF YES                   18400018
         LA    FORMATCT,THREE           INT CTR OF NO EXTENTS IN F1     18500018
         B     CONVERT                  BRANCH TO CONVERT EXTENTS       18600018
CHECK3   EQU   *                        BRANCH LABEL             Y02080 18650002
         CLI   DS3FMTID,F3ID            IS THIS F3 DSCB          Y02080 18700002
         BNE   TESTSW                   BRANCH IF NO                    18800018
         LA    REGONE,DS3EXTNT          POINT TO FIRST F3 EXTENT Y02080 18804002
         LA    REGTWO,DS3FMTID          POINT TO END OF 4        Y02080 18808002
*                                       EXTENTS                  A31333 18812020
         LA    REGTEN,DS3PTRDS          POINT TO END OF 13       Y02080 18816002
*                                       EXTENTS                  A31333 18820020
TESTF3   EQU   *                                                 A31333 18824020
         CLI   ZERO(REGONE),SPEXT       TEST IF SPLIT CYL DATA   A31333 18828020
*                                       SET                      A31333 18832020
         BNE   MOVEPTR3                 BRANCH IF NOT            A31333 18836020
         OI    ASWITCH,SPCYLSW          SET SPLIT CYLINDER       Y02080 18840002
*                                       SWITCH                   A31333 18844020
MOVEPTR3 EQU   *                                                 A31333 18848020
         LA    REGONE,TEN(REGONE)       INCREMENT EXTENT POINTER A31333 18852020
         CR    REGONE,REGTWO            WAS 4TH F3 EXTENT JUST   A31333 18856020
*                                       TESTED                   A31333 18860020
         BNE   TESTALL                  BRANCH IF NOT            A31333 18864020
         LA    REGONE,ONE(REGONE)       INCREMENT PAST F3 ID     A31333 18868020
TESTALL  EQU   *                                                 A31333 18872020
         CR    REGONE,REGTEN            TEST IF 13 EXTENTS       A31333 18876020
*                                       TESTED                   A31333 18880020
         BL    TESTF3                   BRANCH IF NOT            A31333 18884020
         LA    EXTPTR,DS3EXTNT          POINT TO 1ST F3 EXTENT   Y02080 18900002
         LA    FORMATCT,THIRT           INT. CTR OF NO. EXTENTS IN F3   19000018
*                                                                     * 19100018
* CONVERT AN EXTENT FORM CCHH/CCHH TO RTA/RTA+1  USING THE RESIDENT   * 19200018
* CONVERSION ROUTINE                                                  * 19300018
*                                                                     * 19400018
CONVERT  EQU   *                                                 A31333 19430020
         CLI   ZERO(EXTPTR),SPEXT       TEST IF SPLIT CYL DATA   A31333 19460020
*                                       SET                      A31333 19490020
         BNE   BGINCONV                 BRANCH IF NOT            A31333 19520020
         LA    EXTPTR,TEN(EXTPTR)       POINT TO NEXT EXTENT     A31333 19550020
         B     CONVNEXT                 BRANCH TO CONVERT NEXT   A31333 19580020
*                                       EXTENT                   A31333 19610020
BGINCONV EQU   *                                                 A31333 19640020
         LA    REGSEVEN,TWO             SET LOOP CONTROL                19700018
         AR    EXTPTR,REGSEVEN          GET PTR TO BEGINNING CCHH       19800018
         LA    REGTWO,CCW12             GET PTR TO ADDR MBBCCHHR INPUT  19900018
         LA    REGONE,DEB               GET PTR TO DEB                  20000018
ROUTINE  EQU   *                        BRANCH LABEL             Y02080 20050002
         STM   REGEIGHT,REGTHIRT,IECREGSV+K12  SAVE REGISTERS    Y02080 20100002
         LR    REGEIGHT,REGTHIRT                                        20200018
         DROP  REGTHIRT                                                 20300018
         USING ALLOCWKA,REGEIGHT        WORK AREA ADDRESSABILITY Y02080 20400002
         MVC   CCW12+THREE(FOUR),ZERO(EXTPTR)  MOVE IN CCHH      Y02080 20500002
         L     RCVT,CVTPTR              LOAD CVT BASE                   20600018
         L     RCVT,CVTPRLTV            LOAD TTR CONVERT RTN BASE       20700018
         BALR  RETRNREG,RCVT            CONVERT EXTENT                  20800018
         LM    REGEIGHT,REGTHIRT,IECREGSV+K12  RESTORE REGISTERS Y02080 20900002
         DROP  REGEIGHT                                                 21000018
         USING ALLOCWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 21100002
         SRA   REGSEVEN,ONE             DECREMENT LOOP CONTROL          21200018
         SRL   REGZERO,SIXTEEN          POSITION IT FOR STORING         21300018
         LTR   REGSEVEN,REGSEVEN        HAS UPPER CCHH BEEN CONVERTED   21400018
         BNE   CONT                     BRANCH IF NO                    21500018
         LA    REGSIX,ONE                                               21600018
         AR    REGZERO,REGSIX          ADD 1 TO UPPER CCHH TO MAKE IT   21700018
*                                       RTA+1                         * 21800018
CONT     STH   REGZERO,ZERO(DADSMPTR)   STORE RTA OR RTA+1              21900018
         LA    REGZERO,TWO                                              22000018
         AR    DADSMPTR,REGZERO         UPDATE PTR TO NEXT SPACE IN     22100018
*                                       DADSMTBL                      * 22200018
         LA    REGSIX,FOUR                                              22300018
         AR    EXTPTR,REGSIX            UPDATE PTR TO NEXT EXTENT TO    22400018
*                                       BE CONVERTED                  * 22500018
         LTR   REGSEVEN,REGSEVEN        HAS RTA+1 JUST BEEN STORED      22600018
         BNE   ROUTINE                  BRANCH IF NO                    22700018
         STM   FORMATCT,EXTPTR,CCW11    SAVE PTR TO NEXT EXTENT  Y02080 22800002
*                                                                     * 22900018
* TEST DADSMCTR TO DETERMINE IF  5 EXTENTS HAVE BEEN CONVERTED AS YET * 23000018
* IF 5 EXTENTS HAVE BEEN CONVERTED,GO TO SUBTRACT ROUTINE. IF NOT     * 23100018
* CALCULATE ADDR OF NEXT EXTENT TO BE CONVERTED                       * 23200018
*                                                                     * 23300018
         BCT   DADSMCTR,CONVNEXT        BRANCH IF DADSMTBL NOT FULL     23400018
         BAL   RETRNREG,ORDER           GO TO ORDER AND SUB EXTENTS     23500018
RETURNPT EQU   *                        BRANCH LABEL             Y02080 23550002
         LM    FORMATCT,EXTPTR,CCW11    LOAD PTR TO NEXT EXTENT  Y02080 23600002
         LA    DADSMCTR,FIVE                                            23700018
         LA    DADSMPTR,DADSMTBL                                        23800018
         XC    DADSMTBL,DADSMTBL        ZERO DADSMTBL                   23900018
CONVNEXT BCTR  FORMATCT,ZERO            DECREMENT CTR                   24000018
         LTR   FORMATCT,FORMATCT        ARE THERE MORE EXTENTS IN F1    24100018
*                                       OR F3                         * 24200018
         BZ    TESTSW                   BRANCH IF NO                    24300018
         CH    FORMATCT,EXTSIX          WAS PREVIOUS EXTENT NO.  A30794 24400020
*                                       6                        A30794 24500020
         BNE   TESTUSED                 BRANCH IF NO             A31333 24600020
         LA    EXTPTR,ONE(EXTPTR)                                       24800018
TESTUSED EQU   *                                                 A31333 24900020
         CLI   ZERO(EXTPTR),ZERO        IS NEW EXTENT UNUSED            25000018
         BE    TESTSW                   BRANCH IF YES                   25100018
         B     CONVERT                  BRANCH TO CONVERT NEXT EXTENT   25200018
*                                                                     * 25300018
* PUT THE CONVERTED EXTENTS IN THE DADSMTBL INTO ASCENDING ORDER      * 25400018
*                                                                     * 25500018
ORDER    LA    REGNINE,FIVE                                             25600018
         SR    REGNINE,DADSMCTR         FIND NO. EXTENTS IN TABLE       25700018
         ST    REGNINE,PDLIST5          SAVE NUMBER OF EXTENTS   Y02080 25800002
NEXTPASS LA    REGTEN,DADSMTBL          GET ADDR. BEGINNING OF TABLE    25900018
COMPARE  EQU   *                                                 A29936 25950020
         LM    REGZERO,REGTWO,ZERO(REGTEN) PICK UP FIRST 3       A29936 26000020
*                                       EXTENTS                  A29936 26050020
         LTR   REGONE,REGONE            IS THERE ONLY ONE EXTENT A29936 26100020
         BZ    LASTXTNT                 BRANCH IF YES            A29936 26150020
         CR    REGZERO,REGONE           COMPARE TWO ADJACENT     A29936 26200020
*                                       EXTENTS                  A29936 26250020
         BL    UPDATPTR                 IF 1ST LOW, DO NOT       A29936 26300020
*                                       SWITCH                   A29936 26350020
         ST    REGONE,ZERO(,REGTEN)     SWITCH CONTENTS OF THE   A29936 26400020
         ST    REGZERO,FOUR(,REGTEN)    TWO ADJACENT EXTENTS     A29936 26450020
UPDATPTR EQU   *                                                 A29936 26500020
         AR    REGTEN,REGSIX            POINT TO NEXT EXTENT     A29936 26550020
LASTXTNT EQU   *                                                 A29936 26600020
         LTR   REGTWO,REGTWO            IS THIS THE LAST EXTENT  A29936 26650020
         BNZ   COMPARE                  BRANCH IF NO             A29936 26700020
         BCT   REGNINE,NEXTPASS         DECREMENT CTR OF NO OF PASSES   26800018
         L     REGTEN,PDLIST5           GET NBR EXTENTS IN TABLE Y02080 26900002
*                                                                     * 27100018
* THIS ROUTINE BUILDS THE FIRST FORMAT 5 DSCB. WHEN THE FIRST FORMAT  * 27200018
* 5 DSCB IS FULL, THE MERGE FLAG IS SET AND XCTL IS MADE TO THE       * 27300018
* SECOND LOAD TO SUBTRACT THE EXTENTS IN THE DADSMTBL.                * 27400018
*                                                                     * 27450002
         TM    ASWITCH,MERGESW          TEST IF MORE THAN ONE F5 Y02080 27500002
         BO    GOTOTRIL                 BRANCH IF YES                   27600018
         LH    LSTF5CTR,LSTF5CT         GET NUMBER OF EXTENTS    Y02080 27700002
*                                       IN THE LAST F5 DSCB      Y02080 27750002
         LA    F5ADDR,DS5AVEXT          POINT TO BEGINNING F5           27800018
         LA    F5EXTCTR,ONE             CTR EXTS IN F5 BEING COMPARED   27900018
         LA    ALLOCADR,DADSMTBL        GET ADDR 1ST EXTENT TO BE SUBT  28000018
NEWCOMP  CLC   ZERO(TWO,ALLOCADR),ZERO(F5ADDR) COMPARE BEGIN EXTENTS    28100018
         BL    DSERROR                  BRANCH IF NEW EXTENT LOW        28200018
         BH    MORECK                   BRANCH IF NEW EXTENT HIGH       28300018
         CLC   TWO(TWO,ALLOCADR),TWO(F5ADDR) ARE ENDS EXTENTS EQUAL     28400018
         BH    DSERROR                  ERROR IF EXTENT TO BE    A31333 28440020
*                                       SUBTRACTED IS GREATER           28480020
*                                       THAN FREE EXTENT                28520020
         BL    REPLACE                  BRANCH IF LOWER          A31333 28560020
WIPEOUT  LA    REGONE,TWTYSIX                                           28600018
         SR    REGONE,F5EXTCTR          CALCULATE LOOP CONTROL          28700018
         BZ    ZERO26                   EQUAL TO LAST EXTENT    ZA00008 28750002
*                                       IN FORMAT 5             ZA00008 28760002
         LR    REGTHREE,F5ADDR                                          28800018
MOVEFLD  MVC   ZERO(FIVE,REGTHREE),FIVE(REGTHREE) WIPEOUT ALLOCATED EXT 28900018
         LA    REGTHREE,FIVE(REGTHREE)  GET ADDR NEXT E                 29000018
         BCT   REGONE,MOVEFLD           DECREMENT LOOP CONTROL          29100018
ZERO26   EQU   *                                                ZA00008 29110002
         XC    F5EXT16(FIVE),F5EXT16    CLEAR 26TH EXTENT        Y02080 29120002
         BCTR  LSTF5CTR,ZERO            DECREMENT COUNTER        Y02080 29140002
CHNGPTR  LA    ALLOCADR,FOUR(ALLOCADR)  POINT TO NEXT EXTENT TO BE SUBT 29200018
         BCT   REGTEN,NEWCOMP           DECREMENT CTR EXTENT TO BE SUBT 29300018
         STH   LSTF5CTR,LSTF5CT         SAVE COUNTER OF EXTENTS  Y02080 29400002
*                                       IN LAST F5 BEING BUILT   Y02080 29450002
         ST    REGTEN,PDLIST5           ZERO OUT                 Y02080 29500002
         BR    RETRNREG                 RETURN TO OBTAIN VORE EXTENTS   29600018
REPLACE  MVC   ZERO(TWO,F5ADDR),TWO(ALLOCADR) UPDATE EXTENT BOUNDRIES   29700018
         B     CHNGPTR                  BRANCH TO POINT TO NEW F5 EXT   29800018
MORECK   CLC   ZERO(TWO,ALLOCADR),TWO(F5ADDR) IS EXT TO BE SUBT IN THIS 29900018
*                                       FREE EXTENT                   * 30000018
         BNL   POINTNXT                 BRANCH IF NO                    30100018
         CLC   TWO(TWO,ALLOCADR),TWO(F5ADDR) COMPARE END EXTENT  A31333 30160020
*                                       TO BE SUBTRACTED TO END         30220020
*                                       OF FREE EXTENT                  30280020
         BH    DSERROR                  ERROR IF HIGHER          A31333 30340020
         BL    TWOEXTS                  BRANCH IF LOWER          A31333 30400020
         MVC   TWO(TWO,F5ADDR),ZERO(ALLOCADR) UPDATE EXTENT BOUNDRY     30500018
         B     CHNGPTR                 BRANCH TO POINT TO NEW F5 EXT    30600018
POINTNXT LA    F5ADDR,FIVE(F5ADDR)      POINT TO NEXT FREE EXTENT       30700018
         LA    F5EXTCTR,ONE(F5EXTCTR)   UPDATE CTR EXTENT BEING         30800018
*                                       COMPARED                      * 30900018
         CLC   ZERO(FOUR,F5ADDR),ZEROS  IS NEW EXTENT ZERO       A53183 31000021
         BE    DSERROR                  ERROR IF EXTENT TO BE    A31333 31050020
*                                       SUBTRACTED IS NOT WITHIN        31100020
*                                       ANY FREE EXTENT                 31150020
         B     NEWCOMP                   BRANCH TO START COMPARISON     31200018
TWOEXTS  EQU   *                        BRANCH LABEL             Y02080 31250002
         LA    LSTF5CTR,ONE(LSTF5CTR)   INCREMENT COUNT          Y02080 31300002
         LA    REGTWO,TWTYSIX                                           31400018
         CR    LSTF5CTR,REGTWO          IS LAST F5 FULL          Y02080 31500002
         BH    PREPPARM                 BRANCH IF YES                   31600018
         LA    REGTWO,FIVE              LOAD INCREMENT REGISTER         31700018
         LA    REGTHREE,F5EXT15                                         31800018
MOVE     MVC   FIVE(FIVE,REGTHREE),ZERO(REGTHREE)  MOVE A FIELD         31900018
         CR    F5ADDR,REGTHREE          HAVE NECESSARY FIELDS BEEN      32000018
*                                       MOVED                         * 32100018
         BE    CONTIN                   BRANCH IF YES                   32200018
         SR    REGTHREE,REGTWO          DECREMENT MOVE ADDR             32300018
         B     MOVE                     BRNACH TO MOVE NEXT FIELD       32400018
CONTIN   MVC   SEVEN(TWO,F5ADDR),TWO(F5ADDR) SET UP                     32500018
         MVC   TWO(TWO,F5ADDR),ZERO(ALLOCADR)   TWO NEW                 32600018
         MVC   FIVE(TWO,F5ADDR),TWO(ALLOCADR)        EXTENTS            32700018
         LA    F5EXTCTR,ONE(F5EXTCTR)                                   32800018
         LA    F5ADDR,FIVE(F5ADDR)      POINT TO NEXT FREE EXTENT       32900018
         B     CHNGPTR                  BRNACH TO POINT TO NEW F5 EXT   33000018
DSERROR  EQU   *                                                 A31333 33100020
         LA    RERRPASS,VTOCERR         SET ERROR CODE OF X'48'  A31333 33200020
         B     ERREXIT                  GO XCTL TO IGG0325H      A31333 33300020
*                                                                       33350002
* THIS SECTION SETS UP A PARAMETER LIST IN CCW12 FOR MODULE IGG0325R.   33400002
*                                                                       33450002
PREPPARM EQU   *                        BRANCH LABEL             Y02080 33500002
         ST    ALLOCADR,CCW12+K4        PUT ADDR NEXT EXTENT TO  Y02080 33700002
*                                       SUBTRACT IN PARM LIST    Y02080 33800002
         OI    ASWITCH,MERGESW          SET MULTIPLE F5 SWITCH   Y02080 33900002
         STH   LSTF5CTR,LSTF5CT         SAVE COUNTER OF EXTENTS  Y02080 34000002
*                                       IN LAST F5 DSCB          Y02080 34050002
         ST    REGTEN,CCW12             PUT NO. EXTENTS TO BE SUBTRACT  34300018
*                                       IN PARAMETER LIST             * 34400018
         BAL   RETRNREG,PREFXADR        GO GET PREFIX ADDRESS    Y02078 34405002
NEXTPTR  EQU   *                        PREFIX ADDRESS IN REG 10 Y02078 34410002
         CLC   IECCORPS,IECCORP2        TEST FOR ANOTHER WKAREA  Y02078 34415002
         BE    FIRSTWKA                 BRANCH IF NO EXTENSION   Y02078 34420002
         L     REGTEN,IECCORP2          LOAD ADDR OF NEXT PREFIX Y02078 34425002
         CLC   IECCORID,VCWKAID         TEST IF VTOC WORK AREA   Y02078 34430002
         BNE   NEXTPTR                  BRANCH IF NOT            Y02078 34435002
         L     RVTOCWKA,IECCORAD        LOAD ADDR OF EXTENSION   Y02078 34440002
INITWKA  EQU   *                        BRANCH LABEL             Y02078 34445002
         MVC   VTC1STF5,DSCBF5          MOVE IN FIRST REBUILT F5 Y02078 34450002
         ST    RVTOCWKA,LASTF5AD        INITIALIZE LAST F5 ADDR  Y02078 34455002
         B     BELOW                    BELOW                           34500018
FIRSTWKA EQU   *                        BRANCH LABEL             Y02078 34520002
         BAL   RETRNREG,GETWKA          GO GET WKAREA EXTENSION  Y02078 34540002
         MVC   VTCCHHR1,FMTOUTAD        MOVE IN CCHHR OF 1ST F5  Y02078 34560002
         B     INITWKA                  MOVE IN 1ST REBUILT F5   Y02078 34580002
GOTOTRIL LA    ALLOCADR,DADSMTBL        PUT ADDR NEXT EXTENT TO BE      34600018
*                                       SUBTRACTED IN PARAMETER LIST  * 34700018
         ST    ALLOCADR,CCW12+K4                                 Y02080 34800002
         ST    REGTEN,CCW12             PUT NO. EXTENTS TO BE SUBT.     34900018
*                                       IN PARAMETER LIST             * 35000018
BELOW    EQU   *                                                 A31333 35060020
         MVI   CCW12,ZERO               SET BYTE TO SHOW ENTRY   A31333 35120020
*                                       FROM IGG0325P                   35180020
         LA    REGTWO,NEXTLOAD          POINT TO ID OF IGG0325R  Y02080 35230002
         B     XCTLHERE                 BRNACH TO XCTL                  35600018
*                                                                       35602002
* THIS ROUTINE CALCULATES THE ADDRESS OF THE INITIAL PREFIX AND         35604002
* RETURNS THIS ADDRESS IN REGISTER 10.                                  35606002
*                                                                       35608002
PREFXADR EQU   *                        BRANCH LABEL             Y02078 35610002
         LA    REGTEN,ZERO(RWKAREA)     INITIAL WORK AREA ADDR   Y02078 35612002
         LA    REGONE,IECEXTPR-IECPREFX  LENGTH OF PREFIX        Y02078 35614002
         SR    REGTEN,REGONE            CALCULATE PREFIX ADDRESS Y02078 35616002
         BR    RETRNREG                 RETURN                   Y02078 35618002
*                                                                       35620002
* THIS ROUTINE OBTAINS A VTOC CONVERSION WORK AREA EXTENSION AND        35622002
* RETURNS ITS ADDRESS IN REGISTER RVTOCWKA.                             35624002
*                                                                       35626002
GETWKA   EQU   *                        BRANCH LABEL             Y02078 35628002
         IECRES GET,EXTPR=(RWKAREA),LV=VWALNGTH,ID=VCWA,         Y02078X35630002
               STM=(REGTWO,RETRNREG,IECREGSV+K12)                Y02078 35632002
         LR    RVTOCWKA,REGONE          LOAD WKA EXTENSION ADDR  Y02078 35634002
         BR    RETRNREG                 RETURN                   Y02078 35636002
*                                                                       35638002
* THIS ROUTINE CALCULATES THE ADDRESS OF THE FIRST VTOC CONVERSION      35640002
* WORK AREA EXTENSION AND MOVES THE FIRST REBUILT FORMAT 5 INTO IT.     35642002
*                                                                       35644002
MOVEF5IN EQU   *                        BRANCH LABEL             Y02078 35646002
         BAL   RETRNREG,PREFXADR        GO GET PREFIX ADDRESS    Y02078 35648002
NXTPREFX EQU   *                        PREFIX ADDRESS IN REG 10 Y02078 35650002
         L     REGTEN,IECCORP2          LOAD ADDR OF NEXT PREFIX Y02078 35652002
         CLC   IECCORID,VCWKAID         TEST IF VTOC WORK AREA   Y02078 35654002
         BNE   NXTPREFX                 BRANCH IF NOT            Y02078 35656002
         L     RVTOCWKA,IECCORAD        LOAD ADDR OF EXTENSION   Y02078 35658002
         MVC   VTC1STF5,DSCBF5          MOVE IN FIRST REBUILT F5 Y02078 35660002
         ST    RVTOCWKA,LASTF5AD        INITIALIZE LAST F5 ADDR  Y02078 35662002
         BR    REGTWO                   RETURN                   Y02078 35664002
*                                                                     * 35698002
* END OF VOLUME ROUTINE                                               * 35700018
*                                                                     * 35800018
FINISHF5 LA    REGNINE,FIVE                                             35900018
         SR    REGNINE,DADSMCTR                                         36000018
         LTR   REGNINE,REGNINE          ARE EXTENTS TO BE SUBTRACTED    36100018
         BE    TESTSPL                 BRANCH IF NO                     36200018
         BAL   RETRNREG,ORDER           BRNACH TO ORDER EXTENTS         36300018
*                                                                       36310002
* THIS SECTION DETERMINES THE NEXT MODULE TO RECEIVE CONTROL.           36320002
*                                                                       36330002
TESTSPL  EQU   *                        BRANCH LABEL             Y02080 36350002
         TM    ASWITCH,MERGESW          ARE NEW F5'S ON VOLUME   Y02080 36400002
         BO    SPTEST                   BRANCH IF YES                   36500018
         TM    ASWITCH,SPCYLSW          TEST FOR SPLIT CYL D/S   Y02078 36540002
         BNO   ONEF5TST                 BRANCH IF NONE FOUND     Y02078 36580002
         LA    REGTWO,LOAD4             PREPARE RETURN ADDRESS   Y02078 36620002
         CLC   F5FNDCT,ONEF5            TEST IF ONLY 1 FOUND F5  Y02078 36660002
         BNE   MOVEF5IN                 BRANCH IF MORE THAN 1    Y02078 36700002
         BAL   RETRNREG,GETWKA          GO GET WKAREA EXTENSION  Y02078 36740002
         MVC   VTCCHHR1,FMTOUTAD        MOVE IN CCHHR OF 1ST F5  Y02078 36780002
         MVC   VTC1STF5,DSCBF5          MOVE IN 1ST REBUILT F5   Y02078 36820002
         ST    RVTOCWKA,LASTF5AD        INITIALIZE LAST F5 ADDR  Y02078 36840002
         B     LOAD4                    GO BRANCH TO IGG0325Q    Y02078 36860002
ONEF5TST EQU   *                        BRANCH LABEL             Y02078 36900002
         CLC   F5FNDCT,ONEF5            TEST IF ONLY 1 FOUND F5  Y02078 36940002
         BE    LOAD5                    IF ONLY 1 FOUND F5 AND 1 Y02078 36980002
*                                       REBUILT F5, DO NOT USE   Y02078 37020002
*                                       A WORK AREA EXTENSION    Y02078 37060002
         LA    REGTWO,LOAD5             PREPARE RETURN ADDRESS   Y02078 37100002
         B     MOVEF5IN                 MOVE IN 1ST REBUILT F5   Y02078 37140002
SPTEST   EQU   *                                                 A31333 37150020
         TM    ASWITCH,SPCYLSW          DO SPLIT CYL DATA SETS   Y02080 37250002
*                                       EXIST ON THIS VOLUME          * 37300018
         BO    LOAD4                    BRANCH IF YES                   37400018
LOAD5    EQU   *                                                 A31333 37500020
         XR    RERRPASS,RERRPASS        CLEAR ERROR PASS REG     S21040 37550021
ERREXIT  EQU   *                        BRANCH LABEL             Y02080 37560002
         LA    REGTWO,LASTLOAD          POINT TO ID OF IGG0325T  Y02080 37600002
XCTLHERE EQU   *                        BRANCH LABEL             Y02080 37650002
        IECRES LOAD,EXTPR=(RWKAREA),MODID=(REGTWO),BRANCH=DIRECT Y02080 37750002
LOAD4    EQU   *                                                 A31333 38100020
         LA    REGONE,C32              MAKE REG 1 NOT ZERO SO    S21040 38120021
*                                      IGG0325Q WILL NOT THINK          38140021
*                                      THIS IS REENTRY FROM 325U        38160021
         LA    REGTWO,SPLITCYL          POINT TO ID OF IGG0325Q  Y02080 38210002
         B     XCTLHERE                 BRANCH TO XCTL                  38400018
*                                                                       38490002
* THIS ROUTINE EXECUTES A CHANNEL PROGRAM.                              38492002
*                                                                       38494002
EXCHANPG MVI   ECB,ZERO                                                 38500018
         EXCP IOB                                                       38600018
         WAIT   1,ECB=ECB                                               38700018
         TM    ECB,GOODIO                                               38800018
         BCR   1,RETRNREG               RETURN IF I/O SUCESSFUL  M0124  38900021
         LA    RERRPASS,ERRCD                                           39000018
         B     ERREXIT                  BRANCH TO IGG0325T       Y02080 39050002
*                                                                     * 39500021
*          CONSTANTS                                                  * 39600018
*                                                                     * 39650021
FW3      DC    F'3'                     3 F5'S PER WKA EXTENSION Y02078 39700002
ONEF5    DC    H'1'                     HALFWORD OF ONE          Y02078 39750002
VCWKAID  DC    C'VCWA'                  VTOC WORK AREA PREFIX ID Y02078 39800002
         DS    0H                       HALF-WORD BOUNDARY       A30794 40020020
EXTSIX   DC    X'0009'                  EXTENT SIX               A30794 40040020
*                                                                     * 40045021
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                       * 40050002
*                                                                     * 40055021
         XCTLTABL ID=(NEXTLOAD,5R,SPLITCYL,5Q,LASTLOAD,5T),      Y02080X40105002
               SVC=032,LENGTH=,BRT=YES                           Y02080 40205002
         EJECT                                                   Y02080 40255002
CVT      DSECT                                                          41700018
         CVT                                                     Y02080 41800002
         EJECT                                                   Y02080 41850002
DSCBWKAR IECALLWA EP,F4,D1=(1,3),D2=(5)  ALLOCATE WORK AREA      Y02080 41900002
DS4VTOC6 EQU   DS4VTOCE+6                                               44500018
F5EXT15  EQU   DSCBF5+124               EXTENT 15 IN F5 DSCB            49000018
F5EXT16  EQU   DSCBF5+129               EXTENT 16 IN F5 DSCB            49100002
CHNPGADR EQU   IOB+16                   ADDR. CHANNEL PROGRAM IN IOB    50500018
SEEKCYL  EQU   SEEK+3                                                   50700018
SEEKREC  EQU   SEEK+7                                                   50800018
ZEROS    EQU   CCW2+4                   FULL WORD OF ZERO               51100018
         EJECT                                                   Y02078 51200002
VWKAREA  IECVTCWA                       VTOC CONVERSION WORKAREA Y02078 51300002
         END                                                            57500018
./  ADD  SSI=32510334,NAME=IGG0325Q
 TITLE 'IGG0325Q - SPLIT CYLINDER DATA SET PROCESSING'           Y02080 00200002
IGG0325Q CSECT                                                          00300021
*                                                                       00350002
* MODULE NAME = IGG0325Q                                                00360002
*                                                                       00370002
* DESCRIPTIVE NAME = SPLIT CYLINDER DATA SET PROCESSING                 00380002
*                                                                       00390002
* COPYRIGHT = NONE                                                      00392002
*                                                                       00394002
* CHANGE ACTIVITY = SEE BELOW                                           00396002
*                                                                     * 00400018
*          RELEASE 19 DELETIONS                                       * 00410018
*          RELEASE 20 DELETIONS                                       * 00420018
*1026062000,108000,630000,658000-660000                          A31534 00425020
*1026012000-022000,028000-032000,036000-044000,060000,084000,    A31333 00426020
*1026092000,142000,216000,224000,242000-246000,250000-282000,    A31333 00427020
*1026286000-548000,568000-594000,604000,648000-652000,654000-    A31333 00428020
*1026656000,668000                                               A31333 00429020
*          RELEASE 21 DELETIONS                                       * 00430018
*1191011000-017000,618000,622000-624000,638000,678000,682000-    M0124  00431021
*1191700000,704000-726000,730000,736000-782000,786000-790000,    M0124  00432021
*1191802000,808000,812000-816000,830000                          M0124  00433021
*1191062000,186000,658000                                        S21040 00435021
*          RELEASE 22 DELETIONS                                       * 00440018
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00450002
*0000000300-002000,004500-004900,054000,058800-059600,062200,    Y02080 00450102
*0000066000,070000,122000-124000,128000,132000,138000,144000,    Y02080 00450202
*0000146000,152000-154000,158000-162000,166000-184000,192000,    Y02080 00450302
*0000222300,224400,232000-234000,239000-239200,251600,264400,    Y02080 00450402
*0000266400,267600-268000,270000,270800,276800-277200,354000,    Y02080 00450502
*0000384000-404000,434000,474000-494000,556000-562000,600000,    Y02080 00450602
*0000626000-636800,640000-646000,648400,649000-668000,672000-    Y02080 00450702
*0000702000,730000-846000,850000,856000-858000,862000-986000     Y02080 00450802
*0000028000-032000,034400-045600,060400-061200,064400-065600,    Y02078 00450902
*0000096000,214000,218000-222000                                 Y02078 00451002
*                                                                     * 00500018
*STATUS CHANGE LEVEL 003                                                00510021
*                                                                     * 00520018
*                                                                     * 00600018
*                                                                     * 00800018
*                                                                     * 01000018
* FUNCTION/OPERATION  IGG0325Q READS EACH DSCB IN THE VTOC AND CHECKS * 01100021
*   FOR SPLIT CYLINDER DATA SETS. IF IT FINDS A SPLIT CYLINDER DATA   * 01200021
*   SET, IT BUILDS THE FIRST EXTENT IN THE FIRST FORMAT 6 DSCB. IF    * 01300021
*   THE FIRST EXTENT IS ALREADY BUILT, IT XCTL'S TO IGG0325U TO BUILD * 01400021
*   MORE FORMAT 6 ENTRIES OR TO UPDATE THE COUNT BYTE OF AN EXISTING  * 01500021
*   FORMAT 6 ENTRY. WHEN ALL SPLIT CYLINDER DATA SET EXTENTS HAVE     * 01600021
*   BEEN READ AND PROCESSED, IT XCTL'S TO IGG0325W.                   * 01700021
*                                                                     * 02400018
* ENTRY POINTS                                                        * 02600018
*        IGG0325Q - FROM IGG0325P IF SPLIT CYLINDER DATA SETS ARE     * 02800002
*                                 FOUND DURING THE BUILDING OF        * 03000002
*                                 THE FORMAT 5 DSCB'S                 * 03200002
*                                                                     * 03400018
*                   FROM IGG0325U AFTER A FORMAT 6 ENTRY IS BUILT     * 03440002
*                                 OR A DATA SET COUNT INCREMENTED     * 03480002
*                                                                     * 03490002
* INPUT  FROM IGG0325P                                                * 03520002
*              REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,      * 03560002
*              WHICH WILL CONTAIN THE FORMAT 4 DSCB WITH A VALID      * 03570002
*              HIGH WATER MARK.  'FMTOUTAD' CONTAINS THE CCHHR OF     * 03620002
*              THE FIRST FORMAT 5 DSCB.                               * 03680002
*                                                                     * 03720002
*        FROM IGG0325U                                                * 03760002
*              REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,      * 03800002
*              WHICH WILL CONTAIN THE FORMAT 4 DSCB, THE FORMAT 1 OR  * 03840002
*              FORMAT 3 CURRENTLY BEING PROCESSED IN 'DSCBF1', AND    * 03850002
*              THE FIRST FORMAT 6 DSCB IN 'DSCBF5'. 'COUNT' CONTAINS  * 03880002
*              THE CCHHR OF THE NEXT DSCB TO BE READ. REGISTER 1 WILL * 03920002
*              BE ZERO TO INDICATE REENTRY FROM IGG0325U.             * 03960002
*                                                                     * 04000002
* OUTPUT TO IGG0325U                                                  * 04040002
*              REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,      * 04080002
*              WHICH WILL CONTAIN THE FORMAT 4 DSCB, THE FORMAT 1     * 04120002
*              OR 3 DSCB CURRENTLY BEING PROCESSED, AND THE FIRST     * 04160002
*              FORMAT 6 DSCB IN 'DSCBF5'.  'CCHHRSAV' CONTAINS THE    * 04200002
*              CCHHR OF THE FORMAT 1 OR 3 DSCB BEING PROCESSED.       * 04240002
*              REGISTER 6 WILL POINT TO THE RTA/RTA+1 OF THE DATA     * 04280002
*              SET AND REGISTER 8 WILL POINT TO THE  FIRST F6 EXTENT. * 04320002
*                                                                     * 04360002
*        TO IGG0325W                                                  * 04400002
*              REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,      * 04440002
*              WHICH WILL CONTAIN THE FORMAT 4 DSCB AND THE FIRST     * 04480002
*              FORMAT 6 DSCB IN 'DSCBF5'.  'FMTOUTAD' CONTAINS THE    * 04520002
*              CCHHR OF THE FIRST FORMAT 5 DSCB.                      * 04560002
*                                                                     * 04600018
* EXTERNAL ROUTINES                                                   * 04800018
*        EXCP(0)                                                      * 05000018
*        WAIT(1)                                                      * 05200018
*                                                                     * 05600018
*                                                                     * 05800018
* EXITS NORMAL BRANCH TO IGG0325U TO BUILD MORE F6 ENTRIES            * 05880002
*              BRANCH TO IGG0325W TO SUBTRACT THE F6 EXTENTS          * 05960002
*                               FROM THE F5 FREE SPACE AND TO         * 06040002
*                               CONVERT THE F6 TO FINAL FORM          * 06120002
*       ERROR  BRANCH TO IGG0325T                                     * 06220002
*                                                                     * 06400018
*       ERROR CODES ISSUED BY THIS MODULE -                           * 06440002
*                                                                     * 06480002
*       0C - PERMANENT I/O ERROR                                      * 06520002
*                                                                     * 06560002
* TABLES/WORKAREAS  DADSM ALLOCATE WORK AREA                          * 06600002
*                                                                     * 06800018
* ATTRIBUTES  REENTRANT                                               * 07000002
*                                                                     * 07200018
*                                                                     * 07400018
REGZERO  EQU   0                       WORK REGISTER                    07600018
REENTRY  EQU   1                        REENTRY FROM IGG0325U    A31333 07700020
REGONE   EQU   1                       WORK REGISTER                    07800018
REGTWO   EQU   2                       WORK REGISTER                    08000018
REGTHREE EQU   3                       WORK REGISTER                    08200018
FORMATCT EQU   4                        MAX NO EXTENTS IN DSCB   A31333 08260020
EXTPTR   EQU   5                        PTR TO EXTENT BEING      A31333 08320020
*                                       CONVERTED                A31333 08380020
RTAPTR   EQU   6                        PTR TO CONVERTED EXTENT  A31333 08440020
NEXTPTR  EQU   6                        PTR TO NEXT EXTENT       A31333 08500020
REGSIX   EQU   6                       WORK REGISTER                    08600018
F6EXTCTR EQU   7                       CTR OF NO. EXTENTS IN F6         08800018
REGEIGHT EQU   8                       WORK REGISTER                    09000018
F6PTR    EQU   8                        ADDR OF EXTENT IN F6     A31333 09100020
RERRPASS EQU   8                        ERROR CODE REGISTER      A31534 09300020
RTNREG2  EQU   9                       BRANCH REGISTER                  09400018
LSTF6CTR EQU   10                       NO. EXTENTS IN LAST F6   A31333 09500020
BASEREG  EQU   12                      BASE REGISTER                    09800018
REGTHIRT EQU   13                      WORK REGISTER                    10000018
RWKAREA  EQU   13                      WORK AREA BASE REGISTER          10200018
RETRNREG EQU   14                      BRANCH REGISTER                  10400018
RCVT     EQU   15                      CVT BASE REGISTER                10600018
*                                                                       10700021
* OTHER EQUATES                                                         10800021
*                                                                       10900021
ZERO     EQU   0                        VALUE ZERO                      11000018
ONE      EQU   1                        VALUE ONE                       11200018
TWO      EQU   2                        VALUE TWO                       11400018
THREE    EQU   3                        VALUE THREE                     11600018
K4       EQU   4                        CONSTANT OF 4            Y02080 11650002
FOUR     EQU   4                        VALUE FOUR                      11800018
FIVE     EQU   5                        VALUE FIVE                      12000018
EIGHT    EQU   8                        VALUE EIGHT                     12600018
TEN      EQU   10                       VALUE TEN                A31333 12700020
K12      EQU   12                       VALUE TWELVE             Y02080 12750002
FOURTEEN EQU   14                       VALUE FOURTEEN           A31333 12900020
SIXTEEN  EQU   16                       VALUE SIXTEEN                   13000018
F1ID     EQU   X'F1'                    F1 DSCB INDICATOR               13400018
SPEXT    EQU   X'80'                    SPLIT CYL EXTENT INDICATOR      13600018
F3ID     EQU   X'F3'                    F3 DSCB INDICATOR               14000018
F6INDIC  EQU   X'06'                    F6 DSCB INDICATOR        A31333 14500020
GOODIO   EQU   X'20'                    TEST VALUE FOR SUCCESSFUL I/O   14800018
ERRCD    EQU   X'0C'                    ERROR CODE FOR UNSUCCESSFUL I/O 15000018
C140     EQU   140                                                      15600018
NOCC     EQU   X'00'                    NO COMMAND CHAINING      Y02080 16000002
CC       EQU   X'40'                    COMMAND CHAINING BIT     Y02080 16050002
SLI      EQU   X'20'                    SUPPRESS INCORRECT LNGTH Y02080 16100002
SKIP     EQU   X'10'                    SUPPRESS DATA TRANSFER   Y02080 16150002
READCOMD EQU   X'0E'                    READ COMMAND CODE               16400018
*                                                                       18600021
         BALR  BASEREG,ZERO             INIT BASE REGISTER              18800018
         USING *,BASEREG                                                19000018
         USING ALLOCWKA,RWKAREA         BASE FOR WORK AREA       Y02080 19200002
         USING CVT,RCVT                 BASE FOR CVT                    19400018
*                                                                       19410002
         LTR   REENTRY,REENTRY          IS THIS REENTRY          A31333 19420020
         BE    TESTNEXT                 BRANCH IF YES            A31333 19440020
*                                                                       19460020
* FIND THE FIRST HOLE IN THE VTOC AND INITIALIZE THE F6 POINTER         19480020
* IN THE FORMAT 4 DSCB.                                                 19500020
*                                                                       19520020
BUILDF6  MVC   SEEKCYL(FIVE),VTOCADR    MOVE ADDR VTOC TO CHANNEL       19600018
*                                       PROGRAM                       * 19800018
         BAL   RTNREG2,FINDHOLE         FIND FIRST HOLE IN VTOC         20000018
         MVC   DADSMADR(FIVE),COUNT     INT.ADDR. OF PRESENT F6         20200018
         MVC   DS4F6PTR(FIVE),COUNT     SAVE FIRST F6 PTR IN F4         20400018
         MVC   SEEKCYL(FIVE),COUNT      MOVE ADDR FIRST F6 TO CHANNEL   20600018
*                                       PROGRAM                       * 20800018
         BAL   RTNREG2,FINDHOLE         FIND NEXT HOLE IN VTOC          21000018
         MVC   FMTINAD(FIVE),COUNT      SAVE ADDR OF NEXT HOLE          21200018
         MVC   COUNT,FMTOUTAD           INITIALIZE COUNT FIELD   Y02078 21400002
         SR    LSTF6CTR,LSTF6CTR        INIT CTR OF EXTENTS      A31333 21600020
         NI    ASWITCH,X'FF'-EOVSW      TURN EOV SWITCH OFF      Y02080 22230002
*                                                                       22260020
* READ THE NEXT DSCB IN THE VTOC IF ALL THE EXTENTS IN THE              22290020
* PREVIOUS FORMAT 1 OR 3 DSCB HAVE BEEN TESTED FOR SPLIT                22320020
* CYLINDER DATA SETS.                                                   22350020
*                                                                       22380020
READNEXT EQU   *                                                 A31333 22410020
         TM    ASWITCH,EOVSW            IS EOV SWITCH ON         Y02080 22440002
         BO    XCTL325W                 BRANCH IF YES            A31333 22470020
         LA    REGONE,DSCBF1                                     A31333 22500020
         ST    REGONE,CCW6              PUT ADDR. OF F1 AREA INTO       22600018
*                                       CHANNEL PROGRAM READ          * 22800018
         MVI   CCW6,READCOMD            PUT READ COMMAND IN CCW6        23000018
         MVI   CCW6+K4,CC               CHAIN READ TO READ COUNT Y02080 23200002
         MVI   CCW7+K4,SLI              UNCHAIN RD CNT FROM SKE  Y02080 23400002
         MVC   SEEKCYL(FIVE),COUNT      MOVE ADDR. NEXT DSCB TO         23600018
*                                       CHANNEL PROGRAM               * 23800018
         CLC   SEEKCYL(FOUR),DS4VTOC6   LAST TRACK IN VTOC       A31333 23820020
         BNE   NOTLAST                  BRANCH IF NOT            A31333 23840020
         CLC   SEEKREC(ONE),DS4DEVDT    LAST RECORD ON TRACK     A31333 23860020
         BNE   NOTLAST                  BRANCH IF NOT            A31333 23880020
         OI    ASWITCH,EOVSW            TURN ON EOV SWITCH       Y02080 23900002
         MVI   CCW6+K4,NOCC             BREAK READ COUNT FROM    Y02080 23920002
*                                       CHAIN                           23940020
NOTLAST  EQU   *                                                 A31333 23960020
         LA    REGONE,CCW4                                       Y02078 23980002
         ST    REGONE,CHNPGADR          CHANNEL PROGRAM ADDRESS  Y02078 23990002
         BAL   RETRNREG,EXCHANPG        READ NEXT DSCB IN VTOC          24000018
*                                                                       24100020
* IF THIS IS A FORMAT 1 OR 3 DSCB, TEST THE EXTENTS FOR SPLIT           24200020
* CYLINDER DATA SETS.                                                   24300020
*                                                                       24400020
TESTF1   EQU   *                                                 A31333 24500020
         CLI   DS1FMTID,F1ID            IS THIS A FORMAT 1 DSCB         24800018
         BNE   TESTF3                   BRANCH IF NO             A31333 24840020
         LA    FORMATCT,FOUR            INITIALIZE FOR 4 EXTENTS A31333 24880020
         LA    EXTPTR,DS1EXT1           POINT TO FIRST F1 EXTENT A31333 24920020
         B     SAVEPTR                  GO SAVE THIS POINTER     A31333 24960020
TESTF3   EQU   *                                                 A31333 25000020
         CLI   DS1FMTID,F3ID            TEST IF FORMAT 3 DSCB    A31333 25040020
         BNE   READNEXT                 BRANCH IF NOT            A31333 25080020
         LA    FORMATCT,FOURTEEN        INITIALIZE FOR 14 XTENTS A31333 25120020
         LA    EXTPTR,DS3EXTNT          POINT TO FIRST F3 EXTENT Y02080 25160002
SAVEPTR  EQU   *                                                 A31333 25200020
         ST    EXTPTR,NEXTEXTN          SAVE EXTENT POINTER      A31333 25240020
*                                                                       25280020
* TEST IF THE NEXT EXTENT IS A SPLIT CYLINDER DATA SET                  25320020
*                                                                       25360020
TESTNEXT EQU   *                                                 A31333 25400020
         LTR   FORMATCT,FORMATCT        WERE ALL EXTENTS TESTED  A31333 25440020
         BE    READNEXT                 BRANCH IF YES            A31333 25480020
         L     NEXTPTR,NEXTEXTN         GET PTR TO NEXT EXTENT   A31333 25520020
         BCTR  FORMATCT,ZERO            DECREMENT NO OF EXTENTS  A31333 25560020
         CH    FORMATCT,EXTSIX          WAS PREVIOUS EXTENT NO 6 A31333 25600020
         BNE   TESTZERO                 BRANCH IF NOT            A31333 25640020
         LA    NEXTPTR,ONE(NEXTPTR)     INCREMENT PAST F3 ID     A31333 25680020
TESTZERO EQU   *                                                 A31333 25720020
         LR    EXTPTR,NEXTPTR                                    A31333 25760020
         CLI   ZERO(EXTPTR),ZERO        IS NEW EXTENT UNUSED     A31333 25800020
         BE    READNEXT                 GO READ NEXT EXTENT      A31333 25840020
INCRMENT EQU   *                                                 A31333 25880020
         LA    NEXTPTR,TEN(NEXTPTR)     POINT TO NEXT EXTENT     A31333 25920020
         ST    NEXTPTR,NEXTEXTN         SAVE PTR TO NEXT EXTENT  A31333 25960020
         CLI   ZERO(EXTPTR),SPEXT       TEST IF SPLIT CYLINDER   A31333 26000020
*                                       DATA SET                        26040020
         BNE   TESTNEXT                 BRANCH IF NOT            A31333 26080020
         MVC   FOUR(TWO,EXTPTR),ZEROS   MOVE MIN TRACK IN EXTENT A31333 26120020
         MVC   EIGHT(TWO,EXTPTR),MAXTRK MOVE MAX TRACK IN EXTENT A31333 26160020
*                                                                       26200020
* CONVERT THE EXTENT FROM CCHH/CCHH TO RTA/RTA+1 USING THE              26240020
* RESIDENT CONVERSION ROUTINE.                                          26280020
*                                                                       26320020
CONVERT  EQU   *                                                 A31333 26360020
         LA    REGTHREE,TWO             SET LOOP CONTROL         A31333 26400020
         LA    RTAPTR,PDLIST5           POINT TO OUTPUT AREA     Y02080 26440002
         AR    EXTPTR,REGTHREE          GET PTR TO FIRST CCHH    A31333 26480020
         LA    REGTWO,CCW12             GET PTR TO MBBCCHHR      A31333 26520020
*                                       INPUT                    A31333 26560020
         LA    REGONE,DEB               GET PTR TO DEB           A31333 26600020
ROUTINE  EQU   *                        BRANCH LABEL             Y02080 26610002
         STM   REGEIGHT,REGTHIRT,IECREGSV+K12  SAVE REGISTERS    Y02080 26640002
         LR    REGEIGHT,REGTHIRT                                 A31333 26680020
         DROP  REGTHIRT                                          A31333 26720020
         USING ALLOCWKA,REGEIGHT        WORK AREA ADDRESSABILITY Y02080 26760002
         MVC   CCW12+THREE(FOUR),ZERO(EXTPTR)  MOVE IN CCHH      Y02080 26800002
         L     RCVT,CVTPTR              LOAD CVT BASE            A31333 26840020
         L     RCVT,CVTPRLTV            LOAD TTR CONVERT RTN     A31333 26880020
*                                       BASE                     A31333 26920020
         BALR  RETRNREG,RCVT            CONVERT EXTENT           A31333 26960020
         LM    REGEIGHT,REGTHIRT,IECREGSV+K12  RESTORE REGISTERS Y02080 27000002
         DROP  REGEIGHT                                          A31333 27040020
         USING ALLOCWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 27080002
         SRA   REGTHREE,ONE             DECREMENT LOOP CONTROL   A31333 27120020
         SRL   REGZERO,SIXTEEN          POSITION RTA FOR STORING A31333 27160020
         LTR   REGTHREE,REGTHREE        HAS UPPER CCHH BEEN      A31333 27200020
*                                       CONVERTED                A31333 27240020
         BNE   CONT                     BRANCH IF NO             A31333 27280020
         LA    REGEIGHT,ONE                                      A31333 27320020
         AR    REGZERO,REGEIGHT         ADD 1 TO UPPER RTA       A31333 27360020
CONT     EQU   *                                                 A31333 27400020
         STH   REGZERO,ZERO(RTAPTR)     STORE RTA OR RTA+1       A31333 27440020
         LA    RTAPTR,TWO(RTAPTR)       UPDATE PTR TO NEXT SPACE A31333 27480020
         LA    EXTPTR,FOUR(EXTPTR)      UPDATE PTR TO EXTENT TO  A31333 27520020
*                                       BE CONVERTED                    27560020
         LTR   REGTHREE,REGTHREE        HAS RTA+1 BEEN STORED    A31333 27600020
         BNE   ROUTINE                  BRANCH IF NO             A31333 27640020
         LA    RTAPTR,PDLIST5           POINT TO RTA/RTA+1       Y02080 27680002
         LA    F6PTR,DS6AVEXT           POINT TO FIRST F6 EXTENT Y02080 27720002
         LTR   LSTF6CTR,LSTF6CTR        IS THIS THE FIRST SPLIT  A31333 27760020
*                                       CYLINDER DATA SET               27800020
         BNE   XCTL325U                 BRANCH IF NO             A31333 27840020
         XC    DSCBF5(C140),DSCBF5      CLEAR F5 AREA                   28400018
         MVC   ZERO(FOUR,F6PTR),ZERO(RTAPTR) MOVE RTA/RTA+1      A31333 29400020
         LA    REGTWO,ONE                                        A31333 30400020
         STC   REGTWO,FOUR(F6PTR)       DATA SET COUNT SET TO 1  A31333 31400020
         LA    LSTF6CTR,ONE             INIT CTR OF EXTENTS      A31333 32400020
         B     TESTNEXT                 GO TO TEST NEXT EXTENT   A31333 33400020
*                                                                       34400020
* BRANCH TO IGG0325U TO ADD MORE F6 EXTENTS                             35400002
*                                                                       36400020
XCTL325U EQU   *                                                 A31333 37400020
         MVC   CCHHRSAV,SEEKCYL         SAVE CCHHR OF F1 OR F3   Y02078 37410002
*                                       DSCB BEING PROCESSED     Y02078 37420002
         LA    REGTWO,NEXTLOAD          POINT TO ID OF IGG0325U  Y02080 37450002
         B     XCTLHERE                 GO XCTL                  A31333 41400020
*                                                                       42400020
* BRANCH TO IGG0325W TO SUBTRACT THE F6 EXTENTS FROM THE F5.            43400002
*                                                                       44400020
XCTL325W EQU   *                                                 A31333 45400020
         BAL   RTNREG2,WRITEF6          WRITE OUT THE F6         A31333 46400020
         LA    REGTWO,F6LOAD            POINT TO ID OF IGG0325W  Y02080 46450002
         B     XCTLHERE                 GO XCTL                  A31333 50400020
*                                                                       51400020
* FIND THE ADDRESS OF THE NEXT F0 DSCB.                                 52400020
*                                                                       53400020
FINDHOLE LA    REGONE,CCW4              GET ADDR. CHANNEL PROGRAM TO    55000018
*                                       BE EXECUTED                   * 55200018
         ST    REGONE,CHNPGADR          STORE IN IOB                    55400018
         MVI   CCW6+K4,CC+SKIP          SET SKIP BIT IN READ     Y02080 55600002
         MVI   CCW7+K4,CC+SLI           CHAIN READ COUNT TO      Y02080 55800002
*                                       SEARCH KEY EQUAL         Y02080 56000002
         MVI   CCW8+K4,CC+SLI           SET SLI BIT IN SKE       Y02080 56200002
         BAL   RETRNREG,EXCHANPG        FINDHOLE                        56400018
         BR    RTNREG2                  RETURN                          56600018
*                                                                       57300020
* WRITE A FORMAT 6 DSCB.                                                58000020
*                                                                       58700020
WRITEF6  LA    REGONE,CCW1                                              59600018
         ST    REGONE,CHNPGADR          GET ADDR. WRITE CHANNEL PROGRAM 59800018
         MVI   CCW3+K4,NOCC             UNCHAIN WRITE FROM SID   Y02080 60000002
         MVC   SEEKCYL(FIVE),DADSMADR                                   60200018
         MVI   DSCBF5,F6INDIC           PUT F6 INDICATOR IN      A31333 60300020
*                                       RECORD                   A31333 60400020
         BAL   RETRNREG,EXCHANPG        WRITE F6                        60600018
         BR    RTNREG2                  RETURN                          60800018
*                                                                       60840020
* THIS ROUTINE EXECUTES THE CHANNEL PROGRAM THAT HAS BEEN SET UP        60880020
* BY ANOTHER ROUTINE.                                                   60920020
*                                                                       60960020
EXCHANPG MVI   ECB,ZERO                                                 61000018
         EXCP  IOB                                                      61200018
         WAIT  1,ECB=ECB                                                61400018
         TM    ECB,GOODIO               WAS I/O SUCCESSFUL              61600018
         BCR   1,RETRNREG               RETURN IF I/O SUCESSFUL  M0124  61800021
         LA    RERRPASS,ERRCD           SET ERROR RETURN CODE           62000018
ERREXIT  EQU   *                        BRANCH LABEL             Y02080 62600002
         LA    REGTWO,ERRLOAD           POINT TO ID OF IGG0325T  Y02080 62850002
XCTLHERE EQU   *                        BRANCH LABEL             Y02080 63200002
        IECRES LOAD,EXTPR=(RWKAREA),MODID=(REGTWO),BRANCH=DIRECT Y02080 63250002
*                                                                       63760021
* CONSTANTS                                                             63840021
*                                                                       63920021
         DS    0H                       HALF WORD BOUNDARY       A31333 64700020
EXTSIX   DC    X'0009'                  TEST FOR EXTENT 6        A31333 64800020
*                                                                       64820021
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         64840002
*                                                                       64860021
         XCTLTABL ID=(NEXTLOAD,5U,F6LOAD,5W,ERRLOAD,5T),SVC=032, Y02080X64910002
               LENGTH=,BRT=YES                                   Y02080 64970002
         EJECT                                                   Y02080 65020002
CVT      DSECT                                                          67000018
         CVT                                                     Y02080 67200002
         EJECT                                                   Y02080 67250002
DSCBWKAR IECALLWA EP,F4,D1=(1,3),D2=(6)  ALLOCATE WORK AREA      Y02080 67400002
DS4VTOC6 EQU   DS4VTOCE+6                                               72800018
CHNPGADR EQU   IOB+16                   ADDR. CHANNEL PROGRAM IN IOB    84800018
SEEKCYL  EQU   SEEK+3                                                   85200018
SEEKREC  EQU   SEEK+7                                                   85400018
ZEROS    EQU   CCW2+4                   FULL WORD OF ZERO               86000018
         END                                                            98800018
./  ADD  SSI=32510336,NAME=IGG0325R
 TITLE 'IGG0325R - FORMAT 5 DSCB PROCESSING'                            00100002
IGG0325R CSECT                                                          00150021
*                                                                       00160002
* MODULE NAME = IGG0325R                                                00170002
*                                                                       00180002
* DESCRIPTIVE NAME = FORMAT 5 DSCB PROCESSING                           00190002
*                                                                       00192002
* COPYRIGHT = NONE                                                      00194002
*                                                                       00196002
* CHANGE ACTIVITY = SEE BELOW                                           00198002
*                                                                     * 00200018
*          RELEASE 19 DELETIONS                                       * 00207018
*          RELEASE 20 DELETIONS                                       * 00214018
*1026033000,054000,345000-346000                                 A31534 00217020
*1026008000-010000,013000-014000,016000-026000,032000-034000,    A31333 00218020
*1026114000,116000-118000,186000,201000-206000,223000,226000,    A31333 00219020
*1026269000,271000-274000,340000-342000,350000                   A31333 00220020
*1026190000-191000,311000,313000-315000,332000,335000            A36311 00220520
*          RELEASE 21 DELETIONS                                       * 00221018
*1191005000-010000,012500-014500,173000-175000,196000,353000,    M0124  00221721
*1191355000-364000,366000-376000,378000,381000-404000,406000-    M0124  00222421
*1191408000,414000,417000,419000-421000,428000                   M0124  00223121
*1191032800,093000,345000-346000                                 S21040 00224021
*0000001000,222000                                               A53183 00226021
*          RELEASE 22 DELETIONS                                       * 00228018
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00235002
*0000000100-000500,002350-002630,015900-016200,019200-019500,    Y02080 00235102
*0000030000,031600,032200,032700,037000,045000,064000-071000,    Y02080 00235202
*0000073000,076000,080000,084000-092000,096000,100000-103000,    Y02080 00235302
*0000108000,121000,132000,135000,138000,142000-143000,145000-    Y02080 00235402
*0000146000,148000,160000-161000,165000-166000,170000,181000,    Y02080 00235502
*0000183100-183200,184000,185000,189000-191300,192000-193000,    Y02080 00235602
*0000193600-195600,197000-199000,225000,227000,229000,257000-    Y02080 00235702
*0000259000,261000,263000-265000,284000,286000,288000-289000,    Y02080 00235802
*0000293000,298000-299000,310300,310800,311000,318000,336000-    Y02080 00235902
*0000339000,339400,341000-365000,378000-405000,411500-418000,    Y02080 00236002
*0000424000-436000,438000,441000-442000,444000-506000            Y02080 00236102
*0000015300-024600,031300-031900,032500,033100-034600,039000,    Y02078 00236202
*0000049500-050000,072000,075500,082300-082600,086000,100000-    Y02078 00236302
*0000100100,108000-110000,132000,139000,141000-144000,149000-    Y02078 00236402
*0000151000,153000-154000,156000-158000,160000-162000,164000-    Y02078 00236502
*0000166000,182000-183100,183700,185000-187000,196600,225000,    Y02078 00236602
*0000227000-228000,230000-231000,253000,255000-261000,264000-    Y02078 00236702
*0000266000,280000,286000,288000-289000,294000-296000,306000-    Y02078 00236802
*0000320000,326000-327000,443500                                 Y02078 00236902
*                                                                     * 00270018
*STATUS CHANGE LEVEL 003                                                00277021
*                                                                     * 00284018
*                                                                     * 00300018
*                                                                     * 00400018
* FUNCTION/OPERATION  THIS MODULE SUBTRACTS THE ENTRIES IN THE DADSM  * 00500021
*   TABLE FROM THE FREE SPACE IN THE FORMAT 5 DSCB(S). IT CREATES THE * 00600021
*   2ND...NTH FORMAT 5 DSCB'S AS NECESSARY.                           * 00700021
*                                                                     * 01100018
* ENTRY POINTS                                                        * 01200018
*   IGG0325R - FROM IGG0325P TO SUBTRACT NON SPLIT-CYLINDER DATA SET  * 01260021
*                            EXTENTS FROM MULTIPLE FORMAT 5 DSCB'S    * 01320021
*              FROM IGG0325W TO SUBTRACT FORMAT 6 EXTENTS FROM THE    * 01380021
*                            FREE SPACE IN THE FORMAT 5 DSCB(S)       * 01440021
*                                                                     * 01500018
* INPUT  FROM IGG0325P                                                * 01530002
*              REGISTER 13 POINTS TO THE ALLOCATE WORK AREA, WHICH    * 01560002
*              CONTAINS THE FORMAT 4 DSCB, THE LAST FORMAT 1 OR 3     * 01590002
*              DSCB READ, AND THE FIRST FORMAT 5 DSCB.  THE SEEK      * 01620002
*              ADDRESS IN THE IOB CONTAINS THE CCHHR OF THE DSCB      * 01650002
*              BEING PROCESSED.  'CCW12' CONTAINS A TWO WORD          * 01680002
*              PARAMETER LIST CONSISTING OF THE NUMBER OF EXTENTS     * 01710002
*              IN THE DADSMTBL TO BE SUBTRACTED AND THE ADDRESS       * 01740002
*              OF THE FIRST EXTENT TO BE SUBTRACTED.                  * 01770002
*                                                                     * 01830002
*        FROM IGG0325W                                                * 01860002
*              REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,      * 01890002
*              WHICH WILL CONTAIN THE FORMAT 4 DSCB, THE FORMAT 6     * 01920002
*              DSCB BEING PROCESSED IN 'DSCBF1', AND THE FIRST FORMAT * 01950002
*              5 DSCB IN 'DSCBF5'.  'SEEKCYL' CONTAINS THE CCHHR OF   * 01980002
*              THE FORMAT 6 DSCB IN 'DSCBF1'.  'CCW12' WILL CONTAIN   * 02010002
*              A TWO WORD PARAMETER LIST CONSISTING OF THE NUMBER     * 02040002
*              OF EXTENTS IN THE DADSMTABLE TO BE SUBTRACTED AND      * 02070002
*              THE ADDRESS OF THE FIRST EXTENT TO BE SUBTRACTED.      * 02100002
*                                                                     * 02160002
* OUTPUT TO IGG0325P                                                  * 02190002
*              REGISTER 13 POINTS TO THE ALLOCATE WORK AREA, WHICH    * 02210002
*              CONTAINS THE FORMAT 4 DSCB, THE LAST FORMAT 1 OR 3     * 02230002
*              DSCB READ, AND THE FIRST FORMAT 5 DSCB IN THE CHAIN.   * 02250002
*              'COUNT' CONTAINS THE CCHHR OF THE NEXT DSCB TO BE READ.* 02270002
*              REGISTER 1 IS ZERO TO INDICATE REENTRY FROM IGG0325R.  * 02290002
*                                                                     * 02310002
*        TO IGG0325W                                                  * 02340002
*              REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,      * 02360002
*              WHICH WILL CONTAIN THE FORMAT 4 DSCB, THE FORMAT 6     * 02380002
*              DSCB CURRENTLY BEING PROCESSED IN 'DSCBF1', AND THE    * 02400002
*              FIRST FORMAT 5 DSCB IN 'DSCBF5'.  REGISTER 1 WILL BE   * 02420002
*              ZERO TO INDICATE REENTRY FROM IGG0325R.                * 02440002
*                                                                     * 02460002
*                                                                     * 02700018
* EXTERNAL ROUTINES                                                   * 02800018
*          EXCP(0)                                                    * 02900018
*          WAIT(1)                                                    * 03100018
*          IECRES - TO GET AND FREE WORK AREA EXTENSIONS              * 03110002
*                                                                     * 03130002
* EXITS NORMAL BRANCH TO IGG0325P TO ADD MORE NON SPLIT CYLINDER      * 03160002
*                    DATA SET EXTENTS TO THE DADSM EXTENT TABLE       * 03190002
*              BRANCH TO IGG0325W TO ADD MORE F6 EXTENTS TO THE       * 03220002
*                    DADSM EXTENT TABLE                               * 03250002
*       ERROR  BRANCH TO IGG0325T                                     * 03270002
*                                                                     * 03290021
*       ERROR CODES ISSUED BY THIS MODULE -                           * 03310002
*                                                                     * 03340002
*       0C - PERMANENT I/O ERROR                                      * 03370002
*                                                                     * 03400002
*       94 - OVERLAPPING EXTENTS IN THE VTOC                          * 03430002
*                                                                     * 03440002
*       98 - OVERLAPPING DOS SPLIT CYLINDER EXTENTS IN THE VTOC       * 03450002
*                                                                     * 03460002
* TABLES/WORKAREAS - DADSM WORKAREA                                   * 03500018
*                                                                     * 03600018
* ATTRIBUTES  REENTRANT                                               * 03700002
*                                                                     * 03800018
REGZERO  EQU   0                        WORK REGISTER            A31333 03850020
REGONE   EQU   1                        WORK REGISTER            Y02078 03900002
REENTRY  EQU   1                       INDICATES RETURN TO SECOND LOAD  04000018
F5ADDR   EQU   2                       ADDR EXTENT IN F5                04100018
REGTWO   EQU   2                        EQUATE FOR REGISTER 2    Y02080 04150002
DADSMCTR EQU   3                       COUNTER OF EXTENTS IN DADSMTBL   04200018
RTNREG2  EQU   4                       BRANCH REGISTER                  04300018
REGFOUR  EQU   4                        WORK REGISTER            Y02078 04350002
ALLOCADR EQU   5                       ADDR EXTENT IN DADSMTBL          04400018
LSTF5CTR EQU   6                       CTR OF EXTENTS IN LAST F5 Y02080 04500002
F5EXTCTR EQU   7                       NO. OF EXTENT IN F5              04600018
REGEIGHT EQU   8                       WORK REGISTER                    04700018
RERRPASS EQU   8                        ERROR CODE REGISTER      A31534 04750020
REGNINE  EQU   9                       WORK REGISTER                    04800018
REGTEN   EQU   10                      WORK REGISTER                    04900018
RVTOCWKA EQU   11                       VTOC CONVERSION W/A PTR  Y02078 05000002
BASEREG  EQU   12                      BASE REGISTER                    05100018
RWKAREA  EQU   13                      WORK AREA BASE REGISTER          05200018
RETRNREG EQU   14                      RETURN REG                       05300018
REG14    EQU   14                       WORK REGISTER            Y02078 05320002
REG15    EQU   15                       WORK REGISTER            Y02078 05340002
*                                                                     * 05350021
* OTHER EQUATES                                                       * 05400021
*                                                                     * 05450021
ZERO     EQU   0                        VALUE ZERO                      05500018
ONE      EQU   1                        VALUE ONE                       05600018
TWO      EQU   2                        VALUE TWO                       05700018
THREE    EQU   3                        VALUE THREE                     05800018
K4       EQU   4                        CONSTANT OF 4            Y02080 05850002
FOUR     EQU   4                        VALUE FOUR                      05900018
FIVE     EQU   5                        VALUE FIVE                      06000018
SIX      EQU   6                        VALUE SIX                       06100018
SEVEN    EQU   7                        VALUE SEVEN                     06200018
EIGHT    EQU   8                        VALUE EIGHT                     06300018
TWELVE   EQU   12                       VALUE TWELVE             Y02078 06400002
DOSBIT   EQU   X'80'                    DOS BIT IN DS4VTOCI      Y02078 07000002
VTOCERR  EQU   X'94'                    OVERLAPPING XTENTS ERROR Y02078 07100002
DOSERR   EQU   X'98'                    DOS OVERLAPPING EXTENTS  Y02078 07200002
GOODIO   EQU   X'20'                    TEST VALUE FOR SUCCESSFUL I/O   07400018
ERRCD    EQU   X'0C'                    ERROR CODE FOR UNSUCCESSFUL I/O 07500018
C26      EQU   26                                                       07700018
C140     EQU   140                                                      07800018
C125     EQU   125                      VALUE 125                       07900018
C27      EQU   27                       VALUE 27                        08100018
READCOMD EQU   X'0E'                    READ COMMAND CODE               08200018
C25      EQU   25                       VALUE 25                        08300018
NOCC     EQU   X'00'                    NO COMMAND CHAINING      Y02080 08350002
SLI      EQU   X'20'                    SUPPRESS WRONG LENGTH    Y02080 08400002
CC       EQU   X'40'                    COMMAND CHAINING BIT     Y02080 08650002
*                                                                     * 09300021
          BALR  BASEREG,ZERO           INITIALIZE BASE REGISTER         09400018
         USING *,BASEREG                                                09500018
         USING ALLOCWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 09600002
         USING VTOCWKA,RVTOCWKA         VTOC W/A ADDRESSABILITY  Y02078 09650002
*                                                                     * 09700018
* INITIALIZE REGISTERS                                                  09800018
*                                                                     * 09900018
         LH    DADSMCTR,CCW12+TWO       NBR EXTENTS TO SUBTRACT  Y02080 10100002
         L     ALLOCADR,CCW12+FOUR      GET PTR TO EXTENT        Y02080 10200002
         LH    LSTF5CTR,LSTF5CT         NBR EXTENTS IN LAST F5   Y02080 10300002
*                                                                     * 10400018
* SAVE ADDRESS OF FORMAT 5 CURRENTLY BEING PROCESSED AND PUT THIS     * 10500018
* ADDRESS IN WHERE TO WRITE 1ST F5 IN MERGE OR EXPAND ROUTINE           10600018
*                                                                     * 10700018
         BAL   RETRNREG,LOC1STF5        FIND ADDRESS OF 1ST F5   Y02078 10750002
         ST    RVTOCWKA,PREVF5AD        INIT. PREVIOUS F5 ADDR   Y02078 10800002
         ST    RVTOCWKA,FMTINAD         SAVE WHERE-TO-WRITE ADDR Y02078 10850002
         ST    RVTOCWKA,CURRF5AD        SAVE ADDRESS OF THE F5   Y02078 10900002
*                                       NOW BEING COMPARED       Y02078 10950002
STARTCOM LA    F5EXTCTR,ONE             INT. NO. F5 EXTENT BEING CMP    11100018
         LA    F5ADDR,DS5AVEXT          GET ADDR 1ST EXTENT IN F5       11200018
BEGNCOMP CLC   ZERO(TWO,ALLOCADR),ZERO(F5ADDR) COMPARE BEGIN OF EXTENTS 11300018
         BL    DSERROR                  BRANCH IF LOW            A31333 11400020
         BH    MORECK                   BRANCH IF ALLOCATED EXTENT HIGH 11500018
         CLC   TWO(TWO,ALLOCADR),TWO(F5ADDR) COMPARE ENDS OF     A31333 11550020
*                                       EXTENTS                  A31333 11600020
         BH    DSERROR                  ERROR IF EXTENT TO BE    A31333 11650020
*                                       SUBTRACTED IS GREATER           11700020
*                                       THAN FREE EXTENT                11750020
         BL    REPLACE                  BRANCH IF LOWER          A31333 11800020
*                                                                     * 11900018
* MOVE ALL EXTENTW IN CURRENT FORMAT 5 DSCB'S FOWARD TO WIPE OUT      * 12000018
* EXTENT JUST ALLOCATED AND UPDATE LSTF5CTR TO REFLECT ONE LESS       * 12100002
* EXTENT (MERGE ROUTINE)                                              * 12200018
*                                *                                    * 12300018
WIPEOUT  LA    REGEIGHT,C26             GET MAX. NO. EXTENTS IN F5      12400018
         SR    REGEIGHT,F5EXTCTR        CALCULATE LOOP CONTROL          12500018
         BZ    COMPLAST                BRANCH IF LAST EXTENT IN THIS    12600018
*                                      F5 TO BE WIPED OUT               12700018
         LR    REGNINE,F5ADDR           GET ADDR FREE EXTENT AFFECTED   12800018
MOVEFLD  MVC   ZERO(FIVE,REGNINE),FIVE(REGNINE) MOVE A FIELD            12900018
         LA    REGNINE,FIVE(REGNINE)   POINT TO NEXT EXTENT             13000018
         BCT   REGEIGHT,MOVEFLD         BRANCH IF MORE EXTENTS TO MOVE  13100018
COMPLAST EQU   *                        BRANCH LABEL             Y02080 13150002
         CLC   DS5PTRDS+ONE(FOUR),ZEROS  TEST IF LAST IN CHAIN   Y02078 13200002
         BNE   MERGERTN                 BRANCH IF NO                    13300018
         LA    REGEIGHT,C26                                             13400018
         CR    REGEIGHT,LSTF5CTR        26 EXTENTS IN LAST F5    Y02080 13500002
         BNE   NEXTCOMP                BRANCH IF LAST F5 NOT FULL       13600018
         MVC   F5EXT16(FIVE),F5EXT16+FIVE     ZERO LAST EXTENT          13700018
NEXTCOMP EQU   *                        BRANCH LABEL             Y02080 13750002
         BCT   LSTF5CTR,WRITENOW        BR IF LAST F5 NOT ZERO   Y02080 13800002
         L     REGTEN,FMTINAD           ADDR OF F5 TO BE ZEROED  Y02078 13900002
*                                      IN CHANNEL PROGRAM             * 14000018
         XC    ZERO(L'VTC1STF5+L'VTCBPTR1,REGTEN),ZERO(REGTEN)   Y02078 14020002
*                                       ZERO LAST FORMAT 5 AND   Y02078 14040002
*                                       ITS BACKWARD POINTER     Y02078 14060002
         LH    REGONE,F5BLDCT           LOAD COUNT OF BUILT F5'S Y02078 14080002
         BCTR  REGONE,ZERO              DECREMENT BY ONE         Y02078 14100002
         STH   REGONE,F5BLDCT           SAVE UPDATED COUNT       Y02078 14120002
         LTR   REGONE,REGONE            TEST IF NO REBUILT F5'S  Y02078 14140002
         BZ    UPDATPTR                 BRANCH IF YES            Y02078 14160002
         XR    REGZERO,REGZERO          ZERO REGISTER FOR DIVIDE Y02078 14180002
         D     REGZERO,FW3              3 F5 SLOTS PER WORK AREA Y02078 14200002
         LTR   REGZERO,REGZERO          TEST IF LAST WORK AREA   Y02078 14220002
*                                       HAS ANY REBUILT F5'S     Y02078 14240002
         BNZ   NEWLAST                  BRANCH IF YES            Y02078 14260002
         CLC   F5FNDCT,F5BLDCT          TEST IF WKAREA IS EMPTY  Y02078 14280002
         BH    NEWLAST                  BRANCH IF NOT            Y02078 14300002
         IECRES FREE,PREFIX=YES,A=(REGTEN),                      Y02078X14320002
               STM=(REGONE,RWKAREA,IECREGSV+TWELVE)  FREE THE    Y02078X14340002
                                        LAST WORK AREA EXTENSION Y02078X14360002
                                        IF IT IS TOTALLY EMPTY   Y02078 14380002
NEWLAST  EQU   *                        BRANCH LABEL             Y02078 14400002
         L     REGTEN,PREVF5AD          ADDRESS OF NEW LAST F5   Y02078 14420002
         ST    REGTEN,LASTF5AD          UPDATE ADDR OF LAST F5   Y02078 14440002
         MVC   DSCBF5,ZERO(REGTEN)      MOVE IN NEW LAST F5      Y02078 14460002
         MVI   DS5PTRDS,ZERO                                     Y02080 14500002
         MVC   DS5PTRDS+ONE(FOUR),DS5PTRDS  ZERO OUT F5 CHAIN    Y02080 14600002
*                                       ADDRESS IN NEW LAST F5   Y02080 14660002
         BAL   RTNREG2,WRITEF5          WRITE NEW LAST F5               14700018
         LA    LSTF5CTR,C26             26 EXTENTS IN LAST F5    Y02080 14800002
         B     READNOW5                 GO TO READ F5 NOW BEING CMP     15200018
WRITENOW EQU   *                        BRANCH LABEL             Y02078 15300002
         L     REGTEN,FMTINAD           WHERE-TO-WRITE ADDRESS   Y02078 15400002
         BAL   RTNREG2,WRITEF5          WRITE F5                        15500018
READNOW5 EQU   *                        BRANCH LABEL             Y02078 15600002
         L     REGTEN,CURRF5AD          ADDRESS OF F5 NOW BEING  Y02078 15650002
*                                       COMPARED                 Y02078 15700002
         ST    REGTEN,FMTINAD           INIT WHERE-TO-WRITE ADDR Y02078 15750002
         MVC   DSCBF5,ZERO(REGTEN)      MOVE IN F5 TO COMPARE    Y02078 15800002
         B     UPDATPTR                 GO TO SUBT NEXT EXTENT          15900018
MERGERTN EQU   *                        BRANCH LABEL             Y02080 15950002
         L     REGTEN,DS5PTRDS+ONE      LOAD CHAINING ADDRESS    Y02078 16100002
         MVC   DSCBF1,ZERO(REGTEN)      MOVE IN NEXT F5 IN CHAIN Y02078 16200002
         MVC   F5EXT16(FIVE),DSF3EXT1   MERGE EXTENT TO PREVIOUS F5     16300018
         L     REGTEN,FMTINAD           GET WHERE-TO-WRITE ADDR  Y02078 16400002
         MVC   FMTINAD(FOUR),DS5PTRDS+ONE  NEW WHERE-TO-WR ADDR  Y02078 16500002
         ST    REGTEN,PREVF5AD          NEW PREVIOUS F5 ADDRESS  Y02078 16600002
         BAL   RTNREG2,WRITEF5          WRITE PREVIOUS F5               16700018
         XC    DSCBF5(C140),DSCBF5      ZERO F5 AREA                    16800018
         MVC   DS5AVEXT(C125),DSF3EXT2  UPDATE NEXT F5 IN CHAIN         16900018
         MVC   DS5PTRDS,DS1PTRDS        SAVE CHAINING POINTER    Y02080 17000002
         B     COMPLAST                 GO TO CHECK FOR LAST F5         17100018
*                                                                     * 17200018
* THIS ROUTINE MODIFIES A FORMAT 5 EXTENT WHEN THE ALLOCATED EXTENT   * 17300021
* BEGINS AT THE BEGINNING OF THE FORMAT 5 EXTENT.                     * 17400021
*                                                                     * 17600018
REPLACE  MVC   ZERO(TWO,F5ADDR),TWO(ALLOCADR) UPDATE LOWER EXTENT BOUND 17700018
         B     WRITENOW                 GO TO WRITE F5                  17800018
UPDATPTR LA    ALLOCADR,FOUR(ALLOCADR)  UPDATE PTR TO EXTENT TO BE SUBT 17900018
         BCT   DADSMCTR,BEGNCOMP        BRANCH IF MORE EXTENTS TO SUBT  18000018
         STH   LSTF5CTR,LSTF5CT         SAVE LAST F5 EXTENT CTR  Y02080 18100002
         BAL   RETRNREG,LOC1STF5        FIND ADDRESS OF 1ST F5   Y02078 18200002
         MVC   DSCBF5,VTC1STF5          MOVE IN FIRST F5         Y02078 18300002
         CLI   CCW12,ZERO               ENTRY FROM IGG0325P      Y02080 18320002
         BNE   UNCHAIND                 BRANCH IF NO             A31333 18330020
         CLC   SEEKCYL(FOUR),DS4VTOC6   LAST TRACK IN VTOC       A31333 18340020
         BNE   NOTLAST                  BRANCH IF NOT            A31333 18350020
         CLC   SEEKREC(ONE),DS4DEVDT    LAST RECORD ON TRACK     A31333 18360020
         BNE   NOTLAST                  BRANCH IF NOT            Y02078 18365002
         MVI   CCW6+K4,NOCC             UNCHAIN READ FROM RD CNT Y02078 18370002
         B     UNCHAIND                 BRANCH TO REREAD DSCB    Y02078 18375002
NOTLAST  EQU   *                                                 A31333 18380020
         MVI   CCW6+K4,CC               CHAIN READ TO READ COUNT Y02080 18400002
UNCHAIND EQU   *                                                 A31333 18450020
         BAL   RETRNREG,READTOF1        READ LAST F1 OR F3 READ  Y02078 18700002
         SR    REENTRY,REENTRY          ZERO PARAMETER REG              18800018
         CLI   CCW12,ZERO               ENTRY FROM IGG0325P      Y02080 19130002
         BNE   LOAD325W                 BRANCH IF NO             A31333 19160020
         LA    REGTWO,F5LOAD            POINT TO ID OF IGG0325P  Y02080 19210002
         B     XCTLHERE                 GO XCTL                  A31333 19320020
LOAD325W EQU   *                                                 A31333 19340020
         LA    REGTWO,F6LOAD            POINT TO ID OF IGG0325W  Y02080 19390002
XCTLHERE EQU   *                        BRANCH LABEL             Y02080 19440002
        IECRES LOAD,EXTPR=(RWKAREA),MODID=(REGTWO),BRANCH=DIRECT Y02080 19490002
DSERROR  EQU   *                                                 A31333 19630020
         LA    RERRPASS,VTOCERR         OVERLAPPING EXTENTS ERR  Y02078 19640002
         CLI   CCW12,ZERO               ENTRY FROM IGG0325P      Y02078 19650002
         BE    ERREXIT                  BRANCH IF YES            Y02078 19660002
         TM    DS4VTOCI,DOSBIT          TEST IF DOS VOLUME       Y02078 19670002
         BNO   ERREXIT                  BRANCH IF NOT            Y02078 19680002
         LA    RERRPASS,DOSERR          DOS SPLIT/CYL EXTENT ERR Y02078 19690002
ERREXIT  EQU   *                        BRANCH LABEL             Y02080 19710002
         LA    REGTWO,LASTLOAD          POINT TO ID OF IGG0325T  Y02080 19760002
         B     XCTLHERE                 GO TO XCTL                      20000018
*                                                                     * 20700018
* THIS SECTION CHECKS TO SEE IF ALLOCATED EXTENT DIVIDES FREE EXTENT  * 20800018
* IN TWO PARTS,IF THE UPPER BOUNDRY OF THE FREE EXTENT MUST BE UPDATED* 20900018
* OR IF THE ALLOCATED EXTENT MUST BE COMPARED AGAINST THE NEXT FREE   * 21000018
* EXTENT                                                              * 21100018
*                                                                     * 21200018
MORECK   CLC   ZERO(TWO,ALLOCADR),TWO(F5ADDR) IS ALLOCATED EXT IN THIS  21300018
*                                       FREE EXTENT                   * 21400018
         BL    EXPANDCK                 BRANCH IF YES                   21500018
         LA    F5EXTCTR,ONE(F5EXTCTR)                                   21600018
         LA    REGEIGHT,C27                                             21700018
         CR    F5EXTCTR,REGEIGHT        HAS LAST EXTENT IN THIS F5      21800018
*                                       BEEN COMPARED                 * 21900018
         BE    READNXT                  BRANCH IF YES                   22000018
         LA    F5ADDR,FIVE(F5ADDR)      POINT TO NEXT EXTENT            22100018
         CLC   ZERO(FOUR,F5ADDR),ZEROS  IS THIS EXTENT ZERO      A53183 22200021
         BE    DSERROR                  ERROR IF EXTENT TO BE    A31333 22250020
*                                       SUBTRACTED IS NOT WITHIN        22300020
*                                       ANY FREE EXTENT                 22350020
         B     BEGNCOMP                 BRANCH TO BEGIN COMPARISON      22400018
READNXT  EQU   *                        BRANCH LABEL             Y02080 22450002
         CLC   DS5PTRDS+ONE(FOUR),ZEROS  IS THIS THE LAST F5     Y02078 22500002
         BE    DSERROR                  ERROR IF EXTENT TO BE    A31333 22550020
*                                       SUBTRACTED IS NOT WITHIN        22600020
*                                       ANY FREE EXTENT                 22650020
         L     REGTEN,DS5PTRDS+ONE      LOAD NEXT F5 ADDRESS     Y02078 22700002
         MVC   DSCBF5,ZERO(REGTEN)      MOVE IN NEXT F5          Y02078 22800002
         MVC   PREVF5AD,FMTINAD         SAVE PREVIOUS F5 ADDR    Y02080 22900002
         ST    REGTEN,FMTINAD           SAVE WHERE-TO-WRITE ADDR Y02078 23000002
UPDATNXT EQU   *                        BRANCH LABEL             Y02078 23100002
         ST    REGTEN,CURRF5AD          ADDR F5 BEING COMPARED   Y02078 23150002
         B     STARTCOM                 BRANCH TO BEGIN COMPARISON      23200018
EXPANDCK CLC   TWO(TWO,ALLOCADR),TWO(F5ADDR) ARE ENDS OF EXTENTS EQUAL  23300018
         BE    REPLACE2                 BRANCH IF YES                   23400018
         BH    DSERROR                  ERROR IF EXTENT TO BE    A31333 23420020
*                                       SUBTRACTED IS GREATER           23440020
*                                       THAN FREE EXTENT                23460020
         MVC   DSCBF1(FIVE),F5EXT16                                     23500018
         LA    REGNINE,C26              GET MAX.NO. EXTENTS IN F5       23600018
         CR    REGNINE,F5EXTCTR         IS LAST EXTENT IN F5 BEING      23700018
*                                       DIVIDED                       * 23800018
         BE    SETUP                    BRANCH IF YES                   23900018
         LA    REGNINE,FIVE                                             24000018
         LA    REGEIGHT,F5EXT15                                         24100018
MOVE     MVC   FIVE(FIVE,REGEIGHT),ZERO(REGEIGHT) MOVE A FIELD          24200018
         CR    REGEIGHT,F5ADDR          HAVE ALL FIELDS BEEN MOVED      24300018
         BE    CONT                     BRANCH IF YES                   24400018
         SR    REGEIGHT,REGNINE         UPDATE POINTER TO NEXT FIELD    24500018
         B     MOVE                     GO TO MOVE NEXT FIELD           24600018
SETUP    MVC   TWO(TWO,F5ADDR),ZERO(ALLOCADR) SET UP NEW BOUND TO EXT   24700018
         MVC   DSCBF1(TWO),TWO(ALLOCADR)                                24800018
         B     LASTF5CK                 GO TO SEE IF THIS IS LAST F5    24900018
CONT     MVC   SEVEN(TWO,F5ADDR),TWO(F5ADDR) SET UP                     25000018
         MVC   TWO(TWO,F5ADDR),ZERO(ALLOCADR)    NEW BOUNDS FOR         25100018
         MVC   FIVE(TWO,F5ADDR),TWO(ALLOCADR)               DIVIDED EXT 25200018
LASTF5CK EQU   *                        BRANCH LABEL             Y02078 25300002
         L     REGTEN,FMTINAD           GET WHERE-TO-WRITE ADDR  Y02078 25350002
         BAL   RTNREG2,WRITEF5          WRITE F5                        25400018
         CLC   DS5PTRDS+ONE(FOUR),ZEROS  IS THIS LAST F5 DSCB    Y02078 26100002
         BE    FINXPAND                 BRANCH IF YES                   26200018
         MVC   PREVF5AD,FMTINAD         SAVE PREVIOUS F5 ADDR    Y02080 26300002
         L     REGTEN,DS5PTRDS+ONE      GET NEXT F5 ADDRESS      Y02078 26400002
         ST    REGTEN,FMTINAD           SAVE WHERE-TO-WRITE ADDR Y02078 26500002
         MVC   DSCBF5,ZERO(REGTEN)      MOVE IN NEXT F5          Y02078 26600002
         MVC   DSF3SAVE(FIVE),F5EXT16   SAVE LAST EXTENT IN F5 JUST     26700018
*                                       READ                          * 26800018
         LA    REGZERO,FIVE             GET POINTER DECREMENT    A31333 26900020
         LA    REGEIGHT,C25             LOAD LOOP CONTROL               27000018
         LA    REGNINE,F5EXT15          POINT TO EXTENT TO BE    A31333 27080020
*                                       MOVED                    A31333 27160020
MOVE2    EQU   *                                                 A31333 27240020
         MVC   FIVE(FIVE,REGNINE),ZERO(REGNINE) MOVE A FIELD     A31333 27320020
         SR    REGNINE,REGZERO          DECREMENT PTR TO FIELD   A31333 27400020
         BCT   REGEIGHT,MOVE2           BRANCH IF MORE FIELDS TO MOVE   27500018
         MVC   DS5AVEXT(FIVE),DSCBF1    MOVE IN NEW FIRST EXTENT        27600018
         MVC   DSCBF1(FIVE),DSF3SAVE    POSITION EXTENT SAVED FROMF5    27700018
         B     LASTF5CK                 GO TO WRITE F5 JUST EXPANDED    27800018
REPLACE2 MVC   TWO(TWO,F5ADDR),ZERO(ALLOCADR) SET UP NEW UPPER BOUND    27900018
         L     REGTEN,FMTINAD           GET WHERE-TO-WRITE ADDR  Y02078 28000002
         BAL   RTNREG2,WRITEF5          WRITE F5                        28100018
         B     UPDATPTR                 GO TO SUBT NEXT EXTENT          28200018
FINXPAND LA    REGEIGHT,C26                                             28300018
         CR    LSTF5CTR,REGEIGHT        IS LAST F5 FULL          Y02080 28400002
         BL    INCRCTR                  BRANCH IF NO                    28500018
         XR    REGTEN,REGTEN            INDICATE NEED OF NEW F5  Y02078 28600002
*                                       SLOT IN A W/A EXTENSION  Y02078 28650002
         BAL   RTNREG2,WRITEF5          WRITE F5 JUST EXPANDED          28700018
*                                       REGTEN POINTS TO F5 SLOT Y02078 28800002
         XC    DSCBF5(C140),DSCBF5      CLEAR F5 AREA                   29000018
         MVC   DS5AVEXT(FIVE),DSCBF1    MOVE EXTENT TO NEW F5           29100018
         BAL   RTNREG2,WRITEF5          WRITE NEW F5                    29200018
         LA    LSTF5CTR,ONE             INITIALIZE LAST F5 CTR   Y02080 29300002
         B     READNOW5                 READ F5 BEING COMPARED          29700018
INCRCTR  EQU   *                        BRANCH LABEL             Y02080 29750002
         LA    LSTF5CTR,ONE(LSTF5CTR)   UPDATE CTR OF EXTENTS IN Y02080 29800002
*                                       LAST F5                  Y02080 29900002
         CR    REGEIGHT,F5EXTCTR        IS FREE EXTENT JUST DIVIDED     30000018
*                                       THE LAST EXTENT IN THAT F5      30100018
         BNH   READNOW5                 BRANCH IF YES                   30200018
PTRUPDAT LA    F5ADDR,FIVE(F5ADDR)      POINT TO NEXT FREE EXTENT       30300018
         LA    F5EXTCTR,ONE(F5EXTCTR)   UPDATE CTR OF FREE EXTENT       30400018
         B     READNOW5                 READ F5 NOW BEING COMPARED      30500018
*                                                                       30520002
* THIS ROUTINE LOCATES THE ADDRESS OF THE FIRST FORMAT 5 DSCB IN        30540002
* THE VTOC EXTENSION WORK AREA(S) AND RETURNS ITS ADDRESS IN            30560002
* REGISTER RVTOCWKA.                                                    30580002
*                                                                       30600002
LOC1STF5 EQU   *                        BRANCH LABEL             Y02078 30620002
         LA    REGEIGHT,ZERO(RWKAREA)   INITIAL WORK AREA ADDR   Y02078 30640002
         LA    REGONE,IECEXTPR-IECPREFX  LENGTH OF PREFIX        Y02078 30660002
         SR    REGEIGHT,REGONE          CALCULATE PREFIX ADDRESS Y02078 30680002
NXTPREFX EQU   *                        BRANCH LABEL             Y02078 30700002
         USING IECPREFX,REGEIGHT        PREFIX ADDRESSABILITY    Y02078 30720002
         L     REGEIGHT,IECCORP2        LOAD ADDR OF NEXT PREFIX Y02078 30740002
         CLC   IECCORID,VCWKAID         TEST IF VTOC WORK AREA   Y02078 30760002
         BNE   NXTPREFX                 BRANCH IF NOT            Y02078 30780002
         L     RVTOCWKA,IECCORAD        LOAD ADDR OF EXTENSION   Y02078 30800002
         BR    RETRNREG                 RETURN                   Y02078 30820002
         DROP  REGEIGHT                                          Y02078 30840002
*                                                                       30860002
* THIS ROUTINE MOVES A FORMAT 5 DSCB FROM 'DSCBF5' TO THE LOCATION      30880002
* POINTED TO BY REGISTER 10.  IF REGISTER 10 IS ZERO, THIS INDICATES    30900002
* THAT A FORMAT 5 DSCB IS BEING EXPANDED AND THAT A NEW FORMAT 5 SLOT   30920002
* MUST BE FOUND IN AN EXISTING WORK AREA EXTENSION OR THAT A NEW WORK   30940002
* AREA EXTENSION MUST BE OBTAINED.  THE ADDRESS OF THE NEW SLOT IS      30960002
* INSERTED INTO THE CHAINING FIELD OF THE FORMAT 5 IN 'DSCBF5' BEFORE   30980002
* IT IS WRITTEN TO THE LOCATION WHOSE ADDRESS IS IN 'FMTINAD'.  THEN    31000002
* THE ADDRESS OF THE NEW FORMAT 5 SLOT IN RETURNED IN REGISTER 10.      31020002
*                                                                       31040002
WRITEF5  EQU   *                        BRANCH LABEL             Y02078 31060002
         LTR   REGTEN,REGTEN            TEST IF A NEW F5 SLOT    Y02078 31080002
*                                       MUST BE FOUND            Y02078 31100002
         BZ    BLDNEWF5                 BRANCH IF YES            Y02078 31120002
         MVC   ZERO(L'DSCBF5,REGTEN),DSCBF5  MOVE OUT UPDATED F5 Y02078 31140002
         BR    RTNREG2                  RETURN                   Y02078 31160002
BLDNEWF5 EQU   *                        BRANCH LABEL             Y02078 31180002
         XR    REGEIGHT,REGEIGHT        PREPARE FOR DIVISION     Y02078 31200002
         LH    REGNINE,F5BLDCT          GET NBR OF REBUILT F5'S  Y02078 31220002
         D     REGEIGHT,FW3             3 F5'S PER WKA EXTENSION Y02078 31240002
         L     REGONE,FMTINAD           LOAD WHERE-TO-WRITE ADDR Y02078 31260002
         LTR   REGEIGHT,REGEIGHT        TEST IF NO FREE F5 SLOT  Y02078 31280002
         BNZ   FREESLOT                 BRANCH IF A FREE SLOT    Y02078 31300002
         CLC   F5BLDCT,F5FNDCT          TEST FOR AN EXTENSION    Y02078 31320002
*                                       WITHOUT ANY REBUILT F5'S Y02078 31340002
         BNL   NEWKAREA                 BRANCH IF NOT            Y02078 31360002
NEXTWKA  EQU   *                        BRANCH LABEL             Y02078 31380002
         LR    REG14,REGONE             LOAD WHERE-TO-WRITE ADDR Y02078 31400002
         LA    REG15,VTC3RDF5-VTC1STF5  OFFSET TO W/A BEGINNING  Y02078 31420002
         LA    REG15,IECEXTPR-IECPREFX(REG15)  PREFIX LENGTH     Y02078 31440002
         SR    REG14,REG15              POINT TO WKAREA PREFIX   Y02078 31460002
         USING IECPREFX,REG14           PREFIX ADDRESSABILITY    Y02078 31480002
         L     REG14,IECCORP2           LOAD ADDR OF NEXT PREFIX Y02078 31500002
         L     REGTEN,IECCORAD          LOAD ADDR OF EXTENSION   Y02078 31520002
*                                       WHICH IS FREE SLOT ADDR  Y02078 31540002
         DROP  REG14                                             Y02078 31560002
MOVEF5IN EQU   *                        BRANCH LABEL             Y02078 31580002
         ST    REGTEN,DS5PTRDS+ONE      INSERT CHAINING ADDRESS  Y02078 31600002
         MVC   ZERO(L'DSCBF5,REGONE),DSCBF5  MOVE OUT UPDATED F5 Y02078 31620002
         LH    REGNINE,F5BLDCT          GET NBR OF REBUILT F5'S  Y02078 31640002
         LA    REGNINE,ONE(REGNINE)     INCREMENT COUNT          Y02078 31660002
         STH   REGNINE,F5BLDCT          SAVE UPDATED COUNT       Y02078 31680002
         ST    REGTEN,LASTF5AD          UPDATED PTR TO LAST SLOT Y02078 31700002
         ST    REGONE,VTCBPTR(REGTEN)   INSERT BACKWARD POINTER  Y02078 31720002
         BR    RTNREG2                  RETURN                   Y02078 31740002
FREESLOT EQU   *                        BRANCH LABEL             Y02078 31760002
         LA    REGTEN,VTCNXTF5(REGONE)  POINT TO NEXT W/A SLOT   Y02078 31780002
         B     MOVEF5IN                 GO MOVE IN UPDATED F5    Y02078 31800002
NEWKAREA EQU   *                        BRANCH LABEL             Y02078 31820002
         LR    REG14,REGONE             SAVE WHERE-TO-WRITE ADDR Y02078 31840002
         IECRES GET,EXTPR=(RWKAREA),LV=VWALNGTH,ID=VCWA,         Y02078X31860002
               STM=(F5ADDR,REG14,IECREGSV+12)  OBTAIN NEXT WKA   Y02078 31880002
         LR    REGTEN,REGONE            ADDR OF NEW EXTENSION    Y02078 31900002
         LR    REGONE,REG14             RESTORE WHERE-TO-WR ADDR Y02078 31920002
         B     MOVEF5IN                 GO MOVE IN UPDATED F5    Y02078 31940002
*                                                                       31960002
* THIS ROUTINE REREADS THE FORMAT 1, 3, OR 6 DSCB BEING PROCESSED.      31980002
*                                                                       32000002
READTOF1 LA    REGEIGHT,DSCBF1          GET ADDR OF F1 AREA             32100018
FURTHER  ST    REGEIGHT,CCW6            STORE ADDR OF AREA RECEIVING F5 32200018
         LA    REGEIGHT,CCW4                                            32300018
         ST    REGEIGHT,CHNPGADR        SET CHANNEL PROGRAM TO READ     32400018
         MVI   CCW6,READCOMD            MOVE IN READ CODE               32500018
EXCHANPG MVI   ECB,ZERO                                                 32800018
         EXCP  IOB                                                      32900018
         WAIT  1,ECB=ECB                                                33000018
         TM    ECB,GOODIO                                               33100018
         BCR   ONE,RETRNREG        RETURN IF GOOD I/O            A36311 33200020
         LA    RERRPASS,ERRCD                                           33300018
         B     ERREXIT                  BRANCH IF ERROR                 33400018
*                                                                     * 33450021
* CONSTANTS                                                           * 33500021
*                                                                     * 33550021
VCWKAID  DC    C'VCWA'                  VTOC WORK AREA PREFIX ID Y02078 33560002
FW3      DC    F'3'                     3 F5'S PER WKA EXTENSION Y02078 33570002
*                                                                     * 33920021
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                       * 33940002
*                                                                     * 33960021
         XCTLTABL ID=(F5LOAD,5P,F6LOAD,5W,LASTLOAD,5T),          Y02080X34010002
               SVC=032,LENGTH=,BRT=YES                           Y02080 34060002
         EJECT                                                   Y02080 34110002
CVT      DSECT                          CVT DSECT                Y02080 34120002
         CVT                                                     Y02080 34130002
         EJECT                                                   Y02080 34210002
DSCBWKAR IECALLWA EP,F4,D1=(1),D2=(5)   ALLOCATE WORK AREA       Y02080 35100002
DS4VTOC6 EQU   DS4VTOCE+6                                               37700018
DSF3EXT1 EQU   DSCBF1+4                                                 40900018
DSF3EXT2 EQU   DSCBF1+9                                                 41000018
DSF3SAVE EQU   DSCBF1+5                                                 41100018
F5EXT15  EQU   DSCBF5+124               EXTENT 15 IN F5 DSCB            42200018
F5EXT16  EQU   DSCBF5+129               EXTENT 16 IN F5 DSCB            42300018
CHNPGADR EQU   IOB+16                   ADDR. CHANNEL PROGRAM IN IOB    43700018
SEEKCYL  EQU   SEEK+3                                                   43900018
SEEKREC  EQU   SEEK+7                                                   44000018
ZEROS    EQU   CCW2+4                   FULL WORD OF ZERO               44300018
CURRF5AD EQU   TTRLL                    CURRENT FORMAT 5 ADDRESS Y02078 44350002
         EJECT                                                   Y02078 44400002
VWKAREA  IECVTCWA                       VTOC CONVERSION WORKAREA Y02078 44450002
         END                                                            50700018
./  ADD  SSI=52390013,NAME=IGG0325T
        TITLE 'IGG0325T - F5 DSCB COMPLETION, F4 DSCB UPDATING' SA56426 00200021
IGG0325T CSECT                                                          00300020
*                                                                       00350002
* MODULE NAME = IGG0325T                                                00400002
*                                                                       00402002
* DESCRIPTIVE NAME = F5 DSCB COMPLETION, F4 DSCB UPDATING               00404002
*                                                                       00406002
* COPYRIGHT = NONE                                                      00408002
*                                                                       00408402
* CHANGE ACTIVITY = SEE BELOW                                           00408802
*                                                                       00409202
*          RELEASE 19 DELETIONS                                       * 00410018
*          RELEASE 20 DELETIONS                                       * 00420018
*1296052000,098000,398000-400000                                 A31534 00425020
*1296004000,180000,190000,256000,322000,392000-394000,408000     S20201 00427020
*          RELEASE 21 DELETIONS                                       * 00430018
*1190178400                                                      M0130  00432021
*1190050000-052000                                               S21040 00435021
*1190020000-021200,036000,049000,320800,344000,348000-350000,    M0124  00436021
*1190364000,418000,422000-440000,444000-464000,468000,474000-    M0124  00437021
*1190520000,524000-528000,540000,546000,550000-554000,568000     M0124  00438021
*          RELEASE 21.7 DELETIONS                                     * 00450421
*0000002000,176000,188000,306000-308000,310000,320800,356000,   SA56426 00463621
*0000394000-407000,408500,410000-412000                         SA56426 00476021
*          RELEASE 22 DELETIONS                                       * 00488421
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00501002
*0000000300-001500,005008-005628,046000,049000-052000,060000,    Y02080 00501102
*0000118000-132000,136000,142000,148000-152000,156000,160000-    Y02080 00501202
*0000162000,166000,172000-178600,186000,214000,262000,266000-    Y02080 00501302
*0000270000,278000,288000-290000,308100,308400-309200,310000-    Y02080 00501402
*0000310500,311500-311600,316000-318000,320400-320800,328000,    Y02080 00501502
*0000352000-352600,354000-363000,374000,384000-390500,392000,    Y02080 00501602
*0000394000-434000,466000-558000,562000-584000,588000,592000-    Y02080 00501702
*0000724000                                                      Y02080 00501802
*0000                                                            Y02082 00501902
*0000010000-014000,024000-028000,188100-188200,189000,196000-    Y02078 00502002
*0000200000,266000-276000,292000,309200,364500-382000,591000-    Y02078 00502102
*0000591500                                                      Y02078 00502202
*0000308400                                                      Y02144 00502302
*          VS2 RELEASE 3 CHANGES/DELETIONS                              00522303
*0000270300-270600                                             @ZA05618 00542303
*                                                                     * 00563002
*STATUS CHANGE LEVEL 003                                                00575221
*                                                                     * 00600018
* FUNCTION/OPERATION  THIS MODULE CONVERTS THE FORMAT 5 DSCB'S TO     * 00800018
* FINAL FORM AND WRITES THEM IN THE VTOC.  IF THERE WAS ORIGINALLY    * 00850002
* ONLY ONE FORMAT 5 DSCB ON THE VOLUME, ONLY ONE FORMAT 5 WAS REBUILT,* 00900002
* AND THERE ARE NO SPLIT CYLINDER DATA SET EXTENTS, THEN THE REBUILT  * 00950002
* FORMAT 5 IS IN 'DSCBF5' IN THE ALLOCATE WORK AREA.  OTHERWISE, THE  * 01000002
* REBUILT FORMAT 5 DSCB(S) ARE STORED IN THE VTOC CONVERSION WORK     * 01050002
* AREA EXTENSIONS(S).  IF THERE WERE ORIGINALLY MORE FORMAT 5 DSCB'S  * 01100002
* ON THE VOLUME THAN THERE ARE REBUILT FORMAT 5 DSCB'S, THIS MODULE   * 01150002
* ZEROS OUT THE EXTRA FORMAT 5 DSCB'S.  IF THE DOS BIT IS SET, THIS   * 01200002
* MODULE RESETS IT AND SETS BIT 58.4 IN THE FORMAT 4 DSCB.  IF THE    * 01250002
* VTOC CONVERSION ROUTINES WERE ENTERED BECAUSE THE DIRF BIT IS SET,  * 01300002
* THIS MODULE SETS BIT 58.6 IN THE FORMAT 4 DSCB.  IT THEN WRITE THE  * 01350002
* UPDATED FORMAT 4 DSCB TO THE VTOC.  IF THE VTOC CANNOT BE CONVERTED,* 01400002
* THIS MODULE ISSUES MESSAGE IEC602I WITH A CODE OF 0, 4, OR 8.       * 01450002
*                                                                     * 01600018
* ENTRY POINTS                                                        * 01800018
*        IGG0325T - UNDER NORMAL CONDITIONS, ENTRY IS MADE FROM       * 01900021
*        IGG0325P OR IGG0325W. ENTRY IS ALSO MADE FROM ANY OF THE     * 02000021
*        CONVERT ROUTINE MODULES WHEN AN ERROR IS ENCOUNTERED.        * 02100021
*                                                                     * 02200018
* INPUT  REGISTER 13 POINTS TO THE ALLOCATE WORK AREA, WHICH CONTAINS * 02400002
*        THE FORMAT 4 DSCB.  REGISTER 8 IS ZERO FOR A NORMAL ENTRY OR * 02600002
*        CONTAINS AN ERROR CODE.                                      * 02800002
*                                                                     * 03000018
* OUTPUT  VALID FORMAT 5 DSCB'S AND AN UPDATED FORMAT 4 DSCB WILL     * 03200018
*         EXIST IN THE VTOC. REGISTER 4 WILL BE ZERO TO INDICATE      * 03400018
*         REENTRY TO IGG0325A.                                        * 03600021
*                                                                     * 03800018
* EXTERNAL ROUTINES                                                   * 04000018
*        EXCP(0)                                                      * 04200018
*        WAIT(1)                                                      * 04400018
*        WTO(35) - WRITE A MESSAGE TO THE OPERATOR                    * 04600002
*                                                                     * 04800018
* EXITS NORMAL  BRANCH TO IGG0325A IF CALLED BY ALLOCATE OR TO        * 04900002
*               IGG0553F IF CALLED BY EXTEND                          * 05000002
*       ERROR   BRANCH TO IGG0325H IF CALLED BY ALLOCATE OR TO        * 05100002
*               IGG0553F IF CALLED BY EXTEND                          * 05200002
*                                                                     * 05400018
* TABLES/WORKAREAS DADSM WORKAREA                                     * 05600018
*                                                                     * 05800018
* ATTRIBUTES   REENTRANT                                              * 06000002
*                                                                     * 06200018
*                                                                     * 06400018
*                                                                     * 06600018
*                                                                     * 06800018
REGONE   EQU   1                       WORK REGISTER                    07000018
REGTWO   EQU   2                       WORK REGISTER                    07200018
REGTHREE  EQU  3                       WORK REGISTER                    07400018
REGFOUR  EQU   4                       WORK REGISTER                    07600018
REGFIVE  EQU   5                       WORK REGISTER                    07800018
REGSIX  EQU   6                        WORK REGISTER                    08000018
F0CTR    EQU   6                        NUMBER OF F0'S TO WRITE  Y02078 08100002
REGSEVEN EQU   7                       WORK REGISTER                    08200018
RUCBPTR  EQU   7                       UCB POINTER                      08400018
RF5BLDCT EQU   8                        NBR OF F5'S STILL TO BE  Y02078 08450002
*                                       CONVERTED AND WRITTEN    Y02078 08460002
RERRPASS EQU   8                        ERROR CODE REGISTER      A31534 08500020
RTNREG2  EQU   9                       BRANCH REGISTER                  08600018
REGTEN   EQU   10                       WORK REGISTER            Y02078 08700002
RJFCBPTR EQU   11                      JFCB POINTER                     08800018
RVTOCWKA EQU   11                       VTOC WORK AREA ADDRESS   Y02078 08900002
BASEREG  EQU   12                      BASE REGISTER                    09000018
RWKAREA  EQU   13                      WORK AREA BASE REGISTER          09200018
RETRNREG EQU   14                     BRANCH REGISTER                   09400018
RCVT     EQU   15                      CVT BASE REGISTER                09600018
*                                                                       09700021
* OTHER EQUATES                                                         09800021
*                                                                       09900021
ZERO     EQU   0                        VALUE ZERO                      10000018
ONE      EQU   1                        VALUE ONE                       10200018
TWO      EQU   2                        VALUE TWO                       10400018
THREE    EQU   3                        VALUE THREE                     10600018
K4       EQU   4                        CONSTANT OF 4            Y02080 10650002
FOUR     EQU   4                        VALUE FOUR                      10800018
FIVE     EQU   5                        VALUE FIVE                      11000018
SIX      EQU   6                        VALUE SIX                       11200018
EIGHT    EQU   8                        VALUE EIGHT                     11600018
K12      EQU   12                       TWELVE BYTES             Y02080 11650002
F5INDIC  EQU   X'05'                    F5 DSCB INDICATOR               13400018
GOODIO   EQU   X'20'                    TEST VALUE FOR SUCCESSFUL I/O   13800018
ERRCD    EQU   X'0C'                    ERROR CODE FOR UNSUCCESSFUL I/O 14000018
C26      EQU   26                                                       14400018
C140     EQU   140                                                      14600018
NOCC     EQU   X'00'                    NO COMMAND CHAINING      Y02080 14650002
CC       EQU   X'40'                    COMMAND CHAINING BIT     Y02078 14700002
SLI      EQU   X'20'                    SUPPRESS INCORRECT LNGTH Y02078 14750002
SKIP     EQU   X'10'                    SUPPRESS DATA XFER BIT   Y02078 14800002
WRDATA   EQU   X'05'                    WRITE DATA COMMAND CODE  Y02078 14850002
WRITCOMD EQU   X'0D'                    WRITE KEY AND DATA       Y02078 14900002
READCOMD EQU   X'0E'                    READ COMMAND CODE               15400018
C90      EQU   90                      VALUE 90                         15800018
F5ID     EQU   X'F5'                   F5 ID                            16400018
DOSBIT   EQU   X'80'                    DOS BIT IN DS4VTOCI      Y02080 16450002
DIRFBIT  EQU   X'04'                    DIRF BIT IN DS4VTOCI     Y02078 16460002
DIRFCNVT EQU   X'02'                    DIRF CONVERTED BIT       Y02078 16470002
UCBADDR  EQU   32                       DISP. TO UCB ADDR IN DEB Y02078 16480002
UUU      EQU   34                       DISP. TO UUU IN MESSAGE  Y02078 16490002
VOLSER   EQU   38                       DISP. TO VOLSER IN MSG   Y02078 16500002
CODE     EQU   45                       DISP. TO CODE IN MESSAGE Y02078 16510002
CODE4    EQU   C'4'                     CODE 4 IN MESSAGE        Y02078 16520002
CODE8    EQU   C'8'                     CODE 8 IN MESSAGE        Y02078 16530002
VTOCERR  EQU   X'48'                    RETURN CODE FOR EXTEND   Y02078 16540002
BITON    EQU   X'08'                   USED TO TURN BIT 58.4 ON         16800018
C96      EQU   96                      VALUE 96                         17000018
*                                                                       17900020
* REGISTER USAGE                                                        18000020
*                                                                       18100020
         BALR  BASEREG,ZERO             INITIALIZE BASE REGISTER        18200018
         USING *,BASEREG                                                18400018
         USING ALLOCWKA,RWKAREA         BASE FOR ALLOCATE W/A    Y02080 18600002
*                                                                       18800002
* THIS SECTION DETERMINES IF THE FIRST FORMAT 5 DSCB IS LOCATED         18810002
* IN A VTOC WORK AREA EXTENSION.                                        18820002
*                                                                       18830021
         LTR   RERRPASS,RERRPASS        IS THERE AN ERROR        S21040 18840021
         BP    ERREXIT                  YES, DO WE GO TO EXTEND  S21040 18850021
WKAEXTST EQU   *                        BRANCH LABEL             Y02078 18860002
         XC    DADSMADR,DADSMADR        INITIALIZE CHAIN CCHHR   Y02078 18870002
         LH    RF5BLDCT,F5BLDCT         LOAD NBR OF REBUILT F5'S Y02078 18880002
         CH    RF5BLDCT,F5FNDCT         TEST IF EQUAL TO NUMBER  Y02078 18890002
*                                       OF FOUND F5'S            Y02078 18900002
         BH    FINDF0                   BRANCH IF THERE ARE MORE Y02078 18910002
*                                       REBUILT THAN FOUND F5'S  Y02078 18920002
         BL    FINDLAST                 BRANCH IF THERE ARE MORE Y02078 18930002
*                                       FOUND THAN REBUILT F5'S  Y02078 18940002
         CH    RF5BLDCT,ONEF5           TEST IF ONLY 1 F5 BUILT  Y02078 18950002
         BNE   FINDLAST                 BRANCH IF MORE THAN ONE  Y02078 18960002
         TM    ASWITCH,SPCYLSW          TEST FOR SPLIT CYLINDER  Y02078 18970002
*                                       DATA SET EXTENTS IN VTOC Y02078 18980002
         BO    FINDLAST                 BRANCH IF YES            Y02078 18990002
*                                                                       18995002
* THIS SECTION CONVERTS EACH FORMAT 5 RTA/RTA+1 TO AN XXYYZ EXTENT.     19000020
*                                                                     * 19200018
         MVC   DADSMADR,FMTOUTAD        GET 1ST F5 ADDRESS              19400018
CONVNEXT EQU   *                        BRANCH LABEL             Y02078 19600002
         LA    REGTWO,C26               MAXIMUM NBR OF EXTENTS   Y02078 20000002
         LA    REGTHREE,DS5AVEXT        GET PTR TO CONVERTED AREA       20200018
         LH    REGONE,DS4TKCYL          GET NUM TRKS/CYL                20400018
NEXTEXT  SR    REGFOUR,REGFOUR          CLEAR HIGH DIVIDE REGISTERS     20600018
         SR    REGSIX,REGSIX                                            20800018
         MVC   DSCBF5(FOUR),ZERO(REGTHREE)                              21000018
         LH    REGFIVE,DSCBF5           GET RTA                         21200018
         LH    REGSEVEN,DSCBF5+TWO      GET RTA+1                Y02080 21400002
         DR    REGFOUR,REGONE           CONVERT RTA TO CYL/TRK          21600018
         DR    REGSIX,REGONE            CONVERT RTA+1 TO CYL/TRK        21800018
         SR    REGSEVEN,REGFIVE         CALCULATE CYL DIFFERENCE        22000018
         SR    REGSIX,REGFOUR                                           22200018
         LTR   REGSEVEN,REGSEVEN        IS CYL DIFFERENCE ZERO          22400018
         BZ    STORE                    BRANCH IF YES                   22600018
         LTR   REGFOUR,REGFOUR          IS TRK DIFFERENCE ZERO          22800018
         BZ    STORE                    BRANCH IF YES                   23000018
         AR    REGSIX,REGONE            ADD TRK CONSTANT TO TRK DIFF    23200018
         BCTR  REGSEVEN,ZERO            DECREMENT NO OF CYLS            23400018
STORE    STH   REGSEVEN,DSCBF5          STORE NUM FULL CYLS             23600018
         MVC   TWO(TWO,REGTHREE),DSCBF5 STORE NO FULL CYLS              23800018
         STC   REGSIX,FOUR(REGTHREE)    STORE NO EXCESS TRKS            24000018
         LA    REGTHREE,FIVE(REGTHREE)  HAVE ALL EXTENTS BEEN CONVERTED 24200018
         BCT   REGTWO,NEXTEXT           BRANCH IF NO                    24400018
         LA    REGTWO,C90               SET UP LOOP CONTROL             24600018
         LA    REGONE,F5EXT16B          GET ADDR OF START OF MOVE       24800018
MOVEMORE MVC   ONE(ONE,REGONE),ZERO(REGONE) MOVE A FIELD                25000018
         BCTR  REGONE,ZERO              UPDATE MOVE ADDR                25200018
         BCT   REGTWO,MOVEMORE          BRANCH IF MORE FIELDS TO MOVE   25400018
*                                                                       25480020
* THIS SECTION INSERTS THE FORMAT 5 INDICATORS AND WRITES THE           25560020
* CONVERTED FORMAT 5 DSCB'S.                                            25640020
*                                                                       25720020
         MVI   DS5FMTID,F5ID            INSERT F5 INDICATOR             25800018
         MVI   DSCBF5,F5INDIC           INSERT F5 INDICATOR             26000018
         MVC   DSCBF5+ONE(THREE),DSCBF5  PROPAGATE F5 INDICATOR  Y02080 26200002
         BAL   RTNREG2,WRITEF5          WRITE F5 JUST CONVERTED         26400018
         LH    REGONE,DS4DSREC          LOAD COUNT OF F0 DSCBS   Y02078 26410002
         BCTR  REGONE,ZERO              DECREMENT BY ONE         Y02078 26420002
         STH   REGONE,DS4DSREC          SAVE UPDATED COUNT       Y02078 26430002
         BCT   RF5BLDCT,MOVEF5IN        GO GET THE NEXT F5 DSCB  Y02078 26440002
         B     F0TEST                   TEST IF F0 TO BE WRITTEN Y02078 26450002
*                                                                       26460002
* THIS SECTION FINDS FORMAT 0 DSCB'S OVER WHICH REBUILT FORMAT 5        26470002
* DSCB'S WILL BE WRITTEN.                                               26480002
*                                                                       26490002
FINDF0   EQU   *                        BRANCH LABEL             Y02078 26500002
         LR    F0CTR,RF5BLDCT           LOAD NBR OF REBUILT F5'S Y02078 26510002
         SH    F0CTR,F5FNDCT            NUMBER OF F0'S TO FIND   Y02078 26520002
         L     RVTOCWKA,LASTF5AD        ADDR OF LAST REBUILT F5  Y02078 26530002
         USING VTOCWKA,RVTOCWKA         WORK AREA ADDRESSABILITY Y02078 26540002
         LA    REGONE,CCW4                                       Y02078 26550002
         ST    REGONE,CHNPGADR          ADDR OF CHAN PROG IN IOB Y02078 26560002
         MVC   SEEKCYL(FIVE),FMTOUTAD   BEGIN SEARCH AT F5 CCHHR Y02078 26570002
         MVI   CCW6+FOUR,CC+SKIP        CHAIN READ TO READ COUNT Y02078 26580002
         MVI   CCW7+FOUR,CC+SLI         CHAIN RD COUNT TO SKE    Y02078 26590002
         MVI   CCW8+FOUR,CC+SLI         SET SLI BIT IN SKE       Y02078 26600002
NEXTF0   EQU   *                        BRANCH LABEL             Y02078 26610002
         BAL   RETRNREG,EXCHANPG        EXECUTE THE CHANNEL PROG Y02078 26620002
         MVC   VTCCHHR1,COUNT           MOVE CCHHR OF F0 TO WKA  Y02078 26630002
         MVC   SEEKCYL(FIVE),COUNT      INIT. FOR ANOTHER SEARCH Y02078 26640002
         LH    REGONE,F5FNDCT           NBR OF FOUND F5 CCHHR'S  Y02078 26650002
         LA    REGONE,ONE(REGONE)       INCREMENT BY ONE         Y02078 26660002
         STH   REGONE,F5FNDCT           SAVE UPDATED COUNT       Y02078 26670002
         L     RVTOCWKA,VTCBPTR1        ADDRESS OF PRECEDING F5  Y02078 26680002
         BCT   F0CTR,NEXTF0             BRANCH IF MORE TO FIND   Y02078 26690002
*                                                                       26700002
* THIS SECTION MOVES THE FORMAT 5 DSCB POINTED TO BY REGISTER           26710002
* RVTOCWKA FROM A VTOC CONVERSION WORK AREA EXTENSION INTO THE          26720002
* MAIN ALLOCATE WORK AREA.                                              26730002
*                                                                       26740002
FINDLAST EQU   *                        BRANCH LABEL             Y02078 26750002
         L     RVTOCWKA,LASTF5AD        LOAD LAST F5 DSCB ADDR   Y02078 26760002
MOVEF5IN EQU   *                        BRANCH LABEL             Y02078 26770002
         MVC   DSCBF5,VTC1STF5          MOVE F5 DSCB POINTED TO  Y02078 26780002
*                                       BY RVTOCWKA INTO DSCBF5  Y02078 26790002
         MVC   DS5PTRDS,DADSMADR        MOVE IN CHAINING ADDRESS Y02078 26800002
         MVC   DADSMADR,VTCCHHR1        CCHHR OF THIS F5         Y02078 26810002
         L     RVTOCWKA,VTCBPTR1        ADDRESS OF PRECEDING F5  Y02078 26820002
         B     CONVNEXT                 GO CONVERT THE FORMAT 5  Y02078 26830002
*                                                                       26840002
* THIS SECTION TESTS IF FORMAT 0 DSCB'S MUST BE WRITTEN OVER ANY        26850002
* FORMAT 5 DSCB'S (FOUND DURING THE SEARCH THROUGH THE VTOC IN MODULE   26860002
* IGG0325P) WHICH WERE NOT WRITTEN OVER WITH REBUILT FORMAT 5 DSCB'S.   26870002
*                                                                       26880002
F0TEST   EQU   *                        BRANCH LABEL             Y02078 26890002
         CLC   F5BLDCT,F5FNDCT          TEST IF F0'S TO WRITE    Y02078 26900002
         BNL   TURNOFF                  DO NOT BRANCH IF MORE    Y02078 26910002
*                                       FOUND F5'S THAN REBUILT  Y02078 26920002
         LH    F0CTR,F5FNDCT            LOAD NBR OF FOUND F5'S   Y02078 26930002
         SH    F0CTR,F5BLDCT            CALCULATE NUMBER OF F0'S Y02078 26940002
         L     RVTOCWKA,LASTF5AD        ADDRESS OF LAST F5       Y02078 26950002
         SR    REGFOUR,REGFOUR          CLEAR FOR DIVISION       Y02078 26960002
         LH    REGFIVE,F5BLDCT          GET NUMBER OF BUILT F5'S Y02078 26970002
         D     REGFOUR,FW3              3 F5'S PER WKA EXTENSION Y02078 26980002
         LTR   REGFOUR,REGFOUR          TEST IF THE LAST REBUILT Y02078 26990002
*                                       F5 WAS THE THIRD IN THE  Y02078 27000002
*                                       WORK AREA EXTENSION      Y02078 27010002
         BZ    NEXTWKA                  BRANCH IF YES            Y02078 27020002
         LA    REGTWO,VTCNXTF5          LENGTH OF A F5 SLOT    @ZA05618 27030003
         AR    RVTOCWKA,REGTWO          POINT TO NEXT ADDRESS  @ZA05618 27040003
WRITEF0  EQU   *                        BRANCH LABEL             Y02078 27070002
         MVC   SEEKCYL(FIVE),VTCCHHR1   MOVE CCHHR INTO IOB      Y02078 27080002
         LA    REGONE,ONE                                        Y02078 27090002
         STH   REGONE,CCW3+SIX                                   Y02078 27100002
         MVI   CCW3+FOUR,SLI            SET SLI BIT IN WRITE K&D Y02078 27110002
         LA    REGONE,ZEROS                                      Y02078 27120002
         ST    REGONE,CCW3              WRITE 140 BYTES OF ZEROS Y02078 27130002
         MVI   CCW3,WRITCOMD            WRITE KEY AND DATA COMD  Y02078 27140002
         LA    REGONE,CCW1                                       Y02078 27150002
         ST    REGONE,CHNPGADR          ADDR OF CHAN PROG IN IOB Y02078 27160002
         BAL   RETRNREG,EXCHANPG        EXECUTE THE CHANNEL PROG Y02078 27170002
         BCTR  F0CTR,ZERO               DECREMENT COUNTER        Y02078 27180002
         LTR   F0CTR,F0CTR              TEST IF ALL WRITTEN      Y02078 27190002
         BZ    TURNOFF                  BRANCH IF ALL WRITTEN    Y02078 27200002
         LA    REGFOUR,ONE(,REGFOUR)                             Y02078 27210002
         C     REGFOUR,FW3              TEST IF NEXT CCHHR IS IN Y02078 27220002
*                                       THE SAME WORK AREA       Y02078 27230002
         BNE   SAMEWKA                  BRANCH IF YES            Y02078 27240002
         SR    REGFOUR,REGFOUR                                   Y02078 27250002
NEXTWKA  EQU   *                        BRANCH LABEL             Y02078 27260002
         LA    REGTEN,VTC3RDF5-VTC1STF5  LENGTH OF 2 F5 SLOTS    Y02078 27270002
         SR    RVTOCWKA,REGTEN          ADDR OF WKAREA BEGINNING Y02078 27280002
         LR    REGTEN,RVTOCWKA                                   Y02078 27290002
         LA    REGONE,IECEXTPR-IECPREFX  LENGTH OF PREFIX        Y02078 27300002
         SR    REGTEN,REGONE            CALCULATE PREFIX ADDRESS Y02078 27310002
         USING IECPREFX,REGTEN          PREFIX ADDRESSABILITY    Y02078 27320002
         L     REGTEN,IECCORP2          ADDRESS OF NEXT PREFIX   Y02078 27330002
         L     RVTOCWKA,IECCORAD        LOAD ADDR OF WORK AREA   Y02078 27340002
         B     WRITEF0                  GO WRITE A F0 DSCB       Y02078 27350002
SAMEWKA  EQU   *                        BRANCH LABEL             Y02078 27360002
         LA    RVTOCWKA,VTCNXTF5(RVTOCWKA)  POINT TO NEXT SLOT   Y02078 27370002
         B     WRITEF0                  GO WRITE A F0 DSCB       Y02078 27380002
*                                                                       27640020
* THIS SECTION TURNS OFF THE DOS BIT AND WRITES BACK THE FORMAT 4 DSCB  27680020
* BEFORE RETURNING.                                                     27720020
*                                                                       27760020
TURNOFF  EQU   *                        BRANCH LABEL             Y02080 27770002
         TM    DS4VTOCI,DOSBIT          TEST IF DOS BIT SET      Y02078 27780002
         BNO   DIRFTEST                 BRANCH IF NOT            Y02078 27790002
         NI    DS4VTOCI,X'FF'-DOSBIT    TURN OFF DOS BIT IN F4   Y02080 27800002
         OI    DS4VTOCI,BITON           TURN ON CONVERTED BIT           28000018
DIRFTEST EQU   *                        BRANCH LABEL             Y02078 28010002
         TM    ACNVSW,DIRFSET           TEST IF ENTRY FOR DIRF   Y02078 28020002
         BNO   WRITEF4                  BRANCH IF NOT            Y02078 28030002
         OI    DS4VTOCI,DIRFCNVT        SET DIRF CONVERTED BIT   Y02078 28040002
WRITEF4  EQU   *                        BRANCH LABEL             Y02078 28050002
         MVI   DS4NOEXT,X'01'           UPDATE NO. OF EXTENTS FIELD     28100018
         LA    REGONE,IECSDSF4          GET ADDR OF F4 IN WORK AREA     28200018
         ST    REGONE,CCW3              MOVE F4 ADDR TO CHANNEL PROGRAM 28400018
         LA    REGONE,C96               GET LENGTH F4 DATA              28600018
         ST    REGONE,CCW3+FOUR         STORE DATA LENGTH IN     Y02080 28800002
*                                       CHANNEL PROGRAM          Y02080 29000002
         MVI   CCW3,WRDATA              PUT WRITE DATA COMMAND   Y02078 29200002
*                                       IN CHANNEL PROGRAM            * 29400018
         LA    REGONE,CCW1              GET ADDR BEGINNING CHANNEL      29600018
*                                       PROGRAM                       * 29800018
         ST    REGONE,CHNPGADR                                          30000018
         MVC   SEEKCYL(FIVE),VTOCADR    MOVE ADDR F4 TO CHANNEL PROGRAM 30200018
         BAL   RETRNREG,EXCHANPG        WRITE NEW F4 DATA               30400018
         XR    RERRPASS,RERRPASS        CLEAR ERROR CODE REG     Y02078 30600002
         TM    ACNVSW,EXTENDID          DID WE COME FROM EXTEND  Y02080 30810002
         BNO   AROUND                   NO, GO TO ALLOCATE       S21040 30820021
EXTNDBCK EQU   *                                                 S21040 30830021
         CH    RERRPASS,IOCODE          TEST FOR ANY VTOC ERROR  Y02078 30832002
         BNH   LDWKADDR                 BRANCH IF NO ERROR OR AN Y02078 30834002
*                                       I/O ERROR RETURN CODE    Y02078 30835002
         LA    RERRPASS,VTOCERR         RETURN X'48' TO EXTEND   Y02078 30836002
LDWKADDR EQU   *                        BRANCH LABEL             Y02078 30838002
         L     REGFOUR,ALLADTRL         LOAD EOV WORK AREA ADDR  Y02144 30840002
         MVC   WTGMODNM(K12),EXTEND     MOVE IN MODULE NAME AND  Y02080 30860002
*                                       ENTRY POINT ADDRESS      Y02080 30870002
         B     FREEWKAS                 GO FREE ANY WORK AREAS   Y02078 30920002
AROUND   EQU   *                                                 S21040 30930021
         XC    CCW1(ATIOTPTR-CCW1),CCW1  CLEAR CCW'S             Y02080 30980002
         XC    TTRLL(VTOCADR-TTRLL),TTRLL  CLEAR CCHHR'S EXCEPT  Y02080 31000002
*                                       VTOCADR (F4 DSCB CCHHR) SA56426 31100021
         XC    DADSMADR(MIELNAME-DADSMADR),DADSMADR              Y02080 31150002
*                                       CLEAR REST OF CCHHR'S    Y02080 31160002
         XC    DSCBF1(C140),DSCBF1     CLEAR F1 AREA                    31200018
         XC    DSCBF5(C140),DSCBF5     CLEAR F5 AREA                    31400018
         XC    DADSMTBL(ACNVSW-DADSMTBL),DADSMTBL                Y02080 31600002
*                                       CLEAR REST OF WORK AREA  Y02080 31650002
         SR    REGFOUR,REGFOUR          INITIALIZE REENTRY REGISTER     32000018
         LA    REGTWO,ALLOCATE          POINT TO ID OF IGG0325A  Y02080 32050002
         B     XCTLHERE                                          M0124  32120021
*                                                                       32160020
* THIS ROUTINE WRITES A FORMAT 5 DSCB.                                  32240020
*                                                                       32320020
WRITEF5  LA    REGONE,CCW1              GET ADDR WRITE CHANNEL PROGRAM  32400018
         ST    REGONE,CHNPGADR                                          32600018
         MVI   CCW3+K4,NOCC             UNCHAIN WRITE FROM SID   Y02080 32800002
         MVC   SEEKCYL(FIVE),DADSMADR   GET WHERE TO WRITE ADDR         33000018
         BAL   RETRNREG,EXCHANPG        WRITE F5                        33200018
         BR    RTNREG2                  RETURN                          33400018
*                                                                       33450020
* THIS ROUTINE EXECUTES A CHANNEL PROGRAM.                              33500020
*                                                                       33550020
EXCHANPG MVI   ECB,ZERO                 INITIALIZE ECB                  33600018
         EXCP  IOB                      DO I/O                          33800018
         WAIT  1,ECB=ECB                                                34000018
         TM    ECB,GOODIO               WAS I/O SUCCESSFUL              34200018
         BCR   1,RETRNREG               RETURN IF I/O SUCCESSFUL M0124  34400021
         LA    RERRPASS,ERRCD           LOAD ERROR CODE                 34600018
         B     NOERRMSG                 GO TEST THE RETURN       Y02078 34700002
*                                                                       34800002
* IF THE VTOC COULD NOT BE CONVERTED, THIS SECTION ISSUES MESSAGE       34900002
* IEC602I WITH A CODE OF 0, 4, OR 8.                                    35000002
*                                                                       35100002
ERREXIT  EQU   *                        BRANCH LABEL             Y02080 35200002
         CH    RERRPASS,IOCODE          TEST FOR I/O ERROR CODE  Y02078 35202002
         BE    NOERRMSG                 BRANCH IF YES            Y02078 35204002
         MVC   DSCBF1(MSGEND-ERRMSG),ERRMSG  MOVE IN MESSAGE     Y02078 35206002
         L     RUCBPTR,DEB+UCBADDR      LOAD UCB ADDRESS         Y02078 35208002
         USING UCB,RUCBPTR              UCB ADDRESSABILITY       Y02078 35210002
         MVC   DSCBF1+UUU(L'UCBNAME),UCBNAME  MOVE IN EBCDIC UCB Y02078 35212002
*                                       CHANNEL/UNIT ADDRESS     Y02078 35214002
         MVC   DSCBF1+VOLSER(L'SRTEVOLI),SRTEVOLI  MOVE IN VOLID Y02078 35216002
         CH    RERRPASS,OVERLAP         TEST IF OVERLAP ERROR    Y02078 35218002
         BE    ISSUEMSG                 BRANCH IF YES            Y02078 35220002
         MVI   DSCBF1+CODE,CODE4        INITIALIZE FOR CODE = 4  Y02078 35222002
         CH    RERRPASS,DOSERR          TEST IF DOS SPLIT CYL    Y02078 35224002
*                                       OVERLAPPING EXTENT ERROR Y02078 35226002
         BE    ISSUEMSG                 BRANCH IF YES            Y02078 35228002
         MVI   DSCBF1+CODE,CODE8        ASSUME RERRPASS = X'9C'  Y02078 35230002
*                                       AND SET CODE = 8 IN MSG  Y02078 35232002
ISSUEMSG EQU   *                        BRANCH LABEL             Y02078 35234002
         WTO   MF=(E,DSCBF1)            ISSUE ERROR MESSAGE      Y02078 35236002
         NI    DS4VTOCI,X'FF'-DIRFBIT   RESET DIRF BIT TO        Y02078 35238002
*                                       PREVENT IGG0325H FROM    Y02078 35240002
*                                       REWRITING THE F4 DSCB    Y02078 35242002
NOERRMSG EQU   *                        BRANCH LABEL             Y02078 35244002
         TM    ACNVSW,EXTENDID          DID WE COME FROM EXTEND  Y02080 35260002
         BO    EXTNDBCK                 YES, GO TO EXTEND        S21040 35320021
         LA    REGTWO,ERRLOAD           POINT TO ID OF IGG0325H  Y02080 35600002
XCTLHERE EQU   *                                                        35800002
         L     RJFCBPTR,AJFCBPTR        RESTORE JFCB ADDRESS     Y02078 35850002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 35900002
         MVC   WTGMODNM+SIX(TWO),ZERO(REGTWO)  MOVE IN MODULE ID Y02080 36000002
         MVC   WTGMODEP+ONE(THREE),TWO(REGTWO)  MOVE IN EPA      Y02080 36100002
FREEWKAS EQU   *                        BRANCH LABEL             Y02078 36102002
         LA    REGONE,IECEXTPR-IECPREFX  LENGTH OF PREFIX        Y02078 36104002
         LA    REGTEN,ZERO(RWKAREA)     INITIAL WORK AREA ADDR   Y02078 36106002
         SR    REGTEN,REGONE            CALCULATE PREFIX ADDRESS Y02078 36108002
         USING IECPREFX,REGTEN          PREFIX ADDRESSABILITY    Y02078 36110002
NXTPREFX EQU   *                        BRANCH LABEL             Y02078 36112002
         CLC   IECCORPS,IECCORP2        TEST IF ONLY ALLOCATE    Y02078 36114002
*                                       OR EXTEND AND ALLOCATE   Y02078 36116002
*                                       WORK AREAS AND/OR RPS    Y02078 36118002
*                                       WORK AREAS EXIST         Y02078 36120002
         BE    LOADMOD                  YES, DO NOT FREE WKAREA  Y02078 36122002
         L     REGTEN,IECCORP2          LOAD NEXT PREFIX ADDRESS Y02078 36124002
         CLC   IECCORID,VCWKAID         TEST IF VTOC CONVERSION  Y02078 36126002
*                                       WORK AREA EXTENSION      Y02078 36128002
         BNE   NXTPREFX                 BRANCH IF NOT            Y02078 36130002
         L     REGTEN,IECCORAD          LOAD ADDRESS OF WKAREA   Y02078 36132002
         IECRES FREE,PREFIX=YES,A=(REGTEN),                      Y02078X36134002
               STM=(REGONE,RWKAREA,IECREGSV+K12)  FREE WORK AREA Y02078 36136002
         B     FREEWKAS                 GO TEST IF MORE TO FREE  Y02078 36138002
LOADMOD  EQU   *                        BRANCH LABEL             Y02080 36150002
         IECRES LOAD,EXTPR=(RWKAREA),BRANCH=DIRECT               Y02080 36200002
*                                                                       38250020
* CONSTANTS                                                             38300020
*                                                                       38350020
IOCODE   DC    H'12'                    I/O ERROR                Y02078 38360002
ONEF5    DC    H'1'                     HALFWORD OF ONE          Y02078 38370002
OVERLAP  DC    X'0094'                  OVERLAPPING EXTENTS ERR  Y02078 38380002
DOSERR   DC    X'0098'                  DOS OVERLAPPING ERROR    Y02078 38390002
FW3      DC    F'3'                     3 F5 SLOTS PER WORK AREA Y02078 38400002
VCWKAID  DC    CL4'VCWA'                VTOC WORK AREA ID        Y02078 38410002
ERRMSG   WTO   'IEC602I VTOC NOT CONVERTED ON UUU,VOLSER,0',     Y02078X38420002
               ROUTCDE=(4,10),DESC=4,MF=L                        Y02078 38430002
MSGEND   EQU   *                        MSG DELIMITER            Y02078 38440002
*                                                                       39100020
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         39200002
*                                                                       39300020
         XCTLTABL ID=(ALLOCATE,5A,ERRLOAD,5H,EXTEND,IGG0553F),   Y02080X39400002
               SVC=032,LENGTH=,BRT=YES                           Y02080 39450002
         SPACE 2                                                 Y02078 39500002
         IECDSECS CVT,UCB,EXPAND=YES    CVT AND UCB DSECTS       Y02078 39600002
DSCBWKAR IECALLWA EP,F4,D2=(5)          ALLOCATE WORK AREA       Y02080 41400002
ZEROS    EQU   CCW2+4                   FULL WORD OF ZEROS       Y02078 41600002
DS4TKCYL EQU   DS4DEVSZ+2                                               44200018
F5EXT16B EQU   DSCBF5+133               END OF EXTENT 16 IN F5 DSCB     56000018
CHNPGADR EQU   IOB+16                   ADDR. CHANNEL PROGRAM IN IOB    58600018
SEEKCYL  EQU   SEEK+3                                                   59000018
         EJECT                                                   Y02078 59200002
VWKAREA  IECVTCWA                       VTOC WORK AREA           Y02078 59400002
         END                                                            72600018
./  ADD  SSI=32510338,NAME=IGG0325U
         TITLE 'IGG0325U - BUILD FORMAT 6 DSCBS'                 Y02080 00100002
IGG0325U CSECT                                                          00200020
*                                                                       00250002
* MODULE NAME = IGG0325U                                                00260002
*                                                                       00270002
* DESCRIPTIVE NAME = BUILD FORMAT 6 DSCB'S                              00280002
*                                                                       00290002
* COPYRIGHT = NONE                                                      00292002
*                                                                       00294002
* CHANGE ACTIVITY = SEE BELOW                                           00296002
*                                                                     * 00300020
*          RELEASE 21 DELETIONS                                       * 00400020
*1190340000,342000-344000,352000,373000-374000,383000,385000-    M0124  00410021
*1190394000,396000-407000,409000,412000-435000,437000-439000,    M0124  00420021
*1190446000,449000,451000-453000,460000                          M0124  00430021
*1190069000,364000-365000                                        S21040 00450021
*          RELEASE 22 DELETIONS                                       * 00500020
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00600002
*0000000100-001000,006000-010000,065000,067000-069000,077000,    Y02080 00600102
*0000112000-114000,122000,150000,152000-153000,156000,164000,    Y02080 00600202
*0000167000,173000,176000,228000,230000,232000,242000-243000,    Y02080 00600302
*0000249000,252000,274000-276000,283000-285000,303000,315000-    Y02080 00600402
*0000316000,318000,327000,346000-348000,350000-352000,356000-    Y02080 00600502
*0000359000,359400,360000-376000,378000-450000,456000-462000,    Y02080 00600602
*0000464000,466000-468000,470000,472000-474000,476000-538000     Y02080 00600702
*0000025000-029000,033000-036000,045000-049000,052000-055000,    Y02078 00600802
*0000095000,177000-179000,193000,247000,267000-268000,463000     Y02078 00600902
*                                                                     * 01100020
*STATUS CHANGE LEVEL 002                                                01200021
*                                                                     * 01300020
*                                                                     * 01400020
*                                                                     * 01500020
* FUNCTION/OPERATION  THIS MODULE BUILDS A NEW FORMAT 6 EXTENT OR     * 01600020
* INCREMENTS THE DATA SET COUNT OF AN EXISTING FORMAT 6 ENTRY.        * 01700020
*                                                                     * 01800020
* ENTRY POINTS                                                        * 01900020
*        IGG0325U- FROM IGG0325Q TO BUILD FORMAT 6 ENTRIES            * 02000020
*                  FROM IGG0325V TO INCREMENT THE DATA SET COUNT      * 02100020
*                                AND WRITE OUT THE F6                 * 02200020
*                                                                     * 02300020
* INPUT  FROM IGG0325Q                                                * 02400020
*              REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,      * 02500002
*              WHICH WILL CONTAIN THE FORMAT 4 DSCB, THE FORMAT 1     * 02600002
*              OR 3 DSCB THAT IS BEING PROCESSED IN 'DSCBF1', AND     * 02700002
*              THE FIRST FORMAT 6 DSCB IN 'DSCBF5'.  'CCHHRSAV'       * 02800002
*              CONTAINS THE CCHHR OF THE FORMAT 1 OR FORMAT 3 DSCB.   * 02850002
*              REGISTER 6 WILL POINT TO THE RTA/RTA+1 OF THE DATA     * 02900002
*              SET AND REGISTER 8 WILL POINT TO THE FIRST F6 EXTENT.  * 03000020
*              'COUNT' CONTAINS THE CCHHR OF THE NEXT DSCB TO BE READ.* 03050002
*                                                                     * 03100020
*        FROM IGG0325V                                                * 03200020
*              REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,      * 03300002
*              WHICH WILL CONTAIN THE FORMAT 4 DSCB, THE FORMAT 1 OR  * 03400002
*              3 DSCB BEING PROCESSED IN 'DSCBF1', AND THE FORMAT 6   * 03500002
*              DSCB CURRENTLY BEING COMPARED IN 'DSCBF5'.  'CCHHRSAV' * 03600002
*              CONTAINS THE CCHHR OF THE FORMAT 1 OR FORMAT 3 DSCB.   * 03650002
*              'COUNT' CONTAINS THE CCHHR OF THE NEXT DSCB TO BE READ.* 03660002
*              'DADSMADR' CONTAINS THE CCHHR OF THE F6 IN 'DSCBF5'.   * 03670002
*              REGISTER 6 WILL POINT TO THE RTA/RTA+1 OF THE DATA SET,* 03700020
*              REGISTER 7 WILL CONTAIN THE NUMBER OF THE EXTENT BEING * 03800020
*              COMPARED, REGISTER 8 WILL POINT TO THE CURRENT F6      * 03900020
*              EXTENT, AND REGISTER 10 WILL CONTAIN THE NUMBER OF     * 04000020
*              EXTENTS IN THE LAST F6. REGISTER 1 WILL BE ZERO TO     * 04100020
*              INDICATE REENTRY FROM IGG0325V.                        * 04200020
*                                                                     * 04300020
* OUTPUT TO IGG0325Q                                                  * 04400020
*              REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,      * 04500002
*              WHICH WILL CONTAIN THE FORMAT 4 DSCB, THE FORMAT 1     * 04600002
*              OR 3 DSCB BEING PROCESSED IN 'DSCBF1', AND THE FIRST   * 04700002
*              FORMAT 6 DSCB IN 'DSCBF5'.  'CCHHRSAV' CONTAINS THE    * 04800002
*              CCHHR OF THE FORMAT 1 OR 3 DSCB.  'COUNT' CONTAINS     * 04850002
*              THE CCHHR OF THE NEXT DSCB TO BE READ.  REGISTER 1     * 04900002
*              WILL BE ZERO TO INDICATE REENTRY FROM IGG0325U.        * 04950002
*                                                                     * 05000020
*        TO IGG0325V                                                  * 05100020
*              REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,      * 05200002
*              WHICH WILL CONTAIN THE FORMAT 4 DSCB, THE FORMAT 1 OR  * 05300002
*              3 DSCB BEING PROCESSED IN 'DSCBF1', AND THE FORMAT     * 05400002
*              DSCB CURRENTLY BEING COMPARED IN 'DSCBF5'.  'CCHHRSAV' * 05450002
*              CONTAINS THE CCHHR OF THE FORMAT 1 OR FORMAT 3 DSCB.   * 05500002
*              'COUNT' CONTAINS THE CCHHR OF THE NEXT DSCB TO BE READ.* 05550002
*              'DADSMADR' CONTAINS THE CCHHR OF THE F6 IN 'DSCBF5'.   * 05560002
*              REGISTER 6 WILL POINT TO THE RTA/RTA+1 OF THE DATA SET,* 05600020
*              REGISTER 7 WILL CONTAIN THE NUMBER OF THE EXTENT BEING * 05700020
*              COMPARED, REGISTER 8 WILL POINT TO THE CURRENT F6      * 05800020
*              EXTENT, AND REGISTER 10 WILL CONTAIN THE NUMBER OF     * 05900020
*              EXTENTS IN THE LAST F6.                                * 06000020
*                                                                     * 06100020
* EXTERNAL ROUTINES                                                   * 06200020
*        EXCP (0)                                                     * 06300020
*        WAIT (1)                                                     * 06400020
*                                                                     * 06600020
* EXITS NORMAL BRANCH TO IGG0325Q TO READ THE NEXT DSCB IN THE VTOC   * 06700002
*              BRANCH TO IGG0325V TO TEST FOR OVERLAPPING F6 EXTENTS  * 06800002
*       ERROR  BRANCH TO IGG0325T                                     * 06900002
*                                                                     * 07000020
*       ERROR CODES ISSUED BY THIS MODULE -                           * 07100020
*                                                                     * 07200020
*       0C - PERMANENT I/O ERROR                                      * 07300020
*                                                                     * 07400020
* TABLES/WORKAREAS  DADSM WORKAREA                                    * 07500020
*                                                                     * 07600020
* ATTRIBUTES  REENTRANT                                               * 07700002
*                                                                     * 07800020
* NOTES - THIS MODULE WAS SPLIT FROM IGG0325Q IN RELEASE 20.          * 07830021
*                                                                     * 07860021
*                                                                     * 07900020
REGZERO  EQU   0                        WORK REGISTER                   08000020
REGONE   EQU   1                        WORK REGISTER                   08100020
REENTRY  EQU   1                        REENTRY FROM IGG0325V           08200020
REGTWO   EQU   2                        WORK REGISTER                   08300020
REGTHREE EQU   3                        WORK REGISTER                   08400020
FORMATCT EQU   4                        MAXIMUM NO OF EXTENTS IN DSCB   08500020
EXTPTR   EQU   5                        PTR TO EXTENT BEING CONVERTED   08600020
RTAPTR   EQU   6                        PTR TO CONVERTED EXTENT         08700020
NEXTPTR  EQU   6                        PTR TO NEXT F6 EXTENT           08800020
REGSIX   EQU   6                        WORK REGISTER                   08900020
F6EXTCTR EQU   7                        CTR OF NO OF EXTENTS IN F6      09000020
RERRPASS EQU   8                        ERROR CODE REGISTER             09100020
F6PTR    EQU   8                        ADDR OF EXTENT IN F6            09200020
RTNREG2  EQU   9                        BRANCH REGISTER                 09300020
LSTF6CTR EQU   10                       NO. OF EXTENTS IN LAST F6       09400020
BASEREG  EQU   12                       BASE REGISTER                   09600020
RWKAREA  EQU   13                       WORK AREA BASE REGISTER         09700020
RETRNREG EQU   14                       BRANCH REGISTER                 09800020
RCVT     EQU   15                       CVT BASE REGISTER               09900020
*                                                                     * 09920021
* OTHER EQUATES                                                       * 09940021
*                                                                     * 09960021
ZERO     EQU   0                        VALUE ZERO                      10000020
ONE      EQU   1                        VALUE ONE                       10100020
TWO      EQU   2                        VALUE TWO                       10200020
THREE    EQU   3                        VALUE THREE                     10300020
K4       EQU   4                        CONSTANT OF 4            Y02080 10350002
FOUR     EQU   4                        VALUE FOUR                      10400020
FIVE     EQU   5                        VALUE FIVE                      10500020
SIX      EQU   6                        VALUE SIX                       10600020
SEVEN    EQU   7                        VALUE SEVEN                     10700020
C25      EQU   25                       VALUE 25                        10800020
C26      EQU   26                       VALUE 26                        10900020
C32      EQU   32                       VALUE 32                        11000020
C140     EQU   140                      VALUE 140                       11100020
NOCC     EQU   X'00'                    NO COMMAND CHAINING      Y02080 11150002
CC       EQU   X'40'                    COMMAND CHAINING BIT     Y02080 11200002
SLI      EQU   X'20'                    SUPPRESS INCORRECT LNGTH Y02080 11300002
SKIP     EQU   X'10'                    SUPPRESS TRANSFER BIT    Y02080 11400002
GOODIO   EQU   X'20'                    TEST VALUE FOR SUCCESSFUL I/O   11500020
ERRCD    EQU   X'0C'                    ERROR CODE FOR UNSUCCESSFUL I/O 11600020
F6INDIC  EQU   X'06'                    F6 DSCB INDICATOR               11700020
READCOMD EQU   X'0E'                    READ COMMAND CODE               11800020
*                                                                     * 11900020
         BALR  BASEREG,ZERO             INITIALIZE BASE REGISTER        12000020
         USING *,BASEREG                                                12100020
         USING ALLOCWKA,RWKAREA         BASE FOR ALLOCATE W/A    Y02080 12200002
         USING CVT,RCVT                 BASE FOR CVT                    12300020
*                                                                       12350002
         LTR   REENTRY,REENTRY          IS THIS REENTRY                 12400020
         BE    INCDSCNT                 BRANCH IF YES                   12500020
         LA    F6EXTCTR,ONE             INIT NO. OF EXTENT BEING COMP   12600020
*                                                                       12700020
* COMPARE THE JUST CONVERTED RTA/RTA+1 TO THE F6 EXTENT.                12800020
*                                                                       12900020
COMPARE  EQU   *                                                        13000020
         CLC   ZERO(TWO,RTAPTR),ZERO(F6PTR) COMPARE LOWER XTENTS        13100020
         BE    NEWDSCNT                 BRANCH IF EQUAL                 13200020
         BL    NEWENTRY                 BRANCH TO CREATE NEW ENTRY      13300020
*                                                                       13400020
* TEST IF THIS SPLIT CYLINDER EXTENT LIES WITHIN THE F6 EXTENT.         13500020
* IF NOT, GO TEST IT AGAINST THE NEXT F6 EXTENT.                        13600020
*                                                                       13700020
         CLC   ZERO(TWO,RTAPTR),TWO(F6PTR) TEST FOR NO OVERLAP          13800020
         BNL   NOLAP                    BRANCH IF NO OVERLAP            13900020
         CLC   TWO(TWO,RTAPTR),TWO(F6PTR) TEST IF THIS EXTENT           14000020
*                                       LIES WITHIN F6 EXTENT           14100020
         BNH   INCDSCNT                 BRANCH IF YES                   14200020
         MVC   TWO(TWO,F6PTR),TWO(RTAPTR) MOVE IN NEW UPPER EXTENT      14300020
         B     XCTL325V                 TEST FOR F6 OVERLAPPING         14400020
NOLAP    EQU   *                                                        14500020
         LA    REGTHREE,C26             GET MAX. NO. EXTENTS IN F6      14600020
         CR    F6EXTCTR,REGTHREE        HAS LAST EXTENT IN F6 BEEN      14700020
*                                       COMPARED                        14800020
         BL    UPDATPTR                 BRANCH IF NO                    14900020
         CLI   DS6PTRDS+FOUR,ZERO       IS THIS THE LAST F6      Y02080 15000002
         BE    NEWF6                    BRANCH IF YES                   15100020
         MVC   DADSMADR,DS6PTRDS        UPDATE PTR TO PRESENT F6 Y02080 15200002
         MVC   SEEKCYL(FIVE),DS6PTRDS   MOVE ADDR OF F6 TO READ  Y02080 15300002
*                                       TO CHANNEL PROGRAM              15400020
         BAL   RTNREG2,READF6           READ NEXT F6                    15500020
         LA    F6PTR,DS6AVEXT           POINT TO FIRST F6 EXTENT Y02080 15600002
         LA    F6EXTCTR,ONE             INITIALIZE COUNTER OF EXTENTS   15700020
         B     COMPARE                  GO BEGIN COMPARISON             15800020
*                                                                       15900020
* WRITE THE LAST F6, FIND THE NEXT HOLE IN THE VTOC, AND BUILD          16000020
* A NEW F6.                                                             16100020
*                                                                       16200020
NEWF6    EQU   *                                                        16300020
         MVC   DS6PTRDS,FMTINAD         MOVE ADDR OF NEW F6      Y02080 16400002
*                                       TO PREVIOUS F6           Y02080 16450002
         BAL   RTNREG2,WRITEF6          WRITE LAST F6                   16500020
         XC    DSCBF5(C140),DSCBF5      CLEAR F6 AREA                   16600020
         LA    F6PTR,DS6AVEXT           POINT TO FIRST EXTENT    Y02080 16700002
         BAL   RTNREG2,NEWEXTST         MOVE IN NEW EXTENT              16800020
WRITENEW EQU   *                                                        16900020
         LA    LSTF6CTR,ONE             INIT CTR OF EXTENTS IN LAST F6  17000020
         MVC   DADSMADR(FIVE),FMTINAD   UPDATE PTR TO PRESENT F6        17100020
         BAL   RTNREG2,WRITEF6          WRITE NEW F6                    17200020
         MVC   SAVEPT,COUNT             SAVE ADDRESS OF NEXT     Y02080 17300002
*                                       DSCB TO BE READ          Y02080 17350002
         BAL   RTNREG2,FINDHOLE         FIND NEXT HOLE                  17400020
         MVC   FMTINAD(FIVE),COUNT      INITIALIZE NEXT HOLE POINTER    17500020
         MVC   COUNT,SAVEPT             RESTORE ADDRESS OF NEXT  Y02080 17600002
*                                       DSCB TO BE READ          Y02080 17650002
RD1STF6  EQU   *                                                        18000020
         MVC   SEEKCYL(FIVE),DS4F6PTR   MOVE ADDR OF FIRST F6 TO        18100020
*                                       CHANNEL PROGRAM                 18200020
         CLC   DADSMADR,DS4F6PTR        TEST IF 1ST F6 IN CORE   Y02078 18250002
         BE    XCTL325Q                 IF YES, DO NOT REREAD    Y02078 18260002
         BAL   RTNREG2,READF6           READ FIRST F6                   18300020
         MVC   DADSMADR(FIVE),DS4F6PTR  UPDATE PTR TO PRESENT F6        18400020
         B     XCTL325Q                 XCTL TO IGG0325Q                18500020
*                                                                       18600020
* UPDATE THE POINTER TO THE F6 EXTENT AND INCREMENT THE COUNTER         18700020
* OF EXTENTS.                                                           18800020
*                                                                       18900020
UPDATPTR EQU   *                                                        19000020
         LA    F6PTR,FIVE(F6PTR)        POINT TO NEXT EXTENT            19100020
         LA    F6EXTCTR,ONE(F6EXTCTR)   UPDATE COUNTER OF EXTENTS       19200020
         CLC   ZERO(TWO,F6PTR),ZEROS    IS THIS EXTENT UNUSED    Y02078 19300002
         BNE   COMPARE                  BRANCH IF NO                    19400020
         LA    LSTF6CTR,ONE(LSTF6CTR)   INCREMENT CTR OF EXTENTS        19500020
         BAL   RTNREG2,NEWEXTST         MOVE IN NEW EXTENT              19600020
GOWRTF6  EQU   *                        BRANCH LABEL             Y02078 19670002
         BAL   RTNREG2,WRITEF6          WRITE F6                        19700020
         B     RD1STF6                  GO TO READ FIRST F6             19800020
*                                                                       19900020
* CREATE A NEW F6 EXTENT IF THE NEW EXTENT DOES NOT OVERLAP THE         20000020
* PRESENT F6 EXTENT.                                                    20100020
*                                                                       20200020
NEWENTRY EQU   *                                                        20300020
         CLC   TWO(TWO,RTAPTR),ZERO(F6PTR) TEST FOR OVERLAPPING         20400020
         BNH   NEWONE                   BRANCH IF NO OVERLAP            20500020
         MVC   ZERO(TWO,F6PTR),ZERO(RTAPTR) MOVE IN NEW LOWER EXTENT    20600020
         CLC   TWO(TWO,RTAPTR),TWO(F6PTR) COMPARE UPPER EXTENTS         20700020
         BNH   INCDSCNT                 BRANCH IF LOW OR EQUAL          20800020
         MVC   TWO(TWO,F6PTR),TWO(RTAPTR) MOVE IN NEW UPPER EXTENT      20900020
         B     XCTL325V                 TEST FOR F6 OVERLAPPING         21000020
NEWONE   EQU   *                                                        21100020
         MVC   DADSMTBL(FIVE),F5EXT16   SAVE LAST EXTENT OF F6          21200020
         LA    REGONE,FIVE              GET ADDRESS DECREMENT           21300020
         LA    REGTHREE,F5EXT15                                         21400020
MOVE     EQU   *                                                        21500020
         MVC   FIVE(FIVE,REGTHREE),ZERO(REGTHREE) MOVE A FIELD          21600020
         CR    REGTHREE,F6PTR           HAVE ALL THE NECESSARY          21700020
*                                       FIELDS BEEN MOVED               21800020
         BE    SETUPEXT                 BRANCH IF YES                   21900020
         SR    REGTHREE,REGONE          DECREMENT MOVE ADDRESS          22000020
         B     MOVE                     BRANCH TO MOVE ANOTHER FIELD    22100020
SETUPEXT EQU   *                                                        22200020
         LA    LSTF6CTR,ONE(LSTF6CTR)   INCREMENT CTR OF EXTENTS        22300020
         BAL   RTNREG2,NEWEXTST         MOVE IN NEW SPLIT DATA SET      22400020
LASTWT   EQU   *                                                        22500020
         BAL   RTNREG2,WRITEF6          WRITE F6                        22600020
LASTF6CK EQU   *                                                        22700020
         CLI   DS6PTRDS+FOUR,ZERO       IS THIS THE LAST F6      Y02080 22800002
         BE    LASTCK                   BRANCH IF YES                   22900020
         MVC   SEEKCYL(FIVE),DS6PTRDS   MOVE ADDR OF NEXT F6 TO  Y02080 23000002
*                                       CHANNEL PROGRAM                 23100020
         MVC   DADSMADR,DS6PTRDS        UPDATE PRESENT F6 PTR    Y02080 23200002
         BAL   RTNREG2,READF6           READ NEXT F6                    23300020
         MVC   DADSMT5(FIVE),F5EXT16    SAVE LAST EXTENT FROM THIS F6   23400020
         LA    REGTHREE,C25             LOAD LOOP CONTROL               23500020
         LA    REGONE,FIVE              GET ADDRESS DECREMENT           23600020
         LA    REGTWO,F5EXT15                                           23700020
MOVE2    EQU   *                                                        23800020
         MVC   FIVE(FIVE,REGTWO),ZERO(REGTWO) MOVE A FIELD              23900020
         SR    REGTWO,REGONE            DECREMENT ADDRESS               24000020
         BCT   REGTHREE,MOVE2           BRANCH IF MORE FIELDS TO MOVE   24100020
         MVC   DS6AVEXT(FIVE),DADSMTBL  MOVE IN OVERFLOW FIELD   Y02080 24200002
*                                       FROM EXPANDED F6         Y02080 24300002
         MVC   DADSMTBL(FIVE),DADSMT5                                   24400020
         B     LASTWT                   GO TO WRITE EXPANDED F6         24500020
LASTCK   EQU   *                                                        24600020
         CLC   DADSMTBL(TWO),ZEROS      HAS LAST F6 OVERFLOWED   Y02078 24700002
         BE    RD1STF6                  BRANCH IF NOT                   24800020
         MVC   DS6PTRDS,FMTINAD         MOVE ADDR OF NEW F6 TO   Y02080 24900002
*                                       PREVIOUS F6              Y02080 24950002
         BAL   RTNREG2,WRITEF6          WRITE LAST F6                   25000020
         XC    DSCBF5(C140),DSCBF5      CLEAR F6 AREA                   25100020
         MVC   DS6AVEXT(FIVE),DADSMTBL  MOVE IN OVERFLOW EXTENT  Y02080 25200002
         B     WRITENEW                 GO WRITE THE NEW F6             25300020
*                                                                       25400020
* INCREMENT THE DATA SET COUNT BY ONE.                                  25500020
*                                                                       25600020
NEWDSCNT EQU   *                                                        25700020
         CLC   TWO(TWO,RTAPTR),TWO(F6PTR) COMPARE UPPER EXTENTS         25800020
         BNH   INCDSCNT                 BRANCH IF LOW OR EQUAL          25900020
         MVC   TWO(TWO,F6PTR),TWO(RTAPTR) MOVE IN NEW UPPER EXTENT      26000020
         B     XCTL325V                 TEST FOR F6 OVERLAPPING         26100020
INCDSCNT EQU   *                                                        26200020
         SR    REGTWO,REGTWO            ZERO REGISTER                   26300020
         IC    REGTWO,FOUR(F6PTR)       GET OLD DATA SET COUNT          26400020
         LA    REGTWO,ONE(REGTWO)       UPDATE DATA SET COUNT           26500020
         STC   REGTWO,FOUR(F6PTR)       SAVE NEW DATA SET COUNT         26600020
         B     GOWRTF6                  GO WRITE THE FORMAT 6    Y02078 26700002
*                                                                       26900020
* XCTL TO IGG0325Q TO READ THE NEXT DSCB.                               27000020
*                                                                       27100020
XCTL325Q EQU   *                                                        27200020
         MVC   SEEKCYL(FIVE),CCHHRSAV   RESTORE F1 OR F3 CCHHR   Y02078 27250002
         SR    REENTRY,REENTRY          ZERO REGISTER ONE               27300020
         LA    REGTWO,MOD325Q           POINT TO ID OF IGG0325Q  Y02080 27350002
         B     XCTLHERE                 BRANCH TO XCTL                  27700020
*                                                                       27800020
* XCTL TO IGG0325V TO TEST IF THE SPLIT CYLINDER DATA SET EXTENT        27900020
* OVERLAPS ONE OR MORE F6 EXTENTS.                                      28000020
*                                                                       28100020
XCTL325V EQU   *                                                        28200020
         LA    REGTWO,MOD325V           POINT TO ID OF IGG0325V  Y02080 28250002
         B     XCTLHERE                 BRANCH TO XCTL                  28600020
*                                                                       28700020
* MOVE THE RTA/RTA+1 OF THE SPLIT CYLINDER DATA SET INTO THE F6         28800020
* AND INITIALIZE THE DATA SET COUNT TO ONE.                             28900020
*                                                                       29000020
NEWEXTST EQU   *                                                        29100020
         MVC   ZERO(FOUR,F6PTR),ZERO(RTAPTR) MOVE RTA/RTA+1             29200020
         LA    REGTWO,ONE                                               29300020
         STC   REGTWO,FOUR(F6PTR)       DATA SET COUNT SET TO 1         29400020
         BR    RTNREG2                  RETURN                          29500020
*                                                                       29600020
* READ THE NEXT F6 DSCB.                                                29700020
*                                                                       29800020
READF6   EQU   *                                                        29900020
         LA    REGONE,DSCBF5            GET ADDR OF F6 AREA             30000020
         ST    REGONE,CCW6              STORE F6 ADDR IN READ           30100020
         MVI   CCW6,READCOMD            RESTORE READ COMMAND CODE       30200020
         MVI   CCW6+K4,NOCC             UNCHAIN READ FROM RD CNT Y02080 30300002
         LA    REGONE,CCW4                                              30400020
         ST    REGONE,CHNPGADR          GET ADDR OF READ CHANNEL PROG   30500020
         BAL   RETRNREG,EXCHANPG        READ F6                         30600020
         BR    RTNREG2                  RETURN                          30700020
*                                                                       30800020
* FIND THE ADDRESS OF THE NEXT F0 DSCB.                                 30900020
*                                                                       31000020
FINDHOLE EQU   *                                                        31100020
         LA    REGONE,CCW4              GET ADDR OF CHANNEL PROGRAM     31200020
*                                       TO BE EXECUTED                  31300020
         ST    REGONE,CHNPGADR          STORE IN IOB                    31400020
         MVI   CCW6+K4,CC+SKIP          SET SKIP BIT IN READ     Y02080 31500002
         MVI   CCW7+K4,CC+SLI           CHAIN RD COUNT TO SEARCH Y02080 31600002
*                                       KEY EQUAL                       31700020
         MVI   CCW8+K4,CC+SLI           SET SLI BIT IN SKE       Y02080 31800002
         BAL   RETRNREG,EXCHANPG        EXECUTE THE CHANNEL PROGRAM     31900020
         BR    RTNREG2                  RETURN                          32000020
*                                                                       32100020
* WRITE A FORMAT 6 DSCB.                                                32200020
*                                                                       32300020
WRITEF6  EQU   *                                                        32400020
         LA    REGONE,CCW1                                              32500020
         ST    REGONE,CHNPGADR          GET ADDR WRITE CHANNEL PROGRAM  32600020
         MVI   CCW3+K4,NOCC             UNCHAIN READ FROM RD CNT Y02080 32700002
         MVC   SEEKCYL(FIVE),DADSMADR   MOVE IN ADDR OF F6              32800020
         MVI   DSCBF5,F6INDIC           PUT F6 INDICATOR IN RECORD      32900020
         BAL   RETRNREG,EXCHANPG        WRITE F6                        33000020
         BR    RTNREG2                  RETURN                          33100020
*                                                                       33200020
* THIS ROUTINE EXECUTES THE CHANNEL PROGRAM.                            33300020
*                                                                       33400020
EXCHANPG EQU   *                                                        33500020
         MVI   ECB,ZERO                                                 33600020
         EXCP  IOB                                                      33700020
         WAIT  1,ECB=ECB                                                33800020
         TM    ECB,GOODIO               WAS I/O SUCCESSFUL              33900020
         BCR   1,RETRNREG               RETURN IF I/O SUCESSFUL  M0124  34000021
         LA    RERRPASS,ERRCD           SET ERROR RETURN CODE           34100020
ERREXIT  EQU   *                                                        34500020
         LA    REGTWO,LASTLOAD          POINT TO ID OF IGG0325T  Y02080 34550002
XCTLHERE EQU   *                                                        34900020
        IECRES LOAD,EXTPR=(RWKAREA),MODID=(REGTWO),BRANCH=DIRECT Y02080 34950002
*                                                                       35300020
* CONSTANTS                                                             35400020
*                                                                       35500020
*                                                                       35920021
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         35940002
*                                                                       35960021
         XCTLTABL ID=(MOD325Q,5Q,MOD325V,5V,LASTLOAD,5T),        Y02080X36010002
               SVC=032,LENGTH=,BRT=YES                           Y02080 36060002
         EJECT                                                   Y02080 36110002
CVT      DSECT                                                          37700020
         CVT                                                     Y02080 37800002
         EJECT                                                   Y02080 37850002
DSCBWKAR IECALLWA EP,F4,D2=(6)          ALLOCATE WORK AREA       Y02080 38100002
F5EXT15  EQU   DSCBF5+124               EXTENT 15 IN F5 DSCB            45400020
F5EXT16  EQU   DSCBF5+129               EXTENT 16 IN F5 DSCB            45500020
DADSMT5  EQU   DADSMTBL+5                                               46500020
CHNPGADR EQU   IOB+16                   ADDRESS CHANNEL PROGRAM IN IOB  46900020
SEEKCYL  EQU   SEEK+3                                                   47100020
SAVEPT   EQU   TTRLL                    CCHHR SAVE AREA          Y02080 47200002
ZEROS    EQU   CCW2+4                   FULL WORD OF ZERO               47500002
         END                                                            53900020
./  ADD  SSI=32510339,NAME=IGG0325V
         TITLE 'IGG0325V - CHECK FOR FORMAT 6 EXTENT OVERLAP'    Y02080 00200002
IGG0325V CSECT                                                          00400020
*                                                                       00450002
* MODULE NAME = IGG0325V                                                00500002
*                                                                       00550002
* DESCRIPTIVE NAME = CHECK FOR FORMAT 6 EXTENT OVERLAP                  00560002
*                                                                       00570002
* COPYRIGHT = NONE                                                      00580002
*                                                                       00590002
* CHANGE ACTIVITY = SEE BELOW                                           00592002
*                                                                       00600020
*          RELEASE 21 DELETIONS                                       * 00800020
*1190560000,564000-568000,584000,642000,646000-664000,668000-    M0124  00820021
*1190690000,694000,700000-746000,750000-754000,768000,774000,    M0124  00840021
*1190778000-782000,796000                                        M0124  00860021
*1190096000,608000-610000                                        S21040 00900021
*          RELEASE 22 DELETIONS                                       * 01000020
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 01200002
*0000000300-002000,012000-020000,088000,092000,096000,114000,    Y02080 01200102
*0000198000,202000,208000,226000,230000-234000,240000,252000,    Y02080 01200202
*0000282000,290000-294000,362000,378000,384000-386000,394000-    Y02080 01200302
*0000396000,412000,440000,446000-448000,452000,464000-466000,    Y02080 01200402
*0000485000,498600,499200,532000,572000-576000,580000-584000,    Y02080 01200502
*0000592000-598000,599000,600000-628000,632000-748000,758000-    Y02080 01200602
*0000760000,763000-784000,788000-812000,816000,820000-824000,    Y02080 01200702
*0000828000-954000                                               Y02080 01200802
*0000054000-070000,104000-106000,146000,180000-182000,320000-    Y02078 01200902
*0000328000,402000-406000                                        Y02078 01201002
*                                                                     * 02200020
*0000478000-490000,504000-508000                                 A36311 02300020
*                                                                     * 02400020
*STATUS CHANGE LEVEL 002                                                02600021
*                                                                     * 02800020
*                                                                     * 03000020
* FUNCTION/OPERATION  THIS MODULE TESTS TO SEE IF A SPLIT CYLINDER    * 03200020
* DATA SET EXTENT OVERLAPS TWO EXISTING FORMAT 6 EXTENTS. IF THIS     * 03400020
* OVERLAPPING EXISTS, THE TWO FORMAT 6 EXTENTS ARE MERGED INTO ONE    * 03600020
* EXTENT AND THEIR DATA SET COUNTS ARE ADDED TOGETHER. WHEN IT IS     * 03800020
* DETERMINED THAT THE SPLIT CYLINDER DATA SET EXTENT DOES NOT OVERLAP,* 04000020
* THE MODULE XCTL'S TO IGG0325U TO RESUME BUILDING THE F6 EXTENTS.    * 04200020
*                                                                     * 04400020
* ENTRY POINTS                                                        * 04600020
*        IGG0325V- FROM IGG0325U TO TEST FOR OVERLAPPING EXTENTS      * 04800020
*                                                                     * 05000020
* INPUT FROM IGG0325U                                                 * 05200020
*              REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,      * 05400002
*              WHICH WILL CONTAIN THE FORMAT 4 DSCB, THE FORMAT 1 OR  * 05600002
*              3 DSCB BEING PROCESSED IN 'DSCBF1', AND THE FORMAT 6   * 05800002
*              DSCB BEING COMPARED IN 'DSCBF5'.  'COUNT' CONTAINS     * 05850002
*              THE CCHHR OF THE NEXT DSCB TO BE READ.  'CCHHRSAV'     * 05900002
*              CONTAINS THE CCHHR OF THE FORMAT 1 OR 3 DSCB IN        * 05950002
*              'DSCBF1'.  AND 'DADSMADR' CONTAINS THE CCHHR OF THE    * 05960002
*              FORMAT 6 IN 'DSCBF5'.  REGISTER 6 WILL POINT TO THE    * 06000002
*              RTA/RTA+1 OF THE DATA SET, REGISTER 7 WILL CONTAIN     * 06200002
*              THE NUMBER OF THE EXTENT BEING COMPARED, REGISTER 8    * 06400002
*              WILL POINT TO THE CURRENT EXTENT, AND REGISTER 10 WILL * 06600002
*              CONTAIN THE NUMBER OF EXTENTS IN THE LAST FORMAT 6.    * 06800002
*                                                                     * 07200020
* OUTPUT TO IGG0325U                                                  * 07400020
*              SAME AS ON INPUT. ALSO, REGISTER 1 WILL BE ZERO TO     * 07600020
*              INDICATE REENTRY FROM IGG0325V.                        * 07800020
*                                                                     * 08000020
* EXTERNAL ROUTINES                                                   * 08200020
*        EXCP (0)                                                     * 08400020
*        WAIT (1)                                                     * 08600020
*                                                                     * 09000020
* EXITS NORMAL BRANCH TO IGG0325U TO RESUME BUILDING FORMAT 6 EXTENTS * 09200002
*                                                                     * 09400020
*       ERROR  BRANCH TO IGG0325T                                     * 09600002
*              ERROR CODES ISSUED BY THIS MODULE -                    * 09800020
*                                                                     * 10000020
*              0C - PERMANENT I/O ERROR                               * 10200020
*                                                                     * 10800020
* TABLES/WORKAREAS  DADSM WORKAREA                                    * 11000020
*                                                                     * 11200020
* ATTRIBUTES  REENTRANT                                               * 11400002
*                                                                     * 11600020
* NOTES - THIS MODULE WAS SPLIT FROM IGG0325Q IN RELEASE 20.          * 11660021
*                                                                     * 11720021
*                                                                     * 11800020
REGZERO  EQU   0                        WORK REGISTER                   12000020
REGONE   EQU   1                        WORK REGISTER                   12200020
REENTRY  EQU   1                        REENTRY TO IGG0325U             12400020
REGTWO   EQU   2                        WORK REGISTER                   12600020
REGTHREE EQU   3                        WORK REGISTER                   12800020
REGFOUR  EQU   4                        WORK REGISTER                   13000020
REGFIVE  EQU   5                        WORK REGISTER                   13200020
RTAPTR   EQU   6                        PTR TO RTA/RTA+1 OF DATA SET    13400020
F6EXTCTR EQU   7                        CTR OF NO OF EXTENTS IN F6      13600020
F6PTR    EQU   8                        ADDR OF CURRENT EXTENT IN F6    13800020
RERRPASS EQU   8                        ERROR CODE REGISTER             14000020
RTNREG2  EQU   9                        BRANCH REGISTER                 14200020
LSTF6CTR EQU   10                       CTR OF EXTENTS IN LAST F6       14400020
BASEREG  EQU   12                       BASE REGISTER                   14800020
RWKAREA  EQU   13                       WORK AREA BASE REGISTER         15000020
RETRNREG EQU   14                       BRANCH REGISTER                 15200020
RCVT     EQU   15                       CVT BASE REGISTER               15400020
*                                                                     * 15450021
* OTHER EQUATES                                                       * 15500021
*                                                                     * 15550021
ZERO     EQU   0                        VALUE ZERO                      15600020
ONE      EQU   1                        VALUE ONE                       15800020
TWO      EQU   2                        VALUE TWO                       16000020
THREE    EQU   3                        VALUE THREE                     16200020
K4       EQU   4                        CONSTANT OF 4            Y02080 16250002
FOUR     EQU   4                        VALUE FOUR                      16400020
FIVE     EQU   5                        VALUE FIVE                      16600020
SIX      EQU   6                        VALUE SIX                       16800020
SEVEN    EQU   7                        VALUE SEVEN                     17000020
C26      EQU   26                       VALUE 26                        17200020
C32      EQU   32                       VALUE 32                        17400020
C125     EQU   125                      VALUE 125                       17600020
C140     EQU   140                      VALUE 140                       17800020
GOODIO   EQU   X'20'                    TEST VALUE FOR SUCCESSFUL I/O   18400020
ERRCD    EQU   X'0C'                    ERROR CODE FOR UNSUCCESSFUL I/O 18600020
F6INDIC  EQU   X'06'                    F6 DSCB INDICATOR               18800020
NOCC     EQU   X'00'                    NO COMMAND CHAINING      Y02080 18850002
READCOMD EQU   X'0E'                    READ COMMAND CODE               19000020
WRITCOMD EQU   X'0D'               WRITE COMMAND CODE            A36311 19060020
SLIBIT   EQU   X'20'               SLI BIT IN CCW                A36311 19120020
*                                                                     * 19200020
         BALR  BASEREG,ZERO             INITIALIZE BASE REGISTER        19400020
         USING *,BASEREG                                                19600020
         USING ALLOCWKA,RWKAREA         BASE FOR ALLOCATE W/A    Y02080 19800002
         USING CVT,RCVT                 BASE FOR CVT                    20000020
*                                                                       20050002
         STM   F6EXTCTR,F6PTR,CCW11     SAVE CURRENT EXTENT PTR  Y02080 20200002
         MVC   SAVEXTNT(FIVE),ZERO(F6PTR) SAVE CONTENTS OF              20400020
*                                       THE CURRENT F6 EXTENT           20600020
         MVC   F6CCHHR,DADSMADR         SAVE ADDR OF CURRENT F6  Y02080 20800002
*                                                                       21000020
* THIS SECTION TESTS IF THE SPLIT CYLINDER DATA SET EXTENT ENDS BEFORE  21200020
* THE NEXT F6 EXTENT BEGINS.                                            21400020
*                                                                       21600020
AGAIN    EQU   *                                                        21800020
         LA    REGTHREE,C26             GET MAX NO EXTENTS IN F6        22000020
         CR    F6EXTCTR,REGTHREE        WAS LAST EXTENT COMPARED        22200020
         BL    UPDATPTR                 BRANCH IF NO                    22400020
         CLI   DS6PTRDS+FOUR,ZERO       IS THIS THE LAST F6      Y02080 22600002
         BE    RESTORE                  BRANCH IF YES                   22800020
         MVC   SAVEPT,F6CCHHR           SAVE ADDR OF OLD F6      Y02080 23000002
         MVC   F6CCHHR,DS6PTRDS         UPDATE PTR TO CURRENT F6 Y02080 23200002
         MVC   SEEKCYL(FIVE),DS6PTRDS   MOVE ADDR OF F6 TO BE    Y02080 23400002
*                                       READ TO CHANNEL PROGRAM         23600020
         BAL   RTNREG2,READTOF5         GO READ THE NEXT F6             23800020
         LA    F6PTR,DS6AVEXT           POINT TO FIRST EXTENT    Y02080 24000002
         LA    F6EXTCTR,ONE             INITIALIZE NO OF EXTENTS        24200020
         B     COMPARE                  GO COMPARE                      24400020
UPDATPTR EQU   *                                                        24600020
         LA    F6PTR,FIVE(F6PTR)        POINT TO NEXT EXTENT            24800020
         LA    F6EXTCTR,ONE(F6EXTCTR)   INCREMENT CTR OF EXTENTS        25000020
         CLC   ZERO(TWO,F6PTR),ZEROS    IS NEXT EXTENT UNUSED    Y02080 25200002
         BE    RESTORE                  BRANCH IF YES                   25400020
COMPARE  EQU   *                                                        25600020
         CLC   TWO(TWO,RTAPTR),ZERO(F6PTR) DOES THE SPLIT CYLINDER      25800020
*                                       DATA SET END BEFORE THE         26000020
*                                       NEXT F6 EXTENT BEGINS           26200020
         BH    COMBINE                  BRANCH IF NO                    26400020
*                                                                       26600020
* THIS SECTION RESTORES THE ORIGINAL F6 AND THE ORIGINAL CONTENTS OF    26800020
* REGISTERS 7 AND 8 BEFORE XCTLING TO IGG0325U.                         27000020
*                                                                       27200020
RESTORE  EQU   *                                                        27400020
         MVC   SEEKCYL(FIVE),DADSMADR   MOVE ADDR OF ORIGINAL F6        27600020
*                                       TO CHANNEL PROGRAM              27800020
         CLC   DADSMADR,F6CCHHR         TEST IF ORIGINAL F6 IS   Y02078 27850002
*                                       STILL IN THE WORK AREA   Y02078 27900002
         BE    CKDSCBF1                 IF YES, DO NOT REREAD    Y02078 27950002
         BAL   RTNREG2,READTOF5         GO READ THIS F6                 28000020
CKDSCBF1 EQU   *                        BRANCH LABEL             Y02078 28010002
         CLI   DSCBF1,F6INDIC           TEST IF AN F6 WAS READ   Y02078 28020002
*                                       INTO DSCBF1              Y02078 28030002
         BNE   LOADRGS1                 BRANCH IF NOT            Y02078 28040002
         MVC   SEEKCYL(FIVE),CCHHRSAV   MOVE IN CCHHR OF F1 OR   Y02078 28050002
*                                       F3 BEING PROCESSED       Y02078 28060002
         BAL   RTNREG2,READTOF1         GO READ F1 OR F3 DSCB    Y02078 28070002
LOADRGS1 EQU   *                        BRANCH LABEL             Y02078 28080002
         LM    F6EXTCTR,F6PTR,CCW11     RESTORE THE EXTENT PTR   Y02080 28200002
         MVC   ZERO(FIVE,F6PTR),SAVEXTNT MOVE IN NEW EXTENT             28400020
*                                       BOUNDARIES AND D/S COUNT        28600020
         SR    REENTRY,REENTRY          ZERO REGISTER 1                 28800020
         LA    REGTWO,MOD325U           POINT TO ID OF IGG0325U  Y02080 28850002
         B     XCTLHERE                 GO XCTL                         29600020
*                                                                       29800020
* THIS SECTION COMBINES TWO F6 EXTENTS.                                 30000020
*                                                                       30200020
COMBINE  EQU   *                                                        30400020
         MVC   SAVEXTNT+TWO(TWO),TWO(F6PTR) MOVE IN NEW UPPER EXTENT    30600020
         SR    REGTWO,REGTWO            ZERO REGISTER                   30800020
         IC    REGTWO,FOUR(F6PTR)       GET NEW F6 D/S COUNT            31000020
         SR    REGONE,REGONE            ZERO REGISTER                   31200020
         IC    REGONE,SAVEXTNT+FOUR     GET RUNNING F6 D/S COUNT        31400020
         AR    REGONE,REGTWO            GET NEW TOTAL D/S COUNT         31600020
         STC   REGONE,SAVEXTNT+FOUR     SAVE NEW TOTAL D/S COUNT        31800020
*                                                                       33000020
* THIS SECTION MOVES ALL EXTENTS IN THE CURRENT F6 DSCB FORWARD TO      33200020
* WIPE OUT THE EXTENT THAT WAS JUST COMBINED AND UPDATES F6EXTCTR TO    33400020
* REFLECT ONE LESS EXTENT.                                              33600020
*                                                                       33800020
WIPEOUT  EQU   *                                                        34000020
         LA    REGTWO,C26               GET MAX NO EXTENTS IN F6        34200020
         SR    REGTWO,F6EXTCTR          CALCULATE LOOP CONTROL          34400020
         BZ    COMPLAST                 BRANCH IF LAST EXTENT IN        34600020
*                                       THIS F6 TO BE WIPED OUT         34800020
         LR    REGONE,F6PTR             GET ADDR OF FREE EXTENT         35000020
MOVEFLD  EQU   *                                                        35200020
         MVC   ZERO(FIVE,REGONE),FIVE(REGONE) MOVE A FIELD              35400020
         LA    REGONE,FIVE(REGONE)      POINT TO NEXT EXTENT            35600020
         BCT   REGTWO,MOVEFLD           BRANCH IF MORE TO MOVE          35800020
COMPLAST EQU   *                                                        36000020
         CLI   DS6PTRDS+FOUR,ZERO       IS THIS LAST F6 IN CHAIN Y02080 36200002
         BNE   MERGERTN                 BRANCH IF NO                    36400020
         LA    REGTWO,C26                                               36600020
         CR    REGTWO,LSTF6CTR          ARE THERE 26 EXTENTS IN LAST F6 36800020
         BNE   NEXTCOMP                 BRANCH IF F6 NOT FULL           37000020
         MVC   F5EXT16(FIVE),F5EXT16+FIVE ZERO LAST EXTENT              37200020
NEXTCOMP EQU   *                                                        37400020
         BCT   LSTF6CTR,WRITENOW        BRANCH IF F6 NOT TO BE ZEROED   37600020
         MVC   SEEKCYL(FIVE),F6CCHHR    PUT ADDR OF F6 TO BE     Y02080 37800002
*                                       ZEROED IN CHANNEL PROG          38000020
         BAL   RTNREG2,WRTZERO          WRITE ZERO RECORD               38200020
         MVC   FMTINAD,F6CCHHR          SET NEW HOLE ADDRESS     Y02080 38400002
         MVC   F6CCHHR,SAVEPT           UPDATE PTR TO CURRENT F6 Y02080 38600002
         MVC   SEEKCYL(FIVE),SAVEPT     PUT ADDR OF PREVIOUS F6         38800020
*                                       IN CHANNEL PROGRAM              39000020
         BAL   RTNREG2,READTOF5         READ NEW LAST F6                39200020
         MVI   DS6PTRDS,ZERO                                     Y02080 39400002
         MVC   DS6PTRDS+ONE(FOUR),DS6PTRDS  ZERO OUT F6 PTR      Y02080 39600002
         BAL   RTNREG2,WRITEF6          WRITE NEW LAST F6               39800020
         LA    LSTF6CTR,C26             INIT CTR OF EXTENTS IN LAST F6  40000020
         B     LASTCOMP                 GO TEST NEXT EXTENT             40800020
WRITENOW EQU   *                                                        41000020
         MVC   SEEKCYL(FIVE),F6CCHHR    MOVE IN ADDR OF F6 TO BE Y02080 41200002
*                                       WRITTEN                         41400020
         BAL   RTNREG2,WRITEF6          GO WRITE THIS F6                41600020
*                                                                       41800020
* THIS SECTION TESTS IF THE SPLIT CYLINDER DATA SET EXTENT ENDS WITHIN  42000020
* THE UPDATED F6 EXTENT.                                                42200020
*                                                                       42400020
LASTCOMP EQU   *                                                        42600020
         CLC   TWO(TWO,RTAPTR),SAVEXTNT+TWO TEST IF SPLIT CYL           42800020
*                                       DATA SET ENDS WITHIN THE        43000020
*                                       UPDATED F6 EXTENT               43200020
         BNH   RESTORE                  BRANCH IF YES                   43400020
         CLC   DADSMADR,F6CCHHR         TEST IF ORIGINAL F6 IS   Y02078 43450002
*                                       STILL IN THE WORK AREA   Y02078 43500002
         BE    LOADRGS2                 IF YES, DO NOT REREAD    Y02078 43550002
         MVC   SEEKCYL(FIVE),DADSMADR   GET CCHHR OF ORIGINAL F6        43600020
         BAL   RTNREG2,READTOF5         GO READ FIRST F6                43800020
LOADRGS2 EQU   *                        BRANCH LABEL             Y02078 43850002
         LM    F6EXTCTR,F6PTR,CCW11     RESTORE EXTENT POINTERS  Y02080 44000002
         B     AGAIN                    GO COMPARE AGAIN                44200020
MERGERTN EQU   *                                                        44400020
         MVC   SAVEPT,F6CCHHR           SAVE ADDR OF LAST F6     Y02080 44600002
         MVC   SEEKCYL(FIVE),DS6PTRDS   MOVE ADDR OF NEXT F6     Y02080 44800002
*                                       INTO CHANNEL PROGRAM            45000020
         MVC   F6CCHHR,DS6PTRDS         MOVE ADDR OF CURRENT F6  Y02080 45200002
         BAL   RTNREG2,READTOF1         READ NEXT F6 IN CHAIN           45400020
         MVC   F5EXT16(FIVE),DSF3EXT1   MERGE EXTENT TO PREVIOUS F6     45600020
         MVC   SEEKCYL(FIVE),SAVEPT     MOVE IN ADDR OF F6              45800020
         BAL   RTNREG2,WRITEF6          WRITE PREVIOUS F6               46000020
         XC    DSCBF5(C140),DSCBF5      ZERO F5 AREA                    46200020
         MVC   DS6AVEXT(C125),DSF3EXT2  UPDATE NEXT F6 IN CHAIN  Y02080 46400002
         MVC   DS6PTRDS,DS1PTRDS        MOVE IN CHAINING ADDR    Y02080 46600002
         B     COMPLAST                 GO TEST IF LAST IN CHAIN        46800020
*                                                                       47000020
* THIS ROUTINE WRITES A ZERO RECORD.                                    47200020
*                                                                       47400020
WRTZERO  EQU   *                                                        47600020
         LA    REGTHREE,ONE        CCW COUNT IS ONE              A36311 47900020
         LA    REGZERO,ZEROS       WRITE A BYTE OF ZEROS         A36311 48200020
         MVI   CCW3+K4,SLIBIT           SET SLI BIT              Y02080 48500002
         B     CONTINUE            SKIP NEXT INSTRUCTIONS        A36311 48800020
*                                                                       49200020
* WRITE A FORMAT 6 DSCB.                                                49400020
*                                                                       49600020
WRITEF6  EQU   *                                                        49800020
         LA    REGTHREE,C140       CCW COUNT IS 140              A36311 49820020
         LA    REGZERO,DSCBF5      WRITE FROM DSCBF5 AREA        A36311 49840020
         MVI   CCW3+K4,NOCC             UNCHAIN CCW3 FROM CCW4   Y02080 49860002
         MVI   DSCBF5,F6INDIC      PUT F6 INDICATOR IN RECORD    A36311 49880020
CONTINUE EQU   *                                                 A36311 49900020
         STH   REGTHREE,CCW3+SIX        MOVE IN COUNT            Y02080 49920002
         ST    REGZERO,CCW3        MOVE IN DATA ADDRESS          A36311 49940020
         MVI   CCW3,WRITCOMD       MOVE IN WRITE CODE            A36311 49960020
         LA    REGONE,CCW1                                              50000020
         ST    REGONE,CHNPGADR          GET ADDR WRITE CHANNEL PROGRAM  50200020
         BAL   RETRNREG,EXCHANPG   WRITE A F6 OR F0 RECORD       A36311 50600020
         BR    RTNREG2                  RETURN                          51000020
*                                                                       51200020
* THIS ROUTINE READS A F6 DSCB INTO EITHER THE F1 OR F5 AREA.           51400020
*                                                                       51600020
READTOF5 EQU   *                                                        51800020
         LA    REGTHREE,DSCBF5          GET ADDR OF F5 AREA             52000020
         B     FURTHER                  SKIP NEXT INSTRUCTION           52200020
READTOF1 EQU   *                                                        52400020
         LA    REGTHREE,DSCBF1          GET ADDR OF F1 AREA             52600020
FURTHER  EQU   *                                                        52800020
         ST    REGTHREE,CCW6            STORE ADDR OF AREA RECEIVING F6 53000020
         MVI   CCW6+K4,NOCC             DON'T READ COUNT         Y02080 53200002
         LA    REGTHREE,CCW4                                            53400020
         ST    REGTHREE,CHNPGADR        SET CHANNEL PROGRAM TO READ     53600020
         MVI   CCW6,READCOMD            MOVE IN READ CODE               53800020
         BAL   RETRNREG,EXCHANPG        EXECUTE CHANNEL PROGRAM         54000020
         BR    RTNREG2                  RETURN                          54200020
*                                                                       54400020
* THIS ROUTINE EXECUTES THE CHANNEL PROGRAM.                            54600020
*                                                                       54800020
EXCHANPG EQU   *                                                        55000020
         MVI   ECB,ZERO                                                 55200020
         EXCP  IOB                                                      55400020
         WAIT  1,ECB=ECB                                                55600020
         TM    ECB,GOODIO               WAS I/O SUCCESSFUL              55800020
         BCR   1,RETRNREG               RETURN IF I/O SUCESSFUL  M0124  56000021
         LA    RERRPASS,ERRCD           SET ERROR RETURN CODE           56200020
ERREXIT  EQU   *                                                        57000020
         LA    REGTWO,LASTLOAD          POINT TO ID OF IGG0325T  Y02080 57050002
XCTLHERE EQU   *                                                        57800020
        IECRES LOAD,EXTPR=(RWKAREA),MODID=(REGTWO),BRANCH=DIRECT Y02080 57850002
*                                                                       58600020
* CONSTANTS                                                             58800020
*                                                                       59000020
*                                                                       59850021
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         59900002
*                                                                       59950021
         XCTLTABL ID=(MOD325U,5U,LASTLOAD,5T),SVC=032,BRT=YES,   Y02080X60000002
               LENGTH=                                           Y02080 60050002
         EJECT                                                   Y02080 60100002
CVT      DSECT                                                          63000020
         CVT                                                     Y02080 63200002
         EJECT                                                   Y02080 63250002
DSCBWKAR IECALLWA EP,F4,D1=(1),D2=(6)   ALLOCATE WORK AREA       Y02080 63800002
DSF3EXT1 EQU   DSCBF1+4                                                 75600020
DSF3EXT2 EQU   DSCBF1+9                                                 76200020
F5EXT16  EQU   DSCBF5+129               EXTENT 16 IN F5 DSCB            78600020
CHNPGADR EQU   IOB+16                   ADDRESS CHANNEL PROGRAM IN IOB  81400020
SEEKCYL  EQU   SEEK+3                                                   81800020
ZEROS    EQU   CCW2+4                   FULL WORD OF ZERO               82600020
SAVEPT   EQU   TTRLL                    CCHHR OF PREVIOUS F6     Y02080 93000002
F6CCHHR  EQU   PREVF5AD                 CURRENT F6 CCHHR         Y02080 93050002
         END                                                            95600020
./  ADD  SSI=32510340,NAME=IGG0325W
         TITLE 'IGG0325W - FORMAT 6 DSCB CONVERSION'             Y02080 00200002
IGG0325W CSECT                                                          00400020
*                                                                       00450002
* MODULE NAME = IGG0325W                                                00500002
*                                                                       00550002
* DESCRIPTIVE NAME = FORMAT 6 DSCB CONVERSION                           00560002
*                                                                       00570002
* COPYRIGHT = NONE                                                      00580002
*                                                                       00590002
* CHANGE ACTIVITY = SEE BELOW                                           00592002
*                                                                     * 00600020
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00800002
*0000000300-002000,008000-012000,078000-080000,108000,112000,    Y02080 00800102
*0000116000-118000,138000,224000,278000,306000,310000-316000,    Y02080 00800202
*0000328000,329200,340000,344000-346000,418000-422000,428000-    Y02080 00800302
*0000430000,464000,468000-470000,478000-486000,500000,530000,    Y02080 00800402
*0000570000-574000,578000-582000,590000-596000,597000,598000-    Y02080 00800502
*0000630000,634000-660000,694000-770000,774000-788000,792000-    Y02080 00800602
*0000814000,818000,822000-826000,830000-956000                   Y02080 00800702
*0000052000-056000,062000-070000,076000-078000,086000-088000,    Y02078 00800802
*0000094000-098000,174000,244000-246000,254000,328600,434000     Y02078 00800902
*          RELEASE 22 DELETIONS                                       * 01400020
*          RELEASE 21 DELETIONS                                       * 01600020
*0982024000-034000,114000,400000-402000,558000,562000-566000,    M0124  01620021
*0982582000,624000-626000,644000,648000-666000,670000-692000,    M0124  01640021
*0982696000,702000-748000,752000-756000,770000,776000,780000-    M0124  01660021
*0982784000,798000                                               M0124  01680021
*0982118000,130000-132000,484000,572000-574000,608000-612000     S21040 01700021
*                                                                     * 01800020
*0000                                                            A36311 01900020
*STATUS CHANGE LEVEL 002                                                02000021
*                                                                     * 02200020
* FUNCTION/OPERATION  THIS MODULE ADDS THE FORMAT 6 EXTENTS, FIVE AT  * 02400021
* A TIME, TO THE DADSMTBL AND XCTL'S TO IGG0325R TO SUBTRACT THESE    * 02600021
* FORMAT 6 EXTENTS FROM THE FREE SPACE IN THE FORMAT 5 DSCB(S). WHEN  * 02800021
* ALL THE EXTENTS HAVE BEEN SUBTRACTED, THE FORMAT 6 DSCB'S ARE       * 03000021
* CONVERTED TO THEIR FINAL FORMAT AND WRITTEN INTO THE VTOC.          * 03200021
*                                                                     * 03600020
* ENTRY POINTS                                                        * 03800020
*        IGG0325W- FROM IGG0325Q TO SUBTRACT FORMAT 6 EXTENTS FROM    * 04000020
*                                FREE SPACE                           * 04200020
*                  FROM IGG0325R TO PLACE MORE ALLOCATED EXTENTS      * 04400020
*                                IN THE DADSM TABLE                   * 04600020
*                                                                     * 04800020
* INPUT  FROM IGG0325Q                                                * 05000020
*              REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,      * 05200002
*              WHICH WILL CONTAIN THE FORMAT 4 DSCB AND THE FIRST     * 05400002
*              FORMAT 6 DSCB IN 'DSCBF5'.                             * 05600002
*                                                                     * 05800020
*        FROM IGG0325R                                                * 06000020
*              REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,      * 06200002
*              WHICH WILL CONTAIN THE FORMAT 4 DSCB, THE FORMAT 6     * 06400002
*              DSCB CURRENTLY BEING PROCESSED IN 'DSCBF1', AND THE    * 06600002
*              FIRST FORMAT 5 DSCB IN 'DSCBF5'.  REGISTER 1 WILL BE   * 06800002
*              ZERO TO INDICATE REENTRY FROM IGG0325R.                * 07000002
*                                                                     * 07200020
* OUTPUT TO IGG0325R                                                  * 07400020
*              REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,      * 07600002
*              WHICH WILL CONTAIN THE FORMAT 4 DSCB, THE FORMAT 6     * 07650002
*              DSCB BEING PROCESSED IN 'DSCBF1', AND THE FIRST FORMAT * 07700002
*              5 DSCB IN 'DSCBF5'.  'SEEKCYL' CONTAINS THE CCHHR OF   * 07750002
*              THE FORMAT 6 DSCB IN 'DSCBF1'.  CCW12 WILL CONTAIN A   * 07800002
*              TWO WORD PARAMETER LIST CONSISTING OF THE NUMBER       * 08000002
*              OF EXTENTS IN THE DADSMTABLE TO BE SUBTRACTED AND      * 08200020
*              THE ADDRESS OF THE FIRST EXTENT TO BE SUBTRACTED.      * 08400020
*                                                                     * 09000020
*         TO IGG0325T                                                 * 09200020
*              REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,      * 09400002
*              WHICH WILL CONTAIN THE FORMAT 4 DSCB.  THE FORMAT 6    * 09600002
*              DSCB(S) IN THE VTOC ARE VALID.                         * 09800002
*                                                                     * 10000020
* EXTERNAL ROUTINES                                                   * 10200020
*        EXCP (0)                                                     * 10400020
*        WAIT (1)                                                     * 10600020
*                                                                     * 11000020
* EXITS NORMAL BRANCH TO IGG0325R TO SUBTRACT F6 EXTENTS FROM THE     * 11200002
*                               FREE SPACE IN THE FORMAT 5 DSCB(S)    * 11400021
*              BRANCH TO IGG0325T TO CONVERT F5 TO CORRECT FORMAT     * 11600002
*       ERROR  BRANCH TO IGG0325T                                     * 11800002
*                                                                     * 12000020
*       ERROR CODES ISSUED BY THIS MODULE -                           * 12200020
*                                                                     * 12400020
*       0C - PERMANENT I/O ERROR                                      * 12600020
*                                                                     * 12800020
* TABLES/WORKAREAS  DADSM WORKAREA                                    * 13400020
*                                                                     * 13600020
* ATTRIBUTES  REENTRANT                                               * 13800002
*                                                                     * 14000020
* NOTES - THIS MODULE WAS SPLIT FROM IGG0325Q IN RELEASE 20.          * 14060021
*                                                                     * 14120021
*                                                                     * 14200020
REGZERO  EQU   0                        WORK REGISTER                   14400020
REGONE   EQU   1                        WORK REGISTER                   14600020
PARMREG  EQU   1                        PTR TO PARAMETER LIST           14800020
REENTRY  EQU   1                        REENTRY FROM IGG0325R           15000020
REGTWO   EQU   2                        WORK REGISTER                   15200020
REGTHREE EQU   3                        WORK REGISTER                   15400020
DADSMCTR EQU   4                        NO OF DADSMTBL ENTRIES          15600020
DADSMPTR EQU   5                        PTR TO DADSMTBL ENTRY           15800020
NEXTPTR  EQU   6                        PTR TO NEXT F6 EXTENT           16000020
REGSIX   EQU   6                        WORK REGISTER                   16200020
F6EXTCTR EQU   7                        CTR OF NO OF EXTENTS IN F6      16400020
RERRPASS EQU   8                        ERROR CODE REGISTER             16600020
F6PTR    EQU   8                        ADDR OF EXTENT IN F6            16800020
RTNREG2  EQU   9                        BRANCH REGISTER                 17000020
REGTEN   EQU   10                       WORK REGISTER                   17200020
RVTOCWKA EQU   11                       VTOC WORK AREA BASE REG  Y02078 17400002
BASEREG  EQU   12                       BASE REGISTER                   17600020
RWKAREA  EQU   13                       WORK AREA BASE REGISTER         17800020
RETRNREG EQU   14                       BRANCH REGISTER                 18000020
RCVT     EQU   15                       CVT BASE REGISTER               18200020
*                                                                     * 18250021
* OTHER EQUATES                                                       * 18300021
*                                                                     * 18350021
ZERO     EQU   0                        VALUE ZERO                      18400020
ONE      EQU   1                        VALUE ONE                       18600020
TWO      EQU   2                        VALUE TWO                       18800020
THREE    EQU   3                        VALUE THREE                     19000020
K4       EQU   4                        CONSTANT OF 4            Y02080 19050002
FOUR     EQU   4                        VALUE FOUR                      19200020
FIVE     EQU   5                        VALUE FIVE                      19400020
SIX      EQU   6                        VALUE SIX                       19600020
SEVEN    EQU   7                        VALUE SEVEN                     19800020
EIGHT    EQU   8                        VALUE EIGHT              A36311 19900020
C26      EQU   26                       VALUE 26                        20000020
C32      EQU   32                       VALUE 32                        20200020
C90      EQU   90                       VALUE 90                        20400020
NOCC     EQU   X'00'                    NO COMMAND CHAINING      Y02080 20500002
HEX01    EQU   X'01'                    VALUE X'01'                     20600020
GOODIO   EQU   X'20'                    TEST VALUE FOR SUCCESSFUL I/O   20800020
ERRCD    EQU   X'0C'                    ERROR CODE FOR UNSUCCESSFUL I/O 21000020
F6ID     EQU   X'F6'                    F6 ID                           21200020
F6INDIC  EQU   X'06'                    F6 DSCB INDICATOR               21400020
READCOMD EQU   X'0E'                    READ COMMAND CODE               21600020
*                                                                     * 21800020
         BALR  BASEREG,ZERO             INITIALIZE BASE REGISTER        22000020
         USING *,BASEREG                                                22200020
         USING ALLOCWKA,RWKAREA         BASE FOR ALLOCATE W/A    Y02080 22400002
         USING CVT,RCVT                 BASE FOR CVT                    22600020
*                                                                       22650002
         LTR   REENTRY,REENTRY          IS THIS REENTRY                 22800020
         BZ    RETURNPT                 BRANCH IF YES                   23000020
*                                                                       23200020
* THIS SECTION BUILDS THE DADSMTBL, FIVE ENTRIES AT A TIME, AND         23400020
* THEN GOES TO THE SUBTRACT ROUTINE TO SUBTRACT THESE EXTENTS           23600020
* FROM THE F5 DSCB(S).                                                  23800020
*                                                                       24000020
BUILDTBL EQU   *                                                        24200020
         MVC   DADSMADR(FIVE),DS4F6PTR  INIT PTR TO PRESENT F6          24800020
         MVC   SEEKCYL(FIVE),DS4F6PTR   MOVE ADDR FIRST F6 TO           25000002
*                                       CHANNEL PROGRAM                 25200002
         MVC   DSCBF1,DSCBF5            MOVE FIRST F6 DSCB       Y02078 25220002
         LR    REGTWO,RWKAREA           LOAD WORK AREA ADDRESS   Y02078 25240002
         LA    REGONE,IECEXTPR-IECPREFX  LENGTH OF PREFIX        Y02078 25260002
         SR    REGTWO,REGONE            POINT TO PREFIX          Y02078 25280002
         USING IECPREFX,REGTWO          ADDRESSABILITY TO PREFIX Y02078 25300002
LOADADDR EQU   *                        BRANCH LABEL             Y02078 25320002
         L     RVTOCWKA,IECCORP2        LOAD NEXT PREFIX ADDRESS Y02078 25340002
         LR    REGTWO,RVTOCWKA          PREPARE TO TEST PREFIX   Y02078 25360002
         CLC   IECCORID,VCWKAID         TEST IF VTOC WORK AREA   Y02078 25380002
         BNE   LOADADDR                 IF NOT, LOAD NEXT ADDR   Y02078 25400002
         LA    RVTOCWKA,IECSTART-IECPREFX(RVTOCWKA)  INCREMENT   Y02078 25420002
*                                       TO WORK AREA BEGINNING   Y02078 25440002
         USING VTOCWKA,RVTOCWKA         VTOC W/A ADDRESSABILITY  Y02078 25460002
         MVC   DSCBF5,VTC1STF5          MOVE IN FIRST F5 DSCB    Y02078 25480002
         LA    DADSMCTR,FIVE            INITIALIZE NUMBER OF            25600020
*                                       ENTRIES IN DADSMTBL             25800002
         LA    DADSMPTR,DADSMTBL        POINT TO DADSMTBL               26000020
         LA    F6EXTCTR,C26             MAX NO EXTENTS IN F6            26200020
         LA    F6PTR,DS6AVEXT           POINT TO FIRST EXTENT           26400020
         LR    NEXTPTR,F6PTR                                            26600020
         LA    NEXTPTR,FIVE(NEXTPTR)    POINT TO NEXT EXTENT            26800020
         XC    DADSMTBL,DADSMTBL        ZERO DADSMTBL                   27000020
ADDENTRY EQU   *                                                        27200020
         MVC   ZERO(FOUR,DADSMPTR),ZERO(F6PTR) MOVE F6 EXTENT           27400020
*                                       INTO DADSMTBL                   27600020
         STM   NEXTPTR,F6EXTCTR,CCW11   SAVE PTR TO NEXT EXTENT  Y02080 27800002
         BCT   DADSMCTR,MOVEAGIN        BRANCH IF DADSMTBL NOT FULL     28000020
*                                                                       28200020
* THIS ROUTINE PREPARES TO XCTL TO IGG0325R TO SUBTRACT THE             28400020
* FORMAT 6 EXTENTS FROM THE FREE SPACE IN THE FORMAT 5 DSCB'S.          28600020
*                                                                       28800020
SUBTRACT EQU   *                                                        29000020
         LA    REGTWO,FIVE                                              29200020
         SR    REGTWO,DADSMCTR          GET NO OF EXTENTS IN DADSMTBL   29400020
         ST    REGTWO,CCW12             PUT NO OF EXTENTS TO BE         29600020
*                                       SUBTRACTED IN LIST              29800020
         LA    DADSMPTR,DADSMTBL        PUT ADDR OF NEXT EXTENT         30000020
*                                       TO BE SUBTRACTED IN             30200020
*                                       PARAMETER LIST                  30400020
         ST    DADSMPTR,CCW12+K4                                 Y02080 30600002
         MVI   CCW12,HEX01              SHOW ENTRY FROM IGG0325W        30800020
         LA    REGTWO,MOD325R           POINT TO ID OF IGG0325R  Y02080 30850002
         B     XCTLHERE                 GO XCTL                         31800020
*                                                                       32000020
* THIS SECTION RECEIVES CONTROL AFTER REENTRY FROM IGG0325R.            32200020
*                                                                       32400020
RETURNPT EQU   *                                                        32600020
         LM    NEXTPTR,F6EXTCTR,CCW11   RESTORE NEXT EXTENT PTR  Y02080 32800002
         LA    DADSMCTR,FIVE            NO OF ENTRIES IN DADSMTBL       33000020
         LA    DADSMPTR,DADSMTBL-FOUR   POINT TO DADSMTBL               33200020
         XC    DADSMTBL,DADSMTBL        ZERO DADSMTBL                   33400020
MOVEAGIN EQU   *                                                        33600020
         BCT   F6EXTCTR,TESTUSED        ARE THERE MORE F6 XTENTS        33800020
         CLI   DS6PTRDS+FOUR,ZERO       IS THIS THE LAST F6      Y02080 34000002
         BE    FINISHED                 BRANCH IF YES                   34200020
         MVC   DADSMADR,DS6PTRDS        UPDATE PTR TO PRESENT F6 Y02080 34400002
         MVC   SEEKCYL(FIVE),DS6PTRDS   MOVE ADDR OF NEW F6 TO   Y02080 34600002
*                                       CHANNEL PROGRAM                 34800020
         BAL   RTNREG2,READTOF1         GO READ THIS F6                 35000020
         LA    F6EXTCTR,C26             MAX NO EXTENTS IN F6            35200020
         LA    NEXTPTR,DS6AVEXT         POINT TO FIRST EXTENT           35400020
         B     CHNGPTR                  GO UPDATE POINTERS              35600020
TESTUSED EQU   *                                                        35800020
         CLC   ZERO(FOUR,NEXTPTR),ZEROS IS NEW EXTENT UNUSED            36000020
         BNE   CHNGPTR                  BRANCH IF NO                    36200020
FINISHED EQU   *                                                        36400020
         LA    REGTWO,FIVE                                              36600020
         SR    REGTWO,DADSMCTR          GET NO OF EXTENTS IN DADSMTBL   36800020
         LTR   REGTWO,REGTWO            ARE EXTENTS TO BE SUBTRACTED    37000020
         BE    RD1STF6                  BRANCH IF NO                    37200020
         B     SUBTRACT                 GO SUBTRACT THE EXTENTS         37400020
CHNGPTR  EQU   *                                                        37600020
         LA    DADSMPTR,FOUR(DADSMPTR)  POINT TO NEXT FREE SPACE        37800020
*                                       IN DADSMTBL                     38000020
         LR    F6PTR,NEXTPTR                                            38200020
         LA    NEXTPTR,FIVE(NEXTPTR)    POINT TO NEXT F6 EXTENT         38400020
         B     ADDENTRY                 GO ADD ENTRY TO DADSMTBL        38600020
RD1STF6  EQU   *                                                        38800020
         CLC   DADSMADR,DS4F6PTR        TEST IF FIRST FORMAT 6   Y02078 38820002
*                                       IS CURRENTLY IN 'DSCBF1' Y02078 38840002
         BNE   READF6                   IF NO, GO READ 1ST F6    Y02078 38860002
         MVC   DSCBF5,DSCBF1            MOVE IN FIRST F6 DSCB    Y02078 38880002
         B     FINISHF6                 GO CONVERT THE FIRST F6  Y02078 38900002
READF6   EQU   *                        BRANCH LABEL             Y02078 38920002
         MVC   SEEKCYL(FIVE),DS4F6PTR   MOVE ADDR FIRST F6              39000020
*                                       INTO CHANNEL PROGRAM            39200020
         MVC   DADSMADR(FIVE),DS4F6PTR  INIT CURRENT F6 POINTER         39400020
         BAL   RTNREG2,READTOF5         READ FIRST F6                   39600020
*                                                                       39800020
* AFTER ALL THE FORMAT 6 EXTENTS HAVE BEEN SUBTRACTED FROM THE FREE     39900021
* SPACE IN THE FORMAT 5 DSCB(S), THIS SECTION CONVERTS THE EXTENTS      40000021
* FROM THE RTA/RTA+1/DATA SET COUNT FORMAT TO THEIR FINAL FORMAT        40100021
* (RTA/NUMBER OF SHARED SYLINDERS/DATA SET COUNT) AND INSERTS THE       40200021
* F6 ID AFTER MOVING THE LAST 90 BYTES ONE BYTE TO THE RIGHT.           40400020
*                                                                       40600020
FINISHF6 EQU   *                                                        40800020
         LA    F6PTR,DS5AVEXT           POINT TO FIRST F6 EXTENT        41000020
         LA    REGSIX,C26               GET MAX NO OF EXTENTS IN F6     41200020
         LH    REGONE,DS4TKCYL          GET NUMBER TRKS/CYL             41400020
CONVNXT  EQU   *                                                        41600020
         MVC   PDLIST5(FOUR),ZERO(F6PTR)  MOVE TO FULLWORD       Y02080 41800002
         LH    REGTHREE,PDLIST5+TWO     GET RTA+1                Y02080 42000002
         SH    REGTHREE,PDLIST5         SUBTRACT RTA FROM RTA+1  Y02080 42200002
         SR    REGTWO,REGTWO            ZERO REGISTER                   42400020
         DR    REGTWO,REGONE            DIVIDE TRKS BY TRKS/CYL         42600020
         STH   REGTHREE,PDLIST5+TWO                              Y02080 42800002
         MVC   TWO(TWO,F6PTR),PDLIST5+TWO  STORE NUMBER OF CYLS  Y02080 43000002
         LA    F6PTR,FIVE(F6PTR)        UPDATE EXTENT POINTER           43200020
         CLC   ZERO(TWO,F6PTR),ZEROS    TEST IF EXTENT UNUSED    Y02078 43400002
         BE    BGINMOVE                 BRANCH IF YES                   43600020
         BCT   REGSIX,CONVNXT           BRANCH IF MORE EXTENTS TO BE    43800020
*                                       CONVERTED                       44000020
BGINMOVE EQU   *                                                        44200020
         LA    REGTWO,C90               SET UP LOOP CONTROL             44400020
         LA    REGONE,F5EXT16B          POINT TO LAST FIELD             44600020
MOVE     EQU   *                                                        44800020
         MVC   ONE(ONE,REGONE),ZERO(REGONE) MOVE FIELDS TO PROPER PLACE 45000020
         BCTR  REGONE,ZERO              DECREMENT ADDRESS               45200020
         BCT   REGTWO,MOVE              BRANCH IF MORE FIELDS TO MOVE   45400020
         MVI   DS5FMTID,F6ID            MOVE IN F6 IDENTIFIER           45600020
         MVI   DSCBF5,F6INDIC           MOVE IN F6 INDICATOR            45800020
         MVC   DS5KID1(THREE),DSCBF5    PROPAGATE X'06' FIELD           46000020
         BAL   RTNREG2,WRITEF6          WRITE F6                        46200020
         LH    REGONE,DS4DSREC          LOAD NUMBER OF F0 DSCB'S Y02078 46250002
         BCTR  REGONE,ZERO              DECREMENT BY ONE         Y02078 46300002
         STH   REGONE,DS4DSREC          SAVE NEW NUMBER OF F0'S  Y02078 46350002
         CLI   DS5PTRDS+FOUR,ZERO       IS THIS THE LAST F6      Y02080 46400002
         BE    XCTL325T                 BRANCH IF YES                   46600020
         MVC   DADSMADR,DS5PTRDS        UPDATE PRESENT F6 PTR    Y02080 46800002
         MVC   SEEKCYL(FIVE),DS5PTRDS   MOVE ADDR OF NEXT F6 TO  Y02080 47000002
*                                       CHANNEL PROGRAM                 47200020
         BAL   RTNREG2,READTOF5         READ NEXT F6                    47400020
         B     FINISHF6                 GO TO CONVERT NEXT F6           47600020
*                                                                       48800020
* WRITE A FORMAT 6 DSCB.                                                49000020
*                                                                       49200020
WRITEF6  EQU   *                                                        49400020
         LA    REGONE,CCW1                                              49600020
         ST    REGONE,CHNPGADR          GET ADDR WRITE CHANNEL PROGRAM  49800020
         MVI   CCW3+K4,NOCC             UNCHAIN READ FROM RD CNT Y02080 50000002
         MVC   SEEKCYL(FIVE),DADSMADR   MOVE IN ADDR OF F6              50200020
         MVI   DSCBF5,F6INDIC           PUT F6 INDICATOR IN RECORD      50400020
         BAL   RETRNREG,EXCHANPG        WRITE F6                        50600020
         BR    RTNREG2                  RETURN                          50800020
*                                                                       51000020
* THIS ROUTINE READS A F6 DSCB INTO EITHER THE F1 OR F5 AREA.           51200020
*                                                                       51400020
READTOF5 EQU   *                                                        51600020
         LA    REGTHREE,DSCBF5          GET ADDR OF F5 AREA             51800020
         B     FURTHER                  SKIP NEXT INSTRUCTION           52000020
READTOF1 EQU   *                                                        52200020
         LA    REGTHREE,DSCBF1          GET ADDR OF F1 AREA             52400020
FURTHER  EQU   *                                                        52600020
         ST    REGTHREE,CCW6            STORE ADDR OF AREA RECEIVING F6 52800020
         MVI   CCW6+K4,NOCC             DON'T READ COUNT         Y02080 53000002
         LA    REGTHREE,CCW4                                            53200020
         ST    REGTHREE,CHNPGADR        SET CHANNEL PROGRAM TO READ     53400020
         MVI   CCW6,READCOMD            MOVE IN READ CODE               53600020
         BAL   RETRNREG,EXCHANPG        EXECUTE CHANNEL PROGRAM         53800020
         BR    RTNREG2                  RETURN                          54000020
*                                                                       54200020
* THIS ROUTINE EXECUTES THE CHANNEL PROGRAM.                            54400020
*                                                                       54600020
EXCHANPG EQU   *                                                        54800020
         MVI   ECB,ZERO                                                 55000020
         EXCP  IOB                                                      55200020
         WAIT  1,ECB=ECB                                                55400020
         TM    ECB,GOODIO               WAS I/O SUCCESSFUL              55600020
         BCR   1,RETRNREG               RETURN IF I/O SUCESSFUL  M0124  55800021
         LA    RERRPASS,ERRCD           SET ERROR RETURN CODE           56000020
         B     ERREXIT                  BRANCH TO IGG0325T       Y02080 56050002
XCTL325T EQU   *                        BRANCH LABEL             Y02080 56100002
         XR    RERRPASS,RERRPASS        CLEAR ERROR PASS REG     Y02080 56150002
ERREXIT  EQU   *                                                        56800020
         LA    REGTWO,LASTLOAD          POINT TO ID OF IGG0325T  Y02080 56850002
XCTLHERE EQU   *                                                        57600020
        IECRES LOAD,EXTPR=(RWKAREA),MODID=(REGTWO),BRANCH=DIRECT Y02080 57650002
*                                                                       58400020
* CONSTANTS                                                             58600020
*                                                                       58800020
VCWKAID  DC    CL4'VCWA'                VTOC WORK AREA PREFIX ID Y02078 58850002
*                                                                       59650021
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         59700002
*                                                                       59750021
         XCTLTABL ID=(MOD325R,5R,LASTLOAD,5T),SVC=032,BRT=YES,   Y02080X59800002
               LENGTH=                                           Y02080 59850002
         EJECT                                                   Y02080 59900002
CVT      DSECT                                                          63200020
         CVT                                                     Y02080 63400002
         EJECT                                                   Y02080 63450002
DSCBWKAR IECALLWA EP,F4,D1=(6),D2=(5)   ALLOCATE WORK AREA       Y02080 64000002
DS4TKCYL EQU   DS4DEVSZ+2                                               66800020
DS5KID1  EQU   DSCBF5+1                                                 77200020
F5EXT16B EQU   DSCBF5+133               END OF EXTENT 16 IN F5 DSCB     79000020
CHNPGADR EQU   IOB+16                   ADDRESS CHANNEL PROGRAM IN IOB  81600020
SEEKCYL  EQU   SEEK+3                                                   82000020
ZEROS    EQU   CCW2+4                   FULL WORD OF ZERO               82800020
         EJECT                                                   Y02078 82850002
VWKAREA  IECVTCWA                       CONVERSION WORK AREA     Y02078 82900002
         END                                                            95800020
./  ADD  SSI=53240532,NAME=IGG0325Z
 TITLE 'IGG0325Z - VTOC CONVERSION INITIALIZATION'               Y02080 00100002
IGG0325Z CSECT                                                          00150021
*                                                                       00160002
* MODULE NAME = IGG0325Z                                                00170002
*                                                                       00180002
* DESCRIPTIVE NAME = VTOC CONVERSION INITIALIZATION                     00190002
*                                                                       00192002
* COPYRIGHT = NONE                                                      00194002
*                                                                       00196002
* CHANGE ACTIVITY = SEE BELOW                                           00198002
*                                                                     * 00200018
*          RELEASE 19 DELETIONS                                       * 00207018
*          RELEASE 20 DELETIONS                                       * 00214018
*2753269000-270000,331000-333000,341000                          A29936 00215020
*2753027000,062000,101000,308000-310000,336000-337000            A31534 00217020
*2753014000-015000,116000                                        A35328 00219020
*          RELEASE 21 DELETIONS                                       * 00221018
*1191032000,036000-038000,306000,348000,350000-359000,361000-    M0124  00221221
*1191372000,374000,377000-400000,402000-404000,410000,413000,    M0124  00221421
*1191415000-417000,424000                                        M0124  00221621
*1191009000,027000,109000,336000-337000                          S21040 00222021
*1191009000-010000,013600-015400,115000,133000,155000,158000,    A37239 00223002
*1191160000,169000-170000,267000-270100                          A37239 00225002
*          RELEASE 22 DELETIONS                                       * 00228018
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00235002
*0000000100-001000,002350-002630,013700-015100,024000,026000-    Y02080 00235102
*0000027000,032000,034000,039000-042000,051000,074000,076000-    Y02080 00235202
*0000080000,086000-087000,089000-103000,106000,112000-113000,    Y02080 00235302
*0000116000-117000,131960,136000,141000,149000,157000,178000,    Y02080 00235402
*0000185000-199000,212000,214000-216000,223000-225000,227000,    Y02080 00235502
*0000239000,245000,249000,251000,253000,264000,272000,277000,    Y02080 00235602
*0000282000-283000,286000,288000-289000,301000-311000,321000,    Y02080 00235702
*0000327000-330000,330400,331000-355000,373000-412000,418000-    Y02080 00235802
*0000427000,429000-432000,434000,436000-502000                   Y02080 00235902
*0000199000                                                      Y02130 00236002
*0000003000                                                      Y02082 00236102
*0000003000-005000,009000-010000,012000-013700,017000,028000-    Y02078 00236202
*0000030000,081000,083000,104000,110000,132600,138000,146000-    Y02078 00236302
*0000148000,159000-167000,172000-174000,207000,213000,236200-    Y02078 00236402
*0000236800,283400,317000                                        Y02078 00236502
*                                                                     * 00270018
*            VS2 RELEASE 03 CHANGES                            @ZA02214 00272003
*0000200000                                                    @ZA02214 00274003
*0000                                                          @ZA07209 00275003
*STATUS CHANGE LEVEL 003                                                00277021
*                                                                     * 00284018
* FUNCTION/OPERATION  THIS MODULE DOES THE INITIALIZATION PROCESSES   * 00292020
* FOR THE VTOC CONVERSION ROUTINES.  IF THESE ROUTINES WERE ENTERED   * 00300002
* FROM IGG0325A (ALLOCATE), THIS MODULE SWITCHES THE PSW KEY TO THE   * 00310002
* DATA MANAGEMENT KEY.  IF THE SECOND BYTE OF THIS MODULE HAS NOT     * 00320002
* BEEN MODIFIED TO PREVENT VTOC CONVERSION, IT ISSUES MESSAGE IEC604I * 00330002
* WITH EITHER CODE=DIRF (IF THE VTOC CONVERSION ROUTINES WERE ENTERED * 00340002
* BECAUSE THE DIRF BIT WAS PREVIOUSLY SET) OR WITH CODE=DOS (IF THE   * 00350002
* CONVERSION ROUTINES WERE ENTERED BECAUSE THE DOS CONTAMINATION      * 00360002
* BIT WAS SET).  IGG0325Z THEN RELOCATES A NEW CHANNEL PROGRAM        * 00370002
* TO THE ALLOCATE WORK AREA.  IT THEN ZEROS OUT EXISTING FORMAT       * 00400002
* 6 DSCB'S. FINALLY IT INITIALIZES THE FIRST FORMAT 5 DSCB AND        * 00500002
* TAKES IPL TRACKS INTO CONSIDERATION.                                * 00600018
*                                                                     * 00700018
* ENTRY POINTS                                                        * 00800018
*        IGG0325Z - ENTRY IS MADE FROM IGG0325A (ALLOCATE) OR FROM    * 00900002
*                   IGG0553F (EXTEND) WHEN EITHER THE DOS BIT OR      * 01000002
*                   THE DIRF BIT IS SET IN THE FORMAT 4 DSCB.         * 01010002
*                                                                     * 01100018
* INPUT  ON ENTRY REGISTER 13 WILL POINT TO THE ALLOCATE WORK AREA,   * 01200002
*        WHICH WILL CONTAIN THE DATA PORTION OF THE FORMAT 4 DSCB.    * 01300002
*        'DADSMADR' AND 'FMTOUTAD' CONTAIN THE CCHHR OF THE FIRST     * 01310002
*        FORMAT 5 DSCB. 'VTOCADR' CONTAINS THE CCHHR OF THE FORMAT 4. * 01370002
*        ON ENTRY FROM ALLOCATE, REGISTER 11 POINTS TO THE JFCB.      * 01380002
*        REGISTER 7 WILL POINT TO THE UCB.                            * 01440002
*                                                                     * 01600018
* OUTPUT  REGISTER 13 WILL BE THE SAME AS ON INPUT.  THE              * 01700002
*         DADSM WORK AREA WILL CONTAIN THE FIRST RE-INITIALIZED       * 01800018
*         FORMAT 5 DSCB,THE FORMAT4 DSCB,AND THE CHANNEL PROGRAM.     * 01900018
*                                                                     * 02000018
* EXTERNAL ROUTINES                                                   * 02100018
*          EXCP(0)                                                    * 02200018
*          WAIT(1)                                                    * 02300018
*          WTO(35)                                                    * 02310002
*                                                                     * 02500018
* EXITS  NORMAL  BRANCH TO IGG0325P                                   * 02600002
*        ERROR   BRANCH TO IGG0325T                                   * 02700002
*                                                                     * 02800002
*        ERROR CODES ISSUES BY THIS MODULE -                          * 02900002
*                                                                     * 02940002
*        0C - PERMANENT I/O ERROR                                     * 02980002
*                                                                     * 03020002
*        9C - DADSM ALLOCATION TERMINATED DUE TO POSSIBLE VTOC ERRORS * 03060002
*                                                                     * 03100018
* TABLES/WORK AREAS - DADSM WORK AREA DESCRIBED BY MACRO 'IECALLWA'   * 03200002
*                                                                     * 03300018
* ATTRIBUTES REENTRANT                                                * 03400002
*                                                                     * 03500018
*                                                                     * 04300018
* REGISTER EQUATES                                                    * 04350021
*                                                                     * 04400018
REGZERO  EQU   0                        WORK REGISTER                   04500018
REGONE   EQU   1                        WORK REGISTER                   04600018
REGTWO   EQU   2                        WORK REGISTER                   04700018
REGTHREE EQU   3                        WORK REGISTER                   04800018
REGFOUR  EQU   4                        WORK REGISTER                   04900018
REGFIVE  EQU   5                       WORK REGISTER             8M3261 04950018
REGSIX   EQU   6                        WORK REGISTER                   05000018
LSTF5CTR EQU   6                        NBR OF EXTENTS IN 1ST F5 Y02080 05100002
RUCBPTR  EQU   7                        PTR. TO UCB                     05200018
REGSEVEN EQU   7                        WORK REGISTER                   05300018
REGEIGHT EQU   8                        WORK REGISTER                   05400018
DADSMPTR EQU   8                        PTR  TO EXTENT IN DADSMTBL      05500018
RERRPASS EQU   8                        ERROR CODE REGISTER      A31534 05550020
REGNINE  EQU   9                        WORK REGISTER                   05600018
RJFCBPTR EQU   11                       PTR. TO JFCB                    05700018
BASEREG  EQU   12                       BASE REGISTER                   05800018
REGTHIRT EQU   13                       WORK REGISTER                   05900018
RWKAREA  EQU   13                       WORK AREA BASE REGISTER         06000018
RETRNREG EQU   14                       RETURN REGISTER                 06100018
RCVT     EQU   15                       CVT POINTER                     06300018
*                                                                     * 06320021
* OTHER EQUATES                                                       * 06340021
*                                                                     * 06360021
K0       EQU   0                        CONSTANT OF 0            Y02080 06370002
ZERO     EQU   0                        VALUE ZERO                      06400018
ONE      EQU   1                        VALUE ONE                       06500018
TWO      EQU   2                        VALUE TWO                       06600018
THREE    EQU   3                        VALUE THREE                     06700018
K4       EQU   4                        CONSTANT OF 4            Y02080 06750002
FOUR     EQU   4                        VALUE FOUR                      06800018
FIVE     EQU   5                        VALUE FIVE                      06900018
SIX      EQU   6                        VALUE SIX                       07000018
SEVEN    EQU   7                        VALUE SEVEN                     07100018
EIGHT    EQU   8                        VALUE EIGHT                     07200018
TWELVE   EQU   12                       VALUE 12                        07300018
SIXTEEN  EQU   16                       VALUE SIXTEEN                   07500018
RDDATA   EQU   X'06'                    READ DATA COMMAND        Y02078 08100002
F5INDIC  EQU   X'05'                    F5 DSCB INDICATOR               08200018
GOODIO   EQU   X'20'                    TEST VALUE FOR SUCCESSFUL I/O   08400018
ERRCD    EQU   X'0C'                    ERROR CODE FOR UNSUCCESSFUL I/O 08500018
UUU      EQU   44                       DISP. TO UUU IN MESSAGE  Y02078 08550002
VOLSER   EQU   48                       DISP. TO VOLSER IN MSG   Y02078 08600002
MSGCODE  EQU   55                       DISP. TO CODE IN MESSAGE Y02078 08650002
BYPASS   EQU   X'01'                    CONVERSION BYPASS BIT    Y02078 08700002
NOCONVT  EQU   X'9C'                    CONVERSION BYPASS ERROR  Y02078 08750002
C140     EQU   140                                                      08800018
ONE16    EQU   116                      116 CYLINDERS            Y02130 08850002
DA3340   EQU   X'0A'                    3340 DEVICE TYPE         Y02130 08900002
DA2305I  EQU   X'06'                    2305 MOD 1 DEVICE TYPE @ZA07209 08930003
DA2305II EQU   X'07'                    2305 MOD 2 DEVICE TYPE @ZA07209 08960003
NOCC     EQU   X'00'                    NO COMMAND CHAINING      Y02080 09000002
SKIP     EQU   X'10'                    SUPPRESS DATA TRANSFER   Y02080 09050002
CC       EQU   X'40'                    COMMAND CHAINING BIT     Y02080 09100002
C40      EQU   40                      VALUE 40                         10500018
C144     EQU   144                     VALUE 144                        10700018
C24      EQU   24                      VALUE 24                         10800018
*                                                                     * 10900021
         USING *,BASEREG                                                11100018
         USING ALLOCWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 11200002
         USING UCB,RUCBPTR              UCB ADDRESSABILITY       Y02080 11300002
         USING CVT,RCVT                                                 11400018
*                                                                     * 11401002
* THE FIRST INSTRUCTION ASSEMBLES AS X'0700'.  YOU CAN DISABLE        * 11402002
* CONVERSION OF YOUR VOLUMES THAT HAVE THE DIRF BIT SET BY CHANGING   * 11403002
* THESE TWO BYTES TO X'0701'.  WITH THIS CHANGE, VTOC CONVERSION WILL * 11404002
* NOT OCCUR FOR A VOLUME ON WHICH THE DIRF BIT WAS PREVIOUSLY SET.    * 11405002
*                                                                     * 11406002
CONVTEST BCR   K0,K0                    CONVERSION TEST          Y02078 11408002
         BALR  BASEREG,ZERO             INITIALIZE THE BASE REG  Y02078 11409002
ADJUSTRG EQU   *                        BRANCH LABEL             Y02078 11410002
         LA    REGEIGHT,ADJUSTRG-CONVTEST  PREPARE TO ADJUST REG Y02078 11411002
         LA    BASEREG,0(BASEREG)       CLEAR HIGH ORDER BYTE    Y02078 11412002
         SR    BASEREG,REGEIGHT         ADJUST THE BASE REGISTER Y02078 11413002
         TM    ACNVSW,ALLOCID           TEST IF ENTERED FROM     Y02082 11414002
*                                       ALLOCATE (IGG0325A)      Y02082 11415002
         BNO   BUILDMSG                 BRANCH IF NOT            Y02082 11416002
         MODESET EXTKEY=DATAMGT         ASSUME DATAMGT KEY       Y02082 11417002
*                                                                     * 11418002
* THIS SECTION TESTS IF THE VTOC IS TO BE CONVERTED.  IF YES,         * 11419002
* IT ISSUES MESSAGE IEC604I.                                          * 11420002
*                                                                     * 11421002
BUILDMSG EQU   *                        BRANCH LABEL             Y02078 11422002
         MVC   CCW1(MSGEND-VTOCMSG),VTOCMSG  MOVE IN MESSAGE     Y02078 11423002
         MVC   CCW1+UUU(L'UCBNAME),UCBNAME  MOVE IN EBCDIC UCB   Y02078 11424002
*                                       CHANNEL/UNIT ADDRESS     Y02078 11425002
         MVC   CCW1+VOLSER(L'SRTEVOLI),SRTEVOLI  MOVE IN VOLID   Y02078 11426002
         TM    ACNVSW,DIRFSET           TEST IF THE DIRF BIT WAS Y02078 11427002
*                                       PREVIOUSLY SET           Y02078 11428002
         BNO   DOSMSG                   BRANCH IF NOT            Y02078 11429002
         TM    CONVTEST+ONE,BYPASS      TEST FOR NO CONVERSION   Y02078 11430002
         BNO   ISSUEMSG                 BRANCH IF CONVERSION     Y02078 11431002
         LA    RERRPASS,NOCONVT         LOAD ERROR CODE          Y02078 11432002
         B     ERREXIT                  GO BRANCH TO IGG0325T    Y02078 11433002
DOSMSG   EQU   *                        BRANCH LABEL             Y02078 11434002
         MVC   CCW1+MSGCODE(L'DOSCODE),DOSCODE  MOVE IN CODE=DOS Y02078 11435002
ISSUEMSG EQU   *                        BRANCH LABEL             Y02078 11436002
         WTO   MF=(E,CCW1)              ISSUE MESSAGE IEC604I    Y02078 11437002
*                                                                     * 11450021
* THIS SECTION RELOCATES THE CHANNEL PROGRAM TO THE WORKAREA.         * 11500021
*                                                                     * 11550021
BUILDCHP EQU   *                        BRANCH LABEL             Y02078 11560002
         XC    CCW11(ATIOTPTR-CCW11),CCW11  ZERO WORK AREA       Y02080 11600002
         ST    RUCBPTR,PDLIST5          SAVE THE UCB POINTER     Y02080 11700002
         LM    REGZERO,REGNINE,CHANPROG GET FIRST 5 CCW'S               11800018
         ALR   REGZERO,RWKAREA          ADD RELOCATION FACTOR TO CCW1   11900018
         ALR   REGTWO,RWKAREA           ADD RELOCATION FACTOR TO CCW2   12000018
         ALR   REGFOUR,RWKAREA          ADD RELOCATION FACTOR TO CCW3   12100018
         ALR   REGSIX,RWKAREA           ADD RELOCATION FACTOR TO CCW4   12200018
         ALR   REGEIGHT,RWKAREA         ADD RELOCATION FACTOR TO CCW5   12300018
         STM   REGZERO,REGNINE,CCW1     STORE CCW'S                     12400018
         LM    REGZERO,REGNINE,CHANPROG+C40 LOAD 2ND 5 CCW'S            12500018
         ALR   REGZERO,RWKAREA          ADD RELOCATION FACTOR TO CCW6   12600018
         ALR   REGTWO,RWKAREA           ADD RELOCATION FACTOR TO CCW7   12700018
         ALR   REGFOUR,RWKAREA          ADD RELOCATION FACTOR TO CCW8   12800018
         ALR   REGSIX,RWKAREA           ADD RELOCATION FACTOR TO CCW9   12900018
         ALR   REGEIGHT,RWKAREA         ADD RELOCATION FACTOR TO CCW10  13000018
         STM   REGZERO,REGNINE,CCW6     STORE CCW'S IN WORK AREA        13100018
*                                                                     * 13100721
* THIS SECTION CALCULATES THE NUMBER OF DSCB'S IN THE VTOC.           * 13101421
*                                                                     * 13102121
         SR    REGFIVE,REGFIVE         CLEAR WORK REGISTER       8M3261 13103018
         MVC   SEEK(EIGHT),DS4VTOCE+TWO POSITION EXTENTS         8M3261 13106018
         LH    REGONE,SEEK             PICK UP BEGINNING CC      8M3261 13109018
         LH    REGTWO,SEEK+TWO         PICK UP BEGINNING  HH     8M3261 13112018
         LH    REGTHREE,SEEK+FOUR      PICK UP ENDING CC         8M3261 13115018
         LH    REGFOUR,SEEK+SIX        PICK UP ENDING  HH        8M3261 13118018
         CLI   DS4VTOCE+FIVE,ZERO       DOES EXTENT BEGIN ON CYL 8M3261 13121018
*                                       BOUND                    8M3261 13124018
         BE    NOCYL                   BRANCH IF YES             8M3261 13127018
         LA    REGONE,ONE(REGONE)      OBTAIN CYLINDER BOUNDRY   8M3261 13130018
         LH    REGFIVE,DS4DEVSZ+TWO                              8M3261 13133018
         SR    REGFIVE,REGTWO          CALCULATE TRKS BEFORE     8M3261 13136018
*                                       FULL CYL                 8M3261 13139018
NOCYL    SR    REGTHREE,REGONE         GET NUM OF FULL CYLS      8M3261 13142018
         MH    REGTHREE,DS4DEVSZ+TWO   GET NUM TRKS IN FULL CYLS 8M3261 13145018
         AR    REGTHREE,REGFIVE        ADD TRACKS BEFORE FULL    8M3261 13148018
*                                       CYL                      8M3261 13151018
         LA    REGFOUR,ONE(REGFOUR)                              8M3261 13154018
         AR    REGTHREE,REGFOUR        GET TOTAL NO. TRACKS IN   8M3261 13157018
*                                       VTOC                     8M3261 13160018
         SR    REGFIVE,REGFIVE         CLEAR WORK REGISTER       8M3261 13163018
         IC    REGFIVE,DS4DEVDT        GET NUM DSCB'S PER TRACK  8M3261 13166018
         MR    REGTWO,REGFIVE          GET TOTAL NO DSCB'S       8M3261 13169018
         L     REGONE,SEEK                                       8M3261 13172018
         LTR   REGONE,REGONE           DOES VTOC BEGIN ON CYL 0  8M3261 13175018
*                                       TRK 0                    8M3261 13178018
         BNE   SUBTF4                  BRANCH IF NOE ZERO        8M3261 13181018
         LA    REGTWO,THREE                                      8M3261 13184018
         SR    REGTHREE,REGTWO         SUBTRACT VOLUME RECORDS   8M3261 13187018
SUBTF4   BCTR  REGTHREE,REGZERO        SUBTRACT F4               8M3261 13190018
         STH   REGTHREE,DS4DSREC       STORE HOLE COUNT          8M3261 13193018
         XC    SEEK,SEEK                ZERO OUT IOB SEEK ADDR   Y02080 13196002
*                                                                     * 13200018
* THIS SECTION ZEROES OUT EXISTING FORMAT 6 DSCB'S.                   * 13260002
*                                                                     * 13320021
ZEROF6   EQU   *                        BRANCH LABEL             Y02078 13330002
         CLI   DS4F6PTR+FOUR,ZERO       DO F6 DSCB'S EXIST       Y02078 13340002
         BZ    STARTF5                  BRANCH IF NO             Y02078 13350002
         MVC   DADSMADR,DS4F6PTR        MOVE IN CCHHR OF 1ST F6  Y02078 13360002
         MVI   DS4F6PTR,ZERO            ZERO OUT F4 PTR TO F6    Y02078 13370002
         MVC   DS4F6PTR+ONE(FOUR),DS4F6PTR                              13380002
READNEXT LA    REGZERO,CCW4             GET ADDR  READ  CHANNEL PROGRAM 13400018
         ST    REGZERO,CHNPGADR         PUT ADDR IN IOB                 13500018
         MVC   SEEKCYL(FIVE),DADSMADR   PICK UP CCHHR                   13700018
         BAL   RETRNREG,EXCHANPG        READ A FORMAT 6 DSCB     Y02078 13800002
ZEROF5   LA    REGZERO,CCW1             GET ADDR WRITE CHANNEL PROGRAM  13900018
         ST    REGZERO,CHNPGADR         PUT ADDR IN IOB                 14000018
         MVI   CCW6+K4,SKIP             SET SKIP BIT IN READ K&D Y02080 14100002
         BAL   RETRNREG,EXCHANPG        WRITE ZERO RECORD OVER DSCB     14200018
         CLI   DS6PTRDS+FOUR,ZERO       TEST IF LAST FORMAT 6    Y02078 14600002
         BZ    STARTF5                  BRANCH IF YES            Y02078 14700002
         MVC   DADSMADR,DS6PTRDS        MOVE IN CCHHR OF NEXT F6 Y02078 14800002
         MVI   CCW6+K4,NOCC             RESET SKIP BIT           Y02080 14900002
         B     READNEXT                 CONTINUE ZEROING PROCESS        15000018
*                                                                     * 15020021
* THIS SECTION EXECUTES A CHANNEL PROGRAM.                            * 15040021
*                                                                     * 15060021
EXCHANPG MVI   ECB,ZERO                 INITIALIZE ECB                  15100018
         EXCP  IOB                                                      15200018
         WAIT  1,ECB=ECB                                                15300018
         TM    ECB,GOODIO               TEST FOR SUCCESSFUL I/O         15400018
         BCR   1,RETRNREG               RETURN IF OK             A37239 15500002
         LA    RERRPASS,ERRCD           LOAD ERROR CODE                 15600018
ERREXIT  EQU   *                        BRANCH LABEL             Y02078 15610002
         LA    REGTWO,LASTLOAD          POINT TO ID OF IGG0325T  Y02080 15650002
         B     LOADMOD                  BRANCH IF ERROR          Y02080 15700002
*                                                                     * 16800018
* THIS SECTION CALCULATES THE HIGHEST ALLOCATABLE TRACK FROM THE      * 16870021
* DEVICE CHARACTERISTICS TABLE.                                       * 16940021
*                                                                     * 17010021
STARTF5  XC    DSCBF5(C140),DSCBF5     ZERO F5 AREA                     17100018
         L     RCVT,CVTPTR              GET PTR TO CVT                  17500018
         L     RCVT,CVTZDTAB           GET PTR TO DEVICE ENTRY          17600018
*                                       CHARACTERISTICS TABLE           17700018
         L     RUCBPTR,PDLIST5          GET UCB PTR              Y02080 17800002
         CLI   UCBTBYT4,DA3340          TEST IF 3340             Y02130 17805002
         BNE   NOT3340                  BRANCH IF NOT            Y02130 17810002
         MVC   MAXTRK,DS4TKCYL          GET NBR TRACKS/CYLINDER  Y02130 17815002
         SR    REGTWO,REGTWO            CLEAR FOR DIVIDE         Y02130 17820002
         LH    REGTHREE,DS4DEVSZ        NBR OF CYLS ON VOLUME    Y02130 17825002
         LA    REGFOUR,ONE16            4 ALTERNATE TRACKS       Y02130 17830002
         DR    REGTWO,REGFOUR           FOR EVERY 116 CYLINDERS  Y02130 17835002
*                                       SO DIVIDE CYL BY 116,    Y02130 17840002
         SLL   REGTHREE,TWO             MULTIPLY QUOTIENT BY 4   Y02130 17845002
*                                       EQUALS TOTAL ALTERNATES  Y02130 17850002
GETCYLS  EQU   *                        BRANCH LABEL             Y02130 17855002
         LH    REGFOUR,DS4DEVSZ         NBR OF CYLS FOR DEVICE   Y02130 17860002
         B     HIGHTRK                  GO COMPLETE CALCULATION  Y02130 17865002
NOT3340  EQU   *                        BRANCH LABEL             Y02130 17870002
         SR    REGONE,REGONE            CLEAR WORK REGISTER             17900018
         IC    REGONE,UCBTYP+THREE     GET DEVICE TYPE                  18000018
         LA    REGTWO,ZERO(REGONE,RCVT)  GET ADDR OF DEVICE TYPE OFFSET 18100018
         IC    REGONE,ZERO(REGTWO)     GET DEVICE OFFSETINTO DEVICE     18200018
*                                      CHARACTERISTICS TABLE          * 18300018
         LA    REGTWO,ZERO(REGONE,RCVT)  GET ADDR DEVICE ENTRY          18400018
         LH    REGFOUR,ZERO(REGTWO)     GET NO. OF CYLINDERS     Y02080 19600002
         MVC   MAXTRK,TWO(REGTWO)       GET NBR TRACKS/CYLINDER  Y02080 19800002
         CH    REGFOUR,DS4DEVSZ         COMPARE HI CYL         @ZA02214 20000003
         BE    NORMAL                                          @ZA02214 20003003
         LH    REGFOUR,DS4DEVSZ         GET TRK/CYL FROM FMT 4 @ZA02214 20006003
         LH    REGTHREE,DS4NOATK        GET ALT FROM FMT 4     @ZA02214 20009003
         B     HIGHTRK                  USE FMT 4 FOR CALC     @ZA02214 20012003
NORMAL   LH    REGTHREE,TWELVE(REGTWO)  GET NO. ALTERNATE TRACK@ZA02214 20015003
HIGHTRK  EQU   *                        BRANCH LABEL             Y02130 20020002
         MH    REGFOUR,MAXTRK           GET TOTAL NBR OF TRACKS  Y02130 20040002
         CLI   UCBTBYT4,DA2305I         IS DEVICE 2305 MOD 1   @ZA07209 20100003
         BE    SAVEALC                                         @ZA07209 20140003
         CLI   UCBTBYT4,DA2305II        IS DEVICE 2305 MOD 2   @ZA07209 20180003
         BE    SAVEALC                                         @ZA07209 20220003
         SR    REGFOUR,REGTHREE         GET HIGHEST ALOCATABLE TRACK    20260003
SAVEALC  STH   REGFOUR,EXT1RTA1         STORE HIGHEST          @ZA07209 20300003
*                                       ALLOCATABLE TRACK IN NE@ZA07209 20340003
         LA    REGONE,ONE                                               20400018
         STH   REGONE,DS5AVEXT          SUBTRACT VOLUME LABEL TRACK     20500018
*                                                                     * 20600018
* THIS SECTION DETERMINES WHETHER THE VOLUME CONTAINS IPL TEXTS.      * 20700002
*                                                                     * 20800018
         LA    REGZERO,CCW4             GET ADDR READ CHANNEL PROGRAM   20900018
         ST    REGZERO,CHNPGADR                                         21000018
         LA    REGTWO,C24               GET LENGTH IPL BOOTSTRAP RECORD 21100018
         STH   REGTWO,CCW6+SIX          STORE IN READ CCW        Y02080 21200002
         MVI   CCW6,RDDATA              SET TO READ DATA ONLY    Y02078 21300002
         MVI   CCW6+K4,NOCC             DO NOT READ COUNT        Y02080 21400002
         XR    REGZERO,REGZERO          ZERO REGISTER ZERO       Y02080 21450002
         LA    REGONE,ONE               GET CCHHR                       21700018
         STM   REGZERO,REGONE,SEEK      STORE MBBCCHHR                  21800018
         BAL   RETRNREG,EXCHANPG       READ 1ST IPL RECORD              21900018
         CLI   DSCBF1+SIXTEEN,ZERO      IS THIS IPLABLE VOLUME          22000018
         BE    SUBTVTOC                 BRANCH IF NOT IPLABLE           22100018
         LA    REGTWO,C144              GET LENGTH 2ND IPL BOOTSTRAP    22200018
         STH   REGTWO,CCW6+SIX          STORE IN READ CCW               22300002
         LA    REGONE,TWO               GET CCHHR 2ND IPL BOOTSTRAP     22600018
         ST    REGONE,SEEK+FOUR         STORE RECORD NUMBER      Y02080 22700002
         BAL   RETRNREG,EXCHANPG        READ 2ND IPL BOOTSTRAP          22800018
         LH    REGZERO,DSCBF1+C40                                       22900018
         LTR   REGZERO,REGZERO          IS IPL TRACK ZERO               23000018
         BE    SUBTVTOC                 BRANCH IF NO IPL TRACK          23100018
         LA    REGZERO,TWO                                              23200018
         STH   REGZERO,DS5AVEXT         CHANGE BEGIN OF EXTENT IN F5    23300018
*                                                                     * 23320002
* THIS SECTION CONVERTS THE VTOC EXTENT FROM CCHH/CCHH FORMAT         * 23340002
* TO RTA/RTA+1 FORMAT.                                                * 23360002
*                                                                     * 23380002
SUBTVTOC LM    REGZERO,REGONE,CHANPROG+C40 GET CCW6                     23400018
         ALR   REGZERO,RWKAREA          ADD RELOCATION FACTOR           23500018
         STM   REGZERO,REGONE,CCW6      RESTORE CCW6                    23600018
         LA    DADSMPTR,DADSMTBL        GET ADDR DADSMTBL               23700018
         LA    REGSEVEN,TWO             SET UP LOOP COUNT               23800018
         MVC   CCW12+THREE(FOUR),DS4VTOCE+TWO  MOVE IN CCHH      Y02080 23900002
SUBTSEC  LA    REGTWO,CCW12                                             24000018
         LA    REGONE,DEB                                               24100018
         L     RCVT,CVTPTR              GET CVT POINTER                 24200018
         L     RCVT,CVTPRLTV            GET ADDR RESIDENT CCHH TO TTR   24300018
*                                       CONVERT ROUTINE               * 24400018
         STM   REGNINE,REGTHIRT,IECREGSV+TWELVE  SAVE REGISTERS  Y02080 24500002
         LR    REGSIX,RWKAREA           SET UP TEMPORARY BASE REG FOR   24600018
*                                       WORK AREA                     * 24700018
         DROP  RWKAREA                                                  24800018
         USING ALLOCWKA,REGSIX          WORK AREA ADDRESSABILITY Y02080 24900002
         BALR  RETRNREG,RCVT            BRANCH TO CCHH CONVERT RTN      25000018
         LM    REGNINE,REGTHIRT,IECREGSV+TWELVE  RESTORE REGS    Y02080 25100002
         DROP  REGSIX                                                   25200018
         USING ALLOCWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 25300002
         SRA   REGSEVEN,ONE             DECREMENT LOOP COUNT            25400018
         SRL   REGZERO,SIXTEEN          POSITION TT FOR STORING         25500018
         LTR   REGSEVEN,REGSEVEN        HAS UPPER CCHH BEEN CONVERTED   25600018
         BNE   CONT                     BRANCH IF THIS NOT UPPER CCHH   25700018
         LA    REGSIX,ONE                                               25800018
         AR    REGZERO,REGSIX           ADD ONE TO UPPER RTA TO MAKE    25900018
*                                       RTA+1                         * 26000018
CONT     STH   REGZERO,ZERO(DADSMPTR)   STORE RTA OR RTA+1              26100018
         LA    REGZERO,TWO              GET INCREMENT                   26200018
         AR    DADSMPTR,REGZERO         ADD INCREMENT TO DADSMTBL PTR   26300018
         MVC   CCW12+THREE(FOUR),DS4VTOCE+SIX MOVE IN UPPER CCHH Y02080 26400002
         LTR   REGSEVEN,REGSEVEN        MUST UPPER CCHH BE CONVERTED    26500018
         BNE   SUBTSEC                  BRANCH TO CONVERT UPPER CCHH    26600018
*                                                                     * 26620021
* THIS SECTION SUBTRACTS THE VTOC EXTENT FROM THE FORMAT 5 DSCB.      * 26640021
*                                                                     * 26660021
         CLC   DS5AVEXT(TWO),DADSMTBL   DOES THE VTOC BEGIN ON   A37239 26760002
*                                       TRK 0 OR TRK 1 OF CYL 0? A37239 26860021
         BL    CHECK2                   BRANCH IF NOT            A37239 26960002
         MVC   DS5AVEXT(TWO),DADSMT2    UPDATE EXTENT                   27100018
         LA    LSTF5CTR,ONE             INIT CTR EXTENTS IN F5   Y02080 27200002
         B     HOLECNT                  BRANCH TO READ 1ST F5           27300018
CHECK2   CLC   EXT1RTA1(TWO),DADSMT2    IS VTOC AT END OF VOLUME        27400018
         BNE   TWOEXT                   BRANCH IF VTOC NOT AT END PACK  27500018
         MVC   EXT1RTA1(TWO),DADSMTBL   UPDATE UPPER BOUND              27600018
         LA    LSTF5CTR,ONE             INIT CTR EXTENTS IN F5   Y02080 27700002
         B     HOLECNT                  BRANCH TO READ 1ST F5           27800018
TWOEXT   MVC   EXT1RTA1+FIVE(TWO),EXT1RTA1 SUBTRACT                     27900018
         MVC   EXT1RTA1(TWO),DADSMTBL             VTOC                  28000018
         MVC   DS5EXTAV(TWO),DADSMT2                 EXTENT             28100018
         LA    LSTF5CTR,TWO             INIT CTR EXTENTS IN F5   Y02080 28200002
HOLECNT  EQU   *                        BRANCH LABEL             Y02080 28250002
         STH   LSTF5CTR,LSTF5CT         SAVE CTR EXTENTS IN F5   Y02080 28300002
*                                                                     * 28320021
* THIS SECTION INITIALIZES THE CHANNEL PROGRAM TO READ EVERY DSCB.    * 28340002
*                                                                     * 28360021
INITCHPG EQU   *                        BRANCH LABEL             Y02078 28380002
         LA    REGZERO,CCW4             GET ADDR READ CHANNEL PROGRAM   28400018
         ST    REGZERO,CHNPGADR                                         28500018
         MVI   CCW6+K4,CC               CHAIN READ TO READ COUNT Y02080 28600002
         LA    REGZERO,C140             GET LENGTH 140                  28700018
         STH   REGZERO,CCW6+SIX         READ 140 BYTE RECORDS    Y02080 28800002
         MVC   SEEKCYL(FIVE),FMTOUTAD   GET ADDR 1ST F5 DSCB            29000018
         BAL   RETRNREG,EXCHANPG        READ 1ST F5 DSCB                29100018
         MVC   DS4HPCHR,COUNT           INITIALIZE 'HIGH-WATER'  Y02078 29110002
*                                       MARK TO 3RD DSCB IN VTOC Y02078 29120002
         LA    REGONE,ONE                                        Y02078 29130002
         STH   REGONE,F5BLDCT           INITIALIZE TO ONE        Y02078 29140002
         STH   REGONE,F5FNDCT           INITIALIZE TO ONE        Y02078 29150002
         XC    DADSMTBL(C24),DADSMTBL   CLEAR DADSMTBL                  29200018
         MVC   MAXTRK(TWO),DS4TKCYL     GET MAX. TRK NO  ON A CYLINDER  29300018
         LH    REGONE,MAXTRK                                            29400018
         BCTR  REGONE,ZERO              GET MAX. TRK IN ZERO ORIGIN     29500018
*                                       INDEX                         * 29600018
         STH   REGONE,MAXTRK            SAVE ZERO ORIGIN MAX TRK        29700018
         LM    REGZERO,REGONE,ALTCCW3                                   29800018
         ALR   REGZERO,RWKAREA          ADD RELOCATION FACTOR           29900018
         STM   REGZERO,REGONE,CCW3      STORE NEW CCW3                  30000018
         LA    REGTWO,NEXTLOAD          POINT TO ID OF IGG0325P  Y02080 30050002
LOADMOD  EQU   *                        BRANCH LABEL             Y02080 30100002
        IECRES LOAD,EXTPR=(RWKAREA),MODID=(REGTWO),BRANCH=DIRECT Y02080 30150002
*                                                                     * 31200018
*  CONSTANTS                                                          * 31300018
*                                                                     * 31400018
DOSCODE  DC    CL4'DOS'                 CODE=DOS FOR MESSAGE     Y02078 31410002
VTOCMSG  WTO 'IEC604I VTOC CONVERT ROUTINE ENTERED ON UUU,VOLSER,DIRF',X31420002
               ROUTCDE=(4,10),DESC=4,MF=L                        Y02078 31430002
MSGEND   EQU   *                             MSG DELIMITER       Y02078 31440002
*                                                                     * 31450002
* CHANNEL PROGRAM                                                     * 31460002
*                                                                     * 31470002
CCWP1    CCW   X'31',SEEK+3-FIRST,X'40',5    SEARCH EQUAL ID FOR F5     31500018
CCWP2    CCW   X'08',CCW1-FIRST,0,0          TIC BACK TO SEARCH         31600018
CCWP3    CCW   X'0D',CCW2+4-FIRST,X'60',1    WRITE FORMAT 0 DSCB Y02078 31700002
CCWP4    CCW   X'31',SEEK+3-FIRST,X'40',5    SEARCH EQ ID FOR NEXT DSCB 31800018
CCWP5    CCW   X'08',CCW4-FIRST,0,0          TIC BACK TO SEARCH         31900018
CCWP6    CCW   X'0E',DSCBF1-FIRST,0,140        READ KEY AND DATA        32000018
CCWP7    CCW   X'92',COUNT-FIRST,X'20',5     RD 5 BYTES OF COUNT Y02080 32100002
CCWP8    CCW   X'29',CCW2+4-FIRST,X'60',4    SEARCH KEY EQ FOR F0 DSCB  32200018
CCWP9    CCW   X'08',CCW7-FIRST,0,0          TIC TO READ COUNT          32300018
CCWP10   CCW   X'03',0,0,1                   NOP                        32400018
ALTCCW3  CCW   X'0D',DSCBF5-FIRST,X'00',140                             32500018
CHANPROG EQU   CCWP1                                                    32600018
*                                                                     * 33020021
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                       * 33040002
*                                                                     * 33060021
         XCTLTABL ID=(NEXTLOAD,5P,LASTLOAD,5T),SVC=032,LENGTH=,  Y02080X33110002
               BRT=YES                                           Y02080 33160002
         SPACE 2                                                 Y02080 33210002
         IECDSECS CVT,UCB,EXPAND=YES    CVT AND UCB DSECTS       Y02080 33260002
DSCBWKAR IECALLWA EP,F4,D1=(6),D2=(5)   ALLOCATE WORK AREA       Y02078 34600002
DS4TKCYL EQU   DS4DEVSZ+2                                               36000018
EXT1RTA1 EQU   DSCBF5+6                                                 41400018
DADSMT2  EQU   DADSMTBL+2                                               42800018
CHNPGADR EQU   IOB+16                   ADDR. CHANNEL PROGRAM IN IOB    43300018
SEEKCYL  EQU   SEEK+3                                                   43500018
         END                                                            50300018
./  ADD  SSI=61170380,NAME=IGG0553A
 TITLE 'IGG0553A - EXTEND INITIALIZATION'                               00020002
IGG0553A CSECT                                                          00020421
*                                                                       00020502
*MODULE NAME = IGG0553A                                                 00020602
*                                                                       00020702
*DESCRIPTIVE NAME = EXTEND INITIALIZATION                               00020802
*                                                                       00020902
*COPYRIGHT = NONE                                                       00021002
*                                                                       00021502
*CHANGE ACTIVITY = SEE BELOW                                            00021602
*                                                                       00021702
*          VS1 RELEASE 01 DELETIONS                                   * 00022002
*0000                                                            XM5887 00022102
*                                                                     * 00022202
*          VS1 RELEASE 02 DELETIONS/CHANGES                           * 00022302
*0000007686,021500-021600                                        X02989 00022402
*          VS2 RELEASE 01 DELETIONS                                   * 00022502
*0000                                                            YM2930 00022602
*          RELEASE 19 DELETIONS                                       * 00022702
*0853045000                                                      O19117 00022800
*          RELEASE 20 DELETIONS                                       * 00023200
*3034035000                                                      A35385 00023600
*3034000213-000227,021000                                        S20201 00024000
*3034037080,082600,083700,084600-085000,085600                   M4027  00024400
*          RELEASE 21 DELETIONS                                       * 00024800
*1194000340,000600-002600,009800,010800-011000,013600,014400,    S21040 00025200
*1194037080,040000-044000,044960-045040,046600-071400,071900,    S21040 00025600
*1194082500-082600                                               S21040 00026000
*0000079400-080000                                              SA48172 00026302
*1194000205,001040,003200-003400,003800-005200,007600-008200,    M0130  00026400
*1194008800,009700-010600,011600-013000,013400-013800,014600-    M0130  00026800
*1194014800,015200,015600,020414,020428,020463-020484,020600-    M0130  00027200
*1194021200,021600,022000,022200,024400,025400,029800-030000,    M0130  00027600
*1194034600,035000,035400-035420,037000-037020,037800,038000,    M0130  00028000
*1194038100,038600-039000,041800,044400-044600,044880,045140,    M0130  00028400
*1194045180-046000,046400-072200,084000,085800,087000-087620,    M0130  00028800
*1194088400-091200,091800-092200,095400                          M0130  00029200
*          RELEASE 21.7 DELETIONS                                       00031202
*0000000296-000300,016000,025200,025800,028600,028800,          SA53147 00033202
*0000084600-085600                                              SA53147 00033602
*          RELEASE 22 DELETIONS                                       * 00035202
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00037202
*0000000205,000217,001040,001440-001640,003300-003500,003620,    Y02080 00037302
*0000004100-004300,007385-007460,007494-008209,008293,008800,    Y02080 00037402
*0000009400-009600,009900-010000,010200,011400,013300-013900,    Y02080 00037502
*0000013940-014192,015000-016100,016200-019900,020000-020400,    Y02080 00037602
*0000020530-020660,020860,021500-021800,021960-022050,022250-    Y02080 00037702
*0000023400,024300-028400,028600,028740-029200,030400-035400,    Y02080 00037802
*0000036600-036660-036980,037064-037120,037260-037356,038100,    Y02080 00037902
*0000038400-039800,042200,043400,044500,045120-045360,045760-    Y02080 00038002
*0000045960,073000,074000,074800,075400,075800,076800,077800,    Y02080 00038102
*0000078200,078600,079600,080600,081000,081400,082400,083200,    Y02080 00038202
*0000084060-084200,084500,084600-088000,089200,091800-093800,    Y02080 00038302
*0000094600-755200                                               Y02080 00038402
*0000001540,009900-010000,041000                                 Y02078 00038502
*0000000030-000150,036846-036908,036936-036956,037023,037055     Y02082 00038602
*0000012000-012200,023600-023800                                 Y02144 00038702
*0000                                                            Y02072 00038802
*0000                                                            YM3047 00039202
*0000023000,028520-028562,084600                                 YM3997 00039602
*0000028564                                                      YM6546 00039802
*0000                                                            YM5371 00040602
*0000013600-013800                                               XM2969 00040802
*                                                                       00044104
*   EXTENDED MVS CVOL SUPPORT                                  @Z40CSRC 00046104
*                                                                     * 00047704
*STATUS CHANGE LEVEL 008                                              * 00051004
*                                                                     * 00054304
* THIS MODULE SPLIT INTO IGG0553G IN RELEASE 21                       * 00057604
*                                                                     * 00060904
*FLAG DESCRIPTION                                                  MC1E 00064204
*   MC1E - ELIMINATION OF THE F1 SEARCH WHILE EXTENDING ON         MC1E 00067504
*          THE SAME VOLUME.                                        MC1E 00070804
*                                                                  MC1E 00074104
*FUNCTION/OPERATION:                                                  * 00077404
*   THIS MODULE IS THE ENTRY POINT FOR EXTEND (SECONDARY SPACE        * 00080704
*   ALLOCATION).  IT PERFORMS THE FOLLOWING FUNCTIONS:                * 00084021
*   - GOES TO RESIDENT CONVERT ROUTINE TO GET CCHHR FOR THE VTOC.     * 00094021
*   - OBTAINS THE EXTEND WORK AREA.                                   * 00104002
*   - ISSUES IECRPS TO INITIALIZE FOR RPS PROCESSING.                 * 00106002
*   - ISSUES AN ENQ WITH THE SET-MUST-COMPLETE OPTION FOR THE VTOC.   * 00114021
*   - EXECUTES A CHANNEL PROGRAM TO READ IN THE FORMAT 4 AND IF       * 00124021
*     EXTENDING ON A NEW VOLUME TO PERFORM A DUPLICATE NAME SEARCH.   * 00134021
*   - IF A DUPLICATE NAME EXISTS ON THE NEW VOLUME, GOES TO IGG0553E. * 00144002
*   - IF THE FORMAT 4 HAS THE DOS OR DIRF BIT ON, GOES TO IGG0553F.   * 00154002
*   - OTHERWISE BRANCH TO IGG0553G TO CONTINUE PROCESSING.            * 00164002
*                                                                     * 00280000
*ENTRY POINTS:                                                        * 00300000
*   IGG0553A - ENTRY MADE FROM END OF VOLUME OR FROM VSAM CATALOG.    * 00330002
*                                                                     * 00360000
*INPUT:                                                               * 00370021
*   UPON ENTRY TO THIS MODULE, REGISTER 13 WILL CONTAIN ONE OF THE    * 00380021
*   FOLLOWING ENTRY CODES:                                            * 00390021
*        1 - EOV ENTRY TO EXTEND ON THE LAST (CURRENT) VOLUME         * 00400021
*        2 - CVOL CATALOG ENTRY TO EXTEND AN OS CATALOG               * 00410002
*        4 - EXTEND ENTRY TO EXTEND ON A NEW VOLUME                   * 00420021
*      129 - VSAM CATALOG ENTRY TO EXTEND AN EXISTING VSAM            * 00422002
*            DATA SPACE                                               * 00424002
*   REGISTER 4 POINTS TO THE I/O SUPPORT WORK AREA.                   * 00440021
*   REGISTER 5 POINTS TO THE USER'S DEB.                              * 00450021
*   REGISTER 10 POINTS TO THE UCB.                                    * 00460021
*   THE I/O SUPPORT WORK AREA IS LAID OUT AS FOLLOWS:                 * 00470021
*                                                                     * 00480021
*          BYTES          AREA                                        * 00540000
*         *******        ******                                       * 00560000
*          100           DSCB FIELD                                   * 00580000
*          176           JFCB                                         * 00600000
*            4           ECB                                          * 00620000
*           40           IOB                                          * 00640000
*           44           DEB                                          * 00660000
*            4           DCB                                          * 00680000
*           96           CCW'S                                        * 00700000
*                                                                     * 00748000
*OUTPUT:                                                              * 00822100
*   THE I/O SUPPORT WORK AREA WILL CONTAIN THE DATA PORTION OF THE    * 00825700
*   FORMAT 4 DSCB.  THE EXTEND WORK AREA WILL CONTAIN THE ADDRESSES   * 00829302
*   OF THE FORMAT 4 AND FORMAT 5 DSCB'S.                              * 00830002
*                                                                     * 00840000
*EXTERNAL ROUTINES:                                                   * 00860000
*        IECRES  - GET CORE FOR THE EXTEND WORK AREA                  * 00880002
*        EXCP(0) - READ OR WRITE A DIRECT ACCESS DEVICE               * 00900000
*        WAIT(1) - WAIT ON EVENT CONTROL BLOCK                        * 00920000
*        RESERVE(56) - ENQ ON THE VTOC                                * 00960002
*                                                                     * 00970021
*EXITS:                                                               * 00980021
*   NORMAL - BRANCH TO IGG0553F IF EXTENDING ON A VOLUME ON WHICH     * 00990002
*            THE DOS AND/OR DIRF BIT IS SET.                          * 00995002
*            BRANCH TO IGG0553G OTHERWISE.                            * 01000002
*                                                                     * 01010021
*   ERROR  - BRANCH TO IGG0553E WITH THE ENTRY CODE IN REGISTER 13    * 01020002
*   ERRORS MAY BE:  I/O ERROR, DUPLICATE NAME ON NEW VOLUME, OR       * 01090002
*                   DOS STACKED PACK.                                 * 01100002
*                                                                     * 01120000
*ATTRIBUTES: REENTRANT                                                * 01140002
*                                                                     * 01160021
*OTHER MACROS USED:                                                   * 01180021
*   IECDSECS - TO EXPAND THE CVT, PSA, RRPL, AND UCB DSECTS           * 01220002
*   IECDSECT - TO DEFINE THE I/O SUPPORT WORK AREA                    * 01240021
*   IECEXTWA - TO DEFINE THE EXTEND WORK AREA                         * 01250002
*   IECSDSL1 - TO SYMBOLICALLY ADDRESS DSCB'S                         * 01260021
*   IECRPS - GENERATES CODE TO INITIALIZE FOR RPS PROCESSING          * 01310002
*                                                                     * 01320000
*STORAGE: PROGRAM CODE CSECT - LESS THAN 1024 BYTES                   * 01340002
*         EXTEND WORK AREA - AS DEFINED IN THE IECEXTWA MACRO    XM2969 01360002
*         RPS WORK AREA - LENGTH IS DEFINED IN THE IECRPS MACRO  XM2969 01380002
*         I/O SUPPORT WORK AREA                                       * 01400002
*                                                                       01420000
         BALR  RBASE,K0                 ESTABLISH BASE REG       Y02080 01500002
         USING BEGIN,RBASE                                       Y02080 01520002
         USING EOVWKA,RCORE             EOV W/A ADDRESSABILITY   Y02080 01540002
         USING EXTNDWKA,EXWKA                                    Y02080 01560002
         USING UCB,RUCB                 UCB ADDRESSABILITY       Y02080 01580002
*                                                                       01612021
* REGISTER EQUATES                                                      01614021
*                                                                       01616021
REG0     EQU   0                        EQUATE FOR REGISTER 0    Y02080 01620002
REG1     EQU   1                        EQUATE FOR REGISTER 1    Y02080 01640002
REG2     EQU   2                        EQUATE FOR REGISTER 2    Y02080 01660002
RBASE    EQU   3                        BASE REGISTER            Y02080 01680002
RCORE    EQU   4                        EOV WORK AREA POINTER    Y02080 01700002
REG5     EQU   5                        EQUATE FOR REGISTER 5    Y02080 01720002
RDEB     EQU   5                        DEB POINTER              Y02080 01740002
REG6     EQU   6                        EQUATE FOR REGISTER 6    Y02080 01760002
REG7     EQU   7                        EQUATE FOR REGISTER 7    Y02080 01820002
ALTWKA   EQU   7                        ALTERNATE WORK AREA PTR  Y02080 01830002
REG8     EQU   8                        EQUATE FOR REGISTER 8    Y02080 01840002
REG9     EQU   9                        EQUATE FOR REGISTER 9    Y02080 01890002
RUCB     EQU   10                       UCB POINTER              Y02080 01920002
EXWKA    EQU   11                       EXTEND WORK AREA POINTER Y02080 01940002
REG12    EQU   12                       EQUATE FOR REGISTER 12   Y02080 01960002
RCODE    EQU   13                       EXTEND CODE REGISTER     Y02080 01980002
REG13    EQU   13                       EQUATE FOR REGISTER 13   Y02080 01990002
RETNREG  EQU   14                                                       02020000
REG15    EQU   15                       EQUATE FOR REGISTER 15   Y02080 02040002
*                                                                       02040721
* OTHER EQUATES                                                         02041421
*                                                                       02042121
DOSBIT   EQU   X'80'                    DOS VTOC BIT             S21040 02043521
K0       EQU   0                        CONSTANT OF 0            Y02080 02043602
K2       EQU   2                        CONSTANT OF 2            Y02080 02044002
K3       EQU   3                        CONSTANT OF 3            S21040 02044221
K4       EQU   4                        CONSTANT OF 4            Y02080 02044602
K7       EQU   7                        CONSTANT OF 7            S21040 02044921
K8       EQU   8                        CONSTANT OF 8            S21040 02045621
K12      EQU   12                       CONSTANT OF 12           Y02080 02047002
DIRFBIT  EQU   X'04'                    VTOC INTERRUPT BIT       O19117 02050019
DOSSTKPK EQU   X'10'                    DOS STACKED PACK         Y02072 02053002
STACKERR EQU   X'08'                    DOS STACKED PACK FORMAT  Y02072 02056002
CC       EQU   X'40'                    CCW COMMAND CHAINING BIT Y02080 02059002
SAMEVOL  EQU   X'01'                    EXTENDING ON SAME VOLUME M0130  02076021
CATALOG  EQU   X'02'                    EXTENDING AN OS CATALOG  YM3047 02086002
NEWVOL   EQU   X'04'                    EXTENDING ON NEW VOLUME  M0130  02096021
VSAMID   EQU   X'81'                    ENTRY FROM VSAM          Y02080 02100002
RPSMSK   EQU   X'10'                    INDICATES RPS DEVICE     A53147 02106002
*                                       IN UCBTBYT2              A53147 02116002
*                                                                       02140000
* THIS SECTION PREPARES TO SAVE THE CALLER'S REGISTERS 2 AND 4 - 12     02150002
* IN THE SVRB EXTENDED SAVE AREA.                                       02160002
*                                                                       02170002
BEGIN    EQU   *                                                 M0130  02188021
         STC   RCODE,DXEXTSW            SAVE THE ENTRY CODE      Y02080 02196002
         LA    RCORE,0(RCORE)           ZERO HIGH ORDER BYTE     Y02080 02205002
*                                         SO CHANNEL PROGRAM WILL       02210021
*                                         BE RELOCATED CORRECTLY        02215021
         L     REG15,CVTPTR             LOAD CVT ADDRESS         Y02080 02220002
         USING CVT,REG15                BASE FOR CVT             Y02080 02225002
         L     REG15,CVTTCBP            LOAD TCB DW ADDRESS      Y02080 02230002
         L     REG15,K4(,REG15)         LOAD TCB ADDRESS         Y02080 02235002
         L     RETNREG,0(,REG15)        LOAD SVRB ADDRESS        Y02080 02240002
         MODESET EXTKEY=ZERO            SWITCH TO KEY 0 BEFORE   Y02082X02245002
                                        SAVING REGISTERS IN SVRB Y02082 02250002
*                                                                       02255002
* THIS SECTION OBTAINS THE EXTEND WORK AREA AND SAVES THE REGISTERS.    02260002
*                                                                       02265002
         IECRES GET,PREFIX=FIRST,LV=EWALNGTH,ID=EXWA,            Y02080X02270002
               STM=(REG2,REG12,96(RETNREG))  OBTAIN WORK AREA    Y02080 02275002
*                                       IGG0553A IS NOW RUNNING  Y02082 02280002
*                                       IN DATAMGT KEY AFTER     Y02082 02285002
*                                       ISSUING THE IECRES GET   Y02082 02290002
         LR    EXWKA,REG1               SET UP BASE REGISTER     Y02080 02295002
         MVC   WTGMODNM,FIRSTLD         MOVE IN MODULE NAME      YM5371 02297002
*                                                                       02302002
         CLI   DXEXTSW,CATALOG          TEST IF ENTRY FROM OS    YM3047X02304002
                                        CVOL CATALOG             YM3047 02306002
         BE    PRNTNAME                 BRANCH IF YES            YM3047 02308002
         CLI   DXEXTSW,VSAMID           TEST IF ENTRY FROM VSAM  Y02080 02310002
         BNE   INITRRPL                 BRANCH IF NOT            Y02080 02315002
PRNTNAME EQU   *                        PRINT THIS MODULE'S NAME YM3047 02317002
         IECRES LOAD,EXTPR=(EXWKA),MODNM=FIRSTLD,BRANCH=NO       Y02080X02320002
                                        LET OPTIONAL TRACE PRINT Y02080X02325002
                                        THIS MODULE'S NAME       Y02080 02330002
*                                                                       02335002
INITRRPL EQU   *                        INITIALIZE RECOVERY RTN  Y02080 02340002
         L     REG1,IECRRPRM            RECOVERY RTN LIST ADDR   Y02144 02345002
         USING RRPLIST,REG1             PARM LIST ADDRESSABILITY Y02144 02350002
         OI    RRFUNCTN,RRFEXTND        SET EXTEND FUNCTION BIT  Y02144 02355002
         ST    RUCB,RRUCBPTR            SAVE UCB ADDRESS         Y02144 02360002
         DROP  REG1                                              Y02144 02365002
*                                                                       02370002
         XC    ECB,ECB                  SET ECB TO ZERO          Y02144 02380002
         MVC   DEB+38(4),ECB            SET BEGINNING ADDRESS TO ZEROS  02400000
         MVC   DEB+42(6),ALLFS          SET END OF DEB EXTENT           02420000
*                                                                       02842002
* THIS SECTION INTIALIZES FOR RPS PROCESSING.                           02842502
*                                                                       02843002
         TM    UCBTBYT2,RPSMSK          EXTENDING ON RPS DEVICE  A53147 02844002
         BNO   NORPS                    NO, BYPASS RPS           A53147 02846002
*                                       INITIALIZATION           A53147 02848002
         LA    REG9,DEB                 LOAD PTR TO DEB          Y02080 02850002
         IECRPS RDEB=REG9,WKREG1=REG8,EXTPR=EXWKA  INITIALIZE    YM3997X02852002
                                        FOR RPS PROCESSING       YM3997 02854002
*                                                                       02855002
         MVC   WTGMODNM,FIRSTLD         RESTORE MODULE NAME      YM5371 02855202
         CLI   DXEXTSW,CATALOG          TEST IF ENTRY FROM OS    YM6546X02855402
                                        CVOL CATALOG             YM6546 02855602
         BE    NORPS                    BRANCH IF YES            YM6546 02855802
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY    YM6546X02856002
                                        IF EOV OR VSAM CATALOG   YM6546 02856202
*                                                                       02856502
* THIS SECTION USES THE RESIDENT CONVERT ROUTINE TO CALCULATE VTOCADR.  02857002
*                                                                       02857502
NORPS    EQU   *                                                 A53147 02858002
         STM   REG9,REG13,IECREGSV+K12  SAVE REGISTERS           Y02080 02859002
         LA    REG2,SEEK                POINT TO CONVERSION AREA Y02080 02859502
         L     REG0,SRTEFSCT            LOAD TTR FROM UCB        Y02080 02860002
         MVC   MINOR(6),SRTEVOLI       SAVE VOLUME SERIAL NUMBER   AAAA 02870016
         L     REG15,CVTPTR             LOAD CVT ADDRESS         Y02080 02880002
         L     REG15,CVTPCNVT           LOAD CONVT ROUTINE ADDR  Y02080 02890002
         LA    REG1,DEB                 SET POINTER TO DEB       Y02080 02900002
         LR    ALTWKA,EXWKA             SAVE EXTEND W/A ADDRESS  Y02080 02910002
         BALR  RETNREG,REG15            GO TO CONVERT ROUTINE    Y02080 02920002
         LM    REG9,REG13,IECREGSV+K12-EXTNDWKA(ALTWKA)  RESTORE Y02080 02930002
         MVC   VTOCADR(5),SEEK+3   SET UP VTOC ADDRESS                  02940000
*                                                                       02960000
* THIS SECTION RELOCATES THE CHANNEL PROGRAM TO READ IN THE             02980021
* FORMAT 4 DSCB AND TO PERFORM A DUPLICATE NAME SEARCH.                 03000021
*                                                                       03020000
         LR    REG2,RDEB                SAVE THE DEB ADDRESS     Y02080 03030002
         LM    REG5,RUCB,CHANPROG       LOAD FIRST 3 CCW'S       Y02080 03040002
         ALR   REG5,EXWKA                                        Y02080 03060002
         ALR   REG7,RCORE                                        Y02080 03080002
         ALR   REG9,RCORE                                        Y02080 03100002
         STM   REG5,RUCB,DXCCW1         STORE FIRST 3 CCW'S      Y02080 03120002
         LM    REG5,RUCB,CCW4           LOAD NEXT 3 CCW'S        Y02080 03140002
         ALR   REG5,EXWKA                                        Y02080 03160002
         ALR   REG7,RCORE                                        Y02080 03180002
         ALR   REG9,RCORE                                        Y02080 03200002
         STM   REG5,RUCB,DXCCW4         STORE NEXT 3 CCW'S       Y02080 03220002
         LM    REG5,RUCB,CCW7           LOAD NEXT 3 CCW'S        Y02080 03240002
         ALR   REG5,RCORE                                        Y02080 03260002
         ALR   REG7,RCORE                                        Y02080 03280002
         ALR   REG9,RCORE                                        Y02080 03300002
         STM   REG5,RUCB,DXCCW7         STORE NEXT 3 CCW'S       Y02080 03320002
         LM    REG5,RUCB,CCW10          LOAD LAST 3 CCW'S        Y02080 03340002
         ALR   REG5,RCORE                                        Y02080 03360002
         ALR   REG7,RCORE                                        Y02080 03380002
         ALR   REG9,EXWKA                                        Y02080 03400002
         STM   REG5,RUCB,DXCCW10        STORE LAST 3 CCW'S       Y02080 03420002
         LR    RDEB,REG2                RESTORE DEB ADDRESS      Y02080 03430002
*                                                                       03560000
* THIS SECTION PERFORMS ENQ ON CURRENT VTOC                             03580000
*                                                                       03600000
         MVC   MAJOR(8),VTOCNAME        MOVE SYSVTOC TO WORK AREA       03620000
         MVI   ENQAREA,X'FF'            SET START OF TABLE FOR ENQ      03640000
         SR    REG1,REG1                ZERO REGISTER            Y02080 03650002
         STH   REG1,ENQAREA+K2          CLEAR FOR RESERVE MACRO  Y02080 03660002
         RESERVE (MAJOR,MINOR,E,6,SYSTEMS),                      YM3022X03665002
               MF=(E,ENQAREA),UCB=DXDEBUCB                       Y02080 03670002
*                                                                       03675002
         OI    DSMADTB2,DSMVTOCR        SET VTOC ENQ'ED SWITCH   Y02144 03680002
*                                                                       03685002
         TM    DXEXTSW,SAMEVOL          EXTENDING ON SAME VOLUME Y02080 03690002
         BZ    EXECUT                   BRANCH IF NOT            Y02080 03695002
         LA    REG15,0(RDEB)            LOAD DEB ADDRESS         Y02080 03700002
         SH    REG15,K16                SET PTR TO DEB PREFIX    Y02080 03705002
         MVC   COUNT,K3(REG15)          OBTAIN F1 CCHHR FROM DEB Y02080 03710002
         NI    DXCCW4+K4,X'FF'-CC       ELIMINATE F1 SEARCH      Y02080 03715002
*                                                                       03720002
EXECUT   EQU   *                        BRANCH LABEL             Y02080 03725002
         EXCP  IOB                      EXECUTE CHANNEL PROGRAM  Y02080 03730002
         WAIT  1,ECB=ECB                                                03740000
         TM    ECB,X'20'                CHECK FOR PERMANENT I/O ERROR   03760000
         BZ    ERREXIT                  BRANCH IF I/O ERROR      M0130  03770021
         TM    DXCCW3+4,X'40'           LAST I/O WAS FOR         O19117 03781019
         BZ    WRCOMP                     WRITING F4             O19117 03782019
         XI    DS4VTOCI,DIRFBIT         SET/RESET DIRF BIT       O19117 03783019
         TM    DS4VTOCI,DOSSTKPK        PACK IN STACKED FORMAT?  Y02072 03783302
         BO    STKERR                   YES - ERROR              Y02072 03783902
         TM    DS4VTOCI,DIRFBIT         TEST RESULTS             O19117 03784019
         BZ    SKIPWR                   BR IF PREVIOUS INTERRUPT O19117 03785019
         MVI   DXCCW3,X'05'             SET WR DATA CMMD         O19117 03786019
         MVI   DXCCW3+4,X'00'           RESET CMMD CHAIN         O19117 03787019
         B     EXECUT                   GO WRITE BACK F4         O19117 03788019
WRCOMP   EQU   *                                                 O19117 03789019
         MVI   DXCCW3,X'06'             RESTORE RD DATA CMMD     O19117 03790019
         MVI   DXCCW3+4,X'40'           RESTORE CMMD CHAIN       O19117 03791019
SKIPWR   EQU   *                                                 O19117 03792019
         OI    DXCCW4+4,X'40'   TURN ON COMM CHAIN FLAG            MC1E 03805018
         TM    DXEXTSW,SAMEVOL          EXTENDING ON SAME VOLUME Y02080 03810002
         BO    GOAHEAD   YES,CCHHR ALREADY SET UP                  MC1E 03815018
         CLI   COUNT+4,X'00'            TEST FOR DUPLICATE NAME         03820000
         BE    GOAHEAD                  NO, SKIP NEW VOL TEST  @Z40CSRC 03840004
         TM    DXEXTSW,NEWVOL           EXTENDING ON NEW VOL   @Z40CSRC 03860004
         BO    ERREXIT                  BRANCH IF NEW VOLUME   @Z40CSRC 03880004
*                                                                       03882004
*   UPDATE CCHHR FOR A SYSCTLG (CVOL) F1 DSCB                           03884004
*                                                                       03886004
         SR    REG12,REG12              CLEAR REGISTER         @Z40CSRC 03900004
         IC    REG12,COUNT+K4           GET R OF F1 CCHHR      @Z40CSRC 03920004
         BCT   REG12,STORER             DECR AND TEST FOR 0    @Z40CSRC 03940004
         IC    REG12,DS4DEVDT           SET TO LAST REC ON TRK @Z40CSRC 03960004
STORER   EQU   *                        UPDATE F1 CCHHR        @Z40CSRC 03980004
         STC   REG12,COUNT+K4           SET UP R OF F1 CCHHR   @Z40CSRC 04000004
*                                                                       04002004
GOAHEAD  EQU   *                                                 S21040 04020021
         TM    DS4VTOCI,DOSBIT          TEST FOR DOS VOL         S21040 04060021
         BO    DOSPAK                   BRANCH IF DOS BIT SET    Y02078 04070002
         TM    DS4VTOCI,DIRFBIT         TEST IF DIRF BIT WAS     Y02078 04080002
*                                       PREVIOUSLY SET           Y02078 04090002
         BO    PASTDOS                  BRANCH IF NOT            Y02078 04100002
DOSPAK   EQU   *                                                 S21040 04140021
         LA    REG9,DOSLOAD             POINT TO IGG0553F        Y02080 04220002
         B     PREPXCTL                 GO XCTL                  S21040 04260021
PASTDOS  EQU   *                                                 S21040 04300021
         LA    REG9,NEXTLOAD            POINT TO IGG0553G        Y02080 04340002
         B     PREPXCTL                                          S21040 04380021
STKERR   EQU   *                        BRANCH LABEL             Y02072 04390002
         OI    DXEXTSW,STACKERR         TURN ON UNCONVERTIBLE    Y02072 04400002
*                                       VTOC INDICATOR           Y02072 04410002
*                                                                       04420000
* THIS SECTION BRANCHES TO ANOTHER MODULE.                              04450002
*                                                                       04480000
ERREXIT  EQU   *                                                 M0130  04490021
         LA    REG9,LASTLOAD            POINT TO IGG0553E        Y02080 04512002
         SR    RCODE,RCODE        CLEAR ERROR REG          S21040       04516002
         IC    RCODE,DXEXTSW            PICK UP ENTRY CODE       Y02080 04536002
PREPXCTL EQU   *                                                 M0130  04556021
         IECRES LOAD,EXTPR=(EXWKA),MODNM=(REG9),BRANCH=DIRECT    Y02080 04570002
*                                                                       04620000
* CHANNEL PROGRAM                                                       05220021
*                                                                       05820021
         DS    0F                                                M0130  06420021
CHANPROG EQU   *                                                        07240000
*CCW1                                                                   07260000
         DC    X'31'                    SEARCH EQUAL ID FOR VTOC DSCB   07280000
         DC    AL3(0+VTOCADR-EXTNDWKA)  SEARCH ARG ADDR          Y02080 07300002
         DC    X'4000'                                                  07320000
         DC    H'5'                                                     07340000
*CCW2                                                                   07360000
         DC    X'08'                    TIC BACK TO SEARCH              07380000
         DC    AL3(0+DXCCW1-DXLBL)      TIC ADDR                 Y02080 07400002
         DC    F'0'                                                     07420000
*CCW3                                                                   07440000
         DC    X'06'                    READ DATA FOR VTOC DSCB         07460000
         DC    AL3(0+DS4IDFMT-DXLBL)    BUFFER ADDR              Y02080 07480002
         DC    X'4000'                                                  07500000
         DC    H'96'                                                    07520000
CCW4     EQU   *                        CCW4                     Y02080 07540002
         DC    X'92'                    READ COUNT OF FORMAT 5          07560000
         DC    AL3(EDADSMAD-EXTNDWKA)   BUFFER ADDR              Y02080 07580002
         DC    X'6000'                                                  07600000
         DC    H'5'                                                     07620000
*CCW5                                                                   07640000
         DC    X'F1'                    SEARCH EQ OR HIGH FORMAT 1      07660000
         DC    AL3(0+DS4HPCHR-DXLBL)    SEARCH ARG ADDR          Y02080 07680002
         DC    X'4000'                                                  07700000
         DC    H'5'                                                     07720000
*CCW6                                                                   07740000
         DC    X'08'                    TIC TO CCW10                    07760000
         DC    AL3(DXCCW10-DXLBL)       TIC ADDR                 Y02080 07780002
         DC    F'0'                                                     07800000
CCW7     EQU   *                        CCW7                     Y02080 07820002
         DC    X'A9'                                                    07840000
         DC    AL3(JFCBDSNM-DXLBL)      SEARCH FOR THIS NAME     Y02080 07860002
         DC    X'6000'                                                  07880000
         DC    H'44'                                                    07900000
*CCW8                                                                   07920000
         DC    X'06'                    READ DATA OF THE LAST   SA48172 07940002
         DC    AL3(0+DS4IDFMT-DXLBL)    FORMAT 1 WITH THE SKIP   Y02080 07960002
         DC    X'3000'                  BIT SET IN ORDER TO END SA48172 07980002
         DC    H'96'                    THE CHANNEL PROGRAM.    SA48172 08000002
*CCW9                                                                   08020000
         DC    X'08'                    TIC TO CCW12                    08040000
         DC    AL3(DXCCW12-DXLBL)       TIC ADDR                 Y02080 08060002
         DC    F'0'                                                     08080000
CCW10    EQU   *                        CCW10                    Y02080 08100002
         DC    X'A9'                    SEARCH EQ KEY FOR DATA SET      08120000
         DC    AL3(JFCBDSNM-DXLBL)      SEARCH ARG ADDR          Y02080 08140002
         DC    X'6000'                                                  08160000
         DC    H'44'                                                    08180000
*CCW11                                                                  08200000
         DC    X'08'                    TIC TO CCW5                     08220000
         DC    AL3(DXCCW5-DXLBL)        TIC ADDR                 Y02080 08240002
         DC    F'0'                                              S21040 08260021
*CCW12                                                                  08280000
         DC    X'12'                    READ COUNT - CCHHR FOR F1+1     08300000
         DC    AL3(0+COUNT-EXTNDWKA)    BUFFER ADDR              Y02080 08320002
         DC    X'2000'                                                  08340000
         DC    H'5'                                                     08360000
*                                                                       08362021
* CONSTANTS                                                             08364021
*                                                                       08366021
K16      DC    H'16'                                             S21040 08370021
ALLFS    DC    X'FFFFFFFF7FFF'          END OF DEB EXTENT               08380000
VTOCNAME DC    C'SYSVTOC '              ENQ MAJOR NAME                  08440000
*                                                                       08445021
* TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                       08450002
*                                                                       08455021
         XCTLTABL ID=(LASTLOAD,IGG0553E,DOSLOAD,IGG0553F,        Y02080X08457002
               NEXTLOAD,IGG0553G,FIRSTLD,IGG0553A,               YM3997X08460002
               RPS19EK,IGG019EK),                                YM3997X08462002
               SVC=055,LENGTH=,BRT=YES                           Y02080 08463002
         SPACE 2                                                 Y02080 08570002
         IECDSECS CVT,RRPL,UCB,EXPAND=YES                        Y02144 08600002
WORKAREA IECEXTWA EP,ADT=YES            EXTEND WORK AREA         Y02144 08700002
VTOCADR  EQU   EVTOCADR                 EQUATE FOR VTOCADR       Y02080 08710002
COUNT    EQU   ECOUNT                   EQUATE FOR COUNT         Y02080 08720002
         EJECT                                                   Y02080 08750002
EOVWKA   DSECT                          EOV WORK AREA            Y02080 08800002
         IECDSECT                                                       08820000
         EJECT                                                   Y02080 08920002
         ORG   DXLBL                                                    09140000
         IECSDSL1 (4)                                                   09160000
ECB      EQU   DXECB                                                    09400000
DEB      EQU   DXDEB                                                    09420000
IOB      EQU   DXIOB                                                    09440000
SEEK     EQU   DXDAADDR                                          M0130  09450021
ENQAREA  EQU   DXLBL                    ENQ PARAMETER LIST       Y02080 09500002
MAJOR    EQU   ENQAREA+16               MAJOR NAME ADDRESS       Y02080 09520002
MINOR    EQU   ENQAREA+24               MINOR NAME ADDRESS       Y02080 09530002
         END                                                            78520021
./  ADD  SSI=32510343,NAME=IGG0553B
 TITLE 'IGG0553B - EXTEND - SPACE SEARCH ROUTINE'                       00020000
IGG0553B CSECT                                                          00022021
*                                                                       00022502
*MODULE NAME = IGG0553B                                                 00023002
*                                                                       00023502
*DESCRIPTIVE NAME = EXTEND - SPACE SEARCH ROUTINE                       00023602
*                                                                       00023702
*COPYRIGHT = NONE                                                       00023802
*                                                                       00023902
*CHANGE ACTIVITY = SEE BELOW                                            00024402
*                                                                       00024502
*          RELEASE 22 DELETIONS                                       * 00024902
*          RELEASE 21 DELETIONS                                       * 00026021
*1394075440-075560,095000                                        M0050  00030021
*1394000400,000600,001600-004200,012000,013800-015200,016000-    M0130  00032021
*1394016400,016800-018000,018400,018800,023600,033400,043200-    M0130  00034021
*1394043400,046800,049600-050200,051200-051600,076000,087600,    M0130  00036021
*1394088400-089400,090200-092800,093400-093800,096600            M0130  00038021
*0000032000-032200,038400                                        M2281  00040021
*0000034800                                                     SA54497 00042021
*          RELEASE 20 DELETIONS                                       * 00044021
*1463                                                            M6099  00050020
*        VS2 RELEASE 02 DELETIONS/CHANGES                             * 00051002
*0000000030-000150,002360,002460,003800-004934,013400,014200,    Y02080 00051102
*0000014800,015600,016700-018680,019000-023400,024520-029800,    Y02080 00051202
*0000030800,032000-033400,033800-034400,035800-036200,036600,    Y02080 00051302
*0000037000-038800,040200-041000,041400-042000,043000-044400,    Y02080 00051402
*0000045400-045800,046200,047200-048000,049000,050400,052000,    Y02080 00051502
*0000052400-052600,053000,054000-054200,056000,056400-056800,    Y02080 00051602
*0000057200-058000,058400-059400,059800-060000,061000,062200-    Y02080 00051702
*0000062800,064000-066200,066600-067400,067800-068000,068600-    Y02080 00051802
*0000069200,069600-072000,072400-073200,073600-074200,074600-    Y02080 00051902
*0000074800,075260,075600,076200-076400,077400,078400,079400,    Y02080 00052002
*0000080400,081200,082200,083200,084000,085000,086000,086800,    Y02080 00052102
*0000087400,087600-089800,091000,093400-756400                   Y02080 00052202
*                                                                     * 00054002
* STATUS CHANGE LEVEL  003                                              00055021
*                                                                     * 00061021
*FUNTION/OPERATION:                                                   * 00067021
*   THIS MODULE READS IN THE FIRST FORMAT 5 DSCB AND SEARCHES IT      * 00073021
*   FOR AVAILABLE EXTENTS THAT WILL FILL THE SECONDARY REQUEST. A     * 00080000
*   PUSH DOWN LIST OF UP TO FIVE ENTRIES IS BUILT UNTIL AN AVAILABLE  * 00100000
*   EXTENT IS FOUND THAT IS EQUAL OR GREATER THAN THE REQUEST. THE    * 00120000
*   EXTENT CLOSEST IN SIZE TO THE REQUEST IS HELD AND NEW EXTENTS ARE * 00140000
*   COMPARED AGAINST THIS EXTENT. WHEN THE PREFERRED EXTENT IS        * 00148021
*   ENCOUNTERED AND THERE IS SUFFICIENT SPACE TO FULFILL THE REQUEST, * 00156021
*   THE PREFERRED EXTENT IS ENTERED IN THE DADSM EXTENT TABLE. IF     * 00164021
*   ANOTHER FORMAT 5 DSCB EXISTS, IT IS ALSO SEARCHED FOR SPACE.      * 00172021
*   AFTER ALL AVAILABLE EXTENTS HAVE BEEN SEARCHED, THE DADSM TABLE   * 00180021
*   IS BUILT FROM THE HELD QUANTITY, IF ONE EXISTS. IF THERE IS NO    * 00188021
*   HELD QUANTITY, THE PUSHDOWN LIST IS EXAMINED TO SEE IF TWO OR     * 00196021
*   MORE EXTENTS CAN SATISFY THE REQUEST. THE EXTENT OR EXTENTS THAT  * 00204021
*   SATISFY THE REQUEST ARE ENTERED IN THE DADSM EXTENT TABLE.        * 00212021
*                                                                     * 00220021
*ENTRY POINT:                                                         * 00228021
*   IGG0553B - ENTRY IS MADE FROM IGG0553G VIA A BRANCH.              * 00236002
*                                                                     * 00244021
*INPUT:                                                               * 00252021
*   REGISTER 4 POINTS TO THE I/O SUPPORT WORK AREA.                   * 00260021
*   REGISTER 5 POINTS TO THE USER'S DEB.                              * 00264002
*   REGISTER 11 POINTS TO THE EXTEND WORK AREA.                       * 00268021
*   REGISTER 12 CONTAINS THE AMOUNT OF SPACE REQUESTED.               * 00276021
*   REGISTER 13 CONTAINS THE PREFERRED RTA.                           * 00284021
*   THE I/O SUPPORT WORK AREA IS LAID OUT AS FOLLOWS:                 * 00292021
*                                                                     * 00300021
*          BYTES          AREA                                        * 00308021
*         *******        ******                                       * 00316021
*          100            DSCB FIELD                                  * 00324021
*          176            JFCB                                        * 00332021
*            4            ECB                                         * 00340021
*           40            IOB                                         * 00348021
*           44            DEB                                         * 00356021
*            4            DCB                                         * 00364021
*           96            CCW'S                                       * 00372021
*                                                                     * 00376002
*OUTPUT:                                                              * 00380002
*   REGISTER 4 POINTS TO THE I/O SUPPORT WORK AREA.                   * 00400002
*   REGISTER 5 POINTS TO THE USER'S DEB.                              * 00420002
*   REGISTER 11 POINTS TO THE EXTEND WORK AREA, WHICH CONTAINS THE    * 00440002
*   DADSM EXTENT TABLE.                                               * 00460002
*                                                                     * 00480002
*              ***************************************                * 00500000
*              *             DADSM TABLE             *                * 00520000
*              ***************************************                * 00540000
*                                                                     * 00560000
*              ***************************************                * 00580000
*              *        *         *                  *                * 00600000
*              *  TYPE  *  NO OF  *     USED HOLE    *                * 00620000
*              *  FLAG  * ENTRIES *      COUNTER     *                * 00640000
*              *        *         *                  *                * 00660000
*              ***************************************                * 00680000
*              *                  *                  *                * 00700000
*              *       RTA        *      RTA+1       *                * 00720000
*              *                  *                  *                * 00740000
*              ***************************************                * 00760000
*              *                  *                  *                * 00780000
*              *       RTA        *      RTA+1       *                * 00800000
*              *                  *                  *                * 00820000
*              ***************************************                * 00840000
*              *                  *                  *                * 00860000
*              *       RTA        *      RTA+1       *                * 00880000
*              *                  *                  *                * 00900000
*              ***************************************                * 00920000
*              *                  *                  *                * 00940000
*              *       RTA        *      RTA+1       *                * 00960000
*              *                  *                  *                * 00980000
*              ***************************************                * 01000000
*              *                  *                  *                * 01020000
*              *       RTA        *      RTA+1       *                * 01040000
*              *                  *                  *                * 01060000
*              ***************************************                * 01080000
*                                                                     * 01100000
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.  * 01120000
*                                                                     * 01140000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.      * 01160000
*                                                                     * 01180000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT* 01200021
*                                                                     * 01220000
*                                                                     * 01240000
*                                                                     * 01260000
*EXTERNAL ROUTINES:                                                   * 01280000
*        EXCP(0) - READ OR WRITE DIRECT ACCESS DEVICE                 * 01300000
*        WAIT(1) - WAIT ON EVENT CONTROL BLOCK                        * 01320000
*        IECRES - BRANCH TO ANOTHER MODULE                            * 01340002
*                                                                     * 01360000
*EXITS:                                                               * 01390021
*   NORMAL - BRANCH TO IGG0553C                                       * 01420002
*                                                                     * 01450021
*   ERROR  - BRANCH TO IGG0553E WITH THE ENTRY CODE IN REGISTER 13    * 01480002
*   ERROR CONDITIONS ARE I/O ERROR OR QUANTITY NOT AVAILABLE.         * 01510021
*                                                                     * 01540000
*ATTRIBUTES: REENTRANT                                                * 01560002
*                                                                     * 01580000
*OTHER MACROS USED:                                                   * 01600021
*   IECDSECT - TO DEFINE THE I/O SUPPORT WORK AREA                    * 01620021
*   IECEXTWA - TO DEFINE THE EXTEND WORK AREA                         * 01630002
*   IECSDSL1 - TO SYMBOLICALLY ADDRESS DSCB'S                         * 01640021
*   CVT - TO DEFINE THE CVT                                           * 01650002
*                                                                     * 01660000
*STORAGE: PROGRAM CODE CSECT - LESS THAN 1024 BYTES                   * 01690002
*         EXTEND WORK AREA - AS DEFINED IN THE IECEXTWA MACRO         * 01720002
*         RPS WORK AREA - AS DEFINED IN THE IECRPS MACRO              * 01750002
*         I/O SUPPORT WORK AREA                                       * 01800002
*                                                                     * 01810002
         BALR  RBASE,K0                 CSECT ADDRESSABILITY     Y02080 01820002
         USING BEGIN,RBASE                                       Y02080 01840002
         USING EOVWKA,RCORE             EOV W/A ADDRESSABILITY   Y02080 01860002
         USING EXTNDWKA,EXWKA           WORK AREA ADDRESSABILITY Y02080 01868002
*                                                                       01876021
* REGISTER EQUATES                                                      01884021
*                                                                       01892021
REG0     EQU   0                        EQUATE FOR REGISTER 0    Y02080 01900002
RHH      EQU   0                        NUMBER OF EXTRA TRACKS   Y02080 01910002
REG1     EQU   1                        EQUATE FOR REGISTER 1    Y02080 01920002
RCC      EQU   1                        NUMBER OF CYLINDERS      Y02080 01930002
ALTWKA   EQU   1                        ALTERNATE EXTEND WKA PTR Y02080 01940002
RIN      EQU   2                        INPUT F5 POINTER         Y02080 01950002
RBASE    EQU   3                        BASE REGISTER            Y02080 01960002
RCORE    EQU   4                        EOV WORK AREA POINTER    Y02080 01980002
RDEB     EQU   5                        DEB POINTER              Y02080 02020002
RCTR     EQU   6                        COUNTER                  Y02080 02030002
RTA1     EQU   6                        EVEN REGISTER            Y02080 02040002
REG6     EQU   6                        EQUATE FOR REGISTER 6    Y02080 02050002
REG7     EQU   7                        EQUATE FOR REGISTER 7    Y02080 02060002
RTA      EQU   7                        ODD REGISTER             Y02080 02080002
REG8     EQU   8                        EQUATE FOR REGISTER 8    Y02080 02100002
ROUT     EQU   8                        CONVERTED F5 POINTER     Y02080 02120002
TBLPTR   EQU   8                        DADSMTBL ENTRY POINTER   Y02080 02140002
REG9     EQU   9                        EQUATE FOR REGISTER 9    Y02080 02160002
PDLPTR   EQU   9                        PUSHDOWN LIST POINTER    Y02080 02180002
RA       EQU   10                       EQUATE FOR REGISTER 10   Y02080 02200002
RTRK     EQU   10                       NUMBER OF TRKS/CYLINDER  Y02080 02220002
EXWKA    EQU   11                       EXTEND WORK AREA POINTER Y02080 02240002
RC       EQU   12                       EQUATE FOR REGISTER 12   Y02080 02250002
REQ      EQU   12                       SPACE REQUESTED          Y02080 02260002
REG13    EQU   13                       EQUATE FOR REGISTER 13   Y02080 02280002
RPREF    EQU   13                       PREFERRED RTA            Y02080 02300002
RE       EQU   14                       EQUATE FOR REGISTER 14   Y02080 02310002
RCNT     EQU   14                       COUNTER OF EXTENTS       Y02080 02320002
RF       EQU   15                       EQUATE FOR REGISTER 15   Y02080 02330002
RHOLD    EQU   15                       HELD QUANTITY INDICATOR  Y02080 02340002
*                                                                       02348021
* OTHER EQUATES                                                         02356021
*                                                                       02364021
ONEENTRY EQU   X'01'                    ONE ENTRY IN DADSM TABLE M0130  02372021
K0       EQU   0                        CONSTANT OF 0            Y02080 02372502
K1       EQU   1                        CONSTANT OF 1            Y02080 02373002
K2       EQU   2                        CONSTANT OF 2            Y02080 02374002
K3       EQU   3                        CONSTANT OF 3            Y02080 02375002
K4       EQU   4                        CONSTANT OF 4            Y02080 02376002
K5       EQU   5                        CONSTANT OF 5            Y02080 02377002
K24      EQU   24                       CONSTANT OF 24           Y02080 02377502
K26      EQU   26                       CONSTANT OF 26           Y02080 02378002
K27      EQU   27                       CONSTANT OF 27           Y02080 02378502
K48      EQU   48                       CONSTANT OF 48           Y02080 02379002
K72      EQU   72                       CONSTANT OF 72           Y02080 02379502
K108     EQU   108                      CONSTANT OF 108          Y02080 02379602
*                                                                       02380000
* THIS SECTION RELOCATES THE CHANNEL PROGRAM FOR                        02400000
* READING IN THE DSCB FORMAT 5.                                         02420000
*                                                                       02440000
BEGIN    EQU   *                        BRANCH LABEL             M0130  02446002
         SR    RHOLD,RHOLD              CLEAR HOLD SWITCH        Y02080 02452002
         MVC   DS5PTRDS,EDADSMAD        MOVE IN FIRST F5 ADDRESS Y02080 02460002
         LR    ALTWKA,EXWKA             SAVE BASE REGISTER       Y02080 02500002
         LM    REG6,EXWKA,CHANPRO       PICK UP FIRST 3 CCW'S    Y02080 02520002
         ALR   REG6,ALTWKA                                       Y02080 02540002
         ALR   REG8,ALTWKA                                       Y02080 02560002
         ALR   RA,RCORE                                          Y02080 02580002
         STM   REG6,EXWKA,DXCCW1        STORE FIRST 3 CCW'S      Y02080 02600002
         LM    REG6,EXWKA,CHANPRO+K24   PICK UP NEXT 3 CCW'S     Y02080 02620002
         ALR   REG6,RCORE                                        Y02080 02640002
         ALR   REG8,ALTWKA                                       Y02080 02660002
         ALR   RA,ALTWKA                                         Y02080 02680002
         STM   REG6,EXWKA,DXCCW4        STORE NEXT 3 CCW'S       Y02080 02700002
         LM    REG6,EXWKA,CHANPRO+K48   PICK UP NEXT 3 CCW'S     Y02080 02720002
         ALR   REG6,RCORE                                        Y02080 02740002
         ALR   REG8,ALTWKA                                       Y02080 02760002
         ALR   RA,RCORE                                          Y02080 02780002
         STM   REG6,EXWKA,DXCCW7        STORE NEXT 3 CCW'S       Y02080 02800002
         LM    REG6,REG9,CHANPRO+K72    PICK UP LAST 2 CCW'S     Y02080 02820002
         ALR   REG6,RCORE                                        Y02080 02840002
         ALR   REG8,ALTWKA                                       Y02080 02860002
         STM   REG6,REG9,DXCCW10        STORE LAST 2 CCW'S       Y02080 02880002
         LR    EXWKA,ALTWKA                                      Y02080 02900002
         LA    REG6,DXCCW9                                       Y02080 02920002
         ST    REG6,IOBSIOCC                                     Y02080 02940002
READF5   EQU   *                        BRANCH LABEL             Y02080 02950002
         MVC   DXDAADDR+K3(K5),DS5PTRDS  INSERT SEEK ADDRESS     Y02080 02960002
         LR    REG6,RHOLD               SAVE HOLD SWITCH         Y02080 02980002
         EXCP  DXIOB                                                    03000000
         WAIT  1,ECB=DXECB                                              03020000
         TM    DXECB,X'20'              TEST FOR PERMANENT I/O ERROR    03040000
         BC    8,UNSUCFUL                                               03060000
         LR    RHOLD,REG6               RESTORE HELD QTY SWITCH  Y02080 03080002
*                                                                       03100000
* THIS SECTION CONVERTS THE EXTENTS IN THE FORMAT 5 FROM XXYYZ TO       03120000
* RTA - NO. OF TRACKS                                                   03140000
*                                                                       03160000
SETUP    MVC   READIN+44(90),READIN+45 CLOSE UP EXTENTS OVER ID         03180000
         SR    RHH,RHH                  CLEAR NUMBER OF TRACKS   Y02080 03200002
         LA    RIN,READIN+K4            SET UP INPUT F5 POINTER  Y02080 03240002
         LR    ROUT,RIN                 POINTER TO CONVERTED F5  Y02080 03260002
         LA    RCNT,K26                 NUMBER OF INPUT EXTENTS  Y02080 03280002
TESTZERO EQU   *                        BRANCH LABEL             Y02080 03290002
         LH    RTRK,DS4DEVSZ+K2         NUMBER OF TRACKS/CYL     Y02080 03300002
         SR    RTA1,RTA1                INITIALIZE FOR DIVISION  Y02080 03320002
         CLC   0(K2,RIN),ZEROS          CHECK FOR A ZERO EXTENT  Y02080 03340002
         BE    INCRIN                   BRANCH IF ZERO TO UPDATE PTRS.  03360000
         MVC   ENEXTADR,0(RIN)          SET XXYYZ ON HALFWORD    Y02080 03380002
         LH    RCC,ENEXTADR+K2                                   Y02080 03400002
         MH    RCC,DS4DEVSZ+K2          MULTIPLY YY BY TRKS/CYL  Y02080 03420002
         LH    RTA,ENEXTADR                                      Y02080 03440002
         TM    JFCBCTRI,X'C0'           TEST FOR CYLINDER REQUEST       03460000
         BO    CYLRND                   BRANCH IF CYLINDER REQ  SA54497 03480021
         TM    JFCBCTRI,JFCBAVR+JFCROUND TEST FOR ROUND REQUEST SA54497 03490021
         BNO   ADD                      BRANCH IF NOT ROUND     SA54497 03492021
*                                                                       03500000
* IF REQUEST IS IN CYLINDERS MUST ROUND RTA UP TO CYLINDER BOUNDARY     03520000
* IF NECESSARY                                                          03540000
*                                                                       03560000
CYLRND   EQU   *                        BRANCH LABEL            SA54497 03570002
         DR    RTA1,RTRK                DIVIDE RTA BY TRKS/CYL   Y02080 03580002
         MH    RTA,DS4DEVSZ+K2          FIND NO. OF FULL CYLS    Y02080 03600002
         LTR   RTA1,RTA1                TEST IF ON CYL BOUNDARY  Y02080 03620002
         BZ    ADDA                     BRANCH IF YES                   03640000
         AR    RTA,RTRK                 ROUND UP TO NEXT CYL     Y02080 03660002
         B     ADDA                                                     03680000
ADD      EQU   *                        BRANCH LABEL             Y02080 03690002
         IC    RHH,ENEXTADR+K4          PICK UP SURPLUS TRACKS   Y02080 03700002
         AR    RCC,RHH                  ADD SURPLUS NO. OF TRKS  Y02080 03720002
ADDA     EQU   *                        BRANCH LABEL             Y02080 03730002
         STH   RCC,K2(ROUT)             STORE CONVERTED EXTENT   Y02080 03740002
         STH   RTA,0(ROUT)                                       Y02080 03760002
         LA    ROUT,K4(ROUT)            INCREMENT POINTERS       Y02080 03780002
INCRIN   EQU   *                        BRANCH LABEL             Y02080 03790002
         LA    RIN,K5(RIN)                                       Y02080 03800002
         BCT   RCNT,TESTZERO            GO CONVERT NEXT EXTENT   Y02080 03820002
         XC    0(K27,ROUT),0(ROUT)      CLEAR REST OF AREA       Y02080 03840002
         LA    RIN,DS5AVEXT             SET UP INPUT F5 POINTER  Y02080 03860002
         B     BEGINHRE                                                 03900000
*                                                                       03920000
* THIS SECTION CHECKS FOR INDEX POINTING TO THE 26 TH EXTENT OF A DSCB  03940000
* FORMAT 5. IF NOT THE INDEX IS UPDATED TO THE NEXT DADSM ENTRY AND     03960000
* THE SEARCH CONTINUES. IF AT THE END A TEST IS MADE TO SEE IF ANOTHER  03980000
* FORMAT 5 IS PRESENT. IF SO THE NEW FORMAT 5 IS READ IN AND THE SEARCH 04000000
* IS CONTINUED.                                                         04020002
*                                                                       04040002
TESTLOC  EQU   *                        BRANCH LABEL             Y02080 04060002
         LA    RA,READIN+K108           TEST FOR LAST EXTENT     Y02080 04080002
         CR    RA,RIN                                            Y02080 04100002
         BNE   BEGSURCH                 BRANCH IF MORE EXTENTS          04120000
         OC    DS5PTRDS,DS5PTRDS        TEST IF ANOTHER F5       Y02080 04160002
         BZ    FILLIT                   BRANCH IF NO MORE F5'S   Y02080 04200002
         B     READF5                   READ ANOTHER FORMAT 5           04220000
*                                                                       04240000
* I/O ERROR AND EXIT ROUTINES                                           04260000
*                                                                       04280000
UNSUCFUL EQU   *                        BRANCH LABEL             Y02080 04290002
         SR    REG13,REG13              ZERO REGISTER            Y02080 04300002
         IC    REG13,DXEXTSW            PICK UP CALLER CODE      Y02080 04320002
         LA    REG6,LASTLOAD            POINT TO ID OF IGG0553E  Y02080 04330002
XCTLHERE EQU   *                        BRANCH LABEL             Y02080 04360002
         IECRES LOAD,EXTPR=(EXWKA),MODID=(REG6),BRANCH=DIRECT    Y02080 04420002
*                                                                       04460000
* THIS SECTION BEGINS THE SEARCH BY TRYING TO FIND AN EXTENT ADJACENT   04480000
* TO THE DATA SET                                                       04500000
*                                                                       04520000
BEGSURCH EQU   *                        BRANCH LABEL             Y02080 04530002
         LA    RIN,K4(RIN)              UPDATE SEARCH POINTER    Y02080 04540002
BEGINHRE EQU   *                        COMPARE THE PREFERRED    Y02080 04560002
         CH    RPREF,0(RIN)             RTA TO THE F5 RTA        Y02080 04580002
         BNE   CHECKOUT                 BRANCH NOT EQUAL                04600000
         CH    REQ,K2(RIN)              TEST IF QTY AVAILABLE    Y02080 04620002
         BH    QTNOTAVL                 NOT AVAILABLE                   04640000
*                                                                       04660000
* WHEN THERE IS SUFFICIENT SPACE AT THE PREFERRED RTA TO FULFILL        04670021
* THE REQUEST, THE PREFERRED EXTENT IS ENTERED IN THE DADSM TABLE.      04680021
*                                                                       04700000
ONEDADSM EQU   *                        BRANCH LABEL             Y02080 04710002
         LH    REG6,0(RIN)              ADD REQUESTED QUANTITY   Y02080 04720002
         AR    REG6,REQ                 TO BEGINNING RTA         Y02080 04740002
         STH   REG6,K2(RIN)                                      Y02080 04760002
         MVC   ENTRIES(K4),0(RIN)       SET UP TABLE             Y02080 04780002
         MVI   ENTRYNUM,ONEENTRY        ONE DADSM ENTRY          Y02080 04800002
         B     BUILDONE                                                 04820000
*                                                                       04840000
* WHEN RTA IS NOT AVAILABLE THE QUANTITY IS CHECKED                     04860000
*                                                                       04880000
CHECKOUT EQU   *                        BRANCH LABEL             Y02080 04890002
         CH    REQ,K2(RIN)              TEST QUANTITY AVAILABLE  Y02080 04900002
         BH    QTNOTAVL                 QUANTITY TOO SMALL              04920000
         BL    COMPARE                  QUANTITY TOO LARGE              04940000
         CH    RPREF,0(RIN)             COMPARE RTA'S            Y02080 05040002
         BNH   ONEDADSM                 BRANCH IF RTA AVAILABLE IS NOT  05060000
*                                        LOWER THAN REQUESTED RTA       05080000
*                                                                       05100000
* THIS SECTION COMPARES THE NEW EXTENT WITH THE HELD EXTENT TO          05120021
* DETERMINE WHICH EXTENT IS THE CLOSEST IN SIZE TO THE ORIGINAL         05140021
* REQUEST.                                                              05160021
*                                                                       05180000
COMPARE  EQU   *                        BRANCH LABEL             Y02080 05190002
         LTR   RHOLD,RHOLD              TEST FOR QUANTITY HELD   Y02080 05200002
         BZ    NOHOLD                   BRANCH IF NOT HELD              05220000
         L     REG6,0(RIN)              COMPARE NEW QTY TO HELD  Y02080 05240002
         CLC   K2(K2,RIN),EPDLIST1+K2   IS NEW QUANTITY LOWER    Y02080 05260002
         BH    TESTLOC                  BRANCH IF NOT CLOSER TO REQUEST 05280000
         ST    REG6,EPDLIST1            IF CLOSER - NEW QUANTITY Y02080 05300002
         B     TESTLOC                   BECOMES HELD QUANTITY          05320000
*                                                                       05330021
* NO QUANTITY IS BEING HELD SO THIS ONE IS THE FIRST TO BE EQUAL OR     05340000
* GREATER THAN THE REQUEST AND BECOMES THE HELD QUANTITY                05360000
*                                                                       05380000
NOHOLD   EQU   *                        BRANCH LABEL             Y02080 05390002
         MVC   EPDLIST1,0(RIN)          SET UP THE HELD QUANTITY Y02080 05400002
         LA    RHOLD,K1(RHOLD)          SET HELD QUANTITY SWITCH Y02080 05420002
         B     TESTLOC                                                  05440000
*                                                                       05460000
* THIS SECTION IS ENTERED WHEN THE QUANTITY IS LESS THAN THE REQUEST    05480000
* FIRST A TEST IS MADE TO CHECK FOR A HELD QUANTITY. IF ONE EXISTS THE  05500000
* NEW EXTENT IS DISREGARDED AND A RETURN IS MADE TO EXAMINE THE NEXT    05520000
* EXTENT. IF THERE IS NO HELD QUANTITY THE PUSH DOWN LIST MUST BE       05540000
* EXAMINED.                                                             05560000
*                                                                       05580000
QTNOTAVL EQU   *                        BRANCH LABEL             Y02080 05590002
         LTR   RHOLD,RHOLD              TEST FOR HELD QUANTITY   Y02080 05600002
         BP    TESTLOC                  BRANCH IF QUANTITY HELD         05620000
CHEKLIST EQU   *                        BRANCH LABEL             Y02080 05630002
         L     REG9,0(RIN)              LOAD CONVERTED EXTENT    Y02080 05640002
         LH    REG0,K2(RIN)             LOAD NUMBER OF TRACKS    Y02080 05660002
         CH    REG0,EPDLIST5+K2         COMPARE PUSHDOWN ENTRY   Y02080 05680002
         BNH   TESTLOC                  BRANCH IF NEW QUANTITY LOW      05700000
FINDSLOT EQU   *                        BRANCH LABEL             Y02080 05710002
         MVC   EPDLIST5,0(RIN)          EXCHANGE NEW QTY WITH    Y02080 05720002
*                                       SMALLEST IN LIST         Y02080 05740002
         LA    REG6,K4                  SET INDEX DECREMENT      Y02080 05760002
         LA    REG7,EPDLIST4            SET LOCATION INDEX       Y02080 05780002
COMPTEST EQU   *                        BRANCH LABEL             Y02080 05790002
         CH    REG0,K2(REG7)            COMPARE NEXT ENTRY       Y02080 05800002
         BNH   TESTLOC                  BRANCH IF NEW QUANTITY LOW      05820000
EXCHANGE EQU   *                        BRANCH LABEL             Y02080 05830002
         LR    REG8,REG7                                         Y02080 05840002
         AR    REG8,REG6                                         Y02080 05860002
         MVC   0(K4,REG8),0(REG7)       EXCHANGE ENTRIES         Y02080 05880002
         ST    REG9,0(REG7)                                      Y02080 05900002
         LA    REG8,EPDLIST1            CHECK IF AT END OF THE   Y02080 05920002
         CR    REG8,REG7                PUSH DOWN LIST           Y02080 05940002
         BE    TESTLOC                  BRANCH IF END                   05960000
         SR    REG7,REG6                DECREMENT LOCATION INDEX Y02080 05980002
         B     COMPTEST                 GO COMPARE AGAIN         Y02080 06000002
*                                                                       06020000
* TESTS ARE MADE HERE TO DETERMINE IF WITH ONE OR MORE EXTENTS THE      06040000
* REQUEST CAN BE FILLED ON THIS VOLUME.                                 06060000
*                                                                       06080000
FILLIT   EQU   *                        BRANCH LABEL             Y02080 06090002
         LTR   RHOLD,RHOLD              TEST FOR HELD QUANTITY   Y02080 06100002
         BZ    PICKLIST                 BRANCH IF NO HELD QUANTITY      06120000
*                                                                       06140000
* AN EXTENT IS AVAILABLE THAT IS EQUAL TO OR GREATER THAN REQUEST.  THE 06160000
* QUANTITY REQUESTED IS ADDED TO STARTING RTA TO DETERMINE ENDING RTA+1 06180000
*                                                                       06200000
         AH    REQ,EPDLIST1             HELD QTY IS AVAILABLE    Y02080 06220002
         STH   REQ,ENTRIES+K2           BUILD DADSM EXTENT TABLE Y02080 06240002
         MVC   ENTRIES(K2),EPDLIST1     SET UP TABLE             Y02080 06260002
         MVI   ENTRYNUM,ONEENTRY        ONE DADSM ENTRY          Y02080 06280002
         B     BUILDONE                                                 06300000
*                                                                       06320000
* THE PUSH DOWN LIST IS EXAMINED FOR UP TO 5 EXTENTS WHICH TOGETHER CAN 06340000
* FILL THE REQUEST                                                      06360000
*                                                                       06380000
PICKLIST EQU   *                        BRANCH LABEL             Y02080 06390002
         MVC   ENTRIES(K4),EPDLIST1     MOVE IN RTA1/RTA2 OF     Y02080 06400002
*                                       THE LARGEST EXTENT       Y02080 06410002
         LH    REG6,ENTRIES             CONVERT FIRST ENTRY      Y02080 06420002
         AH    REG6,ENTRIES+K2                                   Y02080 06440002
         STH   REG6,ENTRIES+K2                                   Y02080 06460002
         SR    RCTR,RCTR                INITIALIZE COUNTER       Y02080 06480002
         LA    TBLPTR,ENTRIES+K4        POINT TO ADDRESS OF NEXT Y02080 06500002
         LA    PDLPTR,EPDLIST2          TABLE ENTRY & PUSH DOWN  Y02080 06520002
         LA    RF,K4                    INITIALIZE TO TEST CTR   Y02080 06540002
         LH    REG7,EPDLIST1+K2         PICK UP LARGEST QUANTITY Y02080 06560002
AGAIN    EQU   *                        BRANCH LABEL             Y02080 06570002
         AH    REG7,K2(PDLPTR)          ADD QUANTITY TO SUM      Y02080 06580002
         LA    RCTR,K1(RCTR)            INCREMENT COUNTER        Y02080 06600002
         CR    REG7,REQ                 COMPARE TO REQUEST       Y02080 06620002
         BNL   COMBINEX                 COMBINE WHEN SUFFICIENT         06640000
         LH    REG13,0(PDLPTR)          PICK UP RTA              Y02080 06660002
         AH    REG13,K2(PDLPTR)         ADD NUMBER OF TRACKS     Y02080 06680002
         STH   REG13,K2(PDLPTR)         CALCULATE ENDING RTA+1   Y02080 06700002
         MVC   0(K4,TBLPTR),0(PDLPTR)   MOVE EXTENT TO DADSMTBL  Y02080 06720002
         CR    RCTR,RF                  TEST CTR FOR 5TH EXTENT  Y02080 06740002
         BE    UNSUCFUL                 IF NOT SUFFICIENT - GET OUT     06760000
         LA    TBLPTR,K4(TBLPTR)        INCREMENT POINTERS       Y02080 06780002
         LA    PDLPTR,K4(PDLPTR)                                 Y02080 06800002
         B     AGAIN                    ENTER LOOP AGAIN                06820000
COMBINEX BH    SUBEXCES                 IF QUANTITY EXACT RTA'S OF LAST 06840000
         LH    REG13,0(PDLPTR)          EXTENT USED ARE MOVED TO Y02080 06860002
         AH    REG13,K2(PDLPTR)         THE DADSM EXTENT TABLE   Y02080 06880002
         STH   REG13,K2(PDLPTR)                                  Y02080 06900002
         MVC   0(K4,TBLPTR),0(PDLPTR)   MOVE EXTENT TO THE       Y02080 06920002
         B     SORTLIST                    DADSM TABLE                  06940000
SUBEXCES EQU   *                        BRANCH LABEL             Y02080 06950002
         SR    REG7,REQ                 IF QUANTITY IS IN EXCESS Y02080 06960002
         LH    REG13,K2(PDLPTR)         THEN MUST ADJUST         Y02080 06980002
         SR    REG13,REG7               ENDING RTA + 1           Y02080 07000002
         AH    REG13,0(PDLPTR)                                   Y02080 07020002
         STH   REG13,K2(PDLPTR)         MOVE EXTENT USED INTO    Y02080 07040002
         MVC   0(K4,TBLPTR),0(PDLPTR)   THE DADSM TABLE          Y02080 07060002
SORTLIST EQU   *                        BRANCH LABEL             Y02080 07070002
         LA    PDLPTR,ENTRIES           PTR TO DADSMTBL ENTRIES  Y02080 07080002
         LA    RCTR,K1(RCTR)            INCREMENT COUNTER        Y02080 07100002
         STC   RCTR,ENTRYNUM            NUMBER OF EXTENTS        Y02080 07120002
         BCTR  RCTR,K0                  DECREMENT EXT COUNT      Y02080 07140002
         LR    REG7,RCTR                NUMBER OF SCANS NEEDED   Y02080 07160002
INNERLP  EQU   *                        BRANCH LABEL             Y02080 07170002
         LH    REG8,0(PDLPTR)           COMPARE BEGINNING RTA'S  Y02080 07180002
         CH    REG8,K4(PDLPTR)          OF THE TWO EXTENTS       Y02080 07200002
         BNH   INORDER                  BRANCH IF IN ORDER              07220000
         L     REG8,0(PDLPTR)           IF SECOND LARGER MUST    Y02080 07240002
         MVC   0(K4,PDLPTR),K4(PDLPTR)  EXCHANGE EXTENTS         Y02080 07260002
         ST    REG8,K4(PDLPTR)                                   Y02080 07280002
INORDER  EQU   *                        BRANCH LABEL             Y02080 07290002
         BCTR  RCTR,K0                  DECREMENT EXT COUNT      Y02080 07300002
         LTR   RCTR,RCTR                TEST FOR END OF SCAN     Y02080 07320002
         BZ    SCANEND                  BRANCH IF SCAN COMPLETE         07340000
         LA    PDLPTR,K4(PDLPTR)        IF NOT, INCR LOCATION    Y02080 07360002
         B     INNERLP                     INDICATOR AND CONTINUE       07380000
SCANEND  EQU   *                        BRANCH LABEL             Y02080 07390002
         BCTR  REG7,K0                  DECREMENT EXT COUNT      Y02080 07400002
         LTR   REG7,REG7                TEST FOR END OF SORT     Y02080 07420002
         BZ    BUILDONE                 BRANCH IF SORT COMPLETE         07440000
         LA    PDLPTR,ENTRIES           IF NOT AT END OF SORT,   Y02080 07460002
*                                       THEN RESET THE LOCATION  Y02080 07470002
         LR    RCTR,REG7                INDICATOR AND COUNTER    Y02080 07480002
         B     INNERLP                  RE-ENTER LOOP                   07500000
*                                                                       07520000
* THIS SECTION PREPARES TO BRANCH TO THE NEXT LOAD.                     07526002
*                                                                       07532021
BUILDONE EQU   *                        BRANCH LABEL                    07540002
         LA    REG6,BUILDLD             POINT TO ID OF IGG0553C  Y02080 07550002
         B     XCTLHERE                                                 07580000
*                                                                       07590021
* CONSTANTS                                                             07600021
*                                                                       07610021
*                                                                       07645021
* CHANNEL PROGRAM                                                       07650021
*                                                                       07655021
         DS    0F                                                       07660000
CHANPRO  EQU   *                                                        07680000
*CCW1                                                                   07700000
         DC    X'16'                    READ R0                         07720000
         DC    AL3(COUNT2-EXTNDWKA)     BUFFER ADDR              Y02080 07740002
         DC    X'7000'                                                  07760000
         DC    H'4'                                                     07780000
*CCW2                                                                   07800000
         DC    X'92'                    READ COUNT - CCHHR              07820000
         DC    AL3(0+COUNT2-EXTNDWKA)   BUFFER ADDR              Y02080 07840002
         DC    X'6000'                                                  07860000
         DC    H'5'                                                     07880000
*CCW3                                                                   07900000
         DC    X'A9'                    SEARCH KEY EQUAL                07920000
         DC    AL3(DXCCW4+4-DXLBL)      SEARCH ARG ADDR          Y02080 07940002
         DC    X'6000'                                                  07960000
         DC    H'4'                                                     07980000
*CCW4                                                                   08000000
         DC    X'08'                    TIC BACK TO READ                08020000
         DC    AL3(0+DXCCW2-DXLBL)      TIC ADDR                 Y02080 08040002
ZEROS    DC    F'0'                                                     08060000
*CCW5                                                                   08080000
         DC    X'06'                    READ DATA                       08100000
         DC    AL3(F5DSCB-EXTNDWKA)     BUFFER ADDR              Y02080 08120002
         DC    X'7000'                                                  08140000
         DC    H'8'                                                     08160000
*CCW6                                                                   08180000
         DC    X'31'                    SEARCH EQUAL I.D.               08200000
         DC    AL3(0+COUNT2-EXTNDWKA)   SEARCH ARG ADDR          Y02080 08220002
         DC    X'4000'                                                  08240000
         DC    H'5'                                                     08260000
*CCW7                                                                   08280000
         DC    X'08'                    TIC BACK TO SEARCH              08300000
         DC    AL3(0+DXCCW6-DXLBL)      TIC ADDR                 Y02080 08320002
         DC    F'0'                                                     08340000
*CCW8                                                                   08360000
         DC    X'0D'                    WRITE KEY AND DATA              08380000
         DC    AL3(0+F5DSCB-EXTNDWKA)   BUFFER ADDR              Y02080 08400002
         DC    X'4000'                                                  08420000
         DC    H'140'                                                   08440000
*CCW9                                                                   08460000
         DC    X'31'                    SEARCH EQUAL I.D.               08480000
         DC    AL3(DXDAADDR+3-DXLBL)    SEARCH ARG ADDR          Y02080 08500002
         DC    X'4000'                                                  08520000
         DC    H'5'                                                     08540000
*CCW10                                                                  08560000
         DC    X'08'                    TIC BACK TO SEARCH              08580000
         DC    AL3(0+DXCCW9-DXLBL)      TIC ADDR                 Y02080 08600002
         DC    F'0'                                                     08620000
*CCW11                                                                  08640000
         DC    X'0E'                    READ KEY AND DATA               08660000
         DC    AL3(0+F5DSCB-EXTNDWKA)   BUFFER ADDR              Y02080 08680002
         DC    H'0'                                                     08700000
         DC    H'140'                                                   08720000
*                                                                       08730021
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         08740002
*                                                                       08750021
         XCTLTABL ID=(BUILDLD,3C,LASTLOAD,3E),SVC=055,           Y02080X08760002
               LENGTH=,BRT=YES                                   Y02080 08770002
         EJECT                                                   Y02080 08780002
WORKAREA IECEXTWA EP,D1=(5)             EXTEND WORK AREA         Y02080 08790002
READIN   EQU   F5DSCB                   EQUATE FOR F5DSCB AREA   Y02080 08800002
         EJECT                                                   Y02080 08860002
EOVWKA   DSECT                                                   Y02080 08960002
         IECDSECT                                                       09000000
         EJECT                                                   Y02144 09100002
         ORG   DXLBL                                                    09300000
         IECSDSL1 (4)                                                   09320000
         EJECT                                                   Y02080 72650002
CVT      DSECT                          CVT DSECT                Y02080 72660002
         CVT                                                     Y02080 72670002
         END                                                            78640021
./  ADD  SSI=63090538,NAME=IGG0553C
 TITLE 'IGG0553C - EXTEND - F1,F3 DSCB ROUTINE'                         00020000
IGG0553C CSECT                                                          00022021
*                                                                       00022402
*MODULE NAME = IGG0553C                                                 00022802
*                                                                       00023202
*DESCRIPTIVE NAME = EXTEND - F1, F3 DSCB ROUTINE                        00023602
*                                                                       00023702
*COPYRIGHT = NONE                                                       00023802
*                                                                       00023902
*CHANGE ACTIVITY = SEE BELOW                                            00025002
*                                                                       00027002
*          RELEASE 16 DELETIONS                                         00030502
*0095038400,038800-039200,045600                                  13559 00031602
*          RELEASE 17 DELETIONS                                         00032702
*1708000640,028600-028800,031400,032000,034800-035000.             UL17 00033802
*1708002800,005000-005200,017400-017600,047400-047600             19682 00034902
*          RELEASE 18 DELETIONS                                         00036002
*3478                                                             MCS   00037102
*3478018400,018800-019200,064600,065000                           22833 00038202
*          RELEASE 19 DELETIONS                                         00039302
*          RELEASE 20 DELETIONS                                         00040402
*1023015200,042200                                               M6099  00041502
*1023017300,037000-037200,051600-051800,058600,064800            S20016 00042602
*          RELEASE 21 DELETIONS                                         00044000
*1395001400-001800,002600-003800,005600-007200,008000-009000,    M0130  00044802
*1395009600-010000,017144-017152,017176,017200-017800,019000-    M0130  00045902
*1395019400,028000,030600,031200,031420,032000-032200,034940,    M0130  00047002
*1395043200,044600,046600-047000,056000,061000,062800,063200,    M0130  00048102
*1395070000-071000,071400-072000,072800-075400,076000-076400     M0130  00049202
*1395039800-042600                                               M0050  00050302
*1395010800-012400,025200,026200-027400,034660,034700,034740,    A40437 00051402
*1395034800,048800-050800,065600-065800,066600,078800            A40437 00052502
*1395056600,065450                                               M0184  00053602
*          RELEASE 22 DELETIONS                                         00054702
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00055802
*0000000030-000150,000520-000600,002200,002420,002580-002640,    Y02080 00056902
*0000003360-003999,004229,004800,005800,006200,007600,008600,    Y02080 00058002
*0000009200,009500-010396,012600-017000,017128-017484,018000-    Y02080 00059102
*0000018600,018900,020400-020800,020860,020900,021000,022600-    Y02080 00060202
*0000022800,023200-023800,024200-024800,025210-025240,025300,    Y02080 00061302
*0000028600-029200,029600-029800,030200-031100,031250,031270-    Y02080 00062402
*0000031280,031330-031340,031360-031420,031440-031800,032200-    Y02080 00063502
*0000034200,034600,034630,034660,034700-034880,034940,034980-    Y02080 00064602
*0000035000,035400,036800,036860-036920,037400-037800,038200-    Y02080 00065702
*0000038250,038400,038500-038562,038580-038586,042800-043200,    Y02080 00066802
*0000044600-044800,045200,045800,046200,047200-048600,052800-    Y02080 00067902
*0000052840,052920-053000,053600-053800,054200,056000,056400,    Y02080 00069002
*0000059200-059400,060400-062000,062280,062300,062600-063000,    Y02080 00070102
*0000065200-065400,065600,065800-072400,073600,076000-078400,    Y02080 00071202
*0000088600-298600                                               Y02080 00072302
*0000                                                            Y02082 00073402
*0000                                                            Y02144 00074502
*0000                                                            Y02083 00075602
*0000065450                                                      YM3995 00076402
*                                                                       00076702
*          VS2 RELEASE 03.0 DELETIONS/CHANGES                         * 00077102
*0000065450                                                     ZA00704 00077502
*          SU32 DELETIONS                                      @G32DSFS 00077632
*                                                              @G32DSMI 00077932
*                                                                     * 00078232
*STATUS CHANGE LEVEL 005                                                00078532
*                                                                       00078902
*FUNCTION/OPERATION: THIS MODULE CHECKS FOR NEW VOLUME OR LAST VOLUME * 00080000
*   EXTENSION. IF ON A NEW VOLUME A DSCB FORMAT 1 IS CREATED AND IF   * 00100000
*   NECESSARY A FORMAT 3. IF ON THE LAST VOLUME OF A DATA SET THE     * 00120000
*   FORMAT 1 AND FORMAT 3 ARE UPDATED. IF NO FORMAT 3 EXISTS BUT      * 00140021
*   ONE IS NEEDED, IT IS CREATED. IF THE OLD VOLUME WAS        @Z40RSGD 00160004
*   DEFINED TO RAC, THE NEW VOLUME IS DEFINED TO RAC AND THE   @Z40RSGD 00172004
*   RAC DEFINED BIT IS SET IN THE NEW FORMAT 1.                @Z40RSGD 00174004
*                                                                     * 00180021
*ENTRY POINT:                                                         * 00200000
*        IGG0553C - ENTRY IS MADE FROM IGG0553B VIA A BRANCH.         * 00220002
*                                                                     * 00240000
*INPUT:                                                               * 00246021
*   REGISTER 4 POINTS TO THE I/O SUPPORT WORK AREA WHICH CONTAINS THE * 00252021
*   FORMAT 4 DSCB.                                                    * 00258002
*   REGISTER 5 POINTS TO THE USER'S DEB.                              * 00260002
*   REGISTER 11 POINTS TO THE EXTEND WORK AREA, WHICH CONTAINS THE    * 00264002
*   DADSM EXTENT TABLE.                                               * 00268002
*   THE I/O SUPPORT WORK AREA IS LAID OUT AS FOLLOWS:                 * 00270021
*                                                                     * 00276021
*          BYTES          AREA                                        * 00282021
*         *******        ******                                       * 00288021
*          100            DSCB FIELD                                  * 00294021
*          176            JFCB                                        * 00300021
*            4            ECB                                         * 00306021
*           40            IOB                                         * 00312021
*           44            DEB                                         * 00318021
*            4            DCB                                         * 00324021
*           96            CCW'S                                       * 00330021
*                                                                     * 00405600
*OUTPUT:                                                              * 00411500
*   THE FORMAT 1 AND FORMAT 3 DSCB'S ARE CREATED OR UPDATED. THE      * 00417200
*   DADSM EXTENT TABLE IN THE EXTEND WORK AREA IS BUILT.              * 00422902
*                                                                     * 00428600
*EXTERNAL ROUTINES:                                                   * 00434300
*        EXCP(0) - READ OR WRITE DIRECT ACCESS DEVICE                 * 00440000
*        WAIT(1) - WAIT ON EVENT CONTROL BLOCK                        * 00460000
*        IECRES  - TRANSFER CONTROL TO OTHER LOADS                    * 00480002
*        STATUS  - SET STEP MUST COMPLETE IN THE TCB                  * 00500002
*                                                                     * 00540000
*EXITS:                                                               * 00560021
*   NORMAL - BRANCH TO IGG0553D                                       * 00580002
*                                                                     * 00600021
*   ERROR  - BRANCH TO IGG0553E WITH THE ENTRY CODE IN REGISTER 13    * 00620002
*   ERROR CONDITIONS ARE I/O ERROR AND TOO MANY EXTENTS (GREATER      * 00640021
*   THAN 16) FOR THIS VOLUME AND UNABLE TO RAC DEFINE A NEW    @Z40RSGD 00660004
*   VOLUME WHEN THE OLD VOLUME WAS RAC DEFINED.                @Z40RSGD 00720004
*                                                                     * 00740000
*ATTRIBUTES: REENTRANT                                                * 00760002
*                                                                     * 00780000
*OTHER MACROS USED:                                                   * 00800021
*   IECEXTWA - TO DEFINE THE EXTEND WORK AREA                         * 00810002
*   IECDSECT - TO DEFINE THE I/O SUPPORT WORK AREA                    * 00820021
*   IECSDSL1 - TO SYMBOLICALLY ADDRESS DSCB'S                         * 00840021
*   IECDSECS - TO EXPAND THE CVT, DSAB, IEZDEB, PSA, SCVT, TCB DSECTS * 00860002
*                                                                     * 00940000
*STORAGE: PROGRAM CODE CSECT - LESS THAN 2048 BYTES                   * 00960002
*         EXTEND WORK AREA - AS DEFINED IN THE IECEXTWA MACRO         * 00980002
*         RPS WORK AREA - AS DEFINED IN THE IECRPS MACRO              * 00990002
*         I/O SUPPORT WORK AREA                                       * 01000002
*                                                                       01040000
*                                                                       01060000
* REGISTER EQUATES                                                      01120021
*                                                                       01180021
REG0     EQU   0                        EQUATE FOR REGISTER 0    Y02080 01260002
REG1     EQU   1                        EQUATE FOR REGISTER 1    Y02080 01280002
REG2     EQU   2                        EQUATE FOR REGISTER 2    Y02080 01300002
RBASE    EQU   3                        BASE REGISTER            Y02080 01320002
RCORE    EQU   4                        EOV WORK AREA POINTER    Y02080 01340002
REG5     EQU   5                        EQUATE FOR REGISTER 5    Y02080 01380002
RDEB     EQU   5                        DEB POINTER              Y02080 01400002
ALTWKA   EQU   6                        ALTERNATE WKA POINTER    Y02080 01410002
REG6     EQU   6                        EQUATE FOR REGISTER 6    Y02080 01420002
REG7     EQU   7                        EQUATE FOR REGISTER 7    Y02080 01440002
REG8     EQU   8                        EQUATE FOR REGISTER 8    Y02080 01480002
RTNREG2  EQU   8                        RETURN REGISTER          Y02080 01500002
REG9     EQU   9                        EQUATE FOR REGISTER 9    Y02080 01540002
RA       EQU   10                       EQUATE FOR REGISTER 10   Y02080 01560002
EXWKA    EQU   11                       EXTEND WORK AREA POINTER Y02080 01580002
RC       EQU   12                       EQUATE FOR REGISTER 12   Y02080 01600002
RD       EQU   13                       EQUATE FOR REGISTER 13   Y02080 01620002
RTNREG   EQU   14                       RETURN REGISTER          Y02080 01660002
RF       EQU   15                       EQUATE FOR REGISTER 15   Y02080 01680002
RCVT     EQU   15                       CVT POINTER              Y02080 01700002
*                                                                       01701021
* OTHER EQUATES                                                         01702021
*                                                                       01703021
DS1CKDS  EQU   X'01'                    DSCB1 CHKPT D/S FLAG     Y02083 01703402
RDWOPSWD EQU   X'04'                    READ WITHOUT PASSWORD    M0130  01704021
NEWVOL   EQU   X'04'                    EXTEND ON NEW VOLUME     M0130  01705021
TWO      EQU   2                                                   UL17 01706000
ZERO     EQU   0                        CONSTANT OF 0            Y02080 01707002
K0       EQU   0                        CONSTANT OF 0            Y02080 01707402
K1       EQU   1                        CONSTANT OF 1            Y02080 01708002
STEPMC   EQU   1                        STATUS STEP MC INDICATOR Y02080 01709002
K3       EQU   3                        CONSTANT OF THREE        Y02080 01711002
FOUR     EQU   4                                                   UL17 01712000
K6       EQU   6                        CONSTANT OF SIX          Y02080 01713002
K12      EQU   12                       CONSTANT OF TWELVE       Y02080 01714002
K16      EQU   16                       CONSTANT OF SIXTEEN      Y02080 01715002
TRKALIGN EQU   X'01'                    EXTENT IS TRACK ALIGNED  Y02080 01716002
CYLALIGN EQU   X'81'                    EXTENT IS CYLINDER ALIGN Y02080 01717002
USRLABEL EQU   X'40'                    USER LABEL TRACK EXTENT  Y02080 01718002
RESBITS  EQU   X'13'                    JFCB DSORG RESERVE BITS  Y02080 01718402
DS1RACDF EQU   X'40'                    DS1DSIND-DATA SET IS   @Z40RSGD 01718804
*                                       RAC DEFINED            @Z40RSGD 01719204
RACERROR EQU   X'40'                    RAC ERROR              @Z40RSGD 01719604
*                                                                       01720002
         USING EOVWKA,RCORE             EOV W/A ADDRESSABILITY   Y02080 01725002
         USING EXTNDWKA,EXWKA           WORK AREA ADDRESSABILITY Y02080 01730002
         BALR  RBASE,K0                 CSECT ADDRESSABILITY     Y02080 01735002
         USING BEGIN,RBASE                                       Y02080 01740002
*                                                                       01745002
* IF THE TASK IS NOT ALREADY STEP MUST COMPLETE, THIS SECTION LINKS     01750002
* TO THE STATUS ROUTINE TO SET THE TASK STEP MUST COMPLETE.             01755002
*                                                                       01760002
BEGIN    EQU   *                        BRANCH LABEL             Y02080 01765002
         XC    F5DSCB,F5DSCB            CLEAR WORK AREA          Y02080 01770002
         XC    F3DSCB,F3DSCB            CLEAR WORK AREA          Y02080 01775002
         MVI   DXCCW5+4,X'30'          BREAK CHANNEL PGM AT CCW5  13559 01790016
         LA    RC,ENTRIES               PTR TO DADSMTBL ENTRIES  Y02080 01792002
         SR    RD,RD                                             Y02080 01794002
         IC    RD,ENTRYNUM              NO. OF DADSMTBL ENTRIES  Y02080 01796002
*                                                                       01798002
         STM   EXWKA,RTNREG,IECREGSV+K12  SAVE REGISTERS 11-14   Y02080 01800002
         LR    ALTWKA,EXWKA             SAVE WORK AREA ADDRESS   Y02080 01802002
         MODESET EXTKEY=ZERO            SWITCH TO KEY ZERO       Y02082X01804002
                                        BEFORE THE SETLOCK       Y02082 01806002
GETLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02080X01808002
               RELATED=(LOCAL,IGG0553C(RLSELOCK))  OBTAIN LOCK   Y02080 01810002
         LM    EXWKA,RTNREG,IECREGSV+K12-EXTNDWKA(ALTWKA)        Y02080 01812002
*                                                                       01814002
         USING DEBBASIC,RDEB            DEB ADDRESSABILITY       Y02080 01816002
         L     REG1,DEBTCBAD            LOAD TCB ADDR FROM DEB   Y02080 01818002
         USING TCB,REG1                 TCB ADDRESSABILITY       Y02080 01820002
         TM    TCBFLGS2,TCBFJMC         TEST IF ALREADY SMC      Y02080 01822002
         BO    RLSELOCK                 BRANCH IF USER SMC       Y02080 01824002
         DROP  REG1                                              Y02080 01826002
*                                                                       01828002
         USING CVT,RCVT                 CVT ADDRESSABILITY       Y02080 01830002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02080 01832002
         L     RCVT,CVTABEND            LOAD SECONDARY CVT PTR   Y02080 01834002
         USING SCVTSECT,RCVT            2NDRY CVT ADDRESSABILITY Y02080 01836002
         L     RCVT,SCVTSTAT            LOAD STATUS EP ADDRESS   Y02080 01838002
         LA    REG0,STEPMC              INDICATE STEP MC         Y02080 01840002
         XR    REG1,REG1                INDICATE STATUS SET      Y02080 01842002
*                                                                       01844002
         BALR  RTNREG,RCVT              LINK TO STATUS ROUTINE   Y02080 01846002
*                                                                       01848002
         OI    ETYPEFLG,RSMC            SET RESET SMC FLAG       Y02080 01850002
         OI    DSMADTB2,DSMSMCE         SET VTOC ENQ'ED SMC BIT  Y02144 01852002
*                                                                       01854002
RLSELOCK EQU   *                        BRANCH LABEL             Y02080 01856002
         STM   EXWKA,RTNREG,IECREGSV+K12  SAVE REGISTERS 11-14   Y02080 01858002
         LR    ALTWKA,EXWKA             SAVE WORK AREA ADDRESS   Y02080 01860002
         SETLOCK RELEASE,TYPE=LOCAL,                             Y02080X01862002
               RELATED=(LOCAL,IGG0553C(GETLOCK))  RELEASE LOCK   Y02080 01864002
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY    Y02082 01866002
         LM    EXWKA,RTNREG,IECREGSV+K12-EXTNDWKA(ALTWKA)        Y02080 01868002
*                                                                       01870002
         USING CVT,RCVT                 CVT ADDRESSABILITY       Y02080 01872002
         TM    DXEXTSW,NEWVOL           TEST IF NEW VOLUME       Y02080 01890002
         BO    BUILDF1                  BRANCH IF NEW VOLUME     M0130  01920021
*                                                                       01960000
* MODIFY IOB AND CCW'S FOR READ OF FORMAT 1 DSCB                        01980000
*                                                                       02000000
READF1   MVC   SEEK+3(5),COUNT          SET UP SEEK ADDRESS IN IOB      02020000
         BAL   RTNREG2,EXEC             GO FOR FORMAT 1 READ     Y02080 02040002
NOERROR  EQU   *                        BRANCH LABEL             Y02080 02050002
         SR    REG6,REG6                                         Y02080 02060002
         IC    REG6,DS1NOEPV            NUMBER OF EXTENTS        Y02080 02080002
         CLI   DS1EXT1,X'40'    IS 1ST XTENT UL EXTENT            22833 02082018
         BNE   NVL              NO                                22833 02084018
         LA    REG6,K1(REG6)            MAKE COUNT+1 FOR INTERNL Y02080 02086002
*                                       USE                       22833 02088018
         STC   REG6,DS1NOEPV                                     Y02080 02090002
NVL      EQU   *                                                  22833 02092018
         AR    REG6,RD                  ADD NUMBER OF EXTENTS IN Y02080 02100002
*                                       THE DADSM EXTENT TABLE   Y02080 02110002
*                                                                       02120000
* AFTER THE FORMAT 1 DSCB FOR THIS DATA SET IS READ IN THE NUMBER OF    02140000
* EXTENTS FOR THE EXISTING DATA SET PLUS THE NUMBER OF NEW EXTENTS IS   02160000
* COMPARED TO SIXTEEN. IF THE TOTAL IS GREATER THAN SIXTEEN A RETURN    02180000
* IS MADE TO EOV SINCE THERE CAN BE ONLY A MAXIMUM OF SIXTEEN EXTENTS   02200000
* FOR A DATA SET PER VOLUME.                                            02220000
*                                                                       02240000
         STC   REG6,ESWITCH             SAVE NUMBER OF EXTENTS   Y02080 02260002
         CLI   ESWITCH,K16              CHECK HOW MANY           Y02080 02280002
         BH    RETURN                   BR IF TO MANY EXTENTS           02300000
         IC    REG6,DS1NOEPV            NO. OF CURRENT EXTENTS   Y02080 02320002
         LR    REG5,REG6                EXTENT NUMBER OF THE     Y02080 02340002
*                                       FIRST NEW EXTENT         Y02080 02350002
         LA    RA,DS3EXTNT              START OF FIRST F3 EXTENT Y02080 02360002
         SH    REG6,THREE               SUBTRACT 3 IN CASE OF F3 Y02080 02380002
         BC    10,NOTF1                 BR IF NO MORE ROOM IN F1        02400000
         LR    REG6,REG5                RESTORE NO. OF EXTENTS   Y02080 02420002
         LA    RA,DS1EXT1               START OF FIRST F1 EXTENT Y02080 02440002
NOTF1    EQU   *                        BRANCH LABEL             Y02080 02450002
         MH    REG6,TEN                 TIMES EXTENT SIZE        Y02080 02460002
         AR    RA,REG6                  POINT TO 1ST FREE EXTENT Y02080 02480002
         CLI   DS1NOEPV,3               CHECK FOR EXISTING F3 DSCB      02500000
         BNH   CHKEXT                   BRANCH IF NO F3 EXISTS   A40437 02503021
*                                                                       02506021
* MODIFY IOB AND CCW'S TO READ THE EXISTING FORMAT 3 DSCB               02509021
*                                                                       02512021
         MVC   SEEK+3(5),DS1PTRDS       SET UP SEEK IN IOB       A40437 02515021
         MVC   COUNT2(5),DS1PTRDS                                A40437 02518021
         LA    REG8,IECSDSL3            POINT TO INPUT AREA      Y02080 02521002
         ST    REG8,DXCCW11                                      Y02080 02524002
         MVI   DXCCW11,X'0E'            INSERT READ OP CODE      A40437 02527021
         BAL   RTNREG2,EXEC             GO READ THE F3 DSCB      Y02080 02530002
         MVC   DXCCW11+1(3),DXCCW5+1    RESTORE F1 AREA ADDRESS  A40437 02533021
CHKEXT   CLI   DS1NOEPV,7               CHECK NO. OF EXTENTS            02540000
         BNL   STBUMP                   BR IF POINTER IS PAST FMTID FLD 02560000
         B     STARTIT                  CONVERT AND MOVE EXTENTS        02580000
*                                                                       02600000
* CONVERT AND MOVE EXTENTS TO FORMAT1 AND FORMAT3 DSCB AREAS.           02760000
* CHECK FOR EXISTANCE OF FORMAT 3 DSCB AND WRITE IT IF NECESSARY.       02780000
* ENTRY TO THIS ROUTINE IS AT STARTIT                                   02820000
*                                                                       02840000
STLOOP   EQU   *                        BRANCH LABEL             Y02080 02850002
         LA    RC,FOUR(RC)              POINT TO NEXT ENTRY      Y02080 02860002
STLOOP2  EQU   *                        BRANCH LABEL             Y02080 02870002
         LA    REG5,K1(REG5)            INCREMENT EXTENT NUMBER  Y02080 02880002
         LA    RA,L'DS1EXT1(RA)         INCREMENT EXTENT POINTER Y02080 02900002
         CH    REG5,THREE               CHECK NEW EXTENT SEQ NO. Y02080 02920002
         BNE   STCHKBMP                 BR IF NOT AT START OF F3 DSCB   02940000
         LA    RA,DS3EXTNT              SET TO START OF F3       Y02080 02960002
STCHKBMP EQU   *                        BRANCH LABEL             Y02080 02970002
         CH    REG5,SEVEN               CHECK NEW EXTENT SEQ NO. Y02080 02980002
         BNE   STARTIT                  BR IF NOT AT F3 FMTID FIELD     03000000
STBUMP   EQU   *                        BRANCH LABEL             Y02080 03010002
         LA    RA,K1(RA)                BUMP PAST FORMAT ID      Y02080 03020002
STARTIT  EQU   *                        BRANCH LABEL             Y02080 03030002
         STC   REG5,K1(RA)              EXTENT SEQ NO. IN DSCB   Y02080 03040002
         LH    REG0,0(RC)               GET LOW RTA              Y02080 03080002
         BAL   RTNREG2,RTACONVT         LINK TO CALL CONVERSION  Y02080 03100002
         MVC   TWO(FOUR,RA),DXCCW12+K3  MOVE IN LOW CCHH         Y02080 03110002
         TM    JFCDSORG,X'20'           IS IT CREATE DIRECT D.S.   UL17 03121000
         BC    1,NOUSERLB               YES,NO USER LABELS         UL17 03122000
         TM    JFCBLTYP,X'08'           USER LABEL REQUEST         UL17 03123000
         BZ    NOUSERLB                 BRANCH IF NO               UL17 03124000
         LTR   REG5,REG5                SEE IF USER LABEL EXTENT Y02080 03125002
         BP    NOUSERLB                 BRANCH IF NOT              UL17 03126000
         MVC   EPDLIST2(TWO),0(RC)      SAVE RTA                 Y02080 03127002
         LH    REG2,0(RC)               PICK UP RTA              Y02080 03128002
         TM    JFCBCTRI,X'C0'           IS THIS A CYLINDER REQUEST UL17 03129000
         BO    CYLREQ                   BRANCH IF YES              UL17 03130000
         TM    JFCBCTRI,X'41'           IS THIS RECORD ROUNDED     UL17 03131000
         BO    CYLREQ                   BR IF YES                  UL17 03132000
         LA    REG2,K1(REG2)            INCREMENT RTA            Y02080 03133002
         STH   REG2,0(RC)               STORE IN DADSM TABLE     Y02080 03134002
         B     UPCCHH                   MOVE CCHH TO DSCB          UL17 03135000
CYLREQ   AH    REG2,DS4DEVSZ+TWO        ADD TRKS/CYL TO RTA      Y02080 03136002
         STH   REG2,0(RC)               UPDATE RTA IN DADSMTBL   Y02080 03137002
         BCTR  REG2,K0                  DECREMENT FOR U.L. RTA   Y02080 03138002
         LR    REG0,REG2                SET UP RTA IN REGISTER   Y02080 03139002
         STH   REG2,EPDLIST2            UPDATE SAVED RTA         Y02080 03140002
         BAL   RTNREG2,RTACONVT         LINK TO CALL CONVERSION  Y02080 03141002
         MVC   TWO(FOUR,RA),DXCCW12+K3  USER LABEL LOW CCHH      Y02080 03142002
         B     UPCCHH                   GO TO MOVE CCHH TO DSCB    UL17 03143000
NOUSERLB EQU   *                        BRANCH LABEL             Y02080 03144002
         LH    REG0,TWO(RC)             PICK UP RTA+1            Y02080 03145002
         BCTR  REG0,K0                  DECREMENT FOR HIGH RTA   Y02080 03160002
         BAL   RTNREG2,RTACONVT         LINK TO CALL CONVERSION  Y02080 03180002
UPCCHH   EQU   *                                                 M0130  03200021
         MVC   K6(FOUR,RA),DXCCW12+K3   MOVE IN UPPER CCHH       Y02080 03220002
         MVI   0(RA),TRKALIGN           INDICATE NOT CYL ALIGNED Y02080 03240002
         LH    REG8,DS4DEVSZ+TWO        PICK UP TRACKS/CYLINDER  Y02080 03260002
         SR    REG6,REG6                                         Y02080 03280002
         LH    REG7,0(RC)               LOAD RTA                 Y02080 03300002
         DR    REG6,REG8                CHECK FOR CYLINDER ALIGN Y02080 03320002
         LTR   REG6,REG6                IF ZERO - ALIGNED        Y02080 03340002
         BP    NOTCYL                   BRANCH IF NOT ALIGNED    Y02080 03360002
         LH    REG7,TWO(RC)             LOAD RTA+1               Y02080 03380002
         DR    REG6,REG8                CHECK FOR CYLINDER ALIGN Y02080 03400002
         LTR   REG6,REG6                                         Y02080 03420002
         BP    NOTCYL                   BR IF NOT ALIGNED               03440000
         MVI   0(RA),CYLALIGN           INDICATE CYL ALIGNED     Y02080 03460002
NOTCYL   EQU   *                                                   UL17 03462000
         LA    REG1,NOUSER              SET UP BRANCH REGISTER   Y02080 03463002
         TM    JFCDSORG,X'20'           IS IT CREATE DIRECT D.S.   UL17 03464000
         BCR   1,REG1                   YES, THEN NO USER LABELS Y02080 03466002
         TM    JFCBLTYP,X'08'           TEST FOR USR LBL REQUEST   UL17 03468000
         BCR   8,REG1                   BRANCH IF NO             Y02080 03470002
         LTR   REG5,REG5                WAS IT USER LABEL EXTENT Y02080 03472002
         BCR   2,REG1                   BRANCH IF NO             Y02080 03474002
         MVI   0(RA),USRLABEL           MOVE IN USER LABEL TYPE  Y02080 03476002
         CLC   0(TWO,RC),TWO(RC)        WAS THIS U.L. ONLY       Y02080 03478002
         BCR   8,REG1                   BRANCH IF YES            Y02080 03480002
         LA    RD,K1(RD)                UPDATE NUMBER OF EXTENTS Y02080 03482002
         STC   RD,ESWITCH                                        Y02080 03484002
         BCT   RD,STLOOP2               GET NEXT EXTENT          Y02080 03486002
NOUSER   EQU   *                        BRANCH LABEL             Y02080 03487002
         BCT   RD,STLOOP                BR IF ANOTHER EXTENT     Y02080 03488002
         CLI   DS1EXT1,X'40'            IS THIS A USER LABEL EXTENTUL17 03490000
         BNE   PREPWRT                  BRANCH IF NO               UL17 03492000
         TM    DXEXTSW,NEWVOL           TEST IF NEW VOLUME       Y02080 03494002
         BZ    PREPWRT                  BRANCH IF NO               UL17 03496000
         MVC   ENTRIES(TWO),EPDLIST2    RESTORE USER LABEL RTA   Y02080 03498002
PREPWRT  EQU   *                        BRANCH LABEL             Y02080 03499002
         LA    REG6,DXCCW6                                       Y02080 03500002
         MVI   DXCCW11+4,X'10'          SET ON WRITE CHECK FLAG         03520000
         CLI   ESWITCH,K3               CHECK ACTUAL NBR EXTENTS Y02080 03540002
         BH    WROUTF3                  BR IF F3 DSCB TO BE WRITTEN     03560000
*                                                                       03580000
* SEARCH FOR SPACE IF NEEDED AND WRITE FORMAT 1                         03600000
*                                                                       03620000
WRITEF1  EQU   *                                                  13559 03640016
         MVC   DS1PTRDS(5),COUNT2       CHAIN ADDRESS OF F3             03660000
         MVC   DS1NOEPV,ESWITCH         SET TOTAL NBR OF EXTENTS Y02080 03680002
         LA    REG6,COUNT                                        Y02080 03686002
         ST    REG6,LITTLE1             GET IDAREA ADDRESS       Y02080 03692002
         NC    COUNT+1(4),COUNT+1       CHK FOR EXISTING FORMAT  S20016 03701020
*                                       1                        S20016 03710020
         BNZ   GOTIDF1                  BRANCH IF FORMAT 1       S20016 03719020
*                                       EXISTS                   S20016 03728020
         LH    REG6,UHOLECTR            UPDATE USED HOLE COUNTER Y02080 03740002
         LA    REG6,K1(REG6)                                     Y02080 03760002
         STH   REG6,UHOLECTR                                     Y02080 03780002
         MVC   COUNT(5),VTOCADR         START SEARCH AT VTOC ADDRESS    03800000
         LA    REG6,DXCCW1                                       Y02080 03820002
         ST    REG6,IOBSIOCC            START SEARCH AT CCW1     Y02080 03825002
         MVC   DXCCW2+1(3),LITTLE1+1   IDAREA ADDRESS             13559 03830016
         MVC   SEEK+3(4),COUNT         IOB SEEK ADDRESS           13559 03835016
         BAL   RTNREG2,EXEC             SEARCH FOR FORMAT 0      Y02080 03840002
GOTIDF1  EQU   *                                                  13559 03845016
         LA    REG6,DXCCW6              START WRITE AT CCW6      Y02080 03850002
         ST    REG6,IOBSIOCC            STORE ENTRY POINT        Y02080 03855002
         SR    REG6,REG6                                         Y02080 03855602
         IC    REG6,DS1NOEPV            OBTAIN EXTENT COUNT      Y02080 03856202
         CLI   DS1EXT1,X'40'       IS 1ST XTENT UL EXTENT         22833 03856818
         BNE   MVL2                NO                             22833 03857418
         BCTR  REG6,K0                  REDUCE EXTENT COUNT BY 1 Y02080 03858002
         STC   REG6,DS1NOEPV                                     Y02080 03858602
MVL2     EQU   *                                                  22833 03859218
         MVC   SEEK+3(4),COUNT          INSERT SEEK ADDRESS IN IOB      03860000
         MVC   DXCCW6+1(3),LITTLE1+1                                    03940000
         MVC   DXCCW9+1(3),LITTLE1+1                                    03960000
         BAL   RTNREG2,EXEC             GO TO WRITE FORMAT 1     Y02080 04280002
         CLC   DS4HPCHR,COUNT           TEST IF NEW HIWATER MARK Y02080 04300002
         BNL   MODIFYCP                 BRANCH IF NOT            Y02080 04310002
         MVC   DS4HPCHR,COUNT           MOVE IN NEW HIWATER MARK Y02080 04320002
*                                                                       04340000
* THIS SECTION MAKES CHANGES IN THE CHANNEL PROGRAM FOR THE DADSM       04360000
* UPDATE LOADS.CCW1 THRU CCW5 WILL BE USED TO SEARCH FOR A DSCB HOLE.   04380000
* CCW6 THRU CCW 11 ARE USED FOR WRITING FORMAT 5 AND FORMAT 4.          04400000
* CCW9 THRU CCW 11 ARE USED TO READ FORMAT5 AND FORMAT4                 04420000
*                                                                       04440000
MODIFYCP EQU   *                        BRANCH LABEL             Y02080 04450002
         LA    REG6,IDAREA              POINT TO IDAREA          Y02080 04460002
         ST    REG6,DXCCW1                                       Y02080 04480002
         MVI   DXCCW1,X'16'             RESTORE READ R0 COMMAND         04500000
         ST    REG6,DXCCW2              CHANGE PTR IN CCW2       Y02080 04520002
         MVI   DXCCW2,X'92'             RESTORE READ COUNT COMMAND      04540000
         ST    REG6,DXCCW6              CHANGE PTR IN CCW6       Y02080 04580002
         MVI   DXCCW6,X'31'             RESTORE SEARCH EQUAL COMMAND    04600000
         ST    REG6,DXCCW9              CHANGE PTR IN CCW6       Y02080 04620002
         MVI   DXCCW9,X'31'             RESTORE SEARCH EQUAL COMMAND    04640000
         LA    REG6,F5LOAD              POINT TO IGG0553D        Y02080 04650002
RETRNEX  EQU   *                        BRANCH LABEL             Y02080 04720002
         LA    REG2,ENTRIES             PTR TO DADSMTBL ENTRIES  Y02080 04750002
XCTLHERE EQU   *                        BRANCH LABEL             Y02080 04780002
         MVI   ESWITCH,ZERO             ZERO ESWITCH             Y02080 04800002
         IECRES LOAD,EXTPR=(EXWKA),MODID=(REG6),BRANCH=DIRECT    Y02080 04820002
*                                                                       05100000
* SEARCH FOR HOLE FOR FORMAT 3 AND WRITE IT OR JUST WRITE THE FORMAT 3  05120000
*                                                                       05140000
WROUTF3  EQU   *                                                 S20016 05150020
         NC    COUNT2+1(4),COUNT2+1     CHK FOR EXISTING FORMAT  S20016 05160020
*                                       3                        S20016 05170020
         BNZ   GOTIDF3                  BRANCH IF FORMAT 3       S20016 05180020
*                                       EXISTS                   S20016 05190020
         MVC   IECSDSL3(4),HEX3         4 HEX 03'S TO KEY               05200000
         MVI   DS3FMTID,X'F3'           FORMAT IDENTIFIER               05220000
         MVI   UHOLECTR+1,X'01'         UPDATE USED HOLE COUNTER        05240000
         MVC   COUNT2(5),VTOCADR        START SEARCH AT VTOC            05260000
         LA    REG6,DXCCW1                                       Y02080 05280002
         ST    REG6,IOBSIOCC            START SEARCH AT CCW1     Y02080 05284002
         MVC   SEEK+3(4),COUNT2        IOB SEEK ADDRESS           13559 05288016
         BAL   RTNREG2,EXEC             SEARCH FOR FORMAT 0      Y02080 05292002
         LA    REG6,DXCCW6              START WRITE AT CCW6      Y02080 05296002
GOTIDF3  EQU   *                        BRANCH LABEL             Y02080 05300002
         ST    REG6,IOBSIOCC            CHAN PROG START ADDRESS  Y02080 05310002
         MVC   SEEK+3(4),COUNT2        INSERT SEEK ADDR INTO IOB.       05320000
         MVC   DXCCW9+1(3),DXCCW2+1     POINTER TO COUNT2 FOR CCW       05340000
         LA    REG6,IECSDSL3            SET CCW TO FORMAT 3 ADDR Y02080 05360002
         ST    REG6,DXCCW8                                       Y02080 05380002
         MVI   DXCCW8,X'0D'             RESTORE COMMAND FOR WRITE       05400000
         BAL   RTNREG2,EXEC             GO TO WRITE FORMAT 3     Y02080 05420002
         MVC   DXCCW8+1(3),DXCCW5+1          RESTORE F1 ADDRESS.        05440000
         B     WRITEF1                                                  05460000
*                                                                       05480000
* BUILD A FORMAT 1 FROM THE JFCB FOR A NEW VOLUME                       05500000
*                                                                       05520000
BUILDF1  MVC   DS1DSNAM(44),JFCBDSNM    DATA SET NAME                   05540000
         MVI   DS1FMTID,X'F1'           FORMAT ID                       05560000
         MVC   DS1DSSN(6),JFCBVOLS      VOLUME SERIAL NUMBER            05580000
         MVC   DS1VOLSQ,DXVOLSEQ        MOVE IN NEW VOLUME SEQ   Y02080 05600002
*                                       NUMBER SET UP BY EOV     Y02080 05610002
         MVC   DS1CREDT(6),JFCBCRDT     CREATION AND EXPIRATION DATES   05620000
         STC   RD,ESWITCH               NBR OF DADSMTBL ENTRIES  Y02080 05640002
         MVC   DS1SYSCD(13),SYSCODE     MOVE IN SYSTEM CODE      M0184  05660021
         MVC   DS1DSORG(8),JFCDSORG     SET UP DATA SET ORGANIZATION    05680000
*                                       RECORD FORMAT                   05700000
*                                       OPTION CODE                     05720000
*                                       BLOCK LENGTH                    05740000
*                                       RECORD LENGTH                   05760000
         NI    DS1DSORG+K1,X'FF'-RESBITS CLEAR THE RESERVED BITS Y02082 05765002
         MVC   DS1KEYL(1),JFCKEYLE                                      05780000
         MVC   DS1RKP(2),JFCRKP         RELATIVE KEY POSITION           05800000
         MVC   DS1SCALO(4),JFCBCTRI     FLAG FIELD AND SECONDARY QTY    05820000
         MVC   DS1LSTAR(5),TTRLL                                        05840000
         L     RA,DXDSAB                FETCH DSAB ADDRESS       Y02083 05842002
         USING DSAB,RA                  DSAB ADDRESSABILITY      Y02083 05844002
         TM    DSABFLG4,DSABCKDS        IS THIS A CHKPT D/S      Y02083 05846002
         DROP  RA                                                Y02083 05848002
         BZ    NOCHKPT                  IF NOT, BRANCH           Y02083 05850002
         OI    DS1DSIND,DS1CKDS         SET CHKPT D/S FLAG       Y02083 05852002
NOCHKPT  EQU   *                        BRANCH LABEL             Y02083 05854002
         TM    JFCBIND2,JFCBSCTY        DOES JFCB SPEC SECURITY  S20016 05860020
         BZ    NOSECUR                  BR IF NOT SECURITY              05880000
         OI    DS1DSIND,X'10'           SET SECURITY INDICATOR IN F1    05900000
         TM    JFCBIND2,JFCBRWPW        DOES JFCB SPEC RWPW OPTN S20016 05905020
         BNO   NOSECUR                  BRANCH IF NO             S20016 05910020
         OI    DS1DSIND,RDWOPSWD        IND SECTY IS FOR WR ONLY S20016 05915020
NOSECUR  EQU   *                        BRANCH LABEL             Y02080 05920002
*   DEFINE NEW VOLUME TO ONLY IF OLD VOLUME WAS                @Z40RSGD 05922004
*   DEFINED.                                                   @Z40RSGD 05924004
         LR    RA,RDEB                  DEB PREFIX             @Z40RSGD 05926004
         SH    RA,LENDEBPX                                     @Z40RSGD 05928004
         USING DEBPREFX,RA                                     @Z40RSGD 05928404
         L     RA,DEBXTNP               DEB EXTENSION          @Z40RSGD 05928804
         USING DEBXTN,RA                                       @Z40RSGD 05929204
         TM    DEBXFLG1,DEBXDSSI        IS IT PROTECTED        @Z40RSGD 05929604
         BZ    RACDONE                  NO-NOT RAC DEFINED     @Z40RSGD 05929704
*   DEFINE NEW VOLUME                                          @Z40RSGD 05929804
         MVC   RACDEF(LRACDEF),MRACDEF  RACDEF PARM LIST       @Z40RSGD 05933204
         L     RF,DXUCBADR              UCB ADDRESSABILITY     @Z40RSGD 05933604
         RACDEF ENTITY=DS1DSNAM,                               @Z40RSGDX05935204
               VOLSER=UCBVOLI-UCB(RF),                         @Z40RSGDX05935604
               OLDVOL=DXOLDVOL,                                @G32DSMIX05936032
               MF=(E,RACDEF)                                   @ZR0RSGD 05936404
         LTR   RF,RF                    RACDEF SUCCESSFUL      @Z40RSGD 05936504
         BZ    RACDEFOK                 YES-CONTINUE           @Z40RSGD 05936604
         OI    DXEXTSW,RACERROR         NO-INDICATE ERROR      @Z40RSGD 05942404
         B     RETURN                   EXIT                   @Z40RSGD 05944404
RACDEFOK OI    DS1DSIND,DS1RACDF        INDICATE DATA SET IS   @Z40RSGD 05946404
*                                       DEFINED                @Z40RSGD 05946804
RACDONE  EQU   *                        PROCESSING DONE        @Z40RSGD 05947204
*                                       SUCCESSFULLY           @Z40RSGD 05947604
         SR    REG5,REG5                1ST SEQ NUMBER IS ZERO   Y02080 05948404
         LA    RA,DS1EXT1               SET UP DSCB 1 ADDRESS    Y02080 05954204
         B     STARTIT                                                  05960000
*                                                                       05980000
* THIS ROUTINE LINKS TO THE RESIDENT CONVERT ROUTINE-RTA/CCHH           06000000
*                                                                       06020000
RTACONVT EQU   *                        BRANCH LABEL             Y02080 06040002
         STM   REG9,RD,IECREGSV+K12     SAVE REGISTERS           Y02080 06050002
         SLL   REG0,16                  SHIFT RTA                Y02080 06060002
         LA    REG1,DXDEB               LOAD DEB ADDRESS         Y02080 06080002
         LA    REG2,DXCCW12             POINT TO RESULT AREA     Y02080 06100002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02080 06120002
         L     RCVT,CVTPCNVT            LOAD CONVERT RTN ADDR    Y02080 06140002
         LR    ALTWKA,EXWKA             SAVE EXTEND WKA ADDRESS  Y02080 06150002
         BALR  RTNREG,RCVT              LINK TO CONVERSION RTN   Y02080 06160002
         LM    REG9,RD,IECREGSV+K12-EXTNDWKA(ALTWKA)             Y02080 06180002
         BR    RTNREG2                  RETURN                   Y02080 06200002
*                                                                       06220000
* THIS SECTION EXECUTES A CHANNEL PROGRAM.                              06221021
*                                                                       06222021
EXEC     EQU   *                                                 A40437 06223021
         MVI   DXECB,X'00'              CLEAR ECB                A40437 06224021
         EXCP  DXIOB                                             A40437 06225021
         WAIT  1,ECB=DXECB                                       A40437 06226021
         TM    DXECB,X'20'              TEST FOR I/O ERROR       A40437 06227021
         BCR   1,RTNREG2                RETURN IF NO ERROR       Y02080 06228002
*                                                                       06229021
* THIS SECTION BRANCHES TO THE LAST LOAD.                               06230002
*                                                                       06240000
RETURN   EQU   *                        BRANCH LABEL             Y02080 06250002
         SR    RD,RD                                             Y02080 06260002
         IC    RD,DXEXTSW               PICK UP CALLER CODE      Y02080 06280002
         LA    REG6,LASTLOAD            POINT TO IGG0553E        Y02080 06300002
         B     XCTLHERE                 GO XCTL                  M0130  06320021
*                                                                       06340000
* CONSTANTS                                                             06360000
*                                                                       06370021
LENDEBPX DC    AL2(DEBBASIC-DEBPREFX)   LENGTH OF DEB PREFX    @Z40RSGD 06372004
THREE    DC    H'3'                                                     06380000
SEVEN    DC    H'7'                                                     06400000
TEN      DC    H'10'                                                    06420000
HEX3     DC    X'03030303'                                              06440000
MRACDEF  RACDEF TYPE=ADDVOL,            RACDEF MASTER          @Z40RSGDX06490004
               DSTYPE=N,                PARAMETER LIST         @Z40RSGDX06540004
               MF=L                                            @Z40RSGD 06542004
LRACDEF  EQU   *-MRACDEF                LENGTH PARM LIST       @Z40RSGD 06544004
SYSCODE  DC    CL13'IBMOSVS2'           SYSTEM CODE             ZA00704 06545002
*                                                                       06550021
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         06560002
*                                                                       06570021
         XCTLTABL ID=(F5LOAD,3D,LASTLOAD,3E),SVC=055,            Y02080X06580002
               LENGTH=,BRT=YES                                   Y02080 06590002
         SPACE 2                                                 Y02080 06600002
         IECDSECS CVT,DSAB,IEZDEB,PSA,SCVT,UCB,TCB,EXPAND=YES  @Z40RSGD 06680004
WORKAREA IECEXTWA EP,D1=(1),D2=(3),ADT=YES  EXTEND WORK AREA     Y02080 07020002
RACDEF   EQU   IECREGSV                 RACDEF PARM LIST       @Z40RSGD 07030004
COUNT    EQU   ECOUNT                   EQUATE FOR ECOUNT        Y02080 07060002
UHOLECTR EQU   EHOLECTR                 EQUATE FOR EHOLECTR      Y02080 07080002
VTOCADR  EQU   EVTOCADR                 EQUATE FOR EVTOCADR      Y02080 07100002
LITTLE1  EQU   EPDLIST1                 EQUATE FOR EPDLIST1      Y02080 07120002
IDAREA   EQU   EIDAREA                  EQUATE FOR EIDAREA       Y02080 07140002
TTRLL    EQU   ETTRLL                   EQUATE FOR ETTRLL        Y02080 07160002
         EJECT                                                   Y02080 07180002
EOVWKA   DSECT                          EOV WORK AREA            Y02080 07220002
         IECDSECT                                                       07260000
         EJECT                                                   Y02080 07360002
         ORG   DXLBL                                                    07560000
         IECSDSL1 (4)                                                   07580000
*                                                                       07840002
SEEK     EQU   DXDAADDR                                                 07860000
         END   IGG0553C                                          A40437 47860021
./  ADD  SSI=32510345,NAME=IGG0553D
 TITLE 'IGG0553D - EXTEND - DADSM UPDATE LOAD'                          00020000
IGG0553D CSECT                                                          00020521
*                                                                       00020902
*MODULE NAME = IGG0553D                                                 00021902
*                                                                       00022302
*DESCRIPTIVE NAME = EXTEND - DADSM UPDATE LOAD                          00022702
*                                                                       00022802
*COPYRIGHT = NONE                                                       00022902
*                                                                       00023302
*CHANGE ACTIVITY = SEE BELOW                                            00023702
*                                                                       00023802
*          RELEASE 17 DELETIONS                                         00024102
*0095000400,004200-004400,007600,016000,017000,027800             19682 00024502
*          RELEASE 18 DELETIONS                                         00025002
*          RELEASE 19 DELETIONS                                         00026002
*3478067600-067800                                               O19117 00027002
*          RELEASE 20 DELETIONS                                         00028002
*3034027900                                                      A38490 00029002
*          RELEASE 21 DELETIONS                                         00030002
*1193000600-000800,001800-003000,004800-005000,005400-005800,    M0130  00031002
*1193006400-007000,007400-007600,014200-014600,015400-016600,    M0130  00032002
*1193035000-035400,045600-045800,055800,058400-058600,065600,    M0130  00033002
*1193067700,068000-068200,069200,070200,071000,074800,076400-    M0130  00034002
*1193078600,083400,086000-088200                                 M0130  00035002
*0000018000,018800-019200,046200,047600-047800,055400-055800,    M2281  00036002
*0000057000-057400,086900,087000                                 M2281  00037002
*          RELEASE 22 DELETIONS                                         00038002
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00039002
*0000000030-000150,000337-000379,001400,001620,001840,002620-    Y02080 00040002
*0000003031,003192-003244,004000,004800,005000,006000,007220-    Y02080 00041002
*0000007992,009000-009200,010600,012000-014000,015200-015500,    Y02080 00042002
*0000017000-017200,017600,018200,025400,026600,027400,027920,    Y02080 00043002
*0000028080-028600,030400,031200,044200,044800-045000,055400,    Y02080 00044002
*0000057800,059400,066000-067400,067700,068400-068800,070000,    Y02080 00045002
*0000070200-071400,074600-083200,084600,085200-086900,087100-    Y02080 00046002
*0000087500                                                      Y02080 00047002
*0000007400-007500,048600                                        XM2969 00047402
*                                                                       00048002
* STATUS CHANGE LEVEL 004                                               00049002
*                                                                     * 00050021
*FUNCTION/OPERATION:                                                  * 00060021
*   THIS MODULE SUBTRACTS THE SPACE IN THE DADSM EXTENT TABLE FROM    * 00070021
*   THE FORMAT 5 DSCB(S).                                             * 00080021
*                                                                     * 00100000
*ENTRY POINT:                                                         * 00120000
*        IGG0553D - ENTRY IS MADE FROM IGG0553C VIA A BRANCH.         * 00140002
*                                                                     * 00160000
*INPUT:                                                               * 00166021
*   REGISTER 2 POINTS TO THE DADSM EXTENT TABLE.                      * 00172021
*   REGISTER 4 POINTS TO THE I/O SUPPORT WORK AREA, WHICH CONTAINS    * 00178021
*   THE FORMAT 4 DSCB.                                                * 00184002
*   REGISTER 11 POINTS TO THE EXTEND WORK AREA.                       * 00190021
*   THE I/O SUPPORT WORK AREA IS LAID OUT AS FOLLOWS:                 * 00196021
*                                                                     * 00202021
*          BYTES          AREA                                        * 00208021
*         *******        ******                                       * 00214021
*          100            DSCB FIELD                                  * 00220021
*          176            JFCB                                        * 00226021
*            4            ECB                                         * 00232021
*           40            IOB                                         * 00238021
*           44            DEB                                         * 00244021
*            4            DCB                                         * 00250021
*           96            CCW'S                                       * 00256021
*                                                                     * 00308300
*OUTPUT:                                                              * 00314000
*   THE FORMAT 5 DSCB'S ARE UPDATED. A SWITCH IS SET IN 'ESWITCH' IN  * 00319202
*   THE EXTEND WORK AREA IF A FORMAT 0 DSCB MUST BE WRITTEN OVER A    * 00324402
*   FORMAT 5 DSCB.                                                    * 00329600
*                                                                     * 00334800
*EXTERNAL ROUTINES:                                                   * 00340000
*        EXCP(0) - READ OR WRITE DIRECT ACCESS DEVICE                 * 00360000
*        WAIT(1) - WAIT ON EVENT CONTROL BLOCK                        * 00380000
*                                                                     * 00460000
*EXITS:                                                               * 00470021
*   NORMAL - BRANCH TO IGG0553E WITH REGISTER 13 EQUAL TO ZERO        * 00480002
*                                                                     * 00490021
*   ERROR  - BRANCH TO IGG0553E WITH THE ENTRY CODE IN REGISTER 13    * 00500002
*   THE ONLY ERROR CONDITION IS AN I/O ERROR.                         * 00510021
*                                                                     * 00520000
*ATTRIBUTES: REENTRANT                                                * 00600002
*                                                                     * 00620000
*OTHER MACROS USED:                                                   * 00640021
*   IECEXTWA - TO DEFINE THE EXTEND WORK AREA                         * 00650002
*   IECDSECT - TO DEFINE THE I/O SUPPORT WORK AREA                    * 00660021
*   IECSDSL1 - TO SYMBOLICALLY ADDRESS DSCB'S                         * 00680021
*   CVT - TO DEFINE THE CVT                                           * 00690002
*                                                                     * 00720000
*STORAGE: PROGRAM CODE CSECT - LESS THAN 2048 BYTES                   * 00730002
*         EXTEND WORK AREA - AS DEFINED IN THE IECEXTWA MACRO    XM2969 00740002
*         RPS WORK AREA - AS DEFINED IN THE IECRPS MACRO         XM2969 00750002
*         I/O SUPPORT WORK AREA                                       * 00760002
*                                                                     * 00799600
*                                                                       00800000
*REGISTER USAGE:                                                        00820000
R0       EQU   0                                                        00840000
R1       EQU   1                                                        00860000
RCNT     EQU   1                        DADSMTBL ENTRY COUNTER   Y02080 00870002
R2       EQU   2                                                        00880000
RTAB     EQU   2                        DADSMTBL POINTER         Y02080 00890002
RBASE    EQU   3                        BASE REGISTER            Y02080 00900002
RCORE    EQU   4                        EOV WORK AREA POINTER    Y02080 00920002
ROEND    EQU   5                        OUTPUT END POINTER       Y02080 00930002
R5       EQU   5                                                        00940000
R6       EQU   6                                                        00960000
R7       EQU   7                                                        00980000
R8       EQU   8                                                        01000000
R9       EQU   9                                                        01020000
RA       EQU   10                                                       01040000
EXWKA    EQU   11                       EXTEND WORK AREA ADDRESS Y02080 01060002
RC       EQU   12                                                       01080000
RIN      EQU   12                       POINTER TO F5 INPUT      Y02080 01090002
RD       EQU   13                                                       01100000
ROUT     EQU   13                 POINTER TO F5 OUTPUT                  01120000
RBAK     EQU   14                 RETURN REGISTER                       01140000
RWRK     EQU   15                 WORK REGISTER                         01160000
RF       EQU   15                                                       01180000
*                                                                       01410021
* OTHER EQUATES                                                         01420021
*                                                                       01430021
K0       EQU   0                        CONSTANT OF 0            Y02080 01430402
H0       EQU   X'00'                    CONSTANT OF HEX 0        Y02080 01430802
K3       EQU   3                        CONSTANT OF THREE        Y02080 01432002
K4       EQU   4                        CONSTANT OF FOUR         Y02080 01434002
K12      EQU   12                       CONSTANT OF TWELVE       Y02080 01436002
F5ID     EQU   C'5'                     EBCDIC FIVE              M0130  01440021
GOODIO   EQU   X'20'                    TEST FOR I/O ERROR       Y02080 01444002
*                                                                       01450021
         BALR  RBASE,0                                                  01480000
         USING DADSMSTR,RBASE                                           01500000
         USING EOVWKA,RCORE             EOV WKA ADDRESSABILITY   Y02080 01520002
         USING EXTNDWKA,EXWKA           WORK AREA ADDRESSABILITY Y02080 01550002
*                                                                       01580021
* THIS SECTION INITIALIZES POINTERS AND COUNTERS  AND READS THE FIRST   01610021
* FORMAT 5 DSCB.                                                        01640021
*                                                                       01680000
DADSMSTR EQU   *                                                 M0130  01690021
         XC    ENEXTADR,ENEXTADR        CLEAR CHAIN ADDRESS      Y02080 01700002
         LA    RWRK,F3DSCB                                       Y02080 01710002
         ST    RWRK,CCW8                SET CCW8 ADDRESS POINTER Y02080 01720002
         MVI   CCW8,X'0D'               SET COMMAND WRTE KEY AND DATA   01740000
         ST    RWRK,CCW5                SET CCW5 ADDRESS POINTER Y02080 01760002
         MVI   CCW5,X'06'               SET COMMAND READ DATA           01780000
         MVC   IECSDSL3(4),FIVES        MOVE IN F5 KEY ID        M2281  01800021
         MVI   SWITCH,FRSTF5+OUTBYP     INITIALIZE READ/WRITE SW Y02080 01820002
         SR    RCNT,RCNT                                                01840000
         IC    RCNT,ENTRYNUM      PICK UP NUMBER OF ENTRIES IN DADSMTBL 01860000
         LA    ROEND,DS3END             END OF OUTPUT POINTER    M2281  01910021
RESTOUT  EQU   *                                                 M2281  01912021
         LA    ROUT,F5OUT               START OF OUTPUT POINTER  M2281  01914021
         XC    DS3EXTNT(DS3END-DS3EXTNT),DS3EXTNT  CLEAR OUTPUT  M2281  01920021
*                                       FORMAT 5 AREA            M2281  01930021
         MVC   IDAREA(5),DADSMADR INSERT CCHHR FOR FIRST DADSM RECORD.  01940000
         MVC   SAVEADR(5),IDAREA                                        01960000
         BAL   RBAK,READF5        READ FIRST DADSM RECORD.              01980000
*                                                                       02000000
* THIS SECTION DETERMINES WHEN THE DADSM TABLE EXTENTS SHOULD BE        02020000
* MERGED INTO THE OUTPUT FORMAT 5                                       02040000
*                                                                       02060000
DUELOOP  CLR   ROEND,ROUT         IS OUTPUT AREA FULL.                  02080000
         BNH   TEST1                    BRANCH IF OUTPUT IS FULL        02100000
         CLC   0(4,RIN),ZEROS     IS INPUT EXTENT ZEROS                 02120000
         BE    CHEND              BR IF ZERO                            02140000
         LTR   RCNT,RCNT          IS TABLE EMPTY                        02160000
         BZ    MOVEOUT            YES MOVE INPUT TO OUTPUT              02180000
         CLC   2(2,RTAB),2(RIN)   IS THIS SPACE ALLOCATED.              02200000
         BL    ALTEREX            CHECK FOR MIDDLE OR FRONT ALL.IF LOW. 02220000
         BE    TOTALL             CHECK FOR TOTAL OR REAR  ALL. IF EQ.  02240000
MOVEOUT  TM    SWITCH,DADBYP            IS WRITE DADSM PENDING          02260000
         BO    CHEXTRTN                 BRANCH IF YES                   02280000
         MVC   0(4,ROUT),0(RIN)         MOVE INPUT TO OUTPUT            02300000
INPUT    BCT   RWRK,UPDATEPT      UPDATE POINTER IF NOT EMPTY           02320000
         LA    ROUT,4(ROUT)                                             02340000
         OI    SWITCH,PRCNTL            SET PROCESS CONTROL SWITCH      02360000
*                                                                       02380000
* TEST FOR MULTIPLE FORMAT 5 RECORDS                                    02400000
*                                                                       02420000
CHECHAIN TM    DS5PTRDS+4,X'FF'   IS INPUT RECORD CHAINED.              02440000
         BZ    CHECALT            NO-CHECK TO SEE IF RECORD WAS ALTERED 02460000
         MVC   EXTCCHHR,IDAREA          SAVE CCHHR OF CURRENT F5 XM2969 02470002
         TM    SWITCH,RCDALT            WAS DADSM RECORD ALTERED        02480000
         BC    1,BRTORDF5         BR IF ALTERED TO READ F5              02500000
TSTPROC  BAL   RBAK,RESTORE                                             02520000
         NI    SWITCH,X'FF'-PRCNTL      CLEAR PROCESS CONTROL SW Y02080 02540002
BRTORDF5 BAL   RBAK,SAVEID        GO TO READ ROUTINE                    02560000
         B     DUELOOP                                                  02580000
CHECALT  TM    SWITCH,RCDALT            WAS DADSM RECORD ALTERED        02600000
         BZ    SETZERO                  BR IF NOT ALTERED               02620000
WRITEFNL OI    SWITCH,WRTFNL            SET WRITE FINAL RECORD SWITCH   02640000
         XC    ENEXTADR,ENEXTADR        CLEAR CHAIN ADDRESS      Y02080 02660002
         BAL   RBAK,WRITEF5       GO TO WRITE  F5                       02680000
SETZERO  SR    RD,RD                    CLEAR ERROR REGISTER            02700000
*                                                                       02720000
* SET UP WTG TABLE FOR TRANSFER TO LAST LOAD                            02740002
*                                                                       02760000
XCTLHRE  EQU   *                                                 A38490 02768020
         TM    SWITCH,NEWF5        TEST IF NEW F5 WAS CREATED    A38490 02776020
         BNO   NONEWF5             BRANCH IF NOT                 A38490 02784020
         NI    SWITCH,X'FF'-WRZERO-NEWF5  CLEAR WRITE F0 BIT     Y02080 02792002
NONEWF5  EQU   *                                                 A38490 02800020
         IECRES LOAD,EXTPR=(EXWKA),MODID=LASTLOAD,BRANCH=DIRECT  Y02080 02860002
*                                                                       02880000
* WHEN OUTPUT IS FULL CHECK CHAIN ADDRESS AND INPUT. DETERMINE IF       02900000
* FUNCTION IS COMPLETE TO WRITE FINAL FORMAT 5                          02920000
*                                                                       02940000
TEST1    TM    SWITCH,PRCNTL            IS PROCESS CONTROL SWITCH ON    02960000
         BZ    TSTCH                    BRANCH IF NO                    02980000
         TM    SWITCH,OUTBYP            IS WRITE BEFORE READ            03000000
         BZ    TSTCH                    BRANCH IF YES                   03020000
         MVC   ENEXTADR,FIVESP          SAVE CHAIN ADDRESS       Y02080 03040002
         B     BRTOWR5            BR TO WRITE F5                        03060000
TSTCH    TM    DS5PTRDS+4,X'FF'   CHECK FOR CHAIN ADDRESS               03080000
         BZ    CHEXT              NO-CHECK TO SEE IF NEXT EXTENT ZER    03100000
WRITE1   EQU   *                        BRANCH LABEL             Y02080 03110002
         MVC   ENEXTADR,DS5PTRDS        SAVE CHAIN ADDRESS       Y02080 03120002
BRTOWR5  BAL   RBAK,WRITEF5                                             03140000
         B     DUELOOP                                                  03160000
CHEND    TM    SWITCH,FRSTF5            IS THE 1ST DADSM RCD IN CORE    03180000
         BO    WRITEFNL                 BRANCH IF YES                   03200000
*                                                                       03220000
* TEST IF THERE HAS BEEN MORE INPUT DADSM RECORDS THAN OUTPUT DADSM     03240000
* RECORDS.  IF SO THEN SET UP TO ZERO OUT THE LAST INPUT DADSM RECORD.  03260000
*                                                                       03280000
TSTZERO  TM    SWITCH,OUTBYP            IS NBR OF WRTS EQUAL TO NBR RDS 03300000
         BO    WRITEZER                 BRANCH IF NO                    03320000
         MVC   IDAREA(5),FIVESP         YES- SET UP SRCH/ID ADDRESS     03340000
         B     WRITEFNL                 GO WRITE LAST F5                03360000
WRITEZER OI    SWITCH,WRZERO            SET WRITE ZERO RECORD SWITCH    03380000
         B     WRITEFNL                                                 03400000
*                                                                       03420000
* THIS SECTION MERGES THE DADSM TABLE WITH THE FORMAT 5                 03440000
*                                                                       03460000
ALTEREX  OI    SWITCH,RCDALT            SET DADSM RECORD ALTERED SWITCH 03480000
         TM    SWITCH,DADBYP            IS DADSM WRITE BYPASS SWITCH ON 03560000
         BO    CHEXTRTN                 BRANCH IF YES                   03580000
         CLC   0(2,RTAB),0(RIN)   TEST FOR MIDDLE OR FRONT ALLOCATION   03600000
         BNE   MIDDLE             LOW NOT EQUAL MIDDLE ALLOCATION       03620000
FRONT    MVC   0(2,ROUT),2(RTAB)  FRONT ALLOCATE INSERT NEW  LOW RTA    03640000
         MVC   2(2,ROUT),2(RIN)   KEEP OLD UPPER RTA                    03660000
DECRMNT  BCTR  RCNT,0             DECREMENT TABLE ENTRY COUNTER         03680000
         LA    RTAB,4(RTAB)       UPDATE POINTER TO NEXT TABLE ENTRY    03700000
         B     INPUT                    GO CHECK FOR INPUT EMPTY        03720000
UPDATEPT LA    ROUT,4(ROUT)       UPDATE POINTERS                       03740000
UPDATIN  LA    RIN,4(RIN)                                               03760000
         B     DUELOOP                                                  03780000
MIDDLE   MVC   0(2,ROUT),0(RIN)   MIDDLE ALLOCATE INSERT LOW OLD RTA    03800000
         MVC   2(2,ROUT),0(RTAB)  INSERT NEW UPPER RTA                  03820000
         LA    ROUT,4(ROUT)       UPDATE OUTPUT AREA POINTER            03840000
         CLR   ROEND,ROUT         IS OUTPUT AREA FULL                   03860000
         BH    FRONT              NO - INSERT NEXT EXTENT               03880000
         MVC   0(2,RIN),2(RTAB)                                         03900000
         LA    RTAB,4(RTAB)                                             03920000
         BCTR  RCNT,0                                                   03940000
         B     TEST1                    GO SET UP THIS DADSM WRITE      03960000
TOTALL   OI    SWITCH,RCDALT            SET DADSM RECORD ALTERED SWITCH 03980000
         CLC   0(2,RIN),0(RTAB)   IS ENTIRE EXTENT ALLOCATED.           04000000
         BNE   NOTALL              NO-GO ND INSERT LOW OLD RTA          04020000
         SH    ROUT,FOUR                COMPENSATE FOR OUTPUT PTR STEP  04040000
         B     DECRMNT                  GO UPDATE POINTERS              04060000
NOTALL   TM    SWITCH,DADBYP            IS A WRITE DADSM PENDING        04080000
         BO    CHEXTRTN                 BRANCH IF YES                   04100000
         MVC   0(2,ROUT),0(RIN)          INSERT LOW OLD RTA             04120000
         MVC   2(2,ROUT),0(RTAB)  INSERT NEW UPPER RTA                  04140000
         B     DECRMNT                                                  04160000
*                                                                       04180000
* LOOK FOR AN AVAILABLE HOLE AND UPDATE HOLE COUNTER IF NECESSARY       04200000
*                                                                       04220000
CHEXT    CLC   0(4,RIN),ZEROS     IS EXTENT ZERO                        04240000
         BE    WRITEFNL           WRITE LAST DADSM                      04260000
SEARCH   MVC   SAVEADR(5),IDAREA  SAVE PREVIOUS DADSM CCHHR             04280000
         MVC   IDAREA(5),DADSMADR INSERT SEARCH START ADDRESS           04300000
         LA    R0,CCW1            START OF CHANNEL PROGRAM              04320000
         BAL   R9,CHANNLGO        SEARCH FOR HOLE                       04340000
         LA    R0,1               UPDATE USED HOLE COUNTER              04360000
         AH    R0,UHOLECTR                                              04380000
         STH   R0,UHOLECTR        UPDATE USED HOLE COUNTER              04400000
         MVC   ENEXTADR,IDAREA                                   Y02080 04420002
         MVC   IDAREA(5),SAVEADR  INSERT ID OF THIS DADSM               04440000
AFTERSRH BAL   RBAK,WRITEF5             GO WRITE THIS DADSM RECORD      04460000
         MVC   IDAREA,ENEXTADR          SET UP NEXT OUTPUT ADDR  Y02080 04480002
         MVC   FIVESP,ENEXTADR          SET UP NEXT OUTPUT ADDR  Y02080 04500002
         OI    SWITCH,NEWF5        SET NEW F5 CREATED BIT        A38490 04510020
         B     DUELOOP                                                  04520000
*                                                                       04540000
* THIS SECTION CONVERTS THE OUTPUT FORMAT 5 FROM RTA/RTA+1 TO           04560021
* XXYYZ FORMAT AND WRITES IT TO THE VTOC.                               04580021
*                                                                       04600000
WRITEF5  EQU   *                                                 M2281  04610021
         LA    ROUT,F5OUT               RESET POINTER            M2281  04620021
         TM    SWITCH,WRTFNL            IS WRITE FINAL RCD SW ON        04640000
         BO    CHEXTRTN                 BRANCH IF YES                   04660000
         OI    SWITCH,DADBYP            SET DADSM WRITE PENDING SW      04680000
         B     DUELOOP                  GO PROCESS DADSM                04700000
CHEXTRTN ST    R5,CCW12+4                                               04720000
         STM   R1,R2,FIELD1       SAVE REGISTERS                        04740000
         LA    R5,F5OUT                 INPUT POINTER            M2281  04760021
         LA    ROUT,DS3EXTNT+1          OUTPUT POINTER           M2281  04780021
         LA    R2,26              SET UP EXTENT COUNTER                 04800000
NEXTEXT  LH    R1,DS4DEVSZ+2      TRACK CONSTANT                        04820000
         CLC   0(2,R5),ZEROS      IS THIS EXTENT ZERO                   04840000
         BNE   CALC                     BRANCH IF NOT ZERO       XM2969 04850002
         CH    R2,CLRXTNT               IF R2=26, ALL EXTENTS IN XM2969 04852002
*                                       THIS F5 ARE ZERO         XM2969 04854002
         BNE   CLRZERO                  BRANCH IF NOT EQUAL 26   XM2969 04856002
         OI    ESWITCH2,EF5ZERO         SET BIT TO INDICATE F5   XM2969 04858402
*                                       WITH ALL ZERO EXTENTS    XM2969 04858802
         B     CLRZERO                  CONTINUE                 XM2969 04859202
CALC     EQU   *                        BRANCH LABEL             XM2969 04859602
         SR    R8,R8              CLEAR HIGH ORDER REGISTERS.           04880000
         LR    R6,R8                 BEFORE DIVIDING.                   04900000
         LH    R7,0(R5)           RTA                                   04920000
         LH    R9,2(R5)           RTA+1                                 04940000
         LR    R0,R9              CALCULATE NUBER OF TRACKS             04960000
         SR    R0,R7                   IN EXTENT                        04980000
         CLR   R0,R1              TEST FOR AT LEAST A CYL               05000000
         BNL   MORETH1            TRACKS ARE EQ TO OR GRTR THAN CYL     05020000
         MVC   2(2,ROUT),ZEROS    ZERO CYL FIELD IF NOT AT LEAST ONE    05040000
         STC   R0,4(ROUT)         STORE NUMBER OF TRKS IN EXTENT        05060000
         B     MOVEXTA            GO TO MOVE EXTENT TO OUTPUT           05080000
MORETH1  DR    R6,R1              DIVIDE RTA BY TRACK CONSTANT          05100000
         DR    R8,R1              DIVIDE RTA+1 BY TRACK CONSTANT        05120000
         SR    R9,R7              FIND TOTAL CYLINDERS AND TRACKS       05140000
         LTR   R6,R6              IS LOW RTA CYL ALIGNED                05160000
         BP    NOTCYL             BR IF NOT ALIGNED                     05180000
         STC   R8,4(ROUT)         STORE EXCESS TRKS                     05200000
         B     STORECYL                                                 05220000
NOTCYL   SR    R1,R6              SUBTRACT LOW RTA FROM TRKS/CYL        05240000
         LTR   R9,R9              IS UPPER EXTENT LESS THAN CYL         05260000
         BZ    ADD2               BR IF LESS                            05280000
         BCTR  R9,0                                                     05300000
ADD2     AR    R1,R8              CALCULATE EXCESS TRKS                 05320000
         STC   R1,4(ROUT)         STORE IN OUTPUT F5                    05340000
STORECYL STH   R9,CCW12                                                 05360000
         MVC   2(2,ROUT),CCW12    MOVE CYLINDER TO OUTPUT               05380000
MOVEXTA  MVC   0(2,ROUT),0(R5)    MOVE RTA TO OUTPUT                    05400000
         LA    ROUT,5(ROUT)       INCREMENT OUTPUT POINTER              05420000
         LA    R5,4(R5)           INCREMENT INPUT POINTER               05440000
         BCT   R2,NEXTEXT         RETURN FOR MORE EXTENTS               05460000
CLRZERO  LA    R2,1(R2)           CLEAR EXCESS F5 AREA                  05480000
         MH    R2,FIVE                                                  05500000
         BCTR  R2,K0                    DECREMENT BY ONE         Y02080 05510002
         EX    R2,CLEAR                                                 05520000
         MVC   DS3PTRDS,ENEXTADR        INSERT F5 CHAIN ADDRESS  Y02080 05540002
INSERTF5 EQU   *                                                 M2281  05550021
         MVC   DS3EXTNT(DS3FMTID-DS3EXTNT),DS3EXTNT+1  OPEN      M2281  05560021
*                                       SPACE FOR F5 IDENTIFIER  M2281  05570021
         MVI   DS3FMTID,F5ID            MOVE IN F5 IDENTIFIER    M2281  05580021
         L     R5,CCW12+4                                               05600000
         LM    R1,R2,FIELD1                                             05620000
         MVI   CCW11+4,X'10'      TURN ON SKIP FLAG                     05640000
         LA    R0,CCW6            START OF CHANNEL PROGRAM              05660000
         BAL   R9,CHANNLGO        WRITE DADSM                           05680000
RESTORE  EQU   *                                                 M2281  05700021
         LA    ROUT,F5OUT               RESET OUTPUT POINTER     M2281  05712021
         MVC   IDAREA(5),DS3PTRDS       SET UP NEXT OUTPUT       M2281  05720021
*                                       FORMAT 5 ADDRESS         M2281  05730021
         XC    DS3EXTNT(DS3END-DS3EXTNT),DS3EXTNT  CLEAR OUTPUT  M2281  05740021
*                                       FORMAT 5 AREA            M2281  05750021
         XI    SWITCH,OUTBYP            FLIP/FLOP READ/WRITE SWITCH     05760000
WRTRTN   EQU   *                        BRANCH LABEL             Y02080 05770002
         NI    SWITCH,X'FF'-DADBYP      CLEAR WRITE PENDING SW   Y02080 05780002
         BR    RBAK                                                     05800000
*                                                                       05820000
* THIS SECTION READS A FORMAT 5 DSCB AND CONVERTS IT FROM XXYYZ TO      05840021
* STARTING RTA/ENDING RTA+1 FORMAT.                                     05860021
*                                                                       05880000
SAVEID   MVC   SAVEADR(5),IDAREA                                        05900000
         MVC   FIVESP(5),DS5PTRDS                                       05920000
         NI    SWITCH,X'FF'-FRSTF5      CLEAR 1ST F5 IN CORE SW  Y02080 05940002
         MVC   IDAREA(5),DS5PTRDS                                       05960000
READF5   LA    RIN,DS5AVEXT       RESET INPUT POINTER.                  05980000
         LR    R8,RIN             SET UP POINTER FOR CONVERTED EXTENT.  06000000
         LA    RWRK,26            INSERT MAX NUMBER OF EXTENTE.         06020000
         LA    R0,CCW9            PICK STARTING CCW                     06040000
         MVI   CCW11+4,X'00'      CLEAR SKIP FLAG                       06060000
         BAL   R9,CHANNLGO        READ DADSM                            06080000
         MVC   DS5KEYID+44(90),DS5KEYID+45   REMOVE ID                  06100000
         SR    R6,R6                                                    06120000
TEST0    CLC   0(2,RIN),ZEROS     EXTENT ZERO                           06140000
         BE    INCRIN             YES  INCREMENT REGISTER               06160000
         MVC   CCW12(5),0(RIN)     ALIGN EXTENT TO FULL WORD            06180000
         LH    R7,CCW12+2         LOAD NUMBER OF CYLINDERS              06200000
         MH    R7,DS4DEVSZ+2      MULTIPLY BY TRACK CONSTANT            06220000
         IC    R6,CCW12+4         ODD TRACKS.                           06240000
         AR    R7,R6              ADD ODD TRACKS FOR TOAL TRACKS        06260000
         AH    R7,CCW12           ADD RTA                               06280000
         STH   R7,2(R8)        STORE RTA+1 INTO INPUT CONVERTED AREA.   06300000
         MVC   0(2,R8),CCW12      MOVE RTA TO CONVERTED INPUT AREA.     06320000
         LA    R8,4(R8)           UPDATE POINTER TO NEXT SPACE.         06340000
INCRIN   LA    RIN,5(RIN)         INCREMENT INPUT POINTER               06360000
         BCT   RF,TEST0           PROCESS NEXT EXTENT                   06380000
         LA    RIN,DS5AVEXT       RESET INPUT POINTER.                  06400000
         XC    0(26,R8),0(R8)      CLEAR EXCESS BITS                    06420000
         LA    RWRK,26            RESET COUNT OF EXTENTS.               06440000
         XI    SWITCH,OUTBYP            FLIP/FLOP READ/WRITE SWITCH     06460000
         BZ    RETNBACK                 BRANCH IF READ BEFORE WRITE     06480000
         MVC   IDAREA(5),SAVEADR                                        06500000
RETNBACK BR    RBAK                                                     06520000
*                                                                       06540000
* THIS ROUTINE EXECUTES A CHANNEL PROGRAM.                              06560021
*                                                                       06580000
CHANNLGO EQU   *                        BRANCH LABEL             Y02080 06600002
         MVC   DXDAADDR+K3(K4),IDAREA   IOS SEEK ADDRESS         Y02080 06610002
         STM   RF,R1,IECREGSV+K12       SAVE REGISTERS           Y02080 06620002
         ST    R0,IOBSIOCC              STORE STARTING CCW       Y02080 06640002
         MVI   DXECB,H0                 CLEAR STATUS BYTE OF ECB Y02080 06660002
         EXCP  DXIOB                    EXECUTE CHANNEL PROGRAM  Y02080 06680002
         WAIT  ECB=DXECB                WAIT FOR COMPLETION      Y02080 06700002
         LM    RF,R1,IECREGSV+K12       RESTORE REGISTERS        Y02080 06720002
         TM    DXECB,GOODIO             TEST FOR I/O ERROR       Y02080 06740002
         BCR   1,R9                     IF NO ERROR, BR          O19117 06750019
         SR    RD,RD                    CLEAR ERROR REG          O19117 06760019
         IC    RD,DXEXTSW               INSERT CALLER CODE       Y02080 06770002
         B     XCTLHRE                                           O19117 06780019
*                                                                       06790021
* CONSTANTS                                                             06800021
*                                                                       06810021
ZEROS    DC    F'0'                     FULL WORD OF ZEROS       Y02080 06840002
FIVES    DC    X'05050505'                                              06900000
CLEAR    XC    0(1,ROUT),0(ROUT)  ZERO DADSM AREA                       06940000
FIVE     DC    H'5'                                                     06960000
FOUR     DC    H'4'                                                     06980000
CLRXTNT  DC    H'26'                    CONSTANT OF 26           XM2969 06982002
*                                                                       06990021
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         07000002
*                                                                       07010021
         XCTLTABL ID=(LASTLOAD,3E),SVC=055,LENGTH=,BRT=YES       Y02080 07020002
         EJECT                                                   Y02080 07030002
EOVWKA   DSECT                                                   Y02080 07120002
         IECDSECT                                                       07160000
         EJECT                                                   Y02144 07170002
CCW1     EQU   DXCCW1                                                   07180000
CCW2     EQU   DXCCW2                                                   07200000
CCW3     EQU   DXCCW3                                                   07220000
CCW4     EQU   DXCCW4                                                   07240000
CCW5     EQU   DXCCW5                                                   07260000
CCW6     EQU   DXCCW6                                                   07280000
CCW7     EQU   DXCCW7                                                   07300000
CCW8     EQU   DXCCW8                                                   07320000
CCW9     EQU   DXCCW9                                                   07340000
CCW10    EQU   DXCCW10                                                  07360000
CCW11    EQU   DXCCW11                                                  07380000
CCW12    EQU   DXCCW12                                                  07400000
*                                                                       07410021
         ORG   DXLBL                                                    07420000
         IECSDSL1 (4)                                                   07440000
         EJECT                                                   Y02080 07490002
WORKAREA IECEXTWA EP,D1=(5),D2=(3)      EXTEND WORK AREA         Y02080 07540002
         SPACE 2                                                 Y02080 07590002
WRZERO   EQU   X'80'                                                    08360000
RCDALT   EQU   X'40'                                                    08380000
PRCNTL   EQU   X'20'                                                    08400000
WRTFNL   EQU   X'10'                                                    08420000
FRSTF5   EQU   X'08'                                                    08440000
NEWF5    EQU   X'04'               NEW F5 DSCB CREATED           A38490 08470020
DADBYP   EQU   X'02'                                                    08480000
OUTBYP   EQU   X'01'                                                    08500000
SWITCH   EQU   ESWITCH                  EXTEND SWITCH EQUATE     Y02080 08520002
SAVEADR  EQU   ECOUNT                   CHANNEL PROGRAM WKAREA   Y02080 08540002
IDAREA   EQU   EIDAREA                  CHANNEL PROGRAM WKAREA   Y02080 08560002
DADSMADR EQU   EDADSMAD                 FORMAT 5 CCHHR           Y02080 08580002
UHOLECTR EQU   EHOLECTR                 NUMBER OF USED F0 DSCB'S Y02080 08600002
FIELD1   EQU   IECREGSV+12              REGISTER SAVE AREA       Y02080 08620002
FIVESP   EQU   COUNT2                   CHANNEL PROGRAM WKAREA   Y02080 08640002
F5OUT    EQU   DS3END-104               F5 IN RTA1/RTA2 FORMAT   M2281  08700021
         EJECT                                                   Y02080 08750002
CVT      DSECT                          CVT DSECT                Y02080 08800002
         CVT                                                     Y02080 08810002
         END   IGG0553D                                                 08840000
./  ADD  SSI=61170382,NAME=IGG0553E
 TITLE 'IGG0553E - EXTEND - DADSM UPDATE LOAD 2'                        00020000
IGG0553E CSECT                                                          00026021
*                                                                       00028002
*MODULE NAME = IGG0553E                                                 00030002
*                                                                       00030102
*DESCRIPTIVE NAME = EXTEND - DADSM UPDATE LOAD 2                        00030202
*                                                                       00030302
*COPYRIGHT = NONE                                                       00034102
*                                                                       00044102
*CHANGE ACTIVITY = SEE BELOW                                            00044502
*                                                                       00044702
*          VS1 RELEASE 01 DELETIONS/CHANGES                             00045202
*0000                                                            YM0924 00048402
*          VS1 RELEASE 02 DELETIONS/CHANGES                             00052202
*0000001785,031000                                               X02989 00056002
*3478                                                             MCS   00059802
*3478029400-030000                                                25999 00063602
*          RELEASE 19 DELETIONS                                         00067402
*2580014400-014600,020000,020400-021800,022400,024000-024200,    O19117 00071202
*2580040216-040400                                               O19117 00075002
*2580038600                                                      A30538 00078802
*2580035600,038400                                               A29269 00082602
*          RELEASE 20 DELETIONS                                         00086402
*0930026100-026300,026800                                        A35385 00090202
*0930                                                            M3294  00094002
*0930000260-000320                                               S20201 00097802
*          RELEASE 21 DELETIONS                                         00101602
*1193000230,000600-006200,009800,010200,010800-011000,011600,    M0130  00105402
*1193012200,012400,013000-013200,014000,015000-015200,015600,    M0130  00109202
*1193018800-019000,024800-025200,026800,027600,028020-028300,    M0130  00113002
*1193028800,032000,032400-032600,033850-033900,035260,035507-    M0130  00116802
*1193035521,036400,038300-039200,040200,040580,041000,041800,    M0130  00120602
*1193045800,047400-049400,051000,051200-053150                   M0130  00124402
*1193005400,012350,028200,034200,038400-039000                   S21040 00128202
*0000027830-027860,040408-040560                                 M2281  00132002
*0000026040,026200,026280                                        A51505 00135802
*          RELEASE 21.7 DELETIONS                                       00139602
*0000026760,034880-034920,035528-035591,038600,041000-041760    SA53147 00143402
*          RELEASE 22 DELETIONS                                         00147202
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00151002
*0000000261,000409,001398-001441,001914-002000,002086,002774-    Y02080 00154802
*0000003330,003805,004065-004130,004455,004940-005471,005690,    Y02080 00158602
*0000005743,006195-006730,007600-007800,009200,011200-012000,    Y02080 00162402
*0000012280,012320-012348,012352-012360,012420,012460-012500,    Y02080 00166202
*0000013800-014000,014214,014260-014410,014500,014600,014620-    Y02080 00170002
*0000014650,015800,018800-019000,019400-020200,020500-020700,    Y02080 00173802
*0000021000-021100,022200-024000,025000,025630-025730,025750,    Y02080 00177602
*0000026000-026240,026680,026840,027000-027800,028120,028240,    Y02080 00181402
*0000028800,029600,030200-030920,030984,032000,032300-036000,    Y02080 00185202
*0000038700-039380,039384-039800,040208,040348,040408,040456,    Y02080 00189002
*0000040528,040576-040588,040800,041000-041760,042200-042400,    Y02080 00192802
*0000045800-046000,046400-047200,050400-053020,053400-053600     Y02080 00196602
*0000000030-000150,004721,005592,026200,026320                   Y02078 00200402
*0000                                                            Y02072 00204202
*0000                                                            Y02144 00208002
*0000026750                                                      YM1089 00211802
*0000012240-012250,026730-026760,040264                          YM3048 00212802
*0000006575-006706,015800,051400                                 XM2969 00214802
*0000029700,032000                                               YM3047 00215202
*0000025900,025940                                               YM3995 00215402
*0000026700,026810-026812,030620                                 YM3997 00215502
*                                                                       00215602
*STATUS CHANGE LEVEL 009                                                00219402
*                                                                     * 00223202
*FUNCTION/OPERATION:                                                  * 00227002
*   THIS MODULE WRITES THE UPDATED FORMAT 4 DSCB IF NECESSARY. IT     * 00230802
*   ALSO TESTS AN INDICATOR IN THE I/O SUPPORT WORK AREA TO DETERMINE * 00234602
*   IF A FORMAT 0 DSCB MUST BE WRITTEN OVER A FORMER FORMAT 5 DSCB.   * 00238402
*   IT THEN DEQ'S THE VTOC, FREES THE CORE GOTTEN FOR THE EXTEND WORK * 00242202
*   AREA, AND RETURNS TO THE CALLER.                                  * 00246002
*   IF AN I/O ERROR HAS OCCURRED IN AN EXTEND MODULE OR DURING VTOC   * 00249802
*   CONVERSION, THIS MODULE ISSUES MESSAGE IEC603I WITH CODE=0.       * 00253602
*                                                                     * 00257402
*ENTRY POINT:                                                         * 00261202
*   IGG0553E - ENTRY IS MADE UNDER NORMAL CONDITIONS FROM IGG0553D.   * 00265002
*   ENTRY IS ALSO MADE FROM ALL LOADS OF EXTEND WHEN AN ERROR OCCURS. * 00268802
*                                                                     * 00272602
*INPUT:                                                               * 00276402
*   REGISTER 4 POINTS TO THE I/O SUPPORT WORK AREA.                   * 00280202
*   REGISTER 11 POINTS TO THE EXTEND WORD AREA.                       * 00284002
*   REGISTER 13 IS NON-ZERO IF AN ERROR HAS OCCURRED.                 * 00287802
*   THE I/O SUPPORT WORK AREA IS LAID OUT AS FOLLOWS:                 * 00291602
*                                                                     * 00295402
*          BYTES          AREA                                        * 00299202
*         *******        ******                                       * 00303002
*          100            DSCB FIELD                                  * 00306802
*          176            JFCB                                        * 00310602
*            4            ECB                                         * 00314402
*           40            IOB                                         * 00318202
*           44            DEB                                         * 00322002
*            4            DCB                                         * 00325802
*           96            CCW'S                                       * 00329602
*                                                                     * 00333400
*OUTPUT:                                                              * 00337100
*   IF NECESSARY, THE UPDATED FORMAT 4 DSCB IS WRITTEN TO THE VTOC.   * 00338900
*   A FORMAT 0 DSCB MAY BE WRITTEN OVER A FORMER FORMAT 5 DSCB.       * 00340700
*                                                                     * 00341500
*EXTERNAL ROUTINES:                                                   * 00348000
*        EXCP(0) - READ OR WRITE ON A DIRECT ACCESS DEVICE            * 00354500
*        WAIT(1) - WAIT ON EVENT CONTROL BLOCK                        * 00361000
*        XCTL(7) - TRANSFER CONTROL TO ANOTHER MODULE                 * 00367500
*        DEQ(48) - DEQ THE VTOC                                       * 00374000
*        IECRES  - FREE CORE FOR THE EXTEND WORK AREA                 * 00380502
*        WTO(35) - WRITE MESSAGE TO OPERATOR                          * 00381502
*                                                                     * 00387000
*EXITS:                                                               * 00393500
*   TO EOV -                                                          * 00400000
*   NORMAL - BRANCH TO IFG0554P WITH ONE OF THE FOLLOWING             * 00406502
*            CODES IN REGISTER 13:                                    * 00419500
*            1 - SUCCESSFUL SECONDARY ALLOCATION ON THE CURRENT VOLUME* 00426000
*            4 - SUCCESSFUL SECONDARY ALLOCATION ON A NEW VOLUME      * 00432500
*                                                                     * 00439000
*   ERROR  - BRANCH TO IFG0554P WITH ONE OF THE FOLLOWING             * 00445502
*            ERROR CODES IN REGISTER 13:                              * 00452000
*           -1 - ERROR IN SECONDARY ALLOCATION ON THE CURRENT VOLUME  * 00458500
*           -4 - ERROR IN SECONDARY ALLOCATION ON THE NEW VOLUME      * 00465000
*           -8 - UNABLE TO CONVERT THE VTOC BECAUSE OF ONE OF THE     * 00467002
*                FOLLOWING ERRORS:                                    * 00469002
*              - OVERLAPPING EXTENTS IN THE VTOC                      * 00471002
*              - OVERLAPPING DOS SPLIT CYLINDER EXTENTS IN THE VTOC   * 00473002
*              - IGG0325Z ZAPPED TO PREVENT VTOC CONVERSION WHEN THE  * 00475002
*                DIRF BIT IS SET IN THE FORMAT 4 DSCB.                * 00477002
*              - DOS STACKED PACK FORMAT                              * 00478002
*          -16 - PERMANENT I/O ERROR                                  * 00480002
*                                                                     * 00482002
*   TO OS CVOL CATALOG -                                              * 00484002
*   NORMAL - XCTL TO IGC0002H WITH THE FOLLOWING CODE IN REGISTER 13: * 00486002
*            2 - SUCCESSFUL SECONDARY ALLOCATION OF THE OS CATALOG    * 00488002
*                ON THE CURRENT VOLUME                                * 00490002
*                                                                     * 00492002
*   ERROR  - XCTL TO IGC0002H WITH ONE OF THE FOLLOWING ERROR CODES   * 00494002
*            IN REGISTER 13:                                          * 00496002
*           -2 - ERROR IN SECONDARY ALLOCATION OF THE OS CATALOG      * 00498002
*           -8 - UNABLE TO CONVERT THE VTOC BECAUSE OF ONE OF THE     * 00500002
*                FOLLOWING ERRORS:                                    * 00502002
*              - OVERLAPPING EXTENTS IN THE VTOC                      * 00504002
*              - OVERLAPPING DOS SPLIT CYLINDER EXTENTS IN THE VTOC   * 00506002
*              - IGG0325Z ZAPPED TO PREVENT VTOC CONVERSION WHEN THE  * 00508002
*                DIRF BIT IS SET IN THE FORMAT 4 DSCB.                * 00510002
*              - DOS STACKED PACK FORMAT                              * 00512002
*          -16 - PERMANENT I/O ERROR                                  * 00514002
*                                                                     * 00516002
*   TO VSAM CATALOG - IN ALL CASES, REGISTER 1 CONTAINS ZERO TO  X02989 00554802
*            INDICATE A RECURSIVE CALL AND REGISTER 14 IS SET    X02989 00555202
*            TO ZERO TO REFLECT THAT THE RETURN IS FROM DADSM    X02989 00555602
*            EXTEND.                                             X02989 00556002
*   NORMAL - XCTL TO IGG0CLA1 WITH THE FOLLOWING CODE IN         XO2989 00556402
*            REGISTER 13:                                        X02989 00556802
*          129 - SUCCESSFUL SECONDARY ALLOCATION OF THE VSAM     X02989 00557602
*                DATA SPACE ON THE CURRENT VOLUME                X02989 00558002
*                                                                X02989 00558202
*   ERROR  - XCTL TO IGG0CLA1 WITH ONE OF THE FOLLOWING ERROR    X02989 00558402
*            CODES IN REGISTER 13:                               X02989 00559102
*           -8 - UNABLE TO CONVERT THE VTOC BECAUSE OF ONE OF THE     * 00559302
*                FOLLOWING ERRORS:                                    * 00559502
*              - OVERLAPPING EXTENTS IN THE VTOC                      * 00559702
*              - OVERLAPPING DOS SPLIT CYLINDER EXTENTS IN THE VTOC   * 00559902
*              - IGG0325Z ZAPPED TO PREVENT VTOC CONVERSION WHEN THE  * 00560102
*                DIRF BIT IS SET IN THE FORMAT 4 DSCB.                * 00560302
*              - DOS STACKED PACK FORMAT                              * 00560702
*          -12 - UNABLE TO RAC DEFINE NEW VOLUME FOR A RAC     @Z40RSGD 00561104
*                DEFINED DATA SET.                             @Z40RSGD 00561204
*          -16 - PERMANENT I/O ERROR                             X02989 00561502
*         -129 - ERROR IN SECONDARY ALLOCATION OF THE VSAM DATA  X02989 00564702
*                SPACE                                           X02989 00566302
*                                                                     * 00572702
*ATTRIBUTES: REENTRANT                                                * 00574302
*                                                                     * 00577502
*OTHER MACROS USED:                                                   * 00583502
*   CVT - TO REFERENCE THE CVT                                        * 00589502
*   UCB - TO REFERENCE THE UCB                                        * 00595502
*   IECDSECT - TO DEFINE THE I/O SUPPORT WORK AREA                    * 00601502
*   IECSDSL1 - TO SYMBOLICALLY ADDRESS DSCB'S                         * 00607502
*   IECEXTWA - TO DEFINE THE EXTEND WORK AREA                         * 00608502
*                                                                     * 00613502
*STORAGE: PROGRAM CODE CSECT - LESS THAN 1024 BYTES                   * 00655502
*         EXTEND WORK AREA - AS DEFINED IN THE IECEXTWA MACRO    XM2969 00657502
*         RPS WORK AREA - LENGTH IS DEFINED IN THE IECRPS MACRO  XM2969 00670602
*         I/O SUPPORT WORK AREA                                       * 00673002
*                                                                       00673300
*REGISTER USAGE                                                         00680000
R0       EQU   0                                                        00700000
R1       EQU   1                                                        00720000
R2       EQU   2                                                        00740000
RBASE    EQU   3                        BASE REGISTER            Y02080 00760002
RCORE    EQU   4                        EOV WKA ADDRESSABILITY   Y02080 00780002
R5       EQU   5                                                        00800000
R6       EQU   6                                                        00820000
R7       EQU   7                                                        00840000
R8       EQU   8                                                        00860000
R9       EQU   9                                                        00880000
RA       EQU   10                                                       00900000
EXWKA    EQU   11                       EXTEND WORK AREA ADDRESS Y02080 00920002
RC       EQU   12                                                       00940000
RD       EQU   13                                                       00960000
RE       EQU   14                                                       01000000
RF       EQU   15                                                       01040000
RWRK     EQU   15                                                       01060000
*                                                                       01205021
* OTHER EQUATES                                                         01210021
*                                                                       01215021
K2       EQU   2                        CONSTANT OF 2            Y02080 01217002
K4       EQU   4                        CONSTANT OF 4            XM2969 01217502
K7       EQU   7                        CONSTANT OF 7            XM2969 01218002
K96      EQU   96                       CONSTANT OF 96           Y02080 01219002
C4       EQU   4                        FOUR CHARACTERS          S20201 01222020
CA       EQU   120                      DISP TO AVT PTR IN W.A.  S20201 01226020
DW       EQU   8                        EIGHT BYTES              Y02080 01228002
DIRFBIT  EQU   X'04'                    VTOC INTERRUPT BIT       O19117 01230019
CATALOG  EQU   X'02'                    EXTENDING AN OS CATALOG  YM3047 01232002
VSAMID   EQU   X'81'                    VSAM CATALOG ID          X02989 01234902
WRZERO   EQU   X'80'                    WRITE FORMAT 0 DSCB      M0130  01238021
X08      EQU   X'08'                    CONSTANT OF X'08'        S21040 01244021
X10      EQU   X'10'                    I/O ERROR                S21040 01252021
X20      EQU   X'20'                    EOV I/O ERROR TEST       Y02078 01253002
UUU      EQU   37                       DISP. TO UUU IN MESSAGE  Y02078 01254002
VOLSER   EQU   41                       DISP. TO VOLSER IN MSG   Y02078 01255002
FRSTF5   EQU   X'08'                    IST F5 IN CORE SW        XM2969 01255502
ZEROFLAG EQU   X'00'                    ZERO FLAGS FOR READ      XM2969 01256002
RDCOUNT  EQU   X'8C'                    READ COUNT               XM2969 01256502
WRTCCW   EQU   X'0D'                    WRITE CCW CODE           XM2969 01257002
READCCW  EQU   X'0E'                    READ CCW CODE            XM2969 01257502
RACERROR EQU   X'40'                    RACDEF FAILED          @Z40RSGD 01259504
RACCODE  EQU   12                       RACDEF FAILED          @Z40RSGD 01259904
*                                                                       01260000
         BALR  RBASE,0                                                  01340000
         USING CHKIOERR,RBASE                                           01360000
         USING EOVWKA,RCORE             EOV W/A ADDRESSABILITY   Y02080 01380002
         USING EXTNDWKA,EXWKA           WORK AREA ADDRESSABILITY Y02080 01400002
         USING CVT,RF                   CVT BASE                        01420000
*                                                                       01420721
* THIS SECTION DETERMINES IF THE FORMAT 4 DSCB MUST BE REWRITTEN.       01421402
*                                                                       01422121
CHKIOERR EQU   *                                                 O19117 01423019
         XI    DS4VTOCI,DIRFBIT         SET/RESET DIRF BIT       Y02080 01426002
         LTR   RD,RD                    TEST FOR NORMAL ENTRY    O19117 01444019
         BZ    START                    IF NORMAL, BR            O19117 01447019
         TM    DS4VTOCI,DIRFBIT         TEST IF DIRF BIT WAS     Y02080 01450002
*                                       PREVIOUSLY SET           Y02080 01451002
         BO    EXITHERE                 IF YES, BR               O19117 01453019
         TM    ECB,X'20'                Q - I/O ERROR            O19117 01456019
         BZ    EXITHERE                 IF YES, BR               O19117 01459019
         TM    DXEXTSW,X10              TEST FOR I/O ERROR       Y02080 01460002
         BO    EXITHERE                 BRANCH IF I/O ERROR      M0130  01461021
         TM    DXEXTSW,X08              TEST IF VTOC COULD NOT   Y02078 01462002
*                                       BE CONVERTED             Y02078 01463002
         BO    EXITHERE                 YES, DO NOT REWRITE F4   Y02078 01464002
         B     WRITEF4                                           O19117 01468019
*                                                                       01480000
* THIS SECTION DETERMINES IF A FORMAT 0 DSCB MUST BE WRITTEN.           01500021
* IF SO, IT WRITES IT.                                                  01520021
*                                                                       01540000
START    EQU   *                                                 M0130  01550021
         TM    SWITCH,WRZERO            MUST AN F0 BE WRITTEN?   M0130  01560021
         BNZ   WRITEF0                  BRANCH IF F0 MUST BE     XM2969 01560502
*                                       WRITTEN                  XM2969 01561002
         TM    ESWITCH2,EF5ZERO         DOES F5 WITH ALL ZERO    XM2969 01561502
*                                       EXTENTS EXIST            XM2969 01562002
         BNO   WRITEF4                  BR TO CHECK F4 UPDATE IF XM2969 01562502
*                                       A F5 WITH ALL ZERO       XM2969 01563002
*                                       EXTENTS DOES NOT EXIST   XM2969 01563602
         TM    SWITCH,FRSTF5            IS FIRST F5 IN CORE      XM2969 01564502
*                                       INDICATOR SET            XM2969 01565002
         BO    WRITEF4                  BRANCH IF INDICATOR SET  XM2969 01565502
         MVI   CCW11+K4,ZEROFLAG        ZERO FLAGS ON READ CCW   XM2969 01566002
         MVI   CCW11+K7,RDCOUNT         INSURE CORRECT COUNT     XM2969 01566502
         MVC   IDAREA,EXTCCHHR          MOVE CCHHR OF PREV F5    XM2969 01567002
         LA    R0,CCW9                  START OF CHANNEL PGM     XM2969 01567502
         BAL   R7,CHANNLGO              BAL TO READ PREVIOUS F5  XM2969 01568002
         MVC   COUNT,DS5PTRDS           SAVE CHAIN ADDR TO WRITE XM2969 01568502
         XC    DS5PTRDS,DS5PTRDS        ZERO CHAIN POINTER       XM2969 01569002
         MVI   CCW11,WRTCCW             CHANGE READ CCW TO WRITE XM2969 01569502
         LA    R0,CCW9                  START OF CHANNEL PGM     XM2969 01570002
         BAL   R7,CHANNLGO              BAL TO WRITE F5          XM2969 01570502
         MVI   CCW11,READCCW            RESTORE READ CCW         XM2969 01571002
WRITEF0  EQU   *                        WRITE AN F0 DSCB         XM2969 01571502
         MVC   IDAREA(5),FIVESP   MOVE IN SAVED ADDRESS                 01600000
         LA    R0,CCW4+4                PICK UP ZERO FIELD ADDR.        01620000
         ST    R0,CCW8             STORE IN SEARCH ID EQ CCW.           01640000
         MVI   CCW8,X'0D'         RESTORE THE OP CODE.                  01660000
         MVI   CCW8+7,X'01'       INSERT COUNT FIELD                    01680000
         MVI   CCW8+4,X'60'                                             01700000
         MVI   CCW11+4,X'10'      TURN ON SKIP FLAG.                    01720000
         MVI   CCW11+7,X'8C'      INSURE CORRECT COUNT FOR WRITE CHECK. 01740000
         LA    R0,CCW6            START SEARCH AT CCW6                  01760000
         BAL   R7,CHANNLGO        EXECUTE CHANNEL PROGRAM               01780000
         LH    RWRK,UHOLECTR                                            01800000
         BCTR  RWRK,0                                                   01820000
         STH   RWRK,UHOLECTR      UPDATE USED HOLES COUNTER.            01840000
*                                                                       01860000
* THIS SECTION UPDATES THE FORMAT 4 DSCB AND WRITES IT BACK.            01880002
*                                                                       01920000
WRITEF4  EQU   *                                                 O19117 02030019
         LH    RWRK,DS4DSREC            LOAD NUMBER OF F0 DSCB'S Y02080 02031002
         SH    RWRK,UHOLECTR            SUBTRACT USED F0 DSCB'S  Y02080 02032002
         STH   RWRK,DS4DSREC            STORE NEW NUMBER OF F0'S Y02080 02033002
         LM    R5,RA,CHANPROG           FETCH CCW'S 1 THRU 3     O19117 02040019
         ALR   R5,EXWKA                 RESOLVE                  Y02080 02050002
         ALR   R7,RCORE                   CORE                   Y02080 02060002
         ALR   R9,RCORE                     ADDRESSES            Y02080 02070002
         STM   R5,RA,CCW1               STORE CCW'S 1 THRU 3     O19117 02080019
         LM    R7,RA,CHANPROG+24        FETCH CCW'S 5 THRU 6     O19117 02090019
         ALR   R7,RCORE                 RESOLVE CORE             Y02080 02100002
         ALR   R9,RCORE                   ADDRESSES              Y02080 02110002
         STM   R5,RA,CCW4               STORE CCW'S 4 THRU 6     O19117 02120019
         MVC   IDAREA(5),VTOCADR        SEARCH ADDRESS FOR IOB          02200000
         LA    R0,CCW1                  START AT CCW1            O19117 02410019
         BAL   R7,CHANNLGO              GO TO WRITE FORMAT 4            02440000
*                                                                       02460000
* THIS SECTION DEQ'S THE VTOC.                                          02500002
*                                                                       02540000
EXITHERE MVC   MAJOR(8),VTOCNAME                                        02560000
         L     R7,DXDEBUCB             R7 = POINTER TO UCB         AAAA 02561016
         USING UCBOB,R7                                            AAAA 02562016
NOSUB    MVC   MINOR(6),SRTEVOLI       SAVE VOLUME SERIAL NUMBER   AAAA 02574016
         MVI   ENQAREA,X'FF'                                            02580000
         SR    R1,R1                    ZERO REGISTER            Y02080 02582002
         STH   R1,ENQAREA+K2            CLEAR FOR DEQ MACRO      Y02080 02584002
         TM    ETYPEFLG,RSMC            LEAVE SMC FOR USER       Y02080 02586002
         BNO   DEQVTOC                  BRANCH IF YES            Y02080 02588002
         DEQ   (MAJOR,MINOR,6,SYSTEMS),RMC=STEP,MF=(E,ENQAREA)   YM3995 02590002
*                                                                       02592002
         NI    DSMADTB2,X'FF'-DSMSMCE-DSMVTOCR  RESET VTOC       YM3995X02593002
                                        ENQ'ED SMC SWITCHES      YM3995 02594002
         B     TSTIOERR                 GO TEST FOR I/O ERROR    YM3995 02595002
*                                                                       02596002
DEQVTOC  EQU   *                        DEQ THE VTOC NON-SMC     Y02080 02598002
         DEQ   (MAJOR,MINOR,6,SYSTEMS),MF=(E,ENQAREA)  DEQ VTOC  Y02080 02600002
*                                                                       02602002
         NI    DSMADTB2,X'FF'-DSMVTOCR  RESET VTOC ENQ'ED SWITCH Y02144 02604002
*                                                                       02606002
* IF AN I/O ERROR HAS OCCURRED, THIS SECTION ISSUES MESSAGE IEC603I.    02608002
*                                                                       02610002
TSTIOERR EQU   *                        TEST FOR I/O ERROR       Y02078 02612002
         TM    ECB,X20                  TEST FOR EOV I/O ERROR   Y02078 02614002
         BZ    BUILDMSG                 BRANCH IF EOV I/O ERROR  Y02078 02616002
         TM    DXEXTSW,X10              TEST IF ALLOCATE I/O ERR Y02078 02618002
         BNO   RESTRIOB                 BRANCH IF NO I/O ERROR   Y02078 02620002
BUILDMSG EQU   *                        BUILD THE MESSAGE        Y02078 02622002
         MVC   F5DSCB(MSGEND-ERRMSG),ERRMSG  MOVE IN MESSAGE     Y02078 02624002
         MVC   F5DSCB+UUU(L'UCBNAME),UCBNAME  MOVE IN EBCDIC UCB Y02078 02626002
*                                       CHANNEL/UNIT ADDRESS     Y02078 02628002
         MVC   F5DSCB+VOLSER(L'SRTEVOLI),SRTEVOLI  MOVE IN VOLID Y02078 02630002
         WTO   MF=(E,F5DSCB)            ISSUE ERROR MESSAGE      Y02078 02632002
*                                                                       02634002
RESTRIOB EQU   *                        RESTORE CCW ADDR IN IOB  Y02078 02636002
         LA    R7,DXCCW                                                 02640000
         ST    R7,IOBSTART-1      RESTORE START ADDRESS FOR EOV         02660000
*                                                                       02669002
* THIS SECTION RESTORES THE DEB AVT POINTER IF AN RPS WORK AREA EXISTS. 02670002
*                                                                       02672002
         TM    DSMADTB1,DSMRPSAP        TEST IF RPS APPENDAGE    YM3048X02673002
                                        WAS LOADED               YM3048 02674002
         BNO   CONTINUE                 BRANCH IF NOT            YM3048 02675002
         L     R1,DXDEBAPP              GET PTR TO RPS WORK AREA YM3048 02676002
         MVC   DXDEBAPP(C4),CA(R1)      RESTORE DEB AVT POINTER SA53147 02677002
         NI    DSMADTB1,X'FF'-DSMRPSAP  RESET RPS APP LOADED BIT Y02144 02681402
*                                                                       02682002
* THIS SECTION PREPARES TO BRANCH TO EOV BY LOADING THE ENTRY           02684002
* POINT ADDRESS.                                                        02688002
*                                                                       02692021
CONTINUE EQU   *                                                SA53147 02694002
         TM    DXEXTSW,CATALOG          TEST FOR CVOL CATALOG    YM3047 02696002
         BO    LOADCODE                 BRANCH IF YES            YM3047 02698002
         TM    DXEXTSW,VSAMID           TEST FOR ENTRY FROM VSAM Y02080 02700002
         BO    LOADCODE                 BRANCH IF YES            Y02080 02720002
         IECRES LOAD,EXTPR=(EXWKA),MODNM=EOVLOAD,BRANCH=NO       Y02080 02740002
         L     RE,WTGMODEP              LOAD ENTRY POINT ADDRESS Y02080 02760002
*                                                                       02789021
* THIS SECTION LOADS THE PROPER EOV RETURN CODE.                        02792021
*                                                                       02795021
LOADCODE EQU   *                        LOAD ERROR CODE          Y02080 02796002
         TM    ECB,X'20'                TEST FOR EOV I/O ERROR          02800000
         BZ    EOVIOERR                 BRANCH IF AN I/O ERROR   M0130  02806021
         TM    DXEXTSW,X10              TEST IF ALLOCATE I/O ERR Y02080 02812002
         BO    EOVIOERR                 BRANCH IF YES            M0130  02818021
         TM    DXEXTSW,X08              TEST IF UNABLE TO        Y02080 02824002
*                                       CONVERT THE VTOC         Y02080 02825002
         BO    DOSVTOC                  BRANCH IF YES            M0130  02830021
         TM    DXEXTSW,RACERROR         RACDEF FAIL ON EXTEND  @Z40RSGD 02832004
         BZ    NORACERR                 NO-CONTINUE            @Z40RSGD 02834004
         LA    RD,RACCODE               YES-MARK RAC ERROR     @Z40RSGD 02836004
NORACERR EQU   *                        CONTINUE               @Z40RSGD 02838004
         LTR   RD,RD                    TEST FOR NORMAL EXIT            02840000
         BP    SETNEG                   BR IF NOT TO SET NEGATIVE CODE  02860000
         IC    RD,DXEXTSW               INSERT ENTRY CODE        Y02080 02880002
         B     TESTRTRN                 TEST RETURN                     02900000
EOVIOERR EQU   *                                                 M0130  02903021
         LA    RD,X10                   LOAD I/O ERROR CODE      M0130  02906021
         B     SETNEG                   GO NEGATE REGISTER 13    M0130  02909021
DOSVTOC  EQU   *                                                 M0130  02912021
         LA    RD,X08                   UNCONVERTIBLE VTOC ERROR M0130  02915021
SETNEG   LNR   RD,RD                    SET NEGATIVE CODE               02920000
*                                                                       02940021
* THIS SECTION FREES THE EXTEND WORK AREA(S), RESTORES REGISTERS,       02960002
* AND XCTL'S TO VSAM CATALOG OR OS CVOL CATALOG OR BRANCHES TO EOV.     02970002
*                                                                       02980021
TESTRTRN EQU   *                        DETERMINE RETURN MODULE  Y02080 03020002
         LR    R8,RCORE                 SAVE EOV WORK AREA ADDR  Y02080 03030002
         STM   RBASE,RE,DXLBL           SAVE REGISTERS 3-14      Y02080 03040002
         IECRES FREE,PREFIX=FIRST,A=(EXWKA)  FREE EXTEND WKAS    Y02080 03050002
         LM    RBASE,RE,DXLBL-DXLBL(R8)  RESTORE REGISTERS 3-14  Y02080 03060002
*                                                                       03064002
         XC    FIELD1(DW),FIELD1        PREPARE TO XCTL          Y02080 03066002
         LA    RF,FIELD1+DW             POINT TO XCTL NAME       Y02080 03068002
         ST    RF,FIELD1                                         Y02080 03070002
         TM    DXEXTSW,CATALOG          TEST FOR ENTRY FROM OS   YM3047X03072002
                                        CVOL CATALOG             YM3047 03074002
         BNO   VSAMTEST                 BRANCH IF NOT            YM3047 03076002
         MVC   FIELD1+DW(X08),CVOLMOD   SET UP TO XCTL TO CVOL   YM3047 03078002
         B     NOTVSAM                  GO RESTORE REGISTERS     YM3047 03080002
VSAMTEST EQU   *                        TEST IF ENTRY FROM VSAM  YM3047 03082002
         TM    DXEXTSW,VSAMID           TEST IF ENTRY FROM VSAM  Y02080 03084002
         BNO   NOTVSAM                  BRANCH IF NOT VSAM       X02989 03094002
         MVC   FIELD1+X08(X08),VSAMMOD  SET UP TO XCTL TO VSAM   X02989 03096002
         SR    R1,R1                    INDICATE RECURSIVE CALL  X02989 03096402
         SR    RE,RE                    RETURN FROM DADSM EXTEND X02989 03096802
NOTVSAM  EQU   *                        BRANCH POINT IF NOT VSAM X02989 03098002
         L     RF,CVTPTR                CVT POINTER              X02989 03100002
         L     RF,CVTTCBP               TCB ADDRESS                     03120000
         L     RF,4(RF)                 POINTER TO SVRB ADDRESS         03140000
         L     RF,0(RF)                                                 03160000
         TM    DXEXTSW,VSAMID           TEST IF ENTRY FROM VSAM  Y02080 03164002
         BO    VSAMRTRN                 BRANCH IF FROM VSAM      Y02080 03168002
         TM    DXEXTSW,CATALOG          TEST FOR CVOL CATALOG    YM3047 03170002
         BO    VSAMRTRN                 BRANCH IF ENTRY FROM     YM3047X03172002
                                        OS CVOL CATALOG          YM3047 03174002
*                                                                       03176002
         LM    R2,RC,96(RF)             RESTORE  REGISTERS FOR EOV      03180000
         IECRES BRANCH,EPA=(RE)         RETURN TO EOV            Y02080 03190002
*                                                                       03194002
VSAMRTRN EQU   *                        XCTL TO VSAM OR CATALOG  YM3047 03200002
         LM    R2,RC,K96(RF)            RESTORE REGS FOR VSAM    Y02080 03210002
         XCTL  MF=(E,(1)),SF=(E,FIELD1)                                 03220000
*                                                                       03620000
* THIS ROUTINE EXECUTES A CHANNEL PROGRAM.                              03640021
*                                                                       03660000
CHANNLGO MVI   ECB,X'00'                                                03680000
         MVC   SEEK+3(4),IDAREA        INSERT SEEK ADDR INTO IOB.       03700000
         ST    R0,IOB+16                                                03720000
         EXCP  IOB                                                      03740000
         WAIT  ECB=ECB                                                  03760000
         TM    ECB,X'20'                TEST FOR I/O ERROR              03780000
         BCR   1,R7                     BR IF NO ERROR                  03800000
         B     EXITHERE                 GO TO EXIT ROUTINE              03820000
*                                                                       03830021
* CONSTANTS                                                             03840021
*                                                                       03850021
ERRMSG   WTO   'IEC603I VTOC ERRORS MAY EXIST ON UUU,VOLSER,0',  Y02078X03851002
               ROUTCDE=(4,10),DESC=4,MF=L                        Y02078 03852002
MSGEND   EQU   *                        MSG DELIMITER            Y02078 03853002
CVOLMOD  DC    CL8'IGC0002H'            CATALOG RETURN MOD NAME  YM3047 03855002
VSAMMOD  DC    CL8'IGG0CLA1'            VSAM RETURN MODULE NAME  X02989 03938102
VTOCNAME DC    C'SYSVTOC '                                              04000000
*                                                                       04027602
* CHANNEL PROGRAMS                                                      04028802
*                                                                       04030002
CHANPROG DS    0F                                                O19117 04031202
*CCW1 - SEARCH ID                                                       04032402
         DC    X'31'                                             O19117 04033602
         DC    AL3(IDAREA-EXTNDWKA)     SID ON F4 CCHHR          Y02080 04034802
         DC    X'4000'                                           O19117 04036002
         DC    H'5'                                              O19117 04037202
*CCW2 - TIC                                                             04038402
         DC    X'08'                                             O19117 04039602
         DC    AL3(DXCCW1-DXLBL)        TIC TO CCW1              Y02080 04040802
         DC    F'0'                                              O19117 04042002
*CCW3 - WRITE DATA                                                      04043202
         DC    X'05'                                             O19117 04044402
         DC    AL3(IECSDSF4-DXLBL)      WRITE FORMAT 4 DSCB      Y02080 04045602
         DC    X'4000'                                           O19117 04046802
         DC    H'96'                                             O19117 04048002
*CCW4 - SEARCH ID (WILL BE DUPLICATED FROM CCW1)                        04049202
*CCW5 - TIC                                                             04050402
         DC    X'08'                                             O19117 04051602
         DC    AL3(DXCCW4-DXLBL)        TIC BACK TO CCW4         Y02080 04052802
         DC    F'0'                                              O19117 04054002
*CCW6 - READ DATA                                                       04055202
         DC    X'06'                                             O19117 04056402
         DC    AL3(IECSDSF4-DXLBL)      WRITE CHECK CCW          Y02080 04057602
         DC    X'1000'                  SUPPRESS DATA TRANSFER   Y02080 04058002
         DC    H'96'                    WRITE LENGTH             Y02080 04058802
*                                                                       04060000
* TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                       04080002
*                                                                       04090021
         XCTLTABL ID=(EOVLOAD,IFG0554P),SVC=055,LENGTH=,BRT=YES  Y02080 04100002
         EJECT                                                   Y02080 04120002
*                                                                       04184021
* I/O SUPPORT WORK AREA                                                 04192021
*                                                                       04200000
EOVWKA   DSECT                          EOV WORK AREA            Y02080 04220002
         IECDSECT                                                       04260000
         EJECT                                                   Y02144 04270002
CCW1     EQU   DXCCW1                                                   04280000
CCW2     EQU   DXCCW2                                                   04300000
CCW3     EQU   DXCCW3                                                   04320000
CCW4     EQU   DXCCW4                                                   04340000
CCW5     EQU   DXCCW5                                                   04360000
CCW6     EQU   DXCCW6                                                   04380000
CCW7     EQU   DXCCW7                                                   04400000
CCW8     EQU   DXCCW8                                                   04420000
CCW9     EQU   DXCCW9                                                   04440000
CCW10    EQU   DXCCW10                                                  04460000
CCW11    EQU   DXCCW11                                                  04480000
CCW12    EQU   DXCCW12                                                  04500000
*                                                                       04510021
         ORG   DXLBL                                                    04520000
         IECSDSL1 (4)                                                   04540000
*                                                                       04560000
SEEK     EQU   DXDAADDR                                                 04620000
ECB      EQU   DXECB                                                    04960000
DEB      EQU   DXDEB                                                    04980000
IOB      EQU   DXIOB                                                    05000000
DCB      EQU   DXDCB                                                    05020000
FIELD1   EQU   DXLBL                    XCTL PARAMETER LIST      Y02080 05040002
ENQAREA  EQU   DXLBL                    DEQ PARAMETER LIST       Y02080 05060002
MAJOR    EQU   ENQAREA+16               DEQ MAJOR NAME           Y02080 05080002
MINOR    EQU   ENQAREA+24               DEQ MINOR NAME           Y02080 05100002
         EJECT                                                   Y02080 05120002
WORKAREA IECEXTWA EP,D1=(5),ADT=YES     EXTEND WORK AREA         XM2969 05140002
SWITCH   EQU   ESWITCH                  EQUATE FOR ESWITCH       Y02080 05160002
COUNT    EQU   ECOUNT                   EQUATE FOR ECOUNT        Y02080 05180002
VTOCADR  EQU   EVTOCADR                 EQUATE FOR EVTOCADR      Y02080 05200002
IDAREA   EQU   EIDAREA                  EQUATE FOR EIDAREA       Y02080 05220002
UHOLECTR EQU   EHOLECTR                 EQUATE FOR EHOLECTR      Y02080 05240002
FIVESP   EQU   COUNT2                   EQUATE FOR COUNT2        Y02080 05260002
         EJECT                                                   Y02080 05280002
CVT      DSECT                                                          05320000
         CVT                            CVT DSECT                Y02080 05340002
         EJECT                                                   Y02080 05360002
UCB      DSECT                                                     AAAA 05366016
         IEFUCBOB                                                  AAAA 05372016
         END   IGG0553E                                                 05380000
./  ADD  SSI=32510347,NAME=IGG0553F
   TITLE 'IGG0553F - EXTEND - INTERFACE TO VTOC CONVERSION ROUTINE'     00100002
IGG0553F CSECT                                                          00300021
*                                                                       00400021
* MODULE NAME = IGG0553F                                                00450002
*                                                                       00460002
* DESCRIPTIVE NAME = EXTEND - INTERFACE TO VTOC CONVERSION ROUTINE      00470002
*                                                                       00480002
* COPYRIGHT = NONE                                                      00490002
*                                                                       00492002
* CHANGE ACTIVITY = SEE BELOW                                           00494002
*                                                                       00500021
*         RELEASE 21 - NEW MODULE                                       00600021
*0000                                                            M0124  00650021
*         RELEASE 22 - DELETIONS/CHANGES                                00700021
*         VS2 RELEASE 02 - DELETIONS/CHANGES                            00800002
*0000000500-000700,008000,017000,020000-021000,025000,027500,    Y02080 00800102
*0000028400-028600,031000-033436,037000,043000,043600-044200,    Y02080 00800202
*0000047000,049000,051000-054000,062000,063100,063800-065388,    Y02080 00800302
*0000066200,076000-077000,090000-091000,098200,108000-109000,    Y02080 00800402
*0000111000-114000,117000-122000,125000-128000,131000-135000,    Y02080 00800502
*0000141000-142500,151000-154000,156200,159000,161000,162100-    Y02080 00800602
*0000168000,170000,172000-173000,175000,177000-205000,207000-    Y02080 00800702
*0000253000,260000-262000,264000,266000,275000,284000,286000,    Y02080 00800802
*0000290000,293000,296000-297000,304000-307000,321000-323000,    Y02080 00800902
*0000323600,324400,324800,325200,327000-330000,333000-334500,    Y02080 00801002
*0000336000,337600-351000,370000-371000,374000-554600            Y02080 00801102
*0000072000-073000,273000,332000                                 Y02078 00801202
*0000021000-021600,172000-173000,261000-266500                   Y02144 00801302
*0000                                                            YM3047 00801402
*                                                                       00900021
*                                                                       01000021
*         STATUS CHANGE LEVEL 000                                       01100021
*0000001000-002000,029000-031000,034000-037000,040000-042000,    M0130  01110021
*0000044000,046000-058000,064000-068000,084000,098000,119000,    M0130  01120021
*0000136000-138000,148000,150000,156000,161000,166000-168000,    M0130  01130021
*0000172000-173000,212000-238000,240000-241000,246000-247000,    M0130  01140021
*0000261000-262000,266000,281000,283000,286000-289000,296000,    M0130  01150021
*0000298000-300000,302000-318000,324000-325000,338000,342000,    M0130  01160021
*0000353000-369000,374000-377000,532000-533000,548000            M0130  01170021
*                                                                       01200021
*********************************************************************** 01300021
*                                                                       01400021
* FUNCTION - THIS MODULE IS THE INTERFACE BETWEEN THE EXTEND ROUTINE    01500021
*    AND THE ALLOCATE VTOC CONVERT ROUTINE.  IT ISSUES A GETMAIN FOR    01600021
*    THE ALLOCATE WORK AREA (VIA AN IECRES GET) AND INITIALIZES IT.     01700002
*    THIS MODULE STORES THE EXTEND REGISTERS AND PASSES CONTROL TO THE  01800021
*    CONVERT ROUTINE.  UPON COMPLETION THE CONVERT ROUTINE PASSES       01900021
*    CONTROL BACK TO THIS MODULE.  IT WILL THEN RELOAD THE EXTEND       02000002
*    REGISTERS AND RE-EXECUTE THE CHANNEL PROGRAM TO READ IN THE        02100002
*    FORMAT 4 DSCB AND SEARCH FOR A DUPLICATE NAME DSCB IF EXTENDING    02150002
*    ON A NEW VOLUME.                                                   02160002
*                                                                       02200021
* ENTRY POINTS -                                                        02300021
*         IGG0553F - ONLY ENTRY POINT TO THIS MODULE.  ENTRY IS MADE    02400021
*         FROM IGG0553A OR THE ALLOCATE CONVERT ROUTINE VIA A BRANCH.   02500002
*                                                                       02600021
*                                                                       02700021
* INPUT -                                                               02800021
*    INPUT FROM EXTEND MODULE IGG0553A:                                 02810002
*    REGISTER 4 POINTS TO THE I/O SUPPORT WORK AREA, WHICH CONTAINS     02820021
*    THE FORMAT 4 DSCB.                                                 02840002
*    REGISTER 11 POINTS TO THE EXTEND WORK AREA, WHICH CONTAINS THE     02860002
*    ADDRESSES OF THE FORMAT 4 AND FORMAT 5 DSCBS.                      02870002
*    THE I/O SUPPORT WORK AREA IS LAID OUT AS FOLLOWS:                  02880021
*                                                                       02900021
*          BYTES          AREA                                          02920021
*         *******        ******                                         02940021
*          100            DSCB FIELD                                    02960021
*          176            JFCB                                          02980021
*            4            ECB                                           03000021
*           40            IOB                                           03020021
*           44            DEB                                           03040021
*            4            DCB                                           03060021
*           96            CCW'S                                         03080021
*                                                                       03090002
*    INPUT FROM THE VTOC CONVERSION ROUTINES:                           03100002
*    REGISTER 4 POINTS TO THE I/O SUPPORT WORK AREA.                    03110002
*    REGISTER 8 CONTAINS A RETURN CODE.                                 03120002
*    REGISTER 13 POINTS TO THE ALLOCATE WORK AREA.                      03130002
*                                                                       03344000
* OUTPUT -                                                              03344400
*    OUTPUT TO THE DOS VTOC CONVERSION ROUTINE:                         03350021
*    REGISTER 7 POINTS TO THE UCB.                                      03360002
*    REGISTER 13 POINTS TO THE ALLOCATE WORK AREA, WHICH CONTAINS A     03400021
*    DEB/DCB, IOB, ECB, THE FORMAT 4 DSCB, AND THE ADDRESSES OF THE     03450021
*    FORMAT 4 AND 5 DSCB'S.                                             03500021
*                                                                       03550021
*    OUTPUT TO IGG0553G:                                                03600021
*    THE I/O SUPPORT WORK AREA WILL CONTAIN THE CONVERTED FORMAT 4      03650021
*    DSCB.  THE EXTEND WORK AREA WILL CONTAIN THE ADDRESSES OF THE      03660002
*    FORMAT 4 AND FORMAT 5 DSCB'S.                                      03700002
*                                                                       03800021
* EXTERNAL ROUTINES                                                     03900021
*         EXCP(0) EXECUTE A CHANNEL PROGRAM                             04000021
*         WAIT(1) WAIT ON AN EVENT CONTROL BLOCK                        04100021
*         IECRES - GET/FREE THE WORK AREA, BRANCH TO OTHER MODULES      04300002
*                                                                       04500021
* EXITS -                                                               04600021
*    NORMAL - BRANCH TO IGG0325Z TO CONVERT THE VTOC                    04700002
*             BRANCH TO IGG0553G TO CONTINUE THE EXTEND FUNCTION        04750002
*                                                                       04800021
*    ERROR  - BRANCH TO IGG0553E WITH THE ENTRY CODE IN REGISTER 13     04900002
*    THE ENTRY CODE BYTE WILL BE MODIFIED FOR THE FOLLOWING ERRORS:     05000021
*    X'11' - I/O ERROR (EOV ENTRY TO EXTEND ON THE SAME VOLUME)         05100002
*    X'12' - I/O ERROR (CVOL CATALOG ENTRY TO EXTEND AN OS CATALOG)     05150002
*    X'14' - I/O ERROR (EOV ENTRY TO EXTEND ON A NEW VOLUME)            05200002
*    X'91' - I/O ERROR (VSAM ENTRY TO EXTEND A DATA SPACE)              05300002
*    X'09' - UNABLE TO CONVERT THE VTOC (EOV ENTRY FOR SAME VOLUME)     05400002
*    X'0A' - UNABLE TO CONVERT THE VTOC (CVOL CATALOG ENTRY TO EXTEND)  05450002
*    X'0C' - UNABLE TO CONVERT THE VTOC (EOV ENTRY FOR NEW VOLUME)      05500002
*    X'89' - UNABLE TO CONVERT THE VTOC (VSAM ENTRY TO EXTEND)          05600002
*                                                                       05900021
* ATTRIBUTES                                                            06000021
*    REENTRANT                                                          06100021
*                                                                       06300021
* STORAGE -                                                             06340021
*    PROGRAM CODE CSECT - LESS THAN 1024 BYTES                          06380002
*    ALLOCATE WORK AREA    - AS DEFINED BY THE IECALLWA MACRO           06420002
*    EXTEND WORK AREA      - AS DEFINED BY THE IECEXTWA MACRO           06460002
*    RPS WORK AREA         - LENGTH IS DEFINED IN THE IECRPS MACRO      06480002
*    I/O SUPPORT WORK AREA                                              06530002
*                                                                       06539200
* OTHER MACROS USED -                                                   06540021
*    CVT - TO REFERENCE THE CVT                                         06580021
*    IECALLWA - TO DEFINE THE ALLOCATE WORK AREA                        06620002
*    IECEXTWA - TO DEFINE THE EXTEND WORK AREA                          06640002
*    IECDSECT - TO DEFINE THE I/O SUPPORT WORK AREA                     06660021
*    IECSDSL1 - TO SYMBOLICALLY ADDRESS DSCB'S                          06700021
*                                                                       06740021
* NOTES -                                                               06780021
*    EXTEND WILL ACCEPT THE FOLLOWING ERROR CODES FROM THE VTOC CONVERT 06900021
*    ROUTINE (PASSED IN REGISTER 8)                                     07000021
*       X'0C' - PERMANENT I/O ERROR.                                    07100021
*       X'48' - VTOC CANNOT BE CONVERTED BECAUSE OF ONE OF THE          07200002
*               FOLLOWING ERRORS:                                       07220002
*               1. OVERLAPPING EXTENTS IN THE VTOC.                     07240002
*               2. AN OVERLAPPING DOS SPLIT CYLINDER EXTENT.            07260002
*               3. IGG0325Z WAS MODIFIED TO PREVENT VTOC CONVERSION     07280002
*                  WHEN THE DIRF BIT WAS PREVIOUSLY SET.                07300002
*    FOR ANY CHANGES OR ADDITIONS TO THE ERROR CODES PASSED BY THE VTOC 07400021
*    CONVERT ROUTINE, INTERFACES WILL HAVE TO BE MADE WITH EOV AND      07500021
*    VSAM CATALOG/DADSM.                                                07600002
*                                                                       07800021
*                                                                       07900021
*********************************************************************** 08000021
*                                                                       08100021
*        REGISTER EQUATES                                               08200021
*                                                                       08300021
REG0     EQU   0                        WORK REGISTER            M0130  08400021
REG1     EQU   1                        WORK REGISTER                   08500021
REG2     EQU   2                        WORK REGISTER                   08600021
REG3     EQU   3                        WORK REGISTER                   08700021
REG4     EQU   4                        WORK REGISTER                   08800021
RCORE    EQU   4                        EOV WORK AREA ADDRESS           08900021
RDEB     EQU   5                        DEB POINTER              Y02080 09000002
REG6     EQU   6                        WORK REGISTER                   09200021
REG7     EQU   7                        WORK REGISTER                   09300021
RUCB     EQU   7                        UCB BASE REG                    09400021
REGERROR EQU   8                        ERROR CODE PASSED IN REG        09500021
BASEREG  EQU   9                        BASE REG FOR THIS MODULE        09700021
REG10    EQU   10                       WORK REGISTER            M0130  09760021
EXWKA    EQU   11                       EXTEND WORK AREA ADDRESS Y02080 09820002
REG12    EQU   12                       WORK REGISTER                   09900021
REG13    EQU   13                       WORK REG AND PASS ERROR CODES   10000021
RWKAREA  EQU   13                       ALLOCATE WORK AREA REG          10100021
RBACK    EQU   14                       RETURN REGISTER                 10200021
RCVT     EQU   15                       CVT BASE                        10300021
*                                                                       10400021
*        CONSTANT EQUATES                                               10500021
*                                                                       10600021
K0       EQU   0                        CONSTANT OF 0                   10700021
K2       EQU   2                        CONSTANT OF 2            Y02080 10800002
K4       EQU   4                        CONSTANT OF 4                   11000021
K8       EQU   8                        CONSTANT OF 8            Y02144 11100002
K12      EQU   12                       CONSTANT OF 12           Y02080 11400002
K16      EQU   16                       CONSTANT OF 16                  11500021
K24      EQU   24                       CONSTANT OF 24                  11600021
X00      EQU   X'00'                    TEST FOR DUPLICATE NAME         12300021
*                                       TURN ON COMMAND CHAINING        12400021
X04      EQU   X'04'                    TEST FOR NEW VOLUME      Y02080 12600002
X10      EQU   X'10'                    I/O ERROR INDICATOR             12900021
X20      EQU   X'20'                    PERM I/O ERROR IN ECB           13000021
DIRFBIT  EQU   X'04'                    DIRFBIT IN DS4VTOCI      Y02080 13500002
E2NDNTRY EQU   X'08'                    SECOND ENTRY TO IGG0553F        13900021
*                                       VTOC NOT CONVERTIBLE ERR CODE   14000021
*                                                                       14300021
*                                                                       14400021
*********************************************************************** 14500021
*                                                                       14600021
*                                                                       14700021
         BALR  BASEREG,REG0             SET UP BASE REG                 14900021
         USING BEGIN,BASEREG            USE REG 9 AS BASE REG    M0130  15000021
         USING EOVWKA,RCORE             EOV WORK AREA POINTER    Y02080 15400002
         USING EXTNDWKA,EXWKA           EXTEND WORK AREA POINTER Y02080 15450002
*                                                                       15500021
BEGIN    EQU   *                                                 M0130  15560021
         TM    DXEXTSW,E2NDNTRY         IS THIS THE SECOND ENTRY Y02080 15620002
         BO    ERRORTST                 YES, GO TEST FOR ERRORS         15700021
*                                                                       15800021
* THIS SECTION OBTAINS CORE FOR THE ALLOCATE WORK AREA.                 15900002
*                                                                       16000021
         IECRES GET,EXTPR=(EXWKA),LV=WKALNGTH,ID=ALWA,           Y02080X16050002
               STM=(REG2,REG12,IECREGSV+K12)                     Y02080 16150002
         LR    RWKAREA,REG1             SET UP WORK AREA ADDRESS        16200021
         DROP  EXWKA                                             Y02080 16210002
         USING IECEXTPR,RWKAREA         ADDRESSABILITY TO THE    Y02080 16220002
*                                       EXTENDED PREFIX          Y02080 16240002
         LA    REG1,WTGMODNM            POINT TO ALLOCATE WTGTBL Y02080 16250002
         ST    REG1,IECWTGTB            FILL IN PTR TO WTG TABLE Y02080 16260002
         MVC   WTGWTOPR(L'WTOFLAGS),WTOFLAGS  FLAGS FOR RES WTO  Y02078 16270002
         DROP  RWKAREA                                           Y02080 16360002
         USING EXTNDWKA,EXWKA           EXTEND WORK AREA POINTER Y02080 16370002
         USING ALLOCWKA,RWKAREA         ALLOCATE WORK AREA PTR   Y02080 16400002
*                                                                       16900021
* THIS SECTION SAVES EXTEND'S REGISTERS.                                17000002
*                                                                       17100021
         STM   RCORE,RDEB,ALLADTRL      SAVE EOV WKA & DEB ADDR  Y02144 17200002
         ST    EXWKA,ALLADTRL+K8        SAVE EXTEND WKA ADDRESS  Y02144 17300002
*                                                                       17400021
* THIS SECTION BUILDS THE DCB/DEB, IOB, AND ECB.                        17500002
*                                                                       17600021
         MVC   DEB+K4(DXDCBDEB-DYYYY),DYYYY  MOVE IN EOV DEB     Y02080 17650002
         LA    REG1,DCB                 POINT TO ALLOCATE'S DCB  Y02080 17700002
         ST    REG1,DEB+K24             FILL IN DEB PTR TO DCB   Y02080 17750002
         LA    REG1,DEB                 PUT IN DEB POINTER       Y02080 20500002
         ST    REG1,DEBPTR              STORE IN DCB                    20600021
         MVC   IOB(DYYYY-DXIOB),DXIOB   MOVE IN EOV'S IOB        Y02080 20650002
         LA    REG2,ECB                 PUT IN ECB POINTER       Y02080 20700002
         ST    REG2,IOB+K4              STORE IN IOB             Y02080 20800002
         LA    REG2,CCW1                PUT IN CHANNEL PROGRAM POINTER  20900021
         LA    REG3,DCB                 PUT IN DCB POINTER       Y02080 21000002
         STM   REG2,REG3,IOB+K16        STORE IN IOB             Y02080 21100002
         L     RUCB,DXDEBUCB            LOAD UCB ADDRESS         Y02080 21200002
         MVC   VTOCADR,EVTOCADR         CCHHR OF THE F4 DSCB     Y02080 22600002
         MVC   DADSMADR,EDADSMAD        CCHHR OF THE 1ST F5 DSCB Y02080 23100002
         MVC   FMTOUTAD,EDADSMAD        INIT 1ST F5 OUTPUT ADDR  Y02080 23900002
         OI    DXEXTSW,E2NDNTRY         SET SECOND ENTRY BIT     Y02080 24000002
         OI    ACNVSW,EXTENDID          ENTRY IS FROM EXTEND     Y02080 24200002
         MVC   ADSCBF4(L'ADSCBF4),DXLBL  MOVE IN FORMAT 4 DSCB   Y02080 24250002
         TM    DS4VTOCI,DIRFBIT         TEST IF DIRF BIT WAS     Y02078 24260002
*                                       PREVIOUSLY SET           Y02078 24270002
         BO    GOCNVERT                 BRANCH IF NOT            Y02078 24280002
         OI    ACNVSW,DIRFSET           ENTRY DUE TO DIRF        Y02078 24290002
         OI    ADSCBF4+AF4VTOCI,DIRFBIT  SET THE DIRF BIT        Y02080 24300002
         DROP  EXWKA                                             Y02080 24350002
         USING IECEXTPR,RWKAREA         ADDRESSABILITY TO THE    Y02080 24400002
*                                       EXTENDED PREFIX          Y02080 24410002
GOCNVERT EQU   *                        BRANCH LABEL             Y02078 24420002
        IECRES LOAD,EXTPR=(RWKAREA),MODNM=CONVLOAD,BRANCH=DIRECT Y02080 24450002
         DROP  RWKAREA                                           Y02080 24500002
         USING EXTNDWKA,EXWKA           EXTEND WORK AREA POINTER Y02080 24550002
         USING ALLOCWKA,RWKAREA         ALLOCATE WORK AREA PTR   Y02080 24600002
*                                                                       25400021
*                                                                       25500021
ERRORTST EQU   *                                                        25600021
*                                                                       25700021
*        RESTORE REGISTERS                                              25800021
*                                                                       25900021
         L     RDEB,ALLADTRL+K4         RESTORE DEB ADDRESS      Y02144 26100002
         L     EXWKA,ALLADTRL+K8        RESTORE EXTEND WKA ADDR  Y02144 26200002
*                                                                       26700021
*        TEST FOR ERRORS FROM THE CONVERT ROUTINE                       26800021
*                                                                       26900021
         CH    REGERROR,PERMIO          IS THERE A PERMANENT I/O ERROR  27000021
         BE    ERROR                    YES, GO PROCESS ERROR           27100021
         CH    REGERROR,NOCONV          WAS THE VTOC CONVERTIBLE -      27200021
         BE    ERROR2                   NO, GO PROCESS ERROR            27400021
*                                                                       27600021
*        READ FORMAT 4 BACK INTO EOV WORKAREA                           27700021
*                   AND                                                 27800021
*              CONTINUE DUPLICATE NAME SEARCH                           27900021
*                                                                       28000021
         BAL   RBACK,EXECUT             GO READ F4                      28200021
         CLI   ECOUNT+K4,X00            TEST FOR DUPLICATE NAME  Y02080 28400002
         BE    GOAHEAD                  NO,SKIP NEW VOLUME TEST         28500021
         TM    DXEXTSW,X04              TEST FOR NEW VOLUME      Y02080 28600002
         BO    ERROR1                   BRANCH IF YES            M0130  28700021
         SR    RBACK,RBACK                                       M0130  28800021
         IC    RBACK,ECOUNT+K4          CCHHR OF F1 MUST BE DECR Y02080 29000002
         BCT   RBACK,STORER             BR IF NOT ZERO FOR STORE        29100021
         IC    RBACK,DS4DEVDT           SET TO LAST RECORD ON TRACK     29200021
STORER   EQU   *                        BRANCH LABEL             Y02080 29250002
         STC   RBACK,ECOUNT+K4          SET UP R OF F1 CCHHR     Y02080 29300002
GOAHEAD  EQU   *                                                        29400021
*                                                                       29500021
         NI    DXEXTSW,X'FF'-E2NDNTRY   TURN OFF 2ND PASS INDIC  Y02080 29600002
         LA    REG2,NEXTLOAD            POINT TO ID OF IGG0553G  Y02080 29650002
XCTLNOW  EQU   *                                                        30100021
         IECRES LOAD,EXTPR=(EXWKA),MODID=(REG2),BRANCH=DIRECT    Y02080 30150002
*                                                                       31000021
*        THIS ROUTINE EXECUTES A CHANNEL PROGRAM.                       31300021
*                                                                       31900021
EXECUT   EQU   *                                                        32000021
         EXCP  DXIOB                    EXECUTE CHANNEL PROGRAM  Y02080 32100002
         WAIT  1,ECB=DXECB              WAIT UNTIL COMPLETED     Y02080 32200002
         TM    DXECB,X20                CHECK FOR PERM IO ERROR  Y02080 32300002
         BCR   1,RBACK                  RETURN IF I/O SUCCESSFUL M0130  32320021
ERROR    EQU   *                                                 M0130  32340021
         OI    DXEXTSW,X10              X'10' INDICATES TO       Y02080 32360002
*                                       IGG0553E THAT AN I/O     M0130  32380021
*                                       ERROR OCCURRED           M0130  32400021
ERROR1   EQU   *                                                 M0130  32420021
         NI    DXEXTSW,X'FF'-E2NDNTRY   TURN OFF 2ND PASS INDIC  Y02080 32440002
ERROR2   EQU   *                                                 M0130  32460021
         LA    REG2,ERRORMOD            POINT TO ID OF IGG0553E  Y02080 32470002
         SR    REG13,REG13              CLEAR ERROR REGISTER     M0130  32500021
         IC    REG13,DXEXTSW            PICK UP ENTRY CODE       Y02080 32520002
         B     XCTLNOW                  GO XCTL                  M0130  32540021
*                                                                       32560021
*        CONSTANTS                                                      32580021
*                                                                       32600021
WTOFLAGS DS    X'000C0000'              MCS FLAGS FOR RES WTO    Y02078 32650002
         DS    0H                       HALFWORD BOUNDARY        Y02080 33050002
PERMIO   DC    X'000C'                  PERM I/O ERROR FROM CNVRT RTN   33100021
NOCONV   DC    X'0048'                  UNABLE TO CONVERT VTOC   Y02078 33200002
*                                                                       33500021
* TABLE OF MODULE IDS, MODULE NAMES, AND ENTRY POINT ADDRESSES          33600002
*                                                                       33700021
XCTLTABL XCTLTABL ID=(CONVLOAD,IGG0325Z,ERRORMOD,3E,             Y02080X33750002
               NEXTLOAD,3G),SVC=055,LENGTH=,BRT=YES              Y02080 33850002
         EJECT                                                   Y02080 33900002
EOVWKA   DSECT                                                   Y02080 35000002
         IECDSECT                                                       35200021
         EJECT                                                   Y02144 35250002
         ORG   DXLBL                                                    37200021
         IECSDSL1 (4)                                                   37300021
AF4VTOCI EQU   DS4VTOCI-DS4IDFMT        OFFSET TO DS4VTOCI FIELD Y02080 37310002
         EJECT                                                   Y02080 37450002
WORKAREA IECEXTWA EP                    EXTEND WORK AREA         Y02080 37500002
         EJECT                                                   Y02080 37550002
DSCBWKAR IECALLWA ,                     ALLOCATE WORK AREA       Y02080 37600002
WKALNGTH EQU   ALLWAEND-ALLOCWKA        ALLOCATE WKAREA LENGTH   Y02080 37610002
         EJECT                                                   Y02080 37650002
CVT      DSECT                          CVT DSECT                Y02080 37700002
         CVT                                                     Y02080 37750002
         END                                                            55500021
./  ADD  SSI=33400784,NAME=IGG0553G
    TITLE      'IGG0553G - EXTEND - SPLIT OF IGG0553A'                  00017021
IGG0553G CSECT                                                          00019021
*                                                                       00021002
*MODULE NAME = IGG0553G                                                 00021402
*                                                                       00021802
*DESCRIPTIVE NAME = EXTEND - SPLIT OF IGG0553A                          00022202
*                                                                       00022602
*COPYRIGHT = NONE                                                       00022702
*                                                                       00022802
*CHANGE ACTIVITY = SEE BELOW                                            00022902
*                                                                       00024802
*        RELEASE 21 NEW MODULE                                          00027402
*0000001930,003700-005200,007600-008200,009600,009800-011000,    M0130  00029302
*0000011800-013000,013400-013800,015200,015600-015800,016600,    M0130  00031202
*0000019200,020420,020470-020500,020600-020800,021400-021600,    M0130  00033102
*0000022000,043200-043600,044400-044600,045140,045180-046000,    M0130  00035002
*0000046400-047200,048600,053210,072000-072200,084100,084400,    M0130  00036902
*0000086400-087620,088400-091200,091800-092200                   M0130  00038802
*          RELEASE 21.7 DELETIONS/CHANGES                               00040702
*0000000270,002230                                              SA61344 00042602
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00044502
*0000000030-000150,000280-000290,003400,003700,004200,004600,    Y02080 00046402
*0000007200-008293,009400,010000,010400,011400,012200,013220-    Y02080 00048302
*0000014196,015000-015700,016000-018400,018800,019200-020000,    Y02080 00050202
*0000020400-020434,020490-020560,031000-040200,042000-043200,    Y02080 00052102
*0000043800,044500,045120-045360,045760-045960,047600-050000,    Y02080 00054002
*0000050800-051000,052000-052200,052600-053210,053290,053310,    Y02080 00055902
*0000054800,055200,055800,055920,056600,058400,059000-059400,    Y02080 00057802
*0000067400,069800,071200,084000-084200,084400,084600-085600,    Y02080 00059702
*0000086200-088000,089200,091800-315200                          Y02080 00061602
*0000                                                           YA03162 00062002
*                                                                     * 00063502
* STATUS CHANGE LEVEL 001                                             * 00065402
*                                                                     * 00067302
*SPLIT OF IGG0553A FOR RELEASE 21                                     * 00069202
*                                                                     * 00071102
*FUNCTION/OPERATION:  THIS MODULE CALCULATES THE NUMBER OF TRACKS     * 00073021
*   NEEDED TO EXTEND THE DATASET. IF THE MOUNTED VOLUME IS THE LAST   * 00093021
*   VOLUME FOR THE DATASET TO BE EXTENDED THE LAST TRACK OF THE LAST  * 00113021
*   EXTENT IS USED AS A PREFERRED TRACK ADDRESS FOR THE EXTENSION.    * 00133021
*   THE REQUEST AS GIVEN IN THE JFCB IS CONVERTED TO TRACKS.  IF THE  * 00153021
*   REQUEST IS OF THE AVERAGE-RECORD-LENGTH TYPE THE JFCBLKSI FIELD   * 00173021
*   IS USED TO DETERMINE THE AVERAGE RECORD LENGTH.  IF THE JFCBLKSI  * 00223002
*   FIELD IS ZERO, THE JFCBDRLH FIELD IS USED.  IF BOTH FIELDS ARE    * 00230002
*   ZERO, NO SPACE WILL BE GOTTEN.                                    * 00240002
*                                                                     * 00280021
*ENTRY POINTS:                                                        * 00300021
*        IGG0553G - ONLY ENTRY POINT TO THIS MODULE.  ENTRY IS        * 00320000
*        MADE FROM IGG0553A OR IGG0553F VIA A BRANCH.                 * 00340002
*                                                                     * 00360021
*INPUT:                                                               * 00380021
*   REGISTER 4 POINTS TO THE I/O SUPPORT WORK AREA, WHICH CONTAINS    * 00400021
*   THE FORMAT 4 DSCB.                                                * 00420002
*   REGISTER 5 POINTS TO THE USER'S DEB.                              * 00440021
*   REGISTER 11 POINTS TO THE EXTEND WORK AREA, WHICH CONTAINS THE    * 00460002
*   ADDRESSES OF THE FORMAT 4 AND FIRST FORMAT 5 DSCBS.               * 00470002
*   THE I/O SUPPORT WORK AREA IS LAID OUT AS FOLLOWS:                 * 00480021
*                                                                     * 00500021
*          BYTES          AREA                                        * 00540021
*         *******        ******                                       * 00560021
*          100           DSCB FIELD                                   * 00580021
*          176           JFCB                                         * 00600021
*            4           ECB                                          * 00620021
*           40           IOB                                          * 00640021
*           44           DEB                                          * 00660021
*            4           DCB                                          * 00680021
*           96           CCW'S                                        * 00700021
*                                                                     * 00720002
*OUTPUT:                                                              * 00740002
*   REGISTER 5 POINTS TO THE USER'S DEB.                              * 00760002
*   REGISTER 12 WILL CONTAIN THE AMOUNT OF SPACE REQUESTED.           * 00780002
*   REGISTER 13 WILL CONTAIN THE RTA OF THE PREFERRED EXTENT.         * 00800002
*                                                                     * 00840021
*EXTERNAL ROUTINES:                                                   * 00860021
*        IECRES - BRANCH TO OTHER MODULES                             * 00940002
*                                                                     * 00960021
*EXITS:                                                               * 00980021
*   NORMAL - BRANCH TO IGG0553B                                       * 01000002
*                                                                     * 01020021
*   ERROR  - BRANCH TO IGG0553E WITH THE ENTRY CODE IN REGISTER 13    * 01040002
*   ERRORS MAY BE: LESS THAN 3 UNUSED DSCB'S IN THE VTOC              * 01060021
*                                                                     * 01120021
*ATTRIBUTES: REENTRANT                                                * 01140002
*                                                                     * 01160021
*OTHER MACROS USED:                                                   * 01180021
*   CVT - TO REFERENCE THE CVT                                        * 01200021
*   IECEXTWA - TO DEFINE THE EXTEND WORK AREA                         * 01220002
*   IECDSECT - TO DEFINE THE I/O SUPPORT WORK AREA                    * 01240021
*   IECSDSL1 - TO SYMBOLICALLY ADDRESS DSCB'S                         * 01260021
*                                                                     * 01320021
*STORAGE:                                                             * 01330021
*   PROGRAM CODE CSECT - LESS THAN 1024 BYTES                         * 01340002
*   EXTEND WORK AREA - AS DEFINED IN THE IECEXTWA MACRO               * 01350002
*   RPS WORK AREA - AS DEFINED IN THE IECRPS MACRO                    * 01360002
*   I/O SUPPORT WORK AREA                                             * 01410002
*                                                                       01419700
*                                                                       01420021
         BALR  RBASE,K0                 ESTABLISH ADDRESSABILITY Y02080 01500002
         USING BEGIN,RBASE                                       Y02080 01520002
         USING EOVWKA,RCORE             EOV W/A ADDRESSABILITY   Y02080 01540002
         USING EXTNDWKA,EXWKA           WORK AREA ADDRESSABILITY Y02080 01570002
*                                                                       01612021
* REGISTER EQUATES                                                      01614021
*                                                                       01616021
REG0     EQU   0                        EQUATE FOR REGISTER 0    Y02080 01620002
REG1     EQU   1                        EQUATE FOR REGISTER 1    Y02080 01640002
REG2     EQU   2                        WORK REGISTER            Y02080 01670002
RBASE    EQU   3                        BASE REGISTER            Y02080 01680002
RCORE    EQU   4                        EOV WORK AREA ADDRESS    Y02080 01700002
RDEB     EQU   5                        DEB POINTER              Y02080 01740002
FREEREGE EQU   6                        EVEN REGISTER            Y02080 01780002
FREEREGO EQU   7                        ODD REGISTER             Y02080 01820002
FREEREGA EQU   8                                                        01860021
FREEREGB EQU   9                                                        01900021
REG9     EQU   9                        EQUATE FOR REGISTER 9    Y02080 01910002
REG10    EQU   10                       WORK REGISTER            Y02080 01920002
EXWKA    EQU   11                       EXTEND WORK AREA POINTER Y02080 01940002
REQ      EQU   12                       SPACE REQUESTED REGISTER Y02080 01960002
RPREF    EQU   13                       PREFERRED RTA REGISTER   Y02080 01980002
REG13    EQU   13                       EQUATE FOR REGISTER 13   Y02080 01990002
RETNREG  EQU   14                                                       02020021
RWRK     EQU   15                       WORK REGISTER            Y02080 02030002
*                                                                       02032002
* OTHER EQUATES                                                         02034002
*                                                                       02036002
K0       EQU   0                        CONSTANT OF 0            Y02080 02038002
K1       EQU   1                        CONSTANT OF 1            Y02080 02040002
K2       EQU   2                        CONSTANT OF 2            Y02080 02042002
K3       EQU   3                        CONSTANT OF 3                   02044021
K4       EQU   4                        CONSTANT OF 4            Y02080 02044402
K6       EQU   6                        CONSTANT OF 6            Y02080 02044802
K7       EQU   7                        CONSTANT OF 7                   02045021
K8       EQU   8                        CONSTANT OF 8            Y02080 02045102
K12      EQU   12                       CONSTANT OF 12           Y02080 02045402
X04      EQU   X'04'                    CONSTANT OF X'04'               02046021
NUMEXT   EQU   16                                                M0130  02047021
FIREXT   EQU   36                                                M0130  02048021
TBOVHD   EQU   X'08'                    TWO BYTE OVERHEAD FLAG   S20201 02100021
*                                                                       02120021
* THIS SECTION TESTS IF THERE ARE 3 UNUSED DSCB'S IN THE VTOC.          02150021
*                                                                       02180021
BEGIN    EQU   *                                                 M0130  02580021
         LA    RWRK,K3                                           Y02080 03100002
         CH    RWRK,DS4DSREC            TEST FOR 3 HOLES IN VTOC Y02080 04020002
         BH    NOROOM                   BRANCH IF LESS THAN 3           04040021
*                                                                       04100021
* THIS SECTION CHECKS TO SEE IF A NEW VOLUME HAS BEEN MOUNTED AND IF SO 04120021
* THE CALCULATION OF THE LAST TRACK USED BY THE DATA SET IS OMITTED     04140021
*                                                                       04160021
         SR    FREEREGO,FREEREGO                                        04180021
         IC    FREEREGO,NUMEXT(RDEB)    COMPUTE ADDRESS OF LAST  Y02080 04200002
         BCTR  FREEREGO,K0                EXTENT IN THE DEB      Y02080 04220002
         SLL   FREEREGO,K4                                       Y02080 04240002
         LA    FREEREGE,FIREXT(RDEB)                             Y02080 04260002
         AR    FREEREGO,FREEREGE        SET UP EXTENT ADDRESS    Y02080 04280002
         LR    FREEREGA,FREEREGO                                 Y02080 04300002
         TM    DXEXTSW,X04              TEST FOR NEW VOLUME      Y02080 04320002
         BZ    COMPRTA                  BRANCH IF NOT            M0130  04340021
         SR    RPREF,RPREF              ZERO PREFERRED RTA REG   Y02080 04380002
         B     CYLTRKRC                                                 04400021
*                                                                       04420021
* THIS SECTION BRANCHES TO ANOTHER MODULE.                              04450002
*                                                                       04480021
NOROOM   EQU   *                                                 O19117 04488021
         LA    REG2,LASTLOAD            POINT TO ID OF IGG0553E  Y02080 04498002
         SR    REG13,REG13              CLEAR ERROR REGISTER     Y02080 04516002
         IC    REG13,DXEXTSW            INSERT CALLER CODE       Y02080 04536002
XCTLHERE EQU   *                                                 M0130  04556021
         IECRES LOAD,EXTPR=(EXWKA),MODID=(REG2),BRANCH=DIRECT    Y02080 04606002
*                                                                       04620021
* THE LAST TRACK USED IS OBTAINED FROM THE DEB AND CONVERTED FROM       04660021
* CCHH TO RTA. THIS RTA IS THE PREFERRED EXTENT.                        04700021
*                                                                       04740021
COMPRTA  EQU   *                        BRANCH LABEL             Y02080 04750002
         LA    FREEREGO,K6(FREEREGO)    POINTER TO CCHH          Y02080 04760002
         USING CVT,RWRK                 CVT ADDRESSABILITY       Y02080 04770002
         L     RWRK,CVTPTR              LOAD CVT ADDRESS         Y02080 04780002
         STM   REG9,REG13,IECREGSV+K12  SAVE REGISTERS           Y02080 04800002
         LA    REG1,DXDEB               SET POINTER TO DEB       Y02080 04820002
         XC    DXCCW12,DXCCW12                                   Y02080 04840002
         MVC   DXCCW12+K3(K4),0(FREEREGO)  SET UP CCHH           Y02080 04860002
         LA    REG2,DXCCW12             MBBCCHHR POINTER         Y02080 04880002
         L     RWRK,CVTPRLTV            ADDRESS OF CONVERT RTN   Y02080 04900002
         LR    FREEREGE,EXWKA           SAVE EXTEND WKA ADDRESS  Y02080 04910002
         BALR  RETNREG,RWRK             LINK TO CONVERT ROUTINE  Y02080 04920002
         LM    REG9,REG13,IECREGSV+K12-EXTNDWKA(FREEREGE)        Y02080 04940002
         LR    RPREF,REG0               SET UP PREFERRED RTA     Y02080 04960002
         SRL   RPREF,16                 SET UP PREFEERED RTA     Y02080 04980002
         LA    RPREF,K1(RPREF)                                   Y02080 05000002
*                                                                       05020021
* TEST FOR PRIMARY QUANTITY IN RECORDS                                  05040021
*                                                                       05060021
CYLTRKRC EQU   *                        BRANCH LABEL             Y02080 05070002
         XC    ETTRLL,ETTRLL            ZERO LAST BLOCK PTR      Y02080 05080002
         MVC   ETTRLL+K3(K2),DS4DEVTK   MOVE TRACK SIZE TO LL    Y02080 05100002
         TM    JFCBCTRI,X'C0'           IS PRI QTY IN CYLINDERS         05120021
         BC    1,INCYLIND               BRANCH IF YES                   05140021
         TM    JFCBCTRI,X'40'           IS PRI QTY IN RECORDS           05160021
         BC    1,INRECORD               BRANCH IF YES                   05180021
         L     REQ,JFCBSQTY             REQUEST IS TRACKS        Y02080 05200002
         SRL   REQ,K8                                            Y02080 05220002
         B     CLEANUP                                                  05240021
INCYLIND EQU   *                        BRANCH LABEL             Y02080 05250002
         L     REQ,JFCBSQTY             LOAD NUMBER OF CYLINDERS Y02080 05260002
         SRL   REQ,K8                                            Y02080 05270002
SETREQ   EQU   *                        CYLINDERS ARE MULTIPLIED Y02080 05290002
         MH    REQ,DS4DEVSZ+K2          BY TRACKS PER CYLINDER   Y02080 05300002
CLEANUP  EQU   *                        BRANCH LABEL             Y02080 05310002
         LA    REG2,NEXTLOAD            POINT TO ID OF IGG0553B  Y02080 05320002
         TM    DXEXTSW,X04              TEST FOR NEW VOLUME      Y02080 05321002
         BZ    XCTLHERE                 BRANCH IF NO                    05322021
         TM    JFCBLTYP,X'08'           USER LABEL REQUEST         UL17 05323021
         BZ    XCTLHERE                 BRANCH IF NO               UL17 05324021
         TM    JFCDSORG,JFCORGDA        TEST IF BDAM LOAD MODE  YA03162 05324402
         BO    XCTLHERE                 BR YES, NO UL 2ND VOL   YA03162 05324802
         TM    JFCBCTRI,X'C0'           TEST FOR CYLINDER REQUEST  UL17 05325021
         BC    1,USERCYL                BRANCH IF YES              UL17 05326021
         TM    JFCBCTRI,X'41'           RECORDS ROUNDED REQUEST    UL17 05327021
         BO    USERCYL                  BRANCH IF YES              UL17 05328021
         LA    REQ,K1(REQ)              ADD UL TRACK TO REQUEST  Y02080 05329002
         B     XCTLHERE                 GO TO EXIT                 UL17 05330021
USERCYL  EQU   *                        BRANCH LABEL             Y02080 05332002
         AH    REQ,DS4DEVSZ+K2          ADD USER LABEL FOR CYL   Y02080 05334002
         B     XCTLHERE                                                 05340021
INRECORD SR    FREEREGA,FREEREGA        SET UP CALLING SEQUENCE         05360021
         IC    FREEREGA,JFCKEYLE        PICK UP KEY LENGTH              05380021
         LH    FREEREGB,JFCBLKSI       PICK UP BLOCK LENGTH             05400021
         LTR   FREEREGB,FREEREGB        IS BLKSIZE AVAILABLE    SA61344 05402002
         BNZ   BLKSIZOK                 BRANCH IF YES           SA61344 05404002
         MVC   DXCCW12+K1(L'JFCBDRLH),JFCBDRLH  AVG RCD SIZE    SA61344 05406002
         L     FREEREGB,DXCCW12         LOAD AVERAGE RCD SIZE   SA61344 05408002
         LA    FREEREGB,0(FREEREGB)     CLEAR HIGH BYTE         SA61344 05410002
         LTR   FREEREGB,FREEREGB        AVG RCD SIZE AVAILABLE  SA61344 05412002
         BNZ   BLKSIZOK                 BRANCH IF YES           SA61344 05414002
         B     NOROOM                   UNABLE TO CALCULATE THE SA61344 05416002
*                                       SECONDARY SPACE         SA61344 05418002
*                                                                       05420021
* OVERHEAD IS CALCULATED IN THIS SECTION                                05440021
*                                                                       05460021
BLKSIZOK EQU   *                                                SA61344 05470002
         STM   FREEREGE,FREEREGO,IECREGSV+K12  SAVE REGISTERS    Y02080 05480002
         SR    FREEREGO,FREEREGO        CLEAR REGISTERS                 05500021
         LR    REG2,FREEREGO                                     Y02080 05520002
         LR    FREEREGE,FREEREGO                                        05540021
         IC    FREEREGO,DS4DEVI         OVERHEAD FOR AVERAGE RCD        05560021
         IC    REG2,DS4DEVL             OVERHEAD FOR LAST RCD    Y02080 05580002
         TM    DS4DEVFG,TBOVHD          TWO BYTE OVERHEAD        S20201 05583021
         BZ    NOTTB10                  BRANCH NO                S20201 05586021
         LH    FREEREGO,DS4DEVI         GET TWO BYTE OVERHEAD    S20201 05589021
         LR    REG2,FREEREGO            USE FOR LAST ALSO        Y02080 05592002
NOTTB10  EQU   *                                                 S20201 05595021
         LTR   FREEREGA,FREEREGA        TEST KEY LENGTH EQ TO ZERO      05600021
         BZ    CALOVHD                  CALCULATE NEW OVERHEAD          05620021
ADDKLDL  AR    FREEREGB,FREEREGA        ADD KEYLENGTH TO DATA LENGTH    05640021
         LR    REG1,FREEREGB                                     Y02080 05660002
         LH    FREEREGE,DS4DEVTL        PICK UP DEVICE TOLERANCE        05680021
         SR    FREEREGA,FREEREGA                                        05700021
         MR    FREEREGA,FREEREGE        (KL+DL)TOLERANCE FACTOR         05720021
         SRDA  FREEREGA,9                                               05740021
         AR    FREEREGB,FREEREGO        ADD OVERHEADD I - - TOTAL IS X  05760021
         LR    FREEREGA,FREEREGB        SET UP AVERAGE RCD LENGTH       05780021
         B     COMPLETE                                                 05800021
CALOVHD  IC    FREEREGE,DS4DEVK         SUBTRACT OVERHEAD CONSTANT      05820021
         SR    REG2,FREEREGE             L-K FOR NEW OVERHEAD    Y02080 05840002
         SR    FREEREGO,FREEREGE        REPEAT FOR AVERAGE RCD          05860021
         B     ADDKLDL                                                  05880021
COMPLETE EQU   *                        BRANCH LABEL             Y02080 05890002
         AR    REG1,REG2                                         Y02080 05900002
         LR    FREEREGB,REG1            SET UP LAST RCD LENGTH=Y Y02080 05920002
         LM    FREEREGE,FREEREGO,IECREGSV+K12  RESTORE REGISTERS Y02080 05940002
*                                                                       05960021
* TRKCAL ----  THIS ROUTINE CALCULATES HOW MANY RECORDS OF A GIVEN      05980021
* SIZE WILL FIT ON A TRACK.                                             06000021
* THE LENGTH IN BYTES OF AN AVERAGE RECORD AND OF A LAST RECORD ON A    06020021
* TRACK ARE TO BE IN REGISTERS 4(FREEREGA) AND 5(FREEREGB)              06040021
* RESPECTIVELY                                                          06060021
* THE NUMBER OF BYTES PER TRACK FOR THE DEVICE IS OBTAINED FROM THE     06080021
* DEVICE ENTRY OF THE FORMAT4 DSCB.                                     06100021
* RECORDS PER TRACK = 1 + (TRACK LENGTH-Y) / X                          06120021
* THE LENGTH OF A LAST RECORD ON A TRACK IS SUBTRACTED FROM THE TRACK   06140021
* LENGTH                                                                06160021
*                                                                       06180021
         LH    FREEREGO,DS4DEVTK                                        06200021
         SR    FREEREGO,FREEREGB        SUBTRACT Y FROM TRACK LENGTH    06220021
         BNL   SHORTREC                 BR IF RECORD DOES NOT EXCEED TK 06240021
*                                                                       06260021
* RECORDS EXCEED TRACK LENGTH. USE AVERAGE RCD AND MULTIPLY BY          06280021
* SECONDARY QUANTITY FOR TOTAL. DIVIDE BY DS4DEVTK FOR TRACKS           06300021
*                                                                       06320021
         L     FREEREGO,JFCBSQTY        SET UP NUMBER OF RECORDS        06340021
         SRL   FREEREGO,8                                               06360021
         MR    FREEREGE,FREEREGA        AVERAGE RCD/SECONDARY QUANTITY  06380021
         LH    FREEREGA,DS4DEVTK       TRACK LENGTH FOR DIVIDE          06400021
         B     LONGREC                  GO FOR DIVIDE                   06420021
*                                                                       06440021
* IF THE LAST RECORD DOES NOT EXCEED THE TRACK LENGTH THE REMAINDER     06460021
* IS DIVIDED BY THE AVERAGE RECORD LENGTH                               06480021
*                                                                       06500021
SHORTREC SR    FREEREGE,FREEREGE                                        06520021
         DR    FREEREGE,FREEREGA        DIVIDE BY AVERAGE RCD LENGTH    06540021
         LR    FREEREGA,FREEREGO                                        06560021
         LA    FREEREGA,1(FREEREGA)     INCREMENT RESULT BY ONE         06580021
         L     FREEREGO,JFCBSQTY        PICK UP SECONDARY QTY.          06600021
         SRL   FREEREGO,8                                               06620021
LONGREC  SR    FREEREGE,FREEREGE                                        06640021
         DR    FREEREGE,FREEREGA        DETERMINE NO. OF TRACKS         06660021
         LTR   FREEREGE,FREEREGE           FOR PRIMARY QUANTITY = A     06680021
         BZ    DONTINC                  BRANCH IF ZERO REMAINDER        06700021
         LA    FREEREGO,1(FREEREGO)    ADD 1 IF REMAINDER EXISTS        06720021
DONTINC  EQU   *                        BRANCH LABEL             Y02080 06730002
         LR    REQ,FREEREGO             ADD A TO B               Y02080 06740002
*                                                                       06760021
* A TEST IS MADE TO SEE IF THE ROUND TO CYLINDER OPTION IS SPECIFIED    06780021
*                                                                       06800021
         TM    JFCBCTRI,X'01'           TEST FOR ROUND OPTION           06820021
         BZ    CLEANUP                  BRANCH IF NOT ROUND             06840021
*                                                                       06860021
* WHEN THE ROUND TO FULL CYLINDERS OPTION IS GIVEN, THE NUMBER OF       06880021
* TRACKS IS DIVIDED BY THE NUMBER OF TRACKS PER CYLINDER TO SEE IF      06900021
* THERE ANY EXCESS TRACKS, AND IF SO THE NUMBER OF CYLINDERS IS         06920021
* INCREMENTED                                                           06940021
*                                                                       06960021
ROUNDUP  EQU   *                        BRANCH LABEL             Y02080 06970002
         LR    FREEREGB,REQ                                      Y02080 06980002
         SR    FREEREGA,FREEREGA       THE NUMBER OF TRACKS IS DIVIDED  07000021
         LH    FREEREGE,DS4DEVSZ+2        BY THE NUMBER OF TRACKS PER   07020021
         DR    FREEREGA,FREEREGE          CYLINDER                      07040021
         LTR   FREEREGA,FREEREGA       IF THERE IS A TRACK REMAINDER    07060021
         BZ    DONOTINC                   INCREMENT THE CYLINDER COUNT  07080021
         LA    FREEREGB,1(FREEREGB)                                     07100021
DONOTINC EQU   *                        BRANCH LABEL             Y02080 07110002
         LR    REQ,FREEREGB            SAVE NUMBER OF CYLINDERS  Y02080 07120002
         B     SETREQ                                                   07140021
*                                                                       07160021
* * * * *                     BEGINNING OF CONSTANTS          * * * * * 07180021
K16      DC    H'16'                                             M4027  07190021
*                                                                       08430021
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         08440002
*                                                                       08450021
XCTLTABL XCTLTABL ID=(NEXTLOAD,3B,LASTLOAD,3E),SVC=055,BRT=YES,  Y02080X08500002
               LENGTH=                                           Y02080 08550002
* * * * *                     END OF CONSTANTS                * * * * * 08580021
         EJECT                                                   Y02080 08590002
CVT      DSECT                                                          08600021
         CVT                                                     Y02080 08620002
         EJECT                                                   Y02080 08670002
WORKAREA IECEXTWA EP                    EXTEND WORK AREA         Y02080 08720002
         EJECT                                                   Y02080 08770002
EOVWKA   DSECT                          EOV WORK AREA DSECT      Y02080 08780002
         IECDSECT                                                       08820021
         EJECT                                                   Y02144 08920002
         ORG   DXLBL                                                    09140021
         IECSDSL1 (4)                                                   09160021
         END   IGG0553G                                                 49520021
